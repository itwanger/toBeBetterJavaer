import{_ as n}from"./plugin-vue_export-helper.21dcd24c.js";import{r as t,o as s,c,a as e,b as p,e as a,d as o}from"./app.5166dee0.js";const d={},i=a(`<p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-kafkahxzszj-03177674-8192-4e7e-a7e6-0d3593bd644e.jpg" alt=""></p><h2 id="\u57FA\u672C\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#\u57FA\u672C\u7B80\u4ECB" aria-hidden="true">#</a> \u57FA\u672C\u7B80\u4ECB</h2><p>Apache Kafka\u662F\u7531LinkedIn\u91C7\u7528Scala\u548CJava\u5F00\u53D1\u7684\u5F00\u6E90\u6D41\u5904\u7406\u8F6F\u4EF6\u5E73\u53F0\uFF0C\u5E76\u6350\u8D60\u7ED9\u4E86Apache Software Foundation\u3002</p><p>\u8BE5\u9879\u76EE\u65E8\u5728\u63D0\u4F9B\u7EDF\u4E00\u7684\u3001\u9AD8\u541E\u5410\u91CF\u3001\u4F4E\u5EF6\u8FDF\u7684\u5E73\u53F0\u6765\u5904\u7406\u5B9E\u65F6\u6570\u636E\u6D41\u3002</p><p>Kafka\u53EF\u4EE5\u901A\u8FC7Kafka Connect\u8FDE\u63A5\u5230\u5916\u90E8\u7CFB\u7EDF\uFF0C\u5E76\u63D0\u4F9B\u4E86Kafka Streams\u3002</p><p><strong>\u300CKafka\u7684\u7279\u6027\u300D</strong></p><p>Kafka\u662F\u4E00\u79CD\u5206\u5E03\u5F0F\u7684\uFF0C\u57FA\u4E8E\u53D1\u5E03/\u8BA2\u9605\u7684\u6D88\u606F\u7CFB\u7EDF\uFF0C\u4E3B\u8981\u7279\u6027\u5982\u4E0B\uFF1A</p><table><thead><tr><th>\u7279\u6027</th><th>\u5206\u5E03\u5F0F</th><th><strong>\u300C\u9AD8\u6027\u80FD\u300D</strong></th><th><strong>\u300C\u6301\u4E45\u6027\u548C\u6269\u5C55\u6027\u300D</strong></th></tr></thead><tbody><tr><td>\u63CF\u8FF0</td><td>\u591A\u5206\u533A</td><td>\u9AD8\u541E\u5410\u91CF</td><td>\u6570\u636E\u53EF\u6301\u4E45\u5316</td></tr><tr><td>\u591A\u526F\u672C</td><td>\u4F4E\u5EF6\u8FDF</td><td>\u5BB9\u9519\u6027</td><td></td></tr><tr><td></td><td></td><td></td><td></td></tr><tr><td>\u591A\u8BA2\u9605\u8005</td><td>\u9AD8\u5E76\u53D1</td><td>\u652F\u6301\u6C34\u5E73\u5728\u7EBF\u6269\u5C55</td><td></td></tr><tr><td></td><td></td><td></td><td></td></tr><tr><td>\u57FA\u4E8E ZooKeeper \u8C03\u5EA6</td><td>\u65F6\u95F4\u590D\u6742\u5EA6\u4E3A O(1)</td><td>\u6D88\u606F\u81EA\u52A8\u5E73\u8861</td><td></td></tr><tr><td></td><td></td><td></td><td></td></tr></tbody></table><h2 id="\u7248\u672C\u53F7" tabindex="-1"><a class="header-anchor" href="#\u7248\u672C\u53F7" aria-hidden="true">#</a> \u7248\u672C\u53F7</h2><p><strong>\u300CKafka\u7248\u672C\u547D\u540D\u300D</strong></p><p>\u6211\u4EEC\u5728\u5B98\u7F51\u4E0A\u4E0B\u8F7DKafka\u65F6\uFF0C\u4F1A\u770B\u5230\u8FD9\u6837\u7684\u7248\u672C\uFF1A</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-kafkahxzszj-677e0f86-8d4f-4db6-95eb-8bbab6da937a.jpg" alt=""></p><p>\u524D\u9762\u7684\u7248\u672C\u53F7\u662F\u7F16\u8BD1Kafka\u6E90\u4EE3\u7801\u7684Scala\u7F16\u8BD1\u5668\u7248\u672C\u3002</p><p>Kafka\u670D\u52A1\u5668\u7AEF\u7684\u4EE3\u7801\u5B8C\u5168\u7531Scala\u8BED\u8A00\u7F16\u5199\uFF0CScala\u540C\u65F6\u652F\u6301\u9762\u5411\u5BF9\u8C61\u7F16\u7A0B\u548C\u51FD\u6570\u5F0F\u7F16\u7A0B\uFF0C\u7528Scala\u5199\u6210\u7684\u6E90\u4EE3\u7801\u7F16\u8BD1\u4E4B\u540E\u4E5F\u662F\u666E\u901A\u7684<code>.class</code>\u6587\u4EF6\uFF0C\u56E0\u6B64\u6211\u4EEC\u8BF4Scala\u662FJVM\u7CFB\u7684\u8BED\u8A00\u3002</p><p>\u771F\u6B63\u7684Kafka\u7248\u672C\u53F7\u5B9E\u9645\u4E0A\u662F<code>2.1.1</code>\u3002</p><blockquote><p>\u275D</p><p>\u90A3\u4E48\u8FD9\u4E2A2.1.1\u53C8\u8868\u793A\u4EC0\u4E48\u5462\uFF1F</p><p>\u275E</p></blockquote><p>\u524D\u9762\u76842\u8868\u793A\u5927\u7248\u672C\u53F7\uFF0C\u5373Major Version\uFF1B\u4E2D\u95F4\u76841\u8868\u793A\u5C0F\u7248\u672C\u53F7\u6216\u6B21\u7248\u672C\u53F7\uFF0C\u5373Minor Version\uFF1B\u6700\u540E\u76841\u8868\u793A\u4FEE\u8BA2\u7248\u672C\u53F7\uFF0C\u4E5F\u5C31\u662FPatch\u53F7\u3002</p><p>Kafka\u793E\u533A\u5728\u53D1\u5E031.0.0\u7248\u672C\u540E\u5199\u8FC7\u4E00\u7BC7\u6587\u7AE0\uFF0C\u5BA3\u5E03Kafka\u7248\u672C\u547D\u540D\u89C4\u5219\u6B63\u5F0F\u4ECE4\u4F4D\u6F14\u8FDB\u52303\u4F4D\uFF0C\u6BD4\u59820.11.0.0\u7248\u672C\u5C31\u662F4\u4F4D\u7248\u672C\u53F7\u3002</p><p>\u6709\u4E2A\u5EFA\u8BAE\uFF0C\u4E0D\u8BBA\u7528\u7684\u662F\u54EA\u4E2A\u7248\u672C\uFF0C\u90FD\u8BF7\u5C3D\u91CF\u4FDD\u6301\u670D\u52A1\u5668\u7AEF\u7248\u672C\u548C\u5BA2\u6237\u7AEF\u7248\u672C\u4E00\u81F4\uFF0C\u5426\u5219\u4F60\u5C06\u635F\u5931\u5F88\u591AKafka\u4E3A\u4F60\u63D0\u4F9B\u7684\u6027\u80FD\u4F18\u5316\u6536\u76CA\u3002</p><p><strong>\u300C\u7248\u672C\u6F14\u8FDB\u300D</strong></p><p>0.7\u7248\u672C\uFF1A\u53EA\u63D0\u4F9B\u4E86\u6700\u57FA\u7840\u7684\u6D88\u606F\u961F\u5217\u529F\u80FD\u3002</p><p>0.8\u7248\u672C\uFF1A\u5F15\u5165\u4E86\u526F\u672C\u673A\u5236\uFF0C\u81F3\u6B64kafka\u6210\u4E3A\u4E86\u4E00\u4E2A\u6574\u6574\u610F\u4E49\u4E0A\u5B8C\u5907\u7684\u5206\u5E03\u5F0F\u53EF\u9760\u6D88\u606F\u961F\u5217\u89E3\u51B3\u65B9\u6848</p><p>0.9.0.0\u7248\u672C\uFF1A\u589E\u52A0\u4E86\u57FA\u7840\u7684\u5B89\u5168\u8BA4\u8BC1/\u6743\u9650\u529F\u80FD\uFF1B\u4F7F\u7528Java\u91CD\u65B0\u4E86\u65B0\u7248\u672C\u6D88\u8D39\u8005API\uFF1B\u5F15\u5165\u4E86Kafka Connect\u7EC4\u4EF6\u3002</p><p>0.11.0.0\u7248\u672C\uFF1A\u63D0\u4F9B\u4E86\u5E42\u7B49\u6027Producer API\u4EE5\u53CA\u4E8B\u52A1API\uFF1B\u5BF9Kafka\u6D88\u606F\u683C\u5F0F\u505A\u4E86\u91CD\u6784\u3002</p><p>1.0\u548C2.0\u7248\u672C\uFF1A\u4E3B\u8981\u8FD8\u662FKafka Streams\u7684\u5404\u79CD\u6539\u8FDB</p><h2 id="\u57FA\u672C\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#\u57FA\u672C\u6982\u5FF5" aria-hidden="true">#</a> \u57FA\u672C\u6982\u5FF5</h2><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-kafkahxzszj-0f6308dc-44db-49a2-9eec-50cf65958236.jpg" alt=""></p><p><strong>\u300C\u4E3B\u9898\u300D</strong></p><p>\u53D1\u5E03\u8BA2\u9605\u7684\u5BF9\u8C61\u662F\u4E3B\u9898\uFF08<code>Topic</code>\uFF09\uFF0C\u53EF\u4EE5\u4E3A\u6BCF \u4E2A\u4E1A\u52A1\u3001\u6BCF\u4E2A\u5E94\u7528\u751A\u81F3\u662F\u6BCF\u7C7B\u6570\u636E\u90FD\u521B\u5EFA\u4E13\u5C5E\u7684\u4E3B\u9898</p><p><strong>\u300C\u751F\u4EA7\u8005\u548C\u6D88\u8D39\u8005\u300D</strong></p><p>\u5411\u4E3B\u9898\u53D1\u5E03\u6D88\u606F\u7684\u5BA2\u6237\u7AEF\u5E94\u7528\u7A0B\u5E8F\u79F0\u4E3A\u751F\u4EA7\u8005\uFF0C\u751F\u4EA7\u8005\u7A0B\u5E8F\u901A\u5E38\u6301\u7EED\u4E0D\u65AD\u5730 \u5411\u4E00\u4E2A\u6216\u591A\u4E2A\u4E3B\u9898\u53D1\u9001\u6D88\u606F</p><p>\u8BA2\u9605\u8FD9\u4E9B\u4E3B\u9898\u6D88\u606F\u7684\u5BA2\u6237\u7AEF\u5E94\u7528\u7A0B\u5E8F\u5C31\u88AB\u79F0\u4E3A\u6D88\u8D39\u8005\uFF0C\u6D88\u8D39\u8005\u4E5F\u80FD\u591F\u540C\u65F6\u8BA2\u9605\u591A\u4E2A\u4E3B\u9898\u7684\u6D88\u606F</p><p><strong>\u300CBroker\u300D</strong></p><p>\u96C6\u7FA4\u7531\u591A\u4E2A Broker \u7EC4\u6210\uFF0C<code>Broker</code> \u8D1F\u8D23\u63A5\u6536\u548C\u5904\u7406\u5BA2\u6237\u7AEF\u53D1\u9001\u8FC7\u6765\u7684\u8BF7\u6C42\uFF0C\u4EE5\u53CA\u5BF9\u6D88\u606F\u8FDB\u884C\u6301\u4E45\u5316</p><p>\u867D\u7136\u591A\u4E2A Broker \u8FDB\u7A0B\u80FD\u591F\u8FD0\u884C\u5728\u540C\u4E00\u53F0\u673A\u5668\u4E0A\uFF0C\u4F46\u66F4\u5E38\u89C1\u7684\u505A\u6CD5\u662F\u5C06 \u4E0D\u540C\u7684 <code>Broker</code> \u5206\u6563\u8FD0\u884C\u5728\u4E0D\u540C\u7684\u673A\u5668\u4E0A\uFF0C\u8FD9\u6837\u5982\u679C\u96C6\u7FA4\u4E2D\u67D0\u4E00\u53F0\u673A\u5668\u5B95\u673A\uFF0C\u5373\u4F7F\u5728\u5B83\u4E0A\u9762 \u8FD0\u884C\u7684\u6240\u6709 Broker \u8FDB\u7A0B\u90FD\u6302\u6389\u4E86\uFF0C\u5176\u4ED6\u673A\u5668\u4E0A\u7684 <code>Broker</code> \u4E5F\u4F9D\u7136\u80FD\u591F\u5BF9\u5916\u63D0\u4F9B\u670D\u52A1</p><p><strong>\u300C\u5907\u4EFD\u673A\u5236\u300D</strong></p><p>\u5907\u4EFD\u7684\u601D\u60F3\u5F88\u7B80\u5355\uFF0C\u5C31\u662F\u628A\u76F8\u540C\u7684\u6570\u636E\u62F7\u8D1D\u5230\u591A\u53F0\u673A\u5668\u4E0A\uFF0C\u800C\u8FD9\u4E9B\u76F8\u540C\u7684\u6570\u636E\u62F7\u8D1D\u88AB\u79F0\u4E3A\u526F\u672C</p><p>\u5B9A\u4E49\u4E86\u4E24\u7C7B\u526F\u672C\uFF1A\u9886\u5BFC\u8005\u526F\u672C\u548C\u8FFD\u968F\u8005\u526F\u672C</p><p>\u524D\u8005\u5BF9\u5916\u63D0\u4F9B\u670D\u52A1\uFF0C\u8FD9\u91CC\u7684\u5BF9\u5916\u6307\u7684\u662F\u4E0E \u5BA2\u6237\u7AEF\u7A0B\u5E8F\u8FDB\u884C\u4EA4\u4E92\uFF1B\u800C\u540E\u8005\u53EA\u662F\u88AB\u52A8\u5730\u8FFD\u968F\u9886\u5BFC\u8005\u526F\u672C\u800C\u5DF2\uFF0C\u4E0D\u80FD\u4E0E\u5916\u754C\u8FDB\u884C\u4EA4\u4E92</p><p><strong>\u300C\u5206\u533A\u300D</strong></p><p>\u5206\u533A\u673A\u5236\u6307\u7684\u662F\u5C06\u6BCF\u4E2A\u4E3B\u9898\u5212\u5206\u6210\u591A\u4E2A\u5206\u533A\uFF0C\u6BCF\u4E2A\u5206\u533A\u662F\u4E00\u7EC4\u6709\u5E8F\u7684\u6D88\u606F\u65E5\u5FD7</p><p>\u751F\u4EA7\u8005\u751F\u4EA7\u7684\u6BCF\u6761\u6D88\u606F\u53EA\u4F1A\u88AB\u53D1\u9001\u5230\u4E00\u4E2A\u5206\u533A\u4E2D\uFF0C\u4E5F\u5C31\u662F\u8BF4\u5982\u679C\u5411\u4E00\u4E2A\u53CC\u5206\u533A\u7684\u4E3B\u9898\u53D1\u9001\u4E00\u6761\u6D88\u606F\uFF0C\u8FD9\u6761\u6D88\u606F\u8981\u4E48\u5728\u5206\u533A 0 \u4E2D\uFF0C\u8981\u4E48\u5728\u5206\u533A 1 \u4E2D</p><p>\u6BCF\u4E2A\u5206\u533A\u4E0B\u53EF\u4EE5\u914D\u7F6E\u82E5\u5E72\u4E2A\u526F\u672C\uFF0C\u5176\u4E2D\u53EA\u80FD\u6709 1 \u4E2A\u9886 \u5BFC\u8005\u526F\u672C\u548C N-1 \u4E2A\u8FFD\u968F\u8005\u526F\u672C</p><p>\u751F\u4EA7\u8005\u5411\u5206\u533A\u5199\u5165\u6D88\u606F\uFF0C\u6BCF\u6761\u6D88\u606F\u5728\u5206\u533A\u4E2D\u7684\u4F4D\u7F6E\u4FE1\u606F\u53EB\u4F4D\u79FB</p><p><strong>\u300C\u6D88\u8D39\u8005\u7EC4\u300D</strong></p><p>\u591A\u4E2A\u6D88\u8D39\u8005\u5B9E\u4F8B\u5171\u540C\u7EC4\u6210\u4E00\u4E2A\u7EC4\u6765 \u6D88\u8D39\u4E00\u7EC4\u4E3B\u9898</p><p>\u8FD9\u7EC4\u4E3B\u9898\u4E2D\u7684\u6BCF\u4E2A\u5206\u533A\u90FD\u53EA\u4F1A\u88AB\u7EC4\u5185\u7684\u4E00\u4E2A\u6D88\u8D39\u8005\u5B9E\u4F8B\u6D88\u8D39\uFF0C\u5176\u4ED6\u6D88\u8D39\u8005\u5B9E\u4F8B\u4E0D\u80FD\u6D88\u8D39\u5B83</p><blockquote><p>\u275D</p><p>\u540C\u65F6\u5B9E\u73B0\u4E86\u4F20\u7EDF\u6D88\u606F\u5F15\u64CE\u7CFB\u7EDF\u7684\u4E24\u5927\u6A21\u578B\uFF1A</p><p>\u275E</p></blockquote><p>\u5982\u679C\u6240\u6709\u5B9E\u4F8B\u90FD\u5C5E\u4E8E\u540C\u4E00\u4E2A <code>Group</code>\uFF0C \u90A3\u4E48\u5B83\u5B9E\u73B0\u7684\u5C31\u662F\u6D88\u606F\u961F\u5217\u6A21\u578B\uFF1B</p><p>\u5982\u679C\u6240\u6709\u5B9E\u4F8B\u5206\u522B\u5C5E\u4E8E\u4E0D \u540C\u7684 <code>Group</code>\uFF0C\u90A3\u4E48\u5B83\u5B9E\u73B0\u7684\u5C31\u662F\u53D1\u5E03/\u8BA2\u9605\u6A21\u578B</p><p><strong>\u300CCoordinator\uFF1A\u534F\u8C03\u8005\u300D</strong></p><p>\u6240\u8C13\u534F\u8C03\u8005\uFF0C\u5B83\u4E13\u95E8\u4E3AConsumer Group\u670D\u52A1\uFF0C\u8D1F\u8D23\u4E3AGroup\u6267\u884CRebalance\u4EE5\u53CA\u63D0\u4F9B\u4F4D\u79FB\u7BA1\u7406\u548C\u7EC4\u6210\u5458\u7BA1\u7406\u7B49\u3002</p><p>\u5177\u4F53\u6765\u8BB2\uFF0CConsumer\u7AEF\u5E94\u7528\u7A0B\u5E8F\u5728\u63D0\u4EA4\u4F4D\u79FB\u65F6\uFF0C\u5176\u5B9E\u662F\u5411Coordinator\u6240\u5728\u7684Broker\u63D0\u4EA4\u4F4D\u79FB\uFF0C\u540C\u6837\u5730\uFF0C\u5F53Consumer\u5E94\u7528\u542F\u52A8\u65F6\uFF0C\u4E5F\u662F\u5411Coordinator\u6240\u5728\u7684Broker\u53D1\u9001\u5404\u79CD\u8BF7\u6C42\uFF0C\u7136\u540E\u7531Coordinator\u8D1F\u8D23\u6267\u884C\u6D88\u8D39\u8005\u7EC4\u7684\u6CE8\u518C\u3001\u6210\u5458\u7BA1\u7406\u8BB0\u5F55\u7B49\u5143\u6570\u636E\u7BA1\u7406\u64CD\u4F5C\u3002</p><p>\u6240\u6709Broker\u5728\u542F\u52A8\u65F6\uFF0C\u90FD\u4F1A\u521B\u5EFA\u548C\u5F00\u542F\u76F8\u5E94\u7684Coordinator\u7EC4\u4EF6\u3002</p><p>\u4E5F\u5C31\u662F\u8BF4\uFF0C<strong>\u300C\u6240\u6709Broker\u90FD\u6709\u5404\u81EA\u7684Coordinator\u7EC4\u4EF6\u300D</strong>\u3002</p><p>\u90A3\u4E48\uFF0CConsumer Group\u5982\u4F55\u786E\u5B9A\u4E3A\u5B83\u670D\u52A1\u7684Coordinator\u5728\u54EA\u53F0Broker\u4E0A\u5462\uFF1F</p><p>\u901A\u8FC7Kafka\u5185\u90E8\u4E3B\u9898<code>__consumer_offsets</code>\u3002</p><p>\u76EE\u524D\uFF0CKafka\u4E3A\u67D0\u4E2AConsumer Group\u786E\u5B9ACoordinator\u6240\u5728\u7684Broker\u7684\u7B97\u6CD5\u67092\u4E2A\u6B65\u9AA4\u3002</p><ul><li>\u7B2C1\u6B65\uFF1A\u786E\u5B9A\u7531<code>__consumer_offsets</code>\u4E3B\u9898\u7684\u54EA\u4E2A\u5206\u533A\u6765\u4FDD\u5B58\u8BE5Group\u6570\u636E\uFF1A<code>partitionId=Math.abs(groupId.hashCode() % offsetsTopicPartitionCount)</code>\u3002</li><li>\u7B2C2\u6B65\uFF1A\u627E\u51FA\u8BE5\u5206\u533ALeader\u526F\u672C\u6240\u5728\u7684Broker\uFF0C\u8BE5Broker\u5373\u4E3A\u5BF9\u5E94\u7684Coordinator\u3002</li></ul><p>\u9996\u5148\uFF0CKafka\u4F1A\u8BA1\u7B97\u8BE5Group\u7684<code>group.id</code>\u53C2\u6570\u7684\u54C8\u5E0C\u503C\u3002</p><p>\u6BD4\u5982\u4F60\u6709\u4E2AGroup\u7684<code>group.id</code>\u8BBE\u7F6E\u6210\u4E86<code>test-group</code>\uFF0C\u90A3\u4E48\u5B83\u7684hashCode\u503C\u5C31\u5E94\u8BE5\u662F627841412\u3002</p><p>\u5176\u6B21\uFF0CKafka\u4F1A\u8BA1\u7B97<code>__consumer_offsets</code>\u7684\u5206\u533A\u6570\uFF0C\u901A\u5E38\u662F50\u4E2A\u5206\u533A\uFF0C\u4E4B\u540E\u5C06\u521A\u624D\u90A3\u4E2A\u54C8\u5E0C\u503C\u5BF9\u5206\u533A\u6570\u8FDB\u884C\u53D6\u6A21\u52A0\u6C42\u7EDD\u5BF9\u503C\u8BA1\u7B97\uFF0C\u5373<code>abs(627841412 % 50) = 12</code>\u3002</p><p>\u6B64\u65F6\uFF0C\u6211\u4EEC\u5C31\u77E5\u9053\u4E86<code>__consumer_offsets</code>\u4E3B\u9898\u7684\u5206\u533A12\u8D1F\u8D23\u4FDD\u5B58\u8FD9\u4E2AGroup\u7684\u6570\u636E\u3002</p><p>\u6709\u4E86\u5206\u533A\u53F7\uFF0C\u6211\u4EEC\u53EA\u9700\u8981\u627E\u51FA<code>__consumer_offsets</code>\u4E3B\u9898\u5206\u533A12\u7684Leader\u526F\u672C\u5728\u54EA\u4E2ABroker\u4E0A\u5C31\u53EF\u4EE5\u4E86\uFF0C\u8FD9\u4E2ABroker\uFF0C\u5C31\u662F\u6211\u4EEC\u8981\u627E\u7684Coordinator\u3002</p><p><strong>\u300C\u6D88\u8D39\u8005\u4F4D\u79FB\uFF1AConsumer Offset\u300D</strong></p><p>\u6D88\u8D39\u8005\u6D88\u8D39\u8FDB\u5EA6\uFF0C\u6BCF\u4E2A\u6D88\u8D39\u8005\u90FD\u6709\u81EA\u5DF1\u7684\u6D88\u8D39\u8005\u4F4D\u79FB\u3002</p><p><strong>\u300C\u91CD\u5E73\u8861\uFF1ARebalance\u300D</strong></p><p>\u6D88\u8D39\u8005\u7EC4\u5185\u67D0\u4E2A\u6D88\u8D39\u8005\u5B9E\u4F8B\u6302\u6389\u540E\uFF0C\u5176\u4ED6\u6D88\u8D39\u8005\u5B9E\u4F8B\u81EA\u52A8\u91CD\u65B0\u5206\u914D\u8BA2\u9605\u4E3B\u9898\u5206\u533A\u7684\u8FC7\u7A0B\u3002</p><p>Rebalance\u662FKafka\u6D88\u8D39\u8005\u7AEF\u5B9E\u73B0\u9AD8\u53EF\u7528\u7684\u91CD\u8981\u624B\u6BB5\u3002</p><p><strong>\u300CAR\uFF08Assigned Replicas\uFF09\u300D</strong>\uFF1A\u5206\u533A\u4E2D\u7684\u6240\u6709\u526F\u672C\u7EDF\u79F0\u4E3AAR\u3002</p><p>\u6240\u6709\u6D88\u606F\u4F1A\u5148\u53D1\u9001\u5230leader\u526F\u672C\uFF0C\u7136\u540Efollower\u526F\u672C\u624D\u80FD\u4ECEleader\u4E2D\u62C9\u53D6\u6D88\u606F\u8FDB\u884C\u540C\u6B65\u3002</p><p>\u4F46\u662F\u5728\u540C\u6B65\u671F\u95F4\uFF0Cfollower\u5BF9\u4E8Eleader\u800C\u8A00\u4F1A\u6709\u4E00\u5B9A\u7A0B\u5EA6\u7684\u6EDE\u540E\uFF0C\u8FD9\u4E2A\u65F6\u5019follower\u548Cleader\u5E76\u975E\u5B8C\u5168\u540C\u6B65\u72B6\u6001</p><p><strong>\u300COSR\uFF08Out Sync Replicas\uFF09\u300D</strong>\uFF1Afollower\u526F\u672C\u4E0Eleader\u526F\u672C\u6CA1\u6709\u5B8C\u5168\u540C\u6B65\u6216\u6EDE\u540E\u7684\u526F\u672C\u96C6\u5408</p><p><strong>\u300CISR\uFF08In Sync Replicas\uFF09\uFF1A</strong>\u300CAR\u4E2D\u7684\u4E00\u4E2A\u5B50\u96C6\uFF0CISR\u4E2D\u7684\u526F\u672C\u90FD\u300D<strong>\u662F\u4E0Eleader\u4FDD\u6301\u5B8C\u5168\u540C\u6B65\u7684\u526F\u672C\u300D</strong>\uFF0C\u5982\u679C\u67D0\u4E2A\u5728ISR\u4E2D\u7684follower\u526F\u672C\u843D\u540E\u4E8Eleader\u526F\u672C\u592A\u591A\uFF0C\u5219\u4F1A\u88AB\u4ECEISR\u4E2D\u79FB\u9664\uFF0C\u5426\u5219\u5982\u679C\u5B8C\u5168\u540C\u6B65\uFF0C\u4F1A\u4ECEOSR\u4E2D\u79FB\u81F3ISR\u96C6\u5408\u3002</p><p>\u5728\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u5F53leader\u526F\u672C\u53D1\u751F\u6545\u969C\u65F6\uFF0C\u53EA\u6709\u5728ISR\u96C6\u5408\u4E2D\u7684follower\u526F\u672C\u624D\u6709\u8D44\u683C\u88AB\u9009\u4E3E\u4E3A\u65B0leader\uFF0C\u800COSR\u4E2D\u7684\u526F\u672C\u6CA1\u6709\u673A\u4F1A\uFF08\u53EF\u4EE5\u901A\u8FC7<code>unclean.leader.election.enable</code>\u8FDB\u884C\u914D\u7F6E\uFF09</p><p><strong>\u300CHW\uFF08High Watermark\uFF09\u300D</strong>\uFF1A\u9AD8\u6C34\u4F4D\uFF0C\u5B83\u6807\u8BC6\u4E86\u4E00\u4E2A\u7279\u5B9A\u7684\u6D88\u606F\u504F\u79FB\u91CF\uFF08offset\uFF09\uFF0C\u6D88\u8D39\u8005\u53EA\u80FD\u62C9\u53D6\u5230\u8FD9\u4E2A\u6C34\u4F4D offset \u4E4B\u524D\u7684\u6D88\u606F</p><p>\u4E0B\u56FE\u8868\u793A\u4E00\u4E2A\u65E5\u5FD7\u6587\u4EF6\uFF0C\u8FD9\u4E2A\u65E5\u5FD7\u6587\u4EF6\u4E2D\u53EA\u67099\u6761\u6D88\u606F\uFF0C\u7B2C\u4E00\u6761\u6D88\u606F\u7684offset\uFF08LogStartOffset\uFF09\u4E3A0\uFF0C\u6700\u6709\u4E00\u6761\u6D88\u606F\u7684offset\u4E3A8\uFF0Coffset\u4E3A9\u7684\u6D88\u606F\u4F7F\u7528\u865A\u7EBF\u8868\u793A\u7684\uFF0C\u4EE3\u8868\u4E0B\u4E00\u6761\u5F85\u5199\u5165\u7684\u6D88\u606F\u3002</p><p>\u65E5\u5FD7\u6587\u4EF6\u7684 HW \u4E3A6\uFF0C\u8868\u793A\u6D88\u8D39\u8005\u53EA\u80FD\u62C9\u53D6offset\u5728 0 \u5230 5 \u4E4B\u95F4\u7684\u6D88\u606F\uFF0Coffset\u4E3A6\u7684\u6D88\u606F\u5BF9\u6D88\u8D39\u8005\u800C\u8A00\u662F\u4E0D\u53EF\u89C1\u7684\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-kafkahxzszj-f27928a8-9a91-4e39-a68d-c74d8a3291f1.jpg" alt=""></p><p><strong>\u300CLEO\uFF08Log End Offset\uFF09\u300D</strong>\uFF1A\u6807\u8BC6\u5F53\u524D\u65E5\u5FD7\u6587\u4EF6\u4E2D\u4E0B\u4E00\u6761\u5F85\u5199\u5165\u7684\u6D88\u606F\u7684offset</p><p>\u4E0A\u56FE\u4E2Doffset\u4E3A9\u7684\u4F4D\u7F6E\u5373\u4E3A\u5F53\u524D\u65E5\u5FD7\u6587\u4EF6\u7684 LEO\uFF0CLEO \u7684\u5927\u5C0F\u76F8\u5F53\u4E8E\u5F53\u524D\u65E5\u5FD7\u5206\u533A\u4E2D\u6700\u540E\u4E00\u6761\u6D88\u606F\u7684offset\u503C\u52A01</p><p>\u5206\u533A ISR \u96C6\u5408\u4E2D\u7684\u6BCF\u4E2A\u526F\u672C\u90FD\u4F1A\u7EF4\u62A4\u81EA\u8EAB\u7684 LEO \uFF0C\u800C ISR \u96C6\u5408\u4E2D\u6700\u5C0F\u7684 LEO \u5373\u4E3A\u5206\u533A\u7684 HW\uFF0C\u5BF9\u6D88\u8D39\u8005\u800C\u8A00\u53EA\u80FD\u6D88\u8D39 HW \u4E4B\u524D\u7684\u6D88\u606F\u3002</p><h2 id="\u7CFB\u7EDF\u67B6\u6784" tabindex="-1"><a class="header-anchor" href="#\u7CFB\u7EDF\u67B6\u6784" aria-hidden="true">#</a> \u7CFB\u7EDF\u67B6\u6784</h2><p><strong>\u300Ckafka\u8BBE\u8BA1\u601D\u60F3\u300D</strong></p><p>\u4E00\u4E2A\u6700\u57FA\u672C\u7684\u67B6\u6784\u662F\u751F\u4EA7\u8005\u53D1\u5E03\u4E00\u4E2A\u6D88\u606F\u5230Kafka\u7684\u4E00\u4E2ATopic \uFF0C\u8BE5Topic\u7684\u6D88\u606F\u5B58\u653E\u4E8E\u7684Broker\u4E2D\uFF0C\u6D88\u8D39\u8005\u8BA2\u9605\u8FD9\u4E2ATopic\uFF0C\u7136\u540E\u4ECEBroker\u4E2D\u6D88\u8D39\u6D88\u606F\uFF0C\u4E0B\u9762\u8FD9\u4E2A\u56FE\u53EF\u4EE5\u66F4\u76F4\u89C2\u7684\u63CF\u8FF0\u8FD9\u4E2A\u573A\u666F\uFF1A</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-kafkahxzszj-19b8855c-e132-4dc8-b8a6-ad03465e8af9.jpg" alt=""></p><p><strong>\u300C\u6D88\u606F\u72B6\u6001\uFF1A\u300D</strong> \u5728Kafka\u4E2D\uFF0C\u6D88\u606F\u662F\u5426\u88AB\u6D88\u8D39\u7684\u72B6\u6001\u4FDD\u5B58\u5728Consumer\u4E2D\uFF0CBroker\u4E0D\u4F1A\u5173\u5FC3\u6D88\u606F\u662F\u5426\u88AB\u6D88\u8D39\u6216\u88AB\u8C01\u6D88\u8D39\uFF0CConsumer\u4F1A\u8BB0\u5F55\u4E00\u4E2Aoffset\u503C\uFF08\u6307\u5411partition\u4E2D\u4E0B\u4E00\u6761\u5C06\u8981\u88AB\u6D88\u8D39\u7684\u6D88\u606F\u4F4D\u7F6E\uFF09\uFF0C\u5982\u679Coffset\u88AB\u9519\u8BEF\u8BBE\u7F6E\u53EF\u80FD\u5BFC\u81F4\u540C\u4E00\u6761\u6D88\u606F\u88AB\u591A\u6B21\u6D88\u8D39\u6216\u8005\u6D88\u606F\u4E22\u5931\u3002</p><p><strong>\u300C\u6D88\u606F\u6301\u4E45\u5316\uFF1A\u300D</strong> Kafka\u4F1A\u628A\u6D88\u606F\u6301\u4E45\u5316\u5230\u672C\u5730\u6587\u4EF6\u7CFB\u7EDF\u4E2D\uFF0C\u5E76\u4E14\u5177\u6709\u6781\u9AD8\u7684\u6027\u80FD\u3002</p><p><strong>\u300C\u6279\u91CF\u53D1\u9001\uFF1A\u300D</strong> Kafka\u652F\u6301\u4EE5\u6D88\u606F\u96C6\u5408\u4E3A\u5355\u4F4D\u8FDB\u884C\u6279\u91CF\u53D1\u9001\uFF0C\u4EE5\u63D0\u9AD8\u6548\u7387\u3002</p><p><strong>\u300CPush-and-Pull\uFF1A\u300D</strong> Kafka\u4E2D\u7684Producer\u548CConsumer\u91C7\u7528\u7684\u662FPush-and-Pull\u6A21\u5F0F\uFF0C\u5373Producer\u5411Broker Push\u6D88\u606F\uFF0CConsumer\u4ECEBroker Pull\u6D88\u606F\u3002</p><p><strong>\u300C\u5206\u533A\u673A\u5236\uFF08Partition\uFF09\uFF1A\u300D</strong> Kafka\u7684Broker\u7AEF\u652F\u6301\u6D88\u606F\u5206\u533A\uFF0CProducer\u53EF\u4EE5\u51B3\u5B9A\u628A\u6D88\u606F\u53D1\u5230\u54EA\u4E2APartition\uFF0C\u5728\u4E00\u4E2APartition\u4E2D\u6D88\u606F\u7684\u987A\u5E8F\u5C31\u662FProducer\u53D1\u9001\u6D88\u606F\u7684\u987A\u5E8F\uFF0C\u4E00\u4E2ATopic\u4E2D\u7684Partition\u6570\u662F\u53EF\u914D\u7F6E\u7684\uFF0CPartition\u662FKafka\u9AD8\u541E\u5410\u91CF\u7684\u91CD\u8981\u4FDD\u8BC1\u3002</p><p><strong>\u300C\u7CFB\u7EDF\u67B6\u6784\u300D</strong></p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-kafkahxzszj-784020d0-cc87-446a-9627-77a88e158d3d.jpg" alt=""></p><p>\u901A\u5E38\u60C5\u51B5\u4E0B\uFF0C\u4E00\u4E2Akafka\u4F53\u7CFB\u67B6\u6784\u5305\u62EC**\u300C\u591A\u4E2AProducer\u300D<strong>\u3001</strong>\u300C\u591A\u4E2AConsumer\u300D<strong>\u3001</strong>\u300C\u591A\u4E2Abroker\u300D<strong>\u4EE5\u53CA</strong>\u300C\u4E00\u4E2AZookeeper\u96C6\u7FA4\u300D**\u3002</p><p><strong>\u300CProducer\u300D</strong>\uFF1A\u751F\u4EA7\u8005\uFF0C\u8D1F\u8D23\u5C06\u6D88\u606F\u53D1\u9001\u5230kafka\u4E2D\u3002</p><p><strong>\u300CConsumer\u300D</strong>\uFF1A\u6D88\u8D39\u8005\uFF0C\u8D1F\u8D23\u4ECEkafka\u4E2D\u62C9\u53D6\u6D88\u606F\u8FDB\u884C\u6D88\u8D39\u3002</p><p><strong>\u300CBroker\u300D</strong>\uFF1AKafka\u670D\u52A1\u8282\u70B9\uFF0C\u4E00\u4E2A\u6216\u591A\u4E2ABroker\u7EC4\u6210\u4E86\u4E00\u4E2AKafka\u96C6\u7FA4</p><p><strong>\u300CZookeeper\u96C6\u7FA4\u300D</strong>\uFF1A\u8D1F\u8D23\u7BA1\u7406kafka\u96C6\u7FA4\u5143\u6570\u636E\u4EE5\u53CA\u63A7\u5236\u5668\u9009\u4E3E\u7B49\u3002</p><h2 id="\u751F\u4EA7\u8005\u5206\u533A" tabindex="-1"><a class="header-anchor" href="#\u751F\u4EA7\u8005\u5206\u533A" aria-hidden="true">#</a> \u751F\u4EA7\u8005\u5206\u533A</h2><p><strong>\u300C\u4E3A\u4EC0\u4E48\u5206\u533A\uFF1F\u300D</strong></p><p>Kafka\u7684\u6D88\u606F\u7EC4\u7EC7\u65B9\u5F0F\u5B9E\u9645\u4E0A\u662F\u4E09\u7EA7\u7ED3\u6784\uFF1A\u4E3B\u9898-\u5206\u533A-\u6D88\u606F\u3002</p><p>\u4E3B\u9898\u4E0B\u7684\u6BCF\u6761\u6D88\u606F\u53EA\u4F1A\u4FDD\u5B58\u5728\u67D0\u4E00\u4E2A\u5206\u533A\u4E2D\uFF0C\u800C\u4E0D\u4F1A\u5728\u591A\u4E2A\u5206\u533A\u4E2D\u88AB\u4FDD\u5B58\u591A\u4EFD\u3002</p><p>\u5176\u5B9E\u5206\u533A\u7684\u4F5C\u7528\u5C31\u662F\u63D0\u4F9B\u8D1F\u8F7D\u5747\u8861\u7684\u80FD\u529B\uFF0C\u6216\u8005\u8BF4\u5BF9\u6570\u636E\u8FDB\u884C\u5206\u533A\u7684\u4E3B\u8981\u539F\u56E0\uFF0C\u5C31\u662F\u4E3A\u4E86\u5B9E\u73B0\u7CFB\u7EDF\u7684\u9AD8\u4F38\u7F29\u6027\uFF08Scalability\uFF09\u3002</p><p>\u4E0D\u540C\u7684\u5206\u533A\u80FD\u591F\u88AB\u653E\u7F6E\u5230\u4E0D\u540C\u8282\u70B9\u7684\u673A\u5668\u4E0A\uFF0C\u800C\u6570\u636E\u7684\u8BFB\u5199\u64CD\u4F5C\u4E5F\u90FD\u662F\u9488\u5BF9\u5206\u533A\u8FD9\u4E2A\u7C92\u5EA6\u800C\u8FDB\u884C\u7684\uFF0C\u8FD9\u6837\u6BCF\u4E2A\u8282\u70B9\u7684\u673A\u5668\u90FD\u80FD\u72EC\u7ACB\u5730\u6267\u884C\u5404\u81EA\u5206\u533A\u7684\u8BFB\u5199\u8BF7\u6C42\u5904\u7406\uFF0C\u5E76\u4E14\uFF0C\u6211\u4EEC\u8FD8\u53EF\u4EE5\u901A\u8FC7\u6DFB\u52A0\u65B0\u7684\u8282\u70B9\u673A\u5668\u6765\u589E\u52A0\u6574\u4F53\u7CFB\u7EDF\u7684\u541E\u5410\u91CF\u3002</p><p><strong>\u300C\u90FD\u6709\u54EA\u4E9B\u5206\u533A\u7B56\u7565\uFF1F\u300D</strong></p><p><strong>\u300C\u6240\u8C13\u5206\u533A\u7B56\u7565\u662F\u51B3\u5B9A\u751F\u4EA7\u8005\u5C06\u6D88\u606F\u53D1\u9001\u5230\u54EA\u4E2A\u5206\u533A\u7684\u7B97\u6CD5\u3002\u300D</strong></p><p>Kafka\u4E3A\u6211\u4EEC\u63D0\u4F9B\u4E86\u9ED8\u8BA4\u7684\u5206\u533A\u7B56\u7565\uFF0C\u540C\u65F6\u5B83\u4E5F\u652F\u6301\u4F60\u81EA\u5B9A\u4E49\u5206\u533A\u7B56\u7565\u3002</p><p><strong>\u300C\u81EA\u5B9A\u4E49\u5206\u533A\u7B56\u7565\u300D</strong></p><p>\u5982\u679C\u8981\u81EA\u5B9A\u4E49\u5206\u533A\u7B56\u7565\uFF0C\u4F60\u9700\u8981\u663E\u5F0F\u5730\u914D\u7F6E\u751F\u4EA7\u8005\u7AEF\u7684\u53C2\u6570p<code>artitioner.class</code>\u3002</p><p>\u5728\u7F16\u5199\u751F\u4EA7\u8005\u7A0B\u5E8F\u65F6\uFF0C\u4F60\u53EF\u4EE5\u7F16\u5199\u4E00\u4E2A\u5177\u4F53\u7684\u7C7B\u5B9E\u73B0<code>org.apache.kafka.clients.producer.Partitioner</code>\u63A5\u53E3\u3002</p><p>\u8FD9\u4E2A\u63A5\u53E3\u4E5F\u5F88\u7B80\u5355\uFF0C\u53EA\u5B9A\u4E49\u4E86\u4E24\u4E2A\u65B9\u6CD5\uFF1Apartition()\u548Cclose()\uFF0C\u901A\u5E38\u4F60\u53EA\u9700\u8981\u5B9E\u73B0\u6700\u91CD\u8981\u7684partition\u65B9\u6CD5\u3002</p><p>\u6211\u4EEC\u6765\u770B\u770B\u8FD9\u4E2A\u65B9\u6CD5\u7684\u65B9\u6CD5\u7B7E\u540D\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>int partition(String topic, Object key, byte[] keyBytes, Object value, byte[] valueBytes, Cluster cluster);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u7684topic\u3001key\u3001keyBytes\u3001value\u548CvalueBytes\u90FD\u5C5E\u4E8E\u6D88\u606F\u6570\u636E\uFF0Ccluster\u5219\u662F\u96C6\u7FA4\u4FE1\u606F\uFF08\u6BD4\u5982\u5F53\u524DKafka\u96C6\u7FA4\u5171\u6709\u591A\u5C11\u4E3B\u9898\u3001\u591A\u5C11Broker\u7B49\uFF09\u3002</p><p>Kafka\u7ED9\u4F60\u8FD9\u4E48\u591A\u4FE1\u606F\uFF0C\u5C31\u662F\u5E0C\u671B\u8BA9\u4F60\u80FD\u591F\u5145\u5206\u5730\u5229\u7528\u8FD9\u4E9B\u4FE1\u606F\u5BF9\u6D88\u606F\u8FDB\u884C\u5206\u533A\uFF0C\u8BA1\u7B97\u51FA\u5B83\u8981\u88AB\u53D1\u9001\u5230\u54EA\u4E2A\u5206\u533A\u4E2D\u3002</p><p>\u53EA\u8981\u4F60\u81EA\u5DF1\u7684\u5B9E\u73B0\u7C7B\u5B9A\u4E49\u597D\u4E86partition\u65B9\u6CD5\uFF0C\u540C\u65F6\u8BBE\u7F6E<code>partitioner.class</code>\u53C2\u6570\u4E3A\u4F60\u81EA\u5DF1\u5B9E\u73B0\u7C7B\u7684Full Qualified Name\uFF0C\u90A3\u4E48\u751F\u4EA7\u8005\u7A0B\u5E8F\u5C31\u4F1A\u6309\u7167\u4F60\u7684\u4EE3\u7801\u903B\u8F91\u5BF9\u6D88\u606F\u8FDB\u884C\u5206\u533A\u3002</p><p><strong>\u300C\u8F6E\u8BE2\u7B56\u7565\u300D</strong></p><p>\u4E5F\u79F0Round-robin\u7B56\u7565\uFF0C\u5373\u987A\u5E8F\u5206\u914D\u3002</p><p>\u6BD4\u5982\u4E00\u4E2A\u4E3B\u9898\u4E0B\u67093\u4E2A\u5206\u533A\uFF0C\u90A3\u4E48\u7B2C\u4E00\u6761\u6D88\u606F\u88AB\u53D1\u9001\u5230\u5206\u533A0\uFF0C\u7B2C\u4E8C\u6761\u88AB\u53D1\u9001\u5230\u5206\u533A1\uFF0C\u7B2C\u4E09\u6761\u88AB\u53D1\u9001\u5230\u5206\u533A2\uFF0C\u4EE5\u6B64\u7C7B\u63A8\u3002\u5F53\u751F\u4EA7\u7B2C4\u6761\u6D88\u606F\u65F6\u53C8\u4F1A\u91CD\u65B0\u5F00\u59CB\uFF0C\u5373\u5C06\u5176\u5206\u914D\u5230\u5206\u533A0</p><p>\u8FD9\u5C31\u662F\u6240\u8C13\u7684\u8F6E\u8BE2\u7B56\u7565\u3002\u8F6E\u8BE2\u7B56\u7565\u662FKafka Java\u751F\u4EA7\u8005API\u9ED8\u8BA4\u63D0\u4F9B\u7684\u5206\u533A\u7B56\u7565\u3002</p><p><strong>\u300C\u8F6E\u8BE2\u7B56\u7565\u6709\u975E\u5E38\u4F18\u79C0\u7684\u8D1F\u8F7D\u5747\u8861\u8868\u73B0\uFF0C\u5B83\u603B\u662F\u80FD\u4FDD\u8BC1\u6D88\u606F\u6700\u5927\u9650\u5EA6\u5730\u88AB\u5E73\u5747\u5206\u914D\u5230\u6240\u6709\u5206\u533A\u4E0A\uFF0C\u6545\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u5B83\u662F\u6700\u5408\u7406\u7684\u5206\u533A\u7B56\u7565\uFF0C\u4E5F\u662F\u6211\u4EEC\u6700\u5E38\u7528\u7684\u5206\u533A\u7B56\u7565\u4E4B\u4E00\u3002\u300D</strong></p><p><strong>\u300C\u968F\u673A\u7B56\u7565\u300D</strong></p><p>\u4E5F\u79F0Randomness\u7B56\u7565\u3002\u6240\u8C13\u968F\u673A\u5C31\u662F\u6211\u4EEC\u968F\u610F\u5730\u5C06\u6D88\u606F\u653E\u7F6E\u5230\u4EFB\u610F\u4E00\u4E2A\u5206\u533A\u4E0A\u3002</p><p>\u5982\u679C\u8981\u5B9E\u73B0\u968F\u673A\u7B56\u7565\u7248\u7684partition\u65B9\u6CD5\uFF0C\u5F88\u7B80\u5355\uFF0C\u53EA\u9700\u8981\u4E24\u884C\u4EE3\u7801\u5373\u53EF\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>List partitions = cluster.partitionsForTopic(topic);
return ThreadLocalRandom.current().nextInt(partitions.size());
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5148\u8BA1\u7B97\u51FA\u8BE5\u4E3B\u9898\u603B\u7684\u5206\u533A\u6570\uFF0C\u7136\u540E\u968F\u673A\u5730\u8FD4\u56DE\u4E00\u4E2A\u5C0F\u4E8E\u5B83\u7684\u6B63\u6574\u6570\u3002</p><p>\u672C\u8D28\u4E0A\u770B\u968F\u673A\u7B56\u7565\u4E5F\u662F\u529B\u6C42\u5C06\u6570\u636E\u5747\u5300\u5730\u6253\u6563\u5230\u5404\u4E2A\u5206\u533A\uFF0C\u4F46\u4ECE\u5B9E\u9645\u8868\u73B0\u6765\u770B\uFF0C\u5B83\u8981\u900A\u4E8E\u8F6E\u8BE2\u7B56\u7565\uFF0C\u6240\u4EE5**\u300C\u5982\u679C\u8FFD\u6C42\u6570\u636E\u7684\u5747\u5300\u5206\u5E03\uFF0C\u8FD8\u662F\u4F7F\u7528\u8F6E\u8BE2\u7B56\u7565\u6BD4\u8F83\u597D\u300D**\u3002\u4E8B\u5B9E\u4E0A\uFF0C\u968F\u673A\u7B56\u7565\u662F\u8001\u7248\u672C\u751F\u4EA7\u8005\u4F7F\u7528\u7684\u5206\u533A\u7B56\u7565\uFF0C\u5728\u65B0\u7248\u672C\u4E2D\u5DF2\u7ECF\u6539\u4E3A\u8F6E\u8BE2\u4E86\u3002</p><p><strong>\u300C\u6309\u6D88\u606F\u952E\u4FDD\u5E8F\u7B56\u7565\u300D</strong></p><p>Kafka\u5141\u8BB8\u4E3A\u6BCF\u6761\u6D88\u606F\u5B9A\u4E49\u6D88\u606F\u952E\uFF0C\u7B80\u79F0\u4E3AKey\u3002</p><p>\u8FD9\u4E2AKey\u7684\u4F5C\u7528\u975E\u5E38\u5927\uFF0C\u5B83\u53EF\u4EE5\u662F\u4E00\u4E2A\u6709\u7740\u660E\u786E\u4E1A\u52A1\u542B\u4E49\u7684\u5B57\u7B26\u4E32\uFF0C\u6BD4\u5982\u5BA2\u6237\u4EE3\u7801\u3001\u90E8\u95E8\u7F16\u53F7\u6216\u662F\u4E1A\u52A1ID\u7B49\uFF1B\u4E5F\u53EF\u4EE5\u7528\u6765\u8868\u5F81\u6D88\u606F\u5143\u6570\u636E\u3002</p><p>\u7279\u522B\u662F\u5728Kafka\u4E0D\u652F\u6301\u65F6\u95F4\u6233\u7684\u5E74\u4EE3\uFF0C\u5728\u4E00\u4E9B\u573A\u666F\u4E2D\uFF0C\u5DE5\u7A0B\u5E08\u4EEC\u90FD\u662F\u76F4\u63A5\u5C06\u6D88\u606F\u521B\u5EFA\u65F6\u95F4\u5C01\u88C5\u8FDBKey\u91CC\u9762\u7684\u3002</p><p>\u4E00\u65E6\u6D88\u606F\u88AB\u5B9A\u4E49\u4E86Key\uFF0C\u90A3\u4E48\u4F60\u5C31\u53EF\u4EE5\u4FDD\u8BC1\u540C\u4E00\u4E2AKey\u7684\u6240\u6709\u6D88\u606F\u90FD\u8FDB\u5165\u5230\u76F8\u540C\u7684\u5206\u533A\u91CC\u9762\uFF0C\u7531\u4E8E\u6BCF\u4E2A\u5206\u533A\u4E0B\u7684\u6D88\u606F\u5904\u7406\u90FD\u662F\u6709\u987A\u5E8F\u7684\uFF0C\u6545\u8FD9\u4E2A\u7B56\u7565\u88AB\u79F0\u4E3A\u6309\u6D88\u606F\u952E\u4FDD\u5E8F\u7B56\u7565</p><p>\u5B9E\u73B0\u8FD9\u4E2A\u7B56\u7565\u7684partition\u65B9\u6CD5\u540C\u6837\u7B80\u5355\uFF0C\u53EA\u9700\u8981\u4E0B\u9762\u4E24\u884C\u4EE3\u7801\u5373\u53EF\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>List partitions = cluster.partitionsForTopic(topic);
return Math.abs(key.hashCode()) % partitions.size();
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u524D\u9762\u63D0\u5230\u7684Kafka\u9ED8\u8BA4\u5206\u533A\u7B56\u7565\u5B9E\u9645\u4E0A\u540C\u65F6\u5B9E\u73B0\u4E86\u4E24\u79CD\u7B56\u7565\uFF1A\u5982\u679C\u6307\u5B9A\u4E86Key\uFF0C\u90A3\u4E48\u9ED8\u8BA4\u5B9E\u73B0\u6309\u6D88\u606F\u952E\u4FDD\u5E8F\u7B56\u7565\uFF1B\u5982\u679C\u6CA1\u6709\u6307\u5B9AKey\uFF0C\u5219\u4F7F\u7528\u8F6E\u8BE2\u7B56\u7565\u3002</p><p><strong>\u300C\u5176\u4ED6\u5206\u533A\u7B56\u7565\u300D</strong></p><p>\u5176\u5B9E\u8FD8\u6709\u4E00\u79CD\u6BD4\u8F83\u5E38\u89C1\u7684\uFF0C\u5373\u6240\u8C13\u7684\u57FA\u4E8E\u5730\u7406\u4F4D\u7F6E\u7684\u5206\u533A\u7B56\u7565\u3002</p><p>\u5F53\u7136\u8FD9\u79CD\u7B56\u7565\u4E00\u822C\u53EA\u9488\u5BF9\u90A3\u4E9B\u5927\u89C4\u6A21\u7684Kafka\u96C6\u7FA4\uFF0C\u7279\u522B\u662F\u8DE8\u57CE\u5E02\u3001\u8DE8\u56FD\u5BB6\u751A\u81F3\u662F\u8DE8\u5927\u6D32\u7684\u96C6\u7FA4\u3002</p><p>\u6211\u4EEC\u53EF\u4EE5\u6839\u636EBroker\u6240\u5728\u7684IP\u5730\u5740\u5B9E\u73B0\u5B9A\u5236\u5316\u7684\u5206\u533A\u7B56\u7565\u3002\u6BD4\u5982\u4E0B\u9762\u8FD9\u6BB5\u4EE3\u7801\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>List partitions = cluster.partitionsForTopic(topic);
return partitions.stream().filter(p -&gt; isSouth(p.leader().host())).map(PartitionInfo::partition).findAny().get();
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6211\u4EEC\u53EF\u4EE5\u4ECE\u6240\u6709\u5206\u533A\u4E2D\u627E\u51FA\u90A3\u4E9BLeader\u526F\u672C\u5728\u5357\u65B9\u7684\u6240\u6709\u5206\u533A\uFF0C\u7136\u540E\u968F\u673A\u6311\u9009\u4E00\u4E2A\u8FDB\u884C\u6D88\u606F\u53D1\u9001\u3002</p><h2 id="\u751F\u4EA7\u8005\u538B\u7F29\u7B97\u6CD5" tabindex="-1"><a class="header-anchor" href="#\u751F\u4EA7\u8005\u538B\u7F29\u7B97\u6CD5" aria-hidden="true">#</a> \u751F\u4EA7\u8005\u538B\u7F29\u7B97\u6CD5</h2><p><strong>\u300CKafka\u662F\u5982\u4F55\u538B\u7F29\u6D88\u606F\u7684\u5462\uFF1F\u300D</strong></p><p>\u76EE\u524DKafka\u5171\u6709\u4E24\u5927\u7C7B\u6D88\u606F\u683C\u5F0F\uFF0C\u793E\u533A\u5206\u522B\u79F0\u4E4B\u4E3AV1\u7248\u672C\u548CV2\u7248\u672C\u3002</p><p>V2\u7248\u672C\u662FKafka 0.11.0.0\u4E2D\u6B63\u5F0F\u5F15\u5165\u7684\u3002</p><p>\u4E0D\u8BBA\u662F\u54EA\u4E2A\u7248\u672C\uFF0CKafka\u7684\u6D88\u606F\u5C42\u6B21\u90FD\u5206\u4E3A\u4E24\u5C42\uFF1A\u6D88\u606F\u96C6\u5408\u4EE5\u53CA\u6D88\u606F\u3002</p><p>\u4E00\u4E2A\u6D88\u606F\u96C6\u5408\u4E2D\u5305\u542B\u82E5\u5E72\u6761\u65E5\u5FD7\u9879\uFF0C\u800C\u65E5\u5FD7\u9879\u624D\u662F\u771F\u6B63\u5C01\u88C5\u6D88\u606F\u7684\u5730\u65B9\u3002</p><p>Kafka\u5E95\u5C42\u7684\u6D88\u606F\u65E5\u5FD7\u7531\u4E00\u7CFB\u5217\u6D88\u606F\u96C6\u5408\u65E5\u5FD7\u9879\u7EC4\u6210\u3002</p><p>Kafka\u901A\u5E38\u4E0D\u4F1A\u76F4\u63A5\u64CD\u4F5C\u5177\u4F53\u7684\u4E00\u6761\u6761\u6D88\u606F\uFF0C\u5B83\u603B\u662F\u5728\u6D88\u606F\u96C6\u5408\u8FD9\u4E2A\u5C42\u9762\u4E0A\u8FDB\u884C\u5199\u5165\u64CD\u4F5C\u3002</p><p><strong>\u300C\u90A3\u4E48\u793E\u533A\u5F15\u5165V2\u7248\u672C\u7684\u76EE\u7684\u662F\u4EC0\u4E48\u5462\uFF1F\u300D</strong></p><p>V2\u7248\u672C\u4E3B\u8981\u662F\u9488\u5BF9V1\u7248\u672C\u7684\u4E00\u4E9B\u5F0A\u7AEF\u505A\u4E86\u4FEE\u6B63\uFF0C\u6BD4\u5982\u628A\u6D88\u606F\u7684\u516C\u5171\u90E8\u5206\u62BD\u53D6\u51FA\u6765\u653E\u5230\u5916\u5C42\u6D88\u606F\u96C6\u5408\u91CC\u9762\uFF0C\u8FD9\u6837\u5C31\u4E0D\u7528\u6BCF\u6761\u6D88\u606F\u90FD\u4FDD\u5B58\u8FD9\u4E9B\u4FE1\u606F\u4E86\u3002</p><p>\u4E3E\u4E2A\u4F8B\u5B50\uFF1A\u539F\u6765\u5728V1\u7248\u672C\u4E2D\uFF0C\u6BCF\u6761\u6D88\u606F\u90FD\u9700\u8981\u6267\u884CCRC\u6821\u9A8C\uFF0C\u4F46\u6709\u4E9B\u60C5\u51B5\u4E0B\u6D88\u606F\u7684CRC\u503C\u662F\u4F1A\u53D1\u751F\u53D8\u5316\u7684\u3002</p><p>\u6BD4\u5982\u5728Broker\u7AEF\u53EF\u80FD\u4F1A\u5BF9\u6D88\u606F\u65F6\u95F4\u6233\u5B57\u6BB5\u8FDB\u884C\u66F4\u65B0\uFF0C\u90A3\u4E48\u91CD\u65B0\u8BA1\u7B97\u4E4B\u540E\u7684CRC\u503C\u4E5F\u4F1A\u76F8\u5E94\u66F4\u65B0\uFF1B\u518D\u6BD4\u5982Broker\u7AEF\u5728\u6267\u884C\u6D88\u606F\u683C\u5F0F\u8F6C\u6362\u65F6\uFF08\u4E3B\u8981\u662F\u4E3A\u4E86\u517C\u5BB9\u8001\u7248\u672C\u5BA2\u6237\u7AEF\u7A0B\u5E8F\uFF09\uFF0C\u4E5F\u4F1A\u5E26\u6765CRC\u503C\u7684\u53D8\u5316\u3002</p><p>\u9274\u4E8E\u8FD9\u4E9B\u60C5\u51B5\uFF0C\u518D\u5BF9\u6BCF\u6761\u6D88\u606F\u90FD\u6267\u884CCRC\u6821\u9A8C\u5C31\u6709\u70B9\u6CA1\u5FC5\u8981\u4E86\uFF0C\u4E0D\u4EC5\u6D6A\u8D39\u7A7A\u95F4\u8FD8\u803D\u8BEFCPU\u65F6\u95F4\uFF0C\u56E0\u6B64\u5728V2\u7248\u672C\u4E2D\uFF0C\u6D88\u606F\u7684CRC\u6821\u9A8C\u5DE5\u4F5C\u5C31\u88AB\u79FB\u5230\u4E86\u6D88\u606F\u96C6\u5408\u8FD9\u4E00\u5C42\u3002</p><p>V2\u7248\u672C\u8FD8\u6709\u4E00\u4E2A\u548C\u538B\u7F29\u606F\u606F\u76F8\u5173\u7684\u6539\u8FDB\uFF0C\u5C31\u662F\u4FDD\u5B58\u538B\u7F29\u6D88\u606F\u7684\u65B9\u6CD5\u53D1\u751F\u4E86\u53D8\u5316\u3002</p><p>\u4E4B\u524DV1\u7248\u672C\u4E2D\u4FDD\u5B58\u538B\u7F29\u6D88\u606F\u7684\u65B9\u6CD5\u662F\u628A\u591A\u6761\u6D88\u606F\u8FDB\u884C\u538B\u7F29\u7136\u540E\u4FDD\u5B58\u5230\u5916\u5C42\u6D88\u606F\u7684\u6D88\u606F\u4F53\u5B57\u6BB5\u4E2D\uFF1B\u800CV2\u7248\u672C\u7684\u505A\u6CD5\u662F\u5BF9\u6574\u4E2A\u6D88\u606F\u96C6\u5408\u8FDB\u884C\u538B\u7F29\uFF0C\u663E\u7136\u540E\u8005\u5E94\u8BE5\u6BD4\u524D\u8005\u6709\u66F4\u597D\u7684\u538B\u7F29\u6548\u679C\u3002</p><p><strong>\u300C\u4F55\u65F6\u538B\u7F29\uFF1F\u300D</strong></p><p>\u5728Kafka\u4E2D\uFF0C\u538B\u7F29\u53EF\u80FD\u53D1\u751F\u5728\u4E24\u4E2A\u5730\u65B9\uFF1A\u751F\u4EA7\u8005\u7AEF\u548CBroker\u7AEF\u3002</p><p>\u751F\u4EA7\u8005\u7A0B\u5E8F\u4E2D\u914D\u7F6E<code>compression.type</code>\u53C2\u6570\u5373\u8868\u793A\u542F\u7528\u6307\u5B9A\u7C7B\u578B\u7684\u538B\u7F29\u7B97\u6CD5\u3002</p><p>\u6BD4\u5982\u4E0B\u9762\u8FD9\u6BB5\u7A0B\u5E8F\u4EE3\u7801\u5C55\u793A\u4E86\u5982\u4F55\u6784\u5EFA\u4E00\u4E2A\u5F00\u542FGZIP\u7684Producer\u5BF9\u8C61\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Properties props = new Properties(); 
props.put(&quot;bootstrap.servers&quot;, &quot;localhost:9092&quot;); 
props.put(&quot;acks&quot;, &quot;all&quot;); 
props.put(&quot;key.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;); props.put(&quot;value.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;); // \u5F00\u542FGZIP\u538B\u7F29 
props.put(&quot;compression.type&quot;, &quot;gzip&quot;); 
Producer producer = new KafkaProducer&lt;&gt;(props);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u6BD4\u8F83\u5173\u952E\u7684\u4EE3\u7801\u884C\u662F<code>props.put(\u201Ccompression.type\u201D, \u201Cgzip\u201D)</code>\uFF0C\u5B83\u8868\u660E\u8BE5Producer\u7684\u538B\u7F29\u7B97\u6CD5\u4F7F\u7528\u7684\u662FGZIP\u3002</p><p>\u8FD9\u6837Producer\u542F\u52A8\u540E\u751F\u4EA7\u7684\u6BCF\u4E2A\u6D88\u606F\u96C6\u5408\u90FD\u662F\u7ECFGZIP\u538B\u7F29\u8FC7\u7684\uFF0C\u6545\u800C\u80FD\u5F88\u597D\u5730\u8282\u7701\u7F51\u7EDC\u4F20\u8F93\u5E26\u5BBD\u4EE5\u53CAKafka Broker\u7AEF\u7684\u78C1\u76D8\u5360\u7528\u3002</p><p>\u6709\u4E24\u79CD\u4F8B\u5916\u60C5\u51B5\u5C31\u53EF\u80FD\u8BA9Broker\u91CD\u65B0\u538B\u7F29\u6D88\u606F\uFF1A</p><p><strong>\u300C\u60C5\u51B5\u4E00\uFF1ABroker\u7AEF\u6307\u5B9A\u4E86\u548CProducer\u7AEF\u4E0D\u540C\u7684\u538B\u7F29\u7B97\u6CD5\u3002\u300D</strong></p><p>\u4E00\u65E6\u4F60\u5728Broker\u7AEF\u8BBE\u7F6E\u4E86\u4E0D\u540C\u7684<code>compression.type</code>\u503C\uFF0C\u5C31\u4E00\u5B9A\u8981\u5C0F\u5FC3\u4E86\uFF0C\u56E0\u4E3A\u53EF\u80FD\u4F1A\u53D1\u751F\u9884\u6599\u4E4B\u5916\u7684\u538B\u7F29/\u89E3\u538B\u7F29\u64CD\u4F5C\uFF0C\u901A\u5E38\u8868\u73B0\u4E3ABroker\u7AEFCPU\u4F7F\u7528\u7387\u98D9\u5347\u3002</p><p><strong>\u300C\u60C5\u51B5\u4E8C\uFF1ABroker\u7AEF\u53D1\u751F\u4E86\u6D88\u606F\u683C\u5F0F\u8F6C\u6362\u3002\u300D</strong></p><p>\u6240\u8C13\u7684\u6D88\u606F\u683C\u5F0F\u8F6C\u6362\u4E3B\u8981\u662F\u4E3A\u4E86\u517C\u5BB9\u8001\u7248\u672C\u7684\u6D88\u8D39\u8005\u7A0B\u5E8F\u3002</p><p>\u5728\u4E00\u4E2A\u751F\u4EA7\u73AF\u5883\u4E2D\uFF0CKafka\u96C6\u7FA4\u4E2D\u540C\u65F6\u4FDD\u5B58\u591A\u79CD\u7248\u672C\u7684\u6D88\u606F\u683C\u5F0F\u975E\u5E38\u5E38\u89C1\u3002</p><p>\u4E3A\u4E86\u517C\u5BB9\u8001\u7248\u672C\u7684\u683C\u5F0F\uFF0CBroker\u7AEF\u4F1A\u5BF9\u65B0\u7248\u672C\u6D88\u606F\u6267\u884C\u5411\u8001\u7248\u672C\u683C\u5F0F\u7684\u8F6C\u6362\u3002</p><p>\u8FD9\u4E2A\u8FC7\u7A0B\u4E2D\u4F1A\u6D89\u53CA\u6D88\u606F\u7684\u89E3\u538B\u7F29\u548C\u91CD\u65B0\u538B\u7F29\u3002</p><p>\u4E00\u822C\u60C5\u51B5\u4E0B\u8FD9\u79CD\u6D88\u606F\u683C\u5F0F\u8F6C\u6362\u5BF9\u6027\u80FD\u662F\u6709\u5F88\u5927\u5F71\u54CD\u7684\uFF0C\u9664\u4E86\u8FD9\u91CC\u7684\u538B\u7F29\u4E4B\u5916\uFF0C\u5B83\u8FD8\u8BA9Kafka\u4E27\u5931\u4E86Zero Copy\u7279\u6027\u3002</p><p><strong>\u300C\u4F55\u65F6\u89E3\u538B\u7F29\uFF1F\u300D</strong></p><p>\u6709\u538B\u7F29\u5FC5\u6709\u89E3\u538B\u7F29\uFF01\u901A\u5E38\u6765\u8BF4\u89E3\u538B\u7F29\u53D1\u751F\u5728\u6D88\u8D39\u8005\u7A0B\u5E8F\u4E2D\uFF0C\u4E5F\u5C31\u662F\u8BF4Producer\u53D1\u9001\u538B\u7F29\u6D88\u606F\u5230Broker\u540E\uFF0CBroker\u7167\u5355\u5168\u6536\u5E76\u539F\u6837\u4FDD\u5B58\u8D77\u6765\u3002\u5F53Consumer\u7A0B\u5E8F\u8BF7\u6C42\u8FD9\u90E8\u5206\u6D88\u606F\u65F6\uFF0CBroker\u4F9D\u7136\u539F\u6837\u53D1\u9001\u51FA\u53BB\uFF0C\u5F53\u6D88\u606F\u5230\u8FBEConsumer\u7AEF\u540E\uFF0C\u7531Consumer\u81EA\u884C\u89E3\u538B\u7F29\u8FD8\u539F\u6210\u4E4B\u524D\u7684\u6D88\u606F\u3002</p><p><strong>\u300C\u57FA\u672C\u8FC7\u7A0B\uFF1AProducer\u7AEF\u538B\u7F29\u3001Broker\u7AEF\u4FDD\u6301\u3001Consumer\u7AEF\u89E3\u538B\u7F29\u3002\u300D</strong></p><p>\u6CE8\u610F\uFF1A\u9664\u4E86\u5728Consumer\u7AEF\u89E3\u538B\u7F29\uFF0CBroker\u7AEF\u4E5F\u4F1A\u8FDB\u884C\u89E3\u538B\u7F29\u3002</p><p>\u6BCF\u4E2A\u538B\u7F29\u8FC7\u7684\u6D88\u606F\u96C6\u5408\u5728Broker\u7AEF\u5199\u5165\u65F6\u90FD\u8981\u53D1\u751F\u89E3\u538B\u7F29\u64CD\u4F5C\uFF0C\u76EE\u7684\u5C31\u662F\u4E3A\u4E86\u5BF9\u6D88\u606F\u6267\u884C\u5404\u79CD\u9A8C\u8BC1\u3002</p><p>\u6211\u4EEC\u5FC5\u987B\u627F\u8BA4\u8FD9\u79CD\u89E3\u538B\u7F29\u5BF9Broker\u7AEF\u6027\u80FD\u662F\u6709\u4E00\u5B9A\u5F71\u54CD\u7684\uFF0C\u7279\u522B\u662F\u5BF9CPU\u7684\u4F7F\u7528\u7387\u800C\u8A00\u3002</p><p><strong>\u300C\u5404\u79CD\u538B\u7F29\u7B97\u6CD5\u5BF9\u6BD4\u300D</strong></p><p>\u5728Kafka 2.1.0\u7248\u672C\u4E4B\u524D\uFF0CKafka\u652F\u63013\u79CD\u538B\u7F29\u7B97\u6CD5\uFF1AGZIP\u3001Snappy\u548CLZ4\u3002</p><p>\u4ECE2.1.0\u5F00\u59CB\uFF0CKafka\u6B63\u5F0F\u652F\u6301Zstandard\u7B97\u6CD5\uFF08\u7B80\u5199\u4E3Azstd\uFF09\u3002</p><p>\u5B83\u662FFacebook\u5F00\u6E90\u7684\u4E00\u4E2A\u538B\u7F29\u7B97\u6CD5\uFF0C\u80FD\u591F\u63D0\u4F9B\u8D85\u9AD8\u7684\u538B\u7F29\u6BD4\u3002</p><p>\u5728\u5B9E\u9645\u4F7F\u7528\u4E2D\uFF0CGZIP\u3001Snappy\u3001LZ4\u548Czstd\u7684\u8868\u73B0\u5404\u6709\u5343\u79CB\u3002</p><p>\u4F46\u5BF9\u4E8EKafka\u800C\u8A00\uFF0C\u5728\u541E\u5410\u91CF\u65B9\u9762\uFF1ALZ4 &gt; Snappy &gt; zstd\u548CGZIP\uFF1B\u800C\u5728\u538B\u7F29\u6BD4\u65B9\u9762\uFF0Czstd &gt; LZ4 &gt; GZIP &gt; Snappy\u3002</p><p>\u5177\u4F53\u5230\u7269\u7406\u8D44\u6E90\uFF0C\u4F7F\u7528Snappy\u7B97\u6CD5\u5360\u7528\u7684\u7F51\u7EDC\u5E26\u5BBD\u6700\u591A\uFF0Czstd\u6700\u5C11\uFF1B</p><p>\u5728CPU\u4F7F\u7528\u7387\u65B9\u9762\uFF0C\u5404\u4E2A\u7B97\u6CD5\u8868\u73B0\u5F97\u5DEE\u4E0D\u591A\uFF0C\u53EA\u662F\u5728\u538B\u7F29\u65F6Snappy\u7B97\u6CD5\u4F7F\u7528\u7684CPU\u8F83\u591A\u4E00\u4E9B\uFF0C\u800C\u5728\u89E3\u538B\u7F29\u65F6GZIP\u7B97\u6CD5\u5219\u53EF\u80FD\u4F7F\u7528\u66F4\u591A\u7684CPU\u3002</p><p><strong>\u300C\u6700\u4F73\u5B9E\u8DF5\u300D</strong></p><blockquote><p>\u275D</p><p>\u4F55\u65F6\u542F\u7528\u538B\u7F29\u662F\u6BD4\u8F83\u5408\u9002\u7684\u65F6\u673A\u5462\uFF1F</p><p>\u275E</p></blockquote><p>\u542F\u7528\u538B\u7F29\u7684\u4E00\u4E2A\u6761\u4EF6\u5C31\u662FProducer\u7A0B\u5E8F\u8FD0\u884C\u673A\u5668\u4E0A\u7684CPU\u8D44\u6E90\u8981\u5F88\u5145\u8DB3\u3002</p><p>\u9664\u4E86CPU\u8D44\u6E90\u5145\u8DB3\u8FD9\u4E00\u6761\u4EF6\uFF0C\u5982\u679C\u4F60\u7684\u73AF\u5883\u4E2D\u5E26\u5BBD\u8D44\u6E90\u6709\u9650\uFF0C\u90A3\u4E48\u5EFA\u8BAE\u4F60\u5F00\u542F\u538B\u7F29\u3002</p><h2 id="\u6D88\u8D39\u8005\u7EC4" tabindex="-1"><a class="header-anchor" href="#\u6D88\u8D39\u8005\u7EC4" aria-hidden="true">#</a> \u6D88\u8D39\u8005\u7EC4</h2><p><strong>\u300CConsumer Group\u662FKafka\u63D0\u4F9B\u7684\u53EF\u6269\u5C55\u4E14\u5177\u6709\u5BB9\u9519\u6027\u7684\u6D88\u8D39\u8005\u673A\u5236\u300D</strong>\u3002</p><p>\u65E2\u7136\u662F\u4E00\u4E2A\u7EC4\uFF0C\u90A3\u4E48\u7EC4\u5185\u5FC5\u7136\u53EF\u4EE5\u6709\u591A\u4E2A\u6D88\u8D39\u8005\u6216\u6D88\u8D39\u8005\u5B9E\u4F8B\uFF0C\u5B83\u4EEC\u5171\u4EAB\u4E00\u4E2A\u516C\u5171\u7684ID\uFF0C\u8FD9\u4E2AID\u88AB\u79F0\u4E3AGroup ID\u3002</p><p>\u7EC4\u5185\u7684\u6240\u6709\u6D88\u8D39\u8005\u534F\u8C03\u5728\u4E00\u8D77\u6765\u6D88\u8D39\u8BA2\u9605\u4E3B\u9898\u7684\u6240\u6709\u5206\u533A\u3002</p><blockquote><p>\u275D</p><p>\u6BCF\u4E2A\u5206\u533A\u53EA\u80FD\u7531\u540C\u4E00\u4E2A\u6D88\u8D39\u8005\u7EC4\u5185\u7684\u4E00\u4E2AConsumer\u5B9E\u4F8B\u6765\u6D88\u8D39\u3002</p><p>\u275E</p></blockquote><p><strong>\u300CConsumer Group\u4E09\u4E2A\u7279\u6027\uFF1A\u300D</strong></p><ol><li>Consumer Group\u4E0B\u53EF\u4EE5\u6709\u4E00\u4E2A\u6216\u591A\u4E2AConsumer\u5B9E\u4F8B\uFF0C\u8FD9\u91CC\u7684\u5B9E\u4F8B\u53EF\u4EE5\u662F\u4E00\u4E2A\u5355\u72EC\u7684\u8FDB\u7A0B\uFF0C\u4E5F\u53EF\u4EE5\u662F\u540C\u4E00\u8FDB\u7A0B\u4E0B\u7684\u7EBF\u7A0B\u3002</li><li>Group ID\u662F\u4E00\u4E2A\u5B57\u7B26\u4E32\uFF0C\u5728\u4E00\u4E2AKafka\u96C6\u7FA4\u4E2D\uFF0C\u5B83\u6807\u8BC6\u552F\u4E00\u7684\u4E00\u4E2AConsumer Group\u3002</li><li>Consumer Group\u4E0B\u6240\u6709\u5B9E\u4F8B\u8BA2\u9605\u7684\u4E3B\u9898\u7684\u5355\u4E2A\u5206\u533A\uFF0C\u53EA\u80FD\u5206\u914D\u7ED9\u7EC4\u5185\u7684\u67D0\u4E2AConsumer\u5B9E\u4F8B\u6D88\u8D39\uFF0C\u8FD9\u4E2A\u5206\u533A\u5F53\u7136\u4E5F\u53EF\u4EE5\u88AB\u5176\u4ED6\u7684Group\u6D88\u8D39\u3002</li></ol><p>\u5F53Consumer Group\u8BA2\u9605\u4E86\u591A\u4E2A\u4E3B\u9898\u540E\uFF0C\u7EC4\u5185\u7684\u6BCF\u4E2A\u5B9E\u4F8B\u4E0D\u8981\u6C42\u4E00\u5B9A\u8981\u8BA2\u9605\u4E3B\u9898\u7684\u6240\u6709\u5206\u533A\uFF0C\u5B83\u53EA\u4F1A\u6D88\u8D39\u90E8\u5206\u5206\u533A\u4E2D\u7684\u6D88\u606F\u3002</p><p>Consumer Group\u4E4B\u95F4\u5F7C\u6B64\u72EC\u7ACB\uFF0C\u4E92\u4E0D\u5F71\u54CD\uFF0C\u5B83\u4EEC\u80FD\u591F\u8BA2\u9605\u76F8\u540C\u7684\u4E00\u7EC4\u4E3B\u9898\u800C\u4E92\u4E0D\u5E72\u6D89\u3002</p><p><strong>\u300CKafka\u4EC5\u4EC5\u4F7F\u7528Consumer Group\u8FD9\u4E00\u79CD\u673A\u5236\uFF0C\u5374\u540C\u65F6\u5B9E\u73B0\u4E86\u4F20\u7EDF\u6D88\u606F\u5F15\u64CE\u7CFB\u7EDF\u7684\u4E24\u5927\u6A21\u578B\u300D</strong>\uFF1A</p><ul><li>\u5982\u679C\u6240\u6709\u5B9E\u4F8B\u90FD\u5C5E\u4E8E\u540C\u4E00\u4E2AGroup\uFF0C\u90A3\u4E48\u5B83\u5B9E\u73B0\u7684\u5C31\u662F\u6D88\u606F\u961F\u5217\u6A21\u578B\uFF1B</li><li>\u5982\u679C\u6240\u6709\u5B9E\u4F8B\u5206\u522B\u5C5E\u4E8E\u4E0D\u540C\u7684Group\uFF0C\u90A3\u4E48\u5B83\u5B9E\u73B0\u7684\u5C31\u662F\u53D1\u5E03/\u8BA2\u9605\u6A21\u578B\u3002</li></ul><p><strong>\u300C\u4E00\u4E2AGroup\u4E0B\u8BE5\u6709\u591A\u5C11\u4E2AConsumer\u5B9E\u4F8B\u5462\uFF1F\u300D</strong></p><p><strong>\u300C\u7406\u60F3\u60C5\u51B5\u4E0B\uFF0CConsumer\u5B9E\u4F8B\u7684\u6570\u91CF\u5E94\u8BE5\u7B49\u4E8E\u8BE5Group\u8BA2\u9605\u4E3B\u9898\u7684\u5206\u533A\u603B\u6570\u3002\u300D</strong></p><p>\u5047\u8BBE\u4E00\u4E2AConsumer Group\u8BA2\u9605\u4E863\u4E2A\u4E3B\u9898\uFF0C\u5206\u522B\u662FA\u3001B\u3001C\uFF0C\u5B83\u4EEC\u7684\u5206\u533A\u6570\u4F9D\u6B21\u662F1\u30012\u30013\uFF0C\u90A3\u4E48\u901A\u5E38\u60C5\u51B5\u4E0B\uFF0C\u4E3A\u8BE5Group\u8BBE\u7F6E6\u4E2AConsumer\u5B9E\u4F8B\u662F\u6BD4\u8F83\u7406\u60F3\u7684\u60C5\u5F62\uFF0C\u56E0\u4E3A\u5B83\u80FD\u6700\u5927\u9650\u5EA6\u5730\u5B9E\u73B0\u9AD8\u4F38\u7F29\u6027\u3002</p><p><strong>\u300C\u9488\u5BF9Consumer Group\uFF0CKafka\u662F\u600E\u4E48\u7BA1\u7406\u4F4D\u79FB\u7684\u5462\uFF1F\u300D</strong></p><p><strong>\u300C\u4F4D\u79FBOffset\u300D</strong></p><p>\u8001\u7248\u672C\u7684Consumer Group\u628A\u4F4D\u79FB\u4FDD\u5B58\u5728ZooKeeper\u4E2D\u3002</p><p>Apache ZooKeeper\u662F\u4E00\u4E2A\u5206\u5E03\u5F0F\u7684\u534F\u8C03\u670D\u52A1\u6846\u67B6\uFF0CKafka\u91CD\u5EA6\u4F9D\u8D56\u5B83\u5B9E\u73B0\u5404\u79CD\u5404\u6837\u7684\u534F\u8C03\u7BA1\u7406\u3002</p><p>\u5C06\u4F4D\u79FB\u4FDD\u5B58\u5728ZooKeeper\u5916\u90E8\u7CFB\u7EDF\u7684\u505A\u6CD5\uFF0C\u6700\u663E\u800C\u6613\u89C1\u7684\u597D\u5904\u5C31\u662F\u51CF\u5C11\u4E86Kafka Broker\u7AEF\u7684\u72B6\u6001\u4FDD\u5B58\u5F00\u9500\u3002</p><p>\u4E0D\u8FC7\uFF0C\u6162\u6162\u5730\u53D1\u73B0\u4E86\u4E00\u4E2A\u95EE\u9898\uFF0C\u5373ZooKeeper\u8FD9\u7C7B\u5143\u6846\u67B6\u5176\u5B9E\u5E76\u4E0D\u9002\u5408\u8FDB\u884C\u9891\u7E41\u7684\u5199\u66F4\u65B0\uFF0C\u800CConsumer Group\u7684\u4F4D\u79FB\u66F4\u65B0\u5374\u662F\u4E00\u4E2A\u975E\u5E38\u9891\u7E41\u7684\u64CD\u4F5C\u3002</p><p>\u8FD9\u79CD\u5927\u541E\u5410\u91CF\u7684\u5199\u64CD\u4F5C\u4F1A\u6781\u5927\u5730\u62D6\u6162ZooKeeper\u96C6\u7FA4\u7684\u6027\u80FD\u3002</p><p>\u4E8E\u662F\uFF0C\u5728\u65B0\u7248\u672C\u7684Consumer Group\u4E2D\uFF0CKafka\u793E\u533A\u91CD\u65B0\u8BBE\u8BA1\u4E86Consumer Group\u7684\u4F4D\u79FB\u7BA1\u7406\u65B9\u5F0F\uFF0C\u91C7\u7528\u4E86\u5C06\u4F4D\u79FB\u4FDD\u5B58\u5728Kafka\u5185\u90E8\u4E3B\u9898\u7684\u65B9\u6CD5\u3002</p><p>\u8FD9\u4E2A\u5185\u90E8\u4E3B\u9898\u5C31\u662F<code>__consumer_offsets</code>\u3002</p><h2 id="\u6D88\u8D39\u8005\u7B56\u7565" tabindex="-1"><a class="header-anchor" href="#\u6D88\u8D39\u8005\u7B56\u7565" aria-hidden="true">#</a> \u6D88\u8D39\u8005\u7B56\u7565</h2><p><strong>\u300C\u7B2C\u4E00\u79CD\u662FRound\u300D</strong></p><p>\u9ED8\u8BA4\uFF0C\u4E5F\u53EB\u8F6E\u5FAA\uFF0C\u8BF4\u7684\u662F\u5BF9\u4E8E\u540C\u4E00\u7EC4\u6D88\u8D39\u8005\u6765\u8BF4\uFF0C\u4F7F\u7528\u8F6E\u8BAD\u5206\u914D\u7684\u65B9\u5F0F\uFF0C\u51B3\u5B9A\u6D88\u8D39\u8005\u6D88\u8D39\u7684\u5206\u533A</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-kafkahxzszj-1262b5a7-198e-47b7-ad81-a4f84e755901.jpg" alt=""></p><p><strong>\u300C\u7B2C\u4E8C\u79CD\u53EB\u505ARange\u300D</strong></p><p>\u5BF9\u4E00\u4E2A\u6D88\u8D39\u8005\u7EC4\u6765\u8BF4\u51B3\u5B9A\u6D88\u8D39\u65B9\u5F0F\u662F\u4EE5\u5206\u533A\u603B\u6570\u9664\u4EE5\u6D88\u8D39\u8005\u603B\u6570\u6765\u51B3\u5B9A\uFF0C\u4E00\u822C\u5982\u679C\u4E0D\u80FD\u6574\u9664\uFF0C\u5F80\u5F80\u662F\u4ECE\u5934\u5F00\u59CB\u5C06\u5269\u4F59\u7684\u5206\u533A\u5206\u914D\u5F00</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-kafkahxzszj-d6a295aa-85f7-439e-9984-e081f3d95238.jpg" alt=""></p><p><strong>\u300C\u7B2C\u4E09\u79CD\u53EBSticky\u300D</strong></p><p>\u662F\u57280.11.x\uFF0C\u65B0\u589E\u7684\uFF0C\u5B83\u548C\u524D\u9762\u4E24\u4E2A\u4E0D\u662F\u5F88\u4E00\u6837\uFF0C\u5B83\u662F\u5728Range\u4E0A\u7684\u4E00\u79CD\u5347\u534E\uFF0C\u4E14\u524D\u9762\u4E24\u4E2A\u5F53\u540C\u7EC4\u5185\u6709\u65B0\u7684\u6D88\u8D39\u8005\u52A0\u5165\u6216\u8005\u65E7\u7684\u6D88\u8D39\u8005\u9000\u51FA\u7684\u65F6\u5019\uFF0C\u4F1A\u4ECE\u65B0\u5F00\u59CB\u51B3\u5B9A\u6D88\u8D39\u8005\u6D88\u8D39\u65B9\u5F0F\uFF0C\u4F46\u662FSticky\uFF0C\u5728\u540C\u7EC4\u4E2D\u6709\u65B0\u7684\u65B0\u7684\u6D88\u8D39\u8005\u52A0\u5165\u6216\u8005\u65E7\u7684\u6D88\u8D39\u8005\u9000\u51FA\u65F6\uFF0C\u4E0D\u4F1A\u76F4\u63A5\u5F00\u59CB\u65B0\u7684Range\u5206\u914D\uFF0C\u800C\u662F\u4FDD\u7559\u73B0\u6709\u6D88\u8D39\u8005\u539F\u6765\u7684\u6D88\u8D39\u7B56\u7565\uFF0C\u5C06\u9000\u51FA\u7684\u6D88\u8D39\u8005\u6240\u6D88\u8D39\u7684\u5206\u533A\u5E73\u5747\u5206\u914D\u7ED9\u73B0\u6709\u6D88\u8D39\u8005\uFF0C\u65B0\u589E\u6D88\u8D39\u8005\u540C\u7406\uFF0C\u540C\u5176\u4ED6\u73B0\u5B58\u6D88\u8D39\u8005\u7684\u6D88\u8D39\u7B56\u7565\u4E2D\u5206\u79BB</p><h2 id="\u4F4D\u79FB\u63D0\u4EA4" tabindex="-1"><a class="header-anchor" href="#\u4F4D\u79FB\u63D0\u4EA4" aria-hidden="true">#</a> \u4F4D\u79FB\u63D0\u4EA4</h2><p>\u5047\u8BBE\u4E00\u4E2A\u5206\u533A\u4E2D\u670910\u6761\u6D88\u606F\uFF0C\u4F4D\u79FB\u5206\u522B\u662F0\u52309\u3002</p><p>\u67D0\u4E2AConsumer\u5E94\u7528\u5DF2\u6D88\u8D39\u4E865\u6761\u6D88\u606F\uFF0C\u8FD9\u5C31\u8BF4\u660E\u8BE5Consumer\u6D88\u8D39\u4E86\u4F4D\u79FB\u4E3A0\u52304\u76845\u6761\u6D88\u606F\uFF0C\u6B64\u65F6Consumer\u7684\u4F4D\u79FB\u662F5\uFF0C\u6307\u5411\u4E86\u4E0B\u4E00\u6761\u6D88\u606F\u7684\u4F4D\u79FB\u3002</p><p>\u56E0\u4E3AConsumer\u80FD\u591F\u540C\u65F6\u6D88\u8D39\u591A\u4E2A\u5206\u533A\u7684\u6570\u636E\uFF0C\u6240\u4EE5\u4F4D\u79FB\u7684\u63D0\u4EA4\u5B9E\u9645\u4E0A\u662F\u5728\u5206\u533A\u7C92\u5EA6\u4E0A\u8FDB\u884C\u7684\uFF0C\u5373**\u300CConsumer\u9700\u8981\u4E3A\u5206\u914D\u7ED9\u5B83\u7684\u6BCF\u4E2A\u5206\u533A\u63D0\u4EA4\u5404\u81EA\u7684\u4F4D\u79FB\u6570\u636E\u300D**\u3002</p><p><strong>\u300C\u4F4D\u79FB\u63D0\u4EA4\u5206\u4E3A\u81EA\u52A8\u63D0\u4EA4\u548C\u624B\u52A8\u63D0\u4EA4\uFF1B\u4ECEConsumer\u7AEF\u7684\u89D2\u5EA6\u6765\u8BF4\uFF0C\u4F4D\u79FB\u63D0\u4EA4\u5206\u4E3A\u540C\u6B65\u63D0\u4EA4\u548C\u5F02\u6B65\u63D0\u4EA4\u300D</strong>\u3002</p><p>\u5F00\u542F\u81EA\u52A8\u63D0\u4EA4\u4F4D\u79FB\u7684\u65B9\u6CD5\uFF1AConsumer\u7AEF\u6709\u4E2A\u53C2\u6570<code>enable.auto.commit</code>\uFF0C\u628A\u5B83\u8BBE\u7F6E\u4E3Atrue\u6216\u8005\u538B\u6839\u4E0D\u8BBE\u7F6E\u5B83\u5C31\u53EF\u4EE5\u4E86\u3002</p><p>\u56E0\u4E3A\u5B83\u7684\u9ED8\u8BA4\u503C\u5C31\u662Ftrue\uFF0C\u5373Java Consumer\u9ED8\u8BA4\u5C31\u662F\u81EA\u52A8\u63D0\u4EA4\u4F4D\u79FB\u7684\u3002</p><p>\u5982\u679C\u542F\u7528\u4E86\u81EA\u52A8\u63D0\u4EA4\uFF0CConsumer\u7AEF\u8FD8\u6709\u4E2A\u53C2\u6570\uFF1A<code>auto.commit.interval.ms</code>\u3002</p><p>\u5B83\u7684\u9ED8\u8BA4\u503C\u662F5\u79D2\uFF0C\u8868\u660EKafka\u6BCF5\u79D2\u4F1A\u4E3A\u4F60\u81EA\u52A8\u63D0\u4EA4\u4E00\u6B21\u4F4D\u79FB\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Properties props = new Properties();
     props.put(&quot;bootstrap.servers&quot;, &quot;localhost:9092&quot;);
     props.put(&quot;group.id&quot;, &quot;test&quot;);
     props.put(&quot;enable.auto.commit&quot;, &quot;true&quot;);
     props.put(&quot;auto.commit.interval.ms&quot;, &quot;2000&quot;);
     props.put(&quot;key.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);
     props.put(&quot;value.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);
     KafkaConsumer consumer = new KafkaConsumer&lt;&gt;(props);
     consumer.subscribe(Arrays.asList(&quot;foo&quot;, &quot;bar&quot;));
     while (true) {
         ConsumerRecords records = consumer.poll(100);
         for (ConsumerRecord record : records)
             System.out.printf(&quot;offset = %d, key = %s, value = %s%n&quot;, record.offset(), record.key(), record.value());
     }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u9762\u7684\u7B2C3\u3001\u7B2C4\u884C\u4EE3\u7801\uFF0C\u5C31\u662F\u5F00\u542F\u81EA\u52A8\u63D0\u4EA4\u4F4D\u79FB\u7684\u65B9\u6CD5\u3002</p><p>\u5F00\u542F\u624B\u52A8\u63D0\u4EA4\u4F4D\u79FB\u7684\u65B9\u6CD5\u5C31\u662F\u8BBE\u7F6E<code>enable.auto.commit\u4E3Afalse</code>\u3002</p><p>\u8FD8\u9700\u8981\u8C03\u7528\u76F8\u5E94\u7684API\u624B\u52A8\u63D0\u4EA4\u4F4D\u79FB\u3002\u6700\u7B80\u5355\u7684API\u5C31\u662F**\u300CKafkaConsumer#commitSync()\u300D**\u3002</p><p>\u8BE5\u65B9\u6CD5\u4F1A\u63D0\u4EA4<code>KafkaConsumer#poll()</code>\u8FD4\u56DE\u7684\u6700\u65B0\u4F4D\u79FB\u3002</p><p>\u4ECE\u540D\u5B57\u4E0A\u6765\u770B\uFF0C\u5B83\u662F\u4E00\u4E2A\u540C\u6B65\u64CD\u4F5C\uFF0C\u5373\u8BE5\u65B9\u6CD5\u4F1A\u4E00\u76F4\u7B49\u5F85\uFF0C\u76F4\u5230\u4F4D\u79FB\u88AB\u6210\u529F\u63D0\u4EA4\u624D\u4F1A\u8FD4\u56DE\u3002</p><p>\u5982\u679C\u63D0\u4EA4\u8FC7\u7A0B\u4E2D\u51FA\u73B0\u5F02\u5E38\uFF0C\u8BE5\u65B9\u6CD5\u4F1A\u5C06\u5F02\u5E38\u4FE1\u606F\u629B\u51FA\u3002</p><p>\u4E0B\u9762\u8FD9\u6BB5\u4EE3\u7801\u5C55\u793A\u4E86commitSync()\u7684\u4F7F\u7528\u65B9\u6CD5\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>while (true) {
            ConsumerRecords records =
                        consumer.poll(Duration.ofSeconds(1));
            process(records); // \u5904\u7406\u6D88\u606F
            try {
                        consumer.commitSync();
            } catch (CommitFailedException e) {
                        handle(e); // \u5904\u7406\u63D0\u4EA4\u5931\u8D25\u5F02\u5E38
            }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E00\u65E6\u8BBE\u7F6E\u4E86<code>enable.auto.commit</code>\u4E3Atrue\uFF0CKafka\u4F1A\u4FDD\u8BC1\u5728\u5F00\u59CB\u8C03\u7528poll\u65B9\u6CD5\u65F6\uFF0C\u63D0\u4EA4\u4E0A\u6B21poll\u8FD4\u56DE\u7684\u6240\u6709\u6D88\u606F\u3002</p><p>\u4ECE\u987A\u5E8F\u4E0A\u6765\u8BF4\uFF0Cpoll\u65B9\u6CD5\u7684\u903B\u8F91\u662F\u5148\u63D0\u4EA4\u4E0A\u4E00\u6279\u6D88\u606F\u7684\u4F4D\u79FB\uFF0C\u518D\u5904\u7406\u4E0B\u4E00\u6279\u6D88\u606F\uFF0C\u56E0\u6B64\u5B83\u80FD\u4FDD\u8BC1\u4E0D\u51FA\u73B0\u6D88\u8D39\u4E22\u5931\u7684\u60C5\u51B5\u3002</p><p>\u4F46\u81EA\u52A8\u63D0\u4EA4\u4F4D\u79FB\u7684\u4E00\u4E2A\u95EE\u9898\u5728\u4E8E\uFF0C<strong>\u300C\u5B83\u53EF\u80FD\u4F1A\u51FA\u73B0\u91CD\u590D\u6D88\u8D39\u300D</strong>\u3002</p><p>\u800C\u624B\u52A8\u63D0\u4EA4\u4F4D\u79FB\uFF0C\u5B83\u7684\u597D\u5904\u5C31\u5728\u4E8E\u66F4\u52A0\u7075\u6D3B\uFF0C\u4F60\u5B8C\u5168\u80FD\u591F\u628A\u63A7\u4F4D\u79FB\u63D0\u4EA4\u7684\u65F6\u673A\u548C\u9891\u7387\u3002</p><p>\u4F46\u662F\uFF0C\u5B83\u4E5F\u6709\u4E00\u4E2A\u7F3A\u9677\uFF0C\u5C31\u662F\u5728\u8C03\u7528commitSync()\u65F6\uFF0CConsumer\u7A0B\u5E8F\u4F1A\u5904\u4E8E\u963B\u585E\u72B6\u6001\uFF0C\u76F4\u5230\u8FDC\u7AEF\u7684Broker\u8FD4\u56DE\u63D0\u4EA4\u7ED3\u679C\uFF0C\u8FD9\u4E2A\u72B6\u6001\u624D\u4F1A\u7ED3\u675F\u3002</p><p>\u9274\u4E8E\u8FD9\u4E2A\u95EE\u9898\uFF0CKafka\u793E\u533A\u4E3A\u624B\u52A8\u63D0\u4EA4\u4F4D\u79FB\u63D0\u4F9B\u4E86\u53E6\u4E00\u4E2AAPI\u65B9\u6CD5\uFF1A<strong>\u300CKafkaConsumer#commitAsync()\u300D</strong>\u3002</p><p>\u4ECE\u540D\u5B57\u4E0A\u6765\u770B\u5B83\u5C31\u4E0D\u662F\u540C\u6B65\u7684\uFF0C\u800C\u662F\u4E00\u4E2A\u5F02\u6B65\u64CD\u4F5C\u3002</p><p>\u8C03\u7528commitAsync()\u4E4B\u540E\uFF0C\u5B83\u4F1A\u7ACB\u5373\u8FD4\u56DE\uFF0C\u4E0D\u4F1A\u963B\u585E\uFF0C\u56E0\u6B64\u4E0D\u4F1A\u5F71\u54CDConsumer\u5E94\u7528\u7684TPS\u3002</p><p>\u7531\u4E8E\u5B83\u662F\u5F02\u6B65\u7684\uFF0CKafka\u63D0\u4F9B\u4E86\u56DE\u8C03\u51FD\u6570\uFF08callback\uFF09\uFF0C\u4F9B\u4F60\u5B9E\u73B0\u63D0\u4EA4\u4E4B\u540E\u7684\u903B\u8F91\uFF0C\u6BD4\u5982\u8BB0\u5F55\u65E5\u5FD7\u6216\u5904\u7406\u5F02\u5E38\u7B49\u3002</p><p>\u4E0B\u9762\u8FD9\u6BB5\u4EE3\u7801\u5C55\u793A\u4E86\u8C03\u7528commitAsync()\u7684\u65B9\u6CD5\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>while (true) {
            ConsumerRecords records = 
 consumer.poll(Duration.ofSeconds(1));
            process(records); // \u5904\u7406\u6D88\u606F
            consumer.commitAsync((offsets, exception) -&gt; {
 if (exception != null)
 handle(exception);
 });
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>commitAsync\u7684\u95EE\u9898\u5728\u4E8E\uFF0C\u51FA\u73B0\u95EE\u9898\u65F6\u5B83\u4E0D\u4F1A\u81EA\u52A8\u91CD\u8BD5\u3002</p><p>\u663E\u7136\uFF0C\u5982\u679C\u662F\u624B\u52A8\u63D0\u4EA4\uFF0C\u6211\u4EEC\u9700\u8981\u5C06commitSync\u548CcommitAsync\u7EC4\u5408\u4F7F\u7528\u624D\u80FD\u5230\u8FBE\u6700\u7406\u60F3\u7684\u6548\u679C\uFF0C\u539F\u56E0\u6709\u4E24\u4E2A\uFF1A</p><ol><li>\u6211\u4EEC\u53EF\u4EE5\u5229\u7528commitSync\u7684\u81EA\u52A8\u91CD\u8BD5\u6765\u89C4\u907F\u90A3\u4E9B\u77AC\u65F6\u9519\u8BEF\uFF0C\u6BD4\u5982\u7F51\u7EDC\u7684\u77AC\u65F6\u6296\u52A8\uFF0CBroker\u7AEFGC\u7B49\uFF0C\u56E0\u4E3A\u8FD9\u4E9B\u95EE\u9898\u90FD\u662F\u77ED\u6682\u7684\uFF0C\u81EA\u52A8\u91CD\u8BD5\u901A\u5E38\u90FD\u4F1A\u6210\u529F\u3002</li><li>\u6211\u4EEC\u4E0D\u5E0C\u671B\u7A0B\u5E8F\u603B\u5904\u4E8E\u963B\u585E\u72B6\u6001\uFF0C\u5F71\u54CDTPS\u3002</li></ol><p>\u6211\u4EEC\u6765\u770B\u4E00\u4E0B\u4E0B\u9762\u8FD9\u6BB5\u4EE3\u7801\uFF0C\u5B83\u5C55\u793A\u7684\u662F\u5982\u4F55\u5C06\u4E24\u4E2AAPI\u65B9\u6CD5\u7ED3\u5408\u4F7F\u7528\u8FDB\u884C\u624B\u52A8\u63D0\u4EA4\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   try {
           while(true) {
                        ConsumerRecords records = 
                                    consumer.poll(Duration.ofSeconds(1));
                        process(records); // \u5904\u7406\u6D88\u606F
                        commitAysnc(); // \u4F7F\u7528\u5F02\u6B65\u63D0\u4EA4\u89C4\u907F\u963B\u585E
            }
} catch(Exception e) {
            handle(e); // \u5904\u7406\u5F02\u5E38
} finally {
            try {
                        consumer.commitSync(); // \u6700\u540E\u4E00\u6B21\u63D0\u4EA4\u4F7F\u7528\u540C\u6B65\u963B\u585E\u5F0F\u63D0\u4EA4
 } finally {
      consumer.close();
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u6837\u4E00\u4E2A\u573A\u666F\uFF1A\u4F60\u7684poll\u65B9\u6CD5\u8FD4\u56DE\u7684\u4E0D\u662F500\u6761\u6D88\u606F\uFF0C\u800C\u662F5000\u6761\u3002</p><p>\u90A3\u4E48\uFF0C\u4F60\u80AF\u5B9A\u4E0D\u60F3\u628A\u8FD95000\u6761\u6D88\u606F\u90FD\u5904\u7406\u5B8C\u4E4B\u540E\u518D\u63D0\u4EA4\u4F4D\u79FB\uFF0C\u56E0\u4E3A\u4E00\u65E6\u4E2D\u95F4\u51FA\u73B0\u5DEE\u9519\uFF0C\u4E4B\u524D\u5904\u7406\u7684\u5168\u90E8\u90FD\u8981\u91CD\u6765\u4E00\u904D\u3002</p><p>\u6BD4\u5982\u524D\u9762\u8FD9\u4E2A5000\u6761\u6D88\u606F\u7684\u4F8B\u5B50\uFF0C\u4F60\u53EF\u80FD\u5E0C\u671B\u6BCF\u5904\u7406\u5B8C100\u6761\u6D88\u606F\u5C31\u63D0\u4EA4\u4E00\u6B21\u4F4D\u79FB\uFF0C\u8FD9\u6837\u80FD\u591F\u907F\u514D\u5927\u6279\u91CF\u7684\u6D88\u606F\u91CD\u65B0\u6D88\u8D39\u3002</p><p>Kafka Consumer API\u4E3A\u624B\u52A8\u63D0\u4EA4\u63D0\u4F9B\u4E86\u8FD9\u6837\u7684\u65B9\u6CD5\uFF1AcommitSync(Map)\u548CcommitAsync(Map)\u3002</p><p>\u5B83\u4EEC\u7684\u53C2\u6570\u662F\u4E00\u4E2AMap\u5BF9\u8C61\uFF0C\u952E\u5C31\u662FTopicPartition\uFF0C\u5373\u6D88\u8D39\u7684\u5206\u533A\uFF0C\u800C\u503C\u662F\u4E00\u4E2AOffsetAndMetadata\u5BF9\u8C61\uFF0C\u4FDD\u5B58\u7684\u4E3B\u8981\u662F\u4F4D\u79FB\u6570\u636E\u3002</p><blockquote><p>\u275D</p><p>\u5982\u4F55\u6BCF\u5904\u7406100\u6761\u6D88\u606F\u5C31\u63D0\u4EA4\u4E00\u6B21\u4F4D\u79FB\u5462\uFF1F</p><p>\u275E</p></blockquote><p>\u5728\u8FD9\u91CC\uFF0C\u6211\u4EE5commitAsync\u4E3A\u4F8B\uFF0C\u5C55\u793A\u4E00\u6BB5\u4EE3\u7801\uFF0C\u5B9E\u9645\u4E0A\uFF0CcommitSync\u7684\u8C03\u7528\u65B9\u6CD5\u548C\u5B83\u662F\u4E00\u6A21\u4E00\u6837\u7684\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>private Map offsets = new HashMap&lt;&gt;();
int count = 0;
\u2026\u2026
while (true) {
            ConsumerRecords records = 
 consumer.poll(Duration.ofSeconds(1));
            for (ConsumerRecord record: records) {
                        process(record);  // \u5904\u7406\u6D88\u606F
                        offsets.put(new TopicPartition(record.topic(), record.partition()),
                                   new OffsetAndMetadata(record.offset() + 1)\uFF1B
                       if\uFF08count % 100 == 0\uFF09
                                    consumer.commitAsync(offsets, null); // \u56DE\u8C03\u5904\u7406\u903B\u8F91\u662Fnull
                        count++;
 }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7A0B\u5E8F\u5148\u662F\u521B\u5EFA\u4E86\u4E00\u4E2AMap\u5BF9\u8C61\uFF0C\u7528\u4E8E\u4FDD\u5B58Consumer\u6D88\u8D39\u5904\u7406\u8FC7\u7A0B\u4E2D\u8981\u63D0\u4EA4\u7684\u5206\u533A\u4F4D\u79FB\uFF0C\u4E4B\u540E\u5F00\u59CB\u9010\u6761\u5904\u7406\u6D88\u606F\uFF0C\u5E76\u6784\u9020\u8981\u63D0\u4EA4\u7684\u4F4D\u79FB\u503C\u3002</p><p>\u4EE3\u7801\u7684\u6700\u540E\u90E8\u5206\u662F\u505A\u4F4D\u79FB\u7684\u63D0\u4EA4\u3002\u8BBE\u7F6E\u4E86\u4E00\u4E2A\u8BA1\u6570\u5668\uFF0C\u6BCF\u7D2F\u8BA1100\u6761\u6D88\u606F\u5C31\u7EDF\u4E00\u63D0\u4EA4\u4E00\u6B21\u4F4D\u79FB\u3002</p><p>\u4E0E\u8C03\u7528\u65E0\u53C2\u7684commitAsync\u4E0D\u540C\uFF0C\u8FD9\u91CC\u8C03\u7528\u4E86\u5E26Map\u5BF9\u8C61\u53C2\u6570\u7684commitAsync\u8FDB\u884C\u7EC6\u7C92\u5EA6\u7684\u4F4D\u79FB\u63D0\u4EA4\u3002</p><p>\u8FD9\u6837\uFF0C\u8FD9\u6BB5\u4EE3\u7801\u5C31\u80FD\u591F\u5B9E\u73B0\u6BCF\u5904\u7406100\u6761\u6D88\u606F\u5C31\u63D0\u4EA4\u4E00\u6B21\u4F4D\u79FB\uFF0C\u4E0D\u7528\u518D\u53D7poll\u65B9\u6CD5\u8FD4\u56DE\u7684\u6D88\u606F\u603B\u6570\u7684\u9650\u5236\u4E86\u3002</p><h2 id="\u91CD\u5E73\u8861" tabindex="-1"><a class="header-anchor" href="#\u91CD\u5E73\u8861" aria-hidden="true">#</a> \u91CD\u5E73\u8861</h2><p><strong>\u300C\uFF08\u91CD\u5E73\u8861\uFF09Rebalance\u672C\u8D28\u4E0A\u662F\u4E00\u79CD\u534F\u8BAE\uFF0C\u89C4\u5B9A\u4E86\u4E00\u4E2AConsumer Group\u4E0B\u7684\u6240\u6709Consumer\u5982\u4F55\u8FBE\u6210\u4E00\u81F4\uFF0C\u6765\u5206\u914D\u8BA2\u9605Topic\u7684\u6BCF\u4E2A\u5206\u533A\u300D</strong>\u3002</p><p>\u6BD4\u5982\u67D0\u4E2AGroup\u4E0B\u670920\u4E2AConsumer\u5B9E\u4F8B\uFF0C\u5B83\u8BA2\u9605\u4E86\u4E00\u4E2A\u5177\u6709100\u4E2A\u5206\u533A\u7684Topic\u3002</p><p>\u6B63\u5E38\u60C5\u51B5\u4E0B\uFF0CKafka\u5E73\u5747\u4F1A\u4E3A\u6BCF\u4E2AConsumer\u5206\u914D5\u4E2A\u5206\u533A\u3002\u8FD9\u4E2A\u5206\u914D\u7684\u8FC7\u7A0B\u5C31\u53EBRebalance\u3002</p><p><strong>\u300CRebalance\u7684\u89E6\u53D1\u6761\u4EF6\u67093\u4E2A\u3002\u300D</strong></p><ol><li>\u7EC4\u6210\u5458\u6570\u53D1\u751F\u53D8\u66F4\u3002\u6BD4\u5982\u6709\u65B0\u7684Consumer\u5B9E\u4F8B\u52A0\u5165\u7EC4\u6216\u8005\u79BB\u5F00\u7EC4\uFF0C\u6216\u662F\u6709Consumer\u5B9E\u4F8B\u5D29\u6E83\u88AB\u8E22\u51FA\u7EC4\u3002</li><li>\u8BA2\u9605\u4E3B\u9898\u6570\u53D1\u751F\u53D8\u66F4\u3002Consumer Group\u53EF\u4EE5\u4F7F\u7528\u6B63\u5219\u8868\u8FBE\u5F0F\u7684\u65B9\u5F0F\u8BA2\u9605\u4E3B\u9898\uFF0C\u6BD4\u5982<code>consumer.subscribe(Pattern.compile(\u201Ct.*c\u201D))</code>\u5C31\u8868\u660E\u8BE5Group\u8BA2\u9605\u6240\u6709\u4EE5\u5B57\u6BCDt\u5F00\u5934\u3001\u5B57\u6BCDc\u7ED3\u5C3E\u7684\u4E3B\u9898\uFF0C\u5728Consumer Group\u7684\u8FD0\u884C\u8FC7\u7A0B\u4E2D\uFF0C\u4F60\u65B0\u521B\u5EFA\u4E86\u4E00\u4E2A\u6EE1\u8DB3\u8FD9\u6837\u6761\u4EF6\u7684\u4E3B\u9898\uFF0C\u90A3\u4E48\u8BE5Group\u5C31\u4F1A\u53D1\u751FRebalance\u3002</li><li>\u8BA2\u9605\u4E3B\u9898\u7684\u5206\u533A\u6570\u53D1\u751F\u53D8\u66F4\u3002Kafka\u5F53\u524D\u53EA\u80FD\u5141\u8BB8\u589E\u52A0\u4E00\u4E2A\u4E3B\u9898\u7684\u5206\u533A\u6570\uFF0C\u5F53\u5206\u533A\u6570\u589E\u52A0\u65F6\uFF0C\u5C31\u4F1A\u89E6\u53D1\u8BA2\u9605\u8BE5\u4E3B\u9898\u7684\u6240\u6709Group\u5F00\u542FRebalance\u3002</li></ol><p>Rebalance\u53D1\u751F\u65F6\uFF0CGroup\u4E0B\u6240\u6709\u7684Consumer\u5B9E\u4F8B\u90FD\u4F1A\u534F\u8C03\u5728\u4E00\u8D77\u5171\u540C\u53C2\u4E0E\u3002</p><p><strong>\u300C\u5206\u914D\u7B56\u7565\u300D</strong></p><p>\u5F53\u524DKafka\u9ED8\u8BA4\u63D0\u4F9B\u4E863\u79CD\u5206\u914D\u7B56\u7565\uFF0C\u6BCF\u79CD\u7B56\u7565\u90FD\u6709\u4E00\u5B9A\u7684\u4F18\u52BF\u548C\u52A3\u52BF\uFF0C\u793E\u533A\u4F1A\u4E0D\u65AD\u5730\u5B8C\u5584\u8FD9\u4E9B\u7B56\u7565\uFF0C\u4FDD\u8BC1\u63D0\u4F9B\u6700\u516C\u5E73\u7684\u5206\u914D\u7B56\u7565\uFF0C\u5373\u6BCF\u4E2AConsumer\u5B9E\u4F8B\u90FD\u80FD\u591F\u5F97\u5230\u8F83\u4E3A\u5E73\u5747\u7684\u5206\u533A\u6570\u3002</p><p>\u6BD4\u5982\u4E00\u4E2AGroup\u5185\u670910\u4E2AConsumer\u5B9E\u4F8B\uFF0C\u8981\u6D88\u8D39100\u4E2A\u5206\u533A\uFF0C\u7406\u60F3\u7684\u5206\u914D\u7B56\u7565\u81EA\u7136\u662F\u6BCF\u4E2A\u5B9E\u4F8B\u5E73\u5747\u5F97\u523010\u4E2A\u5206\u533A\u3002</p><p>\u8FD9\u5C31\u53EB\u516C\u5E73\u7684\u5206\u914D\u7B56\u7565\u3002</p><p>\u4E3E\u4E2A\u7B80\u5355\u7684\u4F8B\u5B50\u6765\u8BF4\u660E\u4E00\u4E0BConsumer Group\u53D1\u751FRebalance\u7684\u8FC7\u7A0B\u3002</p><p>\u5047\u8BBE\u76EE\u524D\u67D0\u4E2AConsumer Group\u4E0B\u6709\u4E24\u4E2AConsumer\uFF0C\u6BD4\u5982A\u548CB\uFF0C\u5F53\u7B2C\u4E09\u4E2A\u6210\u5458C\u52A0\u5165\u65F6\uFF0CKafka\u4F1A\u89E6\u53D1Rebalance\uFF0C\u5E76\u6839\u636E\u9ED8\u8BA4\u7684\u5206\u914D\u7B56\u7565\u91CD\u65B0\u4E3AA\u3001B\u548CC\u5206\u914D\u5206\u533A</p><p>Rebalance\u4E4B\u540E\u7684\u5206\u914D\u4F9D\u7136\u662F\u516C\u5E73\u7684\uFF0C\u5373\u6BCF\u4E2AConsumer\u5B9E\u4F8B\u90FD\u83B7\u5F97\u4E862\u4E2A\u5206\u533A\u7684\u6D88\u8D39\u6743\u3002</p><p>\u5728Rebalance\u8FC7\u7A0B\u4E2D\uFF0C\u6240\u6709Consumer\u5B9E\u4F8B\u90FD\u4F1A\u505C\u6B62\u6D88\u8D39\uFF0C\u7B49\u5F85Rebalance\u5B8C\u6210\uFF0C\u8FD9\u662FRebalance\u4E3A\u4EBA\u8BDF\u75C5\u7684\u4E00\u4E2A\u65B9\u9762\u3002</p><p>\u76EE\u524DRebalance\u7684\u8BBE\u8BA1\u662F\u6240\u6709Consumer\u5B9E\u4F8B\u5171\u540C\u53C2\u4E0E\uFF0C\u5168\u90E8\u91CD\u65B0\u5206\u914D\u6240\u6709\u5206\u533A\u3002</p><p><strong>\u300CCoordinator\u4F1A\u5728\u4EC0\u4E48\u60C5\u51B5\u4E0B\u8BA4\u4E3A\u67D0\u4E2AConsumer\u5B9E\u4F8B\u5DF2\u6302\u4ECE\u800C\u8981\u9000\u7EC4\u5462\uFF1F\u300D</strong></p><p>\u5F53Consumer Group\u5B8C\u6210Rebalance\u4E4B\u540E\uFF0C\u6BCF\u4E2AConsumer\u5B9E\u4F8B\u90FD\u4F1A\u5B9A\u671F\u5730\u5411Coordinator\u53D1\u9001\u5FC3\u8DF3\u8BF7\u6C42\uFF0C\u8868\u660E\u5B83\u8FD8\u5B58\u6D3B\u7740\u3002</p><p>\u5982\u679C\u67D0\u4E2AConsumer\u5B9E\u4F8B\u4E0D\u80FD\u53CA\u65F6\u5730\u53D1\u9001\u8FD9\u4E9B\u5FC3\u8DF3\u8BF7\u6C42\uFF0CCoordinator\u5C31\u4F1A\u8BA4\u4E3A\u8BE5Consumer\u5DF2\u7ECF\u6B7B\u4E86\uFF0C\u4ECE\u800C\u5C06\u5176\u4ECEGroup\u4E2D\u79FB\u9664\uFF0C\u7136\u540E\u5F00\u542F\u65B0\u4E00\u8F6ERebalance\u3002</p><p>Consumer\u7AEF\u6709\u4E2A\u53C2\u6570\uFF0C\u53EB<code>session.timeout.ms</code>\u3002</p><p>\u8BE5\u53C2\u6570\u7684\u9ED8\u8BA4\u503C\u662F10\u79D2\uFF0C\u5373\u5982\u679CCoordinator\u572810\u79D2\u4E4B\u5185\u6CA1\u6709\u6536\u5230Group\u4E0B\u67D0Consumer\u5B9E\u4F8B\u7684\u5FC3\u8DF3\uFF0C\u5B83\u5C31\u4F1A\u8BA4\u4E3A\u8FD9\u4E2AConsumer\u5B9E\u4F8B\u5DF2\u7ECF\u6302\u4E86\u3002</p><p>\u9664\u4E86\u8FD9\u4E2A\u53C2\u6570\uFF0CConsumer\u8FD8\u63D0\u4F9B\u4E86\u4E00\u4E2A\u5141\u8BB8\u4F60\u63A7\u5236\u53D1\u9001\u5FC3\u8DF3\u8BF7\u6C42\u9891\u7387\u7684\u53C2\u6570\uFF0C\u5C31\u662F<code>heartbeat.interval.ms</code>\u3002</p><p>\u8FD9\u4E2A\u503C\u8BBE\u7F6E\u5F97\u8D8A\u5C0F\uFF0CConsumer\u5B9E\u4F8B\u53D1\u9001\u5FC3\u8DF3\u8BF7\u6C42\u7684\u9891\u7387\u5C31\u8D8A\u9AD8\u3002</p><p>\u9891\u7E41\u5730\u53D1\u9001\u5FC3\u8DF3\u8BF7\u6C42\u4F1A\u989D\u5916\u6D88\u8017\u5E26\u5BBD\u8D44\u6E90\uFF0C\u4F46\u597D\u5904\u662F\u80FD\u591F\u66F4\u52A0\u5FEB\u901F\u5730\u77E5\u6653\u5F53\u524D\u662F\u5426\u5F00\u542FRebalance\uFF0C\u56E0\u4E3A\uFF0C\u76EE\u524DCoordinator\u901A\u77E5\u5404\u4E2AConsumer\u5B9E\u4F8B\u5F00\u542FRebalance\u7684\u65B9\u6CD5\uFF0C\u5C31\u662F\u5C06<code>REBALANCE_NEEDED</code>\u6807\u5FD7\u5C01\u88C5\u8FDB\u5FC3\u8DF3\u8BF7\u6C42\u7684\u54CD\u5E94\u4F53\u4E2D\u3002</p><p>\u9664\u4E86\u4EE5\u4E0A\u4E24\u4E2A\u53C2\u6570\uFF0CConsumer\u7AEF\u8FD8\u6709\u4E00\u4E2A\u53C2\u6570\uFF0C\u7528\u4E8E\u63A7\u5236Consumer\u5B9E\u9645\u6D88\u8D39\u80FD\u529B\u5BF9Rebalance\u7684\u5F71\u54CD\uFF0C\u5373<code>max.poll.interval.ms</code>\u53C2\u6570\u3002</p><p>\u5B83\u9650\u5B9A\u4E86Consumer\u7AEF\u5E94\u7528\u7A0B\u5E8F\u4E24\u6B21\u8C03\u7528poll\u65B9\u6CD5\u7684\u6700\u5927\u65F6\u95F4\u95F4\u9694\u3002</p><p>\u5B83\u7684\u9ED8\u8BA4\u503C\u662F5\u5206\u949F\uFF0C\u8868\u793A\u4F60\u7684Consumer\u7A0B\u5E8F\u5982\u679C\u57285\u5206\u949F\u4E4B\u5185\u65E0\u6CD5\u6D88\u8D39\u5B8Cpoll\u65B9\u6CD5\u8FD4\u56DE\u7684\u6D88\u606F\uFF0C\u90A3\u4E48Consumer\u4F1A\u4E3B\u52A8\u53D1\u8D77\u79BB\u5F00\u7EC4\u7684\u8BF7\u6C42\uFF0CCoordinator\u4E5F\u4F1A\u5F00\u542F\u65B0\u4E00\u8F6ERebalance\u3002</p><p><strong>\u300C\u53EF\u907F\u514DRebalance\u7684\u914D\u7F6E\u300D</strong></p><p>\u7B2C\u4E00\u7C7BRebalance\u662F\u56E0\u4E3A\u672A\u80FD\u53CA\u65F6\u53D1\u9001\u5FC3\u8DF3\uFF0C\u5BFC\u81F4Consumer\u88AB\u8E22\u51FAGroup\u800C\u5F15\u53D1\u7684</p><p>\u56E0\u6B64\u53EF\u4EE5\u8BBE\u7F6E**\u300Csession.timeout.ms\u548Cheartbeat.interval.ms\u300D**\u7684\u503C\u3002</p><ul><li>\u8BBE\u7F6E<code>session.timeout.ms</code> = 6s\u3002</li><li>\u8BBE\u7F6E<code>heartbeat.interval.ms</code> = 2s\u3002</li><li>\u8981\u4FDD\u8BC1Consumer\u5B9E\u4F8B\u5728\u88AB\u5224\u5B9A\u4E3Adead\u4E4B\u524D\uFF0C\u80FD\u591F\u53D1\u9001\u81F3\u5C113\u8F6E\u7684\u5FC3\u8DF3\u8BF7\u6C42\uFF0C\u5373<code>session.timeout.ms &gt;= 3 * heartbeat.interval.ms</code>\u3002</li></ul><p>\u5C06<code>session.timeout.ms</code>\u8BBE\u7F6E\u62106s\u4E3B\u8981\u662F\u4E3A\u4E86\u8BA9Coordinator\u80FD\u591F\u66F4\u5FEB\u5730\u5B9A\u4F4D\u5DF2\u7ECF\u6302\u6389\u7684Consumer\u3002</p><p><strong>\u300C\u7B2C\u4E8C\u7C7BRebalance\u662FConsumer\u6D88\u8D39\u65F6\u95F4\u8FC7\u957F\u5BFC\u81F4\u7684\u300D</strong>\u3002</p><p>\u4F60\u8981\u4E3A\u4F60\u7684\u4E1A\u52A1\u5904\u7406\u903B\u8F91\u7559\u4E0B\u5145\u8DB3\u7684\u65F6\u95F4\uFF0C\u8FD9\u6837Consumer\u5C31\u4E0D\u4F1A\u56E0\u4E3A\u5904\u7406\u8FD9\u4E9B\u6D88\u606F\u7684\u65F6\u95F4\u592A\u957F\u800C\u5F15\u53D1Rebalance\u4E86\u3002</p><h2 id="consumeroffsets" tabindex="-1"><a class="header-anchor" href="#consumeroffsets" aria-hidden="true">#</a> ConsumerOffsets</h2><p><strong>\u300CKafka\u5C06Consumer\u7684\u4F4D\u79FB\u6570\u636E\u4F5C\u4E3A\u4E00\u6761\u6761\u666E\u901A\u7684Kafka\u6D88\u606F\uFF0C\u63D0\u4EA4\u5230__consumer_offsets\u4E2D\u3002\u300D</strong></p><p><strong>\u300C__consumer_offsets\u7684\u4E3B\u8981\u4F5C\u7528\u662F\u4FDD\u5B58Kafka\u6D88\u8D39\u8005\u7684\u4F4D\u79FB\u4FE1\u606F\u3002\u300D</strong></p><p>\u5B83\u8981\u6C42\u8FD9\u4E2A\u63D0\u4EA4\u8FC7\u7A0B\u4E0D\u4EC5\u8981\u5B9E\u73B0\u9AD8\u6301\u4E45\u6027\uFF0C\u8FD8\u8981\u652F\u6301\u9AD8\u9891\u7684\u5199\u64CD\u4F5C\u3002</p><p><code>__consumer_offsets</code>\u4E3B\u9898\u5C31\u662F\u666E\u901A\u7684Kafka\u4E3B\u9898\u3002\u4F60\u53EF\u4EE5\u624B\u52A8\u5730\u521B\u5EFA\u5B83\u3001\u4FEE\u6539\u5B83\uFF0C\u751A\u81F3\u662F\u5220\u9664\u5B83\u3002</p><p>\u867D\u8BF4<code>__consumer_offsets</code>\u4E3B\u9898\u662F\u4E00\u4E2A\u666E\u901A\u7684Kafka\u4E3B\u9898\uFF0C\u4F46**\u300C\u5B83\u7684\u6D88\u606F\u683C\u5F0F\u5374\u662FKafka\u81EA\u5DF1\u5B9A\u4E49\u7684\u300D**\uFF0C\u7528\u6237\u4E0D\u80FD\u4FEE\u6539\uFF0C\u4E5F\u5C31\u662F\u8BF4\u4F60\u4E0D\u80FD\u968F\u610F\u5730\u5411\u8FD9\u4E2A\u4E3B\u9898\u5199\u6D88\u606F\uFF0C\u56E0\u4E3A\u4E00\u65E6\u4F60\u5199\u5165\u7684\u6D88\u606F\u4E0D\u6EE1\u8DB3Kafka\u89C4\u5B9A\u7684\u683C\u5F0F\uFF0C\u90A3\u4E48Kafka\u5185\u90E8\u65E0\u6CD5\u6210\u529F\u89E3\u6790\uFF0C\u5C31\u4F1A\u9020\u6210Broker\u7684\u5D29\u6E83\u3002</p><p>Kafka Consumer\u6709API\u5E2E\u4F60\u63D0\u4EA4\u4F4D\u79FB\uFF0C\u4E5F\u5C31\u662F\u5411<code>__consumer_offsets</code>\u4E3B\u9898\u5199\u6D88\u606F\uFF0C\u5343\u4E07\u4E0D\u8981\u81EA\u5DF1\u5199\u4E2AProducer\u968F\u610F\u5411\u8BE5\u4E3B\u9898\u53D1\u9001\u6D88\u606F\u3002</p><p><code>__consumer_offsets</code>\u67093\u79CD\u6D88\u606F\u683C\u5F0F\uFF1A</p><ol><li>\u7528\u4E8E\u4FDD\u5B58Consumer Group\u4FE1\u606F\u7684\u6D88\u606F\u3002</li><li>\u7528\u4E8E\u5220\u9664Group\u8FC7\u671F\u4F4D\u79FB\u751A\u81F3\u662F\u5220\u9664Group\u7684\u6D88\u606F\u3002</li><li>\u4FDD\u5B58\u4E86\u4F4D\u79FB\u503C\u3002</li></ol><p>\u7B2C2\u79CD\u683C\u5F0F\u5B83\u6709\u4E2A\u4E13\u5C5E\u7684\u540D\u5B57\uFF1Atombstone\u6D88\u606F\uFF0C\u5373\u5893\u7891\u6D88\u606F\uFF0C\u4E5F\u79F0delete mark\uFF0C\u5B83\u7684\u4E3B\u8981\u7279\u70B9\u662F\u5B83\u7684\u6D88\u606F\u4F53\u662Fnull\uFF0C\u5373\u7A7A\u6D88\u606F\u4F53\u3002</p><p>\u4E00\u65E6\u67D0\u4E2AConsumer Group\u4E0B\u7684\u6240\u6709Consumer\u5B9E\u4F8B\u90FD\u505C\u6B62\u4E86\uFF0C\u800C\u4E14\u5B83\u4EEC\u7684\u4F4D\u79FB\u6570\u636E\u90FD\u5DF2\u88AB\u5220\u9664\u65F6\uFF0CKafka\u4F1A\u5411<code>__consumer_offsets</code>\u4E3B\u9898\u7684\u5BF9\u5E94\u5206\u533A\u5199\u5165tombstone\u6D88\u606F\uFF0C\u8868\u660E\u8981\u5F7B\u5E95\u5220\u9664\u8FD9\u4E2AGroup\u7684\u4FE1\u606F\u3002</p><p><code>__consumer_offsets</code>\u662F\u600E\u4E48\u88AB\u521B\u5EFA\u7684\uFF1F</p><p>\u901A\u5E38\u6765\u8BF4\uFF0C<strong>\u300C\u5F53Kafka\u96C6\u7FA4\u4E2D\u7684\u7B2C\u4E00\u4E2AConsumer\u7A0B\u5E8F\u542F\u52A8\u65F6\uFF0CKafka\u4F1A\u81EA\u52A8\u521B\u5EFA\u4F4D\u79FB\u4E3B\u9898\u300D</strong>\u3002</p><p><strong>\u300C\u9ED8\u8BA4\u8BE5\u4E3B\u9898\u7684\u5206\u533A\u6570\u662F50\uFF0C\u526F\u672C\u6570\u662F3\u300D</strong>\u3002</p><p>\u76EE\u524DKafka Consumer\u63D0\u4EA4\u4F4D\u79FB\u7684\u65B9\u5F0F\u6709\u4E24\u79CD\uFF1A<strong>\u300C\u81EA\u52A8\u63D0\u4EA4\u4F4D\u79FB\u548C\u624B\u52A8\u63D0\u4EA4\u4F4D\u79FB\u3002\u300D</strong></p><p>Consumer\u7AEF\u6709\u4E2A\u53C2\u6570\u53EB<code>enable.auto.commit</code>\uFF0C\u5982\u679C\u503C\u662Ftrue\uFF0C\u5219Consumer\u5728\u540E\u53F0\u9ED8\u9ED8\u5730\u4E3A\u4F60\u5B9A\u671F\u63D0\u4EA4\u4F4D\u79FB\uFF0C\u63D0\u4EA4\u95F4\u9694\u7531\u4E00\u4E2A\u4E13\u5C5E\u7684\u53C2\u6570<code>auto.commit.interval.ms</code>\u6765\u63A7\u5236\u3002</p><p>\u81EA\u52A8\u63D0\u4EA4\u4F4D\u79FB\u6709\u4E00\u4E2A\u663E\u8457\u7684\u4F18\u70B9\uFF0C\u5C31\u662F\u7701\u4E8B\uFF0C\u4F60\u4E0D\u7528\u64CD\u5FC3\u4F4D\u79FB\u63D0\u4EA4\u7684\u4E8B\u60C5\uFF0C\u5C31\u80FD\u4FDD\u8BC1\u6D88\u606F\u6D88\u8D39\u4E0D\u4F1A\u4E22\u5931\u3002</p><p>\u4F46\u8FD9\u4E00\u70B9\u540C\u65F6\u4E5F\u662F\u7F3A\u70B9\uFF0C\u4E27\u5931\u4E86\u5F88\u5927\u7684\u7075\u6D3B\u6027\u548C\u53EF\u63A7\u6027\uFF0C\u4F60\u5B8C\u5168\u6CA1\u6CD5\u628A\u63A7Consumer\u7AEF\u7684\u4F4D\u79FB\u7BA1\u7406\u3002</p><p>Kafka Consumer API\u4E3A\u4F60\u63D0\u4F9B\u4E86\u4F4D\u79FB\u63D0\u4EA4\u7684\u65B9\u6CD5\uFF0C\u5982<code>consumer.commitSync</code>\u7B49\u3002</p><p>\u5F53\u8C03\u7528\u8FD9\u4E9B\u65B9\u6CD5\u65F6\uFF0CKafka\u4F1A\u5411<code>__consumer_offsets</code>\u4E3B\u9898\u5199\u5165\u76F8\u5E94\u7684\u6D88\u606F\u3002</p><p>\u5982\u679C\u4F60\u9009\u62E9\u7684\u662F\u81EA\u52A8\u63D0\u4EA4\u4F4D\u79FB\uFF0C\u90A3\u4E48\u5C31\u53EF\u80FD\u5B58\u5728\u4E00\u4E2A\u95EE\u9898\uFF1A\u53EA\u8981Consumer\u4E00\u76F4\u542F\u52A8\u7740\uFF0C\u5B83\u5C31\u4F1A\u65E0\u9650\u671F\u5730\u5411\u4F4D\u79FB\u4E3B\u9898\u5199\u5165\u6D88\u606F\u3002</p><p><strong>\u300C\u4E3E\u4E2A\u6781\u7AEF\u4E00\u70B9\u7684\u4F8B\u5B50\u3002\u300D</strong></p><p>\u5047\u8BBEConsumer\u5F53\u524D\u6D88\u8D39\u5230\u4E86\u67D0\u4E2A\u4E3B\u9898\u7684\u6700\u65B0\u4E00\u6761\u6D88\u606F\uFF0C\u4F4D\u79FB\u662F100\uFF0C\u4E4B\u540E\u8BE5\u4E3B\u9898\u6CA1\u6709\u4EFB\u4F55\u65B0\u6D88\u606F\u4EA7\u751F\uFF0C\u6545Consumer\u65E0\u6D88\u606F\u53EF\u6D88\u8D39\u4E86\uFF0C\u6240\u4EE5\u4F4D\u79FB\u6C38\u8FDC\u4FDD\u6301\u5728100\u3002</p><p>\u7531\u4E8E\u662F\u81EA\u52A8\u63D0\u4EA4\u4F4D\u79FB\uFF0C\u4F4D\u79FB\u4E3B\u9898\u4E2D\u4F1A\u4E0D\u505C\u5730\u5199\u5165\u4F4D\u79FB=100\u7684\u6D88\u606F\u3002</p><p>\u663E\u7136Kafka\u53EA\u9700\u8981\u4FDD\u7559\u8FD9\u7C7B\u6D88\u606F\u4E2D\u7684\u6700\u65B0\u4E00\u6761\u5C31\u53EF\u4EE5\u4E86\uFF0C\u4E4B\u524D\u7684\u6D88\u606F\u90FD\u662F\u53EF\u4EE5\u5220\u9664\u7684\u3002</p><p>\u8FD9\u5C31\u8981\u6C42Kafka\u5FC5\u987B\u8981\u6709\u9488\u5BF9\u4F4D\u79FB\u4E3B\u9898\u6D88\u606F\u7279\u70B9\u7684\u6D88\u606F\u5220\u9664\u7B56\u7565\uFF0C\u5426\u5219\u8FD9\u79CD\u6D88\u606F\u4F1A\u8D8A\u6765\u8D8A\u591A\uFF0C\u6700\u7EC8\u6491\u7206\u6574\u4E2A\u78C1\u76D8\u3002</p><p><strong>\u300CCompact\u7B56\u7565\u300D</strong></p><p>Kafka\u4F7F\u7528**\u300CCompact\u7B56\u7565\u300D**\u6765\u5220\u9664<code>__consumer_offsets</code>\u4E3B\u9898\u4E2D\u7684\u8FC7\u671F\u6D88\u606F\uFF0C\u907F\u514D\u8BE5\u4E3B\u9898\u65E0\u9650\u671F\u81A8\u80C0\u3002</p><p>\u6BD4\u5982\u5BF9\u4E8E\u540C\u4E00\u4E2AKey\u7684\u4E24\u6761\u6D88\u606FM1\u548CM2\uFF0C\u5982\u679CM1\u7684\u53D1\u9001\u65F6\u95F4\u65E9\u4E8EM2\uFF0C\u90A3\u4E48M1\u5C31\u662F\u8FC7\u671F\u6D88\u606F\u3002</p><p>Compact\u7684\u8FC7\u7A0B\u5C31\u662F\u626B\u63CF\u65E5\u5FD7\u7684\u6240\u6709\u6D88\u606F\uFF0C\u5254\u9664\u90A3\u4E9B\u8FC7\u671F\u7684\u6D88\u606F\uFF0C\u7136\u540E\u628A\u5269\u4E0B\u7684\u6D88\u606F\u6574\u7406\u5728\u4E00\u8D77\u3002</p><p>\u6211\u5728\u8FD9\u91CC\u8D34\u4E00\u5F20\u6765\u81EA\u5B98\u7F51\u7684\u56FE\u7247\uFF0C\u6765\u8BF4\u660ECompact\u8FC7\u7A0B\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-kafkahxzszj-14efc721-5848-4931-80f3-b8a52c9a7816.jpg" alt=""></p><p>\u56FE\u4E2D\u4F4D\u79FB\u4E3A0\u30012\u548C3\u7684\u6D88\u606F\u7684Key\u90FD\u662FK1\uFF0CCompact\u4E4B\u540E\uFF0C\u5206\u533A\u53EA\u9700\u8981\u4FDD\u5B58\u4F4D\u79FB\u4E3A3\u7684\u6D88\u606F\uFF0C\u56E0\u4E3A\u5B83\u662F\u6700\u65B0\u53D1\u9001\u7684\u3002</p><p><strong>\u300CKafka\u63D0\u4F9B\u4E86\u4E13\u95E8\u7684\u540E\u53F0\u7EBF\u7A0B\u5B9A\u671F\u5730\u5DE1\u68C0\u5F85Compact\u7684\u4E3B\u9898\uFF0C\u770B\u770B\u662F\u5426\u5B58\u5728\u6EE1\u8DB3\u6761\u4EF6\u7684\u53EF\u5220\u9664\u6570\u636E\u300D</strong>\u3002</p><p>\u8FD9\u4E2A\u540E\u53F0\u7EBF\u7A0B\u53EBLog Cleaner\u3002</p><p>\u5F88\u591A\u5B9E\u9645\u751F\u4EA7\u73AF\u5883\u4E2D\u90FD\u51FA\u73B0\u8FC7\u4F4D\u79FB\u4E3B\u9898\u65E0\u9650\u81A8\u80C0\u5360\u7528\u8FC7\u591A\u78C1\u76D8\u7A7A\u95F4\u7684\u95EE\u9898\uFF0C\u5982\u679C\u4F60\u7684\u73AF\u5883\u4E2D\u4E5F\u6709\u8FD9\u4E2A\u95EE\u9898\uFF0C\u5EFA\u8BAE\u4F60\u53BB\u68C0\u67E5\u4E00\u4E0BLog Cleaner\u7EBF\u7A0B\u7684\u72B6\u6001\uFF0C\u901A\u5E38\u90FD\u662F\u8FD9\u4E2A\u7EBF\u7A0B\u6302\u6389\u4E86\u5BFC\u81F4\u7684\u3002</p><h2 id="\u526F\u672C\u673A\u5236" tabindex="-1"><a class="header-anchor" href="#\u526F\u672C\u673A\u5236" aria-hidden="true">#</a> \u526F\u672C\u673A\u5236</h2><p>\u6839\u636EKafka\u526F\u672C\u673A\u5236\u7684\u5B9A\u4E49\uFF0C\u540C\u4E00\u4E2A\u5206\u533A\u4E0B\u7684\u6240\u6709\u526F\u672C\u4FDD\u5B58\u6709\u76F8\u540C\u7684\u6D88\u606F\u5E8F\u5217\uFF0C\u8FD9\u4E9B\u526F\u672C\u5206\u6563\u4FDD\u5B58\u5728\u4E0D\u540C\u7684Broker\u4E0A\uFF0C\u4ECE\u800C\u80FD\u591F\u5BF9\u6297\u90E8\u5206Broker\u5B95\u673A\u5E26\u6765\u7684\u6570\u636E\u4E0D\u53EF\u7528\u3002</p><p>\u4E0B\u9762\u5C55\u793A\u7684\u662F\u4E00\u4E2A\u67093\u53F0Broker\u7684Kafka\u96C6\u7FA4\u4E0A\u7684\u526F\u672C\u5206\u5E03\u60C5\u51B5\u3002</p><p>\u4ECE\u8FD9\u5F20\u56FE\u4E2D\uFF0C\u6211\u4EEC\u53EF\u4EE5\u770B\u5230\uFF0C\u4E3B\u98981\u5206\u533A0\u76843\u4E2A\u526F\u672C\u5206\u6563\u57283\u53F0Broker\u4E0A\uFF0C\u5176\u4ED6\u4E3B\u9898\u5206\u533A\u7684\u526F\u672C\u4E5F\u90FD\u6563\u843D\u5728\u4E0D\u540C\u7684Broker\u4E0A\uFF0C\u4ECE\u800C\u5B9E\u73B0\u6570\u636E\u5197\u4F59\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-kafkahxzszj-b2a22704-3d2e-4e1d-8f43-0dfa869ff8a4.jpg" alt=""></p><p><strong>\u300C\u526F\u672C\u89D2\u8272\u300D</strong></p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-kafkahxzszj-804bdef2-6281-4dd6-bee7-ec3361cff781.jpg" alt=""></p><p>\u5728Kafka\u4E2D\uFF0C\u526F\u672C\u5206\u6210\u4E24\u7C7B\uFF1A\u9886\u5BFC\u8005\u526F\u672C\uFF08Leader Replica\uFF09\u548C\u8FFD\u968F\u8005\u526F\u672C\uFF08Follower Replica\uFF09\u3002</p><p>\u6BCF\u4E2A\u5206\u533A\u5728\u521B\u5EFA\u65F6\u90FD\u8981\u9009\u4E3E\u4E00\u4E2A\u526F\u672C\uFF0C\u79F0\u4E3A\u9886\u5BFC\u8005\u526F\u672C\uFF0C\u5176\u4F59\u7684\u526F\u672C\u81EA\u52A8\u79F0\u4E3A\u8FFD\u968F\u8005\u526F\u672C\u3002</p><p>\u5728Kafka\u4E2D\uFF0C\u8FFD\u968F\u8005\u526F\u672C\u662F\u4E0D\u5BF9\u5916\u63D0\u4F9B\u670D\u52A1\u7684\u3002\u8FD9\u5C31\u662F\u8BF4\uFF0C\u4EFB\u4F55\u4E00\u4E2A\u8FFD\u968F\u8005\u526F\u672C\u90FD\u4E0D\u80FD\u54CD\u5E94\u6D88\u8D39\u8005\u548C\u751F\u4EA7\u8005\u7684\u8BFB\u5199\u8BF7\u6C42\u3002\u6240\u6709\u7684\u8BF7\u6C42\u90FD\u5FC5\u987B\u7531\u9886\u5BFC\u8005\u526F\u672C\u6765\u5904\u7406\uFF0C\u6216\u8005\u8BF4\uFF0C\u6240\u6709\u7684\u8BFB\u5199\u8BF7\u6C42\u90FD\u5FC5\u987B\u53D1\u5F80\u9886\u5BFC\u8005\u526F\u672C\u6240\u5728\u7684Broker\uFF0C\u7531\u8BE5Broker\u8D1F\u8D23\u5904\u7406\u3002</p><p>\u8FFD\u968F\u8005\u526F\u672C\u4E0D\u5904\u7406\u5BA2\u6237\u7AEF\u8BF7\u6C42\uFF0C\u5B83\u552F\u4E00\u7684\u4EFB\u52A1\u5C31\u662F\u4ECE\u9886\u5BFC\u8005\u526F\u672C**\u300C\u5F02\u6B65\u62C9\u53D6\u300D**\u6D88\u606F\uFF0C\u5E76\u5199\u5165\u5230\u81EA\u5DF1\u7684\u63D0\u4EA4\u65E5\u5FD7\u4E2D\uFF0C\u4ECE\u800C\u5B9E\u73B0\u4E0E\u9886\u5BFC\u8005\u526F\u672C\u7684\u540C\u6B65\u3002</p><p>\u5F53\u9886\u5BFC\u8005\u526F\u672C\u6302\u6389\u4E86\uFF0C\u6216\u8005\u8BF4\u9886\u5BFC\u8005\u526F\u672C\u6240\u5728\u7684Broker\u5B95\u673A\u65F6\uFF0CKafka\u4F9D\u6258\u4E8EZooKeeper\u63D0\u4F9B\u7684\u76D1\u63A7\u529F\u80FD\u80FD\u591F\u5B9E\u65F6\u611F\u77E5\u5230\uFF0C\u5E76\u7ACB\u5373\u5F00\u542F\u65B0\u4E00\u8F6E\u7684\u9886\u5BFC\u8005\u9009\u4E3E\uFF0C\u4ECE\u8FFD\u968F\u8005\u526F\u672C\u4E2D\u9009\u4E00\u4E2A\u4F5C\u4E3A\u65B0\u7684\u9886\u5BFC\u8005\u3002\u8001Leader\u526F\u672C\u91CD\u542F\u56DE\u6765\u540E\uFF0C\u53EA\u80FD\u4F5C\u4E3A\u8FFD\u968F\u8005\u526F\u672C\u52A0\u5165\u5230\u96C6\u7FA4\u4E2D\u3002</p><p>\u5BF9\u4E8E\u5BA2\u6237\u7AEF\u7528\u6237\u800C\u8A00\uFF0CKafka\u7684\u8FFD\u968F\u8005\u526F\u672C\u6CA1\u6709\u4EFB\u4F55\u4F5C\u7528\uFF0CKafka\u4E3A\u4EC0\u4E48\u8981\u8FD9\u6837\u8BBE\u8BA1\u5462\uFF1F</p><p>\u8FD9\u79CD\u526F\u672C\u673A\u5236\u6709\u4E24\u4E2A\u65B9\u9762\u7684\u597D\u5904\u3002</p><p>1.<strong>\u300C\u65B9\u4FBF\u5B9E\u73B0Read-your-writes\u300D</strong>\u3002</p><p>\u6240\u8C13Read-your-writes\uFF0C\u987E\u540D\u601D\u4E49\u5C31\u662F\uFF0C\u5F53\u4F60\u4F7F\u7528\u751F\u4EA7\u8005API\u5411Kafka\u6210\u529F\u5199\u5165\u6D88\u606F\u540E\uFF0C\u9A6C\u4E0A\u4F7F\u7528\u6D88\u8D39\u8005API\u53BB\u8BFB\u53D6\u521A\u624D\u751F\u4EA7\u7684\u6D88\u606F\u3002</p><p>2.<strong>\u300C\u65B9\u4FBF\u5B9E\u73B0\u5355\u8C03\u8BFB\uFF08Monotonic Reads\uFF09\u300D</strong>\u3002</p><p>\u5047\u8BBE\u5F53\u524D\u67092\u4E2A\u8FFD\u968F\u8005\u526F\u672CF1\u548CF2\uFF0C\u5B83\u4EEC\u5F02\u6B65\u5730\u62C9\u53D6\u9886\u5BFC\u8005\u526F\u672C\u6570\u636E\u3002\u5018\u82E5F1\u62C9\u53D6\u4E86Leader\u7684\u6700\u65B0\u6D88\u606F\u800CF2\u8FD8\u672A\u53CA\u65F6\u62C9\u53D6\uFF0C\u90A3\u4E48\uFF0C\u6B64\u65F6\u5982\u679C\u6709\u4E00\u4E2A\u6D88\u8D39\u8005\u5148\u4ECEF1\u8BFB\u53D6\u6D88\u606F\u4E4B\u540E\u53C8\u4ECEF2\u62C9\u53D6\u6D88\u606F\uFF0C\u5B83\u53EF\u80FD\u4F1A\u770B\u5230\u8FD9\u6837\u7684\u73B0\u8C61\uFF1A\u7B2C\u4E00\u6B21\u6D88\u8D39\u65F6\u770B\u5230\u7684\u6700\u65B0\u6D88\u606F\u5728\u7B2C\u4E8C\u6B21\u6D88\u8D39\u65F6\u4E0D\u89C1\u4E86\uFF0C\u8FD9\u5C31\u4E0D\u662F\u5355\u8C03\u8BFB\u4E00\u81F4\u6027\u3002</p><p>\u4F46\u662F\uFF0C\u5982\u679C\u6240\u6709\u7684\u8BFB\u8BF7\u6C42\u90FD\u662F\u7531Leader\u6765\u5904\u7406\uFF0C\u90A3\u4E48Kafka\u5C31\u5F88\u5BB9\u6613\u5B9E\u73B0\u5355\u8C03\u8BFB\u4E00\u81F4\u6027\u3002</p><h3 id="isr\u673A\u5236" tabindex="-1"><a class="header-anchor" href="#isr\u673A\u5236" aria-hidden="true">#</a> ISR\u673A\u5236</h3><p>In-sync Replicas\uFF0C\u4E5F\u5C31\u662F\u6240\u8C13\u7684ISR\u526F\u672C\u96C6\u5408\u3002</p><p>ISR\u4E2D\u7684\u526F\u672C\u90FD\u662F\u4E0ELeader\u540C\u6B65\u7684\u526F\u672C\uFF0C\u76F8\u53CD\uFF0C\u4E0D\u5728ISR\u4E2D\u7684\u8FFD\u968F\u8005\u526F\u672C\u5C31\u88AB\u8BA4\u4E3A\u662F\u4E0ELeader\u4E0D\u540C\u6B65\u7684\u3002</p><blockquote><p>\u275D</p><p>\u4EC0\u4E48\u526F\u672C\u80FD\u591F\u8FDB\u5165\u5230ISR\u4E2D\u5462\uFF1F</p><p>\u275E</p></blockquote><p>Leader\u526F\u672C\u5929\u7136\u5C31\u5728ISR\u4E2D\u3002\u4E5F\u5C31\u662F\u8BF4\uFF0C<strong>\u300CISR\u4E0D\u53EA\u662F\u8FFD\u968F\u8005\u526F\u672C\u96C6\u5408\uFF0C\u5B83\u5FC5\u7136\u5305\u62ECLeader\u526F\u672C\u3002\u751A\u81F3\u5728\u67D0\u4E9B\u60C5\u51B5\u4E0B\uFF0CISR\u53EA\u6709Leader\u8FD9\u4E00\u4E2A\u526F\u672C\u300D</strong>\u3002</p><p>\u53E6\u5916\uFF0C\u80FD\u591F\u8FDB\u5165\u5230ISR\u7684\u8FFD\u968F\u8005\u526F\u672C\u8981\u6EE1\u8DB3\u4E00\u5B9A\u7684\u6761\u4EF6\u3002</p><p><strong>\u300C\u901A\u8FC7Broker\u7AEF\u53C2\u6570replica.lag.time.max.ms\u53C2\u6570\u503C\u300D</strong>\u3002</p><p>\u8FD9\u4E2A\u53C2\u6570\u7684\u542B\u4E49\u662FFollower\u526F\u672C\u80FD\u591F\u843D\u540ELeader\u526F\u672C\u7684\u6700\u957F\u65F6\u95F4\u95F4\u9694\uFF0C\u5F53\u524D\u9ED8\u8BA4\u503C\u662F10\u79D2\u3002</p><p>\u8FD9\u5C31\u662F\u8BF4\uFF0C\u53EA\u8981\u4E00\u4E2AFollower\u526F\u672C\u843D\u540ELeader\u526F\u672C\u7684\u65F6\u95F4\u4E0D\u8FDE\u7EED\u8D85\u8FC710\u79D2\uFF0C\u90A3\u4E48Kafka\u5C31\u8BA4\u4E3A\u8BE5Follower\u526F\u672C\u4E0ELeader\u662F\u540C\u6B65\u7684\uFF0C\u5373\u4F7F\u6B64\u65F6Follower\u526F\u672C\u4E2D\u4FDD\u5B58\u7684\u6D88\u606F\u660E\u663E\u5C11\u4E8ELeader\u526F\u672C\u4E2D\u7684\u6D88\u606F\u3002</p><p>Follower\u526F\u672C\u552F\u4E00\u7684\u5DE5\u4F5C\u5C31\u662F\u4E0D\u65AD\u5730\u4ECELeader\u526F\u672C\u62C9\u53D6\u6D88\u606F\uFF0C\u7136\u540E\u5199\u5165\u5230\u81EA\u5DF1\u7684\u63D0\u4EA4\u65E5\u5FD7\u4E2D\u3002</p><p>\u5018\u82E5\u8BE5\u526F\u672C\u540E\u9762\u6162\u6162\u5730\u8FFD\u4E0A\u4E86Leader\u7684\u8FDB\u5EA6\uFF0C\u90A3\u4E48\u5B83\u662F\u80FD\u591F\u91CD\u65B0\u88AB\u52A0\u56DEISR\u7684\u3002</p><p>ISR\u662F\u4E00\u4E2A\u52A8\u6001\u8C03\u6574\u7684\u96C6\u5408\uFF0C\u800C\u975E\u9759\u6001\u4E0D\u53D8\u7684\u3002</p><h3 id="unclean\u9886\u5BFC\u8005\u9009\u4E3E" tabindex="-1"><a class="header-anchor" href="#unclean\u9886\u5BFC\u8005\u9009\u4E3E" aria-hidden="true">#</a> Unclean\u9886\u5BFC\u8005\u9009\u4E3E</h3><p><strong>\u300CKafka\u628A\u6240\u6709\u4E0D\u5728ISR\u4E2D\u7684\u5B58\u6D3B\u526F\u672C\u90FD\u79F0\u4E3A\u975E\u540C\u6B65\u526F\u672C\u300D</strong>\u3002</p><p>\u901A\u5E38\u6765\u8BF4\uFF0C\u975E\u540C\u6B65\u526F\u672C\u843D\u540ELeader\u592A\u591A\uFF0C\u56E0\u6B64\uFF0C\u5982\u679C\u9009\u62E9\u8FD9\u4E9B\u526F\u672C\u4F5C\u4E3A\u65B0Leader\uFF0C\u5C31\u53EF\u80FD\u51FA\u73B0\u6570\u636E\u7684\u4E22\u5931\u3002</p><p>\u6BD5\u7ADF\uFF0C\u8FD9\u4E9B\u526F\u672C\u4E2D\u4FDD\u5B58\u7684\u6D88\u606F\u8FDC\u8FDC\u843D\u540E\u4E8E\u8001Leader\u4E2D\u7684\u6D88\u606F\u3002</p><p>\u5728Kafka\u4E2D\uFF0C\u9009\u4E3E\u8FD9\u79CD\u526F\u672C\u7684\u8FC7\u7A0B\u79F0\u4E3AUnclean\u9886\u5BFC\u8005\u9009\u4E3E\u3002</p><p><strong>\u300CBroker\u7AEF\u53C2\u6570unclean.leader.election.enable\u63A7\u5236\u662F\u5426\u5141\u8BB8Unclean\u9886\u5BFC\u8005\u9009\u4E3E\u300D</strong>\u3002</p><p>\u5F00\u542FUnclean\u9886\u5BFC\u8005\u9009\u4E3E\u53EF\u80FD\u4F1A\u9020\u6210\u6570\u636E\u4E22\u5931\uFF0C\u4F46\u597D\u5904\u662F\uFF0C\u5B83\u4F7F\u5F97\u5206\u533ALeader\u526F\u672C\u4E00\u76F4\u5B58\u5728\uFF0C\u4E0D\u81F3\u4E8E\u505C\u6B62\u5BF9\u5916\u63D0\u4F9B\u670D\u52A1\uFF0C\u56E0\u6B64\u63D0\u5347\u4E86\u9AD8\u53EF\u7528\u6027\u3002\u53CD\u4E4B\uFF0C\u7981\u6B62Unclean\u9886\u5BFC\u8005\u9009\u4E3E\u7684\u597D\u5904\u5728\u4E8E\u7EF4\u62A4\u4E86\u6570\u636E\u7684\u4E00\u81F4\u6027\uFF0C\u907F\u514D\u4E86\u6D88\u606F\u4E22\u5931\uFF0C\u4F46\u727A\u7272\u4E86\u9AD8\u53EF\u7528\u6027\u3002</p><h3 id="\u526F\u672C\u9009\u4E3E" tabindex="-1"><a class="header-anchor" href="#\u526F\u672C\u9009\u4E3E" aria-hidden="true">#</a> \u526F\u672C\u9009\u4E3E</h3><p>\u5BF9\u4E8Ekafka\u96C6\u7FA4\u4E2D\u5BF9\u4E8E\u4EFB\u610F\u7684topic\u7684\u5206\u533A\u4EE5\u53CA\u526F\u672Cleader\u7684\u8BBE\u5B9A\uFF0C\u90FD\u9700\u8981\u8003\u8651\u5230\u96C6\u7FA4\u6574\u4F53\u7684\u8D1F\u8F7D\u80FD\u529B\u7684\u5E73\u8861\u6027\uFF0C\u4F1A\u5C3D\u91CF\u5206\u914D\u6BCF\u4E00\u4E2Apartition\u7684\u526F\u672Cleader\u5728\u4E0D\u540C\u7684broker\u4E2D\uFF0C\u8FD9\u6837\u4F1A\u907F\u514D\u591A\u4E2Aleader\u5728\u540C\u4E00\u4E2Abroker\uFF0C\u5BFC\u81F4\u96C6\u7FA4\u4E2D\u7684broker\u8D1F\u8F7D\u4E0D\u5E73\u8861</p><p>kafka\u5F15\u5165\u4E86\u4F18\u5148\u526F\u672C\u7684\u6982\u5FF5\uFF0C\u4F18\u5148\u526F\u672C\u7684\u610F\u601D\u5728AR\uFF08\u5206\u533A\u4E2D\u7684\u6240\u6709\u526F\u672C\uFF09\u96C6\u5408\u5217\u8868\u4E2D\u7684\u7B2C\u4E00\u4E2A\u526F\u672C\uFF0C\u5728\u7406\u60F3\u72B6\u6001\u4E0B\u8BE5\u526F\u672C\u5C31\u662F\u8BE5\u5206\u533A\u7684leader\u526F\u672C</p><p>\u4F8B\u5982kafka\u96C6\u7FA4\u75313\u53F0broker\u7EC4\u6210\uFF0C\u521B\u5EFA\u4E86\u4E00\u4E2A\u540D\u4E3A<code>topic-partitions</code>\u7684topic\uFF0C\u8BBE\u7F6Epartition\u4E3A3\uFF0C\u526F\u672C\u6570\u4E3A3\uFF0Cpartition0\u4E2DAR\u5217\u8868\u4E3A <code>[1,2,0]</code>\uFF0C\u90A3\u4E48\u5206\u533A0\u7684\u4F18\u5148\u526F\u672C\u4E3A1</p><p>kafka\u4F7F\u7528\u591A\u526F\u672C\u673A\u5236\u63D0\u9AD8\u53EF\u9760\u6027\uFF0C\u4F46\u662F\u53EA\u6709leader\u526F\u672C\u5BF9\u5916\u63D0\u4F9B\u8BFB\u5199\u670D\u52A1\uFF0Cfollow\u526F\u672C\u53EA\u662F\u505A\u6D88\u606F\u540C\u6B65\u3002</p><p><strong>\u300C\u5982\u679C\u4E00\u4E2A\u5206\u533A\u7684leader\u526F\u672C\u4E0D\u53EF\u7528\uFF0C\u5C31\u610F\u5473\u7740\u6574\u4E2A\u5206\u533A\u4E0D\u53EF\u7528\uFF0C\u6B64\u65F6\u9700\u8981\u4ECEfollower\u526F\u672C\u4E2D\u9009\u4E3E\u51FA\u65B0\u7684leader\u526F\u672C\u63D0\u4F9B\u670D\u52A1\u300D</strong>\u3002</p><p><strong>\u300C\u5728\u521B\u5EFA\u4E3B\u9898\u7684\u65F6\u5019\uFF0C\u8BE5\u5206\u533A\u7684\u4E3B\u9898\u548C\u526F\u672C\u4F1A\u5C3D\u53EF\u80FD\u7684\u5747\u5300\u53D1\u5E03\u5230kafka\u7684\u5404\u4E2Abroker\u4E0A\u300D</strong>\u3002</p><p>\u6BD4\u5982\u6211\u4EEC\u5728\u5305\u542B3\u4E2Abroker\u8282\u70B9\u7684kafka\u96C6\u7FA4\u4E0A\u521B\u5EFA\u4E00\u4E2A\u5206\u533A\u6570\u4E3A3\uFF0C\u526F\u672C\u56E0\u5B50\u4E3A3\u7684\u4E3B\u9898<code>topic-partitions</code>\u65F6\uFF0Cleader\u526F\u672C\u4F1A\u5747\u5300\u7684\u5206\u5E03\u57283\u53F0broker\u8282\u70B9\u4E0A\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-kafkahxzszj-1dfdbca2-372c-4bcf-9f9c-d58a94f32477.jpg" alt=""></p><p><strong>\u300C\u9488\u5BF9\u540C\u4E00\u4E2A\u5206\u533A\uFF0C\u5728\u540C\u4E00\u4E2Abroker\u8282\u70B9\u4E0A\u4E0D\u53EF\u80FD\u51FA\u73B0\u5B83\u7684\u591A\u4E2A\u526F\u672C\u300D</strong>\u3002</p><p>\u6211\u4EEC\u53EF\u4EE5\u628Aleader\u526F\u672C\u6240\u5728\u7684\u8282\u70B9\u53EB\u4F5C\u5206\u533A\u7684leader\u8282\u70B9\uFF0C\u628Afollower\u526F\u672C\u6240\u5728\u7684\u8282\u70B9\u53EB\u4F5Cfollower\u8282\u70B9\u3002</p><p>\u5728\u4E0A\u9762\u7684\u4F8B\u5B50\u4E2D\uFF0C\u5206\u533A0\u7684leader\u8282\u70B9\u662Fbroker1\uFF0C\u5206\u533A1\u7684leader\u8282\u70B9\u662Fbroker2\uFF0C\u5206\u533A2\u7684leader\u8282\u70B9\u662Fbroker0\u3002</p><p>\u5F53\u5206\u533Aleader\u8282\u70B9\u53D1\u751F\u6545\u969C\u65F6\uFF0C\u5176\u4E2D\u7684\u4E00\u4E2Afollower\u8282\u70B9\u5C31\u4F1A\u9009\u4E3E\u4E3A\u65B0\u7684leader\u8282\u70B9\u3002</p><p>\u5F53\u539F\u6765leader\u7684\u8282\u70B9\u6062\u590D\u4E4B\u540E\uFF0C\u5B83\u53EA\u80FD\u6210\u4E3A\u4E00\u4E2Afollower\u8282\u70B9\uFF0C\u6B64\u65F6\u5C31\u5BFC\u81F4\u4E86\u96C6\u7FA4\u8D1F\u8F7D\u4E0D\u5747\u8861\u3002</p><p>\u6BD4\u5982\u5206\u533A1\u7684leader\u8282\u70B9broker2\u5D29\u6E83\u4E86\uFF0C\u6B64\u65F6\u9009\u4E3E\u4E86\u5728broker1\u4E0A\u7684\u5206\u533A1follower\u8282\u70B9\u4F5C\u4E3A\u65B0\u7684leader\u8282\u70B9\u3002</p><p>\u5F53broker2\u91CD\u65B0\u6062\u590D\u65F6\uFF0C\u6B64\u65F6\u7684kafka\u96C6\u7FA4\u72B6\u6001\u5982\u4E0B\uFF1A</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-kafkahxzszj-6630b85d-2c0d-44ea-add9-aa1ea1d66ac8.jpg" alt=""></p><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u6B64\u65F6broker1\u4E0A\u8D1F\u8F7D\u66F4\u5927\uFF0C\u800Cbroker2\u4E0A\u6CA1\u6709\u8D1F\u8F7D\u3002</p><p><strong>\u300C\u4E3A\u4E86\u89E3\u51B3\u4E0A\u8FF0\u8D1F\u8F7D\u4E0D\u5747\u8861\u7684\u60C5\u51B5\uFF0Ckafka\u652F\u6301\u4E86\u4F18\u5148\u526F\u672C\u9009\u4E3E\uFF0C\u4F18\u5148\u526F\u672C\u6307\u7684\u662F\u4E00\u4E2A\u5206\u533A\u6240\u5728\u7684AR\u96C6\u5408\u7684\u7B2C\u4E00\u4E2A\u526F\u672C\u300D</strong>\u3002</p><p>\u6BD4\u5982\u4E0A\u9762\u7684\u5206\u533A1\uFF0C\u5B83\u7684AR\u96C6\u5408\u662F<code>[2,0,1]</code>\uFF0C\u8868\u793A\u5206\u533A1\u7684\u4F18\u5148\u526F\u672C\u5C31\u662F\u5728broker2\u4E0A\u3002</p><p>\u7406\u60F3\u60C5\u51B5\u4E0B\uFF0C\u4F18\u5148\u526F\u672C\u5E94\u8BE5\u5C31\u662Fleader\u526F\u672C\uFF0Ckafka\u4FDD\u8BC1\u4E86\u4F18\u5148\u526F\u672C\u7684\u5747\u8861\u5206\u5E03\uFF0C\u800C\u8FD9\u4E0Ebroker\u8282\u70B9\u5B95\u673A\u4E0E\u5426\u6CA1\u6709\u5173\u7CFB\u3002</p><p><strong>\u300C\u4F18\u5148\u526F\u672C\u9009\u4E3E\u5C31\u662F\u5BF9\u5206\u533Aleader\u526F\u672C\u8FDB\u884C\u9009\u4E3E\u7684\u65F6\u5019\uFF0C\u5C3D\u53EF\u80FD\u8BA9\u4F18\u5148\u526F\u672C\u6210\u4E3Aleader\u526F\u672C\u300D</strong>\uFF0C\u9488\u5BF9\u4E0A\u8FF0\u7684\u60C5\u51B5\uFF0C\u53EA\u8981\u518D\u89E6\u53D1\u4E00\u6B21\u4F18\u5148\u526F\u672C\u9009\u4E3E\u5C31\u80FD\u4FDD\u8BC1\u5206\u533A\u8D1F\u8F7D\u5747\u8861\u3002</p><p>kafka\u652F\u6301\u81EA\u52A8\u4F18\u5148\u526F\u672C\u9009\u4E3E\u529F\u80FD\uFF0C\u9ED8\u8BA4\u6BCF5\u5206\u949F\u89E6\u53D1\u4E00\u6B21\u4F18\u5148\u526F\u672C\u9009\u4E3E\u64CD\u4F5C\u3002</p><h2 id="\u7F51\u7EDC\u901A\u4FE1\u6A21\u578B" tabindex="-1"><a class="header-anchor" href="#\u7F51\u7EDC\u901A\u4FE1\u6A21\u578B" aria-hidden="true">#</a> \u7F51\u7EDC\u901A\u4FE1\u6A21\u578B</h2><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-kafkahxzszj-8b040ee5-4ccc-4e81-b653-611c758c9899.jpg" alt=""></p><p>Broker \u4E2D\u6709\u4E2A<code>Acceptor(mainReactor)</code>\u76D1\u542C\u65B0\u8FDE\u63A5\u7684\u5230\u6765\uFF0C\u4E0E\u65B0\u8FDE\u63A5\u5EFA\u8FDE\u4E4B\u540E\u8F6E\u8BE2\u9009\u62E9\u4E00\u4E2A<code>Processor(subReactor)</code>\u7BA1\u7406\u8FD9\u4E2A\u8FDE\u63A5\u3002</p><p>\u800C<code>Processor</code>\u4F1A\u76D1\u542C\u5176\u7BA1\u7406\u7684\u8FDE\u63A5\uFF0C\u5F53\u4E8B\u4EF6\u5230\u8FBE\u4E4B\u540E\uFF0C\u8BFB\u53D6\u5C01\u88C5\u6210<code>Request</code>\uFF0C\u5E76\u5C06<code>Request</code>\u653E\u5165\u5171\u4EAB\u8BF7\u6C42\u961F\u5217\u4E2D\u3002</p><p>\u7136\u540EIO\u7EBF\u7A0B\u6C60\u4E0D\u65AD\u7684\u4ECE\u8BE5\u961F\u5217\u4E2D\u53D6\u51FA\u8BF7\u6C42\uFF0C\u6267\u884C\u771F\u6B63\u7684\u5904\u7406\u3002\u5904\u7406\u5B8C\u4E4B\u540E\u5C06\u54CD\u5E94\u53D1\u9001\u5230\u5BF9\u5E94\u7684<code>Processor</code>\u7684\u54CD\u5E94\u961F\u5217\u4E2D\uFF0C\u7136\u540E\u7531<code>Processor</code>\u5C06<code>Response</code>\u8FD4\u8FD8\u7ED9\u5BA2\u6237\u7AEF\u3002</p><p>\u6BCF\u4E2A<code>listener</code>\u53EA\u6709\u4E00\u4E2A<code>Acceptor\u7EBF\u7A0B</code>\uFF0C\u56E0\u4E3A\u5B83\u53EA\u662F\u4F5C\u4E3A\u65B0\u8FDE\u63A5\u5EFA\u8FDE\u518D\u5206\u53D1\uFF0C\u6CA1\u6709\u8FC7\u591A\u7684\u903B\u8F91\uFF0C\u5F88\u8F7B\u91CF\u3002</p><p><code>Processor</code> \u5728Kafka\u4E2D\u79F0\u4E4B\u4E3A\u7F51\u7EDC\u7EBF\u7A0B\uFF0C\u9ED8\u8BA4\u7F51\u7EDC\u7EBF\u7A0B\u6C60\u67093\u4E2A\u7EBF\u7A0B\uFF0C\u5BF9\u5E94\u7684\u53C2\u6570\u662F<code>num.network.threads</code>\uFF0C\u5E76\u4E14\u53EF\u4EE5\u6839\u636E\u5B9E\u9645\u7684\u4E1A\u52A1\u52A8\u6001\u589E\u51CF\u3002</p><p>\u8FD8\u6709\u4E2A IO \u7EBF\u7A0B\u6C60\uFF0C\u5373<code>KafkaRequestHandlerPool</code>\uFF0C\u6267\u884C\u771F\u6B63\u7684\u5904\u7406\uFF0C\u5BF9\u5E94\u7684\u53C2\u6570\u662F<code>num.io.threads</code>\uFF0C\u9ED8\u8BA4\u503C\u662F 8\u3002</p><p>IO\u7EBF\u7A0B\u5904\u7406\u5B8C\u4E4B\u540E\u4F1A\u5C06<code>Response</code>\u653E\u5165\u5BF9\u5E94\u7684<code>Processor</code>\u4E2D\uFF0C\u7531<code>Processor</code>\u5C06\u54CD\u5E94\u8FD4\u8FD8\u7ED9\u5BA2\u6237\u7AEF\u3002</p><p>\u53EF\u4EE5\u770B\u5230\u7F51\u7EDC\u7EBF\u7A0B\u548CIO\u7EBF\u7A0B\u4E4B\u95F4\u5229\u7528\u7684\u7ECF\u5178\u7684\u751F\u4EA7\u8005 - \u6D88\u8D39\u8005\u6A21\u5F0F\uFF0C\u4E0D\u8BBA\u662F\u7528\u4E8E\u5904\u7406Request\u7684\u5171\u4EAB\u8BF7\u6C42\u961F\u5217\uFF0C\u8FD8\u662FIO\u5904\u7406\u5B8C\u8FD4\u56DE\u7684Response\u3002</p><h2 id="\u5E42\u7B49\u6027" tabindex="-1"><a class="header-anchor" href="#\u5E42\u7B49\u6027" aria-hidden="true">#</a> \u5E42\u7B49\u6027</h2><p><strong>\u300C\u5E42\u7B49\u6027Producer\u300D</strong></p><p>\u5728Kafka\u4E2D\uFF0CProducer\u9ED8\u8BA4\u4E0D\u662F\u5E42\u7B49\u6027\u7684\uFF0C\u4F46\u6211\u4EEC\u53EF\u4EE5\u521B\u5EFA\u5E42\u7B49\u6027Producer\u3002</p><p>\u5B83\u5176\u5B9E\u662F0.11.0.0\u7248\u672C\u5F15\u5165\u7684\u65B0\u529F\u80FD\uFF0C\u5728\u6B64\u4E4B\u524D\uFF0CKafka\u5411\u5206\u533A\u53D1\u9001\u6570\u636E\u65F6\uFF0C\u53EF\u80FD\u4F1A\u51FA\u73B0\u540C\u4E00\u6761\u6D88\u606F\u88AB\u53D1\u9001\u4E86\u591A\u6B21\uFF0C\u5BFC\u81F4\u6D88\u606F\u91CD\u590D\u7684\u60C5\u51B5\u3002</p><p>\u57280.11\u4E4B\u540E\uFF0C\u6307\u5B9AProducer\u5E42\u7B49\u6027\u7684\u65B9\u6CD5\u5F88\u7B80\u5355\uFF0C\u4EC5\u9700\u8981\u8BBE\u7F6E\u4E00\u4E2A\u53C2\u6570\u5373\u53EF\uFF0C\u5373</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>props.put(\u201Cenable.idempotence\u201D, ture)\uFF0C
\u6216props.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG\uFF0C true)\u3002
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>enable.idempotence</code>\u88AB\u8BBE\u7F6E\u6210true\u540E\uFF0CProducer\u81EA\u52A8\u5347\u7EA7\u6210\u5E42\u7B49\u6027Producer\uFF0C\u5176\u4ED6\u6240\u6709\u7684\u4EE3\u7801\u903B\u8F91\u90FD\u4E0D\u9700\u8981\u6539\u53D8\u3002</p><p>Kafka\u81EA\u52A8\u5E2E\u4F60\u505A\u6D88\u606F\u7684\u91CD\u590D\u53BB\u91CD\u3002</p><p>\u5E95\u5C42\u5177\u4F53\u7684\u539F\u7406\u5F88\u7B80\u5355\uFF0C\u5C31\u662F\u7ECF\u5178\u7684\u7528\u7A7A\u95F4\u53BB\u6362\u65F6\u95F4\u7684\u4F18\u5316\u601D\u8DEF\uFF0C\u5373\u5728Broker\u7AEF\u591A\u4FDD\u5B58\u4E00\u4E9B\u5B57\u6BB5\u3002</p><p>\u5F53Producer\u53D1\u9001\u4E86\u5177\u6709\u76F8\u540C\u5B57\u6BB5\u503C\u7684\u6D88\u606F\u540E\uFF0CBroker\u80FD\u591F\u81EA\u52A8\u77E5\u6653\u8FD9\u4E9B\u6D88\u606F\u5DF2\u7ECF\u91CD\u590D\u4E86\uFF0C\u4E8E\u662F\u53EF\u4EE5\u5728\u540E\u53F0\u9ED8\u9ED8\u5730\u628A\u5B83\u4EEC\u4E22\u5F03\u6389\u3002</p><p><strong>\u300C\u5E42\u7B49\u6027Producer\u7684\u4F5C\u7528\u8303\u56F4\u300D</strong></p><p>\u9996\u5148\uFF0C\u5B83\u53EA\u80FD\u4FDD\u8BC1\u5355\u5206\u533A\u4E0A\u7684\u5E42\u7B49\u6027\uFF0C\u5373\u4E00\u4E2A\u5E42\u7B49\u6027Producer\u80FD\u591F\u4FDD\u8BC1\u67D0\u4E2A\u4E3B\u9898\u7684\u4E00\u4E2A\u5206\u533A\u4E0A\u4E0D\u51FA\u73B0\u91CD\u590D\u6D88\u606F\uFF0C\u5B83\u65E0\u6CD5\u5B9E\u73B0\u591A\u4E2A\u5206\u533A\u7684\u5E42\u7B49\u6027\u3002</p><p>\u5176\u6B21\uFF0C\u5B83\u53EA\u80FD\u5B9E\u73B0\u5355\u4F1A\u8BDD\u4E0A\u7684\u5E42\u7B49\u6027\uFF0C\u4E0D\u80FD\u5B9E\u73B0\u8DE8\u4F1A\u8BDD\u7684\u5E42\u7B49\u6027\u3002</p><p>\u8FD9\u91CC\u7684\u4F1A\u8BDD\uFF0C\u4F60\u53EF\u4EE5\u7406\u89E3\u4E3AProducer\u8FDB\u7A0B\u7684\u4E00\u6B21\u8FD0\u884C\uFF0C\u5F53\u4F60\u91CD\u542F\u4E86Producer\u8FDB\u7A0B\u4E4B\u540E\uFF0C\u8FD9\u79CD\u5E42\u7B49\u6027\u4FDD\u8BC1\u5C31\u4E27\u5931\u4E86\u3002</p><h2 id="\u4E8B\u52A1" tabindex="-1"><a class="header-anchor" href="#\u4E8B\u52A1" aria-hidden="true">#</a> \u4E8B\u52A1</h2><p>Kafka\u81EA0.11\u7248\u672C\u5F00\u59CB\u4E5F\u63D0\u4F9B\u4E86\u5BF9\u4E8B\u52A1\u7684\u652F\u6301\uFF0C\u76EE\u524D\u4E3B\u8981\u662F\u5728read committed\u9694\u79BB\u7EA7\u522B\u4E0A\u505A\u4E8B\u60C5\u3002</p><p>\u5B83\u80FD\u4FDD\u8BC1\u591A\u6761\u6D88\u606F\u539F\u5B50\u6027\u5730\u5199\u5165\u5230\u76EE\u6807\u5206\u533A\uFF0C\u540C\u65F6\u4E5F\u80FD\u4FDD\u8BC1Consumer\u53EA\u80FD\u770B\u5230\u4E8B\u52A1\u6210\u529F\u63D0\u4EA4\u7684\u6D88\u606F\u3002</p><p><strong>\u300C\u4E8B\u52A1\u578BProducer\u300D</strong></p><p>\u4E8B\u52A1\u578BProducer\u80FD\u591F\u4FDD\u8BC1\u5C06\u6D88\u606F\u539F\u5B50\u6027\u5730\u5199\u5165\u5230\u591A\u4E2A\u5206\u533A\u4E2D\u3002</p><p>\u8FD9\u6279\u6D88\u606F\u8981\u4E48\u5168\u90E8\u5199\u5165\u6210\u529F\uFF0C\u8981\u4E48\u5168\u90E8\u5931\u8D25\uFF0C\u53E6\u5916\uFF0C\u4E8B\u52A1\u578BProducer\u4E5F\u4E0D\u60E7\u8FDB\u7A0B\u7684\u91CD\u542F\u3002</p><p>Producer\u91CD\u542F\u56DE\u6765\u540E\uFF0CKafka\u4F9D\u7136\u4FDD\u8BC1\u5B83\u4EEC\u53D1\u9001\u6D88\u606F\u7684\u7CBE\u786E\u4E00\u6B21\u5904\u7406\u3002</p><p>\u8BBE\u7F6E\u4E8B\u52A1\u578BProducer\u7684\u65B9\u6CD5\u4E5F\u5F88\u7B80\u5355\uFF0C\u6EE1\u8DB3\u4E24\u4E2A\u8981\u6C42\u5373\u53EF\uFF1A</p><ul><li>\u548C\u5E42\u7B49\u6027Producer\u4E00\u6837\uFF0C\u5F00\u542F<code>enable.idempotence = true</code>\u3002</li><li>\u8BBE\u7F6EProducer\u7AEF\u53C2\u6570<code>transactional. id</code>\uFF0C\u6700\u597D\u4E3A\u5176\u8BBE\u7F6E\u4E00\u4E2A\u6709\u610F\u4E49\u7684\u540D\u5B57\u3002</li></ul><p>\u6B64\u5916\uFF0C\u4F60\u8FD8\u9700\u8981\u5728Producer\u4EE3\u7801\u4E2D\u505A\u4E00\u4E9B\u8C03\u6574\uFF0C\u5982\u8FD9\u6BB5\u4EE3\u7801\u6240\u793A\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>producer.initTransactions();
try {
            producer.beginTransaction();
            producer.send(record1);
            producer.send(record2);
            producer.commitTransaction();
} catch (KafkaException e) {
            producer.abortTransaction();
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u548C\u666E\u901AProducer\u4EE3\u7801\u76F8\u6BD4\uFF0C\u4E8B\u52A1\u578BProducer\u7684\u663E\u8457\u7279\u70B9\u662F\u8C03\u7528\u4E86\u4E00\u4E9B\u4E8B\u52A1API\uFF0C\u5982initTransaction\u3001beginTransaction\u3001commitTransaction\u548CabortTransaction\uFF0C\u5B83\u4EEC\u5206\u522B\u5BF9\u5E94\u4E8B\u52A1\u7684\u521D\u59CB\u5316\u3001\u4E8B\u52A1\u5F00\u59CB\u3001\u4E8B\u52A1\u63D0\u4EA4\u4EE5\u53CA\u4E8B\u52A1\u7EC8\u6B62\u3002</p><p>\u8FD9\u6BB5\u4EE3\u7801\u80FD\u591F\u4FDD\u8BC1Record1\u548CRecord2\u88AB\u5F53\u4F5C\u4E00\u4E2A\u4E8B\u52A1\u7EDF\u4E00\u63D0\u4EA4\u5230Kafka\uFF0C\u8981\u4E48\u5B83\u4EEC\u5168\u90E8\u63D0\u4EA4\u6210\u529F\uFF0C\u8981\u4E48\u5168\u90E8\u5199\u5165\u5931\u8D25\u3002</p><p>\u5B9E\u9645\u4E0A\u5373\u4F7F\u5199\u5165\u5931\u8D25\uFF0CKafka\u4E5F\u4F1A\u628A\u5B83\u4EEC\u5199\u5165\u5230\u5E95\u5C42\u7684\u65E5\u5FD7\u4E2D\uFF0C\u4E5F\u5C31\u662F\u8BF4Consumer\u8FD8\u662F\u4F1A\u770B\u5230\u8FD9\u4E9B\u6D88\u606F\u3002</p><p>\u6709\u4E00\u4E2A<code>isolation.level</code>\u53C2\u6570\uFF0C\u8FD9\u4E2A\u53C2\u6570\u6709\u4E24\u4E2A\u53D6\u503C\uFF1A</p><ol><li><code>read_uncommitted</code>\uFF1A\u8FD9\u662F\u9ED8\u8BA4\u503C\uFF0C\u8868\u660EConsumer\u80FD\u591F\u8BFB\u53D6\u5230Kafka\u5199\u5165\u7684\u4EFB\u4F55\u6D88\u606F\uFF0C\u4E0D\u8BBA\u4E8B\u52A1\u578BProducer\u63D0\u4EA4\u4E8B\u52A1\u8FD8\u662F\u7EC8\u6B62\u4E8B\u52A1\uFF0C\u5176\u5199\u5165\u7684\u6D88\u606F\u90FD\u53EF\u4EE5\u8BFB\u53D6\uFF0C\u5982\u679C\u4F60\u7528\u4E86\u4E8B\u52A1\u578BProducer\uFF0C\u90A3\u4E48\u5BF9\u5E94\u7684Consumer\u5C31\u4E0D\u8981\u4F7F\u7528\u8FD9\u4E2A\u503C\u3002</li><li><code>read_committed</code>\uFF1A\u8868\u660EConsumer\u53EA\u4F1A\u8BFB\u53D6\u4E8B\u52A1\u578BProducer\u6210\u529F\u63D0\u4EA4\u4E8B\u52A1\u5199\u5165\u7684\u6D88\u606F\uFF0C\u5B83\u4E5F\u80FD\u770B\u5230\u975E\u4E8B\u52A1\u578BProducer\u5199\u5165\u7684\u6240\u6709\u6D88\u606F\u3002</li></ol><h2 id="\u62E6\u622A\u5668" tabindex="-1"><a class="header-anchor" href="#\u62E6\u622A\u5668" aria-hidden="true">#</a> \u62E6\u622A\u5668</h2><p><strong>\u300CKafka\u62E6\u622A\u5668\u5206\u4E3A\u751F\u4EA7\u8005\u62E6\u622A\u5668\u548C\u6D88\u8D39\u8005\u62E6\u622A\u5668\u300D</strong>\u3002</p><p>\u751F\u4EA7\u8005\u62E6\u622A\u5668\u5141\u8BB8\u4F60\u5728\u53D1\u9001\u6D88\u606F\u524D\u4EE5\u53CA\u6D88\u606F\u63D0\u4EA4\u6210\u529F\u540E\u690D\u5165\u4F60\u7684\u62E6\u622A\u5668\u903B\u8F91\uFF1B</p><p>\u800C\u6D88\u8D39\u8005\u62E6\u622A\u5668\u652F\u6301\u5728\u6D88\u8D39\u6D88\u606F\u524D\u4EE5\u53CA\u63D0\u4EA4\u4F4D\u79FB\u540E\u7F16\u5199\u7279\u5B9A\u903B\u8F91\u3002</p><p>\u53EF\u4EE5\u5C06\u4E00\u7EC4\u62E6\u622A\u5668\u4E32\u8FDE\u6210\u4E00\u4E2A\u5927\u7684\u62E6\u622A\u5668\uFF0CKafka\u4F1A\u6309\u7167\u6DFB\u52A0\u987A\u5E8F\u4F9D\u6B21\u6267\u884C\u62E6\u622A\u5668\u903B\u8F91\u3002</p><p>\u5F53\u524DKafka\u62E6\u622A\u5668\u7684\u8BBE\u7F6E\u65B9\u6CD5\u662F\u901A\u8FC7\u53C2\u6570\u914D\u7F6E\u5B8C\u6210\u7684\uFF0C\u751F\u4EA7\u8005\u548C\u6D88\u8D39\u8005\u4E24\u7AEF\u6709\u4E00\u4E2A\u76F8\u540C\u7684\u53C2\u6570<code>interceptor.classes</code>\uFF0C\u5B83\u6307\u5B9A\u7684\u662F\u4E00\u7EC4\u7C7B\u7684\u5217\u8868\uFF0C\u6BCF\u4E2A\u7C7B\u5C31\u662F\u7279\u5B9A\u903B\u8F91\u7684\u62E6\u622A\u5668\u5B9E\u73B0\u7C7B\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Properties props = new Properties(); 
List interceptors = new ArrayList&lt;&gt;(); 
interceptors.add(&quot;com.yourcompany.kafkaproject.interceptors.AddTimestampInterceptor&quot;); // \u62E6\u622A\u56681 
interceptors.add(&quot;com.yourcompany.kafkaproject.interceptors.UpdateCounterInterceptor&quot;); // \u62E6\u622A\u56682 
props.put(ProducerConfig.INTERCEPTOR_CLASSES_CONFIG, interceptors); 
\u2026\u2026 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u275D</p><p>\u600E\u4E48\u7F16\u5199AddTimeStampInterceptor\u548CUpdateCounterInterceptor\u7C7B\u5462\uFF1F</p><p>\u275E</p></blockquote><p>\u8FD9\u4E24\u4E2A\u7C7B\u4EE5\u53CA\u4F60\u81EA\u5DF1\u7F16\u5199\u7684\u6240\u6709Producer\u7AEF\u62E6\u622A\u5668\u5B9E\u73B0\u7C7B\u90FD\u8981\u7EE7\u627F<code>org.apache.kafka.clients.producer.ProducerInterceptor</code>\u63A5\u53E3\u3002</p><p>\u8BE5\u63A5\u53E3\u662FKafka\u63D0\u4F9B\u7684\uFF0C\u91CC\u9762\u6709\u4E24\u4E2A\u6838\u5FC3\u7684\u65B9\u6CD5\u3002</p><ol><li>onSend\uFF1A\u8BE5\u65B9\u6CD5\u4F1A\u5728\u6D88\u606F\u53D1\u9001\u4E4B\u524D\u88AB\u8C03\u7528\u3002</li><li>onAcknowledgement\uFF1A\u8BE5\u65B9\u6CD5\u4F1A\u5728\u6D88\u606F\u6210\u529F\u63D0\u4EA4\u6216\u53D1\u9001\u5931\u8D25\u4E4B\u540E\u88AB\u8C03\u7528\u3002onAcknowledgement\u7684\u8C03\u7528\u8981\u65E9\u4E8Ecallback\u7684\u8C03\u7528\u3002\u503C\u5F97\u6CE8\u610F\u7684\u662F\uFF0C\u8FD9\u4E2A\u65B9\u6CD5\u548ConSend\u4E0D\u662F\u5728\u540C\u4E00\u4E2A\u7EBF\u7A0B\u4E2D\u88AB\u8C03\u7528\u7684\uFF0C\u56E0\u6B64\u5982\u679C\u4F60\u5728\u8FD9\u4E24\u4E2A\u65B9\u6CD5\u4E2D\u8C03\u7528\u4E86\u67D0\u4E2A\u5171\u4EAB\u53EF\u53D8\u5BF9\u8C61\uFF0C\u4E00\u5B9A\u8981\u4FDD\u8BC1\u7EBF\u7A0B\u5B89\u5168\u3002</li></ol><p>\u540C\u7406\uFF0C\u6307\u5B9A\u6D88\u8D39\u8005\u62E6\u622A\u5668\u4E5F\u662F\u540C\u6837\u7684\u65B9\u6CD5\uFF0C\u53EA\u662F\u5177\u4F53\u7684\u5B9E\u73B0\u7C7B\u8981\u5B9E\u73B0<code>org.apache.kafka.clients.consumer.ConsumerInterceptor</code>\u63A5\u53E3\uFF0C\u8FD9\u91CC\u9762\u4E5F\u6709\u4E24\u4E2A\u6838\u5FC3\u65B9\u6CD5\u3002</p><ol><li>onConsume\uFF1A\u8BE5\u65B9\u6CD5\u5728\u6D88\u606F\u8FD4\u56DE\u7ED9Consumer\u7A0B\u5E8F\u4E4B\u524D\u8C03\u7528\u3002</li><li>onCommit\uFF1AConsumer\u5728\u63D0\u4EA4\u4F4D\u79FB\u4E4B\u540E\u8C03\u7528\u8BE5\u65B9\u6CD5\u3002\u901A\u5E38\u4F60\u53EF\u4EE5\u5728\u8BE5\u65B9\u6CD5\u4E2D\u505A\u4E00\u4E9B\u8BB0\u8D26\u7C7B\u7684\u52A8\u4F5C\uFF0C\u6BD4\u5982\u6253\u65E5\u5FD7\u7B49\u3002</li></ol><p>\u4E00\u5B9A\u8981\u6CE8\u610F\u7684\u662F\uFF0C<strong>\u300C\u6307\u5B9A\u62E6\u622A\u5668\u7C7B\u65F6\u8981\u6307\u5B9A\u5B83\u4EEC\u7684\u5168\u9650\u5B9A\u540D\u300D</strong>\u3002</p><p>\u901A\u4FD7\u70B9\u8BF4\u5C31\u662F\u8981\u628A\u5B8C\u6574\u5305\u540D\u4E5F\u52A0\u4E0A\uFF0C\u4E0D\u8981\u53EA\u6709\u4E00\u4E2A\u7C7B\u540D\u5728\u90A3\u91CC\uFF0C\u5E76\u4E14\u8FD8\u8981\u4FDD\u8BC1\u4F60\u7684Producer\u7A0B\u5E8F\u80FD\u591F\u6B63\u786E\u52A0\u8F7D\u4F60\u7684\u62E6\u622A\u5668\u7C7B\u3002</p><h2 id="\u63A7\u5236\u5668" tabindex="-1"><a class="header-anchor" href="#\u63A7\u5236\u5668" aria-hidden="true">#</a> \u63A7\u5236\u5668</h2><p><strong>\u300C\u63A7\u5236\u5668\u7EC4\u4EF6\uFF08Controller\uFF09\uFF0C\u5B83\u7684\u4E3B\u8981\u4F5C\u7528\u662F\u5728Apache ZooKeeper\u7684\u5E2E\u52A9\u4E0B\u7BA1\u7406\u548C\u534F\u8C03\u6574\u4E2AKafka\u96C6\u7FA4\u300D</strong>\u3002</p><p>\u96C6\u7FA4\u4E2D\u4EFB\u610F\u4E00\u53F0Broker\u90FD\u80FD\u5145\u5F53\u63A7\u5236\u5668\u7684\u89D2\u8272\uFF0C\u4F46\u662F\uFF0C\u5728\u8FD0\u884C\u8FC7\u7A0B\u4E2D\uFF0C\u53EA\u80FD\u6709\u4E00\u4E2ABroker\u6210\u4E3A\u63A7\u5236\u5668\uFF0C\u884C\u4F7F\u5176\u7BA1\u7406\u548C\u534F\u8C03\u7684\u804C\u8D23\u3002</p><p>Kafka\u63A7\u5236\u5668\u5927\u91CF\u4F7F\u7528ZooKeeper\u7684Watch\u529F\u80FD\u5B9E\u73B0\u5BF9\u96C6\u7FA4\u7684\u534F\u8C03\u7BA1\u7406\u3002</p><p><strong>\u300C\u63A7\u5236\u5668\u662F\u5982\u4F55\u88AB\u9009\u51FA\u6765\u7684\u300D</strong></p><p>\u5B9E\u9645\u4E0A\uFF0CBroker\u5728\u542F\u52A8\u65F6\uFF0C\u4F1A\u5C1D\u8BD5\u53BBZooKeeper\u4E2D\u521B\u5EFA<code>/controller</code>\u8282\u70B9\u3002</p><p>Kafka\u5F53\u524D\u9009\u4E3E\u63A7\u5236\u5668\u7684\u89C4\u5219\u662F\uFF1A<strong>\u300C\u7B2C\u4E00\u4E2A\u6210\u529F\u521B\u5EFA/controller\u8282\u70B9\u7684Broker\u4F1A\u88AB\u6307\u5B9A\u4E3A\u63A7\u5236\u5668\u300D</strong>\u3002</p><p><strong>\u300C\u63A7\u5236\u5668\u662F\u505A\u4EC0\u4E48\u7684\u300D</strong></p><p>\u63A7\u5236\u5668\u7684\u804C\u8D23\u5927\u81F4\u53EF\u4EE5\u5206\u4E3A5\u79CD\uFF1A</p><p>1.<strong>\u300C\u4E3B\u9898\u7BA1\u7406\uFF08\u521B\u5EFA\u3001\u5220\u9664\u3001\u589E\u52A0\u5206\u533A\uFF09\u300D</strong></p><p>\u63A7\u5236\u5668\u5E2E\u52A9\u6211\u4EEC\u5B8C\u6210\u5BF9Kafka\u4E3B\u9898\u7684\u521B\u5EFA\u3001\u5220\u9664\u4EE5\u53CA\u5206\u533A\u589E\u52A0\u7684\u64CD\u4F5C\u3002</p><p>2.<strong>\u300C\u5206\u533A\u91CD\u5206\u914D\u300D</strong></p><p>3.<strong>\u300CPreferred\u9886\u5BFC\u8005\u9009\u4E3E\u300D</strong></p><p>Preferred\u9886\u5BFC\u8005\u9009\u4E3E\u4E3B\u8981\u662FKafka\u4E3A\u4E86\u907F\u514D\u90E8\u5206Broker\u8D1F\u8F7D\u8FC7\u91CD\u800C\u63D0\u4F9B\u7684\u4E00\u79CD\u6362Leader\u7684\u65B9\u6848\u3002</p><p>4.<strong>\u300C\u96C6\u7FA4\u6210\u5458\u7BA1\u7406\uFF08\u65B0\u589EBroker\u3001Broker\u4E3B\u52A8\u5173\u95ED\u3001Broker\u5B95\u673A\uFF09\u300D</strong></p><p>\u5305\u62EC\u81EA\u52A8\u68C0\u6D4B\u65B0\u589EBroker\u3001Broker\u4E3B\u52A8\u5173\u95ED\u53CA\u88AB\u52A8\u5B95\u673A\u3002</p><p>\u8FD9\u79CD\u81EA\u52A8\u68C0\u6D4B\u662F\u4F9D\u8D56\u4E8EWatch\u529F\u80FD\u548CZooKeeper\u4E34\u65F6\u8282\u70B9\u7EC4\u5408\u5B9E\u73B0\u7684\u3002</p><p>\u6BD4\u5982\uFF0C\u63A7\u5236\u5668\u7EC4\u4EF6\u4F1A\u5229\u7528**\u300CWatch\u673A\u5236\u300D**\u68C0\u67E5ZooKeeper\u7684<code>/brokers/ids</code>\u8282\u70B9\u4E0B\u7684\u5B50\u8282\u70B9\u6570\u91CF\u53D8\u66F4\u3002</p><p>\u76EE\u524D\uFF0C\u5F53\u6709\u65B0Broker\u542F\u52A8\u540E\uFF0C\u5B83\u4F1A\u5728<code>/brokers</code>\u4E0B\u521B\u5EFA\u4E13\u5C5E\u7684znode\u8282\u70B9\u3002</p><p>\u4E00\u65E6\u521B\u5EFA\u5B8C\u6BD5\uFF0CZooKeeper\u4F1A\u901A\u8FC7Watch\u673A\u5236\u5C06\u6D88\u606F\u901A\u77E5\u63A8\u9001\u7ED9\u63A7\u5236\u5668\uFF0C\u8FD9\u6837\uFF0C\u63A7\u5236\u5668\u5C31\u80FD\u81EA\u52A8\u5730\u611F\u77E5\u5230\u8FD9\u4E2A\u53D8\u5316\uFF0C\u8FDB\u800C\u5F00\u542F\u540E\u7EED\u7684\u65B0\u589EBroker\u4F5C\u4E1A\u3002</p><p>\u4FA6\u6D4BBroker\u5B58\u6D3B\u6027\u5219\u662F\u4F9D\u8D56\u4E8E\u521A\u521A\u63D0\u5230\u7684\u53E6\u4E00\u4E2A\u673A\u5236\uFF1A<strong>\u300C\u4E34\u65F6\u8282\u70B9\u300D</strong>\u3002</p><p>\u6BCF\u4E2ABroker\u542F\u52A8\u540E\uFF0C\u4F1A\u5728<code>/brokers/ids</code>\u4E0B\u521B\u5EFA\u4E00\u4E2A\u4E34\u65F6znode\u3002</p><p>\u5F53Broker\u5B95\u673A\u6216\u4E3B\u52A8\u5173\u95ED\u540E\uFF0C\u8BE5Broker\u4E0EZooKeeper\u7684\u4F1A\u8BDD\u7ED3\u675F\uFF0C\u8FD9\u4E2Aznode\u4F1A\u88AB\u81EA\u52A8\u5220\u9664\u3002</p><p>\u540C\u7406\uFF0CZooKeeper\u7684Watch\u673A\u5236\u5C06\u8FD9\u4E00\u53D8\u66F4\u63A8\u9001\u7ED9\u63A7\u5236\u5668\uFF0C\u8FD9\u6837\u63A7\u5236\u5668\u5C31\u80FD\u77E5\u9053\u6709Broker\u5173\u95ED\u6216\u5B95\u673A\u4E86\uFF0C\u4ECE\u800C\u8FDB\u884C\u5584\u540E\u3002</p><p>5.<strong>\u300C\u6570\u636E\u670D\u52A1\u300D</strong></p><p>\u63A7\u5236\u5668\u4E0A\u4FDD\u5B58\u4E86\u6700\u5168\u7684\u96C6\u7FA4\u5143\u6570\u636E\u4FE1\u606F\uFF0C\u5176\u4ED6\u6240\u6709Broker\u4F1A\u5B9A\u671F\u63A5\u6536\u63A7\u5236\u5668\u53D1\u6765\u7684\u5143\u6570\u636E\u66F4\u65B0\u8BF7\u6C42\uFF0C\u4ECE\u800C\u66F4\u65B0\u5176\u5185\u5B58\u4E2D\u7684\u7F13\u5B58\u6570\u636E\u3002</p><p><strong>\u300C\u63A7\u5236\u5668\u6545\u969C\u8F6C\u79FB\uFF08Failover\uFF09\u300D</strong></p><p><strong>\u300C\u6545\u969C\u8F6C\u79FB\u6307\u7684\u662F\uFF0C\u5F53\u8FD0\u884C\u4E2D\u7684\u63A7\u5236\u5668\u7A81\u7136\u5B95\u673A\u6216\u610F\u5916\u7EC8\u6B62\u65F6\uFF0CKafka\u80FD\u591F\u5FEB\u901F\u5730\u611F\u77E5\u5230\uFF0C\u5E76\u7ACB\u5373\u542F\u7528\u5907\u7528\u63A7\u5236\u5668\u6765\u4EE3\u66FF\u4E4B\u524D\u5931\u8D25\u7684\u63A7\u5236\u5668\u300D</strong>\u3002\u8FD9\u4E2A\u8FC7\u7A0B\u5C31\u88AB\u79F0\u4E3AFailover\uFF0C\u8BE5\u8FC7\u7A0B\u662F\u81EA\u52A8\u5B8C\u6210\u7684\uFF0C\u65E0\u9700\u4F60\u624B\u52A8\u5E72\u9884\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-kafkahxzszj-d9a4e4d3-0045-4755-87a4-4da396c7ad9f.jpg" alt=""></p><p>\u6700\u5F00\u59CB\u65F6\uFF0CBroker 0\u662F\u63A7\u5236\u5668\u3002\u5F53Broker 0\u5B95\u673A\u540E\uFF0CZooKeeper\u901A\u8FC7Watch\u673A\u5236\u611F\u77E5\u5230\u5E76\u5220\u9664\u4E86<code>/controller</code>\u4E34\u65F6\u8282\u70B9\u3002</p><p>\u4E4B\u540E\uFF0C\u6240\u6709\u5B58\u6D3B\u7684Broker\u5F00\u59CB\u7ADE\u9009\u65B0\u7684\u63A7\u5236\u5668\u8EAB\u4EFD\u3002</p><p>Broker 3\u6700\u7EC8\u8D62\u5F97\u4E86\u9009\u4E3E\uFF0C\u6210\u529F\u5730\u5728ZooKeeper\u4E0A\u91CD\u5EFA\u4E86<code>/controller</code>\u8282\u70B9\u3002</p><p>\u4E4B\u540E\uFF0CBroker 3\u4F1A\u4ECEZooKeeper\u4E2D\u8BFB\u53D6\u96C6\u7FA4\u5143\u6570\u636E\u4FE1\u606F\uFF0C\u5E76\u521D\u59CB\u5316\u5230\u81EA\u5DF1\u7684\u7F13\u5B58\u4E2D\u3002</p><p>\u81F3\u6B64\uFF0C\u63A7\u5236\u5668\u7684Failover\u5B8C\u6210\uFF0C\u53EF\u4EE5\u884C\u4F7F\u6B63\u5E38\u7684\u5DE5\u4F5C\u804C\u8D23\u4E86\u3002</p><h2 id="\u65E5\u5FD7\u5B58\u50A8" tabindex="-1"><a class="header-anchor" href="#\u65E5\u5FD7\u5B58\u50A8" aria-hidden="true">#</a> \u65E5\u5FD7\u5B58\u50A8</h2><p>Kafka\u4E2D\u7684\u6D88\u606F\u662F\u4EE5\u4E3B\u9898\u4E3A\u57FA\u672C\u5355\u4F4D\u8FDB\u884C\u5F52\u7C7B\u7684\uFF0C\u6BCF\u4E2A\u4E3B\u9898\u5728\u903B\u8F91\u4E0A\u76F8\u4E92\u72EC\u7ACB\u3002</p><p>\u6BCF\u4E2A\u4E3B\u9898\u53C8\u53EF\u4EE5\u5206\u4E3A\u4E00\u4E2A\u6216\u591A\u4E2A\u5206\u533A\uFF0C\u5728\u4E0D\u8003\u8651\u526F\u672C\u7684\u60C5\u51B5\u4E0B\uFF0C\u4E00\u4E2A\u5206\u533A\u4F1A\u5BF9\u5E94\u4E00\u4E2A\u65E5\u5FD7\u3002</p><p>\u4F46\u8BBE\u8BA1\u8005\u8003\u8651\u5230\u968F\u7740\u65F6\u95F4\u63A8\u79FB\uFF0C\u65E5\u5FD7\u6587\u4EF6\u4F1A\u4E0D\u65AD\u6269\u5927\uFF0C\u56E0\u6B64\u4E3A\u4E86\u9632\u6B62Log\u8FC7\u5927\uFF0C\u8BBE\u8BA1\u8005\u5F15\u5165\u4E86\u65E5\u5FD7\u5206\u6BB5\uFF08LogSegment\uFF09\u7684\u6982\u5FF5\uFF0C\u5C06Log\u5207\u5206\u4E3A\u591A\u4E2ALogSegment\uFF0C\u4FBF\u4E8E\u540E\u7EED\u7684\u6D88\u606F\u7EF4\u62A4\u548C\u6E05\u7406\u5DE5\u4F5C\u3002</p><p>\u4E0B\u56FE\u63CF\u7ED8\u4E86\u4E3B\u9898\u3001\u5206\u533A\u3001\u526F\u672C\u3001Log\u3001LogSegment\u4E94\u8005\u4E4B\u95F4\u7684\u5173\u7CFB\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-kafkahxzszj-da2e2224-c452-40d2-b1e6-9719e5520954.jpg" alt=""></p><p><strong>\u300CLogSegment\u300D</strong></p><p>\u5728Kafka\u4E2D\uFF0C\u6BCF\u4E2ALog\u5BF9\u8C61\u53C8\u53EF\u4EE5\u5212\u5206\u4E3A\u591A\u4E2ALogSegment\u6587\u4EF6\uFF0C\u6BCF\u4E2ALogSegment\u6587\u4EF6\u5305\u62EC\u4E00\u4E2A\u65E5\u5FD7\u6570\u636E\u6587\u4EF6\u548C\u4E24\u4E2A\u7D22\u5F15\u6587\u4EF6\uFF08\u504F\u79FB\u91CF\u7D22\u5F15\u6587\u4EF6\u548C\u6D88\u606F\u65F6\u95F4\u6233\u7D22\u5F15\u6587\u4EF6\uFF09\u3002</p><p>\u5176\u4E2D\uFF0C\u6BCF\u4E2ALogSegment\u4E2D\u7684\u65E5\u5FD7\u6570\u636E\u6587\u4EF6\u5927\u5C0F\u5747\u76F8\u7B49\uFF08\u8BE5\u65E5\u5FD7\u6570\u636E\u6587\u4EF6\u7684\u5927\u5C0F\u53EF\u4EE5\u901A\u8FC7\u5728Kafka Broker\u7684<code>config/server.properties</code>\u914D\u7F6E\u6587\u4EF6\u7684\u4E2D\u7684**\u300Clog.segment.bytes\u300D**\u8FDB\u884C\u8BBE\u7F6E\uFF0C\u9ED8\u8BA4\u4E3A1G\u5927\u5C0F\uFF081073741824\u5B57\u8282\uFF09\uFF0C\u5728\u987A\u5E8F\u5199\u5165\u6D88\u606F\u65F6\u5982\u679C\u8D85\u51FA\u8BE5\u8BBE\u5B9A\u7684\u9608\u503C\uFF0C\u5C06\u4F1A\u521B\u5EFA\u4E00\u7EC4\u65B0\u7684\u65E5\u5FD7\u6570\u636E\u548C\u7D22\u5F15\u6587\u4EF6\uFF09\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-kafkahxzszj-57d8c857-af51-4d68-9dcb-86c96ba3cb8e.jpg" alt=""></p><h2 id="\u5E38\u7528\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#\u5E38\u7528\u53C2\u6570" aria-hidden="true">#</a> \u5E38\u7528\u53C2\u6570</h2><p><strong>\u300Cbroker\u7AEF\u914D\u7F6E\u300D</strong></p><ul><li>broker.id</li></ul><p>\u6BCF\u4E2A kafka broker \u90FD\u6709\u4E00\u4E2A\u552F\u4E00\u7684\u6807\u8BC6\u6765\u8868\u793A\uFF0C\u8FD9\u4E2A\u552F\u4E00\u7684\u6807\u8BC6\u7B26\u5373\u662F <code>broker.id</code>\uFF0C\u5B83\u7684\u9ED8\u8BA4\u503C\u662F 0\u3002</p><p>\u8FD9\u4E2A\u503C\u5728 kafka \u96C6\u7FA4\u4E2D\u5FC5\u987B\u662F\u552F\u4E00\u7684\uFF0C\u8FD9\u4E2A\u503C\u53EF\u4EE5\u4EFB\u610F\u8BBE\u5B9A\uFF0C</p><ul><li>port</li></ul><p>\u5982\u679C\u4F7F\u7528\u914D\u7F6E\u6837\u672C\u6765\u542F\u52A8 kafka\uFF0C\u5B83\u4F1A\u76D1\u542C 9092 \u7AEF\u53E3\uFF0C\u4FEE\u6539 port \u914D\u7F6E\u53C2\u6570\u53EF\u4EE5\u628A\u5B83\u8BBE\u7F6E\u6210\u4EFB\u610F\u7684\u7AEF\u53E3\u3002</p><p>\u8981\u6CE8\u610F\uFF0C\u5982\u679C\u4F7F\u7528 1024 \u4EE5\u4E0B\u7684\u7AEF\u53E3\uFF0C\u9700\u8981\u4F7F\u7528 root \u6743\u9650\u542F\u52A8 kakfa\u3002</p><ul><li>zookeeper.connect</li></ul><p>\u7528\u4E8E\u4FDD\u5B58 broker \u5143\u6570\u636E\u7684 Zookeeper \u5730\u5740\u662F\u901A\u8FC7 <code>zookeeper.connect</code> \u6765\u6307\u5B9A\u7684\u3002</p><p>\u6BD4\u5982\u53EF\u4EE5\u8FD9\u4E48\u6307\u5B9A <code>localhost:2181</code> \u8868\u793A\u8FD9\u4E2A Zookeeper \u662F\u8FD0\u884C\u5728\u672C\u5730 2181 \u7AEF\u53E3\u4E0A\u7684\u3002</p><p>\u6211\u4EEC\u4E5F\u53EF\u4EE5\u901A\u8FC7 \u6BD4\u5982\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7 <code>zk1:2181,zk2:2181,zk3:2181</code> \u6765\u6307\u5B9A <code>zookeeper.connect</code> \u7684\u591A\u4E2A\u53C2\u6570\u503C\u3002</p><p>\u8BE5\u914D\u7F6E\u53C2\u6570\u662F\u7528\u5192\u53F7\u5206\u5272\u7684\u4E00\u7EC4 <code>hostname:port/path</code> \u5217\u8868\uFF0C\u5176\u542B\u4E49\u5982\u4E0B</p><ul><li>hostname \u662F Zookeeper \u670D\u52A1\u5668\u7684\u673A\u5668\u540D\u6216\u8005 ip \u5730\u5740\u3002</li><li>port \u662F Zookeeper \u5BA2\u6237\u7AEF\u7684\u7AEF\u53E3\u53F7</li><li>/path \u662F\u53EF\u9009\u62E9\u7684 Zookeeper \u8DEF\u5F84\uFF0CKafka \u8DEF\u5F84\u662F\u4F7F\u7528\u4E86 <code>chroot</code> \u73AF\u5883\uFF0C\u5982\u679C\u4E0D\u6307\u5B9A\u9ED8\u8BA4\u4F7F\u7528\u8DDF\u8DEF\u5F84\u3002</li></ul><blockquote><p>\u275D</p><p>\u5982\u679C\u4F60\u6709\u4E24\u5957 Kafka \u96C6\u7FA4\uFF0C\u5047\u8BBE\u5206\u522B\u53EB\u5B83\u4EEC kafka1 \u548C kafka2\uFF0C\u90A3\u4E48\u4E24\u5957\u96C6\u7FA4\u7684<code>zookeeper.connect</code>\u53C2\u6570\u53EF\u4EE5\u8FD9\u6837\u6307\u5B9A\uFF1A<code>zk1:2181,zk2:2181,zk3:2181/kafka1</code>\u548C<code>zk1:2181,zk2:2181,zk3:2181/kafka2</code></p><p>\u275E</p></blockquote><ul><li>log.dirs</li></ul><p>Kafka \u628A\u6240\u6709\u7684\u6D88\u606F\u90FD\u4FDD\u5B58\u5230\u78C1\u76D8\u4E0A\uFF0C\u5B58\u653E\u8FD9\u4E9B\u65E5\u5FD7\u7247\u6BB5\u7684\u76EE\u5F55\u662F\u901A\u8FC7 <code>log.dirs</code> \u6765\u5236\u5B9A\u7684\uFF0C\u5B83\u662F\u7528\u4E00\u7EC4\u9017\u53F7\u6765\u5206\u5272\u7684\u672C\u5730\u7CFB\u7EDF\u8DEF\u5F84\uFF0C<code>log.dirs</code> \u662F\u6CA1\u6709\u9ED8\u8BA4\u503C\u7684\uFF0C<strong>\u300C\u4F60\u5FC5\u987B\u624B\u52A8\u6307\u5B9A\u4ED6\u7684\u9ED8\u8BA4\u503C\u300D</strong>\u3002</p><p>\u5176\u5B9E\u8FD8\u6709\u4E00\u4E2A\u53C2\u6570\u662F <code>log.dir</code>\uFF0C\u8FD9\u4E2A\u914D\u7F6E\u662F\u6CA1\u6709 <code>s</code> \u7684\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u53EA\u7528\u914D\u7F6E <code>log.dirs</code> \u5C31\u597D\u4E86\uFF0C\u6BD4\u5982\u4F60\u53EF\u4EE5\u901A\u8FC7 <code>/home/kafka1,/home/kafka2,/home/kafka3</code> \u8FD9\u6837\u6765\u914D\u7F6E\u8FD9\u4E2A\u53C2\u6570\u7684\u503C\u3002</p><ul><li>auto.create.topics.enable</li></ul><p>\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Ckafka \u4F1A\u81EA\u52A8\u521B\u5EFA\u4E3B\u9898</p><p><code>auto.create.topics.enable</code>\u53C2\u6570\u5EFA\u8BAE\u6700\u597D\u8BBE\u7F6E\u6210 false\uFF0C\u5373\u4E0D\u5141\u8BB8\u81EA\u52A8\u521B\u5EFA Topic\u3002</p><p><strong>\u300C\u4E3B\u9898\u76F8\u5173\u914D\u7F6E\u300D</strong></p><ul><li>num.partitions</li></ul><p>num.partitions \u53C2\u6570\u6307\u5B9A\u4E86\u65B0\u521B\u5EFA\u7684\u4E3B\u9898\u9700\u8981\u5305\u542B\u591A\u5C11\u4E2A\u5206\u533A\uFF0C\u8BE5\u53C2\u6570\u7684\u9ED8\u8BA4\u503C\u662F 1\u3002</p><ul><li>default.replication.factor</li></ul><p>\u8FD9\u4E2A\u53C2\u6570\u6BD4\u8F83\u7B80\u5355\uFF0C\u5B83\u8868\u793A kafka\u4FDD\u5B58\u6D88\u606F\u7684\u526F\u672C\u6570\u3002</p><ul><li>log.retention.ms</li></ul><p>Kafka \u901A\u5E38\u6839\u636E\u65F6\u95F4\u6765\u51B3\u5B9A\u6570\u636E\u53EF\u4EE5\u4FDD\u7559\u591A\u4E45\u3002</p><p>\u9ED8\u8BA4\u4F7F\u7528<code>log.retention.hours</code>\u53C2\u6570\u6765\u914D\u7F6E\u65F6\u95F4\uFF0C\u9ED8\u8BA4\u662F 168 \u4E2A\u5C0F\u65F6\uFF0C\u4E5F\u5C31\u662F\u4E00\u5468\u3002</p><p>\u9664\u6B64\u4E4B\u5916\uFF0C\u8FD8\u6709\u4E24\u4E2A\u53C2\u6570<code>log.retention.minutes</code> \u548C<code>log.retentiion.ms</code> \u3002</p><p>\u8FD9\u4E09\u4E2A\u53C2\u6570\u4F5C\u7528\u662F\u4E00\u6837\u7684\uFF0C\u90FD\u662F\u51B3\u5B9A\u6D88\u606F\u591A\u4E45\u4EE5\u540E\u88AB\u5220\u9664\uFF0C\u63A8\u8350\u4F7F\u7528<code>log.retention.ms</code>\u3002</p><ul><li>message.max.bytes</li></ul><p>broker \u901A\u8FC7\u8BBE\u7F6E <code>message.max.bytes</code> \u53C2\u6570\u6765\u9650\u5236\u5355\u4E2A\u6D88\u606F\u7684\u5927\u5C0F\uFF0C\u9ED8\u8BA4\u662F 1000 000\uFF0C \u4E5F\u5C31\u662F 1MB\uFF0C\u5982\u679C\u751F\u4EA7\u8005\u5C1D\u8BD5\u53D1\u9001\u7684\u6D88\u606F\u8D85\u8FC7\u8FD9\u4E2A\u5927\u5C0F\uFF0C\u4E0D\u4EC5\u6D88\u606F\u4E0D\u4F1A\u88AB\u63A5\u6536\uFF0C\u8FD8\u4F1A\u6536\u5230 broker \u8FD4\u56DE\u7684\u9519\u8BEF\u6D88\u606F\u3002</p><ul><li>retention.ms</li></ul><p>\u89C4\u5B9A\u4E86\u8BE5\u4E3B\u9898\u6D88\u606F\u88AB\u4FDD\u5B58\u7684\u65F6\u5E38\uFF0C\u9ED8\u8BA4\u662F7\u5929\uFF0C\u5373\u8BE5\u4E3B\u9898\u53EA\u80FD\u4FDD\u5B587\u5929\u7684\u6D88\u606F\uFF0C\u4E00\u65E6\u8BBE\u7F6E\u4E86\u8FD9\u4E2A\u503C\uFF0C\u5B83\u4F1A\u8986\u76D6\u6389 Broker \u7AEF\u7684\u5168\u5C40\u53C2\u6570\u503C\u3002</p><h2 id="\u6D88\u606F\u4E22\u5931\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#\u6D88\u606F\u4E22\u5931\u95EE\u9898" aria-hidden="true">#</a> \u6D88\u606F\u4E22\u5931\u95EE\u9898</h2><p><strong>\u300C\u751F\u4EA7\u8005\u7A0B\u5E8F\u4E22\u5931\u6570\u636E\u300D</strong></p><p>\u76EE\u524DKafka Producer\u662F\u5F02\u6B65\u53D1\u9001\u6D88\u606F\u7684\uFF0C\u4E5F\u5C31\u662F\u8BF4\u5982\u679C\u4F60\u8C03\u7528\u7684\u662F<code>producer.send(msg)</code>\u8FD9\u4E2AAPI\uFF0C\u90A3\u4E48\u5B83\u901A\u5E38\u4F1A\u7ACB\u5373\u8FD4\u56DE\uFF0C\u4F46\u6B64\u65F6\u4F60\u4E0D\u80FD\u8BA4\u4E3A\u6D88\u606F\u53D1\u9001\u5DF2\u6210\u529F\u5B8C\u6210\u3002</p><p>\u5982\u679C\u7528\u8FD9\u4E2A\u65B9\u5F0F\uFF0C\u53EF\u80FD\u4F1A\u6709\u54EA\u4E9B\u56E0\u7D20\u5BFC\u81F4\u6D88\u606F\u6CA1\u6709\u53D1\u9001\u6210\u529F\u5462\uFF1F</p><p>\u5176\u5B9E\u539F\u56E0\u6709\u5F88\u591A\uFF0C\u4F8B\u5982\u7F51\u7EDC\u6296\u52A8\uFF0C\u5BFC\u81F4\u6D88\u606F\u538B\u6839\u5C31\u6CA1\u6709\u53D1\u9001\u5230Broker\u7AEF\uFF1B\u6216\u8005\u6D88\u606F\u672C\u8EAB\u4E0D\u5408\u683C\u5BFC\u81F4Broker\u62D2\u7EDD\u63A5\u6536\uFF08\u6BD4\u5982\u6D88\u606F\u592A\u5927\u4E86\uFF0C\u8D85\u8FC7\u4E86Broker\u7684\u627F\u53D7\u80FD\u529B\uFF09\u7B49\u3002</p><p>\u5B9E\u9645\u4E0A\uFF0C\u89E3\u51B3\u6B64\u95EE\u9898\u7684\u65B9\u6CD5\u975E\u5E38\u7B80\u5355\uFF1AProducer\u6C38\u8FDC\u8981\u4F7F\u7528\u5E26\u6709\u56DE\u8C03\u901A\u77E5\u7684\u53D1\u9001API\uFF0C\u4E5F\u5C31\u662F\u8BF4\u4E0D\u8981\u4F7F\u7528<code>producer.send(msg)</code>\uFF0C\u800C\u8981\u4F7F\u7528<code>producer.send(msg, callback)</code>\u3002</p><p>\u5B83\u80FD\u51C6\u786E\u5730\u544A\u8BC9\u4F60\u6D88\u606F\u662F\u5426\u771F\u7684\u63D0\u4EA4\u6210\u529F\u4E86\u3002</p><p>\u4E00\u65E6\u51FA\u73B0\u6D88\u606F\u63D0\u4EA4\u5931\u8D25\u7684\u60C5\u51B5\uFF0C\u4F60\u5C31\u53EF\u4EE5\u6709\u9488\u5BF9\u6027\u5730\u8FDB\u884C\u5904\u7406\u3002</p><p><strong>\u300C\u6D88\u8D39\u8005\u7A0B\u5E8F\u4E22\u5931\u6570\u636E\u300D</strong></p><p>Consumer\u7AEF\u4E22\u5931\u6570\u636E\u4E3B\u8981\u4F53\u73B0\u5728Consumer\u7AEF\u8981\u6D88\u8D39\u7684\u6D88\u606F\u4E0D\u89C1\u4E86\u3002</p><p>\u4E0B\u9762\u8FD9\u5F20\u56FE\u5B83\u6E05\u6670\u5730\u5C55\u793A\u4E86Consumer\u7AEF\u7684\u4F4D\u79FB\u6570\u636E\u3002</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-kafkahxzszj-f8302e6a-9a80-47d8-8946-ac29343bb2af.jpg" alt=""></p><p>\u6BD4\u5982\u5BF9\u4E8EConsumer A\u800C\u8A00\uFF0C\u5B83\u5F53\u524D\u7684\u4F4D\u79FB\u503C\u5C31\u662F9\uFF1BConsumer B\u7684\u4F4D\u79FB\u503C\u662F11\u3002</p><p>Consumer\u7A0B\u5E8F\u4ECEKafka\u83B7\u53D6\u5230\u6D88\u606F\u540E\u5F00\u542F\u4E86\u591A\u4E2A\u7EBF\u7A0B\u5F02\u6B65\u5904\u7406\u6D88\u606F\uFF0C\u800CConsumer\u7A0B\u5E8F\u81EA\u52A8\u5730\u5411\u524D\u66F4\u65B0\u4F4D\u79FB\u3002</p><p>\u5047\u5982\u5176\u4E2D\u67D0\u4E2A\u7EBF\u7A0B\u8FD0\u884C\u5931\u8D25\u4E86\uFF0C\u5B83\u8D1F\u8D23\u7684\u6D88\u606F\u6CA1\u6709\u88AB\u6210\u529F\u5904\u7406\uFF0C\u4F46\u4F4D\u79FB\u5DF2\u7ECF\u88AB\u66F4\u65B0\u4E86\uFF0C\u56E0\u6B64\u8FD9\u6761\u6D88\u606F\u5BF9\u4E8EConsumer\u800C\u8A00\u5B9E\u9645\u4E0A\u662F\u4E22\u5931\u4E86\u3002</p><p>\u8FD9\u91CC\u7684\u5173\u952E\u5728\u4E8EConsumer\u81EA\u52A8\u63D0\u4EA4\u4F4D\u79FB\u3002</p><p>\u8FD9\u4E2A\u95EE\u9898\u7684\u89E3\u51B3\u65B9\u6848\u4E5F\u5F88\u7B80\u5355\uFF1A</p><p><strong>\u300C\u5982\u679C\u662F\u591A\u7EBF\u7A0B\u5F02\u6B65\u5904\u7406\u6D88\u8D39\u6D88\u606F\uFF0CConsumer\u7A0B\u5E8F\u4E0D\u8981\u5F00\u542F\u81EA\u52A8\u63D0\u4EA4\u4F4D\u79FB\uFF0C\u800C\u662F\u8981\u5E94\u7528\u7A0B\u5E8F\u624B\u52A8\u63D0\u4EA4\u4F4D\u79FB\u300D</strong>\u3002</p><h3 id="\u6700\u4F73\u5B9E\u8DF5" tabindex="-1"><a class="header-anchor" href="#\u6700\u4F73\u5B9E\u8DF5" aria-hidden="true">#</a> \u6700\u4F73\u5B9E\u8DF5</h3><p>\u603B\u7ED3Kafka\u65E0\u6D88\u606F\u4E22\u5931\u7684\u914D\u7F6E\uFF1A</p><ol><li>\u4E0D\u8981\u4F7F\u7528<code>producer.send(msg)</code>\uFF0C\u800C\u8981\u4F7F\u7528<code>producer.send(msg, callback)</code>\uFF0C\u4E00\u5B9A\u8981\u4F7F\u7528\u5E26\u6709\u56DE\u8C03\u901A\u77E5\u7684send\u65B9\u6CD5\u3002</li><li>\u8BBE\u7F6E<code>acks = all</code>\uFF0Cacks\u662FProducer\u7684\u4E00\u4E2A\u53C2\u6570\uFF0C\u4EE3\u8868\u4E86\u4F60\u5BF9\u5DF2\u63D0\u4EA4\u6D88\u606F\u7684\u5B9A\u4E49\uFF0C\u5982\u679C\u8BBE\u7F6E\u6210all\uFF0C\u5219\u8868\u660E\u6240\u6709\u526F\u672CBroker\u90FD\u8981\u63A5\u6536\u5230\u6D88\u606F\uFF0C\u8BE5\u6D88\u606F\u624D\u7B97\u662F\u5DF2\u63D0\u4EA4\u3002</li><li>\u8BBE\u7F6Eretries\u4E3A\u4E00\u4E2A\u8F83\u5927\u7684\u503C\u3002\u8FD9\u91CC\u7684retries\u540C\u6837\u662FProducer\u7684\u53C2\u6570\uFF0C\u5BF9\u5E94\u524D\u9762\u63D0\u5230\u7684Producer\u81EA\u52A8\u91CD\u8BD5\uFF0C\u5F53\u51FA\u73B0\u7F51\u7EDC\u7684\u77AC\u65F6\u6296\u52A8\u65F6\uFF0C\u6D88\u606F\u53D1\u9001\u53EF\u80FD\u4F1A\u5931\u8D25\uFF0C\u6B64\u65F6\u914D\u7F6E\u4E86<code>retries &gt; 0</code>\u7684Producer\u80FD\u591F\u81EA\u52A8\u91CD\u8BD5\u6D88\u606F\u53D1\u9001\uFF0C\u907F\u514D\u6D88\u606F\u4E22\u5931\u3002</li><li>\u8BBE\u7F6E<code>unclean.leader.election.enable = false</code>\uFF0C\u8FD9\u662FBroker\u7AEF\u7684\u53C2\u6570\uFF0C\u5B83\u63A7\u5236\u7684\u662F\u54EA\u4E9BBroker\u6709\u8D44\u683C\u7ADE\u9009\u5206\u533A\u7684Leader\uFF0C\u5982\u679C\u4E00\u4E2ABroker\u843D\u540E\u539F\u5148\u7684Leader\u592A\u591A\uFF0C\u90A3\u4E48\u5B83\u4E00\u65E6\u6210\u4E3A\u65B0\u7684Leader\uFF0C\u5FC5\u7136\u4F1A\u9020\u6210\u6D88\u606F\u7684\u4E22\u5931\uFF0C\u6545\u4E00\u822C\u90FD\u8981\u5C06\u8BE5\u53C2\u6570\u8BBE\u7F6E\u6210false\uFF0C\u5373\u4E0D\u5141\u8BB8\u8FD9\u79CD\u60C5\u51B5\u7684\u53D1\u751F\u3002</li><li>\u8BBE\u7F6E<code>replication.factor &gt;= 3</code>\uFF0C\u8FD9\u4E5F\u662FBroker\u7AEF\u7684\u53C2\u6570\uFF0C\u5C06\u6D88\u606F\u591A\u4FDD\u5B58\u51E0\u4EFD\uFF0C\u76EE\u524D\u9632\u6B62\u6D88\u606F\u4E22\u5931\u7684\u4E3B\u8981\u673A\u5236\u5C31\u662F\u5197\u4F59\u3002</li><li>\u8BBE\u7F6E<code>min.insync.replicas &gt; 1</code>\uFF0C\u8FD9\u4F9D\u7136\u662FBroker\u7AEF\u53C2\u6570\uFF0C\u63A7\u5236\u7684\u662F\u6D88\u606F\u81F3\u5C11\u8981\u88AB\u5199\u5165\u5230\u591A\u5C11\u4E2A\u526F\u672C\u624D\u7B97\u662F\u5DF2\u63D0\u4EA4\uFF0C\u8BBE\u7F6E\u6210\u5927\u4E8E1\u53EF\u4EE5\u63D0\u5347\u6D88\u606F\u6301\u4E45\u6027\uFF0C\u5728\u5B9E\u9645\u73AF\u5883\u4E2D\u5343\u4E07\u4E0D\u8981\u4F7F\u7528\u9ED8\u8BA4\u503C1\u3002</li><li>\u786E\u4FDD<code>replication.factor &gt; min.insync.replicas</code>\uFF0C\u5982\u679C\u4E24\u8005\u76F8\u7B49\uFF0C\u90A3\u4E48\u53EA\u8981\u6709\u4E00\u4E2A\u526F\u672C\u6302\u673A\uFF0C\u6574\u4E2A\u5206\u533A\u5C31\u65E0\u6CD5\u6B63\u5E38\u5DE5\u4F5C\u4E86\uFF0C\u6211\u4EEC\u4E0D\u4EC5\u8981\u6539\u5584\u6D88\u606F\u7684\u6301\u4E45\u6027\uFF0C\u9632\u6B62\u6570\u636E\u4E22\u5931\uFF0C\u8FD8\u8981\u5728\u4E0D\u964D\u4F4E\u53EF\u7528\u6027\u7684\u57FA\u7840\u4E0A\u5B8C\u6210\uFF0C\u63A8\u8350\u8BBE\u7F6E\u6210<code>replication.factor = min.insync.replicas + 1</code>\u3002</li><li>\u786E\u4FDD\u6D88\u606F\u6D88\u8D39\u5B8C\u6210\u518D\u63D0\u4EA4\uFF0CConsumer\u7AEF\u6709\u4E2A\u53C2\u6570<code>enable.auto.commit</code>\uFF0C\u6700\u597D\u628A\u5B83\u8BBE\u7F6E\u6210false\uFF0C\u5E76\u91C7\u7528\u624B\u52A8\u63D0\u4EA4\u4F4D\u79FB\u7684\u65B9\u5F0F\u3002</li></ol><h2 id="\u91CD\u590D\u6D88\u8D39\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#\u91CD\u590D\u6D88\u8D39\u95EE\u9898" aria-hidden="true">#</a> \u91CD\u590D\u6D88\u8D39\u95EE\u9898</h2><p><strong>\u300C\u6D88\u8D39\u91CD\u590D\u7684\u573A\u666F\u300D</strong></p><p>\u5728<code>enable.auto.commit</code> \u9ED8\u8BA4\u503Ctrue\u60C5\u51B5\u4E0B\uFF0C\u51FA\u73B0\u91CD\u590D\u6D88\u8D39\u7684\u573A\u666F\u6709\u4EE5\u4E0B\u51E0\u79CD\uFF1A</p><blockquote><p>\u275D</p><p>consumer \u5728\u6D88\u8D39\u8FC7\u7A0B\u4E2D\uFF0C\u5E94\u7528\u8FDB\u7A0B\u88AB\u5F3A\u5236kill\u6389\u6216\u53D1\u751F\u5F02\u5E38\u9000\u51FA\u3002</p><p>\u275E</p></blockquote><p>\u4F8B\u5982\u5728\u4E00\u6B21poll 500\u6761\u6D88\u606F\u540E\uFF0C\u6D88\u8D39\u5230200\u6761\u65F6\uFF0C\u8FDB\u7A0B\u88AB\u5F3A\u5236kill\u6D88\u8D39\u5230offset\u672A\u63D0\u4EA4\uFF0C\u6216\u51FA\u73B0\u5F02\u5E38\u9000\u51FA\u5BFC\u81F4\u6D88\u8D39\u5230offset\u672A\u63D0\u4EA4\u3002</p><p>\u4E0B\u6B21\u91CD\u542F\u65F6\uFF0C\u4F9D\u7136\u4F1A\u91CD\u65B0\u62C9\u53D6500\u6D88\u606F\uFF0C\u9020\u6210\u4E4B\u524D\u6D88\u8D39\u5230200\u6761\u6D88\u606F\u91CD\u590D\u6D88\u8D39\u4E86\u4E24\u6B21\u3002</p><p>\u89E3\u51B3\u65B9\u6848\uFF1A\u5728\u53D1\u751F\u5F02\u5E38\u65F6\u6B63\u786E\u5904\u7406\u672A\u63D0\u4EA4\u7684offset</p><p><strong>\u300C\u6D88\u8D39\u8005\u6D88\u8D39\u65F6\u95F4\u8FC7\u957F\u300D</strong></p><p><code>max.poll.interval.ms</code>\u53C2\u6570\u5B9A\u4E49\u4E86\u4E24\u6B21poll\u7684\u6700\u5927\u95F4\u9694\uFF0C\u5B83\u7684\u9ED8\u8BA4\u503C\u662F 5 \u5206\u949F\uFF0C\u8868\u793A\u4F60\u7684 Consumer \u7A0B\u5E8F\u5982\u679C\u5728 5 \u5206\u949F\u4E4B\u5185\u65E0\u6CD5\u6D88\u8D39\u5B8C poll \u65B9\u6CD5\u8FD4\u56DE\u7684\u6D88\u606F\uFF0C\u90A3\u4E48 Consumer \u4F1A\u4E3B\u52A8\u53D1\u8D77\u79BB\u5F00\u7EC4\u7684\u8BF7\u6C42\uFF0CCoordinator \u4E5F\u4F1A\u5F00\u542F\u65B0\u4E00\u8F6E Rebalance\u3002</p><p>\u4E3E\u4F8B\uFF1A\u5355\u6B21\u62C9\u53D611\u6761\u6D88\u606F\uFF0C\u6BCF\u6761\u6D88\u606F\u8017\u65F630s\uFF0C11\u6761\u6D88\u606F\u8017\u65F65\u5206\u949F30\u79D2\uFF0C\u7531\u4E8E<code>max.poll.interval.ms</code> \u9ED8\u8BA4\u503C5\u5206\u949F\uFF0C\u6240\u4EE5\u6D88\u8D39\u8005\u65E0\u6CD5\u57285\u5206\u949F\u5185\u6D88\u8D39\u5B8C\uFF0Cconsumer\u4F1A\u79BB\u5F00\u7EC4\uFF0C\u5BFC\u81F4rebalance\u3002</p><p>\u5728\u6D88\u8D39\u5B8C11\u6761\u6D88\u606F\u540E\uFF0Cconsumer\u4F1A\u91CD\u65B0\u8FDE\u63A5broker\uFF0C\u518D\u6B21rebalance\uFF0C\u56E0\u4E3A\u4E0A\u6B21\u6D88\u8D39\u7684offset\u672A\u63D0\u4EA4\uFF0C\u518D\u6B21\u62C9\u53D6\u7684\u6D88\u606F\u662F\u4E4B\u524D\u6D88\u8D39\u8FC7\u7684\u6D88\u606F\uFF0C\u9020\u6210\u91CD\u590D\u6D88\u8D39\u3002</p><p><strong>\u300C\u89E3\u51B3\u65B9\u6848\uFF1A\u300D</strong></p><p>1\u3001\u63D0\u9AD8\u6D88\u8D39\u80FD\u529B\uFF0C\u63D0\u9AD8\u5355\u6761\u6D88\u606F\u7684\u5904\u7406\u901F\u5EA6\uFF1B\u6839\u636E\u5B9E\u9645\u573A\u666F\u53EF\u8BB2<code>max.poll.interval.ms</code>\u503C\u8BBE\u7F6E\u5927\u4E00\u70B9\uFF0C\u907F\u514D\u4E0D\u5FC5\u8981\u7684rebalance\uFF1B\u53EF\u9002\u5F53\u51CF\u5C0F<code>max.poll.records</code>\u7684\u503C\uFF0C\u9ED8\u8BA4\u503C\u662F500\uFF0C\u53EF\u6839\u636E\u5B9E\u9645\u6D88\u606F\u901F\u7387\u9002\u5F53\u8C03\u5C0F\u3002</p><p>2\u3001\u751F\u6210\u6D88\u606F\u65F6\uFF0C\u53EF\u52A0\u5165\u552F\u4E00\u6807\u8BC6\u7B26\u5982\u6D88\u606Fid\uFF0C\u5728\u6D88\u8D39\u7AEF\uFF0C\u4FDD\u5B58\u6700\u8FD1\u76841000\u6761\u6D88\u606Fid\u5B58\u5165\u5230redis\u6216mysql\u4E2D\uFF0C\u6D88\u8D39\u7684\u6D88\u606F\u65F6\u901A\u8FC7\u524D\u7F6E\u53BB\u91CD\u3002</p><h2 id="\u6D88\u606F\u987A\u5E8F\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#\u6D88\u606F\u987A\u5E8F\u95EE\u9898" aria-hidden="true">#</a> \u6D88\u606F\u987A\u5E8F\u95EE\u9898</h2><p>\u6211\u4EEC\u90FD\u77E5\u9053<code>kafka</code>\u7684<code>topic</code>\u662F\u65E0\u5E8F\u7684\uFF0C\u4F46\u662F\u4E00\u4E2A<code>topic</code>\u5305\u542B\u591A\u4E2A<code>partition</code>\uFF0C\u6BCF\u4E2A<code>partition</code>\u5185\u90E8\u662F\u6709\u5E8F\u7684</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-kafkahxzszj-1d4b9445-6b7f-4cf5-a54c-3c52e371d9a7.jpg" alt=""></p><p><strong>\u300C\u4E71\u5E8F\u573A\u666F1\u300D</strong></p><p>\u56E0\u4E3A\u4E00\u4E2Atopic\u53EF\u4EE5\u6709\u591A\u4E2Apartition\uFF0Ckafka\u53EA\u80FD\u4FDD\u8BC1partition\u5185\u90E8\u6709\u5E8F</p><p><strong>\u300C\u89E3\u51B3\u65B9\u6848\u300D</strong></p><p>1\u3001\u53EF\u4EE5\u8BBE\u7F6Etopic\uFF0C\u6709\u4E14\u53EA\u6709\u4E00\u4E2Apartition</p><p>2\u3001\u6839\u636E\u4E1A\u52A1\u9700\u8981\uFF0C\u9700\u8981\u987A\u5E8F\u7684 \u6307\u5B9A\u4E3A\u540C\u4E00\u4E2Apartition</p><p>3\u3001\u6839\u636E\u4E1A\u52A1\u9700\u8981\uFF0C\u6BD4\u5982\u540C\u4E00\u4E2A\u8BA2\u5355\uFF0C\u4F7F\u7528\u540C\u4E00\u4E2Akey\uFF0C\u53EF\u4EE5\u4FDD\u8BC1\u5206\u914D\u5230\u540C\u4E00\u4E2Apartition\u4E0A</p><p><strong>\u300C\u4E71\u5E8F\u573A\u666F2\u300D</strong></p><p>\u5BF9\u4E8E\u540C\u4E00\u4E1A\u52A1\u8FDB\u5165\u4E86\u540C\u4E00\u4E2A\u6D88\u8D39\u8005\u7EC4\u4E4B\u540E\uFF0C\u7528\u4E86\u591A\u7EBF\u7A0B\u6765\u5904\u7406\u6D88\u606F\uFF0C\u4F1A\u5BFC\u81F4\u6D88\u606F\u7684\u4E71\u5E8F</p><p><strong>\u300C\u89E3\u51B3\u65B9\u6848\u300D</strong></p><p>\u6D88\u8D39\u8005\u5185\u90E8\u6839\u636E\u7EBF\u7A0B\u6570\u91CF\u521B\u5EFA\u7B49\u91CF\u7684\u5185\u5B58\u961F\u5217\uFF0C\u5BF9\u4E8E\u9700\u8981\u987A\u5E8F\u7684\u4E00\u7CFB\u5217\u4E1A\u52A1\u6570\u636E\uFF0C\u6839\u636Ekey\u6216\u8005\u4E1A\u52A1\u6570\u636E\uFF0C\u653E\u5230\u540C\u4E00\u4E2A\u5185\u5B58\u961F\u5217\u4E2D\uFF0C\u7136\u540E\u7EBF\u7A0B\u4ECE\u5BF9\u5E94\u7684\u5185\u5B58\u961F\u5217\u4E2D\u53D6\u51FA\u5E76\u64CD\u4F5C</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-kafkahxzszj-7fb38f3c-b275-4f33-bbc6-c52f2cc29930.jpg" alt=""></p><p><strong>\u300C\u901A\u8FC7\u8BBE\u7F6E\u76F8\u540Ckey\u6765\u4FDD\u8BC1\u6D88\u606F\u6709\u5E8F\u6027\uFF0C\u4F1A\u6709\u4E00\u70B9\u7F3A\u9677\uFF1A\u300D</strong></p><p>\u4F8B\u5982\u6D88\u606F\u53D1\u9001\u8BBE\u7F6E\u4E86\u91CD\u8BD5\u673A\u5236\uFF0C\u5E76\u4E14\u5F02\u6B65\u53D1\u9001\uFF0C\u6D88\u606FA\u548CB\u8BBE\u7F6E\u76F8\u540C\u7684key\uFF0C\u4E1A\u52A1\u4E0AA\u5148\u53D1\uFF0CB\u540E\u53D1\uFF0C\u7531\u4E8E\u7F51\u7EDC\u6216\u8005\u5176\u4ED6\u539F\u56E0A\u53D1\u9001\u5931\u8D25\uFF0CB\u53D1\u9001\u6210\u529F\uFF1BA\u7531\u4E8E\u53D1\u9001\u5931\u8D25\u5C31\u4F1A\u91CD\u8BD5\u4E14\u91CD\u8BD5\u6210\u529F\uFF0C\u8FD9\u65F6\u5019\u6D88\u606F\u987A\u5E8FB\u5728\u524DA\u5728\u540E\uFF0C\u4E0E\u4E1A\u52A1\u53D1\u9001\u987A\u5E8F\u4E0D\u4E00\u81F4\uFF0C\u5982\u679C\u9700\u8981\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\uFF0C\u9700\u8981\u8BBE\u7F6E\u53C2\u6570<code>max.in.flight.requests.per.connection=1</code>\uFF0C\u5176\u542B\u4E49\u662F\u9650\u5236\u5BA2\u6237\u7AEF\u5728\u5355\u4E2A\u8FDE\u63A5\u4E0A\u80FD\u591F\u53D1\u9001\u7684\u672A\u54CD\u5E94\u8BF7\u6C42\u7684\u4E2A\u6570\uFF0C\u8BBE\u7F6E\u6B64\u503C\u662F1\u8868\u793Akafka broker\u5728\u54CD\u5E94\u8BF7\u6C42\u4E4B\u524Dclient\u4E0D\u80FD\u518D\u5411\u540C\u4E00\u4E2Abroker\u53D1\u9001\u8BF7\u6C42\uFF0C\u8FD9\u4E2A\u53C2\u6570\u9ED8\u8BA4\u503C\u662F5</p><blockquote><p>\u275D</p><p>\u5B98\u65B9\u6587\u6863\u8BF4\u660E\uFF0C\u8FD9\u4E2A\u53C2\u6570\u5982\u679C\u5927\u4E8E1\uFF0C\u7531\u4E8E\u91CD\u8BD5\u6D88\u606F\u987A\u5E8F\u53EF\u80FD\u91CD\u6392</p><p>\u275E</p></blockquote><h2 id="\u9AD8\u6027\u80FD\u539F\u56E0" tabindex="-1"><a class="header-anchor" href="#\u9AD8\u6027\u80FD\u539F\u56E0" aria-hidden="true">#</a> \u9AD8\u6027\u80FD\u539F\u56E0</h2><p><strong>\u300C\u987A\u5E8F\u8BFB\u5199\u300D</strong></p><p>kafka\u7684\u6D88\u606F\u662F\u4E0D\u65AD\u8FFD\u52A0\u5230\u6587\u4EF6\u4E2D\u7684\uFF0C\u8FD9\u4E2A\u7279\u6027\u4F7F<code>kafka</code>\u53EF\u4EE5\u5145\u5206\u5229\u7528\u78C1\u76D8\u7684\u987A\u5E8F\u8BFB\u5199\u6027\u80FD</p><p>\u987A\u5E8F\u8BFB\u5199\u4E0D\u9700\u8981\u786C\u76D8\u78C1\u5934\u7684\u5BFB\u9053\u65F6\u95F4\uFF0C\u53EA\u9700\u5F88\u5C11\u7684\u6247\u533A\u65CB\u8F6C\u65F6\u95F4\uFF0C\u6240\u4EE5\u901F\u5EA6\u8FDC\u5FEB\u4E8E\u968F\u673A\u8BFB\u5199</p><p>Kafka \u53EF\u4EE5\u914D\u7F6E\u5F02\u6B65\u5237\u76D8\uFF0C\u4E0D\u5F00\u542F\u540C\u6B65\u5237\u76D8\uFF0C\u5F02\u6B65\u5237\u76D8\u4E0D\u9700\u8981\u7B49\u5199\u5165\u78C1\u76D8\u540E\u8FD4\u56DE\u6D88\u606F\u6295\u9012\u7684 ACK\uFF0C\u6240\u4EE5\u5B83\u63D0\u9AD8\u4E86\u6D88\u606F\u53D1\u9001\u7684\u541E\u5410\u91CF\uFF0C\u964D\u4F4E\u4E86\u8BF7\u6C42\u7684\u5EF6\u65F6</p><p><strong>\u300C\u96F6\u62F7\u8D1D\u300D</strong></p><p>\u4F20\u7EDF\u7684 IO \u6D41\u7A0B\uFF0C\u9700\u8981\u5148\u628A\u6570\u636E\u62F7\u8D1D\u5230\u5185\u6838\u7F13\u51B2\u533A\uFF0C\u518D\u4ECE\u5185\u6838\u7F13\u51B2\u62F7\u8D1D\u5230\u7528\u6237\u7A7A\u95F4\uFF0C\u5E94\u7528\u7A0B\u5E8F\u5904\u7406\u5B8C\u6210\u4EE5\u540E\uFF0C\u518D\u62F7\u8D1D\u56DE\u5185\u6838\u7F13\u51B2\u533A</p><p>\u8FD9\u4E2A\u8FC7\u7A0B\u4E2D\u53D1\u751F\u4E86\u591A\u6B21\u6570\u636E\u62F7\u8D1D</p><p>\u4E3A\u4E86\u51CF\u5C11\u4E0D\u5FC5\u8981\u7684\u62F7\u8D1D\uFF0C<code>Kafka</code> \u4F9D\u8D56 Linux \u5185\u6838\u63D0\u4F9B\u7684 <code>Sendfile</code> \u7CFB\u7EDF\u8C03\u7528</p><p>\u5728 Sendfile \u65B9\u6CD5\u4E2D\uFF0C\u6570\u636E\u5728\u5185\u6838\u7F13\u51B2\u533A\u5B8C\u6210\u8F93\u5165\u548C\u8F93\u51FA\uFF0C\u4E0D\u9700\u8981\u62F7\u8D1D\u5230\u7528\u6237\u7A7A\u95F4\u5904\u7406\uFF0C\u8FD9\u4E5F\u5C31\u907F\u514D\u4E86\u91CD\u590D\u7684\u6570\u636E\u62F7\u8D1D</p><p>\u5728\u5177\u4F53\u7684\u64CD\u4F5C\u4E2D\uFF0CKafka \u628A\u6240\u6709\u7684\u6D88\u606F\u90FD\u5B58\u653E\u5728\u5355\u72EC\u7684\u6587\u4EF6\u91CC\uFF0C\u5728\u6D88\u606F\u6295\u9012\u65F6\u76F4\u63A5\u901A\u8FC7 <code>Sendfile</code> \u65B9\u6CD5\u53D1\u9001\u6587\u4EF6\uFF0C\u51CF\u5C11\u4E86\u4E0A\u4E0B\u6587\u5207\u6362\uFF0C\u56E0\u6B64\u5927\u5927\u63D0\u9AD8\u4E86\u6027\u80FD</p><p><strong>\u300CMMAP\u6280\u672F\u300D</strong></p><p>\u9664\u4E86 <code>Sendfile</code> \u4E4B\u5916\uFF0C\u8FD8\u6709\u4E00\u79CD\u96F6\u62F7\u8D1D\u7684\u5B9E\u73B0\u6280\u672F\uFF0C\u5373 Memory Mapped Files</p><p>Kafka \u4F7F\u7528 <code>Memory Mapped Files</code> \u5B8C\u6210\u5185\u5B58\u6620\u5C04\uFF0C<code>Memory Mapped Files</code> \u5BF9\u6587\u4EF6\u7684\u64CD\u4F5C\u4E0D\u662F <code>write/read</code>\uFF0C\u800C\u662F\u76F4\u63A5\u5BF9\u5185\u5B58\u5730\u5740\u7684\u64CD\u4F5C\uFF0C\u5982\u679C\u662F\u8C03\u7528\u6587\u4EF6\u7684 <code>read</code> \u64CD\u4F5C\uFF0C\u5219\u628A\u6570\u636E\u5148\u8BFB\u53D6\u5230\u5185\u6838\u7A7A\u95F4\u4E2D\uFF0C\u7136\u540E\u518D\u590D\u5236\u5230\u7528\u6237\u7A7A\u95F4\uFF0C\u4F46 <code>MMAP</code>\u53EF\u4EE5\u5C06\u6587\u4EF6\u76F4\u63A5\u6620\u5C04\u5230\u7528\u6237\u6001\u7684\u5185\u5B58\u7A7A\u95F4\uFF0C\u7701\u53BB\u4E86\u7528\u6237\u7A7A\u95F4\u5230\u5185\u6838\u7A7A\u95F4\u590D\u5236\u7684\u5F00\u9500</p><p>Producer\u751F\u4EA7\u7684\u6570\u636E\u6301\u4E45\u5316\u5230broker\uFF0C\u91C7\u7528mmap\u6587\u4EF6\u6620\u5C04\uFF0C\u5B9E\u73B0\u987A\u5E8F\u7684\u5FEB\u901F\u5199\u5165</p><p>Customer\u4ECEbroker\u8BFB\u53D6\u6570\u636E\uFF0C\u91C7\u7528sendfile\uFF0C\u5C06\u78C1\u76D8\u6587\u4EF6\u8BFB\u5230OS\u5185\u6838\u7F13\u51B2\u533A\u540E\uFF0C\u76F4\u63A5\u8F6C\u5230socket buffer\u8FDB\u884C\u7F51\u7EDC\u53D1\u9001\u3002</p><p><strong>\u300C\u6279\u91CF\u53D1\u9001\u8BFB\u53D6\u300D</strong></p><p>Kafka \u7684\u6279\u91CF\u5305\u62EC\u6279\u91CF\u5199\u5165\u3001\u6279\u91CF\u53D1\u5E03\u7B49\u3002\u5B83\u5728\u6D88\u606F\u6295\u9012\u65F6\u4F1A\u5C06\u6D88\u606F\u7F13\u5B58\u8D77\u6765\uFF0C\u7136\u540E\u6279\u91CF\u53D1\u9001</p><p>\u540C\u6837\uFF0C\u6D88\u8D39\u7AEF\u5728\u6D88\u8D39\u6D88\u606F\u65F6\uFF0C\u4E5F\u4E0D\u662F\u4E00\u6761\u4E00\u6761\u5904\u7406\u7684\uFF0C\u800C\u662F\u6279\u91CF\u8FDB\u884C\u62C9\u53D6\uFF0C\u63D0\u9AD8\u4E86\u6D88\u606F\u7684\u5904\u7406\u901F\u5EA6</p><p><strong>\u300C\u6570\u636E\u538B\u7F29\u300D</strong></p><p>Kafka\u8FD8\u652F\u6301\u5BF9\u6D88\u606F\u96C6\u5408\u8FDB\u884C\u538B\u7F29\uFF0C<code>Producer</code>\u53EF\u4EE5\u901A\u8FC7<code>GZIP</code>\u6216<code>Snappy</code>\u683C\u5F0F\u5BF9\u6D88\u606F\u96C6\u5408\u8FDB\u884C\u538B\u7F29</p><p>\u538B\u7F29\u7684\u597D\u5904\u5C31\u662F\u51CF\u5C11\u4F20\u8F93\u7684\u6570\u636E\u91CF\uFF0C\u51CF\u8F7B\u5BF9\u7F51\u7EDC\u4F20\u8F93\u7684\u538B\u529B</p><p>Producer\u538B\u7F29\u4E4B\u540E\uFF0C\u5728<code>Consumer</code>\u9700\u8FDB\u884C\u89E3\u538B\uFF0C\u867D\u7136\u589E\u52A0\u4E86CPU\u7684\u5DE5\u4F5C\uFF0C\u4F46\u5728\u5BF9\u5927\u6570\u636E\u5904\u7406\u4E0A\uFF0C\u74F6\u9888\u5728\u7F51\u7EDC\u4E0A\u800C\u4E0D\u662FCPU\uFF0C\u6240\u4EE5\u8FD9\u4E2A\u6210\u672C\u5F88\u503C\u5F97</p><p><strong>\u300C\u5206\u533A\u673A\u5236\u300D</strong></p><p>kafka\u4E2D\u7684topic\u4E2D\u7684\u5185\u5BB9\u53EF\u4EE5\u88AB\u5206\u4E3A\u591Apartition\u5B58\u5728\uFF0C\u6BCF\u4E2Apartition\u53C8\u5206\u4E3A\u591A\u4E2A\u6BB5segment\uFF0C\u6240\u4EE5\u6BCF\u6B21\u64CD\u4F5C\u90FD\u662F\u9488\u5BF9\u4E00\u5C0F\u90E8\u5206\u505A\u64CD\u4F5C\uFF0C\u5F88\u8F7B\u4FBF\uFF0C\u5E76\u4E14\u589E\u52A0<code>\u5E76\u884C\u64CD\u4F5C</code>\u7684\u80FD\u529B</p><h2 id="\u5E38\u89C1\u9762\u8BD5\u9898" tabindex="-1"><a class="header-anchor" href="#\u5E38\u89C1\u9762\u8BD5\u9898" aria-hidden="true">#</a> \u5E38\u89C1\u9762\u8BD5\u9898</h2><p><strong>\u300CKafka\u662FPush\u8FD8\u662FPull\u6A21\u5F0F\uFF1F\u300D</strong></p><p>Kafka\u6700\u521D\u8003\u8651\u7684\u95EE\u9898\u662F\uFF0Ccustomer\u5E94\u8BE5\u4ECEbrokes\u62C9\u53D6\u6D88\u606F\u8FD8\u662Fbrokers\u5C06\u6D88\u606F\u63A8\u9001\u5230consumer\u3002</p><p>\u5728\u8FD9\u65B9\u9762\uFF0CKafka\u9075\u5FAA\u4E86\u4E00\u79CD\u5927\u90E8\u5206\u6D88\u606F\u7CFB\u7EDF\u5171\u540C\u7684\u4F20\u7EDF\u7684\u8BBE\u8BA1\uFF1Aproducer\u5C06\u6D88\u606F\u63A8\u9001\u5230broker\uFF0Cconsumer\u4ECEbroker\u62C9\u53D6\u6D88\u606F\u3002</p><p>push\u6A21\u5F0F\u7531broker\u51B3\u5B9A\u6D88\u606F\u63A8\u9001\u7684\u901F\u7387\uFF0C\u5BF9\u4E8E\u4E0D\u540C\u6D88\u8D39\u901F\u7387\u7684consumer\u5C31\u4E0D\u592A\u597D\u5904\u7406\u4E86\u3002</p><p>\u6D88\u606F\u7CFB\u7EDF\u90FD\u81F4\u529B\u4E8E\u8BA9consumer\u4EE5\u6700\u5927\u7684\u901F\u7387\u6700\u5FEB\u901F\u7684\u6D88\u8D39\u6D88\u606F\uFF0Cpush\u6A21\u5F0F\u4E0B\uFF0C\u5F53broker\u63A8\u9001\u7684\u901F\u7387\u8FDC\u5927\u4E8Econsumer\u6D88\u8D39\u7684\u901F\u7387\u65F6\uFF0Cconsumer\u6050\u6015\u5C31\u8981\u5D29\u6E83\u4E86\u3002</p><blockquote><p>\u275D</p><p>Kafka\u4E2D\u7684Producer\u548CConsumer\u91C7\u7528\u7684\u662FPush-and-Pull\u6A21\u5F0F\uFF0C\u5373Producer\u5411Broker Push\u6D88\u606F\uFF0CConsumer\u4ECEBroker Pull\u6D88\u606F\u3002</p><p>\u275E</p></blockquote><p>Pull\u6A21\u5F0F\u7684\u4E00\u4E2A\u597D\u5904\u662Fconsumer\u53EF\u4EE5\u81EA\u4E3B\u51B3\u5B9A\u662F\u5426\u6279\u91CF\u7684\u4ECEbroker\u62C9\u53D6\u6570\u636E\u3002</p><p>Pull\u6709\u4E2A\u7F3A\u70B9\u662F\uFF0C\u5982\u679Cbroker\u6CA1\u6709\u53EF\u4F9B\u6D88\u8D39\u7684\u6D88\u606F\uFF0C\u5C06\u5BFC\u81F4consumer\u4E0D\u65AD\u5728\u5FAA\u73AF\u4E2D\u8F6E\u8BE2\uFF0C\u76F4\u5230\u65B0\u6D88\u606F\u5230\u8FBE\u3002</p><p><strong>\u300CKafka\u5982\u4F55\u4FDD\u8BC1\u9AD8\u53EF\u7528?\u300D</strong></p>`,620),l={href:"https://mp.weixin.qq.com/s?__biz=MzUyOTg1OTkyMA==&mid=2247484980&idx=1&sn=6e0c7112dd72d0edc284009e7503b2ac&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"},u=o("\u9762\u8BD5\u9898\uFF1AKafka\u5982\u4F55\u4FDD\u8BC1\u9AD8\u53EF\u7528\uFF1F\u6709\u56FE\u6709\u771F\u76F8"),m=a("<p><strong>\u300CKafk\u7684\u4F7F\u7528\u573A\u666F\u300D</strong></p><p>\u4E1A\u754CKafka\u5B9E\u9645\u5E94\u7528\u573A\u666F</p><blockquote><p>\u275D</p><p>\u5F02\u6B65\u901A\u4FE1</p><p>\u275E</p></blockquote><p>\u6D88\u606F\u4E2D\u95F4\u4EF6\u5728\u5F02\u6B65\u901A\u4FE1\u4E2D\u7528\u7684\u6700\u591A\uFF0C\u5F88\u591A\u4E1A\u52A1\u6D41\u7A0B\u4E2D\uFF0C\u5982\u679C\u6240\u6709\u6B65\u9AA4\u90FD\u540C\u6B65\u8FDB\u884C\u53EF\u80FD\u4F1A\u5BFC\u81F4\u6838\u5FC3\u6D41\u7A0B\u8017\u65F6\u975E\u5E38\u957F\uFF0C\u66F4\u91CD\u8981\u7684\u662F\u6240\u6709\u6B65\u9AA4\u90FD\u540C\u6B65\u8FDB\u884C\u4E00\u65E6\u975E\u6838\u5FC3\u6B65\u9AA4\u5931\u8D25\u4F1A\u5BFC\u81F4\u6838\u5FC3\u6D41\u7A0B\u6574\u4F53\u5931\u8D25\uFF0C\u56E0\u6B64\u5728\u5F88\u591A\u4E1A\u52A1\u6D41\u7A0B\u4E2DKafka\u5C31\u5145\u5F53\u4E86\u5F02\u6B65\u901A\u4FE1\u89D2\u8272\u3002</p><blockquote><p>\u275D</p><p>\u65E5\u5FD7\u540C\u6B65</p><p>\u275E</p></blockquote><p>\u5927\u89C4\u6A21\u5206\u5E03\u5F0F\u7CFB\u7EDF\u4E2D\u7684\u673A\u5668\u975E\u5E38\u591A\u800C\u4E14\u5206\u6563\u5728\u4E0D\u540C\u673A\u623F\u4E2D\uFF0C\u5206\u5E03\u5F0F\u7CFB\u7EDF\u5E26\u6765\u7684\u4E00\u4E2A\u660E\u663E\u95EE\u9898\u5C31\u662F\u4E1A\u52A1\u65E5\u5FD7\u7684\u67E5\u770B\u3001\u8FFD\u8E2A\u548C\u5206\u6790\u7B49\u884C\u4E3A\u53D8\u5F97\u5341\u5206\u56F0\u96BE\uFF0C\u5BF9\u4E8E\u96C6\u7FA4\u89C4\u6A21\u5728\u767E\u53F0\u4EE5\u4E0A\u7684\u7CFB\u7EDF\uFF0C\u67E5\u8BE2\u7EBF\u4E0A\u65E5\u5FD7\u5F88\u6050\u6016\u3002</p><p>\u4E3A\u4E86\u5E94\u5BF9\u8FD9\u79CD\u573A\u666F\u7EDF\u4E00\u65E5\u5FD7\u7CFB\u7EDF\u5E94\u8FD0\u800C\u751F\uFF0C\u65E5\u5FD7\u6570\u636E\u90FD\u662F\u6D77\u91CF\u6570\u636E\uFF0C\u901A\u5E38\u4E3A\u4E86\u4E0D\u7ED9\u7CFB\u7EDF\u5E26\u6765\u989D\u5916\u8D1F\u62C5\u4E00\u822C\u4F1A\u91C7\u7528\u5F02\u6B65\u4E0A\u62A5\uFF0C\u8FD9\u91CCKafka\u4EE5\u5176\u9AD8\u541E\u5410\u91CF\u5728\u65E5\u5FD7\u5904\u7406\u4E2D\u5F97\u5230\u4E86\u5F88\u597D\u7684\u5E94\u7528\u3002</p><blockquote><p>\u275D</p><p>\u5B9E\u65F6\u8BA1\u7B97</p><p>\u275E</p></blockquote><p>\u968F\u7740\u636E\u91CF\u7684\u589E\u52A0\uFF0C\u79BB\u7EBF\u7684\u8BA1\u7B97\u4F1A\u8D8A\u6765\u8D8A\u6162\uFF0C\u96BE\u4EE5\u6EE1\u8DB3\u7528\u6237\u5728\u67D0\u4E9B\u573A\u666F\u4E0B\u7684\u5B9E\u65F6\u6027\u8981\u6C42\uFF0C\u56E0\u6B64\u5F88\u591A\u89E3\u51B3\u65B9\u6848\u4E2D\u5F15\u5165\u4E86\u5B9E\u65F6\u8BA1\u7B97\u3002</p><p>\u5F88\u591A\u65F6\u5019\uFF0C\u5373\u4F7F\u662F\u6D77\u91CF\u6570\u636E\uFF0C\u6211\u4EEC\u4E5F\u5E0C\u671B\u5373\u65F6\u53BB\u67E5\u770B\u4E00\u4E9B\u6570\u636E\u6307\u6807\uFF0C\u5B9E\u65F6\u6D41\u8BA1\u7B97\u5E94\u8FD0\u800C\u751F\u3002</p><p>\u5B9E\u65F6\u6D41\u8BA1\u7B97\u6709\u4E24\u4E2A\u7279\u70B9\uFF0C\u4E00\u4E2A\u662F\u5B9E\u65F6\uFF0C\u968F\u65F6\u53EF\u4EE5\u770B\u6570\u636E\uFF1B\u53E6\u4E00\u4E2A\u662F\u6D41\u3002</p>",11),k=o("\u8F6C\u8F7D\u94FE\u63A5\uFF1A"),g={href:"https://mp.weixin.qq.com/s?__biz=MzUyOTg1OTkyMA==&mid=2247487063&idx=1&sn=d7c65359630a67695a079d62fce989c0&chksm=fa5bda68cd2c537ed32003d5a98705e85c6b7a47afe0f837cebd27a5f33a8a11231d3eb9c1c5&scene=27#wechat_redirect",target:"_blank",rel:"noopener noreferrer"},f=o("https://mp.weixin.qq.com/s?__biz=MzUyOTg1OTkyMA==&mid=2247487063&idx=1&sn=d7c65359630a67695a079d62fce989c0&chksm=fa5bda68cd2c537ed32003d5a98705e85c6b7a47afe0f837cebd27a5f33a8a11231d3eb9c1c5&scene=27#wechat_redirect"),b=o("\uFF0C\u51FA\u5904\uFF1A\u6708\u4F34\u98DE\u9C7C\uFF0C\u6574\u7406\uFF1A\u6C89\u9ED8\u738B\u4E8C");function h(v,C){const r=t("ExternalLinkIcon");return s(),c("div",null,[i,e("p",null,[e("a",l,[u,p(r)])]),m,e("blockquote",null,[e("p",null,[k,e("a",g,[f,p(r)]),b])])])}var P=n(d,[["render",h],["__file","kafka.html.vue"]]);export{P as default};
