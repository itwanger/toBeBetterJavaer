import{_ as p}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as c,c as i,a as n,d as s,b as t,e}from"./app-72970f25.js";const l={},u=e(`<p>æœ€è¿‘æ­£åœ¨å¼€å‘ä¸€ä¸ªçŸ¥è¯†åº“å­¦ä¹ ç½‘ç«™ç¼–ç¨‹å–µğŸ±ï¼Œéœ€è¦å¯¹è¯·æ±‚å‚æ•°è¿›è¡Œæ ¡éªŒï¼Œæ¯”å¦‚è¯´éç©ºå•Šã€é•¿åº¦é™åˆ¶å•Šç­‰ç­‰ï¼Œå¯é€‰çš„è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š</p><ul><li>ä¸€ç§æ˜¯ç”¨ Hibernate Validator æ¥å¤„ç†</li><li>ä¸€ç§æ˜¯ç”¨å…¨å±€å¼‚å¸¸æ¥å¤„ç†</li></ul><p>ä¸¤ç§æ–¹å¼ï¼Œæˆ‘ä»¬ä¸€ä¸€æ¥å®è·µä½“éªŒä¸€ä¸‹ã€‚</p><h3 id="ä¸€ã€hibernate-validator" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€hibernate-validator" aria-hidden="true">#</a> ä¸€ã€Hibernate Validator</h3><p>Spring Boot å·²ç»å†…ç½®äº† Hibernate Validator æ ¡éªŒæ¡†æ¶ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡ Spring Boot å®˜ç½‘æŸ¥çœ‹å’Œç¡®è®¤ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œè¿›å…¥ Spring Boot å®˜ç½‘ï¼Œç‚¹å‡» learn è¿™ä¸ªé¢æ¿ï¼Œç‚¹å‡»å‚è€ƒæ–‡æ¡£ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/validator-9585b744-a942-425f-b78b-f92f22909c6c.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ç¬¬äºŒæ­¥ï¼Œåœ¨å‚è€ƒæ–‡æ¡£é¡µç‚¹å‡»ã€Œä¾èµ–çš„ç‰ˆæœ¬ã€ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/validator-5b9e4758-27ff-4773-a4b3-809b8dd6546c.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ç¬¬ä¸‰æ­¥ï¼Œåœ¨ä¾èµ–ç‰ˆæœ¬é¡µå°±å¯ä»¥æŸ¥çœ‹åˆ°æ‰€æœ‰çš„ä¾èµ–äº†ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬å·ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/validator-2b0b00c2-fc10-40dc-bfc7-c615bd87f9c9.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>PSï¼šå¦‚æœå‘ç°æ²¡æœ‰èµ·æ•ˆï¼Œå¯èƒ½æ˜¯ä¾èµ–ç‰ˆæœ¬å†²çªäº†ï¼Œæ‰‹åŠ¨æŠŠ Hibernate Validator ä¾èµ–æ·»åŠ åˆ° pom.xml æ–‡ä»¶å°±å¯ä»¥äº†ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.hibernate.validator&lt;/groupId&gt;
    &lt;artifactId&gt;hibernate-validator&lt;/artifactId&gt;
    &lt;version&gt;6.0.17.Final&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;javax.validation&lt;/groupId&gt;
    &lt;artifactId&gt;validation-api&lt;/artifactId&gt;
    &lt;version&gt;2.0.1.Final&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ Hibernate Validator æ ¡éªŒæ¡†æ¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨è¯·æ±‚å‚æ•°çš„å­—æ®µä¸ŠåŠ å…¥æ³¨è§£æ¥å®Œæˆæ ¡éªŒã€‚</p><p><strong>å…·ä½“è¯¥æ€ä¹ˆåšå‘¢</strong>ï¼Ÿ</p><p>ç¬¬ä¸€æ­¥ï¼Œåœ¨éœ€è¦éªŒè¯çš„å­—æ®µä¸ŠåŠ ä¸Š Hibernate Validator æä¾›çš„æ ¡éªŒæ³¨è§£ã€‚</p><p>æ¯”å¦‚è¯´æˆ‘ç°åœ¨æœ‰ä¸€ä¸ªç”¨æˆ·åå’Œå¯†ç ç™»å½•çš„è¯·æ±‚å‚æ•° UsersLoginParam ç±»ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@ApiModel</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;ç”¨æˆ·ç™»å½•&quot;</span><span class="token punctuation">,</span> description<span class="token operator">=</span><span class="token string">&quot;ç”¨æˆ·è¡¨&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UsersLoginParam</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;ç™»å½•å&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message<span class="token operator">=</span><span class="token string">&quot;ç™»å½•åä¸èƒ½ä¸ºç©º&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> userLogin<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;å¯†ç &quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message<span class="token operator">=</span><span class="token string">&quot;å¯†ç ä¸èƒ½ä¸ºç©º&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> userPass<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°±å¯ä»¥é€šè¿‡ <code>@NotBlank</code> æ³¨è§£æ¥å¯¹ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œåˆ¤ç©ºæ ¡éªŒã€‚é™¤äº† <code>@NotBlank</code> æ³¨è§£ï¼ŒHibernate Validator è¿˜æä¾›äº†ä»¥ä¸‹å¸¸ç”¨æ³¨è§£ï¼š</p><ul><li><code>@NotNull</code>ï¼šè¢«æ³¨è§£çš„å­—æ®µä¸èƒ½ä¸º nullï¼›</li><li><code>@NotEmpty</code>ï¼šè¢«æ³¨è§£çš„å­—æ®µä¸èƒ½ä¸ºç©ºï¼›</li><li><code>@Min</code>ï¼šè¢«æ³¨è§£çš„å­—æ®µå¿…é¡»å¤§äºç­‰äºå…¶valueå€¼ï¼›</li><li><code>@Max</code>ï¼šè¢«æ³¨è§£çš„å­—æ®µå¿…é¡»å°äºç­‰äºå…¶valueå€¼ï¼›</li><li><code>@Size</code>ï¼šè¢«æ³¨è§£çš„å­—æ®µå¿…é¡»åœ¨å…¶minå’Œmaxå€¼ä¹‹é—´ï¼›</li><li><code>@Pattern</code>ï¼šè¢«æ³¨è§£çš„å­—æ®µå¿…é¡»ç¬¦åˆæ‰€å®šä¹‰çš„æ­£åˆ™è¡¨è¾¾å¼ï¼›</li><li><code>@Email</code>ï¼šè¢«æ³¨è§£çš„å­—æ®µå¿…é¡»ç¬¦åˆé‚®ç®±æ ¼å¼ã€‚</li></ul><p>ç¬¬äºŒæ­¥ï¼Œåœ¨å¯¹åº”çš„è¯·æ±‚æ¥å£ï¼ˆ<code>UsersController.login()</code>ï¼‰ä¸­æ·»åŠ  <code>@Validated</code> æ³¨è§£ï¼Œå¹¶æ³¨å…¥ä¸€ä¸ª <code>BindingResult</code> å‚æ•°ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>tags<span class="token operator">=</span><span class="token string">&quot;ç”¨æˆ·&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/users&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UsersController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">IUsersService</span> usersService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;ç™»å½•ä»¥åè¿”å›token&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultObject</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Validated</span> <span class="token class-name">UsersLoginParam</span> users<span class="token punctuation">,</span> <span class="token class-name">BindingResult</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> usersService<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>users<span class="token punctuation">.</span><span class="token function">getUserLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> users<span class="token punctuation">.</span><span class="token function">getUserPass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>token <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">ResultObject</span><span class="token punctuation">.</span><span class="token function">validateFailed</span><span class="token punctuation">(</span><span class="token string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> tokenMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tokenMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tokenMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;tokenHead&quot;</span><span class="token punctuation">,</span> tokenHead<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultObject</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>tokenMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬ä¸‰æ­¥ï¼Œä¸ºæ§åˆ¶å±‚ï¼ˆUsersControllerï¼‰åˆ›å»ºä¸€ä¸ªåˆ‡é¢ï¼Œå°†é€šçŸ¥æ³¨å…¥åˆ° BindingResult å¯¹è±¡ä¸­ï¼Œç„¶åå†åˆ¤æ–­æ˜¯å¦æœ‰æ ¡éªŒé”™è¯¯ï¼Œæœ‰é”™è¯¯çš„è¯è¿”å›æ ¡éªŒæç¤ºä¿¡æ¯ï¼Œå¦åˆ™æ”¾è¡Œã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BindingResultAspect</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(public * com.codingmore.controller.*.*(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">BindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;BindingResult()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">doAround</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> arg <span class="token operator">:</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>arg <span class="token keyword">instanceof</span> <span class="token class-name">BindingResult</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">BindingResult</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">BindingResult</span><span class="token punctuation">)</span> arg<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">FieldError</span> fieldError <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getFieldError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>fieldError<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token keyword">return</span> <span class="token class-name">ResultObject</span><span class="token punctuation">.</span><span class="token function">validateFailed</span><span class="token punctuation">(</span>fieldError<span class="token punctuation">.</span><span class="token function">getDefaultMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                        <span class="token keyword">return</span> <span class="token class-name">ResultObject</span><span class="token punctuation">.</span><span class="token function">validateFailed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> joinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,24),r={href:"https://javabetter.cn/springboot/aop-log.html",target:"_blank",rel:"noopener noreferrer"},d=e(`<p>ç¬¬å››æ­¥ï¼Œè®¿é—®ç™»å½•æ¥å£ï¼Œç”¨æˆ·åå’Œå¯†ç éƒ½ä¸ä¼ å…¥çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šè¿”å›â€œç”¨æˆ·åä¸èƒ½ä¸ºç©ºâ€çš„æç¤ºä¿¡æ¯ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/validator-eaf30b98-0a9a-403f-8f2b-a159edc492d6.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>é€šè¿‡ debug çš„å½¢å¼ï¼Œä½“éªŒä¸€ä¸‹æ•´ä¸ªå·¥ä½œæµç¨‹ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/validator-bc9d8ec7-bba6-4306-aaae-b6c66068366a.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å¯ä»¥çœ‹å¾—å‡ºï¼ŒHibernate Validator å¸¦æ¥çš„ä¼˜åŠ¿æœ‰è¿™äº›ï¼š</p><ul><li>éªŒè¯é€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘è¿›è¡Œäº†åˆ†ç¦»ï¼Œé™ä½äº†ç¨‹åºè€¦åˆåº¦ï¼›</li><li>ç»Ÿä¸€ä¸”è§„èŒƒçš„éªŒè¯æ–¹å¼ï¼Œæ— éœ€å†æ¬¡ç¼–å†™é‡å¤çš„éªŒè¯ä»£ç ã€‚</li></ul><p>ä¸è¿‡ï¼Œä¹Ÿå¸¦æ¥ä¸€äº›å¼Šç«¯ï¼Œæ¯”å¦‚è¯´ï¼š</p><ul><li>éœ€è¦åœ¨è¯·æ±‚æ¥å£çš„æ–¹æ³•ä¸­æ³¨å…¥ BindingResult å¯¹è±¡ï¼Œè€Œè¿™ä¸ªå¯¹åº”åœ¨æ–¹æ³•ä½“ä¸­å¹¶æ²¡æœ‰ç”¨åˆ°</li><li>åªèƒ½æ ¡éªŒä¸€äº›éå¸¸ç®€å•çš„é€»è¾‘ï¼Œæ¶‰åŠåˆ°æ•°æ®æŸ¥è¯¢å°±æ— èƒ½ä¸ºåŠ›äº†ã€‚</li></ul><h3 id="äºŒã€å…¨å±€å¼‚å¸¸å¤„ç†" tabindex="-1"><a class="header-anchor" href="#äºŒã€å…¨å±€å¼‚å¸¸å¤„ç†" aria-hidden="true">#</a> äºŒã€å…¨å±€å¼‚å¸¸å¤„ç†</h3><p>ä½¿ç”¨å…¨å±€å¼‚å¸¸å¤„ç†çš„ä¼˜ç‚¹å°±æ˜¯æ¯”è¾ƒçµæ´»ï¼Œå¯ä»¥å¤„ç†æ¯”è¾ƒå¤æ‚çš„é€»è¾‘æ ¡éªŒï¼Œåœ¨æ ¡éªŒå¤±è´¥çš„æ—¶å€™ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œç„¶åè¿›è¡Œæ•è·å¤„ç†å°±å¯ä»¥äº†ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œæ–°å»ºä¸€ä¸ªè‡ªå®šä¹‰å¼‚å¸¸ç±» ApiExceptionã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApiException</span> <span class="token keyword">extends</span> <span class="token class-name">RuntimeException</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">IErrorCode</span> errorCode<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ApiException</span><span class="token punctuation">(</span><span class="token class-name">IErrorCode</span> errorCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>errorCode<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>errorCode <span class="token operator">=</span> errorCode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">ApiException</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">ApiException</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">ApiException</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">IErrorCode</span> <span class="token function">getErrorCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> errorCode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬äºŒæ­¥ï¼Œæ–°å»ºä¸€ä¸ªæ–­è¨€å¤„ç†ç±» Assertsï¼Œç®€åŒ–æŠ›å‡º ApiException çš„æ­¥éª¤ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Asserts</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ApiException</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token class-name">IErrorCode</span> errorCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ApiException</span><span class="token punctuation">(</span>errorCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬ä¸‰æ­¥ï¼Œæ–°å»ºä¸€å…¨å±€å¼‚å¸¸å¤„ç†ç±» GlobalExceptionHandlerï¼Œå¯¹å¼‚å¸¸ä¿¡æ¯è¿›è¡Œè§£æï¼Œå¹¶å°è£…åˆ°ç»Ÿä¸€çš„è¿”å›å¯¹è±¡ ResultObject ä¸­ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalExceptionHandler</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">ApiException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultObject</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">ApiException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getErrorCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">ResultObject</span><span class="token punctuation">.</span><span class="token function">failed</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getErrorCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultObject</span><span class="token punctuation">.</span><span class="token function">failed</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¨å±€å¼‚å¸¸å¤„ç†ç±»ç”¨åˆ°äº†ä¸¤ä¸ªæ³¨è§£ï¼Œ<code>@ControllerAdvice</code> å’Œ <code>@ExceptionHandler</code>ã€‚</p><p><code>@ControllerAdvice</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ <code>@Component</code>ï¼ˆå¯ä»¥é€šè¿‡æºç çœ‹å¾—åˆ°ï¼‰ï¼Œç”¨äºæ ‡è¯†ä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»ä¸­è¢«ä»¥ä¸‹ä¸‰ç§æ³¨è§£æ ‡è¯†çš„æ–¹æ³•ï¼š<code>@ExceptionHandler</code>ï¼Œ<code>@InitBinder</code>ï¼Œ<code>@ModelAttribute</code>ï¼Œå°†ä½œç”¨äºæ‰€æœ‰<code>@Controller</code> ç±»çš„æ¥å£ä¸Šã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">ControllerAdvice</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>@ExceptionHandler</code> æ³¨è§£çš„ä½œç”¨å°±æ˜¯æ ‡è¯†ç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼Œå®ƒå¯ä»¥æŒ‡å®šè¦ç»Ÿä¸€å¤„ç†çš„å¼‚å¸¸ç±»å‹ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬è‡ªå®šä¹‰çš„ ApiExceptionã€‚</p><p>ç¬¬å››æ­¥ï¼Œåœ¨éœ€è¦æ ¡éªŒçš„åœ°æ–¹é€šè¿‡ Asserts ç±»æŠ›å‡ºå¼‚å¸¸ ApiExceptionã€‚è¿˜æ‹¿ç”¨æˆ·ç™»å½•è¿™ä¸ªæ¥å£æ¥è¯´æ˜å§ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>tags<span class="token operator">=</span><span class="token string">&quot;ç”¨æˆ·&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/users&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UsersController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;ç™»å½•ä»¥åè¿”å›token&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultObject</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Validated</span> <span class="token class-name">UsersLoginParam</span> users<span class="token punctuation">,</span> <span class="token class-name">BindingResult</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> usersService<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>users<span class="token punctuation">.</span><span class="token function">getUserLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> users<span class="token punctuation">.</span><span class="token function">getUserPass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> tokenMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tokenMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tokenMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;tokenHead&quot;</span><span class="token punctuation">,</span> tokenHead<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultObject</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>tokenMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯¥æ¥å£éœ€è¦æŸ¥è¯¢æ•°æ®åº“éªŒè¯å¯†ç æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœå¯†ç ä¸æ­£ç¡®å°±æŠ›å‡ºæ ¡éªŒä¿¡æ¯â€œå¯†ç ä¸æ­£ç¡®â€ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UsersServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UsersMapper</span><span class="token punctuation">,</span> <span class="token class-name">Users</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">IUsersService</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">//å¯†ç éœ€è¦å®¢æˆ·ç«¯åŠ å¯†åä¼ é€’</span>
        <span class="token class-name">UserDetails</span> userDetails <span class="token operator">=</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>passwordEncoder<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> userDetails<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Asserts</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">&quot;å¯†ç ä¸æ­£ç¡®&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
        <span class="token comment">// å…¶ä»–ä»£ç çœç•¥</span>
        <span class="token keyword">return</span> token<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬äº”æ­¥ï¼Œé€šè¿‡ ApiPost æ¥æµ‹è¯•ä¸€ä¸‹æ¥å£ï¼Œæ•…æ„æŠŠå¯†ç è¾“é”™ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/validator-1dd4607e-689a-4ddf-814a-d92ac6408fc3.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ä¹Ÿå¯ä»¥é€šè¿‡ debug çš„å½¢å¼ï¼Œä½“éªŒä¸€ä¸‹æ•´ä¸ªå·¥ä½œæµç¨‹ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/validator-8d673f46-6981-4150-b549-29335bf90cf5.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="ä¸‰ã€æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€æ€»ç»“" aria-hidden="true">#</a> ä¸‰ã€æ€»ç»“</h3><p>å®é™…å¼€å‘ä¸­æŠŠä¸¤è€…ç»“åˆåœ¨ä¸€èµ·ç”¨ï¼Œå°±å¯ä»¥å¼¥è¡¥å½¼æ­¤çš„çŸ­æ¿äº†ï¼Œç®€å•æ ¡éªŒç”¨ Hibernate Validatorï¼Œå¤æ‚ä¸€ç‚¹çš„é€»è¾‘æ ¡éªŒï¼Œæ¯”å¦‚è¯´éœ€è¦æ•°æ®åº“æŸ¥è¯¢ç”¨å…¨å±€å¼‚å¸¸å¤„ç†æ¥å®ç°ã€‚</p><p>ä¸ºäº†æŠŠ Spring Boot é€»è¾‘æ ¡éªŒè¿™å—å•ç‹¬æ‹‰å‡ºæ¥åšä¸€ä¸ª demo çš„ä¾‹å­ï¼Œæˆ‘æ–°å»ºäº†ä¸€ä¸ª codingmore-validator çš„é¡¹ç›®ï¼Œæ”¾åœ¨ codingmore-learning é¡¹ç›®ä¸‹é¢äº†ï¼Œæƒ³è¦å‚è€ƒçš„ï¼Œç›´æ¥æˆ³ä¸‹é¢çš„ä¸¤ä¸ªé“¾æ¥ã€‚</p><p>å®Œæ•´çš„ç¼–ç¨‹å–µæ•´ä¸ªé¡¹ç›®çš„æºç æˆ³ç¬¬ä¸€ä¸ªï¼Œåªæƒ³çœ‹é€»è¾‘æ ¡éªŒçš„æˆ³ç¬¬äºŒä¸ªã€‚</p>`,32),k={href:"https://github.com/itwanger/coding-more",target:"_blank",rel:"noopener noreferrer"},v={href:"https://github.com/itwanger/codingmore-learning/tree/main/codingmore-validator",target:"_blank",rel:"noopener noreferrer"},m=n("figure",null,[n("img",{src:"https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/validator-fbd06343-c1ae-4cf6-9b46-bd5c9860b396.png",alt:"",tabindex:"0",loading:"lazy"}),n("figcaption")],-1),b=n("p",null,"æ¯ä¸ªç±»ï¼Œæ¯ä¸ªæ–¹æ³•åŸºæœ¬ä¸Šéƒ½åŠ äº†æ³¨é‡Šï¼Œå¯ä»¥å¾ˆå®¹æ˜“å°±çœ‹å¾—æ‡‚ã€‚",-1),g=n("figure",null,[n("img",{src:"https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png",alt:"",tabindex:"0",loading:"lazy"}),n("figcaption")],-1);function f(y,w){const a=o("ExternalLinkIcon");return c(),i("div",null,[u,n("p",null,[s("è¿™é‡Œæ¶‰åŠåˆ°äº† Spring AOP çš„çŸ¥è¯†ï¼Œæˆ‘åœ¨å‰é¢çš„æ–‡ç« é‡Œè®²è§£è¿‡äº†ï¼Œæˆ³è¿™ä¸ªé“¾æ¥å¯ä»¥ç›´è¾¾ï¼š"),n("a",r,[s("Spring AOP æ‰«ç›²"),t(a)])]),d,n("blockquote",null,[n("ul",null,[n("li",null,[s("ç¼–ç¨‹å–µğŸ±æºç åœ°å€ï¼š"),n("a",k,[s("https://github.com/itwanger/coding-more"),t(a)])]),n("li",null,[s("codingmore-validator: "),n("a",v,[s("https://github.com/itwanger/codingmore-learning/tree/main/codingmore-validator"),t(a)])])])]),m,b,g])}const x=p(l,[["render",f],["__file","validator.html.vue"]]);export{x as default};
