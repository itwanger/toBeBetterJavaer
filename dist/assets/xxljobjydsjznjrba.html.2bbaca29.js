import{_ as l}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as r,c as t,a as e,d as n,b as s,e as d,r as u}from"./app.99eb8281.js";const a={},c=e("hr",null,null,-1),v={href:"https://c1n.cn/N8Mln%E2%80%8D%E2%80%8D%E2%80%8D%E2%80%8D%E2%80%8D%E2%80%8D",target:"_blank",rel:"noopener noreferrer"},o=d(`<p><strong>ç›®å½•</strong></p><ul><li>é€šä¿¡åº•å±‚ä»‹ç»</li><li>é€šä¿¡æ•´ä½“æµç¨‹</li><li>æƒŠè‰³çš„è®¾è®¡</li></ul><p><strong>é€šä¿¡åº•å±‚ä»‹ç»</strong></p><p>xxl-job ä½¿ç”¨ netty http çš„æ–¹å¼è¿›è¡Œé€šä¿¡ï¼Œè™½ç„¶ä¹Ÿæ”¯æŒ Minaï¼Œjettyï¼Œnetty tcp ç­‰æ–¹å¼ï¼Œä½†æ˜¯ä»£ç é‡Œé¢å›ºå®šå†™æ­»çš„æ˜¯ netty httpã€‚</p><p><strong>é€šä¿¡æ•´ä½“æµç¨‹</strong></p><p>æˆ‘ä»¥è°ƒåº¦å™¨é€šçŸ¥æ‰§è¡Œå™¨æ‰§è¡Œä»»åŠ¡ä¸ºä¾‹ï¼Œç»˜åˆ¶çš„æ´»åŠ¨å›¾ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-xxljobjydsjznjrba-27c73954-acc5-4571-b344-7cfaa6c96b7d.jpg" alt="" loading="lazy"></p><p><em>æ´»åŠ¨å›¾</em></p><p><strong>æƒŠè‰³çš„è®¾è®¡</strong></p><p>çœ‹å®Œäº†æ•´ä¸ªå¤„ç†æµç¨‹ä»£ç ï¼Œè®¾è®¡ä¸Šå¯ä»¥è¯´ç‹¬å…·åŒ å¿ƒï¼Œå°† nettyï¼Œå¤šçº¿ç¨‹çš„çŸ¥è¯†è¿ç”¨å¾—è¡Œäº‘æµæ°´ã€‚</p><p>æˆ‘ç°åœ¨å°±å°†è¿™äº›è®¾è®¡ä¸Šå‡ºå½©çš„ç‚¹æ€»ç»“å¦‚ä¸‹ï¼š</p><h4 id="ä½¿ç”¨åŠ¨æ€ä»£ç†æ¨¡å¼-éšè—é€šä¿¡ç»†èŠ‚" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åŠ¨æ€ä»£ç†æ¨¡å¼-éšè—é€šä¿¡ç»†èŠ‚" aria-hidden="true">#</a> <strong>| ä½¿ç”¨åŠ¨æ€ä»£ç†æ¨¡å¼ï¼Œéšè—é€šä¿¡ç»†èŠ‚</strong></h4><p>xxl-job å®šä¹‰äº†ä¸¤ä¸ªæ¥å£ ExecutorBizï¼ŒAdminBizï¼ŒExecutorBiz æ¥å£ä¸­å°è£…äº†å‘å¿ƒè·³ï¼Œæš‚åœï¼Œè§¦å‘æ‰§è¡Œç­‰æ“ä½œï¼ŒAdminBiz å°è£…äº†å›è°ƒï¼Œæ³¨å†Œï¼Œå–æ¶ˆæ³¨å†Œæ“ä½œï¼Œæ¥å£çš„å®ç°ç±»ä¸­ï¼Œå¹¶æ²¡æœ‰é€šä¿¡ç›¸å…³çš„å¤„ç†ã€‚</p><p>XxlRpcReferenceBean ç±»çš„ getObject() æ–¹æ³•ä¼šç”Ÿæˆä¸€ä¸ªä»£ç†ç±»ï¼Œè¿™ä¸ªä»£ç†ç±»ä¼šè¿›è¡Œè¿œç¨‹é€šä¿¡ã€‚</p><h4 id="å…¨å¼‚æ­¥å¤„ç†" tabindex="-1"><a class="header-anchor" href="#å…¨å¼‚æ­¥å¤„ç†" aria-hidden="true">#</a> <strong>| å…¨å¼‚æ­¥å¤„ç†</strong></h4><p>æ‰§è¡Œå™¨æ”¶åˆ°æ¶ˆæ¯è¿›è¡Œååºåˆ—åŒ–ï¼Œå¹¶æ²¡æœ‰åŒæ­¥æ‰§è¡Œä»»åŠ¡ä»£ç ï¼Œè€Œæ˜¯å°†ä»»åŠ¡ä¿¡æ¯å­˜å‚¨åœ¨Â LinkedBlockingQueue ä¸­ï¼Œå¼‚æ­¥çº¿ç¨‹ä»è¿™ä¸ªé˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ä¿¡æ¯ï¼Œç„¶åæ‰§è¡Œã€‚</p><p>è€Œä»»åŠ¡çš„å¤„ç†ç»“æœï¼Œä¹Ÿä¸æ˜¯è¯´å¤„ç†å®Œä¹‹åï¼ŒåŒæ­¥è¿”å›çš„ï¼Œä¹Ÿæ˜¯æ”¾åˆ°å›è°ƒçº¿ç¨‹çš„é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œå¼‚æ­¥çš„å°†å¤„ç†ç»“æœè¿”å›å›å»ã€‚</p><p>è¿™æ ·å¤„ç†çš„å¥½å¤„å°±æ˜¯å‡å°‘äº† netty å·¥ä½œçº¿ç¨‹çš„å¤„ç†æ—¶é—´ï¼Œæå‡äº†ååé‡ã€‚</p><h4 id="å¯¹å¼‚æ­¥å¤„ç†çš„åŒ…è£…" tabindex="-1"><a class="header-anchor" href="#å¯¹å¼‚æ­¥å¤„ç†çš„åŒ…è£…" aria-hidden="true">#</a> <strong>| å¯¹å¼‚æ­¥å¤„ç†çš„åŒ…è£…</strong></h4><p>å¯¹å¼‚æ­¥å¤„ç†è¿›è¡Œäº†åŒ…è£…ï¼Œä»£ç çœ‹èµ·æ¥æ˜¯åŒæ­¥è°ƒç”¨çš„ã€‚</p><p>æˆ‘ä»¬çœ‹ä¸‹è°ƒåº¦å™¨ï¼ŒXxlJobTrigger ç±»è§¦å‘ä»»åŠ¡æ‰§è¡Œçš„ä»£ç ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>public static ReturnT&lt;String&gt; runExecutor(TriggerParam triggerParam, String address){
    ReturnT&lt;String&gt; runResult = null;
    try {
        ExecutorBiz executorBiz = XxlJobScheduler.getExecutorBiz(address);
        //è¿™é‡Œé¢åšäº†å¾ˆå¤šå¼‚æ­¥å¤„ç†ï¼Œæœ€ç»ˆåŒæ­¥å¾—åˆ°å¤„ç†ç»“æœ
        runResult = executorBiz.run(triggerParam);
    } catch (Exception e) {
        logger.error(&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job trigger error, please check if the executor[{}] is running.&quot;, address, e);
        runResult = new ReturnT&lt;String&gt;(ReturnT.FAIL_CODE, ThrowableUtil.toString(e));
    }

    StringBuffer runResultSB = new StringBuffer(I18nUtil.getString(&quot;jobconf_trigger_run&quot;) + &quot;ï¼š&quot;);
    runResultSB.append(&quot;&lt;br&gt;addressï¼š&quot;).append(address);
    runResultSB.append(&quot;&lt;br&gt;codeï¼š&quot;).append(runResult.getCode());
    runResultSB.append(&quot;&lt;br&gt;msgï¼š&quot;).append(runResult.getMsg());

    runResult.setMsg(runResultSB.toString());
    return runResult;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ExecutorBiz.run æ–¹æ³•æˆ‘ä»¬è¯´è¿‡äº†ï¼Œæ˜¯èµ°çš„åŠ¨æ€ä»£ç†ï¼Œå’Œæ‰§è¡Œå™¨è¿›è¡Œé€šä¿¡ï¼Œæ‰§è¡Œå™¨æ‰§è¡Œç»“æœä¹Ÿæ˜¯å¼‚æ­¥å¤„ç†å®Œï¼Œæ‰è¿”å›çš„ï¼Œè€Œè¿™é‡Œçœ‹åˆ°çš„ run æ–¹æ³•æ˜¯åŒæ­¥ç­‰å¾…å¤„ç†ç»“æœè¿”å›ã€‚</p><p>æˆ‘ä»¬çœ‹ä¸‹xxl-jobæ˜¯å¦‚ä½•åŒæ­¥è·å–å¤„ç†ç»“æœçš„ï¼šè°ƒåº¦å™¨å‘æ‰§è¡Œå™¨å‘å‡ºæ¶ˆæ¯åï¼Œè¯¥çº¿ç¨‹é˜»å¡ã€‚ç­‰åˆ°æ‰§è¡Œå™¨å¤„ç†å®Œæ¯•åï¼Œå°†å¤„ç†ç»“æœè¿”å›ï¼Œå”¤é†’è¢«é˜»å¡çš„çº¿ç¨‹ï¼Œè°ƒç”¨å¤„æ‹¿åˆ°è¿”å›å€¼ã€‚</p><p>åŠ¨æ€ä»£ç†ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>//ä»£ç†ç±»ä¸­çš„è§¦å‘è°ƒç”¨
if (CallType.SYNC == callType) {
   // future-response set
   XxlRpcFutureResponse futureResponse = new XxlRpcFutureResponse(invokerFactory, xxlRpcRequest, null);
   try {
      // do invoke
      client.asyncSend(finalAddress, xxlRpcRequest);

      // future get
      XxlRpcResponse xxlRpcResponse = futureResponse.get(timeout, TimeUnit.MILLISECONDS);
      if (xxlRpcResponse.getErrorMsg() != null) {
         throw new XxlRpcException(xxlRpcResponse.getErrorMsg());
      }
      return xxlRpcResponse.getResult();
   } catch (Exception e) {
      logger.info(&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-rpc, invoke error, address:{}, XxlRpcRequest{}&quot;, finalAddress, xxlRpcRequest);

      throw (e instanceof XxlRpcException)?e:new XxlRpcException(e);
   } finally{
      // future-response remove
      futureResponse.removeInvokerFuture();
   }
} 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>XxlRpcFutureResponse ç±»ä¸­å®ç°äº†çº¿ç¨‹çš„ç­‰å¾…ï¼Œå’Œçº¿ç¨‹å”¤é†’çš„å¤„ç†ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>//è¿”å›ç»“æœï¼Œå”¤é†’çº¿ç¨‹
public void setResponse(XxlRpcResponse response) {
   this.response = response;
   synchronized (lock) {
      done = true;
      lock.notifyAll();
   }
}

@Override
    public XxlRpcResponse get(long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException {
        if (!done) {
            synchronized (lock) {
                try {
                    if (timeout &lt; 0) {
            //çº¿ç¨‹é˜»å¡
                        lock.wait();
                    } else {
                        long timeoutMillis = (TimeUnit.MILLISECONDS==unit)?timeout:TimeUnit.MILLISECONDS.convert(timeout , unit);
                        lock.wait(timeoutMillis);
                    }
                } catch (InterruptedException e) {
                    throw e;
                }
            }
        }

        if (!done) {
            throw new XxlRpcException(&quot;xxl-rpc, request timeout at:&quot;+ System.currentTimeMillis() +&quot;, request:&quot; + request.toString());
        }
        return response;
    }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ‰çš„åŒå­¦å¯èƒ½ä¼šé—®äº†ï¼Œè°ƒåº¦å™¨æ¥æ”¶åˆ°è¿”å›ç»“æœï¼Œæ€ä¹ˆç¡®å®šå”¤é†’å“ªä¸ªçº¿ç¨‹å‘¢ï¼Ÿ</p><p>æ¯ä¸€æ¬¡è¿œç¨‹è°ƒç”¨ï¼Œéƒ½ä¼šç”Ÿæˆ uuid çš„è¯·æ±‚ idï¼Œè¿™ä¸ª id æ˜¯åœ¨æ•´ä¸ªè°ƒç”¨è¿‡ç¨‹ä¸­ä¸€ç›´ä¼ é€’çš„ï¼Œå°±åƒä¸€æŠŠé’¥åŒ™ï¼Œåœ¨ä½ å›å®¶çš„çš„æ—¶å€™ï¼Œæ‹¿ç€å®ƒå°±å¸¦å¼€é—¨ã€‚</p><p>è¿™é‡Œæ‹¿ç€è¯·æ±‚ id è¿™æŠŠé’¥åŒ™ï¼Œå°±èƒ½æ‰¾åˆ°å¯¹åº”çš„ XxlRpcFutureResponseï¼Œç„¶åè°ƒç”¨ setResponse æ–¹æ³•ï¼Œè®¾ç½®è¿”å›å€¼ï¼Œå”¤é†’çº¿ç¨‹ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>public void notifyInvokerFuture(String requestId, final XxlRpcResponse xxlRpcResponse){

    // é€šè¿‡requestIdæ‰¾åˆ°XxlRpcFutureResponseï¼Œ
    final XxlRpcFutureResponse futureResponse = futureResponsePool.get(requestId);
    if (futureResponse == null) {
        return;
    }
    if (futureResponse.getInvokeCallback()!=null) {

        // callback type
        try {
            executeResponseCallback(new Runnable() {
                @Override
                public void run() {
                    if (xxlRpcResponse.getErrorMsg() != null) {
                        futureResponse.getInvokeCallback().onFailure(new XxlRpcException(xxlRpcResponse.getErrorMsg()));
                    } else {
                        futureResponse.getInvokeCallback().onSuccess(xxlRpcResponse.getResult());
                    }
                }
            });
        }catch (Exception e) {
            logger.error(e.getMessage(), e);
        }
    } else {
        // é‡Œé¢è°ƒç”¨lockçš„notifyæ–¹æ³•
        futureResponse.setResponse(xxlRpcResponse);
    }

    // do remove
    futureResponsePool.remove(requestId);

}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code> \\-------------Â  ENDÂ Â -------------
</code></pre>`,33),p={href:"https://github.com/dvsusan/susanSayJava****%EF%BC%8C%E6%AC%A2%E8%BF%8E%E5%B0%8F%E4%BC%99%E4%BC%B4%E4%BB%AC%E7%BB%99%E6%88%91%E4%B8%80%E4%B8%AA****star****%E3%80%82",target:"_blank",rel:"noopener noreferrer"},m=e("p",null,[e("strong",null,"ç‚¹å‡»"),n("ğŸ‘‡ğŸ»"),e("strong",null,"é˜…è¯»åŸæ–‡ï¼Œç›´æ¥å¯è®¿é—®è¯¥github")],-1);function b(g,x){const i=u("ExternalLinkIcon");return r(),t("div",null,[c,e("p",null,[n("æ–‡ç« æ¥æºï¼š"),e("a",v,[n("https://c1n.cn/N8Mlnâ€â€â€â€â€â€"),s(i)])]),o,e("p",null,[n("**æ­¤å¤–ï¼Œæˆ‘çš„æ‰€æœ‰æ–‡ç« å·²ç»å¼€æºäº†ã€‚æ›´å¤šç²¾å½©å†…å®¹æ”¶å½•åœ¨æˆ‘çš„GitHubï¼Œè®¿é—®åœ°å€ï¼š**"),e("strong",null,[e("a",p,[n("https://github.com/dvsusan/susanSayJava****ï¼Œæ¬¢è¿å°ä¼™ä¼´ä»¬ç»™æˆ‘ä¸€ä¸ª****star****ã€‚"),s(i)])])]),m])}const f=l(a,[["render",b],["__file","xxljobjydsjznjrba.html.vue"]]);export{f as default};
