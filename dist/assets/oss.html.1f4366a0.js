import{_ as e}from"./_plugin-vue_export-helper.cdc0426e.js";import{o,c,a as n,d as s,b as t,e as p,r as i}from"./app.99eb8281.js";const l={},u=p(`<h1 id="å´©æºƒ-æˆ‘å¸¦çš„å®ä¹ ç”Ÿç«Ÿç„¶æŠŠå›¾ç‰‡ç›´æ¥å­˜åˆ°äº†æœåŠ¡å™¨ä¸Š" tabindex="-1"><a class="header-anchor" href="#å´©æºƒ-æˆ‘å¸¦çš„å®ä¹ ç”Ÿç«Ÿç„¶æŠŠå›¾ç‰‡ç›´æ¥å­˜åˆ°äº†æœåŠ¡å™¨ä¸Š" aria-hidden="true">#</a> å´©æºƒï¼æˆ‘å¸¦çš„å®ä¹ ç”Ÿç«Ÿç„¶æŠŠå›¾ç‰‡ç›´æ¥å­˜åˆ°äº†æœåŠ¡å™¨ä¸Šï¼</h1><p>å°äºŒæ˜¯æ–°æ¥çš„å®ä¹ ç”Ÿï¼Œä½œä¸ºæŠ€æœ¯ leaderï¼Œæˆ‘ç»™ä»–å®‰æ’äº†ä¸€ä¸ªéå¸¸ç®€å•çš„ç»ƒæ‰‹ä»»åŠ¡ï¼ŒæŠŠå‰ç«¯ markdown ç¼–è¾‘å™¨é‡Œä¸Šä¼ çš„å›¾ç‰‡ä¿å­˜åˆ°æœåŠ¡å™¨ç«¯ï¼Œç»“æœä»–çœŸçš„å°±æŠŠå›¾ç‰‡ç›´æ¥ä¿å­˜åˆ°äº†æœåŠ¡å™¨ä¸Šï¼Œè¿™ä¸‹å¯æŠŠæˆ‘æ°”åäº†ï¼Œå°±ä¸èƒ½æä¸ªå¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œæ¯”å¦‚è¯´ OSSã€MinIOï¼Ÿ</p><p>ä»–ç†ç›´æ°”å£®åœ°åé©³é“ï¼šâ€œè°è®©ä½ ä¸è®²æ¸…æ¥šï¼Œæˆ‘å»æ‰¾è€æ¿æŠŠä½ å¼€æ‰ï¼â€æˆ‘ç¬é—´å°±æ€‚äº†ï¼Œè¯´ï¼Œâ€œæ¥æ¥æ¥ï¼Œæˆ‘æ‰‹æŠŠæ‰‹æ•™ä½ æ€ä¹ˆæŠŠå›¾ç‰‡ä¿å­˜åˆ° OSS ä¸Šï¼Œå¥½ä¸å¥½ï¼Ÿâ€</p><p>â€œä¸ç”¨äº†ï¼Œè¿˜æ˜¯æˆ‘æ¥æ•™ä½ å§ã€‚â€å°äºŒéå¸¸è‡ªä¿¡ï¼Œä¸‹é¢æ˜¯ä»–åœ¨ Spring Boot åº”ç”¨ä¸­æ•´åˆ OSS åšçš„è®°å½•ã€‚</p><p>ç‰¹æ­¤å£°æ˜ï¼šé˜¿é‡Œäº‘ OSS çš„äº§å“è´Ÿè´£äººçœ‹åˆ°åè¯·è‡ªè§‰è¿‡æ¥ç»“ç®—ä¸‹æ¨å¹¿è´¹ç”¨ï¼ˆç‹—å¤´ï¼‰ã€‚çœŸå¿ƒè®²ï¼šSpring Boot+OSS åœ¨å®é™…å¼€å‘ä¸­æŒºå¸¸è§çš„ã€‚</p><h3 id="ä¸€ã€å¼€é€š-oss" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€å¼€é€š-oss" aria-hidden="true">#</a> ä¸€ã€å¼€é€š OSS</h3><p>OSS ä¹Ÿå°±æ˜¯ Object Storage Serviceï¼Œæ˜¯é˜¿é‡Œäº‘æä¾›çš„ä¸€å¥—å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œå›½å†…çš„ç«å“è¿˜æœ‰ä¸ƒç‰›äº‘çš„ Kodoå’Œè…¾è®¯äº‘çš„COSã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œç™»å½•é˜¿é‡Œäº‘å®˜ç½‘ï¼Œæœç´¢â€œOSSâ€å…³é”®å­—ï¼Œè¿›å…¥ OSS äº§å“é¡µã€‚</p><p>ç¬¬äºŒæ­¥ï¼Œå¦‚æœæ˜¯ OSS æ–°ç”¨æˆ·çš„è¯ï¼Œå¯ä»¥äº«å— 6 ä¸ªæœˆçš„æ–°äººä¸“äº«ä¼˜æƒ ä»·ï¼Œä¸è¿‡ç»­è´¹çš„æ—¶å€™è¿˜æ˜¯ä¼šè‚‰ç–¼ã€‚</p><p>ç¬¬ä¸‰æ­¥ï¼Œè¿›å…¥ OSS ç®¡ç†æ§åˆ¶å°ï¼Œç‚¹å‡»ã€ŒBucket åˆ—è¡¨ã€ï¼Œç‚¹å‡»ã€Œåˆ›å»º Bucketã€ã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/90545c542bb7576f37d3e7d214d65ea2.png" alt="" loading="lazy"></p><p>Bucket çš„è¯é¢æ„æ€æ˜¯æ¡¶ï¼Œè¿™é‡ŒæŒ‡å­˜å‚¨ç©ºé—´ï¼Œå°±æ˜¯ç”¨äºå­˜å‚¨å¯¹è±¡çš„å®¹å™¨ã€‚æ³¨æ„è¯»å†™æƒé™ä¸ºâ€œå…¬å…±è¯»â€ï¼Œä¹Ÿå°±æ˜¯å…è®¸äº’è”ç½‘ç”¨æˆ·è®¿é—®äº‘ç©ºé—´ä¸Šçš„å›¾ç‰‡ã€‚</p><p>ç¬¬å››æ­¥ï¼Œç‚¹å‡»ã€Œç¡®å®šã€å°±ç®—æ˜¯å¼€é€šæˆåŠŸäº†ã€‚</p><h3 id="äºŒã€æ•´åˆ-oss" tabindex="-1"><a class="header-anchor" href="#äºŒã€æ•´åˆ-oss" aria-hidden="true">#</a> äºŒã€æ•´åˆ OSS</h3><p>ç¬¬ä¸€æ­¥ï¼Œåœ¨ pom.xml æ–‡ä»¶ä¸­æ·»åŠ  OSS çš„ä¾èµ–ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;!-- é˜¿é‡Œäº‘ OSS --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.aliyun.oss&lt;/groupId&gt;
    &lt;artifactId&gt;aliyun-sdk-oss&lt;/artifactId&gt;
    &lt;version&gt;3.10.2&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬äºŒæ­¥ï¼Œåœ¨ application.yml æ–‡ä»¶ä¸­æ·»åŠ  OSS é…ç½®é¡¹ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>aliyun:
  oss:
      # osså¯¹å¤–æœåŠ¡çš„è®¿é—®åŸŸå
    endpoint: oss-cn-beijing.aliyuncs.com
      # è®¿é—®èº«ä»½éªŒè¯ä¸­ç”¨åˆ°ç”¨æˆ·æ ‡è¯†
    accessKeyId: LTAI5
      # ç”¨æˆ·ç”¨äºåŠ å¯†ç­¾åå­—ç¬¦ä¸²å’Œossç”¨æ¥éªŒè¯ç­¾åå­—ç¬¦ä¸²çš„å¯†é’¥
    accessKeySecret: RYN
      # ossçš„å­˜å‚¨ç©ºé—´
    bucketName: itwanger-oss1
      # ä¸Šä¼ æ–‡ä»¶å¤§å°(M)
    maxSize: 3
      # ä¸Šä¼ æ–‡ä»¶å¤¹è·¯å¾„å‰ç¼€
    dir:
      prefix: codingmore/images/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬ä¸‰æ­¥ï¼Œæ–°å¢ OssClientConfig.java é…ç½®ç±»ï¼Œä¸»è¦å°±æ˜¯é€šè¿‡ @Value æ³¨è§£ä»é…ç½®æ–‡ä»¶ä¸­è·å–é…ç½®é¡¹ï¼Œç„¶ååˆ›å»º OSSClientã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OssClientConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${aliyun.oss.endpoint}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> endpoint <span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${aliyun.oss.accessKeyId}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> accessKeyId <span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${aliyun.oss.accessKeySecret}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> accessKeySecret<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">OSSClient</span> <span class="token function">createOssClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">OSSClient</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬å››æ­¥ï¼Œæ–°å¢æ–‡ä»¶ä¸Šä¼ æ¥å£ OssController.javaï¼Œå‚æ•°ä¸º MultipartFileã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>tags <span class="token operator">=</span> <span class="token string">&quot;ä¸Šä¼ &quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/ossController&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OssController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">IOssService</span> ossService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/upload&quot;</span><span class="token punctuation">,</span>method<span class="token operator">=</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸Šä¼ &quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResultObject</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span> file<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ResultObject</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>ossService<span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬äº”æ­¥ï¼Œæ–°å¢ Serviceï¼Œå°†æ–‡ä»¶ä¸Šä¼ åˆ° OSSï¼Œå¹¶è¿”å›æ–‡ä»¶ä¿å­˜è·¯å¾„ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OssServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IOssService</span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${aliyun.oss.maxSize}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> maxSize<span class="token punctuation">;</span>
   
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${aliyun.oss.bucketName}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> bucketName<span class="token punctuation">;</span>
  
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${aliyun.oss.dir.prefix}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> dirPrefix<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">OSSClient</span> ossClient<span class="token punctuation">;</span>   
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">upload</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> inputStream<span class="token punctuation">,</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token function">getBucketName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºPutObjectè¯·æ±‚ã€‚</span>
        ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">formatPath</span><span class="token punctuation">(</span>objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getBucketName</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> ext <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">String</span> extItem<span class="token operator">:</span>imageExtension<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>extItem<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                ext <span class="token operator">=</span> extItem<span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> dirPrefix<span class="token operator">+</span> <span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">today</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;/&quot;</span><span class="token operator">+</span> <span class="token class-name">IdUtil</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>ext<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">formatPath</span><span class="token punctuation">(</span><span class="token class-name">String</span> objectName<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;https://&quot;</span>  <span class="token operator">+</span>bucketName<span class="token operator">+</span><span class="token string">&quot;.&quot;</span><span class="token operator">+</span> ossClient<span class="token punctuation">.</span><span class="token function">getEndpoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> objectName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬å…­æ­¥ï¼Œæ‰“å¼€ Apipostï¼Œæµ‹è¯• OSS ä¸Šä¼ æ¥å£ï¼Œæ³¨æ„å‚æ•°é€‰æ‹©æ–‡ä»¶ï¼Œç‚¹å‡»å‘é€åå¯ä»¥çœ‹åˆ°æœåŠ¡å™¨ç«¯è¿”å›çš„å›¾ç‰‡é“¾æ¥ã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/d8c828ba200687eb61e86a7c474bcaaa.png" alt="" loading="lazy"></p><p>ç¬¬ä¸ƒæ­¥ï¼Œè¿›å…¥é˜¿é‡Œäº‘ OSS åå°ç®¡ç†ï¼Œå¯ä»¥ç¡®è®¤å›¾ç‰‡ç¡®å®å·²ç»ä¸Šä¼ æˆåŠŸã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/3b861901786b72335c400da1cd587007.png" alt="" loading="lazy"></p><h3 id="ä¸‰ã€æ‹‰å–å‰ç«¯ä»£ç æ¥æµ‹è¯•-oss-ä¸Šä¼ æ¥å£" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€æ‹‰å–å‰ç«¯ä»£ç æ¥æµ‹è¯•-oss-ä¸Šä¼ æ¥å£" aria-hidden="true">#</a> ä¸‰ã€æ‹‰å–å‰ç«¯ä»£ç æ¥æµ‹è¯• OSS ä¸Šä¼ æ¥å£</h3><p>codingmore-admin-web æ˜¯ç¼–ç¨‹å–µï¼ˆCodingmoreï¼‰çš„å‰ç«¯ç®¡ç†é¡¹ç›®ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„åœ°å€æ‹‰å–åˆ°æœ¬åœ°ã€‚</p>`,30),k={href:"https://github.com/itwanger/codingmore-admin-web",target:"_blank",rel:"noopener noreferrer"},r=p(`<p>æ‰§è¡Œ <code>yarn run dev</code> å‘½ä»¤åå°±å¯ä»¥å¯åŠ¨ Web ç®¡ç†ç«¯äº†ï¼Œè¿›å…¥åˆ°æ–‡ç« ç¼–è¾‘é¡µé¢ï¼Œé€‰æ‹©ä¸€å¼ å›¾ç‰‡è¿›è¡Œä¸Šä¼ ï¼Œå¯ä»¥ç¡®è®¤å›¾ç‰‡æ˜¯å¯ä»¥æ­£å¸¸ä»å‰ç«¯ä¸Šä¼ åˆ°æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡å™¨ç«¯å†ä¸Šä¼ åˆ° OSSï¼Œä¹‹åå†è¿”å›å‰ç«¯å›¾ç‰‡è®¿é—®é“¾æ¥çš„ã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/51dbf95c222354de4d9653a0ef270944.png" alt="" loading="lazy"></p><h3 id="å››ã€åˆ©ç”¨-oss-è¿›è¡Œè‡ªåŠ¨è½¬é“¾" tabindex="-1"><a class="header-anchor" href="#å››ã€åˆ©ç”¨-oss-è¿›è¡Œè‡ªåŠ¨è½¬é“¾" aria-hidden="true">#</a> å››ã€åˆ©ç”¨ OSS è¿›è¡Œè‡ªåŠ¨è½¬é“¾</h3><p>ç¬¬ä¸€æ­¥ï¼Œåœ¨ PostsServiceImpl.java ä¸­æ·»åŠ å›¾ç‰‡è½¬é“¾çš„æ–¹æ³•ï¼Œä¸»è¦åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼æ‰¾å‡ºæ–‡ç« å†…å®¹ä¸­çš„å¤–é“¾ï¼Œç„¶åå°†å¤–é“¾çš„å›¾ç‰‡ä¸Šä¼ åˆ° OSSï¼Œç„¶åå†æ›¿æ¢æ‰åŸæ¥çš„å¤–é“¾å›¾ç‰‡ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// åŒ¹é…å›¾ç‰‡çš„ markdown è¯­æ³•</span>
<span class="token comment">// ![](hhhx.png)</span>
<span class="token comment">// ![xx](hhhx.png?ax)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">IMG_PATTERN</span> <span class="token operator">=</span> <span class="token string">&quot;\\\\!\\\\[.*\\\\]\\\\((.*)\\\\)&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">handleContentImg</span><span class="token punctuation">(</span><span class="token class-name">Posts</span> posts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> content <span class="token operator">=</span> posts<span class="token punctuation">.</span><span class="token function">getPostContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Pattern</span> p <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token constant">IMG_PATTERN</span><span class="token punctuation">,</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token constant">CASE_INSENSITIVE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Matcher</span> m <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Future</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> imageTag <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;ä½¿ç”¨åˆ†ç»„è¿›è¡Œæ›¿æ¢{}&quot;</span><span class="token punctuation">,</span> imageTag<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> imageUrl <span class="token operator">=</span> imageTag<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>imageTag<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;(&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> imageTag<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ç¡®è®¤æ˜¯æœ¬ç«™é“¾æ¥ï¼Œä¸å¤„ç†</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>imageUrl<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>iOssService<span class="token punctuation">.</span><span class="token function">getEndPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// é€šè¿‡çº¿ç¨‹æ± å°†å›¾ç‰‡ä¸Šä¼ åˆ° OSS</span>
        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> ossUploadImageExecutor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> iOssService<span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span>imageUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>imageUrl<span class="token punctuation">,</span> future<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> oldUrl <span class="token operator">:</span> map<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>oldUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
           <span class="token class-name">String</span> imageUrl <span class="token operator">=</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           content <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>oldUrl<span class="token punctuation">,</span> imageUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> <span class="token operator">|</span> <span class="token class-name">ExecutionException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;è·å–å›¾ç‰‡é“¾æ¥å‡ºé”™{}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
    <span class="token punctuation">}</span>
    posts<span class="token punctuation">.</span><span class="token function">setPostContent</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬äºŒæ­¥ï¼Œåœ¨ OssServiceImpl.java ä¸­æ·»åŠ æ ¹æ®å¤–é“¾åœ°å€ä¸Šä¼ å›¾ç‰‡åˆ° OSS çš„æ–¹æ³•ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> objectName <span class="token operator">=</span> <span class="token function">getFileName</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">formatOSSPath</span><span class="token punctuation">(</span>objectName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬ä¸‰æ­¥ï¼Œé€šè¿‡ Web ç®¡ç†ç«¯æ¥æµ‹è¯•å¤–é“¾æ˜¯å¦è½¬é“¾æˆåŠŸã€‚å…ˆæ‰¾ä¸¤å¼ å¤–é“¾çš„å›¾ç‰‡ï¼Œå¯ä»¥çœ‹åˆ° markdown åœ¨é¢„è§ˆçš„æ—¶å€™å°±ä¸æ˜¾ç¤ºã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/5d7f479d69f7139d1ceb26ac27e2b19f.png" alt="" loading="lazy"></p><p>ç„¶åæˆ‘ä»¬ç‚¹å‡»å‘å¸ƒï¼Œå¯ä»¥çœ‹åˆ°ä¸¤å¼ å›¾ç‰‡éƒ½æ­£å¸¸æ˜¾ç¤ºäº†ï¼Œå› ä¸ºè½¬æˆäº† OSS çš„å›¾ç‰‡è®¿é—®åœ°å€ã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/5acb7ffa8c9856b6c5471632ae2e9ecf.png" alt="" loading="lazy"></p><h3 id="äº”ã€å°ç»“" tabindex="-1"><a class="header-anchor" href="#äº”ã€å°ç»“" aria-hidden="true">#</a> äº”ã€å°ç»“</h3>`,12),d={href:"https://mp.weixin.qq.com/s/VRmXn2_71yy3w-SvKTs1Fg",target:"_blank",rel:"noopener noreferrer"},v=n("p",null,"éœ€è¦æºç çš„å°ä¼™ä¼´å¯ä»¥ç›´æ¥åˆ°ç¼–ç¨‹å–µğŸ±æºç è·¯å¾„æ‹‰å–ï¼š",-1),m={href:"https://github.com/itwanger/coding-more",target:"_blank",rel:"noopener noreferrer"},b=n("hr",null,null,-1),g=n("p",null,[n("img",{src:"http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xingbiaogongzhonghao.png",alt:"",loading:"lazy"})],-1);function S(f,h){const a=i("ExternalLinkIcon");return o(),c("div",null,[u,n("blockquote",null,[n("p",null,[n("a",k,[s("https://github.com/itwanger/codingmore-admin-web"),t(a)])])]),r,n("p",null,[s("ç»¼ä¸Šæ¥çœ‹ï¼Œå®ä¹ ç”Ÿå°äºŒåœ¨ Spring Boot ä¸­æ•´åˆ OSS çš„ä»£ç è¿˜æ˜¯æŒºé è°±çš„ã€‚ä¹Ÿè®¸ OSS+CDN æ‰æ˜¯å›¾åºŠçš„æœ€å¥½è§£å†³æ–¹æ¡ˆï¼Œä¸è¿‡"),n("a",d,[s("é˜¿é‡Œäº‘çš„ HTTPS CDN åœ¨ GitHub ä¸Šæ— æ³•å›æº"),t(a)]),s("å¯¼è‡´å›¾ç‰‡ä¸æ˜¾ç¤ºçš„é—®é¢˜ä»ç„¶æ²¡æœ‰å¾—åˆ°æœ‰æ•ˆçš„è§£å†³ã€‚")]),v,n("blockquote",null,[n("p",null,[n("a",m,[s("https://github.com/itwanger/coding-more"),t(a)])])]),b,g])}const O=e(l,[["render",S],["__file","oss.html.vue"]]);export{O as default};
