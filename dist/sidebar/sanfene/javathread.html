<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.46" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://tobebetterjavaer.com/sidebar/sanfene/javathread.html"><meta property="og:site_name" content="Java ç¨‹åºå‘˜è¿›é˜¶ä¹‹è·¯"><meta property="og:title" content="é¢æ¸£é€†è¢­ï¼ˆJava å¹¶å‘ç¼–ç¨‹ç¯‡ï¼‰å¿…çœ‹ğŸ‘"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-05-20T03:14:08.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="Java"><meta property="article:modified_time" content="2022-05-20T03:14:08.000Z"><script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?5230ac143650bf5eb3c14f3fb9b1d3ec";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
      </script><link rel="stylesheet" href="//at.alicdn.com/t/font_3180624_7cy10l7jqqh.css"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>é¢æ¸£é€†è¢­ï¼ˆJava å¹¶å‘ç¼–ç¨‹ç¯‡ï¼‰å¿…çœ‹ğŸ‘ | Java ç¨‹åºå‘˜è¿›é˜¶ä¹‹è·¯</title><meta name="description" content="ä¸€ä»½é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜çš„Javaå­¦ä¹ æŒ‡å—ï¼Œå†…å®¹æ¶µç›–JavaåŸºç¡€ã€Javaå¹¶å‘ç¼–ç¨‹ã€Javaè™šæ‹Ÿæœºã€Javaä¼ä¸šçº§å¼€å‘ã€Javaé¢è¯•ç­‰æ ¸å¿ƒçŸ¥è¯†ç‚¹ã€‚å­¦Javaï¼Œå°±è®¤å‡†Javaç¨‹åºå‘˜è¿›é˜¶ä¹‹è·¯">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.aa7884a9.css">
    <link rel="modulepreload" href="/assets/app.df242bb6.js"><link rel="modulepreload" href="/assets/javathread.html.054857de.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/assets/javathread.html.1bcda474.js"><link rel="prefetch" href="/assets/index.html.59c102ba.js"><link rel="prefetch" href="/assets/home.html.a6a7aec9.js"><link rel="prefetch" href="/assets/bzhan-10wan.html.98f8ba37.js"><link rel="prefetch" href="/assets/csdn-1000wan.html.438218cb.js"><link rel="prefetch" href="/assets/index.html.a4bb5c6e.js"><link rel="prefetch" href="/assets/zhihu-1000wan.html.4bf2b6f4.js"><link rel="prefetch" href="/assets/array.html.77525f56.js"><link rel="prefetch" href="/assets/print.html.6fe8360d.js"><link rel="prefetch" href="/assets/basic-data-type.html.6be3e7e2.js"><link rel="prefetch" href="/assets/flow-control.html.f6c60ead.js"><link rel="prefetch" href="/assets/javadoc.html.b34e8efb.js"><link rel="prefetch" href="/assets/operator.html.9431d9fc.js"><link rel="prefetch" href="/assets/java-basic-34.html.70be78f8.js"><link rel="prefetch" href="/assets/java-basic.html.52bd7f06.js"><link rel="prefetch" href="/assets/java-thread.html.4a99fb0e.js"><link rel="prefetch" href="/assets/jvm.html.1b4e3107.js"><link rel="prefetch" href="/assets/beijing.html.5436f34b.js"><link rel="prefetch" href="/assets/chengdu.html.09b27f2f.js"><link rel="prefetch" href="/assets/guangzhou.html.ce1033cd.js"><link rel="prefetch" href="/assets/hangzhou.html.9719a0ea.js"><link rel="prefetch" href="/assets/nanjing.html.0381e4b6.js"><link rel="prefetch" href="/assets/qingdao.html.026cf757.js"><link rel="prefetch" href="/assets/shenzhen.html.037e48a5.js"><link rel="prefetch" href="/assets/suzhou.html.1f658a4a.js"><link rel="prefetch" href="/assets/xian.html.4a14941e.js"><link rel="prefetch" href="/assets/zhengzhou.html.43c30f38.js"><link rel="prefetch" href="/assets/48-keywords.html.e76832ee.js"><link rel="prefetch" href="/assets/Overriding.html.14f830f8.js"><link rel="prefetch" href="/assets/annotation.html.14064668.js"><link rel="prefetch" href="/assets/box.html.54cc70a2.js"><link rel="prefetch" href="/assets/class-object.html.c43412d3.js"><link rel="prefetch" href="/assets/comparable-omparator.html.397dc2ff.js"><link rel="prefetch" href="/assets/deep-copy.html.b367f078.js"><link rel="prefetch" href="/assets/enum.html.21e74b14.js"><link rel="prefetch" href="/assets/equals-hashcode.html.cd3210fa.js"><link rel="prefetch" href="/assets/fanshe.html.13ada7e7.js"><link rel="prefetch" href="/assets/generic.html.7ec41e80.js"><link rel="prefetch" href="/assets/hashcode.html.24290486.js"><link rel="prefetch" href="/assets/immutable.html.ed5b1443.js"><link rel="prefetch" href="/assets/instanceof-jvm.html.845ed78f.js"><link rel="prefetch" href="/assets/int-cache.html.0d30900e.js"><link rel="prefetch" href="/assets/java-naming.html.de2604a0.js"><link rel="prefetch" href="/assets/java-unicode.html.9e4e93b1.js"><link rel="prefetch" href="/assets/jdk-while-for-wuxian-xunhuan.html.e352d875.js"><link rel="prefetch" href="/assets/jdk9-char-byte-string.html.e81be44e.js"><link rel="prefetch" href="/assets/override-overload.html.f7d74176.js"><link rel="prefetch" href="/assets/pass-by-value.html.e26c3cdc.js"><link rel="prefetch" href="/assets/true-generic.html.ce09d792.js"><link rel="prefetch" href="/assets/varables.html.6a80fc0e.js"><link rel="prefetch" href="/assets/arraylist.html.0dcdca73.js"><link rel="prefetch" href="/assets/fail-fast.html.4b8a884f.js"><link rel="prefetch" href="/assets/gailan.html.87d77185.js"><link rel="prefetch" href="/assets/hashmap-interview.html.307a5634.js"><link rel="prefetch" href="/assets/hashmap.html.ab523029.js"><link rel="prefetch" href="/assets/iterator-iterable.html.967b5cf7.js"><link rel="prefetch" href="/assets/linkedlist.html.8ede144e.js"><link rel="prefetch" href="/assets/list-war-2.html.b8fa44fb.js"><link rel="prefetch" href="/assets/arrays.html.7944f961.js"><link rel="prefetch" href="/assets/collections.html.2e6479a3.js"><link rel="prefetch" href="/assets/guava.html.e73aaedd.js"><link rel="prefetch" href="/assets/hutool.html.06e72427.js"><link rel="prefetch" href="/assets/os.html.5e6a959a.js"><link rel="prefetch" href="/assets/wangluo.html.b41cb57f.js"><link rel="prefetch" href="/assets/bat-shuati.html.adba9635.js"><link rel="prefetch" href="/assets/history.html.f2970c79.js"><link rel="prefetch" href="/assets/java.html.c5bee727.js"><link rel="prefetch" href="/assets/jianli.html.75854f37.js"><link rel="prefetch" href="/assets/learn-jianyi.html.1b72d4e2.js"><link rel="prefetch" href="/assets/nicearticle.html.b56e678a.js"><link rel="prefetch" href="/assets/pdf.html.a28195f1.js"><link rel="prefetch" href="/assets/progit.html.3b6ba984.js"><link rel="prefetch" href="/assets/yuanyifeng-c-language.html.1d18c5bc.js"><link rel="prefetch" href="/assets/rumen.html.9cc17590.js"><link rel="prefetch" href="/assets/gailan.html.fee068f9.js"><link rel="prefetch" href="/assets/npe.html.a94a2b73.js"><link rel="prefetch" href="/assets/shijian.html.0924a1ec.js"><link rel="prefetch" href="/assets/try-with-resouces.html.8dcef913.js"><link rel="prefetch" href="/assets/git-qiyuan.html.a341e213.js"><link rel="prefetch" href="/assets/progit.html.a119468c.js"><link rel="prefetch" href="/assets/Chocolatey-Homebrew.html.ad256880.js"><link rel="prefetch" href="/assets/DBeaver.html.75fbe8f6.js"><link rel="prefetch" href="/assets/chiner.html.13c55607.js"><link rel="prefetch" href="/assets/choco.html.f8923e81.js"><link rel="prefetch" href="/assets/fastjson.html.f97ae6fd.js"><link rel="prefetch" href="/assets/forest.html.79a7cfed.js"><link rel="prefetch" href="/assets/gson.html.e79a454d.js"><link rel="prefetch" href="/assets/jackson.html.ded110ad.js"><link rel="prefetch" href="/assets/junit.html.2436284c.js"><link rel="prefetch" href="/assets/knife4j.html.fe2f8e7d.js"><link rel="prefetch" href="/assets/log4j.html.14af993a.js"><link rel="prefetch" href="/assets/log4j2.html.9b5a6f13.js"><link rel="prefetch" href="/assets/logback.html.a9628274.js"><link rel="prefetch" href="/assets/others.html.ed8fcf05.js"><link rel="prefetch" href="/assets/slf4j.html.2fd3dca6.js"><link rel="prefetch" href="/assets/tabby.html.9fb65d66.js"><link rel="prefetch" href="/assets/warp.html.4380b228.js"><link rel="prefetch" href="/assets/4-debug-skill.html.9bd076fc.js"><link rel="prefetch" href="/assets/BIONIOAIO.html.ea89d11f.js"><link rel="prefetch" href="/assets/shangtou.html.dd79a90f.js"><link rel="prefetch" href="/assets/Lambda.html.997b367a.js"><link rel="prefetch" href="/assets/optional.html.23c0a140.js"><link rel="prefetch" href="/assets/stream.html.214aab27.js"><link rel="prefetch" href="/assets/asm.html.0e0abd8b.js"><link rel="prefetch" href="/assets/bytecode.html.ba8f00b6.js"><link rel="prefetch" href="/assets/class-file-jiegou.html.3dff0326.js"><link rel="prefetch" href="/assets/class-load.html.6a788fca.js"><link rel="prefetch" href="/assets/compile-jdk.html.531caac0.js"><link rel="prefetch" href="/assets/cpu-percent-100.html.f6bd745b.js"><link rel="prefetch" href="/assets/gc.html.cec6db87.js"><link rel="prefetch" href="/assets/how-jvm-run-zijiema-zhiling.html.400c699c.js"><link rel="prefetch" href="/assets/how-run-java-code.html.1867de4d.js"><link rel="prefetch" href="/assets/hsdb.html.e06d55d6.js"><link rel="prefetch" href="/assets/jit.html.a14bdfce.js"><link rel="prefetch" href="/assets/meituan-9-gc.html.f5a5b89a.js"><link rel="prefetch" href="/assets/neicun-jiegou.html.f0fca3bb.js"><link rel="prefetch" href="/assets/oom.html.23228526.js"><link rel="prefetch" href="/assets/problem-tools.html.fab08888.js"><link rel="prefetch" href="/assets/tujie-gc.html.ca2dffab.js"><link rel="prefetch" href="/assets/what-happen-when-javac.html.ab4282c1.js"><link rel="prefetch" href="/assets/what-is-jvm.html.5131a239.js"><link rel="prefetch" href="/assets/whereis-the-object.html.c695df3e.js"><link rel="prefetch" href="/assets/zijiema-zhiling.html.34c655bc.js"><link rel="prefetch" href="/assets/zongjie.html.c9e5e3c3.js"><link rel="prefetch" href="/assets/auto-generator.html.edd07e0d.js"><link rel="prefetch" href="/assets/index.html.fd879420.js"><link rel="prefetch" href="/assets/yuneban-wangyiyunyinyue.html.275a589e.js"><link rel="prefetch" href="/assets/waibao-1geyue.html.fbddc89c.js"><link rel="prefetch" href="/assets/yanjiusuo-20wan.html.76b660c5.js"><link rel="prefetch" href="/assets/maven.html.f0c8e738.js"><link rel="prefetch" href="/assets/redis12question.html.58f0e7e0.js"><link rel="prefetch" href="/assets/shanganaliyun.html.04eee07a.js"><link rel="prefetch" href="/assets/api-wangguan.html.c2b18262.js"><link rel="prefetch" href="/assets/rumen.html.28382740.js"><link rel="prefetch" href="/assets/100-budiushi.html.c3040dbf.js"><link rel="prefetch" href="/assets/rabbitmq-rumen.html.1f0066c6.js"><link rel="prefetch" href="/assets/deletedb-binlog-weiguanjishu.html.605b28a5.js"><link rel="prefetch" href="/assets/redis-shuju-yizhixing.html.0d2d7824.js"><link rel="prefetch" href="/assets/40-interview.html.2cb0fe6c.js"><link rel="prefetch" href="/assets/nginx.html.c9dd536d.js"><link rel="prefetch" href="/assets/BOKEYUANruhegaoxiaodixuexijishu.html.54dd2a4d.js"><link rel="prefetch" href="/assets/ZHIHUjavaxuexidaoshemechengduokeyizhaodiyifengongzuo.html.e4fead09.js"><link rel="prefetch" href="/assets/bokeyuan-jianxijavazhongdifangwenquanxiankongzhi.html.bc8753e4.js"><link rel="prefetch" href="/assets/bokeyuan-ruhegaoxiaodixuexijishu.html.e9d4ca36.js"><link rel="prefetch" href="/assets/haibukuaiyongmybatisplusshoubashoujiaoni.html.4769ffdb.js"><link rel="prefetch" href="/assets/javaxuexidaoshemechengduokeyizhaodiyifengongzuo.html.3289a228.js"><link rel="prefetch" href="/assets/jiagoushizenyanghuizhijitongjiagoulantu.html.980a677a.js"><link rel="prefetch" href="/assets/jielehenduosihuodiganchu.html.0ffa8f43.js"><link rel="prefetch" href="/assets/jishuzongjianbeikaichuliao.html.1b7e52c1.js"><link rel="prefetch" href="/assets/weixin-liaoliaoxianliu.html.624e17ae.js"><link rel="prefetch" href="/assets/weixin-xinllgjszjszzpojozsyjbsjlxyhjfyll.html.8f640dc9.js"><link rel="prefetch" href="/assets/weixin-zuixinbujiabandigongsimingdan.html.bf87a7d5.js"><link rel="prefetch" href="/assets/abstract.html.3094fdb5.js"><link rel="prefetch" href="/assets/code-init.html.70ef628a.js"><link rel="prefetch" href="/assets/construct.html.5ae3e6eb.js"><link rel="prefetch" href="/assets/final.html.c83d9074.js"><link rel="prefetch" href="/assets/inner-class.html.f2dd62ed.js"><link rel="prefetch" href="/assets/instanceof.html.d3be3510.js"><link rel="prefetch" href="/assets/interface.html.7833e904.js"><link rel="prefetch" href="/assets/method.html.4d951864.js"><link rel="prefetch" href="/assets/object-class.html.85420110.js"><link rel="prefetch" href="/assets/static.html.1a009c06.js"><link rel="prefetch" href="/assets/this-super.html.65fa5da3.js"><link rel="prefetch" href="/assets/var.html.7a0cfd0f.js"><link rel="prefetch" href="/assets/hello-world.html.d0d5adf0.js"><link rel="prefetch" href="/assets/what-is-java.html.b724e432.js"><link rel="prefetch" href="/assets/redis-springboot.html.5e59844d.js"><link rel="prefetch" href="/assets/rumen.html.e13dbda5.js"><link rel="prefetch" href="/assets/xuebeng-chuantou-jichuan.html.26ef04a3.js"><link rel="prefetch" href="/assets/image-yasuo.html.8853b749.js"><link rel="prefetch" href="/assets/log4j2.html.b3fd06a7.js"><link rel="prefetch" href="/assets/computer-base.html.f469b424.js"><link rel="prefetch" href="/assets/Filter-Interceptor-Listener.html.d4211e38.js"><link rel="prefetch" href="/assets/aop-log.html.390b071a.js"><link rel="prefetch" href="/assets/cors.html.b8f51585.js"><link rel="prefetch" href="/assets/initializr.html.ae05e8c2.js"><link rel="prefetch" href="/assets/ioc.html.1c4cca00.js"><link rel="prefetch" href="/assets/jpa.html.c4109873.js"><link rel="prefetch" href="/assets/jwt.html.b4f208bb.js"><link rel="prefetch" href="/assets/logback.html.65200f68.js"><link rel="prefetch" href="/assets/macos-codingmore-run.html.b03e8070.js"><link rel="prefetch" href="/assets/mysql-druid.html.bf232591.js"><link rel="prefetch" href="/assets/oss.html.977b34d5.js"><link rel="prefetch" href="/assets/springtask.html.406633ab.js"><link rel="prefetch" href="/assets/swagger.html.03ed15b7.js"><link rel="prefetch" href="/assets/thymeleaf.html.1a24ed99.js"><link rel="prefetch" href="/assets/tomcat.html.73ec3645.js"><link rel="prefetch" href="/assets/transaction.html.c6ea47a0.js"><link rel="prefetch" href="/assets/constant-pool.html.c79f5c21.js"><link rel="prefetch" href="/assets/equals.html.2fb94b25.js"><link rel="prefetch" href="/assets/immutable.html.36fadfba.js"><link rel="prefetch" href="/assets/intern.html.3d87fa6f.js"><link rel="prefetch" href="/assets/join.html.bb336f49.js"><link rel="prefetch" href="/assets/split.html.0ff2ce60.js"><link rel="prefetch" href="/assets/tobebetterjavaer-beian.html.3820089c.js"><link rel="prefetch" href="/assets/tobebetterjavaer-wangzhan-shangxian.html.a80895d2.js"><link rel="prefetch" href="/assets/tupian-zhuanlian.html.7ab13c07.js"><link rel="prefetch" href="/assets/BlockingQueue.html.9ccd9ba0.js"><link rel="prefetch" href="/assets/ConcurrentHashMap.html.e7f83c81.js"><link rel="prefetch" href="/assets/ConcurrentLinkedQueue.html.da4bfec1.js"><link rel="prefetch" href="/assets/CopyOnWriteArrayList.html.b8e564c2.js"><link rel="prefetch" href="/assets/CountDownLatch.html.f036fab2.js"><link rel="prefetch" href="/assets/LockSupport.html.c7d00cfa.js"><link rel="prefetch" href="/assets/ReentrantReadWriteLock.html.d1bd972f.js"><link rel="prefetch" href="/assets/ScheduledThreadPoolExecutor.html.8d668046.js"><link rel="prefetch" href="/assets/ThreadLocal.html.f9a6fed8.js"><link rel="prefetch" href="/assets/ali-executors.html.988adc8e.js"><link rel="prefetch" href="/assets/aqs.html.d6a8f5b4.js"><link rel="prefetch" href="/assets/atomic.html.93391f09.js"><link rel="prefetch" href="/assets/cas.html.4534d702.js"><link rel="prefetch" href="/assets/condition.html.a41bdc76.js"><link rel="prefetch" href="/assets/fork-join.html.f967d485.js"><link rel="prefetch" href="/assets/jmm.html.7be72db5.js"><link rel="prefetch" href="/assets/lock.html.5385ecc8.js"><link rel="prefetch" href="/assets/map.html.ae80f8e6.js"><link rel="prefetch" href="/assets/pool.html.1918e02b.js"><link rel="prefetch" href="/assets/reentrantLock.html.002f84e4.js"><link rel="prefetch" href="/assets/shengchanzhe-xiaofeizhe.html.0915b865.js"><link rel="prefetch" href="/assets/synchronized.html.6094d556.js"><link rel="prefetch" href="/assets/thread-bring-some-problem.html.c8ae3e7a.js"><link rel="prefetch" href="/assets/thread-group-and-thread-priority.html.873709ce.js"><link rel="prefetch" href="/assets/thread-state-and-method.html.70b8e2e8.js"><link rel="prefetch" href="/assets/volatile.html.26279f7f.js"><link rel="prefetch" href="/assets/wangzhe-thread.html.dda72253.js"><link rel="prefetch" href="/assets/why-need-thread.html.507a940d.js"><link rel="prefetch" href="/assets/aliyun-shuaiguo-gongchengshi.html.e4346151.js"><link rel="prefetch" href="/assets/chadiansanhuo.html.e9cc0b99.js"><link rel="prefetch" href="/assets/chengxuyuannv-chonghui-java.html.b9de6702.js"><link rel="prefetch" href="/assets/daxue-nuli-jisuanji.html.2b1074e1.js"><link rel="prefetch" href="/assets/fumutuanju.html.577491d1.js"><link rel="prefetch" href="/assets/electron-information-engineering.html.b3d4a3e7.js"><link rel="prefetch" href="/assets/read-csapp.html.23c82cf4.js"><link rel="prefetch" href="/assets/algorithm.html.17f14372.js"><link rel="prefetch" href="/assets/c.html.2adcc0b8.js"><link rel="prefetch" href="/assets/ccc.html.ec50d3a7.js"><link rel="prefetch" href="/assets/go.html.7279e529.js"><link rel="prefetch" href="/assets/lanqiaobei.html.3580fcbe.js"><link rel="prefetch" href="/assets/os.html.6a42c2f5.js"><link rel="prefetch" href="/assets/python.html.36401656.js"><link rel="prefetch" href="/assets/qianduan.html.1884f6af.js"><link rel="prefetch" href="/assets/index.html.fe9dcc15.js"><link rel="prefetch" href="/assets/java-mianshi-zhinan.html.f1a349c4.js"><link rel="prefetch" href="/assets/index.html.af7b50d7.js"><link rel="prefetch" href="/assets/jibenjieshao.html.b8a08842.js"><link rel="prefetch" href="/assets/mysql.html.99fca397.js"><link rel="prefetch" href="/assets/collection.html.42c40509.js"><link rel="prefetch" href="/assets/javase.html.b3add115.js"><link rel="prefetch" href="/assets/jvm.html.dd68f45e.js"><link rel="prefetch" href="/assets/mybatis.html.750369f6.js"><link rel="prefetch" href="/assets/nixi.html.689e1ee6.js"><link rel="prefetch" href="/assets/redis.html.b039ba47.js"><link rel="prefetch" href="/assets/spring.html.75b19ea2.js"><link rel="prefetch" href="/assets/jvm.html.76aa5cf0.js"><link rel="prefetch" href="/assets/thread.html.3c6bc9ba.js"><link rel="prefetch" href="/assets/yitiaolong.html.1d8d7fb6.js"><link rel="prefetch" href="/assets/404.html.e75684b7.js"><link rel="prefetch" href="/assets/index.html.7b7d58d0.js"><link rel="prefetch" href="/assets/home.html.e526c20e.js"><link rel="prefetch" href="/assets/bzhan-10wan.html.c484aa13.js"><link rel="prefetch" href="/assets/csdn-1000wan.html.ac3cac01.js"><link rel="prefetch" href="/assets/index.html.54f03448.js"><link rel="prefetch" href="/assets/zhihu-1000wan.html.10d5ce1e.js"><link rel="prefetch" href="/assets/array.html.4f99ffa5.js"><link rel="prefetch" href="/assets/print.html.cd0d2810.js"><link rel="prefetch" href="/assets/basic-data-type.html.65b117b1.js"><link rel="prefetch" href="/assets/flow-control.html.2aef32b6.js"><link rel="prefetch" href="/assets/javadoc.html.21ea06af.js"><link rel="prefetch" href="/assets/operator.html.107bf827.js"><link rel="prefetch" href="/assets/java-basic-34.html.77f3912e.js"><link rel="prefetch" href="/assets/java-basic.html.0de24961.js"><link rel="prefetch" href="/assets/java-thread.html.721c756a.js"><link rel="prefetch" href="/assets/jvm.html.846ad3e0.js"><link rel="prefetch" href="/assets/beijing.html.b14b773f.js"><link rel="prefetch" href="/assets/chengdu.html.9815247c.js"><link rel="prefetch" href="/assets/guangzhou.html.76ccb2ab.js"><link rel="prefetch" href="/assets/hangzhou.html.f24367f8.js"><link rel="prefetch" href="/assets/nanjing.html.95ebf87d.js"><link rel="prefetch" href="/assets/qingdao.html.c83b94a5.js"><link rel="prefetch" href="/assets/shenzhen.html.79fc0329.js"><link rel="prefetch" href="/assets/suzhou.html.5bd017f5.js"><link rel="prefetch" href="/assets/xian.html.9720ddef.js"><link rel="prefetch" href="/assets/zhengzhou.html.3a5a4340.js"><link rel="prefetch" href="/assets/48-keywords.html.a78f27df.js"><link rel="prefetch" href="/assets/Overriding.html.76028677.js"><link rel="prefetch" href="/assets/annotation.html.7842ae54.js"><link rel="prefetch" href="/assets/box.html.4971a6d7.js"><link rel="prefetch" href="/assets/class-object.html.14621c36.js"><link rel="prefetch" href="/assets/comparable-omparator.html.6981ef25.js"><link rel="prefetch" href="/assets/deep-copy.html.fd83f430.js"><link rel="prefetch" href="/assets/enum.html.4e6c5b67.js"><link rel="prefetch" href="/assets/equals-hashcode.html.390b8a88.js"><link rel="prefetch" href="/assets/fanshe.html.efeff003.js"><link rel="prefetch" href="/assets/generic.html.e68ecfe2.js"><link rel="prefetch" href="/assets/hashcode.html.3d4ddd56.js"><link rel="prefetch" href="/assets/immutable.html.f55b754a.js"><link rel="prefetch" href="/assets/instanceof-jvm.html.70e1d6f5.js"><link rel="prefetch" href="/assets/int-cache.html.c0553623.js"><link rel="prefetch" href="/assets/java-naming.html.ce668a70.js"><link rel="prefetch" href="/assets/java-unicode.html.b8b31704.js"><link rel="prefetch" href="/assets/jdk-while-for-wuxian-xunhuan.html.8be23660.js"><link rel="prefetch" href="/assets/jdk9-char-byte-string.html.22eda4a9.js"><link rel="prefetch" href="/assets/override-overload.html.338f834e.js"><link rel="prefetch" href="/assets/pass-by-value.html.fa7af41e.js"><link rel="prefetch" href="/assets/true-generic.html.a3e3f389.js"><link rel="prefetch" href="/assets/varables.html.edd32a53.js"><link rel="prefetch" href="/assets/arraylist.html.dffb9b14.js"><link rel="prefetch" href="/assets/fail-fast.html.3e087997.js"><link rel="prefetch" href="/assets/gailan.html.2d4ff774.js"><link rel="prefetch" href="/assets/hashmap-interview.html.67af44fd.js"><link rel="prefetch" href="/assets/hashmap.html.bef4e6ca.js"><link rel="prefetch" href="/assets/iterator-iterable.html.5cce753c.js"><link rel="prefetch" href="/assets/linkedlist.html.e52baee4.js"><link rel="prefetch" href="/assets/list-war-2.html.1f36b848.js"><link rel="prefetch" href="/assets/arrays.html.17a6a15d.js"><link rel="prefetch" href="/assets/collections.html.16ec007a.js"><link rel="prefetch" href="/assets/guava.html.41ffcaea.js"><link rel="prefetch" href="/assets/hutool.html.e4132b04.js"><link rel="prefetch" href="/assets/os.html.45f78d9b.js"><link rel="prefetch" href="/assets/wangluo.html.42a0af04.js"><link rel="prefetch" href="/assets/bat-shuati.html.369c7899.js"><link rel="prefetch" href="/assets/history.html.2ab6c413.js"><link rel="prefetch" href="/assets/java.html.aa6204ac.js"><link rel="prefetch" href="/assets/jianli.html.740d37ac.js"><link rel="prefetch" href="/assets/learn-jianyi.html.966d7017.js"><link rel="prefetch" href="/assets/nicearticle.html.dacd70f8.js"><link rel="prefetch" href="/assets/pdf.html.aa110ec1.js"><link rel="prefetch" href="/assets/progit.html.1b487241.js"><link rel="prefetch" href="/assets/yuanyifeng-c-language.html.fef0fb9f.js"><link rel="prefetch" href="/assets/rumen.html.9b83b55c.js"><link rel="prefetch" href="/assets/gailan.html.6fb6c22a.js"><link rel="prefetch" href="/assets/npe.html.963fe453.js"><link rel="prefetch" href="/assets/shijian.html.a603a2cc.js"><link rel="prefetch" href="/assets/try-with-resouces.html.d5d53b16.js"><link rel="prefetch" href="/assets/git-qiyuan.html.05fab4d1.js"><link rel="prefetch" href="/assets/progit.html.7a3ded24.js"><link rel="prefetch" href="/assets/Chocolatey-Homebrew.html.a15ffb7d.js"><link rel="prefetch" href="/assets/DBeaver.html.3f466980.js"><link rel="prefetch" href="/assets/chiner.html.8373f1bc.js"><link rel="prefetch" href="/assets/choco.html.bc165f4c.js"><link rel="prefetch" href="/assets/fastjson.html.2915a920.js"><link rel="prefetch" href="/assets/forest.html.20b2f837.js"><link rel="prefetch" href="/assets/gson.html.19af31a3.js"><link rel="prefetch" href="/assets/jackson.html.129709a1.js"><link rel="prefetch" href="/assets/junit.html.895af345.js"><link rel="prefetch" href="/assets/knife4j.html.af2d5656.js"><link rel="prefetch" href="/assets/log4j.html.4a8bdefe.js"><link rel="prefetch" href="/assets/log4j2.html.796cfc97.js"><link rel="prefetch" href="/assets/logback.html.16fb2fee.js"><link rel="prefetch" href="/assets/others.html.543a893c.js"><link rel="prefetch" href="/assets/slf4j.html.8848846a.js"><link rel="prefetch" href="/assets/tabby.html.055f4657.js"><link rel="prefetch" href="/assets/warp.html.d59eef2b.js"><link rel="prefetch" href="/assets/4-debug-skill.html.9e5adc74.js"><link rel="prefetch" href="/assets/BIONIOAIO.html.1ec1443a.js"><link rel="prefetch" href="/assets/shangtou.html.453da032.js"><link rel="prefetch" href="/assets/Lambda.html.ef139f75.js"><link rel="prefetch" href="/assets/optional.html.f1fd7866.js"><link rel="prefetch" href="/assets/stream.html.49c88b8d.js"><link rel="prefetch" href="/assets/asm.html.b2ec3973.js"><link rel="prefetch" href="/assets/bytecode.html.0458870f.js"><link rel="prefetch" href="/assets/class-file-jiegou.html.c2975d5a.js"><link rel="prefetch" href="/assets/class-load.html.bff5c6e4.js"><link rel="prefetch" href="/assets/compile-jdk.html.71345380.js"><link rel="prefetch" href="/assets/cpu-percent-100.html.11988873.js"><link rel="prefetch" href="/assets/gc.html.85b56c2f.js"><link rel="prefetch" href="/assets/how-jvm-run-zijiema-zhiling.html.df3aae8d.js"><link rel="prefetch" href="/assets/how-run-java-code.html.c5447e81.js"><link rel="prefetch" href="/assets/hsdb.html.58cc6862.js"><link rel="prefetch" href="/assets/jit.html.c33bb3e7.js"><link rel="prefetch" href="/assets/meituan-9-gc.html.416f1b2c.js"><link rel="prefetch" href="/assets/neicun-jiegou.html.01618b42.js"><link rel="prefetch" href="/assets/oom.html.b6e43044.js"><link rel="prefetch" href="/assets/problem-tools.html.d71b4603.js"><link rel="prefetch" href="/assets/tujie-gc.html.c9dd92e5.js"><link rel="prefetch" href="/assets/what-happen-when-javac.html.3c45e099.js"><link rel="prefetch" href="/assets/what-is-jvm.html.8e820d05.js"><link rel="prefetch" href="/assets/whereis-the-object.html.e04761a1.js"><link rel="prefetch" href="/assets/zijiema-zhiling.html.a0239f74.js"><link rel="prefetch" href="/assets/zongjie.html.4c721d5c.js"><link rel="prefetch" href="/assets/auto-generator.html.b3b251dd.js"><link rel="prefetch" href="/assets/index.html.aa130762.js"><link rel="prefetch" href="/assets/yuneban-wangyiyunyinyue.html.863ca813.js"><link rel="prefetch" href="/assets/waibao-1geyue.html.8c1e8091.js"><link rel="prefetch" href="/assets/yanjiusuo-20wan.html.66f5eb31.js"><link rel="prefetch" href="/assets/maven.html.601899e6.js"><link rel="prefetch" href="/assets/redis12question.html.c2ff527a.js"><link rel="prefetch" href="/assets/shanganaliyun.html.a8185041.js"><link rel="prefetch" href="/assets/api-wangguan.html.65280273.js"><link rel="prefetch" href="/assets/rumen.html.f51406bb.js"><link rel="prefetch" href="/assets/100-budiushi.html.68123c7f.js"><link rel="prefetch" href="/assets/rabbitmq-rumen.html.e2f85e6a.js"><link rel="prefetch" href="/assets/deletedb-binlog-weiguanjishu.html.006c6b67.js"><link rel="prefetch" href="/assets/redis-shuju-yizhixing.html.73a55990.js"><link rel="prefetch" href="/assets/40-interview.html.25a750aa.js"><link rel="prefetch" href="/assets/nginx.html.77d02aa0.js"><link rel="prefetch" href="/assets/BOKEYUANruhegaoxiaodixuexijishu.html.5d3c8ea1.js"><link rel="prefetch" href="/assets/ZHIHUjavaxuexidaoshemechengduokeyizhaodiyifengongzuo.html.fe0e97a8.js"><link rel="prefetch" href="/assets/bokeyuan-jianxijavazhongdifangwenquanxiankongzhi.html.aa189846.js"><link rel="prefetch" href="/assets/bokeyuan-ruhegaoxiaodixuexijishu.html.5e113029.js"><link rel="prefetch" href="/assets/haibukuaiyongmybatisplusshoubashoujiaoni.html.66e763d8.js"><link rel="prefetch" href="/assets/javaxuexidaoshemechengduokeyizhaodiyifengongzuo.html.ab0dca9d.js"><link rel="prefetch" href="/assets/jiagoushizenyanghuizhijitongjiagoulantu.html.01341aa6.js"><link rel="prefetch" href="/assets/jielehenduosihuodiganchu.html.c164cfce.js"><link rel="prefetch" href="/assets/jishuzongjianbeikaichuliao.html.b6321ccc.js"><link rel="prefetch" href="/assets/weixin-liaoliaoxianliu.html.27586d61.js"><link rel="prefetch" href="/assets/weixin-xinllgjszjszzpojozsyjbsjlxyhjfyll.html.fe69fb0a.js"><link rel="prefetch" href="/assets/weixin-zuixinbujiabandigongsimingdan.html.7c085244.js"><link rel="prefetch" href="/assets/abstract.html.c6059669.js"><link rel="prefetch" href="/assets/code-init.html.8036d74b.js"><link rel="prefetch" href="/assets/construct.html.3d408c28.js"><link rel="prefetch" href="/assets/final.html.171e441f.js"><link rel="prefetch" href="/assets/inner-class.html.859edb19.js"><link rel="prefetch" href="/assets/instanceof.html.8ba53d74.js"><link rel="prefetch" href="/assets/interface.html.c733a6ac.js"><link rel="prefetch" href="/assets/method.html.b595bbaa.js"><link rel="prefetch" href="/assets/object-class.html.4799d5bf.js"><link rel="prefetch" href="/assets/static.html.c6be07b6.js"><link rel="prefetch" href="/assets/this-super.html.56641063.js"><link rel="prefetch" href="/assets/var.html.789ab955.js"><link rel="prefetch" href="/assets/hello-world.html.219ce7e7.js"><link rel="prefetch" href="/assets/what-is-java.html.2a93b165.js"><link rel="prefetch" href="/assets/redis-springboot.html.567215a5.js"><link rel="prefetch" href="/assets/rumen.html.c37e0b1c.js"><link rel="prefetch" href="/assets/xuebeng-chuantou-jichuan.html.76b91f0e.js"><link rel="prefetch" href="/assets/image-yasuo.html.433d3dd3.js"><link rel="prefetch" href="/assets/log4j2.html.1724df41.js"><link rel="prefetch" href="/assets/computer-base.html.eca798cc.js"><link rel="prefetch" href="/assets/Filter-Interceptor-Listener.html.0867f3ae.js"><link rel="prefetch" href="/assets/aop-log.html.58182ae4.js"><link rel="prefetch" href="/assets/cors.html.d20e612d.js"><link rel="prefetch" href="/assets/initializr.html.0275e250.js"><link rel="prefetch" href="/assets/ioc.html.e7e093ea.js"><link rel="prefetch" href="/assets/jpa.html.6941e837.js"><link rel="prefetch" href="/assets/jwt.html.ed8c7468.js"><link rel="prefetch" href="/assets/logback.html.ff1d078b.js"><link rel="prefetch" href="/assets/macos-codingmore-run.html.dd69fef9.js"><link rel="prefetch" href="/assets/mysql-druid.html.54169bb6.js"><link rel="prefetch" href="/assets/oss.html.0e10a8e7.js"><link rel="prefetch" href="/assets/springtask.html.a44de9f0.js"><link rel="prefetch" href="/assets/swagger.html.c936fb04.js"><link rel="prefetch" href="/assets/thymeleaf.html.0c178402.js"><link rel="prefetch" href="/assets/tomcat.html.43cc36e8.js"><link rel="prefetch" href="/assets/transaction.html.40b93699.js"><link rel="prefetch" href="/assets/constant-pool.html.a416a446.js"><link rel="prefetch" href="/assets/equals.html.3bfbe84b.js"><link rel="prefetch" href="/assets/immutable.html.3badd863.js"><link rel="prefetch" href="/assets/intern.html.837845af.js"><link rel="prefetch" href="/assets/join.html.aad68fb5.js"><link rel="prefetch" href="/assets/split.html.658044b9.js"><link rel="prefetch" href="/assets/tobebetterjavaer-beian.html.1e07db11.js"><link rel="prefetch" href="/assets/tobebetterjavaer-wangzhan-shangxian.html.d16c48da.js"><link rel="prefetch" href="/assets/tupian-zhuanlian.html.9e79d82d.js"><link rel="prefetch" href="/assets/BlockingQueue.html.64ecf5ff.js"><link rel="prefetch" href="/assets/ConcurrentHashMap.html.e34a92c6.js"><link rel="prefetch" href="/assets/ConcurrentLinkedQueue.html.5d33097d.js"><link rel="prefetch" href="/assets/CopyOnWriteArrayList.html.3b53d588.js"><link rel="prefetch" href="/assets/CountDownLatch.html.1beda295.js"><link rel="prefetch" href="/assets/LockSupport.html.b0aa5f08.js"><link rel="prefetch" href="/assets/ReentrantReadWriteLock.html.52f9da6f.js"><link rel="prefetch" href="/assets/ScheduledThreadPoolExecutor.html.5f8d291f.js"><link rel="prefetch" href="/assets/ThreadLocal.html.e793bcdd.js"><link rel="prefetch" href="/assets/ali-executors.html.b339b6b9.js"><link rel="prefetch" href="/assets/aqs.html.af099d67.js"><link rel="prefetch" href="/assets/atomic.html.8aeb73f4.js"><link rel="prefetch" href="/assets/cas.html.3e45f2bb.js"><link rel="prefetch" href="/assets/condition.html.38256068.js"><link rel="prefetch" href="/assets/fork-join.html.a8bb42e0.js"><link rel="prefetch" href="/assets/jmm.html.41d07a34.js"><link rel="prefetch" href="/assets/lock.html.e6fdaf8d.js"><link rel="prefetch" href="/assets/map.html.d9195965.js"><link rel="prefetch" href="/assets/pool.html.f29c6469.js"><link rel="prefetch" href="/assets/reentrantLock.html.41b364ea.js"><link rel="prefetch" href="/assets/shengchanzhe-xiaofeizhe.html.564a6033.js"><link rel="prefetch" href="/assets/synchronized.html.879d59c3.js"><link rel="prefetch" href="/assets/thread-bring-some-problem.html.1e74a594.js"><link rel="prefetch" href="/assets/thread-group-and-thread-priority.html.51e2a7d6.js"><link rel="prefetch" href="/assets/thread-state-and-method.html.8bed1a07.js"><link rel="prefetch" href="/assets/volatile.html.521af5a9.js"><link rel="prefetch" href="/assets/wangzhe-thread.html.f69c3d8b.js"><link rel="prefetch" href="/assets/why-need-thread.html.340f87fb.js"><link rel="prefetch" href="/assets/aliyun-shuaiguo-gongchengshi.html.51d0809a.js"><link rel="prefetch" href="/assets/chadiansanhuo.html.4b30898d.js"><link rel="prefetch" href="/assets/chengxuyuannv-chonghui-java.html.6b588a31.js"><link rel="prefetch" href="/assets/daxue-nuli-jisuanji.html.d0d85a1f.js"><link rel="prefetch" href="/assets/fumutuanju.html.f4569795.js"><link rel="prefetch" href="/assets/electron-information-engineering.html.3a6d602d.js"><link rel="prefetch" href="/assets/read-csapp.html.b18968d8.js"><link rel="prefetch" href="/assets/algorithm.html.e5037d53.js"><link rel="prefetch" href="/assets/c.html.54fd84e3.js"><link rel="prefetch" href="/assets/ccc.html.80d0e3de.js"><link rel="prefetch" href="/assets/go.html.ced3c556.js"><link rel="prefetch" href="/assets/lanqiaobei.html.cc45b130.js"><link rel="prefetch" href="/assets/os.html.479bab29.js"><link rel="prefetch" href="/assets/python.html.841e442b.js"><link rel="prefetch" href="/assets/qianduan.html.10268940.js"><link rel="prefetch" href="/assets/index.html.7d92bfba.js"><link rel="prefetch" href="/assets/java-mianshi-zhinan.html.2a7ca0a8.js"><link rel="prefetch" href="/assets/index.html.a5729cfa.js"><link rel="prefetch" href="/assets/jibenjieshao.html.a254e918.js"><link rel="prefetch" href="/assets/mysql.html.378ec8fc.js"><link rel="prefetch" href="/assets/collection.html.e8c4206d.js"><link rel="prefetch" href="/assets/javase.html.a9b9ab83.js"><link rel="prefetch" href="/assets/jvm.html.3840860f.js"><link rel="prefetch" href="/assets/mybatis.html.e8fe38bf.js"><link rel="prefetch" href="/assets/nixi.html.01b9562e.js"><link rel="prefetch" href="/assets/redis.html.6fd1634a.js"><link rel="prefetch" href="/assets/spring.html.87214b1e.js"><link rel="prefetch" href="/assets/jvm.html.389cf5b2.js"><link rel="prefetch" href="/assets/thread.html.b51bbb69.js"><link rel="prefetch" href="/assets/yitiaolong.html.9d638d03.js"><link rel="prefetch" href="/assets/404.html.19bff199.js"><link rel="prefetch" href="/assets/404.ba378284.js"><link rel="prefetch" href="/assets/Layout.05028864.js"><link rel="prefetch" href="/assets/Slide.dbc0e8c0.js"><link rel="prefetch" href="/assets/highlight.esm.d982e650.js"><link rel="prefetch" href="/assets/markdown.esm.832a189d.js"><link rel="prefetch" href="/assets/math.esm.a3f84b6f.js"><link rel="prefetch" href="/assets/notes.esm.3c361cb7.js"><link rel="prefetch" href="/assets/reveal.esm.b96f05d8.js"><link rel="prefetch" href="/assets/search.esm.80da4a02.js"><link rel="prefetch" href="/assets/zoom.esm.8514a202.js"><link rel="prefetch" href="/assets/photoswipe.esm.92018b73.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/" class="brand"><img class="logo" src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/logo-02.png" alt="Java ç¨‹åºå‘˜è¿›é˜¶ä¹‹è·¯"><!----><span class="site-name hide-in-pad">Java ç¨‹åºå‘˜è¿›é˜¶ä¹‹è·¯</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/home.html" class="nav-link" aria-label="è¿›é˜¶ä¹‹è·¯"><span class="icon iconfont icon-lujing" style=""></span>è¿›é˜¶ä¹‹è·¯<!----></a></div><div class="nav-item hide-in-mobile"><a href="/zhishixingqiu/java-mianshi-zhinan.html" class="nav-link" aria-label="æ˜Ÿçƒä¸“æ "><span class="icon iconfont icon-Artboard" style=""></span>æ˜Ÿçƒä¸“æ <!----></a></div><div class="nav-item hide-in-mobile"><a href="/xuexiluxian/" class="nav-link" aria-label="å­¦ä¹ è·¯çº¿"><span class="icon iconfont icon-luxian" style=""></span>å­¦ä¹ è·¯çº¿<!----></a></div><div class="nav-item hide-in-mobile"><a href="https://space.bilibili.com/513340480" rel="noopener noreferrer" target="_blank" aria-label="Bç«™è§†é¢‘" class="nav-link"><span class="icon iconfont icon-bzhan" style=""></span>Bç«™è§†é¢‘<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="çè—èµ„æº"><span class="title"><span class="icon iconfont icon-youzhi" style=""></span>çè—èµ„æº</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/download/java.html" class="nav-link" aria-label="Javaç”µå­ä¹¦ä¸‹è½½"><span class="icon iconfont icon-java" style=""></span>Javaç”µå­ä¹¦ä¸‹è½½<!----></a></li><li class="dropdown-item"><a href="/download/pdf.html" class="nav-link" aria-label="PDFå¹²è´§ç¬”è®°ä¸‹è½½"><span class="icon iconfont icon-pdf" style=""></span>PDFå¹²è´§ç¬”è®°ä¸‹è½½<!----></a></li><li class="dropdown-item"><a href="/download/learn-jianyi.html" class="nav-link" aria-label="å­¦ä¹ å»ºè®®"><span class="icon iconfont icon-xuexijianyi" style=""></span>å­¦ä¹ å»ºè®®<!----></a></li><li class="dropdown-item"><a href="/sidebar/sanfene/nixi.html" class="nav-link" aria-label="é¢æ¸£é€†è¢­"><span class="icon iconfont icon-zhunbei" style=""></span>é¢æ¸£é€†è¢­<!----></a></li><li class="dropdown-item"><a href="/download/nicearticle.html" class="nav-link" aria-label="ä¼˜è´¨æ–‡ç« "><span class="icon iconfont icon-youzhi" style=""></span>ä¼˜è´¨æ–‡ç« <!----></a></li><li class="dropdown-item"><a href="/download/history.html" class="nav-link" aria-label="ç½‘ç»œæ—¥å¿—"><span class="icon iconfont icon-rizhi" style=""></span>ç½‘ç»œæ—¥å¿—<!----></a></li><li class="dropdown-item"><a href="https://docsify.tobebetterjavaer.com/" rel="noopener noreferrer" target="_blank" aria-label="å›åˆ°è¿‡å»" class="nav-link"><span class="icon iconfont icon-fanhuijiuban" style=""></span>å›åˆ°è¿‡å»<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul></button></div></div></nav><!----></div><div class="navbar-right"><!----><div class="nav-item"><!----></div><div class="nav-item"><a class="repo-link" href="https://github.com/itwanger/toBeBetterJavaer" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><div id="docsearch-container"></div><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/sidebar/sanfene/javase.html" class="nav-link sidebar-link sidebar-page" aria-label="Java åŸºç¡€"><!---->Java åŸºç¡€<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/sidebar/sanfene/collection.html" class="nav-link sidebar-link sidebar-page" aria-label="Java é›†åˆæ¡†æ¶"><!---->Java é›†åˆæ¡†æ¶<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/sidebar/sanfene/javathread.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="Java å¹¶å‘ç¼–ç¨‹"><!---->Java å¹¶å‘ç¼–ç¨‹<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#åŸºç¡€" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åŸºç¡€"><!---->åŸºç¡€<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_1-å¹¶è¡Œè·Ÿå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.å¹¶è¡Œè·Ÿå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><!---->1.å¹¶è¡Œè·Ÿå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_2-è¯´è¯´ä»€ä¹ˆæ˜¯è¿›ç¨‹å’Œçº¿ç¨‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.è¯´è¯´ä»€ä¹ˆæ˜¯è¿›ç¨‹å’Œçº¿ç¨‹ï¼Ÿ"><!---->2.è¯´è¯´ä»€ä¹ˆæ˜¯è¿›ç¨‹å’Œçº¿ç¨‹ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_3-è¯´è¯´çº¿ç¨‹æœ‰å‡ ç§åˆ›å»ºæ–¹å¼" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.è¯´è¯´çº¿ç¨‹æœ‰å‡ ç§åˆ›å»ºæ–¹å¼ï¼Ÿ"><!---->3.è¯´è¯´çº¿ç¨‹æœ‰å‡ ç§åˆ›å»ºæ–¹å¼ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_4-ä¸ºä»€ä¹ˆè°ƒç”¨start-æ–¹æ³•æ—¶ä¼šæ‰§è¡Œrun-æ–¹æ³•-é‚£æ€ä¹ˆä¸ç›´æ¥è°ƒç”¨run-æ–¹æ³•" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.ä¸ºä»€ä¹ˆè°ƒç”¨start()æ–¹æ³•æ—¶ä¼šæ‰§è¡Œrun()æ–¹æ³•ï¼Œé‚£æ€ä¹ˆä¸ç›´æ¥è°ƒç”¨run()æ–¹æ³•ï¼Ÿ"><!---->4.ä¸ºä»€ä¹ˆè°ƒç”¨start()æ–¹æ³•æ—¶ä¼šæ‰§è¡Œrun()æ–¹æ³•ï¼Œé‚£æ€ä¹ˆä¸ç›´æ¥è°ƒç”¨run()æ–¹æ³•ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_5-çº¿ç¨‹æœ‰å“ªäº›å¸¸ç”¨çš„è°ƒåº¦æ–¹æ³•" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.çº¿ç¨‹æœ‰å“ªäº›å¸¸ç”¨çš„è°ƒåº¦æ–¹æ³•ï¼Ÿ"><!---->5.çº¿ç¨‹æœ‰å“ªäº›å¸¸ç”¨çš„è°ƒåº¦æ–¹æ³•ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_6-çº¿ç¨‹æœ‰å‡ ç§çŠ¶æ€" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.çº¿ç¨‹æœ‰å‡ ç§çŠ¶æ€ï¼Ÿ"><!---->6.çº¿ç¨‹æœ‰å‡ ç§çŠ¶æ€ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_7-ä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7.ä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ"><!---->7.ä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_8-å®ˆæŠ¤çº¿ç¨‹äº†è§£å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.å®ˆæŠ¤çº¿ç¨‹äº†è§£å—ï¼Ÿ"><!---->8.å®ˆæŠ¤çº¿ç¨‹äº†è§£å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_9-çº¿ç¨‹é—´æœ‰å“ªäº›é€šä¿¡æ–¹å¼" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="9.çº¿ç¨‹é—´æœ‰å“ªäº›é€šä¿¡æ–¹å¼ï¼Ÿ"><!---->9.çº¿ç¨‹é—´æœ‰å“ªäº›é€šä¿¡æ–¹å¼ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#threadlocal" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ThreadLocal"><!---->ThreadLocal<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_10-threadlocalæ˜¯ä»€ä¹ˆ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="10.ThreadLocalæ˜¯ä»€ä¹ˆï¼Ÿ"><!---->10.ThreadLocalæ˜¯ä»€ä¹ˆï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_11-ä½ åœ¨å·¥ä½œä¸­ç”¨åˆ°è¿‡threadlocalå—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="11.ä½ åœ¨å·¥ä½œä¸­ç”¨åˆ°è¿‡ThreadLocalå—ï¼Ÿ"><!---->11.ä½ åœ¨å·¥ä½œä¸­ç”¨åˆ°è¿‡ThreadLocalå—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_12-threadlocalæ€ä¹ˆå®ç°çš„å‘¢" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="12.ThreadLocalæ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ"><!---->12.ThreadLocalæ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_13-threadlocal-å†…å­˜æ³„éœ²æ˜¯æ€ä¹ˆå›äº‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="13.ThreadLocal å†…å­˜æ³„éœ²æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ"><!---->13.ThreadLocal å†…å­˜æ³„éœ²æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_14-threadlocalmapçš„ç»“æ„äº†è§£å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="14.ThreadLocalMapçš„ç»“æ„äº†è§£å—ï¼Ÿ"><!---->14.ThreadLocalMapçš„ç»“æ„äº†è§£å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_15-threadlocalmapæ€ä¹ˆè§£å†³hashå†²çªçš„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="15.ThreadLocalMapæ€ä¹ˆè§£å†³Hashå†²çªçš„ï¼Ÿ"><!---->15.ThreadLocalMapæ€ä¹ˆè§£å†³Hashå†²çªçš„ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_16-threadlocalmapæ‰©å®¹æœºåˆ¶äº†è§£å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="16.ThreadLocalMapæ‰©å®¹æœºåˆ¶äº†è§£å—ï¼Ÿ"><!---->16.ThreadLocalMapæ‰©å®¹æœºåˆ¶äº†è§£å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_17-çˆ¶å­çº¿ç¨‹æ€ä¹ˆå…±äº«æ•°æ®" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="17.çˆ¶å­çº¿ç¨‹æ€ä¹ˆå…±äº«æ•°æ®ï¼Ÿ"><!---->17.çˆ¶å­çº¿ç¨‹æ€ä¹ˆå…±äº«æ•°æ®ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#javaå†…å­˜æ¨¡å‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Javaå†…å­˜æ¨¡å‹"><!---->Javaå†…å­˜æ¨¡å‹<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_18-è¯´ä¸€ä¸‹ä½ å¯¹javaå†…å­˜æ¨¡å‹-jmm-çš„ç†è§£" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="18.è¯´ä¸€ä¸‹ä½ å¯¹Javaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰çš„ç†è§£ï¼Ÿ"><!---->18.è¯´ä¸€ä¸‹ä½ å¯¹Javaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰çš„ç†è§£ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_19-è¯´è¯´ä½ å¯¹åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§çš„ç†è§£" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="19.è¯´è¯´ä½ å¯¹åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§çš„ç†è§£ï¼Ÿ"><!---->19.è¯´è¯´ä½ å¯¹åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§çš„ç†è§£ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_20-é‚£è¯´è¯´ä»€ä¹ˆæ˜¯æŒ‡ä»¤é‡æ’" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="20.é‚£è¯´è¯´ä»€ä¹ˆæ˜¯æŒ‡ä»¤é‡æ’ï¼Ÿ"><!---->20.é‚£è¯´è¯´ä»€ä¹ˆæ˜¯æŒ‡ä»¤é‡æ’ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_21-æŒ‡ä»¤é‡æ’æœ‰é™åˆ¶å—-happens-beforeäº†è§£å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="21.æŒ‡ä»¤é‡æ’æœ‰é™åˆ¶å—ï¼Ÿhappens-beforeäº†è§£å—ï¼Ÿ"><!---->21.æŒ‡ä»¤é‡æ’æœ‰é™åˆ¶å—ï¼Ÿhappens-beforeäº†è§£å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_22-as-if-serialåˆæ˜¯ä»€ä¹ˆ-å•çº¿ç¨‹çš„ç¨‹åºä¸€å®šæ˜¯é¡ºåºçš„å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="22.as-if-serialåˆæ˜¯ä»€ä¹ˆï¼Ÿå•çº¿ç¨‹çš„ç¨‹åºä¸€å®šæ˜¯é¡ºåºçš„å—ï¼Ÿ"><!---->22.as-if-serialåˆæ˜¯ä»€ä¹ˆï¼Ÿå•çº¿ç¨‹çš„ç¨‹åºä¸€å®šæ˜¯é¡ºåºçš„å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_23-volatileå®ç°åŸç†äº†è§£å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="23.volatileå®ç°åŸç†äº†è§£å—ï¼Ÿ"><!---->23.volatileå®ç°åŸç†äº†è§£å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#é”" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="é”"><!---->é”<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_24-synchronizedç”¨è¿‡å—-æ€ä¹ˆä½¿ç”¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="24.synchronizedç”¨è¿‡å—ï¼Ÿæ€ä¹ˆä½¿ç”¨ï¼Ÿ"><!---->24.synchronizedç”¨è¿‡å—ï¼Ÿæ€ä¹ˆä½¿ç”¨ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_25-synchronizedçš„å®ç°åŸç†" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="25.synchronizedçš„å®ç°åŸç†ï¼Ÿ"><!---->25.synchronizedçš„å®ç°åŸç†ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_26-é™¤äº†åŸå­æ€§-synchronizedå¯è§æ€§-æœ‰åºæ€§-å¯é‡å…¥æ€§æ€ä¹ˆå®ç°" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="26.é™¤äº†åŸå­æ€§ï¼Œsynchronizedå¯è§æ€§ï¼Œæœ‰åºæ€§ï¼Œå¯é‡å…¥æ€§æ€ä¹ˆå®ç°ï¼Ÿ"><!---->26.é™¤äº†åŸå­æ€§ï¼Œsynchronizedå¯è§æ€§ï¼Œæœ‰åºæ€§ï¼Œå¯é‡å…¥æ€§æ€ä¹ˆå®ç°ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_27-é”å‡çº§-synchronizedä¼˜åŒ–äº†è§£å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="27.é”å‡çº§ï¼Ÿsynchronizedä¼˜åŒ–äº†è§£å—ï¼Ÿ"><!---->27.é”å‡çº§ï¼Ÿsynchronizedä¼˜åŒ–äº†è§£å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_28-è¯´è¯´synchronizedå’Œreentrantlockçš„åŒºåˆ«" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="28.è¯´è¯´synchronizedå’ŒReentrantLockçš„åŒºåˆ«ï¼Ÿ"><!---->28.è¯´è¯´synchronizedå’ŒReentrantLockçš„åŒºåˆ«ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_29-aqsäº†è§£å¤šå°‘" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="29.AQSäº†è§£å¤šå°‘ï¼Ÿ"><!---->29.AQSäº†è§£å¤šå°‘ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_30-reentrantlockå®ç°åŸç†" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="30.ReentrantLockå®ç°åŸç†ï¼Ÿ"><!---->30.ReentrantLockå®ç°åŸç†ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_31-reentrantlockæ€ä¹ˆå®ç°å…¬å¹³é”çš„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="31.ReentrantLockæ€ä¹ˆå®ç°å…¬å¹³é”çš„ï¼Ÿ"><!---->31.ReentrantLockæ€ä¹ˆå®ç°å…¬å¹³é”çš„ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_32-caså‘¢-casäº†è§£å¤šå°‘" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="32.CASå‘¢ï¼ŸCASäº†è§£å¤šå°‘ï¼Ÿ"><!---->32.CASå‘¢ï¼ŸCASäº†è§£å¤šå°‘ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_33-cas-æœ‰ä»€ä¹ˆé—®é¢˜-å¦‚ä½•è§£å†³" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="33.CAS æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ"><!---->33.CAS æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_34-javaæœ‰å“ªäº›ä¿è¯åŸå­æ€§çš„æ–¹æ³•-å¦‚ä½•ä¿è¯å¤šçº¿ç¨‹ä¸‹i-ç»“æœæ­£ç¡®" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="34.Javaæœ‰å“ªäº›ä¿è¯åŸå­æ€§çš„æ–¹æ³•ï¼Ÿå¦‚ä½•ä¿è¯å¤šçº¿ç¨‹ä¸‹i++ ç»“æœæ­£ç¡®ï¼Ÿ"><!---->34.Javaæœ‰å“ªäº›ä¿è¯åŸå­æ€§çš„æ–¹æ³•ï¼Ÿå¦‚ä½•ä¿è¯å¤šçº¿ç¨‹ä¸‹i++ ç»“æœæ­£ç¡®ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_35-åŸå­æ“ä½œç±»äº†è§£å¤šå°‘" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="35.åŸå­æ“ä½œç±»äº†è§£å¤šå°‘ï¼Ÿ"><!---->35.åŸå­æ“ä½œç±»äº†è§£å¤šå°‘ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_36-atomicinteger-çš„åŸç†" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="36.AtomicInteger çš„åŸç†ï¼Ÿ"><!---->36.AtomicInteger çš„åŸç†ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_37-çº¿ç¨‹æ­»é”äº†è§£å—-è¯¥å¦‚ä½•é¿å…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="37.çº¿ç¨‹æ­»é”äº†è§£å—ï¼Ÿè¯¥å¦‚ä½•é¿å…ï¼Ÿ"><!---->37.çº¿ç¨‹æ­»é”äº†è§£å—ï¼Ÿè¯¥å¦‚ä½•é¿å…ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_38-é‚£æ­»é”é—®é¢˜æ€ä¹ˆæ’æŸ¥å‘¢" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="38.é‚£æ­»é”é—®é¢˜æ€ä¹ˆæ’æŸ¥å‘¢ï¼Ÿ"><!---->38.é‚£æ­»é”é—®é¢˜æ€ä¹ˆæ’æŸ¥å‘¢ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#å¹¶å‘å·¥å…·ç±»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¹¶å‘å·¥å…·ç±»"><!---->å¹¶å‘å·¥å…·ç±»<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_39-countdownlatch-å€’è®¡æ•°å™¨-äº†è§£å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="39.CountDownLatchï¼ˆå€’è®¡æ•°å™¨ï¼‰äº†è§£å—ï¼Ÿ"><!---->39.CountDownLatchï¼ˆå€’è®¡æ•°å™¨ï¼‰äº†è§£å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_40-cyclicbarrier-åŒæ­¥å±éšœ-äº†è§£å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="40.CyclicBarrierï¼ˆåŒæ­¥å±éšœï¼‰äº†è§£å—ï¼Ÿ"><!---->40.CyclicBarrierï¼ˆåŒæ­¥å±éšœï¼‰äº†è§£å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_41-cyclicbarrierå’Œcountdownlatchæœ‰ä»€ä¹ˆåŒºåˆ«" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="41.CyclicBarrierå’ŒCountDownLatchæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><!---->41.CyclicBarrierå’ŒCountDownLatchæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_42-semaphore-ä¿¡å·é‡-äº†è§£å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="42.Semaphoreï¼ˆä¿¡å·é‡ï¼‰äº†è§£å—ï¼Ÿ"><!---->42.Semaphoreï¼ˆä¿¡å·é‡ï¼‰äº†è§£å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_43-exchanger-äº†è§£å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="43.Exchanger äº†è§£å—ï¼Ÿ"><!---->43.Exchanger äº†è§£å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#çº¿ç¨‹æ± " class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="çº¿ç¨‹æ± "><!---->çº¿ç¨‹æ± <!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_44-ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± " class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="44.ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿ"><!---->44.ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_45-èƒ½è¯´è¯´å·¥ä½œä¸­çº¿ç¨‹æ± çš„åº”ç”¨å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="45.èƒ½è¯´è¯´å·¥ä½œä¸­çº¿ç¨‹æ± çš„åº”ç”¨å—ï¼Ÿ"><!---->45.èƒ½è¯´è¯´å·¥ä½œä¸­çº¿ç¨‹æ± çš„åº”ç”¨å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_46-èƒ½ç®€å•è¯´ä¸€ä¸‹çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="46.èƒ½ç®€å•è¯´ä¸€ä¸‹çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹å—ï¼Ÿ"><!---->46.èƒ½ç®€å•è¯´ä¸€ä¸‹çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_47-çº¿ç¨‹æ± ä¸»è¦å‚æ•°æœ‰å“ªäº›" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="47.çº¿ç¨‹æ± ä¸»è¦å‚æ•°æœ‰å“ªäº›ï¼Ÿ"><!---->47.çº¿ç¨‹æ± ä¸»è¦å‚æ•°æœ‰å“ªäº›ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_48-çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="48.çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ"><!---->48.çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_49-çº¿ç¨‹æ± æœ‰å“ªå‡ ç§å·¥ä½œé˜Ÿåˆ—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="49.çº¿ç¨‹æ± æœ‰å“ªå‡ ç§å·¥ä½œé˜Ÿåˆ—ï¼Ÿ"><!---->49.çº¿ç¨‹æ± æœ‰å“ªå‡ ç§å·¥ä½œé˜Ÿåˆ—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_50-çº¿ç¨‹æ± æäº¤executeå’Œsubmitæœ‰ä»€ä¹ˆåŒºåˆ«" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="50.çº¿ç¨‹æ± æäº¤executeå’Œsubmitæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><!---->50.çº¿ç¨‹æ± æäº¤executeå’Œsubmitæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_51-çº¿ç¨‹æ± æ€ä¹ˆå…³é—­çŸ¥é“å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="51.çº¿ç¨‹æ± æ€ä¹ˆå…³é—­çŸ¥é“å—ï¼Ÿ"><!---->51.çº¿ç¨‹æ± æ€ä¹ˆå…³é—­çŸ¥é“å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_52-çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°åº”è¯¥æ€ä¹ˆé…ç½®" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="52.çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°åº”è¯¥æ€ä¹ˆé…ç½®ï¼Ÿ"><!---->52.çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°åº”è¯¥æ€ä¹ˆé…ç½®ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_53-æœ‰å“ªå‡ ç§å¸¸è§çš„çº¿ç¨‹æ± " class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="53.æœ‰å“ªå‡ ç§å¸¸è§çš„çº¿ç¨‹æ± ï¼Ÿ"><!---->53.æœ‰å“ªå‡ ç§å¸¸è§çš„çº¿ç¨‹æ± ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_54-èƒ½è¯´ä¸€ä¸‹å››ç§å¸¸è§çº¿ç¨‹æ± çš„åŸç†å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="54.èƒ½è¯´ä¸€ä¸‹å››ç§å¸¸è§çº¿ç¨‹æ± çš„åŸç†å—ï¼Ÿ"><!---->54.èƒ½è¯´ä¸€ä¸‹å››ç§å¸¸è§çº¿ç¨‹æ± çš„åŸç†å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_55-çº¿ç¨‹æ± å¼‚å¸¸æ€ä¹ˆå¤„ç†çŸ¥é“å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="55.çº¿ç¨‹æ± å¼‚å¸¸æ€ä¹ˆå¤„ç†çŸ¥é“å—ï¼Ÿ"><!---->55.çº¿ç¨‹æ± å¼‚å¸¸æ€ä¹ˆå¤„ç†çŸ¥é“å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_56-èƒ½è¯´ä¸€ä¸‹çº¿ç¨‹æ± æœ‰å‡ ç§çŠ¶æ€å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="56.èƒ½è¯´ä¸€ä¸‹çº¿ç¨‹æ± æœ‰å‡ ç§çŠ¶æ€å—ï¼Ÿ"><!---->56.èƒ½è¯´ä¸€ä¸‹çº¿ç¨‹æ± æœ‰å‡ ç§çŠ¶æ€å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_57-çº¿ç¨‹æ± å¦‚ä½•å®ç°å‚æ•°çš„åŠ¨æ€ä¿®æ”¹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="57.çº¿ç¨‹æ± å¦‚ä½•å®ç°å‚æ•°çš„åŠ¨æ€ä¿®æ”¹ï¼Ÿ"><!---->57.çº¿ç¨‹æ± å¦‚ä½•å®ç°å‚æ•°çš„åŠ¨æ€ä¿®æ”¹ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#çº¿ç¨‹æ± è°ƒä¼˜äº†è§£å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="çº¿ç¨‹æ± è°ƒä¼˜äº†è§£å—ï¼Ÿ"><!---->çº¿ç¨‹æ± è°ƒä¼˜äº†è§£å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_58-ä½ èƒ½è®¾è®¡å®ç°ä¸€ä¸ªçº¿ç¨‹æ± å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="58.ä½ èƒ½è®¾è®¡å®ç°ä¸€ä¸ªçº¿ç¨‹æ± å—ï¼Ÿ"><!---->58.ä½ èƒ½è®¾è®¡å®ç°ä¸€ä¸ªçº¿ç¨‹æ± å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_59-å•æœºçº¿ç¨‹æ± æ‰§è¡Œæ–­ç”µäº†åº”è¯¥æ€ä¹ˆå¤„ç†" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="59.å•æœºçº¿ç¨‹æ± æ‰§è¡Œæ–­ç”µäº†åº”è¯¥æ€ä¹ˆå¤„ç†ï¼Ÿ"><!---->59.å•æœºçº¿ç¨‹æ± æ‰§è¡Œæ–­ç”µäº†åº”è¯¥æ€ä¹ˆå¤„ç†ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#å¹¶å‘å®¹å™¨å’Œæ¡†æ¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¹¶å‘å®¹å™¨å’Œæ¡†æ¶"><!---->å¹¶å‘å®¹å™¨å’Œæ¡†æ¶<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_60-fork-joinæ¡†æ¶äº†è§£å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="60.Fork/Joinæ¡†æ¶äº†è§£å—ï¼Ÿ"><!---->60.Fork/Joinæ¡†æ¶äº†è§£å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/sidebar/sanfene/jvm.html" class="nav-link sidebar-link sidebar-page" aria-label="Java è™šæ‹Ÿæœº"><!---->Java è™šæ‹Ÿæœº<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/sidebar/sanfene/spring.html" class="nav-link sidebar-link sidebar-page" aria-label="Spring"><!---->Spring<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/sidebar/sanfene/redis.html" class="nav-link sidebar-link sidebar-page" aria-label="Redis"><!---->Redis<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/sidebar/sanfene/mybatis.html" class="nav-link sidebar-link sidebar-page" aria-label="MyBatis"><!---->MyBatis<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->é¢æ¸£é€†è¢­ï¼ˆJava å¹¶å‘ç¼–ç¨‹ç¯‡ï¼‰å¿…çœ‹ğŸ‘</h1><div class="page-info"><span class="author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://tobebetterjavaer.com" target="_blank" rel="noopener noreferrer">æ²‰é»˜ç‹äºŒ</a></span><span property="author" content="æ²‰é»˜ç‹äºŒ"></span></span><!----><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022å¹´3æœˆ9æ—¥</span><meta property="datePublished" content="2022-03-09T04:47:34.000Z"></span><span class="category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li class="category category3" role>é¢æ¸£é€†è¢­</li><meta property="articleSection" content="é¢æ¸£é€†è¢­"></ul></span><span aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li class="tag tag4" role>Java</li></ul><meta property="keywords" content="Java"></span><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 79 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT79M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#åŸºç¡€" class="router-link-active router-link-exact-active toc-link level2">åŸºç¡€</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_1-å¹¶è¡Œè·Ÿå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«" class="router-link-active router-link-exact-active toc-link level3">1.å¹¶è¡Œè·Ÿå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_2-è¯´è¯´ä»€ä¹ˆæ˜¯è¿›ç¨‹å’Œçº¿ç¨‹" class="router-link-active router-link-exact-active toc-link level3">2.è¯´è¯´ä»€ä¹ˆæ˜¯è¿›ç¨‹å’Œçº¿ç¨‹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_3-è¯´è¯´çº¿ç¨‹æœ‰å‡ ç§åˆ›å»ºæ–¹å¼" class="router-link-active router-link-exact-active toc-link level3">3.è¯´è¯´çº¿ç¨‹æœ‰å‡ ç§åˆ›å»ºæ–¹å¼ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_4-ä¸ºä»€ä¹ˆè°ƒç”¨start-æ–¹æ³•æ—¶ä¼šæ‰§è¡Œrun-æ–¹æ³•-é‚£æ€ä¹ˆä¸ç›´æ¥è°ƒç”¨run-æ–¹æ³•" class="router-link-active router-link-exact-active toc-link level3">4.ä¸ºä»€ä¹ˆè°ƒç”¨start()æ–¹æ³•æ—¶ä¼šæ‰§è¡Œrun()æ–¹æ³•ï¼Œé‚£æ€ä¹ˆä¸ç›´æ¥è°ƒç”¨run()æ–¹æ³•ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_5-çº¿ç¨‹æœ‰å“ªäº›å¸¸ç”¨çš„è°ƒåº¦æ–¹æ³•" class="router-link-active router-link-exact-active toc-link level3">5.çº¿ç¨‹æœ‰å“ªäº›å¸¸ç”¨çš„è°ƒåº¦æ–¹æ³•ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_6-çº¿ç¨‹æœ‰å‡ ç§çŠ¶æ€" class="router-link-active router-link-exact-active toc-link level3">6.çº¿ç¨‹æœ‰å‡ ç§çŠ¶æ€ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_7-ä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢" class="router-link-active router-link-exact-active toc-link level3">7.ä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_8-å®ˆæŠ¤çº¿ç¨‹äº†è§£å—" class="router-link-active router-link-exact-active toc-link level3">8.å®ˆæŠ¤çº¿ç¨‹äº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_9-çº¿ç¨‹é—´æœ‰å“ªäº›é€šä¿¡æ–¹å¼" class="router-link-active router-link-exact-active toc-link level3">9.çº¿ç¨‹é—´æœ‰å“ªäº›é€šä¿¡æ–¹å¼ï¼Ÿ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#threadlocal" class="router-link-active router-link-exact-active toc-link level2">ThreadLocal</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_10-threadlocalæ˜¯ä»€ä¹ˆ" class="router-link-active router-link-exact-active toc-link level3">10.ThreadLocalæ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_11-ä½ åœ¨å·¥ä½œä¸­ç”¨åˆ°è¿‡threadlocalå—" class="router-link-active router-link-exact-active toc-link level3">11.ä½ åœ¨å·¥ä½œä¸­ç”¨åˆ°è¿‡ThreadLocalå—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_12-threadlocalæ€ä¹ˆå®ç°çš„å‘¢" class="router-link-active router-link-exact-active toc-link level3">12.ThreadLocalæ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_13-threadlocal-å†…å­˜æ³„éœ²æ˜¯æ€ä¹ˆå›äº‹" class="router-link-active router-link-exact-active toc-link level3">13.ThreadLocal å†…å­˜æ³„éœ²æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_14-threadlocalmapçš„ç»“æ„äº†è§£å—" class="router-link-active router-link-exact-active toc-link level3">14.ThreadLocalMapçš„ç»“æ„äº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_15-threadlocalmapæ€ä¹ˆè§£å†³hashå†²çªçš„" class="router-link-active router-link-exact-active toc-link level3">15.ThreadLocalMapæ€ä¹ˆè§£å†³Hashå†²çªçš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_16-threadlocalmapæ‰©å®¹æœºåˆ¶äº†è§£å—" class="router-link-active router-link-exact-active toc-link level3">16.ThreadLocalMapæ‰©å®¹æœºåˆ¶äº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_17-çˆ¶å­çº¿ç¨‹æ€ä¹ˆå…±äº«æ•°æ®" class="router-link-active router-link-exact-active toc-link level3">17.çˆ¶å­çº¿ç¨‹æ€ä¹ˆå…±äº«æ•°æ®ï¼Ÿ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#javaå†…å­˜æ¨¡å‹" class="router-link-active router-link-exact-active toc-link level2">Javaå†…å­˜æ¨¡å‹</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_18-è¯´ä¸€ä¸‹ä½ å¯¹javaå†…å­˜æ¨¡å‹-jmm-çš„ç†è§£" class="router-link-active router-link-exact-active toc-link level3">18.è¯´ä¸€ä¸‹ä½ å¯¹Javaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰çš„ç†è§£ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_19-è¯´è¯´ä½ å¯¹åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§çš„ç†è§£" class="router-link-active router-link-exact-active toc-link level3">19.è¯´è¯´ä½ å¯¹åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§çš„ç†è§£ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_20-é‚£è¯´è¯´ä»€ä¹ˆæ˜¯æŒ‡ä»¤é‡æ’" class="router-link-active router-link-exact-active toc-link level3">20.é‚£è¯´è¯´ä»€ä¹ˆæ˜¯æŒ‡ä»¤é‡æ’ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_21-æŒ‡ä»¤é‡æ’æœ‰é™åˆ¶å—-happens-beforeäº†è§£å—" class="router-link-active router-link-exact-active toc-link level3">21.æŒ‡ä»¤é‡æ’æœ‰é™åˆ¶å—ï¼Ÿhappens-beforeäº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_22-as-if-serialåˆæ˜¯ä»€ä¹ˆ-å•çº¿ç¨‹çš„ç¨‹åºä¸€å®šæ˜¯é¡ºåºçš„å—" class="router-link-active router-link-exact-active toc-link level3">22.as-if-serialåˆæ˜¯ä»€ä¹ˆï¼Ÿå•çº¿ç¨‹çš„ç¨‹åºä¸€å®šæ˜¯é¡ºåºçš„å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_23-volatileå®ç°åŸç†äº†è§£å—" class="router-link-active router-link-exact-active toc-link level3">23.volatileå®ç°åŸç†äº†è§£å—ï¼Ÿ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#é”" class="router-link-active router-link-exact-active toc-link level2">é”</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_24-synchronizedç”¨è¿‡å—-æ€ä¹ˆä½¿ç”¨" class="router-link-active router-link-exact-active toc-link level3">24.synchronizedç”¨è¿‡å—ï¼Ÿæ€ä¹ˆä½¿ç”¨ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_25-synchronizedçš„å®ç°åŸç†" class="router-link-active router-link-exact-active toc-link level3">25.synchronizedçš„å®ç°åŸç†ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_26-é™¤äº†åŸå­æ€§-synchronizedå¯è§æ€§-æœ‰åºæ€§-å¯é‡å…¥æ€§æ€ä¹ˆå®ç°" class="router-link-active router-link-exact-active toc-link level3">26.é™¤äº†åŸå­æ€§ï¼Œsynchronizedå¯è§æ€§ï¼Œæœ‰åºæ€§ï¼Œå¯é‡å…¥æ€§æ€ä¹ˆå®ç°ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_27-é”å‡çº§-synchronizedä¼˜åŒ–äº†è§£å—" class="router-link-active router-link-exact-active toc-link level3">27.é”å‡çº§ï¼Ÿsynchronizedä¼˜åŒ–äº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_28-è¯´è¯´synchronizedå’Œreentrantlockçš„åŒºåˆ«" class="router-link-active router-link-exact-active toc-link level3">28.è¯´è¯´synchronizedå’ŒReentrantLockçš„åŒºåˆ«ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_29-aqsäº†è§£å¤šå°‘" class="router-link-active router-link-exact-active toc-link level3">29.AQSäº†è§£å¤šå°‘ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_30-reentrantlockå®ç°åŸç†" class="router-link-active router-link-exact-active toc-link level3">30.ReentrantLockå®ç°åŸç†ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_31-reentrantlockæ€ä¹ˆå®ç°å…¬å¹³é”çš„" class="router-link-active router-link-exact-active toc-link level3">31.ReentrantLockæ€ä¹ˆå®ç°å…¬å¹³é”çš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_32-caså‘¢-casäº†è§£å¤šå°‘" class="router-link-active router-link-exact-active toc-link level3">32.CASå‘¢ï¼ŸCASäº†è§£å¤šå°‘ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_33-cas-æœ‰ä»€ä¹ˆé—®é¢˜-å¦‚ä½•è§£å†³" class="router-link-active router-link-exact-active toc-link level3">33.CAS æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_34-javaæœ‰å“ªäº›ä¿è¯åŸå­æ€§çš„æ–¹æ³•-å¦‚ä½•ä¿è¯å¤šçº¿ç¨‹ä¸‹i-ç»“æœæ­£ç¡®" class="router-link-active router-link-exact-active toc-link level3">34.Javaæœ‰å“ªäº›ä¿è¯åŸå­æ€§çš„æ–¹æ³•ï¼Ÿå¦‚ä½•ä¿è¯å¤šçº¿ç¨‹ä¸‹i++ ç»“æœæ­£ç¡®ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_35-åŸå­æ“ä½œç±»äº†è§£å¤šå°‘" class="router-link-active router-link-exact-active toc-link level3">35.åŸå­æ“ä½œç±»äº†è§£å¤šå°‘ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_36-atomicinteger-çš„åŸç†" class="router-link-active router-link-exact-active toc-link level3">36.AtomicInteger çš„åŸç†ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_37-çº¿ç¨‹æ­»é”äº†è§£å—-è¯¥å¦‚ä½•é¿å…" class="router-link-active router-link-exact-active toc-link level3">37.çº¿ç¨‹æ­»é”äº†è§£å—ï¼Ÿè¯¥å¦‚ä½•é¿å…ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_38-é‚£æ­»é”é—®é¢˜æ€ä¹ˆæ’æŸ¥å‘¢" class="router-link-active router-link-exact-active toc-link level3">38.é‚£æ­»é”é—®é¢˜æ€ä¹ˆæ’æŸ¥å‘¢ï¼Ÿ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#å¹¶å‘å·¥å…·ç±»" class="router-link-active router-link-exact-active toc-link level2">å¹¶å‘å·¥å…·ç±»</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_39-countdownlatch-å€’è®¡æ•°å™¨-äº†è§£å—" class="router-link-active router-link-exact-active toc-link level3">39.CountDownLatchï¼ˆå€’è®¡æ•°å™¨ï¼‰äº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_40-cyclicbarrier-åŒæ­¥å±éšœ-äº†è§£å—" class="router-link-active router-link-exact-active toc-link level3">40.CyclicBarrierï¼ˆåŒæ­¥å±éšœï¼‰äº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_41-cyclicbarrierå’Œcountdownlatchæœ‰ä»€ä¹ˆåŒºåˆ«" class="router-link-active router-link-exact-active toc-link level3">41.CyclicBarrierå’ŒCountDownLatchæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_42-semaphore-ä¿¡å·é‡-äº†è§£å—" class="router-link-active router-link-exact-active toc-link level3">42.Semaphoreï¼ˆä¿¡å·é‡ï¼‰äº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_43-exchanger-äº†è§£å—" class="router-link-active router-link-exact-active toc-link level3">43.Exchanger äº†è§£å—ï¼Ÿ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#çº¿ç¨‹æ± " class="router-link-active router-link-exact-active toc-link level2">çº¿ç¨‹æ± </a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_44-ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± " class="router-link-active router-link-exact-active toc-link level3">44.ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_45-èƒ½è¯´è¯´å·¥ä½œä¸­çº¿ç¨‹æ± çš„åº”ç”¨å—" class="router-link-active router-link-exact-active toc-link level3">45.èƒ½è¯´è¯´å·¥ä½œä¸­çº¿ç¨‹æ± çš„åº”ç”¨å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_46-èƒ½ç®€å•è¯´ä¸€ä¸‹çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹å—" class="router-link-active router-link-exact-active toc-link level3">46.èƒ½ç®€å•è¯´ä¸€ä¸‹çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_47-çº¿ç¨‹æ± ä¸»è¦å‚æ•°æœ‰å“ªäº›" class="router-link-active router-link-exact-active toc-link level3">47.çº¿ç¨‹æ± ä¸»è¦å‚æ•°æœ‰å“ªäº›ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_48-çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›" class="router-link-active router-link-exact-active toc-link level3">48.çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_49-çº¿ç¨‹æ± æœ‰å“ªå‡ ç§å·¥ä½œé˜Ÿåˆ—" class="router-link-active router-link-exact-active toc-link level3">49.çº¿ç¨‹æ± æœ‰å“ªå‡ ç§å·¥ä½œé˜Ÿåˆ—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_50-çº¿ç¨‹æ± æäº¤executeå’Œsubmitæœ‰ä»€ä¹ˆåŒºåˆ«" class="router-link-active router-link-exact-active toc-link level3">50.çº¿ç¨‹æ± æäº¤executeå’Œsubmitæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_51-çº¿ç¨‹æ± æ€ä¹ˆå…³é—­çŸ¥é“å—" class="router-link-active router-link-exact-active toc-link level3">51.çº¿ç¨‹æ± æ€ä¹ˆå…³é—­çŸ¥é“å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_52-çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°åº”è¯¥æ€ä¹ˆé…ç½®" class="router-link-active router-link-exact-active toc-link level3">52.çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°åº”è¯¥æ€ä¹ˆé…ç½®ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_53-æœ‰å“ªå‡ ç§å¸¸è§çš„çº¿ç¨‹æ± " class="router-link-active router-link-exact-active toc-link level3">53.æœ‰å“ªå‡ ç§å¸¸è§çš„çº¿ç¨‹æ± ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_54-èƒ½è¯´ä¸€ä¸‹å››ç§å¸¸è§çº¿ç¨‹æ± çš„åŸç†å—" class="router-link-active router-link-exact-active toc-link level3">54.èƒ½è¯´ä¸€ä¸‹å››ç§å¸¸è§çº¿ç¨‹æ± çš„åŸç†å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_55-çº¿ç¨‹æ± å¼‚å¸¸æ€ä¹ˆå¤„ç†çŸ¥é“å—" class="router-link-active router-link-exact-active toc-link level3">55.çº¿ç¨‹æ± å¼‚å¸¸æ€ä¹ˆå¤„ç†çŸ¥é“å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_56-èƒ½è¯´ä¸€ä¸‹çº¿ç¨‹æ± æœ‰å‡ ç§çŠ¶æ€å—" class="router-link-active router-link-exact-active toc-link level3">56.èƒ½è¯´ä¸€ä¸‹çº¿ç¨‹æ± æœ‰å‡ ç§çŠ¶æ€å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_57-çº¿ç¨‹æ± å¦‚ä½•å®ç°å‚æ•°çš„åŠ¨æ€ä¿®æ”¹" class="router-link-active router-link-exact-active toc-link level3">57.çº¿ç¨‹æ± å¦‚ä½•å®ç°å‚æ•°çš„åŠ¨æ€ä¿®æ”¹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#çº¿ç¨‹æ± è°ƒä¼˜äº†è§£å—" class="router-link-active router-link-exact-active toc-link level3">çº¿ç¨‹æ± è°ƒä¼˜äº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_58-ä½ èƒ½è®¾è®¡å®ç°ä¸€ä¸ªçº¿ç¨‹æ± å—" class="router-link-active router-link-exact-active toc-link level3">58.ä½ èƒ½è®¾è®¡å®ç°ä¸€ä¸ªçº¿ç¨‹æ± å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_59-å•æœºçº¿ç¨‹æ± æ‰§è¡Œæ–­ç”µäº†åº”è¯¥æ€ä¹ˆå¤„ç†" class="router-link-active router-link-exact-active toc-link level3">59.å•æœºçº¿ç¨‹æ± æ‰§è¡Œæ–­ç”µäº†åº”è¯¥æ€ä¹ˆå¤„ç†ï¼Ÿ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#å¹¶å‘å®¹å™¨å’Œæ¡†æ¶" class="router-link-active router-link-exact-active toc-link level2">å¹¶å‘å®¹å™¨å’Œæ¡†æ¶</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/sidebar/sanfene/javathread.html#_60-fork-joinæ¡†æ¶äº†è§£å—" class="router-link-active router-link-exact-active toc-link level3">60.Fork/Joinæ¡†æ¶äº†è§£å—ï¼Ÿ</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="é¢æ¸£é€†è¢­-java-å¹¶å‘ç¼–ç¨‹ç¯‡-å¿…çœ‹" tabindex="-1"><a class="header-anchor" href="#é¢æ¸£é€†è¢­-java-å¹¶å‘ç¼–ç¨‹ç¯‡-å¿…çœ‹" aria-hidden="true">#</a> é¢æ¸£é€†è¢­ï¼ˆJava å¹¶å‘ç¼–ç¨‹ç¯‡ï¼‰å¿…çœ‹ğŸ‘</h1><blockquote><p>å›¾æ–‡è¯¦è§£ 60 é“Javaå¹¶å‘é¢è¯•é«˜é¢‘é¢˜ï¼Œè¿™æ¬¡é¢è¯•ï¼Œä¸€å®šåŠæ‰“é¢è¯•å®˜ï¼Œæ•´ç†ï¼šæ²‰é»˜ç‹äºŒï¼Œæˆ³<a href="https://mp.weixin.qq.com/s/bImCIoYsH_JEzTkBx2lj4A" target="_blank" rel="noopener noreferrer">è½¬è½½é“¾æ¥<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œä½œè€…ï¼šä¸‰åˆ†æ¶ï¼Œæˆ³<a href="https://mp.weixin.qq.com/s/1jhBZrAb7bnvkgN1TgAUpw" target="_blank" rel="noopener noreferrer">åŸæ–‡é“¾æ¥<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p></blockquote><h2 id="åŸºç¡€" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€" aria-hidden="true">#</a> åŸºç¡€</h2><h3 id="_1-å¹¶è¡Œè·Ÿå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_1-å¹¶è¡Œè·Ÿå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«" aria-hidden="true">#</a> 1.å¹¶è¡Œè·Ÿå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>ä»æ“ä½œç³»ç»Ÿçš„è§’åº¦æ¥çœ‹ï¼Œçº¿ç¨‹æ˜¯CPUåˆ†é…çš„æœ€å°å•ä½ã€‚</p><ul><li>å¹¶è¡Œå°±æ˜¯åŒä¸€æ—¶åˆ»ï¼Œä¸¤ä¸ªçº¿ç¨‹éƒ½åœ¨æ‰§è¡Œã€‚è¿™å°±è¦æ±‚æœ‰ä¸¤ä¸ªCPUå»åˆ†åˆ«æ‰§è¡Œä¸¤ä¸ªçº¿ç¨‹ã€‚</li><li>å¹¶å‘å°±æ˜¯åŒä¸€æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªæ‰§è¡Œï¼Œä½†æ˜¯ä¸€ä¸ªæ—¶é—´æ®µå†…ï¼Œä¸¤ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œäº†ã€‚å¹¶å‘çš„å®ç°ä¾èµ–äºCPUåˆ‡æ¢çº¿ç¨‹ï¼Œå› ä¸ºåˆ‡æ¢çš„æ—¶é—´ç‰¹åˆ«çŸ­ï¼Œæ‰€ä»¥åŸºæœ¬å¯¹äºç”¨æˆ·æ˜¯æ— æ„ŸçŸ¥çš„ã€‚</li></ul><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-1.png" alt="å¹¶è¡Œå’Œå¹¶å‘"></p><p>å°±å¥½åƒæˆ‘ä»¬å»é£Ÿå ‚æ‰“é¥­ï¼Œå¹¶è¡Œå°±æ˜¯æˆ‘ä»¬åœ¨å¤šä¸ªçª—å£æ’é˜Ÿï¼Œå‡ ä¸ªé˜¿å§¨åŒæ—¶æ‰“èœï¼›å¹¶å‘å°±æ˜¯æˆ‘ä»¬æŒ¤åœ¨ä¸€ä¸ªçª—å£ï¼Œé˜¿å§¨ç»™è¿™ä¸ªæ‰“ä¸€å‹ºï¼Œåˆæ‰‹å¿™è„šä¹±åœ°ç»™é‚£ä¸ªæ‰“ä¸€å‹ºã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-2.png" alt="å¹¶è¡Œå¹¶å‘å’Œé£Ÿå ‚æ‰“é¥­"></p><h3 id="_2-è¯´è¯´ä»€ä¹ˆæ˜¯è¿›ç¨‹å’Œçº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#_2-è¯´è¯´ä»€ä¹ˆæ˜¯è¿›ç¨‹å’Œçº¿ç¨‹" aria-hidden="true">#</a> 2.è¯´è¯´ä»€ä¹ˆæ˜¯è¿›ç¨‹å’Œçº¿ç¨‹ï¼Ÿ</h3><p>è¦è¯´çº¿ç¨‹ï¼Œå¿…é¡»å¾—å…ˆè¯´è¯´è¿›ç¨‹ã€‚</p><ul><li>è¿›ç¨‹ï¼šè¿›ç¨‹æ˜¯ä»£ç åœ¨æ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚</li><li>çº¿ç¨‹ï¼šçº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€ä¸ªæ‰§è¡Œè·¯å¾„ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„èµ„æºã€‚</li></ul><p>æ“ä½œç³»ç»Ÿåœ¨åˆ†é…èµ„æºæ—¶æ˜¯æŠŠèµ„æºåˆ†é…ç»™è¿›ç¨‹çš„ï¼Œ ä½†æ˜¯ CPU èµ„æºæ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒæ˜¯è¢«åˆ†é…åˆ°çº¿ç¨‹çš„ï¼Œå› ä¸ºçœŸæ­£è¦å ç”¨CPUè¿è¡Œçš„æ˜¯çº¿ç¨‹ï¼Œæ‰€ä»¥ä¹Ÿè¯´çº¿ç¨‹æ˜¯ CPUåˆ†é…çš„åŸºæœ¬å•ä½ã€‚</p><p>æ¯”å¦‚åœ¨Javaä¸­ï¼Œå½“æˆ‘ä»¬å¯åŠ¨ main å‡½æ•°å…¶å®å°±å¯åŠ¨äº†ä¸€ä¸ªJVMè¿›ç¨‹ï¼Œè€Œ main å‡½æ•°åœ¨çš„çº¿ç¨‹å°±æ˜¯è¿™ä¸ªè¿›ç¨‹ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿç§°ä¸»çº¿ç¨‹ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-3.png" alt="ç¨‹åºè¿›ç¨‹çº¿ç¨‹å…³ç³»"></p><p>ä¸€ä¸ªè¿›ç¨‹ä¸­æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå¤šä¸ªçº¿ç¨‹å…±ç”¨è¿›ç¨‹çš„å †å’Œæ–¹æ³•åŒºèµ„æºï¼Œä½†æ˜¯æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨å’Œæ ˆã€‚</p><h3 id="_3-è¯´è¯´çº¿ç¨‹æœ‰å‡ ç§åˆ›å»ºæ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_3-è¯´è¯´çº¿ç¨‹æœ‰å‡ ç§åˆ›å»ºæ–¹å¼" aria-hidden="true">#</a> 3.è¯´è¯´çº¿ç¨‹æœ‰å‡ ç§åˆ›å»ºæ–¹å¼ï¼Ÿ</h3><p>Javaä¸­åˆ›å»ºçº¿ç¨‹ä¸»è¦æœ‰ä¸‰ç§æ–¹å¼ï¼Œåˆ†åˆ«ä¸ºç»§æ‰¿Threadç±»ã€å®ç°Runnableæ¥å£ã€å®ç°Callableæ¥å£ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-4.png" alt="çº¿ç¨‹åˆ›å»ºä¸‰ç§æ–¹å¼"></p><ul><li>ç»§æ‰¿Threadç±»ï¼Œé‡å†™run()æ–¹æ³•ï¼Œè°ƒç”¨start()æ–¹æ³•å¯åŠ¨çº¿ç¨‹</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadTest</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * ç»§æ‰¿Threadç±»
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;This is child thread&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MyThread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å®ç° Runnable æ¥å£ï¼Œé‡å†™run()æ–¹æ³•</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RunnableTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Runnable!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RunnableTask</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RunnableTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢ä¸¤ç§éƒ½æ˜¯æ²¡æœ‰è¿”å›å€¼çš„ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦è·å–çº¿ç¨‹çš„æ‰§è¡Œç»“æœï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><ul><li>å®ç°Callableæ¥å£ï¼Œé‡å†™call()æ–¹æ³•ï¼Œè¿™ç§æ–¹å¼å¯ä»¥é€šè¿‡FutureTaskè·å–ä»»åŠ¡æ‰§è¡Œçš„è¿”å›å€¼</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CallerTask</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Hello,i am running!&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//åˆ›å»ºå¼‚æ­¥ä»»åŠ¡</span>
        <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> task<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CallerTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å¯åŠ¨çº¿ç¨‹</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//ç­‰å¾…æ‰§è¡Œå®Œæˆï¼Œå¹¶è·å–è¿”å›ç»“æœ</span>
            <span class="token class-name">String</span> result<span class="token operator">=</span>task<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ExecutionException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-ä¸ºä»€ä¹ˆè°ƒç”¨start-æ–¹æ³•æ—¶ä¼šæ‰§è¡Œrun-æ–¹æ³•-é‚£æ€ä¹ˆä¸ç›´æ¥è°ƒç”¨run-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_4-ä¸ºä»€ä¹ˆè°ƒç”¨start-æ–¹æ³•æ—¶ä¼šæ‰§è¡Œrun-æ–¹æ³•-é‚£æ€ä¹ˆä¸ç›´æ¥è°ƒç”¨run-æ–¹æ³•" aria-hidden="true">#</a> 4.ä¸ºä»€ä¹ˆè°ƒç”¨start()æ–¹æ³•æ—¶ä¼šæ‰§è¡Œrun()æ–¹æ³•ï¼Œé‚£æ€ä¹ˆä¸ç›´æ¥è°ƒç”¨run()æ–¹æ³•ï¼Ÿ</h3><p>JVMæ‰§è¡Œstartæ–¹æ³•ï¼Œä¼šå…ˆåˆ›å»ºä¸€æ¡çº¿ç¨‹ï¼Œç”±åˆ›å»ºå‡ºæ¥çš„æ–°çº¿ç¨‹å»æ‰§è¡Œthreadçš„runæ–¹æ³•ï¼Œè¿™æ‰èµ·åˆ°å¤šçº¿ç¨‹çš„æ•ˆæœã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-5.png" alt="startæ–¹æ³•"></p><p>**ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½ç›´æ¥è°ƒç”¨run()æ–¹æ³•ï¼Ÿ**ä¹Ÿå¾ˆæ¸…æ¥šï¼Œ å¦‚æœç›´æ¥è°ƒç”¨Threadçš„run()æ–¹æ³•ï¼Œé‚£ä¹ˆrunæ–¹æ³•è¿˜æ˜¯è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œç›¸å½“äºé¡ºåºæ‰§è¡Œï¼Œå°±èµ·ä¸åˆ°å¤šçº¿ç¨‹çš„æ•ˆæœã€‚</p><h3 id="_5-çº¿ç¨‹æœ‰å“ªäº›å¸¸ç”¨çš„è°ƒåº¦æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_5-çº¿ç¨‹æœ‰å“ªäº›å¸¸ç”¨çš„è°ƒåº¦æ–¹æ³•" aria-hidden="true">#</a> 5.çº¿ç¨‹æœ‰å“ªäº›å¸¸ç”¨çš„è°ƒåº¦æ–¹æ³•ï¼Ÿ</h3><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-6.png" alt="çº¿ç¨‹å¸¸ç”¨è°ƒåº¦æ–¹æ³•"></p><p><strong>çº¿ç¨‹ç­‰å¾…ä¸é€šçŸ¥</strong></p><p>åœ¨Objectç±»ä¸­æœ‰ä¸€äº›å‡½æ•°å¯ä»¥ç”¨äºçº¿ç¨‹çš„ç­‰å¾…ä¸é€šçŸ¥ã€‚</p><ul><li><p>wait()ï¼šå½“ä¸€ä¸ªçº¿ç¨‹Aè°ƒç”¨ä¸€ä¸ªå…±äº«å˜é‡çš„ wait()æ–¹æ³•æ—¶ï¼Œ çº¿ç¨‹Aä¼šè¢«é˜»å¡æŒ‚èµ·ï¼Œ å‘ç”Ÿä¸‹é¢å‡ ç§æƒ…å†µæ‰ä¼šè¿”å› ï¼š</p><ul><li><p>ï¼ˆ1ï¼‰ çº¿ç¨‹Aè°ƒç”¨äº†å…±äº«å¯¹è±¡ notify()æˆ–è€… notifyAll()æ–¹æ³•ï¼›</p></li><li><p>ï¼ˆ2ï¼‰å…¶ä»–çº¿ç¨‹è°ƒç”¨äº†çº¿ç¨‹Açš„ interrupt() æ–¹æ³•ï¼Œçº¿ç¨‹AæŠ›å‡ºInterruptedExceptionå¼‚å¸¸è¿”å›ã€‚</p></li></ul></li><li><p>wait(long timeout) ï¼šè¿™ä¸ªæ–¹æ³•ç›¸æ¯” wait() æ–¹æ³•å¤šäº†ä¸€ä¸ªè¶…æ—¶å‚æ•°ï¼Œå®ƒçš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œå¦‚æœçº¿ç¨‹Aè°ƒç”¨å…±äº«å¯¹è±¡çš„wait(long timeout)æ–¹æ³•åï¼Œæ²¡æœ‰åœ¨æŒ‡å®šçš„ timeout msæ—¶é—´å†…è¢«å…¶å®ƒçº¿ç¨‹å”¤é†’ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•è¿˜æ˜¯ä¼šå› ä¸ºè¶…æ—¶è€Œè¿”å›ã€‚</p></li><li><p>wait(long timeout, int nanos)ï¼Œå…¶å†…éƒ¨è°ƒç”¨çš„æ˜¯ wait(long timoutï¼‰å‡½æ•°ã€‚</p></li></ul><p>ä¸Šé¢æ˜¯çº¿ç¨‹ç­‰å¾…çš„æ–¹æ³•ï¼Œè€Œå”¤é†’çº¿ç¨‹ä¸»è¦æ˜¯ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•ï¼š</p><ul><li>notify() : ä¸€ä¸ªçº¿ç¨‹Aè°ƒç”¨å…±äº«å¯¹è±¡çš„ notify() æ–¹æ³•åï¼Œä¼šå”¤é†’ä¸€ä¸ªåœ¨è¿™ä¸ªå…±äº«å˜é‡ä¸Šè°ƒç”¨ wait ç³»åˆ—æ–¹æ³•åè¢«æŒ‚èµ·çš„çº¿ç¨‹ã€‚ ä¸€ä¸ªå…±äº«å˜é‡ä¸Šå¯èƒ½ä¼šæœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…ï¼Œå…·ä½“å”¤é†’å“ªä¸ªç­‰å¾…çš„çº¿ç¨‹æ˜¯éšæœºçš„ã€‚</li><li>notifyAll() ï¼šä¸åŒäºåœ¨å…±äº«å˜é‡ä¸Šè°ƒç”¨ notify() å‡½æ•°ä¼šå”¤é†’è¢«é˜»å¡åˆ°è¯¥å…±äº«å˜é‡ä¸Šçš„ä¸€ä¸ªçº¿ç¨‹ï¼ŒnotifyAll()æ–¹æ³•åˆ™ä¼šå”¤é†’æ‰€æœ‰åœ¨è¯¥å…±äº«å˜é‡ä¸Šç”±äºè°ƒç”¨ wait ç³»åˆ—æ–¹æ³•è€Œè¢«æŒ‚èµ·çš„çº¿ç¨‹ã€‚</li></ul><p>Threadç±»ä¹Ÿæä¾›äº†ä¸€ä¸ªæ–¹æ³•ç”¨äºç­‰å¾…çš„æ–¹æ³•ï¼š</p><ul><li><p>join()ï¼šå¦‚æœä¸€ä¸ªçº¿ç¨‹Aæ‰§è¡Œäº†thread.join()è¯­å¥ï¼Œå…¶å«ä¹‰æ˜¯ï¼šå½“å‰çº¿ç¨‹Aç­‰å¾…threadçº¿ç¨‹ç»ˆæ­¢ä¹‹åæ‰</p><p>ä»thread.join()è¿”å›ã€‚</p></li></ul><p><strong>çº¿ç¨‹ä¼‘çœ </strong></p><ul><li>sleep(long millis) :Threadç±»ä¸­çš„é™æ€æ–¹æ³•ï¼Œå½“ä¸€ä¸ªæ‰§è¡Œä¸­çš„çº¿ç¨‹Aè°ƒç”¨äº†Thread çš„sleepæ–¹æ³•åï¼Œçº¿ç¨‹Aä¼šæš‚æ—¶è®©å‡ºæŒ‡å®šæ—¶é—´çš„æ‰§è¡Œæƒï¼Œä½†æ˜¯çº¿ç¨‹Aæ‰€æ‹¥æœ‰çš„ç›‘è§†å™¨èµ„æºï¼Œæ¯”å¦‚é”è¿˜æ˜¯æŒæœ‰ä¸è®©å‡ºçš„ã€‚æŒ‡å®šçš„ç¡çœ æ—¶é—´åˆ°äº†åè¯¥å‡½æ•°ä¼šæ­£å¸¸è¿”å›ï¼Œæ¥ç€å‚ä¸ CPU çš„è°ƒåº¦ï¼Œè·å–åˆ° CPU èµ„æºåå°±å¯ä»¥ç»§ç»­è¿è¡Œã€‚</li></ul><p><strong>è®©å‡ºä¼˜å…ˆæƒ</strong></p><ul><li>yield() ï¼šThreadç±»ä¸­çš„é™æ€æ–¹æ³•ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ yield æ–¹æ³•æ—¶ï¼Œå®é™…å°±æ˜¯åœ¨æš—ç¤ºçº¿ç¨‹è°ƒåº¦å™¨å½“å‰çº¿ç¨‹è¯·æ±‚è®©å‡ºè‡ªå·±çš„CPU ï¼Œä½†æ˜¯çº¿ç¨‹è°ƒåº¦å™¨å¯ä»¥æ— æ¡ä»¶å¿½ç•¥è¿™ä¸ªæš—ç¤ºã€‚</li></ul><p><strong>çº¿ç¨‹ä¸­æ–­</strong></p><p>Java ä¸­çš„çº¿ç¨‹ä¸­æ–­æ˜¯ä¸€ç§çº¿ç¨‹é—´çš„åä½œæ¨¡å¼ï¼Œé€šè¿‡è®¾ç½®çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—å¹¶ä¸èƒ½ç›´æ¥ç»ˆæ­¢è¯¥çº¿ç¨‹çš„æ‰§è¡Œï¼Œè€Œæ˜¯è¢«ä¸­æ–­çš„çº¿ç¨‹æ ¹æ®ä¸­æ–­çŠ¶æ€è‡ªè¡Œå¤„ç†ã€‚</p><ul><li>void interrupt() ï¼šä¸­æ–­çº¿ç¨‹ï¼Œä¾‹å¦‚ï¼Œå½“çº¿ç¨‹Aè¿è¡Œæ—¶ï¼Œçº¿ç¨‹Bå¯ä»¥è°ƒç”¨çº¿ç¨‹interrupt() æ–¹æ³•æ¥è®¾ç½®çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä¸ºtrue å¹¶ç«‹å³è¿”å›ã€‚è®¾ç½®æ ‡å¿—ä»…ä»…æ˜¯è®¾ç½®æ ‡å¿—, çº¿ç¨‹Aå®é™…å¹¶æ²¡æœ‰è¢«ä¸­æ–­ï¼Œ ä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</li><li>boolean isInterrupted() æ–¹æ³•ï¼š æ£€æµ‹å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ã€‚</li><li>boolean interrupted() æ–¹æ³•ï¼š æ£€æµ‹å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ï¼Œä¸ isInterrupted ä¸åŒçš„æ˜¯ï¼Œè¯¥æ–¹æ³•å¦‚æœå‘ç°å½“å‰çº¿ç¨‹è¢«ä¸­æ–­ï¼Œåˆ™ä¼šæ¸…é™¤ä¸­æ–­æ ‡å¿—ã€‚</li></ul><h3 id="_6-çº¿ç¨‹æœ‰å‡ ç§çŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#_6-çº¿ç¨‹æœ‰å‡ ç§çŠ¶æ€" aria-hidden="true">#</a> 6.çº¿ç¨‹æœ‰å‡ ç§çŠ¶æ€ï¼Ÿ</h3><p>åœ¨Javaä¸­ï¼Œçº¿ç¨‹å…±æœ‰å…­ç§çŠ¶æ€ï¼š</p><table><thead><tr><th>çŠ¶æ€</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>NEW</td><td>åˆå§‹çŠ¶æ€ï¼šçº¿ç¨‹è¢«åˆ›å»ºï¼Œä½†è¿˜æ²¡æœ‰è°ƒç”¨start()æ–¹æ³•</td></tr><tr><td>RUNNABLE</td><td>è¿è¡ŒçŠ¶æ€ï¼šJavaçº¿ç¨‹å°†æ“ä½œç³»ç»Ÿä¸­çš„å°±ç»ªå’Œè¿è¡Œä¸¤ç§çŠ¶æ€ç¬¼ç»Ÿçš„ç§°ä½œâ€œè¿è¡Œâ€</td></tr><tr><td>BLOCKED</td><td>é˜»å¡çŠ¶æ€ï¼šè¡¨ç¤ºçº¿ç¨‹é˜»å¡äºé”</td></tr><tr><td>WAITING</td><td>ç­‰å¾…çŠ¶æ€ï¼šè¡¨ç¤ºçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œè¿›å…¥è¯¥çŠ¶æ€è¡¨ç¤ºå½“å‰çº¿ç¨‹éœ€è¦ç­‰å¾…å…¶ä»–çº¿ç¨‹åšå‡ºä¸€äº›ç‰¹å®šåŠ¨ä½œï¼ˆé€šçŸ¥æˆ–ä¸­æ–­ï¼‰</td></tr><tr><td>TIME_WAITING</td><td>è¶…æ—¶ç­‰å¾…çŠ¶æ€ï¼šè¯¥çŠ¶æ€ä¸åŒäº WAITINDï¼Œå®ƒæ˜¯å¯ä»¥åœ¨æŒ‡å®šçš„æ—¶é—´è‡ªè¡Œè¿”å›çš„</td></tr><tr><td>TERMINATED</td><td>ç»ˆæ­¢çŠ¶æ€ï¼šè¡¨ç¤ºå½“å‰çº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•</td></tr></tbody></table><p>çº¿ç¨‹åœ¨è‡ªèº«çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œ å¹¶ä¸æ˜¯å›ºå®šåœ°å¤„äºæŸä¸ªçŠ¶æ€ï¼Œè€Œæ˜¯éšç€ä»£ç çš„æ‰§è¡Œåœ¨ä¸åŒçš„çŠ¶æ€ä¹‹é—´è¿›è¡Œåˆ‡æ¢ï¼ŒJavaçº¿ç¨‹çŠ¶æ€å˜åŒ–å¦‚å›¾ç¤ºï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-7.png" alt="Javaçº¿ç¨‹çŠ¶æ€å˜åŒ–"></p><h3 id="_7-ä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢" tabindex="-1"><a class="header-anchor" href="#_7-ä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢" aria-hidden="true">#</a> 7.ä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ</h3><p>ä½¿ç”¨å¤šçº¿ç¨‹çš„ç›®çš„æ˜¯ä¸ºäº†å……åˆ†åˆ©ç”¨CPUï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œå¹¶å‘å…¶å®æ˜¯ä¸€ä¸ªCPUæ¥åº”ä»˜å¤šä¸ªçº¿ç¨‹ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-8.png" alt="çº¿ç¨‹åˆ‡æ¢-2020-12-16-2107"></p><p>ä¸ºäº†è®©ç”¨æˆ·æ„Ÿè§‰å¤šä¸ªçº¿ç¨‹æ˜¯åœ¨åŒæ—¶æ‰§è¡Œçš„ï¼Œ CPU èµ„æºçš„åˆ†é…é‡‡ç”¨äº†æ—¶é—´ç‰‡è½®è½¬ä¹Ÿå°±æ˜¯ç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªæ—¶é—´ç‰‡ï¼Œçº¿ç¨‹åœ¨æ—¶é—´ç‰‡å†…å ç”¨ CPU æ‰§è¡Œä»»åŠ¡ã€‚å½“çº¿ç¨‹ä½¿ç”¨å®Œæ—¶é—´ç‰‡åï¼Œå°±ä¼šå¤„äºå°±ç»ªçŠ¶æ€å¹¶è®©å‡º CPU è®©å…¶ä»–çº¿ç¨‹å ç”¨ï¼Œè¿™å°±æ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-9.png" alt="ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶æœº"></p><h3 id="_8-å®ˆæŠ¤çº¿ç¨‹äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_8-å®ˆæŠ¤çº¿ç¨‹äº†è§£å—" aria-hidden="true">#</a> 8.å®ˆæŠ¤çº¿ç¨‹äº†è§£å—ï¼Ÿ</h3><p>Javaä¸­çš„çº¿ç¨‹åˆ†ä¸ºä¸¤ç±»ï¼Œåˆ†åˆ«ä¸º daemon çº¿ç¨‹ï¼ˆå®ˆæŠ¤çº¿ç¨‹ï¼‰å’Œ user çº¿ç¨‹ï¼ˆç”¨æˆ·çº¿ç¨‹ï¼‰ã€‚</p><p>åœ¨JVM å¯åŠ¨æ—¶ä¼šè°ƒç”¨ main å‡½æ•°ï¼Œmainå‡½æ•°æ‰€åœ¨çš„çº¿ç¨‹å°±æ˜¯ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹ã€‚å…¶å®åœ¨ JVM å†…éƒ¨åŒæ—¶è¿˜å¯åŠ¨äº†å¾ˆå¤šå®ˆæŠ¤çº¿ç¨‹ï¼Œ æ¯”å¦‚åƒåœ¾å›æ”¶çº¿ç¨‹ã€‚</p><p>é‚£ä¹ˆå®ˆæŠ¤çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼ŸåŒºåˆ«ä¹‹ä¸€æ˜¯å½“æœ€åä¸€ä¸ªéå®ˆæŠ¤çº¿ç¨‹æŸæ—¶ï¼Œ JVMä¼šæ­£å¸¸é€€å‡ºï¼Œè€Œä¸ç®¡å½“å‰æ˜¯å¦å­˜åœ¨å®ˆæŠ¤çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´å®ˆæŠ¤çº¿ç¨‹æ˜¯å¦ç»“æŸå¹¶ä¸å½±å“ JVMé€€å‡ºã€‚æ¢è€Œè¨€ä¹‹ï¼Œåªè¦æœ‰ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹è¿˜æ²¡ç»“æŸï¼Œæ­£å¸¸æƒ…å†µä¸‹JVMå°±ä¸ä¼šé€€å‡ºã€‚</p><h3 id="_9-çº¿ç¨‹é—´æœ‰å“ªäº›é€šä¿¡æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_9-çº¿ç¨‹é—´æœ‰å“ªäº›é€šä¿¡æ–¹å¼" aria-hidden="true">#</a> 9.çº¿ç¨‹é—´æœ‰å“ªäº›é€šä¿¡æ–¹å¼ï¼Ÿ</h3><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-10.png" alt="çº¿ç¨‹é—´é€šä¿¡æ–¹å¼"></p><ul><li><strong>volatileå’Œsynchronizedå…³é”®å­—</strong></li></ul><p>å…³é”®å­—volatileå¯ä»¥ç”¨æ¥ä¿®é¥°å­—æ®µï¼ˆæˆå‘˜å˜é‡ï¼‰ï¼Œå°±æ˜¯å‘ŠçŸ¥ç¨‹åºä»»ä½•å¯¹è¯¥å˜é‡çš„è®¿é—®å‡éœ€è¦ä»å…±äº«å†…å­˜ä¸­è·å–ï¼Œè€Œå¯¹å®ƒçš„æ”¹å˜å¿…é¡»åŒæ­¥åˆ·æ–°å›å…±äº«å†…å­˜ï¼Œå®ƒèƒ½ä¿è¯æ‰€æœ‰çº¿ç¨‹å¯¹å˜é‡è®¿é—®çš„å¯è§æ€§ã€‚</p><p>å…³é”®å­—synchronizedå¯ä»¥ä¿®é¥°æ–¹æ³•æˆ–è€…ä»¥åŒæ­¥å—çš„å½¢å¼æ¥è¿›è¡Œä½¿ç”¨ï¼Œå®ƒä¸»è¦ç¡®ä¿å¤šä¸ªçº¿ç¨‹åœ¨åŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¤„äºæ–¹æ³•æˆ–è€…åŒæ­¥å—ä¸­ï¼Œå®ƒä¿è¯äº†çº¿ç¨‹å¯¹å˜é‡è®¿é—®çš„å¯è§æ€§å’Œæ’ä»–æ€§ã€‚</p><ul><li><strong>ç­‰å¾…/é€šçŸ¥æœºåˆ¶</strong></li></ul><p>å¯ä»¥é€šè¿‡Javaå†…ç½®çš„ç­‰å¾…/é€šçŸ¥æœºåˆ¶ï¼ˆwait()/notify()ï¼‰å®ç°ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„å€¼ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹æ„ŸçŸ¥åˆ°äº†å˜åŒ–ï¼Œç„¶åè¿›è¡Œç›¸åº”çš„æ“ä½œã€‚</p><ul><li><strong>ç®¡é“è¾“å…¥/è¾“å‡ºæµ</strong></li></ul><p>ç®¡é“è¾“å…¥/è¾“å‡ºæµå’Œæ™®é€šçš„æ–‡ä»¶è¾“å…¥/è¾“å‡ºæµæˆ–è€…ç½‘ç»œè¾“å…¥/è¾“å‡ºæµä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒä¸»è¦ç”¨äºçº¿ç¨‹ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œè€Œä¼ è¾“çš„åª’ä»‹ä¸ºå†…å­˜ã€‚</p><p>ç®¡é“è¾“å…¥/è¾“å‡ºæµä¸»è¦åŒ…æ‹¬äº†å¦‚ä¸‹4ç§å…·ä½“å®ç°ï¼šPipedOutputStreamã€PipedInputStreamã€ PipedReaderå’ŒPipedWriterï¼Œå‰ä¸¤ç§é¢å‘å­—èŠ‚ï¼Œè€Œåä¸¤ç§é¢å‘å­—ç¬¦ã€‚</p><ul><li><strong>ä½¿ç”¨Thread.join()</strong></li></ul><p>å¦‚æœä¸€ä¸ªçº¿ç¨‹Aæ‰§è¡Œäº†thread.join()è¯­å¥ï¼Œå…¶å«ä¹‰æ˜¯ï¼šå½“å‰çº¿ç¨‹Aç­‰å¾…threadçº¿ç¨‹ç»ˆæ­¢ä¹‹åæ‰ä»thread.join()è¿”å›ã€‚ã€‚çº¿ç¨‹Threadé™¤äº†æä¾›join()æ–¹æ³•ä¹‹å¤–ï¼Œè¿˜æä¾›äº†join(long millis)å’Œjoin(long millis,int nanos)ä¸¤ä¸ªå…·å¤‡è¶…æ—¶ç‰¹æ€§çš„æ–¹æ³•ã€‚</p><ul><li><strong>ä½¿ç”¨ThreadLocal</strong></li></ul><p>ThreadLocalï¼Œå³çº¿ç¨‹å˜é‡ï¼Œæ˜¯ä¸€ä¸ªä»¥ThreadLocalå¯¹è±¡ä¸ºé”®ã€ä»»æ„å¯¹è±¡ä¸ºå€¼çš„å­˜å‚¨ç»“æ„ã€‚è¿™ä¸ªç»“æ„è¢«é™„å¸¦åœ¨çº¿ç¨‹ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ ¹æ®ä¸€ä¸ªThreadLocalå¯¹è±¡æŸ¥è¯¢åˆ°ç»‘å®šåœ¨è¿™ä¸ªçº¿ç¨‹ä¸Šçš„ä¸€ä¸ªå€¼ã€‚</p><p>å¯ä»¥é€šè¿‡set(T)æ–¹æ³•æ¥è®¾ç½®ä¸€ä¸ªå€¼ï¼Œåœ¨å½“å‰çº¿ç¨‹ä¸‹å†é€šè¿‡get()æ–¹æ³•è·å–åˆ°åŸå…ˆè®¾ç½®çš„å€¼ã€‚</p><blockquote><p>å…³äºå¤šçº¿ç¨‹ï¼Œå…¶å®å¾ˆå¤§æ¦‚ç‡è¿˜ä¼šå‡ºä¸€äº›ç¬”è¯•é¢˜ï¼Œæ¯”å¦‚äº¤æ›¿æ‰“å°ã€é“¶è¡Œè½¬è´¦ã€ç”Ÿäº§æ¶ˆè´¹æ¨¡å‹ç­‰ç­‰ï¼Œåé¢è€ä¸‰ä¼šå•ç‹¬å‡ºä¸€æœŸæ¥ç›˜ç‚¹ä¸€ä¸‹å¸¸è§çš„å¤šçº¿ç¨‹ç¬”è¯•é¢˜ã€‚</p></blockquote><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xingbiaogongzhonghao.png" alt=""></p><h2 id="threadlocal" tabindex="-1"><a class="header-anchor" href="#threadlocal" aria-hidden="true">#</a> ThreadLocal</h2><p>ThreadLocalå…¶å®åº”ç”¨åœºæ™¯ä¸æ˜¯å¾ˆå¤šï¼Œä½†å´æ˜¯è¢«ç‚¸äº†åƒç™¾éçš„é¢è¯•è€æ²¹æ¡ï¼Œæ¶‰åŠåˆ°å¤šçº¿ç¨‹ã€æ•°æ®ç»“æ„ã€JVMï¼Œå¯é—®çš„ç‚¹æ¯”è¾ƒå¤šï¼Œä¸€å®šè¦æ‹¿ä¸‹ã€‚</p><h3 id="_10-threadlocalæ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_10-threadlocalæ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> 10.ThreadLocalæ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>ThreadLocalï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹æœ¬åœ°å˜é‡ã€‚å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªThreadLocalå˜é‡ï¼Œé‚£ä¹ˆè®¿é—®è¿™ä¸ªå˜é‡çš„æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰è¿™ä¸ªå˜é‡çš„ä¸€ä¸ªæœ¬åœ°æ‹·è´ï¼Œå¤šä¸ªçº¿ç¨‹æ“ä½œè¿™ä¸ªå˜é‡çš„æ—¶å€™ï¼Œå®é™…æ˜¯æ“ä½œè‡ªå·±æœ¬åœ°å†…å­˜é‡Œé¢çš„å˜é‡ï¼Œä»è€Œèµ·åˆ°çº¿ç¨‹éš”ç¦»çš„ä½œç”¨ï¼Œé¿å…äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-11.png" alt="ThreadLocalçº¿ç¨‹å‰¯æœ¬"></p><ul><li>åˆ›å»º</li></ul><p>åˆ›å»ºäº†ä¸€ä¸ªThreadLocaå˜é‡localVariableï¼Œä»»ä½•ä¸€ä¸ªçº¿ç¨‹éƒ½èƒ½å¹¶å‘è®¿é—®localVariableã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//åˆ›å»ºä¸€ä¸ªThreadLocalå˜é‡</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> localVariable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å†™å…¥</li></ul><p>çº¿ç¨‹å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨localVariableï¼Œå†™å…¥å˜é‡ã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>localVariable<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>&quot;é„™äººä¸‰æŸâ€<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>è¯»å–</li></ul><p>çº¿ç¨‹åœ¨ä»»ä½•åœ°æ–¹è¯»å–çš„éƒ½æ˜¯å®ƒå†™å…¥çš„å˜é‡ã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>localVariable<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_11-ä½ åœ¨å·¥ä½œä¸­ç”¨åˆ°è¿‡threadlocalå—" tabindex="-1"><a class="header-anchor" href="#_11-ä½ åœ¨å·¥ä½œä¸­ç”¨åˆ°è¿‡threadlocalå—" aria-hidden="true">#</a> 11.ä½ åœ¨å·¥ä½œä¸­ç”¨åˆ°è¿‡ThreadLocalå—ï¼Ÿ</h3><p>æœ‰ç”¨åˆ°è¿‡çš„ï¼Œç”¨æ¥åšç”¨æˆ·ä¿¡æ¯ä¸Šä¸‹æ–‡çš„å­˜å‚¨ã€‚</p><p>æˆ‘ä»¬çš„ç³»ç»Ÿåº”ç”¨æ˜¯ä¸€ä¸ªå…¸å‹çš„MVCæ¶æ„ï¼Œç™»å½•åçš„ç”¨æˆ·æ¯æ¬¡è®¿é—®æ¥å£ï¼Œéƒ½ä¼šåœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ä¸€ä¸ªtokenï¼Œåœ¨æ§åˆ¶å±‚å¯ä»¥æ ¹æ®è¿™ä¸ªtokenï¼Œè§£æå‡ºç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå‡å¦‚åœ¨æœåŠ¡å±‚å’ŒæŒä¹…å±‚éƒ½è¦ç”¨åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œæ¯”å¦‚rpcè°ƒç”¨ã€æ›´æ–°ç”¨æˆ·è·å–ç­‰ç­‰ï¼Œé‚£åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>ä¸€ç§åŠæ³•æ˜¯æ˜¾å¼å®šä¹‰ç”¨æˆ·ç›¸å…³çš„å‚æ•°ï¼Œæ¯”å¦‚è´¦å·ã€ç”¨æˆ·åâ€¦â€¦è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å¤§é¢ç§¯åœ°ä¿®æ”¹ä»£ç ï¼Œå¤šå°‘æœ‰ç‚¹ç“œçš®ï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>è¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ç”¨åˆ°ThreadLocalï¼Œåœ¨æ§åˆ¶å±‚æ‹¦æˆªè¯·æ±‚æŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥ThreadLocalï¼Œè¿™æ ·æˆ‘ä»¬åœ¨ä»»ä½•ä¸€ä¸ªåœ°æ–¹ï¼Œéƒ½å¯ä»¥å–å‡ºThreadLocalä¸­å­˜çš„ç”¨æˆ·æ•°æ®ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-12.png" alt="ThreadLocaå­˜æ”¾ç”¨æˆ·ä¸Šä¸‹æ–‡"></p><p>å¾ˆå¤šå…¶å®ƒåœºæ™¯çš„cookieã€sessionç­‰ç­‰æ•°æ®éš”ç¦»ä¹Ÿéƒ½å¯ä»¥é€šè¿‡ThreadLocalå»å®ç°ã€‚</p><p>æˆ‘ä»¬å¸¸ç”¨çš„æ•°æ®åº“è¿æ¥æ± ä¹Ÿç”¨åˆ°äº†ThreadLocalï¼š</p><ul><li>æ•°æ®åº“è¿æ¥æ± çš„è¿æ¥äº¤ç»™ThreadLocaè¿›è¡Œç®¡ç†ï¼Œä¿è¯å½“å‰çº¿ç¨‹çš„æ“ä½œéƒ½æ˜¯åŒä¸€ä¸ªConnnectionã€‚</li></ul><h3 id="_12-threadlocalæ€ä¹ˆå®ç°çš„å‘¢" tabindex="-1"><a class="header-anchor" href="#_12-threadlocalæ€ä¹ˆå®ç°çš„å‘¢" aria-hidden="true">#</a> 12.ThreadLocalæ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ</h3><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ThreadLocalçš„set(T)æ–¹æ³•ï¼Œå‘ç°å…ˆè·å–åˆ°å½“å‰çº¿ç¨‹ï¼Œå†è·å–<code>ThreadLocalMap</code>ï¼Œç„¶åæŠŠå…ƒç´ å­˜åˆ°è¿™ä¸ªmapä¸­ã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//è·å–å½“å‰çº¿ç¨‹</span>
        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è·å–ThreadLocalMap</span>
        <span class="token class-name">ThreadLocalMap</span> map <span class="token operator">=</span> <span class="token function">getMap</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è®²å½“å‰å…ƒç´ å­˜å…¥map</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>map <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token function">createMap</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ThreadLocalå®ç°çš„ç§˜å¯†éƒ½åœ¨è¿™ä¸ª<code>ThreadLocalMap</code>äº†ï¼Œå¯ä»¥Threadç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªç±»å‹ä¸º<code>ThreadLocal.ThreadLocalMap</code>çš„æˆå‘˜å˜é‡<code>threadLocals</code>ã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Thread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
   <span class="token comment">//ThreadLocal.ThreadLocalMapæ˜¯Threadçš„å±æ€§</span>
   <span class="token class-name">ThreadLocal<span class="token punctuation">.</span>ThreadLocalMap</span> threadLocals <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ThreadLocalMapæ—¢ç„¶è¢«ç§°ä¸ºMapï¼Œé‚£ä¹ˆæ¯«æ— ç–‘é—®å®ƒæ˜¯&lt;key,value&gt;å‹çš„æ•°æ®ç»“æ„ã€‚æˆ‘ä»¬éƒ½çŸ¥é“mapçš„æœ¬è´¨æ˜¯ä¸€ä¸ªä¸ª&lt;key,value&gt;å½¢å¼çš„èŠ‚ç‚¹ç»„æˆçš„æ•°ç»„ï¼Œé‚£ThreadLocalMapçš„èŠ‚ç‚¹æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Entry</span> <span class="token keyword">extends</span> <span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ThreadLocal</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/** The value associated with this ThreadLocal. */</span>
    <span class="token class-name">Object</span> value<span class="token punctuation">;</span>

    <span class="token comment">//èŠ‚ç‚¹ç±»</span>
    <span class="token class-name">Entry</span><span class="token punctuation">(</span><span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> k<span class="token punctuation">,</span> <span class="token class-name">Object</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//keyèµ‹å€¼</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//valueèµ‹å€¼</span>
        value <span class="token operator">=</span> v<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œçš„èŠ‚ç‚¹ï¼Œkeyå¯ä»¥ç®€å•ä½è§†ä½œThreadLocalï¼Œvalueä¸ºä»£ç ä¸­æ”¾å…¥çš„å€¼ï¼Œå½“ç„¶å®é™…ä¸Škeyå¹¶ä¸æ˜¯ThreadLocalæœ¬èº«ï¼Œè€Œæ˜¯å®ƒçš„ä¸€ä¸ª<strong>å¼±å¼•ç”¨</strong>ï¼Œå¯ä»¥çœ‹åˆ°Entryçš„keyç»§æ‰¿äº† WeakReferenceï¼ˆå¼±å¼•ç”¨ï¼‰ï¼Œå†æ¥çœ‹ä¸€ä¸‹keyæ€ä¹ˆèµ‹å€¼çš„ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">WeakReference</span><span class="token punctuation">(</span><span class="token class-name">T</span> referent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>referent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>keyçš„èµ‹å€¼ï¼Œä½¿ç”¨çš„æ˜¯WeakReferenceçš„èµ‹å€¼ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-13.png" alt="ThreadLocaç»“æ„å›¾"></p><blockquote><p>æ‰€ä»¥ï¼Œæ€ä¹ˆå›ç­”ThreadLocalåŸç†ï¼Ÿè¦ç­”å‡ºè¿™å‡ ä¸ªç‚¹ï¼š</p></blockquote><ul><li>Threadç±»æœ‰ä¸€ä¸ªç±»å‹ä¸ºThreadLocal.ThreadLocalMapçš„å®ä¾‹å˜é‡threadLocalsï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„ThreadLocalMapã€‚</li><li>ThreadLocalMapå†…éƒ¨ç»´æŠ¤ç€Entryæ•°ç»„ï¼Œæ¯ä¸ªEntryä»£è¡¨ä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡ï¼Œkeyæ˜¯ThreadLocalçš„å¼±å¼•ç”¨ï¼Œvalueæ˜¯ThreadLocalçš„æ³›å‹å€¼ã€‚</li><li>æ¯ä¸ªçº¿ç¨‹åœ¨å¾€ThreadLocalé‡Œè®¾ç½®å€¼çš„æ—¶å€™ï¼Œéƒ½æ˜¯å¾€è‡ªå·±çš„ThreadLocalMapé‡Œå­˜ï¼Œè¯»ä¹Ÿæ˜¯ä»¥æŸä¸ªThreadLocalä½œä¸ºå¼•ç”¨ï¼Œåœ¨è‡ªå·±çš„mapé‡Œæ‰¾å¯¹åº”çš„keyï¼Œä»è€Œå®ç°äº†çº¿ç¨‹éš”ç¦»ã€‚</li><li>ThreadLocalæœ¬èº«ä¸å­˜å‚¨å€¼ï¼Œå®ƒåªæ˜¯ä½œä¸ºä¸€ä¸ªkeyæ¥è®©çº¿ç¨‹å¾€ThreadLocalMapé‡Œå­˜å–å€¼ã€‚</li></ul><h3 id="_13-threadlocal-å†…å­˜æ³„éœ²æ˜¯æ€ä¹ˆå›äº‹" tabindex="-1"><a class="header-anchor" href="#_13-threadlocal-å†…å­˜æ³„éœ²æ˜¯æ€ä¹ˆå›äº‹" aria-hidden="true">#</a> 13.ThreadLocal å†…å­˜æ³„éœ²æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ</h3><p>æˆ‘ä»¬å…ˆæ¥åˆ†æä¸€ä¸‹ä½¿ç”¨ThreadLocalæ—¶çš„å†…å­˜ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œåœ¨JVMä¸­ï¼Œæ ˆå†…å­˜çº¿ç¨‹ç§æœ‰ï¼Œå­˜å‚¨äº†å¯¹è±¡çš„å¼•ç”¨ï¼Œå †å†…å­˜çº¿ç¨‹å…±äº«ï¼Œå­˜å‚¨äº†å¯¹è±¡å®ä¾‹ã€‚</p><p>æ‰€ä»¥å‘¢ï¼Œæ ˆä¸­å­˜å‚¨äº†ThreadLocalã€Threadçš„å¼•ç”¨ï¼Œå †ä¸­å­˜å‚¨äº†å®ƒä»¬çš„å…·ä½“å®ä¾‹ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-14.png" alt="ThreadLocalå†…å­˜åˆ†é…"></p><p>ThreadLocalMapä¸­ä½¿ç”¨çš„ key ä¸º ThreadLocal çš„å¼±å¼•ç”¨ã€‚</p><blockquote><p>â€œå¼±å¼•ç”¨ï¼šåªè¦åƒåœ¾å›æ”¶æœºåˆ¶ä¸€è¿è¡Œï¼Œä¸ç®¡JVMçš„å†…å­˜ç©ºé—´æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå›æ”¶è¯¥å¯¹è±¡å ç”¨çš„å†…å­˜ã€‚â€</p></blockquote><p>é‚£ä¹ˆç°åœ¨é—®é¢˜å°±æ¥äº†ï¼Œå¼±å¼•ç”¨å¾ˆå®¹æ˜“è¢«å›æ”¶ï¼Œå¦‚æœThreadLocalï¼ˆThreadLocalMapçš„Keyï¼‰è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶äº†ï¼Œä½†æ˜¯ThreadLocalMapç”Ÿå‘½å‘¨æœŸå’ŒThreadæ˜¯ä¸€æ ·çš„ï¼Œå®ƒè¿™æ—¶å€™å¦‚æœä¸è¢«å›æ”¶ï¼Œå°±ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼šThreadLocalMapçš„keyæ²¡äº†ï¼Œvalueè¿˜åœ¨ï¼Œè¿™å°±ä¼š<strong>é€ æˆäº†å†…å­˜æ³„æ¼é—®é¢˜</strong>ã€‚</p><blockquote><p>é‚£æ€ä¹ˆè§£å†³å†…å­˜æ³„æ¼é—®é¢˜å‘¢ï¼Ÿ</p></blockquote><p>å¾ˆç®€å•ï¼Œä½¿ç”¨å®ŒThreadLocalåï¼ŒåŠæ—¶è°ƒç”¨remove()æ–¹æ³•é‡Šæ”¾å†…å­˜ç©ºé—´ã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> localVariable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    localVariable<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>&quot;é„™äººä¸‰æŸâ€<span class="token punctuation">)</span><span class="token punctuation">;</span>
    â€¦â€¦
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    localVariable<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>é‚£ä¸ºä»€ä¹ˆkeyè¿˜è¦è®¾è®¡æˆå¼±å¼•ç”¨ï¼Ÿ</p></blockquote><p>keyè®¾è®¡æˆå¼±å¼•ç”¨åŒæ ·æ˜¯ä¸ºäº†é˜²æ­¢å†…å­˜æ³„æ¼ã€‚</p><p>å‡å¦‚keyè¢«è®¾è®¡æˆå¼ºå¼•ç”¨ï¼Œå¦‚æœThreadLocal Referenceè¢«é”€æ¯ï¼Œæ­¤æ—¶å®ƒæŒ‡å‘ThreadLocaçš„å¼ºå¼•ç”¨å°±æ²¡æœ‰äº†ï¼Œä½†æ˜¯æ­¤æ—¶keyè¿˜å¼ºå¼•ç”¨æŒ‡å‘ThreadLocaï¼Œå°±ä¼šå¯¼è‡´ThreadLocalä¸èƒ½è¢«å›æ”¶ï¼Œè¿™æ—¶å€™å°±å‘ç”Ÿäº†å†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚</p><h3 id="_14-threadlocalmapçš„ç»“æ„äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_14-threadlocalmapçš„ç»“æ„äº†è§£å—" aria-hidden="true">#</a> 14.ThreadLocalMapçš„ç»“æ„äº†è§£å—ï¼Ÿ</h3><p>ThreadLocalMapè™½ç„¶è¢«å«åšMapï¼Œå…¶å®å®ƒæ˜¯æ²¡æœ‰å®ç°Mapæ¥å£çš„ï¼Œä½†æ˜¯ç»“æ„è¿˜æ˜¯å’ŒHashMapæ¯”è¾ƒç±»ä¼¼çš„ï¼Œä¸»è¦å…³æ³¨çš„æ˜¯ä¸¤ä¸ªè¦ç´ ï¼š<code>å…ƒç´ æ•°ç»„</code>å’Œ<code>æ•£åˆ—æ–¹æ³•</code>ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-15.png" alt="ThreadLocalMapç»“æ„ç¤ºæ„å›¾"></p><ul><li><p>å…ƒç´ æ•°ç»„</p><p>ä¸€ä¸ªtableæ•°ç»„ï¼Œå­˜å‚¨Entryç±»å‹çš„å…ƒç´ ï¼ŒEntryæ˜¯ThreaLocalå¼±å¼•ç”¨ä½œä¸ºkeyï¼ŒObjectä½œä¸ºvalueçš„ç»“æ„ã€‚</p></li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token keyword">private</span> <span class="token class-name">Entry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> table<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>æ•£åˆ—æ–¹æ³•</p><p>æ•£åˆ—æ–¹æ³•å°±æ˜¯æ€ä¹ˆæŠŠå¯¹åº”çš„keyæ˜ å°„åˆ°tableæ•°ç»„çš„ç›¸åº”ä¸‹æ ‡ï¼ŒThreadLocalMapç”¨çš„æ˜¯å“ˆå¸Œå–ä½™æ³•ï¼Œå–å‡ºkeyçš„threadLocalHashCodeï¼Œç„¶åå’Œtableæ•°ç»„é•¿åº¦å‡ä¸€&amp;è¿ç®—ï¼ˆç›¸å½“äºå–ä½™ï¼‰ã€‚</p></li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">int</span> i <span class="token operator">=</span> key<span class="token punctuation">.</span>threadLocalHashCode <span class="token operator">&amp;</span> <span class="token punctuation">(</span>table<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™é‡Œçš„threadLocalHashCodeè®¡ç®—æœ‰ç‚¹ä¸œè¥¿ï¼Œæ¯åˆ›å»ºä¸€ä¸ªThreadLocalå¯¹è±¡ï¼Œå®ƒå°±ä¼šæ–°å¢<code>0x61c88647</code>ï¼Œè¿™ä¸ªå€¼å¾ˆç‰¹æ®Šï¼Œå®ƒæ˜¯<strong>æ–æ³¢é‚£å¥‘æ•°</strong> ä¹Ÿå« <strong>é»„é‡‘åˆ†å‰²æ•°</strong>ã€‚<code>hash</code>å¢é‡ä¸º è¿™ä¸ªæ•°å­—ï¼Œå¸¦æ¥çš„å¥½å¤„å°±æ˜¯ <code>hash</code> <strong>åˆ†å¸ƒéå¸¸å‡åŒ€</strong>ã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> HASH_INCREMENT <span class="token operator">=</span> <span class="token number">0x61c88647</span><span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">nextHashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> nextHashCode<span class="token punctuation">.</span><span class="token function">getAndAdd</span><span class="token punctuation">(</span>HASH_INCREMENT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_15-threadlocalmapæ€ä¹ˆè§£å†³hashå†²çªçš„" tabindex="-1"><a class="header-anchor" href="#_15-threadlocalmapæ€ä¹ˆè§£å†³hashå†²çªçš„" aria-hidden="true">#</a> 15.ThreadLocalMapæ€ä¹ˆè§£å†³Hashå†²çªçš„ï¼Ÿ</h3><p>æˆ‘ä»¬å¯èƒ½éƒ½çŸ¥é“HashMapä½¿ç”¨äº†é“¾è¡¨æ¥è§£å†³å†²çªï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„é“¾åœ°å€æ³•ã€‚</p><p>ThreadLocalMapæ²¡æœ‰ä½¿ç”¨é“¾è¡¨ï¼Œè‡ªç„¶ä¹Ÿä¸æ˜¯ç”¨é“¾åœ°å€æ³•æ¥è§£å†³å†²çªäº†ï¼Œå®ƒç”¨çš„æ˜¯å¦å¤–ä¸€ç§æ–¹å¼â€”â€”<strong>å¼€æ”¾å®šå€æ³•</strong>ã€‚å¼€æ”¾å®šå€æ³•æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿç®€å•æ¥è¯´ï¼Œå°±æ˜¯è¿™ä¸ªå‘è¢«äººå äº†ï¼Œé‚£å°±æ¥ç€å»æ‰¾ç©ºç€çš„å‘ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-16.png" alt="ThreadLocalMapè§£å†³å†²çª"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¦‚æœæˆ‘ä»¬æ’å…¥ä¸€ä¸ªvalue=27çš„æ•°æ®ï¼Œé€šè¿‡ hashè®¡ç®—ååº”è¯¥è½å…¥ç¬¬ 4 ä¸ªæ§½ä½ä¸­ï¼Œè€Œæ§½ä½ 4 å·²ç»æœ‰äº† Entryæ•°æ®ï¼Œè€Œä¸”Entryæ•°æ®çš„keyå’Œå½“å‰ä¸ç›¸ç­‰ã€‚æ­¤æ—¶å°±ä¼šçº¿æ€§å‘åæŸ¥æ‰¾ï¼Œä¸€ç›´æ‰¾åˆ° Entryä¸º nullçš„æ§½ä½æ‰ä¼šåœæ­¢æŸ¥æ‰¾ï¼ŒæŠŠå…ƒç´ æ”¾åˆ°ç©ºçš„æ§½ä¸­ã€‚</p><p>åœ¨getçš„æ—¶å€™ï¼Œä¹Ÿä¼šæ ¹æ®ThreadLocalå¯¹è±¡çš„hashå€¼ï¼Œå®šä½åˆ°tableä¸­çš„ä½ç½®ï¼Œç„¶ååˆ¤æ–­è¯¥æ§½ä½Entryå¯¹è±¡ä¸­çš„keyæ˜¯å¦å’Œgetçš„keyä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œå°±åˆ¤æ–­ä¸‹ä¸€ä¸ªä½ç½®ã€‚</p><h3 id="_16-threadlocalmapæ‰©å®¹æœºåˆ¶äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_16-threadlocalmapæ‰©å®¹æœºåˆ¶äº†è§£å—" aria-hidden="true">#</a> 16.ThreadLocalMapæ‰©å®¹æœºåˆ¶äº†è§£å—ï¼Ÿ</h3><p>åœ¨ThreadLocalMap.set()æ–¹æ³•çš„æœ€åï¼Œå¦‚æœæ‰§è¡Œå®Œå¯å‘å¼æ¸…ç†å·¥ä½œåï¼Œæœªæ¸…ç†åˆ°ä»»ä½•æ•°æ®ï¼Œä¸”å½“å‰æ•£åˆ—æ•°ç»„ä¸­<code>Entry</code>çš„æ•°é‡å·²ç»è¾¾åˆ°äº†åˆ—è¡¨çš„æ‰©å®¹é˜ˆå€¼<code>(len*2/3)</code>ï¼Œå°±å¼€å§‹æ‰§è¡Œ<code>rehash()</code>é€»è¾‘ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">cleanSomeSlots</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> sz<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> sz <span class="token operator">&gt;=</span> threshold<span class="token punctuation">)</span>
    <span class="token function">rehash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å†ç€çœ‹rehash()å…·ä½“å®ç°ï¼šè¿™é‡Œä¼šå…ˆå»æ¸…ç†è¿‡æœŸçš„Entryï¼Œç„¶åè¿˜è¦æ ¹æ®æ¡ä»¶åˆ¤æ–­<code>size &gt;= threshold - threshold / 4</code> ä¹Ÿå°±æ˜¯<code>size &gt;= threshold* 3/4</code>æ¥å†³å®šæ˜¯å¦éœ€è¦æ‰©å®¹ã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">rehash</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ¸…ç†è¿‡æœŸEntry</span>
    <span class="token function">expungeStaleEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//æ‰©å®¹</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">&gt;=</span> threshold <span class="token operator">-</span> threshold <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span>
        <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//æ¸…ç†è¿‡æœŸEntry</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">expungeStaleEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Entry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab <span class="token operator">=</span> table<span class="token punctuation">;</span>
    <span class="token keyword">int</span> len <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Entry</span> e <span class="token operator">=</span> tab<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> e<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token function">expungeStaleEntry</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ç€çœ‹çœ‹å…·ä½“çš„<code>resize()</code>æ–¹æ³•ï¼Œæ‰©å®¹åçš„<code>newTab</code>çš„å¤§å°ä¸ºè€æ•°ç»„çš„ä¸¤å€ï¼Œç„¶åéå†è€çš„tableæ•°ç»„ï¼Œæ•£åˆ—æ–¹æ³•é‡æ–°è®¡ç®—ä½ç½®ï¼Œå¼€æ”¾åœ°å€è§£å†³å†²çªï¼Œç„¶åæ”¾åˆ°æ–°çš„<code>newTab</code>ï¼Œéå†å®Œæˆä¹‹åï¼Œ<code>oldTab</code>ä¸­æ‰€æœ‰çš„<code>entry</code>æ•°æ®éƒ½å·²ç»æ”¾å…¥åˆ°<code>newTab</code>ä¸­äº†ï¼Œç„¶åtableå¼•ç”¨æŒ‡å‘<code>newTab</code></p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-17.png" alt="ThreadLocalMapæ‰©å®¹"></p><p>å…·ä½“ä»£ç ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-18.png" alt="ThreadLocalMap resize"></p><h3 id="_17-çˆ¶å­çº¿ç¨‹æ€ä¹ˆå…±äº«æ•°æ®" tabindex="-1"><a class="header-anchor" href="#_17-çˆ¶å­çº¿ç¨‹æ€ä¹ˆå…±äº«æ•°æ®" aria-hidden="true">#</a> 17.çˆ¶å­çº¿ç¨‹æ€ä¹ˆå…±äº«æ•°æ®ï¼Ÿ</h3><p>çˆ¶çº¿ç¨‹èƒ½ç”¨ThreadLocalæ¥ç»™å­çº¿ç¨‹ä¼ å€¼å—ï¼Ÿæ¯«æ— ç–‘é—®ï¼Œä¸èƒ½ã€‚é‚£è¯¥æ€ä¹ˆåŠï¼Ÿ</p><p>è¿™æ—¶å€™å¯ä»¥ç”¨åˆ°å¦å¤–ä¸€ä¸ªç±»â€”â€”<code>InheritableThreadLocal </code>ã€‚</p><p>ä½¿ç”¨èµ·æ¥å¾ˆç®€å•ï¼Œåœ¨ä¸»çº¿ç¨‹çš„InheritableThreadLocalå®ä¾‹è®¾ç½®å€¼ï¼Œåœ¨å­çº¿ç¨‹ä¸­å°±å¯ä»¥æ‹¿åˆ°äº†ã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InheritableThreadLocalTest</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">ThreadLocal</span> threadLocal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InheritableThreadLocal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ä¸»çº¿ç¨‹</span>
        threadLocal<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸æ“…æŠ€æœ¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å­çº¿ç¨‹</span>
        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;é„™äººä¸‰æŸ ï¼Œ&quot;</span> <span class="token operator">+</span> threadLocal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>é‚£åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p></blockquote><p>åŸç†å¾ˆç®€å•ï¼Œåœ¨Threadç±»é‡Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªå˜é‡ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ThreadLocal<span class="token punctuation">.</span>ThreadLocalMap</span> inheritableThreadLocals <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åœ¨Thread.initçš„æ—¶å€™ï¼Œå¦‚æœçˆ¶çº¿ç¨‹çš„<code>inheritableThreadLocals</code>ä¸ä¸ºç©ºï¼Œå°±æŠŠå®ƒèµ‹ç»™å½“å‰çº¿ç¨‹ï¼ˆå­çº¿ç¨‹ï¼‰çš„<code>inheritableThreadLocals </code>ã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>inheritThreadLocals <span class="token operator">&amp;&amp;</span> parent<span class="token punctuation">.</span>inheritableThreadLocals <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>inheritableThreadLocals <span class="token operator">=</span>
        <span class="token class-name">ThreadLocal</span><span class="token punctuation">.</span><span class="token function">createInheritedMap</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>inheritableThreadLocals<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xingbiaogongzhonghao.png" alt=""></p><h2 id="javaå†…å­˜æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#javaå†…å­˜æ¨¡å‹" aria-hidden="true">#</a> Javaå†…å­˜æ¨¡å‹</h2><h3 id="_18-è¯´ä¸€ä¸‹ä½ å¯¹javaå†…å­˜æ¨¡å‹-jmm-çš„ç†è§£" tabindex="-1"><a class="header-anchor" href="#_18-è¯´ä¸€ä¸‹ä½ å¯¹javaå†…å­˜æ¨¡å‹-jmm-çš„ç†è§£" aria-hidden="true">#</a> 18.è¯´ä¸€ä¸‹ä½ å¯¹Javaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰çš„ç†è§£ï¼Ÿ</h3><p>Javaå†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼ŒJMMï¼‰ï¼Œæ˜¯ä¸€ç§æŠ½è±¡çš„æ¨¡å‹ï¼Œè¢«å®šä¹‰å‡ºæ¥å±è”½å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ã€‚</p><p>JMMå®šä¹‰äº†çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„æŠ½è±¡å…³ç³»ï¼šçº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡å­˜å‚¨åœ¨<code>ä¸»å†…å­˜</code>ï¼ˆMain Memoryï¼‰ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„<code>æœ¬åœ°å†…å­˜</code>ï¼ˆLocal Memoryï¼‰ï¼Œæœ¬åœ°å†…å­˜ä¸­å­˜å‚¨äº†è¯¥çº¿ç¨‹ä»¥è¯»/å†™å…±äº«å˜é‡çš„å‰¯æœ¬ã€‚</p><p>Javaå†…å­˜æ¨¡å‹çš„æŠ½è±¡å›¾ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-19.png" alt="Javaå†…å­˜æ¨¡å‹"></p><p>æœ¬åœ°å†…å­˜æ˜¯JMMçš„ ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå¹¶ä¸çœŸå®å­˜åœ¨ã€‚å®ƒå…¶å®æ¶µç›–äº†ç¼“å­˜ã€å†™ç¼“å†²åŒºã€å¯„å­˜å™¨ä»¥åŠå…¶ä»–çš„ç¡¬ä»¶å’Œç¼–è¯‘å™¨ä¼˜åŒ–ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-20.png" alt="å®é™…çº¿ç¨‹å·¥ä½œæ¨¡å‹"></p><p>å›¾é‡Œé¢çš„æ˜¯ä¸€ä¸ªåŒæ ¸ CPU ç³»ç»Ÿæ¶æ„ ï¼Œæ¯ä¸ªæ ¸æœ‰è‡ªå·±çš„æ§åˆ¶å™¨å’Œè¿ç®—å™¨ï¼Œå…¶ä¸­æ§åˆ¶å™¨åŒ…å«ä¸€ç»„å¯„å­˜å™¨å’Œæ“ä½œæ§åˆ¶å™¨ï¼Œè¿ç®—å™¨æ‰§è¡Œç®—æœ¯é€»è¾…è¿ç®—ã€‚æ¯ä¸ªæ ¸éƒ½æœ‰è‡ªå·±çš„ä¸€çº§ç¼“å­˜ï¼Œåœ¨æœ‰äº›æ¶æ„é‡Œé¢è¿˜æœ‰ä¸€ä¸ªæ‰€æœ‰ CPU å…±äº«çš„äºŒçº§ç¼“å­˜ã€‚ é‚£ä¹ˆ Java å†…å­˜æ¨¡å‹é‡Œé¢çš„å·¥ä½œå†…å­˜ï¼Œå°±å¯¹åº”è¿™é‡Œçš„ Ll ç¼“å­˜æˆ–è€… L2 ç¼“å­˜æˆ–è€… CPU å¯„å­˜å™¨ã€‚</p><h3 id="_19-è¯´è¯´ä½ å¯¹åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§çš„ç†è§£" tabindex="-1"><a class="header-anchor" href="#_19-è¯´è¯´ä½ å¯¹åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§çš„ç†è§£" aria-hidden="true">#</a> 19.è¯´è¯´ä½ å¯¹åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§çš„ç†è§£ï¼Ÿ</h3><p>åŸå­æ€§ã€æœ‰åºæ€§ã€å¯è§æ€§æ˜¯å¹¶å‘ç¼–ç¨‹ä¸­éå¸¸é‡è¦çš„åŸºç¡€æ¦‚å¿µï¼ŒJMMçš„å¾ˆå¤šæŠ€æœ¯éƒ½æ˜¯å›´ç»•ç€è¿™ä¸‰å¤§ç‰¹æ€§å±•å¼€ã€‚</p><ul><li><strong>åŸå­æ€§</strong>ï¼šåŸå­æ€§æŒ‡çš„æ˜¯ä¸€ä¸ªæ“ä½œæ˜¯ä¸å¯åˆ†å‰²ã€ä¸å¯ä¸­æ–­çš„ï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œå¹¶ä¸”æ‰§è¡Œçš„è¿‡ç¨‹ä¸ä¼šè¢«ä»»ä½•å› ç´ æ‰“æ–­ï¼Œè¦ä¹ˆå°±å…¨ä¸æ‰§è¡Œã€‚</li><li><strong>å¯è§æ€§</strong>ï¼šå¯è§æ€§æŒ‡çš„æ˜¯ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸€ä¸ªå…±äº«å˜é‡çš„å€¼æ—¶ï¼Œå…¶å®ƒçº¿ç¨‹èƒ½å¤Ÿç«‹å³çŸ¥é“è¿™ä¸ªä¿®æ”¹ã€‚</li><li><strong>æœ‰åºæ€§</strong>ï¼šæœ‰åºæ€§æŒ‡çš„æ˜¯å¯¹äºä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œä»£ç ï¼Œä»å‰å¾€åä¾æ¬¡æ‰§è¡Œï¼Œå•çº¿ç¨‹ä¸‹å¯ä»¥è®¤ä¸ºç¨‹åºæ˜¯æœ‰åºçš„ï¼Œä½†æ˜¯å¹¶å‘æ—¶æœ‰å¯èƒ½ä¼šå‘ç”ŸæŒ‡ä»¤é‡æ’ã€‚</li></ul><blockquote><p>åˆ†æä¸‹é¢å‡ è¡Œä»£ç çš„åŸå­æ€§ï¼Ÿ</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span>
i<span class="token operator">++</span><span class="token punctuation">;</span>
i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ç¬¬1å¥æ˜¯åŸºæœ¬ç±»å‹èµ‹å€¼ï¼Œæ˜¯åŸå­æ€§æ“ä½œã€‚</li><li>ç¬¬2å¥å…ˆè¯»içš„å€¼ï¼Œå†èµ‹å€¼åˆ°jï¼Œä¸¤æ­¥æ“ä½œï¼Œä¸èƒ½ä¿è¯åŸå­æ€§ã€‚</li><li>ç¬¬3å’Œç¬¬4å¥å…¶å®æ˜¯ç­‰æ•ˆçš„ï¼Œå…ˆè¯»å–içš„å€¼ï¼Œå†+1ï¼Œæœ€åèµ‹å€¼åˆ°iï¼Œä¸‰æ­¥æ“ä½œäº†ï¼Œä¸èƒ½ä¿è¯åŸå­æ€§ã€‚</li></ul><blockquote><p>åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§éƒ½åº”è¯¥æ€ä¹ˆä¿è¯å‘¢ï¼Ÿ</p></blockquote><ul><li>åŸå­æ€§ï¼šJMMåªèƒ½ä¿è¯åŸºæœ¬çš„åŸå­æ€§ï¼Œå¦‚æœè¦ä¿è¯ä¸€ä¸ªä»£ç å—çš„åŸå­æ€§ï¼Œéœ€è¦ä½¿ç”¨<code>synchronized </code>ã€‚</li><li>å¯è§æ€§ï¼šJavaæ˜¯åˆ©ç”¨<code>volatile</code>å…³é”®å­—æ¥ä¿è¯å¯è§æ€§çš„ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œ<code>final</code>å’Œ<code>synchronized</code>ä¹Ÿèƒ½ä¿è¯å¯è§æ€§ã€‚</li><li>æœ‰åºæ€§ï¼š<code>synchronized</code>æˆ–è€…<code>volatile</code>éƒ½å¯ä»¥ä¿è¯å¤šçº¿ç¨‹ä¹‹é—´æ“ä½œçš„æœ‰åºæ€§ã€‚</li></ul><h3 id="_20-é‚£è¯´è¯´ä»€ä¹ˆæ˜¯æŒ‡ä»¤é‡æ’" tabindex="-1"><a class="header-anchor" href="#_20-é‚£è¯´è¯´ä»€ä¹ˆæ˜¯æŒ‡ä»¤é‡æ’" aria-hidden="true">#</a> 20.é‚£è¯´è¯´ä»€ä¹ˆæ˜¯æŒ‡ä»¤é‡æ’ï¼Ÿ</h3><p>åœ¨æ‰§è¡Œç¨‹åºæ—¶ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸¸å¸¸ä¼šå¯¹æŒ‡ä»¤åšé‡æ’åºã€‚é‡æ’åºåˆ†3ç§ç±»å‹ã€‚</p><ol><li>ç¼–è¯‘å™¨ä¼˜åŒ–çš„é‡æ’åºã€‚ç¼–è¯‘å™¨åœ¨ä¸æ”¹å˜å•çº¿ç¨‹ç¨‹åºè¯­ä¹‰çš„å‰æä¸‹ï¼Œå¯ä»¥é‡æ–°å®‰æ’è¯­å¥çš„æ‰§è¡Œé¡ºåºã€‚</li><li>æŒ‡ä»¤çº§å¹¶è¡Œçš„é‡æ’åºã€‚ç°ä»£å¤„ç†å™¨é‡‡ç”¨äº†æŒ‡ä»¤çº§å¹¶è¡ŒæŠ€æœ¯ï¼ˆInstruction-Level Parallelismï¼ŒILPï¼‰æ¥å°†å¤šæ¡æŒ‡ä»¤é‡å æ‰§è¡Œã€‚å¦‚æœä¸å­˜åœ¨æ•°æ®ä¾èµ–æ€§ï¼Œå¤„ç†å™¨å¯ä»¥æ”¹å˜è¯­å¥å¯¹åº” æœºå™¨æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºã€‚</li><li>å†…å­˜ç³»ç»Ÿçš„é‡æ’åºã€‚ç”±äºå¤„ç†å™¨ä½¿ç”¨ç¼“å­˜å’Œè¯»/å†™ç¼“å†²åŒºï¼Œè¿™ä½¿å¾—åŠ è½½å’Œå­˜å‚¨æ“ä½œçœ‹ä¸Šå»å¯èƒ½æ˜¯åœ¨ä¹±åºæ‰§è¡Œã€‚</li></ol><p>ä»Javaæºä»£ç åˆ°æœ€ç»ˆå®é™…æ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—ï¼Œä¼šåˆ†åˆ«ç»å†ä¸‹é¢3ç§é‡æ’åºï¼Œå¦‚å›¾ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-21.png" alt="å¤šçº§æŒ‡ä»¤é‡æ’"></p><p>æˆ‘ä»¬æ¯”è¾ƒç†Ÿæ‚‰çš„åŒé‡æ ¡éªŒå•ä¾‹æ¨¡å¼å°±æ˜¯ä¸€ä¸ªç»å…¸çš„æŒ‡ä»¤é‡æ’çš„ä¾‹å­ï¼Œ<code>Singleton instance=new Singleton()ï¼›</code>å¯¹åº”çš„JVMæŒ‡ä»¤åˆ†ä¸ºä¸‰æ­¥ï¼šåˆ†é…å†…å­˜ç©ºé—´--&gt;åˆå§‹åŒ–å¯¹è±¡---&gt;å¯¹è±¡æŒ‡å‘åˆ†é…çš„å†…å­˜ç©ºé—´ï¼Œä½†æ˜¯ç»è¿‡äº†ç¼–è¯‘å™¨çš„æŒ‡ä»¤é‡æ’åºï¼Œç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥å°±å¯èƒ½ä¼šé‡æ’åºã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-22.png" alt="åŒé‡æ ¡éªŒå•ä¾‹æ¨¡å¼å¼‚å¸¸æƒ…å½¢"></p><p>JMMå±äºè¯­è¨€çº§çš„å†…å­˜æ¨¡å‹ï¼Œå®ƒç¡®ä¿åœ¨ä¸åŒçš„ç¼–è¯‘å™¨å’Œä¸åŒçš„å¤„ç†å™¨å¹³å°ä¹‹ä¸Šï¼Œé€šè¿‡ç¦æ­¢ç‰¹å®šç±»å‹çš„ç¼–è¯‘å™¨é‡æ’åºå’Œå¤„ç†å™¨é‡æ’åºï¼Œä¸ºç¨‹åºå‘˜æä¾›ä¸€è‡´çš„å†…å­˜å¯è§æ€§ä¿è¯ã€‚</p><h3 id="_21-æŒ‡ä»¤é‡æ’æœ‰é™åˆ¶å—-happens-beforeäº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_21-æŒ‡ä»¤é‡æ’æœ‰é™åˆ¶å—-happens-beforeäº†è§£å—" aria-hidden="true">#</a> 21.æŒ‡ä»¤é‡æ’æœ‰é™åˆ¶å—ï¼Ÿhappens-beforeäº†è§£å—ï¼Ÿ</h3><p>æŒ‡ä»¤é‡æ’ä¹Ÿæ˜¯æœ‰ä¸€äº›é™åˆ¶çš„ï¼Œæœ‰ä¸¤ä¸ªè§„åˆ™<code>happens-before</code>å’Œ<code>as-if-serial</code>æ¥çº¦æŸã€‚</p><p>happens-beforeçš„å®šä¹‰ï¼š</p><ul><li>å¦‚æœä¸€ä¸ªæ“ä½œhappens-beforeå¦ä¸€ä¸ªæ“ä½œï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œç»“æœå°†å¯¹ç¬¬äºŒä¸ªæ“ä½œå¯è§ï¼Œè€Œä¸”ç¬¬ä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºæ’åœ¨ç¬¬äºŒä¸ªæ“ä½œä¹‹å‰ã€‚</li><li>ä¸¤ä¸ªæ“ä½œä¹‹é—´å­˜åœ¨happens-beforeå…³ç³»ï¼Œå¹¶ä¸æ„å‘³ç€Javaå¹³å°çš„å…·ä½“å®ç°å¿…é¡»è¦æŒ‰ç…§ happens-beforeå…³ç³»æŒ‡å®šçš„é¡ºåºæ¥æ‰§è¡Œã€‚å¦‚æœé‡æ’åºä¹‹åçš„æ‰§è¡Œç»“æœï¼Œä¸æŒ‰happens-beforeå…³ç³»æ¥æ‰§è¡Œçš„ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆè¿™ç§é‡æ’åºå¹¶ä¸éæ³•</li></ul><p>happens-beforeå’Œæˆ‘ä»¬æ¯æ¯ç›¸å…³çš„æœ‰å…­å¤§è§„åˆ™ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-23.png" alt="happens-beforeå…­å¤§è§„åˆ™"></p><ul><li><strong>ç¨‹åºé¡ºåºè§„åˆ™</strong>ï¼šä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ¯ä¸ªæ“ä½œï¼Œhappens-beforeäºè¯¥çº¿ç¨‹ä¸­çš„ä»»æ„åç»­æ“ä½œã€‚</li><li><strong>ç›‘è§†å™¨é”è§„åˆ™</strong>ï¼šå¯¹ä¸€ä¸ªé”çš„è§£é”ï¼Œhappens-beforeäºéšåå¯¹è¿™ä¸ªé”çš„åŠ é”ã€‚</li><li><strong>volatileå˜é‡è§„åˆ™</strong>ï¼šå¯¹ä¸€ä¸ªvolatileåŸŸçš„å†™ï¼Œhappens-beforeäºä»»æ„åç»­å¯¹è¿™ä¸ªvolatileåŸŸçš„è¯»ã€‚</li><li><strong>ä¼ é€’æ€§</strong>ï¼šå¦‚æœA happens-before Bï¼Œä¸”B happens-before Cï¼Œé‚£ä¹ˆA happens-before Cã€‚</li><li><strong>start()è§„åˆ™</strong>ï¼šå¦‚æœçº¿ç¨‹Aæ‰§è¡Œæ“ä½œThreadB.start()ï¼ˆå¯åŠ¨çº¿ç¨‹Bï¼‰ï¼Œé‚£ä¹ˆAçº¿ç¨‹çš„ ThreadB.start()æ“ä½œhappens-beforeäºçº¿ç¨‹Bä¸­çš„ä»»æ„æ“ä½œã€‚</li><li><strong>join()è§„åˆ™</strong>ï¼šå¦‚æœçº¿ç¨‹Aæ‰§è¡Œæ“ä½œThreadB.join()å¹¶æˆåŠŸè¿”å›ï¼Œé‚£ä¹ˆçº¿ç¨‹Bä¸­çš„ä»»æ„æ“ä½œ happens-beforeäºçº¿ç¨‹Aä»ThreadB.join()æ“ä½œæˆåŠŸè¿”å›ã€‚</li></ul><h3 id="_22-as-if-serialåˆæ˜¯ä»€ä¹ˆ-å•çº¿ç¨‹çš„ç¨‹åºä¸€å®šæ˜¯é¡ºåºçš„å—" tabindex="-1"><a class="header-anchor" href="#_22-as-if-serialåˆæ˜¯ä»€ä¹ˆ-å•çº¿ç¨‹çš„ç¨‹åºä¸€å®šæ˜¯é¡ºåºçš„å—" aria-hidden="true">#</a> 22.as-if-serialåˆæ˜¯ä»€ä¹ˆï¼Ÿå•çº¿ç¨‹çš„ç¨‹åºä¸€å®šæ˜¯é¡ºåºçš„å—ï¼Ÿ</h3><p>as-if-serialè¯­ä¹‰çš„æ„æ€æ˜¯ï¼šä¸ç®¡æ€ä¹ˆé‡æ’åºï¼ˆç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†æé«˜å¹¶è¡Œåº¦ï¼‰ï¼Œ<strong>å•çº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œç»“æœä¸èƒ½è¢«æ”¹å˜</strong>ã€‚ç¼–è¯‘å™¨ã€runtimeå’Œå¤„ç†å™¨éƒ½å¿…é¡»éµå®ˆas-if-serialè¯­ä¹‰ã€‚</p><p>ä¸ºäº†éµå®ˆas-if-serialè¯­ä¹‰ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ä¼šå¯¹å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„æ“ä½œåšé‡æ’åºï¼Œå› ä¸ºè¿™ç§é‡æ’åºä¼šæ”¹å˜æ‰§è¡Œç»“æœã€‚ä½†æ˜¯ï¼Œå¦‚æœæ“ä½œä¹‹é—´ä¸å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ï¼Œè¿™äº›æ“ä½œå°±å¯èƒ½è¢«ç¼–è¯‘å™¨å’Œå¤„ç†å™¨é‡æ’åºã€‚ä¸ºäº†å…·ä½“è¯´æ˜ï¼Œè¯·çœ‹ä¸‹é¢è®¡ç®—åœ†é¢ç§¯çš„ä»£ç ç¤ºä¾‹ã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">double</span> pi <span class="token operator">=</span> <span class="token number">3.14</span><span class="token punctuation">;</span>   <span class="token comment">// A</span>
<span class="token keyword">double</span> r <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>   <span class="token comment">// B </span>
<span class="token keyword">double</span> area <span class="token operator">=</span> pi <span class="token operator">*</span> r <span class="token operator">*</span> r<span class="token punctuation">;</span>   <span class="token comment">// C</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢3ä¸ªæ“ä½œçš„æ•°æ®ä¾èµ–å…³ç³»ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-24.png" alt=""></p><p>Aå’ŒCä¹‹é—´å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ï¼ŒåŒæ—¶Bå’ŒCä¹‹é—´ä¹Ÿå­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ã€‚å› æ­¤åœ¨æœ€ç»ˆæ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—ä¸­ï¼ŒCä¸èƒ½è¢«é‡æ’åºåˆ°Aå’ŒBçš„å‰é¢ï¼ˆCæ’åˆ°Aå’ŒBçš„å‰é¢ï¼Œç¨‹åºçš„ç»“æœå°†ä¼šè¢«æ”¹å˜ï¼‰ã€‚ä½†Aå’ŒBä¹‹é—´æ²¡æœ‰æ•°æ®ä¾èµ–å…³ç³»ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯ä»¥é‡æ’åºAå’ŒBä¹‹é—´çš„æ‰§è¡Œé¡ºåºã€‚</p><p>æ‰€ä»¥æœ€ç»ˆï¼Œç¨‹åºå¯èƒ½ä¼šæœ‰ä¸¤ç§æ‰§è¡Œé¡ºåºï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-25.png" alt="ä¸¤ç§æ‰§è¡Œç»“æœ"></p><p>as-if-serialè¯­ä¹‰æŠŠå•çº¿ç¨‹ç¨‹åºä¿æŠ¤äº†èµ·æ¥ï¼Œéµå®ˆas-if-serialè¯­ä¹‰çš„ç¼–è¯‘å™¨ã€runtimeå’Œå¤„ç†å™¨å…±åŒç¼–ç»‡äº†è¿™ä¹ˆä¸€ä¸ªâ€œæ¥šé—¨çš„ä¸–ç•Œâ€ï¼šå•çº¿ç¨‹ç¨‹åºæ˜¯æŒ‰ç¨‹åºçš„â€œé¡ºåºâ€æ¥æ‰§è¡Œçš„ã€‚as- if-serialè¯­ä¹‰ä½¿å•çº¿ç¨‹æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‹…å¿ƒé‡æ’åºçš„é—®é¢˜ï¼Œå¯è§æ€§çš„é—®é¢˜ã€‚</p><h3 id="_23-volatileå®ç°åŸç†äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_23-volatileå®ç°åŸç†äº†è§£å—" aria-hidden="true">#</a> 23.volatileå®ç°åŸç†äº†è§£å—ï¼Ÿ</h3><p>volatileæœ‰ä¸¤ä¸ªä½œç”¨ï¼Œä¿è¯<strong>å¯è§æ€§</strong>å’Œ<strong>æœ‰åºæ€§</strong>ã€‚</p><blockquote><p>volatileæ€ä¹ˆä¿è¯å¯è§æ€§çš„å‘¢ï¼Ÿ</p></blockquote><p>ç›¸æ¯”synchronizedçš„åŠ é”æ–¹å¼æ¥è§£å†³å…±äº«å˜é‡çš„å†…å­˜å¯è§æ€§é—®é¢˜ï¼Œvolatileå°±æ˜¯æ›´è½»é‡çš„é€‰æ‹©ï¼Œå®ƒæ²¡æœ‰ä¸Šä¸‹æ–‡åˆ‡æ¢çš„é¢å¤–å¼€é”€æˆæœ¬ã€‚</p><p>volatileå¯ä»¥ç¡®ä¿å¯¹æŸä¸ªå˜é‡çš„æ›´æ–°å¯¹å…¶ä»–çº¿ç¨‹é©¬ä¸Šå¯è§ï¼Œä¸€ä¸ªå˜é‡è¢«å£°æ˜ä¸ºvolatile æ—¶ï¼Œçº¿ç¨‹åœ¨å†™å…¥å˜é‡æ—¶ä¸ä¼šæŠŠå€¼ç¼“å­˜åœ¨å¯„å­˜å™¨æˆ–è€…å…¶ä»–åœ°æ–¹ï¼Œè€Œæ˜¯ä¼šæŠŠå€¼åˆ·æ–°å›ä¸»å†…å­˜ å½“å…¶å®ƒçº¿ç¨‹è¯»å–è¯¥å…±äº«å˜é‡ ï¼Œä¼šä»ä¸»å†…å­˜é‡æ–°è·å–æœ€æ–°å€¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å½“å‰çº¿ç¨‹çš„æœ¬åœ°å†…å­˜ä¸­çš„å€¼ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å£°æ˜ä¸€ä¸ª volatile å˜é‡ volatile int x = 0ï¼Œçº¿ç¨‹Aä¿®æ”¹x=1ï¼Œä¿®æ”¹å®Œä¹‹åå°±ä¼šæŠŠæ–°çš„å€¼åˆ·æ–°å›ä¸»å†…å­˜ï¼Œçº¿ç¨‹Bè¯»å–xçš„æ—¶å€™ï¼Œå°±ä¼šæ¸…ç©ºæœ¬åœ°å†…å­˜å˜é‡ï¼Œç„¶åå†ä»ä¸»å†…å­˜è·å–æœ€æ–°å€¼ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-26.png" alt="volatileå†…å­˜å¯è§æ€§"></p><blockquote><p>volatileæ€ä¹ˆä¿è¯æœ‰åºæ€§çš„å‘¢ï¼Ÿ</p></blockquote><p>é‡æ’åºå¯ä»¥åˆ†ä¸ºç¼–è¯‘å™¨é‡æ’åºå’Œå¤„ç†å™¨é‡æ’åºï¼Œvalatileä¿è¯æœ‰åºæ€§ï¼Œå°±æ˜¯é€šè¿‡åˆ†åˆ«é™åˆ¶è¿™ä¸¤ç§ç±»å‹çš„é‡æ’åºã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-27.png" alt="volatileé‡æ’åºè§„åˆ™è¡¨"></p><p>ä¸ºäº†å®ç°volatileçš„å†…å­˜è¯­ä¹‰ï¼Œç¼–è¯‘å™¨åœ¨ç”Ÿæˆå­—èŠ‚ç æ—¶ï¼Œä¼šåœ¨æŒ‡ä»¤åºåˆ—ä¸­æ’å…¥å†…å­˜å±éšœæ¥ç¦æ­¢ç‰¹å®šç±»å‹çš„å¤„ç†å™¨é‡æ’åºã€‚</p><ol><li>åœ¨æ¯ä¸ªvolatileå†™æ“ä½œçš„å‰é¢æ’å…¥ä¸€ä¸ª<code>StoreStore</code>å±éšœ</li><li>åœ¨æ¯ä¸ªvolatileå†™æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª<code>StoreLoad</code>å±éšœ</li><li>åœ¨æ¯ä¸ªvolatileè¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª<code>LoadLoad</code>å±éšœ</li><li>åœ¨æ¯ä¸ªvolatileè¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª<code>LoadStore</code>å±éšœ</li></ol><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-28.png" alt="volatileå†™æ’å…¥å†…å­˜å±éšœåç”Ÿæˆçš„æŒ‡ä»¤åºåˆ—ç¤ºæ„å›¾"></p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-29.png" alt="volatileå†™æ’å…¥å†…å­˜å±éšœåç”Ÿæˆçš„æŒ‡ä»¤åºåˆ—ç¤ºæ„å›¾"></p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xingbiaogongzhonghao.png" alt=""></p><h2 id="é”" tabindex="-1"><a class="header-anchor" href="#é”" aria-hidden="true">#</a> é”</h2><h3 id="_24-synchronizedç”¨è¿‡å—-æ€ä¹ˆä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#_24-synchronizedç”¨è¿‡å—-æ€ä¹ˆä½¿ç”¨" aria-hidden="true">#</a> 24.synchronizedç”¨è¿‡å—ï¼Ÿæ€ä¹ˆä½¿ç”¨ï¼Ÿ</h3><p>synchronizedç»å¸¸ç”¨çš„ï¼Œç”¨æ¥ä¿è¯ä»£ç çš„åŸå­æ€§ã€‚</p><p>synchronizedä¸»è¦æœ‰ä¸‰ç§ç”¨æ³•ï¼š</p><ul><li><strong>ä¿®é¥°å®ä¾‹æ–¹æ³•:</strong> ä½œç”¨äºå½“å‰å¯¹è±¡å®ä¾‹åŠ é”ï¼Œè¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾— <strong>å½“å‰å¯¹è±¡å®ä¾‹çš„é”</strong></li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//ä¸šåŠ¡ä»£ç </span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><strong>ä¿®é¥°é™æ€æ–¹æ³•</strong>ï¼šä¹Ÿå°±æ˜¯ç»™å½“å‰ç±»åŠ é”ï¼Œä¼šä½œâ½¤äºç±»çš„æ‰€æœ‰å¯¹è±¡å®ä¾‹ ï¼Œè¿›â¼ŠåŒæ­¥ä»£ç å‰è¦è·å¾—å½“å‰ class çš„é”ã€‚å› ä¸ºé™æ€æˆå‘˜ä¸å±äºä»»ä½•â¼€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œæ˜¯ç±»æˆå‘˜ï¼ˆ static è¡¨æ˜è¿™æ˜¯è¯¥ç±»çš„â¼€ä¸ªé™æ€èµ„æºï¼Œä¸ç®¡ new äº†å¤šå°‘ä¸ªå¯¹è±¡ï¼Œåªæœ‰â¼€ä»½ï¼‰ã€‚</p><p>å¦‚æœâ¼€ä¸ªçº¿ç¨‹ A è°ƒâ½¤â¼€ä¸ªå®ä¾‹å¯¹è±¡çš„â¾®é™æ€ synchronized â½…æ³•ï¼Œâ½½çº¿ç¨‹ B éœ€è¦è°ƒâ½¤è¿™ä¸ªå®ä¾‹å¯¹è±¡æ‰€å±ç±»çš„é™æ€ synchronized â½…æ³•ï¼Œæ˜¯å…è®¸çš„ï¼Œä¸ä¼šå‘â½£äº’æ–¥ç°è±¡ï¼Œå› ä¸ºè®¿é—®é™æ€ synchronized â½…æ³•å â½¤çš„é”æ˜¯å½“å‰ç±»çš„é”ï¼Œâ½½è®¿é—®â¾®é™æ€ synchronized â½…æ³•å â½¤çš„é”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡é”ã€‚</p></li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">synchronized</span> <span class="token keyword">void</span> staic <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">//ä¸šåŠ¡ä»£ç </span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>ä¿®é¥°ä»£ç å—</strong> ï¼šæŒ‡å®šåŠ é”å¯¹è±¡ï¼Œå¯¹ç»™å®šå¯¹è±¡/ç±»åŠ é”ã€‚ synchronized(this|object) è¡¨ç¤ºè¿›â¼ŠåŒæ­¥ä»£ç åº“å‰è¦è·å¾—ç»™å®šå¯¹è±¡çš„é”ã€‚ synchronized(ç±».class) è¡¨ç¤ºè¿›â¼ŠåŒæ­¥ä»£ç å‰è¦è·å¾— å½“å‰ <strong>class</strong> çš„é”</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">//ä¸šåŠ¡ä»£ç </span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_25-synchronizedçš„å®ç°åŸç†" tabindex="-1"><a class="header-anchor" href="#_25-synchronizedçš„å®ç°åŸç†" aria-hidden="true">#</a> 25.synchronizedçš„å®ç°åŸç†ï¼Ÿ</h3><blockquote><p>synchronizedæ˜¯æ€ä¹ˆåŠ é”çš„å‘¢ï¼Ÿ</p></blockquote><p>æˆ‘ä»¬ä½¿ç”¨synchronizedçš„æ—¶å€™ï¼Œå‘ç°ä¸ç”¨è‡ªå·±å»lockå’Œunlockï¼Œæ˜¯å› ä¸ºJVMå¸®æˆ‘ä»¬æŠŠè¿™ä¸ªäº‹æƒ…åšäº†ã€‚</p><ol><li><p>synchronizedä¿®é¥°ä»£ç å—æ—¶ï¼ŒJVMé‡‡ç”¨<code>monitorenter</code>ã€<code>monitorexit</code>ä¸¤ä¸ªæŒ‡ä»¤æ¥å®ç°åŒæ­¥ï¼Œ<code>monitorenter</code> æŒ‡ä»¤æŒ‡å‘åŒæ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼Œ <code>monitorexit</code> æŒ‡ä»¤åˆ™æŒ‡å‘åŒæ­¥ä»£ç å—çš„ç»“æŸä½ç½®ã€‚</p><p>åç¼–è¯‘ä¸€æ®µsynchronizedä¿®é¥°ä»£ç å—ä»£ç ï¼Œ<code>javap -c -s -v -l SynchronizedDemo.class</code>ï¼Œå¯ä»¥çœ‹åˆ°ç›¸åº”çš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</p></li></ol><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-30.png" alt="monitorenterå’Œmonitorexit"></p><ol start="2"><li>synchronizedä¿®é¥°åŒæ­¥æ–¹æ³•æ—¶ï¼ŒJVMé‡‡ç”¨<code>ACC_SYNCHRONIZED</code>æ ‡è®°ç¬¦æ¥å®ç°åŒæ­¥ï¼Œè¿™ä¸ªæ ‡è¯†æŒ‡æ˜äº†è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•ã€‚</li></ol><p>åŒæ ·å¯ä»¥å†™æ®µä»£ç åç¼–è¯‘çœ‹ä¸€ä¸‹ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-31.png" alt="synchronizedä¿®é¥°åŒæ­¥æ–¹æ³•"></p><blockquote><p>synchronizedé”ä½çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p></blockquote><p>monitorenterã€monitorexitæˆ–è€…ACC_SYNCHRONIZEDéƒ½æ˜¯<strong>åŸºäºMonitorå®ç°</strong>çš„ã€‚</p><p>å®ä¾‹å¯¹è±¡ç»“æ„é‡Œæœ‰å¯¹è±¡å¤´ï¼Œå¯¹è±¡å¤´é‡Œé¢æœ‰ä¸€å—ç»“æ„å«Mark Wordï¼ŒMark WordæŒ‡é’ˆæŒ‡å‘äº†<strong>monitor</strong>ã€‚</p><p>æ‰€è°“çš„Monitorå…¶å®æ˜¯ä¸€ç§<strong>åŒæ­¥å·¥å…·</strong>ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ä¸€ç§<strong>åŒæ­¥æœºåˆ¶</strong>ã€‚åœ¨Javaè™šæ‹Ÿæœºï¼ˆHotSpotï¼‰ä¸­ï¼ŒMonitoræ˜¯ç”±<strong>ObjectMonitorå®ç°</strong>çš„ï¼Œå¯ä»¥å«åšå†…éƒ¨é”ï¼Œæˆ–è€…Monitoré”ã€‚</p><p>ObjectMonitorçš„å·¥ä½œåŸç†ï¼š</p><ul><li>ObjectMonitoræœ‰ä¸¤ä¸ªé˜Ÿåˆ—ï¼š_WaitSetã€_EntryListï¼Œç”¨æ¥ä¿å­˜ObjectWaiter å¯¹è±¡åˆ—è¡¨ã€‚</li><li>_ownerï¼Œè·å– Monitor å¯¹è±¡çš„çº¿ç¨‹è¿›å…¥ _owner åŒºæ—¶ï¼Œ _count + 1ã€‚å¦‚æœçº¿ç¨‹è°ƒç”¨äº† wait() æ–¹æ³•ï¼Œæ­¤æ—¶ä¼šé‡Šæ”¾ Monitor å¯¹è±¡ï¼Œ _owner æ¢å¤ä¸ºç©ºï¼Œ _count - 1ã€‚åŒæ—¶è¯¥ç­‰å¾…çº¿ç¨‹è¿›å…¥ _WaitSet ä¸­ï¼Œç­‰å¾…è¢«å”¤é†’ã€‚</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ObjectMonitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _header       <span class="token operator">=</span> NULL<span class="token punctuation">;</span>
    _count        <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// è®°å½•çº¿ç¨‹è·å–é”çš„æ¬¡æ•°</span>
    _waiters      <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    _recursions   <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">//é”çš„é‡å…¥æ¬¡æ•°</span>
    _object       <span class="token operator">=</span> NULL<span class="token punctuation">;</span>
    _owner        <span class="token operator">=</span> NULL<span class="token punctuation">;</span>  <span class="token comment">// æŒ‡å‘æŒæœ‰ObjectMonitorå¯¹è±¡çš„çº¿ç¨‹</span>
    _WaitSet      <span class="token operator">=</span> NULL<span class="token punctuation">;</span>  <span class="token comment">// å¤„äºwaitçŠ¶æ€çš„çº¿ç¨‹ï¼Œä¼šè¢«åŠ å…¥åˆ°_WaitSet</span>
    _WaitSetLock  <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
    _Responsible  <span class="token operator">=</span> NULL <span class="token punctuation">;</span>
    _succ         <span class="token operator">=</span> NULL <span class="token punctuation">;</span>
    _cxq          <span class="token operator">=</span> NULL <span class="token punctuation">;</span>
    <span class="token class-name">FreeNext</span>      <span class="token operator">=</span> NULL <span class="token punctuation">;</span>
    _EntryList    <span class="token operator">=</span> NULL <span class="token punctuation">;</span>  <span class="token comment">// å¤„äºç­‰å¾…é”blockçŠ¶æ€çš„çº¿ç¨‹ï¼Œä¼šè¢«åŠ å…¥åˆ°è¯¥åˆ—è¡¨</span>
    _SpinFreq     <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
    _SpinClock    <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
    <span class="token class-name">OwnerIsThread</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥ç±»æ¯”ä¸€ä¸ªå»åŒ»é™¢å°±è¯Šçš„ä¾‹å­[18]ï¼š</p><ul><li><p>é¦–å…ˆï¼Œæ‚£è€…åœ¨<strong>é—¨è¯Šå¤§å…</strong>å‰å°æˆ–è‡ªåŠ©æŒ‚å·æœº<strong>è¿›è¡ŒæŒ‚å·</strong>ï¼›</p></li><li><p>éšåï¼ŒæŒ‚å·ç»“æŸåæ‚£è€…æ‰¾åˆ°å¯¹åº”çš„<strong>è¯Šå®¤å°±è¯Š</strong>ï¼š</p><ul><li>è¯Šå®¤æ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªæ‚£è€…å°±è¯Šï¼›</li><li>å¦‚æœæ­¤æ—¶è¯Šå®¤ç©ºé—²ï¼Œç›´æ¥è¿›å…¥å°±è¯Šï¼›</li><li>å¦‚æœæ­¤æ—¶è¯Šå®¤å†…æœ‰å…¶å®ƒæ‚£è€…å°±è¯Šï¼Œé‚£ä¹ˆå½“å‰æ‚£è€…è¿›å…¥<strong>å€™è¯Šå®¤</strong>ï¼Œç­‰å¾…å«å·ï¼›</li></ul></li><li><p>å°±è¯Šç»“æŸåï¼Œ<strong>èµ°å‡ºå°±è¯Šå®¤</strong>ï¼Œå€™è¯Šå®¤çš„<strong>ä¸‹ä¸€ä½å€™è¯Šæ‚£è€…</strong>è¿›å…¥å°±è¯Šå®¤ã€‚</p></li></ul><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-32.png" alt="å°±è¯Š-å›¾ç‰‡æ¥æºå‚è€ƒ[18]"></p><p>è¿™ä¸ªè¿‡ç¨‹å°±å’ŒMonitoræœºåˆ¶æ¯”è¾ƒç›¸ä¼¼ï¼š</p><ul><li><strong>é—¨è¯Šå¤§å…</strong>ï¼šæ‰€æœ‰å¾…è¿›å…¥çš„çº¿ç¨‹éƒ½å¿…é¡»å…ˆåœ¨<strong>å…¥å£Entry Set</strong>æŒ‚å·æ‰æœ‰èµ„æ ¼ï¼›</li><li><strong>å°±è¯Šå®¤</strong>ï¼šå°±è¯Šå®¤**_Owner**é‡Œé‡Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å°±è¯Šï¼Œå°±è¯Šå®Œçº¿ç¨‹å°±è‡ªè¡Œç¦»å¼€</li><li><strong>å€™è¯Šå®¤</strong>ï¼šå°±è¯Šå®¤ç¹å¿™æ—¶ï¼Œè¿›å…¥<strong>ç­‰å¾…åŒºï¼ˆWait Setï¼‰</strong>ï¼Œå°±è¯Šå®¤ç©ºé—²çš„æ—¶å€™å°±ä»**ç­‰å¾…åŒºï¼ˆWait Setï¼‰**å«æ–°çš„çº¿ç¨‹</li></ul><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-33.png" alt="Java Montioræœºåˆ¶"></p><p>æ‰€ä»¥æˆ‘ä»¬å°±çŸ¥é“äº†ï¼ŒåŒæ­¥æ˜¯é”ä½çš„ä»€ä¹ˆä¸œè¥¿ï¼š</p><ul><li>monitorenterï¼Œåœ¨åˆ¤æ–­æ‹¥æœ‰åŒæ­¥æ ‡è¯† ACC_SYNCHRONIZED æŠ¢å…ˆè¿›å…¥æ­¤æ–¹æ³•çš„çº¿ç¨‹ä¼šä¼˜å…ˆæ‹¥æœ‰ Monitor çš„ owner ï¼Œæ­¤æ—¶è®¡æ•°å™¨ +1ã€‚</li><li>monitorexitï¼Œå½“æ‰§è¡Œå®Œé€€å‡ºåï¼Œè®¡æ•°å™¨ -1ï¼Œå½’ 0 åè¢«å…¶ä»–è¿›å…¥çš„çº¿ç¨‹è·å¾—ã€‚</li></ul><h3 id="_26-é™¤äº†åŸå­æ€§-synchronizedå¯è§æ€§-æœ‰åºæ€§-å¯é‡å…¥æ€§æ€ä¹ˆå®ç°" tabindex="-1"><a class="header-anchor" href="#_26-é™¤äº†åŸå­æ€§-synchronizedå¯è§æ€§-æœ‰åºæ€§-å¯é‡å…¥æ€§æ€ä¹ˆå®ç°" aria-hidden="true">#</a> 26.é™¤äº†åŸå­æ€§ï¼Œsynchronizedå¯è§æ€§ï¼Œæœ‰åºæ€§ï¼Œå¯é‡å…¥æ€§æ€ä¹ˆå®ç°ï¼Ÿ</h3><blockquote><p>synchronizedæ€ä¹ˆä¿è¯å¯è§æ€§ï¼Ÿ</p></blockquote><ul><li>çº¿ç¨‹åŠ é”å‰ï¼Œå°†æ¸…ç©ºå·¥ä½œå†…å­˜ä¸­å…±äº«å˜é‡çš„å€¼ï¼Œä»è€Œä½¿ç”¨å…±äº«å˜é‡æ—¶éœ€è¦ä»ä¸»å†…å­˜ä¸­é‡æ–°è¯»å–æœ€æ–°çš„å€¼ã€‚</li><li>çº¿ç¨‹åŠ é”åï¼Œå…¶å®ƒçº¿ç¨‹æ— æ³•è·å–ä¸»å†…å­˜ä¸­çš„å…±äº«å˜é‡ã€‚</li><li>çº¿ç¨‹è§£é”å‰ï¼Œå¿…é¡»æŠŠå…±äº«å˜é‡çš„æœ€æ–°å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ã€‚</li></ul><blockquote><p>synchronizedæ€ä¹ˆä¿è¯æœ‰åºæ€§ï¼Ÿ</p></blockquote><p>synchronizedåŒæ­¥çš„ä»£ç å—ï¼Œå…·æœ‰æ’ä»–æ€§ï¼Œä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰ï¼Œæ‰€ä»¥synchronizedä¿è¯åŒä¸€æ—¶åˆ»ï¼Œä»£ç æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„ã€‚</p><p>å› ä¸ºas-if-serialè¯­ä¹‰çš„å­˜åœ¨ï¼Œå•çº¿ç¨‹çš„ç¨‹åºèƒ½ä¿è¯æœ€ç»ˆç»“æœæ˜¯æœ‰åºçš„ï¼Œä½†æ˜¯ä¸ä¿è¯ä¸ä¼šæŒ‡ä»¤é‡æ’ã€‚</p><p>æ‰€ä»¥synchronizedä¿è¯çš„æœ‰åºæ˜¯æ‰§è¡Œç»“æœçš„æœ‰åºæ€§ï¼Œè€Œä¸æ˜¯é˜²æ­¢æŒ‡ä»¤é‡æ’çš„æœ‰åºæ€§ã€‚</p><blockquote><p>synchronizedæ€ä¹ˆå®ç°å¯é‡å…¥çš„å‘¢ï¼Ÿ</p></blockquote><p>synchronized æ˜¯å¯é‡å…¥é”ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå…è®¸ä¸€ä¸ªçº¿ç¨‹äºŒæ¬¡è¯·æ±‚è‡ªå·±æŒæœ‰å¯¹è±¡é”çš„ä¸´ç•Œèµ„æºï¼Œè¿™ç§æƒ…å†µç§°ä¸ºå¯é‡å…¥é”ã€‚</p><p>synchronized é”å¯¹è±¡çš„æ—¶å€™æœ‰ä¸ªè®¡æ•°å™¨ï¼Œä»–ä¼šè®°å½•ä¸‹çº¿ç¨‹è·å–é”çš„æ¬¡æ•°ï¼Œåœ¨æ‰§è¡Œå®Œå¯¹åº”çš„ä»£ç å—ä¹‹åï¼Œè®¡æ•°å™¨å°±ä¼š-1ï¼Œç›´åˆ°è®¡æ•°å™¨æ¸…é›¶ï¼Œå°±é‡Šæ”¾é”äº†ã€‚</p><p>ä¹‹æ‰€ä»¥ï¼Œæ˜¯å¯é‡å…¥çš„ã€‚æ˜¯å› ä¸º synchronized é”å¯¹è±¡æœ‰ä¸ªè®¡æ•°å™¨ï¼Œä¼šéšç€çº¿ç¨‹è·å–é”å +1 è®¡æ•°ï¼Œå½“çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å -1ï¼Œç›´åˆ°æ¸…é›¶é‡Šæ”¾é”ã€‚</p><h3 id="_27-é”å‡çº§-synchronizedä¼˜åŒ–äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_27-é”å‡çº§-synchronizedä¼˜åŒ–äº†è§£å—" aria-hidden="true">#</a> 27.é”å‡çº§ï¼Ÿsynchronizedä¼˜åŒ–äº†è§£å—ï¼Ÿ</h3><p>äº†è§£é”å‡çº§ï¼Œå¾—å…ˆçŸ¥é“ï¼Œä¸åŒé”çš„çŠ¶æ€æ˜¯ä»€ä¹ˆæ ·çš„ã€‚è¿™ä¸ªçŠ¶æ€æŒ‡çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>Javaå¯¹è±¡å¤´é‡Œï¼Œæœ‰ä¸€å—ç»“æ„ï¼Œå«<code>Mark Word</code>æ ‡è®°å­—æ®µï¼Œè¿™å—ç»“æ„ä¼šéšç€é”çš„çŠ¶æ€å˜åŒ–è€Œå˜åŒ–ã€‚</p><p>64 ä½è™šæ‹Ÿæœº Mark Word æ˜¯ 64bitï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„çŠ¶æ€å˜åŒ–ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-34.png" alt="Mark Wordå˜åŒ–"></p><p>Mark Wordå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ•°æ®ï¼Œå¦‚<strong>å“ˆå¸Œç ã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€åå‘æ—¶é—´æˆ³ï¼ˆEpochï¼‰</strong> ç­‰ã€‚</p><blockquote><p>synchronizedåšäº†å“ªäº›ä¼˜åŒ–ï¼Ÿ</p></blockquote><p>åœ¨JDK1.6ä¹‹å‰ï¼Œsynchronizedçš„å®ç°ç›´æ¥è°ƒç”¨ObjectMonitorçš„enterå’Œexitï¼Œè¿™ç§é”è¢«ç§°ä¹‹ä¸º<strong>é‡é‡çº§é”</strong>ã€‚ä»JDK6å¼€å§‹ï¼ŒHotSpotè™šæ‹Ÿæœºå¼€å‘å›¢é˜Ÿå¯¹Javaä¸­çš„é”è¿›è¡Œä¼˜åŒ–ï¼Œå¦‚å¢åŠ äº†é€‚åº”æ€§è‡ªæ—‹ã€é”æ¶ˆé™¤ã€é”ç²—åŒ–ã€è½»é‡çº§é”å’Œåå‘é”ç­‰ä¼˜åŒ–ç­–ç•¥ï¼Œæå‡äº†synchronizedçš„æ€§èƒ½ã€‚</p><ul><li><p>åå‘é”ï¼šåœ¨æ— ç«äº‰çš„æƒ…å†µä¸‹ï¼Œåªæ˜¯åœ¨Mark Wordé‡Œå­˜å‚¨å½“å‰çº¿ç¨‹æŒ‡é’ˆï¼ŒCASæ“ä½œéƒ½ä¸åšã€‚</p></li><li><p>è½»é‡çº§é”ï¼šåœ¨æ²¡æœ‰å¤šçº¿ç¨‹ç«äº‰æ—¶ï¼Œç›¸å¯¹é‡é‡çº§é”ï¼Œå‡å°‘æ“ä½œç³»ç»Ÿäº’æ–¥é‡å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ã€‚ä½†æ˜¯ï¼Œå¦‚æœå­˜åœ¨é”ç«äº‰ï¼Œé™¤äº†äº’æ–¥é‡æœ¬èº«å¼€é”€ï¼Œè¿˜é¢å¤–æœ‰CASæ“ä½œçš„å¼€é”€ã€‚</p></li><li><p>è‡ªæ—‹é”ï¼šå‡å°‘ä¸å¿…è¦çš„CPUä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚åœ¨è½»é‡çº§é”å‡çº§ä¸ºé‡é‡çº§é”æ—¶ï¼Œå°±ä½¿ç”¨äº†è‡ªæ—‹åŠ é”çš„æ–¹å¼</p></li><li><p>é”ç²—åŒ–ï¼šå°†å¤šä¸ªè¿ç»­çš„åŠ é”ã€è§£é”æ“ä½œè¿æ¥åœ¨ä¸€èµ·ï¼Œæ‰©å±•æˆä¸€ä¸ªèŒƒå›´æ›´å¤§çš„é”ã€‚</p></li><li><p>é”æ¶ˆé™¤ï¼šè™šæ‹Ÿæœºå³æ—¶ç¼–è¯‘å™¨åœ¨è¿è¡Œæ—¶ï¼Œå¯¹ä¸€äº›ä»£ç ä¸Šè¦æ±‚åŒæ­¥ï¼Œä½†æ˜¯è¢«æ£€æµ‹åˆ°ä¸å¯èƒ½å­˜åœ¨å…±äº«æ•°æ®ç«äº‰çš„é”è¿›è¡Œæ¶ˆé™¤ã€‚</p></li></ul><blockquote><p>é”å‡çº§çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</p></blockquote><p>é”å‡çº§æ–¹å‘ï¼šæ— é”--&gt;åå‘é”---&gt; è½»é‡çº§é”----&gt;é‡é‡çº§é”ï¼Œè¿™ä¸ªæ–¹å‘åŸºæœ¬ä¸Šæ˜¯ä¸å¯é€†çš„ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-35.png" alt="é”å‡çº§æ–¹å‘"></p><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹å‡çº§çš„è¿‡ç¨‹ï¼š</p><h4 id="åå‘é”" tabindex="-1"><a class="header-anchor" href="#åå‘é”" aria-hidden="true">#</a> åå‘é”ï¼š</h4><p><strong>åå‘é”çš„è·å–ï¼š</strong></p><ol><li>åˆ¤æ–­æ˜¯å¦ä¸ºå¯åå‘çŠ¶æ€--MarkWordä¸­é”æ ‡å¿—æ˜¯å¦ä¸ºâ€˜01â€™ï¼Œæ˜¯å¦åå‘é”æ˜¯å¦ä¸ºâ€˜1â€™</li><li>å¦‚æœæ˜¯å¯åå‘çŠ¶æ€ï¼Œåˆ™æŸ¥çœ‹çº¿ç¨‹IDæ˜¯å¦ä¸ºå½“å‰çº¿ç¨‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿›å…¥æ­¥éª¤&#39;5&#39;ï¼Œå¦åˆ™è¿›å…¥æ­¥éª¤â€˜3â€™</li><li>é€šè¿‡CASæ“ä½œç«äº‰é”ï¼Œå¦‚æœç«äº‰æˆåŠŸï¼Œåˆ™å°†MarkWordä¸­çº¿ç¨‹IDè®¾ç½®ä¸ºå½“å‰çº¿ç¨‹IDï¼Œç„¶åæ‰§è¡Œâ€˜5â€™ï¼›ç«äº‰å¤±è´¥ï¼Œåˆ™æ‰§è¡Œâ€˜4â€™</li><li>CASè·å–åå‘é”å¤±è´¥è¡¨ç¤ºæœ‰ç«äº‰ã€‚å½“è¾¾åˆ°safepointæ—¶è·å¾—åå‘é”çš„çº¿ç¨‹è¢«æŒ‚èµ·ï¼Œ<strong>åå‘é”å‡çº§ä¸ºè½»é‡çº§é”</strong>ï¼Œç„¶åè¢«é˜»å¡åœ¨å®‰å…¨ç‚¹çš„çº¿ç¨‹ç»§ç»­å¾€ä¸‹æ‰§è¡ŒåŒæ­¥ä»£ç å—</li><li>æ‰§è¡ŒåŒæ­¥ä»£ç </li></ol><p><strong>åå‘é”çš„æ’¤é”€ï¼š</strong></p><ol><li>åå‘é”ä¸ä¼šä¸»åŠ¨é‡Šæ”¾(æ’¤é”€)ï¼Œåªæœ‰é‡åˆ°å…¶ä»–çº¿ç¨‹ç«äº‰æ—¶æ‰ä¼šæ‰§è¡Œæ’¤é”€ï¼Œç”±äºæ’¤é”€éœ€è¦çŸ¥é“å½“å‰æŒæœ‰è¯¥åå‘é”çš„çº¿ç¨‹æ ˆçŠ¶æ€ï¼Œå› æ­¤è¦ç­‰åˆ°safepointæ—¶æ‰§è¡Œï¼Œæ­¤æ—¶æŒæœ‰è¯¥åå‘é”çš„çº¿ç¨‹ï¼ˆTï¼‰æœ‰â€˜2â€™ï¼Œâ€˜3â€™ä¸¤ç§æƒ…å†µï¼›</li><li>æ’¤é”€----Tçº¿ç¨‹å·²ç»é€€å‡ºåŒæ­¥ä»£ç å—ï¼Œæˆ–è€…å·²ç»ä¸å†å­˜æ´»ï¼Œåˆ™ç›´æ¥æ’¤é”€åå‘é”ï¼Œå˜æˆæ— é”çŠ¶æ€----è¯¥çŠ¶æ€è¾¾åˆ°é˜ˆå€¼20åˆ™æ‰§è¡Œæ‰¹é‡é‡åå‘</li><li>å‡çº§----Tçº¿ç¨‹è¿˜åœ¨åŒæ­¥ä»£ç å—ä¸­ï¼Œåˆ™å°†Tçº¿ç¨‹çš„åå‘é”<strong>å‡çº§ä¸ºè½»é‡çº§é”</strong>ï¼Œå½“å‰çº¿ç¨‹æ‰§è¡Œè½»é‡çº§é”çŠ¶æ€ä¸‹çš„é”è·å–æ­¥éª¤----è¯¥çŠ¶æ€è¾¾åˆ°é˜ˆå€¼40åˆ™æ‰§è¡Œæ‰¹é‡æ’¤é”€</li></ol><h4 id="è½»é‡çº§é”" tabindex="-1"><a class="header-anchor" href="#è½»é‡çº§é”" aria-hidden="true">#</a> è½»é‡çº§é”ï¼š</h4><p><strong>è½»é‡çº§é”çš„è·å–ï¼š</strong></p><ol><li>è¿›è¡ŒåŠ é”æ“ä½œæ—¶ï¼Œjvmä¼šåˆ¤æ–­æ˜¯å¦å·²ç»æ—¶é‡é‡çº§é”ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ä¼šåœ¨å½“å‰çº¿ç¨‹æ ˆå¸§ä¸­åˆ’å‡ºä¸€å—ç©ºé—´ï¼Œä½œä¸ºè¯¥é”çš„é”è®°å½•ï¼Œå¹¶ä¸”å°†é”å¯¹è±¡MarkWordå¤åˆ¶åˆ°è¯¥é”è®°å½•ä¸­</li><li>å¤åˆ¶æˆåŠŸä¹‹åï¼Œjvmä½¿ç”¨CASæ“ä½œå°†å¯¹è±¡å¤´MarkWordæ›´æ–°ä¸ºæŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆï¼Œå¹¶å°†é”è®°å½•é‡Œçš„owneræŒ‡é’ˆæŒ‡å‘å¯¹è±¡å¤´çš„MarkWordã€‚å¦‚æœæˆåŠŸï¼Œåˆ™æ‰§è¡Œâ€˜3â€™ï¼Œå¦åˆ™æ‰§è¡Œâ€˜4â€™</li><li>æ›´æ–°æˆåŠŸï¼Œåˆ™å½“å‰çº¿ç¨‹æŒæœ‰è¯¥å¯¹è±¡é”ï¼Œå¹¶ä¸”å¯¹è±¡MarkWordé”æ ‡å¿—è®¾ç½®ä¸ºâ€˜00â€™ï¼Œå³è¡¨ç¤ºæ­¤å¯¹è±¡å¤„äºè½»é‡çº§é”çŠ¶æ€</li><li>æ›´æ–°å¤±è´¥ï¼Œjvmå…ˆæ£€æŸ¥å¯¹è±¡MarkWordæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹æ ˆå¸§ä¸­çš„é”è®°å½•ï¼Œå¦‚æœæ˜¯åˆ™æ‰§è¡Œâ€˜5â€™ï¼Œå¦åˆ™æ‰§è¡Œâ€˜4â€™</li><li>è¡¨ç¤ºé”é‡å…¥ï¼›ç„¶åå½“å‰çº¿ç¨‹æ ˆå¸§ä¸­å¢åŠ ä¸€ä¸ªé”è®°å½•ç¬¬ä¸€éƒ¨åˆ†ï¼ˆDisplaced Mark Wordï¼‰ä¸ºnullï¼Œå¹¶æŒ‡å‘Mark Wordçš„é”å¯¹è±¡ï¼Œèµ·åˆ°ä¸€ä¸ªé‡å…¥è®¡æ•°å™¨çš„ä½œç”¨ã€‚</li><li>è¡¨ç¤ºè¯¥é”å¯¹è±¡å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŠ¢å ï¼Œåˆ™è¿›è¡Œ<strong>è‡ªæ—‹ç­‰å¾…</strong>ï¼ˆé»˜è®¤10æ¬¡ï¼‰ï¼Œç­‰å¾…æ¬¡æ•°è¾¾åˆ°é˜ˆå€¼ä»æœªè·å–åˆ°é”ï¼Œåˆ™<strong>å‡çº§ä¸ºé‡é‡çº§é”</strong></li></ol><p>å¤§ä½“ä¸Šçœç®€çš„å‡çº§è¿‡ç¨‹ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-36.png" alt="é”å‡çº§ç®€ç•¥è¿‡ç¨‹"></p><p>å®Œæ•´çš„å‡çº§è¿‡ç¨‹ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-37.png" alt="synchronized é”å‡çº§è¿‡ç¨‹-æ¥æºå‚è€ƒ[14]"></p><h3 id="_28-è¯´è¯´synchronizedå’Œreentrantlockçš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_28-è¯´è¯´synchronizedå’Œreentrantlockçš„åŒºåˆ«" aria-hidden="true">#</a> 28.è¯´è¯´synchronizedå’ŒReentrantLockçš„åŒºåˆ«ï¼Ÿ</h3><p>å¯ä»¥ä»é”çš„å®ç°ã€åŠŸèƒ½ç‰¹ç‚¹ã€æ€§èƒ½ç­‰å‡ ä¸ªç»´åº¦å»å›ç­”è¿™ä¸ªé—®é¢˜ï¼š</p><ul><li><strong>é”çš„å®ç°ï¼š</strong> synchronizedæ˜¯Javaè¯­è¨€çš„å…³é”®å­—ï¼ŒåŸºäºJVMå®ç°ã€‚è€ŒReentrantLockæ˜¯åŸºäºJDKçš„APIå±‚é¢å®ç°çš„ï¼ˆä¸€èˆ¬æ˜¯lock()å’Œunlock()æ–¹æ³•é…åˆtry/finally è¯­å¥å—æ¥å®Œæˆã€‚ï¼‰</li><li><strong>æ€§èƒ½ï¼š</strong> åœ¨JDK1.6é”ä¼˜åŒ–ä»¥å‰ï¼Œsynchronizedçš„æ€§èƒ½æ¯”ReenTrantLockå·®å¾ˆå¤šã€‚ä½†æ˜¯JDK6å¼€å§‹ï¼Œå¢åŠ äº†é€‚åº”æ€§è‡ªæ—‹ã€é”æ¶ˆé™¤ç­‰ï¼Œä¸¤è€…æ€§èƒ½å°±å·®ä¸å¤šäº†ã€‚</li><li><strong>åŠŸèƒ½ç‰¹ç‚¹ï¼š</strong> ReentrantLock æ¯” synchronized å¢åŠ äº†ä¸€äº›é«˜çº§åŠŸèƒ½ï¼Œå¦‚ç­‰å¾…å¯ä¸­æ–­ã€å¯å®ç°å…¬å¹³é”ã€å¯å®ç°é€‰æ‹©æ€§é€šçŸ¥ã€‚ <ul><li>ReentrantLockæä¾›äº†ä¸€ç§èƒ½å¤Ÿä¸­æ–­ç­‰å¾…é”çš„çº¿ç¨‹çš„æœºåˆ¶ï¼Œé€šè¿‡lock.lockInterruptibly()æ¥å®ç°è¿™ä¸ªæœºåˆ¶</li><li>ReentrantLockå¯ä»¥æŒ‡å®šæ˜¯å…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”ã€‚è€Œsynchronizedåªèƒ½æ˜¯éå…¬å¹³é”ã€‚æ‰€è°“çš„å…¬å¹³é”å°±æ˜¯å…ˆç­‰å¾…çš„çº¿ç¨‹å…ˆè·å¾—é”ã€‚</li><li>synchronizedä¸wait()å’Œnotify()/notifyAll()æ–¹æ³•ç»“åˆå®ç°ç­‰å¾…/é€šçŸ¥æœºåˆ¶ï¼ŒReentrantLockç±»å€ŸåŠ©Conditionæ¥å£ä¸newCondition()æ–¹æ³•å®ç°ã€‚</li><li>ReentrantLockéœ€è¦æ‰‹å·¥å£°æ˜æ¥åŠ é”å’Œé‡Šæ”¾é”ï¼Œä¸€èˆ¬è·Ÿfinallyé…åˆé‡Šæ”¾é”ã€‚è€Œsynchronizedä¸ç”¨æ‰‹åŠ¨é‡Šæ”¾é”ã€‚</li></ul></li></ul><p>ä¸‹é¢çš„è¡¨æ ¼åˆ—å‡ºå‡ºäº†ä¸¤ç§é”ä¹‹é—´çš„åŒºåˆ«ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-38.png" alt="synchronizedå’ŒReentrantLockçš„åŒºåˆ«"></p><h3 id="_29-aqsäº†è§£å¤šå°‘" tabindex="-1"><a class="header-anchor" href="#_29-aqsäº†è§£å¤šå°‘" aria-hidden="true">#</a> 29.AQSäº†è§£å¤šå°‘ï¼Ÿ</h3><p>AbstractQueuedSynchronizer æŠ½è±¡åŒæ­¥é˜Ÿåˆ—ï¼Œç®€ç§° AQS ï¼Œå®ƒæ˜¯Javaå¹¶å‘åŒ…çš„æ ¹åŸºï¼Œå¹¶å‘åŒ…ä¸­çš„é”å°±æ˜¯åŸºäºAQSå®ç°çš„ã€‚</p><ul><li>AQSæ˜¯åŸºäºä¸€ä¸ªFIFOçš„åŒå‘é˜Ÿåˆ—ï¼Œå…¶å†…éƒ¨å®šä¹‰äº†ä¸€ä¸ªèŠ‚ç‚¹ç±»Nodeï¼ŒNode èŠ‚ç‚¹å†…éƒ¨çš„ SHARED ç”¨æ¥æ ‡è®°è¯¥çº¿ç¨‹æ˜¯è·å–å…±äº«èµ„æºæ—¶è¢«é˜»æŒ‚èµ·åæ”¾å…¥AQS é˜Ÿåˆ—çš„ï¼Œ EXCLUSIVE ç”¨æ¥æ ‡è®°çº¿ç¨‹æ˜¯ å–ç‹¬å èµ„æºæ—¶è¢«æŒ‚èµ·åæ”¾å…¥AQS é˜Ÿåˆ—</li><li>AQS ä½¿ç”¨ä¸€ä¸ª volatile ä¿®é¥°çš„ int ç±»å‹çš„æˆå‘˜å˜é‡ state æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œä¿®æ”¹åŒæ­¥çŠ¶æ€æˆåŠŸå³ä¸ºè·å¾—é”ï¼Œvolatile ä¿è¯äº†å˜é‡åœ¨å¤šçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼Œä¿®æ”¹ State å€¼æ—¶é€šè¿‡ CAS æœºåˆ¶æ¥ä¿è¯ä¿®æ”¹çš„åŸå­æ€§</li><li>è·å–stateçš„æ–¹å¼åˆ†ä¸ºä¸¤ç§ï¼Œç‹¬å æ–¹å¼å’Œå…±äº«æ–¹å¼ï¼Œä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ç‹¬å æ–¹å¼è·å–äº†èµ„æºï¼Œå…¶å®ƒçº¿ç¨‹å°±ä¼šåœ¨è·å–å¤±è´¥åè¢«é˜»å¡ã€‚ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨å…±äº«æ–¹å¼è·å–äº†èµ„æºï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹è¿˜å¯ä»¥é€šè¿‡CASçš„æ–¹å¼è¿›è¡Œè·å–ã€‚</li><li>å¦‚æœå…±äº«èµ„æºè¢«å ç”¨ï¼Œéœ€è¦ä¸€å®šçš„é˜»å¡ç­‰å¾…å”¤é†’æœºåˆ¶æ¥ä¿è¯é”çš„åˆ†é…ï¼ŒAQS ä¸­ä¼šå°†ç«äº‰å…±äº«èµ„æºå¤±è´¥çš„çº¿ç¨‹æ·»åŠ åˆ°ä¸€ä¸ªå˜ä½“çš„ CLH é˜Ÿåˆ—ä¸­ã€‚</li></ul><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-39.png" alt="AQSæŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨"></p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-40.png" alt="CLHé˜Ÿåˆ—"></p><p>AQS ä¸­çš„é˜Ÿåˆ—æ˜¯ CLH å˜ä½“çš„è™šæ‹ŸåŒå‘é˜Ÿåˆ—ï¼Œé€šè¿‡å°†æ¯æ¡è¯·æ±‚å…±äº«èµ„æºçš„çº¿ç¨‹å°è£…æˆä¸€ä¸ªèŠ‚ç‚¹æ¥å®ç°é”çš„åˆ†é…ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-41.png" alt="AQSå˜ç§CLHé˜Ÿåˆ—"></p><p>AQS ä¸­çš„ CLH å˜ä½“ç­‰å¾…é˜Ÿåˆ—æ‹¥æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ul><li>AQS ä¸­é˜Ÿåˆ—æ˜¯ä¸ªåŒå‘é“¾è¡¨ï¼Œä¹Ÿæ˜¯ FIFO å…ˆè¿›å…ˆå‡ºçš„ç‰¹æ€§</li><li>é€šè¿‡ Headã€Tail å¤´å°¾ä¸¤ä¸ªèŠ‚ç‚¹æ¥ç»„æˆé˜Ÿåˆ—ç»“æ„ï¼Œé€šè¿‡ volatile ä¿®é¥°ä¿è¯å¯è§æ€§</li><li>Head æŒ‡å‘èŠ‚ç‚¹ä¸ºå·²è·å¾—é”çš„èŠ‚ç‚¹ï¼Œæ˜¯ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹æœ¬èº«ä¸æŒæœ‰å…·ä½“çº¿ç¨‹</li><li>è·å–ä¸åˆ°åŒæ­¥çŠ¶æ€ï¼Œä¼šå°†èŠ‚ç‚¹è¿›è¡Œè‡ªæ—‹è·å–é”ï¼Œè‡ªæ—‹ä¸€å®šæ¬¡æ•°å¤±è´¥åä¼šå°†çº¿ç¨‹é˜»å¡ï¼Œç›¸å¯¹äº CLH é˜Ÿåˆ—æ€§èƒ½è¾ƒå¥½</li></ul><p>ps:AQSæºç é‡Œé¢æœ‰å¾ˆå¤šç»†èŠ‚å¯é—®ï¼Œå»ºè®®æœ‰æ—¶é—´å¥½å¥½çœ‹çœ‹AQSæºç ã€‚</p><h3 id="_30-reentrantlockå®ç°åŸç†" tabindex="-1"><a class="header-anchor" href="#_30-reentrantlockå®ç°åŸç†" aria-hidden="true">#</a> 30.<strong>ReentrantLock</strong>å®ç°åŸç†ï¼Ÿ</h3><p>ReentrantLock æ˜¯å¯é‡å…¥çš„ç‹¬å é”ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è·å–è¯¥é”ï¼Œå…¶å®ƒè·å–è¯¥é”çš„çº¿ç¨‹ä¼šè¢«é˜»å¡è€Œè¢«æ”¾å…¥è¯¥é”çš„é˜»å¡é˜Ÿåˆ—é‡Œé¢ã€‚</p><p>çœ‹çœ‹ReentrantLockçš„åŠ é”æ“ä½œï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// åˆ›å»ºéå…¬å¹³é”</span>
<span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// è·å–é”æ“ä½œ</span>
lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ‰§è¡Œä»£ç é€»è¾‘</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token comment">// è§£é”æ“ä½œ</span>
    lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>new ReentrantLock() </code>æ„é€ å‡½æ•°é»˜è®¤åˆ›å»ºçš„æ˜¯éå…¬å¹³é” NonfairSyncã€‚</p><p><strong>å…¬å¹³é” FairSync</strong></p><ol><li>å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œçº¿ç¨‹ç›´æ¥è¿›å…¥é˜Ÿåˆ—ä¸­æ’é˜Ÿï¼Œé˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰èƒ½è·å¾—é”</li><li>å…¬å¹³é”çš„ä¼˜ç‚¹æ˜¯ç­‰å¾…é”çš„çº¿ç¨‹ä¸ä¼šé¥¿æ­»ã€‚ç¼ºç‚¹æ˜¯æ•´ä½“ååæ•ˆç‡ç›¸å¯¹éå…¬å¹³é”è¦ä½ï¼Œç­‰å¾…é˜Ÿåˆ—ä¸­é™¤ç¬¬ä¸€ä¸ªçº¿ç¨‹ä»¥å¤–çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šé˜»å¡ï¼ŒCPU å”¤é†’é˜»å¡çº¿ç¨‹çš„å¼€é”€æ¯”éå…¬å¹³é”å¤§</li></ol><p><strong>éå…¬å¹³é” NonfairSync</strong></p><ul><li>éå…¬å¹³é”æ˜¯å¤šä¸ªçº¿ç¨‹åŠ é”æ—¶ç›´æ¥å°è¯•è·å–é”ï¼Œè·å–ä¸åˆ°æ‰ä¼šåˆ°ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿå°¾ç­‰å¾…ã€‚ä½†å¦‚æœæ­¤æ—¶é”åˆšå¥½å¯ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å¯ä»¥æ— éœ€é˜»å¡ç›´æ¥è·å–åˆ°é”</li><li>éå…¬å¹³é”çš„ä¼˜ç‚¹æ˜¯å¯ä»¥å‡å°‘å”¤èµ·çº¿ç¨‹çš„å¼€é”€ï¼Œæ•´ä½“çš„ååæ•ˆç‡é«˜ï¼Œå› ä¸ºçº¿ç¨‹æœ‰å‡ ç‡ä¸é˜»å¡ç›´æ¥è·å¾—é”ï¼ŒCPU ä¸å¿…å”¤é†’æ‰€æœ‰çº¿ç¨‹ã€‚ç¼ºç‚¹æ˜¯å¤„äºç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å¯èƒ½ä¼šé¥¿æ­»ï¼Œæˆ–è€…ç­‰å¾ˆä¹…æ‰ä¼šè·å¾—é”</li></ul><p>é»˜è®¤åˆ›å»ºçš„å¯¹è±¡lock()çš„æ—¶å€™ï¼š</p><ul><li>å¦‚æœé”å½“å‰æ²¡æœ‰è¢«å…¶å®ƒçº¿ç¨‹å ç”¨ï¼Œå¹¶ä¸”å½“å‰çº¿ç¨‹ä¹‹å‰æ²¡æœ‰è·å–è¿‡è¯¥é”ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¼šè·å–åˆ°è¯¥é”ï¼Œç„¶åè®¾ç½®å½“å‰é”çš„æ‹¥æœ‰è€…ä¸ºå½“å‰çº¿ç¨‹ï¼Œå¹¶è®¾ç½® AQS çš„çŠ¶æ€å€¼ä¸º1 ï¼Œç„¶åç›´æ¥è¿”å›ã€‚å¦‚æœå½“å‰çº¿ç¨‹ä¹‹å‰å·±ç»è·å–è¿‡è¯¥é”ï¼Œåˆ™è¿™æ¬¡åªæ˜¯ç®€å•åœ°æŠŠ AQS çš„çŠ¶æ€å€¼åŠ 1åè¿”å›ã€‚</li><li>å¦‚æœè¯¥é”å·±ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œéå…¬å¹³é”ä¼šå°è¯•å»è·å–é”ï¼Œè·å–å¤±è´¥çš„è¯ï¼Œåˆ™è°ƒç”¨è¯¥æ–¹æ³•çº¿ç¨‹ä¼šè¢«æ”¾å…¥ AQS é˜Ÿåˆ—é˜»å¡æŒ‚èµ·ã€‚</li></ul><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-42.png" alt="ReentrantLock éå…¬å¹³é”åŠ é”æµç¨‹ç®€å›¾"></p><h3 id="_31-reentrantlockæ€ä¹ˆå®ç°å…¬å¹³é”çš„" tabindex="-1"><a class="header-anchor" href="#_31-reentrantlockæ€ä¹ˆå®ç°å…¬å¹³é”çš„" aria-hidden="true">#</a> 31.ReentrantLockæ€ä¹ˆå®ç°å…¬å¹³é”çš„ï¼Ÿ</h3><p><code>new ReentrantLock() </code>æ„é€ å‡½æ•°é»˜è®¤åˆ›å»ºçš„æ˜¯éå…¬å¹³é” NonfairSync</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sync <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NonfairSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŒæ—¶ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºé”æ„é€ å‡½æ•°ä¸­ä¼ å…¥å…·ä½“å‚æ•°åˆ›å»ºå…¬å¹³é” FairSync</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">--</span><span class="token operator">-</span> <span class="token class-name">ReentrantLock</span>
<span class="token comment">// true ä»£è¡¨å…¬å¹³é”ï¼Œfalse ä»£è¡¨éå…¬å¹³é”</span>
<span class="token keyword">public</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> fair<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sync <span class="token operator">=</span> fair <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">FairSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">NonfairSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>FairSyncã€NonfairSync ä»£è¡¨å…¬å¹³é”å’Œéå…¬å¹³é”ï¼Œä¸¤è€…éƒ½æ˜¯ ReentrantLock é™æ€å†…éƒ¨ç±»ï¼Œåªä¸è¿‡å®ç°ä¸åŒé”è¯­ä¹‰ã€‚</p><p><strong>éå…¬å¹³é”å’Œå…¬å¹³é”çš„ä¸¤å¤„ä¸åŒï¼š</strong></p><ol><li>éå…¬å¹³é”åœ¨è°ƒç”¨ lock åï¼Œé¦–å…ˆå°±ä¼šè°ƒç”¨ CAS è¿›è¡Œä¸€æ¬¡æŠ¢é”ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™æ°å·§é”æ²¡æœ‰è¢«å ç”¨ï¼Œé‚£ä¹ˆç›´æ¥å°±è·å–åˆ°é”è¿”å›äº†ã€‚</li><li>éå…¬å¹³é”åœ¨ CAS å¤±è´¥åï¼Œå’Œå…¬å¹³é”ä¸€æ ·éƒ½ä¼šè¿›å…¥åˆ° tryAcquire æ–¹æ³•ï¼Œåœ¨ tryAcquire æ–¹æ³•ä¸­ï¼Œå¦‚æœå‘ç°é”è¿™ä¸ªæ—¶å€™è¢«é‡Šæ”¾äº†ï¼ˆstate == 0ï¼‰ï¼Œéå…¬å¹³é”ä¼šç›´æ¥ CAS æŠ¢é”ï¼Œä½†æ˜¯å…¬å¹³é”ä¼šåˆ¤æ–­ç­‰å¾…é˜Ÿåˆ—æ˜¯å¦æœ‰çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ï¼Œå¦‚æœæœ‰åˆ™ä¸å»æŠ¢é”ï¼Œä¹–ä¹–æ’åˆ°åé¢ã€‚</li></ol><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-43.png" alt="å…¬å¹³é”tryAcquire"></p><p>ç›¸å¯¹æ¥è¯´ï¼Œéå…¬å¹³é”ä¼šæœ‰æ›´å¥½çš„æ€§èƒ½ï¼Œå› ä¸ºå®ƒçš„ååé‡æ¯”è¾ƒå¤§ã€‚å½“ç„¶ï¼Œéå…¬å¹³é”è®©è·å–é”çš„æ—¶é—´å˜å¾—æ›´åŠ ä¸ç¡®å®šï¼Œå¯èƒ½ä¼šå¯¼è‡´åœ¨é˜»å¡é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹é•¿æœŸå¤„äºé¥¥é¥¿çŠ¶æ€ã€‚</p><h3 id="_32-caså‘¢-casäº†è§£å¤šå°‘" tabindex="-1"><a class="header-anchor" href="#_32-caså‘¢-casäº†è§£å¤šå°‘" aria-hidden="true">#</a> 32.CASå‘¢ï¼ŸCASäº†è§£å¤šå°‘ï¼Ÿ</h3><p>CASå«åšCompareAndSwapï¼Œâ½è¾ƒå¹¶äº¤æ¢ï¼Œä¸»è¦æ˜¯é€šè¿‡å¤„ç†å™¨çš„æŒ‡ä»¤æ¥ä¿è¯æ“ä½œçš„åŸâ¼¦æ€§çš„ã€‚</p><p>CAS æŒ‡ä»¤åŒ…å« 3 ä¸ªå‚æ•°ï¼šå…±äº«å˜é‡çš„å†…å­˜åœ°å€ Aã€é¢„æœŸçš„å€¼ B å’Œå…±äº«å˜é‡çš„æ–°å€¼ Cã€‚</p><p>åªæœ‰å½“å†…å­˜ä¸­åœ°å€ A å¤„çš„å€¼ç­‰äº B æ—¶ï¼Œæ‰èƒ½å°†å†…å­˜ä¸­åœ°å€ A å¤„çš„å€¼æ›´æ–°ä¸ºæ–°å€¼ Cã€‚ä½œä¸ºä¸€æ¡ CPU æŒ‡ä»¤ï¼ŒCAS æŒ‡ä»¤æœ¬èº«æ˜¯èƒ½å¤Ÿä¿è¯åŸå­æ€§çš„ ã€‚</p><h3 id="_33-cas-æœ‰ä»€ä¹ˆé—®é¢˜-å¦‚ä½•è§£å†³" tabindex="-1"><a class="header-anchor" href="#_33-cas-æœ‰ä»€ä¹ˆé—®é¢˜-å¦‚ä½•è§£å†³" aria-hidden="true">#</a> 33.CAS æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</h3><p>CASçš„ç»å…¸ä¸‰å¤§é—®é¢˜ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-44.png" alt="CASä¸‰å¤§é—®é¢˜"></p><h4 id="aba-é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#aba-é—®é¢˜" aria-hidden="true">#</a> ABA é—®é¢˜</h4><p>å¹¶å‘ç¯å¢ƒä¸‹ï¼Œå‡è®¾åˆå§‹æ¡ä»¶æ˜¯Aï¼Œå»ä¿®æ”¹æ•°æ®æ—¶ï¼Œå‘ç°æ˜¯Aå°±ä¼šæ‰§è¡Œä¿®æ”¹ã€‚ä½†æ˜¯çœ‹åˆ°çš„è™½ç„¶æ˜¯Aï¼Œä¸­é—´å¯èƒ½å‘ç”Ÿäº†Aå˜Bï¼ŒBåˆå˜å›Açš„æƒ…å†µã€‚æ­¤æ—¶Aå·²ç»éå½¼Aï¼Œæ•°æ®å³ä½¿æˆåŠŸä¿®æ”¹ï¼Œä¹Ÿå¯èƒ½æœ‰é—®é¢˜ã€‚</p><blockquote><p>æ€ä¹ˆè§£å†³ABAé—®é¢˜ï¼Ÿ</p></blockquote><ul><li>åŠ ç‰ˆæœ¬å·</li></ul><p>æ¯æ¬¡ä¿®æ”¹å˜é‡ï¼Œéƒ½åœ¨è¿™ä¸ªå˜é‡çš„ç‰ˆæœ¬å·ä¸ŠåŠ 1ï¼Œè¿™æ ·ï¼ŒåˆšåˆšA-&gt;B-&gt;Aï¼Œè™½ç„¶Açš„å€¼æ²¡å˜ï¼Œä½†æ˜¯å®ƒçš„ç‰ˆæœ¬å·å·²ç»å˜äº†ï¼Œå†åˆ¤æ–­ç‰ˆæœ¬å·å°±ä¼šå‘ç°æ­¤æ—¶çš„Aå·²ç»è¢«æ”¹è¿‡äº†ã€‚å‚è€ƒä¹è§‚é”çš„ç‰ˆæœ¬å·ï¼Œè¿™ç§åšæ³•å¯ä»¥ç»™æ•°æ®å¸¦ä¸Šäº†ä¸€ç§å®æ•ˆæ€§çš„æ£€éªŒã€‚</p><p>Javaæä¾›äº†AtomicStampReferenceç±»ï¼Œå®ƒçš„compareAndSetæ–¹æ³•é¦–å…ˆæ£€æŸ¥å½“å‰çš„å¯¹è±¡å¼•ç”¨å€¼æ˜¯å¦ç­‰äºé¢„æœŸå¼•ç”¨ï¼Œå¹¶ä¸”å½“å‰å°æˆ³ï¼ˆStampï¼‰æ ‡å¿—æ˜¯å¦ç­‰äºé¢„æœŸæ ‡å¿—ï¼Œå¦‚æœå…¨éƒ¨ç›¸ç­‰ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†å¼•ç”¨å€¼å’Œå°æˆ³æ ‡å¿—çš„å€¼æ›´æ–°ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚</p><h4 id="å¾ªç¯æ€§èƒ½å¼€é”€" tabindex="-1"><a class="header-anchor" href="#å¾ªç¯æ€§èƒ½å¼€é”€" aria-hidden="true">#</a> å¾ªç¯æ€§èƒ½å¼€é”€</h4><p>è‡ªæ—‹CASï¼Œå¦‚æœä¸€ç›´å¾ªç¯æ‰§è¡Œï¼Œä¸€ç›´ä¸æˆåŠŸï¼Œä¼šç»™CPUå¸¦æ¥éå¸¸å¤§çš„æ‰§è¡Œå¼€é”€ã€‚</p><blockquote><p>æ€ä¹ˆè§£å†³å¾ªç¯æ€§èƒ½å¼€é”€é—®é¢˜ï¼Ÿ</p></blockquote><p>åœ¨Javaä¸­ï¼Œå¾ˆå¤šä½¿ç”¨è‡ªæ—‹CASçš„åœ°æ–¹ï¼Œä¼šæœ‰ä¸€ä¸ªè‡ªæ—‹æ¬¡æ•°çš„é™åˆ¶ï¼Œè¶…è¿‡ä¸€å®šæ¬¡æ•°ï¼Œå°±åœæ­¢è‡ªæ—‹ã€‚</p><h4 id="åªèƒ½ä¿è¯ä¸€ä¸ªå˜é‡çš„åŸå­æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#åªèƒ½ä¿è¯ä¸€ä¸ªå˜é‡çš„åŸå­æ“ä½œ" aria-hidden="true">#</a> åªèƒ½ä¿è¯ä¸€ä¸ªå˜é‡çš„åŸå­æ“ä½œ</h4><p>CAS ä¿è¯çš„æ˜¯å¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œæ“ä½œçš„åŸå­æ€§ï¼Œå¦‚æœå¯¹å¤šä¸ªå˜é‡æ“ä½œæ—¶ï¼ŒCAS ç›®å‰æ— æ³•ç›´æ¥ä¿è¯æ“ä½œçš„åŸå­æ€§çš„ã€‚</p><blockquote><p>æ€ä¹ˆè§£å†³åªèƒ½ä¿è¯ä¸€ä¸ªå˜é‡çš„åŸå­æ“ä½œé—®é¢˜ï¼Ÿ</p></blockquote><ul><li>å¯ä»¥è€ƒè™‘æ”¹ç”¨é”æ¥ä¿è¯æ“ä½œçš„åŸå­æ€§</li><li>å¯ä»¥è€ƒè™‘åˆå¹¶å¤šä¸ªå˜é‡ï¼Œå°†å¤šä¸ªå˜é‡å°è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œé€šè¿‡AtomicReferenceæ¥ä¿è¯åŸå­æ€§ã€‚</li></ul><h3 id="_34-javaæœ‰å“ªäº›ä¿è¯åŸå­æ€§çš„æ–¹æ³•-å¦‚ä½•ä¿è¯å¤šçº¿ç¨‹ä¸‹i-ç»“æœæ­£ç¡®" tabindex="-1"><a class="header-anchor" href="#_34-javaæœ‰å“ªäº›ä¿è¯åŸå­æ€§çš„æ–¹æ³•-å¦‚ä½•ä¿è¯å¤šçº¿ç¨‹ä¸‹i-ç»“æœæ­£ç¡®" aria-hidden="true">#</a> 34.Javaæœ‰å“ªäº›ä¿è¯åŸå­æ€§çš„æ–¹æ³•ï¼Ÿå¦‚ä½•ä¿è¯å¤šçº¿ç¨‹ä¸‹i++ ç»“æœæ­£ç¡®ï¼Ÿ</h3><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-45.png" alt="Javaä¿è¯åŸå­æ€§æ–¹æ³•"></p><ul><li>ä½¿ç”¨å¾ªç¯åŸå­ç±»ï¼Œä¾‹å¦‚AtomicIntegerï¼Œå®ç°i++åŸå­æ“ä½œ</li><li>ä½¿ç”¨jucåŒ…ä¸‹çš„é”ï¼Œå¦‚ReentrantLock ï¼Œå¯¹i++æ“ä½œåŠ é”lock.lock()æ¥å®ç°åŸå­æ€§</li><li>ä½¿ç”¨synchronizedï¼Œå¯¹i++æ“ä½œåŠ é”</li></ul><h3 id="_35-åŸå­æ“ä½œç±»äº†è§£å¤šå°‘" tabindex="-1"><a class="header-anchor" href="#_35-åŸå­æ“ä½œç±»äº†è§£å¤šå°‘" aria-hidden="true">#</a> 35.åŸå­æ“ä½œç±»äº†è§£å¤šå°‘ï¼Ÿ</h3><p>å½“ç¨‹åºæ›´æ–°ä¸€ä¸ªå˜é‡æ—¶ï¼Œå¦‚æœå¤šçº¿ç¨‹åŒæ—¶æ›´æ–°è¿™ä¸ªå˜é‡ï¼Œå¯èƒ½å¾—åˆ°æœŸæœ›ä¹‹å¤–çš„å€¼ï¼Œæ¯”å¦‚å˜é‡i=1ï¼ŒAçº¿ç¨‹æ›´æ–°i+1ï¼ŒBçº¿ç¨‹ä¹Ÿæ›´æ–°i+1ï¼Œç»è¿‡ä¸¤ä¸ªçº¿ç¨‹æ“ä½œä¹‹åå¯èƒ½iä¸ç­‰äº3ï¼Œè€Œæ˜¯ç­‰äº2ã€‚å› ä¸ºAå’ŒBçº¿ç¨‹åœ¨æ›´æ–°å˜é‡içš„æ—¶å€™æ‹¿åˆ°çš„iéƒ½æ˜¯1ï¼Œè¿™å°±æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„æ›´æ–°æ“ä½œï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šä½¿ç”¨synchronizedæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œsynchronizedä¼šä¿è¯å¤šçº¿ç¨‹ä¸ä¼šåŒæ—¶æ›´æ–°å˜é‡iã€‚</p><p>å…¶å®é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰æ›´è½»é‡çº§çš„é€‰æ‹©ï¼ŒJavaä»JDK 1.5å¼€å§‹æä¾›äº†java.util.concurrent.atomicåŒ…ï¼Œè¿™ä¸ªåŒ…ä¸­çš„åŸå­æ“ä½œç±»æä¾›äº†ä¸€ç§ç”¨æ³•ç®€å•ã€æ€§èƒ½é«˜æ•ˆã€çº¿ç¨‹å®‰å…¨åœ°æ›´æ–°ä¸€ä¸ªå˜é‡çš„æ–¹å¼ã€‚</p><p>å› ä¸ºå˜é‡çš„ç±»å‹æœ‰å¾ˆå¤šç§ï¼Œæ‰€ä»¥åœ¨AtomicåŒ…é‡Œä¸€å…±æä¾›äº†13ä¸ªç±»ï¼Œå±äº4ç§ç±»å‹çš„åŸå­æ›´æ–°æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯åŸå­æ›´æ–°åŸºæœ¬ç±»å‹ã€åŸå­æ›´æ–°æ•°ç»„ã€åŸå­æ›´æ–°å¼•ç”¨å’ŒåŸå­æ›´æ–°å±æ€§ï¼ˆå­—æ®µï¼‰ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-46.png" alt="åŸå­æ“ä½œç±»"></p><p>AtomicåŒ…é‡Œçš„ç±»åŸºæœ¬éƒ½æ˜¯ä½¿ç”¨Unsafeå®ç°çš„åŒ…è£…ç±»ã€‚</p><p>ä½¿ç”¨åŸå­çš„æ–¹å¼æ›´æ–°åŸºæœ¬ç±»å‹ï¼ŒAtomicåŒ…æä¾›äº†ä»¥ä¸‹3ä¸ªç±»ï¼š</p><ul><li><p>AtomicBooleanï¼šåŸå­æ›´æ–°å¸ƒå°”ç±»å‹ã€‚</p></li><li><p>AtomicIntegerï¼šåŸå­æ›´æ–°æ•´å‹ã€‚</p></li><li><p>AtomicLongï¼šåŸå­æ›´æ–°é•¿æ•´å‹ã€‚</p></li></ul><p>é€šè¿‡åŸå­çš„æ–¹å¼æ›´æ–°æ•°ç»„é‡Œçš„æŸä¸ªå…ƒç´ ï¼ŒAtomicåŒ…æä¾›äº†ä»¥ä¸‹4ä¸ªç±»ï¼š</p><ul><li><p>AtomicIntegerArrayï¼šåŸå­æ›´æ–°æ•´å‹æ•°ç»„é‡Œçš„å…ƒç´ ã€‚</p></li><li><p>AtomicLongArrayï¼šåŸå­æ›´æ–°é•¿æ•´å‹æ•°ç»„é‡Œçš„å…ƒç´ ã€‚</p></li><li><p>AtomicReferenceArrayï¼šåŸå­æ›´æ–°å¼•ç”¨ç±»å‹æ•°ç»„é‡Œçš„å…ƒç´ ã€‚</p></li><li><p>AtomicIntegerArrayç±»ä¸»è¦æ˜¯æä¾›åŸå­çš„æ–¹å¼æ›´æ–°æ•°ç»„é‡Œçš„æ•´å‹</p></li></ul><p>åŸå­æ›´æ–°åŸºæœ¬ç±»å‹çš„AtomicIntegerï¼Œåªèƒ½æ›´æ–°ä¸€ä¸ªå˜é‡ï¼Œå¦‚æœè¦åŸå­æ›´æ–°å¤šä¸ªå˜é‡ï¼Œå°±éœ€è¦ä½¿ç”¨è¿™ä¸ªåŸå­æ›´æ–°å¼•ç”¨ç±»å‹æä¾›çš„ç±»ã€‚AtomicåŒ…æä¾›äº†ä»¥ä¸‹3ä¸ªç±»ï¼š</p><ul><li><p>AtomicReferenceï¼šåŸå­æ›´æ–°å¼•ç”¨ç±»å‹ã€‚</p></li><li><p>AtomicReferenceFieldUpdaterï¼šåŸå­æ›´æ–°å¼•ç”¨ç±»å‹é‡Œçš„å­—æ®µã€‚</p></li><li><p>AtomicMarkableReferenceï¼šåŸå­æ›´æ–°å¸¦æœ‰æ ‡è®°ä½çš„å¼•ç”¨ç±»å‹ã€‚å¯ä»¥åŸå­æ›´æ–°ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„æ ‡è®°ä½å’Œå¼•ç”¨ç±»å‹ã€‚æ„é€ æ–¹æ³•æ˜¯AtomicMarkableReferenceï¼ˆV initialRefï¼Œboolean initialMarkï¼‰ã€‚</p></li></ul><p>å¦‚æœéœ€åŸå­åœ°æ›´æ–°æŸä¸ªç±»é‡Œçš„æŸä¸ªå­—æ®µæ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨åŸå­æ›´æ–°å­—æ®µç±»ï¼ŒAtomicåŒ…æä¾›äº†ä»¥ä¸‹3ä¸ªç±»è¿›è¡ŒåŸå­å­—æ®µæ›´æ–°ï¼š</p><ul><li>AtomicIntegerFieldUpdaterï¼šåŸå­æ›´æ–°æ•´å‹çš„å­—æ®µçš„æ›´æ–°å™¨ã€‚</li><li>AtomicLongFieldUpdaterï¼šåŸå­æ›´æ–°é•¿æ•´å‹å­—æ®µçš„æ›´æ–°å™¨ã€‚</li><li>AtomicStampedReferenceï¼šåŸå­æ›´æ–°å¸¦æœ‰ç‰ˆæœ¬å·çš„å¼•ç”¨ç±»å‹ã€‚è¯¥ç±»å°†æ•´æ•°å€¼ä¸å¼•ç”¨å…³è”èµ·æ¥ï¼Œå¯ç”¨äºåŸå­çš„æ›´æ–°æ•°æ®å’Œæ•°æ®çš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥è§£å†³ä½¿ç”¨CASè¿›è¡ŒåŸå­æ›´æ–°æ—¶å¯èƒ½å‡ºç°çš„ ABAé—®é¢˜ã€‚</li></ul><h3 id="_36-atomicinteger-çš„åŸç†" tabindex="-1"><a class="header-anchor" href="#_36-atomicinteger-çš„åŸç†" aria-hidden="true">#</a> 36.AtomicInteger çš„åŸç†ï¼Ÿ</h3><p>ä¸€å¥è¯æ¦‚æ‹¬ï¼š<strong>ä½¿ç”¨CASå®ç°</strong>ã€‚</p><p>ä»¥AtomicIntegerçš„æ·»åŠ æ–¹æ³•ä¸ºä¾‹ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> unsafe<span class="token punctuation">.</span><span class="token function">getAndAddInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> valueOffset<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡<code>Unsafe</code>ç±»çš„å®ä¾‹æ¥è¿›è¡Œæ·»åŠ æ“ä½œï¼Œæ¥çœ‹çœ‹å…·ä½“çš„CASæ“ä½œï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndAddInt</span><span class="token punctuation">(</span><span class="token class-name">Object</span> var1<span class="token punctuation">,</span> <span class="token keyword">long</span> var2<span class="token punctuation">,</span> <span class="token keyword">int</span> var4<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> var5<span class="token punctuation">;</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
        var5 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getIntVolatile</span><span class="token punctuation">(</span>var1<span class="token punctuation">,</span> var2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compareAndSwapInt</span><span class="token punctuation">(</span>var1<span class="token punctuation">,</span> var2<span class="token punctuation">,</span> var5<span class="token punctuation">,</span> var5 <span class="token operator">+</span> var4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> var5<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>compareAndSwapInt æ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼ŒåŸºäºCASæ¥æ“ä½œintç±»å‹å˜é‡ã€‚å…¶å®ƒçš„åŸå­æ“ä½œç±»åŸºæœ¬éƒ½æ˜¯å¤§åŒå°å¼‚ã€‚</p><h3 id="_37-çº¿ç¨‹æ­»é”äº†è§£å—-è¯¥å¦‚ä½•é¿å…" tabindex="-1"><a class="header-anchor" href="#_37-çº¿ç¨‹æ­»é”äº†è§£å—-è¯¥å¦‚ä½•é¿å…" aria-hidden="true">#</a> 37.çº¿ç¨‹æ­»é”äº†è§£å—ï¼Ÿè¯¥å¦‚ä½•é¿å…ï¼Ÿ</h3><p>æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› äº‰å¤ºèµ„æºè€Œé€ æˆçš„äº’ç›¸ç­‰å¾…çš„ç°è±¡ï¼Œåœ¨æ— å¤–åŠ›ä½œç”¨çš„æƒ…å†µä¸‹ï¼Œè¿™äº›çº¿ç¨‹ä¼šä¸€ç›´ç›¸äº’ç­‰å¾…è€Œæ— æ³•ç»§ç»­è¿è¡Œä¸‹å»ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-47.png" alt="æ­»é”ç¤ºæ„å›¾"></p><p>é‚£ä¹ˆä¸ºä»€ä¹ˆä¼šäº§ç”Ÿæ­»é”å‘¢ï¼Ÿ æ­»é”çš„äº§ç”Ÿå¿…é¡»å…·å¤‡ä»¥ä¸‹å››ä¸ªæ¡ä»¶ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-48.png" alt="æ­»é”äº§ç”Ÿå¿…å¤‡å››æ¡ä»¶"></p><ul><li>äº’æ–¥æ¡ä»¶ï¼šæŒ‡çº¿ç¨‹å¯¹å·±ç»è·å–åˆ°çš„èµ„æºè¿›è¡Œå®ƒæ€§ä½¿ç”¨ï¼Œå³è¯¥èµ„æºåŒæ—¶åªç”±ä¸€ä¸ªçº¿ç¨‹å ç”¨ã€‚å¦‚æœæ­¤æ—¶è¿˜æœ‰å…¶å®ƒçº¿ç¨‹è¯·æ±‚è·å–è·å–è¯¥èµ„æºï¼Œåˆ™è¯·æ±‚è€…åªèƒ½ç­‰å¾…ï¼Œç›´è‡³å æœ‰èµ„æºçš„çº¿ç¨‹é‡Šæ”¾è¯¥èµ„æºã€‚</li><li>è¯·æ±‚å¹¶æŒæœ‰æ¡ä»¶ï¼šæŒ‡ä¸€ä¸ª çº¿ç¨‹å·±ç»æŒæœ‰äº†è‡³å°‘ä¸€ä¸ªèµ„æºï¼Œä½†åˆæå‡ºäº†æ–°çš„èµ„æºè¯·æ±‚ï¼Œè€Œæ–°èµ„æºå·±è¢«å…¶å®ƒçº¿ç¨‹å æœ‰ï¼Œæ‰€ä»¥å½“å‰çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œä½†é˜»å¡ çš„åŒæ—¶å¹¶ä¸é‡Šæ”¾è‡ªå·±å·²ç»è·å–çš„èµ„æºã€‚</li><li>ä¸å¯å‰¥å¤ºæ¡ä»¶ï¼šæŒ‡çº¿ç¨‹è·å–åˆ°çš„èµ„æºåœ¨è‡ªå·±ä½¿ç”¨å®Œä¹‹å‰ä¸èƒ½è¢«å…¶å®ƒçº¿ç¨‹æŠ¢å ï¼Œåªæœ‰åœ¨è‡ªå·±ä½¿ç”¨å®Œæ¯•åæ‰ç”±è‡ªå·±é‡Šæ”¾è¯¥èµ„æºã€‚</li><li>ç¯è·¯ç­‰å¾…æ¡ä»¶ï¼šæŒ‡åœ¨å‘ç”Ÿæ­»é”æ—¶ï¼Œå¿…ç„¶å­˜åœ¨ä¸€ä¸ªçº¿ç¨‹â€”â€”èµ„æºçš„ç¯å½¢é“¾ï¼Œå³çº¿ç¨‹é›†åˆ {T0ï¼ŒT1ï¼ŒT2,â€¦â€¦ ï¼ŒTn} ä¸­ T0 æ­£åœ¨ç­‰å¾…ä¸€ T1 å ç”¨çš„èµ„æºï¼ŒTl1æ­£åœ¨ç­‰å¾… T2ç”¨çš„èµ„æºï¼Œâ€¦â€¦ Tn åœ¨ç­‰å¾…å·±è¢« T0å ç”¨çš„èµ„æºã€‚</li></ul><p>è¯¥å¦‚ä½•é¿å…æ­»é”å‘¢ï¼Ÿç­”æ¡ˆæ˜¯<strong>è‡³å°‘ç ´åæ­»é”å‘ç”Ÿçš„ä¸€ä¸ªæ¡ä»¶</strong>ã€‚</p><ul><li><p>å…¶ä¸­ï¼Œäº’æ–¥è¿™ä¸ªæ¡ä»¶æˆ‘ä»¬æ²¡æœ‰åŠæ³•ç ´åï¼Œå› ä¸ºç”¨é”ä¸ºçš„å°±æ˜¯äº’æ–¥ã€‚ä¸è¿‡å…¶ä»–ä¸‰ä¸ªæ¡ä»¶éƒ½æ˜¯æœ‰åŠæ³•ç ´åæ‰çš„ï¼Œåˆ°åº•å¦‚ä½•åšå‘¢ï¼Ÿ</p></li><li><p>å¯¹äºâ€œè¯·æ±‚å¹¶æŒæœ‰â€è¿™ä¸ªæ¡ä»¶ï¼Œå¯ä»¥ä¸€æ¬¡æ€§è¯·æ±‚æ‰€æœ‰çš„èµ„æºã€‚</p></li><li><p>å¯¹äºâ€œä¸å¯å‰¥å¤ºâ€è¿™ä¸ªæ¡ä»¶ï¼Œå ç”¨éƒ¨åˆ†èµ„æºçš„çº¿ç¨‹è¿›ä¸€æ­¥ç”³è¯·å…¶ä»–èµ„æºæ—¶ï¼Œå¦‚æœç”³è¯·ä¸åˆ°ï¼Œå¯ä»¥ä¸»åŠ¨é‡Šæ”¾å®ƒå æœ‰çš„èµ„æºï¼Œè¿™æ ·ä¸å¯æŠ¢å è¿™ä¸ªæ¡ä»¶å°±ç ´åæ‰äº†ã€‚</p></li><li><p>å¯¹äºâ€œç¯è·¯ç­‰å¾…â€è¿™ä¸ªæ¡ä»¶ï¼Œå¯ä»¥é æŒ‰åºç”³è¯·èµ„æºæ¥é¢„é˜²ã€‚æ‰€è°“æŒ‰åºç”³è¯·ï¼Œæ˜¯æŒ‡èµ„æºæ˜¯æœ‰çº¿æ€§é¡ºåºçš„ï¼Œç”³è¯·çš„æ—¶å€™å¯ä»¥å…ˆç”³è¯·èµ„æºåºå·å°çš„ï¼Œå†ç”³è¯·èµ„æºåºå·å¤§çš„ï¼Œè¿™æ ·çº¿æ€§åŒ–åå°±ä¸å­˜åœ¨ç¯è·¯äº†ã€‚</p></li></ul><h3 id="_38-é‚£æ­»é”é—®é¢˜æ€ä¹ˆæ’æŸ¥å‘¢" tabindex="-1"><a class="header-anchor" href="#_38-é‚£æ­»é”é—®é¢˜æ€ä¹ˆæ’æŸ¥å‘¢" aria-hidden="true">#</a> 38.é‚£æ­»é”é—®é¢˜æ€ä¹ˆæ’æŸ¥å‘¢ï¼Ÿ</h3><p>å¯ä»¥ä½¿ç”¨jdkè‡ªå¸¦çš„å‘½ä»¤è¡Œå·¥å…·æ’æŸ¥ï¼š</p><ol><li>ä½¿ç”¨jpsæŸ¥æ‰¾è¿è¡Œçš„Javaè¿›ç¨‹ï¼šjps -l</li><li>ä½¿ç”¨jstackæŸ¥çœ‹çº¿ç¨‹å †æ ˆä¿¡æ¯ï¼šjstack -l è¿›ç¨‹id</li></ol><p>åŸºæœ¬å°±å¯ä»¥çœ‹åˆ°æ­»é”çš„ä¿¡æ¯ã€‚</p><p>è¿˜å¯ä»¥åˆ©ç”¨å›¾å½¢åŒ–å·¥å…·ï¼Œæ¯”å¦‚JConsoleã€‚å‡ºç°çº¿ç¨‹æ­»é”ä»¥åï¼Œç‚¹å‡»JConsoleçº¿ç¨‹é¢æ¿çš„<code>æ£€æµ‹åˆ°æ­»é”</code>æŒ‰é’®ï¼Œå°†ä¼šçœ‹åˆ°çº¿ç¨‹çš„æ­»é”ä¿¡æ¯ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-49.png" alt="çº¿ç¨‹æ­»é”æ£€æµ‹"></p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xingbiaogongzhonghao.png" alt=""></p><h2 id="å¹¶å‘å·¥å…·ç±»" tabindex="-1"><a class="header-anchor" href="#å¹¶å‘å·¥å…·ç±»" aria-hidden="true">#</a> å¹¶å‘å·¥å…·ç±»</h2><h3 id="_39-countdownlatch-å€’è®¡æ•°å™¨-äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_39-countdownlatch-å€’è®¡æ•°å™¨-äº†è§£å—" aria-hidden="true">#</a> 39.CountDownLatchï¼ˆå€’è®¡æ•°å™¨ï¼‰äº†è§£å—ï¼Ÿ</h3><p>CountDownLatchï¼Œå€’è®¡æ•°å™¨ï¼Œæœ‰ä¸¤ä¸ªå¸¸è§çš„åº”ç”¨åœºæ™¯[18]ï¼š</p><p><strong>åœºæ™¯1ï¼šåè°ƒå­çº¿ç¨‹ç»“æŸåŠ¨ä½œï¼šç­‰å¾…æ‰€æœ‰å­çº¿ç¨‹è¿è¡Œç»“æŸ</strong></p><p>CountDownLatchå…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆæ“ä½œã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¾ˆå¤šäººå–œæ¬¢ç©çš„ç‹è€…è£è€€ï¼Œå¼€é»‘çš„æ—¶å€™ï¼Œå¾—ç­‰æ‰€æœ‰äººéƒ½ä¸Šçº¿ä¹‹åï¼Œæ‰èƒ½å¼€æ‰“ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-50.jpeg" alt="ç‹è€…è£è€€ç­‰å¾…ç©å®¶ç¡®è®¤-æ¥æºå‚è€ƒ[18]"></p><p>CountDownLatchæ¨¡ä»¿è¿™ä¸ªåœºæ™¯(å‚è€ƒ[18])ï¼š</p><p>åˆ›å»ºå¤§ä¹”ã€å…°é™µç‹ã€å®‰å…¶æ‹‰ã€å“ªå’å’Œé“ ç­‰äº”ä¸ªç©å®¶ï¼Œä¸»çº¿ç¨‹å¿…é¡»åœ¨ä»–ä»¬éƒ½å®Œæˆç¡®è®¤åï¼Œæ‰å¯ä»¥ç»§ç»­è¿è¡Œã€‚</p><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ<code>new CountDownLatch(5)</code>ç”¨æˆ·åˆ›å»ºåˆå§‹çš„latchæ•°é‡ï¼Œå„ç©å®¶é€šè¿‡<code>countDownLatch.countDown()</code>å®ŒæˆçŠ¶æ€ç¡®è®¤ï¼Œä¸»çº¿ç¨‹é€šè¿‡<code>countDownLatch.await()</code>ç­‰å¾…ã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Thread</span> å¤§ä¹” <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>countDownLatch<span class="token operator">::</span><span class="token function">countDown</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span> å…°é™µç‹ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>countDownLatch<span class="token operator">::</span><span class="token function">countDown</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span> å®‰å…¶æ‹‰ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>countDownLatch<span class="token operator">::</span><span class="token function">countDown</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span> å“ªå’ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>countDownLatch<span class="token operator">::</span><span class="token function">countDown</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span> é“  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// ç¨ç­‰ï¼Œä¸Šä¸ªå«ç”Ÿé—´ï¼Œé©¬ä¸Šåˆ°...</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ignored<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    å¤§ä¹”<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    å…°é™µç‹<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    å®‰å…¶æ‹‰<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    å“ªå’<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    é“ <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰€æœ‰ç©å®¶å·²ç»å°±ä½ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åœºæ™¯2. åè°ƒå­çº¿ç¨‹å¼€å§‹åŠ¨ä½œï¼šç»Ÿä¸€å„çº¿ç¨‹åŠ¨ä½œå¼€å§‹çš„æ—¶æœº</strong></p><p>ç‹è€…æ¸¸æˆä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„åœºæ™¯ï¼Œæ¸¸æˆå¼€å§‹æ—¶ï¼Œå„ç©å®¶çš„åˆå§‹çŠ¶æ€å¿…é¡»ä¸€è‡´ã€‚ä¸èƒ½æœ‰çš„ç©å®¶éƒ½å‡ºå®Œè£…äº†ï¼Œæœ‰çš„æ‰é™ç”Ÿã€‚</p><p>æ‰€ä»¥å¤§å®¶å¾—ä¸€å—å‡ºç”Ÿï¼Œåœ¨</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-51.jpeg" alt="ç‹è€…è£è€€-æ¥æºå‚è€ƒ[18]"></p><p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œä»ç„¶ç”¨äº”ä¸ªçº¿ç¨‹ä»£è¡¨å¤§ä¹”ã€å…°é™µç‹ã€å®‰å…¶æ‹‰ã€å“ªå’å’Œé“ ç­‰äº”ä¸ªç©å®¶ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå„ç©å®¶è™½ç„¶éƒ½è°ƒç”¨äº†<code>start()</code>çº¿ç¨‹ï¼Œä½†æ˜¯å®ƒä»¬åœ¨è¿è¡Œæ—¶éƒ½åœ¨ç­‰å¾…<code>countDownLatch</code>çš„ä¿¡å·ï¼Œåœ¨ä¿¡å·æœªæ”¶åˆ°å‰ï¼Œå®ƒä»¬ä¸ä¼šå¾€ä¸‹æ‰§è¡Œã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Thread</span> å¤§ä¹” <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">waitToFight</span><span class="token punctuation">(</span>countDownLatch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span> å…°é™µç‹ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">waitToFight</span><span class="token punctuation">(</span>countDownLatch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span> å®‰å…¶æ‹‰ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">waitToFight</span><span class="token punctuation">(</span>countDownLatch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span> å“ªå’ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">waitToFight</span><span class="token punctuation">(</span>countDownLatch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span> é“  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">waitToFight</span><span class="token punctuation">(</span>countDownLatch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    å¤§ä¹”<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    å…°é™µç‹<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    å®‰å…¶æ‹‰<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    å“ªå’<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    é“ <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ•Œæ–¹è¿˜æœ‰5ç§’è¾¾åˆ°æˆ˜åœºï¼Œå…¨å†›å‡ºå‡»ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">waitToFight</span><span class="token punctuation">(</span><span class="token class-name">CountDownLatch</span> countDownLatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åœ¨æ­¤ç­‰å¾…ä¿¡å·å†ç»§ç»­</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ”¶åˆ°ï¼Œå‘èµ·è¿›æ”»ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>CountDownLatchçš„<strong>æ ¸å¿ƒæ–¹æ³•</strong>ä¹Ÿä¸å¤šï¼š</p><ul><li><code>await()</code>ï¼šç­‰å¾…latché™ä¸º0ï¼›</li><li><code>boolean await(long timeout, TimeUnit unit)</code>ï¼šç­‰å¾…latché™ä¸º0ï¼Œä½†æ˜¯å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚æ¯”å¦‚æœ‰ç©å®¶è¶…æ—¶æœªç¡®è®¤ï¼Œé‚£å°±é‡æ–°åŒ¹é…ï¼Œæ€»ä¸èƒ½ä¸ºäº†æŸä¸ªç©å®¶ç­‰åˆ°å¤©è’åœ°è€ã€‚</li><li><code>countDown()</code>ï¼šlatchæ•°é‡å‡1ï¼›</li><li><code>getCount()</code>ï¼šè·å–å½“å‰çš„latchæ•°é‡ã€‚</li></ul><h3 id="_40-cyclicbarrier-åŒæ­¥å±éšœ-äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_40-cyclicbarrier-åŒæ­¥å±éšœ-äº†è§£å—" aria-hidden="true">#</a> 40.CyclicBarrierï¼ˆåŒæ­¥å±éšœï¼‰äº†è§£å—ï¼Ÿ</h3><p>CyclicBarrierçš„å­—é¢æ„æ€æ˜¯å¯å¾ªç¯ä½¿ç”¨ï¼ˆCyclicï¼‰çš„å±éšœï¼ˆBarrierï¼‰ã€‚å®ƒè¦åšçš„äº‹æƒ…æ˜¯ï¼Œè®©ä¸€ ç»„çº¿ç¨‹åˆ°è¾¾ä¸€ä¸ªå±éšœï¼ˆä¹Ÿå¯ä»¥å«åŒæ­¥ç‚¹ï¼‰æ—¶è¢«é˜»å¡ï¼Œç›´åˆ°æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœæ—¶ï¼Œå±éšœæ‰ä¼šå¼€é—¨ï¼Œæ‰€æœ‰è¢«å±éšœæ‹¦æˆªçš„çº¿ç¨‹æ‰ä¼šç»§ç»­è¿è¡Œã€‚</p><p>å®ƒå’ŒCountDownLatchç±»ä¼¼ï¼Œéƒ½å¯ä»¥åè°ƒå¤šçº¿ç¨‹çš„ç»“æŸåŠ¨ä½œï¼Œåœ¨å®ƒä»¬ç»“æŸåéƒ½å¯ä»¥æ‰§è¡Œç‰¹å®šåŠ¨ä½œï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¦æœ‰CyclicBarrierï¼Œè‡ªç„¶æ˜¯å®ƒæœ‰å’ŒCountDownLatchä¸åŒçš„åœ°æ–¹ã€‚</p><p>ä¸çŸ¥é“ä½ å¬æ²¡å¬è¿‡ä¸€ä¸ªæ–°äººUPä¸»å°çº¦ç¿°å¯æ±—ï¼Œå°çº¦ç¿°ç”Ÿå¹³æœ‰ä¸¤å¤§æ¨â€”â€”â€œæƒ³ç»“è¡£ç»“è¡£ä¸ä¾,è¿·çˆ±ç†çˆ±ç†ä¸ç†ã€‚â€æˆ‘ä»¬æ¥è¿˜åŸä¸€ä¸‹äº‹æƒ…çš„ç»è¿‡ï¼šå°çº¦ç¿°åœ¨äº²æ”¿åè®¤è¯†äº†æ–°å£ç»“è¡£ï¼Œäºæ˜¯å†³å®šç¬¬ä¸€æ¬¡é€‰å¦ƒï¼Œå‘ç»“è¡£è¡¨ç™½ï¼Œç­‰å¾…å›åº”ã€‚ç„¶è€Œæ–°å£ç»“è¡£å›åº”å«ç»™äº†æ˜Ÿé‡æºï¼Œå°çº¦ç¿°ä¼¤å¿ƒæ¬²ç»ï¼Œå‘èª“ç”Ÿå¹³ä¸å¨¶ï¼Œçªç„¶å‘ç°äº†é“ƒæœ¨çˆ±ç†ï¼Œäºæ˜¯å°çº¦ç¿°å†³å®šç¬¬äºŒæ¬¡é€‰å¦ƒï¼Œæ±‚çˆ±ç†æ­ç†ï¼Œç­‰å¾…å›åº”ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-52.png" alt="æƒ³ç»“è¡£ç»“è¡£ä¸ä¾,è¿·çˆ±ç†çˆ±ç†ä¸ç†ã€‚"></p><p>æˆ‘ä»¬æ‹¿ä»£ç æ¨¡æ‹Ÿè¿™ä¸€åœºæ™¯ï¼Œå‘ç°CountDownLatchæ— èƒ½ä¸ºåŠ›äº†ï¼Œå› ä¸ºCountDownLatchçš„ä½¿ç”¨æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œæ— æ³•é‡å¤åˆ©ç”¨ï¼Œè€Œè¿™é‡Œç­‰å¾…äº†ä¸¤æ¬¡ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬ç”¨CyclicBarrierå°±å¯ä»¥å®ç°ï¼Œå› ä¸ºå®ƒå¯ä»¥é‡å¤åˆ©ç”¨ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-53.png" alt="å°çº¦ç¿°å¯æ±—é€‰å¦ƒæ¨¡æ‹Ÿä»£ç "></p><p>è¿è¡Œç»“æœï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-54.png" alt="è¿è¡Œç»“æœ"></p><p>CyclicBarrieræœ€æœ€æ ¸å¿ƒçš„æ–¹æ³•ï¼Œä»ç„¶æ˜¯await()ï¼š</p><ul><li>å¦‚æœå½“å‰çº¿ç¨‹ä¸æ˜¯ç¬¬ä¸€ä¸ªåˆ°è¾¾å±éšœçš„è¯ï¼Œå®ƒå°†ä¼šè¿›å…¥ç­‰å¾…ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹éƒ½åˆ°è¾¾ï¼Œé™¤éå‘ç”Ÿ<strong>è¢«ä¸­æ–­</strong>ã€<strong>å±éšœè¢«æ‹†é™¤</strong>ã€<strong>å±éšœè¢«é‡è®¾</strong>ç­‰æƒ…å†µï¼›</li></ul><p>ä¸Šé¢çš„ä¾‹å­æŠ½è±¡ä¸€ä¸‹ï¼Œæœ¬è´¨ä¸Šå®ƒçš„æµç¨‹å°±æ˜¯è¿™æ ·å°±æ˜¯è¿™æ ·ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-55.png" alt="CyclicBarrierå·¥ä½œæµç¨‹"></p><h3 id="_41-cyclicbarrierå’Œcountdownlatchæœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_41-cyclicbarrierå’Œcountdownlatchæœ‰ä»€ä¹ˆåŒºåˆ«" aria-hidden="true">#</a> 41.CyclicBarrierå’ŒCountDownLatchæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>ä¸¤è€…æœ€æ ¸å¿ƒçš„åŒºåˆ«[18]ï¼š</p><ul><li>CountDownLatchæ˜¯ä¸€æ¬¡æ€§çš„ï¼Œè€ŒCyclicBarrieråˆ™å¯ä»¥å¤šæ¬¡è®¾ç½®å±éšœï¼Œå®ç°é‡å¤åˆ©ç”¨ï¼›</li><li>CountDownLatchä¸­çš„å„ä¸ªå­çº¿ç¨‹ä¸å¯ä»¥ç­‰å¾…å…¶ä»–çº¿ç¨‹ï¼Œåªèƒ½å®Œæˆè‡ªå·±çš„ä»»åŠ¡ï¼›è€ŒCyclicBarrierä¸­çš„å„ä¸ªçº¿ç¨‹å¯ä»¥ç­‰å¾…å…¶ä»–çº¿ç¨‹</li></ul><p>å®ƒä»¬åŒºåˆ«ç”¨ä¸€ä¸ªè¡¨æ ¼æ•´ç†ï¼š</p><table><thead><tr><th>CyclicBarrier</th><th>CountDownLatch</th></tr></thead><tbody><tr><td>CyclicBarrieræ˜¯å¯é‡ç”¨çš„ï¼Œå…¶ä¸­çš„çº¿ç¨‹ä¼šç­‰å¾…æ‰€æœ‰çš„çº¿ç¨‹å®Œæˆä»»åŠ¡ã€‚å±Šæ—¶ï¼Œå±éšœå°†è¢«æ‹†é™¤ï¼Œå¹¶å¯ä»¥é€‰æ‹©æ€§åœ°åšä¸€äº›ç‰¹å®šçš„åŠ¨ä½œã€‚</td><td>CountDownLatchæ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä¸åŒçš„çº¿ç¨‹åœ¨åŒä¸€ä¸ªè®¡æ•°å™¨ä¸Šå·¥ä½œï¼Œç›´åˆ°è®¡æ•°å™¨ä¸º0.</td></tr><tr><td>CyclicBarrieré¢å‘çš„æ˜¯çº¿ç¨‹æ•°</td><td>CountDownLatché¢å‘çš„æ˜¯ä»»åŠ¡æ•°</td></tr><tr><td>åœ¨ä½¿ç”¨CyclicBarrieræ—¶ï¼Œä½ å¿…é¡»åœ¨æ„é€ ä¸­æŒ‡å®šå‚ä¸åä½œçš„çº¿ç¨‹æ•°ï¼Œè¿™äº›çº¿ç¨‹å¿…é¡»è°ƒç”¨await()æ–¹æ³•</td><td>ä½¿ç”¨CountDownLatchæ—¶ï¼Œåˆ™å¿…é¡»è¦æŒ‡å®šä»»åŠ¡æ•°ï¼Œè‡³äºè¿™äº›ä»»åŠ¡ç”±å“ªäº›çº¿ç¨‹å®Œæˆæ— å…³ç´§è¦</td></tr><tr><td>CyclicBarrierå¯ä»¥åœ¨æ‰€æœ‰çš„çº¿ç¨‹é‡Šæ”¾åé‡æ–°ä½¿ç”¨</td><td>CountDownLatchåœ¨è®¡æ•°å™¨ä¸º0æ—¶ä¸èƒ½å†ä½¿ç”¨</td></tr><tr><td>åœ¨CyclicBarrierä¸­ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹é‡åˆ°äº†ä¸­æ–­ã€è¶…æ—¶ç­‰é—®é¢˜æ—¶ï¼Œåˆ™å¤„äºawaitçš„çº¿ç¨‹éƒ½ä¼šå‡ºç°é—®é¢˜</td><td>åœ¨CountDownLatchä¸­ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹å‡ºç°é—®é¢˜ï¼Œå…¶ä»–çº¿ç¨‹ä¸å—å½±å“</td></tr></tbody></table><h3 id="_42-semaphore-ä¿¡å·é‡-äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_42-semaphore-ä¿¡å·é‡-äº†è§£å—" aria-hidden="true">#</a> 42.Semaphoreï¼ˆä¿¡å·é‡ï¼‰äº†è§£å—ï¼Ÿ</h3><p>Semaphoreï¼ˆä¿¡å·é‡ï¼‰æ˜¯ç”¨æ¥æ§åˆ¶åŒæ—¶è®¿é—®ç‰¹å®šèµ„æºçš„çº¿ç¨‹æ•°é‡ï¼Œå®ƒé€šè¿‡åè°ƒå„ä¸ªçº¿ç¨‹ï¼Œä»¥ä¿è¯åˆç†çš„ä½¿ç”¨å…¬å…±èµ„æºã€‚</p><p>å¬èµ·æ¥ä¼¼ä¹å¾ˆæŠ½è±¡ï¼Œç°åœ¨æ±½è½¦å¤šäº†ï¼Œå¼€è½¦å‡ºé—¨åœ¨å¤–çš„ä¸€ä¸ªè€å¤§éš¾é—®é¢˜å°±æ˜¯åœè½¦ ã€‚åœè½¦åœºçš„è½¦ä½æ˜¯æœ‰é™çš„ï¼Œåªèƒ½å…è®¸è‹¥å¹²è½¦è¾†åœæ³Šï¼Œå¦‚æœåœè½¦åœºè¿˜æœ‰ç©ºä½ï¼Œé‚£ä¹ˆæ˜¾ç¤ºç‰Œæ˜¾ç¤ºçš„å°±æ˜¯ç»¿ç¯å’Œå‰©ä½™çš„è½¦ä½ï¼Œè½¦è¾†å°±å¯ä»¥é©¶å…¥ï¼›å¦‚æœåœè½¦åœºæ²¡ä½äº†ï¼Œé‚£ä¹ˆæ˜¾ç¤ºç‰Œæ˜¾ç¤ºçš„å°±æ˜¯ç»¿ç¯å’Œæ•°å­—0ï¼Œè½¦è¾†å°±å¾—ç­‰å¾…ã€‚å¦‚æœæ»¡äº†çš„åœè½¦åœºæœ‰è½¦ç¦»å¼€ï¼Œé‚£ä¹ˆæ˜¾ç¤ºç‰Œå°±åˆå˜ç»¿ï¼Œæ˜¾ç¤ºç©ºè½¦ä½æ•°é‡ï¼Œç­‰å¾…çš„è½¦è¾†å°±èƒ½è¿›åœè½¦åœºã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-56.jpeg" alt="åœè½¦åœºç©ºé—²è½¦ä½æç¤º-å›¾ç‰‡æ¥æºç½‘ç»œ"></p><p>æˆ‘ä»¬æŠŠè¿™ä¸ªä¾‹å­ç±»æ¯”ä¸€ä¸‹ï¼Œè½¦è¾†å°±æ˜¯çº¿ç¨‹ï¼Œè¿›å…¥åœè½¦åœºå°±æ˜¯çº¿ç¨‹åœ¨æ‰§è¡Œï¼Œç¦»å¼€åœè½¦åœºå°±æ˜¯çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œçœ‹è§çº¢ç¯å°±è¡¨ç¤ºçº¿ç¨‹è¢«é˜»å¡ï¼Œä¸èƒ½æ‰§è¡Œï¼ŒSemaphoreçš„æœ¬è´¨å°±æ˜¯<strong>åè°ƒå¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºçš„è·å–</strong>ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-57.jpeg" alt="Semaphoreè®¸å¯è·å–-æ¥æºå‚è€ƒ[18]"></p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªSemaphoreçš„ç”¨é€”ï¼šå®ƒå¯ä»¥ç”¨äºåšæµé‡æ§åˆ¶ï¼Œç‰¹åˆ«æ˜¯å…¬ç”¨èµ„æºæœ‰é™çš„åº”ç”¨åœºæ™¯ï¼Œæ¯”å¦‚æ•°æ®åº“è¿æ¥ã€‚</p><p>å‡å¦‚æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œè¦è¯»å–å‡ ä¸‡ä¸ªæ–‡ä»¶çš„æ•°æ®ï¼Œå› ä¸ºéƒ½æ˜¯IOå¯†é›†å‹ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥å¯åŠ¨å‡ åä¸ªçº¿ç¨‹å¹¶å‘åœ°è¯»å–ï¼Œä½†æ˜¯å¦‚æœè¯»åˆ°å†…å­˜åï¼Œè¿˜éœ€è¦å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œè€Œæ•°æ®åº“çš„è¿æ¥æ•°åªæœ‰10ä¸ªï¼Œè¿™æ—¶æˆ‘ä»¬å¿…é¡»æ§åˆ¶åªæœ‰10ä¸ªçº¿ç¨‹åŒæ—¶è·å–æ•°æ®åº“è¿æ¥ä¿å­˜æ•°æ®ï¼Œå¦åˆ™ä¼šæŠ¥é”™æ— æ³•è·å–æ•°æ®åº“è¿æ¥ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨Semaphoreæ¥åšæµé‡æ§åˆ¶ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SemaphoreTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> THREAD_COUNT <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> threadPool <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span>THREAD_COUNT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Semaphore</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> THREAD_COUNT<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            threadPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        s<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;save data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        s<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        threadPool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä»£ç ä¸­ï¼Œè™½ç„¶æœ‰30ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œï¼Œä½†æ˜¯åªå…è®¸10ä¸ªå¹¶å‘æ‰§è¡Œã€‚Semaphoreçš„æ„é€ æ–¹æ³•<code> Semaphoreï¼ˆint permits</code>ï¼‰æ¥å—ä¸€ä¸ªæ•´å‹çš„æ•°å­—ï¼Œè¡¨ç¤ºå¯ç”¨çš„è®¸å¯è¯æ•°é‡ã€‚<code>Semaphoreï¼ˆ10ï¼‰</code>è¡¨ç¤ºå…è®¸10ä¸ªçº¿ç¨‹è·å–è®¸å¯è¯ï¼Œä¹Ÿå°±æ˜¯æœ€å¤§å¹¶å‘æ•°æ˜¯10ã€‚Semaphoreçš„ç”¨æ³•ä¹Ÿå¾ˆç®€å•ï¼Œé¦–å…ˆçº¿ç¨‹ä½¿ç”¨ Semaphoreçš„acquire()æ–¹æ³•è·å–ä¸€ä¸ªè®¸å¯è¯ï¼Œä½¿ç”¨å®Œä¹‹åè°ƒç”¨release()æ–¹æ³•å½’è¿˜è®¸å¯è¯ã€‚è¿˜å¯ä»¥ç”¨tryAcquire()æ–¹æ³•å°è¯•è·å–è®¸å¯è¯ã€‚</p><h3 id="_43-exchanger-äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_43-exchanger-äº†è§£å—" aria-hidden="true">#</a> 43.Exchanger äº†è§£å—ï¼Ÿ</h3><p>Exchangerï¼ˆäº¤æ¢è€…ï¼‰æ˜¯ä¸€ä¸ªç”¨äºçº¿ç¨‹é—´åä½œçš„å·¥å…·ç±»ã€‚Exchangerç”¨äºè¿›è¡Œçº¿ç¨‹é—´çš„æ•°æ®äº¤æ¢ã€‚å®ƒæä¾›ä¸€ä¸ªåŒæ­¥ç‚¹ï¼Œåœ¨è¿™ä¸ªåŒæ­¥ç‚¹ï¼Œä¸¤ä¸ªçº¿ç¨‹å¯ä»¥äº¤æ¢å½¼æ­¤çš„æ•°æ®ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-58.jpeg" alt="è‹±é›„äº¤æ¢çŒç‰©-æ¥æºå‚è€ƒ[18]"></p><p>è¿™ä¸¤ä¸ªçº¿ç¨‹é€šè¿‡ exchangeæ–¹æ³•äº¤æ¢æ•°æ®ï¼Œå¦‚æœç¬¬ä¸€ä¸ªçº¿ç¨‹å…ˆæ‰§è¡Œexchange()æ–¹æ³•ï¼Œå®ƒä¼šä¸€ç›´ç­‰å¾…ç¬¬äºŒä¸ªçº¿ç¨‹ä¹Ÿæ‰§è¡Œexchangeæ–¹æ³•ï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹éƒ½åˆ°è¾¾åŒæ­¥ç‚¹æ—¶ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹å°±å¯ä»¥äº¤æ¢æ•°æ®ï¼Œå°†æœ¬çº¿ç¨‹ç”Ÿäº§å‡ºæ¥çš„æ•°æ®ä¼ é€’ç»™å¯¹æ–¹ã€‚</p><p>Exchangerå¯ä»¥ç”¨äºé—ä¼ ç®—æ³•ï¼Œé—ä¼ ç®—æ³•é‡Œéœ€è¦é€‰å‡ºä¸¤ä¸ªäººä½œä¸ºäº¤é…å¯¹è±¡ï¼Œè¿™æ—¶å€™ä¼šäº¤æ¢ä¸¤äººçš„æ•°æ®ï¼Œå¹¶ä½¿ç”¨äº¤å‰è§„åˆ™å¾—å‡º2ä¸ªäº¤é…ç»“æœã€‚Exchangerä¹Ÿå¯ä»¥ç”¨äºæ ¡å¯¹å·¥ä½œï¼Œæ¯”å¦‚æˆ‘ä»¬éœ€è¦å°†çº¸åˆ¶é“¶è¡Œæµæ°´é€šè¿‡äººå·¥çš„æ–¹å¼å½•å…¥æˆç”µå­é“¶è¡Œæµæ°´ï¼Œä¸ºäº†é¿å…é”™è¯¯ï¼Œé‡‡ç”¨ABå²—ä¸¤äººè¿›è¡Œå½•å…¥ï¼Œå½•å…¥åˆ°Excelä¹‹åï¼Œç³»ç»Ÿéœ€è¦åŠ è½½è¿™ä¸¤ä¸ªExcelï¼Œå¹¶å¯¹ä¸¤ä¸ªExcelæ•°æ®è¿›è¡Œæ ¡å¯¹ï¼Œçœ‹çœ‹æ˜¯å¦å½•å…¥ä¸€è‡´ã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExchangerTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Exchanger</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> exgr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Exchanger</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> threadPool <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        threadPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">String</span> <span class="token class-name">A</span> <span class="token operator">=</span> <span class="token string">&quot;é“¶è¡Œæµæ°´A&quot;</span><span class="token punctuation">;</span> <span class="token comment">// Aå½•å…¥é“¶è¡Œæµæ°´æ•°æ® </span>
                    exgr<span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        threadPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">String</span> <span class="token class-name">B</span> <span class="token operator">=</span> <span class="token string">&quot;é“¶è¡Œæµæ°´B&quot;</span><span class="token punctuation">;</span> <span class="token comment">// Bå½•å…¥é“¶è¡Œæµæ°´æ•°æ® </span>
                    <span class="token class-name">String</span> <span class="token class-name">A</span> <span class="token operator">=</span> exgr<span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Aå’ŒBæ•°æ®æ˜¯å¦ä¸€è‡´ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">A</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">B</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;ï¼ŒAå½•å…¥çš„æ˜¯ï¼š&quot;</span>
                            <span class="token operator">+</span> <span class="token class-name">A</span> <span class="token operator">+</span> <span class="token string">&quot;ï¼ŒBå½•å…¥æ˜¯ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">B</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        threadPool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‡å¦‚ä¸¤ä¸ªçº¿ç¨‹æœ‰ä¸€ä¸ªæ²¡æœ‰æ‰§è¡Œexchange()æ–¹æ³•ï¼Œåˆ™ä¼šä¸€ç›´ç­‰å¾…ï¼Œå¦‚æœæ‹…å¿ƒæœ‰ç‰¹æ®Šæƒ…å†µå‘ç”Ÿï¼Œé¿å…ä¸€ç›´ç­‰å¾…ï¼Œå¯ä»¥ä½¿ç”¨<code>exchange(V x, long timeOut, TimeUnit unit) </code>è®¾ç½®æœ€å¤§ç­‰å¾…æ—¶é•¿ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xingbiaogongzhonghao.png" alt=""></p><h2 id="çº¿ç¨‹æ± " tabindex="-1"><a class="header-anchor" href="#çº¿ç¨‹æ± " aria-hidden="true">#</a> çº¿ç¨‹æ± </h2><h3 id="_44-ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± " tabindex="-1"><a class="header-anchor" href="#_44-ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± " aria-hidden="true">#</a> 44.ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿ</h3><p><strong>çº¿ç¨‹æ± ï¼š</strong> ç®€å•ç†è§£ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªç®¡ç†çº¿ç¨‹çš„æ± å­ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-59.png" alt="ç®¡ç†çº¿ç¨‹çš„æ± å­"></p><ul><li><strong>å®ƒå¸®æˆ‘ä»¬ç®¡ç†çº¿ç¨‹ï¼Œé¿å…å¢åŠ åˆ›å»ºçº¿ç¨‹å’Œé”€æ¯çº¿ç¨‹çš„èµ„æºæŸè€—</strong>ã€‚å› ä¸ºçº¿ç¨‹å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œéœ€è¦ç»è¿‡ç±»åŠ è½½è¿‡ç¨‹ï¼Œé”€æ¯ä¸€ä¸ªå¯¹è±¡ï¼Œéœ€è¦èµ°GCåƒåœ¾å›æ”¶æµç¨‹ï¼Œéƒ½æ˜¯éœ€è¦èµ„æºå¼€é”€çš„ã€‚</li><li><strong>æé«˜å“åº”é€Ÿåº¦ã€‚</strong> å¦‚æœä»»åŠ¡åˆ°è¾¾äº†ï¼Œç›¸å¯¹äºä»çº¿ç¨‹æ± æ‹¿çº¿ç¨‹ï¼Œé‡æ–°å»åˆ›å»ºä¸€æ¡çº¿ç¨‹æ‰§è¡Œï¼Œé€Ÿåº¦è‚¯å®šæ…¢å¾ˆå¤šã€‚</li><li><strong>é‡å¤åˆ©ç”¨ã€‚</strong> çº¿ç¨‹ç”¨å®Œï¼Œå†æ”¾å›æ± å­ï¼Œå¯ä»¥è¾¾åˆ°é‡å¤åˆ©ç”¨çš„æ•ˆæœï¼ŒèŠ‚çœèµ„æºã€‚</li></ul><h3 id="_45-èƒ½è¯´è¯´å·¥ä½œä¸­çº¿ç¨‹æ± çš„åº”ç”¨å—" tabindex="-1"><a class="header-anchor" href="#_45-èƒ½è¯´è¯´å·¥ä½œä¸­çº¿ç¨‹æ± çš„åº”ç”¨å—" aria-hidden="true">#</a> 45.èƒ½è¯´è¯´å·¥ä½œä¸­çº¿ç¨‹æ± çš„åº”ç”¨å—ï¼Ÿ</h3><p>ä¹‹å‰æˆ‘ä»¬æœ‰ä¸€ä¸ªå’Œç¬¬ä¸‰æ–¹å¯¹æ¥çš„éœ€æ±‚ï¼Œéœ€è¦å‘ç¬¬ä¸‰æ–¹æ¨é€æ•°æ®ï¼Œå¼•å…¥äº†å¤šçº¿ç¨‹æ¥æå‡æ•°æ®æ¨é€çš„æ•ˆç‡ï¼Œå…¶ä¸­ç”¨åˆ°äº†çº¿ç¨‹æ± æ¥ç®¡ç†çº¿ç¨‹ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-60.png" alt="ä¸šåŠ¡ç¤ºä¾‹"></p><p>ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-61.png" alt="ä¸»è¦ä»£ç "></p><p>å®Œæ•´å¯è¿è¡Œä»£ç åœ°å€ï¼šhttps://gitee.com/fighter3/thread-demo.git</p><p>çº¿ç¨‹æ± çš„å‚æ•°å¦‚ä¸‹ï¼š</p><ul><li><p>corePoolSizeï¼šçº¿ç¨‹æ ¸å¿ƒå‚æ•°é€‰æ‹©äº†CPUæ•°Ã—2</p></li><li><p>maximumPoolSizeï¼šæœ€å¤§çº¿ç¨‹æ•°é€‰æ‹©äº†å’Œæ ¸å¿ƒçº¿ç¨‹æ•°ç›¸åŒ</p></li><li><p>keepAliveTimeï¼šéæ ¸å¿ƒé—²ç½®çº¿ç¨‹å­˜æ´»æ—¶é—´ç›´æ¥ç½®ä¸º0</p></li><li><p>unitï¼šéæ ¸å¿ƒçº¿ç¨‹ä¿æŒå­˜æ´»çš„æ—¶é—´é€‰æ‹©äº† TimeUnit.SECONDS ç§’</p></li><li><p>workQueueï¼šçº¿ç¨‹æ± ç­‰å¾…é˜Ÿåˆ—ï¼Œä½¿ç”¨ LinkedBlockingQueueé˜»å¡é˜Ÿåˆ—</p></li></ul><p>åŒæ—¶è¿˜ç”¨äº†synchronized æ¥åŠ é”ï¼Œä¿è¯æ•°æ®ä¸ä¼šè¢«é‡å¤æ¨é€ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>  <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">PushProcessServiceImpl</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ps:è¿™ä¸ªä¾‹å­åªæ˜¯ç®€å•åœ°è¿›è¡Œäº†æ•°æ®æ¨é€ï¼Œå®é™…ä¸Šè¿˜å¯ä»¥ç»“åˆå…¶ä»–çš„ä¸šåŠ¡ï¼Œåƒä»€ä¹ˆæ•°æ®æ¸…æ´—å•Šã€æ•°æ®ç»Ÿè®¡å•Šï¼Œéƒ½å¯ä»¥å¥—ç”¨ã€‚</p><h3 id="_46-èƒ½ç®€å•è¯´ä¸€ä¸‹çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹å—" tabindex="-1"><a class="header-anchor" href="#_46-èƒ½ç®€å•è¯´ä¸€ä¸‹çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹å—" aria-hidden="true">#</a> 46.èƒ½ç®€å•è¯´ä¸€ä¸‹çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹å—ï¼Ÿ</h3><p>ç”¨ä¸€ä¸ªé€šä¿—çš„æ¯”å–»ï¼š</p><p>æœ‰ä¸€ä¸ªè¥ä¸šå…ï¼Œæ€»å…±æœ‰å…­ä¸ªçª—å£ï¼Œç°åœ¨å¼€æ”¾äº†ä¸‰ä¸ªçª—å£ï¼Œç°åœ¨æœ‰ä¸‰ä¸ªçª—å£åç€ä¸‰ä¸ªè¥ä¸šå‘˜å°å§å§åœ¨è¥ä¸šã€‚</p><p>è€ä¸‰å»åŠä¸šåŠ¡ï¼Œå¯èƒ½ä¼šé‡åˆ°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ</p><ol><li>è€ä¸‰å‘ç°æœ‰ç©ºé—´çš„åœ¨è¥ä¸šçš„çª—å£ï¼Œç›´æ¥å»æ‰¾å°å§å§åŠç†ä¸šåŠ¡ã€‚</li></ol><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-62.png" alt="ç›´æ¥åŠç†"></p><ol start="2"><li>è€ä¸‰å‘ç°æ²¡æœ‰ç©ºé—²çš„çª—å£ï¼Œå°±åœ¨æ’é˜ŸåŒºæ’é˜Ÿç­‰ã€‚</li></ol><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-63.png" alt="æ’é˜Ÿç­‰å¾…"></p><ol start="3"><li>è€ä¸‰å‘ç°æ²¡æœ‰ç©ºé—²çš„çª—å£ï¼Œç­‰å¾…åŒºä¹Ÿæ»¡äº†ï¼ŒèšŒåŸ ä½äº†ï¼Œç»ç†ä¸€çœ‹ï¼Œå°±è®©ä¼‘æ¯çš„å°å§å§èµ¶ç´§å›æ¥ä¸Šç­ï¼Œç­‰å¾…åŒºå·é å‰çš„èµ¶ç´§å»æ–°çª—å£åŠï¼Œè€ä¸‰å»æ’é˜ŸåŒºæ’é˜Ÿã€‚å°å§å§æ¯”è¾ƒè¾›è‹¦ï¼Œå‡å¦‚ä¸€æ®µæ—¶é—´å‘ç°ä»–ä»¬å¯ä»¥ä¸ç”¨æ¥ç€è¥ä¸šï¼Œç»ç†å°±è®©å¥¹ä»¬æ¥ç€ä¼‘æ¯ã€‚</li></ol><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-64.png" alt="æ’é˜ŸåŒºæ»¡"></p><ol start="4"><li>è€ä¸‰ä¸€çœ‹ï¼Œå…­ä¸ªçª—å£éƒ½æ»¡äº†ï¼Œç­‰å¾…åŒºä¹Ÿæ²¡ä½ç½®äº†ã€‚è€ä¸‰æ€¥äº†ï¼Œè¦é—¹ï¼Œç»ç†èµ¶ç´§å‡ºæ¥äº†ï¼Œç»ç†è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</li></ol><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-65.png" alt="ç­‰å¾…åŒºï¼Œæ’é˜ŸåŒºéƒ½æ»¡"></p><blockquote><ol><li><p>æˆ‘ä»¬é“¶è¡Œç³»ç»Ÿå·²ç»ç˜«ç—ª</p></li><li><p>è°å«ä½ æ¥åŠçš„ä½ æ‰¾è°å»</p></li><li><p>çœ‹ä½ æ¯”è¾ƒæ€¥ï¼Œå»é˜Ÿé‡ŒåŠ ä¸ªå¡</p></li><li><p>ä»Šå¤©æ²¡åŠæ³•ï¼Œä¸è¡Œä½ çœ‹æ”¹ä¸€å¤©</p></li></ol></blockquote><p>ä¸Šé¢çš„è¿™ä¸ªæµç¨‹å‡ ä¹å°±è·Ÿ JDK çº¿ç¨‹æ± çš„å¤§è‡´æµç¨‹ç±»ä¼¼ï¼Œ</p><blockquote><ol><li>è¥ä¸šä¸­çš„ 3ä¸ªçª—å£å¯¹åº”æ ¸å¿ƒçº¿ç¨‹æ± æ•°ï¼šcorePoolSize</li><li>æ€»çš„è¥ä¸šçª—å£æ•°6å¯¹åº”ï¼šmaximumPoolSize</li><li>æ‰“å¼€çš„ä¸´æ—¶çª—å£åœ¨å¤šå°‘æ—¶é—´å†…æ— äººåŠç†åˆ™å…³é—­å¯¹åº”ï¼šunit</li><li>æ’é˜ŸåŒºå°±æ˜¯ç­‰å¾…é˜Ÿåˆ—ï¼šworkQueue</li><li>æ— æ³•åŠç†çš„æ—¶å€™é“¶è¡Œç»™å‡ºçš„è§£å†³æ–¹æ³•å¯¹åº”ï¼šRejectedExecutionHandler</li><li>threadFactory è¯¥å‚æ•°åœ¨ JDK ä¸­æ˜¯ çº¿ç¨‹å·¥å‚ï¼Œç”¨æ¥åˆ›å»ºçº¿ç¨‹å¯¹è±¡ï¼Œä¸€èˆ¬ä¸ä¼šåŠ¨ã€‚</li></ol></blockquote><p>æ‰€ä»¥æˆ‘ä»¬çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹ä¹Ÿæ¯”è¾ƒå¥½ç†è§£äº†ï¼š</p><ol><li>çº¿ç¨‹æ± åˆšåˆ›å»ºæ—¶ï¼Œé‡Œé¢æ²¡æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚ä»»åŠ¡é˜Ÿåˆ—æ˜¯ä½œä¸ºå‚æ•°ä¼ è¿›æ¥çš„ã€‚ä¸è¿‡ï¼Œå°±ç®—é˜Ÿåˆ—é‡Œé¢æœ‰ä»»åŠ¡ï¼Œçº¿ç¨‹æ± ä¹Ÿä¸ä¼šé©¬ä¸Šæ‰§è¡Œå®ƒä»¬ã€‚</li><li>å½“è°ƒç”¨ execute() æ–¹æ³•æ·»åŠ ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåšå¦‚ä¸‹åˆ¤æ–­ï¼š</li></ol><ul><li>å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å°äº corePoolSizeï¼Œé‚£ä¹ˆé©¬ä¸Šåˆ›å»ºçº¿ç¨‹è¿è¡Œè¿™ä¸ªä»»åŠ¡ï¼›</li><li>å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äº corePoolSizeï¼Œé‚£ä¹ˆå°†è¿™ä¸ªä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼›</li><li>å¦‚æœè¿™æ—¶å€™é˜Ÿåˆ—æ»¡äº†ï¼Œè€Œä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å°äº maximumPoolSizeï¼Œé‚£ä¹ˆè¿˜æ˜¯è¦åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ç«‹åˆ»è¿è¡Œè¿™ä¸ªä»»åŠ¡ï¼›</li><li>å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œè€Œä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äº maximumPoolSizeï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šæ ¹æ®æ‹’ç»ç­–ç•¥æ¥å¯¹åº”å¤„ç†ã€‚</li></ul><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-66.png" alt="çº¿ç¨‹æ± æ‰§è¡Œæµç¨‹"></p><ol start="3"><li><p>å½“ä¸€ä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡æ—¶ï¼Œå®ƒä¼šä»é˜Ÿåˆ—ä¸­å–ä¸‹ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œã€‚</p></li><li><p>å½“ä¸€ä¸ªçº¿ç¨‹æ— äº‹å¯åšï¼Œè¶…è¿‡ä¸€å®šçš„æ—¶é—´ï¼ˆkeepAliveTimeï¼‰æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ¤æ–­ï¼Œå¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å¤§äº corePoolSizeï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±è¢«åœæ‰ã€‚æ‰€ä»¥çº¿ç¨‹æ± çš„æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼Œå®ƒæœ€ç»ˆä¼šæ”¶ç¼©åˆ° corePoolSize çš„å¤§å°ã€‚</p></li></ol><h3 id="_47-çº¿ç¨‹æ± ä¸»è¦å‚æ•°æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#_47-çº¿ç¨‹æ± ä¸»è¦å‚æ•°æœ‰å“ªäº›" aria-hidden="true">#</a> 47.çº¿ç¨‹æ± ä¸»è¦å‚æ•°æœ‰å“ªäº›ï¼Ÿ</h3><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-67.png" alt="çº¿ç¨‹æ± å‚æ•°"></p><p>çº¿ç¨‹æ± æœ‰ä¸ƒå¤§å‚æ•°ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨<code>corePoolSize</code>ã€<code>maximumPoolSize</code>ã€<code>workQueue</code>ã€<code>handler</code>è¿™å››ä¸ªã€‚</p><ol><li>corePoolSize</li></ol><p>æ­¤å€¼æ˜¯ç”¨æ¥åˆå§‹åŒ–çº¿ç¨‹æ± ä¸­æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå½“çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ± æ•°&lt; <code>corePoolSize</code>æ—¶ï¼Œç³»ç»Ÿé»˜è®¤æ˜¯æ·»åŠ ä¸€ä¸ªä»»åŠ¡æ‰åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ã€‚å½“çº¿ç¨‹æ•° = corePoolSizeæ—¶ï¼Œæ–°ä»»åŠ¡ä¼šè¿½åŠ åˆ°workQueueä¸­ã€‚</p><ol start="2"><li>maximumPoolSize</li></ol><p><code>maximumPoolSize</code>è¡¨ç¤ºå…è®¸çš„æœ€å¤§çº¿ç¨‹æ•° = (éæ ¸å¿ƒçº¿ç¨‹æ•°+æ ¸å¿ƒçº¿ç¨‹æ•°)ï¼Œå½“<code>BlockingQueue</code>ä¹Ÿæ»¡äº†ï¼Œä½†çº¿ç¨‹æ± ä¸­æ€»çº¿ç¨‹æ•° &lt; <code>maximumPoolSize</code>æ—¶å€™å°±ä¼šå†æ¬¡åˆ›å»ºæ–°çš„çº¿ç¨‹ã€‚</p><ol start="3"><li>keepAliveTime</li></ol><p>éæ ¸å¿ƒçº¿ç¨‹ =(maximumPoolSize - corePoolSize ) ,éæ ¸å¿ƒçº¿ç¨‹é—²ç½®ä¸‹æ¥ä¸å¹²æ´»æœ€å¤šå­˜æ´»æ—¶é—´ã€‚</p><ol start="4"><li>unit</li></ol><p>çº¿ç¨‹æ± ä¸­éæ ¸å¿ƒçº¿ç¨‹ä¿æŒå­˜æ´»çš„æ—¶é—´çš„å•ä½</p><ul><li>TimeUnit.DAYS; å¤©</li><li>TimeUnit.HOURS; å°æ—¶</li><li>TimeUnit.MINUTES; åˆ†é’Ÿ</li><li>TimeUnit.SECONDS; ç§’</li><li>TimeUnit.MILLISECONDS; æ¯«ç§’</li><li>TimeUnit.MICROSECONDS; å¾®ç§’</li><li>TimeUnit.NANOSECONDS; çº³ç§’</li></ul><ol start="5"><li>workQueue</li></ol><p>çº¿ç¨‹æ± ç­‰å¾…é˜Ÿåˆ—ï¼Œç»´æŠ¤ç€ç­‰å¾…æ‰§è¡Œçš„<code>Runnable</code>å¯¹è±¡ã€‚å½“è¿è¡Œå½“çº¿ç¨‹æ•°= corePoolSizeæ—¶ï¼Œæ–°çš„ä»»åŠ¡ä¼šè¢«æ·»åŠ åˆ°<code>workQueue</code>ä¸­ï¼Œå¦‚æœ<code>workQueue</code>ä¹Ÿæ»¡äº†åˆ™å°è¯•ç”¨éæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œç­‰å¾…é˜Ÿåˆ—åº”è¯¥å°½é‡ç”¨æœ‰ç•Œçš„ã€‚</p><ol start="6"><li>threadFactory</li></ol><p>åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ—¶ä½¿ç”¨çš„å·¥å‚ï¼Œå¯ä»¥ç”¨æ¥è®¾å®šçº¿ç¨‹åã€æ˜¯å¦ä¸ºdaemonçº¿ç¨‹ç­‰ç­‰ã€‚</p><ol start="7"><li>handler</li></ol><p><code>corePoolSize</code>ã€<code>workQueue</code>ã€<code>maximumPoolSize</code>éƒ½ä¸å¯ç”¨çš„æ—¶å€™æ‰§è¡Œçš„é¥±å’Œç­–ç•¥ã€‚</p><h3 id="_48-çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#_48-çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›" aria-hidden="true">#</a> 48.çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</h3><p>ç±»æ¯”å‰é¢çš„ä¾‹å­ï¼Œæ— æ³•åŠç†ä¸šåŠ¡æ—¶çš„å¤„ç†æ–¹å¼ï¼Œå¸®åŠ©è®°å¿†ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-68.png" alt="å››ç§ç­–ç•¥"></p><ul><li>AbortPolicy ï¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œé»˜è®¤ä½¿ç”¨æ­¤ç­–ç•¥</li><li>CallerRunsPolicyï¼šç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡</li><li>DiscardOldestPolicyï¼šä¸¢å¼ƒé˜»å¡é˜Ÿåˆ—é‡Œæœ€è€çš„ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯é˜Ÿåˆ—é‡Œé å‰çš„ä»»åŠ¡</li><li>DiscardPolicy ï¼šå½“å‰ä»»åŠ¡ç›´æ¥ä¸¢å¼ƒ</li></ul><p>æƒ³å®ç°è‡ªå·±çš„æ‹’ç»ç­–ç•¥ï¼Œå®ç°RejectedExecutionHandleræ¥å£å³å¯ã€‚</p><h3 id="_49-çº¿ç¨‹æ± æœ‰å“ªå‡ ç§å·¥ä½œé˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#_49-çº¿ç¨‹æ± æœ‰å“ªå‡ ç§å·¥ä½œé˜Ÿåˆ—" aria-hidden="true">#</a> 49.çº¿ç¨‹æ± æœ‰å“ªå‡ ç§å·¥ä½œé˜Ÿåˆ—ï¼Ÿ</h3><p>å¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-69.png" alt="çº¿ç¨‹æ± å¸¸ç”¨é˜»å¡é˜Ÿåˆ—"></p><ul><li>ArrayBlockingQueueï¼šArrayBlockingQueueï¼ˆæœ‰ç•Œé˜Ÿåˆ—ï¼‰æ˜¯ä¸€ä¸ªç”¨æ•°ç»„å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‰FIFOæ’åºé‡ã€‚</li><li>LinkedBlockingQueueï¼šLinkedBlockingQueueï¼ˆå¯è®¾ç½®å®¹é‡é˜Ÿåˆ—ï¼‰æ˜¯åŸºäºé“¾è¡¨ç»“æ„çš„é˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‰FIFOæ’åºä»»åŠ¡ï¼Œå®¹é‡å¯ä»¥é€‰æ‹©è¿›è¡Œè®¾ç½®ï¼Œä¸è®¾ç½®çš„è¯ï¼Œå°†æ˜¯ä¸€ä¸ªæ— è¾¹ç•Œçš„é˜»å¡é˜Ÿåˆ—ï¼Œæœ€å¤§é•¿åº¦ä¸ºInteger.MAX_VALUEï¼Œååé‡é€šå¸¸è¦é«˜äºArrayBlockingQueneï¼›newFixedThreadPoolçº¿ç¨‹æ± ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—</li><li>DelayQueueï¼šDelayQueueï¼ˆå»¶è¿Ÿé˜Ÿåˆ—ï¼‰æ˜¯ä¸€ä¸ªä»»åŠ¡å®šæ—¶å‘¨æœŸçš„å»¶è¿Ÿæ‰§è¡Œçš„é˜Ÿåˆ—ã€‚æ ¹æ®æŒ‡å®šçš„æ‰§è¡Œæ—¶é—´ä»å°åˆ°å¤§æ’åºï¼Œå¦åˆ™æ ¹æ®æ’å…¥åˆ°é˜Ÿåˆ—çš„å…ˆåæ’åºã€‚newScheduledThreadPoolçº¿ç¨‹æ± ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ã€‚</li><li>PriorityBlockingQueueï¼šPriorityBlockingQueueï¼ˆä¼˜å…ˆçº§é˜Ÿåˆ—ï¼‰æ˜¯å…·æœ‰ä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—</li><li>SynchronousQueueï¼šSynchronousQueueï¼ˆåŒæ­¥é˜Ÿåˆ—ï¼‰æ˜¯ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ç§»é™¤æ“ä½œï¼Œå¦åˆ™æ’å…¥æ“ä½œä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œååé‡é€šå¸¸è¦é«˜äºLinkedBlockingQueneï¼ŒnewCachedThreadPoolçº¿ç¨‹æ± ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ã€‚</li></ul><h3 id="_50-çº¿ç¨‹æ± æäº¤executeå’Œsubmitæœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_50-çº¿ç¨‹æ± æäº¤executeå’Œsubmitæœ‰ä»€ä¹ˆåŒºåˆ«" aria-hidden="true">#</a> 50.çº¿ç¨‹æ± æäº¤executeå’Œsubmitæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><ol><li>execute ç”¨äºæäº¤ä¸éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>threadsPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token comment">// TODO Auto-generated method stub } </span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>submit()æ–¹æ³•ç”¨äºæäº¤éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡ã€‚çº¿ç¨‹æ± ä¼šè¿”å›ä¸€ä¸ªfutureç±»å‹çš„å¯¹è±¡ï¼Œé€šè¿‡è¿™ä¸ª futureå¯¹è±¡å¯ä»¥åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡futureçš„get()æ–¹æ³•æ¥è·å–è¿”å›å€¼</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> executor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>harReturnValuetask<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">Object</span> s <span class="token operator">=</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token comment">// å¤„ç†ä¸­æ–­å¼‚å¸¸ </span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ExecutionException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token comment">// å¤„ç†æ— æ³•æ‰§è¡Œä»»åŠ¡å¼‚å¸¸ </span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span> 
    <span class="token comment">// å…³é—­çº¿ç¨‹æ±  executor.shutdown();</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_51-çº¿ç¨‹æ± æ€ä¹ˆå…³é—­çŸ¥é“å—" tabindex="-1"><a class="header-anchor" href="#_51-çº¿ç¨‹æ± æ€ä¹ˆå…³é—­çŸ¥é“å—" aria-hidden="true">#</a> 51.çº¿ç¨‹æ± æ€ä¹ˆå…³é—­çŸ¥é“å—ï¼Ÿ</h3><p>å¯ä»¥é€šè¿‡è°ƒç”¨çº¿ç¨‹æ± çš„<code>shutdown</code>æˆ–<code>shutdownNow</code>æ–¹æ³•æ¥å…³é—­çº¿ç¨‹æ± ã€‚å®ƒä»¬çš„åŸç†æ˜¯éå†çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹ï¼Œç„¶åé€ä¸ªè°ƒç”¨çº¿ç¨‹çš„interruptæ–¹æ³•æ¥ä¸­æ–­çº¿ç¨‹ï¼Œæ‰€ä»¥æ— æ³•å“åº”ä¸­æ–­çš„ä»»åŠ¡å¯èƒ½æ°¸è¿œæ— æ³•ç»ˆæ­¢ã€‚</p><p><strong>shutdown() å°†çº¿ç¨‹æ± çŠ¶æ€ç½®ä¸ºshutdown,å¹¶ä¸ä¼šç«‹å³åœæ­¢</strong>ï¼š</p><ol><li>åœæ­¢æ¥æ”¶å¤–éƒ¨submitçš„ä»»åŠ¡</li><li>å†…éƒ¨æ­£åœ¨è·‘çš„ä»»åŠ¡å’Œé˜Ÿåˆ—é‡Œç­‰å¾…çš„ä»»åŠ¡ï¼Œä¼šæ‰§è¡Œå®Œ</li><li>ç­‰åˆ°ç¬¬äºŒæ­¥å®Œæˆåï¼Œæ‰çœŸæ­£åœæ­¢</li></ol><p><strong>shutdownNow() å°†çº¿ç¨‹æ± çŠ¶æ€ç½®ä¸ºstopã€‚ä¸€èˆ¬ä¼šç«‹å³åœæ­¢ï¼Œäº‹å®ä¸Šä¸ä¸€å®š</strong>ï¼š</p><ol><li>å’Œshutdown()ä¸€æ ·ï¼Œå…ˆåœæ­¢æ¥æ”¶å¤–éƒ¨æäº¤çš„ä»»åŠ¡</li><li>å¿½ç•¥é˜Ÿåˆ—é‡Œç­‰å¾…çš„ä»»åŠ¡</li><li>å°è¯•å°†æ­£åœ¨è·‘çš„ä»»åŠ¡interruptä¸­æ–­</li><li>è¿”å›æœªæ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨</li></ol><p>shutdown å’Œshutdownnowç®€å•æ¥è¯´åŒºåˆ«å¦‚ä¸‹ï¼š</p><ul><li>shutdownNow()èƒ½ç«‹å³åœæ­¢çº¿ç¨‹æ± ï¼Œæ­£åœ¨è·‘çš„å’Œæ­£åœ¨ç­‰å¾…çš„ä»»åŠ¡éƒ½åœä¸‹äº†ã€‚è¿™æ ·åšç«‹å³ç”Ÿæ•ˆï¼Œä½†æ˜¯é£é™©ä¹Ÿæ¯”è¾ƒå¤§ã€‚</li><li>shutdown()åªæ˜¯å…³é—­äº†æäº¤é€šé“ï¼Œç”¨submit()æ˜¯æ— æ•ˆçš„ï¼›è€Œå†…éƒ¨çš„ä»»åŠ¡è¯¥æ€ä¹ˆè·‘è¿˜æ˜¯æ€ä¹ˆè·‘ï¼Œè·‘å®Œå†å½»åº•åœæ­¢çº¿ç¨‹æ± ã€‚</li></ul><h3 id="_52-çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°åº”è¯¥æ€ä¹ˆé…ç½®" tabindex="-1"><a class="header-anchor" href="#_52-çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°åº”è¯¥æ€ä¹ˆé…ç½®" aria-hidden="true">#</a> 52.çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°åº”è¯¥æ€ä¹ˆé…ç½®ï¼Ÿ</h3><p>çº¿ç¨‹åœ¨Javaä¸­å±äºç¨€ç¼ºèµ„æºï¼Œçº¿ç¨‹æ± ä¸æ˜¯è¶Šå¤§è¶Šå¥½ä¹Ÿä¸æ˜¯è¶Šå°è¶Šå¥½ã€‚ä»»åŠ¡åˆ†ä¸ºè®¡ç®—å¯†é›†å‹ã€IOå¯†é›†å‹ã€æ··åˆå‹ã€‚</p><ol><li>è®¡ç®—å¯†é›†å‹ï¼šå¤§éƒ¨åˆ†éƒ½åœ¨ç”¨CPUè·Ÿå†…å­˜ï¼ŒåŠ å¯†ï¼Œé€»è¾‘æ“ä½œä¸šåŠ¡å¤„ç†ç­‰ã€‚</li><li>IOå¯†é›†å‹ï¼šæ•°æ®åº“é“¾æ¥ï¼Œç½‘ç»œé€šè®¯ä¼ è¾“ç­‰ã€‚</li></ol><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-70.png" alt="å¸¸è§çº¿ç¨‹æ± å‚æ•°é…ç½®æ–¹æ¡ˆ-æ¥æºç¾å›¢æŠ€æœ¯åšå®¢"></p><p>ä¸€èˆ¬çš„ç»éªŒï¼Œä¸åŒç±»å‹çº¿ç¨‹æ± çš„å‚æ•°é…ç½®ï¼š</p><ol><li>è®¡ç®—å¯†é›†å‹ä¸€èˆ¬æ¨èçº¿ç¨‹æ± ä¸è¦è¿‡å¤§ï¼Œä¸€èˆ¬æ˜¯CPUæ•° + 1ï¼Œ+1æ˜¯å› ä¸ºå¯èƒ½å­˜åœ¨<strong>é¡µç¼ºå¤±</strong>(å°±æ˜¯å¯èƒ½å­˜åœ¨æœ‰äº›æ•°æ®åœ¨ç¡¬ç›˜ä¸­éœ€è¦å¤šæ¥ä¸€ä¸ªçº¿ç¨‹å°†æ•°æ®è¯»å…¥å†…å­˜)ã€‚å¦‚æœçº¿ç¨‹æ± æ•°å¤ªå¤§ï¼Œå¯èƒ½ä¼šé¢‘ç¹çš„ è¿›è¡Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢è·Ÿä»»åŠ¡è°ƒåº¦ã€‚è·å¾—å½“å‰CPUæ ¸å¿ƒæ•°ä»£ç å¦‚ä¸‹ï¼š</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">availableProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>IOå¯†é›†å‹ï¼šçº¿ç¨‹æ•°é€‚å½“å¤§ä¸€ç‚¹ï¼Œæœºå™¨çš„Cpuæ ¸å¿ƒæ•°*2ã€‚</li><li>æ··åˆå‹ï¼šå¯ä»¥è€ƒè™‘æ ¹ç»æƒ…å†µå°†å®ƒæ‹†åˆ†æˆCPUå¯†é›†å‹å’ŒIOå¯†é›†å‹ä»»åŠ¡ï¼Œå¦‚æœæ‰§è¡Œæ—¶é—´ç›¸å·®ä¸å¤§ï¼Œæ‹†åˆ†å¯ä»¥æå‡ååé‡ï¼Œåä¹‹æ²¡æœ‰å¿…è¦ã€‚</li></ol><p>å½“ç„¶ï¼Œå®é™…åº”ç”¨ä¸­æ²¡æœ‰å›ºå®šçš„å…¬å¼ï¼Œéœ€è¦ç»“åˆæµ‹è¯•å’Œç›‘æ§æ¥è¿›è¡Œè°ƒæ•´ã€‚</p><h3 id="_53-æœ‰å“ªå‡ ç§å¸¸è§çš„çº¿ç¨‹æ± " tabindex="-1"><a class="header-anchor" href="#_53-æœ‰å“ªå‡ ç§å¸¸è§çš„çº¿ç¨‹æ± " aria-hidden="true">#</a> 53.æœ‰å“ªå‡ ç§å¸¸è§çš„çº¿ç¨‹æ± ï¼Ÿ</h3><p>é¢è¯•å¸¸é—®ï¼Œä¸»è¦æœ‰å››ç§ï¼Œéƒ½æ˜¯é€šè¿‡å·¥å…·ç±»Excutorsåˆ›å»ºå‡ºæ¥çš„ï¼Œéœ€è¦æ³¨æ„ï¼Œé˜¿é‡Œå·´å·´ã€ŠJavaå¼€å‘æ‰‹å†Œã€‹é‡Œç¦æ­¢ä½¿ç”¨è¿™ç§æ–¹å¼æ¥åˆ›å»ºçº¿ç¨‹æ± ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-71.png" alt="å››å¤§çº¿ç¨‹æ± "></p><ul><li><p>newFixedThreadPool (å›ºå®šæ•°ç›®çº¿ç¨‹çš„çº¿ç¨‹æ± )</p></li><li><p>newCachedThreadPool (å¯ç¼“å­˜çº¿ç¨‹çš„çº¿ç¨‹æ± )</p></li><li><p>newSingleThreadExecutor (å•çº¿ç¨‹çš„çº¿ç¨‹æ± )</p></li><li><p>newScheduledThreadPool (å®šæ—¶åŠå‘¨æœŸæ‰§è¡Œçš„çº¿ç¨‹æ± )</p></li></ul><h3 id="_54-èƒ½è¯´ä¸€ä¸‹å››ç§å¸¸è§çº¿ç¨‹æ± çš„åŸç†å—" tabindex="-1"><a class="header-anchor" href="#_54-èƒ½è¯´ä¸€ä¸‹å››ç§å¸¸è§çº¿ç¨‹æ± çš„åŸç†å—" aria-hidden="true">#</a> 54.èƒ½è¯´ä¸€ä¸‹å››ç§å¸¸è§çº¿ç¨‹æ± çš„åŸç†å—ï¼Ÿ</h3><p>å‰ä¸‰ç§çº¿ç¨‹æ± çš„æ„é€ ç›´æ¥è°ƒç”¨ThreadPoolExecutorçš„æ„é€ æ–¹æ³•ã€‚</p><h4 id="newsinglethreadexecutor" tabindex="-1"><a class="header-anchor" href="#newsinglethreadexecutor" aria-hidden="true">#</a> newSingleThreadExecutor</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> <span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token class-name">ThreadFactory</span> threadFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FinalizableDelegatedExecutorService</span>
        <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
                                <span class="token number">0L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">,</span>
                                <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                threadFactory<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>çº¿ç¨‹æ± ç‰¹ç‚¹</strong></p><ul><li>æ ¸å¿ƒçº¿ç¨‹æ•°ä¸º1</li><li>æœ€å¤§çº¿ç¨‹æ•°ä¹Ÿä¸º1</li><li>é˜»å¡é˜Ÿåˆ—æ˜¯æ— ç•Œé˜Ÿåˆ—LinkedBlockingQueueï¼Œå¯èƒ½ä¼šå¯¼è‡´OOM</li><li>keepAliveTimeä¸º0</li></ul><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-72.png" alt="SingleThreadExecutorè¿è¡Œæµç¨‹"></p><p>å·¥ä½œæµç¨‹ï¼š</p><ul><li>æäº¤ä»»åŠ¡</li><li>çº¿ç¨‹æ± æ˜¯å¦æœ‰ä¸€æ¡çº¿ç¨‹åœ¨ï¼Œå¦‚æœæ²¡æœ‰ï¼Œæ–°å»ºçº¿ç¨‹æ‰§è¡Œä»»åŠ¡</li><li>å¦‚æœæœ‰ï¼Œå°†ä»»åŠ¡åŠ åˆ°é˜»å¡é˜Ÿåˆ—</li><li>å½“å‰çš„å”¯ä¸€çº¿ç¨‹ï¼Œä»é˜Ÿåˆ—å–ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œä¸€ä¸ªï¼Œå†ç»§ç»­å–ï¼Œä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚</li></ul><p><strong>é€‚ç”¨åœºæ™¯</strong></p><p>é€‚ç”¨äºä¸²è¡Œæ‰§è¡Œä»»åŠ¡çš„åœºæ™¯ï¼Œä¸€ä¸ªä»»åŠ¡ä¸€ä¸ªä»»åŠ¡åœ°æ‰§è¡Œã€‚</p><h4 id="newfixedthreadpool" tabindex="-1"><a class="header-anchor" href="#newfixedthreadpool" aria-hidden="true">#</a> newFixedThreadPool</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> <span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token keyword">int</span> nThreads<span class="token punctuation">,</span> <span class="token class-name">ThreadFactory</span> threadFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>nThreads<span class="token punctuation">,</span> nThreads<span class="token punctuation">,</span>
                                  <span class="token number">0L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">,</span>
                                  <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                  threadFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>çº¿ç¨‹æ± ç‰¹ç‚¹ï¼š</strong></p><ul><li>æ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°å¤§å°ä¸€æ ·</li><li>æ²¡æœ‰æ‰€è°“çš„éç©ºé—²æ—¶é—´ï¼Œå³keepAliveTimeä¸º0</li><li>é˜»å¡é˜Ÿåˆ—ä¸ºæ— ç•Œé˜Ÿåˆ—LinkedBlockingQueueï¼Œå¯èƒ½ä¼šå¯¼è‡´OOM</li></ul><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-73.png" alt="FixedThreadPool"></p><p>å·¥ä½œæµç¨‹ï¼š</p><ul><li>æäº¤ä»»åŠ¡</li><li>å¦‚æœçº¿ç¨‹æ•°å°‘äºæ ¸å¿ƒçº¿ç¨‹ï¼Œåˆ›å»ºæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œä»»åŠ¡</li><li>å¦‚æœçº¿ç¨‹æ•°ç­‰äºæ ¸å¿ƒçº¿ç¨‹ï¼ŒæŠŠä»»åŠ¡æ·»åŠ åˆ°LinkedBlockingQueueé˜»å¡é˜Ÿåˆ—</li><li>å¦‚æœçº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡ï¼Œå»é˜»å¡é˜Ÿåˆ—å–ä»»åŠ¡ï¼Œç»§ç»­æ‰§è¡Œã€‚</li></ul><p><strong>ä½¿ç”¨åœºæ™¯</strong></p><p>FixedThreadPool é€‚ç”¨äºå¤„ç†CPUå¯†é›†å‹çš„ä»»åŠ¡ï¼Œç¡®ä¿CPUåœ¨é•¿æœŸè¢«å·¥ä½œçº¿ç¨‹ä½¿ç”¨çš„æƒ…å†µä¸‹ï¼Œå°½å¯èƒ½çš„å°‘çš„åˆ†é…çº¿ç¨‹ï¼Œå³é€‚ç”¨æ‰§è¡Œé•¿æœŸçš„ä»»åŠ¡ã€‚</p><h4 id="newcachedthreadpool" tabindex="-1"><a class="header-anchor" href="#newcachedthreadpool" aria-hidden="true">#</a> newCachedThreadPool</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> <span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token class-name">ThreadFactory</span> threadFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">,</span>
                                  <span class="token number">60L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span>
                                  <span class="token keyword">new</span> <span class="token class-name">SynchronousQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                  threadFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>çº¿ç¨‹æ± ç‰¹ç‚¹ï¼š</strong></p><ul><li>æ ¸å¿ƒçº¿ç¨‹æ•°ä¸º0</li><li>æœ€å¤§çº¿ç¨‹æ•°ä¸ºInteger.MAX_VALUEï¼Œå³æ— é™å¤§ï¼Œå¯èƒ½ä¼šå› ä¸ºæ— é™åˆ›å»ºçº¿ç¨‹ï¼Œå¯¼è‡´OOM</li><li>é˜»å¡é˜Ÿåˆ—æ˜¯SynchronousQueue</li><li>éæ ¸å¿ƒçº¿ç¨‹ç©ºé—²å­˜æ´»æ—¶é—´ä¸º60ç§’</li></ul><p>å½“æäº¤ä»»åŠ¡çš„é€Ÿåº¦å¤§äºå¤„ç†ä»»åŠ¡çš„é€Ÿåº¦æ—¶ï¼Œæ¯æ¬¡æäº¤ä¸€ä¸ªä»»åŠ¡ï¼Œå°±å¿…ç„¶ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ã€‚æç«¯æƒ…å†µä¸‹ä¼šåˆ›å»ºè¿‡å¤šçš„çº¿ç¨‹ï¼Œè€—å°½ CPU å’Œå†…å­˜èµ„æºã€‚ç”±äºç©ºé—² 60 ç§’çš„çº¿ç¨‹ä¼šè¢«ç»ˆæ­¢ï¼Œé•¿æ—¶é—´ä¿æŒç©ºé—²çš„ CachedThreadPool ä¸ä¼šå ç”¨ä»»ä½•èµ„æºã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-74.png" alt="CachedThreadPoolæ‰§è¡Œæµç¨‹"></p><p>å·¥ä½œæµç¨‹ï¼š</p><ul><li>æäº¤ä»»åŠ¡</li><li>å› ä¸ºæ²¡æœ‰æ ¸å¿ƒçº¿ç¨‹ï¼Œæ‰€ä»¥ä»»åŠ¡ç›´æ¥åŠ åˆ°SynchronousQueueé˜Ÿåˆ—ã€‚</li><li>åˆ¤æ–­æ˜¯å¦æœ‰ç©ºé—²çº¿ç¨‹ï¼Œå¦‚æœæœ‰ï¼Œå°±å»å–å‡ºä»»åŠ¡æ‰§è¡Œã€‚</li><li>å¦‚æœæ²¡æœ‰ç©ºé—²çº¿ç¨‹ï¼Œå°±æ–°å»ºä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚</li><li>æ‰§è¡Œå®Œä»»åŠ¡çš„çº¿ç¨‹ï¼Œè¿˜å¯ä»¥å­˜æ´»60ç§’ï¼Œå¦‚æœåœ¨è¿™æœŸé—´ï¼Œæ¥åˆ°ä»»åŠ¡ï¼Œå¯ä»¥ç»§ç»­æ´»ä¸‹å»ï¼›å¦åˆ™ï¼Œè¢«é”€æ¯ã€‚</li></ul><p><strong>é€‚ç”¨åœºæ™¯</strong></p><p>ç”¨äºå¹¶å‘æ‰§è¡Œå¤§é‡çŸ­æœŸçš„å°ä»»åŠ¡ã€‚</p><h4 id="newscheduledthreadpool" tabindex="-1"><a class="header-anchor" href="#newscheduledthreadpool" aria-hidden="true">#</a> newScheduledThreadPool</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ScheduledThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>corePoolSize<span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> NANOSECONDS<span class="token punctuation">,</span>
          <span class="token keyword">new</span> <span class="token class-name">DelayedWorkQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>çº¿ç¨‹æ± ç‰¹ç‚¹</strong></p><ul><li>æœ€å¤§çº¿ç¨‹æ•°ä¸ºInteger.MAX_VALUEï¼Œä¹Ÿæœ‰OOMçš„é£é™©</li><li>é˜»å¡é˜Ÿåˆ—æ˜¯DelayedWorkQueue</li><li>keepAliveTimeä¸º0</li><li>scheduleAtFixedRate() ï¼šæŒ‰æŸç§é€Ÿç‡å‘¨æœŸæ‰§è¡Œ</li><li>scheduleWithFixedDelay()ï¼šåœ¨æŸä¸ªå»¶è¿Ÿåæ‰§è¡Œ</li></ul><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-75.png" alt="ScheduledThreadPoolæ‰§è¡Œæµç¨‹"></p><p><strong>å·¥ä½œæœºåˆ¶</strong></p><ul><li>çº¿ç¨‹ä»DelayQueueä¸­è·å–å·²åˆ°æœŸçš„ScheduledFutureTaskï¼ˆDelayQueue.take()ï¼‰ã€‚åˆ°æœŸä»»åŠ¡æ˜¯æŒ‡ScheduledFutureTaskçš„timeå¤§äºç­‰äºå½“å‰æ—¶é—´ã€‚</li><li>çº¿ç¨‹æ‰§è¡Œè¿™ä¸ªScheduledFutureTaskã€‚</li><li>çº¿ç¨‹ä¿®æ”¹ScheduledFutureTaskçš„timeå˜é‡ä¸ºä¸‹æ¬¡å°†è¦è¢«æ‰§è¡Œçš„æ—¶é—´ã€‚</li><li>çº¿ç¨‹æŠŠè¿™ä¸ªä¿®æ”¹timeä¹‹åçš„ScheduledFutureTaskæ”¾å›DelayQueueä¸­ï¼ˆDelayQueue.add()ï¼‰ã€‚</li></ul><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-76.png" alt="ScheduledThreadPoolExecutoræ‰§è¡Œæµç¨‹"></p><p><strong>ä½¿ç”¨åœºæ™¯</strong></p><p>å‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡çš„åœºæ™¯ï¼Œéœ€è¦é™åˆ¶çº¿ç¨‹æ•°é‡çš„åœºæ™¯</p><blockquote><p>ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—çš„çº¿ç¨‹æ± ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ</p></blockquote><p>ä¾‹å¦‚newFixedThreadPoolä½¿ç”¨äº†æ— ç•Œçš„é˜»å¡é˜Ÿåˆ—LinkedBlockingQueueï¼Œå¦‚æœçº¿ç¨‹è·å–ä¸€ä¸ªä»»åŠ¡åï¼Œä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´æ¯”è¾ƒé•¿ï¼Œä¼šå¯¼è‡´é˜Ÿåˆ—çš„ä»»åŠ¡è¶Šç§¯è¶Šå¤šï¼Œå¯¼è‡´æœºå™¨å†…å­˜ä½¿ç”¨ä¸åœé£™å‡ï¼Œæœ€ç»ˆå¯¼è‡´OOMã€‚</p><h3 id="_55-çº¿ç¨‹æ± å¼‚å¸¸æ€ä¹ˆå¤„ç†çŸ¥é“å—" tabindex="-1"><a class="header-anchor" href="#_55-çº¿ç¨‹æ± å¼‚å¸¸æ€ä¹ˆå¤„ç†çŸ¥é“å—" aria-hidden="true">#</a> 55.çº¿ç¨‹æ± å¼‚å¸¸æ€ä¹ˆå¤„ç†çŸ¥é“å—ï¼Ÿ</h3><p>åœ¨ä½¿ç”¨çº¿ç¨‹æ± å¤„ç†ä»»åŠ¡çš„æ—¶å€™ï¼Œä»»åŠ¡ä»£ç å¯èƒ½æŠ›å‡ºRuntimeExceptionï¼ŒæŠ›å‡ºå¼‚å¸¸åï¼Œçº¿ç¨‹æ± å¯èƒ½æ•è·å®ƒï¼Œä¹Ÿå¯èƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥ä»£æ›¿å¼‚å¸¸çš„çº¿ç¨‹ï¼Œæˆ‘ä»¬å¯èƒ½æ— æ³•æ„ŸçŸ¥ä»»åŠ¡å‡ºç°äº†å¼‚å¸¸ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è€ƒè™‘çº¿ç¨‹æ± å¼‚å¸¸æƒ…å†µã€‚</p><p>å¸¸è§çš„å¼‚å¸¸å¤„ç†æ–¹å¼ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-77.png" alt="çº¿ç¨‹æ± å¼‚å¸¸å¤„ç†"></p><h3 id="_56-èƒ½è¯´ä¸€ä¸‹çº¿ç¨‹æ± æœ‰å‡ ç§çŠ¶æ€å—" tabindex="-1"><a class="header-anchor" href="#_56-èƒ½è¯´ä¸€ä¸‹çº¿ç¨‹æ± æœ‰å‡ ç§çŠ¶æ€å—" aria-hidden="true">#</a> 56.èƒ½è¯´ä¸€ä¸‹çº¿ç¨‹æ± æœ‰å‡ ç§çŠ¶æ€å—ï¼Ÿ</h3><p>çº¿ç¨‹æ± æœ‰è¿™å‡ ä¸ªçŠ¶æ€ï¼šRUNNING,SHUTDOWN,STOP,TIDYING,TERMINATEDã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//çº¿ç¨‹æ± çŠ¶æ€</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> RUNNING    <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> COUNT_BITS<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> SHUTDOWN   <span class="token operator">=</span>  <span class="token number">0</span> <span class="token operator">&lt;&lt;</span> COUNT_BITS<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STOP       <span class="token operator">=</span>  <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> COUNT_BITS<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> TIDYING    <span class="token operator">=</span>  <span class="token number">2</span> <span class="token operator">&lt;&lt;</span> COUNT_BITS<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> TERMINATED <span class="token operator">=</span>  <span class="token number">3</span> <span class="token operator">&lt;&lt;</span> COUNT_BITS<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>çº¿ç¨‹æ± å„ä¸ªçŠ¶æ€åˆ‡æ¢å›¾ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-78.png" alt="çº¿ç¨‹æ± çŠ¶æ€åˆ‡æ¢å›¾"></p><p><strong>RUNNING</strong></p><ul><li>è¯¥çŠ¶æ€çš„çº¿ç¨‹æ± ä¼šæ¥æ”¶æ–°ä»»åŠ¡ï¼Œå¹¶å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡;</li><li>è°ƒç”¨çº¿ç¨‹æ± çš„shutdown()æ–¹æ³•ï¼Œå¯ä»¥åˆ‡æ¢åˆ°SHUTDOWNçŠ¶æ€;</li><li>è°ƒç”¨çº¿ç¨‹æ± çš„shutdownNow()æ–¹æ³•ï¼Œå¯ä»¥åˆ‡æ¢åˆ°STOPçŠ¶æ€;</li></ul><p><strong>SHUTDOWN</strong></p><ul><li>è¯¥çŠ¶æ€çš„çº¿ç¨‹æ± ä¸ä¼šæ¥æ”¶æ–°ä»»åŠ¡ï¼Œä½†ä¼šå¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼›</li><li>é˜Ÿåˆ—ä¸ºç©ºï¼Œå¹¶ä¸”çº¿ç¨‹æ± ä¸­æ‰§è¡Œçš„ä»»åŠ¡ä¹Ÿä¸ºç©º,è¿›å…¥TIDYINGçŠ¶æ€;</li></ul><p><strong>STOP</strong></p><ul><li>è¯¥çŠ¶æ€çš„çº¿ç¨‹ä¸ä¼šæ¥æ”¶æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸ä¼šå¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œè€Œä¸”ä¼šä¸­æ–­æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ï¼›</li><li>çº¿ç¨‹æ± ä¸­æ‰§è¡Œçš„ä»»åŠ¡ä¸ºç©º,è¿›å…¥TIDYINGçŠ¶æ€;</li></ul><p><strong>TIDYING</strong></p><ul><li>è¯¥çŠ¶æ€è¡¨æ˜æ‰€æœ‰çš„ä»»åŠ¡å·²ç»è¿è¡Œç»ˆæ­¢ï¼Œè®°å½•çš„ä»»åŠ¡æ•°é‡ä¸º0ã€‚</li><li>terminated()æ‰§è¡Œå®Œæ¯•ï¼Œè¿›å…¥TERMINATEDçŠ¶æ€</li></ul><p><strong>TERMINATED</strong></p><ul><li>è¯¥çŠ¶æ€è¡¨ç¤ºçº¿ç¨‹æ± å½»åº•ç»ˆæ­¢</li></ul><h3 id="_57-çº¿ç¨‹æ± å¦‚ä½•å®ç°å‚æ•°çš„åŠ¨æ€ä¿®æ”¹" tabindex="-1"><a class="header-anchor" href="#_57-çº¿ç¨‹æ± å¦‚ä½•å®ç°å‚æ•°çš„åŠ¨æ€ä¿®æ”¹" aria-hidden="true">#</a> 57.çº¿ç¨‹æ± å¦‚ä½•å®ç°å‚æ•°çš„åŠ¨æ€ä¿®æ”¹ï¼Ÿ</h3><p>çº¿ç¨‹æ± æä¾›äº†å‡ ä¸ª setteræ–¹æ³•æ¥è®¾ç½®çº¿ç¨‹æ± çš„å‚æ•°ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-79.png" alt="JDK çº¿ç¨‹æ± å‚æ•°è®¾ç½®æ¥å£æ¥æºå‚è€ƒ[7]"></p><p>è¿™é‡Œä¸»è¦æœ‰ä¸¤ä¸ªæ€è·¯ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-80.png" alt="åŠ¨æ€ä¿®æ”¹çº¿ç¨‹æ± å‚æ•°"></p><ul><li><p>åœ¨æˆ‘ä»¬å¾®æœåŠ¡çš„æ¶æ„ä¸‹ï¼Œå¯ä»¥åˆ©ç”¨é…ç½®ä¸­å¿ƒå¦‚Nacosã€Apolloç­‰ç­‰ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å¼€å‘é…ç½®ä¸­å¿ƒã€‚ä¸šåŠ¡æœåŠ¡è¯»å–çº¿ç¨‹æ± é…ç½®ï¼Œè·å–ç›¸åº”çš„çº¿ç¨‹æ± å®ä¾‹æ¥ä¿®æ”¹çº¿ç¨‹æ± çš„å‚æ•°ã€‚</p></li><li><p>å¦‚æœé™åˆ¶äº†é…ç½®ä¸­å¿ƒçš„ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å»æ‰©å±•<strong>ThreadPoolExecutor</strong>ï¼Œé‡å†™æ–¹æ³•ï¼Œç›‘å¬çº¿ç¨‹æ± å‚æ•°å˜åŒ–ï¼Œæ¥åŠ¨æ€ä¿®æ”¹çº¿ç¨‹æ± å‚æ•°ã€‚</p></li></ul><h3 id="çº¿ç¨‹æ± è°ƒä¼˜äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#çº¿ç¨‹æ± è°ƒä¼˜äº†è§£å—" aria-hidden="true">#</a> çº¿ç¨‹æ± è°ƒä¼˜äº†è§£å—ï¼Ÿ</h3><p>çº¿ç¨‹æ± é…ç½®æ²¡æœ‰å›ºå®šçš„å…¬å¼ï¼Œé€šå¸¸äº‹å‰ä¼šå¯¹çº¿ç¨‹æ± è¿›è¡Œä¸€å®šè¯„ä¼°ï¼Œå¸¸è§çš„è¯„ä¼°æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-81.png" alt="çº¿ç¨‹æ± è¯„ä¼°æ–¹æ¡ˆ æ¥æºå‚è€ƒ[7]"></p><p>ä¸Šçº¿ä¹‹å‰ä¹Ÿè¦è¿›è¡Œå……åˆ†çš„æµ‹è¯•ï¼Œä¸Šçº¿ä¹‹åè¦å»ºç«‹å®Œå–„çš„çº¿ç¨‹æ± ç›‘æ§æœºåˆ¶ã€‚</p><p>äº‹ä¸­ç»“åˆç›‘æ§å‘Šè­¦æœºåˆ¶ï¼Œåˆ†æçº¿ç¨‹æ± çš„é—®é¢˜ï¼Œæˆ–è€…å¯ä¼˜åŒ–ç‚¹ï¼Œç»“åˆçº¿ç¨‹æ± åŠ¨æ€å‚æ•°é…ç½®æœºåˆ¶æ¥è°ƒæ•´é…ç½®ã€‚</p><p>äº‹åè¦æ³¨æ„ä»”ç»†è§‚å¯Ÿï¼Œéšæ—¶è°ƒæ•´ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-82.png" alt="çº¿ç¨‹æ± è°ƒä¼˜"></p><p>å…·ä½“çš„è°ƒä¼˜æ¡ˆä¾‹å¯ä»¥æŸ¥çœ‹å‚è€ƒ[7]ç¾å›¢æŠ€æœ¯åšå®¢ã€‚</p><h3 id="_58-ä½ èƒ½è®¾è®¡å®ç°ä¸€ä¸ªçº¿ç¨‹æ± å—" tabindex="-1"><a class="header-anchor" href="#_58-ä½ èƒ½è®¾è®¡å®ç°ä¸€ä¸ªçº¿ç¨‹æ± å—" aria-hidden="true">#</a> 58.ä½ èƒ½è®¾è®¡å®ç°ä¸€ä¸ªçº¿ç¨‹æ± å—ï¼Ÿ</h3><p>â­è¿™é“é¢˜åœ¨é˜¿é‡Œçš„é¢è¯•ä¸­å‡ºç°é¢‘ç‡æ¯”è¾ƒé«˜</p><p>çº¿ç¨‹æ± å®ç°åŸç†å¯ä»¥æŸ¥çœ‹ <a href="https://mp.weixin.qq.com/s/Exy7pRGND9TCjRd9TZK4jg" target="_blank" rel="noopener noreferrer">è¦æ˜¯ä»¥å‰æœ‰äººè¿™ä¹ˆè®²çº¿ç¨‹æ± ï¼Œæˆ‘æ—©å°±è¯¥æ˜ç™½äº†ï¼<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬è‡ªå·±å®ç°ï¼Œ åªéœ€è¦æŠ“ä½çº¿ç¨‹æ± çš„æ ¸å¿ƒæµç¨‹-å‚è€ƒ[6]ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-83.png" alt="çº¿ç¨‹æ± ä¸»è¦å®ç°æµç¨‹"></p><p>æˆ‘ä»¬è‡ªå·±çš„å®ç°å°±æ˜¯å®Œæˆè¿™ä¸ªæ ¸å¿ƒæµç¨‹ï¼š</p><ul><li>çº¿ç¨‹æ± ä¸­æœ‰Nä¸ªå·¥ä½œçº¿ç¨‹</li><li>æŠŠä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± è¿è¡Œ</li><li>å¦‚æœçº¿ç¨‹æ± å·²æ»¡ï¼ŒæŠŠä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—</li><li>æœ€åå½“æœ‰ç©ºé—²æ—¶ï¼Œè·å–é˜Ÿåˆ—ä¸­ä»»åŠ¡æ¥æ‰§è¡Œ</li></ul><p>å®ç°ä»£ç [6]ï¼š</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-84.png" alt="è‡ªå®šä¹‰çº¿ç¨‹æ± "></p><p>è¿™æ ·ï¼Œä¸€ä¸ªå®ç°äº†çº¿ç¨‹æ± ä¸»è¦æµç¨‹çš„ç±»å°±å®Œæˆäº†ã€‚</p><h3 id="_59-å•æœºçº¿ç¨‹æ± æ‰§è¡Œæ–­ç”µäº†åº”è¯¥æ€ä¹ˆå¤„ç†" tabindex="-1"><a class="header-anchor" href="#_59-å•æœºçº¿ç¨‹æ± æ‰§è¡Œæ–­ç”µäº†åº”è¯¥æ€ä¹ˆå¤„ç†" aria-hidden="true">#</a> 59.å•æœºçº¿ç¨‹æ± æ‰§è¡Œæ–­ç”µäº†åº”è¯¥æ€ä¹ˆå¤„ç†ï¼Ÿ</h3><p><br>æˆ‘ä»¬å¯ä»¥å¯¹æ­£åœ¨å¤„ç†å’Œé˜»å¡é˜Ÿåˆ—çš„ä»»åŠ¡åšäº‹åŠ¡ç®¡ç†æˆ–è€…å¯¹é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æŒä¹…åŒ–å¤„ç†ï¼Œå¹¶ä¸”å½“æ–­ç”µæˆ–è€…ç³»ç»Ÿå´©æºƒï¼Œæ“ä½œæ— æ³•ç»§ç»­ä¸‹å»çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡å›æº¯æ—¥å¿—çš„æ–¹å¼æ¥æ’¤é”€<code>æ­£åœ¨å¤„ç†</code>çš„å·²ç»æ‰§è¡ŒæˆåŠŸçš„æ“ä½œã€‚ç„¶åé‡æ–°æ‰§è¡Œæ•´ä¸ªé˜»å¡é˜Ÿåˆ—ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹é˜»å¡é˜Ÿåˆ—æŒä¹…åŒ–ï¼›æ­£åœ¨å¤„ç†ä»»åŠ¡äº‹åŠ¡æ§åˆ¶ï¼›æ–­ç”µä¹‹åæ­£åœ¨å¤„ç†ä»»åŠ¡çš„å›æ»šï¼Œé€šè¿‡æ—¥å¿—æ¢å¤è¯¥æ¬¡æ“ä½œï¼›æœåŠ¡å™¨é‡å¯åé˜»å¡é˜Ÿåˆ—ä¸­çš„æ•°æ®å†åŠ è½½ã€‚</p><h2 id="å¹¶å‘å®¹å™¨å’Œæ¡†æ¶" tabindex="-1"><a class="header-anchor" href="#å¹¶å‘å®¹å™¨å’Œæ¡†æ¶" aria-hidden="true">#</a> å¹¶å‘å®¹å™¨å’Œæ¡†æ¶</h2><p>å…³äºä¸€äº›å¹¶å‘å®¹å™¨ï¼Œå¯ä»¥å»çœ‹çœ‹ <a href="https://mp.weixin.qq.com/s/SHkQ7LEOT0itt4bXMoDBPw" target="_blank" rel="noopener noreferrer">é¢æ¸£é€†è¢­ï¼šJavaé›†åˆè¿ç¯ä¸‰åé—® <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œé‡Œé¢æœ‰<code>CopyOnWriteList</code>å’Œ<code>ConcurrentHashMap</code>è¿™ä¸¤ç§çº¿ç¨‹å®‰å…¨å®¹å™¨ç±»çš„é—®ç­”ã€‚ã€‚</p><h3 id="_60-fork-joinæ¡†æ¶äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_60-fork-joinæ¡†æ¶äº†è§£å—" aria-hidden="true">#</a> 60.Fork/Joinæ¡†æ¶äº†è§£å—ï¼Ÿ</h3><p>Fork/Joinæ¡†æ¶æ˜¯Java7æä¾›çš„ä¸€ä¸ªç”¨äºå¹¶è¡Œæ‰§è¡Œä»»åŠ¡çš„æ¡†æ¶ï¼Œæ˜¯ä¸€ä¸ªæŠŠå¤§ä»»åŠ¡åˆ†å‰²æˆè‹¥å¹²ä¸ªå°ä»»åŠ¡ï¼Œæœ€ç»ˆæ±‡æ€»æ¯ä¸ªå°ä»»åŠ¡ç»“æœåå¾—åˆ°å¤§ä»»åŠ¡ç»“æœçš„æ¡†æ¶ã€‚</p><p>è¦æƒ³æŒæ¡Fork/Joinæ¡†æ¶ï¼Œé¦–å…ˆéœ€è¦ç†è§£ä¸¤ä¸ªç‚¹ï¼Œ<strong>åˆ†è€Œæ²»ä¹‹</strong>å’Œ<strong>å·¥ä½œçªƒå–ç®—æ³•</strong>ã€‚</p><p><strong>åˆ†è€Œæ²»ä¹‹</strong></p><p>Fork/Joinæ¡†æ¶çš„å®šä¹‰ï¼Œå…¶å®å°±ä½“ç°äº†åˆ†æ²»æ€æƒ³ï¼šå°†ä¸€ä¸ªè§„æ¨¡ä¸ºNçš„é—®é¢˜åˆ†è§£ä¸ºKä¸ªè§„æ¨¡è¾ƒå°çš„å­é—®é¢˜ï¼Œè¿™äº›å­é—®é¢˜ç›¸äº’ç‹¬ç«‹ä¸”ä¸åŸé—®é¢˜æ€§è´¨ç›¸åŒã€‚æ±‚å‡ºå­é—®é¢˜çš„è§£ï¼Œå°±å¯å¾—åˆ°åŸé—®é¢˜çš„è§£ã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-85.png" alt="Fork/Joinåˆ†æ²»ç®—æ³•"></p><p><strong>å·¥ä½œçªƒå–ç®—æ³•</strong></p><p>å¤§ä»»åŠ¡æ‹†æˆäº†è‹¥å¹²ä¸ªå°ä»»åŠ¡ï¼ŒæŠŠè¿™äº›å°ä»»åŠ¡æ”¾åˆ°ä¸åŒçš„é˜Ÿåˆ—é‡Œï¼Œå„è‡ªåˆ›å»ºå•ç‹¬çº¿ç¨‹æ¥æ‰§è¡Œé˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæœ‰çš„çº¿ç¨‹å¹²æ´»å—ï¼Œæœ‰çš„çº¿ç¨‹å¹²æ´»æ…¢ã€‚å¹²å®Œæ´»çš„çº¿ç¨‹ä¸èƒ½è®©å®ƒç©ºä¸‹æ¥ï¼Œå¾—è®©å®ƒå»å¸®æ²¡å¹²å®Œæ´»çš„çº¿ç¨‹å¹²æ´»ã€‚å®ƒå»å…¶å®ƒçº¿ç¨‹çš„é˜Ÿåˆ—é‡Œçªƒå–ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œï¼Œè¿™å°±æ˜¯æ‰€è°“çš„<strong>å·¥ä½œçªƒå–</strong>ã€‚</p><p>å·¥ä½œçªƒå–å‘ç”Ÿçš„æ—¶å€™ï¼Œå®ƒä»¬ä¼šè®¿é—®åŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œä¸ºäº†å‡å°‘çªƒå–ä»»åŠ¡çº¿ç¨‹å’Œè¢«çªƒå–ä»»åŠ¡çº¿ç¨‹ä¹‹é—´çš„ç«äº‰ï¼Œé€šå¸¸ä»»åŠ¡ä¼šä½¿ç”¨åŒç«¯é˜Ÿåˆ—ï¼Œè¢«çªƒå–ä»»åŠ¡çº¿ç¨‹æ°¸è¿œä»åŒç«¯é˜Ÿåˆ—çš„å¤´éƒ¨æ‹¿ï¼Œè€Œçªƒå–ä»»åŠ¡çš„çº¿ç¨‹æ°¸è¿œä»åŒç«¯é˜Ÿåˆ—çš„å°¾éƒ¨æ‹¿ä»»åŠ¡æ‰§è¡Œã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javathread-86.png" alt="å·¥ä½œçªƒå–"></p><p>çœ‹ä¸€ä¸ªFork/Joinæ¡†æ¶åº”ç”¨çš„ä¾‹å­ï¼Œè®¡ç®—1~nä¹‹é—´çš„å’Œï¼š1+2+3+â€¦+n</p><ul><li>è®¾ç½®ä¸€ä¸ªåˆ†å‰²é˜ˆå€¼ï¼Œä»»åŠ¡å¤§äºé˜ˆå€¼å°±æ‹†åˆ†ä»»åŠ¡</li><li>ä»»åŠ¡æœ‰ç»“æœï¼Œæ‰€ä»¥éœ€è¦ç»§æ‰¿RecursiveTask</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CountTask</span> <span class="token keyword">extends</span> <span class="token class-name">RecursiveTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> THRESHOLD <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span> <span class="token comment">// é˜ˆå€¼</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> start<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> end<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">CountTask</span><span class="token punctuation">(</span><span class="token keyword">int</span> start<span class="token punctuation">,</span> <span class="token keyword">int</span> end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">=</span> start<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">=</span> end<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Integer</span> <span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token comment">// å¦‚æœä»»åŠ¡è¶³å¤Ÿå°å°±è®¡ç®—ä»»åŠ¡</span>
        <span class="token keyword">boolean</span> canCompute <span class="token operator">=</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> THRESHOLD<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>canCompute<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> start<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> end<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                sum <span class="token operator">+=</span> i<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœä»»åŠ¡å¤§äºé˜ˆå€¼ï¼Œå°±åˆ†è£‚æˆä¸¤ä¸ªå­ä»»åŠ¡è®¡ç®—</span>
            <span class="token keyword">int</span> middle <span class="token operator">=</span> <span class="token punctuation">(</span>start <span class="token operator">+</span> end<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token class-name">CountTask</span> leftTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountTask</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> middle<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">CountTask</span> rightTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountTask</span><span class="token punctuation">(</span>middle <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æ‰§è¡Œå­ä»»åŠ¡</span>
            leftTask<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            rightTask<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç­‰å¾…å­ä»»åŠ¡æ‰§è¡Œå®Œï¼Œå¹¶å¾—åˆ°å…¶ç»“æœ</span>
            <span class="token keyword">int</span> leftResult <span class="token operator">=</span> leftTask<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> rightResult <span class="token operator">=</span> rightTask<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆå¹¶å­ä»»åŠ¡</span>
            sum <span class="token operator">=</span> leftResult <span class="token operator">+</span> rightResult<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ForkJoinPool</span> forkJoinPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç”Ÿæˆä¸€ä¸ªè®¡ç®—ä»»åŠ¡ï¼Œè´Ÿè´£è®¡ç®—1+2+3+4</span>
        <span class="token class-name">CountTask</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountTask</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ‰§è¡Œä¸€ä¸ªä»»åŠ¡</span>
        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> forkJoinPool<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ExecutionException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ForkJoinTaskä¸ä¸€èˆ¬Taskçš„ä¸»è¦åŒºåˆ«åœ¨äºå®ƒéœ€è¦å®ç°computeæ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œï¼Œé¦–å…ˆéœ€è¦åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¶³å¤Ÿå°ï¼Œå¦‚æœè¶³å¤Ÿå°å°±ç›´æ¥æ‰§è¡Œä»»åŠ¡ã€‚å¦‚æœæ¯”è¾ƒå¤§ï¼Œå°±å¿…é¡»åˆ†å‰²æˆä¸¤ä¸ªå­ä»»åŠ¡ï¼Œæ¯ä¸ªå­ä»»åŠ¡åœ¨è°ƒç”¨forkæ–¹æ³•æ—¶ï¼Œåˆä¼šè¿›computeæ–¹æ³•ï¼Œçœ‹çœ‹å½“å‰å­ä»»åŠ¡æ˜¯å¦éœ€è¦ç»§ç»­åˆ†å‰²æˆå­ä»»åŠ¡ï¼Œå¦‚æœä¸éœ€è¦ç»§ç»­åˆ†å‰²ï¼Œåˆ™æ‰§è¡Œå½“å‰å­ä»»åŠ¡å¹¶è¿”å›ç»“æœã€‚ä½¿ç”¨joinæ–¹æ³•ä¼šç­‰å¾…å­ä»»åŠ¡æ‰§è¡Œå®Œå¹¶å¾—åˆ°å…¶ç»“æœã€‚</p><p><img src="http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xingbiaogongzhonghao.png" alt=""></p><blockquote><p>å›¾æ–‡è¯¦è§£ 60 é“Javaå¹¶å‘é¢è¯•é«˜é¢‘é¢˜ï¼Œè¿™æ¬¡é¢è¯•ï¼Œä¸€å®šåŠæ‰“é¢è¯•å®˜ï¼Œæ•´ç†ï¼šæ²‰é»˜ç‹äºŒï¼Œæˆ³<a href="https://mp.weixin.qq.com/s/bImCIoYsH_JEzTkBx2lj4A" target="_blank" rel="noopener noreferrer">è½¬è½½é“¾æ¥<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œä½œè€…ï¼šä¸‰åˆ†æ¶ï¼Œæˆ³<a href="https://mp.weixin.qq.com/s/1jhBZrAb7bnvkgN1TgAUpw" target="_blank" rel="noopener noreferrer">åŸæ–‡é“¾æ¥<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p></blockquote></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/itwanger/toBeBetterJavaer/edit/master/docs/sidebar/sanfene/javathread.md" rel="noopener noreferrer" target="_blank" aria-label="ç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->ç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><span class="info">2022/5/20 ä¸Šåˆ11:14:08</span></div><div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: www.qing_gee@163.com">itwanger</span>,<!--]--><!--[--><span class="contributor" title="email: www.qing_gee@163.com">æ²‰é»˜ç‹äºŒ</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/sidebar/sanfene/collection.html" class="nav-link prev" aria-label="Java é›†åˆæ¡†æ¶"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->Java é›†åˆæ¡†æ¶</div></a><a href="/sidebar/sanfene/jvm.html" class="nav-link next" aria-label="Java è™šæ‹Ÿæœº"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow right"></span></div><div class="link">Java è™šæ‹Ÿæœº<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"><a href="https://beian.miit.gov.cn/" target="_blank">è±«ICPå¤‡2021038026å·-1</a><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/beian.png" height="15px" width="15px" /><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41030502000411"><span>è±«å…¬ç½‘å®‰å¤‡ 41030502000411å·</span></a></div><div class="copyright">Copyright Â© 2022 æ²‰é»˜ç‹äºŒ</div></footer><!--]--></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app.df242bb6.js" defer></script>
  </body>
</html>
