---
title: è¯¦è§£ Java ä¸­çš„åŒç«¯é˜Ÿåˆ—ï¼ˆArrayDequeé™„æºç åˆ†æï¼‰
shortTitle: åŒç«¯é˜Ÿåˆ—ArrayDequeè¯¦è§£
category:
  - Javaæ ¸å¿ƒ
tag:
  - é›†åˆæ¡†æ¶ï¼ˆå®¹å™¨ï¼‰
description: æœ¬æ–‡è¯¦ç»†è§£æäº† Java ä¸­çš„åŒç«¯é˜Ÿåˆ— ArrayDeque çš„å®ç°åŸç†ã€åŠŸèƒ½ç‰¹ç‚¹ä»¥åŠæºç ï¼Œä¸ºæ‚¨æä¾›äº† ArrayDeque çš„å®é™…åº”ç”¨ç¤ºä¾‹å’Œæ€§èƒ½ä¼˜åŒ–å»ºè®®ã€‚é˜…è¯»æœ¬æ–‡ï¼Œå°†å¸®åŠ©æ‚¨æ›´æ·±å…¥åœ°ç†è§£åŒç«¯é˜Ÿåˆ—åœ¨ Java ç¼–ç¨‹ä¸­çš„åº”ç”¨ï¼Œä»è€Œåœ¨å®é™…ç¼–ç¨‹ä¸­å……åˆ†å‘æŒ¥å…¶ä¼˜åŠ¿ã€‚
head:
  - - meta
    - name: keywords
      content: Java,ArrayDeque,å †,é˜Ÿåˆ—,java åŒç«¯é˜Ÿåˆ—,java ArrayDeque,æºç åˆ†æ, å®ç°åŸç†
---

# 6.12 åŒç«¯é˜Ÿåˆ—ArrayDequeè¯¦è§£

>å¥½ï¼Œæˆ‘ä»¬è¿™èŠ‚ç»§ç»­æœ‰è¯·ç‹è€å¸ˆä¸Šå°æ¥ç»™å¤§å®¶è®² ArrayDequeï¼Œé¼“æŒæ¬¢è¿äº†ğŸ‘ğŸ»ã€‚

Java é‡Œæœ‰ä¸€ä¸ªå«åš*Stack*çš„ç±»ï¼Œå´æ²¡æœ‰å«åš*Queue*çš„ç±»ï¼ˆå®ƒåªæ˜¯ä¸ªæ¥å£åå­—ï¼Œå’Œç±»è¿˜ä¸ä¸€æ ·ï¼‰ã€‚

```java
public interface Queue<E> extends Collection<E> {}
```

å½“éœ€è¦ä½¿ç”¨æ ˆæ—¶ï¼ŒJava å·²ä¸æ¨èä½¿ç”¨*Stack*ï¼Œè€Œæ˜¯æ¨èä½¿ç”¨æ›´é«˜æ•ˆçš„*ArrayDeque*ï¼ˆåŒç«¯é˜Ÿåˆ—ï¼‰ï¼ŒåŸå› æˆ‘ä»¬ç¬¬ä¸€æ¬¡è®²[é›†åˆæ¡†æ¶](https://javabetter.cn/collection/gailan.html)çš„æ—¶å€™ï¼Œå…¶å®å·²ç»èŠè¿‡äº†ï¼ŒStack æ˜¯ä¸€ä¸ªâ€œåŸå§‹â€ç±»ï¼Œå®ƒçš„æ ¸å¿ƒæ–¹æ³•ä¸Šéƒ½åŠ äº† `synchronized` å…³é”®å­—ä»¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œå½“æˆ‘ä»¬ä¸éœ€è¦çº¿ç¨‹å®‰å…¨ï¼ˆæ¯”å¦‚è¯´å•çº¿ç¨‹ç¯å¢ƒä¸‹ï¼‰æ€§èƒ½å°±ä¼šæ¯”è¾ƒå·®ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection//arraydeque-51e3552c-af39-4d00-8494-1ff0a4913357.png)

ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“éœ€è¦ä½¿ç”¨æ ˆæ—¶å€™ï¼Œè¯·é¦–é€‰*ArrayDeque*ã€‚

```java
// å£°æ˜ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—
ArrayDeque<String> stack = new ArrayDeque<>();

// å¢åŠ å…ƒç´ 
stack.push("æ²‰é»˜");
stack.push("ç‹äºŒ");
stack.push("é™ˆæ¸…æ‰¬");

// è·å–æ ˆé¡¶å…ƒç´ 
String top = stack.peek();
System.out.println("æ ˆé¡¶å…ƒç´ ä¸ºï¼š" + top); // é™ˆæ¸…æ‰¬

// å¼¹å‡ºæ ˆé¡¶å…ƒç´ 
String pop = stack.pop();
System.out.println("å¼¹å‡ºçš„å…ƒç´ ä¸ºï¼š" + pop); // é™ˆæ¸…æ‰¬

// ä¿®æ”¹æ ˆé¡¶å…ƒç´ 
stack.pop();
stack.push("å°æ˜");
System.out.println("ä¿®æ”¹åçš„æ ˆä¸ºï¼š" + stack); // [æ²‰é»˜, å°æ˜]

// éå†é˜Ÿåˆ—æŸ¥æ‰¾å…ƒç´ 
Iterator<String> iterator = stack.iterator();
int index = -1;
String target = "ç‹äºŒ";
while (iterator.hasNext()) {
    String element = iterator.next();
    index++;
    if (element.equals(target)) {
        break;
    }
}

if (index == -1) {
    System.out.println("å…ƒç´  " + target + " ä¸å­˜åœ¨äºé˜Ÿåˆ—ä¸­");
} else {
    System.out.println("å…ƒç´  " + target + " åœ¨é˜Ÿåˆ—ä¸­çš„ä½ç½®ä¸ºï¼š" + index);
}
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºäº†ä¸€ä¸ª ArrayDeque å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ push æ–¹æ³•å‘æ ˆä¸­æ·»åŠ äº†ä¸‰ä¸ªå…ƒç´ ã€‚æ¥ç€ä½¿ç”¨ peek æ–¹æ³•è·å–æ ˆé¡¶å…ƒç´ ï¼Œä½¿ç”¨ pop æ–¹æ³•å¼¹å‡ºæ ˆé¡¶å…ƒç´ ï¼Œä½¿ç”¨ pop å’Œ push æ–¹æ³•ä¿®æ”¹æ ˆé¡¶å…ƒç´ ï¼Œä½¿ç”¨è¿­ä»£å™¨æŸ¥æ‰¾å…ƒç´ åœ¨æ ˆä¸­çš„ä½ç½®ã€‚

ArrayDeque åˆå®ç°äº† Deque æ¥å£ï¼ˆDeque åˆå®ç°äº† Queue æ¥å£ï¼‰ï¼š

```java
public class ArrayDeque<E> extends AbstractCollection<E>
                           implements Deque<E>, Cloneable, Serializable
{}
```

å› æ­¤ï¼Œå½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨é˜Ÿåˆ—çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥é€‰æ‹© ArrayDequeã€‚

```java
ArrayDeque<String> queue = new ArrayDeque<>();

// å¢åŠ å…ƒç´ 
queue.offer("æ²‰é»˜");
queue.offer("ç‹äºŒ");
queue.offer("é™ˆæ¸…æ‰¬");

// è·å–é˜Ÿé¦–å…ƒç´ 
String front = queue.peek();
System.out.println("é˜Ÿé¦–å…ƒç´ ä¸ºï¼š" + front); // æ²‰é»˜

// å¼¹å‡ºé˜Ÿé¦–å…ƒç´ 
String poll = queue.poll();
System.out.println("å¼¹å‡ºçš„å…ƒç´ ä¸ºï¼š" + poll); // æ²‰é»˜

// ä¿®æ”¹é˜Ÿåˆ—ä¸­çš„å…ƒç´ 
queue.poll();
queue.offer("å°æ˜");
System.out.println("ä¿®æ”¹åçš„é˜Ÿåˆ—ä¸ºï¼š" + queue); // [é™ˆæ¸…æ‰¬, å°æ˜]

// æŸ¥æ‰¾å…ƒç´ 
Iterator<String> iterator = queue.iterator();
int index = 0;
while (iterator.hasNext()) {
    String element = iterator.next();
    if (element.equals("ç‹äºŒ")) {
        System.out.println("å…ƒç´ åœ¨é˜Ÿåˆ—ä¸­çš„ä½ç½®ä¸ºï¼š" + index); // 0
        break;
    }
    index++;
}
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºäº†ä¸€ä¸ª ArrayDeque å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ offer æ–¹æ³•å‘é˜Ÿåˆ—ä¸­æ·»åŠ äº†ä¸‰ä¸ªå…ƒç´ ã€‚æ¥ç€ä½¿ç”¨ peek æ–¹æ³•è·å–é˜Ÿé¦–å…ƒç´ ï¼Œä½¿ç”¨ poll æ–¹æ³•å¼¹å‡ºé˜Ÿé¦–å…ƒç´ ï¼Œä½¿ç”¨ poll å’Œ offer æ–¹æ³•ä¿®æ”¹é˜Ÿåˆ—ä¸­çš„å…ƒç´ ï¼Œä½¿ç”¨è¿­ä»£å™¨æŸ¥æ‰¾å…ƒç´ åœ¨é˜Ÿåˆ—ä¸­çš„ä½ç½®ã€‚

[æˆ‘ä»¬å‰é¢è®²äº†](https://javabetter.cn/collection/gailan.html)ï¼ŒLinkedListä¸åªæ˜¯ä¸ª Listï¼Œè¿˜æ˜¯ä¸€ä¸ª Queueï¼Œå®ƒä¹Ÿå®ç°äº† Deque æ¥å£ã€‚

```java
public class LinkedList<E>
    extends AbstractSequentialList<E>
    implements List<E>, Deque<E>, Cloneable, java.io.Serializable
{}
```

æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨é˜Ÿåˆ—æ—¶ï¼Œè¿˜å¯ä»¥é€‰æ‹©[LinkedList](https://javabetter.cn/collection/linkedlist.html)ã€‚

```java
// åˆ›å»ºä¸€ä¸ª LinkedList å¯¹è±¡
LinkedList<String> queue = new LinkedList<>();

// æ·»åŠ å…ƒç´ 
queue.offer("æ²‰é»˜");
queue.offer("ç‹äºŒ");
queue.offer("é™ˆæ¸…æ‰¬");
System.out.println(queue); // è¾“å‡º [æ²‰é»˜, ç‹äºŒ, é™ˆæ¸…æ‰¬]

// åˆ é™¤å…ƒç´ 
queue.poll();
System.out.println(queue); // è¾“å‡º [ç‹äºŒ, é™ˆæ¸…æ‰¬]

// ä¿®æ”¹å…ƒç´ ï¼šLinkedList ä¸­çš„å…ƒç´ ä¸æ”¯æŒç›´æ¥ä¿®æ”¹ï¼Œéœ€è¦å…ˆåˆ é™¤å†æ·»åŠ 
String first = queue.poll();
queue.offer("ç‹å¤§äºŒ");
System.out.println(queue); // è¾“å‡º [é™ˆæ¸…æ‰¬, ç‹å¤§äºŒ]

// æŸ¥æ‰¾å…ƒç´ ï¼šLinkedList ä¸­çš„å…ƒç´ å¯ä»¥ä½¿ç”¨ get() æ–¹æ³•è¿›è¡ŒæŸ¥æ‰¾
System.out.println(queue.get(0)); // è¾“å‡º é™ˆæ¸…æ‰¬
System.out.println(queue.contains("æ²‰é»˜")); // è¾“å‡º false

// æŸ¥æ‰¾å…ƒç´ ï¼šä½¿ç”¨è¿­ä»£å™¨çš„æ–¹å¼æŸ¥æ‰¾é™ˆæ¸…æ‰¬
// ä½¿ç”¨è¿­ä»£å™¨ä¾æ¬¡éå†å…ƒç´ å¹¶æŸ¥æ‰¾
Iterator<String> iterator = queue.iterator();
while (iterator.hasNext()) {
    String element = iterator.next();
    if (element.equals("é™ˆæ¸…æ‰¬")) {
        System.out.println("æ‰¾åˆ°äº†ï¼š" + element);
        break;
    }
}
```

åœ¨ä½¿ç”¨ LinkedList ä½œä¸ºé˜Ÿåˆ—æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ offer() æ–¹æ³•å°†å…ƒç´ æ·»åŠ åˆ°é˜Ÿåˆ—çš„æœ«å°¾ï¼Œä½¿ç”¨ poll() æ–¹æ³•ä»é˜Ÿåˆ—çš„å¤´éƒ¨åˆ é™¤å…ƒç´ ï¼Œä½¿ç”¨è¿­ä»£å™¨æˆ–è€… poll() æ–¹æ³•ä¾æ¬¡éå†å…ƒç´ ã€‚

### æ ˆå’Œé˜Ÿåˆ—

è¦è®²æ ˆå’Œé˜Ÿåˆ—ï¼Œé¦–å…ˆè¦è®²*Deque*æ¥å£ã€‚*Deque*çš„å«ä¹‰æ˜¯â€œdouble ended queueâ€ï¼Œå³åŒç«¯é˜Ÿåˆ—ï¼Œå®ƒæ—¢å¯ä»¥å½“ä½œæ ˆä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å½“ä½œé˜Ÿåˆ—ä½¿ç”¨ã€‚ä¸‹è¡¨åˆ—å‡ºäº†*Deque*ä¸*Queue*ç›¸å¯¹åº”çš„æ¥å£ï¼š

| Queue Method | Equivalent Deque Method | è¯´æ˜                                   |
| ------------ | ----------------------- | -------------------------------------- |
| add(e)       | addLast(e)              | å‘é˜Ÿå°¾æ’å…¥å…ƒç´ ï¼Œå¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸         |
| offer(e)     | offerLast(e)            | å‘é˜Ÿå°¾æ’å…¥å…ƒç´ ï¼Œå¤±è´¥åˆ™è¿”å›`false`      |
| remove()     | removeFirst()           | è·å–å¹¶åˆ é™¤é˜Ÿé¦–å…ƒç´ ï¼Œå¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸     |
| poll()       | pollFirst()             | è·å–å¹¶åˆ é™¤é˜Ÿé¦–å…ƒç´ ï¼Œå¤±è´¥åˆ™è¿”å›`null`   |
| element()    | getFirst()              | è·å–ä½†ä¸åˆ é™¤é˜Ÿé¦–å…ƒç´ ï¼Œå¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸   |
| peek()       | peekFirst()             | è·å–ä½†ä¸åˆ é™¤é˜Ÿé¦–å…ƒç´ ï¼Œå¤±è´¥åˆ™è¿”å›`null` |

ä¸‹è¡¨åˆ—å‡ºäº†*Deque*ä¸*Stack*å¯¹åº”çš„æ¥å£ï¼š

| Stack Method | Equivalent Deque Method | è¯´æ˜                                   |
| ------------ | ----------------------- | -------------------------------------- |
| push(e)      | addFirst(e)             | å‘æ ˆé¡¶æ’å…¥å…ƒç´ ï¼Œå¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸         |
| æ—            | offerFirst(e)           | å‘æ ˆé¡¶æ’å…¥å…ƒç´ ï¼Œå¤±è´¥åˆ™è¿”å›`false`      |
| pop()        | removeFirst()           | è·å–å¹¶åˆ é™¤æ ˆé¡¶å…ƒç´ ï¼Œå¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸     |
| æ—            | pollFirst()             | è·å–å¹¶åˆ é™¤æ ˆé¡¶å…ƒç´ ï¼Œå¤±è´¥åˆ™è¿”å›`null`   |
| peek()       | getFirst()             | è·å–ä½†ä¸åˆ é™¤æ ˆé¡¶å…ƒç´ ï¼Œå¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸   |
| æ—            | peekFirst()             | è·å–ä½†ä¸åˆ é™¤æ ˆé¡¶å…ƒç´ ï¼Œå¤±è´¥åˆ™è¿”å›`null` |

ä¸Šé¢ä¸¤ä¸ªè¡¨å…±å®šä¹‰äº†*Deque*çš„ 12 ä¸ªæ¥å£ã€‚

æ·»åŠ ï¼Œåˆ é™¤ï¼Œå–å€¼éƒ½æœ‰ä¸¤å¥—æ¥å£ï¼Œå®ƒä»¬åŠŸèƒ½ç›¸åŒï¼ŒåŒºåˆ«æ˜¯å¯¹å¤±è´¥æƒ…å†µçš„å¤„ç†ä¸åŒã€‚

**ä¸€å¥—æ¥å£é‡åˆ°å¤±è´¥å°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¦ä¸€å¥—é‡åˆ°å¤±è´¥ä¼šè¿”å›ç‰¹æ®Šå€¼ï¼ˆ`false`æˆ–`null`ï¼‰**ã€‚é™¤éæŸç§å®ç°å¯¹å®¹é‡æœ‰é™åˆ¶ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ·»åŠ æ“ä½œæ˜¯ä¸ä¼šå¤±è´¥çš„ã€‚

**è™½ç„¶*Deque*çš„æ¥å£æœ‰ 12 ä¸ªä¹‹å¤šï¼Œä½†æ— éå°±æ˜¯å¯¹å®¹å™¨çš„ä¸¤ç«¯è¿›è¡Œæ“ä½œï¼Œæˆ–æ·»åŠ ï¼Œæˆ–åˆ é™¤ï¼Œæˆ–æŸ¥çœ‹**ã€‚æ˜ç™½äº†è¿™ä¸€ç‚¹è®²è§£èµ·æ¥å°±ä¼šéå¸¸ç®€å•ã€‚

*ArrayDeque*å’Œ*LinkedList*æ˜¯*Deque*çš„ä¸¤ä¸ªé€šç”¨å®ç°ï¼Œç”±äºå®˜æ–¹æ›´æ¨èä½¿ç”¨*ArrayDeque*ç”¨ä½œæ ˆå’Œé˜Ÿåˆ—ï¼ŒåŠ ä¹‹ä¸Šä¸€ç¯‡å·²ç»è®²è§£è¿‡[LinkedList](https://javabetter.cn/collection/linkedlist.html)ï¼Œæœ¬æ–‡å°†ç€é‡è®²è§£*ArrayDeque*çš„å…·ä½“å®ç°ã€‚

ä»åå­—å¯ä»¥çœ‹å‡º*ArrayDeque*åº•å±‚é€šè¿‡æ•°ç»„å®ç°ï¼Œä¸ºäº†æ»¡è¶³å¯ä»¥åŒæ—¶åœ¨æ•°ç»„ä¸¤ç«¯æ’å…¥æˆ–åˆ é™¤å…ƒç´ çš„éœ€æ±‚ï¼Œè¯¥æ•°ç»„è¿˜å¿…é¡»æ˜¯å¾ªç¯çš„ï¼Œå³**å¾ªç¯æ•°ç»„ï¼ˆcircular arrayï¼‰**ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°ç»„çš„ä»»ä½•ä¸€ç‚¹éƒ½å¯èƒ½è¢«çœ‹ä½œèµ·ç‚¹æˆ–è€…ç»ˆç‚¹ã€‚

*ArrayDeque*æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼ˆnot thread-safeï¼‰ï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶ä½¿ç”¨çš„æ—¶å€™ï¼Œéœ€è¦æ‰‹åŠ¨åŒæ­¥ï¼›å¦å¤–ï¼Œè¯¥å®¹å™¨ä¸å…è®¸æ”¾å…¥`null`å…ƒç´ ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/arraydeque-1e7086a3-3d31-4553-aa16-5eaf2193649e.png)


ä¸Šå›¾ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œ**`head`æŒ‡å‘é¦–ç«¯ç¬¬ä¸€ä¸ªæœ‰æ•ˆå…ƒç´ ï¼Œ`tail`æŒ‡å‘å°¾ç«¯ç¬¬ä¸€ä¸ªå¯ä»¥æ’å…¥å…ƒç´ çš„ç©ºä½**ã€‚å› ä¸ºæ˜¯å¾ªç¯æ•°ç»„ï¼Œæ‰€ä»¥`head`ä¸ä¸€å®šæ€»ç­‰äº 0ï¼Œ`tail`ä¹Ÿä¸ä¸€å®šæ€»æ˜¯æ¯”`head`å¤§ã€‚

### æ–¹æ³•å‰–æ

#### addFirst()

`addFirst(E e)`çš„ä½œç”¨æ˜¯åœ¨*Deque*çš„é¦–ç«¯æ’å…¥å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯åœ¨`head`çš„å‰é¢æ’å…¥å…ƒç´ ï¼Œåœ¨ç©ºé—´è¶³å¤Ÿä¸”ä¸‹æ ‡æ²¡æœ‰è¶Šç•Œçš„æƒ…å†µä¸‹ï¼Œåªéœ€è¦å°†`elements[--head] = e`å³å¯ã€‚


![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/arraydeque-459afbba-2778-4241-97fb-f01a29b79458.png)

å®é™…éœ€è¦è€ƒè™‘ï¼š

1. ç©ºé—´æ˜¯å¦å¤Ÿç”¨ï¼Œä»¥åŠ 
2. ä¸‹æ ‡æ˜¯å¦è¶Šç•Œçš„é—®é¢˜ã€‚

ä¸Šå›¾ä¸­ï¼Œå¦‚æœ`head`ä¸º`0`ä¹‹åæ¥ç€è°ƒç”¨`addFirst()`ï¼Œè™½ç„¶ç©ºä½™ç©ºé—´è¿˜å¤Ÿç”¨ï¼Œä½†`head`ä¸º`-1`ï¼Œä¸‹æ ‡è¶Šç•Œäº†ã€‚ä¸‹åˆ—ä»£ç å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸¤ä¸ªé—®é¢˜ã€‚


```java
//addFirst(E e)
public void addFirst(E e) {
    if (e == null)//ä¸å…è®¸æ”¾å…¥null
        throw new NullPointerException();
    elements[head = (head - 1) & (elements.length - 1)] = e;//2.ä¸‹æ ‡æ˜¯å¦è¶Šç•Œ
    if (head == tail)//1.ç©ºé—´æ˜¯å¦å¤Ÿç”¨
        doubleCapacity();//æ‰©å®¹
}
```

ä¸Šè¿°ä»£ç æˆ‘ä»¬çœ‹åˆ°ï¼Œ**ç©ºé—´é—®é¢˜æ˜¯åœ¨æ’å…¥ä¹‹åè§£å†³çš„**ï¼Œå› ä¸º`tail`æ€»æ˜¯æŒ‡å‘ä¸‹ä¸€ä¸ªå¯æ’å…¥çš„ç©ºä½ï¼Œä¹Ÿå°±æ„å‘³ç€`elements`æ•°ç»„è‡³å°‘æœ‰ä¸€ä¸ªç©ºä½ï¼Œæ‰€ä»¥æ’å…¥å…ƒç´ çš„æ—¶å€™ä¸ç”¨è€ƒè™‘ç©ºé—´é—®é¢˜ã€‚

ä¸‹æ ‡è¶Šç•Œçš„å¤„ç†è§£å†³èµ·æ¥éå¸¸ç®€å•ï¼Œ`head = (head - 1) & (elements.length - 1)`å°±å¯ä»¥äº†ï¼Œ**è¿™æ®µä»£ç ç›¸å½“äºå–ä½™ï¼ŒåŒæ—¶è§£å†³äº†`head`ä¸ºè´Ÿå€¼çš„æƒ…å†µ**ã€‚å› ä¸º`elements.length`å¿…éœ€æ˜¯`2`çš„æŒ‡æ•°å€ï¼Œ`elements - 1`å°±æ˜¯äºŒè¿›åˆ¶ä½ä½å…¨`1`ï¼Œè·Ÿ`head - 1`ç›¸ä¸ä¹‹åå°±èµ·åˆ°äº†å–æ¨¡çš„ä½œç”¨ï¼Œå¦‚æœ`head - 1`ä¸ºè´Ÿæ•°ï¼ˆå…¶å®åªå¯èƒ½æ˜¯-1ï¼‰ï¼Œåˆ™ç›¸å½“äºå¯¹å…¶å–ç›¸å¯¹äº`elements.length`çš„è¡¥ç ã€‚

ä¸‹é¢å†è¯´è¯´æ‰©å®¹å‡½æ•°`doubleCapacity()`ï¼Œå…¶é€»è¾‘æ˜¯ç”³è¯·ä¸€ä¸ªæ›´å¤§çš„æ•°ç»„ï¼ˆåŸæ•°ç»„çš„ä¸¤å€ï¼‰ï¼Œç„¶åå°†åŸæ•°ç»„å¤åˆ¶è¿‡å»ã€‚è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/arraydeque-f1386b63-10be-4998-bb6d-bf6560cca7ee.png)

å›¾ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œå¤åˆ¶åˆ†ä¸¤æ¬¡è¿›è¡Œï¼Œç¬¬ä¸€æ¬¡å¤åˆ¶`head`å³è¾¹çš„å…ƒç´ ï¼Œç¬¬äºŒæ¬¡å¤åˆ¶`head`å·¦è¾¹çš„å…ƒç´ ã€‚

```java
//doubleCapacity()
private void doubleCapacity() {
    assert head == tail;
    int p = head;
    int n = elements.length;
    int r = n - p; // headå³è¾¹å…ƒç´ çš„ä¸ªæ•°
    int newCapacity = n << 1;//åŸç©ºé—´çš„2å€
    if (newCapacity < 0)
        throw new IllegalStateException("Sorry, deque too big");
    Object[] a = new Object[newCapacity];
    System.arraycopy(elements, p, a, 0, r);//å¤åˆ¶å³åŠéƒ¨åˆ†ï¼Œå¯¹åº”ä¸Šå›¾ä¸­ç»¿è‰²éƒ¨åˆ†
    System.arraycopy(elements, 0, a, r, p);//å¤åˆ¶å·¦åŠéƒ¨åˆ†ï¼Œå¯¹åº”ä¸Šå›¾ä¸­ç°è‰²éƒ¨åˆ†
    elements = (E[])a;
    head = 0;
    tail = n;
}
```

è¯¥æ–¹æ³•çš„å®ç°ä¸­ï¼Œé¦–å…ˆæ£€æŸ¥ head å’Œ tail æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœä¸ç›¸ç­‰åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ç„¶åè®¡ç®—å‡º head å³è¾¹çš„å…ƒç´ ä¸ªæ•° rï¼Œä»¥åŠæ–°çš„å®¹é‡ newCapacityï¼Œå¦‚æœ newCapacity å¤ªå¤§åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚

æ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ Object æ•°ç»„ aï¼Œå°†åŸæœ‰ ArrayDeque ä¸­ head å³è¾¹çš„å…ƒç´ å¤åˆ¶åˆ° a çš„å‰é¢ï¼ˆå³å›¾ä¸­ç»¿è‰²éƒ¨åˆ†ï¼‰ï¼Œå°† head å·¦è¾¹çš„å…ƒç´ å¤åˆ¶åˆ° a çš„åé¢ï¼ˆå³å›¾ä¸­ç°è‰²éƒ¨åˆ†ï¼‰ã€‚æœ€åå°† elements æ•°ç»„æ›¿æ¢ä¸º aï¼Œhead è®¾ç½®ä¸º 0ï¼Œtail è®¾ç½®ä¸º nï¼ˆå³æ–°å®¹é‡çš„é•¿åº¦ï¼‰ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äº elements æ•°ç»„è¢«æ›¿æ¢ä¸º a æ•°ç»„ï¼Œå› æ­¤åœ¨æ–¹æ³•è°ƒç”¨ç»“æŸåï¼ŒåŸæœ‰çš„ elements æ•°ç»„å°†ä¸å†è¢«å¼•ç”¨ï¼Œä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚

#### addLast()

`addLast(E e)`çš„ä½œç”¨æ˜¯åœ¨*Deque*çš„å°¾ç«¯æ’å…¥å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯åœ¨`tail`çš„ä½ç½®æ’å…¥å…ƒç´ ï¼Œç”±äº`tail`æ€»æ˜¯æŒ‡å‘ä¸‹ä¸€ä¸ªå¯ä»¥æ’å…¥çš„ç©ºä½ï¼Œå› æ­¤åªéœ€è¦`elements[tail] = e;`å³å¯ã€‚æ’å…¥å®Œæˆåå†æ£€æŸ¥ç©ºé—´ï¼Œå¦‚æœç©ºé—´å·²ç»ç”¨å…‰ï¼Œåˆ™è°ƒç”¨`doubleCapacity()`è¿›è¡Œæ‰©å®¹ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/arraydeque-832c796a-6c24-4546-9f91-22ed39884363.png)

```java
public void addLast(E e) {
    if (e == null)//ä¸å…è®¸æ”¾å…¥null
        throw new NullPointerException();
    elements[tail] = e;//èµ‹å€¼
    if ( (tail = (tail + 1) & (elements.length - 1)) == head)//ä¸‹æ ‡è¶Šç•Œå¤„ç†
        doubleCapacity();//æ‰©å®¹
}
```

ä¸‹æ ‡è¶Šç•Œå¤„ç†æ–¹å¼`addFirt()`ä¸­å·²ç»è®²è¿‡ï¼Œä¸å†èµ˜è¿°ã€‚

#### pollFirst()

`pollFirst()`çš„ä½œç”¨æ˜¯åˆ é™¤å¹¶è¿”å›*Deque*é¦–ç«¯å…ƒç´ ï¼Œä¹Ÿå³æ˜¯`head`ä½ç½®å¤„çš„å…ƒç´ ã€‚å¦‚æœå®¹å™¨ä¸ç©ºï¼Œåªéœ€è¦ç›´æ¥è¿”å›`elements[head]`å³å¯ï¼Œå½“ç„¶è¿˜éœ€è¦å¤„ç†ä¸‹æ ‡çš„é—®é¢˜ã€‚ç”±äº`ArrayDeque`ä¸­ä¸å…è®¸æ”¾å…¥`null`ï¼Œå½“`elements[head] == null`æ—¶ï¼Œæ„å‘³ç€å®¹å™¨ä¸ºç©ºã€‚

```java
public E pollFirst() {
    E result = elements[head];
    if (result == null)//nullå€¼æ„å‘³ç€dequeä¸ºç©º
        return null;
    elements[h] = null;//let GC work
    head = (head + 1) & (elements.length - 1);//ä¸‹æ ‡è¶Šç•Œå¤„ç†
    return result;
}
```

#### pollLast()

`pollLast()`çš„ä½œç”¨æ˜¯åˆ é™¤å¹¶è¿”å›*Deque*å°¾ç«¯å…ƒç´ ï¼Œä¹Ÿå³æ˜¯`tail`ä½ç½®å‰é¢çš„é‚£ä¸ªå…ƒç´ ã€‚

```java
public E pollLast() {
    int t = (tail - 1) & (elements.length - 1);//tailçš„ä¸Šä¸€ä¸ªä½ç½®æ˜¯æœ€åä¸€ä¸ªå…ƒç´ 
    E result = elements[t];
    if (result == null)//nullå€¼æ„å‘³ç€dequeä¸ºç©º
        return null;
    elements[t] = null;//let GC work
    tail = t;
    return result;
}
```

#### peekFirst()

`peekFirst()`çš„ä½œç”¨æ˜¯è¿”å›ä½†ä¸åˆ é™¤*Deque*é¦–ç«¯å…ƒç´ ï¼Œä¹Ÿå³æ˜¯`head`ä½ç½®å¤„çš„å…ƒç´ ï¼Œç›´æ¥è¿”å›`elements[head]`å³å¯ã€‚

```java
public E peekFirst() {
    return elements[head]; // elements[head] is null if deque empty
}
```

#### peekLast()

`peekLast()`çš„ä½œç”¨æ˜¯è¿”å›ä½†ä¸åˆ é™¤*Deque*å°¾ç«¯å…ƒç´ ï¼Œä¹Ÿå³æ˜¯`tail`ä½ç½®å‰é¢çš„é‚£ä¸ªå…ƒç´ ã€‚

```java
public E peekLast() {
    return elements[(tail - 1) & (elements.length - 1)];
}
```

### å°ç»“

å½“éœ€è¦å®ç°å…ˆè¿›å…ˆå‡º(FIFO)æˆ–è€…å…ˆè¿›åå‡º(LIFO)çš„æ•°æ®ç»“æ„æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ ArrayDequeã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ä½¿ç”¨ ArrayDeque çš„åœºæ™¯ï¼š

- ç®¡ç†ä»»åŠ¡é˜Ÿåˆ—ï¼šå¦‚æœéœ€è¦å®ç°ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œå¯ä»¥ä½¿ç”¨ ArrayDeque æ¥å­˜å‚¨ä»»åŠ¡å…ƒç´ ã€‚åœ¨é˜Ÿåˆ—å¤´éƒ¨æ·»åŠ æ–°ä»»åŠ¡å…ƒç´ ï¼Œä»é˜Ÿåˆ—å°¾éƒ¨å–å‡ºä»»åŠ¡è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥ä¿è¯ä»»åŠ¡æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºæ‰§è¡Œã€‚
- å®ç°æ ˆï¼šArrayDeque å¯ä»¥ä½œä¸ºæ ˆçš„å®ç°æ–¹å¼ï¼Œæ”¯æŒ pushã€popã€peek ç­‰æ“ä½œï¼Œå¯ä»¥ç”¨äºéœ€è¦åè¿›å…ˆå‡ºçš„åœºæ™¯ã€‚
- å®ç°ç¼“å­˜ï¼šåœ¨éœ€è¦ç¼“å­˜ä¸€å®šæ•°é‡çš„æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ ArrayDequeã€‚å½“ç¼“å­˜çš„æ•°æ®é‡è¶…è¿‡å®¹é‡æ—¶ï¼Œå¯ä»¥ä»é˜Ÿåˆ—å¤´éƒ¨åˆ é™¤æœ€è€çš„æ•°æ®ï¼Œä»é˜Ÿåˆ—å°¾éƒ¨æ·»åŠ æ–°çš„æ•°æ®ã€‚
- å®ç°äº‹ä»¶å¤„ç†å™¨ï¼šArrayDeque å¯ä»¥ä½œä¸ºäº‹ä»¶å¤„ç†å™¨çš„å®ç°æ–¹å¼ï¼Œæ”¯æŒä»é˜Ÿåˆ—å¤´éƒ¨è·å–äº‹ä»¶è¿›è¡Œå¤„ç†ï¼Œä»é˜Ÿåˆ—å°¾éƒ¨æ·»åŠ æ–°çš„äº‹ä»¶ã€‚

ç®€å•æ€»ç»“ä¸€ä¸‹å§ã€‚

ArrayDeque æ˜¯ Java æ ‡å‡†åº“ä¸­çš„ä¸€ç§åŒç«¯é˜Ÿåˆ—å®ç°ï¼Œåº•å±‚åŸºäºæ•°ç»„å®ç°ã€‚ä¸ LinkedList ç›¸æ¯”ï¼ŒArrayDeque çš„æ€§èƒ½æ›´ä¼˜ï¼Œå› ä¸ºå®ƒä½¿ç”¨è¿ç»­çš„å†…å­˜ç©ºé—´å­˜å‚¨å…ƒç´ ï¼Œå¯ä»¥æ›´å¥½åœ°åˆ©ç”¨ CPU ç¼“å­˜ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä¹Ÿæ›´å¿«ã€‚

ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ

å› ä¸ºArrayDeque çš„åº•å±‚å®ç°æ˜¯æ•°ç»„ï¼Œè€Œ LinkedList çš„åº•å±‚å®ç°æ˜¯é“¾è¡¨ã€‚æ•°ç»„æ˜¯ä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œè€Œé“¾è¡¨æ˜¯ç”±å¤šä¸ªèŠ‚ç‚¹ç»„æˆçš„ï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨æ•°æ®å’ŒæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨ LinkedList æ—¶ï¼Œéœ€è¦é¢‘ç¹è¿›è¡Œå†…å­˜åˆ†é…å’Œé‡Šæ”¾ï¼Œè€Œ ArrayDeque åœ¨åˆ›å»ºæ—¶å°±ä¸€æ¬¡æ€§åˆ†é…äº†è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œä¸éœ€è¦é¢‘ç¹è¿›è¡Œå†…å­˜åˆ†é…å’Œé‡Šæ”¾ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½åœ°åˆ©ç”¨ CPU ç¼“å­˜ï¼Œæé«˜è®¿é—®æ•ˆç‡ã€‚

ç°ä»£è®¡ç®—æœºCPUå¯¹äºæ•°æ®çš„å±€éƒ¨æ€§æœ‰å¾ˆå¼ºçš„ä¾èµ–ï¼Œå¦‚æœéœ€è¦è®¿é—®çš„æ•°æ®åœ¨å†…å­˜ä¸­æ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨CPUçš„ç¼“å­˜æœºåˆ¶ï¼Œæé«˜è®¿é—®æ•ˆç‡ã€‚è€Œå½“æ•°æ®å­˜å‚¨åœ¨ä¸åŒçš„å†…å­˜å—é‡Œæ—¶ï¼Œæ¯æ¬¡è®¿é—®éƒ½éœ€è¦ä»å†…å­˜ä¸­è¯»å–ï¼Œæ•ˆç‡ä¼šå—åˆ°å½±å“ã€‚

å½“ç„¶äº†ï¼Œä½¿ç”¨ ArrayDeque æ—¶ï¼Œæ•°ç»„å¤åˆ¶æ“ä½œä¹Ÿæ˜¯éœ€è¦è€ƒè™‘çš„æ€§èƒ½æ¶ˆè€—ä¹‹ä¸€ã€‚

å½“ ArrayDeque çš„å…ƒç´ æ•°é‡è¶…è¿‡äº†åˆå§‹å®¹é‡æ—¶ï¼Œä¼šè§¦å‘æ‰©å®¹æ“ä½œã€‚æ‰©å®¹æ“ä½œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œå¹¶å°†åŸæœ‰å…ƒç´ å¤åˆ¶åˆ°æ–°æ•°ç»„ä¸­ã€‚æ‰©å®¹æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚

ä¸è¿‡ï¼ŒArrayDeque çš„æ‰©å®¹ç­–ç•¥ï¼ˆå½“ ArrayDeque ä¸­çš„å…ƒç´ æ•°é‡è¾¾åˆ°æ•°ç»„å®¹é‡æ—¶ï¼Œå°±éœ€è¦è¿›è¡Œæ‰©å®¹æ“ä½œï¼Œæ‰©å®¹æ—¶ä¼šå°†æ•°ç»„å®¹é‡æ‰©å¤§ä¸ºåŸæ¥çš„ä¸¤å€ï¼‰å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘æ•°ç»„å¤åˆ¶çš„æ¬¡æ•°å’Œæ—¶é—´æ¶ˆè€—ï¼ŒåŒæ—¶ä¿è¯ ArrayDeque çš„æ€§èƒ½å’Œç©ºé—´åˆ©ç”¨ç‡ã€‚

ArrayDeque ä¸ä»…æ”¯æŒå¸¸è§çš„é˜Ÿåˆ—æ“ä½œï¼Œå¦‚æ·»åŠ å…ƒç´ ã€åˆ é™¤å…ƒç´ ã€è·å–é˜Ÿåˆ—å¤´éƒ¨å…ƒç´ ã€è·å–é˜Ÿåˆ—å°¾éƒ¨å…ƒç´ ç­‰ã€‚åŒæ—¶ï¼Œå®ƒè¿˜æ”¯æŒæ ˆæ“ä½œï¼Œå¦‚ pushã€popã€peek ç­‰ã€‚è¿™ä½¿å¾— ArrayDeque æˆä¸ºä¸€ç§éå¸¸çµæ´»çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥ç”¨äºå„ç§åœºæ™¯çš„æ•°æ®å­˜å‚¨å’Œå¤„ç†ã€‚


>å‚è€ƒé“¾æ¥ï¼š[https://github.com/CarpenterLee/JCFInternals](https://github.com/CarpenterLee/JCFInternals)ï¼Œä½œè€…ï¼šæè±ªï¼Œæ•´ç†ï¼šæ²‰é»˜ç‹äºŒ


----

GitHub ä¸Šæ ‡æ˜Ÿ 9300+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 9300+ çš„ Java æ•™ç¨‹](https://javabetter.cn/overview/)


å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)
