<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.52" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta name="keywords" content="Redisé¢è¯•é¢˜,Redis,å…«è‚¡æ–‡,é¢è¯•é¢˜"><meta property="og:url" content="https://javabetter.cn/sidebar/sanfene/redis.html"><meta property="og:site_name" content="äºŒå“¥çš„Javaè¿›é˜¶ä¹‹è·¯"><meta property="og:title" content="Redisé¢è¯•é¢˜ï¼Œ58é“Rediså…«è‚¡æ–‡ï¼ˆ1.9ä¸‡å­—97å¼ æ‰‹ç»˜å›¾ï¼‰ï¼Œé¢æ¸£é€†è¢­å¿…çœ‹ğŸ‘"><meta property="og:description" content="ä¸‹è½½æ¬¡æ•°è¶… 1 ä¸‡æ¬¡ï¼Œ1.9 ä¸‡å­— 97 å¼ æ‰‹ç»˜å›¾ï¼Œè¯¦è§£ 58 é“ Redis é¢è¯•é«˜é¢‘é¢˜ï¼ˆè®©å¤©ä¸‹æ²¡æœ‰éš¾èƒŒçš„å…«è‚¡ï¼‰ï¼Œé¢æ¸£èƒŒä¼šè¿™äº› Redis å…«è‚¡æ–‡ï¼Œè¿™æ¬¡åŠæ‰“é¢è¯•å®˜ï¼Œæˆ‘è§‰å¾—ç¨³äº†ï¼ˆæ‰‹åŠ¨ dogï¼‰ã€‚"><meta property="og:type" content="article"><meta property="og:image" content="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-96e079f9-49a3-4c55-b0a4-47d043732b62.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-12-10T02:22:13.000Z"><meta property="article:author" content="ä¸‰åˆ†æ¶"><meta property="article:tag" content="é¢æ¸£é€†è¢­"><meta property="article:published_time" content="2024-10-31T00:00:00.000Z"><meta property="article:modified_time" content="2024-12-10T02:22:13.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Redisé¢è¯•é¢˜ï¼Œ58é“Rediså…«è‚¡æ–‡ï¼ˆ1.9ä¸‡å­—97å¼ æ‰‹ç»˜å›¾ï¼‰ï¼Œé¢æ¸£é€†è¢­å¿…çœ‹ğŸ‘","image":["https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-96e079f9-49a3-4c55-b0a4-47d043732b62.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240420093229.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-d44c2397-5994-452f-8b7b-eb85d2b87685.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240420100012.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240808101904.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-10434dc7-c7a3-4c1a-b484-de3fb37669ee.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240315115713.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240315120652.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240315120856.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e05bca61-4600-495c-b92a-25ac822e034e.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240918114125.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-eb541432-d68a-4dd9-b427-96c4dd607d64.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-344b8461-98d4-495b-a697-70275b0abad6.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-b7b24e25-d2dc-4457-994f-95bdb3674b8e.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240408100900.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-3bda4a46-adc3-4f0d-a135-b8ae5d4c0d5d.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-ffe56e32-34c5-453d-8859-c2febbe6a038.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-a9fb6202-b1a1-484d-a4fa-fef519090b44.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20241208204853.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-f9aab5e9-a875-4316-9ec9-0c5650afe5c1.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-19c531e5-da95-495a-a4c4-d63a0b8bba95.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-60497f1e-8afb-44b3-bb7a-d4c29e5ac484.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240709135618.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-5d91a67c-dbff-4a8d-bf9d-1fe7602d5a27.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-71074254-699a-480b-bbb0-c68f364a380b.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-dff14203-5e01-4d1b-a775-10ee444ada54.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-21123b1e-68b4-436b-ac84-3365a49a81bd.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-7518f715-6dee-4e70-b972-8aed9879e451.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-aa8d2960-b341-49cc-b04c-201241fd15de.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-87600c72-cc6a-4656-81b2-e71864c97f23.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-8b1a055c-f077-49ff-9432-c194d4fc3639.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-4074d72a-886a-4892-8f55-80112005aad8.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e7708f8d-ef34-4255-b5d0-cb300c649716.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-11839a24-9249-48a5-8c9d-888aa80d91dc.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-0618a5e2-e94f-40d7-888a-e78019ba8f93.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240819112712.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-03976d35-20b6-4efe-aa9c-7d3759460d34.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-5cbc6009-251e-4d5b-8f22-8d543938eccb.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240408104101.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e0ed9d62-3406-40db-8b01-c931f1020612.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-ceb49e41-dfd7-4d1e-91f9-c299437227d2.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-8b1fcaec-37e6-420a-9ca2-03615232af17.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-89bd1c1c-251c-4f53-bba3-fe945b2ae9e2.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e0ed9d62-3406-40db-8b01-c931f1020612.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-046a512c-baab-4e3a-9409-2af58088cceb.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e6064ba6-fd6f-4270-92f9-68c0bb98fd4b.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-15341792-e7a6-428c-a109-22827e02be5f.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-84a2a89e-f9ea-4681-b748-1a4f1dee172b.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-b61a6109-7aea-45ab-a53c-267eebb9180a.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-0e5a49b3-cb5a-4aef-a81f-fce50a012a39.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-d0e16ea3-6683-43f4-82a3-80478703ae06.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-dd3e9494-eddb-4861-85f7-2646018d93f6.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-1d24bb63-2b05-4db9-bd6b-983f16a4830e.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-86579ee6-9dae-4274-a5cc-af6812f48da4.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-cf63911a-8501-493e-a375-8b47a9f33358.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-029951e6-8b99-4364-a570-010853deb594.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-288af5a2-ae5a-427a-95e9-b4a658b01386.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-0e18ea40-a2e5-4fa6-989e-e771f6e4b0fc.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e8a382c9-4379-44ab-b1dc-fb598a228105.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-1464fe22-c463-4850-8989-b899510cb10e.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240326220634.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240326220408.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240421105333.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-d0b8d85c-85dc-4843-b4be-d5d48338a44e.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20241019191741.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20241019192648.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240325221330.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-ebad0a67-3012-4466-a4dc-e834104c48f8.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-5c929a9e-a723-43b3-8f3c-f22c83765f9d.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240325224814.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240325225250.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e4a61193-515a-409f-a436-2733abc3a86e.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240325225809.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-37c07418-9cd8-43d9-90e7-0cb43b329025.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-fab24753-9c53-4432-9413-5feba07ae1e3.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-6d4ab7e6-8337-4576-bbf0-79202a1c3331.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-20c15f0d-fb3c-4922-94b1-edcd856658be.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240507105407.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240507110254.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240507110652.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-6fa972ec-5531-48f2-a608-4465d79d4518.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240309085135.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240309090340.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240326214119.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240326214800.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240326215240.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-5be7405c-ee11-4d2b-bea4-9598f10a1b17.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e6a35258-7a78-4489-90b7-e47a4190802b.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240309091503.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240309092121.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e4aaafda-fce1-47f0-8b2b-7261d47b720b.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e4b192a1-3ba7-4f4e-98de-e93f437cff7c.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e9581e51-ffc8-4326-9af4-07816743dc88.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-bc6d05be-3701-4e23-b4ca-6330c949f020.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-54bbcc36-0b00-4142-a6eb-bf2ef48c2213.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240314101439.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-2ed7ae21-16a6-4716-ac89-117a8c76d3db.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-38aee4c1-efd2-495e-8a6d-164d21a129b1.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-710cdd19-98ea-4e96-b579-ff1ebb0d5de9.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20241122182250.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20241122191044.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20241122192038.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20241122192708.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240308174708.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240425120229.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240816113330.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240918110433.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-a1b2d2f9-6895-4749-9bda-9314f08bca68.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-7cf91aa9-8db5-4abe-803e-a9e8f3bcb9e4.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-7c038f2c-b5ee-4229-9449-713fab3b1855.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-1adef9c0-8feb-4836-8997-84bda96e2498.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-9934b4a2-c253-4d42-acf4-c6c940840779.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-886ee2a8-fb02-4908-bbba-d4ad2a211094.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-833dbfb2-7c79-4e7b-a143-8a4a2936cdd8.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-99bcbe82-1d91-41bf-8900-a240856071f5.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240403105313.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240403105754.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-2541fd26-4e84-467d-8d8c-c731154a85d7.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-fc26a4e7-1c8d-4e82-b7f8-1f6b43d16d38.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e08347a6-efd5-47c0-9adb-23baff82dbbd.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-08391728-5ba8-42a0-a287-9284451e0ee7.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-b153f782-e2e5-4f98-b251-04f06e16c073.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-d2395b7e-2f31-4ca8-b06d-2cb47afaeb74.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-6be492f7-9f92-4607-a4c4-81a612a3d7bd.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-b5d224c2-53ee-40a3-9efc-2feb7dd3d7a8.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-3b9785b0-6573-4c2d-8b7d-d5d1be799e26.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240420102552.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240420104633.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240420104921.png","https://cdn.tobebetterjavaer.com/stutymore/redis-20240420114025.png","https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png"],"datePublished":"2024-10-31T00:00:00.000Z","dateModified":"2024-12-10T02:22:13.000Z","author":[{"@type":"Person","name":"ä¸‰åˆ†æ¶"}]}</script><meta name="robots" content="all"><meta name="author" content="æ²‰é»˜ç‹äºŒ"><meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Expires" content="0"><meta name="apple-mobile-web-app-capable" content="yes"><script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?5230ac143650bf5eb3c14f3fb9b1d3ec";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
      </script><script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?59aa453e7e706422c636c079fc1cb031";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
      </script><link rel="stylesheet" href="//at.alicdn.com/t/font_3180624_7cy10l7jqqh.css"><link rel="icon" href="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/favicon.ico"><link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><title>Redisé¢è¯•é¢˜ï¼Œ58é“Rediså…«è‚¡æ–‡ï¼ˆ1.9ä¸‡å­—97å¼ æ‰‹ç»˜å›¾ï¼‰ï¼Œé¢æ¸£é€†è¢­å¿…çœ‹ğŸ‘ | äºŒå“¥çš„Javaè¿›é˜¶ä¹‹è·¯</title><meta name="description" content="ä¸‹è½½æ¬¡æ•°è¶… 1 ä¸‡æ¬¡ï¼Œ1.9 ä¸‡å­— 97 å¼ æ‰‹ç»˜å›¾ï¼Œè¯¦è§£ 58 é“ Redis é¢è¯•é«˜é¢‘é¢˜ï¼ˆè®©å¤©ä¸‹æ²¡æœ‰éš¾èƒŒçš„å…«è‚¡ï¼‰ï¼Œé¢æ¸£èƒŒä¼šè¿™äº› Redis å…«è‚¡æ–‡ï¼Œè¿™æ¬¡åŠæ‰“é¢è¯•å®˜ï¼Œæˆ‘è§‰å¾—ç¨³äº†ï¼ˆæ‰‹åŠ¨ dogï¼‰ã€‚">
    <link rel="preload" href="/assets/style-BzmM6pFV.css" as="style"><link rel="stylesheet" href="/assets/style-BzmM6pFV.css">
    <link rel="modulepreload" href="/assets/app-wJXw8B29.js"><link rel="modulepreload" href="/assets/redis.html-BkKzzeQy.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/logo-02.png" alt><!----><span class="vp-site-name hide-in-pad">äºŒå“¥çš„Javaè¿›é˜¶ä¹‹è·¯</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/blog.html" aria-label="åšå®¢"><!--[--><span class="font-icon icon iconfont icon-gaishu" style=""></span><!--]-->åšå®¢<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/home.html" aria-label="è¿›é˜¶ä¹‹è·¯"><!--[--><span class="font-icon icon iconfont icon-lujing" style=""></span><!--]-->è¿›é˜¶ä¹‹è·¯<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/zhishixingqiu/" aria-label="çŸ¥è¯†æ˜Ÿçƒ"><!--[--><span class="font-icon icon iconfont icon-Artboard" style=""></span><!--]-->çŸ¥è¯†æ˜Ÿçƒ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/xuexiluxian/" aria-label="å­¦ä¹ è·¯çº¿"><!--[--><span class="font-icon icon iconfont icon-luxian" style=""></span><!--]-->å­¦ä¹ è·¯çº¿<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/sidebar/sanfene/nixi.html" aria-label="é¢æ¸£é€†è¢­"><!--[--><span class="font-icon icon iconfont icon-zhunbei" style=""></span><!--]-->é¢æ¸£é€†è¢­<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="çè—èµ„æº"><!--[--><span class="font-icon icon iconfont icon-youzhi" style=""></span>çè—èµ„æº<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/pdf/" aria-label="PDFä¸‹è½½"><!--[--><span class="font-icon icon iconfont icon-java" style=""></span><!--]-->PDFä¸‹è½½<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/nice-article/itmind/" aria-label="ç ´è§£åˆé›†"><!--[--><span class="font-icon icon iconfont icon-zhongyaotishi" style=""></span><!--]-->ç ´è§£åˆé›†<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/itwanger/toBeBetterJavaer" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="æœç´¢æ–‡æ¡£"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">æœç´¢æ–‡æ¡£</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/sidebar/sanfene/nixi.html" aria-label="é¢æ¸£é€†è¢­"><!---->é¢æ¸£é€†è¢­<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/sidebar/sanfene/javase.html" aria-label="é¢æ¸£é€†è¢­-Java SE"><!---->é¢æ¸£é€†è¢­-Java SE<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/sidebar/sanfene/collection.html" aria-label="é¢æ¸£é€†è¢­-Javaé›†åˆæ¡†æ¶"><!---->é¢æ¸£é€†è¢­-Javaé›†åˆæ¡†æ¶<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/sidebar/sanfene/javathread.html" aria-label="é¢æ¸£é€†è¢­-Javaå¹¶å‘ç¼–ç¨‹"><!---->é¢æ¸£é€†è¢­-Javaå¹¶å‘ç¼–ç¨‹<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/sidebar/sanfene/jvm.html" aria-label="é¢æ¸£é€†è¢­-JVM"><!---->é¢æ¸£é€†è¢­-JVM<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/sidebar/sanfene/spring.html" aria-label="é¢æ¸£é€†è¢­-Spring"><!---->é¢æ¸£é€†è¢­-Spring<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/sidebar/sanfene/redis.html" aria-label="é¢æ¸£é€†è¢­-Redis"><!---->é¢æ¸£é€†è¢­-Redis<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/sidebar/sanfene/mybatis.html" aria-label="é¢æ¸£é€†è¢­-MyBatis"><!---->é¢æ¸£é€†è¢­-MyBatis<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/sidebar/sanfene/mysql.html" aria-label="é¢æ¸£é€†è¢­-MySQL"><!---->é¢æ¸£é€†è¢­-MySQL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/sidebar/sanfene/os.html" aria-label="é¢æ¸£é€†è¢­-æ“ä½œç³»ç»Ÿ"><!---->é¢æ¸£é€†è¢­-æ“ä½œç³»ç»Ÿ<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/sidebar/sanfene/network.html" aria-label="é¢æ¸£é€†è¢­-è®¡ç®—æœºç½‘ç»œ"><!---->é¢æ¸£é€†è¢­-è®¡ç®—æœºç½‘ç»œ<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/sidebar/sanfene/rocketmq.html" aria-label="é¢æ¸£é€†è¢­-RocketMQ"><!---->é¢æ¸£é€†è¢­-RocketMQ<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/sidebar/sanfene/fenbushi.html" aria-label="é¢æ¸£é€†è¢­-åˆ†å¸ƒå¼"><!---->é¢æ¸£é€†è¢­-åˆ†å¸ƒå¼<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/sidebar/sanfene/weifuwu.html" aria-label="é¢æ¸£é€†è¢­-å¾®æœåŠ¡"><!---->é¢æ¸£é€†è¢­-å¾®æœåŠ¡<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/sidebar/sanfene/shejimoshi.html" aria-label="é¢æ¸£é€†è¢­-è®¾è®¡æ¨¡å¼"><!---->é¢æ¸£é€†è¢­-è®¾è®¡æ¨¡å¼<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/sidebar/sanfene/linux.html" aria-label="é¢æ¸£é€†è¢­-Linux"><!---->é¢æ¸£é€†è¢­-Linux<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Redisé¢è¯•é¢˜ï¼Œ58é“Rediså…«è‚¡æ–‡ï¼ˆ1.9ä¸‡å­—97å¼ æ‰‹ç»˜å›¾ï¼‰ï¼Œé¢æ¸£é€†è¢­å¿…çœ‹ğŸ‘</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">ä¸‰åˆ†æ¶</span></span><span property="author" content="ä¸‰åˆ†æ¶"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-10-31T00:00:00.000Z"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color3 clickable" role="navigation">é¢æ¸£é€†è¢­</span><!--]--><meta property="articleSection" content="é¢æ¸£é€†è¢­"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color3 clickable" role="navigation">é¢æ¸£é€†è¢­</span><!--]--><meta property="keywords" content="é¢æ¸£é€†è¢­"></span><span class="page-word-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon" name="word"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 37686 å­—</span><meta property="wordCount" content="37686"></span><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 126 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT126M"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#åŸºç¡€">åŸºç¡€</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-è¯´è¯´ä»€ä¹ˆæ˜¯-redis">1.è¯´è¯´ä»€ä¹ˆæ˜¯ Redis?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-redis-å¯ä»¥ç”¨æ¥å¹²ä»€ä¹ˆ">2.Redis å¯ä»¥ç”¨æ¥å¹²ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-redis-æœ‰å“ªäº›æ•°æ®ç±»å‹">3.Redis æœ‰å“ªäº›æ•°æ®ç±»å‹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-redis-ä¸ºä»€ä¹ˆå¿«å‘¢">4.Redis ä¸ºä»€ä¹ˆå¿«å‘¢ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-èƒ½è¯´ä¸€ä¸‹-i-o-å¤šè·¯å¤ç”¨å—">5.èƒ½è¯´ä¸€ä¸‹ I/O å¤šè·¯å¤ç”¨å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-redis-ä¸ºä»€ä¹ˆæ—©æœŸé€‰æ‹©å•çº¿ç¨‹">6. Redis ä¸ºä»€ä¹ˆæ—©æœŸé€‰æ‹©å•çº¿ç¨‹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-redis6-0-ä½¿ç”¨å¤šçº¿ç¨‹æ˜¯æ€ä¹ˆå›äº‹">7.Redis6.0 ä½¿ç”¨å¤šçº¿ç¨‹æ˜¯æ€ä¹ˆå›äº‹?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_56-è¯´è¯´-redis-å¸¸ç”¨å‘½ä»¤-è¡¥å……">56.è¯´è¯´ Redis å¸¸ç”¨å‘½ä»¤ï¼ˆè¡¥å……ï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_54-å•çº¿ç¨‹-redis-çš„-qps-æ˜¯å¤šå°‘-è¡¥å……">54.å•çº¿ç¨‹ Redis çš„ QPS æ˜¯å¤šå°‘ï¼Ÿ(è¡¥å……)</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æŒä¹…åŒ–">æŒä¹…åŒ–</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-redis-æŒä¹…åŒ–æ–¹å¼æœ‰å“ªäº›-æœ‰ä»€ä¹ˆåŒºåˆ«">8.Redis æŒä¹…åŒ–â½…å¼æœ‰å“ªäº›ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-rdb-å’Œ-aof-å„è‡ªæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹">9.RDB å’Œ AOF å„è‡ªæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_10-rdb-å’Œ-aof-å¦‚ä½•é€‰æ‹©">10.RDB å’Œ AOF å¦‚ä½•é€‰æ‹©ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_11-redis-çš„æ•°æ®æ¢å¤">11.Redis çš„æ•°æ®æ¢å¤ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_12-redis-4-0-çš„æ··åˆæŒä¹…åŒ–äº†è§£å—">12.Redis 4.0 çš„æ··åˆæŒä¹…åŒ–äº†è§£å—ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#é«˜å¯ç”¨">é«˜å¯ç”¨</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_13-ä¸»ä»å¤åˆ¶äº†è§£å—">13.ä¸»ä»å¤åˆ¶äº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_14-redis-ä¸»ä»æœ‰å‡ ç§å¸¸è§çš„æ‹“æ‰‘ç»“æ„">14.Redis ä¸»ä»æœ‰å‡ ç§å¸¸è§çš„æ‹“æ‰‘ç»“æ„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_15-redis-çš„ä¸»ä»å¤åˆ¶åŸç†äº†è§£å—">15.Redis çš„ä¸»ä»å¤åˆ¶åŸç†äº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_16-è¯´è¯´ä¸»ä»æ•°æ®åŒæ­¥çš„æ–¹å¼">16.è¯´è¯´ä¸»ä»æ•°æ®åŒæ­¥çš„æ–¹å¼ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_17-ä¸»ä»å¤åˆ¶å­˜åœ¨å“ªäº›é—®é¢˜å‘¢">17.ä¸»ä»å¤åˆ¶å­˜åœ¨å“ªäº›é—®é¢˜å‘¢ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_18-redis-å“¨å…µäº†è§£å—">18.Redis å“¨å…µäº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_19-redis-å“¨å…µå®ç°åŸç†çŸ¥é“å—">19.Redis å“¨å…µå®ç°åŸç†çŸ¥é“å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_20-é¢†å¯¼è€…-sentinel-èŠ‚ç‚¹é€‰ä¸¾äº†è§£å—">20.é¢†å¯¼è€… Sentinel èŠ‚ç‚¹é€‰ä¸¾äº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_21-æ–°çš„ä¸»èŠ‚ç‚¹æ˜¯æ€æ ·è¢«æŒ‘é€‰å‡ºæ¥çš„">21.æ–°çš„ä¸»èŠ‚ç‚¹æ˜¯æ€æ ·è¢«æŒ‘é€‰å‡ºæ¥çš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_22-redis-é›†ç¾¤äº†è§£å—">22.Redis é›†ç¾¤äº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_55-redis-clusteräº†è§£å—-è¡¥å……">55.Redis Clusteräº†è§£å—ï¼Ÿï¼ˆè¡¥å……ï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_23-é›†ç¾¤ä¸­æ•°æ®å¦‚ä½•åˆ†åŒº">23.é›†ç¾¤ä¸­æ•°æ®å¦‚ä½•åˆ†åŒºï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_24-èƒ½è¯´è¯´-redis-é›†ç¾¤çš„åŸç†å—">24.èƒ½è¯´è¯´ Redis é›†ç¾¤çš„åŸç†å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_25-è¯´è¯´é›†ç¾¤çš„ä¼¸ç¼©">25.è¯´è¯´é›†ç¾¤çš„ä¼¸ç¼©ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç¼“å­˜è®¾è®¡">ç¼“å­˜è®¾è®¡</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_26-ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜ç©¿é€ã€ç¼“å­˜é›ªå´©äº†è§£å—">26.ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜ç©¿é€ã€ç¼“å­˜é›ªå´©äº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_27-èƒ½è¯´è¯´å¸ƒéš†è¿‡æ»¤å™¨å—">27.èƒ½è¯´è¯´å¸ƒéš†è¿‡æ»¤å™¨å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_28-å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§">28.å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®â¼€è‡´æ€§ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_29-å¦‚ä½•ä¿è¯æœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜çš„ä¸€è‡´">29.å¦‚ä½•ä¿è¯æœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜çš„ä¸€è‡´ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_30-æ€ä¹ˆå¤„ç†çƒ­-key">30.æ€ä¹ˆå¤„ç†çƒ­ keyï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_31-ç¼“å­˜é¢„çƒ­æ€ä¹ˆåšå‘¢">31.ç¼“å­˜é¢„çƒ­æ€ä¹ˆåšå‘¢ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_32-çƒ­ç‚¹-key-é‡å»º-é—®é¢˜-è§£å†³">32.çƒ­ç‚¹ key é‡å»ºï¼Ÿé—®é¢˜ï¼Ÿè§£å†³ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_33-æ— åº•æ´é—®é¢˜å—-å¦‚ä½•è§£å†³">33.æ— åº•æ´é—®é¢˜å—ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#redis-è¿ç»´">Redis è¿ç»´</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_34-redis-æŠ¥å†…å­˜ä¸è¶³æ€ä¹ˆå¤„ç†">34.Redis æŠ¥å†…å­˜ä¸è¶³æ€ä¹ˆå¤„ç†ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_35-redis-key-è¿‡æœŸç­–ç•¥æœ‰å“ªäº›">35.Redis key è¿‡æœŸç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_36-redis-æœ‰å“ªäº›å†…å­˜æ·˜æ±°ç­–ç•¥">36.Redis æœ‰å“ªäº›å†…å­˜æ·˜æ±°ç­–ç•¥ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_37-redis-é˜»å¡-æ€ä¹ˆè§£å†³">37.Redis é˜»å¡ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_38-å¤§-key-é—®é¢˜äº†è§£å—">38.å¤§ key é—®é¢˜äº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_39-redis-å¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ">39.Redis å¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#redis-åº”ç”¨">Redis åº”ç”¨</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_40-ä½¿ç”¨-redis-å¦‚ä½•å®ç°å¼‚æ­¥é˜Ÿåˆ—">40.ä½¿ç”¨ Redis å¦‚ä½•å®ç°å¼‚æ­¥é˜Ÿåˆ—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_41-redis-å¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—">41.Redis å¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_42-redis-æ”¯æŒäº‹åŠ¡å—">42.Redis æ”¯æŒäº‹åŠ¡å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_43-æœ‰-lua-è„šæœ¬æ“ä½œ-redis-çš„ç»éªŒå—">43.æœ‰ Lua è„šæœ¬æ“ä½œ Redis çš„ç»éªŒå—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_44-redis-çš„ç®¡é“pipelineäº†è§£å—">44.Redis çš„ç®¡é“Pipelineäº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_45-redis-å®ç°åˆ†å¸ƒå¼é”äº†è§£å—">45.Redis å®ç°åˆ†å¸ƒå¼é”äº†è§£å—ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#åº•å±‚ç»“æ„">åº•å±‚ç»“æ„</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_46-è¯´è¯´-redis-åº•å±‚æ•°æ®ç»“æ„">46.è¯´è¯´ Redis åº•å±‚æ•°æ®ç»“æ„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_47-redis-çš„-sds-å’Œ-c-ä¸­å­—ç¬¦ä¸²ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿">47.Redis çš„ SDS å’Œ C ä¸­å­—ç¬¦ä¸²ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_48-å­—å…¸æ˜¯å¦‚ä½•å®ç°çš„-rehash-äº†è§£å—">48.å­—å…¸æ˜¯å¦‚ä½•å®ç°çš„ï¼ŸRehash äº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_49-è·³è¡¨æ˜¯å¦‚ä½•å®ç°çš„-åŸç†">49.è·³è¡¨æ˜¯å¦‚ä½•å®ç°çš„ï¼ŸåŸç†ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_50-å‹ç¼©åˆ—è¡¨äº†è§£å—">50.å‹ç¼©åˆ—è¡¨äº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_51-å¿«é€Ÿåˆ—è¡¨-quicklist-äº†è§£å—">51.å¿«é€Ÿåˆ—è¡¨ quicklist äº†è§£å—ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#è¡¥å……">è¡¥å……</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_52-å‡å¦‚-redis-é‡Œé¢æœ‰-1-äº¿ä¸ª-key-å…¶ä¸­æœ‰-10w-ä¸ª-key-æ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„-å¦‚ä½•å°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥">52.å‡å¦‚ Redis é‡Œé¢æœ‰ 1 äº¿ä¸ª keyï¼Œå…¶ä¸­æœ‰ 10w ä¸ª key æ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚ä½•å°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_57-redis-çš„ç§’æ€åœºæ™¯ä¸‹æ‰®æ¼”äº†ä»€ä¹ˆè§’è‰²-è¡¥å……">57.Redis çš„ç§’æ€åœºæ™¯ä¸‹æ‰®æ¼”äº†ä»€ä¹ˆè§’è‰²ï¼Ÿï¼ˆè¡¥å……ï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_58-å®¢æˆ·ç«¯å®•æœºå-redis-æœåŠ¡ç«¯å¦‚ä½•æ„ŸçŸ¥åˆ°">58. å®¢æˆ·ç«¯å®•æœºå Redis æœåŠ¡ç«¯å¦‚ä½•æ„ŸçŸ¥åˆ°ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><p>1.9 ä¸‡å­— 97 å¼ æ‰‹ç»˜å›¾ï¼Œè¯¦è§£ 58 é“ Redis é¢è¯•é«˜é¢‘é¢˜ï¼ˆè®©å¤©ä¸‹æ²¡æœ‰éš¾èƒŒçš„å…«è‚¡ï¼‰ï¼Œé¢æ¸£èƒŒä¼šè¿™äº› Redis å…«è‚¡æ–‡ï¼Œè¿™æ¬¡åŠæ‰“é¢è¯•å®˜ï¼Œæˆ‘è§‰å¾—ç¨³äº†ï¼ˆæ‰‹åŠ¨ dogï¼‰ã€‚æ•´ç†ï¼šæ²‰é»˜ç‹äºŒï¼Œæˆ³<a href="https://mp.weixin.qq.com/s/19u34NXALB1nOlBCE6Eg-Q" target="_blank" rel="noopener noreferrer">è½¬è½½é“¾æ¥</a>ï¼Œä½œè€…ï¼šä¸‰åˆ†æ¶ï¼Œæˆ³<a href="https://mp.weixin.qq.com/s/iJtNJYgirRugNBnzxkbB4Q" target="_blank" rel="noopener noreferrer">åŸæ–‡é“¾æ¥</a>ã€‚</p><h2 id="åŸºç¡€" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€"><span>åŸºç¡€</span></a></h2><h3 id="_1-è¯´è¯´ä»€ä¹ˆæ˜¯-redis" tabindex="-1"><a class="header-anchor" href="#_1-è¯´è¯´ä»€ä¹ˆæ˜¯-redis"><span>1.è¯´è¯´ä»€ä¹ˆæ˜¯ Redis?</span></a></h3><p><a href="https://javabetter.cn/redis/rumen.html" target="_blank" rel="noopener noreferrer">Redis</a> æ˜¯ <strong>Re</strong>mote <strong>Di</strong>ctionary <strong>S</strong>ervice ä¸‰ä¸ªå•è¯ä¸­åŠ ç²—å­—æ¯çš„ç»„åˆï¼Œæ˜¯ä¸€ç§åŸºäºé”®å€¼å¯¹ï¼ˆkey-valueï¼‰çš„ NoSQL æ•°æ®åº“ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-96e079f9-49a3-4c55-b0a4-47d043732b62.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRediså›¾æ ‡" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRediså›¾æ ‡</figcaption></figure><p>ä½†æ¯”ä¸€èˆ¬çš„é”®å€¼å¯¹ï¼Œæ¯”å¦‚ <a href="https://javabetter.cn/collection/hashmap.html" target="_blank" rel="noopener noreferrer">HashMap</a> å¼ºå¤§çš„å¤šï¼ŒRedis ä¸­çš„ value æ”¯æŒ stringï¼ˆå­—ç¬¦ä¸²ï¼‰ã€hashï¼ˆå“ˆå¸Œï¼‰ã€ listï¼ˆåˆ—è¡¨ï¼‰ã€setï¼ˆé›†åˆï¼‰ã€zsetï¼ˆæœ‰åºé›†åˆï¼‰ã€Bitmapsï¼ˆä½å›¾ï¼‰ã€ <a href="https://www.cnblogs.com/54chensongxia/p/13803465.html" target="_blank" rel="noopener noreferrer">HyperLogLog</a>ï¼ˆåŸºæ•°ä¼°ç®—ï¼‰ã€GEOï¼ˆåœ°ç†ä¿¡æ¯å®šä½ï¼‰ç­‰å¤šç§æ•°æ®ç»“æ„ã€‚</p><p>è€Œä¸”å› ä¸º Redis çš„æ‰€æœ‰æ•°æ®éƒ½å­˜æ”¾åœ¨å†…å­˜å½“ä¸­ï¼Œæ‰€ä»¥å®ƒçš„è¯»å†™æ€§èƒ½éå¸¸å‡ºè‰²ã€‚</p><p>ä¸ä»…å¦‚æ­¤ï¼ŒRedis è¿˜å¯ä»¥å°†å†…å­˜æ•°æ®æŒä¹…åŒ–åˆ°ç¡¬ç›˜ä¸Šï¼Œè¿™æ ·åœ¨å‘ç”Ÿç±»ä¼¼æ–­ç”µæˆ–è€…æœºå™¨æ•…éšœçš„æ—¶å€™ï¼Œå†…å­˜ä¸­çš„æ•°æ®å¹¶ä¸ä¼šâ€œä¸¢å¤±â€ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼ŒRedis è¿˜æä¾›äº†é”®è¿‡æœŸã€å‘å¸ƒè®¢é˜…ã€äº‹åŠ¡ã€æµæ°´çº¿ã€Lua è„šæœ¬ç­‰é™„åŠ åŠŸèƒ½ï¼Œæ˜¯äº’è”ç½‘æŠ€æœ¯é¢†åŸŸä¸­ä½¿ç”¨æœ€å¹¿æ³›çš„ç¼“å­˜ä¸­é—´ä»¶ã€‚</p><h4 id="redis-å’Œ-mysql-çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#redis-å’Œ-mysql-çš„åŒºåˆ«"><span>Redis å’Œ MySQL çš„åŒºåˆ«ï¼Ÿ</span></a></h4><ul><li>Redisï¼šæ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ NoSQL æ•°æ®åº“ï¼Œè¯»å†™æ€§èƒ½éå¸¸å¥½ï¼Œæ˜¯äº’è”ç½‘æŠ€æœ¯é¢†åŸŸä¸­ä½¿ç”¨æœ€å¹¿æ³›çš„ç¼“å­˜ä¸­é—´ä»¶ã€‚</li><li>MySQLï¼šæ•°æ®å­˜å‚¨åœ¨ç¡¬ç›˜ä¸­çš„å…³ç³»å‹æ•°æ®åº“ï¼Œé€‚ç”¨äºéœ€è¦äº‹åŠ¡æ”¯æŒå’Œå¤æ‚æŸ¥è¯¢çš„åœºæ™¯ã€‚</li></ul><h4 id="é¡¹ç›®é‡Œå“ªé‡Œç”¨åˆ°äº†-redis" tabindex="-1"><a class="header-anchor" href="#é¡¹ç›®é‡Œå“ªé‡Œç”¨åˆ°äº†-redis"><span>é¡¹ç›®é‡Œå“ªé‡Œç”¨åˆ°äº† Redisï¼Ÿ</span></a></h4><p>åœ¨<a href="https://javabetter.cn/zhishixingqiu/paicoding.html" target="_blank" rel="noopener noreferrer">æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®</a>ä¸­ï¼Œå¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°äº† Redisï¼Œæ¯”å¦‚è¯´ç”¨æˆ·æ´»è·ƒæ’è¡Œæ¦œã€ä½œè€…ç™½åå•ã€å¸¸ç”¨çƒ­ç‚¹æ•°æ®ï¼ˆæ–‡ç« æ ‡ç­¾ã€æ–‡ç« åˆ†ç±»ï¼‰ã€è®¡æ•°ç»Ÿè®¡ï¼ˆæ–‡ç« ç‚¹èµæ”¶è—è¯„è®ºæ•°ç²‰ä¸æ•°ï¼‰ç­‰ç­‰ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240420093229.png" alt="æŠ€æœ¯æ´¾ä¸“æ " tabindex="0" loading="lazy"><figcaption>æŠ€æœ¯æ´¾ä¸“æ </figcaption></figure><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åä¸ºä¸€é¢åŸé¢˜ï¼šè¯´ä¸‹ Redis å’Œ HashMap çš„åŒºåˆ«</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨å•†ä¸šåŒ–ä¸€é¢çš„åŸé¢˜ï¼šRedis å’Œ MySQL çš„åŒºåˆ«</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å†œä¸šé“¶è¡Œé¢ç»åŒå­¦ 7 Java åç«¯é¢è¯•åŸé¢˜ï¼šRedis ç›¸å…³çš„åŸºç¡€çŸ¥è¯†</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åä¸º OD é¢ç»åŒå­¦ 1 ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis çš„äº†è§£, éƒ¨ç½²æ–¹æ¡ˆ?</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å†œä¸šé“¶è¡Œé¢ç»åŒå­¦ 3 Java åç«¯é¢è¯•åŸé¢˜ï¼šé¡¹ç›®é‡Œå“ªé‡Œç”¨åˆ°äº† Redis</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ 360 é¢ç»åŒå­¦ 3 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šç”¨è¿‡ redis å— ç”¨æ¥å¹²ä»€ä¹ˆ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ‹›å•†é“¶è¡Œé¢ç»åŒå­¦ 6 æ‹›é“¶ç½‘ç»œç§‘æŠ€é¢è¯•åŸé¢˜ï¼šäº†è§£ MySQLã€Redis å—ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç™¾åº¦é¢ç»åŒå­¦ 1 æ–‡å¿ƒä¸€è¨€ 25 å®ä¹  Java åç«¯é¢è¯•åŸé¢˜ï¼šé¡¹ç›®ä¸­ä»€ä¹ˆåœ°æ–¹ä½¿ç”¨äº† redis ç¼“å­˜ï¼Œredis ä¸ºä»€ä¹ˆå¿«ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å›½ä¼é›¶ç¢é¢ç»åŒå­¦ 9 é¢è¯•åŸé¢˜ï¼šæ•°æ®åº“ç”¨ä»€ä¹ˆå¤šï¼ˆè¯´äº† Mysql å’Œ Redisï¼‰</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è£è€€é¢ç»åŒå­¦ 4 é¢è¯•åŸé¢˜ï¼šRediså’ŒMySQLçš„åŒºåˆ«ï¼Ÿ</li></ol></blockquote><h3 id="_2-redis-å¯ä»¥ç”¨æ¥å¹²ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_2-redis-å¯ä»¥ç”¨æ¥å¹²ä»€ä¹ˆ"><span>2.Redis å¯ä»¥ç”¨æ¥å¹²ä»€ä¹ˆï¼Ÿ</span></a></h3><p>Redis å¯ä»¥ç”¨æ¥åšç¼“å­˜ã€æ’è¡Œæ¦œã€åˆ†å¸ƒå¼é”ç­‰ç­‰ã€‚</p><p>â‘ ã€ç¼“å­˜</p><p>ç¼“å­˜æ˜¯ Redis æœ€å¸¸è§çš„ç”¨é€”ï¼Œç”±äº Redis çš„æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥è¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼Œè¿œè¶…åŸºäºç£ç›˜å­˜å‚¨çš„æ•°æ®åº“ã€‚ä½¿ç”¨ Redis ç¼“å­˜å¯ä»¥æå¤§åœ°æé«˜åº”ç”¨çš„å“åº”é€Ÿåº¦å’Œååé‡ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-d44c2397-5994-452f-8b7b-eb85d2b87685.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedisç¼“å­˜" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedisç¼“å­˜</figcaption></figure><p>â‘¡ã€æ’è¡Œæ¦œ/è®¡æ•°å™¨</p><p>Redis çš„ ZSet éå¸¸é€‚åˆç”¨æ¥å®ç°æ’è¡Œæ¦œçš„åŠŸèƒ½ï¼Œå¯ä»¥æ ¹æ® scoreï¼ˆåˆ†å€¼ï¼‰è¿›è¡Œæ’åºï¼Œå®æ—¶å±•ç¤ºç”¨æˆ·çš„æ´»è·ƒåº¦ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240420100012.png" alt="æŠ€æœ¯æ´¾é˜…è¯»æ´»è·ƒæ¦œ" tabindex="0" loading="lazy"><figcaption>æŠ€æœ¯æ´¾é˜…è¯»æ´»è·ƒæ¦œ</figcaption></figure><p>åŒæ—¶ Redis çš„åŸå­é€’å¢æ“ä½œå¯ä»¥ç”¨æ¥å®ç°è®¡æ•°å™¨åŠŸèƒ½ã€‚</p><p>â‘¢ã€åˆ†å¸ƒå¼é”</p><p>Redis å¯ä»¥å®ç°åˆ†å¸ƒå¼é”ï¼Œç”¨æ¥æ§åˆ¶è·¨å¤šä¸ªè¿›ç¨‹çš„èµ„æºè®¿é—®ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240808101904.png" alt="äºŒå“¥çš„ PmHub å®æˆ˜æ•™ç¨‹" tabindex="0" loading="lazy"><figcaption>äºŒå“¥çš„ PmHub å®æˆ˜æ•™ç¨‹</figcaption></figure><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å†œä¸šé“¶è¡Œé¢ç»åŒå­¦ 7 Java åç«¯é¢è¯•åŸé¢˜ï¼šRedis ç›¸å…³çš„åŸºç¡€çŸ¥è¯†</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨åŒå­¦ 7 Java åç«¯å®ä¹ ä¸€é¢çš„åŸé¢˜ï¼šè®²ä¸€ä¸‹ä¸ºä»€ä¹ˆè¦ç”¨ Redis å»å­˜æƒé™åˆ—è¡¨ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨åŒå­¦ 20 æµ‹å¼€ä¸€é¢çš„åŸé¢˜ï¼šredis æœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä¸ºä»€ä¹ˆç”¨ redis</li></ol></blockquote><h3 id="_3-redis-æœ‰å“ªäº›æ•°æ®ç±»å‹" tabindex="-1"><a class="header-anchor" href="#_3-redis-æœ‰å“ªäº›æ•°æ®ç±»å‹"><span>3.Redis æœ‰å“ªäº›æ•°æ®ç±»å‹ï¼Ÿ</span></a></h3><p>Redis æœ‰äº”ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œè¿™äº”ç§æ•°æ®ç±»å‹åˆ†åˆ«æ˜¯ï¼šstringï¼ˆå­—ç¬¦ä¸²ï¼‰ã€hashï¼ˆå“ˆå¸Œï¼‰ã€listï¼ˆåˆ—è¡¨ï¼‰ã€setï¼ˆé›†åˆï¼‰ã€sorted setï¼ˆæœ‰åºé›†åˆï¼Œä¹Ÿå« zsetï¼‰ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-10434dc7-c7a3-4c1a-b484-de3fb37669ee.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedisåŸºæœ¬æ•°æ®ç±»å‹" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedisåŸºæœ¬æ•°æ®ç±»å‹</figcaption></figure><h4 id="ç®€å•ä»‹ç»ä¸‹-string" tabindex="-1"><a class="header-anchor" href="#ç®€å•ä»‹ç»ä¸‹-string"><span>ç®€å•ä»‹ç»ä¸‹ stringï¼Ÿ</span></a></h4><p>å­—ç¬¦ä¸²æ˜¯æœ€åŸºç¡€çš„æ•°æ®ç±»å‹ï¼Œkey æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸ç”¨å¤šè¯´ï¼Œvalue å¯ä»¥æ˜¯ï¼š</p><ul><li>å­—ç¬¦ä¸²ï¼ˆç®€å•çš„å­—ç¬¦ä¸²ã€å¤æ‚çš„å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ JSONã€XMLï¼‰ï¼‰</li><li>æ•°å­— ï¼ˆæ•´æ•°ã€æµ®ç‚¹æ•°ï¼‰</li><li>ç”šè‡³æ˜¯äºŒè¿›åˆ¶ï¼ˆå›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ï¼‰ï¼Œä½†æœ€å¤§ä¸èƒ½è¶…è¿‡ 512MBã€‚</li></ul><p>å­—ç¬¦ä¸²ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªå…¸å‹çš„ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li>ç¼“å­˜åŠŸèƒ½</li><li>è®¡æ•°</li><li>å…±äº« Session</li><li>é™é€Ÿ</li></ul><h4 id="ç®€å•ä»‹ç»ä¸‹-hash" tabindex="-1"><a class="header-anchor" href="#ç®€å•ä»‹ç»ä¸‹-hash"><span>ç®€å•ä»‹ç»ä¸‹ hashï¼Ÿ</span></a></h4><p>é”®å€¼å¯¹é›†åˆï¼Œkey æ˜¯å­—ç¬¦ä¸²ï¼Œvalue æ˜¯ä¸€ä¸ª Map é›†åˆï¼Œæ¯”å¦‚è¯´ <code>value = {name: &#39;æ²‰é»˜ç‹äºŒ&#39;, age: 18}</code>ï¼Œname å’Œ age å±äºå­—æ®µ fieldï¼Œæ²‰é»˜ç‹äºŒ å’Œ 18 å±äºå€¼ valueã€‚</p><p>å“ˆå¸Œä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªå…¸å‹åº”ç”¨åœºæ™¯ï¼š</p><ul><li>ç¼“å­˜ç”¨æˆ·ä¿¡æ¯</li><li>ç¼“å­˜å¯¹è±¡</li></ul><h4 id="ä»€ä¹ˆä½¿ç”¨-hash-ç±»å‹è€Œä¸ä½¿ç”¨-string-ç±»å‹åºåˆ—åŒ–å­˜å‚¨" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆä½¿ç”¨-hash-ç±»å‹è€Œä¸ä½¿ç”¨-string-ç±»å‹åºåˆ—åŒ–å­˜å‚¨"><span>ä»€ä¹ˆä½¿ç”¨ hash ç±»å‹è€Œä¸ä½¿ç”¨ string ç±»å‹åºåˆ—åŒ–å­˜å‚¨ï¼Ÿ</span></a></h4><p>æ¥æ„Ÿå—ä¸€ä¸‹ï¼Œä½¿ç”¨å­—ç¬¦ä¸²ç±»å‹å­˜å‚¨ç”¨æˆ·ä¿¡æ¯å’Œä½¿ç”¨å“ˆå¸Œç±»å‹å­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„åŒºåˆ«ï¼š</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240315115713.png" alt="äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯" tabindex="0" loading="lazy"><figcaption>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯</figcaption></figure><p>å¯ä»¥çœ‹å¾—å‡ºï¼Œä½¿ç”¨ hash æ¯”ä½¿ç”¨ string æ›´ä¾¿äºè¿›è¡Œåºåˆ—åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€æ•´ä¸ªç”¨æˆ·å¯¹è±¡åºåˆ—åŒ–ï¼Œç„¶åä½œä¸ºä¸€ä¸ª value å­˜å‚¨åœ¨ Redis ä¸­ï¼Œå­˜å–æ›´åŠ ä¾¿æ·ã€‚</p><h4 id="ç®€å•ä»‹ç»ä¸‹-list" tabindex="-1"><a class="header-anchor" href="#ç®€å•ä»‹ç»ä¸‹-list"><span>ç®€å•ä»‹ç»ä¸‹ listï¼Ÿ</span></a></h4><p>list æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºã€‚å¯ä»¥æ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆå·¦è¾¹ï¼‰æˆ–è€…å°¾éƒ¨ï¼ˆå³è¾¹ï¼‰ã€‚</p><p>åˆ—è¡¨ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªä½¿ç”¨åœºæ™¯ï¼š</p><ul><li>æ¶ˆæ¯é˜Ÿåˆ—</li><li>æ–‡ç« åˆ—è¡¨</li></ul><h4 id="ç®€å•ä»‹ç»ä¸‹-set" tabindex="-1"><a class="header-anchor" href="#ç®€å•ä»‹ç»ä¸‹-set"><span>ç®€å•ä»‹ç»ä¸‹ setï¼Ÿ</span></a></h4><p>é›†åˆæ˜¯å­—ç¬¦ä¸²çš„æ— åºé›†åˆï¼Œé›†åˆä¸­çš„å…ƒç´ æ˜¯å”¯ä¸€çš„ï¼Œä¸å…è®¸é‡å¤ã€‚å’Œ Java é›†åˆæ¡†æ¶ä¸­çš„ Set æœ‰ç›¸ä¼¼ä¹‹å¤„ã€‚</p><p>é›†åˆä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªä½¿ç”¨åœºæ™¯ï¼š</p><ul><li>æ ‡ç­¾ï¼ˆtagï¼‰</li><li>å…±åŒå…³æ³¨</li></ul><h4 id="ç®€å•ä»‹ç»ä¸‹-sorted-set" tabindex="-1"><a class="header-anchor" href="#ç®€å•ä»‹ç»ä¸‹-sorted-set"><span>ç®€å•ä»‹ç»ä¸‹ sorted setï¼Ÿ</span></a></h4><p>Zsetï¼Œæœ‰åºé›†åˆï¼Œæ¯” set å¤šäº†ä¸€ä¸ªæ’åºå±æ€§ scoreï¼ˆåˆ†å€¼ï¼‰ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240315120652.png" alt="äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯" tabindex="0" loading="lazy"><figcaption>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯</figcaption></figure><p>ä¸»è¦åº”ç”¨åœºæ™¯æœ‰ï¼š</p><ul><li>ç”¨æˆ·ç‚¹èµç»Ÿè®¡</li><li>ç”¨æˆ·æ’åº</li></ul><p>æ¯”å¦‚<a href="https://javabetter.cn/zhishixingqiu/paicoding.html" target="_blank" rel="noopener noreferrer">æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®</a>ä¸­ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨ Zset æ¥å®ç°äº†ç”¨æˆ·æœˆåº¦æ´»è·ƒæ’è¡Œæ¦œã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240315120856.png" alt="æŠ€æœ¯æ´¾ç”¨æˆ·æ´»è·ƒæ¦œ" tabindex="0" loading="lazy"><figcaption>æŠ€æœ¯æ´¾ç”¨æˆ·æ´»è·ƒæ¦œ</figcaption></figure><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨å•†ä¸šåŒ–ä¸€é¢çš„åŸé¢˜ï¼šè¯´è¯´ Redis çš„ zsetï¼Œä»€ä¹ˆæ˜¯è·³è¡¨ï¼Œæ’å…¥ä¸€ä¸ªèŠ‚ç‚¹è¦æ„å»ºå‡ å±‚ç´¢å¼•</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 9 é£ä¹¦åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis çš„æ•°æ®ç±»å‹ï¼ŒZSet çš„å®ç°</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³æš‘æœŸå®ä¹ åŒå­¦ E ä¸€é¢é¢è¯•åŸé¢˜ï¼šä½ å¯¹ Redis äº†è§£å¤šå°‘ï¼Œè¯´è¯´å¸¸è§çš„æ•°æ®ç»“æ„å’Œåº”ç”¨åœºæ™¯</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 23 QQ åå°æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis çš„æ•°æ®ç±»å‹</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹é¢ç»åŒå­¦ 7 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šè¯´ä¸€ä¸‹ Redis å¸¸ç”¨çš„æ•°æ®ç»“æ„</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å†œä¸šé“¶è¡Œé¢ç»åŒå­¦ 7 Java åç«¯é¢è¯•åŸé¢˜ï¼šRedis ç›¸å…³çš„åŸºç¡€çŸ¥è¯†</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åä¸ºé¢ç»åŒå­¦ 11 é¢è¯•åŸé¢˜ï¼šé¡¹ç›®ä¸­ä½¿ç”¨äº† redisï¼Œredis æœ‰å“ªäº›æ•°æ®ç±»å‹ï¼Ÿåˆ†åˆ«ä½¿ç”¨çš„åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆä½¿ç”¨ hash ç±»å‹è€Œä¸ä½¿ç”¨ string ç±»å‹åºåˆ—åŒ–å­˜å‚¨ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ OPPO é¢ç»åŒå­¦ 1 é¢è¯•åŸé¢˜ï¼šRediså¸¸è§æ•°æ®ç»“æ„</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç¾å›¢åŒå­¦ 9 ä¸€é¢é¢è¯•åŸé¢˜ï¼šredisçš„æ•°æ®ç»“æ„ç±»å‹ï¼Ÿ</li></ol></blockquote><h3 id="_4-redis-ä¸ºä»€ä¹ˆå¿«å‘¢" tabindex="-1"><a class="header-anchor" href="#_4-redis-ä¸ºä»€ä¹ˆå¿«å‘¢"><span>4.Redis ä¸ºä»€ä¹ˆå¿«å‘¢ï¼Ÿ</span></a></h3><p>Redis çš„é€Ÿåº¦â¾®å¸¸å¿«ï¼Œå•æœºçš„ Redis å°±å¯ä»¥â½€æ’‘æ¯ç§’åå‡ ä¸‡çš„å¹¶å‘ï¼Œæ€§èƒ½æ˜¯ MySQL çš„â¼â¼—å€ã€‚åŸå› ä¸»è¦æœ‰â¼ç‚¹ï¼š</p><p>â‘ ã€<strong>åŸºäºå†…å­˜çš„æ•°æ®å­˜å‚¨</strong>ï¼ŒRedis å°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜å½“ä¸­ï¼Œä½¿å¾—æ•°æ®çš„è¯»å†™æ“ä½œé¿å¼€äº†ç£ç›˜ I/Oã€‚è€Œå†…å­˜çš„è®¿é—®é€Ÿåº¦è¿œè¶…ç¡¬ç›˜ï¼Œè¿™æ˜¯ Redis è¯»å†™é€Ÿåº¦å¿«çš„æ ¹æœ¬åŸå› ã€‚</p><p>â‘¡ã€<strong>å•çº¿ç¨‹æ¨¡å‹</strong>ï¼ŒRedis ä½¿ç”¨å•çº¿ç¨‹æ¨¡å‹æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œè¿™æ„å‘³ç€åœ¨ä»»ä½•æ—¶åˆ»åªæœ‰ä¸€ä¸ªå‘½ä»¤åœ¨æ‰§è¡Œã€‚è¿™æ ·å°±é¿å…äº†çº¿ç¨‹åˆ‡æ¢å’Œé”ç«äº‰å¸¦æ¥çš„æ¶ˆè€—ã€‚</p><p>â‘¢ã€<strong>IO å¤šè·¯å¤â½¤</strong>ï¼ŒåŸºäº Linux çš„ select/epoll æœºåˆ¶ã€‚è¯¥æœºåˆ¶å…è®¸å†…æ ¸ä¸­åŒæ—¶å­˜åœ¨å¤šä¸ªç›‘å¬å¥—æ¥å­—å’Œå·²è¿æ¥å¥—æ¥å­—ï¼Œå†…æ ¸ä¼šä¸€ç›´ç›‘å¬è¿™äº›å¥—æ¥å­—ä¸Šçš„è¿æ¥è¯·æ±‚æˆ–è€…æ•°æ®è¯·æ±‚ï¼Œä¸€æ—¦æœ‰è¯·æ±‚åˆ°è¾¾ï¼Œå°±ä¼šäº¤ç»™ Redis å¤„ç†ï¼Œå°±å®ç°äº†æ‰€è°“çš„ Redis å•ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ª IO è¯»å†™çš„è¯·æ±‚ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e05bca61-4600-495c-b92a-25ac822e034e.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedisä½¿ç”¨IOå¤šè·¯å¤ç”¨å’Œè‡ªèº«äº‹ä»¶æ¨¡å‹" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedisä½¿ç”¨IOå¤šè·¯å¤ç”¨å’Œè‡ªèº«äº‹ä»¶æ¨¡å‹</figcaption></figure><p>â‘£ã€<strong>é«˜æ•ˆçš„æ•°æ®ç»“æ„</strong>ï¼ŒRedis æä¾›äº†å¤šç§é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå¦‚å­—ç¬¦ä¸²ï¼ˆStringï¼‰ã€åˆ—è¡¨ï¼ˆListï¼‰ã€é›†åˆï¼ˆSetï¼‰ã€æœ‰åºé›†åˆï¼ˆSorted Setï¼‰ç­‰ï¼Œè¿™äº›æ•°æ®ç»“æ„ç»è¿‡äº†é«˜åº¦ä¼˜åŒ–ï¼Œèƒ½å¤Ÿæ”¯æŒå¿«é€Ÿçš„æ•°æ®æ“ä½œã€‚</p><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯ Java åç«¯å®ä¹ ä¸€é¢åŸé¢˜ï¼šRedis ä¸ºä»€ä¹ˆè¯»å†™æ€§èƒ½é«˜ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³æ˜¥æ‹›åŒå­¦ K ä¸€é¢é¢è¯•åŸé¢˜ï¼šä¸ºä»€ä¹ˆ redis å¿«ï¼Œæ·˜æ±°ç­–ç•¥ æŒä¹…åŒ–</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 1 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šå•çº¿ç¨‹çš„ Redis ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¾®ä¼—é“¶è¡ŒåŒå­¦ 1 Java åç«¯ä¸€é¢çš„åŸé¢˜ï¼šRedis ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç™¾åº¦é¢ç»åŒå­¦ 1 æ–‡å¿ƒä¸€è¨€ 25 å®ä¹  Java åç«¯é¢è¯•åŸé¢˜ï¼šé¡¹ç›®ä¸­ä»€ä¹ˆåœ°æ–¹ä½¿ç”¨äº† redis ç¼“å­˜ï¼Œredis ä¸ºä»€ä¹ˆå¿«ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¾—ç‰©é¢ç»åŒå­¦ 8 ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis ä¸ºä»€ä¹ˆå¿«</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 21 æŠ–éŸ³å•†åŸä¸€é¢é¢è¯•åŸé¢˜ï¼šredisä¸ºä»€ä¹ˆèƒ½å¤„ç†é«˜å¹¶å‘</li></ol></blockquote><h3 id="_5-èƒ½è¯´ä¸€ä¸‹-i-o-å¤šè·¯å¤ç”¨å—" tabindex="-1"><a class="header-anchor" href="#_5-èƒ½è¯´ä¸€ä¸‹-i-o-å¤šè·¯å¤ç”¨å—"><span>5.èƒ½è¯´ä¸€ä¸‹ I/O å¤šè·¯å¤ç”¨å—ï¼Ÿ</span></a></h3><p>IO å¤šè·¯å¤ç”¨æ˜¯ä¸€ç§é«˜æ•ˆç®¡ç†å¤šä¸ª IO äº‹ä»¶çš„æŠ€æœ¯ï¼Œé€šè¿‡å•çº¿ç¨‹ç›‘æ§å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰ï¼Œå®ç°é«˜å¹¶å‘çš„ IO æ“ä½œã€‚</p><p>å¸¸è§çš„ I/O å¤šè·¯å¤ç”¨æœºåˆ¶åŒ…æ‹¬ selectã€poll å’Œ epoll ç­‰ã€‚</p><table><thead><tr><th>ç‰¹æ€§</th><th><code>select</code></th><th><code>poll</code></th><th><code>epoll</code></th></tr></thead><tbody><tr><td>æ–‡ä»¶æè¿°ç¬¦é™åˆ¶</td><td>å— <code>FD_SETSIZE</code> é™åˆ¶</td><td>æ— é™åˆ¶</td><td>æ— é™åˆ¶</td></tr><tr><td>æ—¶é—´å¤æ‚åº¦</td><td>O(n)</td><td>O(n)</td><td>O(1)</td></tr><tr><td>æ•°æ®å¤åˆ¶</td><td>éœ€è¦</td><td>éœ€è¦</td><td>ä¸éœ€è¦</td></tr><tr><td>å·¥ä½œæ–¹å¼</td><td>çº¿æ€§æ‰«æ</td><td>çº¿æ€§æ‰«æ</td><td>äº‹ä»¶é€šçŸ¥</td></tr><tr><td>å†…æ ¸æ”¯æŒ</td><td>æ‰€æœ‰ UNIX ç³»ç»Ÿ</td><td>æ‰€æœ‰ UNIX ç³»ç»Ÿ</td><td>Linux 2.6 åŠä»¥ä¸Šç‰ˆæœ¬</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>å°‘é‡è¿æ¥</td><td>ä¸­ç­‰è¿æ¥</td><td>å¤§é‡å¹¶å‘è¿æ¥</td></tr></tbody></table><p>æ¯”å¦‚è¯´ä½ æ˜¯ä¸€åæ•°å­¦è€å¸ˆï¼Œä¸Šè¯¾æ—¶æå‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼šâ€œä»Šå¤©è°æ¥è¯æ˜ä¸€ä¸‹å‹¾è‚¡å®šå¾‹ï¼Ÿâ€</p><p>åŒå­¦å°ç‹ä¸¾æ‰‹ï¼Œä½ å°±è®©å°ç‹å›ç­”ï¼›å°æä¸¾æ‰‹ï¼Œä½ å°±è®©å°æå›ç­”ï¼›å°å¼ ä¸¾æ‰‹ï¼Œä½ å°±è®©å°å¼ å›ç­”ã€‚</p><p>è¿™ç§æ¨¡å¼å°±æ˜¯ IO å¤šè·¯å¤ç”¨ï¼Œä½ åªéœ€è¦åœ¨è®²å°ä¸Šç­‰ï¼Œè°ä¸¾æ‰‹è°å›ç­”ï¼Œä¸éœ€è¦ä¸€ä¸ªä¸€ä¸ªå»é—®ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240918114125.png" alt="æœ‰ç›å…ˆç”Ÿï¼šIO å¤šè·¯å¤ç”¨" tabindex="0" loading="lazy"><figcaption>æœ‰ç›å…ˆç”Ÿï¼šIO å¤šè·¯å¤ç”¨</figcaption></figure><p>Redis å°±æ˜¯ä½¿ç”¨ epoll è¿™æ ·çš„ I/O å¤šè·¯å¤ç”¨æœºåˆ¶ï¼Œåœ¨å•çº¿ç¨‹æ¨¡å‹ä¸‹å®ç°é«˜æ•ˆçš„ç½‘ç»œ I/Oï¼Œä»è€Œæ”¯æŒé«˜å¹¶å‘çš„è¯·æ±‚å¤„ç†ã€‚</p><h4 id="ä¸¾ä¾‹å­è¯´ä¸€ä¸‹-i-o-å¤šè·¯å¤ç”¨" tabindex="-1"><a class="header-anchor" href="#ä¸¾ä¾‹å­è¯´ä¸€ä¸‹-i-o-å¤šè·¯å¤ç”¨"><span>ä¸¾ä¾‹å­è¯´ä¸€ä¸‹ I/O å¤šè·¯å¤ç”¨ï¼Ÿ</span></a></h4><p>å‡è®¾ä½ æ˜¯ä¸€ä¸ªè€å¸ˆï¼Œè®© 30 ä¸ªå­¦ç”Ÿè§£ç­”ä¸€é“é¢˜ç›®ï¼Œç„¶åæ£€æŸ¥å­¦ç”Ÿåšçš„æ˜¯å¦æ­£ç¡®ï¼Œä½ æœ‰ä¸‹é¢å‡ ä¸ªé€‰æ‹©ï¼š</p><ul><li>ç¬¬ä¸€ç§é€‰æ‹©ï¼šæŒ‰é¡ºåºé€ä¸ªæ£€æŸ¥ï¼Œå…ˆæ£€æŸ¥ Aï¼Œç„¶åæ˜¯ Bï¼Œä¹‹åæ˜¯ Cã€Dã€‚ã€‚ã€‚è¿™ä¸­é—´å¦‚æœæœ‰ä¸€ä¸ªå­¦ç”Ÿå¡ä½ï¼Œå…¨ç­éƒ½ä¼šè¢«è€½è¯¯ã€‚è¿™ç§æ¨¡å¼å°±å¥½æ¯”ï¼Œä½ ç”¨å¾ªç¯æŒ¨ä¸ªå¤„ç† socketï¼Œæ ¹æœ¬ä¸å…·æœ‰å¹¶å‘èƒ½åŠ›ã€‚</li><li>ç¬¬äºŒç§é€‰æ‹©ï¼šä½ åˆ›å»º 30 ä¸ªåˆ†èº«ï¼Œæ¯ä¸ªåˆ†èº«æ£€æŸ¥ä¸€ä¸ªå­¦ç”Ÿçš„ç­”æ¡ˆæ˜¯å¦æ­£ç¡®ã€‚ è¿™ç§ç±»ä¼¼äºä¸ºæ¯ä¸€ä¸ªç”¨æˆ·åˆ›å»ºä¸€ä¸ªè¿›ç¨‹æˆ–è€…çº¿ç¨‹å¤„ç†è¿æ¥ã€‚</li><li>ç¬¬ä¸‰ç§é€‰æ‹©ï¼Œä½ ç«™åœ¨è®²å°ä¸Šç­‰ï¼Œè°è§£ç­”å®Œè°ä¸¾æ‰‹ã€‚è¿™æ—¶ Cã€D ä¸¾æ‰‹ï¼Œè¡¨ç¤ºä»–ä»¬è§£ç­”é—®é¢˜å®Œæ¯•ï¼Œä½ ä¸‹å»ä¾æ¬¡æ£€æŸ¥ Cã€D çš„ç­”æ¡ˆï¼Œç„¶åç»§ç»­å›åˆ°è®²å°ä¸Šç­‰ã€‚æ­¤æ—¶ Eã€A åˆä¸¾æ‰‹ï¼Œç„¶åå»å¤„ç† E å’Œ Aã€‚</li></ul><p>ç¬¬ä¸€ç§å°±æ˜¯é˜»å¡ IO æ¨¡å‹ï¼Œç¬¬ä¸‰ç§å°±æ˜¯ I/O å¤ç”¨æ¨¡å‹ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-eb541432-d68a-4dd9-b427-96c4dd607d64.png" alt="å›¾ç‰‡æ¥æºäºç½‘ç»œï¼šå¤šè·¯å¤ç”¨æ¨¡å‹" tabindex="0" loading="lazy"><figcaption>å›¾ç‰‡æ¥æºäºç½‘ç»œï¼šå¤šè·¯å¤ç”¨æ¨¡å‹</figcaption></figure><p>Linux ç³»ç»Ÿæœ‰ä¸‰ç§æ–¹å¼å®ç° IO å¤šè·¯å¤ç”¨ï¼šselectã€poll å’Œ epollã€‚</p><p>ä¾‹å¦‚ epoll æ–¹å¼æ˜¯å°†ç”¨æˆ· socket å¯¹åº”çš„ fd æ³¨å†Œè¿› epollï¼Œç„¶å epoll å¸®ä½ ç›‘å¬å“ªäº› socket ä¸Šæœ‰æ¶ˆæ¯åˆ°è¾¾ï¼Œè¿™æ ·å°±é¿å…äº†å¤§é‡çš„æ— ç”¨æ“ä½œã€‚æ­¤æ—¶çš„ socket åº”è¯¥é‡‡ç”¨éé˜»å¡æ¨¡å¼ã€‚</p><p>è¿™æ ·ï¼Œæ•´ä¸ªè¿‡ç¨‹åªåœ¨è¿›è¡Œ selectã€pollã€epoll è¿™äº›è°ƒç”¨çš„æ—¶å€™æ‰ä¼šé˜»å¡ï¼Œæ”¶å‘å®¢æˆ·æ¶ˆæ¯æ˜¯ä¸ä¼šé˜»å¡çš„ï¼Œæ•´ä¸ªè¿›ç¨‹æˆ–è€…çº¿ç¨‹å°±è¢«å……åˆ†åˆ©ç”¨èµ·æ¥ï¼Œè¿™å°±æ˜¯äº‹ä»¶é©±åŠ¨ï¼Œæ‰€è°“çš„ reactor æ¨¡å¼ã€‚</p><h4 id="selectã€poll-å’Œ-epoll-çš„å®ç°åŸç†" tabindex="-1"><a class="header-anchor" href="#selectã€poll-å’Œ-epoll-çš„å®ç°åŸç†"><span>selectã€poll å’Œ epoll çš„å®ç°åŸç†ï¼Ÿ</span></a></h4><p>select ä½¿ç”¨ä½å›¾ç®¡ç† fdï¼Œæ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦å°† fd é›†åˆä»ç”¨æˆ·æ€å¤åˆ¶åˆ°å†…æ ¸æ€ã€‚æœ€å¤§æ”¯æŒ 1024 ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚</p><p>poll ä½¿ç”¨åŠ¨æ€æ•°ç»„ç®¡ç† fdï¼Œçªç ´äº† select çš„æ•°é‡é™åˆ¶ã€‚</p><p>epoll ä½¿ç”¨çº¢é»‘æ ‘å’Œé“¾è¡¨ç®¡ç† fdï¼Œæ¯æ¬¡è°ƒç”¨åªéœ€è¦å°† fd é›†åˆä»ç”¨æˆ·æ€å¤åˆ¶åˆ°å†…æ ¸æ€ä¸€æ¬¡ï¼Œä¸éœ€è¦é‡å¤å¤åˆ¶ã€‚</p><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 21 æŠ–éŸ³å•†åŸä¸€é¢é¢è¯•åŸé¢˜ï¼šioå¤šè·¯å¤ç”¨äº†è§£å—ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹åŒå­¦ 4 ä¸€é¢åŸé¢˜ï¼šIOå¤šè·¯å¤ç”¨ä¸­select/poll/epollå„è‡ªçš„å®ç°åŸç†å’ŒåŒºåˆ«ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦19ç•ªèŒ„å°è¯´ä¸€é¢é¢è¯•åŸé¢˜ï¼šLinuxä¸­çš„IOå¤šè·¯å¤ç”¨</li></ol></blockquote><h3 id="_6-redis-ä¸ºä»€ä¹ˆæ—©æœŸé€‰æ‹©å•çº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#_6-redis-ä¸ºä»€ä¹ˆæ—©æœŸé€‰æ‹©å•çº¿ç¨‹"><span>6. Redis ä¸ºä»€ä¹ˆæ—©æœŸé€‰æ‹©å•çº¿ç¨‹ï¼Ÿ</span></a></h3><p>å®˜æ–¹è§£é‡Šï¼šhttps://redis.io/topics/faq</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-344b8461-98d4-495b-a697-70275b0abad6.png" alt="å®˜æ–¹å•çº¿ç¨‹è§£é‡Š" loading="lazy"> å®˜æ–¹ FAQ è¡¨ç¤ºï¼Œå› ä¸º Redis æ˜¯åŸºäºå†…å­˜çš„æ“ä½œï¼ŒCPU æˆä¸º Redis çš„ç“¶é¢ˆçš„æƒ…å†µå¾ˆå°‘è§ï¼ŒRedis çš„ç“¶é¢ˆæœ€æœ‰å¯èƒ½æ˜¯å†…å­˜çš„å¤§å°æˆ–è€…ç½‘ç»œé™åˆ¶ã€‚</p><p>å¦‚æœæƒ³è¦æœ€å¤§ç¨‹åº¦åˆ©ç”¨ CPUï¼Œå¯ä»¥åœ¨ä¸€å°æœºå™¨ä¸Šå¯åŠ¨å¤šä¸ª Redis å®ä¾‹ã€‚</p><p>PSï¼šç½‘ä¸Šæœ‰è¿™æ ·çš„å›ç­”ï¼Œåæ§½å®˜æ–¹çš„è§£é‡Šæœ‰äº›æ•·è¡ï¼Œå…¶å®å°±æ˜¯å†å²åŸå› ï¼Œå¼€å‘è€…å«Œå¤šçº¿ç¨‹éº»çƒ¦ï¼Œåæ¥è¿™ä¸ª CPU çš„åˆ©ç”¨é—®é¢˜å°±è¢«æŠ›ç»™äº†ä½¿ç”¨è€…ã€‚</p><p>åŒæ—¶ FAQ é‡Œè¿˜æåˆ°äº†ï¼Œ Redis 4.0 ä¹‹åå¼€å§‹å˜æˆå¤šçº¿ç¨‹ï¼Œé™¤äº†ä¸»çº¿ç¨‹å¤–ï¼Œå®ƒä¹Ÿæœ‰åå°çº¿ç¨‹åœ¨å¤„ç†ä¸€äº›è¾ƒä¸ºç¼“æ…¢çš„æ“ä½œï¼Œä¾‹å¦‚æ¸…ç†è„æ•°æ®ã€æ— ç”¨è¿æ¥çš„é‡Šæ”¾ã€å¤§ Key çš„åˆ é™¤ç­‰ç­‰ã€‚</p><h3 id="_7-redis6-0-ä½¿ç”¨å¤šçº¿ç¨‹æ˜¯æ€ä¹ˆå›äº‹" tabindex="-1"><a class="header-anchor" href="#_7-redis6-0-ä½¿ç”¨å¤šçº¿ç¨‹æ˜¯æ€ä¹ˆå›äº‹"><span>7.Redis6.0 ä½¿ç”¨å¤šçº¿ç¨‹æ˜¯æ€ä¹ˆå›äº‹?</span></a></h3><p>Redis ä¸æ˜¯è¯´ç”¨å•çº¿ç¨‹çš„å—ï¼Ÿæ€ä¹ˆ 6.0 æˆäº†å¤šçº¿ç¨‹çš„ï¼Ÿ</p><p>Redis6.0 çš„å¤šçº¿ç¨‹æ˜¯ç”¨å¤šçº¿ç¨‹æ¥å¤„ç†æ•°æ®çš„<strong>è¯»å†™å’Œåè®®è§£æ</strong>ï¼Œä½†æ˜¯ Redis<strong>æ‰§è¡Œå‘½ä»¤</strong>è¿˜æ˜¯å•çº¿ç¨‹çš„ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-b7b24e25-d2dc-4457-994f-95bdb3674b8e.png" alt="Redis6.0å¤šçº¿ç¨‹" loading="lazy"> è¿™æ ·åšçš„â½¬çš„æ˜¯å› ä¸º Redis çš„æ€§èƒ½ç“¶é¢ˆåœ¨äºâ½¹ç»œ IO â½½â¾® CPUï¼Œä½¿â½¤å¤šçº¿ç¨‹èƒ½æå‡ IO è¯»å†™çš„æ•ˆç‡ï¼Œä»â½½æ•´ä½“æâ¾¼ Redis çš„æ€§èƒ½ã€‚</p><h3 id="_56-è¯´è¯´-redis-å¸¸ç”¨å‘½ä»¤-è¡¥å……" tabindex="-1"><a class="header-anchor" href="#_56-è¯´è¯´-redis-å¸¸ç”¨å‘½ä»¤-è¡¥å……"><span>56.è¯´è¯´ Redis å¸¸ç”¨å‘½ä»¤ï¼ˆè¡¥å……ï¼‰</span></a></h3><blockquote><p>2024 å¹´ 04 æœˆ 11 æ—¥å¢è¡¥</p></blockquote><p>â‘ ã€æ“ä½œå­—ç¬¦ä¸²çš„å‘½ä»¤æœ‰ï¼š</p><ul><li><code>SET key value</code>ï¼šè®¾ç½®é”® key çš„å€¼ä¸º valueã€‚</li><li><code>GET key</code>ï¼šè·å–é”® key çš„å€¼ã€‚</li><li><code>DEL key</code>ï¼šåˆ é™¤é”® keyã€‚</li><li><code>INCR key</code>ï¼šå°†é”® key å­˜å‚¨çš„æ•°å€¼å¢ä¸€ã€‚</li><li><code>DECR key</code>ï¼šå°†é”® key å­˜å‚¨çš„æ•°å€¼å‡ä¸€ã€‚</li></ul><p>â‘¡ã€æ“ä½œåˆ—è¡¨çš„å‘½ä»¤æœ‰ï¼š</p><ul><li><code>LPUSH key value</code>ï¼šå°†ä¸€ä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨ key çš„å¤´éƒ¨ã€‚</li><li><code>RPUSH key value</code>ï¼šå°†ä¸€ä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨ key çš„å°¾éƒ¨ã€‚</li><li><code>LPOP key</code>ï¼šç§»é™¤å¹¶è¿”å›åˆ—è¡¨ key çš„å¤´å…ƒç´ ã€‚</li><li><code>RPOP key</code>ï¼šç§»é™¤å¹¶è¿”å›åˆ—è¡¨ key çš„å°¾å…ƒç´ ã€‚</li><li><code>LRANGE key start stop</code>ï¼šè·å–åˆ—è¡¨ key ä¸­æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ ã€‚</li></ul><p>â‘¢ã€æ“ä½œé›†åˆçš„å‘½ä»¤æœ‰ï¼š</p><ul><li><code>SADD key member</code>ï¼šå‘é›†åˆ key æ·»åŠ ä¸€ä¸ªå…ƒç´ ã€‚</li><li><code>SREM key member</code>ï¼šä»é›†åˆ key ä¸­ç§»é™¤ä¸€ä¸ªå…ƒç´ ã€‚</li><li><code>SMEMBERS key</code>ï¼šè¿”å›é›†åˆ key ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚</li></ul><p>â‘£ã€æ“ä½œæœ‰åºé›†åˆçš„å‘½ä»¤æœ‰ï¼š</p><ul><li><code>ZADD key score member</code>ï¼šå‘æœ‰åºé›†åˆ key æ·»åŠ ä¸€ä¸ªæˆå‘˜ï¼Œæˆ–æ›´æ–°å…¶åˆ†æ•°ã€‚</li><li><code>ZRANGE key start stop [WITHSCORES]</code>ï¼šæŒ‰ç…§ç´¢å¼•åŒºé—´è¿”å›æœ‰åºé›†åˆ key ä¸­çš„æˆå‘˜ï¼Œå¯é€‰ WITHSCORES å‚æ•°è¿”å›åˆ†æ•°ã€‚</li><li><code>ZREVRANGE key start stop [WITHSCORES]</code>ï¼šè¿”å›æœ‰åºé›†åˆ key ä¸­ï¼ŒæŒ‡å®šåŒºé—´å†…çš„æˆå‘˜ï¼ŒæŒ‰åˆ†æ•°é€’å‡ã€‚</li><li><code>ZREM key member</code>ï¼šç§»é™¤æœ‰åºé›†åˆ key ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ã€‚</li></ul><p>â‘¤ã€æ“ä½œå“ˆå¸Œçš„å‘½ä»¤æœ‰ï¼š</p><ul><li><code>HSET key field value</code>ï¼šå‘é”®ä¸º key çš„å“ˆå¸Œè¡¨ä¸­è®¾ç½®å­—æ®µ field çš„å€¼ä¸º valueã€‚</li><li><code>HGET key field</code>ï¼šè·å–é”®ä¸º key çš„å“ˆå¸Œè¡¨ä¸­å­—æ®µ field çš„å€¼ã€‚</li><li><code>HGETALL key</code>ï¼šè·å–é”®ä¸º key çš„å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰çš„å­—æ®µå’Œå€¼ã€‚</li><li><code>HDEL key field</code>ï¼šåˆ é™¤é”®ä¸º key çš„å“ˆå¸Œè¡¨ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µã€‚</li></ul><h4 id="è¯¦ç»†è¯´è¯´-set-å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#è¯¦ç»†è¯´è¯´-set-å‘½ä»¤"><span>è¯¦ç»†è¯´è¯´ set å‘½ä»¤ï¼Ÿ</span></a></h4><p>åœ¨ Redis ä¸­ï¼Œè®¾ç½®é”®å€¼å¯¹çš„å‘½ä»¤æ˜¯ setã€‚set å‘½ä»¤æœ‰å‡ ä¸ªå¸¸ç”¨çš„å‚æ•°ï¼š</p><p>â‘ ã€å¯ä»¥é€šè¿‡ EX æˆ– PX ä¸ºé”®è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆç§’æˆ–æ¯«ç§’ï¼‰</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SET</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> session_id</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;xyz&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EX</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3600</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  # è®¾ç½®é”® session_idï¼Œå€¼ä¸º &quot;xyz&quot;ï¼Œè¿‡æœŸæ—¶é—´ä¸º 3600 ç§’</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>â‘¡ã€NX é€‰é¡¹è¡¨ç¤ºåªæœ‰é”®ä¸å­˜åœ¨æ—¶æ‰è®¾ç½®</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SET</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> lock_key</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;locked&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> NX</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>â‘¢ã€XX é€‰é¡¹è¡¨ç¤ºåªæœ‰é”®å­˜åœ¨æ—¶æ‰è®¾ç½®</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SET</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> config</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;new_config&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> XX</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="sadd-å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘" tabindex="-1"><a class="header-anchor" href="#sadd-å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘"><span>sadd å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ</span></a></h4><p>å‘æŒ‡å®š Set ä¸­æ·»åŠ  1 ä¸ªæˆ–å¤šä¸ª memberï¼Œå¦‚æœæŒ‡å®š Set ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªã€‚<strong>æ—¶é—´å¤æ‚åº¦ O(N)</strong> ï¼ŒN ä¸ºæ·»åŠ çš„ member ä¸ªæ•°ã€‚</p><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 1 Java æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šè¯´è¯´ Redis å¸¸ç”¨å‘½ä»¤</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å†œä¸šé“¶è¡Œé¢ç»åŒå­¦ 3 Java åç«¯é¢è¯•åŸé¢˜ï¼šè¯´çš„é‚£ä¹ˆå¥½ï¼ŒRedis è®¾ç½® key value çš„å‡½æ•°æ˜¯å•¥</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹é¢ç»åŒå­¦ 1 éƒ¨é—¨ä¸»ç«™æŠ€æœ¯éƒ¨é¢è¯•åŸé¢˜ï¼šRedis çš„ sadd å‘½ä»¤æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ</li></ol></blockquote><h3 id="_54-å•çº¿ç¨‹-redis-çš„-qps-æ˜¯å¤šå°‘-è¡¥å……" tabindex="-1"><a class="header-anchor" href="#_54-å•çº¿ç¨‹-redis-çš„-qps-æ˜¯å¤šå°‘-è¡¥å……"><span>54.å•çº¿ç¨‹ Redis çš„ QPS æ˜¯å¤šå°‘ï¼Ÿ(è¡¥å……)</span></a></h3><blockquote><p>2024 å¹´ 4 æœˆ 14 æ—¥å¢è¡¥</p></blockquote><p>Redis çš„ QPSï¼ˆQueries Per Secondï¼Œæ¯ç§’æŸ¥è¯¢ç‡ï¼‰å—å¤šç§å› ç´ å½±å“ï¼ŒåŒ…æ‹¬ç¡¬ä»¶é…ç½®ï¼ˆå¦‚ CPUã€å†…å­˜ã€ç½‘ç»œå¸¦å®½ï¼‰ã€æ•°æ®æ¨¡å‹ã€å‘½ä»¤ç±»å‹ã€ç½‘ç»œå»¶è¿Ÿç­‰ã€‚</p><p>æ ¹æ®å®˜æ–¹çš„åŸºå‡†æµ‹è¯•ï¼Œä¸€ä¸ªæ™®é€šæœåŠ¡å™¨çš„ Redis å®ä¾‹é€šå¸¸å¯ä»¥è¾¾åˆ°æ¯ç§’æ•°ä¸‡åˆ°å‡ åä¸‡çš„ QPSã€‚</p><p>å¯ä»¥é€šè¿‡ <code>redis-benchmark</code> å‘½ä»¤è¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-benchmark</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 127.0.0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6379</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 50</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10000</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>-h</code>ï¼šæŒ‡å®š Redis æœåŠ¡å™¨çš„åœ°å€ï¼Œé»˜è®¤æ˜¯ 127.0.0.1ã€‚</li><li><code>-p</code>ï¼šæŒ‡å®š Redis æœåŠ¡å™¨çš„ç«¯å£ï¼Œé»˜è®¤æ˜¯ 6379ã€‚</li><li><code>-c</code>ï¼šå¹¶å‘è¿æ¥æ•°ï¼Œå³åŒæ—¶æœ‰å¤šå°‘ä¸ªå®¢æˆ·ç«¯åœ¨è¿›è¡Œæµ‹è¯•ã€‚</li><li><code>-n</code>ï¼šè¯·æ±‚æ€»æ•°ï¼Œå³æµ‹è¯•è¿‡ç¨‹ä¸­æ€»å…±è¦æ‰§è¡Œå¤šå°‘ä¸ªè¯·æ±‚ã€‚</li></ul><p>æˆ‘æœ¬æœºæ˜¯ä¸€å° macOSï¼Œ4 GHz å››æ ¸ Intel Core i7ï¼Œ32 GB 1867 MHz DDR3ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240408100900.png" alt="äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯" tabindex="0" loading="lazy"><figcaption>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯</figcaption></figure><p>å¯ä»¥çœ‹å¾—å‡ºï¼Œæ¯ç§’èƒ½å¤„ç†è¶…è¿‡ 10 ä¸‡æ¬¡è¯·æ±‚ã€‚</p><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 1 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šå•çº¿ç¨‹ Redis çš„ QPS æ˜¯å¤šå°‘ï¼Ÿ</li></ol></blockquote><p>GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š<a href="https://github.com/itwanger/toBeBetterJavaer" target="_blank" rel="noopener noreferrer">äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯</a>ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&amp;å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š<a href="https://javabetter.cn/overview/" target="_blank" rel="noopener noreferrer">å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹</a></p><p>å¾®ä¿¡æœ <strong>æ²‰é»˜ç‹äºŒ</strong> æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ <strong>222</strong> å³å¯å…è´¹é¢†å–ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="æŒä¹…åŒ–" tabindex="-1"><a class="header-anchor" href="#æŒä¹…åŒ–"><span>æŒä¹…åŒ–</span></a></h2><h3 id="_8-redis-æŒä¹…åŒ–æ–¹å¼æœ‰å“ªäº›-æœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_8-redis-æŒä¹…åŒ–æ–¹å¼æœ‰å“ªäº›-æœ‰ä»€ä¹ˆåŒºåˆ«"><span>8.Redis æŒä¹…åŒ–â½…å¼æœ‰å“ªäº›ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></h3><p>Redis æ”¯æŒä¸¤ç§ä¸»è¦çš„æŒä¹…åŒ–æ–¹å¼ï¼šRDB æŒä¹…åŒ–å’Œ AOFæŒä¹…åŒ–ã€‚è¿™ä¸¤ç§æ–¹å¼å¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åŒæ—¶ä½¿ç”¨ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-3bda4a46-adc3-4f0d-a135-b8ae5d4c0d5d.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedisæŒä¹…åŒ–çš„ä¸¤ç§æ–¹å¼" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedisæŒä¹…åŒ–çš„ä¸¤ç§æ–¹å¼</figcaption></figure><h4 id="è¯´ä¸€ä¸‹-rdb" tabindex="-1"><a class="header-anchor" href="#è¯´ä¸€ä¸‹-rdb"><span>è¯´ä¸€ä¸‹ RDBï¼Ÿ</span></a></h4><p>RDB æŒä¹…åŒ–é€šè¿‡åˆ›å»ºæ•°æ®é›†çš„å¿«ç…§æ¥å·¥ä½œï¼Œåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°† Redis åœ¨æŸä¸€æ—¶åˆ»çš„æ•°æ®çŠ¶æ€ä¿å­˜åˆ°ç£ç›˜çš„ä¸€ä¸ª RDB æ–‡ä»¶ä¸­ã€‚</p><p>å¯é€šè¿‡ save å’Œ bgsave å‘½ä»¤ä¸¤ä¸ªå‘½ä»¤æ¥æ‰‹åŠ¨è§¦å‘ RDB æŒä¹…åŒ–æ“ä½œï¼š</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-ffe56e32-34c5-453d-8859-c2febbe6a038.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šsaveå’Œbgsave" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šsaveå’Œbgsave</figcaption></figure><p><strong>â‘ ã€save å‘½ä»¤</strong>ï¼šä¼šåŒæ­¥åœ°å°† Redis çš„æ‰€æœ‰æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸Šçš„ä¸€ä¸ª RDB æ–‡ä»¶ä¸­ã€‚è¿™ä¸ªæ“ä½œä¼šé˜»å¡æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚ç›´åˆ° RDB æ–‡ä»¶è¢«å®Œå…¨å†™å…¥ç£ç›˜ã€‚</p><p>å½“ Redis æ•°æ®é›†è¾ƒå¤§æ—¶ï¼Œä½¿ç”¨ SAVE å‘½ä»¤ä¼šå¯¼è‡´ Redis æœåŠ¡å™¨åœæ­¢å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚</p><p>ä¸æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé™¤éæ•°æ®é›†éå¸¸å°ï¼Œæˆ–è€…å¯ä»¥æ¥å—æœåŠ¡æš‚æ—¶çš„ä¸å¯ç”¨çŠ¶æ€ã€‚</p><p><strong>â‘¡ã€bgsave å‘½ä»¤</strong>ï¼šä¼šåœ¨åå°å¼‚æ­¥åœ°åˆ›å»º Redis çš„æ•°æ®å¿«ç…§ï¼Œå¹¶å°†å¿«ç…§ä¿å­˜åˆ°ç£ç›˜ä¸Šçš„ RDB æ–‡ä»¶ä¸­ã€‚è¿™ä¸ªå‘½ä»¤ä¼šç«‹å³è¿”å›ï¼ŒRedis æœåŠ¡å™¨å¯ä»¥ç»§ç»­å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ã€‚</p><p>åœ¨ BGSAVE å‘½ä»¤æ‰§è¡ŒæœŸé—´ï¼ŒRedis ä¼šç»§ç»­å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¯¹æœåŠ¡çš„å¯ç”¨æ€§å½±å“è¾ƒå°ã€‚å¿«ç…§çš„åˆ›å»ºè¿‡ç¨‹æ˜¯ç”±ä¸€ä¸ªå­è¿›ç¨‹å®Œæˆçš„ï¼Œä¸»è¿›ç¨‹ä¸ä¼šè¢«é˜»å¡ã€‚æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ‰§è¡Œ RDB æŒä¹…åŒ–çš„æ¨èæ–¹å¼ã€‚</p><p>ä»¥ä¸‹åœºæ™¯ä¼šè‡ªåŠ¨è§¦å‘ RDB æŒä¹…åŒ–ï¼š</p><p>â‘ ã€åœ¨ Redis é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ redis.confï¼‰ä¸­ï¼Œå¯ä»¥é€šè¿‡<code>save &lt;seconds&gt; &lt;changes&gt;</code>æŒ‡ä»¤é…ç½®è‡ªåŠ¨è§¦å‘ RDB æŒä¹…åŒ–çš„æ¡ä»¶ã€‚è¿™ä¸ªæŒ‡ä»¤å¯ä»¥è®¾ç½®å¤šæ¬¡ï¼Œæ¯ä¸ªè®¾ç½®å®šä¹‰äº†ä¸€ä¸ªæ—¶é—´é—´éš”ï¼ˆç§’ï¼‰å’Œè¯¥æ—¶é—´å†…å‘ç”Ÿçš„å˜æ›´æ¬¡æ•°é˜ˆå€¼ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>save 900 1</span></span>
<span class="line"><span>save 300 10</span></span>
<span class="line"><span>save 60 10000</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ„å‘³ç€ï¼š</p><ul><li>å¦‚æœè‡³å°‘æœ‰ 1 ä¸ªé”®è¢«ä¿®æ”¹ï¼Œ900 ç§’åè‡ªåŠ¨è§¦å‘ä¸€æ¬¡ RDB æŒä¹…åŒ–ã€‚</li><li>å¦‚æœè‡³å°‘æœ‰ 10 ä¸ªé”®è¢«ä¿®æ”¹ï¼Œ300 ç§’åè‡ªåŠ¨è§¦å‘ä¸€æ¬¡ RDB æŒä¹…åŒ–ã€‚</li><li>å¦‚æœè‡³å°‘æœ‰ 10000 ä¸ªé”®è¢«ä¿®æ”¹ï¼Œ60 ç§’åè‡ªåŠ¨è§¦å‘ä¸€æ¬¡ RDB æŒä¹…åŒ–ã€‚</li></ul><p>æ»¡è¶³ä»¥ä¸Šä»»ä¸€æ¡ä»¶ï¼ŒRDB æŒä¹…åŒ–å°±ä¼šè¢«è‡ªåŠ¨è§¦å‘ã€‚</p><p>â‘¡ã€å½“ Redis æœåŠ¡å™¨é€šè¿‡ SHUTDOWN å‘½ä»¤æ­£å¸¸å…³é—­æ—¶ï¼Œå¦‚æœæ²¡æœ‰ç¦ç”¨ RDB æŒä¹…åŒ–ï¼ŒRedis ä¼šè‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡ RDB æŒä¹…åŒ–ï¼Œä»¥ç¡®ä¿æ•°æ®åœ¨ä¸‹æ¬¡å¯åŠ¨æ—¶èƒ½å¤Ÿæ¢å¤ã€‚</p><p>â‘¢ã€åœ¨ Redis å¤åˆ¶åœºæ™¯ä¸­ï¼Œå½“ä¸€ä¸ª Redis å®ä¾‹è¢«é…ç½®ä¸ºä»èŠ‚ç‚¹å¹¶ä¸”ä¸ä¸»èŠ‚ç‚¹å»ºç«‹è¿æ¥æ—¶ï¼Œå®ƒå¯èƒ½ä¼šæ ¹æ®é…ç½®æ¥æ”¶ä¸»èŠ‚ç‚¹çš„ RDB æ–‡ä»¶æ¥åˆå§‹åŒ–æ•°æ®é›†ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»èŠ‚ç‚¹ä¼šåœ¨åå°è‡ªåŠ¨è§¦å‘ RDB æŒä¹…åŒ–ï¼Œç„¶åå°†ç”Ÿæˆçš„ RDB æ–‡ä»¶å‘é€ç»™ä»èŠ‚ç‚¹ã€‚</p><h4 id="è¯´ä¸€ä¸‹-aof" tabindex="-1"><a class="header-anchor" href="#è¯´ä¸€ä¸‹-aof"><span>è¯´ä¸€ä¸‹ AOFï¼Ÿ</span></a></h4><p>AOF æŒä¹…åŒ–é€šè¿‡è®°å½•æ¯ä¸ªå†™æ“ä½œå‘½ä»¤å¹¶å°†å…¶è¿½åŠ åˆ° AOF æ–‡ä»¶ä¸­æ¥å·¥ä½œï¼Œæ¢å¤æ—¶é€šè¿‡é‡æ–°æ‰§è¡Œè¿™äº›å‘½ä»¤æ¥é‡å»ºæ•°æ®é›†ã€‚</p><p>AOF çš„ä¸»è¦ä½œç”¨æ˜¯è§£å†³äº†æ•°æ®æŒä¹…åŒ–çš„å®æ—¶æ€§ï¼Œç›®å‰å·²ç»æ˜¯ Redis æŒä¹…åŒ–çš„ä¸»æµæ–¹å¼ã€‚</p><p>AOF çš„å·¥ä½œæµç¨‹æ“ä½œæœ‰å››ä¸ªæ­¥éª¤ï¼šå‘½ä»¤å†™å…¥ã€æ–‡ä»¶åŒæ­¥ã€æ–‡ä»¶é‡å†™ã€é‡å¯åŠ è½½ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-a9fb6202-b1a1-484d-a4fa-fef519090b44.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šAOFå·¥ä½œæµç¨‹" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šAOFå·¥ä½œæµç¨‹</figcaption></figure><p>æµç¨‹å¦‚ä¸‹ï¼š</p><p>1ï¼‰å½“ AOF æŒä¹…åŒ–åŠŸèƒ½è¢«å¯ç”¨æ—¶ï¼ˆé€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½® appendonly å‚æ•°ä¸º yes æ¥å¯ç”¨ï¼‰ï¼ŒRedis æœåŠ¡å™¨ä¼šå°†æ¥æ”¶åˆ°çš„æ‰€æœ‰å†™å‘½ä»¤ï¼ˆæ¯”å¦‚ SET, LPUSH, SADD ç­‰ä¿®æ”¹æ•°æ®çš„å‘½ä»¤ï¼‰è¿½åŠ åˆ° AOF ç¼“å†²åŒºï¼ˆbufferï¼‰çš„æœ«å°¾ã€‚</p><p>2ï¼‰ä¸ºäº†å°†ç¼“å†²åŒºä¸­çš„å‘½ä»¤æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­çš„ AOF æ–‡ä»¶ï¼ŒRedis æä¾›äº†å‡ ç§ä¸åŒçš„åŒæ­¥ç­–ç•¥ï¼š</p><ul><li>alwaysï¼šæ¯æ¬¡å†™å‘½ä»¤éƒ½ä¼šåŒæ­¥åˆ° AOF æ–‡ä»¶ï¼Œè¿™æä¾›äº†æœ€é«˜çš„æ•°æ®å®‰å…¨æ€§ï¼Œä½†å¯èƒ½å› ä¸ºç£ç›˜ I/O çš„å»¶è¿Ÿè€Œå½±å“æ€§èƒ½ã€‚</li><li>everysecï¼ˆé»˜è®¤ï¼‰ï¼šæ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼Œè¿™æ˜¯ä¸€ç§æŠ˜è¡·æ–¹æ¡ˆï¼Œæä¾›äº†è¾ƒå¥½çš„æ€§èƒ½å’Œæ•°æ®å®‰å…¨æ€§ã€‚å¦‚æœç³»ç»Ÿå´©æºƒï¼Œæœ€å¤šå¯èƒ½ä¸¢å¤±æœ€åä¸€ç§’çš„æ•°æ®ã€‚</li><li>noï¼šåªä¼šåœ¨ AOF å…³é—­æˆ– Redis å…³é—­æ—¶æ‰§è¡Œï¼Œ æˆ–ç”±æ“ä½œç³»ç»Ÿå†…æ ¸è§¦å‘ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå¦‚æœå‘ç”Ÿå®•æœºï¼Œé‚£ä¹ˆä¸¢å¤±çš„æ•°æ®é‡ç”±æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å­˜å†²æ´—ç­–ç•¥å†³å®šã€‚</li></ul><p>3ï¼‰éšç€æ“ä½œçš„ä¸æ–­æ‰§è¡Œï¼ŒAOF æ–‡ä»¶ä¼šä¸æ–­å¢é•¿ï¼Œä¸ºäº†å‡å° AOF æ–‡ä»¶å¤§å°ï¼ŒRedis å¯ä»¥é‡å†™ AOF æ–‡ä»¶ï¼š</p><ul><li>é‡å†™è¿‡ç¨‹ä¸ä¼šè§£æåŸå§‹çš„ AOF æ–‡ä»¶ï¼Œè€Œæ˜¯å°†å½“å‰å†…å­˜ä¸­çš„æ•°æ®åº“çŠ¶æ€è½¬æ¢ä¸ºä¸€ç³»åˆ—å†™å‘½ä»¤ï¼Œç„¶åä¿å­˜åˆ°ä¸€ä¸ªæ–°çš„ AOF æ–‡ä»¶ä¸­ã€‚</li><li>AOF é‡å†™æ“ä½œç”± BGREWRITEAOF å‘½ä»¤è§¦å‘ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹æ¥æ‰§è¡Œé‡å†™æ“ä½œï¼Œå› æ­¤ä¸ä¼šé˜»å¡ä¸»è¿›ç¨‹ã€‚</li><li>é‡å†™è¿‡ç¨‹ä¸­ï¼Œæ–°çš„å†™å‘½ä»¤ä¼šç»§ç»­è¿½åŠ åˆ°æ—§çš„ AOF æ–‡ä»¶ä¸­ï¼ŒåŒæ—¶ä¹Ÿä¼šè¢«è®°å½•åˆ°ä¸€ä¸ªç¼“å†²åŒºä¸­ã€‚ä¸€æ—¦é‡å†™å®Œæˆï¼ŒRedis ä¼šå°†è¿™ä¸ªç¼“å†²åŒºä¸­çš„å‘½ä»¤è¿½åŠ åˆ°æ–°çš„ AOF æ–‡ä»¶ä¸­ï¼Œç„¶ååˆ‡æ¢åˆ°æ–°çš„ AOF æ–‡ä»¶ä¸Šï¼Œä»¥ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ã€‚</li></ul><p>4ï¼‰å½“ Redis æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œå¦‚æœé…ç½®ä¸ºä½¿ç”¨ AOF æŒä¹…åŒ–æ–¹å¼ï¼Œå®ƒä¼šè¯»å– AOF æ–‡ä»¶ä¸­çš„æ‰€æœ‰å‘½ä»¤å¹¶é‡æ–°æ‰§è¡Œå®ƒä»¬ï¼Œä»¥æ¢å¤æ•°æ®åº“çš„çŠ¶æ€ã€‚</p><h4 id="aof-æ–‡ä»¶å­˜å‚¨çš„æ˜¯ä»€ä¹ˆç±»å‹çš„æ•°æ®" tabindex="-1"><a class="header-anchor" href="#aof-æ–‡ä»¶å­˜å‚¨çš„æ˜¯ä»€ä¹ˆç±»å‹çš„æ•°æ®"><span>AOF æ–‡ä»¶å­˜å‚¨çš„æ˜¯ä»€ä¹ˆç±»å‹çš„æ•°æ®ï¼Ÿ</span></a></h4><p>AOF æ–‡ä»¶å­˜å‚¨çš„æ˜¯ Redis æ‰€æœ‰çš„å†™æ“ä½œå‘½ä»¤ï¼Œæ¯”å¦‚ SETã€HSETã€INCR ç­‰ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20241208204853.png" alt="äºŒå“¥çš„Java è¿›é˜¶ä¹‹è·¯ï¼šAOFæ–‡ä»¶å†…å®¹" tabindex="0" loading="lazy"><figcaption>äºŒå“¥çš„Java è¿›é˜¶ä¹‹è·¯ï¼šAOFæ–‡ä»¶å†…å®¹</figcaption></figure><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³æ˜¥æ‹›åŒå­¦ K ä¸€é¢é¢è¯•åŸé¢˜ï¼šä¸ºä»€ä¹ˆ redis å¿«ï¼Œæ·˜æ±°ç­–ç•¥ æŒä¹…åŒ–</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹é¢ç»åŒå­¦ 7 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šè¯´ä¸€ä¸‹ Redis çš„æŒä¹…åŒ–æ–¹å¼</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°å…¬å¸é¢ç»åˆé›†åŒå­¦ 1 Java åç«¯é¢è¯•åŸé¢˜ï¼šRedis çš„æŒä¹…åŒ–æ–¹å¼ï¼ŸRDB å’Œ AOF çš„åŒºåˆ«ï¼ŸRedis å®•æœºå“ªç§æ¢å¤çš„æ¯”è¾ƒå¿«ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç¾å›¢é¢ç»åŒå­¦ 18 æˆéƒ½åˆ°å®¶é¢è¯•åŸé¢˜ï¼šredis æŒä¹…åŒ–</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ä½œä¸šå¸®é¢ç»åŒå­¦ 1 Java åç«¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šredisæŒä¹…åŒ–æœºåˆ¶</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ OPPO é¢ç»åŒå­¦ 1 é¢è¯•åŸé¢˜ï¼šRedisæŒä¹…åŒ–æ–¹æ¡ˆ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¾—ç‰©é¢ç»åŒå­¦ 9 é¢è¯•é¢˜ç›®åŸé¢˜ï¼šRedisçš„åŸºæœ¬æ•°æ®ç±»å‹ï¼ŸRedisçš„æŒä¹…åŒ–å‘¢ï¼Ÿæœ‰ä½•ä¼˜ç¼ºç‚¹ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ»´æ»´é¢ç»åŒå­¦ 3 ç½‘çº¦è½¦åç«¯å¼€å‘ä¸€é¢åŸé¢˜ï¼šRedisæŒä¹…åŒ–</li></ol></blockquote><h3 id="_9-rdb-å’Œ-aof-å„è‡ªæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹" tabindex="-1"><a class="header-anchor" href="#_9-rdb-å’Œ-aof-å„è‡ªæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹"><span>9.RDB å’Œ AOF å„è‡ªæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ</span></a></h3><p>RDB æ˜¯ä¸€ä¸ªéå¸¸ç´§å‡‘çš„å•æ–‡ä»¶ï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶ dump.rdbï¼‰ï¼Œä»£è¡¨äº† Redis åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„æ•°æ®å¿«ç…§ã€‚éå¸¸é€‚åˆç”¨äºå¤‡ä»½æ•°æ®ï¼Œæ¯”å¦‚åœ¨å¤œé—´è¿›è¡Œå¤‡ä»½ï¼Œç„¶åå°† RDB æ–‡ä»¶å¤åˆ¶åˆ°è¿œç¨‹æœåŠ¡å™¨ã€‚ä½†å¯èƒ½ä¼šä¸¢å¤±æœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®ã€‚</p><p>AOF çš„æœ€å¤§ä¼˜ç‚¹æ˜¯çµæ´»ï¼Œå®æ—¶æ€§å¥½ï¼Œå¯ä»¥è®¾ç½®ä¸åŒçš„ fsync ç­–ç•¥ï¼Œå¦‚æ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼Œæ¯æ¬¡å†™å…¥å‘½ä»¤å°±åŒæ­¥ï¼Œæˆ–è€…å®Œå…¨ç”±æ“ä½œç³»ç»Ÿæ¥å†³å®šä½•æ—¶åŒæ­¥ã€‚ä½† AOF æ–‡ä»¶å¾€å¾€æ¯”è¾ƒå¤§ï¼Œæ¢å¤é€Ÿåº¦æ…¢ï¼Œå› ä¸ºå®ƒè®°å½•äº†æ¯ä¸ªå†™æ“ä½œã€‚</p><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°å…¬å¸é¢ç»åˆé›†åŒå­¦ 1 Java åç«¯é¢è¯•åŸé¢˜ï¼šRedis çš„æŒä¹…åŒ–æ–¹å¼ï¼ŸRDB å’Œ AOF çš„åŒºåˆ«ï¼ŸRedis å®•æœºå“ªç§æ¢å¤çš„æ¯”è¾ƒå¿«ï¼Ÿ</li></ol></blockquote><h3 id="_10-rdb-å’Œ-aof-å¦‚ä½•é€‰æ‹©" tabindex="-1"><a class="header-anchor" href="#_10-rdb-å’Œ-aof-å¦‚ä½•é€‰æ‹©"><span>10.RDB å’Œ AOF å¦‚ä½•é€‰æ‹©ï¼Ÿ</span></a></h3><p>å¦‚æœéœ€è¦å°½å¯èƒ½å‡å°‘æ•°æ®ä¸¢å¤±ï¼ŒAOF æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚å°¤å…¶æ˜¯åœ¨é¢‘ç¹å†™å…¥çš„ç¯å¢ƒä¸‹ï¼Œè®¾ç½® AOF æ¯ç§’åŒæ­¥å¯ä»¥æœ€å¤§é™åº¦å‡å°‘æ•°æ®ä¸¢å¤±ã€‚</p><p>å¦‚æœæ€§èƒ½æ˜¯é¦–è¦è€ƒè™‘ï¼ŒRDB å¯èƒ½æ›´é€‚åˆã€‚RDB çš„å¿«ç…§ç”Ÿæˆé€šå¸¸å¯¹æ€§èƒ½å½±å“è¾ƒå°ï¼Œå¹¶ä¸”æ•°æ®æ¢å¤é€Ÿåº¦å¿«ã€‚</p><p>å¦‚æœç³»ç»Ÿéœ€è¦ç»å¸¸é‡å¯ï¼Œå¹¶ä¸”å¸Œæœ›ç³»ç»Ÿé‡å¯åå¿«é€Ÿæ¢å¤ï¼ŒRDB å¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚è™½ç„¶ AOF ä¹Ÿæä¾›äº†è‰¯å¥½çš„æ¢å¤èƒ½åŠ›ï¼Œä½†é‡å†™ AOF æ–‡ä»¶å¯èƒ½ä¼šæ¯”è¾ƒæ…¢ã€‚</p><p>åœ¨è®¸å¤šç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒåŒæ—¶å¯ç”¨ RDB å’Œ AOF è¢«è®¤ä¸ºæ˜¯æœ€ä½³å®è·µï¼š</p><ul><li>ä½¿ç”¨ RDB è¿›è¡Œå¿«ç…§å¤‡ä»½ã€‚</li><li>ä½¿ç”¨ AOF ä¿è¯å´©æºƒåçš„æœ€å¤§æ•°æ®å®Œæ•´æ€§ã€‚</li></ul><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç¾å›¢é¢ç»åŒå­¦ 18 æˆéƒ½åˆ°å®¶é¢è¯•åŸé¢˜ï¼šä»€ä¹ˆæ—¶å€™ç”¨ rdb ä»€ä¹ˆæ—¶å€™ç”¨ aof</li></ol></blockquote><h3 id="_11-redis-çš„æ•°æ®æ¢å¤" tabindex="-1"><a class="header-anchor" href="#_11-redis-çš„æ•°æ®æ¢å¤"><span>11.Redis çš„æ•°æ®æ¢å¤ï¼Ÿ</span></a></h3><p>å½“ Redis ä¸­çš„æ•°æ®ä¸¢å¤±æ—¶ï¼Œå¯ä»¥ä» RDB æˆ–è€… AOF ä¸­æ¢å¤æ•°æ®ã€‚</p><p>å¯ä»¥å°† RDB æ–‡ä»¶æˆ–è€… AOF æ–‡ä»¶å¤åˆ¶åˆ° Redis çš„æ•°æ®ç›®å½•ä¸‹ï¼Œç„¶åé‡å¯ Redis æœåŠ¡ï¼ŒRedis ä¼šè‡ªåŠ¨åŠ è½½æ•°æ®æ–‡ä»¶å¹¶æ¢å¤æ•°æ®ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-f9aab5e9-a875-4316-9ec9-0c5650afe5c1.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRediså¯åŠ¨åŠ è½½æ•°æ®" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRediså¯åŠ¨åŠ è½½æ•°æ®</figcaption></figure><p><strong>Redis</strong> å¯åŠ¨æ—¶åŠ è½½æ•°æ®çš„æµç¨‹ï¼š</p><ol><li>AOF å¼€å¯ä¸”å­˜åœ¨ AOF æ–‡ä»¶æ—¶ï¼Œä¼˜å…ˆåŠ è½½ AOF æ–‡ä»¶ã€‚</li><li>AOF å…³é—­æˆ–è€… AOF æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼ŒåŠ è½½ RDB æ–‡ä»¶ã€‚</li></ol><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç¾å›¢é¢ç»åŒå­¦ 4 ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis å†…å­˜ä¸­æ•°æ®ä¸¢å¤±æ€ä¹ˆè§£å†³</li></ol></blockquote><h3 id="_12-redis-4-0-çš„æ··åˆæŒä¹…åŒ–äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_12-redis-4-0-çš„æ··åˆæŒä¹…åŒ–äº†è§£å—"><span>12.Redis 4.0 çš„æ··åˆæŒä¹…åŒ–äº†è§£å—ï¼Ÿ</span></a></h3><p>åœ¨ Redis ä¸­ï¼ŒRDB æŒä¹…åŒ–æ˜¯é€šè¿‡åˆ›å»ºæ•°æ®çš„å¿«ç…§æ¥ä¿å­˜æ•°æ®çš„ï¼Œè€Œ AOF æŒä¹…åŒ–åˆ™æ˜¯é€šè¿‡è®°å½•æ¯ä¸ªå†™å…¥å‘½ä»¤æ¥ä¿å­˜æ•°æ®çš„ã€‚</p><p>ä¸¤ç§æ–¹å¼å„æœ‰ä¼˜ç¼ºç‚¹ã€‚RDB æŒä¹…åŒ–çš„ä¼˜ç‚¹æ˜¯æ¢å¤å¤§æ•°æ®é›†çš„é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œä½†æ˜¯å¯èƒ½ä¼šä¸¢å¤±æœ€åä¸€æ¬¡å¿«ç…§ä»¥åçš„æ•°æ®ã€‚AOF æŒä¹…åŒ–çš„ä¼˜ç‚¹æ˜¯æ•°æ®çš„å®Œæ•´æ€§æ¯”è¾ƒé«˜ï¼Œé€šå¸¸åªä¼šä¸¢å¤±ä¸€ç§’çš„æ•°æ®ï¼Œä½†æ˜¯å¯¹äºå¤§æ•°æ®é›†ï¼ŒAOF æ–‡ä»¶å¯èƒ½ä¼šæ¯”è¾ƒå¤§ï¼Œæ¢å¤çš„é€Ÿåº¦æ¯”è¾ƒæ…¢ã€‚</p><p>åœ¨ Redis 4.0 ç‰ˆæœ¬ä¸­ï¼Œæ··åˆæŒä¹…åŒ–æ¨¡å¼ä¼šåœ¨ AOF é‡å†™çš„æ—¶å€™åŒæ—¶ç”Ÿæˆä¸€ä»½ RDB å¿«ç…§ï¼Œç„¶åå°†è¿™ä»½å¿«ç…§ä½œä¸º AOF æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œæœ€åå†é™„åŠ æ–°çš„å†™å…¥å‘½ä»¤ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-19c531e5-da95-495a-a4c4-d63a0b8bba95.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ··åˆæŒä¹…åŒ–" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ··åˆæŒä¹…åŒ–</figcaption></figure><p>è¿™æ ·ï¼Œå½“éœ€è¦æ¢å¤æ•°æ®æ—¶ï¼ŒRedis å…ˆåŠ è½½ RDB æ–‡ä»¶æ¥æ¢å¤åˆ°å¿«ç…§æ—¶åˆ»çš„çŠ¶æ€ï¼Œç„¶ååº”ç”¨ RDB ä¹‹åè®°å½•çš„ AOF å‘½ä»¤æ¥æ¢å¤ä¹‹åçš„æ•°æ®æ›´æ”¹ï¼Œæ—¢å¿«åˆå¯é ã€‚</p><h4 id="å¦‚ä½•è®¾ç½®æŒä¹…åŒ–æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•è®¾ç½®æŒä¹…åŒ–æ¨¡å¼"><span>å¦‚ä½•è®¾ç½®æŒä¹…åŒ–æ¨¡å¼ï¼Ÿ</span></a></h4><p>å¯ä»¥é€šè¿‡ç¼–è¾‘ Redis çš„é…ç½®æ–‡ä»¶ redis.conf æ¥è¿›è¡Œè®¾ç½®ï¼Œæˆ–è€…åœ¨è¿è¡Œæ—¶é€šè¿‡ Redis å‘½ä»¤è¡ŒåŠ¨æ€è°ƒæ•´ã€‚</p><p>RDB æŒä¹…åŒ–é€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®å¿«ç…§ï¼ˆsnapshottingï¼‰è§„åˆ™æ¥å¯ç”¨ã€‚è¿™äº›è§„åˆ™å®šä¹‰äº†åœ¨å¤šå°‘ç§’å†…å¦‚æœæœ‰å¤šå°‘ä¸ªé”®è¢«ä¿®æ”¹ï¼Œåˆ™è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡æŒä¹…åŒ–æ“ä½œã€‚</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 900</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">      # å¦‚æœè‡³å°‘æœ‰1ä¸ªé”®è¢«ä¿®æ”¹ï¼Œ900ç§’åè‡ªåŠ¨ä¿å­˜ä¸€æ¬¡</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 300</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     # å¦‚æœè‡³å°‘æœ‰10ä¸ªé”®è¢«ä¿®æ”¹ï¼Œ300ç§’åè‡ªåŠ¨ä¿å­˜ä¸€æ¬¡</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 60</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10000</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">   # å¦‚æœè‡³å°‘æœ‰10000ä¸ªé”®è¢«ä¿®æ”¹ï¼Œ60ç§’åè‡ªåŠ¨ä¿å­˜ä¸€æ¬¡</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>AOF æŒä¹…åŒ–æ˜¯é€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½® appendonly å‚æ•°ä¸º yes æ¥å¯ç”¨çš„ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">appendonly</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥é…ç½® AOF æ–‡ä»¶çš„å†™å…¥é¢‘ç‡ï¼Œè¿™æ˜¯é€šè¿‡ appendfsync è®¾ç½®çš„ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">appendfsync</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> always</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    # æ¯æ¬¡å†™å…¥æ•°æ®éƒ½åŒæ­¥ï¼Œä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œä½†æ€§èƒ½è¾ƒä½</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">appendfsync</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> everysec</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  # æ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼ŒæŠ˜è¡·æ–¹æ¡ˆ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">appendfsync</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> no</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        # ç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶åŒæ­¥ï¼Œæ€§èƒ½æœ€å¥½ï¼Œä½†æ•°æ®å®‰å…¨æ€§æœ€ä½</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ºäº†ä¼˜åŒ– AOF æ–‡ä»¶çš„å¤§å°ï¼ŒRedis å…è®¸è‡ªåŠ¨æˆ–æ‰‹åŠ¨é‡å†™ AOF æ–‡ä»¶ã€‚å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®é‡å†™çš„è§¦å‘æ¡ä»¶ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">auto-aof-rewrite-percentage</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  # å¢é•¿åˆ°åŸå¤§å°çš„100%æ—¶è§¦å‘é‡å†™</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">auto-aof-rewrite-min-size</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 64mb</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">   # AOF æ–‡ä»¶è‡³å°‘è¾¾åˆ°64MBæ—¶æ‰è€ƒè™‘é‡å†™</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰‹åŠ¨æ‰§è¡Œ AOF é‡å†™çš„å‘½ä»¤æ˜¯ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bgrewriteaof</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœå†³å®šåŒæ—¶ä½¿ç”¨ RDB å’Œ AOFï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­åŒæ—¶å¯ç”¨ä¸¤è€…ã€‚</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 900</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">appendonly</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿˜å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€æ›´æ”¹ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> config</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> save</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;900 1 300 10 60 10000&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> config</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> appendonly</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> config</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> appendfsync</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> everysec</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 1 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis çš„æŒä¹…åŒ–æœºåˆ¶ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°å…¬å¸é¢ç»åˆé›†åŒå­¦ 1 Java åç«¯é¢è¯•åŸé¢˜ï¼šRedis å®•æœºå“ªç§æ¢å¤çš„æ¯”è¾ƒå¿«ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç¾å›¢é¢ç»åŒå­¦ 18 æˆéƒ½åˆ°å®¶é¢è¯•åŸé¢˜ï¼šå¦‚ä½•è®¾ç½®æŒä¹…åŒ–æ¨¡å¼</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç¾å›¢é¢ç»åŒå­¦ 4 ä¸€é¢é¢è¯•åŸé¢˜ï¼šä¸šç•Œä½¿ç”¨å“ªä¸€ç§æ•°æ®æŒä¹…åŒ–ï¼Œä¸¤ç§æŒä¹…åŒ–æ–¹æ³•çš„ä¼˜ç¼ºç‚¹</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ä½œä¸šå¸®é¢ç»åŒå­¦ 1 Java åç«¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šä¸¤ç§ RedisæŒä¹…åŒ–æœºåˆ¶å¯ä»¥æ··åˆä½¿ç”¨å—</li></ol></blockquote><p>GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š<a href="https://github.com/itwanger/toBeBetterJavaer" target="_blank" rel="noopener noreferrer">äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯</a>ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&amp;å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š<a href="https://javabetter.cn/overview/" target="_blank" rel="noopener noreferrer">å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹</a></p><p>å¾®ä¿¡æœ <strong>æ²‰é»˜ç‹äºŒ</strong> æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ <strong>222</strong> å³å¯å…è´¹é¢†å–ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="é«˜å¯ç”¨" tabindex="-1"><a class="header-anchor" href="#é«˜å¯ç”¨"><span>é«˜å¯ç”¨</span></a></h2><p>Redis é™¤äº†å•æœºéƒ¨ç½²å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ä¸»ä»å¤åˆ¶ã€å“¨å…µæ¨¡å¼å’Œé›†ç¾¤æ¨¡å¼æ¥å®ç°é«˜å¯ç”¨ã€‚</p><p><strong>ä¸»ä»å¤åˆ¶</strong>ï¼ˆMaster-Slave Replicationï¼‰ï¼šå…è®¸ä¸€ä¸ª Redis æœåŠ¡å™¨ï¼ˆä¸»èŠ‚ç‚¹ï¼‰å°†æ•°æ®å¤åˆ¶åˆ°ä¸€ä¸ªæˆ–å¤šä¸ª Redis æœåŠ¡å™¨ï¼ˆä»èŠ‚ç‚¹ï¼‰ã€‚è¿™ç§æ–¹å¼å¯ä»¥å®ç°è¯»å†™åˆ†ç¦»ï¼Œé€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚</p><p><strong>å“¨å…µæ¨¡å¼</strong>ï¼ˆSentinelï¼‰ï¼šç”¨äºç›‘æ§ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œå®ç°è‡ªåŠ¨æ•…éšœè½¬ç§»å’Œç³»ç»Ÿæ¶ˆæ¯é€šçŸ¥ã€‚å¦‚æœä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œå“¨å…µå¯ä»¥è‡ªåŠ¨å°†ä¸€ä¸ªä»èŠ‚ç‚¹å‡çº§ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</p><p><strong>é›†ç¾¤æ¨¡å¼</strong>ï¼ˆClusterï¼‰ï¼šRedis é›†ç¾¤é€šè¿‡åˆ†ç‰‡çš„æ–¹å¼å­˜å‚¨æ•°æ®ï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨æ•°æ®çš„ä¸€éƒ¨åˆ†ï¼Œç”¨æˆ·è¯·æ±‚å¯ä»¥å¹¶è¡Œå¤„ç†ã€‚é›†ç¾¤æ¨¡å¼æ”¯æŒè‡ªåŠ¨åˆ†åŒºã€æ•…éšœè½¬ç§»ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸åœæœºçš„æƒ…å†µä¸‹è¿›è¡ŒèŠ‚ç‚¹å¢åŠ æˆ–åˆ é™¤ã€‚</p><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åä¸º OD é¢ç»åŒå­¦ 1 ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis çš„äº†è§£, éƒ¨ç½²æ–¹æ¡ˆ?</li></ol></blockquote><h3 id="_13-ä¸»ä»å¤åˆ¶äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_13-ä¸»ä»å¤åˆ¶äº†è§£å—"><span>13.ä¸»ä»å¤åˆ¶äº†è§£å—ï¼Ÿ</span></a></h3><p>ä¸»ä»å¤åˆ¶ï¼ˆMaster-Slave Replicationï¼‰æ˜¯æŒ‡å°†ä¸€å° Redis æœåŠ¡å™¨çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°å…¶ä»–çš„ Redis æœåŠ¡å™¨ã€‚</p><p>å‰è€…ç§°ä¸ºä¸»èŠ‚ç‚¹ï¼ˆmasterï¼‰ï¼Œåè€…ç§°ä¸ºä»èŠ‚ç‚¹ï¼ˆslaveï¼‰ã€‚ä¸”æ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”±ä¸»èŠ‚ç‚¹åˆ°ä»èŠ‚ç‚¹ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-60497f1e-8afb-44b3-bb7a-d4c29e5ac484.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedisä¸»ä»å¤åˆ¶ç®€å›¾" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedisä¸»ä»å¤åˆ¶ç®€å›¾</figcaption></figure><p>åœ¨ Redis ä¸»ä»æ¶æ„ä¸­ï¼Œä¸»èŠ‚ç‚¹è´Ÿè´£å¤„ç†æ‰€æœ‰çš„å†™æ“ä½œï¼Œå¹¶å°†è¿™äº›æ“ä½œå¼‚æ­¥å¤åˆ¶åˆ°ä»èŠ‚ç‚¹ã€‚ä»èŠ‚ç‚¹ä¸»è¦ç”¨äºè¯»å–æ“ä½œï¼Œä»¥åˆ†æ‹…ä¸»èŠ‚ç‚¹çš„å‹åŠ›å’Œæé«˜è¯»æ€§èƒ½ã€‚</p><h4 id="ä¸»ä»å¤åˆ¶ä¸»è¦çš„ä½œç”¨æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#ä¸»ä»å¤åˆ¶ä¸»è¦çš„ä½œç”¨æ˜¯ä»€ä¹ˆ"><span>ä¸»ä»å¤åˆ¶ä¸»è¦çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</span></a></h4><p>â‘ ã€<strong>æ•°æ®å†—ä½™ï¼š</strong> ä¸»ä»å¤åˆ¶å®ç°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼ã€‚</p><p>â‘¡ã€<strong>æ•…éšœæ¢å¤ï¼š</strong> å¦‚æœä¸»èŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œå¯ä»¥å°†ä¸€ä¸ªä»èŠ‚ç‚¹æå‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œä»è€Œå®ç°æ•…éšœçš„å¿«é€Ÿæ¢å¤ã€‚</p><p>é€šå¸¸ä¼šä½¿ç”¨ Sentinel å“¨å…µæ¥å®ç°è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼Œå½“ä¸»èŠ‚ç‚¹æŒ‚æ‰æ—¶ï¼ŒSentinel ä¼šè‡ªåŠ¨å°†ä¸€ä¸ªä»èŠ‚ç‚¹å‡çº§ä¸ºä¸»èŠ‚ç‚¹ï¼Œä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># sentinel.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 26379</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> monitor</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mymaster</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 192.168.1.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6379</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> down-after-milliseconds</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mymaster</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5000</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> failover-timeout</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mymaster</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 60000</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> parallel-syncs</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mymaster</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‡å¦‚æ˜¯ä»èŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œä¸»èŠ‚ç‚¹ä¸å—å½±å“ï¼Œä½†åº”è¯¥å°½å¿«ä¿®å¤å¹¶é‡å¯æŒ‚æ‰çš„ä»èŠ‚ç‚¹ï¼Œä½¿å…¶é‡æ–°åŠ å…¥é›†ç¾¤å¹¶ä»ä¸»èŠ‚ç‚¹åŒæ­¥æ•°æ®ã€‚</p><p>â‘¢ã€<strong>è´Ÿè½½å‡è¡¡ï¼š</strong> åœ¨ä¸»ä»å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥ç”±ä¸»èŠ‚ç‚¹æä¾›å†™æœåŠ¡ï¼Œç”±ä»èŠ‚ç‚¹æä¾›è¯»æœåŠ¡ <em>ï¼ˆå³å†™ Redis æ—¶è¿æ¥ä¸»èŠ‚ç‚¹ï¼Œè¯» Redis æ—¶è¿æ¥ä»èŠ‚ç‚¹ï¼‰</em>ï¼Œåˆ†æ‹…æœåŠ¡å™¨è´Ÿè½½ã€‚å°¤å…¶æ˜¯åœ¨å†™å°‘è¯»å¤šçš„åœºæ™¯ä¸‹ï¼Œé€šè¿‡å¤šä¸ªä»èŠ‚ç‚¹åˆ†æ‹…è¯»è´Ÿè½½ï¼Œå¯ä»¥å¤§å¤§æé«˜ Redis æœåŠ¡å™¨çš„å¹¶å‘é‡ã€‚</p><p>â‘£ã€<strong>é«˜å¯ç”¨åŸºçŸ³ï¼š</strong> é™¤äº†ä¸Šè¿°ä½œç”¨ä»¥å¤–ï¼Œä¸»ä»å¤åˆ¶è¿˜æ˜¯å“¨å…µå’Œé›†ç¾¤èƒ½å¤Ÿå®æ–½çš„ <strong>åŸºç¡€</strong>ã€‚</p><h4 id="ä¸»ä»å¤åˆ¶å‡ºç°æ•°æ®ä¸ä¸€è‡´æ€ä¹ˆåŠ" tabindex="-1"><a class="header-anchor" href="#ä¸»ä»å¤åˆ¶å‡ºç°æ•°æ®ä¸ä¸€è‡´æ€ä¹ˆåŠ"><span>ä¸»ä»å¤åˆ¶å‡ºç°æ•°æ®ä¸ä¸€è‡´æ€ä¹ˆåŠï¼Ÿ</span></a></h4><p>Redis çš„ä¸»ä»å¤åˆ¶æ˜¯å¼‚æ­¥è¿›è¡Œçš„ï¼Œè¿™æ„å‘³ç€ä¸»èŠ‚ç‚¹åœ¨æ‰§è¡Œå®Œå†™æ“ä½œåï¼Œä¼šç«‹å³è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè€Œä¸æ˜¯ç­‰å¾…ä»èŠ‚ç‚¹å®Œæˆæ•°æ®åŒæ­¥ã€‚</p><p>åœ¨ä¸»èŠ‚ç‚¹å°†æ•°æ®åŒæ­¥åˆ°ä»èŠ‚ç‚¹çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°ç½‘ç»œå»¶è¿Ÿæˆ–ä¸­æ–­ï¼Œä»è€Œå¯¼è‡´ä»èŠ‚ç‚¹çš„æ•°æ®æ»åäºä¸»èŠ‚ç‚¹ã€‚</p><p>ä¸ºäº†è§£å†³æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œåº”è¯¥å°½é‡ä¿è¯ä¸»ä»èŠ‚ç‚¹ä¹‹é—´çš„ç½‘ç»œè¿æ¥çŠ¶å†µè‰¯å¥½ï¼Œæ¯”å¦‚è¯´é¿å…åœ¨ä¸åŒæœºæˆ¿ä¹‹é—´éƒ¨ç½²ä¸»ä»èŠ‚ç‚¹ï¼Œä»¥å‡å°‘ç½‘ç»œå»¶è¿Ÿã€‚ä½†å¯èƒ½ä¼šå¸¦æ¥æ–°çš„é—®é¢˜ï¼Œå°±æ˜¯æ•´ä¸ªæœºæˆ¿éƒ½æŒ‚æ‰çš„æƒ…å†µã€‚</p><p>æ­¤å¤–ï¼ŒRedis æœ¬èº«ä¹Ÿæä¾›äº†ä¸€äº›æœºåˆ¶æ¥è§£å†³æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´é€šè¿‡ Redis çš„ <code>INFO replication</code> å‘½ä»¤ç›‘æ§ä¸»ä»èŠ‚ç‚¹çš„å¤åˆ¶è¿›åº¦ï¼ŒåŠæ—¶å‘ç°å’Œå¤„ç†å¤åˆ¶å»¶è¿Ÿã€‚</p><p>å…·ä½“åšæ³•æ˜¯è·å–ä¸»èŠ‚ç‚¹çš„ master_repl_offset å’Œä»èŠ‚ç‚¹çš„ slave_repl_offsetï¼Œè®¡ç®—ä¸¤è€…çš„å·®å€¼ã€‚å¦‚æœå·®å€¼è¶…è¿‡é¢„è®¾çš„é˜ˆå€¼ï¼Œé‡‡å–æªæ–½ï¼ˆå¦‚åœæ­¢ä»èŠ‚ç‚¹çš„æ•°æ®è¯»å–ï¼‰ä»¥å‡å°‘è¯»åˆ°ä¸ä¸€è‡´æ•°æ®çš„æƒ…å†µã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240709135618.png" alt="æå®¢æ—¶é—´ï¼šRedis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜" tabindex="0" loading="lazy"><figcaption>æå®¢æ—¶é—´ï¼šRedis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜</figcaption></figure><h4 id="redisè§£å†³å•ç‚¹æ•…éšœä¸»è¦é ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#redisè§£å†³å•ç‚¹æ•…éšœä¸»è¦é ä»€ä¹ˆ"><span>Redisè§£å†³å•ç‚¹æ•…éšœä¸»è¦é ä»€ä¹ˆï¼Ÿ</span></a></h4><p>ä¸»ä»å¤åˆ¶ï¼Œå½“ä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œå¯ä»¥é€šè¿‡æ‰‹åŠ¨æˆ–è‡ªåŠ¨æ–¹å¼å°†æŸä¸ªä»èŠ‚ç‚¹æå‡ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œç»§ç»­å¯¹å¤–æä¾›æœåŠ¡ï¼Œä»è€Œé¿å…å•ç‚¹æ•…éšœã€‚</p><p>Redis çš„å“¨å…µæœºåˆ¶ï¼ˆSentinelï¼‰å¯ä»¥å®ç°è‡ªåŠ¨åŒ–çš„æ•…éšœè½¬ç§»ï¼Œå½“ä¸»èŠ‚ç‚¹å®•æœºæ—¶ï¼Œå“¨å…µä¼šè‡ªåŠ¨å°†ä¸€ä¸ªä»èŠ‚ç‚¹å‡çº§ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ã€‚</p><p>å¦å¤–ï¼Œé›†ç¾¤æ¨¡å¼ä¸‹ï¼Œå½“æŸä¸ªèŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼ŒRedis Cluster ä¼šè‡ªåŠ¨å°†è¯·æ±‚è·¯ç”±åˆ°å…¶ä»–èŠ‚ç‚¹ï¼Œå¹¶é€šè¿‡ä»èŠ‚ç‚¹è¿›è¡Œæ•…éšœæ¢å¤ã€‚</p><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¾—ç‰©é¢ç»åŒå­¦ 1 é¢è¯•åŸé¢˜ï¼šRedis åˆ†å¸ƒå¼ï¼Œä¸»ä»ï¼Œä¸€ä¸ªèŠ‚ç‚¹æŒ‚æ‰æ€ä¹ˆåŠ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³é¢ç»åŒå­¦ F é¢è¯•åŸé¢˜ï¼šredis çš„ä¸»ä»æ¶æ„å’Œä¸»ä»å“¨å…µåŒºåˆ«</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ”¶é’±å§é¢ç»åŒå­¦ 1 Java åç«¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedisè§£å†³å•ç‚¹æ•…éšœä¸»è¦é ä»€ä¹ˆï¼Ÿä¸»ä»æ¨¡å¼ç”¨çš„æ˜¯å¼‚æ­¥è¿˜æ˜¯åŒæ­¥ï¼Ÿ</li></ol></blockquote><h3 id="_14-redis-ä¸»ä»æœ‰å‡ ç§å¸¸è§çš„æ‹“æ‰‘ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_14-redis-ä¸»ä»æœ‰å‡ ç§å¸¸è§çš„æ‹“æ‰‘ç»“æ„"><span>14.Redis ä¸»ä»æœ‰å‡ ç§å¸¸è§çš„æ‹“æ‰‘ç»“æ„ï¼Ÿ</span></a></h3><p>Redis çš„å¤åˆ¶æ‹“æ‰‘ç»“æ„å¯ä»¥æ”¯æŒå•å±‚æˆ–å¤šå±‚å¤åˆ¶å…³ç³»ï¼Œæ ¹æ®æ‹“æ‰‘å¤æ‚æ€§å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ï¼šä¸€ä¸»ä¸€ä»ã€ä¸€ä¸»å¤šä»ã€æ ‘çŠ¶ä¸»ä»ç»“æ„ã€‚</p><p>1.ä¸€ä¸»ä¸€ä»ç»“æ„</p><p>ä¸€ä¸»ä¸€ä»ç»“æ„æ˜¯æœ€ç®€å•çš„å¤åˆ¶æ‹“æ‰‘ç»“æ„ï¼Œç”¨äºä¸»èŠ‚ç‚¹å‡ºç°å®•æœºæ—¶ä»èŠ‚ç‚¹æä¾›æ•…éšœè½¬ç§»æ”¯æŒã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-5d91a67c-dbff-4a8d-bf9d-1fe7602d5a27.png" alt="ä¸€ä¸»ä¸€ä»ç»“æ„" loading="lazy"> 2.ä¸€ä¸»å¤šä»ç»“æ„</p><p>ä¸€ä¸»å¤šä»ç»“æ„ï¼ˆåˆç§°ä¸ºæ˜Ÿå½¢æ‹“æ‰‘ç»“æ„ï¼‰ä½¿å¾—åº”ç”¨ç«¯å¯ä»¥åˆ©ç”¨å¤šä¸ªä»èŠ‚ç‚¹å®ç°è¯»å†™åˆ†ç¦»ï¼ˆè§å›¾ 6-5ï¼‰ã€‚å¯¹äºè¯»å æ¯”è¾ƒå¤§çš„åœºæ™¯ï¼Œå¯ä»¥æŠŠè¯»å‘½ä»¤å‘é€åˆ°ä»èŠ‚ç‚¹æ¥åˆ†æ‹…ä¸»èŠ‚ç‚¹å‹åŠ›ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-71074254-699a-480b-bbb0-c68f364a380b.png" alt="ä¸€ä¸»å¤šä»ç»“æ„" loading="lazy"> 3.æ ‘çŠ¶ä¸»ä»ç»“æ„</p><p>æ ‘çŠ¶ä¸»ä»ç»“æ„ï¼ˆåˆç§°ä¸ºæ ‘çŠ¶æ‹“æ‰‘ç»“æ„ï¼‰ä½¿å¾—ä»èŠ‚ç‚¹ä¸ä½†å¯ä»¥å¤åˆ¶ä¸»èŠ‚ç‚¹æ•°æ®ï¼ŒåŒæ—¶å¯ä»¥ä½œä¸ºå…¶ä»–ä»èŠ‚ç‚¹çš„ä¸»èŠ‚ç‚¹ç»§ç»­å‘ä¸‹å±‚å¤åˆ¶ã€‚é€šè¿‡å¼•å…¥å¤åˆ¶ä¸­é—´å±‚ï¼Œå¯ä»¥æœ‰æ•ˆé™ä½ä¸»èŠ‚ç‚¹è´Ÿè½½å’Œéœ€è¦ä¼ é€ç»™ä»èŠ‚ç‚¹çš„æ•°æ®é‡ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-dff14203-5e01-4d1b-a775-10ee444ada54.png" alt="æ ‘çŠ¶ä¸»ä»ç»“æ„" tabindex="0" loading="lazy"><figcaption>æ ‘çŠ¶ä¸»ä»ç»“æ„</figcaption></figure><h3 id="_15-redis-çš„ä¸»ä»å¤åˆ¶åŸç†äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_15-redis-çš„ä¸»ä»å¤åˆ¶åŸç†äº†è§£å—"><span>15.Redis çš„ä¸»ä»å¤åˆ¶åŸç†äº†è§£å—ï¼Ÿ</span></a></h3><p>Redis ä¸»ä»å¤åˆ¶çš„å·¥ä½œæµç¨‹å¤§æ¦‚å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ æ­¥ï¼š <img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-21123b1e-68b4-436b-ac84-3365a49a81bd.png" alt="Redisä¸»ä»å¤åˆ¶å·¥ä½œæµç¨‹" loading="lazy"></p><ol><li>ä¿å­˜ä¸»èŠ‚ç‚¹ï¼ˆmasterï¼‰ä¿¡æ¯ è¿™ä¸€æ­¥åªæ˜¯ä¿å­˜ä¸»èŠ‚ç‚¹ä¿¡æ¯ï¼Œä¿å­˜ä¸»èŠ‚ç‚¹çš„ ip å’Œ portã€‚</li><li>ä¸»ä»å»ºç«‹è¿æ¥ ä»èŠ‚ç‚¹ï¼ˆslaveï¼‰å‘ç°æ–°çš„ä¸»èŠ‚ç‚¹åï¼Œä¼šå°è¯•å’Œä¸»èŠ‚ç‚¹å»ºç«‹ç½‘ç»œè¿æ¥ã€‚</li><li>å‘é€ ping å‘½ä»¤ è¿æ¥å»ºç«‹æˆåŠŸåä»èŠ‚ç‚¹å‘é€ ping è¯·æ±‚è¿›è¡Œé¦–æ¬¡é€šä¿¡ï¼Œä¸»è¦æ˜¯æ£€æµ‹ä¸»ä»ä¹‹é—´ç½‘ç»œå¥—æ¥å­—æ˜¯å¦å¯ç”¨ã€ä¸»èŠ‚ç‚¹å½“å‰æ˜¯å¦å¯æ¥å—å¤„ç†å‘½ä»¤ã€‚</li><li>æƒé™éªŒè¯ å¦‚æœä¸»èŠ‚ç‚¹è¦æ±‚å¯†ç éªŒè¯ï¼Œä»èŠ‚ç‚¹å¿…é¡»æ­£ç¡®çš„å¯†ç æ‰èƒ½é€šè¿‡éªŒè¯ã€‚</li><li>åŒæ­¥æ•°æ®é›† ä¸»ä»å¤åˆ¶è¿æ¥æ­£å¸¸é€šä¿¡åï¼Œä¸»èŠ‚ç‚¹ä¼šæŠŠæŒæœ‰çš„æ•°æ®å…¨éƒ¨å‘é€ç»™ä»èŠ‚ç‚¹ã€‚</li><li>å‘½ä»¤æŒç»­å¤åˆ¶ æ¥ä¸‹æ¥ä¸»èŠ‚ç‚¹ä¼šæŒç»­åœ°æŠŠå†™å‘½ä»¤å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä¿è¯ä¸»ä»æ•°æ®ä¸€è‡´æ€§ã€‚</li></ol><h3 id="_16-è¯´è¯´ä¸»ä»æ•°æ®åŒæ­¥çš„æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_16-è¯´è¯´ä¸»ä»æ•°æ®åŒæ­¥çš„æ–¹å¼"><span>16.è¯´è¯´ä¸»ä»æ•°æ®åŒæ­¥çš„æ–¹å¼ï¼Ÿ</span></a></h3><p>Redis åœ¨ 2.8 åŠä»¥ä¸Šç‰ˆæœ¬ä½¿ç”¨ psync å‘½ä»¤å®Œæˆä¸»ä»æ•°æ®åŒæ­¥ï¼ŒåŒæ­¥è¿‡ç¨‹åˆ†ä¸ºï¼šå…¨é‡å¤åˆ¶å’Œéƒ¨åˆ†å¤åˆ¶ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-7518f715-6dee-4e70-b972-8aed9879e451.png" alt="ä¸»ä»æ•°æ®åŒæ­¥æ–¹å¼" tabindex="0" loading="lazy"><figcaption>ä¸»ä»æ•°æ®åŒæ­¥æ–¹å¼</figcaption></figure><p><strong>å…¨é‡å¤åˆ¶</strong> ä¸€èˆ¬ç”¨äºåˆæ¬¡å¤åˆ¶åœºæ™¯ï¼ŒRedis æ—©æœŸæ”¯æŒçš„å¤åˆ¶åŠŸèƒ½åªæœ‰å…¨é‡å¤åˆ¶ï¼Œå®ƒä¼šæŠŠä¸»èŠ‚ç‚¹å…¨éƒ¨æ•°æ®ä¸€æ¬¡æ€§å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œå½“æ•°æ®é‡è¾ƒå¤§æ—¶ï¼Œä¼šå¯¹ä¸»ä»èŠ‚ç‚¹å’Œç½‘ç»œé€ æˆå¾ˆå¤§çš„å¼€é”€ã€‚</p><p>å…¨é‡å¤åˆ¶çš„å®Œæ•´è¿è¡Œæµç¨‹å¦‚ä¸‹ï¼š <img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-aa8d2960-b341-49cc-b04c-201241fd15de.png" alt="å…¨é‡å¤åˆ¶" loading="lazy"></p><ol><li>å‘é€ psync å‘½ä»¤è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œç”±äºæ˜¯ç¬¬ä¸€æ¬¡è¿›è¡Œå¤åˆ¶ï¼Œä»èŠ‚ç‚¹æ²¡æœ‰å¤åˆ¶åç§»é‡å’Œä¸»èŠ‚ç‚¹çš„è¿è¡Œ IDï¼Œæ‰€ä»¥å‘é€ psync-1ã€‚</li><li>ä¸»èŠ‚ç‚¹æ ¹æ® psync-1 è§£æå‡ºå½“å‰ä¸ºå…¨é‡å¤åˆ¶ï¼Œå›å¤+FULLRESYNC å“åº”ã€‚</li><li>ä»èŠ‚ç‚¹æ¥æ”¶ä¸»èŠ‚ç‚¹çš„å“åº”æ•°æ®ä¿å­˜è¿è¡Œ ID å’Œåç§»é‡ offset</li><li>ä¸»èŠ‚ç‚¹æ‰§è¡Œ bgsave ä¿å­˜ RDB æ–‡ä»¶åˆ°æœ¬åœ°</li><li>ä¸»èŠ‚ç‚¹å‘é€ RDB æ–‡ä»¶ç»™ä»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹æŠŠæ¥æ”¶çš„ RDB æ–‡ä»¶ä¿å­˜åœ¨æœ¬åœ°å¹¶ç›´æ¥ä½œä¸ºä»èŠ‚ç‚¹çš„æ•°æ®æ–‡ä»¶</li><li>å¯¹äºä»èŠ‚ç‚¹å¼€å§‹æ¥æ”¶ RDB å¿«ç…§åˆ°æ¥æ”¶å®ŒæˆæœŸé—´ï¼Œä¸»èŠ‚ç‚¹ä»ç„¶å“åº”è¯»å†™å‘½ä»¤ï¼Œå› æ­¤ä¸»èŠ‚ç‚¹ä¼šæŠŠè¿™æœŸé—´å†™å‘½ä»¤æ•°æ®ä¿å­˜åœ¨å¤åˆ¶å®¢æˆ·ç«¯ç¼“å†²åŒºå†…ï¼Œå½“ä»èŠ‚ç‚¹åŠ è½½å®Œ RDB æ–‡ä»¶åï¼Œä¸»èŠ‚ç‚¹å†æŠŠç¼“å†²åŒºå†…çš„æ•°æ®å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä¿è¯ä¸»ä»ä¹‹é—´æ•°æ®ä¸€è‡´æ€§ã€‚</li><li>ä»èŠ‚ç‚¹æ¥æ”¶å®Œä¸»èŠ‚ç‚¹ä¼ é€æ¥çš„å…¨éƒ¨æ•°æ®åä¼šæ¸…ç©ºè‡ªèº«æ—§æ•°æ®</li><li>ä»èŠ‚ç‚¹æ¸…ç©ºæ•°æ®åå¼€å§‹åŠ è½½ RDB æ–‡ä»¶</li><li>ä»èŠ‚ç‚¹æˆåŠŸåŠ è½½å®Œ RDB åï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹å¼€å¯äº† AOF æŒä¹…åŒ–åŠŸèƒ½ï¼Œ å®ƒä¼šç«‹åˆ»åš bgrewriteaof æ“ä½œï¼Œä¸ºäº†ä¿è¯å…¨é‡å¤åˆ¶å AOF æŒä¹…åŒ–æ–‡ä»¶ç«‹åˆ»å¯ç”¨ã€‚</li></ol><p><strong>éƒ¨åˆ†å¤åˆ¶</strong> éƒ¨åˆ†å¤åˆ¶ä¸»è¦æ˜¯ Redis é’ˆå¯¹å…¨é‡å¤åˆ¶çš„è¿‡é«˜å¼€é”€åšå‡ºçš„ä¸€ç§ä¼˜åŒ–æªæ–½ï¼Œ ä½¿ç”¨ psync{runId}{offset}å‘½ä»¤å®ç°ã€‚å½“ä»èŠ‚ç‚¹ï¼ˆslaveï¼‰æ­£åœ¨å¤åˆ¶ä¸»èŠ‚ç‚¹ ï¼ˆmasterï¼‰æ—¶ï¼Œå¦‚æœå‡ºç°ç½‘ç»œé—ªæ–­æˆ–è€…å‘½ä»¤ä¸¢å¤±ç­‰å¼‚å¸¸æƒ…å†µæ—¶ï¼Œä»èŠ‚ç‚¹ä¼šå‘ ä¸»èŠ‚ç‚¹è¦æ±‚è¡¥å‘ä¸¢å¤±çš„å‘½ä»¤æ•°æ®ï¼Œå¦‚æœä¸»èŠ‚ç‚¹çš„å¤åˆ¶ç§¯å‹ç¼“å†²åŒºå†…å­˜åœ¨è¿™éƒ¨åˆ†æ•°æ®åˆ™ç›´æ¥å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œè¿™æ ·å°±å¯ä»¥ä¿æŒä¸»ä»èŠ‚ç‚¹å¤åˆ¶çš„ä¸€è‡´æ€§ã€‚ <img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-87600c72-cc6a-4656-81b2-e71864c97f23.png" alt="éƒ¨åˆ†å¤åˆ¶" loading="lazy"></p><ol><li>å½“ä¸»ä»èŠ‚ç‚¹ä¹‹é—´ç½‘ç»œå‡ºç°ä¸­æ–­æ—¶ï¼Œå¦‚æœè¶…è¿‡ repl-timeout æ—¶é—´ï¼Œä¸»èŠ‚ç‚¹ä¼šè®¤ä¸ºä»èŠ‚ç‚¹æ•…éšœå¹¶ä¸­æ–­å¤åˆ¶è¿æ¥</li><li>ä¸»ä»è¿æ¥ä¸­æ–­æœŸé—´ä¸»èŠ‚ç‚¹ä¾ç„¶å“åº”å‘½ä»¤ï¼Œä½†å› å¤åˆ¶è¿æ¥ä¸­æ–­å‘½ä»¤æ— æ³•å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä¸è¿‡ä¸»èŠ‚ç‚¹å†…éƒ¨å­˜åœ¨çš„å¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼Œä¾ç„¶å¯ä»¥ä¿å­˜æœ€è¿‘ä¸€æ®µæ—¶é—´çš„å†™å‘½ä»¤æ•°æ®ï¼Œé»˜è®¤æœ€å¤§ç¼“å­˜ 1MBã€‚</li><li>å½“ä¸»ä»èŠ‚ç‚¹ç½‘ç»œæ¢å¤åï¼Œä»èŠ‚ç‚¹ä¼šå†æ¬¡è¿ä¸Šä¸»èŠ‚ç‚¹</li><li>å½“ä¸»ä»è¿æ¥æ¢å¤åï¼Œç”±äºä»èŠ‚ç‚¹ä¹‹å‰ä¿å­˜äº†è‡ªèº«å·²å¤åˆ¶çš„åç§»é‡å’Œä¸»èŠ‚ç‚¹çš„è¿è¡Œ IDã€‚å› æ­¤ä¼šæŠŠå®ƒä»¬å½“ä½œ psync å‚æ•°å‘é€ç»™ä¸»èŠ‚ç‚¹ï¼Œè¦æ±‚è¿›è¡Œéƒ¨åˆ†å¤åˆ¶æ“ä½œã€‚</li><li>ä¸»èŠ‚ç‚¹æ¥åˆ° psync å‘½ä»¤åé¦–å…ˆæ ¸å¯¹å‚æ•° runId æ˜¯å¦ä¸è‡ªèº«ä¸€è‡´ï¼Œå¦‚æœä¸€ è‡´ï¼Œè¯´æ˜ä¹‹å‰å¤åˆ¶çš„æ˜¯å½“å‰ä¸»èŠ‚ç‚¹ï¼›ä¹‹åæ ¹æ®å‚æ•° offset åœ¨è‡ªèº«å¤åˆ¶ç§¯å‹ç¼“å†²åŒºæŸ¥æ‰¾ï¼Œå¦‚æœåç§»é‡ä¹‹åçš„æ•°æ®å­˜åœ¨ç¼“å†²åŒºä¸­ï¼Œåˆ™å¯¹ä»èŠ‚ç‚¹å‘é€+CONTINUE å“åº”ï¼Œè¡¨ç¤ºå¯ä»¥è¿›è¡Œéƒ¨åˆ†å¤åˆ¶ã€‚</li><li>ä¸»èŠ‚ç‚¹æ ¹æ®åç§»é‡æŠŠå¤åˆ¶ç§¯å‹ç¼“å†²åŒºé‡Œçš„æ•°æ®å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä¿è¯ä¸»ä»å¤åˆ¶è¿›å…¥æ­£å¸¸çŠ¶æ€ã€‚</li></ol><h3 id="_17-ä¸»ä»å¤åˆ¶å­˜åœ¨å“ªäº›é—®é¢˜å‘¢" tabindex="-1"><a class="header-anchor" href="#_17-ä¸»ä»å¤åˆ¶å­˜åœ¨å“ªäº›é—®é¢˜å‘¢"><span>17.ä¸»ä»å¤åˆ¶å­˜åœ¨å“ªäº›é—®é¢˜å‘¢ï¼Ÿ</span></a></h3><p>ä¸»ä»å¤åˆ¶è™½å¥½ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p><ul><li>ä¸€æ—¦ä¸»èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œéœ€è¦æ‰‹åŠ¨å°†ä¸€ä¸ªä»èŠ‚ç‚¹æ™‹å‡ä¸ºä¸»èŠ‚ç‚¹ï¼ŒåŒæ—¶éœ€è¦ä¿®æ”¹åº”ç”¨æ–¹çš„ä¸»èŠ‚ç‚¹åœ°å€ï¼Œè¿˜éœ€è¦å‘½ä»¤å…¶ä»–ä»èŠ‚ç‚¹å»å¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹ï¼Œæ•´ä¸ªè¿‡ç¨‹éƒ½éœ€è¦äººå·¥å¹²é¢„ã€‚</li><li>ä¸»èŠ‚ç‚¹çš„å†™èƒ½åŠ›å—åˆ°å•æœºçš„é™åˆ¶ã€‚</li><li>ä¸»èŠ‚ç‚¹çš„å­˜å‚¨èƒ½åŠ›å—åˆ°å•æœºçš„é™åˆ¶ã€‚</li></ul><p>ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ Redis çš„é«˜å¯ç”¨é—®é¢˜ï¼Œç¬¬äºŒã€ä¸‰ä¸ªé—®é¢˜å±äº Redis çš„åˆ†å¸ƒå¼é—®é¢˜ã€‚</p><h3 id="_18-redis-å“¨å…µäº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_18-redis-å“¨å…µäº†è§£å—"><span>18.Redis å“¨å…µäº†è§£å—ï¼Ÿ</span></a></h3><p>å“¨å…µï¼ˆSentinelï¼‰æœºåˆ¶æ˜¯ Redis æä¾›çš„ä¸€ä¸ªé«˜å¯ç”¨æ€§è§£å†³æ–¹æ¡ˆï¼Œä¸»è¦ç”¨æ¥ç›‘æ§ Redis ä¸»ä»æ¶æ„ä¸­çš„å®ä¾‹ï¼Œå¹¶åœ¨ä¸»èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶ï¼Œè‡ªåŠ¨è¿›è¡Œæ•…éšœè½¬ç§»ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-8b1a055c-f077-49ff-9432-c194d4fc3639.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedis Sentinel" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedis Sentinel</figcaption></figure><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ¯”äºšè¿ªé¢ç»åŒå­¦ 1 é¢è¯•åŸé¢˜ï¼šRedis çš„å“¨å…µæœºåˆ¶äº†è§£å—ï¼Ÿ</li></ol></blockquote><h3 id="_19-redis-å“¨å…µå®ç°åŸç†çŸ¥é“å—" tabindex="-1"><a class="header-anchor" href="#_19-redis-å“¨å…µå®ç°åŸç†çŸ¥é“å—"><span>19.Redis å“¨å…µå®ç°åŸç†çŸ¥é“å—ï¼Ÿ</span></a></h3><p>å“¨å…µçš„å·¥ä½œæµç¨‹åŒ…æ‹¬å®šæ—¶ç›‘æ§ã€ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿ã€é¢†å¯¼è€… Sentinel èŠ‚ç‚¹é€‰ä¸¾ã€æ•…éšœè½¬ç§»ç­‰ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-4074d72a-886a-4892-8f55-80112005aad8.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedis Sentinelå·¥ä½œæµç¨‹" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedis Sentinelå·¥ä½œæµç¨‹</figcaption></figure><p>æ¯ä¸ª Sentinel å®ä¾‹ä¼šå®šæœŸé€šè¿‡ PING å‘½ä»¤å‘ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹å‘é€å¿ƒè·³åŒ…ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e7708f8d-ef34-4255-b5d0-cb300c649716.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šä¸‰ä¸ªå®šæ—¶ä»»åŠ¡" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šä¸‰ä¸ªå®šæ—¶ä»»åŠ¡</figcaption></figure><p>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹é•¿æ—¶é—´æ²¡æœ‰å“åº” PING å‘½ä»¤ï¼ŒSentinel ä¼šå°†è¯¥èŠ‚ç‚¹æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ã€‚å½“å¤šä¸ª Sentinel åŒæ—¶è®¤ä¸ºä¸€ä¸ªèŠ‚ç‚¹ä¸å¯ç”¨æ—¶ï¼Œè¯¥èŠ‚ç‚¹è¢«æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-11839a24-9249-48a5-8c9d-888aa80d91dc.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿</figcaption></figure><p>å½“ä¸»èŠ‚ç‚¹è¢«ç¡®è®¤ä¸‹çº¿åï¼ŒSentinel ä¹‹é—´ä¼šé€šè¿‡ç±»ä¼¼ Raft çš„é€‰ä¸¾ç®—æ³•è¿›è¡Œåå•†ï¼Œé€‰å‡ºä¸€ä¸ªé¢†å¯¼è€… Sentinel æ¥è´Ÿè´£æ‰§è¡Œæ•…éšœè½¬ç§»ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-0618a5e2-e94f-40d7-888a-e78019ba8f93.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ•…éšœè½¬ç§»" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ•…éšœè½¬ç§»</figcaption></figure><ol><li>å°†æŸä¸ªä»èŠ‚ç‚¹æå‡ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ã€‚</li><li>é€šçŸ¥å…¶ä»–ä»èŠ‚ç‚¹é‡æ–°å¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹çš„æ•°æ®ã€‚</li></ol><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ OPPO é¢ç»åŒå­¦ 1 é¢è¯•åŸé¢˜ï¼šRedisçš„Sentinelå’ŒClusteræ€ä¹ˆç†è§£ï¼Ÿè¯´ä¸€ä¸‹å¤§æ¦‚åŸç†</li></ol></blockquote><h3 id="_20-é¢†å¯¼è€…-sentinel-èŠ‚ç‚¹é€‰ä¸¾äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_20-é¢†å¯¼è€…-sentinel-èŠ‚ç‚¹é€‰ä¸¾äº†è§£å—"><span>20.é¢†å¯¼è€… Sentinel èŠ‚ç‚¹é€‰ä¸¾äº†è§£å—ï¼Ÿ</span></a></h3><p>Redis ä½¿ç”¨ Raft ç®—æ³•å®ç°é¢†å¯¼è€…é€‰ä¸¾çš„ï¼šå½“ä¸»èŠ‚ç‚¹æŒ‚æ‰åï¼Œæ–°çš„ä¸»èŠ‚ç‚¹æ˜¯ç”±å‰©ä½™çš„ä»èŠ‚ç‚¹å‘èµ·é€‰ä¸¾åæ™‹å‡çš„ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240819112712.png" alt="äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šé¢†å¯¼è€…SentinelèŠ‚ç‚¹é€‰ä¸¾" tabindex="0" loading="lazy"><figcaption>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šé¢†å¯¼è€…SentinelèŠ‚ç‚¹é€‰ä¸¾</figcaption></figure><p>â‘ ã€æ¯ä¸ªåœ¨çº¿çš„ Sentinel èŠ‚ç‚¹éƒ½æœ‰èµ„æ ¼æˆä¸ºé¢†å¯¼è€…ï¼Œå½“å®ƒç¡®è®¤ä¸»èŠ‚ç‚¹ä¸‹çº¿æ—¶å€™ï¼Œä¼šå‘å…¶ä»–å“¨å…µèŠ‚ç‚¹å‘é€å‘½ä»¤ï¼Œè¡¨æ˜å¸Œæœ›ç”±è‡ªå·±æ¥æ‰§è¡Œä¸»ä»åˆ‡æ¢ï¼Œå¹¶è®©æ‰€æœ‰å…¶ä»–å“¨å…µè¿›è¡ŒæŠ•ç¥¨ã€‚</p><p>è¿™ä¸ªæŠ•ç¥¨è¿‡ç¨‹ç§°ä¸ºâ€œLeader é€‰ä¸¾â€ã€‚å€™é€‰è€…ä¼šç»™è‡ªå·±å…ˆæŠ• 1 ç¥¨ï¼Œç„¶åå‘å…¶ä»– Sentinel èŠ‚ç‚¹å‘é€æŠ•ç¥¨çš„è¯·æ±‚ã€‚</p><p>â‘¡ã€æ”¶åˆ°è¯·æ±‚çš„ Sentinel èŠ‚ç‚¹ä¼šè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœå€™é€‰è€…çš„æ—¥å¿—ä¸è‡ªå·±çš„æ—¥å¿—ä¸€æ ·æ–°ï¼Œä»»æœŸå·ä¹Ÿå°äºè‡ªå·±ï¼Œä¸”ä¹‹å‰æ²¡æœ‰æŠ•ç¥¨è¿‡ï¼Œå°±ä¼šåŒæ„æŠ•ç¥¨ï¼Œå›å¤ Yã€‚å¦åˆ™å›å¤ Nã€‚</p><p>â‘¢ã€å€™é€‰è€…æ”¶åˆ°æŠ•ç¥¨åä¼šç»Ÿè®¡æ”¯æŒè‡ªå·±çš„å¾—ç¥¨æ•°ï¼Œå¦‚æœå€™é€‰è€…è·å¾—äº†é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°èŠ‚ç‚¹çš„æŠ•ç¥¨æ”¯æŒï¼ˆå³å¤šæ•°åŸåˆ™ï¼‰ï¼Œå®ƒå°†æˆä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ã€‚</p><p>æ–°çš„ä¸»èŠ‚ç‚¹åœ¨ç¡®ç«‹åï¼Œä¼šå‘å…¶ä»–ä»èŠ‚ç‚¹å‘é€å¿ƒè·³ä¿¡å·ï¼Œå‘Šè¯‰å®ƒä»¬è‡ªå·±å·²ç»æˆä¸ºä¸»èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶ä»–èŠ‚ç‚¹çš„çŠ¶æ€é‡ç½®ä¸ºä»èŠ‚ç‚¹ã€‚</p><p>â‘£ã€å¦‚æœå¤šä¸ªèŠ‚ç‚¹åŒæ—¶æˆä¸ºå€™é€‰è€…ï¼Œå¹¶ä¸”éƒ½æœ‰å¯èƒ½è·å¾—è¶³å¤Ÿçš„ç¥¨æ•°ï¼Œè¿™ç§æƒ…å†µä¸‹å¯èƒ½ä¼šå‡ºç°é€‰ç¥¨åˆ†è£‚ã€‚ä¹Ÿå°±æ˜¯æ²¡æœ‰å€™é€‰è€…è·å¾—è¶…è¿‡åŠæ•°çš„é€‰ç¥¨ï¼Œé‚£ä¹ˆè¿™æ¬¡é€‰ä¸¾å°±ä¼šå¤±è´¥ï¼Œæ‰€æœ‰å€™é€‰è€…éƒ½ä¼šå†æ¬¡å‘èµ·é€‰ä¸¾ã€‚</p><p>ä¸ºäº†é˜²æ­¢æ— é™åˆ¶çš„é€‰ä¸¾å¤±è´¥ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šæœ‰ä¸€ä¸ªé€‰ä¸¾è¶…æ—¶æ—¶é—´ï¼Œä¸”æ˜¯éšæœºçš„ã€‚</p><blockquote><p>è¶…æ—¶æ—¶é—´æŒ‡ä»èŠ‚ç‚¹åœ¨æ²¡æœ‰æ”¶åˆ°ä¸»èŠ‚ç‚¹çš„å¿ƒè·³ä¿¡å·æˆ–æ—¥å¿—è¿½åŠ è¯·æ±‚åï¼Œç­‰å¾…å¤šé•¿æ—¶é—´æ‰ä¼šè®¤ä¸ºä¸»èŠ‚ç‚¹å·²æŒ‚æ‰ï¼Œä»è€Œè¿›å…¥å€™é€‰çŠ¶æ€å¹¶å‘èµ·é€‰ä¸¾ã€‚</p></blockquote><p>æ¨èé˜…è¯»ï¼š<a href="https://hoverzheng.github.io/post/technology-blog/blockchain/raft%E7%AE%97%E6%B3%95%E8%AF%A6%E8%A7%A33--%E9%80%89%E4%B8%BB/" target="_blank" rel="noopener noreferrer">Raftç®—æ³•çš„é€‰ä¸»è¿‡ç¨‹è¯¦è§£</a></p><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„8 åç«¯å¼€å‘ç§‹æ‹›ä¸€é¢é¢è¯•åŸé¢˜ï¼šraftä¸»èŠ‚ç‚¹æŒ‚äº†æ€ä¹ˆé€‰ä»èŠ‚ç‚¹</li></ol></blockquote><h3 id="_21-æ–°çš„ä¸»èŠ‚ç‚¹æ˜¯æ€æ ·è¢«æŒ‘é€‰å‡ºæ¥çš„" tabindex="-1"><a class="header-anchor" href="#_21-æ–°çš„ä¸»èŠ‚ç‚¹æ˜¯æ€æ ·è¢«æŒ‘é€‰å‡ºæ¥çš„"><span>21.æ–°çš„ä¸»èŠ‚ç‚¹æ˜¯æ€æ ·è¢«æŒ‘é€‰å‡ºæ¥çš„ï¼Ÿ</span></a></h3><p>é€‰å‡ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œå¤§æ¦‚åˆ†ä¸ºè¿™ä¹ˆå‡ æ­¥ï¼š <img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-03976d35-20b6-4efe-aa9c-7d3759460d34.png" alt="æ–°çš„ä¸»èŠ‚ç‚¹" loading="lazy"></p><ol><li>è¿‡æ»¤ï¼šâ€œä¸å¥åº·â€ï¼ˆä¸»è§‚ä¸‹çº¿ã€æ–­çº¿ï¼‰ã€5 ç§’å†…æ²¡æœ‰å›å¤è¿‡ Sentinel èŠ‚ ç‚¹ ping å“åº”ã€ä¸ä¸»èŠ‚ç‚¹å¤±è”è¶…è¿‡ down-after-milliseconds*10 ç§’ã€‚</li><li>é€‰æ‹© slave-priorityï¼ˆä»èŠ‚ç‚¹ä¼˜å…ˆçº§ï¼‰æœ€é«˜çš„ä»èŠ‚ç‚¹åˆ—è¡¨ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿”å›ï¼Œä¸å­˜åœ¨åˆ™ç»§ç»­ã€‚</li><li>é€‰æ‹©å¤åˆ¶åç§»é‡æœ€å¤§çš„ä»èŠ‚ç‚¹ï¼ˆå¤åˆ¶çš„æœ€å®Œæ•´ï¼‰ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿” å›ï¼Œä¸å­˜åœ¨åˆ™ç»§ç»­ã€‚</li><li>é€‰æ‹© runid æœ€å°çš„ä»èŠ‚ç‚¹ã€‚</li></ol><h3 id="_22-redis-é›†ç¾¤äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_22-redis-é›†ç¾¤äº†è§£å—"><span>22.Redis é›†ç¾¤äº†è§£å—ï¼Ÿ</span></a></h3><p>å‰é¢è¯´åˆ°äº†ä¸»ä»å­˜åœ¨é«˜å¯ç”¨å’Œåˆ†å¸ƒå¼çš„é—®é¢˜ï¼Œå“¨å…µè§£å†³äº†é«˜å¯ç”¨çš„é—®é¢˜ï¼Œè€Œé›†ç¾¤å°±æ˜¯ç»ˆææ–¹æ¡ˆï¼Œä¸€ä¸¾è§£å†³é«˜å¯ç”¨å’Œåˆ†å¸ƒå¼é—®é¢˜ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-5cbc6009-251e-4d5b-8f22-8d543938eccb.png" alt="Redis é›†ç¾¤ç¤ºæ„å›¾" tabindex="0" loading="lazy"><figcaption>Redis é›†ç¾¤ç¤ºæ„å›¾</figcaption></figure><ol><li><p><strong>æ•°æ®åˆ†åŒºï¼š</strong> æ•°æ®åˆ†åŒº <em>(æˆ–ç§°æ•°æ®åˆ†ç‰‡)</em> æ˜¯é›†ç¾¤æœ€æ ¸å¿ƒçš„åŠŸèƒ½ã€‚é›†ç¾¤å°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œä¸€æ–¹é¢ çªç ´äº† Redis å•æœºå†…å­˜å¤§å°çš„é™åˆ¶ï¼Œ<strong>å­˜å‚¨å®¹é‡å¤§å¤§å¢åŠ </strong>ï¼›<strong>å¦ä¸€æ–¹é¢</strong> æ¯ä¸ªä¸»èŠ‚ç‚¹éƒ½å¯ä»¥å¯¹å¤–æä¾›è¯»æœåŠ¡å’Œå†™æœåŠ¡ï¼Œ<strong>å¤§å¤§æé«˜äº†é›†ç¾¤çš„å“åº”èƒ½åŠ›</strong>ã€‚</p></li><li><p><strong>é«˜å¯ç”¨ï¼š</strong> é›†ç¾¤æ”¯æŒä¸»ä»å¤åˆ¶å’Œä¸»èŠ‚ç‚¹çš„ <strong>è‡ªåŠ¨æ•…éšœè½¬ç§»</strong> <em>ï¼ˆä¸å“¨å…µç±»ä¼¼ï¼‰</em>ï¼Œå½“ä»»ä¸€èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œé›†ç¾¤ä»ç„¶å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡ã€‚</p></li></ol><h3 id="_55-redis-clusteräº†è§£å—-è¡¥å……" tabindex="-1"><a class="header-anchor" href="#_55-redis-clusteräº†è§£å—-è¡¥å……"><span>55.Redis Clusteräº†è§£å—ï¼Ÿï¼ˆè¡¥å……ï¼‰</span></a></h3><blockquote><p>2024 å¹´ 04 æœˆ 26 æ—¥æ–°å¢</p></blockquote><p>åˆ‡ç‰‡é›†ç¾¤æ˜¯ä¸€ç§å°†æ•°æ®åˆ†ç‰‡å­˜å‚¨åœ¨å¤šä¸ª Redis å®ä¾‹ä¸Šçš„é›†ç¾¤æ¶æ„ï¼Œæ¯ä¸ª Redis å®ä¾‹è´Ÿè´£å­˜å‚¨éƒ¨åˆ†æ•°æ®ã€‚æ¯”å¦‚è¯´æŠŠ 25G çš„æ•°æ®å¹³å‡åˆ†ä¸º 5 ä»½ï¼Œæ¯ä»½ 5Gï¼Œç„¶åå¯åŠ¨ 5 ä¸ª Redis å®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹ä¿å­˜ä¸€ä»½æ•°æ®ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240408104101.png" alt="æå®¢æ—¶é—´ï¼šåˆ‡ç‰‡é›†ç¾¤æ¶æ„å›¾" tabindex="0" loading="lazy"><figcaption>æå®¢æ—¶é—´ï¼šåˆ‡ç‰‡é›†ç¾¤æ¶æ„å›¾</figcaption></figure><p>åœ¨ Redis 3.0 ä¹‹å‰ï¼Œå®˜æ–¹å¹¶æ²¡æœ‰é’ˆå¯¹åˆ‡ç‰‡é›†ç¾¤æä¾›å…·ä½“çš„è§£å†³æ–¹æ¡ˆï¼›ä½†æ˜¯åœ¨ Redis 3.0 ä¹‹åï¼Œå®˜æ–¹æä¾›äº† Redis Clusterï¼Œæ•°æ®å’Œå®ä¾‹ä¹‹é—´çš„æ˜ å°„é€šè¿‡å“ˆå¸Œæ§½ï¼ˆhash slotï¼‰æ¥å®ç°ã€‚</p><p>Redis Cluster æœ‰ 16384 ä¸ªå“ˆå¸Œæ§½ï¼Œæ¯ä¸ªé”®æ ¹æ®å…¶åå­—çš„ CRC16 å€¼è¢«æ˜ å°„åˆ°è¿™äº›å“ˆå¸Œæ§½ä¸Šã€‚ç„¶åï¼Œè¿™äº›å“ˆå¸Œæ§½ä¼šè¢«å‡åŒ€åœ°åˆ†é…åˆ°æ‰€æœ‰çš„ Redis å®ä¾‹ä¸Šã€‚</p><blockquote><p>CRC16 æ˜¯ä¸€ç§å“ˆå¸Œç®—æ³•ï¼Œå®ƒå¯ä»¥å°†ä»»æ„é•¿åº¦çš„è¾“å…¥æ•°æ®æ˜ å°„ä¸ºä¸€ä¸ª 16 ä½çš„å“ˆå¸Œå€¼ã€‚</p></blockquote><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e0ed9d62-3406-40db-8b01-c931f1020612.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ§½" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ§½</figcaption></figure><p>ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ 3 ä¸ª Redis å®ä¾‹ï¼Œé‚£ä¹ˆæ¯ä¸ªå®ä¾‹å¯èƒ½ä¼šè´Ÿè´£å¤§çº¦ 5461 ä¸ªå“ˆå¸Œæ§½ã€‚</p><p>å½“éœ€è¦å­˜å‚¨æˆ–æ£€ç´¢ä¸€ä¸ªé”®å€¼å¯¹æ—¶ï¼ŒRedis Cluster ä¼šå…ˆè®¡ç®—è¿™ä¸ªé”®çš„å“ˆå¸Œæ§½ï¼Œç„¶åæ‰¾åˆ°è´Ÿè´£è¿™ä¸ªå“ˆå¸Œæ§½çš„ Redis å®ä¾‹ï¼Œæœ€ååœ¨è¿™ä¸ªå®ä¾‹ä¸Šè¿›è¡Œæ“ä½œã€‚</p><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 1 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis åˆ‡ç‰‡é›†ç¾¤ï¼Ÿæ•°æ®å’Œå®ä¾‹ä¹‹é—´çš„å¦‚ä½•è¿›è¡Œæ˜ å°„ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹é¢ç»åŒå­¦ 1 éƒ¨é—¨ä¸»ç«™æŠ€æœ¯éƒ¨é¢è¯•åŸé¢˜ï¼šRedis çš„ cluster é›†ç¾¤å¦‚ä½•å®ç°ï¼Ÿ</li></ol></blockquote><h3 id="_23-é›†ç¾¤ä¸­æ•°æ®å¦‚ä½•åˆ†åŒº" tabindex="-1"><a class="header-anchor" href="#_23-é›†ç¾¤ä¸­æ•°æ®å¦‚ä½•åˆ†åŒº"><span>23.é›†ç¾¤ä¸­æ•°æ®å¦‚ä½•åˆ†åŒºï¼Ÿ</span></a></h3><p>åœ¨ Redis é›†ç¾¤ä¸­ï¼Œæ•°æ®åˆ†åŒºæ˜¯é€šè¿‡å°†æ•°æ®åˆ†æ•£åˆ°ä¸åŒçš„èŠ‚ç‚¹æ¥å®ç°çš„ï¼Œå¸¸è§çš„æ•°æ®åˆ†åŒºè§„åˆ™æœ‰ä¸‰ç§ï¼šèŠ‚ç‚¹å–ä½™åˆ†åŒºã€ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºã€è™šæ‹Ÿæ§½åˆ†åŒºã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-ceb49e41-dfd7-4d1e-91f9-c299437227d2.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šåˆ†å¸ƒå¼æ•°æ®åˆ†åŒº" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šåˆ†å¸ƒå¼æ•°æ®åˆ†åŒº</figcaption></figure><h4 id="è¯´è¯´èŠ‚ç‚¹å–ä½™åˆ†åŒº" tabindex="-1"><a class="header-anchor" href="#è¯´è¯´èŠ‚ç‚¹å–ä½™åˆ†åŒº"><span>è¯´è¯´èŠ‚ç‚¹å–ä½™åˆ†åŒº</span></a></h4><p>èŠ‚ç‚¹å–ä½™åˆ†åŒºæ˜¯ä¸€ç§ç®€å•çš„åˆ†åŒºç­–ç•¥ï¼Œå…¶ä¸­æ•°æ®é¡¹é€šè¿‡å¯¹æŸä¸ªå€¼ï¼ˆé€šå¸¸æ˜¯é”®çš„å“ˆå¸Œå€¼ï¼‰è¿›è¡Œå–ä½™æ“ä½œæ¥åˆ†é…åˆ°ä¸åŒçš„èŠ‚ç‚¹ã€‚</p><p>ç±»ä¼¼ HashMap ä¸­çš„å–ä½™æ“ä½œï¼Œæ•°æ®é¡¹çš„é”®ç»è¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—åï¼Œå¯¹èŠ‚ç‚¹æ•°é‡å–ä½™ï¼Œç„¶åå°†æ•°æ®é¡¹åˆ†é…åˆ°ä½™æ•°å¯¹åº”çš„èŠ‚ç‚¹ä¸Šã€‚</p><p>ç¼ºç‚¹æ˜¯æ‰©ç¼©å®¹æ—¶ï¼Œå¤§å¤šæ•°æ•°æ®éœ€è¦é‡æ–°åˆ†é…ï¼Œå› ä¸ºèŠ‚ç‚¹æ€»æ•°çš„æ”¹å˜ä¼šå½±å“å–ä½™ç»“æœï¼Œè¿™å¯èƒ½å¯¼è‡´å¤§é‡æ•°æ®è¿ç§»ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-8b1fcaec-37e6-420a-9ca2-03615232af17.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šèŠ‚ç‚¹å–ä½™åˆ†åŒº" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šèŠ‚ç‚¹å–ä½™åˆ†åŒº</figcaption></figure><h4 id="è¯´è¯´ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº" tabindex="-1"><a class="header-anchor" href="#è¯´è¯´ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº"><span>è¯´è¯´ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº</span></a></h4><p>ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºçš„åŸç†æ˜¯ï¼šå°†å“ˆå¸Œå€¼ç©ºé—´ç»„ç»‡æˆä¸€ä¸ªç¯ï¼Œæ•°æ®é¡¹å’ŒèŠ‚ç‚¹éƒ½æ˜ å°„åˆ°è¿™ä¸ªç¯ä¸Šã€‚æ•°æ®é¡¹ç”±å…¶å“ˆå¸Œå€¼ç›´æ¥æ˜ å°„åˆ°ç¯ä¸Šï¼Œç„¶åé¡ºæ—¶é’ˆåˆ†é…åˆ°é‡åˆ°çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p><p>ä»è€Œæ¥å‡å°‘èŠ‚ç‚¹å˜åŠ¨æ—¶æ•°æ®è¿ç§»çš„é‡ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-89bd1c1c-251c-4f53-bba3-fe945b2ae9e2.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº</figcaption></figure><p>Key 1 å’Œ Key 2 ä¼šè½å…¥åˆ° Node 1 ä¸­ï¼ŒKey 3ã€Key 4 ä¼šè½å…¥åˆ° Node 2 ä¸­ï¼ŒKey 5 è½å…¥åˆ° Node 3 ä¸­ï¼ŒKey 6 è½å…¥åˆ° Node 4 ä¸­ã€‚</p><p>è¿™ç§æ–¹å¼ç›¸æ¯”èŠ‚ç‚¹å–ä½™æœ€å¤§çš„å¥½å¤„åœ¨äºåŠ å…¥å’Œåˆ é™¤èŠ‚ç‚¹åªå½±å“å“ˆå¸Œç¯ä¸­ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œå¯¹å…¶ä»–èŠ‚ç‚¹æ— å½±å“ã€‚</p><p>ä½†å®ƒè¿˜æ˜¯å­˜åœ¨é—®é¢˜ï¼š</p><ul><li>èŠ‚ç‚¹åœ¨åœ†ç¯ä¸Šåˆ†å¸ƒä¸å¹³å‡ï¼Œä¼šé€ æˆéƒ¨åˆ†ç¼“å­˜èŠ‚ç‚¹çš„å‹åŠ›è¾ƒå¤§</li><li>å½“æŸä¸ªèŠ‚ç‚¹æ•…éšœæ—¶ï¼Œè¿™ä¸ªèŠ‚ç‚¹æ‰€è¦æ‰¿æ‹…çš„æ‰€æœ‰è®¿é—®éƒ½ä¼šè¢«é¡ºç§»åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œä¼šå¯¹åé¢è¿™ä¸ªèŠ‚ç‚¹é€ æˆå‹åŠ›ã€‚</li></ul><h4 id="è¯´è¯´è™šæ‹Ÿæ§½åˆ†åŒº" tabindex="-1"><a class="header-anchor" href="#è¯´è¯´è™šæ‹Ÿæ§½åˆ†åŒº"><span>è¯´è¯´è™šæ‹Ÿæ§½åˆ†åŒºï¼Ÿ</span></a></h4><p>åœ¨è™šæ‹Ÿæ§½ï¼ˆä¹Ÿå«å“ˆå¸Œæ§½ï¼‰åˆ†åŒºä¸­ï¼Œæ§½ä½çš„æ•°é‡æ˜¯å›ºå®šçš„ï¼ˆä¾‹å¦‚ Redis Cluster æœ‰ 16384 ä¸ªæ§½ï¼‰ï¼Œæ¯ä¸ªé”®é€šè¿‡å“ˆå¸Œç®—æ³•ï¼ˆæ¯”å¦‚ CRC16ï¼‰æ˜ å°„åˆ°è¿™äº›æ§½ä¸Šï¼Œæ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹è´Ÿè´£ç®¡ç†ä¸€å®šèŒƒå›´å†…çš„æ§½ã€‚</p><p>è¿™ç§åˆ†åŒºå¯ä»¥çµæ´»åœ°å°†æ§½ï¼ˆä»¥åŠæ§½ä¸­çš„æ•°æ®ï¼‰ä»ä¸€ä¸ªèŠ‚ç‚¹è¿ç§»åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»è€Œå®ç°å¹³æ»‘æ‰©å®¹å’Œç¼©å®¹ï¼›æ•°æ®åˆ†å¸ƒä¹Ÿæ›´åŠ å‡åŒ€ï¼ŒRedis Cluster é‡‡ç”¨çš„æ­£æ˜¯è¿™ç§åˆ†åŒºæ–¹å¼ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e0ed9d62-3406-40db-8b01-c931f1020612.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šè™šæ‹Ÿæ§½åˆ†é…" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šè™šæ‹Ÿæ§½åˆ†é…</figcaption></figure><p>å‡è®¾ç³»ç»Ÿä¸­æœ‰ 4 ä¸ªå®é™…èŠ‚ç‚¹ï¼Œå‡è®¾ä¸ºå…¶åˆ†é…äº† 16 ä¸ªæ§½(0-15)ï¼›</p><ul><li>æ§½ 0-3 ä½äºèŠ‚ç‚¹ node1ï¼›</li><li>æ§½ 4-7 ä½äºèŠ‚ç‚¹ node2ï¼›</li><li>æ§½ 8-11 ä½äºèŠ‚ç‚¹ node3ï¼›</li><li>æ§½ 12-15 ä½äºèŠ‚ç‚¹ node4ã€‚</li></ul><p>å¦‚æœæ­¤æ—¶åˆ é™¤ <code>node2</code>ï¼Œåªéœ€è¦å°†æ§½ 4-7 é‡æ–°åˆ†é…å³å¯ï¼Œä¾‹å¦‚å°†æ§½ 4-5 åˆ†é…ç»™ <code>node1</code>ï¼Œæ§½ 6 åˆ†é…ç»™ <code>node3</code>ï¼Œæ§½ 7 åˆ†é…ç»™ <code>node4</code>ï¼Œæ•°æ®åœ¨èŠ‚ç‚¹ä¸Šçš„åˆ†å¸ƒä»ç„¶è¾ƒä¸ºå‡è¡¡ã€‚</p><p>å¦‚æœæ­¤æ—¶å¢åŠ  node5ï¼Œä¹Ÿåªéœ€è¦å°†ä¸€éƒ¨åˆ†æ§½åˆ†é…ç»™ node5 å³å¯ï¼Œæ¯”å¦‚è¯´å°†æ§½ 3ã€æ§½ 7ã€æ§½ 11ã€æ§½ 15 è¿ç§»ç»™ node5ï¼ŒèŠ‚ç‚¹ä¸Šçš„å…¶ä»–æ§½ä½ä¿ç•™ã€‚</p><p>å½“ç„¶äº†ï¼Œè¿™å–å†³äº <code>CRC16(key) % æ§½çš„ä¸ªæ•°</code> çš„å…·ä½“ç»“æœã€‚å› ä¸ºåœ¨ Redis Cluster ä¸­ï¼Œæ§½çš„ä¸ªæ•°åˆšå¥½æ˜¯ 2 çš„ 14 æ¬¡æ–¹ï¼Œè¿™å’Œ HashMap ä¸­æ•°ç»„çš„é•¿åº¦å¿…é¡»æ˜¯ 2 çš„å¹‚æ¬¡æ–¹æœ‰ç€å¼‚æ›²åŒå·¥ä¹‹å¦™ã€‚</p><p>å®ƒèƒ½ä¿è¯æ‰©å®¹åï¼Œå¤§éƒ¨åˆ†æ•°æ®åœç•™åœ¨æ‰©å®¹å‰çš„ä½ç½®ï¼Œåªæœ‰å°‘éƒ¨åˆ†æ•°æ®éœ€è¦è¿ç§»åˆ°æ–°çš„æ§½ä¸Šã€‚</p><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³æš‘æœŸå®ä¹ åŒå­¦ E ä¸€é¢é¢è¯•åŸé¢˜ï¼šä½ çŸ¥é“ Redis çš„ä¸€è‡´æ€§ hash å—</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 1 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis æ‰©å®¹ä¹‹åï¼Œå“ˆå¸Œæ§½çš„ä½ç½®æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 8 Java åç«¯å®ä¹ ä¸€é¢é¢è¯•åŸé¢˜ï¼šredis åˆ†ç‰‡é›†ç¾¤ï¼Œå¦‚ä½•åˆ†ç‰‡çš„ï¼Œæœ‰ä»€ä¹ˆå¥½å¤„</li></ol></blockquote><h3 id="_24-èƒ½è¯´è¯´-redis-é›†ç¾¤çš„åŸç†å—" tabindex="-1"><a class="header-anchor" href="#_24-èƒ½è¯´è¯´-redis-é›†ç¾¤çš„åŸç†å—"><span>24.èƒ½è¯´è¯´ Redis é›†ç¾¤çš„åŸç†å—ï¼Ÿ</span></a></h3><p>Redis é›†ç¾¤é€šè¿‡æ•°æ®åˆ†åŒºæ¥å®ç°æ•°æ®çš„åˆ†å¸ƒå¼å­˜å‚¨ï¼Œé€šè¿‡è‡ªåŠ¨æ•…éšœè½¬ç§»å®ç°é«˜å¯ç”¨ã€‚</p><h5 id="é›†ç¾¤åˆ›å»º" tabindex="-1"><a class="header-anchor" href="#é›†ç¾¤åˆ›å»º"><span>é›†ç¾¤åˆ›å»º</span></a></h5><p>æ•°æ®åˆ†åŒºæ˜¯åœ¨é›†ç¾¤åˆ›å»ºçš„æ—¶å€™å®Œæˆçš„ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-046a512c-baab-4e3a-9409-2af58088cceb.png" alt="é›†ç¾¤åˆ›å»º" tabindex="0" loading="lazy"><figcaption>é›†ç¾¤åˆ›å»º</figcaption></figure><p><strong>è®¾ç½®èŠ‚ç‚¹</strong> Redis é›†ç¾¤ä¸€èˆ¬ç”±å¤šä¸ªèŠ‚ç‚¹ç»„æˆï¼ŒèŠ‚ç‚¹æ•°é‡è‡³å°‘ä¸º 6 ä¸ªæ‰èƒ½ä¿è¯ç»„æˆå®Œæ•´é«˜å¯ç”¨çš„é›†ç¾¤ã€‚æ¯ä¸ªèŠ‚ç‚¹éœ€è¦å¼€å¯é…ç½® cluster-enabled yesï¼Œè®© Redis è¿è¡Œåœ¨é›†ç¾¤æ¨¡å¼ä¸‹ã€‚ <img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e6064ba6-fd6f-4270-92f9-68c0bb98fd4b.png" alt="èŠ‚ç‚¹å’Œæ¡æ‰‹" loading="lazy"><strong>èŠ‚ç‚¹æ¡æ‰‹</strong> èŠ‚ç‚¹æ¡æ‰‹æ˜¯æŒ‡ä¸€æ‰¹è¿è¡Œåœ¨é›†ç¾¤æ¨¡å¼ä¸‹çš„èŠ‚ç‚¹é€šè¿‡ Gossip åè®®å½¼æ­¤é€šä¿¡ï¼Œ è¾¾åˆ°æ„ŸçŸ¥å¯¹æ–¹çš„è¿‡ç¨‹ã€‚èŠ‚ç‚¹æ¡æ‰‹æ˜¯é›†ç¾¤å½¼æ­¤é€šä¿¡çš„ç¬¬ä¸€æ­¥ï¼Œç”±å®¢æˆ·ç«¯å‘èµ·å‘½ ä»¤ï¼šcluster meet{ip}{port}ã€‚å®ŒæˆèŠ‚ç‚¹æ¡æ‰‹ä¹‹åï¼Œä¸€ä¸ªä¸ªçš„ Redis èŠ‚ç‚¹å°±ç»„æˆäº†ä¸€ä¸ªå¤šèŠ‚ç‚¹çš„é›†ç¾¤ã€‚</p><p><strong>åˆ†é…æ§½ï¼ˆslotï¼‰</strong> Redis é›†ç¾¤æŠŠæ‰€æœ‰çš„æ•°æ®æ˜ å°„åˆ° 16384 ä¸ªæ§½ä¸­ã€‚æ¯ä¸ªèŠ‚ç‚¹å¯¹åº”è‹¥å¹²ä¸ªæ§½ï¼Œåªæœ‰å½“èŠ‚ç‚¹åˆ†é…äº†æ§½ï¼Œæ‰èƒ½å“åº”å’Œè¿™äº›æ§½å…³è”çš„é”®å‘½ä»¤ã€‚é€šè¿‡ cluster addslots å‘½ä»¤ä¸ºèŠ‚ç‚¹åˆ†é…æ§½ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-15341792-e7a6-428c-a109-22827e02be5f.png" alt="åˆ†é…æ§½" tabindex="0" loading="lazy"><figcaption>åˆ†é…æ§½</figcaption></figure><h5 id="æ•…éšœè½¬ç§»" tabindex="-1"><a class="header-anchor" href="#æ•…éšœè½¬ç§»"><span>æ•…éšœè½¬ç§»</span></a></h5><p>Redis é›†ç¾¤çš„æ•…éšœè½¬ç§»å’Œå“¨å…µçš„æ•…éšœè½¬ç§»ç±»ä¼¼ï¼Œä½†æ˜¯ Redis é›†ç¾¤ä¸­æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½è¦æ‰¿æ‹…çŠ¶æ€ç»´æŠ¤çš„ä»»åŠ¡ã€‚</p><p><strong>æ•…éšœå‘ç°</strong> Redis é›†ç¾¤å†…èŠ‚ç‚¹é€šè¿‡ ping/pong æ¶ˆæ¯å®ç°èŠ‚ç‚¹é€šä¿¡ï¼Œé›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šå®šæœŸå‘å…¶ä»–èŠ‚ç‚¹å‘é€ ping æ¶ˆæ¯ï¼Œæ¥æ”¶èŠ‚ç‚¹å›å¤ pong æ¶ˆæ¯ä½œä¸ºå“åº”ã€‚å¦‚æœåœ¨ cluster-node-timeout æ—¶é—´å†…é€šä¿¡ä¸€ç›´å¤±è´¥ï¼Œåˆ™å‘é€èŠ‚ ç‚¹ä¼šè®¤ä¸ºæ¥æ”¶èŠ‚ç‚¹å­˜åœ¨æ•…éšœï¼ŒæŠŠæ¥æ”¶èŠ‚ç‚¹æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼ˆpfailï¼‰çŠ¶æ€ã€‚ <img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-84a2a89e-f9ea-4681-b748-1a4f1dee172b.png" alt="ä¸»è§‚ä¸‹çº¿" loading="lazy"> å½“æŸä¸ªèŠ‚ç‚¹åˆ¤æ–­å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸»è§‚ä¸‹çº¿åï¼Œç›¸åº”çš„èŠ‚ç‚¹çŠ¶æ€ä¼šè·Ÿéšæ¶ˆæ¯åœ¨é›†ç¾¤å†…ä¼ æ’­ã€‚é€šè¿‡ Gossip æ¶ˆæ¯ä¼ æ’­ï¼Œé›†ç¾¤å†…èŠ‚ç‚¹ä¸æ–­æ”¶é›†åˆ°æ•…éšœèŠ‚ç‚¹çš„ä¸‹çº¿æŠ¥å‘Šã€‚å½“ åŠæ•°ä»¥ä¸ŠæŒæœ‰æ§½çš„ä¸»èŠ‚ç‚¹éƒ½æ ‡è®°æŸä¸ªèŠ‚ç‚¹æ˜¯ä¸»è§‚ä¸‹çº¿æ—¶ã€‚è§¦å‘å®¢è§‚ä¸‹çº¿æµç¨‹ã€‚ <img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-b61a6109-7aea-45ab-a53c-267eebb9180a.png" alt="ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿" loading="lazy"></p><p><strong>æ•…éšœæ¢å¤</strong></p><p>æ•…éšœèŠ‚ç‚¹å˜ä¸ºå®¢è§‚ä¸‹çº¿åï¼Œå¦‚æœä¸‹çº¿èŠ‚ç‚¹æ˜¯æŒæœ‰æ§½çš„ä¸»èŠ‚ç‚¹åˆ™éœ€è¦åœ¨å®ƒ çš„ä»èŠ‚ç‚¹ä¸­é€‰å‡ºä¸€ä¸ªæ›¿æ¢å®ƒï¼Œä»è€Œä¿è¯é›†ç¾¤çš„é«˜å¯ç”¨ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-0e5a49b3-cb5a-4aef-a81f-fce50a012a39.png" alt="æ•…éšœæ¢å¤æµç¨‹" tabindex="0" loading="lazy"><figcaption>æ•…éšœæ¢å¤æµç¨‹</figcaption></figure><ol><li>èµ„æ ¼æ£€æŸ¥ æ¯ä¸ªä»èŠ‚ç‚¹éƒ½è¦æ£€æŸ¥æœ€åä¸ä¸»èŠ‚ç‚¹æ–­çº¿æ—¶é—´ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰èµ„æ ¼æ›¿æ¢æ•…éšœ çš„ä¸»èŠ‚ç‚¹ã€‚</li><li>å‡†å¤‡é€‰ä¸¾æ—¶é—´ å½“ä»èŠ‚ç‚¹ç¬¦åˆæ•…éšœè½¬ç§»èµ„æ ¼åï¼Œæ›´æ–°è§¦å‘æ•…éšœé€‰ä¸¾çš„æ—¶é—´ï¼Œåªæœ‰åˆ°è¾¾è¯¥ æ—¶é—´åæ‰èƒ½æ‰§è¡Œåç»­æµç¨‹ã€‚</li><li>å‘èµ·é€‰ä¸¾ å½“ä»èŠ‚ç‚¹å®šæ—¶ä»»åŠ¡æ£€æµ‹åˆ°è¾¾æ•…éšœé€‰ä¸¾æ—¶é—´ï¼ˆfailover_auth_timeï¼‰åˆ°è¾¾åï¼Œå‘èµ·é€‰ä¸¾æµç¨‹ã€‚</li><li>é€‰ä¸¾æŠ•ç¥¨ æŒæœ‰æ§½çš„ä¸»èŠ‚ç‚¹å¤„ç†æ•…éšœé€‰ä¸¾æ¶ˆæ¯ã€‚æŠ•ç¥¨è¿‡ç¨‹å…¶å®æ˜¯ä¸€ä¸ªé¢†å¯¼è€…é€‰ä¸¾çš„è¿‡ç¨‹ï¼Œå¦‚é›†ç¾¤å†…æœ‰ N ä¸ªæŒæœ‰æ§½çš„ä¸»èŠ‚ ç‚¹ä»£è¡¨æœ‰ N å¼ é€‰ç¥¨ã€‚ç”±äºåœ¨æ¯ä¸ªé…ç½®çºªå…ƒå†…æŒæœ‰æ§½çš„ä¸»èŠ‚ç‚¹åªèƒ½æŠ•ç¥¨ç»™ä¸€ä¸ª ä»èŠ‚ç‚¹ï¼Œå› æ­¤åªèƒ½æœ‰ä¸€ä¸ªä»èŠ‚ç‚¹è·å¾— N/2+1 çš„é€‰ç¥¨ï¼Œä¿è¯èƒ½å¤Ÿæ‰¾å‡ºå”¯ä¸€çš„ä»èŠ‚ç‚¹ã€‚ <img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-d0e16ea3-6683-43f4-82a3-80478703ae06.png" alt="é€‰ä¸¾æŠ•ç¥¨" loading="lazy"></li><li>æ›¿æ¢ä¸»èŠ‚ç‚¹ å½“ä»èŠ‚ç‚¹æ”¶é›†åˆ°è¶³å¤Ÿçš„é€‰ç¥¨ä¹‹åï¼Œè§¦å‘æ›¿æ¢ä¸»èŠ‚ç‚¹æ“ä½œã€‚</li></ol><blockquote><p><strong>éƒ¨ç½² Redis é›†ç¾¤è‡³å°‘éœ€è¦å‡ ä¸ªç‰©ç†èŠ‚ç‚¹ï¼Ÿ</strong></p></blockquote><p>åœ¨æŠ•ç¥¨é€‰ä¸¾çš„ç¯èŠ‚ï¼Œæ•…éšœä¸»èŠ‚ç‚¹ä¹Ÿç®—åœ¨æŠ•ç¥¨æ•°å†…ï¼Œå‡è®¾é›†ç¾¤å†…èŠ‚ç‚¹è§„æ¨¡æ˜¯ 3 ä¸» 3 ä»ï¼Œå…¶ä¸­æœ‰ 2 ä¸ªä¸»èŠ‚ç‚¹éƒ¨ç½²åœ¨ä¸€å°æœºå™¨ä¸Šï¼Œå½“è¿™å°æœºå™¨å®•æœºæ—¶ï¼Œç”±äºä»èŠ‚ç‚¹æ— æ³•æ”¶é›†åˆ° 3/2+1 ä¸ªä¸»èŠ‚ç‚¹é€‰ç¥¨å°†å¯¼è‡´æ•…éšœè½¬ç§»å¤±è´¥ã€‚è¿™ä¸ªé—®é¢˜ä¹Ÿé€‚ç”¨äºæ•…éšœå‘ç°ç¯èŠ‚ã€‚å› æ­¤éƒ¨ç½²é›†ç¾¤æ—¶æ‰€æœ‰ä¸»èŠ‚ç‚¹æœ€å°‘éœ€è¦éƒ¨ç½²åœ¨ 3 å°ç‰©ç†æœºä¸Šæ‰èƒ½é¿å…å•ç‚¹é—®é¢˜ã€‚</p><h3 id="_25-è¯´è¯´é›†ç¾¤çš„ä¼¸ç¼©" tabindex="-1"><a class="header-anchor" href="#_25-è¯´è¯´é›†ç¾¤çš„ä¼¸ç¼©"><span>25.è¯´è¯´é›†ç¾¤çš„ä¼¸ç¼©ï¼Ÿ</span></a></h3><p>Redis é›†ç¾¤ä½¿ç”¨æ•°æ®åˆ†ç‰‡å’Œå“ˆå¸Œæ§½çš„æœºåˆ¶å°†æ•°æ®åˆ†å¸ƒåˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šã€‚é›†ç¾¤æ‰©å®¹å’Œç¼©å®¹çš„å…³é”®ï¼Œåœ¨äºæ§½å’ŒèŠ‚ç‚¹ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-dd3e9494-eddb-4861-85f7-2646018d93f6.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šé›†ç¾¤çš„ä¼¸ç¼©" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šé›†ç¾¤çš„ä¼¸ç¼©</figcaption></figure><p>å½“éœ€è¦æ‰©å®¹æ—¶ï¼Œæ–°çš„èŠ‚ç‚¹è¢«æ·»åŠ åˆ°é›†ç¾¤ä¸­ï¼Œé›†ç¾¤ä¼šè‡ªåŠ¨æ‰§è¡Œæ•°æ®è¿ç§»ï¼Œä»¥é‡æ–°åˆ†å¸ƒå“ˆå¸Œæ§½åˆ°æ–°çš„èŠ‚ç‚¹ã€‚æ•°æ®è¿ç§»çš„è¿‡ç¨‹å¯ä»¥ç¡®ä¿åœ¨æ‰©å®¹æœŸé—´æ•°æ®çš„æ­£å¸¸è®¿é—®å’Œæ’å…¥ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-1d24bb63-2b05-4db9-bd6b-983f16a4830e.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ‰©å®¹å®ä¾‹" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ‰©å®¹å®ä¾‹</figcaption></figure><p>å½“æ•°æ®æ­£åœ¨è¿ç§»æ—¶ï¼Œå®¢æˆ·ç«¯è¯·æ±‚å¯èƒ½è¢«è·¯ç”±åˆ°åŸæœ‰èŠ‚ç‚¹æˆ–æ–°èŠ‚ç‚¹ã€‚Redis Cluster ä¼šæ ¹æ®å“ˆå¸Œæ§½çš„æ˜ å°„å…³ç³»åˆ¤æ–­è¯·æ±‚åº”è¯¥è¢«è·¯ç”±åˆ°å“ªä¸ªèŠ‚ç‚¹ï¼Œå¹¶åœ¨å¿…è¦æ—¶è¿›è¡Œé‡å®šå‘ã€‚</p><p>å¦‚æœè¯·æ±‚è¢«è·¯ç”±åˆ°æ­£åœ¨è¿ç§»æ•°æ®çš„å“ˆå¸Œæ§½ï¼ŒRedis Cluster ä¼šè¿”å›ä¸€ä¸ª MOVED å“åº”ï¼ŒæŒ‡ç¤ºå®¢æˆ·ç«¯é‡æ–°è·¯ç”±è¯·æ±‚åˆ°æ­£ç¡®çš„ç›®æ ‡èŠ‚ç‚¹ã€‚è¿™ç§æœºåˆ¶ä¹Ÿå°±ä¿è¯äº†æ•°æ®è¿ç§»è¿‡ç¨‹ä¸­çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><p>å½“éœ€è¦ç¼©å®¹æ—¶ï¼ŒRedis é›†ç¾¤ä¼šå°†æ§½ä»è¦ç¼©å®¹çš„èŠ‚ç‚¹ä¸Šè¿ç§»åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šï¼Œç„¶åå°†è¦ç¼©å®¹çš„èŠ‚ç‚¹ä»é›†ç¾¤ä¸­ç§»é™¤ã€‚</p><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 21 æŠ–éŸ³å•†åŸä¸€é¢é¢è¯•åŸé¢˜ï¼šrediså¦‚ä½•ä¿è¯æ‰©å®¹è¿‡ç¨‹ä¸­æ•°æ®æ­£å¸¸è®¿é—®æ’å…¥</li></ol></blockquote><p>GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š<a href="https://github.com/itwanger/toBeBetterJavaer" target="_blank" rel="noopener noreferrer">äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯</a>ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&amp;å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š<a href="https://javabetter.cn/overview/" target="_blank" rel="noopener noreferrer">å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹</a></p><p>å¾®ä¿¡æœ <strong>æ²‰é»˜ç‹äºŒ</strong> æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ <strong>222</strong> å³å¯å…è´¹é¢†å–ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="ç¼“å­˜è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜è®¾è®¡"><span>ç¼“å­˜è®¾è®¡</span></a></h2><h3 id="_26-ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜ç©¿é€ã€ç¼“å­˜é›ªå´©äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_26-ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜ç©¿é€ã€ç¼“å­˜é›ªå´©äº†è§£å—"><span>26.ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜ç©¿é€ã€ç¼“å­˜é›ªå´©äº†è§£å—ï¼Ÿ</span></a></h3><p>ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿å’Œç¼“å­˜é›ªå´©æ˜¯æŒ‡åœ¨ä½¿ç”¨ Redis åšç¼“å­˜æ—¶å¯èƒ½é‡åˆ°çš„ä¸‰ç§é«˜å¹¶å‘åœºæ™¯ä¸‹çš„é—®é¢˜ã€‚</p><h4 id="ä»€ä¹ˆæ˜¯ç¼“å­˜å‡»ç©¿" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯ç¼“å­˜å‡»ç©¿"><span>ä»€ä¹ˆæ˜¯ç¼“å­˜å‡»ç©¿ï¼Ÿ</span></a></h4><p>ç¼“å­˜å‡»ç©¿æ˜¯æŒ‡æŸä¸€ä¸ªæˆ–å°‘æ•°å‡ ä¸ªæ•°æ®è¢«é«˜é¢‘è®¿é—®ï¼Œå½“è¿™äº›æ•°æ®åœ¨ç¼“å­˜ä¸­è¿‡æœŸçš„é‚£ä¸€åˆ»ï¼Œå¤§é‡è¯·æ±‚å°±ä¼šç›´æ¥åˆ°è¾¾æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“ç¬é—´å‹åŠ›è¿‡å¤§ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-86579ee6-9dae-4274-a5cc-af6812f48da4.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç¼“å­˜å‡»ç©¿" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç¼“å­˜å‡»ç©¿</figcaption></figure><p>è§£å†³â½…æ¡ˆï¼š</p><p>â‘ ã€åŠ é”æ›´æ–°ï¼Œâ½å¦‚è¯·æ±‚æŸ¥è¯¢ Aï¼Œå‘ç°ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œå¯¹ A è¿™ä¸ª key åŠ é”ï¼ŒåŒæ—¶å»æ•°æ®åº“æŸ¥è¯¢æ•°æ®ï¼Œå†™â¼Šç¼“å­˜ï¼Œå†è¿”å›ç»™â½¤æˆ·ï¼Œè¿™æ ·åâ¾¯çš„è¯·æ±‚å°±å¯ä»¥ä»ç¼“å­˜ä¸­æ‹¿åˆ°æ•°æ®äº†ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-cf63911a-8501-493e-a375-8b47a9f33358.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šåŠ é”æ›´æ–°" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šåŠ é”æ›´æ–°</figcaption></figure><p>â‘¡ã€å°†è¿‡æœŸæ—¶é—´ç»„åˆå†™åœ¨ value ä¸­ï¼Œé€šè¿‡å¼‚æ­¥çš„â½…å¼ä¸æ–­çš„åˆ·æ–°è¿‡æœŸæ—¶é—´ï¼Œé˜²â½Œæ­¤ç±»ç°è±¡ã€‚</p><h4 id="ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€"><span>ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Ÿ</span></a></h4><p>ç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼Œç”±äºç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼ˆå› ä¸ºæ•°æ®æ ¹æœ¬å°±ä¸å­˜åœ¨ï¼‰ï¼Œè¯·æ±‚æ¯æ¬¡éƒ½ä¼šç©¿è¿‡ç¼“å­˜å»æŸ¥è¯¢æ•°æ®åº“ã€‚å¦‚æœè¿™ç§æŸ¥è¯¢éå¸¸é¢‘ç¹ï¼Œå°±ä¼šç»™æ•°æ®åº“é€ æˆå¾ˆå¤§çš„å‹åŠ›ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-029951e6-8b99-4364-a570-010853deb594.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç¼“å­˜ç©¿é€" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç¼“å­˜ç©¿é€</figcaption></figure><p>ç¼“å­˜ç©¿é€æ„å‘³ç€ç¼“å­˜å¤±å»äº†å‡è½»æ•°æ®å‹åŠ›çš„æ„ä¹‰ã€‚ç¼“å­˜ç©¿é€å¯èƒ½æœ‰ä¸¤ç§åŸå› ï¼š</p><ol><li>è‡ªèº«ä¸šåŠ¡ä»£ç é—®é¢˜</li><li>æ¶æ„æ”»å‡»ï¼Œçˆ¬è™«é€ æˆç©ºå‘½ä¸­</li></ol><p>å®ƒä¸»è¦æœ‰ä¸¤ç§è§£å†³åŠæ³•ï¼š</p><p>â‘ ã€<strong>ç¼“å­˜ç©ºå€¼/é»˜è®¤å€¼</strong></p><p>å®¢æˆ·ç«¯è¯·æ±‚æŸä¸ª ID çš„æ•°æ®ï¼Œé¦–å…ˆæ£€æŸ¥ç¼“å­˜æ˜¯å¦å‘½ä¸­ã€‚å¦‚æœç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“ã€‚å¦‚æœæ•°æ®åº“æŸ¥è¯¢ç»“æœä¸ºç©ºï¼Œå°†è¯¥ç©ºç»“æœï¼ˆå¦‚ null æˆ– {}ï¼‰ç¼“å­˜èµ·æ¥ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªåˆç†çš„è¿‡æœŸæ—¶é—´ã€‚å½“åç»­è¯·æ±‚å†è®¿é—®ç›¸åŒ ID æ—¶ï¼Œç¼“å­˜ç›´æ¥è¿”å›ç©ºç»“æœï¼Œé¿å…æ¯æ¬¡éƒ½æ‰“åˆ°æ•°æ®åº“ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-288af5a2-ae5a-427a-95e9-b4a658b01386.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç¼“å­˜ç©ºå€¼/é»˜è®¤å€¼" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç¼“å­˜ç©ºå€¼/é»˜è®¤å€¼</figcaption></figure><p>ä»£ç ç¤ºä¾‹ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> cacheKey </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;product::&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> productId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> result </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(cacheKey);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (result </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    result </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> database</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">queryProductById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(productId);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (result </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // ç¼“å­˜ç©ºå€¼ï¼Œè®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(cacheKey, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;null&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, shortTTL);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // ç¼“å­˜æœ‰æ•ˆæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        cache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(cacheKey, result, longTTL);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â‘¡ã€<strong>å¸ƒéš†è¿‡æ»¤å™¨</strong></p><p>é€šè¿‡å¸ƒéš†è¿‡æ»¤å™¨å­˜å‚¨æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„åˆæ³•æ•°æ®çš„é”®ï¼Œå½“è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œå…ˆé€šè¿‡å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­è¯¥é”®æ˜¯å¦å­˜åœ¨ï¼š</p><ul><li>å¦‚æœå¸ƒéš†è¿‡æ»¤å™¨è®¤ä¸ºè¯¥é”®ä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›ç©ºï¼Œä¸ä¼šæŸ¥è¯¢æ•°æ®åº“ã€‚</li><li>å¦‚æœå¸ƒéš†è¿‡æ»¤å™¨è®¤ä¸ºè¯¥é”®å¯èƒ½å­˜åœ¨ï¼Œåˆ™æŸ¥è¯¢ç¼“å­˜å’Œæ•°æ®åº“ã€‚</li></ul><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-0e18ea40-a2e5-4fa6-989e-e771f6e4b0fc.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå¸ƒéš†è¿‡æ»¤å™¨" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå¸ƒéš†è¿‡æ»¤å™¨</figcaption></figure><p>ä»£ç ç¤ºä¾‹ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">BloomFilter</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> bloomFilter </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BloomFilter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(expectedInsertions</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> fpp)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // æœŸæœ›æ’å…¥é‡å’Œè¯¯åˆ¤ç‡</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">bloomFilter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;valid_key_1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">bloomFilter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;valid_key_2&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// åˆ¤æ–­è¯·æ±‚çš„é”®æ˜¯å¦å­˜åœ¨äºå¸ƒéš†è¿‡æ»¤å™¨ä¸­</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">bloomFilter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mightContain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(requestedKey)</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // å¦‚æœå¸ƒéš†è¿‡æ»¤å™¨è®¤ä¸ºè¯¥é”®ä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›ç©º</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">} </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // ç»§ç»­æ­£å¸¸çš„ç¼“å­˜æŸ¥è¯¢å’Œæ•°æ®åº“æŸ¥è¯¢æµç¨‹</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸¤ç§è§£å†³æ–¹æ¡ˆçš„å¯¹æ¯”ï¼š</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e8a382c9-4379-44ab-b1dc-fb598a228105.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç¼“å­˜ç©ºå¯¹è±¡å’Œå¸ƒéš†è¿‡æ»¤å™¨æ–¹æ¡ˆ" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç¼“å­˜ç©ºå¯¹è±¡å’Œå¸ƒéš†è¿‡æ»¤å™¨æ–¹æ¡ˆ</figcaption></figure><h4 id="ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©"><span>ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ</span></a></h4><p>ç¼“å­˜é›ªå´©æ˜¯æŒ‡åœ¨æŸä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œç”±äºå¤§é‡çš„ç¼“å­˜æ•°æ®åŒæ—¶è¿‡æœŸæˆ–ç¼“å­˜æœåŠ¡å™¨çªç„¶å®•æœºäº†ï¼Œå¯¼è‡´æ‰€æœ‰çš„è¯·æ±‚éƒ½è½åˆ°äº†æ•°æ®åº“ä¸Šï¼ˆæ¯”å¦‚ MySQLï¼‰ï¼Œä»è€Œå¯¹æ•°æ®åº“é€ æˆå·¨å¤§å‹åŠ›ï¼Œç”šè‡³å¯¼è‡´æ•°æ®åº“å´©æºƒçš„ç°è±¡ã€‚</p><p>æ€»ä¹‹å°±æ˜¯ï¼Œå´©äº†ï¼Œå´©çš„éå¸¸ä¸¥é‡ï¼Œå°±å«é›ªå´©äº†ï¼ˆç”µå½±ç”µè§†é‡Œåº”è¯¥çœ‹åˆ°è¿‡ï¼Œéå¸¸å¤¸å¼ ï¼‰ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-1464fe22-c463-4850-8989-b899510cb10e.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç¼“å­˜é›ªå´©" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç¼“å­˜é›ªå´©</figcaption></figure><h4 id="å¦‚ä½•è§£å†³ç¼“å­˜é›ªå´©å‘¢" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•è§£å†³ç¼“å­˜é›ªå´©å‘¢"><span>å¦‚ä½•è§£å†³ç¼“å­˜é›ªå´©å‘¢ï¼Ÿ</span></a></h4><p>ç¬¬ä¸€ç§ï¼šæé«˜ç¼“å­˜å¯ç”¨æ€§</p><p><strong>01ã€é›†ç¾¤éƒ¨ç½²</strong>ï¼šé‡‡ç”¨åˆ†å¸ƒå¼ç¼“å­˜è€Œä¸æ˜¯å•ä¸€ç¼“å­˜æœåŠ¡å™¨ï¼Œå¯ä»¥é™ä½å•ç‚¹æ•…éšœçš„é£é™©ã€‚å³ä½¿æŸä¸ªç¼“å­˜èŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œå…¶ä»–èŠ‚ç‚¹ä»ç„¶å¯ä»¥æä¾›æœåŠ¡ï¼Œä»è€Œé¿å…å¯¹æ•°æ®åº“çš„å¤§é‡ç›´æ¥è®¿é—®ã€‚</p><p>å¯ä»¥åˆ©ç”¨ Redis Clusterã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240326220634.png" alt="Rajat Pachauriï¼šRedis Cluster" tabindex="0" loading="lazy"><figcaption>Rajat Pachauriï¼šRedis Cluster</figcaption></figure><p>æˆ–è€…ç¬¬ä¸‰æ–¹é›†ç¾¤æ–¹æ¡ˆ Codisã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240326220408.png" alt="æå®¢æ—¶é—´ï¼šCodis" tabindex="0" loading="lazy"><figcaption>æå®¢æ—¶é—´ï¼šCodis</figcaption></figure><p><strong>02ã€å¤‡ä»½ç¼“å­˜</strong>ï¼šå¯¹äºå…³é”®æ•°æ®ï¼Œé™¤äº†åœ¨ä¸»ç¼“å­˜ä¸­å­˜å‚¨ï¼Œè¿˜å¯ä»¥åœ¨å¤‡ç”¨ç¼“å­˜ä¸­ä¿å­˜ä¸€ä»½ã€‚å½“ä¸»ç¼“å­˜ä¸å¯ç”¨æ—¶ï¼Œå¯ä»¥å¿«é€Ÿåˆ‡æ¢åˆ°å¤‡ç”¨ç¼“å­˜ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§ã€‚</p><p>åœ¨<a href="https://javabetter.cn/zhishixingqiu/paicoding.html" target="_blank" rel="noopener noreferrer">æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®</a>ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†å¤šçº§ç¼“å­˜çš„ç­–ç•¥ï¼Œå…¶ä¸­å°±åŒ…æ‹¬ä½¿ç”¨æœ¬åœ°ç¼“å­˜ Guava Cache å’Œ Caffeine æ¥ä½œä¸ºäºŒçº§ç¼“å­˜ï¼Œåœ¨ Redis å‡ºç°é—®é¢˜æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°æœ¬åœ°ç¼“å­˜ã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºâ€œé™çº§â€ï¼Œæ„å‘³ç€ç³»ç»Ÿåœ¨å¤±å»ä¼˜å…ˆçº§é«˜çš„èµ„æºæ—¶ä»èƒ½ç»§ç»­æä¾›æœåŠ¡ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240421105333.png" alt="æŠ€æœ¯æ´¾æ•™ç¨‹" tabindex="0" loading="lazy"><figcaption>æŠ€æœ¯æ´¾æ•™ç¨‹</figcaption></figure><p>å½“ä» Redis è·å–æ•°æ®å¤±è´¥æ—¶ï¼Œå°è¯•ä»æœ¬åœ°ç¼“å­˜è¯»å–æ•°æ®ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">LoadingCache</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserPermissions</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> permissionsCache </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Caffeine</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">newBuilder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">maximumSize</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">expireAfterWrite</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">TimeUnit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">MINUTES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">build</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">::</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">loadPermissionsFromRedis);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserPermissions</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> loadPermissionsFromRedis</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> userId) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    try</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> redisClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getPermissions</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(userId);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Redis å¼‚å¸¸å¤„ç†ï¼Œå°è¯•ä»æœ¬åœ°ç¼“å­˜è·å–</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> permissionsCache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getIfPresent</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(userId);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬äºŒç§ï¼šè¿‡æœŸæ—¶é—´</p><p>å¯¹äºç¼“å­˜æ•°æ®ï¼Œè®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œé¿å…å¤§é‡ç¼“å­˜æ•°æ®åŒæ—¶è¿‡æœŸã€‚å¯ä»¥é€šè¿‡åœ¨åŸæœ‰è¿‡æœŸæ—¶é—´çš„åŸºç¡€ä¸Šæ·»åŠ ä¸€ä¸ªéšæœºå€¼æ¥å®ç°ï¼Œè¿™æ ·å¯ä»¥åˆ†æ•£ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œå‡å°‘åŒä¸€æ—¶é—´å¯¹æ•°æ®åº“çš„è®¿é—®å‹åŠ›ã€‚</p><p>ç¬¬ä¸‰ç§ï¼šé™æµå’Œé™çº§</p><p>é€šè¿‡è®¾ç½®åˆç†çš„ç³»ç»Ÿé™æµç­–ç•¥ï¼Œå¦‚ä»¤ç‰Œæ¡¶æˆ–æ¼æ–—ç®—æ³•ï¼Œæ¥æ§åˆ¶è®¿é—®æµé‡ï¼Œé˜²æ­¢åœ¨ç¼“å­˜å¤±æ•ˆæ—¶æ•°æ®åº“è¢«æ‰“å®ã€‚</p><p>æ­¤å¤–ï¼Œç³»ç»Ÿå¯ä»¥å®ç°é™çº§ç­–ç•¥ï¼Œåœ¨ç¼“å­˜é›ªå´©æˆ–ç³»ç»Ÿå‹åŠ›è¿‡å¤§æ—¶ï¼Œæš‚æ—¶å…³é—­ä¸€äº›éæ ¸å¿ƒæœåŠ¡ï¼Œç¡®ä¿æ ¸å¿ƒæœåŠ¡çš„æ­£å¸¸è¿è¡Œã€‚</p><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 22 æš‘æœŸå®ä¹ ä¸€é¢é¢è¯•åŸé¢˜ï¼šç¼“å­˜é›ªå´©ï¼Œå¦‚ä½•è§£å†³</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹é¢ç»åŒå­¦ 7 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šè¯´ä¸€ä¸‹ ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜é›ªå´©</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨åŒå­¦ 7 Java åç«¯å®ä¹ ä¸€é¢çš„åŸé¢˜ï¼šRedis å®•æœºä¼šä¸ä¼šå¯¹æƒé™ç³»ç»Ÿæœ‰å½±å“ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨åŒå­¦ 7 Java åç«¯å®ä¹ ä¸€é¢çš„åŸé¢˜ï¼šè¯´ä¸€ä¸‹ Redis é›ªå´©ã€ç©¿é€ã€å‡»ç©¿ç­‰åœºæ™¯çš„è§£å†³æ–¹æ¡ˆ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³åŒå­¦ F é¢è¯•åŸé¢˜ï¼šç¼“å­˜å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼ˆå¼•ç”³åˆ°å¤šçº§ç¼“å­˜ï¼‰ï¼Œå¤šçº§ç¼“å­˜ï¼ˆredisï¼Œnginxï¼Œæœ¬åœ°ç¼“å­˜ï¼‰çš„å®ç°æ€è·¯</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„TPè”æ´²åŒå­¦ 5 Java åç«¯ä¸€é¢çš„åŸé¢˜ï¼šå¦‚ä½•è§£å†³ç¼“å­˜ç©¿é€</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç†æƒ³æ±½è½¦é¢ç»åŒå­¦ 2 ä¸€é¢é¢è¯•åŸé¢˜ï¼šå¦‚ä½•ç†è§£ç¼“å­˜é›ªå´©ã€ç¼“å­˜å‡»ç©¿å’Œç¼“å­˜ç©¿é€ï¼Ÿ</li></ol></blockquote><h3 id="_27-èƒ½è¯´è¯´å¸ƒéš†è¿‡æ»¤å™¨å—" tabindex="-1"><a class="header-anchor" href="#_27-èƒ½è¯´è¯´å¸ƒéš†è¿‡æ»¤å™¨å—"><span>27.èƒ½è¯´è¯´å¸ƒéš†è¿‡æ»¤å™¨å—ï¼Ÿ</span></a></h3><p>å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§ç©ºé—´æ•ˆç‡æé«˜çš„æ¦‚ç‡å‹æ•°æ®ç»“æ„ï¼Œç”¨äºå¿«é€Ÿæ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºä¸€ä¸ªé›†åˆä¸­ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-d0b8d85c-85dc-4843-b4be-d5d48338a44e.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå¸ƒéš†è¿‡æ»¤å™¨" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå¸ƒéš†è¿‡æ»¤å™¨</figcaption></figure><p>å¸ƒéš†è¿‡æ»¤å™¨ç”±ä¸€ä¸ªé•¿åº¦ä¸º m çš„ä½æ•°ç»„å’Œ k ä¸ªå“ˆå¸Œå‡½æ•°ç»„æˆã€‚</p><ul><li>å¼€å§‹æ—¶ï¼Œå¸ƒéš†è¿‡æ»¤å™¨çš„æ¯ä¸ªä½éƒ½è¢«è®¾ç½®ä¸º 0ã€‚</li><li>å½“ä¸€ä¸ªå…ƒç´ è¢«æ·»åŠ åˆ°è¿‡æ»¤å™¨ä¸­æ—¶ï¼Œå®ƒä¼šè¢« k ä¸ªå“ˆå¸Œå‡½æ•°åˆ†åˆ«è®¡ç®—å¾—åˆ° k ä¸ªä½ç½®ï¼Œç„¶åå°†ä½æ•°ç»„ä¸­å¯¹åº”çš„ä½è®¾ç½®ä¸º 1ã€‚</li><li>å½“æ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºè¿‡æ»¤å™¨ä¸­æ—¶ï¼ŒåŒæ ·ä½¿ç”¨ k ä¸ªå“ˆå¸Œå‡½æ•°è®¡ç®—ä½ç½®ï¼Œå¦‚æœä»»ä¸€ä½ç½®çš„ä½ä¸º 0ï¼Œåˆ™è¯¥å…ƒç´ è‚¯å®šä¸åœ¨è¿‡æ»¤å™¨ä¸­ï¼›å¦‚æœæ‰€æœ‰ä½ç½®çš„ä½éƒ½ä¸º 1ï¼Œåˆ™è¯¥å…ƒç´ å¯èƒ½åœ¨è¿‡æ»¤å™¨ä¸­ã€‚</li></ul><h4 id="å¸ƒéš†è¿‡æ»¤å™¨å­˜åœ¨è¯¯åˆ¤å—" tabindex="-1"><a class="header-anchor" href="#å¸ƒéš†è¿‡æ»¤å™¨å­˜åœ¨è¯¯åˆ¤å—"><span>å¸ƒéš†è¿‡æ»¤å™¨å­˜åœ¨è¯¯åˆ¤å—ï¼Ÿ</span></a></h4><p>å¸ƒéš†è¿‡æ»¤å™¨çš„ä¼˜ç‚¹æ˜¯ç©ºé—´æ•ˆç‡å’ŒæŸ¥è¯¢æ—¶é—´éƒ½è¿œè¿œè¶…è¿‡ä¸€èˆ¬çš„ç®—æ³•ï¼Œç¼ºç‚¹æ˜¯å­˜åœ¨è¯¯åˆ¤å’Œåˆ é™¤å›°éš¾ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20241019191741.png" alt="å‹‡å“¥ï¼šå¸ƒéš†è¿‡æ»¤å™¨" tabindex="0" loading="lazy"><figcaption>å‹‡å“¥ï¼šå¸ƒéš†è¿‡æ»¤å™¨</figcaption></figure><p>å½“å¸ƒéš†è¿‡æ»¤å™¨ä¿å­˜çš„å…ƒç´ è¶Šå¤šï¼Œè¢«ç½®ä¸º 1 çš„ bit ä½å°±ä¼šè¶Šå¤šã€‚å‡è®¾å…ƒç´  x æ²¡æœ‰å­˜å‚¨è¿‡ï¼Œä½†å…¶ä»–å…ƒç´ çš„å“ˆå¸Œå‡½æ•°æ˜ å°„åˆ°ä½æ•°ç»„çš„ä¸‰ä¸ªä½åˆšå¥½éƒ½ä¸º 1 ä¸”æ°å¥½è¦†ç›–äº†å…ƒç´  x æ˜ å°„çš„ä½ç½®ï¼Œé‚£ä¹ˆå¯¹äºå¸ƒéš†è¿‡æ»¤å™¨æ¥è®²ï¼Œå…ƒç´  x è¿™ä¸ªå€¼å°±æ˜¯å­˜åœ¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¸ƒéš†è¿‡æ»¤å™¨å­˜åœ¨ä¸€å®šçš„è¯¯åˆ¤ç‡ã€‚</p><p>å¸ƒéš†è¿‡æ»¤å™¨çš„è¯¯åˆ¤ç‡å–å†³äºä»¥ä¸‹å‡ ä¸ªå› ç´ ï¼š</p><ol><li>ä½æ•°ç»„çš„å¤§å°ï¼ˆmï¼‰ï¼šä½æ•°ç»„çš„å¤§å°å†³å®šäº†å¯ä»¥å­˜å‚¨çš„æ ‡å¿—ä½æ•°é‡ã€‚å¦‚æœä½æ•°ç»„è¿‡å°ï¼Œé‚£ä¹ˆå“ˆå¸Œç¢°æ’çš„å‡ ç‡å°±ä¼šå¢åŠ ï¼Œä»è€Œå¯¼è‡´æ›´é«˜çš„è¯¯åˆ¤ç‡ã€‚</li><li>å“ˆå¸Œå‡½æ•°çš„æ•°é‡ï¼ˆkï¼‰ï¼šå“ˆå¸Œå‡½æ•°çš„æ•°é‡å†³å®šäº†æ¯ä¸ªå…ƒç´ åœ¨ä½æ•°ç»„ä¸­æ ‡è®°çš„ä½æ•°ã€‚å“ˆå¸Œå‡½æ•°è¶Šå¤šï¼Œç¢°æ’çš„æ¦‚ç‡ä¹Ÿä¼šç›¸åº”å˜åŒ–ã€‚å¦‚æœå“ˆå¸Œå‡½æ•°å¤ªå°‘ï¼Œåˆ™è¿‡æ»¤å™¨å¾ˆå¿«ä¼šå˜å¾—ä¸ç²¾ç¡®ï¼›å¦‚æœå¤ªå¤šï¼Œè¯¯åˆ¤ç‡ä¹Ÿä¼šå‡é«˜ï¼Œæ•ˆç‡ä¸‹é™ã€‚</li><li>å­˜å…¥çš„å…ƒç´ æ•°é‡ï¼ˆnï¼‰ï¼šå­˜å…¥çš„å…ƒç´ è¶Šå¤šï¼Œå“ˆå¸Œç¢°æ’çš„å‡ ç‡è¶Šå¤§ï¼Œä»è€Œå¯¼è‡´æ›´é«˜çš„è¯¯åˆ¤ç‡ã€‚</li></ol><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20241019192648.png" alt="å‹‡å“¥ï¼šå¸ƒéš†è¿‡æ»¤å™¨çš„è¯¯åˆ¤" tabindex="0" loading="lazy"><figcaption>å‹‡å“¥ï¼šå¸ƒéš†è¿‡æ»¤å™¨çš„è¯¯åˆ¤</figcaption></figure><p>è¯¯åˆ¤ç‡å…¬å¼å¦‚ä¸‹ï¼š</p><mjx-container class="MathJax" jax="SVG" display="true" style="position:relative;"><svg style="vertical-align:-1.469ex;" xmlns="http://www.w3.org/2000/svg" width="19.279ex" height="4.563ex" role="img" focusable="false" viewBox="0 -1367.3 8521.2 2016.8" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g><g data-mml-node="mo" transform="translate(550,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(939,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mo" transform="translate(1460,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(2126.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="msup" transform="translate(3182.6,0)"><g data-mml-node="mrow"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="28" d="M180 96T180 250T205 541T266 770T353 944T444 1069T527 1150H555Q561 1144 561 1141Q561 1137 545 1120T504 1072T447 995T386 878T330 721T288 513T272 251Q272 133 280 56Q293 -87 326 -209T399 -405T475 -531T536 -609T561 -640Q561 -643 555 -649H527Q483 -612 443 -568T353 -443T266 -270T205 -41Z"></path></g><g data-mml-node="mn" transform="translate(597,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(1319.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="msup" transform="translate(2319.4,0)"><g data-mml-node="mi"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="TeXAtom" transform="translate(499,413) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mfrac" transform="translate(778,0)"><g data-mml-node="mrow" transform="translate(220,394) scale(0.707)"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mi" transform="translate(521,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mi" transform="translate(305.9,-345) scale(0.707)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><rect width="992.7" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mo" transform="translate(4290.2,0) translate(0 -0.5)"><path data-c="29" d="M35 1138Q35 1150 51 1150H56H69Q113 1113 153 1069T243 944T330 771T391 541T416 250T391 -40T330 -270T243 -443T152 -568T69 -649H56Q43 -649 39 -647T35 -637Q65 -607 110 -548Q283 -316 316 56Q324 133 324 251Q324 368 316 445Q278 877 48 1123Q36 1137 35 1138Z"></path></g></g><g data-mml-node="mi" transform="translate(4920.2,876.6) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>f</mi><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mn>1</mn><mo>âˆ’</mo><msup><mi>e</mi><mrow data-mjx-texclass="ORD"><mo>âˆ’</mo><mfrac><mrow><mi>k</mi><mi>n</mi></mrow><mi>m</mi></mfrac></mrow></msup><mo data-mjx-texclass="CLOSE">)</mo></mrow><mi>k</mi></msup></math></mjx-assistive-mml></mjx-container><p>è™½ç„¶å¸ƒéš†è¿‡æ»¤å™¨ä¼šäº§ç”Ÿè¯¯åˆ¤ï¼Œä½†åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ä¸€å®šçš„è¯¯åˆ¤ç‡æ˜¯å¯ä»¥æ¥å—çš„ï¼Œè¿™æ˜¯å› ä¸ºå¸ƒéš†è¿‡æ»¤å™¨çš„ä¸»è¦ä¼˜ç‚¹æ˜¯å…¶é«˜æ•ˆçš„æŸ¥è¯¢é€Ÿåº¦å’Œä½å†…å­˜å ç”¨ã€‚ç›¸æ¯”å…¶ä»–ç²¾ç¡®çš„é›†åˆæ•°æ®ç»“æ„ï¼ˆå¦‚å“ˆå¸Œè¡¨ã€æ ‘ç­‰ï¼‰ï¼Œå¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥åœ¨ç©ºé—´æ•ˆç‡å’ŒæŸ¥è¯¢é€Ÿåº¦ä¸Šè¡¨ç°æ›´ä¼˜ã€‚</p><h4 id="å¸ƒéš†è¿‡æ»¤å™¨æ”¯æŒåˆ é™¤å—" tabindex="-1"><a class="header-anchor" href="#å¸ƒéš†è¿‡æ»¤å™¨æ”¯æŒåˆ é™¤å—"><span>å¸ƒéš†è¿‡æ»¤å™¨æ”¯æŒåˆ é™¤å—ï¼Ÿ</span></a></h4><p>å¸ƒéš†è¿‡æ»¤å™¨å…¶å®å¹¶ä¸æ”¯æŒåˆ é™¤å…ƒç´ ï¼Œå› ä¸ºå¤šä¸ªå…ƒç´ å¯èƒ½å“ˆå¸Œåˆ°ä¸€ä¸ªå¸ƒéš†è¿‡æ»¤å™¨çš„åŒä¸€ä¸ªä½ç½®ï¼Œå¦‚æœç›´æ¥åˆ é™¤è¯¥ä½ç½®çš„å…ƒç´ ï¼Œåˆ™ä¼šå½±å“å…¶ä»–å…ƒç´ çš„åˆ¤æ–­ã€‚</p><h4 id="ä¸ºä»€ä¹ˆä¸èƒ½ç”¨å“ˆå¸Œè¡¨è€Œæ˜¯ç”¨å¸ƒéš†è¿‡æ»¤å™¨" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆä¸èƒ½ç”¨å“ˆå¸Œè¡¨è€Œæ˜¯ç”¨å¸ƒéš†è¿‡æ»¤å™¨"><span>ä¸ºä»€ä¹ˆä¸èƒ½ç”¨å“ˆå¸Œè¡¨è€Œæ˜¯ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿ</span></a></h4><p>å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§åŸºäºä½æ•°ç»„å’Œå¤šä¸ªå“ˆå¸Œå‡½æ•°çš„æ¦‚ç‡å‹æ•°æ®ç»“æ„ï¼Œé€‚åˆåœ¨å†…å­˜èµ„æºæœ‰é™ã€æ•°æ®é‡å¤§ä¸”èƒ½å®¹å¿ä¸€å®šè¯¯åˆ¤çš„åœºæ™¯ä¸‹ä½¿ç”¨ã€‚</p><p>ç›¸æ¯”å“ˆå¸Œè¡¨ï¼Œå¸ƒéš†è¿‡æ»¤å™¨çš„å†…å­˜å¼€é”€éå¸¸å°ï¼Œèƒ½å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨ã€‚è™½ç„¶å®ƒå­˜åœ¨è¯¯åˆ¤ï¼Œä½†ä¸ä¼šæ¼æŠ¥ï¼Œå› æ­¤åœ¨é˜²æ­¢ç¼“å­˜ç©¿é€ã€é»‘åå•è¿‡æ»¤å’Œæ¨èç³»ç»Ÿå»é‡ç­‰åœºæ™¯ä¸­å¹¿æ³›ä½¿ç”¨ã€‚</p><p>å“ˆå¸Œè¡¨è™½ç„¶å¯ä»¥ç²¾å‡†åˆ¤æ–­å…ƒç´ å­˜åœ¨ä¸å¦ï¼Œä½†éœ€è¦å­˜å‚¨å®é™…æ•°æ®ï¼Œå†…å­˜å¼€é”€å¤§ï¼Œä¸é€‚åˆå¤§è§„æ¨¡æ•°æ®å­˜å‚¨ã€‚</p><h4 id="å¸ƒéš†è¿‡æ»¤å™¨çš„ä¼˜ç‚¹" tabindex="-1"><a class="header-anchor" href="#å¸ƒéš†è¿‡æ»¤å™¨çš„ä¼˜ç‚¹"><span>å¸ƒéš†è¿‡æ»¤å™¨çš„ä¼˜ç‚¹ï¼Ÿ</span></a></h4><ol><li><strong>å†…å­˜æ•ˆç‡é«˜</strong>ï¼šå¸ƒéš†è¿‡æ»¤å™¨åªéœ€è¦å­˜å‚¨æ¯ä¸ªå…ƒç´ çš„å“ˆå¸Œå€¼ï¼Œè€Œä¸éœ€è¦å­˜å‚¨å…ƒç´ æœ¬èº«ï¼Œå› æ­¤å†…å­˜å ç”¨éå¸¸å°ã€‚</li><li><strong>æŸ¥è¯¢é€Ÿåº¦å¿«</strong>ï¼šå¸ƒéš†è¿‡æ»¤å™¨åªéœ€è¦å°†å…ƒç´ é€šè¿‡å¤šä¸ªå“ˆå¸Œå‡½æ•°æ˜ å°„åˆ°ä½æ•°ç»„ï¼Œå¹¶æ£€æŸ¥ä½çŠ¶æ€å³å¯ã€‚å®ƒä¸éœ€è¦å“ˆå¸Œè¡¨é‚£æ ·çš„å¤æ‚é”®å€¼æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦æ¥è¿‘å¸¸æ•°æ—¶é—´ï¼Œé€Ÿåº¦éå¸¸å¿«ã€‚</li></ol><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨åŒå­¦ 7 Java åç«¯å®ä¹ ä¸€é¢çš„åŸé¢˜ï¼šæœ‰äº†è§£è¿‡å¸ƒéš†è¿‡æ»¤å™¨å—ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„TPè”æ´²åŒå­¦ 5 Java åç«¯ä¸€é¢çš„åŸé¢˜ï¼šå¸ƒéš†è¿‡æ»¤å™¨åŸç†ï¼Œè¿™ç§æ–¹å¼ä¸‹5%çš„é”™è¯¯ç‡å¯æ¥å—ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç¾å›¢åŒå­¦ 9 ä¸€é¢é¢è¯•åŸé¢˜ï¼šå¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿå¸ƒéš†è¿‡æ»¤å™¨ä¼˜ç‚¹ï¼Ÿä¸ºä»€ä¹ˆä¸èƒ½ç”¨å“ˆå¸Œè¡¨è¦ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç†æƒ³æ±½è½¦é¢ç»åŒå­¦ 2 ä¸€é¢é¢è¯•åŸé¢˜ï¼šè¿½é—®ï¼šè¯´æ˜ä¸€ä¸‹å¸ƒéš†è¿‡æ»¤å™¨</li></ol></blockquote><h3 id="_28-å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§" tabindex="-1"><a class="header-anchor" href="#_28-å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§"><span>28.å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®â¼€è‡´æ€§ï¼Ÿ</span></a></h3><p>åœ¨<a href="https://javabetter.cn/zhishixingqiu/paicoding.html" target="_blank" rel="noopener noreferrer">æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®</a>ä¸­ï¼Œæˆ‘é‡‡ç”¨çš„æ˜¯å…ˆå†™ MySQLï¼Œå†åˆ é™¤ Redis çš„æ–¹å¼æ¥ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240325221330.png" alt="æŠ€æœ¯æ´¾æ•™ç¨‹" tabindex="0" loading="lazy"><figcaption>æŠ€æœ¯æ´¾æ•™ç¨‹</figcaption></figure><p>æˆ‘ä¸¾ä¾‹è¯´æ˜ä¸€ä¸‹ã€‚</p><p>å¯¹äºç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼Œè¯·æ±‚ B æŸ¥è¯¢åˆ°çš„ç¼“å­˜æ•°æ®æ˜¯ 10ï¼Œä½† MySQL è¢«è¯·æ±‚ A æ›´æ–°ä¸ºäº† 11ï¼Œæ­¤æ—¶æ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´ã€‚</p><p>ä½†ä¹Ÿåªå­˜åœ¨è¿™ä¸€æ¬¡ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå¯¹äºä¸æ˜¯å¼ºä¸€è‡´æ€§çš„ä¸šåŠ¡ï¼Œå¯ä»¥å®¹å¿ã€‚</p><p>å½“è¯·æ±‚ B ç¬¬äºŒæ¬¡æŸ¥è¯¢æ—¶ï¼Œå› ä¸ºè¯·æ±‚ A æ›´æ–°å®Œæ•°æ®åº“æŠŠç¼“å­˜åˆ é™¤äº†ï¼Œæ‰€ä»¥è¯·æ±‚ B è¿™æ¬¡ä¸ä¼šå‘½ä¸­ç¼“å­˜ï¼Œä¼šé‡æ–°æŸ¥ä¸€æ¬¡ MySQLï¼Œç„¶åå›å†™åˆ° Redisã€‚</p><p>ç¼“å­˜å’Œæ•°æ®åº“åˆä¸€è‡´äº†ã€‚</p><h4 id="é‚£å†æ¥è¯´è¯´ä¸ºä»€ä¹ˆè¦åˆ é™¤ç¼“å­˜è€Œä¸æ˜¯æ›´æ–°ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#é‚£å†æ¥è¯´è¯´ä¸ºä»€ä¹ˆè¦åˆ é™¤ç¼“å­˜è€Œä¸æ˜¯æ›´æ–°ç¼“å­˜"><span>é‚£å†æ¥è¯´è¯´ä¸ºä»€ä¹ˆè¦åˆ é™¤ç¼“å­˜è€Œä¸æ˜¯æ›´æ–°ç¼“å­˜</span></a></h4><p>å› ä¸ºç›¸å¯¹è€Œè¨€ï¼Œåˆ é™¤ç¼“å­˜çš„é€Ÿåº¦æ¯”æ›´æ–°ç¼“å­˜çš„é€Ÿåº¦è¦å¿«å¾—å¤šã€‚ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾å•†å“ product_123 çš„å½“å‰åº“å­˜æ˜¯ 10ï¼Œç°åœ¨æœ‰ä¸€æ¬¡è´­ä¹°æ“ä½œï¼Œåº“å­˜å‡ 1ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–° Redis ä¸­çš„åº“å­˜ä¿¡æ¯ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">product_id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;product_123&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"># å‡è®¾è¿™æ˜¯è´­ä¹°æ“ä½œåçš„æ–°åº“å­˜å€¼</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">new_stock </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 9</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"># æ›´æ–°Redisä¸­çš„åº“å­˜ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(product_id, new_stock)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ›´æ–°æ“ä½œè‡³å°‘æ¶‰åŠåˆ°ä¸¤ä¸ªæ­¥éª¤ï¼šè®¡ç®—æ–°çš„åº“å­˜å€¼å’Œæ›´æ–° Redis ä¸­çš„åº“å­˜å€¼ã€‚</p><p>å‡å¦‚æ˜¯ç›´æ¥åˆ é™¤æ“ä½œï¼Œç›´æ¥å°±ä¸€æ­¥åˆ°ä½äº†ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">product_id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;product_123&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"># åˆ é™¤Redisä¸­çš„åº“å­˜ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">del</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(product_id)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-ebad0a67-3012-4466-a4dc-e834104c48f8.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šåˆ é™¤ç¼“å­˜å’Œæ›´æ–°ç¼“å­˜" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šåˆ é™¤ç¼“å­˜å’Œæ›´æ–°ç¼“å­˜</figcaption></figure><p>å‡å¦‚æ˜¯æ›´æ–°ç¼“å­˜ï¼Œé‚£ä¹ˆå¯èƒ½è¯·æ±‚ A æ›´æ–°å®Œ MySQL ååœ¨æ›´æ–° Redis ä¸­ï¼Œè¯·æ±‚ B å·²ç»è¯»å–åˆ° Redis ä¸­çš„æ—§å€¼è¿”å›äº†ï¼Œåˆä¸€æ¬¡å¯¼è‡´äº†ç¼“å­˜å’Œæ•°æ®åº“ä¸ä¸€è‡´ã€‚</p><h4 id="é‚£å†è¯´è¯´ä¸ºä»€ä¹ˆè¦å…ˆæ›´æ–°æ•°æ®åº“-å†åˆ é™¤ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#é‚£å†è¯´è¯´ä¸ºä»€ä¹ˆè¦å…ˆæ›´æ–°æ•°æ®åº“-å†åˆ é™¤ç¼“å­˜"><span>é‚£å†è¯´è¯´ä¸ºä»€ä¹ˆè¦å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</span></a></h4><p>å› ä¸ºæ›´æ–°æ•°æ®åº“çš„é€Ÿåº¦æ¯”åˆ é™¤ç¼“å­˜çš„é€Ÿåº¦è¦æ…¢å¾—å¤šã€‚å› ä¸ºæ›´æ–° MySQL æ˜¯ç£ç›˜ IO æ“ä½œï¼Œè€Œ Redis æ˜¯å†…å­˜æ“ä½œã€‚å†…å­˜æ“ä½œæ¯”ç£ç›˜ IO å¿«å¾—å¤šï¼ˆè¿™æ˜¯ç¡¬ä»¶å±‚é¢çš„å¤©ç„¶å·®è·ï¼‰ã€‚</p><p>é‚£å‡å¦‚æ˜¯å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼Œå°±ä¼šé€ æˆè¿™æ ·çš„æƒ…å†µï¼š</p><p>ç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œæ•°æ®åº“åˆæ²¡æœ‰å®Œæˆæ›´æ–°ï¼Œæ­¤æ—¶æœ‰è¯·æ±‚è¿›æ¥è¯»å–æ•°æ®ï¼Œå¹¶å†™å…¥åˆ°ç¼“å­˜ï¼Œé‚£ä¹ˆåœ¨æ›´æ–°å®Œç¼“å­˜åï¼Œç¼“å­˜ä¸­è¿™ä¸ª key å°±æˆäº†ä¸€ä¸ªè„æ•°æ®ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-5c929a9e-a723-43b3-8f3c-f22c83765f9d.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå…ˆæ›´æ•°æ®åº“è¿˜æ˜¯å…ˆåˆ ç¼“å­˜" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå…ˆæ›´æ•°æ®åº“è¿˜æ˜¯å…ˆåˆ ç¼“å­˜</figcaption></figure><p>ç›®å‰æœ€æµè¡Œçš„ç¼“å­˜è¯»å†™ç­–ç•¥ Cache Aside Patternï¼ˆ<a href="https://coolshell.cn/articles/17416.html" target="_blank" rel="noopener noreferrer">æ—è·¯ç¼“å­˜æ¨¡å¼</a>ï¼‰å°±æ˜¯é‡‡ç”¨çš„å…ˆå†™æ•°æ®åº“ï¼Œå†åˆ ç¼“å­˜çš„æ–¹å¼ã€‚</p><ul><li>å¤±æ•ˆï¼šåº”ç”¨ç¨‹åºå…ˆä»ç¼“å­˜è¯»å–æ•°æ®ï¼Œå¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œå†ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®ï¼ŒæˆåŠŸåï¼Œæ”¾å…¥ç¼“å­˜ã€‚</li><li>å‘½ä¸­ï¼šåº”ç”¨ç¨‹åºä»ç¼“å­˜è¯»å–æ•°æ®ï¼Œå¦‚æœæ•°æ®å­˜åœ¨ï¼Œç›´æ¥è¿”å›ã€‚</li><li>æ›´æ–°ï¼šå…ˆæŠŠæ•°æ®å†™å…¥æ•°æ®åº“ï¼ŒæˆåŠŸåï¼Œå†è®©ç¼“å­˜å¤±æ•ˆã€‚</li></ul><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240325224814.png" alt="å·¦è€³æœµè€—å­ï¼šCache Aside Pattern" tabindex="0" loading="lazy"><figcaption>å·¦è€³æœµè€—å­ï¼šCache Aside Pattern</figcaption></figure><h4 id="é‚£å‡å¦‚å¯¹ä¸€è‡´æ€§è¦æ±‚å¾ˆé«˜-è¯¥æ€ä¹ˆåŠå‘¢" tabindex="-1"><a class="header-anchor" href="#é‚£å‡å¦‚å¯¹ä¸€è‡´æ€§è¦æ±‚å¾ˆé«˜-è¯¥æ€ä¹ˆåŠå‘¢"><span>é‚£å‡å¦‚å¯¹ä¸€è‡´æ€§è¦æ±‚å¾ˆé«˜ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</span></a></h4><p>ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®ä¸ä¸€è‡´çš„åŸå› ï¼Œå¸¸è§çš„æœ‰ä¸¤ç§ï¼š</p><ul><li>ç¼“å­˜åˆ é™¤å¤±è´¥</li><li>å¹¶å‘å¯¼è‡´å†™å…¥äº†è„æ•°æ®</li></ul><p>é‚£é€šå¸¸æœ‰å››ç§æ–¹æ¡ˆå¯ä»¥è§£å†³ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240325225250.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>â‘ ã€å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯ç¼“å­˜è¢«åˆ é™¤</strong></p><p>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚ Kafkaã€RabbitMQï¼‰ä¿è¯æ•°æ®åº“æ›´æ–°å’Œç¼“å­˜æ›´æ–°ä¹‹é—´çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚å½“æ•°æ®åº“æ›´æ–°å®Œæˆåï¼Œå°†æ›´æ–°äº‹ä»¶å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ã€‚æœ‰ä¸“é—¨çš„æœåŠ¡ç›‘å¬è¿™äº›äº‹ä»¶å¹¶è´Ÿè´£æ›´æ–°æˆ–åˆ é™¤ç¼“å­˜ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e4a61193-515a-409f-a436-2733abc3a86e.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ¶ˆæ¯é˜Ÿåˆ—ä¿è¯keyè¢«åˆ é™¤" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ¶ˆæ¯é˜Ÿåˆ—ä¿è¯keyè¢«åˆ é™¤</figcaption></figure><p>è¿™ç§æ–¹æ¡ˆå¾ˆä¸é”™ï¼Œç¼ºç‚¹æ˜¯å¯¹ä¸šåŠ¡ä»£ç æœ‰ä¸€å®šçš„ä¾µå…¥ï¼Œæ¯•ç«Ÿå¼•å…¥äº†æ¶ˆæ¯é˜Ÿåˆ—å˜›ã€‚</p><p><strong>â‘¡ã€æ•°æ®åº“è®¢é˜…+æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯ç¼“å­˜è¢«åˆ é™¤</strong></p><p>å¯ä»¥ä¸“é—¨èµ·ä¸€ä¸ªæœåŠ¡ï¼ˆæ¯”å¦‚ <a href="https://github.com/alibaba/canal" target="_blank" rel="noopener noreferrer">Canal</a>ï¼Œé˜¿é‡Œå·´å·´ MySQL binlog å¢é‡è®¢é˜…&amp;æ¶ˆè´¹ç»„ä»¶ï¼‰å»ç›‘å¬ MySQL çš„ binlogï¼Œè·å–éœ€è¦æ“ä½œçš„æ•°æ®ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240325225809.png" alt="æŠ€æœ¯æ´¾æ•™ç¨‹" tabindex="0" loading="lazy"><figcaption>æŠ€æœ¯æ´¾æ•™ç¨‹</figcaption></figure><p>ç„¶åç”¨ä¸€ä¸ªå…¬å…±çš„æœåŠ¡è·å–è®¢é˜…ç¨‹åºä¼ æ¥çš„ä¿¡æ¯ï¼Œè¿›è¡Œç¼“å­˜åˆ é™¤ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-37c07418-9cd8-43d9-90e7-0cb43b329025.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ•°æ®åº“è®¢é˜…+æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯keyè¢«åˆ é™¤" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ•°æ®åº“è®¢é˜…+æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯keyè¢«åˆ é™¤</figcaption></figure><p>è¿™ç§æ–¹å¼è™½ç„¶é™ä½äº†å¯¹ä¸šåŠ¡çš„ä¾µå…¥ï¼Œä½†å¢åŠ äº†æ•´ä¸ªç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œé€‚åˆåŸºå»ºå®Œå–„çš„å¤§å‚ã€‚</p><p><strong>â‘¢ã€å»¶æ—¶åŒåˆ é˜²æ­¢è„æ•°æ®</strong></p><p>ç®€å•è¯´ï¼Œå°±æ˜¯åœ¨ç¬¬ä¸€æ¬¡åˆ é™¤ç¼“å­˜ä¹‹åï¼Œè¿‡ä¸€æ®µæ—¶é—´ä¹‹åï¼Œå†æ¬¡åˆ é™¤ç¼“å­˜ã€‚</p><p>ä¸»è¦é’ˆå¯¹ç¼“å­˜ä¸å­˜åœ¨ï¼Œä½†å†™å…¥äº†è„æ•°æ®çš„æƒ…å†µã€‚åœ¨å…ˆåˆ ç¼“å­˜ï¼Œå†å†™æ•°æ®åº“çš„æ›´æ–°ç­–ç•¥ä¸‹å‘ç”Ÿçš„æ¯”è¾ƒå¤šã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-fab24753-9c53-4432-9413-5feba07ae1e3.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå»¶æ—¶åŒåˆ " tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå»¶æ—¶åŒåˆ </figcaption></figure><p>è¿™ç§æ–¹å¼çš„å»¶æ—¶æ—¶é—´éœ€è¦ä»”ç»†è€ƒé‡å’Œæµ‹è¯•ã€‚</p><p><strong>â‘£ï¼šè®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´å…œåº•</strong></p><p>è¿™æ˜¯ä¸€ä¸ªæœ´ç´ ä½†æœ‰ç”¨çš„å…œåº•ç­–ç•¥ï¼Œç»™ç¼“å­˜è®¾ç½®ä¸€ä¸ªåˆç†çš„è¿‡æœŸæ—¶é—´ï¼Œå³ä½¿å‘ç”Ÿäº†ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œä¹Ÿä¸ä¼šæ°¸è¿œä¸ä¸€è‡´ä¸‹å»ï¼Œç¼“å­˜è¿‡æœŸåï¼Œè‡ªç„¶å°±ä¸€è‡´äº†ã€‚</p><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åä¸ºé¢ç»åŒå­¦ 8 æŠ€æœ¯äºŒé¢é¢è¯•åŸé¢˜ï¼šæ€æ ·ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 23 QQ åå°æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šæ•°æ®ä¸€è‡´æ€§é—®é¢˜</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¾®ä¼—é“¶è¡ŒåŒå­¦ 1 Java åç«¯ä¸€é¢çš„åŸé¢˜ï¼šMySQL å’Œç¼“å­˜ä¸€è‡´æ€§é—®é¢˜äº†è§£å—ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç¾å›¢é¢ç»åŒå­¦ 3 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šå¦‚ä½•ä¿è¯ redis ç¼“å­˜ä¸æ•°æ®åº“çš„ä¸€è‡´æ€§ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ¯”äºšè¿ªé¢ç»åŒå­¦ 12 Java æŠ€æœ¯é¢è¯•åŸé¢˜ï¼šæ€ä¹ˆè§£å†³rediså’Œmysqlçš„ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨åŒå­¦ 17 åç«¯æŠ€æœ¯é¢è¯•åŸé¢˜ï¼šåŒå†™ä¸€è‡´æ€§æ€ä¹ˆè§£å†³çš„</li></ol></blockquote><h3 id="_29-å¦‚ä½•ä¿è¯æœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜çš„ä¸€è‡´" tabindex="-1"><a class="header-anchor" href="#_29-å¦‚ä½•ä¿è¯æœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜çš„ä¸€è‡´"><span>29.å¦‚ä½•ä¿è¯æœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜çš„ä¸€è‡´ï¼Ÿ</span></a></h3><p>åœ¨<a href="https://javabetter.cn/zhishixingqiu/paicoding.html" target="_blank" rel="noopener noreferrer">æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®</a>ä¸­ï¼Œä¸ºäº†å‡è½» Redis çš„è´Ÿè½½ï¼Œæˆ‘åˆè¿½åŠ äº†ä¸€å±‚æœ¬åœ°ç¼“å­˜ Caffeineã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-6d4ab7e6-8337-4576-bbf0-79202a1c3331.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå»¶æ—¶åŒåˆ " tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå»¶æ—¶åŒåˆ </figcaption></figure><p>ä¸ºäº†ä¿è¯æœ¬åœ°ç¼“å­˜å’Œ Redis ç¼“å­˜çš„ä¸€è‡´æ€§ï¼Œé€šå¸¸é‡‡ç”¨çš„ç­–ç•¥æœ‰ï¼š</p><p>â‘ ã€è®¾ç½®æœ¬åœ°ç¼“å­˜çš„è¿‡æœŸæ—¶é—´ï¼Œè¿™æ˜¯æœ€ç®€å•ä¹Ÿæ˜¯æœ€ç›´æ¥çš„æ–¹æ³•ï¼Œå½“æœ¬åœ°ç¼“å­˜è¿‡æœŸæ—¶ï¼Œå°±ä» Redis ç¼“å­˜ä¸­å»åŒæ­¥ã€‚</p><p>â‘¡ã€ä½¿ç”¨ Redis çš„ Pub/Sub æœºåˆ¶ï¼Œå½“ Redis ç¼“å­˜å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå‘å¸ƒä¸€ä¸ªæ¶ˆæ¯ï¼Œæœ¬åœ°ç¼“å­˜è®¢é˜…è¿™ä¸ªæ¶ˆæ¯ï¼Œç„¶ååˆ é™¤å¯¹åº”çš„æœ¬åœ°ç¼“å­˜ã€‚</p><p>â‘¢ã€Redis ç¼“å­˜å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¯”å¦‚ RocketMQã€RabbitMQ å»æ›´æ–°æœ¬åœ°ç¼“å­˜ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-20c15f0d-fb3c-4922-94b1-edcd856658be.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæœ¬åœ°ç¼“å­˜/åˆ†å¸ƒå¼ç¼“å­˜ä¿æŒä¸€è‡´" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæœ¬åœ°ç¼“å­˜/åˆ†å¸ƒå¼ç¼“å­˜ä¿æŒä¸€è‡´</figcaption></figure><p>ç”±äºæŠ€æœ¯æ´¾æœ¬èº«å¯¹ç¼“å­˜çš„ä¸€è‡´æ€§è¦æ±‚ä¸æ˜¯ç‰¹åˆ«é«˜ï¼Œæ‰€ä»¥æˆ‘å°±é‡‡ç”¨ç¬¬ä¸€ç§æ–¹å¼ã€‚</p><p>å¦å¤–ï¼Œåœ¨æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®ä¸­ï¼Œæˆ‘å¯¹ç¼“å­˜çš„ä½¿ç”¨åœºæ™¯åšäº†ç»†åŒ–ã€‚æ¯”å¦‚è¯´ï¼Œä½¿ç”¨ CacheBuilder æ¥å®Œæˆ Guava Cache çš„æ„å»ºï¼Œåƒä¸€äº›ç®€å•çš„ç¼“å­˜åœºæ™¯ï¼Œæ¯”å¦‚è¯´è·å–èœå•åˆ†ç±»ã€è·å–ç™»å½•éªŒè¯ç ã€è·å–ç”¨æˆ·è½¬å­˜å›¾ç‰‡ç­‰ï¼Œéƒ½ä½¿ç”¨äº† Guava Cacheã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240507105407.png" alt="æŠ€æœ¯æ´¾æ•™ç¨‹ï¼šGuava" tabindex="0" loading="lazy"><figcaption>æŠ€æœ¯æ´¾æ•™ç¨‹ï¼šGuava</figcaption></figure><p>åƒé¦–é¡µä¾§è¾¹æ ã€ä¸“æ ä¾§è¾¹æ ã€æ–‡ç« è¯¦æƒ…ä¾§è¾¹æ ç­‰ç¼“å­˜åœºæ™¯ï¼Œå°±ä½¿ç”¨äº† Caffeine ä½œä¸ºæœ¬åœ°ç¼“å­˜ï¼Œé€šè¿‡ @Cacheableã€@CacheEvitã€@CachePut ç­‰æ³¨è§£å®ç°ï¼Œéå¸¸è½»å·§ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240507110254.png" alt="æŠ€æœ¯æ´¾æ•™ç¨‹ï¼šCaffeine" tabindex="0" loading="lazy"><figcaption>æŠ€æœ¯æ´¾æ•™ç¨‹ï¼šCaffeine</figcaption></figure><p>è€Œåƒç”¨æˆ· Session å’Œç½‘ç«™åœ°å›¾ SiteMap ç­‰ç¼“å­˜åœºæ™¯ï¼Œå°±ä½¿ç”¨äº† Redis æ¥ä½œä¸ºç¼“å­˜ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240507110652.png" alt="æŠ€æœ¯æ´¾æ•™ç¨‹ï¼šRedis" tabindex="0" loading="lazy"><figcaption>æŠ€æœ¯æ´¾æ•™ç¨‹ï¼šRedis</figcaption></figure><h4 id="å¦‚æœåœ¨é¡¹ç›®ä¸­å¤šä¸ªåœ°æ–¹éƒ½è¦ä½¿ç”¨åˆ°äºŒçº§ç¼“å­˜çš„é€»è¾‘-å¦‚ä½•è®¾è®¡è¿™ä¸€å—" tabindex="-1"><a class="header-anchor" href="#å¦‚æœåœ¨é¡¹ç›®ä¸­å¤šä¸ªåœ°æ–¹éƒ½è¦ä½¿ç”¨åˆ°äºŒçº§ç¼“å­˜çš„é€»è¾‘-å¦‚ä½•è®¾è®¡è¿™ä¸€å—"><span>å¦‚æœåœ¨é¡¹ç›®ä¸­å¤šä¸ªåœ°æ–¹éƒ½è¦ä½¿ç”¨åˆ°äºŒçº§ç¼“å­˜çš„é€»è¾‘ï¼Œå¦‚ä½•è®¾è®¡è¿™ä¸€å—ï¼Ÿ</span></a></h4><p>åœ¨è®¾è®¡æ—¶ï¼Œåº”è¯¥æ¸…æ¥šåœ°åŒºåˆ†ä½•æ—¶ä½¿ç”¨ä¸€çº§ç¼“å­˜å’Œä½•æ—¶ä½¿ç”¨äºŒçº§ç¼“å­˜ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¯¹äºé¢‘ç¹è®¿é—®ä½†ä¸ç»å¸¸æ›´æ”¹çš„æ•°æ®ï¼Œå¯ä»¥æ”¾åœ¨æœ¬åœ°ç¼“å­˜ä¸­ä»¥æä¾›æœ€å¿«çš„è®¿é—®é€Ÿåº¦ã€‚è€Œå¯¹äºéœ€è¦å…±äº«æˆ–è€…ä¸€è‡´æ€§è¦æ±‚è¾ƒé«˜çš„æ•°æ®ï¼Œåº”å½“æ”¾åœ¨ä¸€çº§ç¼“å­˜ä¸­ã€‚</p><h4 id="æœ¬åœ°ç¼“å­˜å’Œ-redis-ç¼“å­˜çš„åŒºåˆ«å’Œæ•ˆç‡å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#æœ¬åœ°ç¼“å­˜å’Œ-redis-ç¼“å­˜çš„åŒºåˆ«å’Œæ•ˆç‡å¯¹æ¯”"><span>æœ¬åœ°ç¼“å­˜å’Œ Redis ç¼“å­˜çš„åŒºåˆ«å’Œæ•ˆç‡å¯¹æ¯”ï¼Ÿ</span></a></h4><p>Redis å¯ä»¥éƒ¨ç½²åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ”¯æŒæ•°æ®åˆ†ç‰‡ï¼Œé€‚ç”¨äºè·¨æœåŠ¡å™¨çš„ç¼“å­˜å…±äº«ã€‚è€Œæœ¬åœ°ç¼“å­˜åªèƒ½åœ¨å•ä¸ªæœåŠ¡å™¨ä¸Šä½¿ç”¨ã€‚</p><p>Redis è¿˜å¯ä»¥æŒä¹…åŒ–æ•°æ®ï¼Œæ”¯æŒæ•°æ®å¤‡ä»½å’Œæ¢å¤ï¼Œé€‚ç”¨äºå¯¹æ•°æ®å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ã€‚å¹¶ä¸”æ”¯æŒå‘å¸ƒ/è®¢é˜…ã€äº‹åŠ¡ã€Lua è„šæœ¬ç­‰é«˜çº§åŠŸèƒ½ã€‚</p><p>æ•ˆç‡ä¸Šï¼ŒRedis å’Œæœ¬åœ°ç¼“å­˜éƒ½æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè¯»å†™é€Ÿåº¦éƒ½éå¸¸å¿«ã€‚</p><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨åŒå­¦ 7 Java åç«¯å®ä¹ ä¸€é¢çš„åŸé¢˜ï¼šæ€ä¹ˆä¿è¯äºŒçº§ç¼“å­˜å’Œ Redis ç¼“å­˜çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åä¸ºé¢ç»åŒå­¦ 11 é¢è¯•åŸé¢˜ï¼šä½¿ç”¨çš„ guava cache å’Œ redis æ˜¯å¦‚ä½•ç»„åˆä½¿ç”¨çš„ï¼Ÿå¦‚æœåœ¨é¡¹ç›®ä¸­å¤šä¸ªåœ°æ–¹éƒ½è¦ä½¿ç”¨åˆ°äºŒçº§ç¼“å­˜çš„é€»è¾‘ï¼Œå¦‚ä½•è®¾è®¡è¿™ä¸€å—ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å»å“ªå„¿åŒå­¦ 1 æŠ€æœ¯äºŒé¢çš„åŸé¢˜ï¼šredis å’Œæœ¬åœ°ç¼“å­˜çš„åŒºåˆ«ï¼Œå“ªä¸ªæ•ˆç‡é«˜</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ‹¼å¤šå¤šé¢ç»åŒå­¦ 8 ä¸€é¢é¢è¯•åŸé¢˜ï¼šç¼“å­˜ä¸€è‡´æ€§å¦‚ä½•ä¿è¯</li></ol></blockquote><h3 id="_30-æ€ä¹ˆå¤„ç†çƒ­-key" tabindex="-1"><a class="header-anchor" href="#_30-æ€ä¹ˆå¤„ç†çƒ­-key"><span>30.æ€ä¹ˆå¤„ç†çƒ­ keyï¼Ÿ</span></a></h3><p>æ¨èé˜…è¯»ï¼š</p><ul><li><a href="https://help.aliyun.com/zh/redis/user-guide/identify-and-handle-large-keys-and-hotkeys" target="_blank" rel="noopener noreferrer">é˜¿é‡Œï¼šå‘ç°å¹¶å¤„ç† Redis çš„å¤§ Key å’Œçƒ­ Key</a></li><li><a href="https://dongzl.github.io/2021/01/14/03-Redis-Hot-Key/index.html" target="_blank" rel="noopener noreferrer">è‘£å®—ç£Šï¼šRedis çƒ­ Key å‘ç°ä»¥åŠè§£å†³åŠæ³•</a></li></ul><p>æ‰€è°“çš„çƒ­ keyï¼Œå°±æ˜¯æŒ‡åœ¨å¾ˆçŸ­æ—¶é—´å†…è¢«é¢‘ç¹è®¿é—®çš„é”®ã€‚</p><p>æ¯”å¦‚ï¼Œçƒ­é—¨æ–°é—»æˆ–çƒ­é—¨å•†å“ï¼Œè¿™ç±» key é€šå¸¸ä¼šæœ‰å¤§æµé‡çš„è®¿é—®ï¼Œå¯¹å­˜å‚¨è¿™ç±»ä¿¡æ¯çš„ Redis æ¥è¯´ï¼Œæ˜¯ä¸å°çš„å‹åŠ›ã€‚</p><blockquote><p>æŸå¤©æŸæµé‡æ˜æ˜Ÿçªç„¶çˆ†å‡ºä¸€ä¸ªå¤§ç“œï¼Œå¾®åšçªç„¶å°±å´©äº†ï¼Œè¿™å°±æ˜¯çƒ­ key çš„å‹åŠ›ã€‚</p></blockquote><p>å†æ¯”å¦‚è¯´ Redis æ˜¯é›†ç¾¤éƒ¨ç½²ï¼Œçƒ­ key å¯èƒ½ä¼šé€ æˆæ•´ä½“æµé‡çš„ä¸å‡è¡¡ï¼ˆç½‘ç»œå¸¦å®½ã€CPU å’Œå†…å­˜èµ„æºï¼‰ï¼Œä¸ªåˆ«èŠ‚ç‚¹å‡ºç° OPS è¿‡å¤§çš„æƒ…å†µï¼Œæç«¯æƒ…å†µä¸‹çƒ­ç‚¹ key ç”šè‡³ä¼šè¶…è¿‡ Redis æœ¬èº«èƒ½å¤Ÿæ‰¿å—çš„ OPSã€‚</p><blockquote><p>OPSï¼ˆOperations Per Secondï¼‰æ˜¯ Redis çš„ä¸€ä¸ªé‡è¦æŒ‡æ ‡ï¼Œè¡¨ç¤º Redis æ¯ç§’é’Ÿèƒ½å¤Ÿå¤„ç†çš„å‘½ä»¤æ•°ã€‚</p></blockquote><p>é€šå¸¸ä»¥ Key è¢«è¯·æ±‚çš„é¢‘ç‡æ¥åˆ¤å®šï¼Œæ¯”å¦‚ï¼š</p><ul><li><strong>QPS é›†ä¸­åœ¨ç‰¹å®šçš„ Key</strong>ï¼šæ€»çš„ QPSï¼ˆæ¯ç§’æŸ¥è¯¢ç‡ï¼‰ä¸º 10000ï¼Œå…¶ä¸­ä¸€ä¸ª Key çš„ QPS é£™åˆ°äº† 8000ã€‚</li><li><strong>å¸¦å®½ä½¿ç”¨ç‡é›†ä¸­åœ¨ç‰¹å®šçš„ Key</strong>ï¼šä¸€ä¸ªæ‹¥æœ‰ä¸Šåƒæˆå‘˜ä¸”æ€»å¤§å°ä¸º 1M çš„å“ˆå¸Œ Keyï¼Œæ¯ç§’å‘é€å¤§é‡çš„ HGETALL è¯·æ±‚ã€‚</li><li><strong>CPU ä½¿ç”¨ç‡é›†ä¸­åœ¨ç‰¹å®šçš„ Key</strong>ï¼šä¸€ä¸ªæ‹¥æœ‰æ•°ä¸‡ä¸ªæˆå‘˜çš„ ZSET Keyï¼Œæ¯ç§’å‘é€å¤§é‡çš„ ZRANGE è¯·æ±‚ã€‚</li></ul><blockquote><ul><li>HGETALL å‘½ä»¤ç”¨äºè¿”å›å“ˆå¸Œè¡¨ä¸­ï¼Œæ‰€æœ‰çš„å­—æ®µå’Œå€¼ã€‚</li><li>ZRANGE å‘½ä»¤ç”¨äºè¿”å›æœ‰åºé›†ä¸­ï¼ŒæŒ‡å®šåŒºé—´å†…çš„æˆå‘˜ã€‚</li></ul></blockquote><h4 id="æ€ä¹ˆå¤„ç†çƒ­-key" tabindex="-1"><a class="header-anchor" href="#æ€ä¹ˆå¤„ç†çƒ­-key"><span>æ€ä¹ˆå¤„ç†çƒ­ keyï¼Ÿ</span></a></h4><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-6fa972ec-5531-48f2-a608-4465d79d4518.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šçƒ­keyå¤„ç†" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šçƒ­keyå¤„ç†</figcaption></figure><p>å¯¹çƒ­ key çš„å¤„ç†ï¼Œæœ€å…³é”®çš„æ˜¯å¯¹çƒ­ key çš„ç›‘æ§:</p><p>â‘ ã€å®¢æˆ·ç«¯</p><p>å®¢æˆ·ç«¯å…¶å®æ˜¯è·ç¦» keyâ€œæœ€è¿‘â€çš„åœ°æ–¹ï¼Œå› ä¸º Redis å‘½ä»¤å°±æ˜¯ä»å®¢æˆ·ç«¯å‘å‡ºçš„ï¼Œä¾‹å¦‚åœ¨å®¢æˆ·ç«¯è®¾ç½®å…¨å±€å­—å…¸ï¼ˆkey å’Œè°ƒç”¨æ¬¡æ•°ï¼‰ï¼Œæ¯æ¬¡è°ƒç”¨ Redis å‘½ä»¤æ—¶ï¼Œä½¿ç”¨è¿™ä¸ªå­—å…¸è¿›è¡Œè®°å½•ã€‚</p><p>â‘¡ã€ä»£ç†ç«¯</p><p>åƒ Twemproxyã€Codis è¿™äº›åŸºäºä»£ç†çš„ Redis åˆ†å¸ƒå¼æ¶æ„ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯çš„è¯·æ±‚éƒ½æ˜¯é€šè¿‡ä»£ç†ç«¯å®Œæˆçš„ï¼Œå¯ä»¥åœ¨ä»£ç†ç«¯è¿›è¡Œç›‘æ§ã€‚</p><p>â‘¢ã€Redis æœåŠ¡ç«¯</p><p>ä½¿ç”¨ monitor å‘½ä»¤ç»Ÿè®¡çƒ­ç‚¹ key æ˜¯å¾ˆå¤šå¼€å‘å’Œè¿ç»´äººå‘˜é¦–å…ˆæƒ³åˆ°çš„æ–¹æ¡ˆï¼Œmonitor å‘½ä»¤å¯ä»¥ç›‘æ§åˆ° Redis æ‰§è¡Œçš„æ‰€æœ‰å‘½ä»¤ã€‚</p><blockquote><p>monitor å‘½ä»¤çš„ä½¿ç”¨ï¼š<code>redis-cli monitor</code></p></blockquote><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240309085135.png" alt="äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šmonitor" tabindex="0" loading="lazy"><figcaption>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šmonitor</figcaption></figure><p>è¿˜å¯ä»¥é€šè¿‡ bigkeys å‚æ•°æ¥åˆ†æçƒ­ Keyã€‚</p><blockquote><p>bigkeys å‘½ä»¤çš„ä½¿ç”¨ï¼š<code>redis-cli --bigkeys</code></p></blockquote><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240309090340.png" alt="äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šbigkeys" tabindex="0" loading="lazy"><figcaption>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šbigkeys</figcaption></figure><p>åªè¦ç›‘æ§åˆ°äº†çƒ­ keyï¼Œå¯¹çƒ­ key çš„å¤„ç†å°±ç®€å•äº†ï¼š</p><p>â‘ ã€æŠŠçƒ­ key æ‰“æ•£åˆ°ä¸åŒçš„æœåŠ¡å™¨ï¼Œé™ä½å‹â¼’ã€‚</p><p>åŸºæœ¬æ€è·¯å°±æ˜¯ç»™çƒ­ Key åŠ ä¸Šå‰ç¼€æˆ–è€…åç¼€ï¼Œè§ä¸‹ä¾‹ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// N ä¸º Redis å®ä¾‹ä¸ªæ•°ï¼ŒM ä¸º N çš„ 2å€</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> M </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> N </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">//ç”Ÿæˆéšæœºæ•°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">random </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> GenRandom</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> M)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">//æ„é€ å¤‡ä»½æ–° Key</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">bakHotKey </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> hotKey </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;_&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> random</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">data </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">GET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(bakHotKey)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> data </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> NULL {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    data </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">GET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(hotKey)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> data </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> NULL {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">        data </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> GetFromDB</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // å¯ä»¥åˆ©ç”¨åŸå­é”æ¥å†™å…¥æ•°æ®ä¿è¯æ•°æ®ä¸€è‡´æ€§</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(hotKey, data, expireTime)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(bakHotKey, data, expireTime </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> GenRandom</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(bakHotKey, data, expireTime </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> GenRandom</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â‘¡ã€åŠ â¼Šâ¼†çº§ç¼“å­˜ï¼Œå½“å‡ºç°çƒ­ Key åï¼ŒæŠŠçƒ­ Key åŠ è½½åˆ° JVM ä¸­ï¼Œåç»­é’ˆå¯¹è¿™äº›çƒ­ Key çš„è¯·æ±‚ï¼Œç›´æ¥ä» JVM ä¸­è¯»å–ã€‚</p><p>è¿™äº›æœ¬åœ°çš„ç¼“å­˜å·¥å…·æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ Caffeineã€Guava ç­‰ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ HashMap ä½œä¸ºæœ¬åœ°ç¼“å­˜éƒ½æ˜¯å¯ä»¥çš„ã€‚</p><p>æ³¨æ„ï¼Œå¦‚æœå¯¹çƒ­ Key è¿›è¡Œæœ¬åœ°ç¼“å­˜ï¼Œéœ€è¦é˜²æ­¢æœ¬åœ°ç¼“å­˜è¿‡å¤§ã€‚</p><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åä¸º OD çš„é¢è¯•ä¸­å‡ºç°è¿‡è¯¥é¢˜ï¼šè®²ä¸€è®² Redis çš„çƒ­ Key å’Œå¤§ Key</li></ol></blockquote><h3 id="_31-ç¼“å­˜é¢„çƒ­æ€ä¹ˆåšå‘¢" tabindex="-1"><a class="header-anchor" href="#_31-ç¼“å­˜é¢„çƒ­æ€ä¹ˆåšå‘¢"><span>31.ç¼“å­˜é¢„çƒ­æ€ä¹ˆåšå‘¢ï¼Ÿ</span></a></h3><p>ç¼“å­˜é¢„çƒ­æ˜¯æŒ‡åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œæå‰å°†ä¸€äº›é¢„å®šä¹‰çš„æ•°æ®åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œä»¥é¿å…åœ¨ç³»ç»Ÿè¿è¡ŒåˆæœŸç”±äºç¼“å­˜æœªå‘½ä¸­ï¼ˆcache missï¼‰å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€‚</p><p>é€šè¿‡ç¼“å­˜é¢„çƒ­ï¼Œå¯ä»¥ç¡®ä¿ç³»ç»Ÿåœ¨ä¸Šçº¿åèƒ½å¤Ÿç«‹å³æä¾›é«˜æ•ˆçš„æœåŠ¡ï¼Œå‡å°‘é¦–æ¬¡è®¿é—®æ—¶çš„å»¶è¿Ÿã€‚</p><p>ç¼“å­˜é¢„çƒ­çš„æ–¹æ³•æœ‰å¤šç§ï¼Œåœ¨<a href="https://javabetter.cn/zhishixingqiu/paicoding.html" target="_blank" rel="noopener noreferrer">æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®</a>ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†é¡¹ç›®å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½å’Œå®šæ—¶é¢„çƒ­ä¸¤ç§æ–¹å¼ï¼Œæ¯”å¦‚è¯´æ¯å¤©å®šæ—¶æ›´æ–°ç«™ç‚¹åœ°å›¾åˆ° Redis ç¼“å­˜ä¸­ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">/**</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> * é‡‡ç”¨å®šæ—¶å™¨æ–¹æ¡ˆï¼Œæ¯å¤©5:15åˆ†åˆ·æ–°ç«™ç‚¹åœ°å›¾ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Scheduled</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">cron</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;0 15 5 * * ?&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> autoRefreshCache</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;å¼€å§‹åˆ·æ–°sitemap.xmlçš„urlåœ°å€ï¼Œé¿å…å‡ºç°æ•°æ®ä¸ä¸€è‡´é—®é¢˜!&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    refreshSitemap</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;åˆ·æ–°å®Œæˆï¼&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> refreshSitemap</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    initSiteMap</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> synchronized</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> initSiteMap</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    long</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> lastId </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0L</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    RedisClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">del</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(SITE_MAP_CACHE_KEY);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    while</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">SimpleArticleDTO</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> list </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> articleDao</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBaseMapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">listArticlesOrderById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(lastId, SCAN_SIZE);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // åˆ·æ–°ç«™ç‚¹åœ°å›¾ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        Map</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Long</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> map </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> list</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">stream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">collect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Collectors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">toMap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(s </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">valueOf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">s</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()), s </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> s</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getCreateTime</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getTime</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), (a, b) </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> a));</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        RedisClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">hMSet</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(SITE_MAP_CACHE_KEY, map);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">list</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> SCAN_SIZE) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            break</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">        lastId </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> list</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">list</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 1 æŠ€æœ¯äºŒé¢é¢è¯•åŸé¢˜ï¼šä»€ä¹ˆæ˜¯ç¼“å­˜é¢„çƒ­ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</li></ol></blockquote><h3 id="_32-çƒ­ç‚¹-key-é‡å»º-é—®é¢˜-è§£å†³" tabindex="-1"><a class="header-anchor" href="#_32-çƒ­ç‚¹-key-é‡å»º-é—®é¢˜-è§£å†³"><span>32.çƒ­ç‚¹ key é‡å»ºï¼Ÿé—®é¢˜ï¼Ÿè§£å†³ï¼Ÿ</span></a></h3><p>å¼€å‘çš„æ—¶å€™ä¸€èˆ¬ä½¿ç”¨â€œç¼“å­˜+è¿‡æœŸæ—¶é—´â€çš„ç­–ç•¥ï¼Œæ—¢å¯ä»¥åŠ é€Ÿæ•°æ®è¯»å†™ï¼Œåˆä¿è¯æ•°æ®çš„å®šæœŸæ›´æ–°ï¼Œè¿™ç§æ¨¡å¼åŸºæœ¬èƒ½å¤Ÿæ»¡è¶³ç»å¤§éƒ¨åˆ†éœ€æ±‚ã€‚</p><p>ä½†æ˜¯æœ‰ä¸¤ä¸ªé—®é¢˜å¦‚æœåŒæ—¶å‡ºç°ï¼Œå¯èƒ½å°±ä¼šå‡ºç°æ¯”è¾ƒå¤§çš„é—®é¢˜ï¼š</p><ul><li><p>å½“å‰ key æ˜¯ä¸€ä¸ªçƒ­ç‚¹ keyï¼ˆä¾‹å¦‚ä¸€ä¸ªçƒ­é—¨çš„å¨±ä¹æ–°é—»ï¼‰ï¼Œå¹¶å‘é‡éå¸¸å¤§ã€‚</p></li><li><p>é‡å»ºç¼“å­˜ä¸èƒ½åœ¨çŸ­æ—¶é—´å®Œæˆï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªå¤æ‚è®¡ç®—ï¼Œä¾‹å¦‚å¤æ‚çš„ SQLã€å¤šæ¬¡ IOã€å¤šä¸ªä¾èµ–ç­‰ã€‚ åœ¨ç¼“å­˜å¤±æ•ˆçš„ç¬é—´ï¼Œæœ‰å¤§é‡çº¿ç¨‹æ¥é‡å»ºç¼“å­˜ï¼Œé€ æˆåç«¯è´Ÿè½½åŠ å¤§ï¼Œç”šè‡³å¯èƒ½ä¼šè®©åº”ç”¨å´©æºƒã€‚</p></li></ul><blockquote><p><strong>æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</strong></p></blockquote><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿä¸æ˜¯å¾ˆå¤æ‚ï¼Œè§£å†³é—®é¢˜çš„è¦ç‚¹åœ¨äºï¼š</p><ul><li>å‡å°‘é‡å»ºç¼“å­˜çš„æ¬¡æ•°ã€‚</li><li>æ•°æ®å°½å¯èƒ½ä¸€è‡´ã€‚</li><li>è¾ƒå°‘çš„æ½œåœ¨å±é™©ã€‚</li></ul><p>æ‰€ä»¥ä¸€èˆ¬é‡‡ç”¨å¦‚ä¸‹æ–¹å¼ï¼š</p><ol><li>äº’æ–¥é”ï¼ˆmutex keyï¼‰ è¿™ç§æ–¹æ³•åªå…è®¸ä¸€ä¸ªçº¿ç¨‹é‡å»ºç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…é‡å»ºç¼“å­˜çš„çº¿ç¨‹æ‰§è¡Œå®Œï¼Œé‡æ–°ä»ç¼“å­˜è·å–æ•°æ®å³å¯ã€‚</li><li>æ°¸è¿œä¸è¿‡æœŸ â€œæ°¸è¿œä¸è¿‡æœŸâ€åŒ…å«ä¸¤å±‚æ„æ€ï¼š</li></ol><ul><li>ä»ç¼“å­˜å±‚é¢æ¥çœ‹ï¼Œç¡®å®æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°çƒ­ç‚¹ key è¿‡æœŸåäº§ç”Ÿçš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯â€œç‰©ç†â€ä¸è¿‡æœŸã€‚</li><li>ä»åŠŸèƒ½å±‚é¢æ¥çœ‹ï¼Œä¸ºæ¯ä¸ª value è®¾ç½®ä¸€ä¸ªé€»è¾‘è¿‡æœŸæ—¶é—´ï¼Œå½“å‘ç°è¶…è¿‡é€»è¾‘è¿‡æœŸæ—¶é—´åï¼Œä¼šä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹å»æ„å»ºç¼“å­˜ã€‚</li></ul><h3 id="_33-æ— åº•æ´é—®é¢˜å—-å¦‚ä½•è§£å†³" tabindex="-1"><a class="header-anchor" href="#_33-æ— åº•æ´é—®é¢˜å—-å¦‚ä½•è§£å†³"><span>33.æ— åº•æ´é—®é¢˜å—ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</span></a></h3><blockquote><p><strong>ä»€ä¹ˆæ˜¯æ— åº•æ´é—®é¢˜ï¼Ÿ</strong></p></blockquote><p>2010 å¹´ï¼ŒFacebook çš„ Memcache èŠ‚ç‚¹å·²ç»è¾¾åˆ°äº† 3000 ä¸ªï¼Œæ‰¿è½½ç€ TB çº§åˆ«çš„ç¼“å­˜æ•°æ®ã€‚ä½†å¼€å‘å’Œè¿ç»´äººå‘˜å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºäº†æ»¡è¶³ä¸šåŠ¡è¦æ±‚æ·»åŠ äº†å¤§é‡æ–° Memcache èŠ‚ç‚¹ï¼Œä½†æ˜¯å‘ç°æ€§èƒ½ä¸ä½†æ²¡æœ‰å¥½è½¬åè€Œä¸‹é™äº†ï¼Œå½“æ—¶å°†è¿™ ç§ç°è±¡ç§°ä¸ºç¼“å­˜çš„â€œ<strong>æ— åº•æ´</strong>â€ç°è±¡ã€‚</p><p>é‚£ä¹ˆä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè¿™ç§ç°è±¡å‘¢?</p><p>é€šå¸¸æ¥è¯´æ·»åŠ èŠ‚ç‚¹ä½¿å¾— Memcache é›†ç¾¤ æ€§èƒ½åº”è¯¥æ›´å¼ºäº†ï¼Œä½†äº‹å®å¹¶éå¦‚æ­¤ã€‚é”®å€¼æ•°æ®åº“ç”±äºé€šå¸¸é‡‡ç”¨å“ˆå¸Œå‡½æ•°å°† key æ˜ å°„åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šï¼Œé€ æˆ key çš„åˆ†å¸ƒä¸ä¸šåŠ¡æ— å…³ï¼Œä½†æ˜¯ç”±äºæ•°æ®é‡å’Œè®¿é—®é‡çš„æŒç»­å¢é•¿ï¼Œé€ æˆéœ€è¦æ·»åŠ å¤§é‡èŠ‚ç‚¹åšæ°´å¹³æ‰©å®¹ï¼Œå¯¼è‡´é”®å€¼åˆ†å¸ƒåˆ°æ›´å¤šçš„ èŠ‚ç‚¹ä¸Šï¼Œæ‰€ä»¥æ— è®ºæ˜¯ Memcache è¿˜æ˜¯ Redis çš„åˆ†å¸ƒå¼ï¼Œæ‰¹é‡æ“ä½œé€šå¸¸éœ€è¦ä»ä¸åŒèŠ‚ç‚¹ä¸Šè·å–ï¼Œç›¸æ¯”äºå•æœºæ‰¹é‡æ“ä½œåªæ¶‰åŠä¸€æ¬¡ç½‘ç»œæ“ä½œï¼Œåˆ†å¸ƒå¼æ‰¹é‡æ“ä½œä¼šæ¶‰åŠå¤šæ¬¡ç½‘ç»œæ—¶é—´ã€‚</p><blockquote><p><strong>æ— åº•æ´é—®é¢˜å¦‚ä½•ä¼˜åŒ–å‘¢ï¼Ÿ</strong></p></blockquote><p>å…ˆåˆ†æä¸€ä¸‹æ— åº•æ´é—®é¢˜ï¼š</p><ul><li><p>å®¢æˆ·ç«¯ä¸€æ¬¡æ‰¹é‡æ“ä½œä¼šæ¶‰åŠå¤šæ¬¡ç½‘ç»œæ“ä½œï¼Œä¹Ÿå°±æ„å‘³ç€æ‰¹é‡æ“ä½œä¼šéšç€èŠ‚ç‚¹çš„å¢å¤šï¼Œè€—æ—¶ä¼šä¸æ–­å¢å¤§ã€‚</p></li><li><p>ç½‘ç»œè¿æ¥æ•°å˜å¤šï¼Œå¯¹èŠ‚ç‚¹çš„æ€§èƒ½ä¹Ÿæœ‰ä¸€å®šå½±å“ã€‚</p></li></ul><p>å¸¸è§çš„ä¼˜åŒ–æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li><p>å‘½ä»¤æœ¬èº«çš„ä¼˜åŒ–ï¼Œä¾‹å¦‚ä¼˜åŒ–æ“ä½œè¯­å¥ç­‰ã€‚</p></li><li><p>å‡å°‘ç½‘ç»œé€šä¿¡æ¬¡æ•°ã€‚</p></li><li><p>é™ä½æ¥å…¥æˆæœ¬ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯ä½¿ç”¨é•¿è¿/è¿æ¥æ± ã€NIO ç­‰ã€‚</p></li></ul><p>GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š<a href="https://github.com/itwanger/toBeBetterJavaer" target="_blank" rel="noopener noreferrer">äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯</a>ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&amp;å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š<a href="https://javabetter.cn/overview/" target="_blank" rel="noopener noreferrer">å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹</a></p><p>å¾®ä¿¡æœ <strong>æ²‰é»˜ç‹äºŒ</strong> æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ <strong>222</strong> å³å¯å…è´¹é¢†å–ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="redis-è¿ç»´" tabindex="-1"><a class="header-anchor" href="#redis-è¿ç»´"><span>Redis è¿ç»´</span></a></h2><h3 id="_34-redis-æŠ¥å†…å­˜ä¸è¶³æ€ä¹ˆå¤„ç†" tabindex="-1"><a class="header-anchor" href="#_34-redis-æŠ¥å†…å­˜ä¸è¶³æ€ä¹ˆå¤„ç†"><span>34.Redis æŠ¥å†…å­˜ä¸è¶³æ€ä¹ˆå¤„ç†ï¼Ÿ</span></a></h3><p>Redis å†…å­˜ä¸è¶³æœ‰è¿™ä¹ˆå‡ ç§å¤„ç†æ–¹å¼ï¼š</p><ul><li>ä¿®æ”¹é…ç½®æ–‡ä»¶ redis.conf çš„ maxmemory å‚æ•°ï¼Œå¢åŠ  Redis å¯ç”¨å†…å­˜</li><li>ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤ set maxmemory åŠ¨æ€è®¾ç½®å†…å­˜ä¸Šé™</li><li>ä¿®æ”¹å†…å­˜æ·˜æ±°ç­–ç•¥ï¼ŒåŠæ—¶é‡Šæ”¾å†…å­˜ç©ºé—´</li><li>ä½¿ç”¨ Redis é›†ç¾¤æ¨¡å¼ï¼Œè¿›è¡Œæ¨ªå‘æ‰©å®¹ã€‚</li></ul><h3 id="_35-redis-key-è¿‡æœŸç­–ç•¥æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#_35-redis-key-è¿‡æœŸç­–ç•¥æœ‰å“ªäº›"><span>35.Redis key è¿‡æœŸç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</span></a></h3><p>Redis çš„ key è¿‡æœŸå›æ”¶ç­–ç•¥ä¸»è¦æœ‰ä¸¤ç§ï¼šæƒ°æ€§åˆ é™¤å’Œå®šæœŸåˆ é™¤ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240326214119.png" alt="äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šRedis çš„è¿‡æœŸæ·˜æ±°ç­–ç•¥" tabindex="0" loading="lazy"><figcaption>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šRedis çš„è¿‡æœŸæ·˜æ±°ç­–ç•¥</figcaption></figure><p>å½“æŸä¸ªé”®è¢«è®¿é—®æ—¶ï¼Œå¦‚æœå‘ç°å®ƒå·²ç»è¿‡æœŸï¼ŒRedis ä¼šç«‹å³åˆ é™¤è¯¥é”®ï¼Œä¿—ç§°æƒ°æ€§åˆ é™¤ã€‚ä½†è¿™ä¹Ÿæ„å‘³ç€å¦‚æœä¸€ä¸ªå·²è¿‡æœŸçš„é”®ä»æœªè¢«è®¿é—®ï¼Œå®ƒå°±ä¸ä¼šè¢«åˆ é™¤ï¼Œä¼šå ç”¨é¢å¤–çš„å†…å­˜ç©ºé—´ã€‚</p><p>é‚£è¿˜æœ‰ä¸€ç§å®šæœŸåˆ é™¤ç­–ç•¥ï¼Œå³æ¯éš”ä¸€æ®µæ—¶é—´ï¼ŒRedis å°±ä¼šéšæœºæ£€æŸ¥ä¸€äº›é”®æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸå°±åˆ é™¤ã€‚è¿™ç§ç­–ç•¥å¯ä»¥ä¿è¯è¿‡æœŸé”®åŠæ—¶è¢«åˆ é™¤ï¼Œä½†ä¹Ÿä¼šå¢åŠ  Redis çš„ CPU æ¶ˆè€—ã€‚</p><p>å¯ä»¥é€šè¿‡ <code>config get hz</code> å‘½ä»¤æŸ¥çœ‹ Redis å†…éƒ¨å®šæ—¶ä»»åŠ¡çš„é¢‘ç‡ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240326214800.png" alt="äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šconfig get hz" tabindex="0" loading="lazy"><figcaption>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šconfig get hz</figcaption></figure><p>ç»“æœæ˜¾ç¤º hz çš„å€¼ä¸º &quot;10&quot;ï¼Œæ„å‘³ç€ Redis æœåŠ¡å™¨æ¯ç§’æ‰§è¡Œå®šæ—¶ä»»åŠ¡çš„é¢‘ç‡æ˜¯ 10 æ¬¡ã€‚å¯ä»¥é€šè¿‡ <code>CONFIG SET hz 20</code> è¿›è¡Œè°ƒæ•´ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240326215240.png" alt="äºŒå“¥æœ¬åœ° Redis çš„é…ç½®æ–‡ä»¶è·¯å¾„å’Œ hz çš„é»˜è®¤å€¼" tabindex="0" loading="lazy"><figcaption>äºŒå“¥æœ¬åœ° Redis çš„é…ç½®æ–‡ä»¶è·¯å¾„å’Œ hz çš„é»˜è®¤å€¼</figcaption></figure><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 22 æš‘æœŸå®ä¹ ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis key åˆ é™¤ç­–ç•¥</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å»å“ªå„¿é¢ç»åŒå­¦ 1 æŠ€æœ¯ 2 é¢é¢è¯•åŸé¢˜ï¼šredis å†…å­˜æ·˜æ±°å’Œè¿‡æœŸç­–ç•¥</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 5 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šredis keyè¿‡æœŸç­–ç•¥</li></ol></blockquote><h3 id="_36-redis-æœ‰å“ªäº›å†…å­˜æ·˜æ±°ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_36-redis-æœ‰å“ªäº›å†…å­˜æ·˜æ±°ç­–ç•¥"><span>36.Redis æœ‰å“ªäº›å†…å­˜æ·˜æ±°ç­–ç•¥ï¼Ÿ</span></a></h3><p>å½“ Redis çš„å†…å­˜ä½¿ç”¨è¾¾åˆ°æœ€å¤§å€¼æ—¶ï¼Œå®ƒä¼šæ ¹æ®é…ç½®çš„å†…å­˜æ·˜æ±°ç­–ç•¥æ¥å†³å®šå¦‚ä½•å¤„ç†æ–°çš„è¯·æ±‚ã€‚</p><blockquote><p>æœ€å¤§å€¼é€šè¿‡ maxmemory å‚æ•°è®¾ç½®</p></blockquote><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-5be7405c-ee11-4d2b-bea4-9598f10a1b17.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRediså…­ç§å†…å­˜æº¢å‡ºæ§åˆ¶ç­–ç•¥" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRediså…­ç§å†…å­˜æº¢å‡ºæ§åˆ¶ç­–ç•¥</figcaption></figure><p>å¸¸è§çš„ç­–ç•¥æœ‰ï¼š</p><ol><li>noevictionï¼šé»˜è®¤ç­–ç•¥ï¼Œä¸è¿›è¡Œä»»ä½•æ•°æ®æ·˜æ±°ï¼Œç›´æ¥è¿”å›é”™è¯¯ä¿¡æ¯ã€‚</li><li>allkeys-lruï¼šä»æ‰€æœ‰é”®ä¸­ï¼Œä½¿ç”¨ LRU ç®—æ³•æ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é”®ã€‚</li><li>allkeys-lfuï¼šä»æ‰€æœ‰é”®ä¸­ï¼Œä½¿ç”¨ LFU ç®—æ³•æ·˜æ±°æœ€å°‘ä½¿ç”¨çš„é”®ã€‚</li><li>volatile-lruï¼šä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­æ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é”®ã€‚</li><li>volatile-ttlï¼šä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­æ·˜æ±°å³å°†è¿‡æœŸçš„é”®ã€‚</li></ol><blockquote><p>TTLï¼ŒTime To Liveï¼Œå­˜æ´»æ—¶é—´</p></blockquote><h4 id="lru-å’Œ-lfu-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#lru-å’Œ-lfu-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ"><span>LRU å’Œ LFU çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h4><p>LRUï¼ˆLeast Recently Usedï¼‰ï¼šåŸºäºæ—¶é—´ç»´åº¦ï¼Œæ·˜æ±°æœ€è¿‘æœ€å°‘è®¿é—®çš„é”®ã€‚é€‚åˆè®¿é—®å…·æœ‰æ—¶é—´ç‰¹æ€§çš„åœºæ™¯ã€‚</p><p>LFUï¼ˆLeast Frequently Usedï¼‰ï¼šåŸºäºæ¬¡æ•°ç»´åº¦ï¼Œæ·˜æ±°è®¿é—®é¢‘ç‡æœ€ä½çš„é”®ã€‚æ›´é€‚åˆé•¿æœŸçƒ­ç‚¹æ•°æ®åœºæ™¯ã€‚</p><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³æ˜¥æ‹›åŒå­¦ K ä¸€é¢é¢è¯•åŸé¢˜ï¼šä¸ºä»€ä¹ˆ redis å¿«ï¼Œæ·˜æ±°ç­–ç•¥ æŒä¹…åŒ–</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å»å“ªå„¿é¢ç»åŒå­¦ 1 æŠ€æœ¯ 2 é¢é¢è¯•åŸé¢˜ï¼šredis å†…å­˜æ·˜æ±°å’Œè¿‡æœŸç­–ç•¥</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ä½œä¸šå¸®é¢ç»åŒå­¦ 1 Java åç«¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šrediså†…å­˜æ·˜æ±°ç­–ç•¥</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„é˜¿é‡Œç³»é¢ç»åŒå­¦ 19 é¥¿äº†ä¹ˆé¢è¯•åŸé¢˜ï¼šrediså†…å­˜æ·˜æ±°æœºåˆ¶ å»¶ä¼¸åˆ°LRU LFU</li></ol></blockquote><h3 id="_37-redis-é˜»å¡-æ€ä¹ˆè§£å†³" tabindex="-1"><a class="header-anchor" href="#_37-redis-é˜»å¡-æ€ä¹ˆè§£å†³"><span>37.Redis é˜»å¡ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ</span></a></h3><p>Redis å‘ç”Ÿé˜»å¡ï¼Œå¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ’æŸ¥ï¼š <img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e6a35258-7a78-4489-90b7-e47a4190802b.png" alt="Redisé˜»å¡æ’æŸ¥" loading="lazy"></p><ul><li><p><strong>API æˆ–æ•°æ®ç»“æ„ä½¿ç”¨ä¸åˆç†</strong></p><p>é€šå¸¸ Redis æ‰§è¡Œå‘½ä»¤é€Ÿåº¦éå¸¸å¿«ï¼Œä½†æ˜¯ä¸åˆç†åœ°ä½¿ç”¨å‘½ä»¤ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ‰§è¡Œé€Ÿåº¦å¾ˆæ…¢ï¼Œå¯¼è‡´é˜»å¡ï¼Œå¯¹äºé«˜å¹¶å‘çš„åœºæ™¯ï¼Œåº”è¯¥å°½é‡é¿å…åœ¨å¤§å¯¹è±¡ä¸Šæ‰§è¡Œç®—æ³•å¤æ‚ åº¦è¶…è¿‡ Oï¼ˆnï¼‰çš„å‘½ä»¤ã€‚</p><p>å¯¹æ…¢æŸ¥è¯¢çš„å¤„ç†åˆ†ä¸ºä¸¤æ­¥ï¼š</p><ol><li>å‘ç°æ…¢æŸ¥è¯¢ï¼š slowlog get{n}å‘½ä»¤å¯ä»¥è·å–æœ€è¿‘ çš„ n æ¡æ…¢æŸ¥è¯¢å‘½ä»¤ï¼›</li><li>å‘ç°æ…¢æŸ¥è¯¢åï¼Œå¯ä»¥ä»ä¸¤ä¸ªæ–¹å‘å»ä¼˜åŒ–æ…¢æŸ¥è¯¢ï¼š 1ï¼‰ä¿®æ”¹ä¸ºä½ç®—æ³•å¤æ‚åº¦çš„å‘½ä»¤ï¼Œå¦‚ hgetall æ”¹ä¸º hmget ç­‰ï¼Œç¦ç”¨ keysã€sort ç­‰å‘½ ä»¤ 2ï¼‰è°ƒæ•´å¤§å¯¹è±¡ï¼šç¼©å‡å¤§å¯¹è±¡æ•°æ®æˆ–æŠŠå¤§å¯¹è±¡æ‹†åˆ†ä¸ºå¤šä¸ªå°å¯¹è±¡ï¼Œé˜²æ­¢ä¸€æ¬¡å‘½ä»¤æ“ä½œè¿‡å¤šçš„æ•°æ®ã€‚</li></ol></li><li><p><strong>CPU é¥±å’Œçš„é—®é¢˜</strong></p><p>å•çº¿ç¨‹çš„ Redis å¤„ç†å‘½ä»¤æ—¶åªèƒ½ä½¿ç”¨ä¸€ä¸ª CPUã€‚è€Œ CPU é¥±å’Œæ˜¯æŒ‡ Redis å•æ ¸ CPU ä½¿ç”¨ç‡è·‘åˆ°æ¥è¿‘ 100%ã€‚</p><p>é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œå¤„ç†æ­¥éª¤ä¸€èˆ¬å¦‚ä¸‹ï¼š</p><ol><li>åˆ¤æ–­å½“å‰ Redis å¹¶å‘é‡æ˜¯å¦å·²ç»è¾¾åˆ°æé™ï¼Œå¯ä»¥ä½¿ç”¨ç»Ÿè®¡å‘½ä»¤ redis-cli-h{ip}-p{port}--stat è·å–å½“å‰ Redis ä½¿ç”¨æƒ…å†µ</li><li>å¦‚æœ Redis çš„è¯·æ±‚å‡ ä¸‡+ï¼Œé‚£ä¹ˆå¤§æ¦‚å°±æ˜¯ Redis çš„ OPS å·²ç»åˆ°äº†æé™ï¼Œåº”è¯¥åšé›†ç¾¤åŒ–æ°´å“æ‰©å±•æ¥åˆ†æ‘Š OPS å‹åŠ›</li><li>å¦‚æœåªæœ‰å‡ ç™¾å‡ åƒï¼Œé‚£ä¹ˆå°±å¾—æ’æŸ¥å‘½ä»¤å’Œå†…å­˜çš„ä½¿ç”¨</li></ol></li><li><p><strong>æŒä¹…åŒ–ç›¸å…³çš„é˜»å¡</strong></p><p>å¯¹äºå¼€å¯äº†æŒä¹…åŒ–åŠŸèƒ½çš„ Redis èŠ‚ç‚¹ï¼Œéœ€è¦æ’æŸ¥æ˜¯å¦æ˜¯æŒä¹…åŒ–å¯¼è‡´çš„é˜»å¡ã€‚</p><ol><li>fork é˜»å¡ fork æ“ä½œå‘ç”Ÿåœ¨ RDB å’Œ AOF é‡å†™æ—¶ï¼ŒRedis ä¸»çº¿ç¨‹è°ƒç”¨ fork æ“ä½œäº§ç”Ÿå…±äº« å†…å­˜çš„å­è¿›ç¨‹ï¼Œç”±å­è¿›ç¨‹å®ŒæˆæŒä¹…åŒ–æ–‡ä»¶é‡å†™å·¥ä½œã€‚å¦‚æœ fork æ“ä½œæœ¬èº«è€—æ—¶è¿‡é•¿ï¼Œå¿…ç„¶ä¼šå¯¼è‡´ä¸»çº¿ç¨‹çš„é˜»å¡ã€‚</li><li>AOF åˆ·ç›˜é˜»å¡ å½“æˆ‘ä»¬å¼€å¯ AOF æŒä¹…åŒ–åŠŸèƒ½æ—¶ï¼Œæ–‡ä»¶åˆ·ç›˜çš„æ–¹å¼ä¸€èˆ¬é‡‡ç”¨æ¯ç§’ä¸€æ¬¡ï¼Œåå°çº¿ç¨‹æ¯ç§’å¯¹ AOF æ–‡ä»¶åš fsync æ“ä½œã€‚å½“ç¡¬ç›˜å‹åŠ›è¿‡å¤§æ—¶ï¼Œfsync æ“ä½œéœ€è¦ç­‰ å¾…ï¼Œç›´åˆ°å†™å…¥å®Œæˆã€‚å¦‚æœä¸»çº¿ç¨‹å‘ç°è·ç¦»ä¸Šä¸€æ¬¡çš„ fsync æˆåŠŸè¶…è¿‡ 2 ç§’ï¼Œä¸ºäº† æ•°æ®å®‰å…¨æ€§å®ƒä¼šé˜»å¡ç›´åˆ°åå°çº¿ç¨‹æ‰§è¡Œ fsync æ“ä½œå®Œæˆã€‚</li><li>HugePage å†™æ“ä½œé˜»å¡ å¯¹äºå¼€å¯ Transparent HugePages çš„ æ“ä½œç³»ç»Ÿï¼Œæ¯æ¬¡å†™å‘½ä»¤å¼•èµ·çš„å¤åˆ¶å†…å­˜é¡µå•ä½ç”± 4K å˜ä¸º 2MBï¼Œæ”¾å¤§äº† 512 å€ï¼Œä¼šæ‹–æ…¢å†™æ“ä½œçš„æ‰§è¡Œæ—¶é—´ï¼Œå¯¼è‡´å¤§é‡å†™æ“ä½œæ…¢æŸ¥è¯¢ã€‚</li></ol></li></ul><h3 id="_38-å¤§-key-é—®é¢˜äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_38-å¤§-key-é—®é¢˜äº†è§£å—"><span>38.å¤§ key é—®é¢˜äº†è§£å—ï¼Ÿ</span></a></h3><p>å¤§ key æŒ‡çš„æ˜¯å­˜å‚¨äº†å¤§é‡æ•°æ®çš„é”®ï¼Œæ¯”å¦‚ï¼š</p><ul><li>å•ä¸ªç®€å•çš„ key å­˜å‚¨çš„ value å¾ˆå¤§ï¼Œsize è¶…è¿‡ 10KB</li><li>hashï¼Œsetï¼Œzsetï¼Œlist ä¸­å­˜å‚¨è¿‡å¤šçš„å…ƒç´ ï¼ˆä»¥ä¸‡ä¸ºå•ä½ï¼‰</li></ul><p>æ¨èé˜…è¯»ï¼š<a href="https://help.aliyun.com/zh/redis/user-guide/identify-and-handle-large-keys-and-hotkeys" target="_blank" rel="noopener noreferrer">é˜¿é‡Œï¼šå‘ç°å¹¶å¤„ç† Redis çš„å¤§ Key å’Œçƒ­ Key</a></p><p><strong>å¤§ key ä¼šé€ æˆä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</strong></p><ul><li>å®¢æˆ·ç«¯è€—æ—¶å¢åŠ ï¼Œç”šè‡³è¶…æ—¶</li><li>å¯¹å¤§ key è¿›è¡Œ IO æ“ä½œæ—¶ï¼Œä¼šä¸¥é‡å ç”¨å¸¦å®½å’Œ CPU</li><li>é€ æˆ Redis é›†ç¾¤ä¸­æ•°æ®å€¾æ–œ</li><li>ä¸»åŠ¨åˆ é™¤ã€è¢«åŠ¨åˆ ç­‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´é˜»å¡</li></ul><p><strong>å¦‚ä½•æ‰¾åˆ°å¤§ key?</strong></p><p>â‘ ã€bigkeys å‚æ•°ï¼šä½¿ç”¨ bigkeys å‘½ä»¤ä»¥éå†çš„æ–¹å¼åˆ†æ Redis å®ä¾‹ä¸­çš„æ‰€æœ‰ Keyï¼Œå¹¶è¿”å›æ•´ä½“ç»Ÿè®¡ä¿¡æ¯ä¸æ¯ä¸ªæ•°æ®ç±»å‹ä¸­ Top1 çš„å¤§ Key</p><blockquote><p>bigkeys å‘½ä»¤çš„ä½¿ç”¨ï¼š<code>redis-cli --bigkeys</code></p></blockquote><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240309091503.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>â‘¡ã€redis-rdb-toolsï¼šredis-rdb-tools æ˜¯ç”± Python è¯­è¨€ç¼–å†™çš„ç”¨æ¥åˆ†æ Redis ä¸­ rdb å¿«ç…§æ–‡ä»¶çš„å·¥å…·ã€‚</p><p>æºç åœ°å€ï¼š<a href="https://github.com/sripathikrishnan/redis-rdb-tools/" target="_blank" rel="noopener noreferrer">https://github.com/sripathikrishnan/redis-rdb-tools/</a></p><blockquote><p>rdbï¼Œå…¨ç§° Redis DataBaseï¼Œæ˜¯ Redis åœ¨å†…å­˜ä¸­çš„æ•°æ®æ ¼å¼çš„ä¸€ç§æŒä¹…åŒ–å­˜å‚¨æ–¹å¼ã€‚</p></blockquote><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240309092121.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>æ¨èé˜…è¯»ï¼š<a href="https://redisbook.readthedocs.io/en/latest/internal/rdb.html" target="_blank" rel="noopener noreferrer">RDB è¯¦è§£</a></p><p><strong>å¦‚ä½•å¤„ç†å¤§ key?</strong></p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e4aaafda-fce1-47f0-8b2b-7261d47b720b.png" alt="å¤§keyå¤„ç†" tabindex="0" loading="lazy"><figcaption>å¤§keyå¤„ç†</figcaption></figure><p>â‘ ã€<strong>åˆ é™¤å¤§ key</strong></p><ul><li>å½“ Redis ç‰ˆæœ¬å¤§äº 4.0 æ—¶ï¼Œå¯ä½¿ç”¨ UNLINK å‘½ä»¤å®‰å…¨åœ°åˆ é™¤å¤§ Keyï¼Œè¯¥å‘½ä»¤èƒ½å¤Ÿä»¥éé˜»å¡çš„æ–¹å¼ï¼Œé€æ­¥åœ°æ¸…ç†ä¼ å…¥çš„å¤§ Keyã€‚</li><li>å½“ Redis ç‰ˆæœ¬å°äº 4.0 æ—¶ï¼Œå»ºè®®é€šè¿‡ SCAN å‘½ä»¤æ‰§è¡Œå¢é‡è¿­ä»£æ‰«æ keyï¼Œç„¶ååˆ¤æ–­è¿›è¡Œåˆ é™¤ã€‚</li></ul><p>â‘¡ã€<strong>å‹ç¼©å’Œæ‹†åˆ† key</strong></p><ul><li>å½“ vaule æ˜¯ string æ—¶ï¼Œæ¯”è¾ƒéš¾æ‹†åˆ†ï¼Œåˆ™ä½¿ç”¨åºåˆ—åŒ–ã€å‹ç¼©ç®—æ³•å°† key çš„å¤§å°æ§åˆ¶åœ¨åˆç†èŒƒå›´å†…ï¼Œä½†æ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–éƒ½ä¼šå¸¦æ¥é¢å¤–çš„æ€§èƒ½æ¶ˆè€—ã€‚</li><li>å½“ value æ˜¯ stringï¼Œå‹ç¼©ä¹‹åä»ç„¶æ˜¯å¤§ key æ—¶ï¼Œåˆ™éœ€è¦è¿›è¡Œæ‹†åˆ†ï¼Œå°†ä¸€ä¸ªå¤§ key åˆ†ä¸ºä¸åŒçš„éƒ¨åˆ†ï¼Œè®°å½•æ¯ä¸ªéƒ¨åˆ†çš„ keyï¼Œä½¿ç”¨ multiget ç­‰æ“ä½œå®ç°äº‹åŠ¡è¯»å–ã€‚</li><li>å½“ value æ˜¯ list/set ç­‰é›†åˆç±»å‹æ—¶ï¼Œæ ¹æ®é¢„ä¼°çš„æ•°æ®è§„æ¨¡æ¥è¿›è¡Œåˆ†ç‰‡ï¼Œä¸åŒçš„å…ƒç´ è®¡ç®—ååˆ†åˆ°ä¸åŒçš„ç‰‡ã€‚</li></ul><blockquote><ol><li>åä¸º OD çš„é¢è¯•ä¸­å‡ºç°è¿‡è¯¥é¢˜ï¼šè®²ä¸€è®² Redis çš„çƒ­ Key å’Œå¤§ Key</li></ol></blockquote><h3 id="_39-redis-å¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_39-redis-å¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ"><span>39.Redis å¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Ÿ</span></a></h3><ol><li>Master æœ€å¥½ä¸è¦åšä»»ä½•æŒä¹…åŒ–å·¥ä½œï¼ŒåŒ…æ‹¬å†…å­˜å¿«ç…§å’Œ AOF æ—¥å¿—æ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯ä¸è¦å¯ç”¨å†…å­˜å¿«ç…§åšæŒä¹…åŒ–ã€‚</li><li>å¦‚æœæ•°æ®æ¯”è¾ƒå…³é”®ï¼ŒæŸä¸ª Slave å¼€å¯ AOF å¤‡ä»½æ•°æ®ï¼Œç­–ç•¥ä¸ºæ¯ç§’åŒæ­¥ä¸€æ¬¡ã€‚</li><li>ä¸ºäº†ä¸»ä»å¤åˆ¶çš„é€Ÿåº¦å’Œè¿æ¥çš„ç¨³å®šæ€§ï¼ŒSlave å’Œ Master æœ€å¥½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…ã€‚</li><li>å°½é‡é¿å…åœ¨å‹åŠ›è¾ƒå¤§çš„ä¸»åº“ä¸Šå¢åŠ ä»åº“ã€‚</li><li>Master è°ƒç”¨ BGREWRITEAOF é‡å†™ AOF æ–‡ä»¶ï¼ŒAOF åœ¨é‡å†™çš„æ—¶å€™ä¼šå å¤§é‡çš„ CPU å’Œå†…å­˜èµ„æºï¼Œå¯¼è‡´æœåŠ¡ load è¿‡é«˜ï¼Œå‡ºç°çŸ­æš‚æœåŠ¡æš‚åœç°è±¡ã€‚</li><li>ä¸ºäº† Master çš„ç¨³å®šæ€§ï¼Œä¸»ä»å¤åˆ¶ä¸è¦ç”¨å›¾çŠ¶ç»“æ„ï¼Œç”¨å•å‘é“¾è¡¨ç»“æ„æ›´ç¨³å®šï¼Œå³ä¸»ä»å…³ä¸ºï¼šMaster&lt;â€“Slave1&lt;â€“Slave2&lt;â€“Slave3â€¦ï¼Œè¿™æ ·çš„ç»“æ„ä¹Ÿæ–¹ä¾¿è§£å†³å•ç‚¹æ•…éšœé—®é¢˜ï¼Œå®ç° Slave å¯¹ Master çš„æ›¿æ¢ï¼Œä¹Ÿå³ï¼Œå¦‚æœ Master æŒ‚äº†ï¼Œå¯ä»¥ç«‹é©¬å¯ç”¨ Slave1 åš Masterï¼Œå…¶ä»–ä¸å˜ã€‚</li></ol><p>GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š<a href="https://github.com/itwanger/toBeBetterJavaer" target="_blank" rel="noopener noreferrer">äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯</a>ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&amp;å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š<a href="https://javabetter.cn/overview/" target="_blank" rel="noopener noreferrer">å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹</a></p><p>å¾®ä¿¡æœ <strong>æ²‰é»˜ç‹äºŒ</strong> æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ <strong>222</strong> å³å¯å…è´¹é¢†å–ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="redis-åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#redis-åº”ç”¨"><span>Redis åº”ç”¨</span></a></h2><h3 id="_40-ä½¿ç”¨-redis-å¦‚ä½•å®ç°å¼‚æ­¥é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#_40-ä½¿ç”¨-redis-å¦‚ä½•å®ç°å¼‚æ­¥é˜Ÿåˆ—"><span>40.ä½¿ç”¨ Redis å¦‚ä½•å®ç°å¼‚æ­¥é˜Ÿåˆ—ï¼Ÿ</span></a></h3><p>æˆ‘ä»¬çŸ¥é“ redis æ”¯æŒå¾ˆå¤šç§ç»“æ„çš„æ•°æ®ï¼Œé‚£ä¹ˆå¦‚ä½•ä½¿ç”¨ redis ä½œä¸ºå¼‚æ­¥é˜Ÿåˆ—ä½¿ç”¨å‘¢ï¼Ÿ ä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p><ul><li><strong>ä½¿ç”¨ list ä½œä¸ºé˜Ÿåˆ—ï¼Œlpush ç”Ÿäº§æ¶ˆæ¯ï¼Œrpop æ¶ˆè´¹æ¶ˆæ¯</strong></li></ul><p>è¿™ç§æ–¹å¼ï¼Œæ¶ˆè´¹è€…æ­»å¾ªç¯ rpop ä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹æ¶ˆæ¯ã€‚ä½†æ˜¯è¿™æ ·ï¼Œå³ä½¿é˜Ÿåˆ—é‡Œæ²¡æœ‰æ¶ˆæ¯ï¼Œä¹Ÿä¼šè¿›è¡Œ rpopï¼Œä¼šå¯¼è‡´ Redis CPU çš„æ¶ˆè€—ã€‚ <img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e4b192a1-3ba7-4f4e-98de-e93f437cff7c.png" alt="listä½œä¸ºé˜Ÿåˆ—" loading="lazy"> å¯ä»¥é€šè¿‡è®©æ¶ˆè´¹è€…ä¼‘çœ çš„æ–¹å¼çš„æ–¹å¼æ¥å¤„ç†ï¼Œä½†æ˜¯è¿™æ ·åˆä¼šåˆæ¶ˆæ¯çš„å»¶è¿Ÿé—®é¢˜ã€‚</p><p>-<strong>ä½¿ç”¨ list ä½œä¸ºé˜Ÿåˆ—ï¼Œlpush ç”Ÿäº§æ¶ˆæ¯ï¼Œbrpop æ¶ˆè´¹æ¶ˆæ¯</strong></p><p>brpop æ˜¯ rpop çš„é˜»å¡ç‰ˆæœ¬ï¼Œlist ä¸ºç©ºçš„æ—¶å€™ï¼Œå®ƒä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ° list ä¸­æœ‰å€¼æˆ–è€…è¶…æ—¶ã€‚ <img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e9581e51-ffc8-4326-9af4-07816743dc88.png" alt="listä½œä¸ºé˜Ÿåˆ—ï¼Œbrpop" loading="lazy"></p><p>è¿™ç§æ–¹å¼åªèƒ½å®ç°ä¸€å¯¹ä¸€çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p><ul><li><strong>ä½¿ç”¨ Redis çš„ pub/sub æ¥è¿›è¡Œæ¶ˆæ¯çš„å‘å¸ƒ/è®¢é˜…</strong></li></ul><p>å‘å¸ƒ/è®¢é˜…æ¨¡å¼å¯ä»¥ 1ï¼šN çš„æ¶ˆæ¯å‘å¸ƒ/è®¢é˜…ã€‚å‘å¸ƒè€…å°†æ¶ˆæ¯å‘å¸ƒåˆ°æŒ‡å®šçš„é¢‘é“é¢‘é“ï¼ˆchannelï¼‰ï¼Œè®¢é˜…ç›¸åº”é¢‘é“çš„å®¢æˆ·ç«¯éƒ½èƒ½æ”¶åˆ°æ¶ˆæ¯ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-bc6d05be-3701-4e23-b4ca-6330c949f020.png" alt="pub/sub" loading="lazy"> ä½†æ˜¯è¿™ç§æ–¹å¼ä¸æ˜¯å¯é çš„ï¼Œå®ƒä¸ä¿è¯è®¢é˜…è€…ä¸€å®šèƒ½æ”¶åˆ°æ¶ˆæ¯ï¼Œä¹Ÿä¸è¿›è¡Œæ¶ˆæ¯çš„å­˜å‚¨ã€‚</p><p>æ‰€ä»¥ï¼Œä¸€èˆ¬çš„å¼‚æ­¥é˜Ÿåˆ—çš„å®ç°è¿˜æ˜¯äº¤ç»™ä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p><h3 id="_41-redis-å¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#_41-redis-å¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—"><span>41.Redis å¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—?</span></a></h3><p>å¯ä»¥ä½¿ç”¨ Redis çš„ zsetï¼ˆæœ‰åºé›†åˆï¼‰æ¥å®ç°å»¶æ—¶é˜Ÿåˆ—ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-54bbcc36-0b00-4142-a6eb-bf2ef48c2213.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šzsetå®ç°å»¶æ—¶é˜Ÿåˆ—" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šzsetå®ç°å»¶æ—¶é˜Ÿåˆ—</figcaption></figure><p>ç¬¬ä¸€æ­¥ï¼Œå°†ä»»åŠ¡æ·»åŠ åˆ° zset ä¸­ï¼Œscore ä¸ºä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´æˆ³ï¼Œvalue ä¸ºä»»åŠ¡çš„å†…å®¹ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ZADD</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> delay_queue</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1617024000</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> task1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç¬¬äºŒæ­¥ï¼Œå®šæœŸï¼ˆä¾‹å¦‚æ¯ç§’ï¼‰ä» zset ä¸­è·å– score å°äºå½“å‰æ—¶é—´æˆ³çš„ä»»åŠ¡ï¼Œç„¶åæ‰§è¡Œä»»åŠ¡ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ZREMRANGEBYSCORE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> delay_queue</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -inf</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1617024000</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç¬¬ä¸‰æ­¥ï¼Œä»»åŠ¡æ‰§è¡Œåï¼Œä» zset ä¸­åˆ é™¤ä»»åŠ¡ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ZREM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> delay_queue</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> task1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 23 QQ åå°æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis å®ç°å»¶è¿Ÿé˜Ÿåˆ—</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 8 Java åç«¯å®ä¹ ä¸€é¢é¢è¯•åŸé¢˜ï¼šredis æ•°æ®ç»“æ„ï¼Œç”¨ä»€ä¹ˆç»“æ„å®ç°å»¶è¿Ÿæ¶ˆæ¯é˜Ÿåˆ—</li></ol></blockquote><h3 id="_42-redis-æ”¯æŒäº‹åŠ¡å—" tabindex="-1"><a class="header-anchor" href="#_42-redis-æ”¯æŒäº‹åŠ¡å—"><span>42.Redis æ”¯æŒäº‹åŠ¡å—ï¼Ÿ</span></a></h3><p>Redis æ”¯æŒç®€å•çš„äº‹åŠ¡ï¼Œå¯ä»¥å°†å¤šä¸ªå‘½ä»¤æ‰“åŒ…ï¼Œç„¶åä¸€æ¬¡æ€§çš„ï¼ŒæŒ‰ç…§é¡ºåºæ‰§è¡Œã€‚ä¸»è¦é€šè¿‡ multiã€execã€discardã€watch ç­‰å‘½ä»¤æ¥å®ç°ï¼š</p><ul><li>multiï¼šæ ‡è®°ä¸€ä¸ªäº‹åŠ¡å—çš„å¼€å§‹</li><li>execï¼šæ‰§è¡Œæ‰€æœ‰äº‹åŠ¡å—å†…çš„å‘½ä»¤</li><li>discardï¼šå–æ¶ˆäº‹åŠ¡ï¼Œæ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡å—å†…çš„æ‰€æœ‰å‘½ä»¤</li><li>watchï¼šç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ª keyï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ª key è¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­</li></ul><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240314101439.png" alt="äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šRedis äº‹åŠ¡" tabindex="0" loading="lazy"><figcaption>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šRedis äº‹åŠ¡</figcaption></figure><h4 id="è¯´ä¸€ä¸‹-redis-äº‹åŠ¡çš„åŸç†" tabindex="-1"><a class="header-anchor" href="#è¯´ä¸€ä¸‹-redis-äº‹åŠ¡çš„åŸç†"><span>è¯´ä¸€ä¸‹ Redis äº‹åŠ¡çš„åŸç†ï¼Ÿ</span></a></h4><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-2ed7ae21-16a6-4716-ac89-117a8c76d3db.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedisäº‹åŠ¡" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedisäº‹åŠ¡</figcaption></figure><ul><li>ä½¿ç”¨ MULTI å‘½ä»¤å¼€å§‹ä¸€ä¸ªäº‹åŠ¡ã€‚ä»è¿™ä¸ªå‘½ä»¤æ‰§è¡Œä¹‹åå¼€å§‹ï¼Œæ‰€æœ‰çš„åç»­å‘½ä»¤éƒ½ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯è¢«æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ä¸­ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒRedis åªæ˜¯è®°å½•ä¸‹äº†è¿™äº›å‘½ä»¤ã€‚</li><li>ä½¿ç”¨ EXEC å‘½ä»¤è§¦å‘äº‹åŠ¡çš„æ‰§è¡Œã€‚ä¸€æ—¦æ‰§è¡Œäº† EXECï¼Œä¹‹å‰ MULTI åé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤ä¼šè¢«åŸå­åœ°ï¼ˆatomicï¼‰æ‰§è¡Œã€‚è¿™é‡Œçš„â€œåŸå­â€æ„å‘³ç€è¿™äº›å‘½ä»¤è¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆï¼ˆåœ¨å‡ºç°é”™è¯¯æ—¶ï¼‰å…¨éƒ¨ä¸æ‰§è¡Œã€‚</li><li>å¦‚æœåœ¨æ‰§è¡Œ EXEC ä¹‹å‰å†³å®šä¸æ‰§è¡Œäº‹åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ DISCARD å‘½ä»¤æ¥å–æ¶ˆäº‹åŠ¡ã€‚è¿™ä¼šæ¸…ç©ºäº‹åŠ¡é˜Ÿåˆ—å¹¶é€€å‡ºäº‹åŠ¡çŠ¶æ€ã€‚</li><li>WATCH å‘½ä»¤ç”¨äºå®ç°ä¹è§‚é”ã€‚WATCH å‘½ä»¤å¯ä»¥ç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ªé”®ï¼Œå¦‚æœåœ¨æ‰§è¡Œäº‹åŠ¡çš„è¿‡ç¨‹ä¸­ï¼ˆå³åœ¨æ‰§è¡Œ MULTI ä¹‹åï¼Œæ‰§è¡Œ EXEC ä¹‹å‰ï¼‰ï¼Œè¢«ç›‘è§†çš„é”®è¢«å…¶ä»–å‘½ä»¤æ”¹å˜äº†ï¼Œé‚£ä¹ˆå½“æ‰§è¡Œ EXEC æ—¶ï¼Œäº‹åŠ¡å°†è¢«å–æ¶ˆï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚</li></ul><h4 id="redis-äº‹åŠ¡çš„æ³¨æ„ç‚¹æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#redis-äº‹åŠ¡çš„æ³¨æ„ç‚¹æœ‰å“ªäº›"><span>Redis äº‹åŠ¡çš„æ³¨æ„ç‚¹æœ‰å“ªäº›ï¼Ÿ</span></a></h4><p>Redis äº‹åŠ¡æ˜¯ä¸æ”¯æŒå›æ»šçš„ï¼Œä¸€æ—¦ EXEC å‘½ä»¤è¢«è°ƒç”¨ï¼Œæ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«æ‰§è¡Œï¼Œå³ä½¿æœ‰äº›å‘½ä»¤å¯èƒ½æ‰§è¡Œå¤±è´¥ã€‚</p><h4 id="redis-äº‹åŠ¡ä¸ºä»€ä¹ˆä¸æ”¯æŒå›æ»š" tabindex="-1"><a class="header-anchor" href="#redis-äº‹åŠ¡ä¸ºä»€ä¹ˆä¸æ”¯æŒå›æ»š"><span>Redis äº‹åŠ¡ä¸ºä»€ä¹ˆä¸æ”¯æŒå›æ»šï¼Ÿ</span></a></h4><p>å¼•å…¥äº‹åŠ¡å›æ»šæœºåˆ¶ä¼šå¤§å¤§å¢åŠ  Redis çš„å¤æ‚æ€§ï¼Œå› ä¸ºéœ€è¦è·Ÿè¸ªäº‹åŠ¡ä¸­æ¯ä¸ªå‘½ä»¤çš„çŠ¶æ€ï¼Œå¹¶åœ¨å‘ç”Ÿé”™è¯¯æ—¶é€†å‘æ‰§è¡Œå‘½ä»¤ä»¥æ¢å¤åŸå§‹çŠ¶æ€ã€‚</p><p>Redis æ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„æ•°æ®å­˜å‚¨ç³»ç»Ÿï¼Œå…¶è®¾è®¡é‡ç‚¹æ˜¯å®ç°é«˜æ€§èƒ½ã€‚äº‹åŠ¡å›æ»šéœ€è¦é¢å¤–çš„èµ„æºå’Œæ—¶é—´æ¥ç®¡ç†å’Œæ‰§è¡Œï¼Œè¿™ä¸ Redis çš„è®¾è®¡ç›®æ ‡ç›¸è¿èƒŒã€‚å› æ­¤ï¼ŒRedis é€‰æ‹©ä¸æ”¯æŒäº‹åŠ¡å›æ»šã€‚</p><p>æ¢å¥è¯è¯´ï¼Œ<strong>å°±æ˜¯æˆ‘ Redis ä¸æƒ³æ”¯æŒäº‹åŠ¡ï¼Œä¹Ÿæ²¡æœ‰è¿™ä¸ªå¿…è¦</strong>ã€‚</p><h4 id="redis-äº‹åŠ¡çš„-acid-ç‰¹æ€§å¦‚ä½•ä½“ç°" tabindex="-1"><a class="header-anchor" href="#redis-äº‹åŠ¡çš„-acid-ç‰¹æ€§å¦‚ä½•ä½“ç°"><span>Redis äº‹åŠ¡çš„ ACID ç‰¹æ€§å¦‚ä½•ä½“ç°ï¼Ÿ</span></a></h4><p>ACID ä¸€èˆ¬æŒ‡ MySQL äº‹åŠ¡ä¸­çš„å››ä¸ªç‰¹æ€§ï¼šåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ã€‚è™½ç„¶ Redis æä¾›äº†äº‹åŠ¡çš„æ”¯æŒï¼Œä½†å®ƒåœ¨ ACID ä¸Šçš„è¡¨ç°ä¸ MySQL æœ‰æ‰€ä¸åŒã€‚</p><p>Redis äº‹åŠ¡ä¸­ï¼Œæ‰€æœ‰å‘½ä»¤ä¼šä¾æ¬¡æ‰§è¡Œï¼Œä½†å¹¶ä¸æ”¯æŒéƒ¨åˆ†å¤±è´¥åçš„è‡ªåŠ¨å›æ»šã€‚å› æ­¤ Redis åœ¨äº‹åŠ¡å±‚é¢å¹¶ä¸èƒ½ä¿è¯ä¸€è‡´æ€§ï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡ç¨‹åºé€»è¾‘æ¥è¿›è¡Œä¼˜åŒ–ã€‚</p><p>Redis äº‹åŠ¡åœ¨ä¸€å®šç¨‹åº¦ä¸Šæä¾›äº†éš”ç¦»æ€§ï¼Œäº‹åŠ¡ä¸­çš„å‘½ä»¤ä¼šæŒ‰é¡ºåºæ‰§è¡Œï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯çš„å‘½ä»¤æ’å…¥ã€‚</p><p>Redis çš„æŒä¹…æ€§ä¾èµ–äºå…¶æŒä¹…åŒ–æœºåˆ¶ï¼ˆå¦‚ RDB å’Œ AOFï¼‰ï¼Œè€Œä¸æ˜¯äº‹åŠ¡æœ¬èº«ã€‚</p><h4 id="redisäº‹åŠ¡æ»¡è¶³åŸå­æ€§å—-è¦æ€ä¹ˆæ”¹è¿›" tabindex="-1"><a class="header-anchor" href="#redisäº‹åŠ¡æ»¡è¶³åŸå­æ€§å—-è¦æ€ä¹ˆæ”¹è¿›"><span>Redisäº‹åŠ¡æ»¡è¶³åŸå­æ€§å—ï¼Ÿè¦æ€ä¹ˆæ”¹è¿›ï¼Ÿ</span></a></h4><p>ä¸æ»¡è¶³ï¼ŒRedis äº‹åŠ¡ä¸æ”¯æŒå›æ»šï¼Œä¸€æ—¦ EXEC å‘½ä»¤è¢«è°ƒç”¨ï¼Œæ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«æ‰§è¡Œï¼Œå³ä½¿æœ‰äº›å‘½ä»¤å¯èƒ½æ‰§è¡Œå¤±è´¥ã€‚</p><p>å¯ä»¥é€šè¿‡ Lua è„šæœ¬æ¥å®ç°äº‹åŠ¡çš„åŸå­æ€§ï¼ŒLua è„šæœ¬åœ¨ Redis ä¸­æ˜¯åŸå­æ‰§è¡Œçš„ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­é—´ä¸ä¼šæ’å…¥å…¶ä»–å‘½ä»¤ã€‚</p><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„åä¸ºä¸€é¢åŸé¢˜ï¼šè¯´ä¸‹ Redis äº‹åŠ¡</li><li><a href="https://javabetter.cn/zhishixingqiu/" target="_blank" rel="noopener noreferrer">äºŒå“¥ç¼–ç¨‹æ˜Ÿçƒ</a>çƒå‹<a href="https://t.zsxq.com/BaHOh" target="_blank" rel="noopener noreferrer">æ•äº‘çœ ç¾å›¢ AI é¢è¯•åŸé¢˜</a>ï¼šä»€ä¹ˆæ˜¯ redis çš„äº‹åŠ¡ï¼Œå®ƒçš„ ACID å±æ€§å¦‚ä½•ä½“ç°</li></ol></blockquote><h3 id="_43-æœ‰-lua-è„šæœ¬æ“ä½œ-redis-çš„ç»éªŒå—" tabindex="-1"><a class="header-anchor" href="#_43-æœ‰-lua-è„šæœ¬æ“ä½œ-redis-çš„ç»éªŒå—"><span>43.æœ‰ Lua è„šæœ¬æ“ä½œ Redis çš„ç»éªŒå—ï¼Ÿ</span></a></h3><p>Redis çš„äº‹åŠ¡ä¸å…·å¤‡å¼ºåˆ¶æ€§çš„åŸå­æ€§ï¼Œä½†å¯ä»¥é€šè¿‡ Lua è„šæœ¬æ¥å¢å¼º Redis çš„åŸå­èƒ½åŠ›ã€‚</p><p>åœ¨ Redis ä¸­ï¼ŒLua è„šæœ¬æ˜¯ä»¥åŸå­æ“ä½œçš„æ–¹å¼æ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è„šæœ¬æ‰§è¡ŒæœŸé—´ï¼Œä¸ä¼šæ’å…¥å…¶ä»–å‘½ä»¤ï¼Œå¤©ç„¶ä¿è¯äº†äº‹åŠ¡æ€§ã€‚</p><p>æ¯”å¦‚ç§’æ€ç³»ç»Ÿæ˜¯ä¸€ä¸ªç»å…¸åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ Lua è„šæœ¬æ¥å®ç°æ‰£å‡ Redis åº“å­˜çš„åŠŸèƒ½ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">--</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> åº“å­˜æœªé¢„çƒ­</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;exists&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">KEYS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">])</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> ==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) then</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">9</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">end</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">--</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> ç§’æ€å•†å“åº“å­˜å­˜åœ¨</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;exists&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">KEYS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">])</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> ==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) then</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    local stock </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> tonumber</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;get&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">KEYS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">])</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    local num </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> tonumber</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">])</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    --</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> å‰©ä½™åº“å­˜å°‘äºè¯·æ±‚æ•°é‡</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (stock </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> num) then</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    end</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    --</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> æ‰£å‡åº“å­˜</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (stock </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;=</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> num) then</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;incrby&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">KEYS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">], </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> num);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        --</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> æ‰£å‡æˆåŠŸ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    end</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">end</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">--</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> ç§’æ€å•†å“åº“å­˜ä¸å­˜åœ¨</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">return</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹åŒå­¦ 4 ä¸€é¢åŸé¢˜ï¼šRedisäº‹åŠ¡æ»¡è¶³åŸå­æ€§å—ï¼Ÿè¦æ€ä¹ˆæ”¹è¿›ï¼Ÿ</li></ol></blockquote><h3 id="_44-redis-çš„ç®¡é“pipelineäº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_44-redis-çš„ç®¡é“pipelineäº†è§£å—"><span>44.Redis çš„ç®¡é“Pipelineäº†è§£å—ï¼Ÿ</span></a></h3><p>Pipeline æ˜¯ Redis æä¾›çš„ä¸€ç§ä¼˜åŒ–æ‰‹æ®µï¼Œå…è®¸å®¢æˆ·ç«¯ä¸€æ¬¡æ€§å‘æœåŠ¡å™¨å‘é€å¤šä¸ªå‘½ä»¤ï¼Œè€Œä¸å¿…ç­‰å¾…æ¯ä¸ªå‘½ä»¤çš„å“åº”ï¼Œä»è€Œå‡å°‘ç½‘ç»œå»¶è¿Ÿã€‚å®ƒçš„å·¥ä½œåŸç†ç±»ä¼¼äºæ‰¹é‡æ“ä½œï¼Œå³å¤šä¸ªå‘½ä»¤ä¸€æ¬¡æ€§æ‰“åŒ…å‘é€ï¼ŒRedis æœåŠ¡å™¨ä¾æ¬¡æ‰§è¡Œåå†å°†ç»“æœä¸€æ¬¡æ€§è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>é€šå¸¸åœ¨ Redis ä¸­ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½ä¼šéµå¾ªä»¥ä¸‹æµç¨‹ï¼š</p><ol><li>å®¢æˆ·ç«¯å‘é€å‘½ä»¤åˆ°æœåŠ¡å™¨ã€‚</li><li>æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤å¹¶å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li><li>å®¢æˆ·ç«¯æ¥æ”¶è¿”å›ç»“æœã€‚</li></ol><p>æ¯ä¸€ä¸ªè¯·æ±‚å’Œå“åº”ä¹‹é—´å­˜åœ¨ä¸€æ¬¡ç½‘ç»œé€šä¿¡çš„å¾€è¿”æ—¶é—´ï¼ˆRTTï¼ŒRound-Trip Timeï¼‰ï¼Œå¦‚æœå¤§é‡è¯·æ±‚ä¾æ¬¡å‘é€ï¼Œç½‘ç»œå»¶è¿Ÿä¼šæ˜¾è‘—å¢åŠ è¯·æ±‚çš„æ€»æ‰§è¡Œæ—¶é—´ã€‚</p><p>æœ‰äº† Pipeline åï¼Œæµç¨‹å˜ä¸ºï¼š</p><blockquote><p>å‘é€å‘½ä»¤1ã€å‘½ä»¤2ã€å‘½ä»¤3â€¦â€¦ -&gt; æœåŠ¡å™¨å¤„ç† -&gt; ä¸€æ¬¡æ€§è¿”å›æ‰€æœ‰ç»“æœã€‚</p></blockquote><p>ä¾‹å¦‚ï¼Œæ‰¹é‡å†™å…¥å¤§é‡æ•°æ®æˆ–æ‰§è¡Œä¸€ç³»åˆ—æŸ¥è¯¢æ—¶ï¼Œå¯ä»¥å°†è¿™äº›æ“ä½œæ‰“åŒ…é€šè¿‡ Pipeline æ‰§è¡Œã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-38aee4c1-efd2-495e-8a6d-164d21a129b1.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šPipeliningç¤ºæ„å›¾" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šPipeliningç¤ºæ„å›¾</figcaption></figure><p>åœ¨ Pipeline æ¨¡å¼ä¸‹ï¼Œå®¢æˆ·ç«¯ä¸ä¼šåœ¨æ¯æ¡å‘½ä»¤å‘é€åç«‹å³ç­‰å¾… Redis çš„å“åº”ï¼Œè€Œæ˜¯å°†å¤šä¸ªå‘½ä»¤ä¾æ¬¡å†™å…¥ TCP ç¼“å†²åŒºï¼Œæ‰€æœ‰å‘½ä»¤ä¸€èµ·å‘é€åˆ° Redis æœåŠ¡å™¨ã€‚</p><p>Redis æœåŠ¡å™¨æ¥æ”¶åˆ°æ‰¹é‡å‘½ä»¤åï¼Œä¾æ¬¡æ‰§è¡Œæ¯ä¸ªå‘½ä»¤ã€‚</p><p>Redis æœåŠ¡å™¨æ‰§è¡Œå®Œæ‰€æœ‰å‘½ä»¤åï¼Œå°†æ¯æ¡å‘½ä»¤çš„ç»“æœä¸€æ¬¡æ€§æ‰“åŒ…é€šè¿‡ TCP è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>å®¢æˆ·ç«¯ä¸€æ¬¡æ€§æ¥æ”¶æ‰€æœ‰è¿”å›ç»“æœï¼Œå¹¶è§£ææ¯ä¸ªå‘½ä»¤çš„æ‰§è¡Œç»“æœã€‚</p><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 8 é¢è¯•åŸé¢˜ï¼šå¯¹pipelineçš„ç†è§£ï¼Œä»€ä¹ˆåœºæ™¯é€‚åˆä½¿ç”¨pipelineï¼Ÿæœ‰äº†è§£è¿‡pipelineçš„åº•å±‚ï¼Ÿ</li></ol></blockquote><h3 id="_45-redis-å®ç°åˆ†å¸ƒå¼é”äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_45-redis-å®ç°åˆ†å¸ƒå¼é”äº†è§£å—"><span>45.Redis å®ç°åˆ†å¸ƒå¼é”äº†è§£å—ï¼Ÿ</span></a></h3><p>Redis å®ç°åˆ†å¸ƒå¼é”çš„æœ¬è´¨ï¼Œå°±æ˜¯åœ¨ Redis é‡Œé¢å ä¸€ä¸ªâ€œèŒ…å‘â€ï¼Œå½“åˆ«çš„å®¢æˆ·ç«¯ä¹Ÿæ¥å å‘æ—¶ï¼Œå‘ç°å·²ç»æœ‰å®¢æˆ·ç«¯è¹²åœ¨é‚£é‡Œäº†ï¼Œå°±åªå¥½æ”¾å¼ƒæˆ–è€…ç¨åå†è¯•ã€‚</p><p><strong>å¯ä»¥ä½¿ç”¨ Redis çš„ SET å‘½ä»¤å®ç°åˆ†å¸ƒå¼é”</strong>ã€‚åŒæ—¶æ·»åŠ è¿‡æœŸæ—¶é—´ï¼Œä»¥é˜²æ­¢æ­»é”çš„å‘ç”Ÿã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-710cdd19-98ea-4e96-b579-ff1ebb0d5de9.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šsetåŸå­å‘½ä»¤" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šsetåŸå­å‘½ä»¤</figcaption></figure><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>SET key value NX PX 30000</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>key</code> æ˜¯é”åã€‚</li><li><code>value</code> æ˜¯é”çš„æŒæœ‰è€…æ ‡è¯†ï¼Œå¯ä»¥ä½¿ç”¨ UUID ä½œä¸º valueã€‚</li><li><code>NX</code> åªåœ¨é”®ä¸å­˜åœ¨æ—¶è®¾ç½®ã€‚</li><li><code>PX 30000</code>ï¼šè®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸º 30 ç§’ï¼ˆé˜²æ­¢æ­»é”ï¼‰ã€‚</li></ul><h4 id="ä»€ä¹ˆæ˜¯-setnx" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-setnx"><span>ä»€ä¹ˆæ˜¯ setnxï¼Ÿ</span></a></h4><p>setnx ä» Redis ç‰ˆæœ¬ 2.6.12 å¼€å§‹è¢«å¼ƒç”¨ï¼Œå› ä¸ºå¯ä»¥é€šè¿‡ set å‘½ä»¤çš„ NX é€‰é¡¹æ¥å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20241122182250.png" alt="æˆªå›¾æ¥è‡ªRedis docs" tabindex="0" loading="lazy"><figcaption>æˆªå›¾æ¥è‡ªRedis docs</figcaption></figure><p>ä½¿ç”¨ setnx åˆ›å»ºåˆ†å¸ƒå¼é”æ—¶ï¼Œè™½ç„¶è®¾ç½®è¿‡æœŸæ—¶é—´å¯ä»¥é¿å…æ­»é”é—®é¢˜ï¼Œä½†å¯èƒ½å­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼šçº¿ç¨‹ A è·å–é”åå¼€å§‹ä»»åŠ¡ï¼Œå¦‚æœä»»åŠ¡æ‰§è¡Œæ—¶é—´è¶…è¿‡é”çš„è¿‡æœŸæ—¶é—´ï¼Œé”ä¼šæå‰é‡Šæ”¾ï¼Œå¯¼è‡´çº¿ç¨‹ B ä¹Ÿè·å–äº†é”å¹¶å¼€å§‹æ‰§è¡Œä»»åŠ¡ã€‚è¿™ä¼šç ´åé”çš„ç‹¬å æ€§ï¼Œå¯¼è‡´å¹¶å‘è®¿é—®èµ„æºï¼Œè¿›è€Œé€ æˆæ•°æ®ä¸ä¸€è‡´ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20241122191044.png" alt="æŠ€æœ¯æ´¾ï¼šRedis é”" tabindex="0" loading="lazy"><figcaption>æŠ€æœ¯æ´¾ï¼šRedis é”</figcaption></figure><p>å¯ä»¥å¼•å…¥é”çš„è‡ªåŠ¨ç»­çº¦æœºåˆ¶ï¼Œåœ¨ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å®šæœŸç»­æœŸï¼Œç¡®ä¿é”åœ¨ä»»åŠ¡å®Œæˆä¹‹å‰ä¸ä¼šè¿‡æœŸã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20241122192038.png" alt="æŠ€æœ¯æ´¾ï¼šredisson çœ‹é—¨ç‹—" tabindex="0" loading="lazy"><figcaption>æŠ€æœ¯æ´¾ï¼šredisson çœ‹é—¨ç‹—</figcaption></figure><p>æ¯”å¦‚è¯´ Redisson çš„ RedissonLock å°±æ”¯æŒè‡ªåŠ¨ç»­æœŸï¼Œé€šè¿‡çœ‹é—¨ç‹—æœºåˆ¶å®šæœŸç»­æœŸé”çš„æœ‰æ•ˆæœŸã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20241122192708.png" alt="äºŒå“¥çš„Java è¿›é˜¶ä¹‹è·¯ï¼šrenewExpirationAsync" tabindex="0" loading="lazy"><figcaption>äºŒå“¥çš„Java è¿›é˜¶ä¹‹è·¯ï¼šrenewExpirationAsync</figcaption></figure><h4 id="redisson-äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#redisson-äº†è§£å—"><span>Redisson äº†è§£å—ï¼Ÿ</span></a></h4><p>å®é™…çš„å¼€å‘ä¸­ï¼Œæ²¡äººä¼šå»è‡ªå·±å†™åˆ†å¸ƒå¼é”çš„å‘½ä»¤ï¼Œå› ä¸ºæœ‰ä¸“ä¸šçš„è½®å­â€”â€”<a href="https://xie.infoq.cn/article/d8e897f768eb1a358a0fd6300" target="_blank" rel="noopener noreferrer">Redisson</a>ã€‚ï¼ˆæˆ³é“¾æ¥è·³è½¬è‡³æ‚Ÿç©ºèŠæ¶æ„ï¼šåˆ†å¸ƒå¼é”ä¸­çš„ç‹è€…æ–¹æ¡ˆ - Redissonï¼‰</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240308174708.png" alt="å›¾ç‰‡æ¥æºäºç½‘ç»œ" tabindex="0" loading="lazy"><figcaption>å›¾ç‰‡æ¥æºäºç½‘ç»œ</figcaption></figure><p>Redisson æ˜¯ä¸€ä¸ªåŸºäº Redis çš„ Java é©»å†…å­˜æ•°æ®ç½‘æ ¼ï¼ˆIn-Memory Data Gridï¼‰ï¼Œæä¾›äº†ä¸€ç³»åˆ— API ç”¨æ¥æ“ä½œ Redisï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„åŠŸèƒ½å°±æ˜¯åˆ†å¸ƒå¼é”ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">RLock</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> lock </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> redisson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getLock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;lock&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">lock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">lock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">try</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // do something</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">} </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">finally</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    lock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">unlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ™®é€šé”çš„å®ç°æºç æ˜¯åœ¨ RedissonLock ç±»ä¸­ï¼Œä¹Ÿæ˜¯é€šè¿‡ Lua è„šæœ¬å°è£…ä¸€äº› Redis å‘½ä»¤æ¥å®ç°çš„çš„ï¼Œæ¯”å¦‚è¯´ tryLockInnerAsync æºç ï¼š</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240425120229.png" alt="äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šRedissonLock" tabindex="0" loading="lazy"><figcaption>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šRedissonLock</figcaption></figure><p>å…¶ä¸­ hincrby å‘½ä»¤ç”¨äºå¯¹å“ˆå¸Œè¡¨ä¸­çš„å­—æ®µå€¼æ‰§è¡Œè‡ªå¢æ“ä½œï¼Œpexpire å‘½ä»¤ç”¨äºè®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ã€‚æ¯” SETNX æ›´ä¼˜é›…ã€‚</p><h4 id="pmhub-ç³»ç»Ÿé‡Œé¢çš„åˆ†å¸ƒå¼é”æ˜¯æ€ä¹ˆåšçš„" tabindex="-1"><a class="header-anchor" href="#pmhub-ç³»ç»Ÿé‡Œé¢çš„åˆ†å¸ƒå¼é”æ˜¯æ€ä¹ˆåšçš„"><span>PmHub ç³»ç»Ÿé‡Œé¢çš„åˆ†å¸ƒå¼é”æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ</span></a></h4><p>ä¸»è¦é€šè¿‡ Redisson æ¡†æ¶å®ç°çš„ RedLock æ¥å®Œæˆçš„ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// åˆ›å»º Redisson å®¢æˆ·ç«¯é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Config</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> config </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Config</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">useClusterServers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addNodeAddress</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;redis://127.0.0.1:6379&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                &quot;redis://127.0.0.1:6380&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                &quot;redis://127.0.0.1:6381&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // å‡è®¾æœ‰ä¸‰ä¸ª Redis èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// åˆ›å»º Redisson å®¢æˆ·ç«¯å®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">RedissonClient</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> redissonClient </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Redisson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">create</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(config);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// åˆ›å»º RedLock å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">RLock</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> redLock </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> redissonClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getLock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;lock_key&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">try</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // å°è¯•è·å–åˆ†å¸ƒå¼é”ï¼Œæœ€å¤šå°è¯• 5 ç§’è·å–é”ï¼Œå¹¶ä¸”é”çš„æœ‰æ•ˆæœŸä¸º 5000 æ¯«ç§’</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    boolean</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> lockAcquired </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> redLock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tryLock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">TimeUnit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">MILLISECONDS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (lockAcquired) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // åŠ é”æˆåŠŸï¼Œæ‰§è¡Œä¸šåŠ¡ä»£ç ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Failed to acquire the lock!&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">} </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">InterruptedException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">currentThread</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">interrupt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Interrupted while acquiring the lock&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">} </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">finally</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // æ— è®ºæ˜¯å¦æˆåŠŸè·å–åˆ°é”ï¼Œåœ¨ä¸šåŠ¡é€»è¾‘ç»“æŸåéƒ½è¦é‡Šæ”¾é”</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">redLock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">isLocked</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        redLock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">unlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // å…³é—­ Redisson å®¢æˆ·ç«¯è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    redissonClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">shutdown</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä½ æåˆ°äº†redlock-é‚£å®ƒæœºåˆ¶æ˜¯æ€ä¹ˆæ ·çš„" tabindex="-1"><a class="header-anchor" href="#ä½ æåˆ°äº†redlock-é‚£å®ƒæœºåˆ¶æ˜¯æ€ä¹ˆæ ·çš„"><span>ä½ æåˆ°äº†Redlockï¼Œé‚£å®ƒæœºåˆ¶æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ</span></a></h4><p>Redlock æ˜¯ Redis ä½œè€…æå‡ºçš„ä¸€ç§åˆ†å¸ƒå¼é”å®ç°æ–¹æ¡ˆï¼Œç”¨äºç¡®ä¿åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹å®‰å…¨å¯é åœ°è·å–é”ã€‚å®ƒçš„ç›®æ ‡æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æä¾›ä¸€ç§é«˜å¯ç”¨ã€é«˜å®¹é”™çš„é”æœºåˆ¶ï¼Œç¡®ä¿åœ¨åŒä¸€æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½å¤ŸæˆåŠŸè·å¾—é”ï¼Œä»è€Œå®ç°å¯¹å…±äº«èµ„æºçš„äº’æ–¥è®¿é—®ã€‚</p><p>Redisson ä¸­çš„ RedLock æ˜¯åŸºäº RedissonMultiLockï¼ˆè”é”ï¼‰å®ç°çš„ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240816113330.png" alt="äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šRedissonRedLock" tabindex="0" loading="lazy"><figcaption>äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šRedissonRedLock</figcaption></figure><p>RedissonMultiLock çš„ tryLock æ–¹æ³•ä¼šåœ¨æŒ‡å®šçš„ Redis å®ä¾‹ä¸Šé€ä¸€å°è¯•è·å–é”ã€‚</p><p>åœ¨è·å–é”çš„è¿‡ç¨‹ä¸­ï¼ŒRedlock ä¼šæ ¹æ®é…ç½®çš„ waitTimeï¼ˆæœ€å¤§ç­‰å¾…æ—¶é—´ï¼‰å’Œ leaseTimeï¼ˆé”çš„æŒæœ‰æ—¶é—´ï¼‰è¿›è¡Œçµæ´»æ§åˆ¶ã€‚æ¯”å¦‚ï¼Œå¦‚æœè·å–é”çš„æ—¶é—´å°äºé”çš„æœ‰æ•ˆæœŸï¼ˆé€šè¿‡TTLå‘½ä»¤è·å–é”çš„å‰©ä½™æ—¶é—´ï¼‰ï¼Œåˆ™è¡¨ç¤ºè·å–é”æˆåŠŸã€‚</p><p>é€šå¸¸ï¼Œè‡³å°‘éœ€è¦å¤šæ•°ï¼ˆå¦‚ 5 ä¸ªå®ä¾‹ä¸­çš„ 3 ä¸ªï¼‰å®ä¾‹æˆåŠŸè·å–é”ï¼Œæ‰èƒ½è®¤ä¸ºæ•´ä¸ªé”è·å–æˆåŠŸã€‚</p><p>å¦‚æœæŒ‡å®šäº†é”çš„æŒæœ‰æ—¶é—´ï¼ˆleaseTimeï¼‰ï¼Œåœ¨æˆåŠŸè·å–é”åï¼ŒRedlock ä¼šä¸ºé”è¿›è¡Œç»­æœŸï¼Œä»¥é˜²æ­¢é”åœ¨æ“ä½œå®Œæˆä¹‹å‰æ„å¤–å¤±æ•ˆã€‚</p><h4 id="çº¢é”èƒ½ä¸èƒ½ä¿è¯ç™¾åˆ†ç™¾ä¸Šé”" tabindex="-1"><a class="header-anchor" href="#çº¢é”èƒ½ä¸èƒ½ä¿è¯ç™¾åˆ†ç™¾ä¸Šé”"><span>çº¢é”èƒ½ä¸èƒ½ä¿è¯ç™¾åˆ†ç™¾ä¸Šé”ï¼Ÿ</span></a></h4><p>Redlock ä¸èƒ½ä¿è¯ç™¾åˆ†ç™¾ä¸Šé”ï¼Œå› ä¸ºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç½‘ç»œå»¶è¿Ÿã€æ—¶é’Ÿæ¼‚ç§»ã€Redis å®ä¾‹å®•æœºç­‰å› ç´ éƒ½å¯èƒ½å¯¼è‡´é”çš„è·å–å¤±è´¥ã€‚</p><h4 id="åŠ åˆ†å¸ƒå¼é”æ—¶rediså¦‚ä½•ä¿è¯ä¸ä¼šå‘ç”Ÿå†²çª" tabindex="-1"><a class="header-anchor" href="#åŠ åˆ†å¸ƒå¼é”æ—¶rediså¦‚ä½•ä¿è¯ä¸ä¼šå‘ç”Ÿå†²çª"><span>åŠ åˆ†å¸ƒå¼é”æ—¶Rediså¦‚ä½•ä¿è¯ä¸ä¼šå‘ç”Ÿå†²çªï¼Ÿ</span></a></h4><p>â‘ ã€ä½¿ç”¨ SET NX PX æˆ– SETNX å‘½ä»¤ç¡®ä¿é”çš„è·å–æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼ŒåŒæ—¶è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´é˜²æ­¢æ­»é”ã€‚</p><p>æ¯”å¦‚è¯´ <code>SET lock_key unique_value NX PX 5000</code> å‘½ä»¤ï¼Œå…¶ä¸­ <code>NX</code> ç¡®ä¿äº†åŸå­æ“ä½œï¼Œï¼Œå¦‚æœ lock_key å·²å­˜åœ¨ï¼ŒSET æ“ä½œä¼šè¿”å› nilï¼›<code>PX 5000</code> è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º 5000 æ¯«ç§’ï¼Œé¿å…æ­»é”ã€‚</p><p>â‘¡ã€ä½¿ç”¨ Lua è„šæœ¬å°†é”çš„æ£€æŸ¥å’Œé‡Šæ”¾æ“ä½œå°è£…ä¸ºä¸€ä¸ªåŸå­æ“ä½œï¼Œç¡®ä¿å®‰å…¨åœ°é‡Šæ”¾é”ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>EVAL &quot;if redis.call(&#39;get&#39;, KEYS[1]) == ARGV[1] then return redis.call(&#39;del&#39;, KEYS[1]) else return 0 end&quot; 1 lock_key unique_value</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>â‘¢ã€ä½¿ç”¨ Redlock ç®—æ³•ç¡®ä¿é”çš„æ­£ç¡®è·å–å’Œé‡Šæ”¾ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">RLock</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> lock </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> redisson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getLock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;lock_key&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">try</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // 500ms ç­‰å¾…æ—¶é—´ï¼Œ10000ms é”è¿‡æœŸæ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    boolean</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> isLocked </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> lock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tryLock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">500</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">TimeUnit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">MILLISECONDS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (isLocked) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // æ‰§è¡Œéœ€è¦åŒæ­¥çš„æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">} </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">finally</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    lock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">unlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="redisson-ä¸­çš„çœ‹é—¨ç‹—æœºåˆ¶äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#redisson-ä¸­çš„çœ‹é—¨ç‹—æœºåˆ¶äº†è§£å—"><span>Redisson ä¸­çš„çœ‹é—¨ç‹—æœºåˆ¶äº†è§£å—ï¼Ÿ</span></a></h4><p>Redisson æä¾›çš„åˆ†å¸ƒå¼é”æ˜¯æ”¯æŒé”è‡ªåŠ¨ç»­æœŸçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœçº¿ç¨‹åœ¨é”åˆ°æœŸä¹‹å‰è¿˜æ²¡æœ‰æ‰§è¡Œå®Œï¼Œé‚£ä¹ˆ Redisson ä¼šè‡ªåŠ¨ç»™é”ç»­æœŸï¼Œé¿å…é”çš„è¿‡æœŸã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240918110433.png" alt="éƒ­æ…•è£åšå®¢å›­ï¼šçœ‹é—¨ç‹—" tabindex="0" loading="lazy"><figcaption>éƒ­æ…•è£åšå®¢å›­ï¼šçœ‹é—¨ç‹—</figcaption></figure><p>è¿™è¢«ç§°ä¸ºâ€œçœ‹é—¨ç‹—â€æœºåˆ¶ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> RedissonWatchdogExample</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // é…ç½® Redisson å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        Config</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> config</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">useSingleServer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setAddress</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;redis://127.0.0.1:6379&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        RedissonClient</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> redisson</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Redisson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">create</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(config);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // è·å–é”å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        RLock</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> lock</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> redisson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getLock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;myLock&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        try</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            // è·å–é”ï¼Œé»˜è®¤çœ‹é—¨ç‹—æœºåˆ¶ä¼šå¯åŠ¨</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            lock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">lock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            // æ¨¡æ‹Ÿä»»åŠ¡æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Task is running...&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">40000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// æ¨¡æ‹Ÿé•¿æ—¶é—´ä»»åŠ¡ï¼ˆ40ç§’ï¼‰</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Task completed.&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">InterruptedException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">finally</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            // é‡Šæ”¾é”</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            lock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">unlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // å…³é—­ Redisson å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        redisson</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">shutdown</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>çœ‹é—¨ç‹—å¯åŠ¨åï¼Œæ¯éš” 10 ç§’ä¼šåˆ·æ–°é”çš„è¿‡æœŸæ—¶é—´ï¼Œå°†å…¶å»¶é•¿åˆ° 30 ç§’ï¼Œç¡®ä¿åœ¨é”æŒæœ‰æœŸé—´ä¸ä¼šå› ä¸ºè¿‡æœŸè€Œé‡Šæ”¾ã€‚</p><p>å½“ä»»åŠ¡æ‰§è¡Œå®Œæˆæ—¶ï¼Œå®¢æˆ·ç«¯è°ƒç”¨ <code>unlock()</code> æ–¹æ³•é‡Šæ”¾é”ï¼Œçœ‹é—¨ç‹—ä¹Ÿéšä¹‹åœæ­¢ã€‚</p><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯ Java åç«¯å®ä¹ ä¸€é¢åŸé¢˜ï¼šåˆ†å¸ƒå¼é”ç”¨äº† Redis çš„ä»€ä¹ˆæ•°æ®ç»“æ„</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°å…¬å¸é¢ç»åˆé›†åŒå­¦ 1 Java åç«¯é¢è¯•åŸé¢˜ï¼šRedisson çš„åº•å±‚åŸç†ï¼Ÿä»¥åŠä¸ SETNX çš„åŒºåˆ«ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç™¾åº¦é¢ç»åŒå­¦ 1 æ–‡å¿ƒä¸€è¨€ 25 å®ä¹  Java åç«¯é¢è¯•åŸé¢˜ï¼šredis åˆ†å¸ƒå¼é”çš„å®ç°åŸç†ï¼Ÿsetnxï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³åŒå­¦ F é¢è¯•åŸé¢˜ï¼šè‡ªå·±å®ç° redis åˆ†å¸ƒå¼é”çš„å‘ï¼ˆä¸»åŠ¨æäº† Redissionï¼‰</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯äº‘æ™ºé¢ç»åŒå­¦ 20 äºŒé¢é¢è¯•åŸé¢˜ï¼šredission çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ setnx + lua è„šæœ¬ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ”¶é’±å§é¢ç»åŒå­¦ 1 Java åç«¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šç³»ç»Ÿé‡Œé¢åˆ†å¸ƒå¼é”æ˜¯æ€ä¹ˆåšçš„ï¼Ÿä½ æåˆ°äº†redlockï¼Œé‚£å®ƒæœºåˆ¶æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿçº¢é”èƒ½ä¸èƒ½ä¿è¯ç™¾åˆ†ç™¾ä¸Šé”ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 21 æŠ–éŸ³å•†åŸä¸€é¢é¢è¯•åŸé¢˜ï¼šåŠ åˆ†å¸ƒå¼é”æ—¶rediså¦‚ä½•ä¿è¯ä¸ä¼šå‘ç”Ÿå†²çªï¼Ÿåˆ†å¸ƒå¼é”è¿‡æœŸæ€ä¹ˆåŠï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ‹¼å¤šå¤šé¢ç»åŒå­¦ 8 ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedisåˆ†å¸ƒå¼é”å¦‚ä½•å®ç°çš„</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç™¾åº¦åŒå­¦ 4 é¢è¯•åŸé¢˜ï¼šSetnx,çŸ¥é“å—? ç”¨è¿™ä¸ªåŠ é”æœ‰ä»€ä¹ˆé—®é¢˜å—?æ€ä¹ˆè§£å†³?</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„é˜¿é‡Œç³»é¢ç»åŒå­¦ 19 é¥¿äº†ä¹ˆé¢è¯•åŸé¢˜ï¼šåˆ†å¸ƒå¼é”ç”¨rediså®ç°æ€è·¯</li></ol></blockquote><p>GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š<a href="https://github.com/itwanger/toBeBetterJavaer" target="_blank" rel="noopener noreferrer">äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯</a>ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&amp;å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š<a href="https://javabetter.cn/overview/" target="_blank" rel="noopener noreferrer">å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹</a></p><p>å¾®ä¿¡æœ <strong>æ²‰é»˜ç‹äºŒ</strong> æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ <strong>222</strong> å³å¯å…è´¹é¢†å–ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="åº•å±‚ç»“æ„" tabindex="-1"><a class="header-anchor" href="#åº•å±‚ç»“æ„"><span>åº•å±‚ç»“æ„</span></a></h2><p>è¿™ä¸€éƒ¨åˆ†å°±æ¯”è¾ƒæ·±äº†ï¼Œå¦‚æœä¸æ˜¯ç®€å†ä¸Šå†™äº†ç²¾é€š Redisï¼Œåº”è¯¥ä¸ä¼šæ€ä¹ˆé—®ã€‚</p><h3 id="_46-è¯´è¯´-redis-åº•å±‚æ•°æ®ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_46-è¯´è¯´-redis-åº•å±‚æ•°æ®ç»“æ„"><span>46.è¯´è¯´ Redis åº•å±‚æ•°æ®ç»“æ„ï¼Ÿ</span></a></h3><p>Redis çš„åº•å±‚æ•°æ®ç»“æ„æœ‰<strong>åŠ¨æ€å­—ç¬¦ä¸²(sds)</strong>ã€<strong>é“¾è¡¨(list)</strong>ã€<strong>å­—å…¸(ht)</strong>ã€<strong>è·³è·ƒè¡¨(skiplist)</strong>ã€<strong>æ•´æ•°é›†åˆ(intset)</strong>ã€<strong>å‹ç¼©åˆ—è¡¨(ziplist)</strong> ç­‰ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-a1b2d2f9-6895-4749-9bda-9314f08bca68.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedis Objectå¯¹åº”çš„æ˜ å°„" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedis Objectå¯¹åº”çš„æ˜ å°„</figcaption></figure><p>æ¯”å¦‚è¯´ string æ˜¯é€šè¿‡ SDS å®ç°çš„ï¼Œlist æ˜¯é€šè¿‡é“¾è¡¨å®ç°çš„ï¼Œhash æ˜¯é€šè¿‡å­—å…¸å®ç°çš„ï¼Œset æ˜¯é€šè¿‡å­—å…¸å®ç°çš„ï¼Œzset æ˜¯é€šè¿‡è·³è·ƒè¡¨å®ç°çš„ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-7cf91aa9-8db5-4abe-803e-a9e8f3bcb9e4.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç±»å‹-ç¼–ç -ç»“æ„" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç±»å‹-ç¼–ç -ç»“æ„</figcaption></figure><h4 id="ç®€å•ä»‹ç»ä¸‹-sds" tabindex="-1"><a class="header-anchor" href="#ç®€å•ä»‹ç»ä¸‹-sds"><span>ç®€å•ä»‹ç»ä¸‹ SDSï¼Ÿ</span></a></h4><p>Redis æ˜¯é€šè¿‡ C è¯­è¨€å®ç°çš„ï¼Œä½† Redis å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨ C è¯­è¨€çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯è‡ªå·±å®ç°äº†ä¸€ç§å«åšåŠ¨æ€å­—ç¬¦ä¸² SDS çš„ç±»å‹ã€‚</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> sdshdr {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> len;</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // buf ä¸­å·²ä½¿ç”¨çš„é•¿åº¦</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> free;</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // buf ä¸­æœªä½¿ç”¨çš„é•¿åº¦</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    char</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> buf</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">[]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // æ•°æ®ç©ºé—´</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› ä¸º C è¯­â¾”çš„å­—ç¬¦ä¸²ä¸è®°å½•â¾ƒèº«çš„â»“åº¦ä¿¡æ¯ï¼Œå½“éœ€è¦è·å–å­—ç¬¦ä¸²â»“åº¦æ—¶ï¼Œéœ€è¦éå†æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(N)ã€‚</p><p>â½½ SDS ä¿å­˜äº†â»“åº¦ä¿¡æ¯ï¼Œè¿™æ ·å°±å°†è·å–å­—ç¬¦ä¸²â»“åº¦çš„æ—¶é—´ç”± O(N) é™ä½åˆ°äº† O(1)ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-7c038f2c-b5ee-4229-9449-713fab3b1855.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSDS" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSDS</figcaption></figure><h4 id="ç®€å•ä»‹ç»ä¸‹é“¾è¡¨-linkedlist" tabindex="-1"><a class="header-anchor" href="#ç®€å•ä»‹ç»ä¸‹é“¾è¡¨-linkedlist"><span>ç®€å•ä»‹ç»ä¸‹é“¾è¡¨ linkedlist</span></a></h4><p>Redis çš„é“¾è¡¨æ˜¯â¼€ä¸ªåŒå‘â½†ç¯é“¾è¡¨ç»“æ„ï¼Œå’Œ Java ä¸­çš„ <a href="https://javabetter.cn/collection/linkedlist.html" target="_blank" rel="noopener noreferrer">LinkedList</a> ç±»ä¼¼ã€‚</p><p>é“¾è¡¨çš„èŠ‚ç‚¹ç”±â¼€ä¸ªå«åš listNode çš„ç»“æ„æ¥è¡¨ç¤ºï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰æŒ‡å‘å…¶å‰ç½®èŠ‚ç‚¹å’Œåç½®èŠ‚ç‚¹çš„æŒ‡é’ˆï¼ŒåŒæ—¶å¤´èŠ‚ç‚¹çš„å‰ç½®å’Œå°¾èŠ‚ç‚¹çš„åç½®å‡æŒ‡å‘ nullã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-1adef9c0-8feb-4836-8997-84bda96e2498.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šé“¾è¡¨linkedlist" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šé“¾è¡¨linkedlist</figcaption></figure><h4 id="ç®€å•ä»‹ç»ä¸‹å­—å…¸-dict" tabindex="-1"><a class="header-anchor" href="#ç®€å•ä»‹ç»ä¸‹å­—å…¸-dict"><span>ç®€å•ä»‹ç»ä¸‹å­—å…¸ dict</span></a></h4><p>â½¤äºä¿å­˜é”®å€¼å¯¹çš„æŠ½è±¡æ•°æ®ç»“æ„ã€‚Redis ä½¿â½¤ hash è¡¨ä½œä¸ºåº•å±‚å®ç°ï¼Œä¸€ä¸ªå“ˆå¸Œè¡¨é‡Œå¯ä»¥æœ‰å¤šä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹ï¼Œè€Œæ¯ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹å°±ä¿å­˜äº†å­—å…¸é‡Œä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚</p><p>æ¯ä¸ªå­—å…¸å¸¦æœ‰ä¸¤ä¸ª hash è¡¨ï¼Œä¾›å¹³æ—¶ä½¿â½¤å’Œ rehash æ—¶ä½¿â½¤ï¼Œhash è¡¨ä½¿â½¤é“¾åœ°å€æ³•æ¥è§£å†³é”®å†²çªï¼Œè¢«åˆ†é…åˆ°åŒâ¼€ä¸ªç´¢å¼•ä½ç½®çš„å¤šä¸ªé”®å€¼å¯¹ä¼šå½¢æˆâ¼€ä¸ªå•å‘é“¾è¡¨ï¼Œåœ¨å¯¹ hash è¡¨è¿›â¾æ‰©å®¹æˆ–è€…ç¼©å®¹çš„æ—¶å€™ï¼Œä¸ºäº†æœåŠ¡çš„å¯â½¤æ€§ï¼Œrehash çš„è¿‡ç¨‹ä¸æ˜¯â¼€æ¬¡æ€§å®Œæˆçš„ï¼Œâ½½æ˜¯æ¸è¿›å¼çš„ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-9934b4a2-c253-4d42-acf4-c6c940840779.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå­—å…¸" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå­—å…¸</figcaption></figure><h4 id="ç®€å•ä»‹ç»ä¸‹è·³è¡¨-skiplist" tabindex="-1"><a class="header-anchor" href="#ç®€å•ä»‹ç»ä¸‹è·³è¡¨-skiplist"><span>ç®€å•ä»‹ç»ä¸‹è·³è¡¨ skiplist</span></a></h4><p>æ¨èé˜…è¯»ï¼š<a href="https://www.jianshu.com/p/9d8296562806" target="_blank" rel="noopener noreferrer">å…¨ç½‘æœ€è¯¦ç»†çš„è·³è¡¨æ–‡ç« </a></p><p>è·³è¡¨æ˜¯æœ‰åºé›†åˆ Zset çš„åº•å±‚å®ç°ä¹‹â¼€ã€‚åœ¨ Redis 7.0 ä¹‹å‰ï¼Œå¦‚æœæœ‰åºé›†åˆçš„å…ƒç´ ä¸ªæ•°å°äº 128 ä¸ªï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ çš„å€¼å°äº 64 å­—èŠ‚æ—¶ï¼ŒRedis ä¼šä½¿ç”¨å‹ç¼©åˆ—è¡¨ä½œä¸º Zset çš„åº•å±‚å®ç°ï¼Œå¦åˆ™ä¼šä½¿ç”¨è·³è¡¨ï¼›åœ¨ Redis 7.0 ä¹‹åï¼Œå‹ç¼©åˆ—è¡¨å·²ç»åºŸå¼ƒï¼Œäº¤ç”± listpack æ¥æ›¿ä»£ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-886ee2a8-fb02-4908-bbba-d4ad2a211094.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šè·³è¡¨" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šè·³è¡¨</figcaption></figure><p>è·³è¡¨ç”± zskiplist å’Œ zskiplistNode ç»„æˆï¼Œzskiplist â½¤äºä¿å­˜è·³è¡¨çš„åŸºæœ¬ä¿¡æ¯ï¼ˆè¡¨å¤´ã€è¡¨å°¾ã€â»“åº¦ã€å±‚é«˜ç­‰ï¼‰ã€‚</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> zskiplist {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> zskiplistNode </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">header, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">tail;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    unsigned</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> long</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> length;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> level;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">} zskiplist;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>zskiplistNode â½¤äºè¡¨ç¤ºè·³è¡¨èŠ‚ç‚¹ï¼Œæ¯ä¸ªè·³è¡¨èŠ‚ç‚¹çš„å±‚â¾¼æ˜¯ä¸å›ºå®šçš„ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰â¼€ä¸ªæŒ‡å‘ä¿å­˜äº†å½“å‰èŠ‚ç‚¹çš„åˆ†å€¼å’Œæˆå‘˜å¯¹è±¡çš„æŒ‡é’ˆã€‚</p><div class="language-c line-numbers-mode" data-highlighter="shiki" data-ext="c" data-title="c" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">typedef</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> zskiplistNode {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    sds ele;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    double</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> score;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> zskiplistNode </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">backward;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> zskiplistLevel {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> zskiplistNode </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">forward;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        unsigned</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> span;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    } level</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">[]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">} zskiplistNode;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç®€å•ä»‹ç»ä¸‹æ•´æ•°é›†åˆ-intset" tabindex="-1"><a class="header-anchor" href="#ç®€å•ä»‹ç»ä¸‹æ•´æ•°é›†åˆ-intset"><span>ç®€å•ä»‹ç»ä¸‹æ•´æ•°é›†åˆ intset</span></a></h4><p>â½¤äºä¿å­˜æ•´æ•°å€¼çš„é›†åˆæŠ½è±¡æ•°æ®ç»“æ„ï¼Œä¸ä¼šå‡ºç°é‡å¤å…ƒç´ ï¼Œåº•å±‚å®ç°ä¸ºæ•°ç»„ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-833dbfb2-7c79-4e7b-a143-8a4a2936cdd8.png" alt="æ•´æ•°é›†åˆintset" tabindex="0" loading="lazy"><figcaption>æ•´æ•°é›†åˆintset</figcaption></figure><h4 id="ç®€å•ä»‹ç»ä¸‹å‹ç¼©åˆ—è¡¨-ziplist" tabindex="-1"><a class="header-anchor" href="#ç®€å•ä»‹ç»ä¸‹å‹ç¼©åˆ—è¡¨-ziplist"><span>ç®€å•ä»‹ç»ä¸‹å‹ç¼©åˆ—è¡¨ ziplist</span></a></h4><p>å‹ç¼©åˆ—è¡¨æ˜¯ä¸ºèŠ‚çº¦å†…å­˜â½½å¼€å‘çš„é¡ºåºæ€§æ•°æ®ç»“æ„ï¼Œå®ƒå¯ä»¥åŒ…å«ä»»æ„å¤šä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥ä¿å­˜â¼€ä¸ªå­—èŠ‚æ•°ç»„æˆ–è€…æ•´æ•°å€¼ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-99bcbe82-1d91-41bf-8900-a240856071f5.png" alt="å‹ç¼©åˆ—è¡¨ç»„æˆ" tabindex="0" loading="lazy"><figcaption>å‹ç¼©åˆ—è¡¨ç»„æˆ</figcaption></figure><h4 id="ç®€å•ä»‹ç»ä¸‹ç´§å‡‘åˆ—è¡¨-listpack" tabindex="-1"><a class="header-anchor" href="#ç®€å•ä»‹ç»ä¸‹ç´§å‡‘åˆ—è¡¨-listpack"><span>ç®€å•ä»‹ç»ä¸‹ç´§å‡‘åˆ—è¡¨ listpack</span></a></h4><p>listpack æ˜¯ Redis ç”¨æ¥æ›¿ä»£å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰çš„ä¸€ç§å†…å­˜æ›´åŠ ç´§å‡‘çš„æ•°æ®ç»“æ„ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240403105313.png" alt="æå®¢æ—¶é—´ï¼šlistpack" tabindex="0" loading="lazy"><figcaption>æå®¢æ—¶é—´ï¼šlistpack</figcaption></figure><p>ä¸ºäº†é¿å… ziplist å¼•èµ·çš„è¿é”æ›´æ–°é—®é¢˜ï¼Œlistpack ä¸­çš„å…ƒç´ ä¸å†åƒ ziplist é‚£æ ·ï¼Œä¿å­˜å…¶å‰ä¸€ä¸ªå…ƒç´ çš„é•¿åº¦ï¼Œè€Œæ˜¯ä¿å­˜å½“å‰å…ƒç´ çš„ç¼–ç ç±»å‹ã€æ•°æ®ï¼Œä»¥åŠç¼–ç ç±»å‹å’Œæ•°æ®çš„é•¿åº¦ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240403105754.png" alt="æå®¢æ—¶é—´ï¼šlistpack çš„å…ƒç´ " tabindex="0" loading="lazy"><figcaption>æå®¢æ—¶é—´ï¼šlistpack çš„å…ƒç´ </figcaption></figure><p>listpack æ¯ä¸ªå…ƒç´ é¡¹ä¸å†ä¿å­˜ä¸Šä¸€ä¸ªå…ƒç´ çš„é•¿åº¦ï¼Œè€Œæ˜¯ä¼˜åŒ–å…ƒç´ å†…å­—æ®µçš„é¡ºåºï¼Œæ¥ä¿è¯æ—¢å¯ä»¥ä»å‰ä¹Ÿå¯ä»¥å‘åéå†ã€‚</p><p>ä½†å› ä¸º List/Hash/Set/ZSet éƒ½ä¸¥é‡ä¾èµ– ziplistï¼Œæ‰€ä»¥è¿™ä¸ªæ›¿æ¢ä¹‹è·¯å¾ˆæ¼«é•¿ã€‚</p><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨å•†ä¸šåŒ–ä¸€é¢çš„åŸé¢˜ï¼šè¯´è¯´ Redis çš„ zsetï¼Œä»€ä¹ˆæ˜¯è·³è¡¨ï¼Œæ’å…¥ä¸€ä¸ªèŠ‚ç‚¹è¦æ„å»ºå‡ å±‚ç´¢å¼•</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 9 é£ä¹¦åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis çš„æ•°æ®ç±»å‹ï¼ŒZSet çš„å®ç°</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³æš‘æœŸå®ä¹ åŒå­¦ E ä¸€é¢é¢è¯•åŸé¢˜ï¼šä½ çŸ¥é“ Redis çš„ zset åº•å±‚å®ç°å—</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 23 QQ åå°æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šzset çš„åº•å±‚åŸç†</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¿«æ‰‹é¢ç»åŒå­¦ 7 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šè¯´ä¸€ä¸‹ ZSet åº•å±‚ç»“æ„</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç¾å›¢åŒå­¦ 9 ä¸€é¢é¢è¯•åŸé¢˜ï¼šredisçš„æ•°æ®ç»“æ„åº•å±‚åŸç†ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 27 äº‘åå°æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šZsetçš„åº•å±‚å®ç°ï¼Ÿ</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¾—ç‰©é¢ç»åŒå­¦ 9 é¢è¯•é¢˜ç›®åŸé¢˜ï¼šZsetçš„åº•å±‚å¦‚ä½•å®ç°ï¼Ÿ</li></ol></blockquote><h3 id="_47-redis-çš„-sds-å’Œ-c-ä¸­å­—ç¬¦ä¸²ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿" tabindex="-1"><a class="header-anchor" href="#_47-redis-çš„-sds-å’Œ-c-ä¸­å­—ç¬¦ä¸²ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿"><span>47.Redis çš„ SDS å’Œ C ä¸­å­—ç¬¦ä¸²ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ</span></a></h3><p>C è¯­è¨€ä½¿ç”¨äº†ä¸€ä¸ªé•¿åº¦ä¸º <code>N+1</code> çš„å­—ç¬¦æ•°ç»„æ¥è¡¨ç¤ºé•¿åº¦ä¸º <code>N</code> çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”å­—ç¬¦æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ æ€»æ˜¯ <code>\0</code>ï¼Œè¿™ç§ç®€å•çš„å­—ç¬¦ä¸²è¡¨ç¤ºæ–¹å¼ ä¸ç¬¦åˆ Redis å¯¹å­—ç¬¦ä¸²åœ¨å®‰å…¨æ€§ã€æ•ˆç‡ä»¥åŠåŠŸèƒ½æ–¹é¢çš„è¦æ±‚ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-2541fd26-4e84-467d-8d8c-c731154a85d7.png" alt="Cè¯­è¨€çš„å­—ç¬¦ä¸²" tabindex="0" loading="lazy"><figcaption>Cè¯­è¨€çš„å­—ç¬¦ä¸²</figcaption></figure><p><strong>C è¯­è¨€çš„å­—ç¬¦ä¸²å¯èƒ½æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p><p>è¿™æ ·ç®€å•çš„æ•°æ®ç»“æ„å¯èƒ½ä¼šé€ æˆä»¥ä¸‹ä¸€äº›é—®é¢˜ï¼š</p><ul><li><strong>è·å–å­—ç¬¦ä¸²é•¿åº¦å¤æ‚åº¦é«˜</strong> ï¼šå› ä¸º C ä¸ä¿å­˜æ•°ç»„çš„é•¿åº¦ï¼Œæ¯æ¬¡éƒ½éœ€è¦éå†ä¸€éæ•´ä¸ªæ•°ç»„ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼›</li><li>ä¸èƒ½æœç» <strong>ç¼“å†²åŒºæº¢å‡º/å†…å­˜æ³„æ¼</strong> çš„é—®é¢˜ : C å­—ç¬¦ä¸²ä¸è®°å½•è‡ªèº«é•¿åº¦å¸¦æ¥çš„å¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯å®¹æ˜“é€ æˆç¼“å­˜åŒºæº¢å‡ºï¼ˆbuffer overflowï¼‰ï¼Œä¾‹å¦‚åœ¨å­—ç¬¦ä¸²æ‹¼æ¥çš„æ—¶å€™ï¼Œæ–°çš„</li><li>C å­—ç¬¦ä¸² <strong>åªèƒ½ä¿å­˜æ–‡æœ¬æ•°æ®</strong> â†’ å› ä¸º C è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²å¿…é¡»ç¬¦åˆæŸç§ç¼–ç ï¼ˆæ¯”å¦‚ ASCIIï¼‰ï¼Œä¾‹å¦‚ä¸­é—´å‡ºç°çš„ <code>&#39;\0&#39;</code> å¯èƒ½ä¼šè¢«åˆ¤å®šä¸ºæå‰ç»“æŸçš„å­—ç¬¦ä¸²è€Œè¯†åˆ«ä¸äº†ï¼›</li></ul><p><strong>Redis å¦‚ä½•è§£å†³ï¼Ÿä¼˜åŠ¿ï¼Ÿ</strong></p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-fc26a4e7-1c8d-4e82-b7f8-1f6b43d16d38.png" alt="Redis sds" tabindex="0" loading="lazy"><figcaption>Redis sds</figcaption></figure><p>ç®€å•æ¥è¯´ä¸€ä¸‹ Redis å¦‚ä½•è§£å†³çš„ï¼š</p><ol><li><strong>å¤šå¢åŠ  len è¡¨ç¤ºå½“å‰å­—ç¬¦ä¸²çš„é•¿åº¦</strong>ï¼šè¿™æ ·å°±å¯ä»¥ç›´æ¥è·å–é•¿åº¦äº†ï¼Œå¤æ‚åº¦ O(1)ï¼›</li><li><strong>è‡ªåŠ¨æ‰©å±•ç©ºé—´</strong>ï¼šå½“ SDS éœ€è¦å¯¹å­—ç¬¦ä¸²è¿›è¡Œä¿®æ”¹æ—¶ï¼Œé¦–å…ˆå€ŸåŠ©äº <code>len</code> å’Œ <code>alloc</code> æ£€æŸ¥ç©ºé—´æ˜¯å¦æ»¡è¶³ä¿®æ”¹æ‰€éœ€çš„è¦æ±‚ï¼Œå¦‚æœç©ºé—´ä¸å¤Ÿçš„è¯ï¼ŒSDS ä¼šè‡ªåŠ¨æ‰©å±•ç©ºé—´ï¼Œé¿å…äº†åƒ C å­—ç¬¦ä¸²æ“ä½œä¸­çš„æº¢å‡ºæƒ…å†µï¼›</li><li><strong>æœ‰æ•ˆé™ä½å†…å­˜åˆ†é…æ¬¡æ•°</strong>ï¼šC å­—ç¬¦ä¸²åœ¨æ¶‰åŠå¢åŠ æˆ–è€…æ¸…é™¤æ“ä½œæ—¶ä¼šæ”¹å˜åº•å±‚æ•°ç»„çš„å¤§å°é€ æˆé‡æ–°åˆ†é…ï¼ŒSDS ä½¿ç”¨äº† <strong>ç©ºé—´é¢„åˆ†é…</strong> å’Œ <strong>æƒ°æ€§ç©ºé—´é‡Šæ”¾</strong> æœºåˆ¶ï¼Œç®€å•ç†è§£å°±æ˜¯æ¯æ¬¡åœ¨æ‰©å±•æ—¶æ˜¯æˆå€çš„å¤šåˆ†é…çš„ï¼Œåœ¨ç¼©å®¹æ˜¯ä¹Ÿæ˜¯å…ˆç•™ç€å¹¶ä¸æ­£å¼å½’è¿˜ç»™ OSï¼›</li><li><strong>äºŒè¿›åˆ¶å®‰å…¨</strong>ï¼šC è¯­è¨€å­—ç¬¦ä¸²åªèƒ½ä¿å­˜ <code>ascii</code> ç ï¼Œå¯¹äºå›¾ç‰‡ã€éŸ³é¢‘ç­‰ä¿¡æ¯æ— æ³•ä¿å­˜ï¼ŒSDS æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œå†™å…¥ä»€ä¹ˆè¯»å–å°±æ˜¯ä»€ä¹ˆï¼Œä¸åšä»»ä½•è¿‡æ»¤å’Œé™åˆ¶ï¼›</li></ol><h3 id="_48-å­—å…¸æ˜¯å¦‚ä½•å®ç°çš„-rehash-äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_48-å­—å…¸æ˜¯å¦‚ä½•å®ç°çš„-rehash-äº†è§£å—"><span>48.å­—å…¸æ˜¯å¦‚ä½•å®ç°çš„ï¼ŸRehash äº†è§£å—ï¼Ÿ</span></a></h3><p>å­—å…¸æ˜¯ Redis æœåŠ¡å™¨ä¸­å‡ºç°æœ€ä¸ºé¢‘ç¹çš„å¤åˆå‹æ•°æ®ç»“æ„ã€‚é™¤äº† <strong>hash</strong> ç»“æ„çš„æ•°æ®ä¼šç”¨åˆ°å­—å…¸å¤–ï¼Œæ•´ä¸ª Redis æ•°æ®åº“çš„æ‰€æœ‰ <code>key</code> å’Œ <code>value</code> ä¹Ÿç»„æˆäº†ä¸€ä¸ª <strong>å…¨å±€å­—å…¸</strong>ï¼Œè¿˜æœ‰å¸¦è¿‡æœŸæ—¶é—´çš„ <code>key</code> ä¹Ÿæ˜¯ä¸€ä¸ªå­—å…¸ã€‚<em>(å­˜å‚¨åœ¨ RedisDb æ•°æ®ç»“æ„ä¸­)</em></p><p><strong>å­—å…¸ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</strong></p><p><strong>Redis</strong> ä¸­çš„å­—å…¸ç›¸å½“äº Java ä¸­çš„ <strong>HashMap</strong>ï¼Œå†…éƒ¨å®ç°ä¹Ÿå·®ä¸å¤šç±»ä¼¼ï¼Œé‡‡ç”¨å“ˆå¸Œä¸è¿ç®—è®¡ç®—ä¸‹æ ‡ä½ç½®ï¼›é€šè¿‡ <strong>&quot;æ•°ç»„ + é“¾è¡¨&quot; <strong>çš„</strong>é“¾åœ°å€æ³•</strong> æ¥è§£å†³å“ˆå¸Œå†²çªï¼ŒåŒæ—¶è¿™æ ·çš„ç»“æ„ä¹Ÿå¸æ”¶äº†ä¸¤ç§ä¸åŒæ•°æ®ç»“æ„çš„ä¼˜ç‚¹ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e08347a6-efd5-47c0-9adb-23baff82dbbd.png" alt="Rediså­—å…¸ç»“æ„" tabindex="0" loading="lazy"><figcaption>Rediså­—å…¸ç»“æ„</figcaption></figure><p><strong>å­—å…¸æ˜¯æ€ä¹ˆæ‰©å®¹çš„ï¼Ÿ</strong></p><p>å­—å…¸ç»“æ„å†…éƒ¨åŒ…å« <strong>ä¸¤ä¸ª hashtable</strong>ï¼Œé€šå¸¸æƒ…å†µä¸‹åªæœ‰ä¸€ä¸ªå“ˆå¸Œè¡¨ ht[0] æœ‰å€¼ï¼Œåœ¨æ‰©å®¹çš„æ—¶å€™ï¼ŒæŠŠ ht[0]é‡Œçš„å€¼ rehash åˆ° ht[1]ï¼Œç„¶åè¿›è¡Œ <strong>æ¸è¿›å¼ rehash</strong> â€”â€”æ‰€è°“æ¸è¿›å¼ rehashï¼ŒæŒ‡çš„æ˜¯è¿™ä¸ª rehash çš„åŠ¨ä½œå¹¶ä¸æ˜¯ä¸€æ¬¡æ€§ã€é›†ä¸­å¼åœ°å®Œæˆçš„ï¼Œè€Œæ˜¯åˆ†å¤šæ¬¡ã€æ¸è¿›å¼åœ°å®Œæˆçš„ã€‚</p><p>å¾…æ¬è¿ç»“æŸåï¼Œh[1]å°±å–ä»£ h[0]å­˜å‚¨å­—å…¸çš„å…ƒç´ ã€‚</p><h3 id="_49-è·³è¡¨æ˜¯å¦‚ä½•å®ç°çš„-åŸç†" tabindex="-1"><a class="header-anchor" href="#_49-è·³è¡¨æ˜¯å¦‚ä½•å®ç°çš„-åŸç†"><span>49.è·³è¡¨æ˜¯å¦‚ä½•å®ç°çš„ï¼ŸåŸç†ï¼Ÿ</span></a></h3><p>è·³è¡¨æ˜¯ä¸€ç§æœ‰åºçš„æ•°æ®ç»“æ„ï¼Œå®ƒé€šè¿‡åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­ç»´æŒå¤šä¸ªæŒ‡å‘å…¶å®ƒèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä»è€Œè¾¾åˆ°å¿«é€Ÿè®¿é—®èŠ‚ç‚¹çš„ç›®çš„ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-08391728-5ba8-42a0-a287-9284451e0ee7.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šè·³è¡¨" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šè·³è¡¨</figcaption></figure><h4 id="ä¸ºä»€ä¹ˆä½¿ç”¨è·³è¡¨" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆä½¿ç”¨è·³è¡¨"><span>ä¸ºä»€ä¹ˆä½¿ç”¨è·³è¡¨ï¼Ÿ</span></a></h4><p>é¦–å…ˆï¼Œå› ä¸º zset è¦æ”¯æŒéšæœºçš„æ’å…¥å’Œåˆ é™¤ï¼Œæ‰€ä»¥å®ƒ <strong>ä¸å®œä½¿ç”¨æ•°ç»„æ¥å®ç°</strong>ï¼Œå…³äºæ’åºé—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆå®¹æ˜“å°±æƒ³åˆ° <strong>çº¢é»‘æ ‘/ å¹³è¡¡æ ‘</strong> è¿™æ ·çš„æ ‘å½¢ç»“æ„ï¼Œä¸ºä»€ä¹ˆ Redis ä¸ä½¿ç”¨è¿™æ ·ä¸€äº›ç»“æ„å‘¢ï¼Ÿ</p><ol><li><strong>æ€§èƒ½è€ƒè™‘ï¼š</strong> åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œæ ‘å½¢ç»“æ„éœ€è¦æ‰§è¡Œä¸€äº›ç±»ä¼¼äº rebalance è¿™æ ·çš„å¯èƒ½æ¶‰åŠæ•´æ£µæ ‘çš„æ“ä½œï¼Œç›¸å¯¹æ¥è¯´è·³è·ƒè¡¨çš„å˜åŒ–åªæ¶‰åŠå±€éƒ¨ï¼›</li><li><strong>å®ç°è€ƒè™‘ï¼š</strong> åœ¨å¤æ‚åº¦ä¸çº¢é»‘æ ‘ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œè·³è·ƒè¡¨å®ç°èµ·æ¥æ›´ç®€å•ï¼Œçœ‹èµ·æ¥ä¹Ÿæ›´åŠ ç›´è§‚ï¼›</li></ol><p>åŸºäºä»¥ä¸Šçš„ä¸€äº›è€ƒè™‘ï¼ŒRedis åŸºäº <strong>William Pugh</strong> çš„è®ºæ–‡åšå‡ºä¸€äº›æ”¹è¿›åé‡‡ç”¨äº† <strong>è·³è·ƒè¡¨</strong> è¿™æ ·çš„ç»“æ„ã€‚</p><p>æœ¬è´¨æ˜¯è§£å†³æŸ¥æ‰¾é—®é¢˜ã€‚</p><h4 id="è·³è·ƒè¡¨æ˜¯æ€ä¹ˆå®ç°çš„" tabindex="-1"><a class="header-anchor" href="#è·³è·ƒè¡¨æ˜¯æ€ä¹ˆå®ç°çš„"><span>è·³è·ƒè¡¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</span></a></h4><p>è·³è·ƒè¡¨çš„èŠ‚ç‚¹é‡Œæœ‰è¿™äº›å…ƒç´ ï¼š</p><p>â‘ ã€<strong>å±‚</strong></p><p>è·³è·ƒè¡¨èŠ‚ç‚¹çš„ level æ•°ç»„å¯ä»¥åŒ…å«å¤šä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘å…¶å®ƒèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œç¨‹åºå¯ä»¥é€šè¿‡è¿™äº›å±‚æ¥åŠ å¿«è®¿é—®å…¶å®ƒèŠ‚ç‚¹çš„é€Ÿåº¦ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå±‚çš„æ•°é‡æœˆå¤šï¼Œè®¿é—®å…¶å®ƒèŠ‚ç‚¹çš„é€Ÿåº¦å°±è¶Šå¿«ã€‚</p><p>æ¯æ¬¡åˆ›å»ºä¸€ä¸ªæ–°çš„è·³è·ƒè¡¨èŠ‚ç‚¹çš„æ—¶å€™ï¼Œç¨‹åºéƒ½æ ¹æ®å¹‚æ¬¡å®šå¾‹ï¼Œéšæœºç”Ÿæˆä¸€ä¸ªä»‹äº 1 å’Œ 32 ä¹‹é—´çš„å€¼ä½œä¸º level æ•°ç»„çš„å¤§å°ï¼Œè¿™ä¸ªå¤§å°å°±æ˜¯å±‚çš„â€œé«˜åº¦â€</p><p>â‘¡ã€<strong>å‰è¿›æŒ‡é’ˆ</strong></p><p>æ¯ä¸ªå±‚éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘è¡¨å°¾çš„å‰è¿›æŒ‡é’ˆï¼ˆ<code>level[i].forward</code> å±æ€§ï¼‰ï¼Œç”¨äºä»è¡¨å¤´å‘è¡¨å°¾æ–¹å‘è®¿é—®èŠ‚ç‚¹ã€‚</p><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹è·³è·ƒè¡¨ä»è¡¨å¤´åˆ°è¡¨å°¾ï¼Œéå†æ‰€æœ‰èŠ‚ç‚¹çš„è·¯å¾„ï¼š</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-b153f782-e2e5-4f98-b251-04f06e16c073.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šé€šè¿‡å‰è¿›æŒ‡é’ˆéå†" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šé€šè¿‡å‰è¿›æŒ‡é’ˆéå†</figcaption></figure><p>â‘¢ã€<strong>è·¨åº¦</strong></p><p>å±‚çš„è·¨åº¦ç”¨äºè®°å½•ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è·ç¦»ã€‚è·¨åº¦æ˜¯ç”¨æ¥è®¡ç®—æ’ä½ï¼ˆrankï¼‰çš„ï¼šåœ¨æŸ¥æ‰¾æŸä¸ªèŠ‚ç‚¹çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ²¿é€”è®¿é—®è¿‡çš„æ‰€æœ‰å±‚çš„è·¨åº¦ç´¯è®¡èµ·æ¥ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯ç›®æ ‡èŠ‚ç‚¹åœ¨è·³è·ƒè¡¨ä¸­çš„æ’ä½ã€‚</p><p>ä¾‹å¦‚æŸ¥æ‰¾ï¼Œåˆ†å€¼ä¸º 3.0ã€æˆå‘˜å¯¹è±¡ä¸º o3 çš„èŠ‚ç‚¹æ—¶ï¼Œæ²¿é€”ç»å†çš„å±‚ï¼šæŸ¥æ‰¾çš„è¿‡ç¨‹åªç»è¿‡äº†ä¸€ä¸ªå±‚ï¼Œå¹¶ä¸”å±‚çš„è·¨åº¦ä¸º 3ï¼Œæ‰€ä»¥ç›®æ ‡èŠ‚ç‚¹åœ¨è·³è·ƒè¡¨ä¸­çš„æ’ä½ä¸º 3ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-d2395b7e-2f31-4ca8-b06d-2cb47afaeb74.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šè®¡ç®—èŠ‚ç‚¹çš„æ’ä½" tabindex="0" loading="lazy"><figcaption>ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šè®¡ç®—èŠ‚ç‚¹çš„æ’ä½</figcaption></figure><p>â‘£ã€<strong>åˆ†å€¼å’Œæˆå‘˜</strong></p><p>èŠ‚ç‚¹çš„åˆ†å€¼ï¼ˆscore å±æ€§ï¼‰æ˜¯ä¸€ä¸ª double ç±»å‹çš„æµ®ç‚¹æ•°ï¼Œè·³è·ƒè¡¨ä¸­æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æŒ‰åˆ†å€¼ä»å°åˆ°å¤§æ¥æ’åºã€‚</p><p>èŠ‚ç‚¹çš„æˆå‘˜å¯¹è±¡ï¼ˆobj å±æ€§ï¼‰æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œè€Œå­—ç¬¦ä¸²å¯¹è±¡åˆ™ä¿å­˜è¿™ä¸€ä¸ª SDS å€¼ã€‚</p><h4 id="ä¸ºä»€ä¹ˆ-hash-è¡¨èŒƒå›´æŸ¥è¯¢æ•ˆç‡æ¯”è·³è¡¨ä½" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆ-hash-è¡¨èŒƒå›´æŸ¥è¯¢æ•ˆç‡æ¯”è·³è¡¨ä½"><span>ä¸ºä»€ä¹ˆ hash è¡¨èŒƒå›´æŸ¥è¯¢æ•ˆç‡æ¯”è·³è¡¨ä½ï¼Ÿ</span></a></h4><p>å“ˆå¸Œè¡¨æ˜¯ä¸€ç§åŸºäºé”®å€¼å¯¹çš„æ•°æ®ç»“æ„ï¼Œä¸»è¦ç”¨äºå¿«é€ŸæŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚</p><p>å“ˆå¸Œè¡¨é€šè¿‡è®¡ç®—é”®çš„å“ˆå¸Œå€¼æ¥ç¡®å®šå€¼çš„å­˜å‚¨ä½ç½®ï¼Œè¿™ä½¿å¾—å®ƒåœ¨å•ä¸ªå…ƒç´ çš„è®¿é—®ä¸Šéå¸¸é«˜æ•ˆï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚</p><p>ç„¶è€Œï¼Œå“ˆå¸Œè¡¨å†…çš„å…ƒç´ æ˜¯æ— åºçš„ã€‚å› æ­¤ï¼Œå¯¹äºèŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚æŸ¥æ‰¾æ‰€æœ‰åœ¨æŸä¸ªèŒƒå›´å†…çš„å…ƒç´ ï¼‰ï¼Œå“ˆå¸Œè¡¨æ— æ³•ç›´æ¥æ”¯æŒï¼Œå¿…é¡»éå†æ•´ä¸ªè¡¨æ¥æ£€æŸ¥å“ªäº›å…ƒç´ æ»¡è¶³æ¡ä»¶ï¼Œè¿™ä½¿å¾—å…¶åœ¨èŒƒå›´æŸ¥è¯¢ä¸Šçš„æ•ˆç‡ä½ä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚</p><p>è·³è¡¨æ˜¯ä¸€ç§æœ‰åºçš„æ•°æ®ç»“æ„ï¼Œèƒ½å¤Ÿä¿æŒå…ƒç´ çš„æ’åºé¡ºåºã€‚</p><p>å®ƒé€šè¿‡å¤šå±‚çš„é“¾è¡¨ç»“æ„å®ç°å¿«é€Ÿçš„æ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾æ“ä½œï¼Œå…¶ä¸­æ¯ä¸€å±‚éƒ½æ˜¯ä¸‹ä¸€å±‚çš„ä¸€ä¸ªå­é›†ï¼Œå¹¶ä¸”å…ƒç´ åœ¨æ¯ä¸€å±‚éƒ½æ˜¯æœ‰åºçš„ã€‚</p><p>å½“è¿›è¡ŒèŒƒå›´æŸ¥è¯¢æ—¶ï¼Œè·³è¡¨å¯ä»¥ä»æœ€é«˜å±‚å¼€å§‹ï¼Œå¿«é€Ÿå®šä½åˆ°èŒƒå›´çš„èµ·å§‹ç‚¹ï¼Œç„¶åæ²¿ç€ä¸‹ä¸€å±‚ç»§ç»­ç›´åˆ°æ‰¾åˆ°èŒƒå›´çš„ç»“æŸç‚¹ã€‚è¿™ç§åˆ†å±‚çš„ç»“æ„ä½¿å¾—è·³è¡¨åœ¨è¿›è¡ŒèŒƒå›´æŸ¥è¯¢æ—¶éå¸¸é«˜æ•ˆï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(log n) åŠ ä¸ŠèŒƒå›´å†…å…ƒç´ çš„æ•°é‡ã€‚</p><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å°ç±³æš‘æœŸå®ä¹ åŒå­¦ E ä¸€é¢é¢è¯•åŸé¢˜ï¼šä¸ºä»€ä¹ˆ hash è¡¨èŒƒå›´æŸ¥è¯¢æ•ˆç‡æ¯”è·³è¡¨ä½</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 23 QQ åå°æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šzset çš„åº•å±‚åŸç†</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å¾—ç‰©é¢ç»åŒå­¦ 8 ä¸€é¢é¢è¯•åŸé¢˜ï¼šè·³è¡¨çš„ç»“æ„</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„ç¾å›¢é¢ç»åŒå­¦ 4 ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis è·³è¡¨</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„é˜¿é‡Œç³»é¢ç»åŒå­¦ 19 é¥¿äº†ä¹ˆé¢è¯•åŸé¢˜ï¼šè·³è¡¨äº†è§£å—</li></ol></blockquote><h3 id="_50-å‹ç¼©åˆ—è¡¨äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_50-å‹ç¼©åˆ—è¡¨äº†è§£å—"><span>50.å‹ç¼©åˆ—è¡¨äº†è§£å—ï¼Ÿ</span></a></h3><p>å‹ç¼©åˆ—è¡¨æ˜¯ Redis <strong>ä¸ºäº†èŠ‚çº¦å†…å­˜</strong> è€Œä½¿ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œæ˜¯ç”±ä¸€ç³»åˆ—ç‰¹æ®Šç¼–ç çš„è¿ç»­å†…å­˜å¿«ç»„æˆçš„é¡ºåºå‹æ•°æ®ç»“æ„ã€‚</p><p>ä¸€ä¸ªå‹ç¼©åˆ—è¡¨å¯ä»¥åŒ…å«ä»»æ„å¤šä¸ªèŠ‚ç‚¹ï¼ˆentryï¼‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥ä¿å­˜ä¸€ä¸ªå­—èŠ‚æ•°ç»„æˆ–è€…ä¸€ä¸ªæ•´æ•°å€¼ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-6be492f7-9f92-4607-a4c4-81a612a3d7bd.png" alt="å‹ç¼©åˆ—è¡¨ç»„æˆéƒ¨åˆ†" loading="lazy">å‹ç¼©åˆ—è¡¨ç”±è¿™ä¹ˆå‡ éƒ¨åˆ†ç»„æˆï¼š</p><ul><li><strong>zlbyttes</strong>:è®°å½•æ•´ä¸ªå‹ç¼©åˆ—è¡¨å ç”¨çš„å†…å­˜å­—èŠ‚æ•°</li><li><strong>zltail</strong>:è®°å½•å‹ç¼©åˆ—è¡¨è¡¨å°¾èŠ‚ç‚¹è·ç¦»å‹ç¼©åˆ—è¡¨çš„èµ·å§‹åœ°å€æœ‰å¤šå°‘å­—èŠ‚</li><li><strong>zllen</strong>:è®°å½•å‹ç¼©åˆ—è¡¨åŒ…å«çš„èŠ‚ç‚¹æ•°é‡</li><li><strong>entryX</strong>:åˆ—è¡¨èŠ‚ç‚¹</li><li><strong>zlend</strong>:ç”¨äºæ ‡è®°å‹ç¼©åˆ—è¡¨çš„æœ«ç«¯</li></ul><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-b5d224c2-53ee-40a3-9efc-2feb7dd3d7a8.png" alt="å‹ç¼©åˆ—è¡¨ç¤ºä¾‹" tabindex="0" loading="lazy"><figcaption>å‹ç¼©åˆ—è¡¨ç¤ºä¾‹</figcaption></figure><h3 id="_51-å¿«é€Ÿåˆ—è¡¨-quicklist-äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_51-å¿«é€Ÿåˆ—è¡¨-quicklist-äº†è§£å—"><span>51.å¿«é€Ÿåˆ—è¡¨ quicklist äº†è§£å—ï¼Ÿ</span></a></h3><p>Redis æ—©æœŸç‰ˆæœ¬å­˜å‚¨ list åˆ—è¡¨æ•°æ®ç»“æ„ä½¿ç”¨çš„æ˜¯å‹ç¼©åˆ—è¡¨ ziplist å’Œæ™®é€šçš„åŒå‘é“¾è¡¨ linkedlistï¼Œä¹Ÿå°±æ˜¯è¯´å½“å…ƒç´ å°‘æ—¶ä½¿ç”¨ ziplistï¼Œå½“å…ƒç´ å¤šæ—¶ç”¨ linkedlistã€‚</p><p>ä½†è€ƒè™‘åˆ°é“¾è¡¨çš„é™„åŠ ç©ºé—´ç›¸å¯¹è¾ƒé«˜ï¼Œ<code>prev</code> å’Œ <code>next</code> æŒ‡é’ˆå°±è¦å å» <code>16</code> ä¸ªå­—èŠ‚ï¼ˆ64 ä½æ“ä½œç³»ç»Ÿå ç”¨ <code>8</code> ä¸ªå­—èŠ‚ï¼‰ï¼Œå¦å¤–æ¯ä¸ªèŠ‚ç‚¹çš„å†…å­˜éƒ½æ˜¯å•ç‹¬åˆ†é…ï¼Œä¼šå®¶å…·å†…å­˜çš„ç¢ç‰‡åŒ–ï¼Œå½±å“å†…å­˜ç®¡ç†æ•ˆç‡ã€‚</p><p>åæ¥ Redis æ–°ç‰ˆæœ¬ï¼ˆ3.2ï¼‰å¯¹åˆ—è¡¨æ•°æ®ç»“æ„è¿›è¡Œäº†æ”¹é€ ï¼Œä½¿ç”¨ <code>quicklist</code> ä»£æ›¿äº† <code>ziplist</code> å’Œ <code>linkedlist</code>ï¼Œquicklist æ˜¯ç»¼åˆè€ƒè™‘äº†æ—¶é—´æ•ˆç‡ä¸ç©ºé—´æ•ˆç‡å¼•å…¥çš„æ–°å‹æ•°æ®ç»“æ„ã€‚</p><p>quicklist ç”± list å’Œ ziplist ç»“åˆè€Œæˆï¼Œå®ƒæ˜¯ä¸€ä¸ªç”± ziplist å……å½“èŠ‚ç‚¹çš„åŒå‘é“¾è¡¨ã€‚ <img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-3b9785b0-6573-4c2d-8b7d-d5d1be799e26.png" alt="quicklist" loading="lazy"></p><p>GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š<a href="https://github.com/itwanger/toBeBetterJavaer" target="_blank" rel="noopener noreferrer">äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯</a>ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&amp;å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š<a href="https://javabetter.cn/overview/" target="_blank" rel="noopener noreferrer">å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹</a></p><p>å¾®ä¿¡æœ <strong>æ²‰é»˜ç‹äºŒ</strong> æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ <strong>222</strong> å³å¯å…è´¹é¢†å–ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="è¡¥å……" tabindex="-1"><a class="header-anchor" href="#è¡¥å……"><span>è¡¥å……</span></a></h2><h3 id="_52-å‡å¦‚-redis-é‡Œé¢æœ‰-1-äº¿ä¸ª-key-å…¶ä¸­æœ‰-10w-ä¸ª-key-æ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„-å¦‚ä½•å°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥" tabindex="-1"><a class="header-anchor" href="#_52-å‡å¦‚-redis-é‡Œé¢æœ‰-1-äº¿ä¸ª-key-å…¶ä¸­æœ‰-10w-ä¸ª-key-æ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„-å¦‚ä½•å°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥"><span>52.å‡å¦‚ Redis é‡Œé¢æœ‰ 1 äº¿ä¸ª keyï¼Œå…¶ä¸­æœ‰ 10w ä¸ª key æ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚ä½•å°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Ÿ</span></a></h3><p>ä½¿ç”¨ <code>keys</code> æŒ‡ä»¤å¯ä»¥æ‰«å‡ºæŒ‡å®šæ¨¡å¼çš„ key åˆ—è¡¨ã€‚ä½†æ˜¯è¦æ³¨æ„ keys æŒ‡ä»¤ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ä¸€æ®µæ—¶é—´ï¼Œçº¿ä¸ŠæœåŠ¡ä¼šåœé¡¿ï¼Œç›´åˆ°æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ï¼ŒæœåŠ¡æ‰èƒ½æ¢å¤ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨ <code>scan</code> æŒ‡ä»¤ï¼Œ<code>scan</code> æŒ‡ä»¤å¯ä»¥æ— é˜»å¡çš„æå–å‡ºæŒ‡å®šæ¨¡å¼çš„ <code>key</code> åˆ—è¡¨ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€å®šçš„é‡å¤æ¦‚ç‡ï¼Œåœ¨å®¢æˆ·ç«¯åšä¸€æ¬¡å»é‡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æ•´ä½“æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ¯”ç›´æ¥ç”¨ <code>keys</code> æŒ‡ä»¤é•¿ã€‚</p><h3 id="_57-redis-çš„ç§’æ€åœºæ™¯ä¸‹æ‰®æ¼”äº†ä»€ä¹ˆè§’è‰²-è¡¥å……" tabindex="-1"><a class="header-anchor" href="#_57-redis-çš„ç§’æ€åœºæ™¯ä¸‹æ‰®æ¼”äº†ä»€ä¹ˆè§’è‰²-è¡¥å……"><span>57.Redis çš„ç§’æ€åœºæ™¯ä¸‹æ‰®æ¼”äº†ä»€ä¹ˆè§’è‰²ï¼Ÿï¼ˆè¡¥å……ï¼‰</span></a></h3><p>ç§’æ€ä¸»è¦æ˜¯æŒ‡å¤§é‡ç”¨æˆ·é›†ä¸­åœ¨çŸ­æ—¶é—´å†…å¯¹æœåŠ¡å™¨è¿›è¡Œè®¿é—®ï¼Œä»è€Œå¯¼è‡´æœåŠ¡å™¨è´Ÿè½½å‰§å¢ï¼Œå¯èƒ½å‡ºç°ç³»ç»Ÿå“åº”ç¼“æ…¢ç”šè‡³å´©æºƒçš„æƒ…å†µã€‚</p><p>é’ˆå¯¹ç§’æ€çš„åœºæ™¯æ¥è¯´ï¼Œæœ€ç»ˆæŠ¢åˆ°å•†å“çš„ç”¨æˆ·æ˜¯å›ºå®šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ 100 ä¸ªäººå’Œ 10000 ä¸ªäººæ¥æŠ¢ä¸€ä¸ªå•†å“ï¼Œæœ€ç»ˆéƒ½åªèƒ½æœ‰ 100 ä¸ªäººæŠ¢åˆ°ã€‚</p><p>ä½†æ˜¯å¯¹äºç§’æ€æ´»åŠ¨çš„åˆå¿ƒæ¥è¯´ï¼Œè‚¯å®šæ˜¯å¸Œæœ›å‚ä¸çš„ç”¨æˆ·è¶Šå¤šè¶Šå¥½ï¼Œä½†çœŸæ­£å¼€å§‹ä¸‹å•æ—¶ï¼Œæœ€å¥½èƒ½æŠŠè¯·æ±‚æ§åˆ¶åœ¨æœåŠ¡å™¨èƒ½å¤Ÿæ‰¿å—çš„èŒƒå›´ä¹‹å†…ï¼ˆğŸ˜‚ï¼‰ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240420102552.png" alt="è®¸ä»¤æ³¢-ç§’æ€ç³»ç»Ÿçš„è®¾è®¡" tabindex="0" loading="lazy"><figcaption>è®¸ä»¤æ³¢-ç§’æ€ç³»ç»Ÿçš„è®¾è®¡</figcaption></figure><p>è§£å†³è¿™ä¸€é—®é¢˜çš„å…³é”®å°±åœ¨äºé”™å³°å‰Šå³°å’Œé™æµã€‚å½“ç„¶äº†ï¼Œå‰ç«¯é¡µé¢çš„é™æ€åŒ–ã€æŒ‰é’®é˜²æŠ–ä¹Ÿèƒ½å¤Ÿæœ‰æ•ˆçš„å‡è½»æœåŠ¡å™¨çš„å‹åŠ›ã€‚</p><ul><li>é¡µé¢é™æ€åŒ–ï¼šå°†å•†å“è¯¦æƒ…ç­‰é¡µé¢é™æ€åŒ–ï¼Œä½¿ç”¨ CDN åˆ†å‘ã€‚</li><li>æŒ‰é’®é˜²æŠ–ï¼šé¿å…ç”¨æˆ·å› é¢‘ç¹ç‚¹å‡»é€ æˆçš„é¢å¤–è¯·æ±‚ï¼Œæ¯”å¦‚è®¾å®šé—´éš”æ—¶é—´åæ‰èƒ½å†æ¬¡ç‚¹å‡»ã€‚</li></ul><h4 id="å¦‚ä½•å®ç°é”™å³°å‰Šå³°å‘¢" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•å®ç°é”™å³°å‰Šå³°å‘¢"><span>å¦‚ä½•å®ç°é”™å³°å‰Šå³°å‘¢ï¼Ÿ</span></a></h4><p>é’ˆå¯¹è½¦æµé‡çš„æ™šé«˜å³°å’Œæ—©é«˜å³°ï¼Œæœ€å¼ºæœ‰åŠ›çš„åŠæ³•å°±æ˜¯é™è¡Œï¼Œä½†é™è¡Œä¸æ˜¯æ— æŸçš„ï¼Œæ¯•ç«Ÿé™è¡Œçš„ç‰Œå·æ— æ³•å‡ºè¡Œã€‚</p><p>æ— æŸçš„æ–¹å¼å°±æ˜¯æœ‰çš„è½¦è¾†æ—©å‡ºå‘ï¼Œæœ‰çš„è½¦è¾†æ™šå‡ºå‘ï¼Œè¿™æ ·å°±èƒ½å¤Ÿå®ç°é”™å³°å‡ºè¡Œã€‚</p><p>åœ¨ç§’æ€åœºæ™¯ä¸‹ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼å®ç°é”™å³°å‰Šå³°ï¼š</p><p>â‘ ã€<strong>é¢„çƒ­ç¼“å­˜</strong>ï¼šæå‰å°†çƒ­ç‚¹æ•°æ®åŠ è½½åˆ° Redis ç¼“å­˜ä¸­ï¼Œå‡å°‘å¯¹æ•°æ®åº“çš„è®¿é—®å‹åŠ›ã€‚</p><p>â‘¡ã€<strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šå¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå°†è¯·æ±‚å¼‚æ­¥å¤„ç†ï¼Œå‡å°‘ç¬æ—¶è¯·æ±‚å‹åŠ›ã€‚æ¶ˆæ¯é˜Ÿåˆ—å°±åƒä¸€ä¸ªæ°´åº“ï¼Œå¯ä»¥å‰Šå‡ä¸Šæ¸¸çš„æ´ªå³°æµé‡ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240420104633.png" alt="è®¸ä»¤æ³¢-æ’é˜Ÿ" tabindex="0" loading="lazy"><figcaption>è®¸ä»¤æ³¢-æ’é˜Ÿ</figcaption></figure><p>â‘¢ã€<strong>å¤šé˜¶æ®µå¤šæ—¶é—´çª—å£</strong>ï¼šå°†ç§’æ€æ´»åŠ¨åˆ†ä¸ºå¤šä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µè®¾ç½®ä¸åŒçš„æ—¶é—´çª—å£ï¼Œè®©ç”¨æˆ·åœ¨ä¸åŒçš„æ—¶é—´æ®µå†…å‚ä¸ç§’æ€æ´»åŠ¨ã€‚</p><p>â‘£ã€<strong>æ’å…¥ç­”é¢˜ç³»ç»Ÿ</strong>ï¼šåœ¨ç§’æ€æ´»åŠ¨ä¸­åŠ å…¥ç­”é¢˜ç¯èŠ‚ï¼Œåªæœ‰ç­”å¯¹é¢˜ç›®çš„ç”¨æˆ·æ‰èƒ½å‚ä¸ç§’æ€æ´»åŠ¨ï¼Œè¿™æ ·å¯ä»¥å‡å°‘æ— æ•ˆè¯·æ±‚ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240420104921.png" alt="è®¸ä»¤æ³¢-ç­”é¢˜" tabindex="0" loading="lazy"><figcaption>è®¸ä»¤æ³¢-ç­”é¢˜</figcaption></figure><h4 id="å¦‚ä½•é™æµå‘¢" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•é™æµå‘¢"><span>å¦‚ä½•é™æµå‘¢ï¼Ÿ</span></a></h4><p>é‡‡ç”¨ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œå®ƒå°±åƒåœ¨å¸éƒ½ä¹°è½¦ï¼Œæ‘‡åˆ°å·æ‰æœ‰èµ„æ ¼ï¼Œæ²¡æ‘‡åˆ°å°±åªèƒ½ç­‰ä¸‹ä¸€æ¬¡ï¼ˆğŸ˜ï¼‰ã€‚</p><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç»´æŠ¤ä¸€ä¸ªå®¹å™¨ï¼ŒæŒ‰ç…§å›ºå®šçš„é€Ÿç‡å¾€å®¹å™¨ä¸­æ”¾ä»¤ç‰Œï¼ˆtokenï¼‰ï¼Œå½“è¯·æ±‚åˆ°æ¥æ—¶ï¼Œä»å®¹å™¨ä¸­å–å‡ºä¸€ä¸ªä»¤ç‰Œï¼Œå¦‚æœå®¹å™¨ä¸­æ²¡æœ‰ä»¤ç‰Œï¼Œåˆ™æ‹’ç»è¯·æ±‚ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240420114025.png" alt="æå­æŒï¼šä»¤ç‰Œæ¡¶" tabindex="0" loading="lazy"><figcaption>æå­æŒï¼šä»¤ç‰Œæ¡¶</figcaption></figure><p>ç¬¬ä¸€æ­¥ï¼Œä½¿ç”¨ Redis åˆå§‹åŒ–ä»¤ç‰Œæ¡¶ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SET</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;token_bucket&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;100&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç¬¬äºŒæ­¥ï¼Œä½¿ç”¨ Lua è„šæœ¬å®ç°ä»¤ç‰Œæ¡¶ç®—æ³•ï¼›å‡è®¾æ¯ç§’å‘æ¡¶ä¸­æ·»åŠ  10 ä¸ªä»¤ç‰Œï¼Œä½†ä¸è¶…è¿‡æ¡¶çš„æœ€å¤§å®¹é‡ã€‚</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- Lua è„šæœ¬æ¥æ·»åŠ ä»¤ç‰Œï¼Œå¹¶ç¡®ä¿ä¸è¶…è¿‡æœ€å¤§å®¹é‡</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> bucket</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">KEYS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> add_count</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">tonumber</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">])</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> max_tokens</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">tonumber</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">])</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> current</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">tonumber</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;GET&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bucket</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) or </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> new_count</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">math.min</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">current</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> + </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">add_count</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">max_tokens</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;SET&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bucket</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">tostring</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">new_count</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">return</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> new_count</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬ä¸‰æ­¥ï¼Œä½¿ç”¨ Shell è„šæœ¬è°ƒç”¨ Lua è„šæœ¬ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#!/bin/bash</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">while</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">do</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    redis-cli</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EVAL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> add_tokens.lua)&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> token_bucket</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    sleep</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">done</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬å››æ­¥ï¼Œå½“è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œéœ€è¦æ£€æŸ¥å¹¶æ¶ˆè€—ä¸€ä¸ªä»¤ç‰Œã€‚</p><div class="language-lua line-numbers-mode" data-highlighter="shiki" data-ext="lua" data-title="lua" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- Lua è„šæœ¬æ¥æ¶ˆè€—ä¸€ä¸ªä»¤ç‰Œ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> bucket</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">KEYS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tokens</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">tonumber</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;GET&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bucket</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) or </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tokens</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> then</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">call</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;DECR&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bucket</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  -- æˆåŠŸæ¶ˆè€—ä»¤ç‰Œ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  -- ä»¤ç‰Œä¸è¶³</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è°ƒç”¨ Lua è„šæœ¬ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EVAL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> consume_token.lua)&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> token_bucket</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å†œä¸šé“¶è¡Œé¢ç»åŒå­¦ 3 Java åç«¯é¢è¯•åŸé¢˜ï¼šç§’æ€é—®é¢˜ï¼ˆé”™å³°ã€å‰Šå³°ã€å‰ç«¯ã€æµé‡æ§åˆ¶ï¼‰</li><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„æ»´æ»´é¢ç»åŒå­¦ 3 ç½‘çº¦è½¦åç«¯å¼€å‘ä¸€é¢åŸé¢˜ï¼šé™æµç®—æ³•</li></ol></blockquote><h3 id="_58-å®¢æˆ·ç«¯å®•æœºå-redis-æœåŠ¡ç«¯å¦‚ä½•æ„ŸçŸ¥åˆ°" tabindex="-1"><a class="header-anchor" href="#_58-å®¢æˆ·ç«¯å®•æœºå-redis-æœåŠ¡ç«¯å¦‚ä½•æ„ŸçŸ¥åˆ°"><span>58. å®¢æˆ·ç«¯å®•æœºå Redis æœåŠ¡ç«¯å¦‚ä½•æ„ŸçŸ¥åˆ°ï¼Ÿ</span></a></h3><p>æ¯ä¸ªå®¢æˆ·ç«¯åœ¨ Redis ä¸­ç»´æŠ¤ä¸€ä¸ªç‰¹å®šçš„é”®ï¼ˆç§°ä¸ºå¿ƒè·³é”®ï¼‰ï¼Œç”¨äºè¡¨ç¤ºå®¢æˆ·ç«¯çš„å¥åº·çŠ¶æ€ã€‚è¯¥é”®å…·æœ‰ä¸€ä¸ªè®¾ç½®çš„è¶…æ—¶æ—¶é—´ï¼Œä¾‹å¦‚ 10 ç§’ã€‚</p><p>å®¢æˆ·ç«¯å®šæœŸï¼ˆå¦‚æ¯ 5 ç§’ï¼‰æ›´æ–°è¿™ä¸ªå¿ƒè·³é”®çš„è¶…æ—¶æ—¶é—´ï¼Œä¿æŒå®ƒçš„å­˜æ´»çŠ¶æ€ï¼Œé€šå¸¸é€šè¿‡ SET å‘½ä»¤é‡è®¾é”®çš„è¿‡æœŸæ—¶é—´ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> redis.clients.jedis.Jedis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ClientHeartbeat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> HEARTBEAT_KEY </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;client:heartbeat&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> EXPIRE_TIME </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // 10ç§’</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // åˆ›å»º Redis è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        Jedis</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> jedis</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Jedis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;localhost&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // å®šæ—¶æ›´æ–°å¿ƒè·³é”®</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        while</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            try</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                // è®¾ç½®å¿ƒè·³é”®å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                jedis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setex</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(HEARTBEAT_KEY, EXPIRE_TIME, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;alive&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                // æ‰“å°å¿ƒè·³æ—¥å¿—</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Heartbeat sent.&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                // ç­‰å¾…ä¸€æ®µæ—¶é—´åå†æ¬¡å‘é€å¿ƒè·³</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// æ¯5ç§’å‘é€ä¸€æ¬¡å¿ƒè·³</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">InterruptedException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                break</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Redis æœåŠ¡ç«¯å®šæœŸæ£€æŸ¥è¿™ä¸ªå¿ƒè·³é”®ã€‚å¦‚æœå‘ç°è¯¥é”®å·²è¶…æ—¶å¹¶è¢« Redis è‡ªåŠ¨åˆ é™¤ï¼Œè¯´æ˜å®¢æˆ·ç«¯å¯èƒ½å·²å®•æœºã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> redis.clients.jedis.Jedis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ServerMonitor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> HEARTBEAT_KEY </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;client:heartbeat&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // åˆ›å»º Redis è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        Jedis</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> jedis</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Jedis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;localhost&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // å®šæœŸæ£€æŸ¥å¿ƒè·³é”®</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        while</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            try</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                // æ£€æŸ¥å¿ƒè·³é”®æ˜¯å¦å­˜åœ¨</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">jedis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">exists</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(HEARTBEAT_KEY)) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                    System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Client is alive.&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                    System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Client is down or disconnected.&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                // æ¯éš”ä¸€æ®µæ—¶é—´æ£€æŸ¥ä¸€æ¬¡</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// æ¯10ç§’æ£€æŸ¥ä¸€æ¬¡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">InterruptedException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                break</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><ol><li><a href="https://javabetter.cn/zhishixingqiu/mianshi.html" target="_blank" rel="noopener noreferrer">Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰</a>æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 21 æŠ–éŸ³å•†åŸä¸€é¢é¢è¯•åŸé¢˜ï¼šå¦‚æœå®¢æˆ·ç«¯å®•æœºæœåŠ¡å™¨å¦‚ä½•æ„ŸçŸ¥ï¼Ÿ</li></ol></blockquote><hr><p>å›¾æ–‡è¯¦è§£ 58 é“ Redis é¢è¯•é«˜é¢‘é¢˜ï¼Œè¿™æ¬¡åŠæ‰“é¢è¯•å®˜ï¼Œæˆ‘è§‰å¾—ç¨³äº†ï¼ˆæ‰‹åŠ¨ dogï¼‰ã€‚æ•´ç†ï¼šæ²‰é»˜ç‹äºŒï¼Œæˆ³<a href="https://mp.weixin.qq.com/s/19u34NXALB1nOlBCE6Eg-Q" target="_blank" rel="noopener noreferrer">è½¬è½½é“¾æ¥</a>ï¼Œä½œè€…ï¼šä¸‰åˆ†æ¶ï¼Œæˆ³<a href="https://mp.weixin.qq.com/s/iJtNJYgirRugNBnzxkbB4Q" target="_blank" rel="noopener noreferrer">åŸæ–‡é“¾æ¥</a>ã€‚</p><p><em>æ²¡æœ‰ä»€ä¹ˆä½¿æˆ‘åœç•™â€”â€”é™¤äº†ç›®çš„ï¼Œçºµç„¶å²¸æ—æœ‰ç«ç‘°ã€æœ‰ç»¿è«ã€æœ‰å®é™çš„æ¸¯æ¹¾ï¼Œæˆ‘æ˜¯ä¸ç³»ä¹‹èˆŸ</em>ã€‚</p><p><strong>ç³»åˆ—å†…å®¹</strong>ï¼š</p><ul><li><a href="https://javabetter.cn/sidebar/sanfene/javase.html" target="_blank" rel="noopener noreferrer">é¢æ¸£é€†è¢­ Java SE ç¯‡ ğŸ‘</a></li><li><a href="https://javabetter.cn/sidebar/sanfene/javathread.html" target="_blank" rel="noopener noreferrer">é¢æ¸£é€†è¢­ Java é›†åˆæ¡†æ¶ç¯‡ ğŸ‘</a></li><li><a href="https://javabetter.cn/sidebar/sanfene/collection.html" target="_blank" rel="noopener noreferrer">é¢æ¸£é€†è¢­ Java å¹¶å‘ç¼–ç¨‹ç¯‡ ğŸ‘</a></li><li><a href="https://javabetter.cn/sidebar/sanfene/jvm.html" target="_blank" rel="noopener noreferrer">é¢æ¸£é€†è¢­ JVM ç¯‡ ğŸ‘</a></li><li><a href="https://javabetter.cn/sidebar/sanfene/spring.html" target="_blank" rel="noopener noreferrer">é¢æ¸£é€†è¢­ Spring ç¯‡ ğŸ‘</a></li><li><a href="https://javabetter.cn/sidebar/sanfene/redis.html" target="_blank" rel="noopener noreferrer">é¢æ¸£é€†è¢­ Redis ç¯‡ ğŸ‘</a></li><li><a href="https://javabetter.cn/sidebar/sanfene/mybatis.html" target="_blank" rel="noopener noreferrer">é¢æ¸£é€†è¢­ MyBatis ç¯‡ ğŸ‘</a></li><li><a href="https://javabetter.cn/sidebar/sanfene/mysql.html" target="_blank" rel="noopener noreferrer">é¢æ¸£é€†è¢­ MySQL ç¯‡ ğŸ‘</a></li><li><a href="https://javabetter.cn/sidebar/sanfene/os.html" target="_blank" rel="noopener noreferrer">é¢æ¸£é€†è¢­æ“ä½œç³»ç»Ÿç¯‡ ğŸ‘</a></li><li><a href="https://javabetter.cn/sidebar/sanfene/network.html" target="_blank" rel="noopener noreferrer">é¢æ¸£é€†è¢­è®¡ç®—æœºç½‘ç»œç¯‡ ğŸ‘</a></li><li><a href="https://javabetter.cn/sidebar/sanfene/rocketmq.html" target="_blank" rel="noopener noreferrer">é¢æ¸£é€†è¢­ RocketMQ ç¯‡ ğŸ‘</a></li><li><a href="https://javabetter.cn/sidebar/sanfene/fenbushi.html" target="_blank" rel="noopener noreferrer">é¢æ¸£é€†è¢­åˆ†å¸ƒå¼ç¯‡ ğŸ‘</a></li><li><a href="https://javabetter.cn/sidebar/sanfene/weifuwu.html" target="_blank" rel="noopener noreferrer">é¢æ¸£é€†è¢­å¾®æœåŠ¡ç¯‡ ğŸ‘</a></li><li><a href="https://javabetter.cn/sidebar/sanfene/shejimoshi.html" target="_blank" rel="noopener noreferrer">é¢æ¸£é€†è¢­è®¾è®¡æ¨¡å¼ç¯‡ ğŸ‘</a></li><li><a href="https://javabetter.cn/sidebar/sanfene/linux.html" target="_blank" rel="noopener noreferrer">é¢æ¸£é€†è¢­ Linux ç¯‡ ğŸ‘</a></li></ul><hr><p>GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š<a href="https://github.com/itwanger/toBeBetterJavaer" target="_blank" rel="noopener noreferrer">äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯</a>ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&amp;å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š<a href="https://javabetter.cn/overview/" target="_blank" rel="noopener noreferrer">å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹</a></p><p>å¾®ä¿¡æœ <strong>æ²‰é»˜ç‹äºŒ</strong> æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ <strong>222</strong> å³å¯å…è´¹é¢†å–ã€‚</p><figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/itwanger/toBeBetterJavaer/edit/master/docs/src/sidebar/sanfene/redis.md" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: www.qing_gee@163.com">æ²‰é»˜ç‹äºŒ</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/sidebar/sanfene/spring.html" aria-label="é¢æ¸£é€†è¢­-Spring"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->é¢æ¸£é€†è¢­-Spring</div></a><a class="route-link auto-link next" href="/sidebar/sanfene/mybatis.html" aria-label="é¢æ¸£é€†è¢­-MyBatis"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">é¢æ¸£é€†è¢­-MyBatis<!----></div></a></nav><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer"><a href="https://beian.miit.gov.cn/" target="_blank">è±«ICPå¤‡2021038026å·-4</a><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/beian.png" height="15px" width="15px" /><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41030502000411"><span>è±«å…¬ç½‘å®‰å¤‡ 41030502000411å·</span></a></div><div class="vp-copyright">Copyright Â© 2024 ä¸‰åˆ†æ¶ </div></footer></div><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-wJXw8B29.js" defer></script>
  </body>
</html>
