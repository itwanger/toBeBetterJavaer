---
title: æ·±å…¥ç†è§£ JVM çš„åƒåœ¾æ”¶é›†å™¨ï¼šCMSã€G1ã€ZGC
shortTitle: åƒåœ¾æ”¶é›†å™¨
category:
  - Javaæ ¸å¿ƒ
tag:
  - Javaè™šæ‹Ÿæœº
description: æ·±å…¥ç†è§£ JVM çš„åƒåœ¾æ”¶é›†å™¨ï¼šCMSã€G1ã€ZGC
head:
  - - meta
    - name: keywords
      content: Java,JavaSE,æ•™ç¨‹,äºŒå“¥çš„Javaè¿›é˜¶ä¹‹è·¯,jvm,Javaè™šæ‹Ÿæœº,CMS,G1,ZGC,åƒåœ¾æ”¶é›†å™¨
---

# ç¬¬åä¸€èŠ‚ï¼šåƒåœ¾æ”¶é›†å™¨

åƒåœ¾å›æ”¶å¯¹äº Java å…šæ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªç»•ä¸å¼€çš„è¯é¢˜ï¼Œå·¥ä½œä¸­æ¶‰åŠåˆ°çš„è°ƒä¼˜å·¥ä½œä¹Ÿç»å¸¸å›´ç»•ç€åƒåœ¾å›æ”¶å™¨å±•å¼€ã€‚é¢å¯¹ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼Œå¾€å¾€éœ€è¦ä¸åŒçš„åƒåœ¾æ”¶é›†å™¨æ‰èƒ½ä¿è¯ GC æ€§èƒ½ï¼Œå› æ­¤ï¼Œå¯¹äºé¢å¤§å‚æˆ–è€…æœ‰è¿œå¤§å¿—å‘çš„çƒå‹å¯ä»¥å·ä¸€ä¸‹åƒåœ¾æ”¶é›†å™¨ã€‚

å°±ç›®å‰æ¥è¯´ï¼ŒJVM çš„åƒåœ¾æ”¶é›†å™¨ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼š**åˆ†ä»£æ”¶é›†å™¨**å’Œ**åˆ†åŒºæ”¶é›†å™¨**ï¼Œåˆ†ä»£æ”¶é›†å™¨çš„ä»£è¡¨æ˜¯ CMSï¼Œåˆ†åŒºæ”¶é›†å™¨çš„ä»£è¡¨æ˜¯ G1 å’Œ ZGCï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸¤å¤§ç±»çš„åƒåœ¾æ”¶é›†å™¨ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-collector-20231227143820.png)

## åˆ†ä»£æ”¶é›†å™¨

### CMS

ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡ï¼Œé‡‡ç”¨â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ï¼Œåˆ† 4 å¤§æ­¥è¿›è¡Œåƒåœ¾æ”¶é›†ï¼Œå…¶ä¸­åˆå§‹æ ‡è®°å’Œé‡æ–°æ ‡è®°ä¼š STWï¼ŒJDK 1.5 æ—¶å¼•å…¥ï¼ŒJDK9 è¢«æ ‡è®°å¼ƒç”¨ï¼ŒJDK14 è¢«ç§»é™¤ï¼Œè¯¦æƒ…å¯è§ Â [JEP 363](https://openjdk.java.net/jeps/363)ã€‚

**CMSï¼ˆConcurrent Mark Sweepï¼‰åƒåœ¾æ”¶é›†å™¨æ˜¯ç¬¬ä¸€ä¸ªå…³æ³¨ GC åœé¡¿æ—¶é—´ï¼ˆSTW çš„æ—¶é—´ï¼‰çš„åƒåœ¾æ”¶é›†å™¨**ã€‚ä¹‹å‰çš„åƒåœ¾æ”¶é›†å™¨ï¼Œè¦ä¹ˆæ˜¯ä¸²è¡Œçš„åƒåœ¾å›æ”¶æ–¹å¼ï¼Œè¦ä¹ˆåªå…³æ³¨ç³»ç»Ÿååé‡ã€‚

CMS åƒåœ¾æ”¶é›†å™¨ä¹‹æ‰€ä»¥èƒ½å¤Ÿå®ç°å¯¹ GC åœé¡¿æ—¶é—´çš„æ§åˆ¶ï¼Œå…¶æœ¬è´¨æ¥æºäºå¯¹ã€Œå¯è¾¾æ€§åˆ†æç®—æ³•ã€çš„æ”¹è¿›ï¼Œå³ä¸‰è‰²æ ‡è®°ç®—æ³•ã€‚åœ¨ CMS å‡ºç°ä¹‹å‰ï¼Œæ— è®ºæ˜¯ Serious åƒåœ¾æ”¶é›†å™¨ï¼Œè¿˜æ˜¯ ParNew åƒåœ¾æ”¶é›†å™¨ï¼Œä»¥åŠ Parallel Scavenge åƒåœ¾æ”¶é›†å™¨ï¼Œå®ƒä»¬åœ¨è¿›è¡Œåƒåœ¾å›æ”¶çš„æ—¶å€™éƒ½éœ€è¦ Stop the Worldï¼Œæ— æ³•å®ç°åƒåœ¾å›æ”¶çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹çš„å¹¶å‘æ‰§è¡Œã€‚

> æ ‡è®°-æ¸…é™¤ç®—æ³•ã€Stop the Worldã€å¯è¾¾æ€§åˆ†æç®—æ³•ç­‰çŸ¥è¯†æˆ‘ä»¬[ä¸Šä¸€èŠ‚](https://javabetter.cn/jvm/gc.html)ä¹Ÿè®²è¿‡äº†ï¼Œå¿˜è®°çš„[çƒå‹](https://javabetter.cn/zhishixingqiu/)å¯ä»¥å›é¡¾ä¸€ä¸‹ã€‚

CMS åƒåœ¾æ”¶é›†å™¨é€šè¿‡ä¸‰è‰²æ ‡è®°ç®—æ³•ï¼Œå®ç°äº†åƒåœ¾å›æ”¶çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹çš„å¹¶å‘æ‰§è¡Œï¼Œä»è€Œæå¤§åœ°é™ä½äº†ç³»ç»Ÿå“åº”æ—¶é—´ï¼Œæé«˜äº†å¼ºäº¤äº’åº”ç”¨ç¨‹åºçš„ä½“éªŒã€‚å®ƒçš„è¿è¡Œè¿‡ç¨‹åˆ†ä¸º 4 ä¸ªæ­¥éª¤ï¼ŒåŒ…æ‹¬ï¼š

- åˆå§‹æ ‡è®°
- å¹¶å‘æ ‡è®°
- é‡æ–°æ ‡è®°
- å¹¶å‘æ¸…é™¤

**åˆå§‹æ ‡è®°**ï¼ŒæŒ‡çš„æ˜¯å¯»æ‰¾æ‰€æœ‰è¢« GCRoots å¼•ç”¨çš„å¯¹è±¡ï¼Œè¯¥é˜¶æ®µéœ€è¦ã€ŒStop the Worldã€ã€‚è¿™ä¸ªæ­¥éª¤ä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹ GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œå¹¶ä¸éœ€è¦åšæ•´ä¸ªå¼•ç”¨çš„æ‰«æï¼Œå› æ­¤é€Ÿåº¦å¾ˆå¿«ã€‚

**å¹¶å‘æ ‡è®°**ï¼ŒæŒ‡çš„æ˜¯å¯¹ã€Œåˆå§‹æ ‡è®°é˜¶æ®µã€æ ‡è®°çš„å¯¹è±¡è¿›è¡Œæ•´ä¸ªå¼•ç”¨é“¾çš„æ‰«æï¼Œè¯¥é˜¶æ®µä¸éœ€è¦ã€ŒStop the Worldã€ã€‚ å¯¹æ•´ä¸ªå¼•ç”¨é“¾åšæ‰«æéœ€è¦èŠ±è´¹éå¸¸å¤šçš„æ—¶é—´ï¼Œå› æ­¤é€šè¿‡åƒåœ¾å›æ”¶çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œå¯ä»¥é™ä½åƒåœ¾å›æ”¶çš„æ—¶é—´ã€‚

è¿™ä¹Ÿæ˜¯ CMS èƒ½æå¤§é™ä½ GC åœé¡¿æ—¶é—´çš„æ ¸å¿ƒåŸå› ï¼Œä½†è¿™ä¹Ÿå¸¦æ¥äº†ä¸€äº›é—®é¢˜ï¼Œå³ï¼šå¹¶å‘æ ‡è®°çš„æ—¶å€™ï¼Œå¼•ç”¨å¯èƒ½å‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤å¯èƒ½å‘ç”Ÿæ¼æ ‡ï¼ˆæœ¬åº”è¯¥å›æ”¶çš„åƒåœ¾æ²¡æœ‰è¢«å›æ”¶ï¼‰å’Œå¤šæ ‡ï¼ˆæœ¬ä¸åº”è¯¥å›æ”¶çš„åƒåœ¾è¢«å›æ”¶ï¼‰äº†ã€‚

**é‡æ–°æ ‡è®°**ï¼ŒæŒ‡çš„æ˜¯å¯¹ã€Œå¹¶å‘æ ‡è®°ã€é˜¶æ®µå‡ºç°çš„é—®é¢˜è¿›è¡Œæ ¡æ­£ï¼Œè¯¥é˜¶æ®µéœ€è¦ã€ŒStop the Worldã€ã€‚æ­£å¦‚å¹¶å‘æ ‡è®°é˜¶æ®µè¯´åˆ°çš„ï¼Œç”±äºåƒåœ¾å›æ”¶ç®—æ³•å’Œç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œè™½ç„¶èƒ½é™ä½å“åº”æ—¶é—´ï¼Œä½†æ˜¯ä¼šå‘ç”Ÿæ¼æ ‡å’Œå¤šæ ‡çš„é—®é¢˜ã€‚æ‰€ä»¥å¯¹äº CMS æ¥è¯´ï¼Œå®ƒéœ€è¦åœ¨è¿™ä¸ªé˜¶æ®µåšä¸€äº›æ ¡éªŒï¼Œè§£å†³å¹¶å‘æ ‡è®°é˜¶æ®µå‘ç”Ÿçš„é—®é¢˜ã€‚

**å¹¶å‘æ¸…é™¤**ï¼ŒæŒ‡çš„æ˜¯å°†æ ‡è®°ä¸ºåƒåœ¾çš„å¯¹è±¡è¿›è¡Œæ¸…é™¤ï¼Œè¯¥é˜¶æ®µä¸éœ€è¦ã€ŒStop the Worldã€ã€‚ åœ¨è¿™ä¸ªé˜¶æ®µï¼Œåƒåœ¾å›æ”¶çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œå› æ­¤å¹¶ä¸å½±å“ç”¨æˆ·çš„å“åº”æ—¶é—´ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-collector-20231228211056.png)

CMS çš„ä¼˜ç‚¹æ˜¯ï¼šå¹¶å‘æ”¶é›†ã€ä½åœé¡¿ã€‚ä½†ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼š

â‘ ã€å¯¹ CPU èµ„æºéå¸¸æ•æ„Ÿï¼Œå› æ­¤åœ¨ CPU èµ„æºç´§å¼ çš„æƒ…å†µä¸‹ï¼ŒCMS çš„æ€§èƒ½ä¼šå¤§æ‰“æŠ˜æ‰£ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼ŒCMS å¯ç”¨çš„åƒåœ¾å›æ”¶çº¿ç¨‹æ•°æ˜¯`ï¼ˆCPUæ•°é‡ + 3)/4`ï¼Œå½“ CPU æ•°é‡å¾ˆå¤§æ—¶ï¼Œå¯ç”¨çš„åƒåœ¾å›æ”¶çº¿ç¨‹æ•°å æ¯”å°±è¶Šå°ã€‚ä½†å¦‚æœ CPU æ•°é‡å¾ˆå°ï¼Œä¾‹å¦‚åªæœ‰ 2 ä¸ª CPUï¼Œåƒåœ¾å›æ”¶çº¿ç¨‹å ç”¨å°±è¾¾åˆ°äº† 50%ï¼Œè¿™æå¤§åœ°é™ä½ç³»ç»Ÿçš„ååé‡ï¼Œæ— æ³•æ¥å—ã€‚

â‘¡ã€CMS é‡‡ç”¨çš„æ˜¯ã€Œæ ‡è®°-æ¸…é™¤ã€ç®—æ³•ï¼Œä¼šäº§ç”Ÿå¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼Œå¯¼è‡´ç©ºé—´ä¸è¿ç»­ï¼Œå½“å‡ºç°å¤§å¯¹è±¡æ— æ³•æ‰¾åˆ°è¿ç»­çš„å†…å­˜ç©ºé—´æ—¶ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡ Full GCï¼Œè¿™ä¼šå¯¼è‡´ç³»ç»Ÿçš„åœé¡¿æ—¶é—´å˜é•¿ã€‚

â‘¢ã€CMS æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼Œå½“ CMS åœ¨è¿›è¡Œåƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œåº”ç”¨ç¨‹åºè¿˜åœ¨ä¸æ–­åœ°äº§ç”Ÿåƒåœ¾ï¼Œè¿™äº›åƒåœ¾ä¼šåœ¨ CMS åƒåœ¾å›æ”¶ç»“æŸä¹‹åäº§ç”Ÿï¼Œè¿™äº›åƒåœ¾å°±æ˜¯æµ®åŠ¨åƒåœ¾ï¼ŒCMS æ— æ³•å¤„ç†è¿™äº›æµ®åŠ¨åƒåœ¾ï¼Œåªèƒ½åœ¨ä¸‹ä¸€æ¬¡ GC æ—¶æ¸…ç†æ‰ã€‚

## åˆ†åŒºæ”¶é›†å™¨

### G1

G1ï¼ˆGarbage-First Garbage Collectorï¼‰åœ¨ JDK 1.7 æ—¶å¼•å…¥ï¼Œåœ¨ JDK 9 æ—¶å–ä»£ CMS æˆä¸ºäº†é»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨ã€‚G1 æœ‰äº”ä¸ªå±æ€§ï¼šåˆ†ä»£ã€å¢é‡ã€å¹¶è¡Œã€æ ‡è®°æ•´ç†ã€STWã€‚

â‘ ã€åˆ†ä»£ï¼šç›¸ä¿¡å¤§å®¶è¿˜è®°å¾—æˆ‘ä»¬[ä¸Šä¸€è®²ä¸­çš„å¹´è½»ä»£å’Œè€å¹´ä»£](https://javabetter.cn/jvm/gc.html)ï¼ŒG1 ä¹Ÿæ˜¯åŸºäºè¿™ä¸ªæ€æƒ³è¿›è¡Œè®¾è®¡çš„ã€‚å®ƒå°†å †å†…å­˜åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„åŒºåŸŸï¼ˆRegionï¼‰ï¼Œæ¯ä¸ªåŒºåŸŸéƒ½å¯ä»¥æ˜¯ Eden åŒºã€Survivor åŒºæˆ–è€… Old åŒºã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-collector-20231228213824.png)

å¯ä»¥é€šè¿‡ `-XX:G1HeapRegionSize=n` æ¥è®¾ç½® Region çš„å¤§å°ï¼Œå¯ä»¥è®¾å®šä¸º 1Mã€2Mã€4Mã€8Mã€16Mã€32Mï¼ˆä¸èƒ½è¶…è¿‡ï¼‰ã€‚

G1 æœ‰ä¸“é—¨åˆ†é…å¤§å¯¹è±¡çš„ Region å« Humongous åŒºï¼Œè€Œä¸æ˜¯è®©å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£çš„ Region ä¸­ã€‚åœ¨ G1 ä¸­ï¼Œå¤§å¯¹è±¡çš„åˆ¤å®šè§„åˆ™å°±æ˜¯ä¸€ä¸ªå¤§å¯¹è±¡è¶…è¿‡äº†ä¸€ä¸ª Region å¤§å°çš„ 50%ï¼Œæ¯”å¦‚æ¯ä¸ª Region æ˜¯ 2Mï¼Œåªè¦ä¸€ä¸ªå¯¹è±¡è¶…è¿‡äº† 1Mï¼Œå°±ä¼šè¢«æ”¾å…¥ Humongous ä¸­ï¼Œè€Œä¸”ä¸€ä¸ªå¤§å¯¹è±¡å¦‚æœå¤ªå¤§ï¼Œå¯èƒ½ä¼šæ¨ªè·¨å¤šä¸ª Region æ¥å­˜æ”¾ã€‚

G1 ä¼šæ ¹æ®å„ä¸ªåŒºåŸŸçš„åƒåœ¾å›æ”¶æƒ…å†µæ¥å†³å®šä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶çš„åŒºåŸŸï¼Œè¿™æ ·å°±é¿å…äº†å¯¹æ•´ä¸ªå †å†…å­˜è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œä»è€Œé™ä½äº†åƒåœ¾å›æ”¶çš„æ—¶é—´ã€‚

â‘¡ã€å¢é‡ï¼šG1 å¯ä»¥ä»¥å¢é‡æ–¹å¼æ‰§è¡Œåƒåœ¾å›æ”¶ï¼Œè¿™æ„å‘³ç€å®ƒä¸éœ€è¦ä¸€æ¬¡æ€§å›æ”¶æ•´ä¸ªå †ç©ºé—´ï¼Œè€Œæ˜¯å¯ä»¥é€æ­¥ã€å¢é‡åœ°æ¸…ç†ã€‚æœ‰åŠ©äºæ§åˆ¶åœé¡¿æ—¶é—´ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤§å‹å †æ—¶ã€‚

â‘¢ã€å¹¶è¡Œï¼šG1 åƒåœ¾å›æ”¶å™¨å¯ä»¥å¹¶è¡Œå›æ”¶åƒåœ¾ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥åˆ©ç”¨å¤šä¸ª CPU æ¥åŠ é€Ÿåƒåœ¾å›æ”¶çš„é€Ÿåº¦ï¼Œè¿™ä¸€ç‰¹æ€§åœ¨å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ï¼ˆMinor GCï¼‰ä¸­ç‰¹åˆ«æ˜æ˜¾ï¼Œå› ä¸ºå¹´è½»ä»£çš„å›æ”¶é€šå¸¸æ¶‰åŠè¾ƒå¤šçš„å¯¹è±¡å’Œè¾ƒé«˜çš„å›æ”¶é€Ÿç‡ã€‚

â‘£ã€æ ‡è®°æ•´ç†ï¼šåœ¨è¿›è¡Œè€å¹´ä»£çš„åƒåœ¾å›æ”¶æ—¶ï¼ŒG1 ä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚è¿™ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šæ ‡è®°å­˜æ´»çš„å¯¹è±¡å’Œæ•´ç†ï¼ˆå‹ç¼©ï¼‰å †ç©ºé—´ã€‚é€šè¿‡æ•´ç†ï¼ŒG1 èƒ½å¤Ÿé¿å…å†…å­˜ç¢ç‰‡åŒ–ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡ã€‚

å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ï¼ˆMinor GCï¼‰ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œå› ä¸ºå¹´è½»ä»£çš„å¯¹è±¡é€šå¸¸æ˜¯æœç”Ÿå¤•æ­»çš„ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-collector-20231230100404.png)

â‘¤ã€STWï¼šG1 ä¹Ÿæ˜¯åŸºäºã€Œæ ‡è®°-æ¸…é™¤ã€ç®—æ³•ï¼Œå› æ­¤åœ¨è¿›è¡Œåƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œä»ç„¶éœ€è¦ã€ŒStop the Worldã€ã€‚ä¸è¿‡ï¼ŒG1 åœ¨åœé¡¿æ—¶é—´ä¸Šæ·»åŠ äº†é¢„æµ‹æœºåˆ¶ï¼Œç”¨æˆ·å¯ä»¥æŒ‡å®šæœŸæœ›åœé¡¿æ—¶é—´ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-collector-20231228213622.png)

G1 ä¸­å­˜åœ¨ä¸‰ç§ GC æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯ Young GCã€Mixed GC å’Œ Full GCã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-collector-20231228215108.png)

å½“ Eden åŒºçš„å†…å­˜ç©ºé—´æ— æ³•æ”¯æŒæ–°å¯¹è±¡çš„å†…å­˜åˆ†é…æ—¶ï¼ŒG1 ä¼šè§¦å‘ Young GCã€‚

å½“éœ€è¦åˆ†é…å¯¹è±¡åˆ° Humongous åŒºåŸŸæˆ–è€…å †å†…å­˜çš„ç©ºé—´å æ¯”è¶…è¿‡ `-XX:G1HeapWastePercent` è®¾ç½®çš„ InitiatingHeapOccupancyPercent å€¼æ—¶ï¼ŒG1 ä¼šè§¦å‘ä¸€æ¬¡ concurrent markingï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯è®¡ç®—è€å¹´ä»£ä¸­æœ‰å¤šå°‘ç©ºé—´éœ€è¦è¢«å›æ”¶ï¼Œå½“å‘ç°åƒåœ¾çš„å æ¯”è¾¾åˆ° `-XX:G1HeapWastePercent` ä¸­æ‰€è®¾ç½®çš„ G1HeapWastePercent æ¯”ä¾‹æ—¶ï¼Œåœ¨ä¸‹æ¬¡ Young GC åä¼šè§¦å‘ä¸€æ¬¡ Mixed GCã€‚

Mixed GC æ˜¯æŒ‡å›æ”¶å¹´è½»ä»£çš„ Region ä»¥åŠä¸€éƒ¨åˆ†è€å¹´ä»£ä¸­çš„ Regionã€‚Mixed GC å’Œ Young GC ä¸€æ ·ï¼Œé‡‡ç”¨çš„ä¹Ÿæ˜¯å¤åˆ¶ç®—æ³•ã€‚

åœ¨ Mixed GC è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‘ç°è€å¹´ä»£ç©ºé—´è¿˜æ˜¯ä¸è¶³ï¼Œæ­¤æ—¶å¦‚æœ G1HeapWastePercent è®¾å®šè¿‡ä½ï¼Œå¯èƒ½å¼•å‘ Full GCã€‚`-XX:G1HeapWastePercent` é»˜è®¤æ˜¯ 5ï¼Œæ„å‘³ç€åªæœ‰ 5% çš„å †æ˜¯â€œæµªè´¹â€çš„ã€‚å¦‚æœæµªè´¹çš„å †çš„ç™¾åˆ†æ¯”å¤§äº G1HeapWastePercentï¼Œåˆ™è¿è¡Œ Full GCã€‚

åœ¨ä»¥ Region ä¸ºæœ€å°ç®¡ç†å•å…ƒä»¥åŠæ‰€é‡‡ç”¨çš„ GC æ¨¡å¼çš„åŸºç¡€ä¸Šï¼ŒG1 å»ºç«‹äº†åœé¡¿é¢„æµ‹æ¨¡å‹ï¼Œå³ Pause Prediction Model ã€‚è¿™ä¹Ÿæ˜¯ G1 éå¸¸è¢«äººæ‰€ç§°é“çš„ç‰¹æ€§ã€‚

æˆ‘ä»¬å¯ä»¥å€ŸåŠ© `-XX:MaxGCPauseMillis` æ¥è®¾ç½®æœŸæœ›çš„åœé¡¿æ—¶é—´ï¼ˆé»˜è®¤ 200msï¼‰ï¼ŒG1 ä¼šæ ¹æ®è¿™ä¸ªå€¼æ¥è®¡ç®—å‡ºä¸€ä¸ªåˆç†çš„ Young GC çš„å›æ”¶æ—¶é—´ï¼Œç„¶åæ ¹æ®è¿™ä¸ªæ—¶é—´æ¥åˆ¶å®š Young GC çš„å›æ”¶è®¡åˆ’ã€‚

### ZGC

ZGCï¼ˆThe Z Garbage Collectorï¼‰æ˜¯ JDK11 æ¨å‡ºçš„ä¸€æ¬¾ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨ï¼Œé€‚ç”¨äºå¤§å†…å­˜ä½å»¶è¿ŸæœåŠ¡çš„å†…å­˜ç®¡ç†å’Œå›æ”¶ï¼ŒSPEC jbb 2015 åŸºå‡†æµ‹è¯•ï¼Œåœ¨ 128G çš„å¤§å †ä¸‹ï¼Œæœ€å¤§åœé¡¿æ—¶é—´æ‰ 1.68 msï¼Œåœé¡¿æ—¶é—´è¿œèƒœäº G1 å’Œ CMSã€‚

ZGC çš„è®¾è®¡ç›®æ ‡æ˜¯ï¼šåœ¨ä¸è¶…è¿‡ 10ms çš„åœé¡¿æ—¶é—´ä¸‹ï¼Œæ”¯æŒ TB çº§çš„å†…å­˜å®¹é‡å’Œå‡ ä¹æ‰€æœ‰çš„ GC åŠŸèƒ½ï¼Œè¿™ä¹Ÿæ˜¯ ZGC åå­—çš„ç”±æ¥ï¼ŒZ ä»£è¡¨ç€ Zettabyteï¼Œä¹Ÿå°±æ˜¯ 1024EBï¼Œä¹Ÿå°±æ˜¯ 1TB çš„ 1024 å€ã€‚

ä¸è¿‡ï¼Œæˆ‘éœ€è¦å‘Šè¯‰å¤§å®¶çš„æ˜¯ï¼Œä¸Šé¢è¿™æ®µæ˜¯æˆ‘èƒ¡ç¼–çš„ï¼ˆğŸ˜‚ï¼‰ï¼ŒJDK å®˜æ–¹å¹¶æ²¡æœ‰æ˜ç¡®ç»™å‡º Z çš„å®šä¹‰ï¼Œå°±åƒå°ç±³æ±½è½¦ su7ï¼Œ7 ä¹Ÿæ˜¯ä¸ªé­”æ•°ï¼Œæ²¡æœ‰æ˜ç¡®çš„å®šä¹‰ã€‚

æ€»ä¹‹å°±æ˜¯ï¼ŒZGC å¾ˆç‰›é€¼ï¼Œå®ƒçš„ç›®æ ‡æ˜¯ï¼š

- åœé¡¿æ—¶é—´ä¸è¶…è¿‡ 10msï¼›
- åœé¡¿æ—¶é—´ä¸ä¼šéšç€å †çš„å¤§å°ï¼Œæˆ–è€…æ´»è·ƒå¯¹è±¡çš„å¤§å°è€Œå¢åŠ ï¼›
- æ”¯æŒ 8MB~4TB çº§åˆ«çš„å †ï¼Œæœªæ¥æ”¯æŒ 16TBã€‚

å‰é¢è®² G1 åƒåœ¾æ”¶é›†å™¨çš„æ—¶å€™æåˆ°è¿‡ï¼ŒYoung GC å’Œ Mixed GC å‡é‡‡ç”¨çš„æ˜¯[å¤åˆ¶ç®—æ³•](https://javabetter.cn/jvm/gc.html)ï¼Œå¤åˆ¶ç®—æ³•ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ 3 ä¸ªé˜¶æ®µï¼š

â‘ ã€æ ‡è®°é˜¶æ®µï¼Œä» GC Roots å¼€å§‹ï¼Œåˆ†æå¯¹è±¡å¯è¾¾æ€§ï¼Œæ ‡è®°å‡ºæ´»è·ƒå¯¹è±¡ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-collector-20231230101117.png)

â‘¡ã€å¯¹è±¡è½¬ç§»é˜¶æ®µï¼ŒæŠŠæ´»è·ƒå¯¹è±¡å¤åˆ¶åˆ°æ–°çš„å†…å­˜åœ°å€ä¸Šã€‚

â‘¢ã€é‡å®šä½é˜¶æ®µï¼Œå› ä¸ºè½¬ç§»å¯¼è‡´å¯¹è±¡åœ°å€å‘ç”Ÿäº†å˜åŒ–ï¼Œåœ¨é‡å®šä½é˜¶æ®µï¼Œæ‰€æœ‰æŒ‡å‘å¯¹è±¡æ—§åœ°å€çš„å¼•ç”¨éƒ½è¦è°ƒæ•´åˆ°å¯¹è±¡æ–°çš„åœ°å€ä¸Šã€‚

æ ‡è®°é˜¶æ®µå› ä¸ºåªæ ‡è®° GC Rootsï¼Œè€—æ—¶è¾ƒçŸ­ã€‚ä½†è½¬ç§»é˜¶æ®µå’Œé‡å®šä½é˜¶æ®µéœ€è¦å¤„ç†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ï¼Œè€—æ—¶è¾ƒé•¿ï¼Œå¹¶ä¸”è½¬ç§»é˜¶æ®µæ˜¯ STW çš„ï¼Œå› æ­¤ï¼ŒG1 çš„æ€§èƒ½ç“¶é¢ˆå°±ä¸»è¦å¡åœ¨è½¬ç§»é˜¶æ®µã€‚

ä¸ G1 å’Œ CMS ç±»ä¼¼ï¼ŒZGC ä¹Ÿé‡‡ç”¨äº†å¤åˆ¶ç®—æ³•ï¼Œåªä¸è¿‡åšäº†é‡å¤§ä¼˜åŒ–ï¼ŒZGC åœ¨æ ‡è®°ã€è½¬ç§»å’Œé‡å®šä½é˜¶æ®µå‡ ä¹éƒ½æ˜¯å¹¶å‘çš„ï¼Œè¿™æ˜¯ ZGC å®ç°åœé¡¿æ—¶é—´å°äº 10ms çš„å…³é”®æ‰€åœ¨ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-collector-20231230101805.png)

ZGC æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ

- æŒ‡é’ˆæŸ“è‰²ï¼ˆColored Pointerï¼‰ï¼šä¸€ç§ç”¨äºæ ‡è®°å¯¹è±¡çŠ¶æ€çš„æŠ€æœ¯ã€‚
- è¯»å±éšœï¼ˆLoad Barrierï¼‰ï¼šä¸€ç§åœ¨ç¨‹åºè¿è¡Œæ—¶æ’å…¥åˆ°å¯¹è±¡è®¿é—®æ“ä½œä¸­çš„ç‰¹æ®Šæ£€æŸ¥ï¼Œç”¨äºç¡®ä¿å¯¹è±¡è®¿é—®çš„æ­£ç¡®æ€§ã€‚

è¿™ä¸¤ç§æŠ€æœ¯å¯ä»¥è®©æ‰€æœ‰çº¿ç¨‹åœ¨å¹¶å‘çš„æ¡ä»¶ä¸‹å°±æŒ‡é’ˆçš„é¢œè‰² (çŠ¶æ€) è¾¾æˆä¸€è‡´ï¼Œè€Œä¸æ˜¯å¯¹è±¡åœ°å€ã€‚å› æ­¤ï¼ŒZGC å¯ä»¥å¹¶å‘çš„å¤åˆ¶å¯¹è±¡ï¼Œè¿™å¤§å¤§çš„é™ä½äº† GC çš„åœé¡¿æ—¶é—´ã€‚

#### æŒ‡é’ˆæŸ“è‰²

åœ¨ä¸€ä¸ªæŒ‡é’ˆä¸­ï¼Œé™¤äº†å­˜å‚¨å¯¹è±¡çš„å®é™…åœ°å€å¤–ï¼Œè¿˜æœ‰é¢å¤–çš„ä½è¢«ç”¨æ¥å­˜å‚¨å…³äºè¯¥å¯¹è±¡çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å¯èƒ½åŒ…æ‹¬ï¼š

- å¯¹è±¡æ˜¯å¦è¢«ç§»åŠ¨äº†ï¼ˆå³å®ƒæ˜¯å¦åœ¨å›æ”¶è¿‡ç¨‹ä¸­è¢«ç§»åŠ¨åˆ°äº†æ–°çš„ä½ç½®ï¼‰ã€‚
- å¯¹è±¡çš„å­˜æ´»çŠ¶æ€ã€‚
- å¯¹è±¡æ˜¯å¦è¢«é”å®šæˆ–æœ‰å…¶ä»–ç‰¹æ®ŠçŠ¶æ€ã€‚

é€šè¿‡åœ¨æŒ‡é’ˆä¸­åµŒå…¥è¿™äº›ä¿¡æ¯ï¼ŒZGC åœ¨æ ‡è®°å’Œè½¬ç§»é˜¶æ®µä¼šæ›´å¿«ï¼Œå› ä¸ºé€šè¿‡æŒ‡é’ˆä¸Šçš„é¢œè‰²å°±èƒ½åŒºåˆ†å‡ºå¯¹è±¡çŠ¶æ€ï¼Œä¸ç”¨é¢å¤–åšå†…å­˜è®¿é—®ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-collector-20231230104802.png)

- ç¬¬ 0~43 ä½å­˜å‚¨å¯¹è±¡åœ°å€ï¼Œ2^44 = 16TBï¼Œæ‰€ä»¥ ZGC æœ€å¤§æ”¯æŒ 16TB çš„å †ã€‚
- ç¬¬ 44~47 ä½ä½œä¸ºé¢œè‰²æ ‡å¿—ä½ï¼ŒMarked0ã€Marked1 å’Œ Remapped åˆ†åˆ«å¯¹åº”ä¸‰ä¸ªè§†å›¾ç©ºé—´ã€‚
- ç¬¬ 48~63 ä½å›ºå®šä¸º 0 æš‚æ—¶æ²¡æœ‰ä½¿ç”¨ã€‚

å†æ¥ç»†è‡´åœ°åˆ’åˆ†ä¸‹ 64 ä½åœ°å€ç©ºé—´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://cdn.tobebetterjavaer.com/stutymore/gc-collector-20231230104011.png)


å…¶ä¸­ï¼Œ0-4TB å¯¹åº” Java å †ï¼Œ4TB-8TB è¢«ç§°ä¸º M0 åœ°å€ç©ºé—´ï¼Œ8TB-12TB è¢«ç§°ä¸º M1 åœ°å€ç©ºé—´ï¼Œ12TB-16TB é¢„ç•™æœªä½¿ç”¨ï¼Œ16TB-20TB è¢«ç§°ä¸º Remapped ç©ºé—´ã€‚

å½“åˆ›å»ºå¯¹è±¡æ—¶ï¼Œé¦–å…ˆåœ¨å †ç©ºé—´ç”³è¯·ä¸€ä¸ªè™šæ‹Ÿåœ°å€ï¼Œè¯¥è™šæ‹Ÿåœ°å€å¹¶ä¸ä¼šæ˜ å°„åˆ°çœŸæ­£çš„ç‰©ç†åœ°å€ã€‚åŒæ—¶ï¼ŒZGC ä¼šåœ¨ M0ã€M1ã€Remapped ç©ºé—´ä¸­ä¸ºè¯¥å¯¹è±¡åˆ†åˆ«ç”³è¯·ä¸€ä¸ªè™šæ‹Ÿåœ°å€ï¼Œä¸”ä¸‰ä¸ªè™šæ‹Ÿåœ°å€éƒ½æ˜ å°„åˆ°åŒä¸€ä¸ªç‰©ç†åœ°å€ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-collector-20231230105830.png)

ä¸è¿‡ï¼Œä¸‰ä¸ªç©ºé—´åœ¨åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªç©ºé—´æœ‰æ•ˆã€‚ZGC ä¹‹æ‰€ä»¥è®¾ç½®è¿™ä¸‰ä¸ªè™šæ‹Ÿåœ°å€ï¼Œæ˜¯å› ä¸º ZGC é‡‡ç”¨çš„æ˜¯â€œç©ºé—´æ¢æ—¶é—´â€çš„æ€æƒ³ï¼Œå»é™ä½ GC çš„åœé¡¿æ—¶é—´ã€‚

#### è¯»å±éšœ

å½“ç¨‹åºå°è¯•è¯»å–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œè¯»å±éšœä¼šè§¦å‘ä»¥ä¸‹æ“ä½œï¼š

- æ£€æŸ¥æŒ‡é’ˆæŸ“è‰²ï¼šè¯»å±éšœé¦–å…ˆæ£€æŸ¥æŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆçš„é¢œè‰²ä¿¡æ¯ã€‚
- å¤„ç†ç§»åŠ¨çš„å¯¹è±¡ï¼šå¦‚æœæŒ‡é’ˆè¡¨ç¤ºå¯¹è±¡å·²ç»è¢«ç§»åŠ¨ï¼ˆä¾‹å¦‚ï¼Œåœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­ï¼‰ï¼Œè¯»å±éšœå°†ç¡®ä¿è¿”å›å¯¹è±¡çš„æ–°ä½ç½®ã€‚
- ç¡®ä¿ä¸€è‡´æ€§ï¼šé€šè¿‡è¿™ç§æ–¹å¼ï¼ŒZGC èƒ½å¤Ÿåœ¨å¹¶å‘ç§»åŠ¨å¯¹è±¡æ—¶ä¿æŒå†…å­˜è®¿é—®çš„ä¸€è‡´æ€§ï¼Œä»è€Œå‡å°‘å¯¹åº”ç”¨ç¨‹åºåœé¡¿çš„éœ€è¦ã€‚

å‚è€ƒèµ„æ–™ï¼š

> 1ã€æ ‘å“¥èŠç¼–ç¨‹ï¼š[CMS åƒåœ¾æ”¶é›†å™¨](https://mp.weixin.qq.com/s/V1utsm5Wn3uhV1QrATz4ag)
> 2ã€å†›å“¥èŠæŠ€æœ¯ï¼š[G1 åƒåœ¾æ”¶é›†å™¨](https://mp.weixin.qq.com/s/rVS5TBRU9QcnMNdBz6w_Mg)
> 3ã€ç¾å›¢æŠ€æœ¯ä¸“å®¶ï¼š[G1 GC çš„ä¸€äº›å…³é”®æŠ€æœ¯](https://tech.meituan.com/2016/09/23/g1.html)
> 4ã€æå®¢æ—¶é—´ï¼š[ä¸ºä»€ä¹ˆ G1 è¢«å«åš GC ä¸­çš„ç‹](https://time.geekbang.org/column/article/703481)
> 5ã€å¾—ç‰©æŠ€æœ¯ï¼š[ZGC å…³é”®æŠ€æœ¯åˆ†æ](https://mp.weixin.qq.com/s/W-RDY1mLDQG86hlLMNM0IQ)
> 6ã€ç¾å›¢æŠ€æœ¯ï¼š[ZGC çš„æ¢ç´¢ä¸å®è·µ](https://tech.meituan.com/2020/08/06/new-zgc-practice-in-meituan.html)
> 7ã€CoderWï¼š[ZGC åƒåœ¾æ”¶é›†å™¨](https://mp.weixin.qq.com/s/FIr6r2dcrm1pqZj5Bubbmw)

---

GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹](https://javabetter.cn/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)
