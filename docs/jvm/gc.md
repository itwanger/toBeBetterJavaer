---
title: æ·±å…¥ç†è§£ JVM çš„åƒåœ¾å›æ”¶æœºåˆ¶
shortTitle: æ·±å…¥ç†è§£åƒåœ¾å›æ”¶æœºåˆ¶
category:
  - Javaæ ¸å¿ƒ
tag:
  - Javaè™šæ‹Ÿæœº
description: æœ¬ç¯‡å†…å®¹æˆ‘ä»¬ä»å¤´åˆ°å°¾è®²äº†ä¸€é JVM çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼ŒåŒ…æ‹¬åƒåœ¾å›æ”¶çš„æ¦‚å¿µã€åƒåœ¾åˆ¤æ–­ç®—æ³•ã€åƒåœ¾æ”¶é›†ç®—æ³•ã€Stop The Worldã€æ–°ç”Ÿä»£å’Œè€å¹´ä»£ç­‰ç­‰ã€‚
head:
  - - meta
    - name: keywords
      content: Java,JavaSE,æ•™ç¨‹,äºŒå“¥çš„Javaè¿›é˜¶ä¹‹è·¯,jvm,Javaè™šæ‹Ÿæœº,åƒåœ¾å›æ”¶,gc,åƒåœ¾å›æ”¶æœºåˆ¶,åƒåœ¾å›æ”¶ç®—æ³•
---

# ç¬¬åèŠ‚ï¼šæ·±å…¥ç†è§£åƒåœ¾å›æ”¶æœºåˆ¶

è®°å¾—ä»¥å‰æœ‰è¿™æ ·ä¸€å‰¯åŠ¨å›¾ï¼Œç”¨æ¥å˜²ç¬‘ JVM çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå¤§è‡´çš„æ„æ€å°±æ˜¯ï¼ŒJVM çš„åƒåœ¾å›æ”¶æœºåˆ¶å¾ˆå·¥ä¸šåŒ–ï¼Œä½†æ˜¯å¥½åƒæ˜¯åœ¨åšæ— ç”¨åŠŸï¼Œåƒåœ¾å›æ”¶ä¸å½»åº•ï¼ˆğŸ˜‚ï¼‰ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-gc.gif)

C/C++ è™½ç„¶éœ€è¦æ‰‹åŠ¨é‡Šæ”¾å†…å­˜ï¼Œä½†å¼€å‘è€…ä¿¡èª“æ—¦æ—¦ï¼Œè®¤ä¸ºè‡ªå·±ä¸€å®šèƒ½æ¸…ç†å¾—å¾ˆå½»åº•ã€‚é‚£è¿™æ¬¡ï¼Œæˆ‘ä»¬å°±ä»å¤´åˆ°å°¾æ¥è¯¦ç»†åœ°èŠä¸€èŠ JVM çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œçœ‹çœ‹åˆ°åº•å¦‚ä½•ã€‚

## åƒåœ¾å›æ”¶çš„æ¦‚å¿µ

åƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼ŒGCï¼‰ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯é‡Šæ”¾åƒåœ¾å ç”¨çš„ç©ºé—´ï¼Œé˜²æ­¢å†…å­˜çˆ†æ‰ã€‚æœ‰æ•ˆçš„ä½¿ç”¨å¯ä»¥ä½¿ç”¨çš„å†…å­˜ï¼Œå¯¹å†…å­˜[å †](https://javabetter.cn/jvm/neicun-jiegou.html)ä¸­å·²ç»æ­»äº¡çš„æˆ–è€…é•¿æ—¶é—´æ²¡æœ‰ä½¿ç”¨çš„å¯¹è±¡è¿›è¡Œæ¸…é™¤å’Œå›æ”¶ã€‚

Java è¯­è¨€å‡ºæ¥ä¹‹å‰ï¼Œå¤§å®¶éƒ½åœ¨æ‹¼å‘½çš„å†™ C æˆ–è€… C++ çš„ç¨‹åºï¼Œè€Œæ­¤æ—¶å­˜åœ¨ä¸€ä¸ªå¾ˆå¤§çš„çŸ›ç›¾ï¼ŒC++ ç­‰è¯­è¨€åˆ›å»ºå¯¹è±¡è¦ä¸æ–­çš„å»å¼€è¾Ÿç©ºé—´ï¼Œä¸ç”¨çš„æ—¶å€™åˆéœ€è¦ä¸æ–­çš„å»é‡Šæ”¾ç©ºé—´ï¼Œæ—¢è¦å†™æ„é€ å‡½æ•°ï¼Œåˆè¦å†™ææ„å‡½æ•°ã€‚

> æ„é€ å‡½æ•°å’Œ Java ä¸­çš„æ„é€ æ–¹æ³•ç±»ä¼¼ï¼Œç”¨æ¥åˆ›å»ºå¯¹è±¡ï¼Œææ„å‡½æ•°å’Œ Java ä¸­çš„ finalize æ–¹æ³•æœ‰ä¸€ç‚¹ç±»ä¼¼ï¼Œå¯ä»¥åœ¨å¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ä¹‹å‰æ‰§è¡Œæ¸…ç†æ“ä½œï¼Œä½†ä¸æ¨èï¼Œå› ä¸º finalize çš„æ‰§è¡Œæ—¶æœºå¹¶ä¸ç¡®å®šã€‚

äºæ˜¯ï¼Œæœ‰äººå°±æå‡ºï¼Œèƒ½ä¸èƒ½å†™ä¸€æ®µç¨‹åºå®ç°è¿™å—åŠŸèƒ½ï¼Œæ¯æ¬¡åˆ›å»ºå¯¹è±¡ã€é‡Šæ”¾å†…å­˜ç©ºé—´çš„æ—¶å€™å¤ç”¨è¿™æ®µä»£ç ï¼Ÿ

ç‰›äººè¿˜æ˜¯å¤šå•Šï¼Œ1960 å¹´ï¼ŒåŸºäº MIT çš„ Lisp é¦–å…ˆæå‡ºäº†åƒåœ¾å›æ”¶çš„æ¦‚å¿µï¼Œç”¨äºå¤„ç† C è¯­è¨€ç­‰ä¸åœçš„ææ„æ“ä½œï¼ŒJava çš„åƒåœ¾å›æ”¶æœºåˆ¶ç®—æ˜¯å‘æ‰¬å…‰å¤§äº†ã€‚

> [Lisp](https://lisp-lang.org/) æ˜¯ä¸€ç§å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ï¼Œæˆ‘ä»å®˜ç½‘ä¸Šæˆªå¹…å›¾å¤§å®¶æ„Ÿå—ä¸‹ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-20231227094028.png)

## åƒåœ¾åˆ¤æ–­ç®—æ³•

æ—¢ç„¶ JVM è¦åšåƒåœ¾å›æ”¶ï¼Œå°±è¦ææ¸…æ¥šä»€ä¹ˆæ˜¯åƒåœ¾ï¼Œä»€ä¹ˆä¸æ˜¯åƒåœ¾ã€‚é€šå¸¸ä¼šæœ‰è¿™ä¹ˆå‡ ç§ç®—æ³•æ¥ç¡®å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯åƒåœ¾ï¼Œè¿™å—ä¹Ÿæ˜¯é¢è¯•å½“ä¸­å¸¸è€ƒçš„ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œå¤§å®¶ä¸€å®šè¦æŒæ¡ã€‚

- å¼•ç”¨è®¡æ•°ç®—æ³•
- å¯è¾¾æ€§åˆ†æç®—æ³•
- åˆ†ä»£æ”¶é›†ç®—æ³•
- å¤åˆ¶ç®—æ³•

### å¼•ç”¨è®¡æ•°ç®—æ³•

å¼•ç”¨è®¡æ•°ç®—æ³•ï¼ˆReachability Countingï¼‰æ˜¯é€šè¿‡åœ¨å¯¹è±¡å¤´ä¸­åˆ†é…ä¸€ä¸ªç©ºé—´æ¥ä¿å­˜è¯¥å¯¹è±¡è¢«å¼•ç”¨çš„æ¬¡æ•°ï¼ˆReference Countï¼‰ã€‚

å¦‚æœè¯¥å¯¹è±¡è¢«å…¶å®ƒå¯¹è±¡å¼•ç”¨ï¼Œåˆ™å®ƒçš„å¼•ç”¨è®¡æ•°åŠ  1ï¼Œå¦‚æœåˆ é™¤å¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒçš„å¼•ç”¨è®¡æ•°å°±å‡ 1ï¼Œå½“è¯¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º 0 æ—¶ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å°±ä¼šè¢«å›æ”¶ã€‚

```java
String s = new String("æ²‰é»˜ç‹äºŒ");
```

æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ª[å­—ç¬¦ä¸²](https://javabetter.cn/string/string-source.html)ï¼Œè¿™æ—¶å€™"æ²‰é»˜ç‹äºŒ"æœ‰ä¸€ä¸ªå¼•ç”¨ï¼Œå°±æ˜¯ sã€‚æ­¤æ—¶ Reference Count ä¸º 1ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-20231227095408.png)

ç„¶åå°† s è®¾ç½®ä¸º nullã€‚

```java
s = null;
```

è¿™æ—¶å€™"æ²‰é»˜ç‹äºŒ"çš„å¼•ç”¨æ¬¡æ•°å°±ç­‰äº 0 äº†ï¼Œåœ¨å¼•ç”¨è®¡æ•°ç®—æ³•ä¸­ï¼Œæ„å‘³ç€è¿™å—å†…å®¹å°±éœ€è¦è¢«å›æ”¶äº†ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-20231227095728.png)

å¼•ç”¨è®¡æ•°ç®—æ³•å°†åƒåœ¾å›æ”¶åˆ†æ‘Šåˆ°æ•´ä¸ªåº”ç”¨ç¨‹åºçš„è¿è¡Œå½“ä¸­ï¼Œè€Œä¸æ˜¯é›†ä¸­åœ¨åƒåœ¾æ”¶é›†æ—¶ã€‚å› æ­¤ï¼Œé‡‡ç”¨å¼•ç”¨è®¡æ•°çš„åƒåœ¾æ”¶é›†ä¸å±äºä¸¥æ ¼æ„ä¹‰ä¸Šçš„"Stop-The-World"çš„åƒåœ¾æ”¶é›†æœºåˆ¶ï¼ˆéšåæˆ‘ä»¬ä¼šç»†è®²ï¼‰ã€‚

å¼•ç”¨è®¡æ•°ç®—æ³•çœ‹ä¼¼å¾ˆç¾å¥½ï¼Œä½†å®é™…ä¸Šå®ƒå­˜åœ¨ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯æ— æ³•è§£å†³å¾ªç¯ä¾èµ–çš„é—®é¢˜ã€‚æ¥çœ‹ä¸‹é¢çš„ä»£ç ã€‚

```java
public class ReferenceCountingGC {

    public Object instance;  // å¯¹è±¡å±æ€§ï¼Œç”¨äºå­˜å‚¨å¯¹å¦ä¸€ä¸ª ReferenceCountingGC å¯¹è±¡çš„å¼•ç”¨

    public ReferenceCountingGC(String name) {
        // æ„é€ æ–¹æ³•
    }

    public static void testGC() {
        // åˆ›å»ºä¸¤ä¸ª ReferenceCountingGC å¯¹è±¡
        ReferenceCountingGC a = new ReferenceCountingGC("æ²‰é»˜ç‹äºŒ");
        ReferenceCountingGC b = new ReferenceCountingGC("æ²‰é»˜ç‹ä¸‰");

        // ä½¿ a å’Œ b ç›¸äº’å¼•ç”¨
        a.instance = b;
        b.instance = a;

        // å°† a å’Œ b è®¾ç½®ä¸º null
        a = null;
        b = null;

        // è¿™ä¸ªä½ç½®æ˜¯åƒåœ¾å›æ”¶çš„è§¦å‘ç‚¹
    }
}
```

ä»£ç ä¸­åˆ›å»ºäº†ä¸¤ä¸ª ReferenceCountingGC å¯¹è±¡ a å’Œ bã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-20231227103018.png)

ç„¶åä½¿å®ƒä»¬ç›¸äº’å¼•ç”¨ã€‚æ¥ç€ï¼Œå°†è¿™ä¸¤ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¾ç½®ä¸º nullï¼Œç†è®ºä¸Šå®ƒä»¬ä¼šåœ¨æ¥ä¸‹æ¥è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚ä½†ç”±äºå®ƒä»¬ç›¸äº’å¼•ç”¨ç€å¯¹æ–¹ï¼Œå¯¼è‡´å®ƒä»¬çš„å¼•ç”¨è®¡æ•°æ°¸è¿œéƒ½ä¸ä¼šä¸º 0ï¼Œé€šè¿‡å¼•ç”¨è®¡æ•°ç®—æ³•ï¼Œä¹Ÿå°±æ°¸è¿œæ— æ³•é€šçŸ¥ GC æ”¶é›†å™¨å›æ”¶å®ƒä»¬ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-20231227103102.png)


### å¯è¾¾æ€§åˆ†æç®—æ³•

å¯è¾¾æ€§åˆ†æç®—æ³•ï¼ˆReachability Analysisï¼‰çš„åŸºæœ¬æ€è·¯æ˜¯ï¼Œé€šè¿‡ä¸€äº›è¢«ç§°ä¸ºå¼•ç”¨é“¾ï¼ˆGC Rootsï¼‰çš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œç„¶åå‘ä¸‹æœç´¢ï¼Œæœç´¢èµ°è¿‡çš„è·¯å¾„è¢«ç§°ä¸ºï¼ˆReference Chainï¼‰ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ° GC Roots ä¹‹é—´æ²¡æœ‰ä»»ä½•å¼•ç”¨ç›¸è¿æ—¶ï¼Œå³ä» GC Roots åˆ°è¯¥å¯¹è±¡èŠ‚ç‚¹ä¸å¯è¾¾ï¼Œåˆ™è¯æ˜è¯¥å¯¹è±¡æ˜¯éœ€è¦åƒåœ¾æ”¶é›†çš„ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-20231227104036.png)

é€šè¿‡å¯è¾¾æ€§ç®—æ³•ï¼ŒæˆåŠŸè§£å†³äº†å¼•ç”¨è®¡æ•°æ— æ³•è§£å†³çš„é—®é¢˜-â€œå¾ªç¯ä¾èµ–â€ï¼Œåªè¦ä½ æ— æ³•ä¸ GC Root å»ºç«‹ç›´æ¥æˆ–é—´æ¥çš„è¿æ¥ï¼Œç³»ç»Ÿå°±ä¼šåˆ¤å®šä½ ä¸ºå¯å›æ”¶å¯¹è±¡ã€‚

åœ¨ Java è¯­è¨€ä¸­ï¼Œå¯ä½œä¸º GC Root çš„å¯¹è±¡åŒ…æ‹¬ä»¥ä¸‹ 4 ç§ï¼š

- è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡
- æœ¬åœ°æ–¹æ³•æ ˆå¼•ç”¨çš„å¯¹è±¡
- ç±»é™æ€å˜é‡å¼•ç”¨çš„å¯¹è±¡
- å¸¸é‡å¼•ç”¨çš„å¯¹è±¡

å¤§å®¶å¯ä»¥å›æƒ³ä¸€ä¸‹æˆ‘ä»¬å‰é¢è®²è¿‡çš„[JVM è¿è¡Œæ—¶æ•°æ®åŒº](https://javabetter.cn/jvm/neicun-jiegou.html)ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/neicun-jiegou-20231227111238.png)

#### 1ã€è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡

æ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼š

```java
public class StackLocalParameter {
    // æ„é€ æ–¹æ³•
    public StackLocalParameter(String name) {}

    public static void testGC() {
        // åˆ›å»ºä¸€ä¸ª StackLocalParameter å¯¹è±¡ï¼Œå¼•ç”¨å­˜å‚¨åœ¨æ ˆä¸Šï¼Œå¯¹è±¡åœ¨å †ä¸Š
        StackLocalParameter s = new StackLocalParameter("localParameter");

        // å°†å¼•ç”¨ s è®¾ç½®ä¸º nullï¼Œä½¿ StackLocalParameter å¯¹è±¡æˆä¸ºåƒåœ¾å›æ”¶çš„å€™é€‰å¯¹è±¡
        s = null;

        // æ­¤æ—¶ï¼Œåƒåœ¾å›æ”¶å™¨å¯ä»¥å›æ”¶ä¹‹å‰åˆ›å»ºçš„ StackLocalParameter å¯¹è±¡ï¼Œ
        // å› ä¸ºå®ƒä¸å†æœ‰ä»»ä½•å¼ºå¼•ç”¨æŒ‡å‘å®ƒ
    }
}
```

è¿™ä¸ªä»£ç ç‰‡æ®µä¸»è¦å±•ç¤ºäº† Java ä¸­å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸå’Œåƒåœ¾å›æ”¶æœºåˆ¶ã€‚å½“å±€éƒ¨å˜é‡ï¼ˆå¦‚è¿™é‡Œçš„ sï¼‰ä¸å†æŒ‡å‘ä»»ä½•å¯¹è±¡ï¼Œæˆ–è€…å˜é‡æœ¬èº«ç¦»å¼€äº†ä½œç”¨åŸŸï¼Œå®ƒæŒ‡å‘çš„å¯¹è±¡å°±å¯ä»¥è¢«è§†ä¸ºåƒåœ¾å›æ”¶çš„å€™é€‰å¯¹è±¡ã€‚

>å±€éƒ¨å˜é‡çš„å¼•ç”¨å­˜å‚¨åœ¨è™šæ‹Ÿæœºæ ˆä¸­ï¼Œè€Œå¯¹è±¡å­˜å‚¨åœ¨å †ä¸­ã€‚

#### 2ã€æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡

æ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼š

```java
public class NativeExample {
    private native void nativeMethod(Object obj);

    public void exampleMethod() {
        Object myObject = new Object();

        // è°ƒç”¨æœ¬åœ°æ–¹æ³•ï¼Œä¼ é€’å¯¹è±¡
        nativeMethod(myObject);

        // å³ä½¿åœ¨ Java ä»£ç ä¸­ä¸å†ä½¿ç”¨ myObjectï¼Œ
        // åªè¦ nativeMethod è¿˜æŒæœ‰å®ƒçš„å¼•ç”¨ï¼Œå®ƒå°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶ã€‚
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒnativeMethod æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œå®ƒä» Java ä»£ç ä¸­æ¥æ”¶ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ã€‚å³ä½¿ Java æ–¹æ³• exampleMethod å®Œæˆäº†å¯¹ myObject çš„ä½¿ç”¨ï¼Œåªè¦æœ¬åœ°æ–¹æ³• nativeMethod è¿˜åœ¨æ‰§è¡Œå¹¶ä¸”æŒæœ‰å¯¹ myObject çš„å¼•ç”¨ï¼ŒmyObject å°±ä¸ä¼šè¢«å›æ”¶ã€‚

æŠŠæœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ä½œä¸º GC Rootï¼Œæ˜¯ JVM ä¿è¯ Java ä¸æœ¬åœ°ä»£ç äº¤äº’æ—¶å†…å­˜å®‰å…¨çš„ä¸€ä¸ªå…³é”®æœºåˆ¶ã€‚

#### 3ã€ç±»é™æ€å˜é‡å¼•ç”¨çš„å¯¹è±¡

æ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼š

```java
public class MethodAreaStaicProperties {
    // é™æ€å˜é‡çš„å¼•ç”¨ m å­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼ˆJDK8 ä»¥åçš„å…ƒç©ºé—´ï¼‰
    public static MethodAreaStaicProperties m;

    // æ„é€ æ–¹æ³•
    public MethodAreaStaicProperties(String name) {}

    public static void testGC() {
        // åˆ›å»ºä¸€ä¸ª MethodAreaStaicProperties å®ä¾‹
        MethodAreaStaicProperties s = new MethodAreaStaicProperties("properties");

        // é€šè¿‡å®ä¾‹ s è®¾ç½®é™æ€å˜é‡ m çš„å€¼
        // æ­¤æ—¶ï¼Œm æŒ‡å‘å †ä¸Šçš„ä¸€ä¸ªæ–° MethodAreaStaicProperties å®ä¾‹
        s.m = new MethodAreaStaicProperties("parameter");

        // å°† s ç½®ä¸º null
        // æ­¤æ—¶ï¼Œs æŒ‡å‘çš„å¯¹è±¡å¯ä»¥è¢«åƒåœ¾å›æ”¶ï¼Œä½†é™æ€å˜é‡ m æŒ‡å‘çš„å¯¹è±¡ä¸ä¼šè¢«å›æ”¶
        s = null;

        // è™½ç„¶ s è¢«ç½®ä¸º nullï¼Œä½† m ä½œä¸ºé™æ€å˜é‡ï¼Œä»ç„¶å¼•ç”¨ç€ä¸€ä¸ª MethodAreaStaicProperties å®ä¾‹
        // å› æ­¤ï¼Œè¿™ä¸ªç”± m å¼•ç”¨çš„å¯¹è±¡ä¸ä¼šè¢«åƒåœ¾å›æ”¶
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œé™æ€å˜é‡ m æŒ‡å‘å †ä¸Šçš„ä¸€ä¸ª MethodAreaStaicProperties å®ä¾‹ã€‚å³ä½¿ s è¢«ç½®ä¸º nullï¼Œä½† m ä»ç„¶å¼•ç”¨ç€ä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œå› æ­¤ m å¼•ç”¨çš„å¯¹è±¡ä¸ä¼šè¢«åƒåœ¾å›æ”¶ã€‚

>é™æ€å˜é‡çš„å¼•ç”¨é€šå¸¸å­˜å‚¨åœ¨å…ƒç©ºé—´ï¼Œè€Œå¯¹è±¡ä»ç„¶å­˜å‚¨åœ¨å †ä¸­ã€‚

#### 3ã€å¸¸é‡å¼•ç”¨çš„å¯¹è±¡

æ¥çœ‹è¿™æ®µä»£ç ï¼š

```java
public class MethodAreaStaicProperties {
    // å¸¸é‡ m çš„å¼•ç”¨å­˜å‚¨åœ¨æ–¹æ³•åŒºï¼ˆJDK8 ä»¥åå…ƒç©ºé—´ï¼‰
    public static final MethodAreaStaicProperties m = new MethodAreaStaicProperties("final");

    // æ„é€ æ–¹æ³•
    public MethodAreaStaicProperties(String name) {}

    public static void testGC() {
        // åˆ›å»º MethodAreaStaicProperties ç±»çš„å®ä¾‹
        MethodAreaStaicProperties s = new MethodAreaStaicProperties("staticProperties");

        // å°†å¼•ç”¨ s è®¾ç½®ä¸º nullï¼Œè¿™ä½¿å¾— s æŒ‡å‘çš„å¯¹è±¡æˆä¸ºåƒåœ¾å›æ”¶çš„å€™é€‰å¯¹è±¡
        s = null;

        // å¸¸é‡ m çš„å¯¹è±¡ä¸ä¼šè¢«å›æ”¶
    }
}
```

å¸¸é‡ m åº”ç”¨çš„å¯¹è±¡å’Œ testGC æ–¹æ³•ä¸­çš„ s å…¶å®ä¸å­˜åœ¨å…³ç³»ï¼Œæ‰€ä»¥å±€éƒ¨å˜é‡ s å¼•ç”¨çš„å¯¹è±¡å›æ”¶å’Œå…¶æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚

## Stop The World

"Stop The World"æ˜¯ Java åƒåœ¾æ”¶é›†ä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚åœ¨åƒåœ¾æ”¶é›†è¿‡ç¨‹ä¸­ï¼ŒJVM ä¼šæš‚åœæ‰€æœ‰çš„ç”¨æˆ·çº¿ç¨‹ï¼Œè¿™ç§æš‚åœè¢«ç§°ä¸º"Stop The World"äº‹ä»¶ã€‚

è¿™ä¹ˆåšçš„ä¸»è¦åŸå› æ˜¯ä¸ºäº†é˜²æ­¢åœ¨åƒåœ¾æ”¶é›†è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·çº¿ç¨‹ä¿®æ”¹äº†å †ä¸­çš„å¯¹è±¡ï¼Œå¯¼è‡´åƒåœ¾æ”¶é›†å™¨æ— æ³•å‡†ç¡®åœ°æ”¶é›†åƒåœ¾ã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ"Stop The World"äº‹ä»¶ä¼šå¯¹ Java åº”ç”¨çš„æ€§èƒ½äº§ç”Ÿå½±å“ã€‚å¦‚æœåœé¡¿æ—¶é—´è¿‡é•¿ï¼Œå°±ä¼šå¯¼è‡´åº”ç”¨çš„å“åº”æ—¶é—´å˜é•¿ï¼Œå¯¹äºå¯¹å®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„åº”ç”¨ï¼Œå¦‚äº¤æ˜“ç³»ç»Ÿã€æ¸¸æˆæœåŠ¡å™¨ç­‰ï¼Œè¿™ç§æƒ…å†µæ˜¯ä¸èƒ½æ¥å—çš„ã€‚

å› æ­¤ï¼Œåœ¨é€‰æ‹©å’Œè°ƒä¼˜åƒåœ¾æ”¶é›†å™¨æ—¶ï¼Œéœ€è¦è€ƒè™‘å…¶åœé¡¿æ—¶é—´ã€‚Java ä¸­çš„ä¸€äº›åƒåœ¾æ”¶é›†å™¨ï¼Œå¦‚ G1 å’Œ ZGCï¼Œéƒ½ä¼šå°½å¯èƒ½åœ°å‡å°‘äº†"Stop The World"çš„æ—¶é—´ï¼Œé€šè¿‡å¹¶å‘çš„åƒåœ¾æ”¶é›†ï¼Œæé«˜åº”ç”¨çš„å“åº”æ€§èƒ½ã€‚

æ€»çš„æ¥è¯´ï¼Œ"Stop The World"æ˜¯ Java åƒåœ¾æ”¶é›†ä¸­å¿…é¡»é¢å¯¹çš„ä¸€ä¸ªæŒ‘æˆ˜ï¼Œå…¶ç›®æ ‡æ˜¯åœ¨ä¿è¯å†…å­˜çš„æœ‰æ•ˆåˆ©ç”¨å’Œåº”ç”¨çš„å“åº”æ€§èƒ½ä¹‹é—´æ‰¾åˆ°ä¸€ä¸ªå¹³è¡¡ã€‚

## åƒåœ¾æ”¶é›†ç®—æ³•

åœ¨ç¡®å®šäº†å“ªäº›åƒåœ¾å¯ä»¥è¢«å›æ”¶åï¼Œåƒåœ¾æ”¶é›†å™¨è¦åšçš„äº‹æƒ…å°±æ˜¯è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œä½†æ˜¯è¿™é‡Œé¢æ¶‰åŠåˆ°ä¸€ä¸ªé—®é¢˜æ˜¯ï¼š**å¦‚ä½•é«˜æ•ˆåœ°è¿›è¡Œåƒåœ¾å›æ”¶**ã€‚ç”±äº JVM è§„èŒƒå¹¶æ²¡æœ‰å¯¹å¦‚ä½•å®ç°åƒåœ¾æ”¶é›†å™¨åšå‡ºæ˜ç¡®çš„è§„å®šï¼Œå› æ­¤å„ä¸ªå‚å•†çš„è™šæ‹Ÿæœºå¯ä»¥é‡‡ç”¨ä¸åŒçš„æ–¹å¼æ¥å®ç°åƒåœ¾æ”¶é›†å™¨ï¼Œè¿™é‡Œæˆ‘ä»¬è®¨è®ºå‡ ç§å¸¸è§çš„åƒåœ¾æ”¶é›†ç®—æ³•ã€‚

### æ ‡è®°æ¸…é™¤ç®—æ³•

æ ‡è®°æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰æ˜¯æœ€åŸºç¡€çš„ä¸€ç§åƒåœ¾å›æ”¶ç®—æ³•ï¼Œå®ƒåˆ†ä¸º 2 éƒ¨åˆ†ï¼Œå…ˆæŠŠå†…å­˜åŒºåŸŸä¸­çš„è¿™äº›å¯¹è±¡è¿›è¡Œæ ‡è®°ï¼Œå“ªäº›å±äºå¯å›æ”¶çš„æ ‡è®°å‡ºæ¥ï¼ˆç”¨å‰é¢æåˆ°çš„å¯è¾¾æ€§åˆ†ææ³•ï¼‰ï¼Œç„¶åæŠŠè¿™äº›åƒåœ¾æ‹å‡ºæ¥æ¸…ç†æ‰ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-20231227125304.png)

å°±åƒä¸Šå›¾ä¸€æ ·ï¼Œæ¸…ç†æ‰çš„åƒåœ¾å°±å˜æˆå¯ä½¿ç”¨çš„ç©ºé—²ç©ºé—´ï¼Œç­‰å¾…è¢«å†æ¬¡ä½¿ç”¨ã€‚é€»è¾‘æ¸…æ™°ï¼Œå¹¶ä¸”ä¹Ÿå¾ˆå¥½æ“ä½œï¼Œä½†å®ƒå­˜åœ¨ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯å†…å­˜ç¢ç‰‡ã€‚ç¢ç‰‡å¤ªå¤šå¯èƒ½ä¼šå¯¼è‡´å½“ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦åˆ†é…è¾ƒå¤§å¯¹è±¡æ—¶ï¼Œå› æ— æ³•æ‰¾åˆ°è¶³å¤Ÿçš„è¿ç»­å†…å­˜è€Œä¸å¾—ä¸æå‰è§¦å‘æ–°ä¸€è½®çš„åƒåœ¾æ”¶é›†ã€‚

### å¤åˆ¶ç®—æ³•

å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰æ˜¯åœ¨æ ‡è®°æ¸…é™¤ç®—æ³•ä¸Šæ¼”åŒ–è€Œæ¥çš„ï¼Œç”¨äºè§£å†³æ ‡è®°æ¸…é™¤ç®—æ³•çš„å†…å­˜ç¢ç‰‡é—®é¢˜ã€‚å®ƒå°†å¯ç”¨å†…å­˜æŒ‰å®¹é‡åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—ã€‚

å½“è¿™ä¸€å—çš„å†…å­˜ç”¨å®Œäº†ï¼Œå°±å°†è¿˜å­˜æ´»ç€çš„å¯¹è±¡å¤åˆ¶åˆ°å¦å¤–ä¸€å—ä¸Šé¢ï¼Œç„¶åå†æŠŠå·²ä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ã€‚è¿™æ ·å°±ä¿è¯äº†å†…å­˜çš„è¿ç»­æ€§ï¼Œé€»è¾‘æ¸…æ™°ï¼Œè¿è¡Œé«˜æ•ˆã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-20231227125751.png)

ä½†å¤åˆ¶ç®—æ³•ä¹Ÿå­˜åœ¨ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„é—®é¢˜ï¼Œåˆç€æˆ‘è¿™ 190 å¹³çš„å¤§å››å®¤ï¼Œåªèƒ½å½“ 90 å¹³ç±³çš„å°ä¸¤å®¤æ¥å±…ä½ï¼Ÿä»£ä»·å®åœ¨å¤ªé«˜ã€‚

### æ ‡è®°æ•´ç†ç®—æ³•

æ ‡è®°æ•´ç†ç®—æ³•ï¼ˆMark-Compactï¼‰ï¼Œæ ‡è®°è¿‡ç¨‹ä»ç„¶ä¸æ ‡è®°æ¸…é™¤ç®—æ³•ä¸€æ ·ï¼Œä½†åç»­æ­¥éª¤ä¸æ˜¯ç›´æ¥å¯¹å¯å›æ”¶å¯¹è±¡è¿›è¡Œæ¸…ç†ï¼Œè€Œæ˜¯è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œå†æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜åŒºåŸŸã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-20231227130011.png)

æ ‡è®°æ•´ç†ç®—æ³•ä¸€æ–¹é¢åœ¨æ ‡è®°-æ¸…é™¤ç®—æ³•ä¸Šåšäº†å‡çº§ï¼Œè§£å†³äº†å†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œä¹Ÿè§„é¿äº†å¤åˆ¶ç®—æ³•åªèƒ½åˆ©ç”¨ä¸€åŠå†…å­˜åŒºåŸŸçš„å¼Šç«¯ã€‚çœ‹èµ·æ¥å¾ˆç¾å¥½ï¼Œä½†å†…å­˜å˜åŠ¨æ›´é¢‘ç¹ï¼Œéœ€è¦æ•´ç†æ‰€æœ‰å­˜æ´»å¯¹è±¡çš„å¼•ç”¨åœ°å€ï¼Œåœ¨æ•ˆç‡ä¸Šæ¯”å¤åˆ¶ç®—æ³•å·®å¾ˆå¤šã€‚

### åˆ†ä»£æ”¶é›†ç®—æ³•

åˆ†ä»£æ”¶é›†ç®—æ³•ï¼ˆGenerational Collectionï¼‰ä¸¥æ ¼æ¥è¯´å¹¶ä¸æ˜¯ä¸€ç§æ€æƒ³æˆ–ç†è®ºï¼Œè€Œæ˜¯èåˆä¸Šè¿° 3 ç§åŸºç¡€çš„ç®—æ³•æ€æƒ³ï¼Œè€Œäº§ç”Ÿçš„é’ˆå¯¹ä¸åŒæƒ…å†µæ‰€é‡‡ç”¨ä¸åŒç®—æ³•çš„ä¸€å¥—ç»„åˆæ‹³ã€‚

å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œä¸€èˆ¬æ˜¯æŠŠ Java å †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹é‡‡ç”¨æœ€é€‚å½“çš„æ”¶é›†ç®—æ³•ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-20231227131241.png)

åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œæ¯æ¬¡åƒåœ¾æ”¶é›†æ—¶éƒ½å‘ç°æœ‰å¤§æ‰¹å¯¹è±¡æ­»å»ï¼Œåªæœ‰å°‘é‡å­˜æ´»ï¼Œé‚£å°±é€‰ç”¨å¤åˆ¶ç®—æ³•ï¼Œåªéœ€è¦ä»˜å‡ºå°‘é‡å­˜æ´»å¯¹è±¡çš„å¤åˆ¶æˆæœ¬å°±å¯ä»¥å®Œæˆæ”¶é›†ã€‚

è€å¹´ä»£ä¸­å› ä¸ºå¯¹è±¡å­˜æ´»ç‡é«˜ã€æ²¡æœ‰é¢å¤–ç©ºé—´å¯¹å®ƒè¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œå°±å¿…é¡»ä½¿ç”¨æ ‡è®°æ¸…ç†æˆ–è€…æ ‡è®°æ•´ç†ç®—æ³•æ¥è¿›è¡Œå›æ”¶ã€‚

## æ–°ç”Ÿä»£å’Œè€å¹´ä»£

å †ï¼ˆHeapï¼‰æ˜¯ JVM ä¸­æœ€å¤§çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œä¹Ÿæ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-20231227132701.png)

å †ä¸»è¦åˆ†ä¸º 2 ä¸ªåŒºåŸŸï¼Œå¹´è½»ä»£ä¸è€å¹´ä»£ï¼Œå…¶ä¸­å¹´è½»ä»£åˆåˆ† Eden åŒºå’Œ Survivor åŒºï¼Œå…¶ä¸­ Survivor åŒºåˆåˆ† From å’Œ To ä¸¤ä¸ªåŒºã€‚

### Eden åŒº

æ® IBM å…¬å¸ä¹‹å‰çš„ç ”ç©¶è¡¨æ˜ï¼Œæœ‰å°†è¿‘ 98% çš„å¯¹è±¡æ˜¯æœç”Ÿå¤•æ­»ï¼Œæ‰€ä»¥é’ˆå¯¹è¿™ä¸€ç°çŠ¶ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡ä¼šåœ¨æ–°ç”Ÿä»£ Eden åŒºä¸­è¿›è¡Œåˆ†é…ï¼Œå½“ Eden åŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼ŒJVM ä¼šå‘èµ·ä¸€æ¬¡ Minor GCï¼ŒMinor GC ç›¸æ¯” Major GC æ›´é¢‘ç¹ï¼Œå›æ”¶é€Ÿåº¦ä¹Ÿæ›´å¿«ã€‚

é€šè¿‡ Minor GC ä¹‹åï¼ŒEden åŒºä¸­ç»å¤§éƒ¨åˆ†å¯¹è±¡ä¼šè¢«å›æ”¶ï¼Œè€Œé‚£äº›æ— éœ€å›æ”¶çš„å­˜æ´»å¯¹è±¡ï¼Œå°†ä¼šè¿›åˆ° Survivor çš„ From åŒºï¼Œå¦‚æœ From åŒºä¸å¤Ÿï¼Œåˆ™ç›´æ¥è¿›å…¥ To åŒºã€‚

### Survivor åŒº

Survivor åŒºç›¸å½“äºæ˜¯ Eden åŒºå’Œ Old åŒºçš„ä¸€ä¸ªç¼“å†²ï¼Œç±»ä¼¼äºæˆ‘ä»¬äº¤é€šç¯ä¸­çš„é»„ç¯ã€‚

#### 1ã€ä¸ºå•¥éœ€è¦ Survivor åŒºï¼Ÿ

ä¸å°±æ˜¯æ–°ç”Ÿä»£åˆ°è€å¹´ä»£å—ï¼Œç›´æ¥ Eden åˆ° Old ä¸å¥½äº†å—ï¼Œä¸ºå•¥è¦è¿™ä¹ˆå¤æ‚ã€‚

å¦‚æœæ²¡æœ‰ Survivor åŒºï¼ŒEden åŒºæ¯è¿›è¡Œä¸€æ¬¡ Minor GCï¼Œå­˜æ´»çš„å¯¹è±¡å°±ä¼šè¢«é€åˆ°è€å¹´ä»£ï¼Œè€å¹´ä»£å¾ˆå¿«å°±ä¼šè¢«å¡«æ»¡ã€‚è€Œæœ‰å¾ˆå¤šå¯¹è±¡è™½ç„¶ä¸€æ¬¡ Minor GC æ²¡æœ‰æ¶ˆç­ï¼Œä½†å…¶å®ä¹Ÿå¹¶ä¸ä¼šè¹¦è·¶å¤šä¹…ï¼Œæˆ–è®¸ç¬¬äºŒæ¬¡ï¼Œç¬¬ä¸‰æ¬¡å°±éœ€è¦è¢«æ¸…é™¤ã€‚

è¿™æ—¶å€™ç§»å…¥è€å¹´åŒºï¼Œå¾ˆæ˜æ˜¾ä¸æ˜¯ä¸€ä¸ªæ˜æ™ºçš„å†³å®šã€‚

æ‰€ä»¥ï¼ŒSurvivor çš„å­˜åœ¨æ„ä¹‰å°±æ˜¯å‡å°‘è¢«é€åˆ°è€å¹´ä»£çš„å¯¹è±¡ï¼Œè¿›è€Œå‡å°‘ Major GC çš„å‘ç”Ÿã€‚Survivor çš„é¢„ç­›é€‰ä¿è¯ï¼Œåªæœ‰ç»å† 16 æ¬¡ Minor GC è¿˜èƒ½åœ¨æ–°ç”Ÿä»£ä¸­å­˜æ´»çš„å¯¹è±¡ï¼Œæ‰ä¼šè¢«é€åˆ°è€å¹´ä»£ã€‚

#### 2ã€Survivor åŒºä¸ºå•¥åˆ’åˆ†ä¸ºä¸¤å—ï¼Ÿ

è®¾ç½®ä¸¤ä¸ª Survivor åŒºæœ€å¤§çš„å¥½å¤„å°±æ˜¯è§£å†³å†…å­˜ç¢ç‰‡åŒ–ï¼Œæˆ‘ä»¬å…ˆå‡è®¾ä¸€ä¸‹ï¼ŒSurvivor åªæœ‰ä¸€ä¸ªåŒºåŸŸä¼šæ€æ ·ã€‚

Minor GC æ‰§è¡Œåï¼ŒEden åŒºè¢«æ¸…ç©ºï¼Œå­˜æ´»çš„å¯¹è±¡æ”¾åˆ°äº† Survivor åŒºï¼Œè€Œä¹‹å‰ Survivor åŒºä¸­çš„å¯¹è±¡ï¼Œå¯èƒ½ä¹Ÿæœ‰ä¸€äº›æ˜¯éœ€è¦è¢«æ¸…é™¤çš„ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬æ€ä¹ˆæ¸…é™¤å®ƒä»¬ï¼Ÿ

åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬åªèƒ½æ ‡è®°æ¸…é™¤ï¼Œè€Œæˆ‘ä»¬çŸ¥é“æ ‡è®°æ¸…é™¤æœ€å¤§çš„é—®é¢˜å°±æ˜¯å†…å­˜ç¢ç‰‡ï¼Œåœ¨æ–°ç”Ÿä»£è¿™ç§ç»å¸¸ä¼šæ¶ˆäº¡çš„åŒºåŸŸï¼Œé‡‡ç”¨æ ‡è®°æ¸…é™¤å¿…ç„¶ä¼šè®©å†…å­˜äº§ç”Ÿä¸¥é‡çš„ç¢ç‰‡åŒ–ã€‚

ä½†å› ä¸º Survivor æœ‰ 2 ä¸ªåŒºåŸŸï¼Œæ‰€ä»¥æ¯æ¬¡ Minor GCï¼Œä¼šå°†ä¹‹å‰ Eden åŒºå’Œ From åŒºä¸­çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ° To åŒºåŸŸã€‚ç¬¬äºŒæ¬¡ Minor GC æ—¶ï¼ŒFrom ä¸ To èŒè´£å…‘æ¢ï¼Œè¿™æ—¶å€™ä¼šå°† Eden åŒºå’Œ To åŒºä¸­çš„å­˜æ´»å¯¹è±¡å†å¤åˆ¶åˆ° From åŒºåŸŸï¼Œä»¥æ­¤åå¤ã€‚

è¿™ç§æœºåˆ¶æœ€å¤§çš„å¥½å¤„å°±æ˜¯ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ°¸è¿œæœ‰ä¸€ä¸ª Survivor space æ˜¯ç©ºçš„ï¼Œå¦ä¸€ä¸ªéç©ºçš„ Survivor space æ˜¯æ— ç¢ç‰‡çš„ã€‚

é‚£ä¹ˆï¼ŒSurvivor ä¸ºä»€ä¹ˆä¸åˆ†æ›´å¤šå—å‘¢ï¼Ÿæ¯”æ–¹è¯´åˆ†æˆä¸‰ä¸ªã€å››ä¸ªã€äº”ä¸ªï¼Ÿ

æ˜¾ç„¶ï¼Œå¦‚æœ Survivor åŒºå†ç»†åˆ†ä¸‹å»ï¼Œæ¯ä¸€å—çš„ç©ºé—´å°±ä¼šæ¯”è¾ƒå°ï¼Œå®¹æ˜“å¯¼è‡´ Survivor åŒºæ»¡ï¼Œä¸¤å— Survivor åŒºå¯èƒ½æ˜¯ç»è¿‡æƒè¡¡ä¹‹åçš„æœ€ä½³æ–¹æ¡ˆã€‚

### Old åŒº

è€å¹´ä»£å æ®ç€ 2/3 çš„å †å†…å­˜ç©ºé—´ï¼Œåªæœ‰åœ¨ Major GC çš„æ—¶å€™æ‰ä¼šè¿›è¡Œæ¸…ç†ï¼Œæ¯æ¬¡ GC éƒ½ä¼šè§¦å‘â€œStop-The-Worldâ€ã€‚å†…å­˜è¶Šå¤§ï¼ŒSTW çš„æ—¶é—´ä¹Ÿè¶Šé•¿ï¼Œæ‰€ä»¥å†…å­˜ä¹Ÿä¸ä»…ä»…æ˜¯è¶Šå¤§å°±è¶Šå¥½ã€‚

ç”±äºå¤åˆ¶ç®—æ³•åœ¨å¯¹è±¡å­˜æ´»ç‡è¾ƒé«˜çš„è€å¹´ä»£ä¼šè¿›è¡Œå¾ˆå¤šæ¬¡çš„å¤åˆ¶æ“ä½œï¼Œæ•ˆç‡å¾ˆä½ï¼Œæ‰€ä»¥è€å¹´ä»£è¿™é‡Œé‡‡ç”¨çš„æ˜¯æ ‡è®°æ•´ç†ç®—æ³•ã€‚

é™¤äº†ä¸Šè¿°æ‰€è¯´ï¼Œåœ¨å†…å­˜æ‹…ä¿æœºåˆ¶ä¸‹ï¼Œæ— æ³•å®‰ç½®çš„å¯¹è±¡ä¼šç›´æ¥è¿›åˆ°è€å¹´ä»£ï¼Œä»¥ä¸‹å‡ ç§æƒ…å†µä¹Ÿä¼šè¿›å…¥è€å¹´ä»£ã€‚

#### 1ã€å¤§å¯¹è±¡

å¤§å¯¹è±¡æŒ‡éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼Œè¿™éƒ¨åˆ†å¯¹è±¡ä¸ç®¡æ˜¯ä¸æ˜¯â€œæœç”Ÿå¤•æ­»â€ï¼Œéƒ½ä¼šç›´æ¥è¿›åˆ°è€å¹´ä»£ã€‚è¿™æ ·åšä¸»è¦æ˜¯ä¸ºäº†é¿å…åœ¨ Eden åŒºåŠ 2 ä¸ª Survivor åŒºä¹‹é—´å‘ç”Ÿå¤§é‡çš„å†…å­˜å¤åˆ¶ã€‚å½“ä½ çš„ç³»ç»Ÿæœ‰éå¸¸å¤šâ€œæœç”Ÿå¤•æ­»â€çš„å¤§å¯¹è±¡æ—¶ï¼Œå¾—æ³¨æ„äº†ã€‚

#### 2ã€é•¿æœŸå­˜æ´»å¯¹è±¡

è™šæ‹Ÿæœºç»™æ¯ä¸ªå¯¹è±¡å®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡å¹´é¾„ï¼ˆAgeï¼‰è®¡æ•°å™¨ã€‚æ­£å¸¸æƒ…å†µä¸‹å¯¹è±¡ä¼šä¸æ–­çš„åœ¨ Survivor çš„ From åŒºä¸ To åŒºä¹‹é—´ç§»åŠ¨ï¼Œå¯¹è±¡åœ¨ Survivor åŒºä¸­æ¯ç»å†ä¸€æ¬¡ Minor GCï¼Œå¹´é¾„å°±å¢åŠ  1 å²ã€‚å½“å¹´é¾„å¢åŠ åˆ° 15 å²æ—¶ï¼Œè¿™æ—¶å€™å°±ä¼šè¢«è½¬ç§»åˆ°è€å¹´ä»£ã€‚å½“ç„¶ï¼Œè¿™é‡Œçš„ 15ï¼ŒJVM ä¹Ÿæ”¯æŒè¿›è¡Œç‰¹æ®Šè®¾ç½® `-XX:MaxTenuringThreshold=10`ã€‚

å¯é€šè¿‡ `java -XX:+PrintFlagsFinal -version | grep MaxTenuringThreshold` æŸ¥çœ‹é»˜è®¤çš„é˜ˆå€¼ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/gc-20231227133826.png)

#### 3ã€åŠ¨æ€å¯¹è±¡å¹´é¾„

JVM å¹¶ä¸å¼ºåˆ¶è¦æ±‚å¯¹è±¡å¹´é¾„å¿…é¡»åˆ° 15 å²æ‰ä¼šæ”¾å…¥è€å¹´åŒºï¼Œå¦‚æœ Survivor ç©ºé—´ä¸­æŸä¸ªå¹´é¾„æ®µçš„å¯¹è±¡æ€»å¤§å°è¶…è¿‡äº† Survivor ç©ºé—´çš„ä¸€åŠï¼Œé‚£ä¹ˆè¯¥å¹´é¾„æ®µåŠä»¥ä¸Šå¹´é¾„æ®µçš„æ‰€æœ‰å¯¹è±¡éƒ½ä¼šåœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶è¢«æ™‹å‡åˆ°è€å¹´ä»£ï¼Œæ— éœ€ç­‰ä½ â€œæˆå¹´â€ã€‚

æœ‰ç‚¹ç±»ä¼¼äºè´Ÿè½½å‡è¡¡ï¼Œè½®è¯¢æ˜¯è´Ÿè½½å‡è¡¡çš„ä¸€ç§ï¼Œä¿è¯æ¯å°æœºå™¨éƒ½åˆ†å¾—åŒæ ·çš„è¯·æ±‚ã€‚çœ‹ä¼¼å¾ˆå‡è¡¡ï¼Œä½†æ¯å°æœºå™¨çš„ç¡¬ä»¶ä¸åŒï¼Œå¥åº·çŠ¶å†µä¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åŸºäºæ¯å°æœºå™¨æ¥æ”¶çš„è¯·æ±‚æ•°ã€å“åº”æ—¶é—´ç­‰ï¼Œæ¥è°ƒæ•´è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚

è¿™ç§åŠ¨æ€è°ƒæ•´æœºåˆ¶æœ‰åŠ©äºä¼˜åŒ–å†…å­˜ä½¿ç”¨å’Œå‡å°‘åƒåœ¾æ”¶é›†çš„é¢‘ç‡ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡çš„åº”ç”¨ç¨‹åºæ—¶ã€‚

## å°ç»“

æœ¬ç¯‡å†…å®¹æˆ‘ä»¬ä»å¤´åˆ°å°¾è®²äº†ä¸€é JVM çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼ŒåŒ…æ‹¬åƒåœ¾å›æ”¶çš„æ¦‚å¿µã€åƒåœ¾åˆ¤æ–­ç®—æ³•ã€åƒåœ¾æ”¶é›†ç®—æ³•ã€Stop The Worldã€æ–°ç”Ÿä»£å’Œè€å¹´ä»£ç­‰ç­‰ã€‚


> - å‚è€ƒé“¾æ¥ 1ï¼š[ä»å¤´åˆ°å°¾å†è®²ä¸€æ¬¡ Java çš„åƒåœ¾å›æ”¶](https://zhuanlan.zhihu.com/p/73628158)
> - å‚è€ƒé“¾æ¥ 2ï¼š[è¯¦è§£Javaçš„åƒåœ¾å›æ”¶æœºåˆ¶](https://segmentfault.com/a/1190000038256027)
> - å‚è€ƒé“¾æ¥ 3ï¼š[ä¸‰å¤§åƒåœ¾æ”¶é›†ç®—æ³•](https://www.51cto.com/article/708223.html)

---

GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹](https://javabetter.cn/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)
