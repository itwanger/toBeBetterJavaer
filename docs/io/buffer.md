---
title: Java ç¼“å†²æµï¼šJava IO çš„è¯»å†™æ•ˆç‡æœ‰äº†è´¨çš„é£å‡
shortTitle: ç¼“å†²æµ
category:
  - Javaæ ¸å¿ƒ
tag:
  - Java IO
description: æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å­—ç¬¦æµåœ¨ Java IO æ“ä½œä¸­çš„é‡è¦ä½œç”¨ï¼Œç‰¹åˆ«å…³æ³¨ Reader å’Œ Writer ç±»åŠå…¶å­ç±»çš„åŠŸèƒ½ä¸ç”¨é€”ã€‚åŒæ—¶ï¼Œæ–‡ç« è¿˜æä¾›äº†å­—ç¬¦æµçš„å®é™…åº”ç”¨ç¤ºä¾‹å’Œå¸¸ç”¨æ–¹æ³•ã€‚é˜…è¯»æœ¬æ–‡ï¼Œå°†å¸®åŠ©æ‚¨æ›´æ·±å…¥åœ°äº†è§£å­—ç¬¦æµä»¥åŠ Reader å’Œ Writer åœ¨ Java ç¼–ç¨‹ä¸­çš„å…³é”®åœ°ä½ï¼Œæé«˜æ–‡æœ¬æ“ä½œæ•ˆç‡ã€‚
head:
  - - meta
    - name: keywords
      content: Java,IO,ç¼“å†²æµ,Buffered,BufferedInputStream,BufferedOutputStream,BufferedReader,BufferedWriter,java ç¼“å†²æµ,java buffer
---

# 7.5 ç¼“å†²æµ

Java çš„ç¼“å†²æµæ˜¯å¯¹å­—èŠ‚æµå’Œå­—ç¬¦æµçš„ä¸€ç§å°è£…ï¼Œé€šè¿‡åœ¨å†…å­˜ä¸­å¼€è¾Ÿç¼“å†²åŒºæ¥æé«˜ I/O æ“ä½œçš„æ•ˆç‡ã€‚Java é€šè¿‡ BufferedInputStream å’Œ BufferedOutputStream æ¥å®ç°å­—èŠ‚æµçš„ç¼“å†²ï¼Œé€šè¿‡ BufferedReader å’Œ BufferedWriter æ¥å®ç°å­—ç¬¦æµçš„ç¼“å†²ã€‚

ç¼“å†²æµçš„å·¥ä½œåŸç†æ˜¯å°†æ•°æ®å…ˆå†™å…¥ç¼“å†²åŒºä¸­ï¼Œå½“ç¼“å†²åŒºæ»¡æ—¶å†ä¸€æ¬¡æ€§å†™å…¥æ–‡ä»¶æˆ–è¾“å‡ºæµï¼Œæˆ–è€…å½“ç¼“å†²åŒºä¸ºç©ºæ—¶ä¸€æ¬¡æ€§ä»æ–‡ä»¶æˆ–è¾“å…¥æµä¸­è¯»å–ä¸€å®šé‡çš„æ•°æ®ã€‚è¿™æ ·å¯ä»¥å‡å°‘ç³»ç»Ÿçš„ I/O æ“ä½œæ¬¡æ•°ï¼Œæé«˜ç³»ç»Ÿçš„ I/O æ•ˆç‡ï¼Œä»è€Œæé«˜ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚

### 01ã€å­—èŠ‚ç¼“å†²æµ

BufferedInputStream å’Œ BufferedOutputStream å±äºå­—èŠ‚ç¼“å†²æµï¼Œå¼ºåŒ–äº†å­—èŠ‚æµ InputStream å’Œ OutputStreamï¼Œå…³äºå­—èŠ‚æµï¼Œæˆ‘ä»¬å‰é¢å·²ç»è¯¦ç»†åœ°è®²è¿‡äº†ï¼Œå¯ä»¥[æˆ³è¿™ä¸ªé“¾æ¥](https://tobebetterjavaer.com/io/stream.html)å»æ¸©ä¹ ã€‚

#### 1ï¼‰æ„é€ æ–¹æ³•

*   `BufferedInputStream(InputStream in)` ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç¼“å†²è¾“å…¥æµï¼Œæ³¨æ„å‚æ•°ç±»å‹ä¸º**InputStream**ã€‚
*   `BufferedOutputStream(OutputStream out)`ï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„ç¼“å†²è¾“å‡ºæµï¼Œæ³¨æ„å‚æ•°ç±»å‹ä¸º**OutputStream**ã€‚

ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
// åˆ›å»ºå­—èŠ‚ç¼“å†²è¾“å…¥æµï¼Œå…ˆå£°æ˜å­—èŠ‚æµ
FileInputStream fps = new FileInputStream(b.txt);
BufferedInputStream bis = new BufferedInputStream(fps)

// åˆ›å»ºå­—èŠ‚ç¼“å†²è¾“å…¥æµï¼ˆä¸€æ­¥åˆ°ä½ï¼‰
BufferedInputStream bis = new BufferedInputStream(new FileInputStream("b.txt"));

// åˆ›å»ºå­—èŠ‚ç¼“å†²è¾“å‡ºæµï¼ˆä¸€æ­¥åˆ°ä½ï¼‰
BufferedOutputStream bos = new BufferedOutputStream(new FileOutputStream("b.txt"));
```

#### 2ï¼‰ç¼“å†²æµçš„é«˜æ•ˆ

æˆ‘ä»¬é€šè¿‡å¤åˆ¶ä¸€ä¸ª 370M+ çš„å¤§æ–‡ä»¶ï¼Œæ¥æµ‹è¯•ç¼“å†²æµçš„æ•ˆç‡ã€‚ä¸ºäº†åšå¯¹æ¯”ï¼Œæˆ‘ä»¬å…ˆç”¨åŸºæœ¬æµæ¥å®ç°ä¸€ä¸‹ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
// è®°å½•å¼€å§‹æ—¶é—´
long start = System.currentTimeMillis();
// åˆ›å»ºæµå¯¹è±¡
try (FileInputStream fis = new FileInputStream("py.mp4");//exeæ–‡ä»¶å¤Ÿå¤§
        FileOutputStream fos = new FileOutputStream("copyPy.mp4")){
    // è¯»å†™æ•°æ®
    int b;
    while ((b = fis.read()) != -1) {
        fos.write(b);
    }
}
// è®°å½•ç»“æŸæ—¶é—´
long end = System.currentTimeMillis();
System.out.println("æ™®é€šæµå¤åˆ¶æ—¶é—´:"+(end - start)+" æ¯«ç§’");
```

ä¸å¥½æ„æ€ï¼Œæˆ‘æœ¬æœºæ¯”è¾ƒèœï¼Œ10 åˆ†é’Ÿè¿˜åœ¨å¤åˆ¶ä¸­ã€‚åˆ‡æ¢åˆ°ç¼“å†²æµè¯•ä¸€ä¸‹ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
// è®°å½•å¼€å§‹æ—¶é—´
long start = System.currentTimeMillis();
// åˆ›å»ºæµå¯¹è±¡
try (BufferedInputStream bis = new BufferedInputStream(new FileInputStream("py.mp4"));
        BufferedOutputStream bos = new BufferedOutputStream(new FileOutputStream("copyPy.mp4"));){
    // è¯»å†™æ•°æ®
    int b;
    while ((b = bis.read()) != -1) {
        bos.write(b);
    }
}
// è®°å½•ç»“æŸæ—¶é—´
long end = System.currentTimeMillis();
System.out.println("ç¼“å†²æµå¤åˆ¶æ—¶é—´:"+(end - start)+" æ¯«ç§’");
```
 
åªéœ€è¦ 8016 æ¯«ç§’ï¼Œå¦‚ä½•æ›´å¿«å‘¢ï¼Ÿ

å¯ä»¥æ¢æ•°ç»„çš„æ–¹å¼æ¥è¯»å†™ï¼Œè¿™ä¸ªæˆ‘ä»¬å‰é¢ä¹Ÿæœ‰è®²åˆ°ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
// è®°å½•å¼€å§‹æ—¶é—´
long start = System.currentTimeMillis();
// åˆ›å»ºæµå¯¹è±¡
try (BufferedInputStream bis = new BufferedInputStream(new FileInputStream("py.mp4"));
        BufferedOutputStream bos = new BufferedOutputStream(new FileOutputStream("copyPy.mp4"));){
    // è¯»å†™æ•°æ®
    int len;
    byte[] bytes = new byte[8*1024];
    while ((len = bis.read(bytes)) != -1) {
        bos.write(bytes, 0 , len);
    }
}
// è®°å½•ç»“æŸæ—¶é—´
long end = System.currentTimeMillis();
System.out.println("ç¼“å†²æµä½¿ç”¨æ•°ç»„å¤åˆ¶æ—¶é—´:"+(end - start)+" æ¯«ç§’");
```

è¿™ä¸‹å°±æ›´å¿«äº†ï¼Œåªéœ€è¦ 521 æ¯«ç§’ã€‚
 
#### 3ï¼‰ä¸ºä»€ä¹ˆå­—èŠ‚ç¼“å†²æµä¼šè¿™ä¹ˆå¿«ï¼Ÿ


ä¼ ç»Ÿçš„ Java IO æ˜¯é˜»å¡æ¨¡å¼çš„ï¼Œå®ƒçš„å·¥ä½œçŠ¶æ€å°±æ˜¯â€œè¯»/å†™ï¼Œç­‰å¾…ï¼Œè¯»/å†™ï¼Œç­‰å¾…ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚â€

å­—èŠ‚ç¼“å†²æµè§£å†³çš„å°±æ˜¯è¿™ä¸ªé—®é¢˜ï¼š**ä¸€æ¬¡å¤šè¯»ç‚¹å¤šå†™ç‚¹ï¼Œå‡å°‘è¯»å†™çš„é¢‘ç‡ï¼Œç”¨ç©ºé—´æ¢æ—¶é—´**ã€‚

- å‡å°‘ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ï¼šåœ¨ä½¿ç”¨å­—èŠ‚ç¼“å†²æµæ—¶ï¼Œæ•°æ®ä¸æ˜¯ç«‹å³å†™å…¥ç£ç›˜æˆ–è¾“å‡ºæµï¼Œè€Œæ˜¯å…ˆå†™å…¥ç¼“å†²åŒºï¼Œå½“ç¼“å†²åŒºæ»¡æ—¶å†ä¸€æ¬¡æ€§å†™å…¥ç£ç›˜æˆ–è¾“å‡ºæµã€‚è¿™æ ·å¯ä»¥å‡å°‘ç³»ç»Ÿè°ƒç”¨çš„æ¬¡æ•°ï¼Œä»è€Œæé«˜ I/O æ“ä½œçš„æ•ˆç‡ã€‚
- å‡å°‘ç£ç›˜è¯»å†™æ¬¡æ•°ï¼šåœ¨ä½¿ç”¨å­—èŠ‚ç¼“å†²æµæ—¶ï¼Œå½“éœ€è¦è¯»å–æ•°æ®æ—¶ï¼Œç¼“å†²æµä¼šå…ˆä»ç¼“å†²åŒºä¸­è¯»å–æ•°æ®ï¼Œå¦‚æœç¼“å†²åŒºä¸­æ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®ï¼Œåˆ™ä¼šä¸€æ¬¡æ€§ä»ç£ç›˜æˆ–è¾“å…¥æµä¸­è¯»å–ä¸€å®šé‡çš„æ•°æ®ã€‚åŒæ ·åœ°ï¼Œå½“éœ€è¦å†™å…¥æ•°æ®æ—¶ï¼Œç¼“å†²æµä¼šå…ˆå°†æ•°æ®å†™å…¥ç¼“å†²åŒºï¼Œå¦‚æœç¼“å†²åŒºæ»¡äº†ï¼Œåˆ™ä¼šä¸€æ¬¡æ€§å°†ç¼“å†²åŒºä¸­çš„æ•°æ®å†™å…¥ç£ç›˜æˆ–è¾“å‡ºæµã€‚è¿™æ ·å¯ä»¥å‡å°‘ç£ç›˜è¯»å†™çš„æ¬¡æ•°ï¼Œä»è€Œæé«˜ I/O æ“ä½œçš„æ•ˆç‡ã€‚
- æé«˜æ•°æ®ä¼ è¾“æ•ˆç‡ï¼šåœ¨ä½¿ç”¨å­—èŠ‚ç¼“å†²æµæ—¶ï¼Œç”±äºæ•°æ®æ˜¯ä»¥å—çš„å½¢å¼è¿›è¡Œä¼ è¾“ï¼Œå› æ­¤å¯ä»¥å‡å°‘æ•°æ®ä¼ è¾“çš„æ¬¡æ•°ï¼Œä»è€Œæé«˜æ•°æ®ä¼ è¾“çš„æ•ˆç‡ã€‚

æˆ‘ä»¬æ¥çœ‹ BufferedInputStream çš„ read æ–¹æ³•ï¼š

```java
public synchronized int read() throws IOException {
    if (pos >= count) {     // å¦‚æœå½“å‰ä½ç½®å·²ç»åˆ°è¾¾ç¼“å†²åŒºæœ«å°¾
        fill();             // å¡«å……ç¼“å†²åŒº
        if (pos >= count)   // å¦‚æœå¡«å……åä»ç„¶åˆ°è¾¾ç¼“å†²åŒºæœ«å°¾ï¼Œè¯´æ˜å·²ç»è¯»å–å®Œæ¯•
            return -1;      // è¿”å› -1 è¡¨ç¤ºå·²ç»è¯»å–å®Œæ¯•
    }
    return getBufIfOpen()[pos++] & 0xff; // è¿”å›å½“å‰ä½ç½®çš„å­—èŠ‚ï¼Œå¹¶å°†ä½ç½®åŠ  1
}
```

è¿™æ®µä»£ç ä¸»è¦æœ‰ä¸¤éƒ¨åˆ†ï¼š

- `fill()`ï¼šè¯¥æ–¹æ³•ä¼šå°†ç¼“å†² buf å¡«æ»¡ã€‚
- `getBufIfOpen()[pos++] & 0xff`ï¼šè¿”å›å½“å‰è¯»å–ä½ç½® pos å¤„çš„å­—èŠ‚ï¼ˆ`getBufIfOpen()`è¿”å›çš„æ˜¯ buffer æ•°ç»„ï¼Œæ˜¯ byte ç±»å‹ï¼‰ï¼Œå¹¶å°†å…¶ä¸ 0xff è¿›è¡Œä½ä¸è¿ç®—ã€‚è¿™é‡Œçš„ç›®çš„æ˜¯å°†è¯»å–åˆ°çš„å­—èŠ‚ b å½“åšæ— ç¬¦å·çš„å­—èŠ‚å¤„ç†ï¼Œå› ä¸º Java çš„ byte ç±»å‹æ˜¯æœ‰ç¬¦å·çš„ï¼Œè€Œå°† b ä¸ 0xff è¿›è¡Œä½ä¸è¿ç®—ï¼Œå°±å¯ä»¥å°†å…¶è½¬æ¢ä¸ºæ— ç¬¦å·çš„å­—èŠ‚ï¼Œå…¶èŒƒå›´ä¸º 0 åˆ° 255ã€‚

>byte & 0xFF æˆ‘ä»¬ä¸€ä¼šå†ç»†è®²ã€‚

å†æ¥çœ‹ FileInputStream çš„ read æ–¹æ³•ï¼š

![](https://cdn.tobebetterjavaer.com/stutymore/buffer-20230321154534.png)

åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ`read0()` æ–¹æ³•æ˜¯ä¸€ä¸ª[æœ¬åœ°æ–¹æ³•](https://tobebetterjavaer.com/oo/native-method.html)ï¼Œå®ƒçš„å®ç°æ˜¯ç”±åº•å±‚æ“ä½œç³»ç»Ÿæä¾›çš„ï¼Œå¹¶ä¸æ˜¯ Java è¯­è¨€å®ç°çš„ã€‚åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šï¼Œ`read0()` æ–¹æ³•çš„å®ç°å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯å®ƒä»¬çš„åŠŸèƒ½éƒ½æ˜¯ç›¸åŒçš„ï¼Œéƒ½æ˜¯ç”¨äº**è¯»å–ä¸€ä¸ªå­—èŠ‚**ã€‚

å†æ¥çœ‹ä¸€ä¸‹ BufferedOutputStream çš„ `write(byte b[], int off, int len)` æ–¹æ³•ï¼š

```java
public synchronized void write(byte b[], int off, int len) throws IOException {
    if (len >= buf.length) {    // å¦‚æœå†™å…¥çš„å­—èŠ‚æ•°å¤§äºç­‰äºç¼“å†²åŒºé•¿åº¦
        /* å¦‚æœè¯·æ±‚çš„é•¿åº¦è¶…è¿‡äº†è¾“å‡ºç¼“å†²åŒºçš„å¤§å°ï¼Œ
           å…ˆåˆ·æ–°ç¼“å†²åŒºï¼Œç„¶åç›´æ¥å°†æ•°æ®å†™å…¥ã€‚
           è¿™æ ·å¯ä»¥é¿å…ç¼“å†²æµçº§è”æ—¶çš„é—®é¢˜ã€‚*/
        flushBuffer();          // å…ˆåˆ·æ–°ç¼“å†²åŒº
        out.write(b, off, len); // ç›´æ¥å°†æ•°æ®å†™å…¥è¾“å‡ºæµ
        return;
    }
    if (len > buf.length - count) { // å¦‚æœå†™å…¥çš„å­—èŠ‚æ•°å¤§äºç©ºä½™ç©ºé—´
        flushBuffer();              // å…ˆåˆ·æ–°ç¼“å†²åŒº
    }
    System.arraycopy(b, off, buf, count, len); // å°†æ•°æ®æ‹·è´åˆ°ç¼“å†²åŒºä¸­
    count += len;                             // æ›´æ–°è®¡æ•°å™¨
}
```

é¦–å…ˆï¼Œè¯¥æ–¹æ³•ä¼šæ£€æŸ¥å†™å…¥çš„å­—èŠ‚æ•°æ˜¯å¦å¤§äºç­‰äºç¼“å†²åŒºé•¿åº¦ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å…ˆå°†ç¼“å†²åŒºä¸­çš„æ•°æ®åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼Œç„¶åç›´æ¥å°†æ•°æ®å†™å…¥è¾“å‡ºæµã€‚è¿™æ ·åšæ˜¯ä¸ºäº†é¿å…ç¼“å†²æµçº§è”æ—¶çš„é—®é¢˜ï¼Œå³ç¼“å†²åŒºçš„å¤§å°ä¸è¶³ä»¥å®¹çº³å†™å…¥çš„æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šå¼•å‘çº§è”åˆ·æ–°ï¼Œå¯¼è‡´æ•ˆç‡é™ä½ã€‚

>çº§è”é—®é¢˜ï¼ˆCascade Problemï¼‰æ˜¯æŒ‡åœ¨ä¸€ç»„ç¼“å†²æµï¼ˆBuffered Streamï¼‰ä¸­ï¼Œç”±äºç¼“å†²åŒºçš„å¤§å°ä¸è¶³ä»¥å®¹çº³è¦å†™å…¥çš„æ•°æ®ï¼Œå¯¼è‡´æ•°æ®è¢«åˆ†å‰²æˆå¤šä¸ªéƒ¨åˆ†ï¼Œå¹¶åˆ†åˆ«å†™å…¥åˆ°ä¸åŒçš„ç¼“å†²åŒºä¸­ï¼Œæœ€ç»ˆéœ€è¦é€ä¸ªåˆ·æ–°ç¼“å†²åŒºï¼Œä»è€Œå¯¼è‡´æ€§èƒ½ä¸‹é™çš„é—®é¢˜ã€‚

å…¶æ¬¡ï¼Œå¦‚æœå†™å…¥çš„å­—èŠ‚æ•°å°äºç¼“å†²åŒºé•¿åº¦ï¼Œåˆ™æ£€æŸ¥ç¼“å†²åŒºä¸­å‰©ä½™çš„ç©ºé—´æ˜¯å¦è¶³å¤Ÿå®¹çº³è¦å†™å…¥çš„å­—èŠ‚æ•°ï¼Œå¦‚æœä¸å¤Ÿï¼Œåˆ™å…ˆå°†ç¼“å†²åŒºä¸­çš„æ•°æ®åˆ·æ–°åˆ°ç£ç›˜ä¸­ã€‚ç„¶åï¼Œä½¿ç”¨ `System.arraycopy()` æ–¹æ³•å°†è¦å†™å…¥çš„æ•°æ®æ‹·è´åˆ°ç¼“å†²åŒºä¸­ï¼Œå¹¶æ›´æ–°è®¡æ•°å™¨ countã€‚

æœ€åï¼Œå¦‚æœå†™å…¥çš„å­—èŠ‚æ•°å°äºç¼“å†²åŒºé•¿åº¦ä¸”ç¼“å†²åŒºä¸­è¿˜æœ‰å‰©ä½™ç©ºé—´ï¼Œåˆ™ç›´æ¥å°†è¦å†™å…¥çš„æ•°æ®æ‹·è´åˆ°ç¼“å†²åŒºä¸­ï¼Œå¹¶æ›´æ–°è®¡æ•°å™¨ countã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰å½“ buf å†™æ»¡äº†ï¼Œæ‰ä¼š flushï¼Œå°†æ•°æ®åˆ·åˆ°ç£ç›˜ï¼Œé»˜è®¤ä¸€æ¬¡åˆ· 8192 ä¸ªå­—èŠ‚ã€‚

```java
public BufferedOutputStream(OutputStream out) {
    this(out, 8192);
}
```

å¦‚æœ buf æ²¡æœ‰å†™æ»¡ï¼Œä¼šç»§ç»­å†™ bufã€‚

å¯¹æ¯”ä¸€ä¸‹ FileOutputStream çš„ write æ–¹æ³•ï¼ŒåŒæ ·æ˜¯æœ¬åœ°æ–¹æ³•ï¼Œä¸€æ¬¡åªèƒ½å†™å…¥ä¸€ä¸ªå­—èŠ‚ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/buffer-20230321162808.png)

å½“æŠŠ BufferedOutputStream å’Œ BufferedInputStream é…åˆèµ·æ¥ä½¿ç”¨åï¼Œå°±å‡å°‘äº†å¤§é‡çš„è¯»å†™æ¬¡æ•°ï¼Œå°¤å…¶æ˜¯ `byte[] bytes = new byte[8*1024]`ï¼Œå°±ç›¸å½“äºç¼“å†²åŒºçš„ç©ºé—´æœ‰ 8 ä¸ª 1024 å­—èŠ‚ï¼Œé‚£è¯»å†™æ•ˆç‡å°±ä¼šå¤§å¤§æé«˜ã€‚

#### 4ï¼‰`byte & 0xFF`

byte ç±»å‹é€šå¸¸è¢«ç”¨äºå­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ï¼Œä¾‹å¦‚è¯»å–å’Œå†™å…¥æ–‡ä»¶ã€ç½‘ç»œä¼ è¾“ç­‰åœºæ™¯ã€‚åœ¨è¿™äº›åœºæ™¯ä¸‹ï¼Œbyte ç±»å‹çš„å˜é‡å¯ä»¥ç”¨æ¥å­˜å‚¨æ•°æ®æµä¸­çš„æ¯ä¸ªå­—èŠ‚ï¼Œä»è€Œè¿›è¡Œè¯»å–å’Œå†™å…¥æ“ä½œã€‚

byte ç±»å‹æ˜¯æœ‰ç¬¦å·çš„ï¼Œå³å…¶å–å€¼èŒƒå›´ä¸º -128 åˆ° 127ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›å¾—åˆ°çš„æ˜¯ä¸€ä¸ªæ— ç¬¦å·çš„ byte å€¼ï¼Œå°±éœ€è¦ä½¿ç”¨ `byte & 0xFF` æ¥è¿›è¡Œè½¬æ¢ã€‚

è¿™æ˜¯å› ä¸º 0xFF æ˜¯ä¸€ä¸ªæ— ç¬¦å·çš„æ•´æ•°ï¼Œå®ƒçš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸º 11111111ã€‚å½“ä¸€ä¸ª byte ç±»å‹çš„å€¼ä¸ 0xFF è¿›è¡Œä½ä¸è¿ç®—æ—¶ï¼Œä¼šå°† byte ç±»å‹çš„å€¼è½¬æ¢ä¸ºä¸€ä¸ªæ— ç¬¦å·çš„æ•´æ•°ï¼Œå…¶èŒƒå›´ä¸º 0 åˆ° 255ã€‚

0xff æ˜¯ä¸€ä¸ªåå…­è¿›åˆ¶çš„æ•°ï¼Œç›¸å½“äºäºŒè¿›åˆ¶çš„ 11111111ï¼Œ& è¿ç®—ç¬¦çš„æ„æ€æ˜¯ï¼šå¦‚æœä¸¤ä¸ªæ“ä½œæ•°çš„å¯¹åº”ä½ä¸º 1ï¼Œåˆ™è¾“å‡º 1ï¼Œå¦åˆ™ä¸º 0ï¼›ç”±äº 0xff æœ‰ 8 ä¸ª 1ï¼Œå•ä¸ª byte è½¬æˆ int å…¶å®å°±æ˜¯å°† byte å’Œ int ç±»å‹çš„ 255 è¿›è¡Œ(&)ä¸è¿ç®—ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ª byte ç±»å‹çš„å˜é‡ bï¼Œå…¶å€¼ä¸º -1ï¼Œé‚£ä¹ˆ b & 0xFF çš„ç»“æœå°±æ˜¯ 255ã€‚è¿™æ ·å°±å¯ä»¥å°†ä¸€ä¸ªæœ‰ç¬¦å·çš„ byte ç±»å‹çš„å€¼è½¬æ¢ä¸ºä¸€ä¸ªæ— ç¬¦å·çš„æ•´æ•°ã€‚

& è¿ç®—æ˜¯ä¸€ç§äºŒè¿›åˆ¶æ•°æ®çš„è®¡ç®—æ–¹å¼, ä¸¤ä¸ªæ“ä½œä½éƒ½ä¸º1ï¼Œç»“æœæ‰ä¸º1ï¼Œå¦åˆ™ç»“æœä¸º0. åœ¨ä¸Šé¢çš„ `getBufIfOpen()[pos++] & 0xff` è®¡ç®—è¿‡ç¨‹ä¸­, byte æœ‰ 8bit, OXFF æ˜¯16è¿›åˆ¶çš„255, è¡¨ç¤ºçš„æ˜¯ int ç±»å‹, int æœ‰ 32bit.

å¦‚æœ `getBufIfOpen()[pos++]` ä¸º -118, é‚£ä¹ˆå…¶åŸç è¡¨ç¤ºä¸º

```
00000000 00000000 00000000 10001010
```

åç ä¸º

```
11111111 11111111 11111111 11110101
```

è¡¥ç ä¸º

```
11111111 11111111 11111111 11110110
```

0XFF è¡¨ç¤º16è¿›åˆ¶çš„æ•°æ®255, åŸç , åç , è¡¥ç éƒ½æ˜¯ä¸€æ ·çš„, å…¶äºŒè¿›åˆ¶æ•°æ®ä¸º

```
00000000 00000000 00000000 11111111
```

0XFF å’Œ -118 è¿›è¡Œ&è¿ç®—åç»“æœä¸º

```
00000000 00000000 00000000 11110110
```

è¿˜åŸä¸ºåŸç åä¸º

```
00000000 00000000 00000000 10001010
```

å…¶è¡¨ç¤ºçš„ int å€¼ä¸º 138ï¼Œå¯è§å°† byte ç±»å‹çš„ -118 ä¸ 0XFF è¿›è¡Œä¸è¿ç®—åå€¼ç”± -118 å˜æˆäº† int ç±»å‹çš„ 138ï¼Œå…¶ä¸­ä½8ä½å’Œbyteçš„-118å®Œå…¨ä¸€è‡´ã€‚

é¡ºå¸¦èŠä¸€ä¸‹ åŸç ã€åç å’Œè¡¥ç ã€‚

â‘ ã€åŸç 

åŸç å°±æ˜¯ç¬¦å·ä½åŠ ä¸ŠçœŸå€¼çš„ç»å¯¹å€¼ï¼Œå³ç”¨ç¬¬ä¸€ä½è¡¨ç¤ºç¬¦å·ï¼Œå…¶ä½™ä½è¡¨ç¤ºå€¼ã€‚æ¯”å¦‚å¦‚æœæ˜¯8ä½äºŒè¿›åˆ¶:

```
[+1]åŸ = 0000 0001

[-1]åŸ = 1000 0001
```

ç¬¬ä¸€ä½æ˜¯ç¬¦å·ä½ã€‚å› ä¸ºç¬¬ä¸€ä½æ˜¯ç¬¦å·ä½ï¼Œæ‰€ä»¥8ä½äºŒè¿›åˆ¶æ•°çš„å–å€¼èŒƒå›´å°±æ˜¯ï¼š

```
[1111 1111 , 0111 1111]
```

å³

```
[-127 , 127]
```

â‘¡ã€åç 

åç çš„è¡¨ç¤ºæ–¹æ³•æ˜¯ï¼š

- æ­£æ•°çš„åç æ˜¯å…¶æœ¬èº«
- è´Ÿæ•°çš„åç æ˜¯åœ¨å…¶åŸç çš„åŸºç¡€ä¸Šï¼Œç¬¦å·ä½ä¸å˜ï¼Œå…¶ä½™å„ä¸ªä½å–åã€‚


ä¾‹å¦‚ï¼š

```
[+1] = [00000001]åŸ = [00000001]å

[-1] = [10000001]åŸ = [11111110]å
```

å¯è§å¦‚æœä¸€ä¸ªåç è¡¨ç¤ºçš„æ˜¯è´Ÿæ•°ï¼Œäººè„‘æ— æ³•ç›´è§‚çš„çœ‹å‡ºæ¥å®ƒçš„æ•°å€¼ã€‚é€šå¸¸è¦å°†å…¶è½¬æ¢æˆåŸç å†è®¡ç®—ã€‚

â‘¢ã€è¡¥ç 

è¡¥ç çš„è¡¨ç¤ºæ–¹æ³•æ˜¯ï¼š

- æ­£æ•°çš„è¡¥ç å°±æ˜¯å…¶æœ¬èº«
- è´Ÿæ•°çš„è¡¥ç æ˜¯åœ¨å…¶åŸç çš„åŸºç¡€ä¸Šï¼Œç¬¦å·ä½ä¸å˜ï¼Œå…¶ä½™å„ä½å–åï¼Œæœ€å+1ã€‚(å³åœ¨åç çš„åŸºç¡€ä¸Š+1)

```
[+1] = [00000001]åŸ = [00000001]å = [00000001]è¡¥

[-1] = [10000001]åŸ = [11111110]å = [11111111]è¡¥
```

å¯¹äºè´Ÿæ•°ï¼Œè¡¥ç è¡¨ç¤ºæ–¹å¼ä¹Ÿæ˜¯äººè„‘æ— æ³•ç›´è§‚çœ‹å‡ºå…¶æ•°å€¼çš„ã€‚é€šå¸¸ä¹Ÿéœ€è¦è½¬æ¢æˆåŸç åœ¨è®¡ç®—å…¶æ•°å€¼ã€‚

ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼š

- å¯¹äºæ­£æ•°ï¼šåŸç ï¼Œåç ï¼Œè¡¥ç éƒ½æ˜¯ä¸€æ ·çš„
- å¯¹äºè´Ÿæ•°ï¼šåŸç ï¼Œåç ï¼Œè¡¥ç éƒ½æ˜¯ä¸ä¸€æ ·çš„

### 02ã€å­—ç¬¦ç¼“å†²æµ

BufferedReader ç±»ç»§æ‰¿è‡ª Reader ç±»ï¼Œæä¾›äº†ä¸€äº›ä¾¿æ·çš„æ–¹æ³•ï¼Œä¾‹å¦‚ `readLine()` æ–¹æ³•å¯ä»¥ä¸€æ¬¡è¯»å–ä¸€è¡Œæ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—ç¬¦åœ°è¯»å–ã€‚

BufferedWriter ç±»ç»§æ‰¿è‡ª Writer ç±»ï¼Œæä¾›äº†ä¸€äº›ä¾¿æ·çš„æ–¹æ³•ï¼Œä¾‹å¦‚ `newLine()` æ–¹æ³•å¯ä»¥å†™å…¥ä¸€ä¸ªç³»ç»Ÿç‰¹å®šçš„è¡Œåˆ†éš”ç¬¦ã€‚

#### 1ï¼‰æ„é€ æ–¹æ³•

*   `BufferedReader(Reader in)` ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç¼“å†²è¾“å…¥æµï¼Œæ³¨æ„å‚æ•°ç±»å‹ä¸º**Reader**ã€‚
*   `BufferedWriter(Writer out)`ï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„ç¼“å†²è¾“å‡ºæµï¼Œæ³¨æ„å‚æ•°ç±»å‹ä¸º**Writer**ã€‚

ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
// åˆ›å»ºå­—ç¬¦ç¼“å†²è¾“å…¥æµ
BufferedReader br = new BufferedReader(new FileReader("b.txt"));
// åˆ›å»ºå­—ç¬¦ç¼“å†²è¾“å‡ºæµ
BufferedWriter bw = new BufferedWriter(new FileWriter("b.txt"));
```

#### 2ï¼‰å­—ç¬¦ç¼“å†²æµç‰¹æœ‰æ–¹æ³•

å­—ç¬¦ç¼“å†²æµçš„åŸºæœ¬æ–¹æ³•ä¸[æ™®é€šå­—ç¬¦æµ](https://tobebetterjavaer.com/io/reader-writer.html)è°ƒç”¨æ–¹å¼ä¸€è‡´ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï¼Œæˆ‘ä»¬æ¥çœ‹å­—ç¬¦ç¼“å†²æµ**ç‰¹æœ‰**çš„æ–¹æ³•ã€‚

*   BufferedReaderï¼š`String readLine()`: **è¯»ä¸€è¡Œæ•°æ®**ï¼Œè¯»å–åˆ°æœ€åè¿”å› null
*   BufferedWriterï¼š`newLine()`: **æ¢è¡Œ**ï¼Œç”±ç³»ç»Ÿå®šä¹‰æ¢è¡Œç¬¦ã€‚

æ¥çœ‹ `readLine()`æ–¹æ³•çš„ä»£ç ç¤ºä¾‹ï¼š

```java
// åˆ›å»ºæµå¯¹è±¡
BufferedReader br = new BufferedReader(new FileReader("a.txt"));
// å®šä¹‰å­—ç¬¦ä¸²,ä¿å­˜è¯»å–çš„ä¸€è¡Œæ–‡å­—
String line  = null;
// å¾ªç¯è¯»å–,è¯»å–åˆ°æœ€åè¿”å›null
while ((line = br.readLine())!=null) {
    System.out.print(line);
    System.out.println("------");
}
// é‡Šæ”¾èµ„æº
br.close();
```

å†æ¥çœ‹ `newLine()` æ–¹æ³•çš„ä»£ç ç¤ºä¾‹ï¼š

```java
// åˆ›å»ºæµå¯¹è±¡
BfferedWriter bw = new BufferedWriter(new FileWriter("b.txt"));
// å†™å‡ºæ•°æ®
bw.write("æ²‰");
// å†™å‡ºæ¢è¡Œ
bw.newLine();
bw.write("é»˜");
bw.newLine();
bw.write("ç‹");
bw.newLine();
bw.write("äºŒ");
bw.newLine();
// é‡Šæ”¾èµ„æº
bw.close();
```

### 03ã€å­—ç¬¦ç¼“å†²æµç»ƒä¹ 

æ¥æ¬£èµä¸€ä¸‹æˆ‘å†™çš„è¿™ç¯‡è¯—ï¼š

> 6.å²‘å¤«å­ï¼Œä¸¹ä¸˜ç”Ÿï¼Œå°†è¿›é…’ï¼Œæ¯è«åœã€‚
> 
> 1.å›ä¸è§é»„æ²³ä¹‹æ°´å¤©ä¸Šæ¥ï¼Œå¥”æµåˆ°æµ·ä¸å¤å›ã€‚
> 
> 8.é’Ÿé¼“é¦”ç‰ä¸è¶³è´µï¼Œä½†æ„¿é•¿é†‰ä¸æ„¿é†’ã€‚
> 
> 3.äººç”Ÿå¾—æ„é¡»å°½æ¬¢ï¼Œè«ä½¿é‡‘æ¨½ç©ºå¯¹æœˆã€‚
> 
> 5.çƒ¹ç¾Šå®°ç‰›ä¸”ä¸ºä¹ï¼Œä¼šé¡»ä¸€é¥®ä¸‰ç™¾æ¯ã€‚
> 
> 2.å›ä¸è§é«˜å ‚æ˜é•œæ‚²ç™½å‘ï¼Œæœå¦‚é’ä¸æš®æˆé›ªã€‚
> 
> 7.ä¸å›æ­Œä¸€æ›²ï¼Œè¯·å›ä¸ºæˆ‘å€¾è€³å¬ã€‚
> 
> 4.å¤©ç”Ÿæˆ‘æå¿…æœ‰ç”¨ï¼Œåƒé‡‘æ•£å°½è¿˜å¤æ¥ã€‚

æ¬£èµå®Œäº†æ²¡ï¼Ÿ

ä¼°è®¡ä½ ä¹Ÿçœ‹å‡ºæ¥äº†ï¼Œè¿™æ˜¯æç™½å†™çš„ã€Šå°†è¿›é…’ã€‹ï¼Œä¸æ˜¯æˆ‘ç‹äºŒå†™çš„ã€‚ğŸ˜

ä¸è¿‡ï¼Œé¡ºåºæ˜¯ä¹±çš„ï¼Œè¿˜å¥½ï¼Œæˆ‘éƒ½ç¼–äº†å·ã€‚é‚£å¦‚ä½•æ‰èƒ½æŒ‰ç…§æ­£ç¡®çš„é¡ºåºæ¥å‘¢ï¼Ÿ

æ¥çœ‹ä»£ç å®ç°ï¼š

```java
// åˆ›å»ºmapé›†åˆ,ä¿å­˜æ–‡æœ¬æ•°æ®,é”®ä¸ºåºå·,å€¼ä¸ºæ–‡å­—
HashMap<String, String> lineMap = new HashMap<>();

// åˆ›å»ºæµå¯¹è±¡  æº
BufferedReader br = new BufferedReader(new FileReader("logs/test.log"));
//ç›®æ ‡
BufferedWriter bw = new BufferedWriter(new FileWriter("logs/test1.txt"));

// è¯»å–æ•°æ®
String line;
while ((line = br.readLine())!=null) {
    // è§£ææ–‡æœ¬
    if (line.isEmpty()) {
        continue;
    }
    String[] split = line.split(Pattern.quote("."));
    // ä¿å­˜åˆ°é›†åˆ
    lineMap.put(split[0], split[1]);
}
// é‡Šæ”¾èµ„æº
br.close();

// éå†mapé›†åˆ
for (int i = 1; i <= lineMap.size(); i++) {
    String key = String.valueOf(i);
    // è·å–mapä¸­æ–‡æœ¬
    String value = lineMap.get(key);
    // å†™å‡ºæ‹¼æ¥æ–‡æœ¬
    bw.write(key+"."+value);
    // å†™å‡ºæ¢è¡Œ
    bw.newLine();
}
// é‡Šæ”¾èµ„æº
bw.close();
```

è¿™é‡Œé¢ç”¨åˆ°çš„çŸ¥è¯†éƒ½æ˜¯æˆ‘ä»¬å‰é¢å­¦è¿‡çš„ï¼Œæ¯”å¦‚è¯´ [HashMap](https://tobebetterjavaer.com/collection/hashmap.html)ï¼Œ[å­—ç¬¦ä¸²åˆ†å‰²](https://tobebetterjavaer.com/string/split.html)ï¼ŒåŒ…æ‹¬åˆšåˆšå­¦ä¹ çš„å­—ç¬¦ç¼“å†²æµã€‚
 

æ¥çœ‹è¾“å‡ºç»“æœ

```
1.å›ä¸è§é»„æ²³ä¹‹æ°´å¤©ä¸Šæ¥ï¼Œå¥”æµåˆ°æµ·ä¸å¤å›ã€‚
2.å›ä¸è§é«˜å ‚æ˜é•œæ‚²ç™½å‘ï¼Œæœå¦‚é’ä¸æš®æˆé›ªã€‚
3.äººç”Ÿå¾—æ„é¡»å°½æ¬¢ï¼Œè«ä½¿é‡‘æ¨½ç©ºå¯¹æœˆã€‚
4.å¤©ç”Ÿæˆ‘æå¿…æœ‰ç”¨ï¼Œåƒé‡‘æ•£å°½è¿˜å¤æ¥ã€‚
5.çƒ¹ç¾Šå®°ç‰›ä¸”ä¸ºä¹ï¼Œä¼šé¡»ä¸€é¥®ä¸‰ç™¾æ¯ã€‚
6.å²‘å¤«å­ï¼Œä¸¹ä¸˜ç”Ÿï¼Œå°†è¿›é…’ï¼Œæ¯è«åœã€‚
7.ä¸å›æ­Œä¸€æ›²ï¼Œè¯·å›ä¸ºæˆ‘å€¾è€³å¬ã€‚
8.é’Ÿé¼“é¦”ç‰ä¸è¶³è´µï¼Œä½†æ„¿é•¿é†‰ä¸æ„¿é†’ã€‚
```

---------

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)


å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)