---
title: æˆ‘æœ‰ 7ç§ å®ç°webå®æ—¶æ¶ˆæ¯æ¨é€çš„æ–¹æ¡ˆï¼Œ7ç§ï¼
shortTitle: æˆ‘æœ‰ 7ç§ å®ç°webå®æ—¶æ¶ˆæ¯æ¨é€çš„æ–¹æ¡ˆï¼Œ7ç§ï¼
description: æˆ‘æœ‰ä¸€ä¸ªæœ‹å‹ï½åšäº†ä¸€ä¸ªå°ç ´ç«™ï¼Œç°åœ¨è¦å®ç°ä¸€ä¸ªç«™å†…ä¿¡webæ¶ˆæ¯æ¨é€çš„åŠŸèƒ½
author: ç¨‹åºå‘˜å†…ç‚¹äº‹
category:
  - å¾®ä¿¡å…¬ä¼—å·
head:
  - - meta
    - name: description
      content: æˆ‘æœ‰ä¸€ä¸ªæœ‹å‹ï½åšäº†ä¸€ä¸ªå°ç ´ç«™ï¼Œç°åœ¨è¦å®ç°ä¸€ä¸ªç«™å†…ä¿¡webæ¶ˆæ¯æ¨é€çš„åŠŸèƒ½
---

**å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°å¯Œï½**

æˆ‘æœ‰ä¸€ä¸ªæœ‹å‹ï½

åšäº†ä¸€ä¸ªå°ç ´ç«™ï¼Œç°åœ¨è¦å®ç°ä¸€ä¸ªç«™å†…ä¿¡webæ¶ˆæ¯æ¨é€çš„åŠŸèƒ½ï¼Œå¯¹ï¼Œå°±æ˜¯ä¸‹å›¾è¿™ä¸ªå°çº¢ç‚¹ï¼Œä¸€ä¸ªå¾ˆå¸¸ç”¨çš„åŠŸèƒ½ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-7dad1821-bd37-4e47-80fc-b09db54c1a71.jpg)

ä¸è¿‡ä»–è¿˜æ²¡æƒ³å¥½ç”¨ä»€ä¹ˆæ–¹å¼åšï¼Œè¿™é‡Œæˆ‘å¸®ä»–æ•´ç†äº†ä¸€ä¸‹å‡ ç§æ–¹æ¡ˆï¼Œå¹¶ç®€å•åšäº†å®ç°ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-6509c4d3-7c5f-4b6e-95e9-4e9482133d21.jpg)

### ä»€ä¹ˆæ˜¯æ¶ˆæ¯æ¨é€ï¼ˆpushï¼‰

æ¨é€çš„åœºæ™¯æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚æœ‰äººå…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼Œè¿™æ—¶æˆ‘å°±ä¼šæ”¶åˆ°ä¸€æ¡æ¨é€æ¶ˆæ¯ï¼Œä»¥æ­¤æ¥å¸å¼•æˆ‘ç‚¹å‡»æ‰“å¼€åº”ç”¨ã€‚

æ¶ˆæ¯æ¨é€(`push`)é€šå¸¸æ˜¯æŒ‡ç½‘ç«™çš„è¿è¥å·¥ä½œç­‰äººå‘˜ï¼Œé€šè¿‡æŸç§å·¥å…·å¯¹ç”¨æˆ·å½“å‰ç½‘é¡µæˆ–ç§»åŠ¨è®¾å¤‡APPè¿›è¡Œçš„ä¸»åŠ¨æ¶ˆæ¯æ¨é€ã€‚

æ¶ˆæ¯æ¨é€ä¸€èˆ¬åˆåˆ†ä¸º`webç«¯æ¶ˆæ¯æ¨é€`å’Œ`ç§»åŠ¨ç«¯æ¶ˆæ¯æ¨é€`ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-45d8c9ae-666f-468b-b8c5-2a04a1762a4e.jpg)

ä¸Šè¾¹çš„è¿™ç§å±äºç§»åŠ¨ç«¯æ¶ˆæ¯æ¨é€ï¼Œwebç«¯æ¶ˆæ¯æ¨é€å¸¸è§çš„è¯¸å¦‚ç«™å†…ä¿¡ã€æœªè¯»é‚®ä»¶æ•°é‡ã€ç›‘æ§æŠ¥è­¦æ•°é‡ç­‰ï¼Œåº”ç”¨çš„ä¹Ÿéå¸¸å¹¿æ³›ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-f6ca6bd4-63d8-4081-9348-ca48a68aaf09.jpg)

åœ¨å…·ä½“å®ç°ä¹‹å‰ï¼Œå’±ä»¬å†æ¥åˆ†æä¸€ä¸‹å‰è¾¹çš„éœ€æ±‚ï¼Œå…¶å®åŠŸèƒ½å¾ˆç®€å•ï¼Œåªè¦è§¦å‘æŸä¸ªäº‹ä»¶ï¼ˆä¸»åŠ¨åˆ†äº«äº†èµ„æºæˆ–è€…åå°ä¸»åŠ¨æ¨é€æ¶ˆæ¯ï¼‰ï¼Œwebé¡µé¢çš„é€šçŸ¥å°çº¢ç‚¹å°±ä¼šå®æ—¶çš„`+1`å°±å¯ä»¥äº†ã€‚

é€šå¸¸åœ¨æœåŠ¡ç«¯ä¼šæœ‰è‹¥å¹²å¼ æ¶ˆæ¯æ¨é€è¡¨ï¼Œç”¨æ¥è®°å½•ç”¨æˆ·è§¦å‘ä¸åŒäº‹ä»¶æ‰€æ¨é€ä¸åŒç±»å‹çš„æ¶ˆæ¯ï¼Œå‰ç«¯ä¸»åŠ¨æŸ¥è¯¢ï¼ˆæ‹‰ï¼‰æˆ–è€…è¢«åŠ¨æ¥æ”¶ï¼ˆæ¨ï¼‰ç”¨æˆ·æ‰€æœ‰æœªè¯»çš„æ¶ˆæ¯æ•°ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-d73b5ed2-78e4-48f4-a5b0-edc2a078be8f.jpg)

æ¶ˆæ¯æ¨é€æ— éæ˜¯æ¨ï¼ˆ`push`ï¼‰å’Œæ‹‰ï¼ˆ`pull`ï¼‰ä¸¤ç§å½¢å¼ï¼Œä¸‹è¾¹æˆ‘ä»¬é€ä¸ªäº†è§£ä¸‹ã€‚

### çŸ­è½®è¯¢

è½®è¯¢(`polling`)åº”è¯¥æ˜¯å®ç°æ¶ˆæ¯æ¨é€æ–¹æ¡ˆä¸­æœ€ç®€å•çš„ä¸€ç§ï¼Œè¿™é‡Œæˆ‘ä»¬æš‚ä¸”å°†è½®è¯¢åˆ†ä¸º`çŸ­è½®è¯¢`å’Œ`é•¿è½®è¯¢`ã€‚

çŸ­è½®è¯¢å¾ˆå¥½ç†è§£ï¼ŒæŒ‡å®šçš„æ—¶é—´é—´éš”ï¼Œç”±æµè§ˆå™¨å‘æœåŠ¡å™¨å‘å‡º`HTTP`è¯·æ±‚ï¼ŒæœåŠ¡å™¨å®æ—¶è¿”å›æœªè¯»æ¶ˆæ¯æ•°æ®ç»™å®¢æˆ·ç«¯ï¼Œæµè§ˆå™¨å†åšæ¸²æŸ“æ˜¾ç¤ºã€‚

ä¸€ä¸ªç®€å•çš„JSå®šæ—¶å™¨å°±å¯ä»¥æå®šï¼Œæ¯ç§’é’Ÿè¯·æ±‚ä¸€æ¬¡æœªè¯»æ¶ˆæ¯æ•°æ¥å£ï¼Œè¿”å›çš„æ•°æ®å±•ç¤ºå³å¯ã€‚

```
setInterval(()Â =>Â {Â Â //Â æ–¹æ³•è¯·æ±‚Â Â messageCount().then((res)Â =>Â {Â Â Â Â Â Â ifÂ (res.codeÂ ===Â 200)Â {Â Â Â Â Â Â Â Â Â Â this.messageCountÂ =Â res.dataÂ Â Â Â Â Â }Â Â })},Â 1000);
```

æ•ˆæœè¿˜æ˜¯å¯ä»¥çš„ï¼ŒçŸ­è½®è¯¢å®ç°å›ºç„¶ç®€å•ï¼Œç¼ºç‚¹ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§ï¼Œç”±äºæ¨é€æ•°æ®å¹¶ä¸ä¼šé¢‘ç¹å˜æ›´ï¼Œæ— è®ºåç«¯æ­¤æ—¶æ˜¯å¦æœ‰æ–°çš„æ¶ˆæ¯äº§ç”Ÿï¼Œå®¢æˆ·ç«¯éƒ½ä¼šè¿›è¡Œè¯·æ±‚ï¼ŒåŠ¿å¿…ä¼šå¯¹æœåŠ¡ç«¯é€ æˆå¾ˆå¤§å‹åŠ›ï¼Œæµªè´¹å¸¦å®½å’ŒæœåŠ¡å™¨èµ„æºã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-c78a59e3-cb09-47be-a50d-d8125c7b6f7a.jpg)

### é•¿è½®è¯¢

é•¿è½®è¯¢æ˜¯å¯¹ä¸Šè¾¹çŸ­è½®è¯¢çš„ä¸€ç§æ”¹è¿›ç‰ˆæœ¬ï¼Œåœ¨å°½å¯èƒ½å‡å°‘å¯¹æœåŠ¡å™¨èµ„æºæµªè´¹çš„åŒæ—¶ï¼Œä¿è¯æ¶ˆæ¯çš„ç›¸å¯¹å®æ—¶æ€§ã€‚é•¿è½®è¯¢åœ¨ä¸­é—´ä»¶ä¸­åº”ç”¨çš„å¾ˆå¹¿æ³›ï¼Œæ¯”å¦‚`Nacos`å’Œ`apollo`é…ç½®ä¸­å¿ƒï¼Œæ¶ˆæ¯é˜Ÿåˆ—`kafka`ã€`RocketMQ`ä¸­éƒ½æœ‰ç”¨åˆ°é•¿è½®è¯¢ã€‚

[Nacosé…ç½®ä¸­å¿ƒäº¤äº’æ¨¡å‹æ˜¯pushè¿˜æ˜¯pullï¼Ÿ](https://mp.weixin.qq.com/s?__biz=MzAxNTM4NzAyNg==&mid=2247494748&idx=1&sn=2cccdbc6269ea01e75012340af1496ef&scene=21#wechat_redirect)ä¸€æ–‡ä¸­æˆ‘è¯¦ç»†ä»‹ç»è¿‡`Nacos`é•¿è½®è¯¢çš„å®ç°åŸç†ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥ç…ç…ã€‚

è¿™æ¬¡æˆ‘ä½¿ç”¨`apollo`é…ç½®ä¸­å¿ƒå®ç°é•¿è½®è¯¢çš„æ–¹å¼ï¼Œåº”ç”¨äº†ä¸€ä¸ªç±»`DeferredResult`ï¼Œå®ƒæ˜¯åœ¨`servelet3.0`åç»è¿‡Springå°è£…æä¾›çš„ä¸€ç§å¼‚æ­¥è¯·æ±‚æœºåˆ¶ï¼Œç›´æ„å°±æ˜¯å»¶è¿Ÿç»“æœã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-6fe55cf8-0929-4360-9ebc-baa2fa203a32.jpg)

`DeferredResult`å¯ä»¥å…è®¸å®¹å™¨çº¿ç¨‹å¿«é€Ÿé‡Šæ”¾å ç”¨çš„èµ„æºï¼Œä¸é˜»å¡è¯·æ±‚çº¿ç¨‹ï¼Œä»¥æ­¤æ¥å—æ›´å¤šçš„è¯·æ±‚æå‡ç³»ç»Ÿçš„ååé‡ï¼Œç„¶åå¯åŠ¨å¼‚æ­¥å·¥ä½œçº¿ç¨‹å¤„ç†çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¤„ç†å®Œæˆè°ƒç”¨`DeferredResult.setResult(200)`æäº¤å“åº”ç»“æœã€‚

ä¸‹è¾¹æˆ‘ä»¬ç”¨é•¿è½®è¯¢æ¥å®ç°æ¶ˆæ¯æ¨é€ã€‚

å› ä¸ºä¸€ä¸ªIDå¯èƒ½ä¼šè¢«å¤šä¸ªé•¿è½®è¯¢è¯·æ±‚ç›‘å¬ï¼Œæ‰€ä»¥æˆ‘é‡‡ç”¨äº†`guava`åŒ…æä¾›çš„`Multimap`ç»“æ„å­˜æ”¾é•¿è½®è¯¢ï¼Œä¸€ä¸ªkeyå¯ä»¥å¯¹åº”å¤šä¸ªvalueã€‚ä¸€æ—¦ç›‘å¬åˆ°keyå‘ç”Ÿå˜åŒ–ï¼Œå¯¹åº”çš„æ‰€æœ‰é•¿è½®è¯¢éƒ½ä¼šå“åº”ã€‚å‰ç«¯å¾—åˆ°éè¯·æ±‚è¶…æ—¶çš„çŠ¶æ€ç ï¼ŒçŸ¥æ™“æ•°æ®å˜æ›´ï¼Œä¸»åŠ¨æŸ¥è¯¢æœªè¯»æ¶ˆæ¯æ•°æ¥å£ï¼Œæ›´æ–°é¡µé¢æ•°æ®ã€‚

```
@Controller@RequestMapping("/polling")publicÂ classÂ PollingControllerÂ {Â Â Â Â //Â å­˜æ”¾ç›‘å¬æŸä¸ªIdçš„é•¿è½®è¯¢é›†åˆÂ Â Â Â //Â çº¿ç¨‹åŒæ­¥ç»“æ„Â Â Â Â publicÂ staticÂ Multimap<String,Â DeferredResult<String>>Â watchRequestsÂ =Â Multimaps.synchronizedMultimap(HashMultimap.create());Â Â Â Â /**Â Â Â Â Â *Â å…¬ä¼—å·ï¼šç¨‹åºå‘˜å°å¯ŒÂ Â Â Â Â *Â è®¾ç½®ç›‘å¬Â Â Â Â Â */Â Â Â Â @GetMapping(pathÂ =Â "watch/{id}")Â Â Â Â @ResponseBodyÂ Â Â Â publicÂ DeferredResult<String>Â watch(@PathVariableÂ StringÂ id)Â {Â Â Â Â Â Â Â Â //Â å»¶è¿Ÿå¯¹è±¡è®¾ç½®è¶…æ—¶æ—¶é—´Â Â Â Â Â Â Â Â DeferredResult<String>Â deferredResultÂ =Â newÂ DeferredResult<>(TIME_OUT);Â Â Â Â Â Â Â Â //Â å¼‚æ­¥è¯·æ±‚å®Œæˆæ—¶ç§»é™¤Â keyï¼Œé˜²æ­¢å†…å­˜æº¢å‡ºÂ Â Â Â Â Â Â Â deferredResult.onCompletion(()Â ->Â {Â Â Â Â Â Â Â Â Â Â Â Â watchRequests.remove(id,Â deferredResult);Â Â Â Â Â Â Â Â });Â Â Â Â Â Â Â Â //Â æ³¨å†Œé•¿è½®è¯¢è¯·æ±‚Â Â Â Â Â Â Â Â watchRequests.put(id,Â deferredResult);Â Â Â Â Â Â Â Â returnÂ deferredResult;Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â å…¬ä¼—å·ï¼šç¨‹åºå‘˜å°å¯ŒÂ Â Â Â Â *Â å˜æ›´æ•°æ®Â Â Â Â Â */Â Â Â Â @GetMapping(pathÂ =Â "publish/{id}")Â Â Â Â @ResponseBodyÂ Â Â Â publicÂ StringÂ publish(@PathVariableÂ StringÂ id)Â {Â Â Â Â Â Â Â Â //Â æ•°æ®å˜æ›´Â å–å‡ºç›‘å¬IDçš„æ‰€æœ‰é•¿è½®è¯¢è¯·æ±‚ï¼Œå¹¶ä¸€ä¸€å“åº”å¤„ç†Â Â Â Â Â Â Â Â ifÂ (watchRequests.containsKey(id))Â {Â Â Â Â Â Â Â Â Â Â Â Â Collection<DeferredResult<String>>Â deferredResultsÂ =Â watchRequests.get(id);Â Â Â Â Â Â Â Â Â Â Â Â forÂ (DeferredResult<String>Â deferredResultÂ :Â deferredResults)Â {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â deferredResult.setResult("æˆ‘æ›´æ–°äº†"Â +Â newÂ Date());Â Â Â Â Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â returnÂ "success";Â Â Â Â }
```

å½“è¯·æ±‚è¶…è¿‡è®¾ç½®çš„è¶…æ—¶æ—¶é—´ï¼Œä¼šæŠ›å‡º`AsyncRequestTimeoutException`å¼‚å¸¸ï¼Œè¿™é‡Œç›´æ¥ç”¨`@ControllerAdvice`å…¨å±€æ•è·ç»Ÿä¸€è¿”å›å³å¯ï¼Œå‰ç«¯è·å–çº¦å®šå¥½çš„çŠ¶æ€ç åå†æ¬¡å‘èµ·é•¿è½®è¯¢è¯·æ±‚ï¼Œå¦‚æ­¤å¾€å¤è°ƒç”¨ã€‚

```
@ControllerAdvicepublicÂ classÂ AsyncRequestTimeoutHandlerÂ {Â Â Â Â @ResponseStatus(HttpStatus.NOT_MODIFIED)Â Â Â Â @ResponseBodyÂ Â Â Â @ExceptionHandler(AsyncRequestTimeoutException.class)Â Â Â Â publicÂ StringÂ asyncRequestTimeoutHandler(AsyncRequestTimeoutExceptionÂ e)Â {Â Â Â Â Â Â Â Â System.out.println("å¼‚æ­¥è¯·æ±‚è¶…æ—¶");Â Â Â Â Â Â Â Â returnÂ "304";Â Â Â Â }}
```

æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œé¦–å…ˆé¡µé¢å‘èµ·é•¿è½®è¯¢è¯·æ±‚`/polling/watch/10086`ç›‘å¬æ¶ˆæ¯æ›´å˜ï¼Œè¯·æ±‚è¢«æŒ‚èµ·ï¼Œä¸å˜æ›´æ•°æ®ç›´è‡³è¶…æ—¶ï¼Œå†æ¬¡å‘èµ·äº†é•¿è½®è¯¢è¯·æ±‚ï¼›ç´§æ¥ç€æ‰‹åŠ¨å˜æ›´æ•°æ®`/polling/publish/10086`ï¼Œé•¿è½®è¯¢å¾—åˆ°å“åº”ï¼Œå‰ç«¯å¤„ç†ä¸šåŠ¡é€»è¾‘å®Œæˆåå†æ¬¡å‘èµ·è¯·æ±‚ï¼Œå¦‚æ­¤å¾ªç¯å¾€å¤ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-bbcdfce6-7032-4ad2-a04c-f90d7c4dbf2c.jpg)

é•¿è½®è¯¢ç›¸æ¯”äºçŸ­è½®è¯¢åœ¨æ€§èƒ½ä¸Šæå‡äº†å¾ˆå¤šï¼Œä½†ä¾ç„¶ä¼šäº§ç”Ÿè¾ƒå¤šçš„è¯·æ±‚ï¼Œè¿™æ˜¯å®ƒçš„ä¸€ç‚¹ä¸å®Œç¾çš„åœ°æ–¹ã€‚

### iframeæµ

iframeæµå°±æ˜¯åœ¨é¡µé¢ä¸­æ’å…¥ä¸€ä¸ªéšè—çš„`<iframe>`æ ‡ç­¾ï¼Œé€šè¿‡åœ¨`src`ä¸­è¯·æ±‚æ¶ˆæ¯æ•°é‡APIæ¥å£ï¼Œç”±æ­¤åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´åˆ›å»ºä¸€æ¡é•¿è¿æ¥ï¼ŒæœåŠ¡ç«¯æŒç»­å‘`iframe`ä¼ è¾“æ•°æ®ã€‚

> â€œ
> 
> ä¼ è¾“çš„æ•°æ®é€šå¸¸æ˜¯`HTML`ã€æˆ–æ˜¯å†…åµŒçš„`javascript`è„šæœ¬ï¼Œæ¥è¾¾åˆ°å®æ—¶æ›´æ–°é¡µé¢çš„æ•ˆæœã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-360e8778-af64-407c-8dcf-72308d6d1c43.jpg)

è¿™ç§æ–¹å¼å®ç°ç®€å•ï¼Œå‰ç«¯åªè¦ä¸€ä¸ª`<iframe>`æ ‡ç­¾æå®šäº†

```
<iframeÂ src="/iframe/message"Â style="display:none"></iframe>
```

æœåŠ¡ç«¯ç›´æ¥ç»„è£…htmlã€jsè„šæœ¬æ•°æ®å‘`response`å†™å…¥å°±è¡Œäº†

```
@Controller@RequestMapping("/iframe")publicÂ classÂ IframeControllerÂ {Â Â Â Â @GetMapping(pathÂ =Â "message")Â Â Â Â publicÂ voidÂ message(HttpServletResponseÂ response)Â throwsÂ IOException,Â InterruptedExceptionÂ {Â Â Â Â Â Â Â Â whileÂ (true)Â {Â Â Â Â Â Â Â Â Â Â Â Â response.setHeader("Pragma",Â "no-cache");Â Â Â Â Â Â Â Â Â Â Â Â response.setDateHeader("Expires",Â 0);Â Â Â Â Â Â Â Â Â Â Â Â response.setHeader("Cache-Control",Â "no-cache,no-store");Â Â Â Â Â Â Â Â Â Â Â Â response.setStatus(HttpServletResponse.SC_OK);Â Â Â Â Â Â Â Â Â Â Â Â response.getWriter().print("Â <scriptÂ type=\"text/javascript\">\n"Â +Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "parent.document.getElementById('clock').innerHTMLÂ =Â \""Â +Â count.get()Â +Â "\";"Â +Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "parent.document.getElementById('count').innerHTMLÂ =Â \""Â +Â count.get()Â +Â "\";"Â +Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "</script>");Â Â Â Â Â Â Â Â }Â Â Â Â }}
```

ä½†æˆ‘ä¸ªäººä¸æ¨èï¼Œå› ä¸ºå®ƒåœ¨æµè§ˆå™¨ä¸Šä¼šæ˜¾ç¤ºè¯·æ±‚æœªåŠ è½½å®Œï¼Œå›¾æ ‡ä¼šä¸åœæ—‹è½¬ï¼Œç®€ç›´æ˜¯å¼ºè¿«ç—‡æ€æ‰‹ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-b66b0eee-189a-49f0-aae6-31b549543c20.jpg)

### SSE (æˆ‘çš„æ–¹å¼)

å¾ˆå¤šäººå¯èƒ½ä¸çŸ¥é“ï¼ŒæœåŠ¡ç«¯å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯ï¼Œå…¶å®é™¤äº†å¯ä»¥ç”¨`WebSocket`è¿™ç§è€³ç†Ÿèƒ½è¯¦çš„æœºåˆ¶å¤–ï¼Œè¿˜æœ‰ä¸€ç§æœåŠ¡å™¨å‘é€äº‹ä»¶(`Server-sent events`)ï¼Œç®€ç§°`SSE`ã€‚

`SSE`å®ƒæ˜¯åŸºäº`HTTP`åè®®çš„ï¼Œæˆ‘ä»¬çŸ¥é“ä¸€èˆ¬æ„ä¹‰ä¸Šçš„HTTPåè®®æ˜¯æ— æ³•åšåˆ°æœåŠ¡ç«¯ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯çš„ï¼Œä½†SSEæ˜¯ä¸ªä¾‹å¤–ï¼Œå®ƒå˜æ¢äº†ä¸€ç§æ€è·¯ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-1668dd05-2600-431d-ac93-20e0ac4022b7.jpg)

SSEåœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´æ‰“å¼€ä¸€ä¸ªå•å‘é€šé“ï¼ŒæœåŠ¡ç«¯å“åº”çš„ä¸å†æ˜¯ä¸€æ¬¡æ€§çš„æ•°æ®åŒ…è€Œæ˜¯`text/event-stream`ç±»å‹çš„æ•°æ®æµä¿¡æ¯ï¼Œåœ¨æœ‰æ•°æ®å˜æ›´æ—¶ä»æœåŠ¡å™¨æµå¼ä¼ è¾“åˆ°å®¢æˆ·ç«¯ã€‚

æ•´ä½“çš„å®ç°æ€è·¯æœ‰ç‚¹ç±»ä¼¼äºåœ¨çº¿è§†é¢‘æ’­æ”¾ï¼Œè§†é¢‘æµä¼šè¿ç»­ä¸æ–­çš„æ¨é€åˆ°æµè§ˆå™¨ï¼Œä½ ä¹Ÿå¯ä»¥ç†è§£æˆï¼Œå®¢æˆ·ç«¯åœ¨å®Œæˆä¸€æ¬¡ç”¨æ—¶å¾ˆé•¿ï¼ˆç½‘ç»œä¸ç•…ï¼‰çš„ä¸‹è½½ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-c18f4919-8877-4afa-b20f-700141cae211.jpg)

`SSE`ä¸`WebSocket`ä½œç”¨ç›¸ä¼¼ï¼Œéƒ½å¯ä»¥å»ºç«‹æœåŠ¡ç«¯ä¸æµè§ˆå™¨ä¹‹é—´çš„é€šä¿¡ï¼Œå®ç°æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯ï¼Œä½†è¿˜æ˜¯æœ‰äº›è®¸ä¸åŒï¼š

*   SSE æ˜¯åŸºäºHTTPåè®®çš„ï¼Œå®ƒä»¬ä¸éœ€è¦ç‰¹æ®Šçš„åè®®æˆ–æœåŠ¡å™¨å®ç°å³å¯å·¥ä½œï¼›`WebSocket`éœ€å•ç‹¬æœåŠ¡å™¨æ¥å¤„ç†åè®®ã€‚
*   SSE å•å‘é€šä¿¡ï¼Œåªèƒ½ç”±æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å•å‘é€šä¿¡ï¼›webSocketå…¨åŒå·¥é€šä¿¡ï¼Œå³é€šä¿¡çš„åŒæ–¹å¯ä»¥åŒæ—¶å‘é€å’Œæ¥å—ä¿¡æ¯ã€‚
*   SSE å®ç°ç®€å•å¼€å‘æˆæœ¬ä½ï¼Œæ— éœ€å¼•å…¥å…¶ä»–ç»„ä»¶ï¼›WebSocketä¼ è¾“æ•°æ®éœ€åšäºŒæ¬¡è§£æï¼Œå¼€å‘é—¨æ§›é«˜ä¸€äº›ã€‚
*   SSE é»˜è®¤æ”¯æŒæ–­çº¿é‡è¿ï¼›WebSocketåˆ™éœ€è¦è‡ªå·±å®ç°ã€‚
*   SSE åªèƒ½ä¼ é€æ–‡æœ¬æ¶ˆæ¯ï¼ŒäºŒè¿›åˆ¶æ•°æ®éœ€è¦ç»è¿‡ç¼–ç åä¼ é€ï¼›WebSocketé»˜è®¤æ”¯æŒä¼ é€äºŒè¿›åˆ¶æ•°æ®ã€‚

**SSE ä¸ WebSocket è¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿ**

> â€œ
> 
> æŠ€æœ¯å¹¶æ²¡æœ‰å¥½åä¹‹åˆ†ï¼Œåªæœ‰å“ªä¸ªæ›´åˆé€‚

SSEå¥½åƒä¸€ç›´ä¸è¢«å¤§å®¶æ‰€ç†ŸçŸ¥ï¼Œä¸€éƒ¨åˆ†åŸå› æ˜¯å‡ºç°äº†WebSocketsï¼Œè¿™ä¸ªæä¾›äº†æ›´ä¸°å¯Œçš„åè®®æ¥æ‰§è¡ŒåŒå‘ã€å…¨åŒå·¥é€šä¿¡ã€‚å¯¹äºæ¸¸æˆã€å³æ—¶é€šä¿¡ä»¥åŠéœ€è¦åŒå‘è¿‘ä¹å®æ—¶æ›´æ–°çš„åœºæ™¯ï¼Œæ‹¥æœ‰åŒå‘é€šé“æ›´å…·å¸å¼•åŠ›ã€‚

ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸éœ€è¦ä»å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚è€Œä½ åªéœ€è¦ä¸€äº›æœåŠ¡å™¨æ“ä½œçš„æ›´æ–°ã€‚æ¯”å¦‚ï¼šç«™å†…ä¿¡ã€æœªè¯»æ¶ˆæ¯æ•°ã€çŠ¶æ€æ›´æ–°ã€è‚¡ç¥¨è¡Œæƒ…ã€ç›‘æ§æ•°é‡ç­‰åœºæ™¯ï¼Œ`SEE`ä¸ç®¡æ˜¯ä»å®ç°çš„éš¾æ˜“å’Œæˆæœ¬ä¸Šéƒ½æ›´åŠ æœ‰ä¼˜åŠ¿ã€‚æ­¤å¤–ï¼ŒSSE å…·æœ‰`WebSockets`åœ¨è®¾è®¡ä¸Šç¼ºä¹çš„å¤šç§åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š`è‡ªåŠ¨é‡æ–°è¿æ¥`ã€`äº‹ä»¶ID`å’Œ`å‘é€ä»»æ„äº‹ä»¶`çš„èƒ½åŠ›ã€‚

å‰ç«¯åªéœ€è¿›è¡Œä¸€æ¬¡HTTPè¯·æ±‚ï¼Œå¸¦ä¸Šå”¯ä¸€IDï¼Œæ‰“å¼€äº‹ä»¶æµï¼Œç›‘å¬æœåŠ¡ç«¯æ¨é€çš„äº‹ä»¶å°±å¯ä»¥äº†

```
<script>Â Â Â Â letÂ sourceÂ =Â null;Â Â Â Â letÂ userIdÂ =Â 7777Â Â Â Â ifÂ (window.EventSource)Â {Â Â Â Â Â Â Â Â //Â å»ºç«‹è¿æ¥Â Â Â Â Â Â Â Â sourceÂ =Â newÂ EventSource('http://localhost:7777/sse/sub/'+userId);Â Â Â Â Â Â Â Â setMessageInnerHTML("è¿æ¥ç”¨æˆ·="Â +Â userId);Â Â Â Â Â Â Â Â /**Â Â Â Â Â Â Â Â Â *Â è¿æ¥ä¸€æ—¦å»ºç«‹ï¼Œå°±ä¼šè§¦å‘openäº‹ä»¶Â Â Â Â Â Â Â Â Â *Â å¦ä¸€ç§å†™æ³•ï¼šsource.onopen = function (event)Â {}Â Â Â Â Â Â Â Â Â */Â Â Â Â Â Â Â Â source.addEventListener('open',Â functionÂ (e)Â {Â Â Â Â Â Â Â Â Â Â Â Â setMessageInnerHTML("å»ºç«‹è¿æ¥ã€‚ã€‚ã€‚");Â Â Â Â Â Â Â Â },Â false);Â Â Â Â Â Â Â Â /**Â Â Â Â Â Â Â Â Â *Â å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨å‘æ¥çš„æ•°æ®Â Â Â Â Â Â Â Â Â *Â å¦ä¸€ç§å†™æ³•ï¼šsource.onmessage = function (event)Â {}Â Â Â Â Â Â Â Â Â */Â Â Â Â Â Â Â Â source.addEventListener('message',Â functionÂ (e)Â {Â Â Â Â Â Â Â Â Â Â Â Â setMessageInnerHTML(e.data);Â Â Â Â Â Â Â Â });Â Â Â Â }Â elseÂ {Â Â Â Â Â Â Â Â setMessageInnerHTML("ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒSSE");Â Â Â Â }</script>
```

æœåŠ¡ç«¯çš„å®ç°æ›´ç®€å•ï¼Œåˆ›å»ºä¸€ä¸ª`SseEmitter`å¯¹è±¡æ”¾å…¥`sseEmitterMap`è¿›è¡Œç®¡ç†

```
privateÂ staticÂ Map<String,Â SseEmitter>Â sseEmitterMapÂ =Â newÂ ConcurrentHashMap<>();/**Â *Â åˆ›å»ºè¿æ¥Â *Â *Â @date:Â 2022/7/12Â 14:51Â *Â @auther:Â å…¬ä¼—å·ï¼šç¨‹åºå‘˜å°å¯ŒÂ */publicÂ staticÂ SseEmitterÂ connect(StringÂ userId)Â {Â Â Â Â tryÂ {Â Â Â Â Â Â Â Â //Â è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œ0è¡¨ç¤ºä¸è¿‡æœŸã€‚é»˜è®¤30ç§’Â Â Â Â Â Â Â Â SseEmitterÂ sseEmitterÂ =Â newÂ SseEmitter(0L);Â Â Â Â Â Â Â Â //Â æ³¨å†Œå›è°ƒÂ Â Â Â Â Â Â Â sseEmitter.onCompletion(completionCallBack(userId));Â Â Â Â Â Â Â Â sseEmitter.onError(errorCallBack(userId));Â Â Â Â Â Â Â Â sseEmitter.onTimeout(timeoutCallBack(userId));Â Â Â Â Â Â Â Â sseEmitterMap.put(userId,Â sseEmitter);Â Â Â Â Â Â Â Â count.getAndIncrement();Â Â Â Â Â Â Â Â returnÂ sseEmitter;Â Â Â Â }Â catchÂ (ExceptionÂ e)Â {Â Â Â Â Â Â Â Â log.info("åˆ›å»ºæ–°çš„sseè¿æ¥å¼‚å¸¸ï¼Œå½“å‰ç”¨æˆ·ï¼š{}",Â userId);Â Â Â Â }Â Â Â Â returnÂ null;}/**Â *Â ç»™æŒ‡å®šç”¨æˆ·å‘é€æ¶ˆæ¯Â *Â *Â @date:Â 2022/7/12Â 14:51Â *Â @auther:Â å…¬ä¼—å·ï¼šç¨‹åºå‘˜å°å¯ŒÂ */publicÂ staticÂ voidÂ sendMessage(StringÂ userId,Â StringÂ message)Â {Â Â Â Â ifÂ (sseEmitterMap.containsKey(userId))Â {Â Â Â Â Â Â Â Â tryÂ {Â Â Â Â Â Â Â Â Â Â Â Â sseEmitterMap.get(userId).send(message);Â Â Â Â Â Â Â Â }Â catchÂ (IOExceptionÂ e)Â {Â Â Â Â Â Â Â Â Â Â Â Â log.error("ç”¨æˆ·[{}]æ¨é€å¼‚å¸¸:{}",Â userId,Â e.getMessage());Â Â Â Â Â Â Â Â Â Â Â Â removeUser(userId);Â Â Â Â Â Â Â Â }Â Â Â Â }}
```

æˆ‘ä»¬æ¨¡æ‹ŸæœåŠ¡ç«¯æ¨é€æ¶ˆæ¯ï¼Œçœ‹ä¸‹å®¢æˆ·ç«¯æ”¶åˆ°äº†æ¶ˆæ¯ï¼Œå’Œæˆ‘ä»¬é¢„æœŸçš„æ•ˆæœä¸€è‡´ã€‚![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-78c18502-2b42-46fe-9414-74ab9017c5d5.jpg)

**æ³¨æ„ï¼š** SSEä¸æ”¯æŒ`IE`æµè§ˆå™¨ï¼Œå¯¹å…¶ä»–ä¸»æµæµè§ˆå™¨å…¼å®¹æ€§åšçš„è¿˜ä¸é”™ã€‚![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-0a5ab7ce-1921-414b-8ad1-d7ea4d0b2d55.jpg)

### MQTT

ä»€ä¹ˆæ˜¯ MQTTåè®®ï¼Ÿ

`MQTT` å…¨ç§°(Message Queue Telemetry Transport)ï¼šä¸€ç§åŸºäºå‘å¸ƒ/è®¢é˜…ï¼ˆ`publish`/`subscribe`ï¼‰æ¨¡å¼çš„`è½»é‡çº§`é€šè®¯åè®®ï¼Œé€šè¿‡è®¢é˜…ç›¸åº”çš„ä¸»é¢˜æ¥è·å–æ¶ˆæ¯ï¼Œæ˜¯ç‰©è”ç½‘ï¼ˆ`Internet of Thing`ï¼‰ä¸­çš„ä¸€ä¸ªæ ‡å‡†ä¼ è¾“åè®®ã€‚

è¯¥åè®®å°†æ¶ˆæ¯çš„å‘å¸ƒè€…ï¼ˆ`publisher`ï¼‰ä¸è®¢é˜…è€…ï¼ˆ`subscriber`ï¼‰è¿›è¡Œåˆ†ç¦»ï¼Œå› æ­¤å¯ä»¥åœ¨ä¸å¯é çš„ç½‘ç»œç¯å¢ƒä¸­ï¼Œä¸ºè¿œç¨‹è¿æ¥çš„è®¾å¤‡æä¾›å¯é çš„æ¶ˆæ¯æœåŠ¡ï¼Œä½¿ç”¨æ–¹å¼ä¸ä¼ ç»Ÿçš„MQæœ‰ç‚¹ç±»ä¼¼ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-5524743a-1f9f-4cde-9f0a-e30312f368b8.jpg)

`TCP`åè®®ä½äºä¼ è¾“å±‚ï¼Œ`MQTT` åè®®ä½äºåº”ç”¨å±‚ï¼Œ`MQTT` åè®®æ„å»ºäº`TCP/IP`åè®®ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦æ”¯æŒ`TCP/IP`åè®®æ ˆçš„åœ°æ–¹ï¼Œéƒ½å¯ä»¥ä½¿ç”¨`MQTT`åè®®ã€‚

ä¸ºä»€ä¹ˆè¦ç”¨ MQTTåè®®ï¼Ÿ

`MQTT`åè®®ä¸ºä»€ä¹ˆåœ¨ç‰©è”ç½‘ï¼ˆIOTï¼‰ä¸­å¦‚æ­¤å—åçˆ±ï¼Ÿè€Œä¸æ˜¯å…¶å®ƒåè®®ï¼Œæ¯”å¦‚æˆ‘ä»¬æ›´ä¸ºç†Ÿæ‚‰çš„ `HTTP`åè®®å‘¢ï¼Ÿ

*   é¦–å…ˆ`HTTP`åè®®å®ƒæ˜¯ä¸€ç§åŒæ­¥åè®®ï¼Œå®¢æˆ·ç«¯è¯·æ±‚åéœ€è¦ç­‰å¾…æœåŠ¡å™¨çš„å“åº”ã€‚è€Œåœ¨ç‰©è”ç½‘ï¼ˆIOTï¼‰ç¯å¢ƒä¸­ï¼Œè®¾å¤‡ä¼šå¾ˆå—åˆ¶äºç¯å¢ƒçš„å½±å“ï¼Œæ¯”å¦‚å¸¦å®½ä½ã€ç½‘ç»œå»¶è¿Ÿé«˜ã€ç½‘ç»œé€šä¿¡ä¸ç¨³å®šç­‰ï¼Œæ˜¾ç„¶å¼‚æ­¥æ¶ˆæ¯åè®®æ›´ä¸ºé€‚åˆ`IOT`åº”ç”¨ç¨‹åºã€‚
*   `HTTP`æ˜¯å•å‘çš„ï¼Œå¦‚æœè¦è·å–æ¶ˆæ¯å®¢æˆ·ç«¯å¿…é¡»å‘èµ·è¿æ¥ï¼Œè€Œåœ¨ç‰©è”ç½‘ï¼ˆIOTï¼‰åº”ç”¨ç¨‹åºä¸­ï¼Œè®¾å¤‡æˆ–ä¼ æ„Ÿå™¨å¾€å¾€éƒ½æ˜¯å®¢æˆ·ç«¯ï¼Œè¿™æ„å‘³ç€å®ƒä»¬æ— æ³•è¢«åŠ¨åœ°æ¥æ”¶æ¥è‡ªç½‘ç»œçš„å‘½ä»¤ã€‚
*   é€šå¸¸éœ€è¦å°†ä¸€æ¡å‘½ä»¤æˆ–è€…æ¶ˆæ¯ï¼Œå‘é€åˆ°ç½‘ç»œä¸Šçš„æ‰€æœ‰è®¾å¤‡ä¸Šã€‚`HTTP`è¦å®ç°è¿™æ ·çš„åŠŸèƒ½ä¸ä½†å¾ˆå›°éš¾ï¼Œè€Œä¸”æˆæœ¬æé«˜ã€‚

å…·ä½“çš„MQTTåè®®ä»‹ç»å’Œå®è·µï¼Œè¿™é‡Œæˆ‘å°±ä¸å†èµ˜è¿°äº†ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„ä¸¤ç¯‡æ–‡ç« ï¼Œé‡Œè¾¹å†™çš„ä¹Ÿéƒ½å¾ˆè¯¦ç»†äº†ã€‚

MQTTåè®®çš„ä»‹ç»

[æˆ‘ä¹Ÿæ²¡æƒ³åˆ° springboot + rabbitmq åšæ™ºèƒ½å®¶å±…ï¼Œä¼šè¿™ä¹ˆç®€å•](https://mp.weixin.qq.com/s?__biz=MzAxNTM4NzAyNg==&mid=2247486353&idx=1&sn=02371acc8048cb15f29285f0505c4958&scene=21#wechat_redirect)

MQTTå®ç°æ¶ˆæ¯æ¨é€

[æœªè¯»æ¶ˆæ¯ï¼ˆå°çº¢ç‚¹ï¼‰ï¼Œå‰ç«¯ ä¸ RabbitMQ å®æ—¶æ¶ˆæ¯æ¨é€å®è·µï¼Œè´¼ç®€å•~](https://mp.weixin.qq.com/s?__biz=MzAxNTM4NzAyNg==&mid=2247487818&idx=1&sn=19393de4304e1ddd3179d0e45ec16cd7&scene=21#wechat_redirect)

### Websocket

`websocket`åº”è¯¥æ˜¯å¤§å®¶éƒ½æ¯”è¾ƒç†Ÿæ‚‰çš„ä¸€ç§å®ç°æ¶ˆæ¯æ¨é€çš„æ–¹å¼ï¼Œä¸Šè¾¹æˆ‘ä»¬åœ¨è®²SSEçš„æ—¶å€™ä¹Ÿå’Œwebsocketè¿›è¡Œè¿‡æ¯”è¾ƒã€‚

WebSocketæ˜¯ä¸€ç§åœ¨`TCP`è¿æ¥ä¸Šè¿›è¡Œå…¨åŒå·¥é€šä¿¡çš„åè®®ï¼Œå»ºç«‹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ¸ é“ã€‚æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä»…éœ€ä¸€æ¬¡æ¡æ‰‹ï¼Œä¸¤è€…ä¹‹é—´å°±ç›´æ¥å¯ä»¥åˆ›å»ºæŒä¹…æ€§çš„è¿æ¥ï¼Œå¹¶è¿›è¡ŒåŒå‘æ•°æ®ä¼ è¾“ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-5c924827-2ada-4e25-bc89-a67b746b2ae8.jpg)

å›¾ç‰‡æºäºç½‘ç»œ

springbootæ•´åˆwebsocketï¼Œå…ˆå¼•å…¥`websocket`ç›¸å…³çš„å·¥å…·åŒ…ï¼Œå’ŒSSEç›¸æ¯”é¢å¤–çš„å¼€å‘æˆæœ¬ã€‚

```
<!--Â å¼•å…¥websocketÂ --><dependency>Â Â Â Â <groupId>org.springframework.boot</groupId>Â Â Â Â <artifactId>spring-boot-starter-websocket</artifactId></dependency>
```

æœåŠ¡ç«¯ä½¿ç”¨`@ServerEndpoint`æ³¨è§£æ ‡æ³¨å½“å‰ç±»ä¸ºä¸€ä¸ªwebsocketæœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡`ws://localhost:7777/webSocket/10086`æ¥è¿æ¥åˆ°WebSocketæœåŠ¡å™¨ç«¯ã€‚

```
@Component@Slf4j@ServerEndpoint("/websocket/{userId}")publicÂ classÂ WebSocketServerÂ {Â Â Â Â //ä¸æŸä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ä¼šè¯ï¼Œéœ€è¦é€šè¿‡å®ƒæ¥ç»™å®¢æˆ·ç«¯å‘é€æ•°æ®Â Â Â Â privateÂ SessionÂ session;Â Â Â Â privateÂ staticÂ finalÂ CopyOnWriteArraySet<WebSocketServer>Â webSocketsÂ =Â newÂ CopyOnWriteArraySet<>();Â Â Â Â //Â ç”¨æ¥å­˜åœ¨çº¿è¿æ¥æ•°Â Â Â Â privateÂ staticÂ finalÂ Map<String,Â Session>Â sessionPoolÂ =Â newÂ HashMap<String,Â Session>();Â Â Â Â /**Â Â Â Â Â *Â å…¬ä¼—å·ï¼šç¨‹åºå‘˜å°å¯ŒÂ Â Â Â Â *Â é“¾æ¥æˆåŠŸè°ƒç”¨çš„æ–¹æ³•Â Â Â Â Â */Â Â Â Â @OnOpenÂ Â Â Â publicÂ voidÂ onOpen(SessionÂ session,Â @PathParam(valueÂ =Â "userId")Â StringÂ userId)Â {Â Â Â Â Â Â Â Â tryÂ {Â Â Â Â Â Â Â Â Â Â Â Â this.sessionÂ =Â session;Â Â Â Â Â Â Â Â Â Â Â Â webSockets.add(this);Â Â Â Â Â Â Â Â Â Â Â Â sessionPool.put(userId,Â session);Â Â Â Â Â Â Â Â Â Â Â Â log.info("websocketæ¶ˆæ¯:Â æœ‰æ–°çš„è¿æ¥ï¼Œæ€»æ•°ä¸º:"Â +Â webSockets.size());Â Â Â Â Â Â Â Â }Â catchÂ (ExceptionÂ e)Â {Â Â Â Â Â Â Â Â }Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â å…¬ä¼—å·ï¼šç¨‹åºå‘˜å°å¯ŒÂ Â Â Â Â *Â æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯åè°ƒç”¨çš„æ–¹æ³•Â Â Â Â Â */Â Â Â Â @OnMessageÂ Â Â Â publicÂ voidÂ onMessage(StringÂ message)Â {Â Â Â Â Â Â Â Â log.info("websocketæ¶ˆæ¯:Â æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯:"Â +Â message);Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â å…¬ä¼—å·ï¼šç¨‹åºå‘˜å°å¯ŒÂ Â Â Â Â *Â æ­¤ä¸ºå•ç‚¹æ¶ˆæ¯Â Â Â Â Â */Â Â Â Â publicÂ voidÂ sendOneMessage(StringÂ userId,Â StringÂ message)Â {Â Â Â Â Â Â Â Â SessionÂ sessionÂ =Â sessionPool.get(userId);Â Â Â Â Â Â Â Â ifÂ (sessionÂ !=Â nullÂ &&Â session.isOpen())Â {Â Â Â Â Â Â Â Â Â Â Â Â tryÂ {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â log.info("websocketæ¶ˆ:Â å•ç‚¹æ¶ˆæ¯:"Â +Â message);Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â session.getAsyncRemote().sendText(message);Â Â Â Â Â Â Â Â Â Â Â Â }Â catchÂ (ExceptionÂ e)Â {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â e.printStackTrace();Â Â Â Â Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â }Â Â Â Â }}
```

å‰ç«¯åˆå§‹åŒ–æ‰“å¼€WebSocketè¿æ¥ï¼Œå¹¶ç›‘å¬è¿æ¥çŠ¶æ€ï¼Œæ¥æ”¶æœåŠ¡ç«¯æ•°æ®æˆ–å‘æœåŠ¡ç«¯å‘é€æ•°æ®ã€‚

```
<script>Â Â Â Â varÂ wsÂ =Â newÂ WebSocket('ws://localhost:7777/webSocket/10086');Â Â Â Â //Â è·å–è¿æ¥çŠ¶æ€Â Â Â Â console.log('wsè¿æ¥çŠ¶æ€ï¼š'Â +Â ws.readyState);Â Â Â Â //ç›‘å¬æ˜¯å¦è¿æ¥æˆåŠŸÂ Â Â Â ws.onopenÂ =Â functionÂ ()Â {Â Â Â Â Â Â Â Â console.log('wsè¿æ¥çŠ¶æ€ï¼š'Â +Â ws.readyState);Â Â Â Â Â Â Â Â //è¿æ¥æˆåŠŸåˆ™å‘é€ä¸€ä¸ªæ•°æ®Â Â Â Â Â Â Â Â ws.send('test1');Â Â Â Â }Â Â Â Â //Â æ¥å¬æœåŠ¡å™¨å‘å›çš„ä¿¡æ¯å¹¶å¤„ç†å±•ç¤ºÂ Â Â Â ws.onmessageÂ =Â functionÂ (data)Â {Â Â Â Â Â Â Â Â console.log('æ¥æ”¶åˆ°æ¥è‡ªæœåŠ¡å™¨çš„æ¶ˆæ¯ï¼š');Â Â Â Â Â Â Â Â console.log(data);Â Â Â Â Â Â Â Â //å®Œæˆé€šä¿¡åå…³é—­WebSocketè¿æ¥Â Â Â Â Â Â Â Â ws.close();Â Â Â Â }Â Â Â Â //Â ç›‘å¬è¿æ¥å…³é—­äº‹ä»¶Â Â Â Â ws.oncloseÂ =Â functionÂ ()Â {Â Â Â Â Â Â Â Â //Â ç›‘å¬æ•´ä¸ªè¿‡ç¨‹ä¸­websocketçš„çŠ¶æ€Â Â Â Â Â Â Â Â console.log('wsè¿æ¥çŠ¶æ€ï¼š'Â +Â ws.readyState);Â Â Â Â }Â Â Â Â //Â ç›‘å¬å¹¶å¤„ç†erroräº‹ä»¶Â Â Â Â ws.onerrorÂ =Â functionÂ (error)Â {Â Â Â Â Â Â Â Â console.log(error);Â Â Â Â }Â Â Â Â functionÂ sendMessage()Â {Â Â Â Â Â Â Â Â varÂ contentÂ =Â $("#message").val();Â Â Â Â Â Â Â Â $.ajax({Â Â Â Â Â Â Â Â Â Â Â Â url:Â '/socket/publish?userId=10086&message='Â +Â content,Â Â Â Â Â Â Â Â Â Â Â Â type:Â 'GET',Â Â Â Â Â Â Â Â Â Â Â Â data:Â {Â "id":Â "7777",Â "content":Â contentÂ },Â Â Â Â Â Â Â Â Â Â Â Â success:Â functionÂ (data)Â {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â console.log(data)Â Â Â Â Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â })Â Â Â Â }</script>
```

é¡µé¢åˆå§‹åŒ–å»ºç«‹websocketè¿æ¥ï¼Œä¹‹åå°±å¯ä»¥è¿›è¡ŒåŒå‘é€šä¿¡äº†ï¼Œæ•ˆæœè¿˜ä¸é”™

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-7cdef2ca-add8-4ef1-be3c-3acab7e45f72.jpg)

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-9a99bdb6-6329-4372-8eb9-59bc8d4be64f.jpg)

### è‡ªå®šä¹‰æ¨é€

ä¸Šè¾¹æˆ‘ä»¬ç»™æˆ‘å‡ºäº†6ç§æ–¹æ¡ˆçš„åŸç†å’Œä»£ç å®ç°ï¼Œä½†åœ¨å®é™…ä¸šåŠ¡å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸èƒ½ç›²ç›®çš„ç›´æ¥æ‹¿è¿‡æ¥ç”¨ï¼Œè¿˜æ˜¯è¦ç»“åˆè‡ªèº«ç³»ç»Ÿä¸šåŠ¡çš„ç‰¹ç‚¹å’Œå®é™…åœºæ™¯æ¥é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆã€‚

æ¨é€æœ€ç›´æ¥çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨ç¬¬ä¸‰æ¨é€å¹³å°ï¼Œæ¯•ç«Ÿ**é’±èƒ½è§£å†³çš„éœ€æ±‚éƒ½ä¸æ˜¯é—®é¢˜**ï¼Œæ— éœ€å¤æ‚çš„å¼€å‘è¿ç»´ï¼Œç›´æ¥å¯ä»¥ä½¿ç”¨ï¼Œçœæ—¶ã€çœåŠ›ã€çœå¿ƒï¼ŒåƒgoEasyã€æå…‰æ¨é€éƒ½æ˜¯å¾ˆä¸é”™çš„ä¸‰æ–¹æœåŠ¡å•†ã€‚

ä¸€èˆ¬å¤§å‹å…¬å¸éƒ½æœ‰è‡ªç ”çš„æ¶ˆæ¯æ¨é€å¹³å°ï¼Œåƒæˆ‘ä»¬æœ¬æ¬¡å®ç°çš„webç«™å†…ä¿¡åªæ˜¯å¹³å°ä¸Šçš„ä¸€ä¸ªè§¦ç‚¹è€Œå·²ï¼ŒçŸ­ä¿¡ã€é‚®ä»¶ã€å¾®ä¿¡å…¬ä¼—å·ã€å°ç¨‹åºå‡¡æ˜¯å¯ä»¥è§¦è¾¾åˆ°ç”¨æˆ·çš„æ¸ é“éƒ½å¯ä»¥æ¥å…¥è¿›æ¥ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-b4a464a7-b308-498e-81f9-3418f33c396a.jpg)

å›¾ç‰‡æ¥æºäºç½‘ç»œ

æ¶ˆæ¯æ¨é€ç³»ç»Ÿå†…éƒ¨æ˜¯ç›¸å½“å¤æ‚çš„ï¼Œè¯¸å¦‚æ¶ˆæ¯å†…å®¹çš„ç»´æŠ¤å®¡æ ¸ã€åœˆå®šæ¨é€äººç¾¤ã€è§¦è¾¾è¿‡æ»¤æ‹¦æˆªï¼ˆæ¨é€çš„è§„åˆ™é¢‘æ¬¡ã€æ—¶æ®µã€æ•°é‡ã€é»‘ç™½åå•ã€å…³é”®è¯ç­‰ç­‰ï¼‰ã€æ¨é€å¤±è´¥è¡¥å¿éå¸¸å¤šçš„æ¨¡å—ï¼ŒæŠ€æœ¯ä¸Šæ¶‰åŠåˆ°å¤§æ•°æ®é‡ã€é«˜å¹¶å‘çš„åœºæ™¯ä¹Ÿå¾ˆå¤šã€‚æ‰€ä»¥æˆ‘ä»¬ä»Šå¤©çš„å®ç°æ–¹å¼åœ¨è¿™ä¸ªåºå¤§çš„ç³»ç»Ÿé¢å‰åªæ˜¯å°æ‰“å°é—¹ã€‚

### Githubåœ°å€

æ–‡ä¸­æ‰€æåˆ°çš„æ¡ˆä¾‹æˆ‘éƒ½ä¸€ä¸€çš„åšäº†å®ç°ï¼Œæ•´ç†æ”¾åœ¨äº†`Github`ä¸Šï¼Œè§‰å¾—æœ‰ç”¨å°± **Star** ä¸€ä¸‹å§ï¼

> â€œ
> 
> ä¼ é€é—¨ï¼šhttps://github.com/chengxy-nds/Springboot-Notebook/tree/master/springboot-realtime-data



**æˆ‘æ˜¯å°å¯Œï½**ï¼Œå¦‚æœå¯¹ä½ æœ‰ç”¨**åœ¨çœ‹**ã€**å…³æ³¨**æ”¯æŒä¸‹ï¼Œå’±ä»¬ä¸‹æœŸè§~

 

  

   

    

     

      

       ![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-f8e2738f-ee37-4374-bfd3-cf9860aa5137.jpg)
      

     

    

   

   



   

    

Â å¾€æœŸæ¨èÂ 

    

**ğŸ”—**

    

[**é¢è¯•å®˜é—®ï¼šè®¢å•30åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œè‡ªåŠ¨å–æ¶ˆï¼Œè¯¥æ€ä¹ˆå®ç°ï¼Ÿ**](http://mp.weixin.qq.com/s?__biz=MzAxNTM4NzAyNg==&mid=2247497637&idx=1&sn=4bd9d411830e60aabe790b5acea71304&chksm=9b866758acf1ee4e785fea28a16e6def02aefb04e8c9a1a95ea55f1d855ab1b564a307c27977&scene=21#wechat_redirect)

    

[**å¦‚ä½•é˜²æ­¢è®¢å•é‡å¤æ”¯ä»˜**](http://mp.weixin.qq.com/s?__biz=MzAxNTM4NzAyNg==&mid=2247500377&idx=1&sn=6414da2b8956d629dd98144eef3518aa&chksm=9b8652a4acf1dbb24a517ef221b5b50f768561068be882f1a75cce1553027202404705be49de&scene=21#wechat_redirect)**[

](http://mp.weixin.qq.com/s?__biz=MzAxNTM4NzAyNg==&mid=2247500377&idx=1&sn=6414da2b8956d629dd98144eef3518aa&chksm=9b8652a4acf1dbb24a517ef221b5b50f768561068be882f1a75cce1553027202404705be49de&scene=21#wechat_redirect)**[**æˆ‘æœ‰ 10 ç§ä¿è¯æ¥å£æ•°æ®å®‰å…¨çš„æ–¹æ¡ˆ**](http://mp.weixin.qq.com/s?__biz=MzAxNTM4NzAyNg==&mid=2247500371&idx=1&sn=13f41ac6d493753f00472be5822217ab&chksm=9b8652aeacf1dbb8ae2513ae5c40106cd33f75cae9fa9ed89dede1cd5db6ea006bec96b18959&scene=21#wechat_redirect)

    

[**40ä¸ªspringbooté«˜é¢‘ä½¿ç”¨æ³¨è§£ï¼Œå¼€å‘æ•ˆç‡åˆ©å™¨**](http://mp.weixin.qq.com/s?__biz=MzAxNTM4NzAyNg==&mid=2247500339&idx=1&sn=e0015cd3573ba059d6999ad272c8dad5&chksm=9b8652ceacf1dbd8c40db756e210cd1c7a69708ded5500e449a4865d4a3f8b2cef44c6a8be19&scene=21#wechat_redirect)

    

**å®æˆ˜å¹²è´§ï¼Spring Cloud Gateway æ•´åˆ OAuth2.0 å®ç°åˆ†å¸ƒå¼ç»Ÿä¸€è®¤è¯æˆæƒï¼**

    



   

   

**åœ¨çœ‹****ã€****ç‚¹èµ****ã€****è½¬å‘****ï¼Œæ˜¯å¯¹æˆ‘æœ€å¤§çš„é¼“åŠ±**ã€‚

  

 

 

  

æ•´ç†äº†å†™æŠ€æœ¯ä¹¦ç±ï¼Œæœ‰éœ€è¦çš„åŒå­¦å…¬ä¼—å·å†…å›å¤\[Â **pdf**Â \]è‡ªå–ã€‚æŠ€æœ¯ç¾¤å¿«æ»¡äº†ï¼Œæƒ³è¿›çš„åŒå­¦å¯ä»¥åŠ æˆ‘å¥½å‹ï¼Œå’Œå¤§ä½¬ä»¬ä¸€èµ·å¹å¹æŠ€æœ¯ã€‚

  

  

   

    

     

      

       Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ä½ çš„æ¯ä¸ªèµå’Œåœ¨çœ‹ï¼Œæˆ‘éƒ½å–œæ¬¢ï¼
      

     

     

      

       ![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-woycsxwebssxxtsdfac-5bc47714-044c-4154-b66a-8ac102a2e815.jpg)

>è½¬è½½é“¾æ¥ï¼š[https://mp.weixin.qq.com/s/xQV81HiD8hkzx2wMc3ZT7A](https://mp.weixin.qq.com/s/xQV81HiD8hkzx2wMc3ZT7A)ï¼Œå‡ºå¤„ï¼šç¨‹åºå‘˜å°å¯Œï¼Œæ•´ç†ï¼šæ²‰é»˜ç‹äºŒ
