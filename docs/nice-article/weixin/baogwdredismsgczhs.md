---
title: åˆ¨æ ¹é—®åº• Redisï¼Œ é¢è¯•è¿‡ç¨‹çœŸå¥½ä½¿
shortTitle: åˆ¨æ ¹é—®åº• Redisï¼Œ é¢è¯•è¿‡ç¨‹çœŸå¥½ä½¿
author: èœå†œ
category:
  - å¾®ä¿¡å…¬ä¼—å·
---

å¤§å®¶å¥½ï¼ŒäºŒå“¥å‘€ï¼Œæ¬¢è¿æ¥åˆ°æˆ‘çš„é¢‘é“ã€‚

Redisï¼Œæ˜¯äºŒå“¥ä¸€ç›´æåˆ°çš„ Java åç«¯å¼€å‘å››å¤§ä»¶ä¹‹ä¸€ï¼Œé‡è¦ç¨‹åº¦å°±ä¸ç”¨æˆ‘å†è¿‡åˆ†å¼ºè°ƒäº†ï¼Œæœ¬ç¯‡å°†é€šè¿‡ 30 ä¸ªé—®é¢˜ï¼Œç”±æµ…å…¥æ·±ï¼Œæœ€å¤§ç¨‹åº¦ä¸Šè¦†ç›–æ•´ä¸ªRedisçš„é—®ç­”å†…å®¹ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBMEJiaINeicVO5po51KtujLkvRXbxKibt7IK2veJsicqWssPINRtDkvJia6Q/640?wx_fmt=png)

åœ¨ Web åº”ç”¨å‘å±•çš„åˆæœŸé˜¶æ®µï¼Œä¸€ä¸ªç½‘ç«™çš„è®¿é—®é‡æœ¬èº«å°±ä¸æ˜¯å¾ˆé«˜ï¼Œç›´æ¥ä½¿ç”¨å…³ç³»å‹æ•°æ®åº“å°±å¯ä»¥åº”ä»˜ç»å¤§éƒ¨åˆ†åœºæ™¯ã€‚ä½†æ˜¯éšç€äº’è”ç½‘æ—¶ä»£çš„å´›èµ·ï¼Œäººä»¬å¯¹äºç½‘ç«™è®¿é—®é€Ÿåº¦æœ‰ç€è¶Šæ¥è¶Šé«˜çš„è¦æ±‚ï¼Œç›´æ¥ä½¿ç”¨å…³ç³»å‹æ•°æ®åº“çš„æ–¹æ¡ˆåœ¨æ€§èƒ½ä¸Šå°±å‡ºç°äº†ç“¶é¢ˆã€‚å› æ­¤åœ¨å®¢æˆ·ç«¯ä¸æ•°æ®å±‚ä¹‹é—´å°±éœ€è¦ä¸€ä¸ªç¼“å­˜å±‚æ¥åˆ†æ‹…è¯·æ±‚å‹åŠ›ï¼Œè€Œ Redis ä½œä¸ºä¸€æ¬¾ä¼˜ç§€çš„ç¼“å­˜ä¸­é—´ä»¶ï¼Œåœ¨ä¼ä¸šçº§æ¶æ„ä¸­å æœ‰é‡è¦çš„åœ°ä½ï¼Œå› æ­¤ Redis ä¹Ÿä½œä¸ºé¢è¯•çš„å¿…é—®é¡¹ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBNmo8taIL9Ria7icMowvHrYW0pJsAcGic5HICbg4Eb0NiaaPDFtzsZ1icOrA/640?wx_fmt=png)


* * *

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBUibeUjnqr4zLIvHv6HeHWfCvPMroJdTD2CEiaWj63DxSgAyhxXnUAYJQ/640?wx_fmt=png)

Redisï¼ˆRemote Dictionary Serverï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„ã€é”®å€¼å¯¹å‹çš„æ•°æ®å­˜å‚¨ç³»ç»Ÿã€‚ä½¿ç”¨Cè¯­è¨€ç¼–å†™ï¼Œéµå®ˆBSDåè®®ï¼Œå¯åŸºäºå†…å­˜ä¹Ÿå¯æŒä¹…åŒ–çš„æ—¥å¿—å‹æ•°æ®åº“ï¼Œæä¾›äº†å¤šç§è¯­è¨€çš„APIï¼Œè¢«å¹¿æ³›ç”¨äºæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä¸­é—´ä»¶ã€‚å¹¶ä¸”æ”¯æŒå¤šç§ç±»å‹çš„æ•°æ®ç»“æ„ï¼Œç”¨äºåº”å¯¹å„ç§ä¸åŒåœºæ™¯ã€‚å¯ä»¥å­˜å‚¨å¤šç§ä¸åŒç±»å‹å€¼ä¹‹é—´çš„æ˜ å°„ï¼Œæ”¯æŒäº‹åŠ¡ï¼ŒæŒä¹…åŒ–ï¼ŒLUA è„šæœ¬ä»¥åŠå¤šç§é›†ç¾¤æ–¹æ¡ˆç­‰ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBK5CnA01uEEjqicEvYIYM5a6YXw0umchMiaOLdib2xNC99WrIhELiaDoEzg/640?wx_fmt=png)

**ä¼˜ç‚¹ï¼š**

1.  å®Œå…¨åŸºäºå†…å­˜æ“ä½œï¼Œæ€§èƒ½æé«˜ï¼Œè¯»å†™é€Ÿåº¦å¿«ï¼ŒRedis èƒ½å¤Ÿæ”¯æŒè¶…è¿‡ 100KB/s çš„è¯»å†™é€Ÿç‡
2.  æ”¯æŒé«˜å¹¶å‘ï¼Œæ”¯æŒ10ä¸‡çº§åˆ«çš„å¹¶å‘è¯»å†™
3.  æ”¯æŒä¸»ä»æ¨¡å¼ï¼Œæ”¯æŒè¯»å†™åˆ†ç¦»ä¸åˆ†å¸ƒå¼
4.  å…·æœ‰ä¸°å¯Œçš„æ•°æ®ç±»å‹ä¸ä¸°å¯Œçš„ç‰¹æ€§ï¼ˆå‘å¸ƒè®¢é˜…æ¨¡å¼ï¼‰
5.  æ”¯æŒæŒä¹…åŒ–æ“ä½œï¼Œä¸ä¼šä¸¢å¤±æ•°æ®

**ç¼ºç‚¹ï¼š**

1.  æ•°æ®åº“å®¹é‡å—åˆ°ç‰©ç†å†…å­˜çš„é™åˆ¶ï¼Œä¸èƒ½å®ç°æµ·é‡æ•°æ®çš„é«˜æ€§èƒ½è¯»å†™
2.  ç›¸æ¯”å…³ç³»å‹æ•°æ®åº“ï¼Œä¸æ”¯æŒå¤æ‚é€»è¾‘æŸ¥è¯¢ï¼Œä¸”å­˜å‚¨ç»“æ„ç›¸å¯¹ç®€å•
3.  è™½ç„¶æä¾›æŒä¹…åŒ–èƒ½åŠ›ï¼Œä½†å®é™…æ›´å¤šæ˜¯ä¸€ä¸ª disk-backed åŠŸèƒ½ï¼Œä¸ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„æŒä¹…åŒ–æœ‰æ‰€åŒºåˆ«

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBtzAQ6udQvY7gDRfFOQQIp7fRgNOMqSwFDvSawFibQ84asRrWJxL5LVA/640?wx_fmt=png)

> Memcache ä¹Ÿæ˜¯ä¸€ä¸ªå¼€æºã€é«˜æ€§èƒ½ã€åˆ†å¸ƒå¼å†…å­˜å¯¹è±¡ç¼“å­˜ç³»ç»Ÿã€‚æ‰€æœ‰æ•°æ®å‡å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œåœ¨æœåŠ¡å™¨é‡å¯ä¹‹åå°±ä¼šæ¶ˆå¤±ï¼Œéœ€è¦é‡æ–°åŠ è½½æ•°æ®ï¼Œé‡‡ç”¨ hash è¡¨çš„æ–¹å¼å°†æ‰€æœ‰æ•°æ®ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œé‡‡ç”¨ LRU ç®—æ³•æ¥é€æ¸æŠŠè¿‡æœŸçš„æ•°æ®æ¸…é™¤æ‰ã€‚

1.  **æ•°æ®ç±»å‹**ï¼šMemcache ä»…æ”¯æŒå­—ç¬¦ä¸²ç±»å‹ï¼ŒRedis æ”¯æŒ 5 ç§ä¸åŒçš„æ•°æ®ç±»å‹
2.  **æ•°æ®æŒä¹…åŒ–**ï¼šMemcache ä¸æ”¯æŒæŒä¹…åŒ–ï¼ŒRedis æ”¯æŒä¸¤ç§æŒä¹…åŒ–ç­–ç•¥ï¼ŒRDB å¿«ç…§ å’Œ AOF æ—¥å¿—
3.  **åˆ†å¸ƒå¼**ï¼šMemcache ä¸æ”¯æŒåˆ†å¸ƒå¼ï¼Œåªèƒ½åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œçš„æ–¹å¼æ¥å®ç°åˆ†å¸ƒå¼å­˜å‚¨ï¼ŒRedis3.0 ä¹‹åå¯åœ¨æœåŠ¡ç«¯æ„å»ºåˆ†å¸ƒå¼å­˜å‚¨ï¼ŒRedisé›†ç¾¤æ²¡æœ‰ä¸­å¿ƒèŠ‚ç‚¹ï¼Œå„ä¸ªèŠ‚ç‚¹åœ°ä½å¹³ç­‰ï¼Œå…·æœ‰çº¿æ€§å¯ä¼¸ç¼©çš„åŠŸèƒ½ã€‚
4.  **å†…å­˜ç®¡ç†æœºåˆ¶**ï¼šMemcacheæ•°æ®é‡ä¸èƒ½è¶…å‡ºç³»ç»Ÿå†…å­˜ï¼Œä½†å¯ä»¥è°ƒæ•´å†…å­˜å¤§å°ï¼Œæ·˜æ±°ç­–ç•¥é‡‡ç”¨LRUç®—æ³•ã€‚Rediså¢åŠ äº† VM ç‰¹æ€§ï¼Œå®ç°äº†ç‰©ç†å†…å­˜çš„é™åˆ¶ï¼Œå®ƒä»¬ä¹‹é—´åº•å±‚å®ç°æ–¹å¼ä»¥åŠå®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡çš„åº”ç”¨åè®®ä¸ä¸€æ ·ã€‚
5.  **æ•°æ®å¤§å°é™åˆ¶**ï¼šMemcache å•ä¸ª key-value å¤§å°æœ‰é™åˆ¶ï¼Œä¸€ä¸ªValueæœ€å¤§å®¹é‡ä¸º 1MBï¼ŒRedis æœ€å¤§å®¹é‡ä¸º512 MB

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBUhSNxXKXEaPmYknHKsqhRhxUWqfz9Hiavwda3ja4Y2KMaQcicic0BccVQ/640?wx_fmt=png)

**åŸºæœ¬æ•°æ®ç±»å‹ï¼š**

*   Stringï¼ˆå­—ç¬¦ä¸²ï¼‰
*   Hashï¼ˆå“ˆå¸Œï¼‰
*   Listï¼ˆåˆ—è¡¨ï¼‰
*   Setï¼ˆé›†åˆï¼‰
*   ZSetï¼ˆSorted Set æœ‰åºé›†åˆï¼‰

**é«˜çº§æ•°æ®ç±»å‹ï¼š**

*   HyperLogLogï¼šç”¨æ¥åšåŸºæ•°ç»Ÿè®¡çš„ç®—æ³•ï¼Œåœ¨è¾“å…¥å…ƒç´ çš„æ•°é‡æˆ–ä½“ç§¯éå¸¸å¤§æ—¶ï¼Œè®¡ç®—åŸºæ•°æ‰€éœ€çš„ç©ºé—´æ€»æ˜¯å›ºå®šçš„ï¼Œå¹¶ä¸”æ˜¯å¾ˆå°çš„ã€‚HyperLogLog åªä¼šæ ¹æ®è¾“å…¥å…ƒç´ æ¥è®¡ç®—åŸºæ•°ï¼Œè€Œä¸ä¼šå­˜å‚¨è¾“å…¥å…ƒç´ æœ¬èº«
*   Geoï¼šç”¨æ¥åœ°ç†ä½ç½®çš„å­˜å‚¨å’Œè®¡ç®—
*   BitMapï¼šå®é™…ä¸Šä¸æ˜¯ç‰¹æ®Šçš„å­˜å‚¨ç»“æ„ï¼Œæœ¬è´¨ä¸Šæ˜¯äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œå¯ä»¥è¿›è¡Œä½æ“ä½œï¼Œå¸¸ç”¨äºç»Ÿè®¡æ—¥æ´»è·ƒç”¨æˆ·ç­‰

> *æ‰©å±•ï¼š* geohashé€šè¿‡ç®—æ³•å°†1ä¸ªå®šä½çš„ç»åº¦å’Œçº¬åº¦2ä¸ªæ•°å€¼ï¼Œè½¬æ¢æˆ1ä¸ªhashå­—ç¬¦ä¸²ã€‚å¦‚æœ2ä¸ªåœ°æ–¹è·ç¦»è¶Šè¿‘ï¼Œé‚£ä¹ˆä»–ä»¬çš„hashå€¼çš„å‰ç¼€è¶Šç›¸åŒã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBNVpfbor1yic7PJ6gPVzo9v2icjTt0nNzdnZUn7jhQ9oGWt1THegtcGaA/640?wx_fmt=png)

Redis åº•å±‚å®ç°äº†ç®€å•åŠ¨æ€å­—ç¬¦ä¸²çš„ç±»å‹ï¼ˆSimple Dynamic Stringï¼ŒSDSï¼‰æ¥è¡¨ç¤º String ç±»å‹ã€‚æ²¡æœ‰ç›´æ¥ä½¿ç”¨Cè¯­è¨€å®šä¹‰çš„å­—ç¬¦ä¸²ç±»å‹ã€‚

> SDS å®ç°ç›¸å¯¹äºCè¯­è¨€Stringæ–¹å¼çš„æå‡

1.  é¿å…ç¼“å†²åŒºç§»é™¤ã€‚å¯¹å­—ç¬¦ä¿®æ”¹æ—¶ï¼Œå¯ä»¥æ ¹æ® len å±æ€§æ£€æŸ¥ç©ºé—´æ˜¯å¦æ»¡è¶³è¦æ±‚
2.  è·å–å­—ç¬¦ä¸²é•¿åº¦çš„å¤æ‚åº¦è¾ƒä½
3.  å‡å°‘å†…å­˜åˆ†é…æ¬¡æ•°
4.  å…¼å®¹Cå­—ç¬¦ä¸²å‡½æ•°ï¼Œå¯ä»¥é‡ç”¨Cè¯­è¨€åº“çš„ä¸€éƒ¨åˆ†å‡½æ•°

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBZ0WvKUGwiaYh7Y93DKibyfjHbliasf8UdLgAvIJ7sorYf0S5CWCh15iaBw/640?wx_fmt=png)

Redis ç›´æ¥ä»¥å†…å­˜çš„æ–¹å¼å­˜å‚¨å¯ä»¥è¾¾åˆ°æœ€å¿«çš„è¯»å†™é€Ÿåº¦ï¼Œå¦‚æœå¼€å¯äº†æŒä¹…åŒ–åˆ™é€šè¿‡å¼‚æ­¥çš„æ–¹å¼å°†æ•°æ®å†™å…¥ç£ç›˜ï¼Œå› æ­¤Redis å…·æœ‰å¿«é€Ÿå’Œæ•°æ®æŒä¹…åŒ–çš„ç‰¹å¾ã€‚

åœ¨å†…å­˜ä¸­æ“ä½œæœ¬èº«å°±æ¯”ä»ç£ç›˜æ“ä½œæ›´å¿«ï¼Œä¸”ä¸å—ç£ç›˜I/Oé€Ÿåº¦çš„å½±å“ã€‚å¦‚æœä¸å°†æ•°æ®æ”¾åœ¨å†…å­˜ä¸­è€Œæ˜¯ä¿å­˜åˆ°ç£ç›˜ï¼Œç£ç›˜I/Oé€Ÿåº¦ä¼šä¸¥é‡å½±å“åˆ°Redis çš„æ€§èƒ½ï¼Œè€Œæ•°æ®é›†å¤§å°å¦‚æœè¾¾åˆ°äº†å†…å­˜çš„æœ€å¤§é™å®šå€¼åˆ™ä¸èƒ½ç»§ç»­æ’å…¥æ–°å€¼ã€‚

å¦‚æœæ‰“å¼€äº†è™šæ‹Ÿå†…å­˜åŠŸèƒ½ï¼Œå½“å†…å­˜ç”¨å°½æ—¶ï¼ŒRediså°±ä¼šæŠŠé‚£äº›ä¸ç»å¸¸ä½¿ç”¨çš„æ•°æ®å­˜å‚¨åˆ°ç£ç›˜ï¼Œå¦‚æœRedisä¸­çš„è™šæ‹Ÿå†…å­˜è¢«ç¦äº†ï¼Œå®ƒå°±ä¼šæ“ä½œç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜ï¼ˆäº¤æ¢å†…å­˜ï¼‰ï¼Œä½†è¿™æ—¶Redisçš„æ€§èƒ½ä¼šæ€¥å‰§ä¸‹é™ã€‚å¦‚æœé…ç½®äº†æ·˜æ±°æœºåˆ¶ï¼Œä¼šæ ¹æ®å·²é…ç½®çš„æ•°æ®æ·˜æ±°æœºåˆ¶æ¥æ·˜æ±°æ—§æ•°æ®ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uB6Zn8xRkp7nzfzTDd06dcIdP1yX3PrcegYtB42I5VyMZV1v7NVUXZXw/640?wx_fmt=png)

1ã€**å°½å¯èƒ½ä½¿ç”¨å“ˆå¸Œè¡¨ï¼ˆhash æ•°æ®ç»“æ„ï¼‰**ï¼šRedis åœ¨å‚¨å­˜å°äº100ä¸ªå­—æ®µçš„Hashç»“æ„ä¸Šï¼Œå…¶å­˜å‚¨æ•ˆç‡æ˜¯éå¸¸é«˜çš„ã€‚æ‰€ä»¥åœ¨ä¸éœ€è¦é›†åˆï¼ˆsetï¼‰æ“ä½œæˆ– list çš„push/pop æ“ä½œçš„æ—¶å€™ï¼Œå°½å¯èƒ½ä½¿ç”¨ hash ç»“æ„ã€‚

2ã€**æ ¹æ®ä¸šåŠ¡åœºæ™¯ï¼Œè€ƒè™‘ä½¿ç”¨ BitMap**

3ã€**å……åˆ†åˆ©ç”¨å…±äº«å¯¹è±¡æ± **ï¼šRedis å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºã€0-9999ã€‘çš„æ•´æ•°å¯¹è±¡æ± ï¼Œå¯¹äº 0-9999çš„å†…éƒ¨æ•´æ•°ç±»å‹çš„å…ƒç´ ï¼Œæ•´æ•°å€¼å¯¹è±¡éƒ½ä¼šç›´æ¥å¼•ç”¨æ•´æ•°å¯¹è±¡æ± ä¸­çš„å¯¹è±¡ï¼Œå› æ­¤å°½é‡ä½¿ç”¨ 0-9999 æ•´æ•°å¯¹è±¡å¯èŠ‚çœå†…å­˜ã€‚

4ã€**åˆç†ä½¿ç”¨å†…å­˜å›æ”¶ç­–ç•¥**ï¼šè¿‡æœŸæ•°æ®æ¸…é™¤ã€expire è®¾ç½®æ•°æ®è¿‡æœŸæ—¶é—´ç­‰

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uB9UYADDrIFSibUVdEiaP6nsUIh5MxZtw6lpFvVvX4qu3sxp4S9ibvWUatg/640?wx_fmt=png)

> Redis èƒ½å¤Ÿç”¨æ¥å®ç°åˆ†å¸ƒå¼é”çš„å‘½ä»¤æœ‰ INCRã€SETNXã€SETï¼Œå¹¶åˆ©ç”¨è¿‡æœŸæ—¶é—´å‘½ä»¤ expire ä½œä¸ºè¾…åŠ©

**æ–¹å¼1ï¼šåˆ©ç”¨ INCR**

å¦‚æœ key ä¸å­˜åœ¨ï¼Œåˆ™åˆå§‹åŒ–å€¼ä¸º 0ï¼Œç„¶åå†åˆ©ç”¨ `INCR` è¿›è¡ŒåŠ  1 æ“ä½œã€‚åç»­ç”¨æˆ·å¦‚æœè·å–åˆ°çš„å€¼å¤§äºç­‰äº 1ï¼Œè¯´æ˜å·²ç»è¢«å…¶ä»–çº¿ç¨‹åŠ é”ã€‚å½“æŒæœ‰é”çš„ç”¨æˆ·åœ¨æ‰§è¡Œå®Œä»»åŠ¡åï¼Œåˆ©ç”¨ `DECR` å‘½ä»¤å°† key çš„å€¼å‡ 1ï¼Œåˆ™è¡¨ç¤ºé‡Šæ”¾é”ã€‚

**æ–¹å¼2ï¼šåˆ©ç”¨ SETNX**

å…ˆä½¿ç”¨ `setnx` æ¥äº‰æŠ¢é”ï¼ŒæŠ¢åˆ°ä¹‹ååˆ©ç”¨ `expire` è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´é˜²æ­¢æœªèƒ½é‡Šæ”¾é”ã€‚`setnx` çš„æ„ä¹‰æ˜¯å¦‚æœ key ä¸å­˜åœ¨ï¼Œåˆ™å°†keyè®¾ç½®ä¸º valueï¼Œè¿”å› 1ã€‚å¦‚æœå·²å­˜åœ¨ï¼Œåˆ™ä¸åšä»»ä½•æ“ä½œï¼Œè¿”å› 0ã€‚

**æ–¹å¼3ï¼šåˆ©ç”¨ SET**

`set` æŒ‡ä»¤æœ‰éå¸¸å¤æ‚çš„å‚æ•°ï¼Œç›¸å½“äºåˆæˆäº† `setnx` å’Œ `expire` ä¸¤æ¡å‘½ä»¤çš„åŠŸèƒ½ã€‚å…¶å‘½ä»¤æ ¼å¼å¦‚ï¼š`set($Key,$value, array('nx', 'ex'=>$ttl))`ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBNWPytZicN29qvK9Detvq0Jf0B1zralngkppWq3PXsqP7kibPzF1QsibcQ/640?wx_fmt=png)

1.  å®Œå…¨åŸºäºå†…å­˜
2.  æ•°æ®ç»“æ„ç®€å•ï¼Œæ“ä½œæ–¹ä¾¿ï¼Œå¹¶ä¸”ä¸åŒæ•°æ®ç»“æ„èƒ½å¤Ÿåº”å¯¹äºä¸åŒåœºæ™¯
3.  é‡‡ç”¨å•çº¿ç¨‹ï¼ˆç½‘ç»œè¯·æ±‚æ¨¡å—ä½¿ç”¨å•çº¿ç¨‹ï¼Œå…¶ä»–æ¨¡å—ä»ç”¨äº†å¤šçº¿ç¨‹ï¼‰ï¼Œé¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶ï¼Œä¹Ÿä¸å­˜åœ¨å¤šè¿›ç¨‹æˆ–å¤šçº¿ç¨‹åˆ‡æ¢å¯¼è‡´CPUæ¶ˆè€—ï¼Œä¸éœ€è¦è€ƒè™‘å„ç§é”çš„é—®é¢˜ã€‚
4.  ä½¿ç”¨å¤šè·¯I/Oå¤ç”¨æ¨¡å‹ï¼Œä¸ºéé˜»å¡I/O
5.  Redis æœ¬èº«è®¾å®šäº† VM æœºåˆ¶ï¼Œæ²¡æœ‰ä½¿ç”¨ OS çš„Swapï¼Œå¯ä»¥å®ç°å†·çƒ­æ•°æ®åˆ†ç¦»ï¼Œé¿å…å› ä¸ºå†…å­˜ä¸è¶³è€Œé€ æˆè®¿é—®é€Ÿåº¦ä¸‹é™çš„é—®é¢˜

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBR2rFJicqUacqlLQlp3Ww2kLlM02RxslfBR4ssWSqccp1ia2MYYaF2kfQ/640?wx_fmt=png)

**1ã€RDBï¼ˆRedis DataBaseï¼‰æŒä¹…åŒ–**

RDB æ˜¯ Redis ä¸­é»˜è®¤çš„æŒä¹…åŒ–æœºåˆ¶ï¼ŒæŒ‰ç…§ä¸€å®šçš„æ—¶é—´å°†å†…å­˜ä¸­çš„æ•°æ®ä»¥å¿«ç…§çš„æ–¹å¼ä¿å­˜åˆ°ç£ç›˜ä¸­ï¼Œå®ƒä¼šäº§ç”Ÿä¸€ä¸ªç‰¹æ®Šç±»å‹çš„æ–‡ä»¶ `.rdb` æ–‡ä»¶ï¼ŒåŒæ—¶å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„ `save` å‚æ•°æ¥å®šä¹‰å¿«ç…§çš„å‘¨æœŸ

åœ¨ RDB ä¸­æœ‰ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µ `fork` å’Œ `cow`ï¼Œåœ¨æ‰§è¡Œå¤‡ä»½çš„æµç¨‹å¦‚ä¸‹ï¼š

åœ¨æ‰§è¡Œ`bgsave`çš„æ—¶å€™ï¼ŒRedis ä¼š fork ä¸»è¿›ç¨‹å¾—åˆ°ä¸€ä¸ªæ–°çš„å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹æ˜¯å…±äº«ä¸»è¿›ç¨‹å†…å­˜æ•°æ®çš„ï¼Œä¼šå°†æ•°æ®å†™åˆ°ç£ç›˜ä¸Šçš„ä¸€ä¸ªä¸´æ—¶çš„ `.rdb` æ–‡ä»¶ä¸­ï¼Œå½“å­è¿›ç¨‹å†™å®Œä¸´æ—¶æ–‡ä»¶åï¼Œä¼šå°†åŸæ¥çš„ `.rdb` æ–‡ä»¶æ›¿æ¢æ‰ï¼Œè¿™ä¸ªå°±æ˜¯ fork çš„æ¦‚å¿µã€‚é‚£ cow å…¨ç§°æ˜¯ copy-on-write ï¼Œå½“ä¸»è¿›ç¨‹æ‰§è¡Œè¯»æ“ä½œçš„æ—¶å€™æ˜¯è®¿é—®å…±äº«å†…å­˜çš„ï¼Œè€Œä¸»è¿›ç¨‹æ‰§è¡Œå†™æ“ä½œçš„æ—¶å€™ï¼Œåˆ™ä¼šæ‹·è´ä¸€ä»½æ•°æ®ï¼Œæ‰§è¡Œå†™æ“ä½œã€‚

***ä¼˜ç‚¹***

1.  åªæœ‰ä¸€ä¸ªæ–‡ä»¶ dump.rdb ï¼Œæ–¹ä¾¿æŒä¹…åŒ–
2.  å®¹é”™æ€§å¥½ï¼Œä¸€ä¸ªæ–‡ä»¶å¯ä»¥ä¿å­˜åˆ°å®‰å…¨çš„ç£ç›˜
3.  å®ç°äº†æ€§èƒ½æœ€å¤§åŒ–ï¼Œfork å•ç‹¬å­è¿›ç¨‹æ¥å®ŒæˆæŒä¹…åŒ–ï¼Œè®©ä¸»è¿›ç¨‹ç»§ç»­å¤„ç†å‘½ä»¤ï¼Œä¸»è¿›ç¨‹ä¸è¿›è¡Œä»»ä½• I/O æ“ä½œï¼Œä»è€Œä¿è¯äº†Redisçš„é«˜æ€§èƒ½
4.  RDB æ˜¯ä¸€ä¸ªç´§å‡‘å‹ç¼©çš„äºŒè¿›åˆ¶æ–‡åŒ–ï¼ŒRDBé‡å¯æ—¶çš„åŠ è½½æ•ˆç‡æ¯”AOFæŒä¹…åŒ–æ›´é«˜ï¼Œåœ¨æ•°æ®é‡å¤§æ—¶æ›´æ˜æ˜¾

***ç¼ºç‚¹***

1.  å¯èƒ½å‡ºç°æ•°æ®ä¸¢å¤±ï¼Œåœ¨ä¸¤æ¬¡RDBæŒä¹…åŒ–çš„æ—¶é—´é—´éš”ä¸­ï¼Œå¦‚æœå‡ºç°å®•æœºï¼Œåˆ™ä¼šä¸¢å¤±è¿™æ®µæ—¶é—´ä¸­çš„æ•°æ®
2.  ç”±äºRDBæ˜¯é€šè¿‡forkå­è¿›ç¨‹æ¥ååŠ©å®Œæˆæ•°æ®æŒä¹…åŒ–ï¼Œå¦‚æœå½“æ•°æ®é›†è¾ƒå¤§æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªæœåŠ¡å™¨é—´æ­‡æ€§æš‚åœæœåŠ¡

**2ã€AOFï¼ˆAppend Only Fileï¼‰æŒä¹…åŒ–**

AOF å…¨ç§°æ˜¯ Append Only Fileï¼ˆè¿½åŠ æ–‡ä»¶ï¼‰ã€‚å½“ Redis å¤„ç†æ¯ä¸€ä¸ªå†™å‘½ä»¤éƒ½ä¼šè®°å½•åœ¨ AOF æ–‡ä»¶ä¸­ï¼Œå¯ä»¥çœ‹åšæ˜¯å‘½ä»¤æ—¥å¿—æ–‡ä»¶ã€‚è¯¥æ–¹å¼éœ€è¦è®¾ç½® AOF çš„åŒæ­¥é€‰é¡¹ï¼Œå› ä¸ºå¯¹æ–‡ä»¶è¿›è¡Œå†™å…¥å¹¶ä¸ä¼šé©¬ä¸Šå°†å†…å®¹åŒæ­¥åˆ°ç£ç›˜ä¸Šï¼Œè€Œæ˜¯å…ˆå­˜å‚¨åˆ°ç¼“å†²åŒºä¸­ï¼ŒåŒæ­¥é€‰é¡¹æœ‰ä¸‰ç§é…ç½®é¡¹é€‰æ‹©ï¼š

*   `always`ï¼šåŒæ­¥åˆ·ç›˜ï¼Œå¯é æ€§é«˜ï¼Œä½†æ€§èƒ½å½±å“è¾ƒå¤§
*   `everysec`ï¼šæ¯ç§’åˆ·ç›˜ï¼Œæ€§èƒ½é€‚ä¸­ï¼Œæœ€å¤šä¸¢å¤± 1 ç§’çš„æ•°æ®
*   `no`ï¼šæ“ä½œç³»ç»Ÿæ§åˆ¶ï¼Œæ€§èƒ½æœ€å¥½ï¼Œå¯é æ€§æœ€å·®

ä¸ºäº†è§£å†³ AOF æ–‡ä»¶ä½“æ£€ä¸æ–­å¢å¤§çš„é—®é¢˜ï¼Œç”¨æˆ·å¯ä»¥å‘ Redis å‘é€ `bgrewriteaof` å‘½ä»¤ï¼Œå¯ä»¥å°† AOF æ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©è‡ªåŠ¨è§¦å‘ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®

```
auto-aof-rewrite-precentageÂ 100
auto-aof-rewrite-min-ziseÂ 64mb
```

***ä¼˜ç‚¹***

1.  å®ç°æŒä¹…åŒ–ï¼Œæ•°æ®å®‰å…¨ï¼ŒAOFæŒä¹…åŒ–å¯ä»¥é…ç½® appendfsync å±æ€§ä¸º alwaysï¼Œæ¯è¿›è¡Œä¸€æ¬¡å‘½ä»¤æ“ä½œå°±è®°å½•åˆ°AOFæ–‡ä»¶ä¸­ä¸€æ¬¡ï¼Œæ•°æ®æœ€å¤šä¸¢å¤±ä¸€æ¬¡
2.  é€šè¿‡ append æ¨¡å¼å†™æ–‡ä»¶ï¼Œå³ä½¿ä¸­é€”æœåŠ¡å™¨å®•æœºï¼Œå¯ä»¥é€šè¿‡ Redis-check-aof å·¥å…·è§£å†³æ•°æ®ä¸€è‡´æ€§é—®é¢˜
3.  AOF æœºåˆ¶çš„ rewrite æ¨¡å¼ã€‚AOF æ–‡ä»¶çš„æ–‡ä»¶å¤§å°è§¦ç¢°åˆ°ä¸´ç•Œç‚¹æ—¶ï¼Œrewrite æ¨¡å¼ä¼šè¢«è¿è¡Œï¼Œé‡å†™å†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œä»è€Œç¼©å°æ–‡ä»¶ä½“ç§¯

***ç¼ºç‚¹***

1.  AOF æ–‡ä»¶å¤§ï¼Œé€šå¸¸æ¯” RDB æ–‡ä»¶å¤§å¾ˆå¤š
2.  æ¯” RDB æŒä¹…åŒ–å¯åŠ¨æ•ˆç‡ä½ï¼Œæ•°æ®é›†å¤§çš„æ—¶å€™è¾ƒä¸ºæ˜æ˜¾
3.  AOF æ–‡ä»¶ä½“ç§¯å¯èƒ½è¿…é€Ÿå˜å¤§ï¼Œéœ€è¦å®šæœŸæ‰§è¡Œé‡å†™æ“ä½œæ¥é™ä½æ–‡ä»¶ä½“ç§¯

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uB6ANIPgtD87JYRLes0TzoVDwicsX5HO9ohkvf6tGxVVWah5UicicfU5slw/640?wx_fmt=png)

**æ–¹å¼1ï¼šå®šæ—¶åˆ é™¤**

åœ¨è®¾ç½® Key çš„è¿‡æœŸæ—¶é—´çš„åŒæ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ timerï¼Œå®šæ—¶å™¨åœ¨ Key è¿‡æœŸæ—¶é—´æ¥ä¸´æ—¶ï¼Œä¼šç«‹å³æ‰§è¡Œå¯¹ Key çš„åˆ é™¤æ“ä½œ

*ç‰¹ç‚¹ï¼š* å¯¹å†…å­˜å‹å¥½ï¼Œå¯¹ CPU ä¸å‹å¥½ã€‚å­˜åœ¨è¾ƒå¤šè¿‡æœŸé”®æ—¶ï¼Œåˆ©ç”¨å®šæ—¶å™¨åˆ é™¤è¿‡æœŸé”®ä¼šå ç”¨ç›¸å½“ä¸€éƒ¨åˆ†CPU

**æ–¹å¼2ï¼šæƒ°æ€§åˆ é™¤**

key ä¸ä½¿ç”¨æ—¶ä¸ç®¡ key è¿‡ä¸è¿‡æœŸï¼Œåªä¼šåœ¨æ¯æ¬¡ä½¿ç”¨çš„æ—¶å€™å†æ£€æŸ¥ Key æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸçš„è¯å°±ä¼šåˆ é™¤è¯¥ Keyã€‚

*ç‰¹ç‚¹ï¼š* å¯¹ CPU å‹å¥½ï¼Œå¯¹å†…å­˜ä¸å‹å¥½ã€‚ä¸ä¼šèŠ±è´¹é¢å¤–çš„CPUèµ„æºæ¥æ£€æµ‹Keyæ˜¯å¦è¿‡æœŸï¼Œä½†å¦‚æœå­˜åœ¨è¾ƒå¤šæœªä½¿ç”¨ä¸”è¿‡æœŸçš„Keyæ—¶ï¼Œæ‰€å ç”¨çš„å†…å­˜å°±ä¸ä¼šå¾—åˆ°é‡Šæ”¾

**æ–¹å¼3ï¼šå®šæœŸåˆ é™¤**

æ¯éš”ä¸€æ®µæ—¶é—´å°±ä¼šå¯¹æ•°æ®åº“è¿›è¡Œä¸€æ¬¡æ£€æŸ¥ï¼Œåˆ é™¤é‡Œé¢çš„è¿‡æœŸKeyï¼Œè€Œæ£€æŸ¥å¤šå°‘ä¸ªæ•°æ®åº“ï¼Œåˆ™ç”±ç®—æ³•å†³å®š

*ç‰¹ç‚¹ï¼š* å®šæœŸåˆ é™¤æ˜¯å¯¹ä¸Šé¢ä¸¤ç§è¿‡æœŸç­–ç•¥çš„æŠ˜ä¸­ï¼Œä¹Ÿå°±æ˜¯å¯¹å†…å­˜å‹å¥½å’ŒCPUå‹å¥½çš„æŠ˜ä¸­æ–¹æ³•ã€‚æ¯éš”ä¸€æ®µæ—¶é—´æ‰§è¡Œä¸€æ¬¡åˆ é™¤è¿‡æœŸé”®ä»»åŠ¡ï¼Œå¹¶é€šè¿‡é™åˆ¶æ“ä½œçš„æ—¶é•¿å’Œé¢‘ç‡æ¥å‡å°‘å¯¹CPUæ—¶é—´çš„å ç”¨ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBR5Na0yKib8MHYYXzqRWWIHIiby5tDicKsnrWTsiafzja9q41a9V6vw8Lag/640?wx_fmt=png)

> Redis ä¸»ä»åŒæ­¥åˆ†ä¸ºå¢é‡åŒæ­¥å’Œå…¨é‡åŒæ­¥Redis ä¼šå…ˆå°è¯•è¿›è¡Œå¢é‡åŒæ­¥ï¼Œå¦‚æœä¸æˆåŠŸåˆ™ä¼šè¿›è¡Œå…¨é‡åŒæ­¥ã€‚

**å¢é‡åŒæ­¥ï¼š**

Slave åˆå§‹åŒ–åå¼€å§‹æ­£å¸¸å·¥ä½œæ—¶ä¸»æœåŠ¡å™¨å‘ç”Ÿçš„å†™æ“ä½œåŒæ­¥åˆ°ä»æœåŠ¡å™¨çš„è¿‡ç¨‹ã€‚å¢é‡åŒæ­¥çš„è¿‡ç¨‹ä¸»è¦æ˜¯ä¸»æœåŠ¡å™¨æ¯æ‰§è¡Œä¸€ä¸ªå†™å‘½ä»¤å°±ä¼šå‘ä»æœåŠ¡å™¨å‘é€ç›¸åŒçš„å†™å‘½ä»¤ã€‚

**å…¨é‡åŒæ­¥ï¼š**

Slave åˆå§‹åŒ–æ—¶å®ƒä¼šå‘é€ä¸€ä¸ª `psync` å‘½ä»¤åˆ°ä¸»æœåŠ¡å™¨ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡åŒæ­¥ï¼Œä¸»æœåŠ¡å™¨ä¼šåšä¸€æ¬¡`bgsave`ï¼Œå¹¶åŒæ—¶å°†åç»­çš„ä¿®æ”¹æ“ä½œè®°å½•åˆ°å†…å­˜ buffer ä¸­ï¼Œå¾… `bgsave` å®Œæˆåå†å°† RDB æ–‡ä»¶å…¨é‡åŒæ­¥åˆ°ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨æ¥æ”¶å®Œæˆåä¼šå°† RDB å¿«ç…§åŠ è½½åˆ°å†…å­˜ç„¶åå†™å…¥åˆ°æœ¬åœ°ç£ç›˜ï¼Œå¤„ç†å®Œæˆåï¼Œå†é€šçŸ¥ä¸»æœåŠ¡å™¨å°†æœŸé—´ä¿®æ”¹çš„æ“ä½œè®°å½•åŒæ­¥åˆ°å¤åˆ¶èŠ‚ç‚¹è¿›è¡Œé‡æ”¾å°±å®Œæˆäº†æ•´ä¸ªå…¨é‡åŒæ­¥è¿‡ç¨‹ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uB5IB2ickLPfNibvZs66gVdFYYG5TbNrXCuB6rX3ic0bRupq4EX4rzVibsnA/640?wx_fmt=png)

åœ¨Redisä¸­ï¼Œæœ€å¤§ä½¿ç”¨å†…å­˜å¤§å°ç”±Redis.confä¸­çš„å‚æ•°maxmemoryå†³å®šï¼Œé»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºä¸é™åˆ¶ï¼Œè¿™æ—¶å®é™…ç›¸å½“äºå½“å‰ç³»ç»Ÿçš„å†…å­˜ã€‚ä½†å¦‚æœéšç€æ•°æ®çš„å¢åŠ ï¼Œå¦‚æœå¯¹å†…å­˜ä¸­çš„æ•°æ®æ²¡æœ‰ç®¡ç†æœºåˆ¶ï¼Œé‚£ä¹ˆæ•°æ®é›†å¤§å°è¾¾åˆ°æˆ–è¶…è¿‡æœ€å¤§å†…å­˜çš„å¤§å°æ—¶ï¼Œåˆ™ä¼šé€ æˆRediså´©æºƒã€‚å› æ­¤éœ€è¦å†…å­˜æ•°æ®æ·˜æ±°æœºåˆ¶ã€‚

**è®¾æœ‰è¿‡æœŸæ—¶é—´**

1.  `volatile-lru`ï¼šå°è¯•å›æ”¶æœ€å°‘ä½¿ç”¨çš„é”®
2.  `volatile-random`ï¼šå›æ”¶éšæœºçš„é”®
3.  `volatile-ttl`ï¼šä¼˜å…ˆå›æ”¶å­˜æ´»æ—¶é—´è¾ƒçŸ­çš„é”®

**æ²¡æœ‰è¿‡æœŸæ—¶é—´**

1.  `allkey-lru`ï¼šå°è¯•å›æ”¶æœ€å°‘ä½¿ç”¨çš„é”®
2.  `allkeys-random`ï¼šå›æ”¶éšæœºçš„é”®
3.  `noeviction`ï¼šå½“å†…å­˜è¾¾åˆ°é™åˆ¶å¹¶ä¸”å®¢æˆ·ç«¯å°è¯•æ‰§è¡Œæ–°å¢ï¼Œä¼šè¿”å›é”™è¯¯

> *æ·˜æ±°ç­–ç•¥çš„è§„åˆ™*
> 
> *   å¦‚æœæ•°æ®å‘ˆç°å¹‚å¾‹åˆ†å¸ƒï¼Œä¹Ÿå°±æ˜¯ä¸€éƒ¨åˆ†æ•°æ®è®¿é—®é¢‘ç‡é«˜ï¼Œä¸€éƒ¨åˆ†æ•°æ®è®¿é—®é¢‘ç‡ä½ï¼Œåˆ™ä½¿ç”¨ allKeys-lru
> *   å¦‚æœæ•°æ®å‘ˆç°å¹³ç­‰åˆ†å¸ƒï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰çš„æ•°æ®è®¿é—®é¢‘ç‡å¤§ä½“ç›¸åŒï¼Œåˆ™ä½¿ç”¨ allKeys-random
> *   å…³äº lru ç­–ç•¥ï¼ŒRedisä¸­å¹¶ä¸ä¼šå‡†ç¡®çš„åˆ é™¤æ‰€æœ‰é”®ä¸­æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é”®ï¼Œè€Œæ˜¯éšæœºæŠ½å–5ä¸ªé”®ï¼ˆä¸ªæ•°ç”±å‚æ•°maxmemory-sampleså†³å®šï¼Œé»˜è®¤å€¼æ˜¯5ï¼‰ï¼Œåˆ é™¤è¿™5ä¸ªé”®ä¸­æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é”®ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBswuUsyfaAaTE6bLTtMoJ513W618icxYoRrFvv1CLCkomdN7ic74gcfOg/640?wx_fmt=png)

**é—®é¢˜1ï¼šç¼“å­˜ç©¿é€**

> ç¼“å­˜ç©¿é€æ˜¯æŒ‡ç¼“å­˜å’Œæ•°æ®åº“ä¸Šéƒ½æ²¡æœ‰çš„æ•°æ®ï¼Œå¯¼è‡´æ‰€æœ‰è¯·æ±‚éƒ½è½åˆ°æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“çŸ­æ—¶é—´å†…æ‰¿å—å¤§é‡çš„è¯·æ±‚è€Œå¯¼è‡´å®•æœº

*è§£å†³ï¼š*

1.  ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼šå°†æŸ¥è¯¢çš„å‚æ•°éƒ½å­˜å‚¨åˆ°ä¸€ä¸ª bitmap ä¸­ï¼Œåœ¨æŸ¥è¯¢ç¼“å­˜å‰ï¼Œå¦‚æœ bitmap å­˜åœ¨åˆ™è¿›è¡Œåº•å±‚ç¼“å­˜çš„æ•°æ®æŸ¥è¯¢ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿›è¡Œæ‹¦æˆªï¼Œä¸å†è¿›è¡Œç¼“å­˜çš„æ•°æ®æŸ¥è¯¢
2.  ç¼“å­˜ç©ºå¯¹è±¡ï¼šå¦‚æœæ•°æ®åº“æŸ¥è¯¢çš„ä¸ºç©ºï¼Œåˆ™ä¾ç„¶æŠŠè¿™ä¸ªæ•°æ®ç¼“å­˜å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå½“å¤šæ¬¡è®¿é—®çš„æ—¶å€™å¯ä»¥ç›´æ¥è¿”å›ç»“æœï¼Œé¿å…é€ æˆå¤šæ¬¡è®¿é—®æ•°æ®åº“ï¼Œä½†è¦ä¿è¯å½“æ•°æ®åº“æœ‰æ•°æ®æ—¶åŠæ—¶æ›´æ–°ç¼“å­˜ã€‚

**é—®é¢˜2ï¼šç¼“å­˜å‡»ç©¿**

> ç¼“å­˜å‡»ç©¿æ˜¯æŒ‡ç¼“å­˜ä¸­æ²¡æœ‰ä½†æ•°æ®åº“ä¸­æœ‰çš„æ•°æ®ï¼ˆä¸€èˆ¬æ˜¯ç¼“å­˜æ—¶é—´åˆ°æœŸï¼‰ï¼Œå°±ä¼šå¯¼è‡´æ‰€æœ‰è¯·æ±‚éƒ½è½åˆ°æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“æ®µæ—¶é—´å†…æ‰¿å—å¤§é‡çš„è¯·æ±‚è€Œå®•æœº

*è§£å†³ï¼š*

1.  è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ
2.  å¯ä»¥ä½¿ç”¨äº’æ–¥é”æ›´æ–°ï¼Œä¿è¯åŒä¸€è¿›ç¨‹ä¸­é’ˆå¯¹åŒä¸€ä¸ªæ•°æ®ä¸ä¼šå¹¶å‘è¯·æ±‚åˆ° DBï¼Œå‡å°DBçš„å‹åŠ›
3.  ä½¿ç”¨éšæœºé€€é¿æ–¹å¼ï¼Œå¤±æ•ˆæ—¶éšæœº sleep ä¸€ä¸ªå¾ˆçŸ­çš„æ—¶é—´ï¼Œå†æ¬¡æŸ¥è¯¢ï¼Œå¦‚æœå¤±è´¥å†æ‰§è¡Œæ›´æ–°

**é—®é¢˜3ï¼šç¼“å­˜é›ªå´©**

> ç¼“å­˜é›ªå´©æ˜¯æŒ‡å¤§é‡ç¼“å­˜åŒä¸€æ—¶é—´å†…å¤§é¢ç§¯å¤±æ•ˆï¼Œåé¢çš„è¯·æ±‚éƒ½ä¼šè½åˆ°æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“æ®µæ—¶é—´æ— æ³•æ‰¿å—å¤§é‡çš„è¯·æ±‚è€Œå®•æ‰

*è§£å†³ï¼š*

1.  åœ¨ç¼“å­˜å¤±æ•ˆåï¼Œé€šè¿‡åŠ é”æˆ–è€…é˜Ÿåˆ—æ¥æ§åˆ¶è¯»æ•°æ®åº“å†™ç¼“å­˜çš„çº¿ç¨‹æ•°é‡ã€‚æ¯”å¦‚å¯¹æŸä¸ªKeyåªå…è®¸ä¸€ä¸ªçº¿ç¨‹æŸ¥è¯¢å’Œå†™ç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…
2.  é€šè¿‡ç¼“å­˜ reload æœºåˆ¶ï¼Œé¢„å…ˆå»æ›´æ–°ç¼“å­˜ï¼Œåœ¨å³å°†å‘ç”Ÿé«˜å¹¶å‘è®¿é—®å‰æ‰‹åŠ¨è§¦å‘åŠ è½½ç¼“å­˜
3.  å¯¹äºä¸åŒçš„keyè®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œè®©ç¼“å­˜å¤±æ•ˆçš„æ—¶é—´ç‚¹å°½é‡å‡åŒ€ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨åŸæœ‰çš„å¤±æ•ˆæ—¶é—´åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªéšæœºå€¼ï¼Œæ¯”å¦‚1~5åˆ†é’Ÿéšæœºï¼Œè¿™æ ·æ¯ä¸€ä¸ªç¼“å­˜çš„è¿‡æœŸæ—¶é—´çš„é‡å¤ç‡å°±ä¼šé™ä½ã€‚
4.  è®¾ç½®äºŒçº§ç¼“å­˜ï¼Œæˆ–è€…åŒç¼“å­˜ç­–ç•¥ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBFbIh5dnAib4icicWwKh8tFcIcspzRG3YbX5tI11BAlfzpFUdHTymal3Iw/640?wx_fmt=png)

ç¼“å­˜é™çº§ï¼Œå…¶å®éƒ½åº”è¯¥æ˜¯æŒ‡æœåŠ¡é™çº§ã€‚åœ¨è®¿é—®é‡å‰§å¢ã€æœåŠ¡å“åº”å‡ºç°é—®é¢˜ï¼ˆå¦‚å“åº”å»¶è¿Ÿæˆ–ä¸å“åº”ï¼‰æˆ–éæ ¸å¿ƒæœåŠ¡å½±å“åˆ°æ ¸å¿ƒæµç¨‹çš„æ€§èƒ½çš„æƒ…å†µä¸‹ï¼Œä»ç„¶éœ€è¦ä¿è¯æ ¸å¿ƒæœåŠ¡å¯ç”¨ï¼Œå°½ç®¡å¯èƒ½ä¸€äº›éä¸»è¦æœåŠ¡ä¸å¯ç”¨ï¼Œè¿™æ—¶å°±å¯ä»¥é‡‡å–æœåŠ¡é™çº§ç­–ç•¥ã€‚

æœåŠ¡é™çº§çš„æœ€ç»ˆç›®çš„æ˜¯ä¿è¯æ ¸å¿ƒæœåŠ¡å¯ç”¨ï¼Œå³ä½¿æ˜¯æœ‰æŸçš„ã€‚æœåŠ¡é™çº§åº”å½“äº‹å…ˆç¡®å®šå¥½é™çº§æ–¹æ¡ˆï¼Œç¡®å®šå“ªäº›æœåŠ¡æ˜¯å¯ä»¥é™çº§çš„ï¼Œå“ªäº›æœåŠ¡æ˜¯ä¸å¯é™çº§çš„ã€‚æ ¹æ®å½“å‰ä¸šåŠ¡æƒ…å†µåŠæµé‡å¯¹ä¸€äº›æœåŠ¡å’Œé¡µé¢æœ‰ç­–ç•¥çš„é™çº§ï¼Œä»¥æ­¤é‡Šæ”¾æœåŠ¡å™¨èµ„æºä»¥ä¿è¯æ ¸å¿ƒæœåŠ¡çš„æ­£å¸¸è¿è¡Œã€‚

é™çº§å¾€å¾€ä¼šæŒ‡å®šä¸åŒçš„çº§åˆ«ï¼Œé¢ä¸´ä¸åŒçš„å¼‚å¸¸ç­‰çº§æ‰§è¡Œä¸åŒçš„å¤„ç†ã€‚æ ¹æ®æœåŠ¡æ–¹å¼ï¼šå¯ä»¥æ‹’æ¥æœåŠ¡ï¼Œå¯ä»¥å»¶è¿ŸæœåŠ¡ï¼Œä¹Ÿå¯ä»¥éšæœºæä¾›æœåŠ¡ã€‚æ ¹æ®æœåŠ¡èŒƒå›´ï¼šå¯ä»¥æš‚æ—¶ç¦ç”¨æŸäº›åŠŸèƒ½æˆ–ç¦ç”¨æŸäº›åŠŸèƒ½æ¨¡å—ã€‚æ€»ä¹‹æœåŠ¡é™çº§éœ€è¦æ ¹æ®ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚é‡‡ç”¨ä¸åŒçš„é™çº§ç­–ç•¥ã€‚ä¸»è¦çš„ç›®çš„å°±æ˜¯æœåŠ¡è™½ç„¶æœ‰æŸä½†æ˜¯æ€»æ¯”æ²¡æœ‰å¥½ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBFmUHfS1q73gmLNhmfDYicUjVhQkcoRqSgriatzUbClhILbal9UJjvbXA/640?wx_fmt=png)

1.  æ•°æ®å®æ—¶åŒæ­¥å¤±æ•ˆæˆ–æ›´æ–°ã€‚è¿™æ˜¯ä¸€ç§å¢é‡ä¸»åŠ¨å‹çš„æ–¹æ¡ˆï¼Œèƒ½ä¿è¯æ•°æ®å¼ºä¸€è‡´æ€§ï¼Œåœ¨æ•°æ®åº“æ•°æ®æ›´æ–°ä¹‹åï¼Œä¸»åŠ¨è¯·æ±‚ç¼“å­˜æ›´æ–°
2.  æ•°æ®å¼‚æ­¥æ›´æ–°ã€‚è¿™æ˜¯ä¸€ç§å¢é‡è¢«åŠ¨å‹æ–¹æ¡ˆï¼Œæ•°æ®ä¸€è‡´æ€§ç¨å¼±ï¼Œæ•°æ®æ›´æ–°ä¼šæœ‰å»¶è¿Ÿï¼Œæ›´æ–°æ•°æ®åº“æ•°æ®åï¼Œé€šè¿‡å¼‚æ­¥æ–¹å¼ï¼Œç”¨å¤šçº¿ç¨‹æ–¹å¼æˆ–æ¶ˆæ¯é˜Ÿåˆ—æ¥å®ç°æ›´æ–°
3.  å®šæ—¶ä»»åŠ¡æ›´æ–°ã€‚è¿™æ˜¯ä¸€ç§å¢/å…¨é‡è¢«åŠ¨å‹æ–¹æ¡ˆï¼Œé€šè¿‡å®šæ—¶ä»»åŠ¡æŒ‰ä¸€å®šé¢‘ç‡è°ƒåº¦æ›´æ–°ï¼Œæ•°æ®ä¸€è‡´æ€§æœ€å·®

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBN8xgckvUUlHxZ1dB4UvXbdwhT0RCAC2we811ibbyH7DAbYINlHVudMA/640?wx_fmt=png)

1.  ç›´æ¥å†™ä¸ªç¼“å­˜åˆ·æ–°é¡µé¢ï¼Œä¸Šçº¿æ—¶æ‰‹å·¥æ“ä½œ
2.  æ•°æ®é‡ä¸å¤§ï¼Œå¯ä»¥åœ¨é¡¹ç›®å¯åŠ¨æ—¶è‡ªåŠ¨è¿›è¡ŒåŠ è½½
3.  å®šæ—¶åˆ·æ–°ç¼“å­˜

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBGQn9eOL3KBgyyakEQqAuzxKCUDMtTXaZp98WgWYT7N7rywO3mjwicoA/640?wx_fmt=png)

> Sentinelï¼ˆå“¨å…µï¼‰é€‚ç”¨äºç›‘æ§ Redis é›†ç¾¤ä¸­ Master å’Œ Slave çŠ¶æ€çš„å·¥å…·ï¼Œæ˜¯Redisçš„é«˜å¯ç”¨æ€§è§£å†³æ–¹æ¡ˆ

**ä¸»è¦ä½œç”¨**

1.  ç›‘æ§ã€‚å“¨å…µä¼šä¸æ–­æ£€æŸ¥ç”¨æˆ·çš„Masterå’ŒSlaveæ˜¯å¦è¿ä½œæ­£å¸¸
2.  æé†’ã€‚å½“è¢«ç›‘æ§çš„æŸä¸ªRedisèŠ‚ç‚¹å‡ºç°é—®é¢˜æ—¶ï¼Œå“¨å…µå¯ä»¥é€šè¿‡APIå‘ç®¡ç†å‘˜æˆ–å…¶ä»–åº”ç”¨ç¨‹åºå‘é€é€šçŸ¥
3.  è‡ªåŠ¨æ•…éšœè¿ç§»ã€‚å½“ä¸€ä¸ªMasterä¸èƒ½æ­£å¸¸å·¥ä½œæ—¶ï¼Œå“¨å…µä¼šå¼€å§‹ä¸€æ¬¡è‡ªåŠ¨æ•…éšœè¿ç§»æ“ä½œï¼Œå®ƒä¼šå°†é›†ç¾¤ä¸­ä¸€ä¸ªSlaveæå‡ä¸ºæ–°çš„Masterï¼Œå¹¶è®©å…¶ä»–Slaveæ”¹ä¸ºä¸æ–°çš„Masterè¿›è¡ŒåŒæ­¥ã€‚å½“å®¢æˆ·ç«¯è¯•å›¾è¿æ¥å¤±è´¥çš„Masteræ—¶ï¼Œé›†ç¾¤ä¹Ÿä¼šæƒ³å®¢æˆ·ç«¯è¿”å›æ–°çš„Masteråœ°å€ã€‚å½“ä¸»ä»æœåŠ¡å™¨åˆ‡æ¢åï¼Œæ–°Masterçš„Redis.confï¼ŒSlaveçš„Redis.confå’ŒSentinelçš„Redis.confä¸‰è€…é…ç½®æ–‡ä»¶éƒ½ä¼šå‘ç”Ÿç›¸åº”çš„æ”¹å˜ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBDdniblg7yicJ06gOSsTCu4MncKFo38k2zzr6BY3ic4p7XibYoO4azWYqUw/640?wx_fmt=png)

**é—®é¢˜èƒŒæ™¯**

> Redis æ˜¯åŸºäºTCPåè®®çš„è¯·æ±‚/å“åº”æœåŠ¡å™¨ï¼Œæ¯æ¬¡é€šä¿¡éƒ½è¦ç»è¿‡TCPåè®®çš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œæ‰€ä»¥å½“éœ€è¦æ‰§è¡Œçš„å‘½ä»¤è¶³å¤Ÿå¤æ‚æ—¶ï¼Œä¼šäº§ç”Ÿå¾ˆå¤§çš„ç½‘ç»œå»¶è¿Ÿï¼Œå¹¶ä¸”ç½‘ç»œçš„ä¼ è¾“æ—¶é—´æˆæœ¬å’ŒæœåŠ¡å™¨å¼€é”€æ²¡æœ‰è®¡å…¥å…¶ä¸­ï¼Œæ€»çš„å»¶è¿Ÿå¯èƒ½æ›´å¤§ã€‚

**Pipelineè§£å†³**

*   Pipeline ä¸»è¦å°±æ˜¯ä¸ºäº†è§£å†³å­˜åœ¨è¿™ç§æƒ…å†µçš„åœºæ™¯ï¼Œä½¿ç”¨Pipelineæ¨¡å¼ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä¸€æ¬¡æ€§å‘é€å¤šä¸ªå‘½ä»¤ï¼Œæ— éœ€ç­‰å¾…æœåŠ¡ç«¯è¿”å›ï¼Œè¿™æ ·å¯ä»¥å°†å¤šæ¬¡I/Oå¾€è¿”çš„æ—¶é—´ç¼©çŸ­ä¸ºä¸€æ¬¡ï¼Œå¤§å¤§å‡å°‘äº†ç½‘ç»œå¾€è¿”æ—¶é—´ï¼Œæé«˜äº†ç³»ç»Ÿæ€§èƒ½ã€‚
*   Pipeline æ˜¯åŸºäºé˜Ÿåˆ—å®ç°ï¼ŒåŸºäºå…ˆè¿›å…ˆå‡ºçš„åŸç†ï¼Œæ»¡è¶³äº†æ•°æ®é¡ºåºæ€§ã€‚åŒæ—¶ä¸€æ¬¡æäº¤çš„å‘½ä»¤å¾ˆå¤šçš„è¯ï¼Œé˜Ÿåˆ—éœ€è¦éå¸¸å¤§é‡çš„å†…å­˜æ¥ç»„ç»‡è¿”å›æ•°æ®å†…å®¹ï¼Œå¦‚æœå¤§é‡ä½¿ç”¨Pipelineçš„è¯ï¼Œåº”å½“åˆç†åˆ†æ‰¹æ¬¡æäº¤å‘½ä»¤ã€‚
*   Pipelineçš„é»˜è®¤åŒæ­¥ä¸ªæ•°ä¸º`53`ä¸ªï¼Œç´¯åŠ åˆ° 53 æ¡æ•°æ®æ—¶ä¼šæŠŠæ•°æ®æäº¤

*æ³¨æ„ï¼š* Redis é›†ç¾¤ä¸­ä½¿ç”¨ä¸äº† Pipelineï¼Œå¯¹å¯é æ€§è¦æ±‚å¾ˆé«˜ï¼Œæ¯æ¬¡æ“ä½œéƒ½éœ€è¦ç«‹å³è·å–æœ¬æ¬¡æ“ä½œç»“æœçš„åœºæ™¯éƒ½ä¸é€‚åˆç”¨ Pipeline

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBUB8VaDpUO3Bqg6LEAkGfGEWxT3Teh3CHP02Xdzk90H2bqZuHvyuOnQ/640?wx_fmt=png)

1.  Master æœ€å¥½ä¸è¦åš RDB æŒä¹…åŒ–ï¼Œå› ä¸ºè¿™æ—¶ save å‘½ä»¤è°ƒåº¦ rdbSave å‡½æ•°ï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹çš„å·¥ä½œï¼Œå½“æ•°æ®é›†æ¯”è¾ƒå¤§æ—¶å¯èƒ½é€ æˆä¸»çº¿ç¨‹é—´æ–­æ€§æš‚åœæœåŠ¡
2.  å¦‚æœæ•°æ®æ¯”è¾ƒé‡è¦ï¼Œå°†æŸä¸ª Slave èŠ‚ç‚¹å¼€å¯AOFæ•°æ®å¤‡ä»½ï¼Œç­–ç•¥è®¾ç½®ä¸ºæ¯ç§’ä¸€æ¬¡
3.  ä¸ºäº†ä¸»ä»å¤åˆ¶é€Ÿåº¦å’Œè¿æ¥çš„ç¨³å®šæ€§ï¼ŒMaster å’Œ Slave æœ€å¥½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘ä¸­
4.  å°½é‡é¿å…åœ¨è¿è¡Œå‹åŠ›å¾ˆå¤§çš„ä¸»åº“ä¸Šå¢åŠ ä»åº“
5.  ä¸»ä»å¤åˆ¶ä¸è¦ç”¨å›¾çŠ¶ç»“æ„ï¼Œç”¨å•å‘é“¾è¡¨ç»“æ„æ›´ä¸ºç¨³å®šï¼Œ`Mater->Slave1->Slave2->Slave3...` è¿™æ ·çš„ç»“æ„æ–¹ä¾¿è§£å†³å•ç‚¹æ•…éšœé—®é¢˜ï¼Œå®ç° Slave å¯¹ Master çš„æ›¿æ¢ï¼Œå¦‚æœ Master å´©æºƒï¼Œå¯ä»¥ç«‹å³å¯ç”¨ Slave1æ›¿æ¢Materï¼Œè€Œå…¶ä»–ä¾èµ–å…³ç³»åˆ™ä¿æŒä¸å˜ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBbvxylAE9vKEUEzia14JSgXgh3q8JHrfgU5kS3UiaQ52hlAxocib3iaFt2Q/640?wx_fmt=png)

**æ–¹å¼1ï¼šå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜**

è¿™ç§æ˜¯å¸¸è§„çš„åšæ³•ï¼Œä½†æ˜¯å¦‚æœæ›´æ–°ç¼“å­˜å¤±è´¥ï¼Œå°†ä¼šå¯¼è‡´ç¼“å­˜æ˜¯æ—§æ•°æ®ï¼Œæ•°æ®åº“æ˜¯æ–°æ•°æ®

**æ–¹å¼2ï¼šå…ˆåˆ é™¤ç¼“å­˜ï¼Œå†å†™å…¥æ•°æ®åº“**

è¿™ç§æ–¹å¼èƒ½å¤Ÿè§£å†³æ–¹å¼1çš„é—®é¢˜ï¼Œä½†æ˜¯ä»…é™äºä½å¹¶å‘çš„åœºæ™¯ï¼Œä¸ç„¶å¦‚æœæœ‰æ–°çš„è¯·æ±‚åœ¨åˆ å®Œç¼“å­˜ä¹‹åï¼Œå†™æ•°æ®åº“ä¹‹å‰è¿›æ¥ï¼Œé‚£ä¹ˆç¼“å­˜å°±ä¼šé©¬ä¸Šæ›´æ–°æ•°æ®åº“æ›´æ–°ä¹‹å‰æ•°æ®ï¼Œé€ æˆæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜

**æ–¹å¼3ï¼šå»¶æ—¶åŒåˆ ç­–ç•¥**

è¿™ç§æ–¹å¼æ˜¯å…ˆåˆ é™¤ç¼“å­˜ï¼Œç„¶åæ›´æ–°æ•°æ®åº“ï¼Œæœ€åå»¶è¿Ÿä¸ªå‡ ç™¾æ¯«ç§’å†åˆ é™¤ç¼“å­˜

**æ–¹å¼4ï¼šç›´æ¥æ“ä½œç¼“å­˜ï¼Œå®šæœŸå†™å…¥æ•°æ®åº“**

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBkQJHfqiaUYsGmPdCSD4QAMs5WAaCBicSzyghs1ja0ets0SWPaBcJFqxg/640?wx_fmt=png)

> è™½ç„¶Redisçš„Transactions æä¾›çš„å¹¶ä¸æ˜¯ä¸¥æ ¼çš„ ACIDçš„äº‹åŠ¡ï¼ˆå¦‚ä¸€ä¸²ç”¨EXECæäº¤æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¦‚æœåœ¨æ‰§è¡Œä¸­æœåŠ¡å™¨å®•æœºï¼Œé‚£ä¹ˆä¼šæœ‰ä¸€éƒ¨åˆ†å‘½ä»¤æ‰§è¡Œä¸€éƒ¨åˆ†å‘½ä»¤æœªæ‰§è¡Œï¼‰ï¼Œä½†è¿™äº›Transactionsè¿˜æ˜¯æä¾›äº†åŸºæœ¬çš„å‘½ä»¤æ‰“åŒ…æ‰§è¡Œçš„åŠŸèƒ½ï¼ˆåœ¨æœåŠ¡å™¨ä¸å‡ºé—®é¢˜çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä¿è¯ä¸€è¿ä¸²çš„å‘½ä»¤æ˜¯é¡ºåºåœ¨ä¸€èµ·æ‰§è¡Œçš„ã€‚

Redis äº‹åŠ¡çš„æœ¬è´¨å°±æ˜¯å››ä¸ªåŸè¯­ï¼š

1.  `multi`ï¼šç”¨äºå¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå®ƒæ€»æ˜¯è¿”å› OKï¼Œå½“ multi æ‰§è¡Œä¹‹åï¼Œå®¢æˆ·ç«¯å¯ä»¥ç»§ç»­å‘æœåŠ¡å™¨å‘é€ä»»æ„å¤šæ¡å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤ä¸ä¼šè¢«ç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯æ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå½“ exec å‘½ä»¤è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œæ‰€æœ‰é˜Ÿåˆ—d å‘½ä»¤æ‰ä¼šæ‰§è¡Œ
2.  `exec`ï¼šæ‰§è¡Œæ‰€æœ‰äº‹åŠ¡é˜Ÿåˆ—å†…çš„å‘½ä»¤ï¼Œè¿”å›äº‹åŠ¡å†…æ‰€æœ‰å‘½ä»¤çš„è¿”å›å€¼ï¼Œå½“æ“ä½œè¢«æ‰“æ–­çš„æ—¶å€™ï¼Œè¿”å›ç©ºå€¼ nil
3.  `watch`ï¼šæ˜¯ä¸€ä¸ªä¹è§‚é”ã€‚å¯ä»¥ä¸º redis äº‹åŠ¡æä¾› CAS æ“ä½œï¼Œå¯ä»¥ç›‘æ§ä¸€ä¸ªæˆ–å¤šä¸ªé”®ã€‚ä¸€æ—¦å…¶ä¸­æœ‰ä¸€ä¸ªé”®è¢«ä¿®æ”¹ï¼ˆåˆ é™¤ï¼‰ï¼Œä¹‹åçš„äº‹åŠ¡å°±ä¸ä¼šæ‰§è¡Œï¼Œç›‘æ§ä¸€ç›´æŒç»­åˆ° exec å‘½ä»¤æ‰§è¡Œä¹‹å
4.  `discard`ï¼šè°ƒç”¨ discardï¼Œå®¢æˆ·ç«¯å¯ä»¥æ¸…ç©ºäº‹åŠ¡é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ï¼Œå¹¶æ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡

äº‹åŠ¡æ”¯æŒä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«åºåˆ—åŒ–ã€‚åœ¨äº‹åŠ¡æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¼šæŒ‰ç…§é¡ºåºä¸²è¡ŒåŒ–æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„å‘½ä»¤ï¼Œå…¶ä»–å®¢æˆ·ç«¯æäº¤çš„å‘½ä»¤è¯·æ±‚ä¸ä¼šæ’å…¥åˆ°äº‹åŠ¡æ‰§è¡Œå‘½ä»¤é˜Ÿåˆ—ä¸­ã€‚Redis ä¸æ”¯æŒå›æ»šäº‹åŠ¡ï¼Œåœ¨äº‹åŠ¡å¤±è´¥çš„æ—¶å€™ä¸ä¼šå›æ»šï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œä½™ä¸‹çš„å‘½ä»¤ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBEBT0EiaHhbADuHQRGJ8CCVrYqPlJ7PqBibvFibXo75KdSiaCMkBO16w4Gw/640?wx_fmt=png)

**æ–¹å¼1ï¼šCluster 3.0**

è¿™æ˜¯Redis è‡ªå¸¦çš„é›†ç¾¤åŠŸèƒ½ï¼Œå®ƒé‡‡ç”¨çš„åˆ†å¸ƒå¼ç®—æ³•æ˜¯å“ˆå¸Œæ§½ï¼Œè€Œä¸æ˜¯ä¸€è‡´æ€§Hashã€‚æ”¯æŒä¸»ä»ç»“æ„ï¼Œå¯ä»¥æ‰©å±•å¤šä¸ªä»æœåŠ¡å™¨ï¼Œå½“ä¸»èŠ‚ç‚¹æŒ‚äº†å¯ä»¥å¾ˆå¿«åˆ‡æ¢åˆ°ä¸€ä¸ªä»èŠ‚ç‚¹ä½œä¸»èŠ‚ç‚¹ï¼Œç„¶åå…¶ä»–ä»èŠ‚ç‚¹éƒ½ä¼šåˆ‡æ¢è¯»å–æœ€æ–°çš„ä¸»èŠ‚ç‚¹ã€‚

**æ–¹å¼2ï¼šTwemproxy**

Twitter å¼€æºçš„ä¸€ä¸ªè½»é‡çº§åç«¯ä»£ç†ã€‚å¯ä»¥ç®¡ç† Redis æˆ– Memcache é›†ç¾¤ã€‚ç›¸å¯¹äº Redis é›†ç¾¤æ¥è¯´ï¼Œæ˜“äºç®¡ç†ã€‚å®ƒçš„ä½¿ç”¨æ–¹æ³•å’ŒRedisé›†ç¾¤æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œåªéœ€è¦è®¾ç½®å¤šä¸ªRediså®ä¾‹åï¼Œåœ¨æœ¬éœ€è¦è¿æ¥ Redis çš„åœ°æ–¹æ”¹ä¸ºè¿æ¥ Twemproxy ï¼Œå®ƒå°±ä¼šä»¥ä¸€ä¸ªä»£ç†çš„èº«ä»½æ¥æ”¶è¯·æ±‚å¹¶ä½¿ç”¨ä¸€è‡´æ€§Hashç®—æ³•ï¼Œå°†è¯·æ±‚è¿æ¥åˆ°å…·ä½“çš„RedisèŠ‚ç‚¹ä¸Šï¼Œå°†ç»“æœå†è¿”å›Twemproxyã€‚å¯¹äºå®¢æˆ·ç«¯æ¥è¯´ï¼ŒTwemproxy ç›¸å½“äºæ˜¯ç¼“å­˜æ•°æ®åº“çš„æ€»å…¥å£ï¼Œå®ƒä¸éœ€è¦çŸ¥é“åç«¯å¦‚ä½•éƒ¨ç½²çš„ã€‚Twemproxy ä¼šæ£€æµ‹ä¸æ¯ä¸ªèŠ‚ç‚¹çš„è¿æ¥æ˜¯å¦æ­£å¸¸ï¼Œå¦‚æœå­˜åœ¨å¼‚å¸¸èŠ‚ç‚¹å°±ä¼šå°†å…¶å‰”é™¤ï¼Œç­‰ä¸€æ®µæ—¶é—´åï¼ŒTwemproxy è¿˜ä¼šå†æ¬¡å°è¯•è¿æ¥è¢«å‰”é™¤çš„èŠ‚ç‚¹ã€‚

**æ–¹å¼3ï¼šCodis**

å®ƒæ˜¯ä¸€ä¸ª Redis åˆ†å¸ƒå¼çš„è§£å†³æ–¹æ³•ï¼Œå¯¹äºåº”ç”¨ä½¿ç”¨ Codis Proxy çš„è¿æ¥å’Œä½¿ç”¨Redisçš„æœåŠ¡æ²¡æœ‰æ˜æ˜¾åŒºåˆ«ï¼Œåº”ç”¨èƒ½å¤Ÿåƒä½¿ç”¨å•æœº Redis ä¸€æ ·ï¼Œè®© Codis åº•å±‚å¤„ç†è¯·æ±‚è½¬å‘ï¼Œå®ç°ä¸åœæœºå®ç°æ•°æ®è¿ç§»ç­‰å·¥ä½œã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uB1PkXjLOib66Axv6oU1ia9B3F303DRIVRU7hQZSN7cibsHxib0iaCzBREOdg/640?wx_fmt=png)

> ä»€ä¹ˆæ˜¯è„‘è£‚é—®é¢˜

è„‘è£‚é—®é¢˜é€šå¸¸æ˜¯å› ä¸ºç½‘ç»œé—®é¢˜å¯¼è‡´çš„ã€‚è®© masterã€slave å’Œ sentinel ä¸‰ç±»èŠ‚ç‚¹å¤„äºä¸åŒçš„ç½‘ç»œåˆ†åŒºã€‚æ­¤æ—¶å“¨å…µæ— æ³•æ„ŸçŸ¥åˆ° master çš„å­˜åœ¨ï¼Œä¼šå°† slave æå‡ä¸º master èŠ‚ç‚¹ã€‚æ­¤æ—¶å°±ä¼šå­˜åœ¨ä¸¤ä¸ª masterï¼Œå°±åƒå¤§è„‘åˆ†è£‚ï¼Œé‚£ä¹ˆåŸæ¥çš„å®¢æˆ·ç«¯å¾€ç»§ç»­å¾€æ—§çš„ master å†™å…¥æ•°æ®ï¼Œè€Œæ–°çš„master å°±ä¼šä¸¢å¤±è¿™äº›æ•°æ®

> å¦‚ä½•è§£å†³

é€šè¿‡é…ç½®æ–‡ä»¶ä¿®æ”¹ä¸¤ä¸ªå‚æ•°

```
min-slaves-to-writeÂ 3Â Â #Â è¡¨ç¤ºè¿æ¥åˆ°Â masterÂ æœ€å°‘Â slaveÂ çš„æ•°é‡
min-slaves-max-lagÂ 10Â Â #Â è¡¨ç¤ºslaveè¿æ¥åˆ°masteræœ€å¤§çš„å»¶è¿Ÿæ—¶é—´
--------------------æ–°ç‰ˆæœ¬å†™æ³•-----------------
min-replicas-to-writeÂ 3
min-replicas-max-lagÂ Â 10
```

é…ç½®è¿™ä¸¤ä¸ªå‚æ•°ä¹‹åï¼Œå¦‚æœå‘ç”Ÿé›†ç¾¤è„‘è£‚ï¼ŒåŸå…ˆçš„masterèŠ‚ç‚¹æ¥æ”¶åˆ°å†™å…¥è¯·æ±‚å°±ä¼šæ‹’ç»ï¼Œå°±ä¼šå‡å°‘æ•°æ®åŒæ­¥ä¹‹åçš„æ•°æ®ä¸¢å¤±

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBLjSCaI1VLaicJWnpTLj6XCGpqEE58XWvWhlH3t8QXkxBWibSWksAahoQ/640?wx_fmt=png)

ä¸€èˆ¬ä½¿ç”¨ `List` ç»“æ„ä½œä¸ºé˜Ÿåˆ—ã€‚`Rpush` ç”Ÿäº§æ¶ˆæ¯ï¼Œ`Lpop` æ¶ˆè´¹æ¶ˆæ¯ã€‚å½“ `Lpop` æ²¡æœ‰æ¶ˆè´¹çš„æ—¶å€™ï¼Œéœ€è¦é€‚å½“ sleep ä¸€ä¼šå†é‡è¯•ã€‚ä½†æ˜¯é‡å¤ sleep ä¼šè€—è´¹æ€§èƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ list çš„ `blpop` æŒ‡ä»¤ï¼Œåœ¨è¿˜æ²¡æœ‰æ¶ˆæ¯åˆ°æ¥æ—¶ï¼Œå®ƒä¼šé˜»å¡ç›´åˆ°æ¶ˆæ¯åˆ°æ¥ã€‚

æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ `pub/sub` ä¸»é¢˜è®¢é˜…è€…æ¨¡å¼ï¼Œå®ç° 1ï¼šN çš„æ¶ˆè´¹é˜Ÿåˆ—ï¼Œä½†æ˜¯åœ¨æ¶ˆè´¹è€…ä¸‹çº¿çš„æ—¶å€™ï¼Œç”Ÿäº§çš„æ¶ˆæ¯ä¼šä¸¢å¤±

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uByB3BNdERA349D2YVz5OloKR7wUekRDNVrUExCPkKz3LL2oWLqNdA8A/640?wx_fmt=png)

å¯ä»¥ä½¿ç”¨ `zset` ç»“æ„ï¼Œå¯ä»¥æ‹¿æ—¶é—´æˆ³ä½œä¸º scoreï¼Œæ¶ˆæ¯çš„å†…å®¹ä½œä¸ºkeyï¼Œé€šè¿‡è°ƒç”¨ `zadd` æ¥ç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ä½¿ç”¨ `zrangebyscore` æŒ‡ä»¤è½®è¯¢è·å– N ç§’ä¹‹å‰çš„æ•°æ®è¿›è¡Œå¤„ç†

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBAefbJwy388IJv8USpH1aG5kCgngWDvZWs34CIj13RUjHeeo0QFOocw/640?wx_fmt=png)

Redis Clusteræä¾›äº†è‡ªåŠ¨å°†æ•°æ®åˆ†æ•£åˆ°å„ä¸ªä¸åŒèŠ‚ç‚¹çš„èƒ½åŠ›ï¼Œä½†é‡‡ç”¨çš„ç­–ç•¥å¹¶ä¸æ˜¯ä¸€è‡´æ€§Hashï¼Œè€Œæ˜¯å“ˆå¸Œæ§½ã€‚Redis é›†ç¾¤å°†æ•´ä¸ªKeyçš„æ•°å€¼åŸŸåˆ†æˆ16384ä¸ªå“ˆå¸Œæ§½ï¼Œæ¯ä¸ªKeyé€šè¿‡ CRC16æ£€éªŒåå¯¹16384é©±é­”æ¥å†³å®šæ”¾ç½®åˆ°é‚£ä¸ªæ§½ä¸­ï¼Œé›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è´Ÿè´£å…¶ä¸­ä¸€éƒ¨åˆ†çš„å“ˆå¸Œæ§½ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uB3nAA85P9Tvr05UuQ9nN2mjKVuJwZUxwfMxLhP6h2BorlNI7Rs6rWiaw/640?wx_fmt=png)

**1ã€æ•°æ®ç¼“å­˜**

ç»å…¸çš„åœºæ™¯ï¼Œç°åœ¨å‡ ä¹æ˜¯æ‰€æœ‰ä¸­å¤§å‹ç½‘ç«™éƒ½åœ¨ç”¨çš„æå‡æ‰‹æ®µï¼Œåˆç†åœ°åˆ©ç”¨ç¼“å­˜èƒ½å¤Ÿæå‡ç½‘ç«™è®¿é—®é€Ÿåº¦

**2ã€æ’è¡Œæ¦œ**

å¯ä»¥å€ŸåŠ©Redisæä¾›çš„æœ‰åºé›†åˆï¼ˆ`sorted set`ï¼‰èƒ½åŠ›å®ç°æ’è¡Œæ¦œçš„åŠŸèƒ½

**3ã€è®¡æ•°å™¨**

å¯ä»¥å€ŸåŠ©Redisæä¾›çš„ `incr` å‘½ä»¤æ¥å®ç°è®¡æ•°å™¨åŠŸèƒ½ï¼Œå› ä¸ºæ˜¯å•çº¿ç¨‹çš„åŸå­æ“ä½œï¼Œä¿è¯äº†ç»Ÿè®¡ä¸ä¼šå‡ºé”™ï¼Œè€Œä¸”é€Ÿåº¦å¿«

**4ã€åˆ†å¸ƒå¼sessionå…±äº«**

é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œå¯ä»¥åŸºäº Redis å®ç° session å…±äº«

**5ã€åˆ†å¸ƒå¼é”**

åœ¨åˆ†å¸ƒå¼æ¶æ„ä¸­ï¼Œä¸ºäº†ä¿è¯å¹¶å‘è®¿é—®æ—¶æ“ä½œçš„åŸå­æ€§ï¼Œå¯ä»¥åˆ©ç”¨Redisæ¥å®ç°åˆ†å¸ƒå¼é”çš„åŠŸèƒ½

**6ã€æœ€æ–°åˆ—è¡¨**

å¯ä»¥å€ŸåŠ©Redisåˆ—è¡¨ç»“æ„ï¼Œ`LPUSH`ã€`LPOP`ã€`LTRIM`ç­‰å‘½ä»¤æ¥å®Œæˆå†…å®¹çš„æŸ¥è¯¢

**7ã€ä½æ“ä½œ**

å¯ä»¥å€ŸåŠ©Redisä¸­ `setbit`ã€`getbit`ã€`bitcount` ç­‰å‘½ä»¤æ¥å®Œæˆæ•°é‡ä¸Šåƒä¸‡ç”šè‡³ä¸Šäº¿çš„åœºæ™¯ä¸‹ï¼Œå®ç°ç”¨æˆ·æ´»è·ƒåº¦ç»Ÿè®¡

**8ã€æ¶ˆæ¯é˜Ÿåˆ—**

Redis æä¾›äº†å‘å¸ƒï¼ˆ`Publish`ï¼‰ä¸è®¢é˜…ï¼ˆ`Subscribe`ï¼‰ä»¥åŠé˜»å¡é˜Ÿåˆ—èƒ½åŠ›ï¼Œèƒ½å¤Ÿå®ç°ä¸€ä¸ªç®€å•çš„æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿ

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBKCJj5KMFkZUsnicLbdXNzKv6FdmXNXCrfBZJbmWRsmBI6ibUrlTHGx3Q/640?wx_fmt=png)

**æ–¹å¼1ï¼šSet ç»“æ„**

ä»¥æ—¥æœŸä¸º keyï¼Œä»¥ç”¨æˆ· IDï¼ˆå¯¹åº”æ•°æ®åº“çš„ Primary Idï¼‰ç»„æˆçš„é›†åˆä¸º value

*   æŸ¥è¯¢æŸä¸ªç”¨æˆ·çš„ç­¾åˆ°çŠ¶æ€ `sismember key member`
*   æ’å…¥ç­¾åˆ°çŠ¶æ€ `sadd key member`
*   ç»Ÿè®¡æŸå¤©ç”¨æˆ·çš„ç­¾åˆ°äººæ•° `scard key`

##### 2ã€bitMap ç»“æ„

Keyçš„æ ¼å¼ä¸º`u:sign:uid:yyyyMM`ï¼ŒValueåˆ™é‡‡ç”¨é•¿åº¦ä¸º4ä¸ªå­—èŠ‚ï¼ˆ32ä½ï¼‰çš„ä½å›¾ï¼ˆæœ€å¤§æœˆä»½åªæœ‰31å¤©ï¼‰ã€‚ä½å›¾çš„æ¯ä¸€ä½ä»£è¡¨ä¸€å¤©çš„ç­¾åˆ°ï¼Œ1è¡¨ç¤ºå·²ç­¾ï¼Œ0è¡¨ç¤ºæœªç­¾ã€‚

```
#Â ç”¨æˆ·2æœˆ17å·ç­¾åˆ°
SETBITÂ u:sign:1000:201902Â 16Â 1Â #Â åç§»é‡æ˜¯ä»0å¼€å§‹ï¼Œæ‰€ä»¥è¦æŠŠ17å‡1


#Â æ£€æŸ¥2æœˆ17å·æ˜¯å¦ç­¾åˆ°
GETBITÂ u:sign:1000:201902Â 16Â #Â åç§»é‡æ˜¯ä»0å¼€å§‹ï¼Œæ‰€ä»¥è¦æŠŠ17å‡1


#Â ç»Ÿè®¡2æœˆä»½çš„ç­¾åˆ°æ¬¡æ•°
BITCOUNTÂ u:sign:1000:201902


#Â è·å–2æœˆä»½å‰28å¤©çš„ç­¾åˆ°æ•°æ®
BITFIELDÂ u:sign:1000:201902Â getÂ u28Â 0


#Â è·å–2æœˆä»½é¦–æ¬¡ç­¾åˆ°çš„æ—¥æœŸ
BITPOSÂ u:sign:1000:201902Â 1Â #Â è¿”å›çš„é¦–æ¬¡ç­¾åˆ°çš„åç§»é‡ï¼ŒåŠ ä¸Š1å³ä¸ºå½“æœˆçš„æŸä¸€å¤©
```

***ä¸¤è€…å¯¹æ¯”***

1.  ä½¿ç”¨ set çš„æ–¹å¼æ‰€å ç”¨çš„å†…å­˜åªä¸æ•°é‡ç›¸å…³ï¼Œå’Œå­˜å‚¨å“ªäº› ID æ— å…³
2.  ä½¿ç”¨ bitmap çš„æ–¹å¼æ‰€å ç”¨çš„å†…å­˜ä¸æ•°é‡æ²¡æœ‰ç»å¯¹çš„å…³ç³»ï¼Œè€Œæ˜¯ä¸æœ€é«˜ä½æœ‰å…³ï¼Œæ¯”å¦‚å‡è®¾ ID ä¸º 500 Wçš„ç”¨æˆ·ç­¾åˆ°äº†ï¼Œé‚£ä¹ˆä» 1~4999999 ç”¨æˆ·ä¸ç®¡æ˜¯å¦ç­¾åˆ°ï¼Œæ‰€å ç”¨çš„å†…å­˜éƒ½æ˜¯ 500 wä¸ªbitï¼Œè¿™è¾¹æ˜¯æœ€åçš„æƒ…å†µ
3.  ä½¿ç”¨ bitmap æœ€å¤§å¯ä»¥å­˜å‚¨ 2^32-1ä¹Ÿå°±æ˜¯ 512M æ•°æ®
4.  ä½¿ç”¨ bitmap åªé€‚ç”¨å­˜å‚¨åªæœ‰ä¸¤ä¸ªçŠ¶æ€çš„æ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·ç­¾åˆ°ï¼Œèµ„æºï¼ˆè§†é¢‘ã€æ–‡ç« ã€å•†å“ï¼‰çš„å·²è¯»æˆ–æœªè¯»çŠ¶æ€

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uBfIOnBJ99ga3uzqIAHPEpiafSxRgLo9ia9txiakgib6XsF5mHRotcB8AiazA/640?wx_fmt=png)

Redisä¸­ ZSet æ˜¯é€‰æ‹©ä½¿ç”¨ `è·³è¡¨` è€Œä¸æ˜¯çº¢é»‘æ ‘

> ä»€ä¹ˆæ˜¯è·³è¡¨

*   è·³è¡¨æ˜¯ä¸€ä¸ªéšæœºåŒ–çš„æ•°æ®ç»“æ„ï¼Œå®è´¨ä¸Šå°±æ˜¯ä¸€ç§å¯ä»¥è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾çš„æœ‰åºé“¾è¡¨ã€‚
*   è·³è¡¨åœ¨åŸæœ‰çš„æœ‰åºé“¾è¡¨ä¸Šå¢åŠ äº†å¤šçº§ç´¢å¼•ï¼Œé€šè¿‡ç´¢å¼•æ¥å®ç°å¿«é€ŸæŸ¥æ‰¾
*   è·³è¡¨ä¸ä»…èƒ½æé«˜æœç´¢æ€§èƒ½ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æé«˜æ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ€§èƒ½

![](https://mmbiz.qpic.cn/mmbiz_png/P7WuIzkp9iaXuoibkSfkk1ia6m8UZqibD4uB2K7GaFZKRhglARgFAV8qFmtgibSN6z9gvUcwCFlWiaRtkPax4FVYVR1g/640?wx_fmt=png)

***æ€»ç»“ï¼š***

1.  è·³è¡¨æ˜¯å¯ä»¥å®ç°äºŒåˆ†æŸ¥æ‰¾çš„æœ‰åºé“¾è¡¨
2.  æ¯ä¸ªå…ƒç´ æ’å…¥æ—¶éšæœºç”Ÿæˆå®ƒçš„ level
3.  æœ€åº•å±‚åŒ…å«æ‰€æœ‰çš„å…ƒç´ 
4.  å¦‚æœä¸€ä¸ªå…ƒç´ å‡ºç°åœ¨ level(x)ï¼Œé‚£ä¹ˆå®ƒè‚¯å®šå‡ºç°åœ¨ x ä»¥ä¸‹çš„ level ä¸­
5.  æ¯ä¸ªç´¢å¼•èŠ‚ç‚¹åŒ…å«ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªå‘ä¸‹ï¼Œä¸€ä¸ªå‘å³
6.  è·³è¡¨æŸ¥è¯¢ã€æ’å…¥ã€åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦ä¸º O(log n)ï¼Œä¸å¹³è¡¡äºŒå‰æ ‘æ¥è¿‘

> ä¸ºä»€ä¹ˆä¸é€‰æ‹©çº¢é»‘æ ‘æ¥å®ç°

é¦–å…ˆæ¥åˆ†æä¸‹ Redis çš„æœ‰åºé›†åˆæ”¯æŒçš„æ“ä½œï¼š

1.  æ’å…¥å…ƒç´ 
2.  åˆ é™¤å…ƒç´ 
3.  æŸ¥æ‰¾å…ƒç´ 
4.  æœ‰åºè¾“å‡ºæ‰€æœ‰å…ƒç´ 
5.  æŸ¥æ‰¾åŒºé—´å†…çš„æ‰€æœ‰å…ƒç´ 

å…¶ä¸­å‰ 4 é¡¹çº¢é»‘æ ‘éƒ½å¯ä»¥å®Œæˆï¼Œä¸”æ—¶é—´å¤æ‚åº¦ä¸è·³è¡¨ä¸€è‡´ï¼Œä½†æ˜¯æœ€åä¸€ä¸ªçº¢é»‘æ ‘çš„æ•ˆç‡å°±æ²¡æœ‰è·³è¡¨é«˜äº†ã€‚åœ¨è·³è¡¨ä¸­ï¼Œè¦æŸ¥æ‰¾åŒºé—´çš„å…ƒç´ ï¼Œåªè¦å®šä½åˆ°ä¸¤ä¸ªåŒºé—´ç«¯ç‚¹åœ¨æœ€ä½å±‚çº§çš„ä½ç½®ï¼Œç„¶åæŒ‰é¡ºåºéå†å…ƒç´ å°±å¯ä»¥äº†ï¼Œéå¸¸é«˜æ•ˆã€‚


---

æ²¡æœ‰ä»€ä¹ˆä½¿æˆ‘åœç•™â€”â€”é™¤äº†ç›®çš„ï¼Œçºµç„¶å²¸æ—æœ‰ç«ç‘°ã€æœ‰ç»¿è«ã€æœ‰å®é™çš„æ¸¯æ¹¾ï¼Œæˆ‘æ˜¯ä¸ç³»ä¹‹èˆŸğŸ¤”ã€‚

- âœŒï¸ï¼š[å·¥ä½œå››å¹´ï¼Œè¢«åŠ¨é†’æ‚Ÿ](https://mp.weixin.qq.com/s/q-o4SBZQ3SH62T0c52aBUw)
- âœŒï¸ï¼š[æ¥ç½‘æ˜“å››ä¸ªæœˆï¼ŒçœŸçš„ä¸ä¸€æ ·](https://mp.weixin.qq.com/s/4Zcd16hMazydelrN6CUXBA)
- âœŒï¸ï¼š[ç§‹æ‹› 13 å®¶ offerï¼Œæ‰‹åˆ°æ“’æ¥](https://mp.weixin.qq.com/s/LKkvcSdhMyXAGgtqEak0Zw)
- âœŒï¸ï¼š[è€ƒç ”å¤±è´¥ï¼ŒçœŸçš„ä¸ç”˜å¿ƒ](https://mp.weixin.qq.com/s/mrSxrQYaWiUE82tBUu3XIw)
- âœŒï¸ï¼š[æƒ³æ˜¥æ‹›æ‰¾ä¸ªå®ä¹ ï¼Œæˆ‘è¯¥å¦‚ä½•å‡†å¤‡ï¼Ÿ](https://mp.weixin.qq.com/s/eyCEQKclRkTnsJze01Bilg)
- âœŒï¸ï¼š[é€¼ç­¾ï¼å†²å­—èŠ‚è¿˜æ˜¯è‹ŸåŒèŠ±é¡ºï¼Ÿ](https://mp.weixin.qq.com/s/Dv_kcwUT-KTZ6LAwn3o_Jg)
- âœŒï¸ï¼š[ç®€å†ä¸Šå†™äº†è¿™ä¿©é¡¹ç›®ï¼Œè¶…çº§åŠ åˆ†ï¼](https://mp.weixin.qq.com/s/yYWD0VPZ_NoGPOmhoa-OlQ)
- âœŒï¸ï¼š[åŒéå¾ˆèœï¼Œæ‹¿åˆ°è¿™ä¿©offeræŒºä¸å®¹æ˜“](https://mp.weixin.qq.com/s/OHXpEOKcLaKW8h0TS4Xqjg)
- âœŒï¸ï¼š[ä»Šå¹´åµŒå…¥å¼è½¯ä»¶è¿™å—çœŸæŒºé¦™](https://mp.weixin.qq.com/s/6YuyA1Ja5RfDEQatfsQpjA)
- âœŒï¸ï¼š[å…¥èŒ 15 å¤©ï¼Œå°±æƒ³è·‘è·¯äº†ï¼Ÿ](https://mp.weixin.qq.com/s/EW95wdK4SM0CiBEJqUP7Mg)
- âœŒï¸ï¼š[æ¯”äºšè¿ªï¼Œæ•‘äº†æˆ‘ç§‹æ‹›çš„å‘½](https://mp.weixin.qq.com/s/PmVwFKsXkGeJjmNPiu5hrQ)


>å‚è€ƒé“¾æ¥ï¼š[https://mp.weixin.qq.com/s/l9V21i70cMlq3mE_4cA2oA](https://mp.weixin.qq.com/s/l9V21i70cMlq3mE_4cA2oA)ï¼Œå‡ºå¤„ï¼šèœå†œæ›°ï¼Œæ•´ç†ï¼šæ²‰é»˜ç‹äºŒ
