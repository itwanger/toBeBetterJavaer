---
title: xxl-jobæƒŠè‰³çš„è®¾è®¡ï¼Œæ€èƒ½å«äººä¸çˆ±
shortTitle: xxl-jobæƒŠè‰³çš„è®¾è®¡ï¼Œæ€èƒ½å«äººä¸çˆ±
author: æºç è¶…çº§è”ç›Ÿ
category:
  - å¾®ä¿¡å…¬ä¼—å·
---

* * *

æ–‡ç« æ¥æºï¼šhttps://c1n.cn/N8Mlnâ€â€â€â€â€â€



**ç›®å½•**

*   é€šä¿¡åº•å±‚ä»‹ç»
*   é€šä¿¡æ•´ä½“æµç¨‹
*   æƒŠè‰³çš„è®¾è®¡



**é€šä¿¡åº•å±‚ä»‹ç»**



xxl-job ä½¿ç”¨ netty http çš„æ–¹å¼è¿›è¡Œé€šä¿¡ï¼Œè™½ç„¶ä¹Ÿæ”¯æŒ Minaï¼Œjettyï¼Œnetty tcp ç­‰æ–¹å¼ï¼Œä½†æ˜¯ä»£ç é‡Œé¢å›ºå®šå†™æ­»çš„æ˜¯ netty httpã€‚



**é€šä¿¡æ•´ä½“æµç¨‹**



æˆ‘ä»¥è°ƒåº¦å™¨é€šçŸ¥æ‰§è¡Œå™¨æ‰§è¡Œä»»åŠ¡ä¸ºä¾‹ï¼Œç»˜åˆ¶çš„æ´»åŠ¨å›¾ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/weixin-xxljobjydsjznjrba-27c73954-acc5-4571-b344-7cfaa6c96b7d.jpg)

*æ´»åŠ¨å›¾*



**æƒŠè‰³çš„è®¾è®¡**



çœ‹å®Œäº†æ•´ä¸ªå¤„ç†æµç¨‹ä»£ç ï¼Œè®¾è®¡ä¸Šå¯ä»¥è¯´ç‹¬å…·åŒ å¿ƒï¼Œå°† nettyï¼Œå¤šçº¿ç¨‹çš„çŸ¥è¯†è¿ç”¨å¾—è¡Œäº‘æµæ°´ã€‚



æˆ‘ç°åœ¨å°±å°†è¿™äº›è®¾è®¡ä¸Šå‡ºå½©çš„ç‚¹æ€»ç»“å¦‚ä¸‹ï¼š



#### **| ä½¿ç”¨åŠ¨æ€ä»£ç†æ¨¡å¼ï¼Œéšè—é€šä¿¡ç»†èŠ‚**

xxl-job å®šä¹‰äº†ä¸¤ä¸ªæ¥å£ ExecutorBizï¼ŒAdminBizï¼ŒExecutorBiz æ¥å£ä¸­å°è£…äº†å‘å¿ƒè·³ï¼Œæš‚åœï¼Œè§¦å‘æ‰§è¡Œç­‰æ“ä½œï¼ŒAdminBiz å°è£…äº†å›è°ƒï¼Œæ³¨å†Œï¼Œå–æ¶ˆæ³¨å†Œæ“ä½œï¼Œæ¥å£çš„å®ç°ç±»ä¸­ï¼Œå¹¶æ²¡æœ‰é€šä¿¡ç›¸å…³çš„å¤„ç†ã€‚



XxlRpcReferenceBean ç±»çš„ getObject() æ–¹æ³•ä¼šç”Ÿæˆä¸€ä¸ªä»£ç†ç±»ï¼Œè¿™ä¸ªä»£ç†ç±»ä¼šè¿›è¡Œè¿œç¨‹é€šä¿¡ã€‚



#### **| å…¨å¼‚æ­¥å¤„ç†**

æ‰§è¡Œå™¨æ”¶åˆ°æ¶ˆæ¯è¿›è¡Œååºåˆ—åŒ–ï¼Œå¹¶æ²¡æœ‰åŒæ­¥æ‰§è¡Œä»»åŠ¡ä»£ç ï¼Œè€Œæ˜¯å°†ä»»åŠ¡ä¿¡æ¯å­˜å‚¨åœ¨Â LinkedBlockingQueue ä¸­ï¼Œå¼‚æ­¥çº¿ç¨‹ä»è¿™ä¸ªé˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ä¿¡æ¯ï¼Œç„¶åæ‰§è¡Œã€‚



è€Œä»»åŠ¡çš„å¤„ç†ç»“æœï¼Œä¹Ÿä¸æ˜¯è¯´å¤„ç†å®Œä¹‹åï¼ŒåŒæ­¥è¿”å›çš„ï¼Œä¹Ÿæ˜¯æ”¾åˆ°å›è°ƒçº¿ç¨‹çš„é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œå¼‚æ­¥çš„å°†å¤„ç†ç»“æœè¿”å›å›å»ã€‚



è¿™æ ·å¤„ç†çš„å¥½å¤„å°±æ˜¯å‡å°‘äº† netty å·¥ä½œçº¿ç¨‹çš„å¤„ç†æ—¶é—´ï¼Œæå‡äº†ååé‡ã€‚



#### **| å¯¹å¼‚æ­¥å¤„ç†çš„åŒ…è£…**

å¯¹å¼‚æ­¥å¤„ç†è¿›è¡Œäº†åŒ…è£…ï¼Œä»£ç çœ‹èµ·æ¥æ˜¯åŒæ­¥è°ƒç”¨çš„ã€‚



æˆ‘ä»¬çœ‹ä¸‹è°ƒåº¦å™¨ï¼ŒXxlJobTrigger ç±»è§¦å‘ä»»åŠ¡æ‰§è¡Œçš„ä»£ç ï¼š

```
publicÂ staticÂ ReturnT<String>Â runExecutor(TriggerParamÂ triggerParam,Â StringÂ address){
Â Â Â Â ReturnT<String>Â runResultÂ =Â null;
Â Â Â Â tryÂ {
Â Â Â Â Â Â Â Â ExecutorBizÂ executorBizÂ =Â XxlJobScheduler.getExecutorBiz(address);
Â Â Â Â Â Â Â Â //è¿™é‡Œé¢åšäº†å¾ˆå¤šå¼‚æ­¥å¤„ç†ï¼Œæœ€ç»ˆåŒæ­¥å¾—åˆ°å¤„ç†ç»“æœ
Â Â Â Â Â Â Â Â runResultÂ =Â executorBiz.run(triggerParam);
Â Â Â Â }Â catchÂ (ExceptionÂ e)Â {
Â Â Â Â Â Â Â Â logger.error(">>>>>>>>>>>Â xxl-jobÂ triggerÂ error,Â pleaseÂ checkÂ ifÂ theÂ executor[{}]Â isÂ running.",Â address,Â e);
Â Â Â Â Â Â Â Â runResultÂ =Â newÂ ReturnT<String>(ReturnT.FAIL_CODE,Â ThrowableUtil.toString(e));
Â Â Â Â }

Â Â Â Â StringBufferÂ runResultSBÂ =Â newÂ StringBuffer(I18nUtil.getString("jobconf_trigger_run")Â +Â "ï¼š");
Â Â Â Â runResultSB.append("<br>addressï¼š").append(address);
Â Â Â Â runResultSB.append("<br>codeï¼š").append(runResult.getCode());
Â Â Â Â runResultSB.append("<br>msgï¼š").append(runResult.getMsg());

Â Â Â Â runResult.setMsg(runResultSB.toString());
Â Â Â Â returnÂ runResult;
}
```



ExecutorBiz.run æ–¹æ³•æˆ‘ä»¬è¯´è¿‡äº†ï¼Œæ˜¯èµ°çš„åŠ¨æ€ä»£ç†ï¼Œå’Œæ‰§è¡Œå™¨è¿›è¡Œé€šä¿¡ï¼Œæ‰§è¡Œå™¨æ‰§è¡Œç»“æœä¹Ÿæ˜¯å¼‚æ­¥å¤„ç†å®Œï¼Œæ‰è¿”å›çš„ï¼Œè€Œè¿™é‡Œçœ‹åˆ°çš„ run æ–¹æ³•æ˜¯åŒæ­¥ç­‰å¾…å¤„ç†ç»“æœè¿”å›ã€‚



æˆ‘ä»¬çœ‹ä¸‹xxl-jobæ˜¯å¦‚ä½•åŒæ­¥è·å–å¤„ç†ç»“æœçš„ï¼šè°ƒåº¦å™¨å‘æ‰§è¡Œå™¨å‘å‡ºæ¶ˆæ¯åï¼Œè¯¥çº¿ç¨‹é˜»å¡ã€‚ç­‰åˆ°æ‰§è¡Œå™¨å¤„ç†å®Œæ¯•åï¼Œå°†å¤„ç†ç»“æœè¿”å›ï¼Œå”¤é†’è¢«é˜»å¡çš„çº¿ç¨‹ï¼Œè°ƒç”¨å¤„æ‹¿åˆ°è¿”å›å€¼ã€‚



åŠ¨æ€ä»£ç†ä»£ç å¦‚ä¸‹ï¼š

```
//ä»£ç†ç±»ä¸­çš„è§¦å‘è°ƒç”¨
ifÂ (CallType.SYNCÂ ==Â callType)Â {
Â Â Â //Â future-responseÂ set
Â Â Â XxlRpcFutureResponseÂ futureResponseÂ =Â newÂ XxlRpcFutureResponse(invokerFactory,Â xxlRpcRequest,Â null);
Â Â Â tryÂ {
Â Â Â Â Â Â //Â doÂ invoke
Â Â Â Â Â Â client.asyncSend(finalAddress,Â xxlRpcRequest);

Â Â Â Â Â Â //Â futureÂ get
Â Â Â Â Â Â XxlRpcResponseÂ xxlRpcResponseÂ =Â futureResponse.get(timeout,Â TimeUnit.MILLISECONDS);
Â Â Â Â Â Â ifÂ (xxlRpcResponse.getErrorMsg()Â !=Â null)Â {
Â Â Â Â Â Â Â Â Â throwÂ newÂ XxlRpcException(xxlRpcResponse.getErrorMsg());
Â Â Â Â Â Â }
Â Â Â Â Â Â returnÂ xxlRpcResponse.getResult();
Â Â Â }Â catchÂ (ExceptionÂ e)Â {
Â Â Â Â Â Â logger.info(">>>>>>>>>>>Â xxl-rpc,Â invokeÂ error,Â address:{},Â XxlRpcRequest{}",Â finalAddress,Â xxlRpcRequest);

Â Â Â Â Â Â throwÂ (eÂ instanceofÂ XxlRpcException)?e:newÂ XxlRpcException(e);
Â Â Â }Â finally{
Â Â Â Â Â Â //Â future-responseÂ remove
Â Â Â Â Â Â futureResponse.removeInvokerFuture();
Â Â Â }
}Â 
```



XxlRpcFutureResponse ç±»ä¸­å®ç°äº†çº¿ç¨‹çš„ç­‰å¾…ï¼Œå’Œçº¿ç¨‹å”¤é†’çš„å¤„ç†ï¼š

```
//è¿”å›ç»“æœï¼Œå”¤é†’çº¿ç¨‹
publicÂ voidÂ setResponse(XxlRpcResponseÂ response)Â {
Â Â Â this.responseÂ =Â response;
Â Â Â synchronizedÂ (lock)Â {
Â Â Â Â Â Â doneÂ =Â true;
Â Â Â Â Â Â lock.notifyAll();
Â Â Â }
}

@Override
Â Â Â Â publicÂ XxlRpcResponseÂ get(longÂ timeout,Â TimeUnitÂ unit)Â throwsÂ InterruptedException,Â ExecutionException,Â TimeoutExceptionÂ {
Â Â Â Â Â Â Â Â ifÂ (!done)Â {
Â Â Â Â Â Â Â Â Â Â Â Â synchronizedÂ (lock)Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â tryÂ {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (timeoutÂ <Â 0)Â {
Â Â Â Â Â Â Â Â Â Â Â Â //çº¿ç¨‹é˜»å¡
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lock.wait();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â longÂ timeoutMillisÂ =Â (TimeUnit.MILLISECONDS==unit)?timeout:TimeUnit.MILLISECONDS.convert(timeoutÂ ,Â unit);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lock.wait(timeoutMillis);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â catchÂ (InterruptedExceptionÂ e)Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â throwÂ e;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â ifÂ (!done)Â {
Â Â Â Â Â Â Â Â Â Â Â Â throwÂ newÂ XxlRpcException("xxl-rpc,Â requestÂ timeoutÂ at:"+Â System.currentTimeMillis()Â +",Â request:"Â +Â request.toString());
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â returnÂ response;
Â Â Â Â }
```



æœ‰çš„åŒå­¦å¯èƒ½ä¼šé—®äº†ï¼Œè°ƒåº¦å™¨æ¥æ”¶åˆ°è¿”å›ç»“æœï¼Œæ€ä¹ˆç¡®å®šå”¤é†’å“ªä¸ªçº¿ç¨‹å‘¢ï¼Ÿ



æ¯ä¸€æ¬¡è¿œç¨‹è°ƒç”¨ï¼Œéƒ½ä¼šç”Ÿæˆ uuid çš„è¯·æ±‚ idï¼Œè¿™ä¸ª id æ˜¯åœ¨æ•´ä¸ªè°ƒç”¨è¿‡ç¨‹ä¸­ä¸€ç›´ä¼ é€’çš„ï¼Œå°±åƒä¸€æŠŠé’¥åŒ™ï¼Œåœ¨ä½ å›å®¶çš„çš„æ—¶å€™ï¼Œæ‹¿ç€å®ƒå°±å¸¦å¼€é—¨ã€‚



è¿™é‡Œæ‹¿ç€è¯·æ±‚ id è¿™æŠŠé’¥åŒ™ï¼Œå°±èƒ½æ‰¾åˆ°å¯¹åº”çš„ XxlRpcFutureResponseï¼Œç„¶åè°ƒç”¨ setResponse æ–¹æ³•ï¼Œè®¾ç½®è¿”å›å€¼ï¼Œå”¤é†’çº¿ç¨‹ã€‚

```
publicÂ voidÂ notifyInvokerFuture(StringÂ requestId,Â finalÂ XxlRpcResponseÂ xxlRpcResponse){

Â Â Â Â //Â é€šè¿‡requestIdæ‰¾åˆ°XxlRpcFutureResponseï¼Œ
Â Â Â Â finalÂ XxlRpcFutureResponseÂ futureResponseÂ =Â futureResponsePool.get(requestId);
Â Â Â Â ifÂ (futureResponseÂ ==Â null)Â {
Â Â Â Â Â Â Â Â return;
Â Â Â Â }
Â Â Â Â ifÂ (futureResponse.getInvokeCallback()!=null)Â {

Â Â Â Â Â Â Â Â //Â callbackÂ type
Â Â Â Â Â Â Â Â tryÂ {
Â Â Â Â Â Â Â Â Â Â Â Â executeResponseCallback(newÂ Runnable()Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â @Override
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â publicÂ voidÂ run()Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (xxlRpcResponse.getErrorMsg()Â !=Â null)Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â futureResponse.getInvokeCallback().onFailure(newÂ XxlRpcException(xxlRpcResponse.getErrorMsg()));
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â futureResponse.getInvokeCallback().onSuccess(xxlRpcResponse.getResult());
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â });
Â Â Â Â Â Â Â Â }catchÂ (ExceptionÂ e)Â {
Â Â Â Â Â Â Â Â Â Â Â Â logger.error(e.getMessage(),Â e);
Â Â Â Â Â Â Â Â }
Â Â Â Â }Â elseÂ {
Â Â Â Â Â Â Â Â //Â é‡Œé¢è°ƒç”¨lockçš„notifyæ–¹æ³•
Â Â Â Â Â Â Â Â futureResponse.setResponse(xxlRpcResponse);
Â Â Â Â }

Â Â Â Â //Â doÂ remove
Â Â Â Â futureResponsePool.remove(requestId);

}
```





    

     \-------------Â  ENDÂ Â -------------
    

    

**æ­¤å¤–ï¼Œæˆ‘çš„æ‰€æœ‰æ–‡ç« å·²ç»å¼€æºäº†ã€‚æ›´å¤šç²¾å½©å†…å®¹æ”¶å½•åœ¨æˆ‘çš„GitHubï¼Œè®¿é—®åœ°å€ï¼š****https://github.com/dvsusan/susanSayJava****ï¼Œæ¬¢è¿å°ä¼™ä¼´ä»¬ç»™æˆ‘ä¸€ä¸ª****star****ã€‚**

**ç‚¹å‡»**ğŸ‘‡ğŸ»**é˜…è¯»åŸæ–‡ï¼Œç›´æ¥å¯è®¿é—®è¯¥github**