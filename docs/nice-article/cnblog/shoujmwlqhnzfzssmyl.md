---
title: æ‰‹æœºæ²¡ç½‘äº†ï¼Œå´è¿˜èƒ½æ”¯ä»˜ï¼Œè¿™æ˜¯ä»€ä¹ˆåŸç†ï¼Ÿ
shortTitle: æ‰‹æœºæ²¡ç½‘äº†ï¼Œå´è¿˜èƒ½æ”¯ä»˜ï¼Œè¿™æ˜¯ä»€ä¹ˆåŸç†ï¼Ÿ
author: æ¥¼ä¸‹å°é»‘å“¥
category:
  - åšå®¢å›­
---

ç°åœ¨ç”Ÿæ´»å·²ç»ç¦»ä¸å¼€å¾®ä¿¡/æ”¯ä»˜å®ç”µå­æ”¯ä»˜ï¼Œå¹³å¸¸å‡ºå»åƒé¥­ã€è´­ç‰©åªè¦å¸¦ä¸ªæ‰‹æœºï¼Œå°±å¯ä»¥è§£å†³ä¸€åˆ‡ï¼Œä»¥è‡´äºç°åœ¨å·²ç»å¥½ä¹…æ²¡æ‘¸è¿‡çœŸğŸ’°äº†ã€‚

æœ‰ä¸€æ¬¡å‡ºå»åƒé¥­ï¼Œæ’ç€é˜Ÿä»˜é’±ï¼Œç­‰ç€è¿‡ç¨‹éå¸¸æ— èŠï¼Œå‡†å¤‡æ‹”å‡ºæ‰‹æœºæ¥æŠŠè’é‡ä¹±æ–—ï¼Œå´å‘ç°è¿™ä¸ªåœ°æ–¹ç«Ÿç„¶è¿ä¸ä¸Šç½‘ ã€‚

![](https://img2020.cnblogs.com/other/1419561/202009/1419561-20200903084258108-174125349.jpg)

çœ‹ç€æ‰‹æœºæ˜æ˜ä¿¡å·æ»¡æ ¼ï¼Œä½†æ˜¯å°±æ˜¯æ˜¾ç¤ºç½‘ç»œæ— è¿æ¥ï¼Œè‹¹æœæ‰‹æœºç”¨æˆ·ç—›ï¼Œè°ç”¨è°çŸ¥é“ã€‚

> ç”»å¤–éŸ³:çœŸçš„è¦ Diss ä¸€ä¸‹ä½¿ç”¨è‹±ç‰¹å°”åŸºå¸¦çš„ Iphoneï¼ŒğŸ“¶å¥½å·®ï¼Œæ²¡äº‹ç½‘ç»œå°±ä¼šé—ªæ–­~

è¯´å›æ­£é¢˜ï¼Œç”±äºæ²¡æœ‰ç½‘ç»œï¼Œè€Œæˆ‘åˆæ²¡å¸¦é’±ï¼Œæ‰€ä»¥å°±æ€•ä»˜é’±çš„æ—¶å€™å› ä¸ºæ‰‹æœºæ²¡ç½‘ï¼Œæ²¡åŠæ³•ä½¿ç”¨æ”¯ä»˜å®æ‰£æ¬¾ã€‚æ­£æƒ³ç€æ—¶ï¼Œå·²ç»æ’åˆ°äº†æˆ‘ï¼Œä¸ç®¡ä¸‰ä¸ƒäºŒåä¸€ï¼Œå…ˆç”¨ä¸‹æ”¯ä»˜å®è¯•è¯•ï¼Œå®åœ¨ä¸è¡Œçˆ·ä¸åƒäº†ã€‚

ä¸è¿‡æ²¡æƒ³åˆ°ï¼Œå½“å•†å®¶ç”¨æ‰«ç æŠ¢æ‰«ææ”¯ä»˜å®ä¸Šä»˜æ¬¾ç æ”¯ä»˜ä»¥åï¼Œè™½ç„¶æˆ‘çš„æ‰‹æœºæœ€ç»ˆæ²¡æœ‰å¼¹å‡ºæ”¯ä»˜æˆåŠŸçš„é¡µé¢ï¼Œä½†æ˜¯å•†å®¶ç«¯æ˜¾ç¤ºæ”¯ä»˜æˆåŠŸï¼Œå¹¶æˆåŠŸæ‰“å°å‡ºäº†å°ç¥¨ï¼Œè¿‡äº†ä¸€ä¼šï¼Œæˆ‘çš„æ‰‹æœºæ”¶åˆ°æ”¯ä»˜å®æ‰£æ¬¾çŸ­ä¿¡ã€‚

å› ä¸ºæˆ‘æœ€è¿‘çš„å·¥ä½œå¯¹éƒ½æ˜¯ä¸å¾®ä¿¡/æ”¯ä»˜å®æœ‰å…³ï¼Œæ•´ä½“æ”¯ä»˜æµç¨‹è¿˜æ˜¯æ¯”è¾ƒæ¸…æ¥šï¼Œä½†æ˜¯ä»˜æ¬¾ç ä¸ºä»€ä¹ˆèƒ½ç¦»çº¿æ”¯ä»˜ç¡®å®ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œæ‰€ä»¥ç ”ç©¶äº†ä¸€ç•ªï¼Œäºæ˜¯æœ‰äº†ä»Šå¤©çš„æ–‡ç« ã€‚

![](https://img2020.cnblogs.com/other/1419561/202009/1419561-20200903084258265-1975570204.jpg)

## ç§‘æ™®æ”¯ä»˜æ–¹å¼

åœ¨èŠä»˜æ¬¾ç ç¦»çº¿åŸç†ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç»™ä¸ç†Ÿæ‚‰æ”¯ä»˜å®/å¾®ä¿¡æ”¯ä»˜æ–¹å¼åŒå­¦å…ˆç§‘æ™®ä¸€ä¸‹å¸¸è§çš„ä¸¤ç§æ”¯ä»˜æ–¹å¼ã€‚

å¾®ä¿¡ã€æ”¯ä»˜å®çº¿ä¸‹æ”¯ä»˜å¸¸ç”¨æ”¯ä»˜æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯æˆ‘ä»¬æ‰“å¼€æ‰‹æœºï¼Œä¸»åŠ¨æ‰«æå•†å®¶æä¾›ç ç‰Œï¼Œè¿™ç§æ”¯ä»˜æ–¹å¼ä¸€èˆ¬ç§°ä¸ºä¸»æ‰«æ”¯ä»˜ï¼ˆç”¨æˆ·ä¸»åŠ¨æ‰«ç ï¼‰ã€‚

ä»¥æ”¯ä»˜å®ä¸ºä¾‹ï¼Œä»˜æ¬¾æµç¨‹å¦‚å›¾æ‰€ç¤ºï¼š

![å›¾ç‰‡æ¥è‡ªæ”¯ä»˜å®å®˜ç½‘](https://img2020.cnblogs.com/other/1419561/202009/1419561-20200903084258471-1092312591.jpg)

ç¬¬äºŒç§åˆ™æ˜¯æˆ‘ä»¬æ‰“å¼€æ‰‹æœºï¼Œå±•ç¤ºæˆ‘ä»¬çš„ä»˜æ¬¾ç ï¼Œç„¶åå•†å®¶ä½¿ç”¨æ‰«ç æªç­‰å·¥å…·è·å–ä»˜æ¬¾ç å®Œæˆæ”¯ä»˜ï¼Œè¿™ç§æ”¯ä»˜æ–¹å¼ä¸€èˆ¬ç§°ä¸ºè¢«æ‰«æ”¯ä»˜ï¼ˆç”¨æˆ·è¢«æ‰«ç ï¼‰ã€‚

ä»¥æ”¯ä»˜å®ä¸ºä¾‹ï¼Œä»˜æ¬¾æµç¨‹å¦‚å›¾æ‰€ç¤ºï¼š

![å›¾ç‰‡æ¥è‡ªæ”¯ä»˜å®å®˜ç½‘](https://img2020.cnblogs.com/other/1419561/202009/1419561-20200903084258757-1945687815.jpg)

å¯¹äºç¬¬ä¸€ç§æ–¹å¼ï¼Œéœ€è¦æ‰‹æœºç«¯ APP æ‰«ç ï¼Œç„¶åå¼¹çª—ç¡®è®¤ä»˜æ¬¾ï¼Œè¿™ç§æ–¹å¼æ˜¯æ²¡æœ‰åŠæ³•åœ¨æ‰‹æœºæ²¡æœ‰ç½‘ç»œçš„æƒ…å†µå®Œæˆæ”¯ä»˜ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸Šæ–‡è¯´çš„æ²¡æœ‰ç½‘ç»œçš„æƒ…å†µç‰¹æŒ‡ä»˜æ¬¾ç æ”¯ä»˜çš„åœºæ™¯ã€‚

## ä»˜æ¬¾ç ä»˜æ¬¾æµç¨‹

åœ¨èŠä»˜æ¬¾ç ç¦»çº¿æ”¯ä»˜çš„å‰æå‰ï¼Œæˆ‘ä»¬å…ˆæ¥æ¥çœ‹ä¸‹ä»˜æ¬¾ç çš„æ•´ä½“æµç¨‹ï¼Œä»¥è¶…å¸‚è´­ç‰©ä¸ºä¾‹ï¼Œä¸€æ¬¡ä»˜æ¬¾ç çš„æ”¯ä»˜ä¿¡æ¯æµå¦‚å›¾æ‰€ç¤ºï¼š

![å‚è€ƒçŸ¥ä¹@å¤©é¡º](https://img2020.cnblogs.com/other/1419561/202009/1419561-20200903084259038-399486180.jpg)

è¿™ä¸ªè¿‡ç¨‹å•†å®¶åå°ç³»ç»Ÿæ˜¯éœ€è¦è°ƒç”¨çš„æ”¯ä»˜å®æ¡ç æ”¯ä»˜çš„æ¥å£ï¼Œå®Œæˆæ”¯ä»˜ã€‚

**ç”±äºå•†å®¶åå°éœ€è¦åœ¨çº¿è”ç½‘ä¸æ”¯ä»˜å®åå°é€šè®¯ï¼Œæ‰€ä»¥è¯´ä»˜æ¬¾ç çš„ç¦»çº¿æ”¯ä»˜ï¼ŒæŒ‡çš„æ˜¯å®¢æˆ·ç«¯æ²¡æœ‰çš„ç½‘ç»œçš„æƒ…å†µï¼Œå•†å®¶ç«¯å…¶å®å¿…é¡»å®æ—¶è”ç½‘åœ¨çº¿ã€‚**

ä¸€æ¬¡ä»˜æ¬¾ç æ¥å£è°ƒç”¨æµç¨‹å¦‚å›¾æ‰€ç¤ºï¼š

![æ¥è‡ªæ”¯ä»˜å®å®˜ç½‘](https://img2020.cnblogs.com/other/1419561/202009/1419561-20200903084259392-963235151.jpg)

é€šè¿‡ä¸Šé¢ä¸¤å¼ å›¾ï¼Œæˆ‘ä»¬æ•´ä½“äº†è§£ä»˜æ¬¾ç äº¤äº’æµç¨‹ã€‚

ä»˜æ¬¾ç çš„æŠ€æœ¯æ–¹æ¡ˆå…¶å®å¯ä»¥åˆ†ä¸ºå®¢æˆ·ç«¯åœ¨çº¿ä¸ç¦»çº¿çš„ä¸¤ç§æƒ…å†µï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹ä¸¤ç§æ–¹æ¡ˆå…·ä½“å®ç°æ–¹å¼ã€‚

## åœ¨çº¿ç æ–¹æ¡ˆ

å®¢æˆ·ç«¯åœ¨çº¿ç çš„æ–¹æ¡ˆï¼Œè¿™ä¸ªåº”è¯¥æ¯”è¾ƒå®¹æ˜“æƒ³åˆ°ï¼Œåªè¦æ”¯ä»˜å®/å¾®ä¿¡åœ¨ç™»å½•çš„æƒ…å†µä¸‹ï¼Œç‚¹å‡»ä»˜æ¬¾æŒ‰é’®ï¼Œå®¢æˆ·ç«¯è°ƒç”¨åå°ç³»ç»Ÿçš„ç”³è¯·ä»˜æ¬¾ç æ¥å£ã€‚

åå°ç³»ç»Ÿå—åˆ°è¯·æ±‚ä¹‹åï¼Œç”Ÿæˆä¸€ä¸ªä»˜æ¬¾ç ï¼Œç„¶ååœ¨æ•°æ®åº“ä¿å­˜ä»˜æ¬¾ç ä¸ç”¨æˆ·çš„å…³ç³»ï¼Œå¹¶ä¸”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

åªè¦å®¢æˆ·ç«¯åœ¨æœ‰æ•ˆæœŸå†…å±•ç¤ºè¯¥ä»˜æ¬¾ç ï¼Œå°±å¯ä»¥å®Œæˆæ”¯ä»˜ï¼Œå¦åˆ™è¯¥äºŒç»´ç å°±å°†ä¼šè¿‡æœŸã€‚

ä½¿ç”¨è¿™ç§æ–¹æ¡ˆï¼Œç›¸å¯¹æ¥è¯´æ¯”è¾ƒå®‰å…¨ï¼Œå› ä¸ºæ¯æ¬¡éƒ½æ˜¯æœåŠ¡ç«¯ç”Ÿæˆç ï¼ŒæœåŠ¡ç«¯å¯ä»¥æ§åˆ¶å¹‚ç­‰ï¼Œæ²¡æœ‰å®¢æˆ·ç«¯ä¼ªé€ çš„é£é™©çš„ã€‚

å¦å¤–å³ä½¿éœ€è¦å¯¹ä»˜æ¬¾ç è§„åˆ™è°ƒæ•´ï¼Œæ¯”å¦‚ä»˜æ¬¾ç ä½æ•°å¢åŠ ä¸€ä½ï¼Œæˆ‘ä»¬åªè¦è°ƒæ•´æœåŠ¡ç«¯ä»£ç å³å¯ï¼Œå®¢æˆ·ç«¯éƒ½æ— éœ€å‡çº§ã€‚

**ä¸è¿‡è¿™ç§æ–¹æ¡ˆç¼ºç‚¹ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼Œå®¢æˆ·ç«¯å¿…é¡»å®æ—¶åœ¨çº¿è”ç½‘ï¼Œæ²¡æœ‰ç½‘ç»œåˆ™æ— æ³•è·å–ä»˜æ¬¾ç ã€‚**

å¦å¤–ï¼Œç°åœ¨æœ‰ä¸€äº›æ™ºèƒ½è®¾å¤‡ä¹Ÿå¼€å§‹æ”¯æŒæ”¯ä»˜å®æ”¯ä»˜ï¼Œè¿™äº›è®¾å¤‡ä¸­å¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯æ²¡æœ‰è”ç½‘çš„åŠŸèƒ½ï¼ˆ*æ¯”å¦‚å°ç±³æ‰‹ç¯å››*ï¼‰ï¼Œé‚£è¿™ç§æƒ…å†µæ˜¯æ²¡åŠæ³•ä½¿ç”¨åœ¨çº¿ç æ–¹æ¡ˆã€‚

![](https://img2020.cnblogs.com/other/1419561/202009/1419561-20200903084259568-1378830885.jpg)

åŸºäºè¿™ç§æƒ…å†µï¼Œæ‰€ä»¥å¼€å§‹æœ‰äº†ç¦»çº¿ç æ–¹æ¡ˆã€‚

## ç¦»çº¿ç æ–¹æ¡ˆ

è¯´èµ·ç¦»çº¿ç å¤§å®¶å¯èƒ½æ¯”è¾ƒé™Œç”Ÿï¼Œä½†æ˜¯å®é™…ä¸Šä½ å¦‚æœä»”ç»†è§‚å¯Ÿï¼Œå…¶å®å¾ˆå¤šåœºæ™¯éƒ½ç”¨åˆ°äº†ç¦»çº¿ç ã€‚

æ¯”å¦‚è¯´ä»¥å‰å»é»‘ç½‘å§ç©æ¢¦å¹»è¥¿æ¸¸çš„æ—¶å€™ï¼Œè´¦å·æ€»æ˜¯è¢«ç›—ã€‚

![](https://img2020.cnblogs.com/other/1419561/202009/1419561-20200903084259736-1623577831.jpg)

æ²¡åŠæ³•ï¼ŒèŠ±äº†ä¸€ç¬”é‡èµ„ä¹°äº†ä¸€ä¸ªç½‘æ˜“å°†å†›ä»¤ï¼Œæ¯æ¬¡ç™»å½•çš„æ—¶å€™ï¼Œé™¤äº†è¾“å…¥ç”¨æˆ·åä¸å¯†ç ä»¥å¤–ï¼Œè¿˜éœ€è¦è¾“å…¥åŠ¨æ€å£ä»¤ã€‚ä»æ­¤è´¦å·å°±å¾ˆå°‘è¢«ç›—äº†ã€‚

![](https://img2020.cnblogs.com/other/1419561/202009/1419561-20200903084259872-97493341.jpg)

åˆæ¯”å¦‚è¯´æ¯æ¬¡ç½‘æ˜“æ”¯ä»˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬é™¤äº†è¾“å…¥é“¶è¡Œå¡å¯†ç ä»¥å¤–ï¼Œè¿˜éœ€è¦è¾“å…¥ç½‘é“¶ç›¾ä¸ŠåŠ¨æ€ç ï¼Œè¿™æ ·æ‰èƒ½å®Œæˆæ”¯ä»˜ã€‚

![](https://img2020.cnblogs.com/other/1419561/202009/1419561-20200903084300001-909222687.jpg)

> ç”»å¤–éŸ³ï¼š
> 
> ![](https://img2020.cnblogs.com/other/1419561/202009/1419561-20200903084300156-503110690.jpg)
> 
> è¿™é‡Œåˆè¦åæ§½ä¸€ä¸‹ï¼Œç½‘é“¶ç›¾ä»¥å‰çœŸçš„è¶…éš¾ç”¨ï¼ŒåŠ¨ä¸åŠ¨å°±é©±åŠ¨ä¸å…¼å®¹ã€‚è¿˜è®°å¾—å½“åˆç”¨ç½‘é“¶å……å€¼é»„é’»ï¼Œæäº†ä¸€ä¸‹åˆéƒ½æ²¡æœ‰æˆåŠŸ--ï¼

å½“ç„¶ä¸Šé¢è¿™äº›å¯èƒ½å·²ç»æ˜¯*è€å¤è‘£*äº†ï¼Œå¾ˆå¤šäººéƒ½å¯èƒ½æ²¡ç”¨è¿‡ï¼Œç°åœ¨æ¯”è¾ƒæµè¡Œæ˜¯**æ‰‹æœºéªŒè¯å™¨APP**ï¼Œæ¯”å¦‚ **Google Authenticator** ç­‰ã€‚

![](https://img2020.cnblogs.com/other/1419561/202009/1419561-20200903084300339-900696701.jpg)

è¿™ç§ä»¤ç‰Œå™¨ï¼ŒåŠ¨æ€äº§ç”Ÿä¸€æ¬¡æ€§å£ä»¤ï¼ˆ**OTP, One-time Password**ï¼‰ï¼Œå¯ä»¥é˜²æ­¢å¯†ç è¢«ç›—ç”¨å¼•å‘çš„å®‰å…¨é£é™©ã€‚

å…¶å®ä»˜æ¬¾ç ç¦»çº¿æ–¹æ¡ˆæŠ€æœ¯åŸå‹å°±æ˜¯åŸºäºè¿™ç§æ–¹æ¡ˆï¼Œæ‰€ä»¥ä¸‹é¢æˆ‘ä»¬å°±åŸºäº Google Authenticatorï¼Œæ¥äº†è§£ä¸€ä¸‹è¿™å…¶ä¸­çš„åŸç†ã€‚

### åŠ¨æ€å£ä»¤æŠ€æœ¯åŸç†

é¦–å…ˆå¦‚æœæˆ‘ä»¬éœ€è¦ä½¿ç”¨ **Google Authenticator**ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç½‘ç«™ä¸Šå¼€å¯äºŒæ¬¡éªŒè¯åŠŸèƒ½ï¼Œä»¥ Google è´¦å·ä¸ºä¾‹ï¼Œåœ¨è®¾ç½®ä¸¤æ­¥éªŒè¯çš„åœ°æ–¹å¯ä»¥æ‰¾åˆ°å¦‚ä¸‹è®¾ç½®ï¼š

![](https://img2020.cnblogs.com/other/1419561/202009/1419561-20200903084300560-1624461624.jpg)

å½“æˆ‘ä»¬ç‚¹å‡»è®¾ç½®ï¼Œå°†ä¼šå¼¹å‡ºä¸€ä¸ªäºŒç»´ç ï¼Œç„¶åä½¿ç”¨ **Google Authenticator** APP æ‰«ç ç»‘å®šã€‚

![](https://img2020.cnblogs.com/other/1419561/202009/1419561-20200903084300775-1871222912.jpg)

å½“æˆ‘ä»¬ç»‘å®šä¹‹åï¼Œ **Google Authenticator** APP å°†ä¼šå±•ç¤ºåŠ¨æ€ç ã€‚

æˆ‘ä»¬æ¥è§£æä¸€ä¸‹è¿™ä¸ªäºŒç»´ç ï¼Œå¯¹åº”ä¸‹é¢è¿™ä¸ªå­—ç¬¦ä¸²ï¼š

```
otpauth://totp/Google%3Ayourname@gmail.com?secret=xxxx&issuer=Google
```
 

ä¸Šé¢çš„å­—ç¬¦ä¸²ä¸­ï¼Œæœ€é‡è¦å°±æ˜¯è¿™ä¸€ä¸²å¯†é’¥ `secret`ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªç»è¿‡ **BASE32** ç¼–ç ä¹‹åçš„å­—ç¬¦ä¸²ï¼ŒçœŸæ­£ä½¿ç”¨æ—¶éœ€è¦å°†å…¶ä½¿ç”¨**BASE32** è§£ç ï¼Œå¤„ç†ä¼ªç å¦‚ä¸‹ï¼š

```java
original_secret = xxxx xxxx xxxx xxxx xxxx xxxx xxxx xxxx
secret = BASE32_DECODE(TO_UPPERCASE(REMOVE_SPACES(original_secret)))
```
 

**è¿™ä¸ªå¯†é’¥å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å°†ä¼šåŒæ—¶ä¿å­˜ä¸€ä»½ï¼Œä¸¤ç«¯å°†ä¼šåŒæ ·çš„ç®—æ³•è®¡ç®—ï¼Œä»¥æ­¤ç”¨æ¥æ¯”è¾ƒåŠ¨æ€ç çš„æ­£ç¡®æ€§ã€‚**

æˆ‘ä»¬ä»¥å®¢æˆ·ç«¯ä¸ºä¾‹ï¼Œç”Ÿæˆä¸€ä¸ªåŠ¨æ€ç ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦ç»è¿‡ä¸€ä¸ªç­¾åå‡½æ•°ï¼Œè¿™é‡Œ \*\*Google Authenticator \*\*é‡‡ç”¨çš„ **HMAC-SHA1**ï¼Œè¿™æ˜¯ä¸€ç§åŸºäºå“ˆå¸Œçš„æ¶ˆæ¯éªŒè¯ç ï¼Œå¯ä»¥ç”¨æ¯”è¾ƒå®‰å…¨çš„å•å‘å“ˆå¸Œå‡½æ•°ï¼ˆå¦‚ SHA1ï¼‰æ¥äº§ç”Ÿç­¾åã€‚

ç­¾åå‡½æ•°ä¼ªç å¦‚ä¸‹ï¼š

```java
hmac = SHA1(secret + SHA1(secret + input))
```
 

ä¸Šé¢å‡½æ•°ä¸­çš„ï¼Œ`input` ä½¿ç”¨å½“å‰æ—¶é—´æ•´é™¤ 30 çš„å€¼ã€‚

```java
input = CURRENT_UNIX_TIME() / 30
```
 

è¿™é‡Œæ—¶é—´å°±å……å½“ä¸€ä¸ªåŠ¨æ€å˜å‚ï¼Œè¿™æ ·å¯ä»¥æºæºä¸æ–­äº§ç”ŸåŠ¨æ€ç ã€‚

**å¦å¤–è¿™é‡Œæ•´é™¤ 30ï¼Œæ˜¯ä¸ºäº†èµ‹äºˆéªŒè¯ç ä¸€ä¸ª 30 ç§’çš„æœ‰æ•ˆæœŸã€‚**

è¿™æ ·å¯¹äºç”¨æˆ·è¾“å…¥æ¥è®²ï¼Œå¯ä»¥æœ‰å……è¶³æ—¶é—´å‡†å¤‡è¾“å…¥è¿™ä¸ªåŠ¨æ€ç ï¼Œå¦å¤–ä¸€ç‚¹å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å¯èƒ½å­˜åœ¨æ—¶é—´åå·®ï¼Œ30 ç§’çš„é—´éš”å¯ä»¥å¾ˆå¤§æ¦‚ç‡çš„å±è”½è¿™ç§å·®å¼‚ã€‚

> ç”»å¤–éŸ³ï¼šè¿™ä¸ªæœ‰æ•ˆæ—¶é—´å…¶å®å¾ˆè€ƒé‡ï¼Œå¦‚æœæ¯”è¾ƒé•¿ï¼Œå®‰å…¨æ€§å°±å·®ã€‚
> 
> å¦‚æœæ¯”è¾ƒçŸ­ï¼Œç”¨æˆ·ä½“éªŒå°±å¾ˆå·®ï¼Œä¸å®¹æ˜“è¾“å…¥å‡†å¤‡ã€‚

ç»è¿‡ **HMAC-SHA1** ç­¾åå‡½æ•°ä»¥åï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªé•¿åº¦ä¸º 40 çš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†å…¶è½¬åŒ–ä¸º 6 ä½æ•°å­—ï¼Œæ–¹ä¾¿ç”¨æˆ·è¾“å…¥ã€‚å¤„ç†çš„ä¼ªç å¦‚ä¸‹ï¼š

```java
four_bytes = hmac[LAST_BYTE(hmac):LAST_BYTE(hmac) + 4]
large_integer = INT(four_bytes)
small_integer = large_integer % 1,000,000
```
 

å®Œæ•´çš„ç®—æ³•ä¼ªç å¦‚ä¸‹ï¼š

```java
original_secret = xxxx xxxx xxxx xxxx xxxx xxxx xxxx xxxx
secret = BASE32_DECODE(TO_UPPERCASE(REMOVE_SPACES(original_secret)))
input = CURRENT_UNIX_TIME() / 30
hmac = SHA1(secret + SHA1(secret + input))
four_bytes = hmac[LAST_BYTE(hmac):LAST_BYTE(hmac) + 4]
large_integer = INT(four_bytes)
small_integer = large_integer % 1,000,000
```
 

å½“å®¢æˆ·ç«¯å°†åŠ¨æ€ç ä¸Šä¼ ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æŸ¥è¯¢æ•°æ®åº“è·å–åˆ°ç”¨æˆ·å¯¹åº”çš„å¯†é’¥ï¼Œç„¶åä½¿ç”¨åŒæ ·çš„ç®—æ³•è¿›è¡Œå¤„ç†ç”Ÿæˆä¸€ä¸ªåŠ¨æ€ç ï¼Œæœ€åæ¯”è¾ƒå®¢æˆ·ç«¯ä¸Šä¼ åŠ¨æ€ç ä¸æœåŠ¡ç«¯ç”Ÿæˆæ˜¯å¦ä¸€è‡´ã€‚

### ä»˜æ¬¾ç ç¦»çº¿æ–¹æ¡ˆ

ä¸Šé¢æˆ‘ä»¬äº†è§£äº†åŠ¨æ€å£ä»¤çš„å®ç°æ–¹æ¡ˆï¼Œä»˜æ¬¾ç ç”ŸæˆåŸç†å…¶å®ä¹Ÿå¤§è‡´å¦‚æ­¤ã€‚

ä¸è¿‡ä»˜æ¬¾ç ç¦»çº¿æ–¹æ¡ˆé‡‡ç”¨åŠ¨æ€å¯†é’¥çš„æ–¹å¼(**å…¨å±€å”¯ä¸€**)ï¼Œå®šæ—¶è¯·æ±‚æœåŠ¡ç«¯æ›´æ¢å¯†é’¥ï¼Œä»¥æ­¤ä¿è¯æ›´é«˜çš„å®‰å…¨æ€§ã€‚

å¦å¤–åœ¨ä¸€æ¬¡æ€§åŠ¨æ€å£ä»¤æ–¹æ¡ˆï¼Œéœ€è¦åŒæ–¹åŸºäºåŒæ ·çš„ç§˜é’¥ï¼Œæ‰€ä»¥æœåŠ¡ç«¯éœ€è¦æ˜ç¡®çŸ¥é“è¿™**èƒŒåæ­£ç¡®ç”¨æˆ·**ã€‚ä»¥ä¸Šé¢çš„ç™»å½•åœºæ™¯ä¸ºä¾‹ï¼Œç™»å½•è¿‡ç¨‹è¾“å…¥ç”¨æˆ·å,æœåŠ¡ç«¯å°±å¯ä»¥æ ¹æ®è¿™ä¸ªåœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢ç›¸åº”çš„å¯†é’¥ã€‚

ä½†æ˜¯åœ¨ä»˜æ¬¾ç çš„æ”¯ä»˜åœºæ™¯ä¸­ï¼Œæ”¯ä»˜è¿‡ç¨‹ä»…ä»…ä¼ é€’ä¸€ä¸ªä»˜æ¬¾ç ï¼Œå°±å¯ä»¥å‘ç›¸åº”çš„ç”¨æˆ·æ‰£æ¬¾ã€‚ä¸ç”¨æƒ³ï¼Œè¿™ä¸ªä»˜æ¬¾ç è¿™ä¸²æ•°å­—ä¸€å®šåŒ…å«ç›¸åº”çš„ç”¨æˆ·ä¿¡æ¯ã€‚

æ‰€ä»¥ä»˜æ¬¾ç çš„ç›¸åº”çš„ç®—æ³•ç›¸æ¯”åŠ¨æ€ç ä¼šæ›´åŠ å¤æ‚ï¼Œè¿™æ ·æ‰å¯ä»¥æœ‰æ•ˆä¿è¯å®‰å…¨æ€§ã€‚

çœ‹åˆ°è¿™é‡Œï¼Œä¸çŸ¥é“ä½ ä»¬æ˜¯å¦æƒ³äº†è§£è¿™å¥—ç®—æ³•é‚£ï¼Ÿ

![](https://img2020.cnblogs.com/other/1419561/202009/1419561-20200903084300952-579485567.jpg)

å“ˆå“ˆï¼Œå¼€ä¸ªç©ç¬‘ï¼Œè¿™ç§ç®—æ³•å²‚èƒ½æ˜¯æˆ‘ä»¬èƒ½æŒæ¡çš„ã€‚

æ”¯ä»˜å®æ ¸å¿ƒç®—æ³•å’±ä¸çŸ¥é“ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä»å…¶ä»–äººå…¬å¼€è®¾è®¡æ–¹æ¡ˆäº†è§£ä¸€ä¸ªçš®æ¯›ã€‚

è¿™é‡Œå°é»‘å“¥ç»™ä½ ä¸€ä¸ªçŸ¥ä¹ç½‘å‹[@åæ–¹å‘çš„é’Ÿå›ç­”](https://www.zhihu.com/question/49811134/answer/135886638)çš„ç¦»çº¿äºŒç»´ç å®ç°æ–¹å¼ï¼Œç»™ä½  look lookã€‚

![æ¥è‡ªï¼šhttps://www.zhihu.com/question/49811134/answer/135886638](https://img2020.cnblogs.com/other/1419561/202009/1419561-20200903084301103-1719620198.png)

### ä»˜æ¬¾ç ç¦»çº¿ç çš„åŠ£åŠ¿

æœ€åæˆ‘ä»¬æ¥çœ‹ä¸‹ä»˜æ¬¾ç ç¦»çº¿æ–¹æ¡ˆçš„åŠ£åŠ¿ï¼š

ç¬¬ä¸€ï¼Œç®—æ³•è°ƒæ•´ä¸çµæ´»ï¼Œå¦‚æœç›¸å…³ç®—æ³•è¾ƒå¤§çš„è°ƒæ•´ï¼Œå¯èƒ½éœ€è¦å‡çº§å®¢æˆ·ç«¯,å¹¶ä¸”è¿™ä¸ªæœŸé—´æœåŠ¡ç«¯è¿˜éœ€è¦å…¼å®¹æ–°è€ç®—æ³•äº§ç”Ÿçš„ä»˜æ¬¾ç ã€‚

ç¬¬äºŒï¼Œå®‰å…¨æ€§é—®é¢˜ï¼Œæ­£å¸¸çš„æƒ…å†µç›¸å…³å¯†é’¥æ— æ³•è¢«æ™®é€šç”¨æˆ·è·å–ï¼Œä½†æ˜¯æ¶ä¸ä½æœ‰æœ‰å¿ƒä¹‹äººã€‚ä»–ä»¬å¯èƒ½é€šè¿‡è·å–æ‰‹æœºç”¨æˆ· Root æƒé™æˆ–è€…è¶Šç‹±æ‰‹æœºï¼Œåˆ©ç”¨æ¶æ„ç¨‹åºè·å–å¯†é’¥ï¼Œç„¶åéšæ„ç”Ÿæˆä»˜æ¬¾ç ã€‚

çœ‹åˆ°è¿™ä¸€ç‚¹ï¼Œå¤§å®¶å¯èƒ½ä¼šæ‹…å¿ƒè‡ªå·±çš„é’±åŒ…å®‰å…¨äº†ã€‚ä¸è¿‡è¿™ä¸€ç‚¹ï¼Œæˆ‘è§‰å¾—ä¸è¿‡è¿‡åˆ†æ‹…å¿ƒï¼Œèš‚èšé›†å›¢è¿™ä¹ˆå¤šå¤§ç¥ï¼Œä¸æ˜¯åƒå¹²é¥­çš„ï¼Œä»–ä»¬è‚¯å®šæœ‰å¾ˆå¤šæªæ–½ä¿è¯æ”¯ä»˜å®‰å…¨ã€‚

ç¬¬ä¸‰æ•°æ®ç¢°æ’é—®é¢˜ï¼ŒA ç”¨æˆ·ç”Ÿæˆä»˜æ¬¾ç ç®—å‡ºæ¥ä¸ B ç”¨æˆ·ä¸€è‡´ï¼Œè¿™å°± Hash ç®—æ³•ä¸€æ ·ï¼Œå†æ€ä¹ˆä¼˜ç§€çš„ç®—æ³•ï¼Œä¹Ÿæœ‰æ¦‚ç‡æ‰ç”Ÿä¸€æ ·çš„é¢ Hash å€¼ã€‚

è¿™å°±å¯¼è‡´åŸæœ¬æ˜¯æ‰£ç”¨æˆ· A çš„é’±ï¼Œæœ€åå´æ‰£äº† B ç”¨æˆ·ã€‚è¿™æ ·ä¸€æ¥ï¼Œç¡®å®å¾ˆä¹Œé¾™ï¼Œå¯¹äº B ç”¨æˆ·æ¥è®²ï¼Œè«åå…¶å¦™è¢«æ‰£é’±äº†ã€‚

![](https://img2020.cnblogs.com/other/1419561/202009/1419561-20200903084301259-857416869.jpg)

ä¸è¿‡æ”¾å¿ƒï¼Œè¿™ç§äº‹æ”¾åˆ°æ”¾åˆ°ç°åœ¨ï¼Œæˆ‘è§‰å¾—è¿˜æ˜¯æ¯”ä¹°å½©ç¥¨ä¸­å¥–ä½ï¼Œæ‰€ä»¥è¿™ç§äº‹è¿˜æ˜¯ä¸ç”¨è¿‡åˆ†æ‹…å¿ƒäº†ã€‚

å³ä½¿çœŸè¢«è¯¯æ‰£äº†ï¼Œæ”¾å¿ƒï¼Œæ”¯ä»˜å®è¿™ä¹ˆå¤§ä½“é‡è‚¯å®šä¼šè·Ÿå®¢æˆ·èµ”é’±çš„ã€‚

## æœ€å

æœ€åæ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¹³å¸¸ä½¿ç”¨ä»˜æ¬¾ç æ”¯ä»˜ï¼Œå…¶å®åŸç†å°±æ˜¯å•†å®¶ç«¯è·å–æˆ‘ä»¬æ‰‹æœº APP ä»˜æ¬¾ç ï¼ˆ**å…¶å®å°±æ˜¯ä¸€ä¸²æ•°å­—**ï¼‰ï¼Œç„¶ååå°è°ƒç”¨æ”¯ä»˜å®æ”¯ä»˜æ¥å£å®Œæˆæ‰£æ¬¾ã€‚

è¿™ä¸ªæµç¨‹å•†å®¶ç«¯åå°ç¨‹åºå¿…é¡»è”ç½‘åœ¨çº¿ï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬å®¢æˆ·ç«¯æ¥è®²å¯ä»¥åœ¨çº¿ï¼Œä¹Ÿå¯ä»¥ç¦»çº¿ã€‚

å¦‚æœæˆ‘ä»¬å®¢æˆ·ç«¯åœ¨çº¿ï¼Œé‚£å°±å¯ä»¥é€šè¿‡æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€ä»˜æ¬¾ç ï¼Œè¿™ç§æ–¹å¼æ›´åŠ å®‰å…¨ï¼Œçµæ´»ï¼Œä½†æ˜¯å¯¹äºå¼±ç½‘ç¯å¢ƒä¸‹ï¼Œä½“éªŒå°±å¾ˆå·®ã€‚

å¦‚æœæˆ‘ä»¬å®¢æˆ·ç«¯æ²¡ç½‘ï¼Œé‚£å°±é€šè¿‡å®¢æˆ·ç«¯é€šè¿‡ä¸€å®šç®—æ³•ç”Ÿæˆä»˜æ¬¾ç ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°ç»è¿‡ç›¸å…³æ ¡éªŒï¼Œç¡®è®¤æ˜¯å“ªä¸ªç”¨æˆ·ï¼Œç¡®è®¤ç æœ‰æ•ˆæ€§ï¼Œå¹¶ä¸”å®Œæˆæ‰£æ¬¾ã€‚è¿™ç§æ–¹å¼ï¼Œé€‚åˆå®¢æˆ·ç«¯æ²¡æœ‰ç½‘ç»œçš„æƒ…å†µï¼Œä¸è¿‡ç›¸å¯¹ä¸çµæ´»ï¼Œä¸”å®‰å…¨æ€§ç¨å·®ã€‚

å˜¿å˜¿ï¼Œäº†è§£åŸç†ï¼Œæœ‰æ²¡æœ‰è§‰å¾—è¿˜æ˜¯æŒºæœ‰æ„æ€çš„~

ä¸‹æ¬¡æ’é˜Ÿä»˜æ¬¾é’±,å¦‚æœæ‰‹æœºæ²¡ç½‘ï¼Œä¸è¦æ‹…å¿ƒå°´å°¬ï¼Œæ”¾å¿ƒæ‹¿å‡ºæ‰‹æœºä»˜é’±~

## å‚è€ƒ

1.  [https://www.zhihu.com/question/49811134/answer/135886638](https://www.zhihu.com/question/49811134/answer/135886638)
2.  [https://garbagecollected.org/2014/09/14/how-google-authenticator-works/](https://garbagecollected.org/2014/09/14/how-google-authenticator-works/)

> æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼šç¨‹åºé€šäº‹ï¼Œè·å¾—æ—¥å¸¸å¹²è´§æ¨é€ã€‚å¦‚æœæ‚¨å¯¹æˆ‘çš„ä¸“é¢˜å†…å®¹æ„Ÿå…´è¶£ï¼Œä¹Ÿå¯ä»¥å…³æ³¨æˆ‘çš„åšå®¢ï¼š[studyidea.cn](https://studyidea.cn)

>å‚è€ƒé“¾æ¥ï¼š[https://www.cnblogs.com/goodAndyxublog/p/13605601.html](https://www.cnblogs.com/goodAndyxublog/p/13605601.html)ï¼Œæ•´ç†ï¼šæ²‰é»˜ç‹äºŒ
