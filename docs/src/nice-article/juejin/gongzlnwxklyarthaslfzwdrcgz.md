---
title: å·¥ä½œå…­å¹´ï¼Œæˆ‘å­¦ä¼šäº†ç”¨ Arthas æ¥è¾…åŠ©æˆ‘çš„æ—¥å¸¸å·¥ä½œ 
shortTitle: å·¥ä½œå…­å¹´ï¼Œæˆ‘å­¦ä¼šäº†ç”¨ Arthas æ¥è¾…åŠ©æˆ‘çš„æ—¥å¸¸å·¥ä½œ 
description: å¦‚ä½•é€šè¿‡ arthas æ¥è§£å†³æ—¥å¸¸å·¥ä½œä¸­çš„ç–‘éš¾é—®é¢˜ï¼Œå¦‚ä½•é€šè¿‡ arthas å¤„ç†å·¥ä½œä»¥å‰éœ€è¦ debugï¼Œéœ€è¦æ‰“å°æ—¥å¿—æ‰èƒ½æ‰¾çš„ bugã€‚ é›†åˆæ¡ˆä¾‹æ¥è°ˆè°ˆå¦‚ä½•ä½¿ç”¨ arthas è¿™äº›å‘½ä»¤ã€‚
tag:
  - ä¼˜è´¨æ–‡ç« 
author: uzong
category:
  - æ˜é‡‘ç¤¾åŒº
head:
  - - meta
    - name: keywords
      content: Java
---

## å·¥ä½œå…­å¹´ï¼Œæˆ‘å­¦ä¼šäº†ç”¨ Arthas æ¥è¾…åŠ©æˆ‘çš„æ—¥å¸¸å·¥ä½œ

*å¾ˆä¹…å°±æƒ³å†™ä¸€ç¯‡ä»‹ç» Arthas çš„æ–‡ç« ï¼Œè™½ç„¶ Arthas å·²æœ‰å¤§é‡æ–‡ç« ä»‹ç»ï¼›ä½†æˆ‘ä¾ç„¶æƒ³ç»“åˆæˆ‘çš„å®é™…å·¥ä½œï¼Œæ¥èŠèŠè¿™æ¬¾æˆ‘å–œçˆ±çš„ Java ç›‘æ§è¯Šæ–­äº§å“ã€‚*

> ğŸ”Šä¸€ä½ Java å¼€å‘è€…çš„ä½¿ç”¨æ€»ç»“ï¼Œåªè°ˆä½¿ç”¨ç»éªŒï¼Œä¸èŠåŸç†ã€‚

## ğŸ“† é‚£äº›è¾›é…¸çš„è¿‡å¾€

***å†å†åœ¨ç›®çš„åœºæ™¯*ğŸ¥¹**(âÂ´â—¡`â)(âÂ´â—¡`â)

*   å®¢æˆ·çº¿ä¸Šé—®é¢˜ï¼Œåº”è¯¥å¦‚ä½•å¤ç°ï¼Œè®©å®¢æˆ·å†ç‚¹ä¸€ä¸‹å—ï¼Ÿ
*   å¼‚å¸¸è¢«åƒæ‰ï¼Œæ‰‹è¶³æ— æªï¼Œçœ‹æ˜¯å“ªä¸ªå®¶ä¼™å†™çš„ï¼Œç«Ÿç„¶æ˜¯è‡ªå·±ï¼
*   æ’æŸ¥åˆ«äººçº¿ä¸Šçš„ bugï¼Œä¸ä»…ä»£ç è¿˜æ²¡çœ‹æ‡‚ï¼Œè¿˜æ²¡ä¸€è¡Œæ—¥å¿—ï¼Œæäº†ä¸€æŠŠæ±—ï¼
*   é¢„å‘ debugï¼Œç¨å¾®æ—¶é—´é•¿ç‚¹ï¼Œç¾¤é‡Œå°±æ€¨å£°è½½é“ï¼
*   åŠ æ—¥å¿—é‡æ–°éƒ¨ç½²ï¼ŒåŠä¸ªå°æ—¶å°±æ²¡äº†ï¼Œé—®é¢˜è¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œå¤´é¡¶çš„ç¯å´æ—©å·²ç…§äº®äº†æ•´å±‚æ¥¼......
*   çº¿ä¸Šæœºå™¨ä¸èƒ½ debugï¼Œä¹Ÿä¸èƒ½å¼€ debug ç«¯å£ï¼Œé‡æ–°éƒ¨ç½²ä¼šä¸ä¼šç ´åç°åœºå‘¢?
*   æ€€ç–‘å…¥å‚æœ‰é—®é¢˜ï¼Œæ€€ç–‘åˆå¹¶ä»£ç æœ‰é—®é¢˜ï¼Œæ€€ç–‘æ²¡æœ‰éƒ¨ç½²æˆåŠŸï¼Œå…¨æ˜¯é—®å·......
*   ä¸€ä¸ªé—®é¢˜æ’æŸ¥ä¸€å¤©ï¼Œè¢« Diss æ’æŸ¥é—®é¢˜æ…¢......

> *ç›´åˆ°æˆ‘é‡åˆ°äº† Arthasï¼Œé‚£äº›æ›¾ç»æŸæ‰‹æ— ç­–çš„é—®é¢˜ï¼Œéƒ½å˜å¾—è½»è€Œæ˜“ä¸¾ã€‚äºæ˜¯æƒ³æŠŠè¿™äº›é‡åˆ°çš„åœºæ™¯å’Œç”¨æ³•åšä¸ªæ€»ç»“ã€‚*

## ğŸ“•ä¸€ã€é€šè¿‡å‘½ä»¤æ‰§è¡Œæ–¹æ³•--vmtool

**vmtool å‘½ä»¤æ˜¯æˆ‘æœ€å–œæ¬¢ç”¨çš„ï¼Œä¹Ÿæ˜¯ç”¨æœ€å¤šçš„ä¸€ä¸ªå‘½ä»¤ã€‚é€šè¿‡è¿™ä¸ªå‘½ä»¤æ‰§è¡Œæ–¹æ³•ï¼Œæ£€æŸ¥å„ç§ä¸ç¬¦åˆé¢„æœŸçš„åˆ†æ”¯é€»è¾‘ï¼Œå…¥å‚å‡ºå‚ï¼Œä»¥åŠå„ç§å¤–éƒ¨ä¾èµ–æ¥å£ï¼Œç”šè‡³è¿˜èƒ½ä¿®æ”¹æ•°æ®ç­‰ã€‚**

#### 1.1 åœºæ™¯

è§£å†³è¿‡çš„åœºæ™¯|å…·ä½“æè¿°|
---|---|
å‘å¸ƒå¯¼è‡´çº¿ä¸Šçš„ç¼“å­˜ key é”™è¯¯ï¼Œéœ€è¦æ¸…ç†ï¼Œä½†è¿‡æœŸæ—¶é—´è¿˜é•¿ï¼Œæ²¡æœ‰åˆ é™¤ key çš„è¿œç¨‹æ¥å£|é€šè¿‡æ‰§è¡Œ service æ–¹æ³•ï¼Œåˆ é™¤ç¼“å­˜ keyï¼›å¦å¤–è¯»å– redis ä¸­çš„ key ä¹Ÿæå…¶æ–¹ä¾¿|
ç¼ºå°‘æ—¥å¿—ï¼Œä¸çŸ¥é“ä¸Šæ¸¸æ˜¯å¦è¿”å›æ•°æ®åˆç†|é€šè¿‡æ‰§è¡Œæ–¹æ³•ï¼Œç¡®å®šä¾èµ–è¿”å›æ•°æ®ä¸æ­£ç¡®|
å‘å¸ƒåº”ç”¨åŒæ—¶ä¿®æ”¹åˆ†å¸ƒå¼é…ç½®ï¼Œå¯¼è‡´æ¨é€é…ç½®åˆ°è¯¥èŠ‚ç‚¹å¤±è´¥|é€šè¿‡æ‰§è¡Œæ–¹æ³•ï¼ŒæŸ¥è¯¢é…ç½®ä¿¡æ¯ä¸æ˜¯æœ€æ–°|
å¸¸é‡å€¼ä¸ç¬¦åˆé¢„æœŸï¼Œé…ç½®åœ¨ properties ä¸­çš„å…ç™» url å¤±æ•ˆ|é€šè¿‡æ‰§è¡Œæ–¹æ³•ï¼ŒæŸ¥è¯¢å½“å‰å¸¸é‡å€¼ï¼Œåˆ¤æ–­è¯»å–ä¸åˆç†|
æ–°å¢é…ç½®ä¿¡æ¯ã€åˆ é™¤è„æ•°æ®|é€šè¿‡æ¥å£æ‰§è¡Œæ–¹æ³•ï¼Œæ·»åŠ äº†é…ç½®ã€åˆ é™¤äº†è„æ•°æ®|
é›†ç¾¤ç¯å¢ƒï¼Œæƒ³è¦è¯·æ±‚æ‰“åœ¨æŒ‡å®šæœºå™¨ä¸ŠæŸ¥çœ‹æ—¥å¿—|éœ€è¦åå¤è¯·æ±‚å¤šæ¬¡æ‰èƒ½å‘½ä¸­ç‰¹å®šæœºå™¨æŸ¥çœ‹æ—¥å¿—ï¼Œé€šè¿‡vmtool æ‰§è¡Œæ–¹æ³•ï¼Œå¿«é€Ÿå®ç°æ—¥å¿—æŸ¥çœ‹|
å‡ºå‚å…¥å‚ä¸ç¬¦åˆé¢„æœŸ|åœ¨è°ƒç”¨é“¾è·¯ä¸Šæ‰§è¡Œæ‰€æœ‰å¯ç–‘æ–¹æ³•|
ä»¥å‰éœ€è¦å†™ controller è°ƒç”¨è§¦å‘çš„æµ‹è¯•æ–¹æ³•|ç›´æ¥ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œå‡å°‘ä»£ç ï¼Œè¿˜èƒ½æµ‹è¯•ä¸Šä¸‹æ¸¸çš„å„ç§äºŒæ–¹æ¥å£ï¼Œååˆ†æ–¹ä¾¿|

*æ¡ˆä¾‹è¿˜æœ‰å¾ˆå¤šå¾ˆå¤šï¼Œå› ä¸ºçœŸçš„å¯ä»¥æ‹¿ç€å…¥å‚å°½æƒ…çš„ invoke*

æå‡äº†æ’æŸ¥é—®é¢˜ã€è§£å†³é—®é¢˜çš„æ•ˆç‡ï¼Œä¹Ÿå¸®åŠ©å…¶ä»–äººè§£å†³ä»–ä»¬çš„é—®é¢˜ã€‚ä¸å†ä¾èµ–æ‰“å°å¤§é‡æ—¥å¿—åå¤éƒ¨ç½²æœåŠ¡ï¼Œä¹Ÿä¸å†ç”³è¯· debug ç«¯å£è¿›è¡Œè¿œç¨‹ debug ï¼Œå› ä¸ºç¡®å®æ–¹ä¾¿ã€‚

#### 1.2 ä½¿ç”¨

å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨ï¼Œæˆ‘åœ¨ IDEA è£…ä¸Šä¸€ä¸ª Arthas æ’ä»¶ï¼Œç”¨å®ƒæ¥å¿«é€Ÿå¤åˆ¶å‘½ä»¤ï¼Œæƒ³æ‰§è¡Œå“ªä¸ªæ–¹æ³•æ‹·è´å³å¯ã€‚ 

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9a19a329d1834bccab44454f811f01ec~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1563&h=515&s=88254&e=png&b=3c3f41)

> ä¸Šå›¾æ˜¯ä½¿ç”¨ Arthas æ’ä»¶ç”Ÿæˆæ‰§è¡Œå‘½ä»¤ã€‚å…‰æ ‡æ”¾åœ¨æ‰§è¡Œæ–¹æ³•ä¸Šå³å‡»é€‰æ‹© vmtool å³å¯å¾—åˆ°å¯è¿è¡Œå‘½ä»¤ã€‚

**æƒ…æ™¯ä¸€ï¼š æ‰§è¡Œçš„æ–¹æ³•æ˜¯å¯¹è±¡**ï¼šéœ€è¦å¯¹å‚æ•°å¯¹è±¡èµ‹å€¼ï¼Œä»¥ä¸‹å›¾ä¸­çš„æ–¹æ³•ä¸ºä¾‹ï¼š

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/da59573084794985be61f1da3bb246f7~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=2038&h=430&s=106438&e=png&b=3b3b3b)

`queryIBCcContactConfig` æ–¹æ³•å‚æ•°æ˜¯å¯¹è±¡ï¼Œ é¦–å…ˆé€šè¿‡ Arthas å·¥å…·æŸ¥æ‰¾åˆ°å‚æ•° `IbCcContactConfigParam` çš„**classLoaderHash**ï¼Œ å¦‚ä¸‹å‘½ä»¤ï¼šï¼ˆsc -d è·¯å¾„ï¼‰

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/35d04f03ee5d44cfbdea15fec56b281e~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1507&h=1089&s=629859&e=png&b=101010)

å¯¹å‚æ•°å¯¹è±¡è¿›è¡Œå­—æ®µèµ‹å€¼,æ–¹å¼å‚è€ƒä¸‹é¢åŠ ç²—éƒ¨åˆ†ï¼ˆognlæ–¹å¼ï¼‰ï¼š

> vmtoolÂ  -x 3 -cÂ 76707e36Â --actionÂ getInstancesÂ --classNameÂ com.xxx.impl.IbCcContactConfigServiceImplÂ --expressÂ 'instances\[0\].queryIbCcContactConfig(**(#demo=newÂ com.xxx.param.IbCcContactConfigParam(),Â #demo.setContactBizCode('12345L'),#demo)**)'

æƒ…æ™¯äºŒã€åŸºç¡€ç±»å‹ï¼Œæ¯”å¦‚Stringã€Longã€Intã€‚ç›´æ¥å¡«å……æ•°å€¼å³å¯

ä¸¾ä¾‹|è¯­å¥|æè¿°|
---|---|---|
åŸºç¡€ç±»å‹ï¼Œæ¯”å¦‚Stringã€Intã€Longç±»å‹ç­‰|vmtool -x 3 --action getInstances --className com.xxl.mq.admin.service.IXxlMqMessageService --express 'instances\[0\].delete(0)'|æ‰§è¡Œ IXxlMqMessageService#delete æ–¹æ³•ï¼Œå‚æ•°ä¸º0|
|||

å‚æ•°|è§£é‡Š|
---|---|
\-x 3|è¿”å›å‚æ•°å±•å¼€å½¢å¼çš„ï¼Œé»˜è®¤1ï¼Œå¦‚æœè¿”å›ä½“æ˜¯å¯¹è±¡ï¼Œå»ºè®®è®¾ç½®3ï¼Œæ–¹ä¾¿è§‚å¯Ÿè¿”å›ç»“æœ|
\-c xxx|æŒ‡å®šclassLoaderHashï¼Œå¦‚æœä¸æŒ‡å®šï¼Œnew æ–¹æ³•æŠ¥é”™|

#### 1.3 é™åˆ¶

å…¶ä¸€ã€å°½é‡é¿å¼€ ThreadLocal ã€‚æ‰§è¡Œçº¿ç¨‹æ²¡æœ‰ ThreadLocal çš„ä¸Šä¸‹æ–‡ï¼›

å…¶äºŒã€åªèƒ½æœ‰ä¸€ä¸ªç«¯å£ï¼Œåªæ”¯æŒä¸€ä¸ªarthas-serverï¼Œç”¨å®ŒåŠæ—¶å…³æ‰ã€‚

#### 1.4 æ‰©å±•

ä½¿ç”¨ getstatic å‘½ä»¤æŸ¥çœ‹é™æ€å˜é‡

åœºæ™¯æè¿°|è¯­å¥æ‰§è¡Œ|è§£é‡Š|
---|---|---|
æŸ¥çœ‹é™æ€å˜é‡çš„å®é™…å€¼|getstatic com.xxx.xxx.interceptor.env.EnvIsolationInterceptor FILL\_FIELD\_NAME -x 3|æŸ¥çœ‹ EnvIsolationInterceptor # FILL\_FIELD\_NAME çš„é™æ€å˜é‡å€¼|
é…ç½®application.propertiesçš„å…ç™» uriï¼Œå‘ç°æ²¡æœ‰ç”Ÿæ•ˆ|getstatic com.xxx.sso.filter.InitParamContext excludeList -x 3|æŸ¥çœ‹è‡ªå·±çš„å…ç™» uri æ˜¯å¦åœ¨é›†åˆé‡Œé¢ï¼Œä»è€Œå¿«é€Ÿå®šä½é—®é¢˜|
ä¿®æ”¹é™æ€å˜é‡å€¼|ognl -x 3 '#field=@[com.xxl.mq.admin.conf.XxlMqBrokerImpl@class.getDeclaredField](https://link.juejin.cn?target=mailto%3Acom.xxl.mq.admin.conf.XxlMqBrokerImpl%40class.getDeclaredField "mailto:com.xxl.mq.admin.conf.XxlMqBrokerImpl@class.getDeclaredField")("ENV"),#field.setAccessible(true),#field.set(null," ")'|![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d60784f5a53d4326917c49af16a3425d~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1737&h=327&s=72781&e=png&b=3c3f41)
|

## ğŸ–¥ï¸äºŒã€çƒ­éƒ¨ç½² # redefine && retransform

ğŸ˜­**æ‹æ¡Œå­æ‹å¤§è…¿æ„Ÿå¹å‘å¸ƒçš„çš„ä»£ç å°‘å†™æˆ–è€…æ¼å†™ï¼›æ‹è„‘é—¨æƒ‹æƒœä¸ºå•¥ä¸å¤šæ‰“ä¸€è¡Œæ—¥å¿—ï¼›å£åèŠ¬èŠ³ä¸ºä»€ä¹ˆæŠŠåˆ¤æ–­æ¡ä»¶å†™æ­»......ï¼Œé‚£äº›åªèƒ½å‘å¸ƒæ‰èƒ½è°ƒè¯•ã€éƒ¨ç½²ä¸€æ¬¡è¦åŠå°æ—¶çš„åº”ç”¨ï¼ŒçœŸçš„ä¼šè®©ç”Ÿå‘½å˜å¾—å»‰ä»·ã€‚**

#### 2.1 åœºæ™¯

è§£å†³è¿‡çš„åœºæ™¯|æè¿°|
---|---|
åŠ æ—¥å¿—è¯­å¥ï¼Œå…¥å‚å‡ºå‚è§‚å¯Ÿ|è”è°ƒæŸ¥çœ‹å‚æ•°|
å°†åˆ¤æ–­æ¡ä»¶æ’å®šæˆäº† falseï¼Œç›®æ ‡åˆ†æ”¯æ— æ³•æ‰§è¡Œï¼Œé˜»å¡è¿›åº¦|ä¿®æ”¹åˆ¤æ–­é€»è¾‘|
æ¼å†™ä¸€è¡Œèµ‹å€¼ä»£ç |å¯¹è±¡è‡ªå·±èµ‹å€¼ç»™è‡ªå·±ï¼Œå­—æ®µå€¼ä¸ºNULL|
ç ”å‘ã€è”è°ƒé˜¶æ®µï¼Œä»£ç éªŒè¯|éœ€è¦åå¤ä¿®æ”¹ä»£ç éªŒè¯|
æµ‹è¯•åŒå­¦æBugåŠæ—¶ä¿®å¤éªŒè¯|å¿«é€Ÿä¿®å¤é—®é¢˜ï¼Œä¸å½±å“æµ‹è¯•è¿›åº¦|

**çƒ­éƒ¨ç½²çš„ä¼˜åŠ¿ç”¨è¿‡çš„éƒ½è¯´å¥½**ğŸ‘ã€‚

#### 2.2 ä½¿ç”¨

IDEA é›†æˆ ArthasHotSwap æ’ä»¶ï¼Œæ–¹ä¾¿å¿«æ·ï¼š

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6dd3e1fc0dc049e0af782fcf608dd915~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1295&h=561&s=128313&e=png&b=343638)

> å¾ˆå¤šå…¬å¸é€šè¿‡ API æ–¹å¼å·²ç»é›†æˆäº†å·¥å…·ï¼Œå®šåˆ¶åŒ–æ›´å¥½ç”¨ğŸ˜„ã€‚

#### 2.3 é™åˆ¶

*   ä¸å…è®¸æ–°å¢åŠ  field/method
*   æ­£åœ¨è·‘çš„å‡½æ•°ï¼Œæ²¡æœ‰é€€å‡ºä¸èƒ½ç”Ÿæ•ˆ
*   redefine å’Œ watch/trace/jad/tt ç­‰å‘½ä»¤å†²çª

çƒ­éƒ¨ç½²èƒ½åŠ›ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¼ºå¤§çš„èƒ½åŠ›ï¼Œçº¿ä¸Šè°¨æ…ä½¿ç”¨ï¼Œå±äºé«˜å±æ“ä½œã€‚

## ğŸ“‘ä¸‰ã€OGNL && æ¡ä»¶è¿‡æ»¤

**é¡¶æµåŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨ OGNL è§£å†³å¾ˆå¤šå¤æ‚åœºæ™¯ï¼Œå…¶æ¡ä»¶è¿‡æ»¤å±äºç»ä½³ã€‚ é€‚ç”¨äº watchã€traceã€stackã€monitorç­‰ï¼Œæœ‰å¤§é‡è¯·æ±‚ã€ for åœºæ™¯ç­‰ã€‚**

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/55686acfd0fc4ce18990387012c30be4~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1019&h=915&s=412228&e=png&b=f9f9f9)

#### 3.1 åœºæ™¯

æ¡ä»¶è¿‡æ»¤çš„é€‚ç”¨åœºæ™¯å®åœ¨å¤ªå¤šï¼Œç®€å•ä¸¾ä¾‹

è§£å†³è¿‡çš„åœºæ™¯|æè¿°|
---|---|
æƒ³æ‹¦æˆªç‰¹å®šå‚æ•°å€¼çš„æ–¹æ³•å…¥å‚å‡ºå‚ï¼Œè¿‡æ»¤å…¶ä»–å‚æ•°è¯·æ±‚|åªæœ‰ç‰¹å®šå‚æ•°æ‰ä¼šè¢«æ‹¦æˆªï¼Œå¦åˆ™è·³è¿‡ï¼Œä¸å½±å“å…¶ä»–äººä½¿ç”¨|
æ‹¦æˆªç‰¹å®šå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æ–¹æ³•è°ƒç”¨è€—æ—¶é•¿|æ’æŸ¥åˆ°äº†å‚æ•°å¼‚å¸¸æƒ…å†µï¼Œç‰¹å®šè´¦å·æ•°æ®é‡å¤ªå¤§|
æŒ‡å®šè´¦å·ç™»å½•å¼‚å¸¸|é€šè¿‡ç›‘æ§æŒ‡å®š userId çš„è°ƒç”¨æ ˆï¼Œæ’æŸ¥é—®é¢˜|

#### 3.2 ä½¿ç”¨

æ¡ä»¶åˆ¤æ–­å½¢å¼ï¼šå½¢å¦‚ params\[0\] == "orgIdxxx726" ï¼ˆOGNLï¼‰

åœºæ™¯|æ¡ˆä¾‹|æè¿°|
---|---|---|
**watch å‘½ä»¤**ï¼šåªç›‘æ§ç‰¹å®šç»„ç»‡çš„æ•°æ®ä¿¡æ¯|watch com.xxx.controller.OrgServiceController getOrgInfo '{params,returnObj,throwExp}' 'params\[0\] == "orgIdxxx726"' -n 5 -x 3|é€šè¿‡â€œÂ '**params\[0\]Â ==Â "orgIdxxx726**"'â€å‘½ä»¤ï¼Œåˆ¤æ–­åªæœ‰å½“å‚æ•°ä¸ºâ€œorgIdxxx726â€ watch æ‰ç”Ÿæ•ˆ|
**trace å‘½ä»¤**ï¼šåªæœ‰ç‰¹å®šç»„ç»‡çš„æ•°æ®æ¯”è¾ƒæ¶ˆè€—æ—¶é—´|trace com.xxx.controller.OrgServiceController getOrgInfo 'params\[0\] == "orgIdxxx726"' -n 5 --skipJDKMethod false|æŸ¥è¯¢åªè¦ç‰¹å®šç»„ç»‡è€—æ—¶é•¿ï¼Œå¿½ç•¥å…¶ä»–å‚æ•°ï¼Œç²¾å‡†å®šä½|
**stack å‘½ä»¤**ï¼šæŸ¥çœ‹è°ƒç”¨æ ˆï¼Œéå¸¸é€‚åˆä»£ç†è°ƒç”¨ã€AOPã€Filterç­‰|stack com.xxx.controller.OrgServiceController getOrgInfo 'params\[0\] == "orgIdxxx726"' -n 5|æ’æŸ¥è°ƒç”¨é“¾è·¯|

æ›´å¤šä½¿ç”¨æ¡ä»¶åˆ¤æ–­çš„æ¡ˆä¾‹å¦‚ä¸‹

```java
-- åˆ¤ç©º
trace com.xxx.controller.OrgServiceControllerÂ getOrgInfo'params[0] != null'

-- ç­‰äº
trace *com.xxx.controller.OrgServiceControllerÂ getOrgInfo 'params[0] == 1L'

-- å­—ç¬¦ä¸²ä¸ç­‰äº
trace com.xxx.controller.OrgServiceControllerÂ getOrgInfo 'params[1] != "AA"'
```
 

OGNL å¯ä»¥ç»„åˆå„ç§å½¢å¼çš„æ¡ä»¶åˆ¤æ–­ã€‚éå¸¸é€‚åˆ watchã€traceã€stack ç­‰åœºæ™¯ã€‚

#### 3.3 æ‰©å±•

[æ›´å¤šçµæ´»çš„ç”¨æ³•](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falibaba%2Farthas%2Fissues%2F11 "https://github.com/alibaba/arthas/issues/11")

[ognl | arthas](https://link.juejin.cn?target=https%3A%2F%2Farthas.aliyun.com%2Fdoc%2Fognl.html "https://arthas.aliyun.com/doc/ognl.html")

## ğŸ”– å››ã€å…¶ä»–å‘½ä»¤æ±‡æ€»

#### 4.1 logger

åœ¨å†™ä»£ç çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥åˆ»æ„åŠ  log.debug çº§åˆ«çš„æ—¥å¿—ã€‚æ—¥å¿—çº§åˆ«ä¸€èˆ¬ä¸º info ,å½“éœ€è¦æ’æŸ¥é—®é¢˜çš„æ—¶å€™ï¼Œå¯ä»¥ä¿®æ”¹æ—¥å¿—çº§åˆ«ä¸º debugã€‚

è§£å†³è¿‡çš„åœºæ™¯|æè¿°|
---|---|
è‡ªå®šä¹‰æ—¥å¿—å¤±æ•ˆï¼Œæ’æŸ¥æ—¥å¿—çš„å®ç°ç±»ç”±å“ªä¸ªåŒ…å¼•å…¥æˆ–è€…æä¾›|æ’æŸ¥é—´æ¥å¼•å…¥çš„æ—¥å¿—ä¾èµ–åŒ…|
æ”¹å˜å½“å‰ç±»çš„æ—¥å¿—çº§åˆ«ï¼ŒæŸ¥çœ‹æ—¥å¿—|å°† info çº§åˆ«ä¿®æ”¹æˆ debug çº§åˆ«|

```css
logger -n com.xxx.controller.OrgServiceControlle

é€šè¿‡sc æŸ¥çœ‹è¿™ä¸ªç±»çš„claasLoaderHashï¼›

logger --name ROOT --level debug -c 4839ebd
```
 

#### 4.2 monitor

ç›‘æ§æŸä¸ªæ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°ã€‚åŒ…æ‹¬è°ƒç”¨æ¬¡æ•°ï¼Œå¹³å‡RTã€æˆåŠŸç‡ç­‰ä¿¡æ¯ã€‚åœ¨æ€§èƒ½è°ƒä¼˜ä½¿ç”¨ï¼š

```arduino
monitor com.XXXX.handler.HandlerManager process  -n 10  --cycle 10
```
 

#### 4.3 thread

æ’æŸ¥çº¿ç¨‹æ­»é”ï¼Œä»¥åŠçº¿ç¨‹çŠ¶æ€ï¼š

è¯­å¥|è¯¦ç»†|
---|---|
thread -b|æ’æŸ¥æ­»é”æƒ…å†µï¼Œæ³¨æ„ï¼Œå½“ Arthas ä¸èƒ½åŠ è½½çš„æ—¶å€™ï¼Œè¿˜æ˜¯ç»§ç»­ä½¿ç”¨åŸæ¥çš„ top å‘½ä»¤é‚£ä¸€å¥—æ’æŸ¥é—®é¢˜|
thread -n 3|æŸ¥è¯¢å½“å‰æœ€å¿™çš„ N ä¸ªçº¿ç¨‹|

#### 4.4 jad å‘½ä»¤ã€åç¼–è¯‘

åœºæ™¯|æè¿°|
---|---|
æ’æŸ¥ jar ä¸­çš„ class æ–‡ä»¶åŠ è½½æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚æ¯”å¦‚ï¼šçªç„¶å‘ç°æŸä¸€å°æœºå™¨ä¸Šçš„æ‰§è¡Œç»“æœå’Œå…¶ä»–çš„æœºå™¨çš„ç»“æœä¸ä¸€è‡´ã€‚|æ€€ç–‘æœºå™¨éƒ¨ç½²å¼‚å¸¸|
ä¾èµ–åŒ…å†²çªï¼ŒåŠ è½½ç±»ä¸ç¬¦åˆé¢„æœŸæˆ–è€…æ”¯åˆå¹¶çš„æ—¶å€™å‡ºé”™|æ£€æŸ¥è¿è¡Œçš„ä»£ç |

æ¡ˆä¾‹ï¼šspringBoot åº”ç”¨é‡åˆ° NoSuchMethodError ç­‰é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ Jad åç¼–è¯‘ç¡®è®¤ï¼Œçœ‹ä¸€ä¸‹åŠ è½½çš„ç±»æ˜¯å¦æœ‰é—®é¢˜ã€‚

#### 4.5 watch

watch ç”¨æ¥æŸ¥çœ‹å…¥å‚å‡ºå‚ï¼Œé…åˆ OGNL æ¡ä»¶è¿‡æ»¤éå¸¸å®ç”¨ï¼š

```arduino
watch com.xxl.mq.admin.service.IXxlMqMessageService pageList '{params,returnObj,throwExp}'  -n 5  -x 4
```
 

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9dc1a2af991c4f4282f3624ae0efddf9~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1447&h=443&s=57064&e=png&b=ffffff)

æ¡ä»¶åˆ¤æ–­ #cost>200(å•ä½ms) è¡¨ç¤ºåªæœ‰å½“è€—æ—¶å¤§äº200msæ‰è¾“å‡ºï¼š

```arduino
watch demo... primeFactors '{params, returnObj}' '#cost>200' -x 2
```
 

å¦‚æœ x è®¾ç½®è¶…è¿‡ 4 ä¹Ÿå°±åªå±•ç¤º4ã€‚ä½¿ç”¨ x=4 çš„æƒ…å†µæ¯”è¾ƒå¸¸è§ï¼Œå› ä¸ºå±•å¼€çš„ä¿¡æ¯æœ€å¤šã€‚ä½†éœ€è¦æ³¨æ„çº¿ä¸Šæ•°æ®é‡å¤ªå¤§æƒ…å†µã€‚

#### 4.6 tt ï¼ˆTime Tunnelï¼‰

tt å¯ä»¥å®ç°é‡åšï¼Œå®ç°æ–¹æ³•è°ƒç”¨ï¼›ä¸ªäººæ¯”è¾ƒå–œæ¬¢ vmtoolï¼Œä¸è¿‡å¤šä»‹ç»ï¼Œ tt åŠŸèƒ½ä¹Ÿååˆ†å¼ºå¤§ã€‚

#### 4.7 ç”¨å¾—ä¸å¤šçš„å‘½ä»¤

ä¸‹é¢å‡ ä¸ªå‘½ä»¤ä¸ªäººç”¨å¾—å°‘ï¼Œä½†å¾ˆé‡è¦ï¼š

å‘½ä»¤|æè¿°|
---|---|
memory|æŸ¥çœ‹å†…å­˜ä¿¡æ¯|
options|å…¨å±€å¼€å…³ï¼Œjvm æ¯”è¾ƒé«˜çº§å°‘ç”¨çš„å‘½ä»¤|
sysprop / sysenv|å½“å‰ JVM çš„ç³»ç»Ÿå±æ€§ï¼Œç¯å¢ƒå±æ€§|
profiler|[ç«ç„°å›¾](https://link.juejin.cn?target=https%3A%2F%2Farthas.aliyun.com%2Fdoc%2Fprofiler.html "https://arthas.aliyun.com/doc/profiler.html")|
dashboard|[å®æ—¶æ•°æ®é¢æ¿](https://link.juejin.cn?target=https%3A%2F%2Farthas.aliyun.com%2Fdoc%2Fdashboard.html "https://arthas.aliyun.com/doc/dashboard.html")|

å…¶ä»–å‘½ä»¤å°±ä¸å†èµ˜è¿°äº†ğŸ“ã€‚

#### 4.8 Arthas æ’ä»¶åŠŸèƒ½

Arthas æ’ä»¶ç”Ÿæˆçš„å‘½ä»¤å¦‚ä¸‹ï¼š

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1eeb9c5772914b17b466ac427bb3e9a2~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1745&h=1511&s=502786&e=png&b=fcfcfc)

> æ³¨ï¼šå›¾ç‰‡æ¥æºäº [arthas æ’ä»¶ä½œè€…](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FWangJi92%2Farthas-idea-plugin%2Fblob%2Fmaster%2FREADME.md "https://github.com/WangJi92/arthas-idea-plugin/blob/master/README.md")ï¼Œæ’ä»¶å’Œæ–‡ç« éƒ½å¾ˆå¥½ğŸŒº

é’ˆå¯¹æ’ä»¶çš„çƒ­éƒ¨ç½²é…ç½®è¯¦è§ï¼š [(Hot Swap) Redefine çƒ­æ›´æ–°æ”¯æŒ](https://link.juejin.cn?target=https%3A%2F%2Fwww.yuque.com%2Farthas-idea-plugin%2Fhelp%2Fpwxhb4 "https://www.yuque.com/arthas-idea-plugin/help/pwxhb4"))ï¼› ä¸ªäººæ›´æ¨èçƒ­éƒ¨ç½²ç”¨ ArthasHotSwap æ’ä»¶ã€‚

## ğŸ“Œäº”ã€ä¸€äº›é™åˆ¶ && æ³¨æ„äº‹é¡¹

*   æ‰§è¡Œtrace / tt ç­‰å‘½ä»¤æ—¶ï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨ method çš„å‰åæ’å…¥ä»£ç ï¼Œä¼šå½±å“åŸæ¥ JVM é‡Œé¢ JIT ç¼–è¯‘ç”Ÿæˆçš„ä»£ç ã€‚å¯èƒ½æ‰§è¡Œå¹¶å‘é«˜çš„å‡½æ•°æœ‰æŠ–åŠ¨ï¼›
*   åªèƒ½æœ‰ä¸€ä¸ªç«¯å£ï¼Œåªæ”¯æŒä¸€ä¸ª arthas-serverï¼›
*   çƒ­éƒ¨ç½²æœ‰é™åˆ¶ä¸”ä¸ä¸€å®šèƒ½æˆåŠŸï¼Œçº¿ä¸Šå±äºé«˜å±æ“ä½œï¼›
*   å¦‚æœæœåŠ¡ä¸èƒ½å“åº”ï¼Œå¯èƒ½ Arthas ä¸èƒ½å¯åŠ¨ä½¿ç”¨ï¼Œéœ€è¦ä½¿ç”¨ Linux ç›¸å…³å‘½ä»¤æ’æŸ¥é—®é¢˜ã€‚

## ğŸ“‡å…­ã€å¥½æ–‡æ¨è

1.  [å®˜ç½‘æ–‡æ¡£](https://link.juejin.cn?target=https%3A%2F%2Farthas.aliyun.com%2F "https://arthas.aliyun.com/")
2.  [ä¸ªäººæœ€æ¨èçš„å­¦ä¹ èµ„æ–™ï¼š arthas idea pluginæ‰‹å†Œ](https://link.juejin.cn?target=https%3A%2F%2Fwww.yuque.com%2Farthas-idea-plugin%2Fhelp%2Fpe6i45 "https://www.yuque.com/arthas-idea-plugin/help/pe6i45")

## ğŸ§£ä¸ƒã€æœ€åçš„è¯

ğŸ–²è¦æˆä¸º Arthas ä½¿ç”¨çš„å¥½æ‰‹ï¼Œä¸€å®šå¤šå¤šç»ƒä¹ ï¼š**çº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œç»çŸ¥æ­¤äº‹è¦èº¬è¡Œ**ã€‚


>å‚è€ƒé“¾æ¥ï¼š[https://juejin.cn/post/7291931708920512527#heading-2](https://juejin.cn/post/7291931708920512527#heading-2)ï¼Œæ•´ç†ï¼šæ²‰é»˜ç‹äºŒ
