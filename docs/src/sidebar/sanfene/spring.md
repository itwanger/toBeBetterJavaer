---
title: Springé¢è¯•é¢˜ï¼Œ41é“Springå…«è‚¡æ–‡ï¼ˆ1.3ä¸‡å­—63å¼ æ‰‹ç»˜å›¾ï¼‰ï¼Œé¢æ¸£é€†è¢­å¿…çœ‹ğŸ‘
shortTitle: é¢æ¸£é€†è¢­-Spring
description: ä¸‹è½½æ¬¡æ•°è¶… 1 ä¸‡æ¬¡ï¼Œ1.3 ä¸‡å­— 63 å¼ æ‰‹ç»˜å›¾ï¼Œè¯¦è§£ 41 é“ Spring é¢è¯•é«˜é¢‘é¢˜ï¼ˆè®©å¤©ä¸‹æ²¡æœ‰éš¾èƒŒçš„å…«è‚¡ï¼‰ï¼Œé¢æ¸£èƒŒä¼šè¿™äº› Spring å…«è‚¡æ–‡ï¼Œè¿™æ¬¡åŠæ‰“é¢è¯•å®˜ï¼Œæˆ‘è§‰å¾—ç¨³äº†ï¼ˆæ‰‹åŠ¨ dogï¼‰ã€‚
author: ä¸‰åˆ†æ¶
date: 2024-11-05
category:
  - é¢æ¸£é€†è¢­
tag:
  - é¢æ¸£é€†è¢­
head:
  - - meta
    - name: keywords
      content: Springé¢è¯•é¢˜,Spring,é¢è¯•é¢˜,å…«è‚¡æ–‡,java,springå…¨å®¶æ¡¶
---

![é¢æ¸£é€†è¢­ Spring ç¯‡å°é¢å›¾](https://cdn.tobebetterjavaer.com/stutymore/spring-mianzhanixi-spring1.jpg)

## å‰è¨€

1.3 ä¸‡å­— 63 å¼ æ‰‹ç»˜å›¾ï¼Œè¯¦è§£ 41 é“ Spring é¢è¯•é«˜é¢‘é¢˜ï¼ˆè®©å¤©ä¸‹æ²¡æœ‰éš¾èƒŒçš„å…«è‚¡ï¼‰ï¼Œé¢æ¸£èƒŒä¼šè¿™äº› Spring å…«è‚¡æ–‡ï¼Œè¿™æ¬¡åŠæ‰“é¢è¯•å®˜ï¼Œæˆ‘è§‰å¾—ç¨³äº†ï¼ˆæ‰‹åŠ¨ dogï¼‰ã€‚æ•´ç†ï¼šæ²‰é»˜ç‹äºŒï¼Œæˆ³[è½¬è½½é“¾æ¥](https://mp.weixin.qq.com/s/EQge6DmgIqYITM3mAxkatg)ï¼Œä½œè€…ï¼šä¸‰åˆ†æ¶ï¼Œæˆ³[åŸæ–‡é“¾æ¥](https://mp.weixin.qq.com/s/Y17S85ntHm_MLTZMJdtjQQ)ã€‚

äº®ç™½ç‰ˆæœ¬æ›´é€‚åˆæ‹¿å‡ºæ¥æ‰“å°ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¤šå­¦ç”Ÿå…šå–œæ¬¢çš„æ–¹å¼ï¼Œæ‰“å°å‡ºæ¥èƒŒè¯µçš„æ•ˆç‡ä¼šæ›´é«˜ã€‚

![é¢æ¸£é€†è¢­Redisç¯‡.pdfç¬¬äºŒç‰ˆ](https://cdn.tobebetterjavaer.com/stutymore/redis-20250614154255.png)

2025 å¹´ 06 æœˆ 15 æ—¥å¼€å§‹ç€æ‰‹ç¬¬äºŒç‰ˆæ›´æ–°ã€‚

- å¯¹äºé«˜é¢‘é¢˜ï¼Œä¼šæ ‡æ³¨åœ¨ã€Š[Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)ã€‹ä¸­å‡ºç°çš„ä½ç½®ï¼Œå“ªå®¶å…¬å¸ï¼ŒåŸé¢˜æ˜¯ä»€ä¹ˆï¼Œå¹¶ä¸”ä¼šåŠ ğŸŒŸï¼Œç›®å½•ä¸€ç›®äº†ç„¶ï¼›å¦‚æœä½ æƒ³èŠ‚çœæ—¶é—´çš„è¯ï¼Œå¯ä»¥ä¼˜å…ˆèƒŒè¯µè¿™äº›é¢˜ç›®ï¼Œå°½å¿«åšåˆ°çŸ¥å½¼çŸ¥å·±ï¼Œç™¾æˆ˜ä¸æ®†ã€‚
- åŒºåˆ†å…«è‚¡ç²¾åå›ç­”ç‰ˆæœ¬å’ŒåŸç†åº•å±‚è§£é‡Šï¼Œè®©å¤§å®¶çŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼ŒåŒæ—¶åˆèƒ½åšåˆ°é¢è¯•æ—¶çš„é«˜æ•ˆå›ç­”ã€‚
- ç»“åˆé¡¹ç›®ï¼ˆ[æŠ€æœ¯æ´¾](https://javabetter.cn/zhishixingqiu/paicoding.html)ã€[pmhub](https://javabetter.cn/zhishixingqiu/pmhub.html)ï¼‰æ¥ç»„ç»‡è¯­è¨€ï¼Œè®©é¢è¯•å®˜æœ€å¤§ç¨‹åº¦æ„Ÿå—åˆ°ä½ çš„è¯šæ„ï¼Œè€Œä¸æ˜¯æœºæ¢°åŒ–çš„èƒŒè¯µã€‚
- ä¿®å¤ç¬¬ä¸€ç‰ˆä¸­å‡ºç°çš„é—®é¢˜ï¼ŒåŒ…æ‹¬çƒå‹ä»¬çš„ç§ä¿¡åé¦ˆï¼Œç½‘ç«™ç•™è¨€åŒºçš„è¯„è®ºï¼Œä»¥åŠ [GitHub ä»“åº“](https://github.com/itwanger/toBeBetterJavaer/issues)ä¸­çš„ issueï¼Œè®©è¿™ä»½é¢è¯•æŒ‡å—æ›´åŠ å®Œå–„ã€‚
- å¢åŠ [äºŒå“¥ç¼–ç¨‹æ˜Ÿçƒ](https://javabetter.cn/zhishixingqiu/)çš„çƒå‹ä»¬æ‹¿åˆ°çš„ä¸€äº› offerï¼Œå¯¹é¢æ¸£é€†è¢­çš„æ„Ÿè°¢ï¼Œä»¥åŠå¯¹ç®€å†ä¿®æ”¹çš„ä¸€äº›è®¤å¯ï¼Œä»¥æ­¤æ¥æ¿€åŠ±å¤§å®¶ï¼Œç»™å¤§å®¶æ›´å¤šä¿¡å¿ƒã€‚
- ä¼˜åŒ–æ’ç‰ˆï¼Œå¢åŠ æ‰‹ç»˜å›¾ï¼Œé‡æ–°ç»„ç»‡ç­”æ¡ˆï¼Œä½¿å…¶æ›´åŠ å£è¯­åŒ–ï¼Œä»è€Œæ›´è´´è¿‘é¢è¯•å®˜çš„é¢„æœŸã€‚

![é¢æ¸£é€†è¢­å·²ç»æäº¤ 1478 æ¬¡ GitHub è®°å½•](https://cdn.tobebetterjavaer.com/stutymore/redis-20250614154416.png)

ç”±äº PDF æ²¡åŠæ³•è‡ªæˆ‘æ›´æ–°ï¼Œæ‰€ä»¥éœ€è¦æœ€æ–°ç‰ˆçš„å°ä¼™ä¼´ï¼Œå¯ä»¥å¾®ä¿¡æœã€**æ²‰é»˜ç‹äºŒ**ã€‘ï¼Œæˆ–è€…æ‰«æ/é•¿æŒ‰è¯†åˆ«ä¸‹é¢çš„äºŒç»´ç ï¼Œå…³æ³¨äºŒå“¥çš„å…¬ä¼—å·ï¼Œå›å¤ã€**222**ã€‘å³å¯æ‹‰å–æœ€æ–°ç‰ˆæœ¬ã€‚

<div style="text-align: center; margin: 20px 0;">
    <img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png" alt="å¾®ä¿¡æ‰«ç æˆ–è€…é•¿æŒ‰è¯†åˆ«ï¼Œæˆ–è€…å¾®ä¿¡æœç´¢â€œæ²‰é»˜ç‹äºŒâ€" style="max-width: 100%; height: auto;  border-radius: 10px;" />
</div>

å½“ç„¶äº†ï¼Œè¯·å…è®¸æˆ‘çš„ä¸€ç‚¹ç‚¹ç§å¿ƒï¼Œé‚£å°±æ˜¯æ˜Ÿçƒçš„ PDF ç‰ˆæœ¬ä¼šæ¯”å…¬ä¼—å·æ—©ä¸€ä¸ªæœˆæ—¶é—´ï¼Œæ¯•ç«Ÿæ˜Ÿçƒç”¨æˆ·éƒ½ä»˜è´¹è¿‡äº†ï¼Œæˆ‘æœ‰å¿…è¦è®©ä»–ä»¬å…ˆäº«å—åˆ°ä¸€ç‚¹ç‚¹ç¦åˆ©ã€‚ç›¸ä¿¡å¤§å®¶ä¹Ÿéƒ½èƒ½ç†è§£ï¼Œæ¯•ç«Ÿåœ¨çº¿ç‰ˆæ˜¯å…è´¹çš„ï¼ŒCDNã€æœåŠ¡å™¨ã€åŸŸåã€OSS ç­‰ç­‰éƒ½æ˜¯éœ€è¦æˆæœ¬çš„ã€‚

æ›´åˆ«è¯´æˆ‘ä»˜å‡ºçš„æ—¶é—´å’Œç²¾åŠ›äº†ï¼Œå¤§å®¶è§‰å¾—æœ‰å¸®åŠ©è¿˜è¯·ç»™ä¸ªå£ç¢‘ï¼Œè®©ä½ èº«è¾¹çš„åŒäº‹ã€åŒå­¦éƒ½èƒ½å—ç›Šåˆ°ã€‚

![å›å¤ 222](https://cdn.tobebetterjavaer.com/stutymore/collection-20250512160410.png)

æˆ‘æŠŠäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ã€JVM è¿›é˜¶ä¹‹è·¯ã€å¹¶å‘ç¼–ç¨‹è¿›é˜¶ä¹‹è·¯ï¼Œä»¥åŠæ‰€æœ‰é¢æ¸£é€†è¢­çš„ç‰ˆæœ¬éƒ½æ”¾è¿›æ¥äº†ï¼Œæ¶µç›– JavaåŸºç¡€ã€Javaé›†åˆã€Javaå¹¶å‘ã€JVMã€Springã€MyBatisã€è®¡ç®—æœºç½‘ç»œã€æ“ä½œç³»ç»Ÿã€MySQLã€Redisã€RocketMQã€åˆ†å¸ƒå¼ã€å¾®æœåŠ¡ã€è®¾è®¡æ¨¡å¼ã€Linux ç­‰ 16 ä¸ªå¤§çš„ä¸»é¢˜ï¼Œå…±æœ‰ 40 å¤šä¸‡å­—ï¼Œ2000+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯è¯šæ„æ»¡æ»¡ã€‚

å±•ç¤ºä¸€ä¸‹æš—é»‘ç‰ˆæœ¬çš„ PDF å§ï¼Œæ’ç‰ˆæ¸…æ™°ï¼Œå­—ä½“ä¼˜é›…ï¼Œæ›´åŠ é€‚åˆå¤œæœï¼Œæ™šä¸Šçœ‹ä¼šæ›´èˆ’æœä¸€ç‚¹ã€‚

![é¢æ¸£é€†è¢­RSpringç¯‡.pdfæš—é»‘ç‰ˆ](https://cdn.tobebetterjavaer.com/stutymore/redis-20250614154601.png)

## åŸºç¡€

### 1.Springæ˜¯ä»€ä¹ˆï¼Ÿ

Spring æ˜¯ä¸€ä¸ª Java åç«¯å¼€å‘æ¡†æ¶ï¼Œå…¶æœ€æ ¸å¿ƒçš„ä½œç”¨æ˜¯å¸®æˆ‘ä»¬ç®¡ç† Java å¯¹è±¡ã€‚

![Spring Logo](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-165c27b4-2ea0-409a-8fa5-389c105db0fa.png)

å…¶æœ€é‡è¦çš„ç‰¹æ€§å°±æ˜¯ IoCï¼Œä¹Ÿå°±æ˜¯æ§åˆ¶åè½¬ã€‚ä»¥å‰æˆ‘ä»¬è¦ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œéƒ½è¦è‡ªå·±å…ˆ new å‡ºæ¥ã€‚ä½†æœ‰äº† Spring ä¹‹åï¼Œæˆ‘ä»¬åªéœ€è¦å‘Šè¯‰ Spring æˆ‘ä»¬éœ€è¦ä»€ä¹ˆå¯¹è±¡ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åˆ›å»ºå¥½å¹¶æ³¨å…¥åˆ° Spring å®¹å™¨å½“ä¸­ã€‚

æ¯”å¦‚æˆ‘åœ¨ä¸€ä¸ª Service ç±»é‡Œéœ€è¦ç”¨åˆ° Dao å¯¹è±¡ï¼Œåªéœ€è¦åŠ ä¸ª `@Autowired` æ³¨è§£ï¼ŒSpring å°±ä¼šè‡ªåŠ¨æŠŠ Dao å¯¹è±¡æ³¨å…¥åˆ° Spring å®¹å™¨å½“ä¸­ï¼Œè¿™æ ·å°±ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»ç®¡ç†è¿™äº›å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»äº†ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šæŠ€æœ¯æ´¾@Autowiredæºç ](https://cdn.tobebetterjavaer.com/stutymore/spring-20250615105532.png)

å¦å¤–ï¼ŒSpring è¿˜æä¾›äº† AOPï¼Œä¹Ÿå°±æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œåœ¨æˆ‘ä»¬éœ€è¦åšä¸€äº›é€šç”¨åŠŸèƒ½çš„æ—¶å€™ç‰¹åˆ«æœ‰ç”¨ï¼Œæ¯”å¦‚è¯´æ—¥å¿—è®°å½•ã€æƒé™æ ¡éªŒã€äº‹åŠ¡ç®¡ç†è¿™äº›ï¼Œæˆ‘ä»¬ä¸ç”¨åœ¨æ¯ä¸ªæ–¹æ³•é‡Œéƒ½å†™é‡å¤çš„ä»£ç ï¼Œç›´æ¥ç”¨ AOP å°±èƒ½ç»Ÿä¸€å¤„ç†ã€‚

![æŠ€æœ¯æ´¾ï¼šAOP äº‹åŠ¡æºç ](https://cdn.tobebetterjavaer.com/stutymore/spring-20250615105726.png)

Spring çš„ç”Ÿæ€ä¹Ÿç‰¹åˆ«ä¸°å¯Œï¼Œåƒ Spring Boot èƒ½è®©æˆ‘ä»¬å¿«é€Ÿæ­å»ºé¡¹ç›®ï¼ŒSpring MVC èƒ½å¸®æˆ‘ä»¬å¤„ç† web è¯·æ±‚ï¼ŒSpring Data èƒ½å¸®æˆ‘ä»¬ç®€åŒ–æ•°æ®åº“æ“ä½œï¼ŒSpring Cloud èƒ½å¸®æˆ‘ä»¬åšå¾®æœåŠ¡æ¶æ„ç­‰ç­‰ã€‚

#### Springæœ‰å“ªäº›ç‰¹æ€§ï¼Ÿ

Spring çš„ç‰¹æ€§è¿˜æ˜¯æŒºå¤šçš„ï¼Œæˆ‘æŒ‰ç…§åœ¨å®é™…å·¥ä½œ/å­¦ä¹ ä¸­ç”¨å¾—æœ€å¤šçš„å‡ ä¸ªæ¥è¯´å§ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringç‰¹æ€§](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-a0f0ef9d-3289-41ea-94c2-34b7e37ef854.png)

é¦–å…ˆæœ€æ ¸å¿ƒçš„å°±æ˜¯ IoC æ§åˆ¶åè½¬å’Œ DI ä¾èµ–æ³¨å…¥ã€‚è¿™ä¸ªæˆ‘å‰é¢ä¹Ÿæåˆ°äº†ï¼Œå°±æ˜¯ Spring èƒ½å¸®æˆ‘ä»¬ç®¡ç†å¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–å…³ç³»ã€‚

æ¯”å¦‚æˆ‘å†™ä¸€ä¸ª UserServiceï¼Œéœ€è¦ç”¨åˆ° UserDaoï¼Œä»¥å‰å¾—è‡ªå·± new ä¸€ä¸ª UserDao å‡ºæ¥ï¼Œç°åœ¨åªè¦åœ¨ UserService ä¸ŠåŠ ä¸ª `@Service` æ³¨è§£ï¼Œåœ¨ UserDao å­—æ®µä¸ŠåŠ ä¸ª `@Autowired`ï¼ŒSpring å°±ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å¤„ç†å¥½è¿™äº›ä¾èµ–å…³ç³»ã€‚

è¿™æ ·ä»£ç çš„è€¦åˆåº¦å°±å¤§å¤§é™ä½äº†ï¼Œæµ‹è¯•çš„æ—¶å€™ä¹Ÿæ›´å®¹æ˜“ mockã€‚

ç¬¬äºŒä¸ªå°±æ˜¯ AOP é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚è¿™ä¸ªåœ¨æˆ‘ä»¬å¤„ç†ä¸€äº›æ¨ªåˆ‡å…³æ³¨ç‚¹çš„æ—¶å€™ç‰¹åˆ«æœ‰ç”¨ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬è¦ç»™æŸäº› Controller æ–¹æ³•éƒ½åŠ ä¸Šæƒé™æ§åˆ¶ï¼Œå¦‚æœæ²¡æœ‰ AOP çš„è¯ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½è¦å†™ä¸€éåŠ æƒä»£ç ï¼Œç»´æŠ¤èµ·æ¥å¾ˆéº»çƒ¦ã€‚

![æŠ€æœ¯æ´¾æºç ï¼š@Permissionæ³¨è§£åŠ æƒé™éªŒè¯](https://cdn.tobebetterjavaer.com/stutymore/spring-20250615110533.png)

ç”¨äº† AOP ä¹‹åï¼Œæˆ‘ä»¬åªéœ€è¦å†™ä¸€ä¸ªåˆ‡é¢ç±»ï¼Œå®šä¹‰å¥½åˆ‡ç‚¹å’Œé€šçŸ¥ï¼Œå°±èƒ½ç»Ÿä¸€å¤„ç†äº†ã€‚äº‹åŠ¡ç®¡ç†ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼ŒåŠ ä¸ª `@Transactional` æ³¨è§£å°±æå®šäº†ã€‚

è¿˜æœ‰å°±æ˜¯ Spring å¯¹å„ç§ä¼ä¸šçº§åŠŸèƒ½çš„é›†æˆæ”¯æŒä¹Ÿç‰¹åˆ«å¥½ã€‚æ¯”å¦‚æ•°æ®åº“è®¿é—®ï¼Œä¸ç®¡æˆ‘ä»¬ç”¨ JDBCã€MyBatis-Plus è¿˜æ˜¯ Hibernateï¼ŒSpring éƒ½èƒ½å¾ˆå¥½åœ°é›†æˆã€‚æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜ã€å®‰å…¨è®¤è¯è¿™äº›ï¼Œ Spring éƒ½æœ‰å¯¹åº”çš„æ¨¡å—æ¥æ”¯æŒã€‚

![æŠ€æœ¯æ´¾æºç ï¼šSpring Boot çš„çº¦å®šå¤§äºé…ç½®](https://cdn.tobebetterjavaer.com/stutymore/spring-20250615111039.png)

å¦å¤– Spring çš„é…ç½®ä¹Ÿå¾ˆçµæ´»ï¼Œæ—¢æ”¯æŒ XML é…ç½®ï¼Œä¹Ÿæ”¯æŒæ³¨è§£é…ç½®ï¼Œç°åœ¨æˆ‘ä»¬åŸºæœ¬éƒ½ç”¨æ³¨è§£äº†ï¼Œå†™èµ·æ¥æ›´ç®€æ´ã€‚Spring Boot å‡ºæ¥ä¹‹åå°±æ›´æ–¹ä¾¿äº†ï¼Œçº¦å®šå¤§äºé…ç½®ï¼Œå¾ˆå¤šä¸œè¥¿éƒ½æ˜¯å¼€ç®±å³ç”¨çš„ã€‚

#### ç®€å•è¯´ä¸€ä¸‹ä»€ä¹ˆæ˜¯AOPå’ŒIoCï¼Ÿ

AOP é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œç®€å•ç‚¹è¯´å°±æ˜¯æŠŠä¸€äº›é€šç”¨çš„åŠŸèƒ½ä»ä¸šåŠ¡ä»£ç é‡ŒæŠ½å–å‡ºæ¥ï¼Œç»Ÿä¸€å¤„ç†ã€‚æ¯”å¦‚è¯´[æŠ€æœ¯æ´¾](https://javabetter.cn/zhishixingqiu/paicoding.html)ä¸­çš„ `@MdcDot` æ³¨è§£çš„ä½œç”¨æ˜¯é…åˆ AOP åœ¨æ—¥å¿—ä¸­åŠ å…¥ MDC ä¿¡æ¯ï¼Œæ–¹ä¾¿è¿›è¡Œæ—¥å¿—è¿½è¸ªã€‚

![æŠ€æœ¯æ´¾æºç ï¼š@MdcDotæ³¨è§£é…åˆ AOP å®Œæˆæ—¥å¿—è¿½è¸ª](https://cdn.tobebetterjavaer.com/stutymore/spring-20250615111917.png)

IoC æ§åˆ¶åè½¬æ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å°†å¯¹è±¡çš„åˆ›å»ºå’Œå¯¹è±¡ä¹‹é—´çš„è°ƒç”¨è¿‡ç¨‹äº¤ç»™ Spring å®¹å™¨æ¥ç®¡ç†ã€‚æ¯”å¦‚è¯´åœ¨[æŠ€æœ¯æ´¾](https://javabetter.cn/zhishixingqiu/paicoding.html)é¡¹ç›®å½“ä¸­ï¼Œ`@PostConstruct` æ³¨è§£è¡¨æ˜è¿™ä¸ªæ–¹æ³•ç”± Spring å®¹å™¨åœ¨ Bean åˆå§‹åŒ–å®Œæˆåè‡ªåŠ¨è°ƒç”¨ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨ init æ–¹æ³•ã€‚

![æŠ€æœ¯æ´¾æºç ï¼š@PostConstructåº”ç”¨](https://cdn.tobebetterjavaer.com/stutymore/spring-20250615113219.png)

#### Springæºç çœ‹è¿‡å—ï¼Ÿ

çœ‹è¿‡ä¸€äº›ï¼Œä¸»è¦æ˜¯å¸¦ç€é—®é¢˜å»çœ‹çš„ï¼Œæ¯”å¦‚é‡åˆ°ä¸€äº›æŠ€æœ¯éš¾ç‚¹æˆ–è€…æƒ³æ·±å…¥ç†è§£æŸä¸ªåŠŸèƒ½çš„æ—¶å€™ã€‚

æˆ‘é‡ç‚¹çœ‹è¿‡çš„æ˜¯ IoC å®¹å™¨çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯ ApplicationContext çš„å¯åŠ¨æµç¨‹ã€‚ä» `refresh()` æ–¹æ³•å¼€å§‹ï¼ŒåŒ…æ‹¬ Bean çš„å®šä¹‰å’ŒåŠ è½½ã€Bean å·¥å‚çš„å‡†å¤‡ã€Bean çš„å®ä¾‹åŒ–å’Œåˆå§‹åŒ–è¿™äº›å…³é”®æ­¥éª¤ã€‚

![æ˜Ÿçƒå˜‰å®¾æ¥¼ä»”ï¼šSpring æºç è§£æ](https://cdn.tobebetterjavaer.com/stutymore/spring-20241207102105.png)

çœ‹æºç çš„æ—¶å€™å‘ç° Spring ç”¨äº†å¾ˆå¤šè®¾è®¡æ¨¡å¼ï¼Œæ¯”å¦‚å·¥å‚æ¨¡å¼ã€å•ä¾‹æ¨¡å¼ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼ç­‰ç­‰ï¼Œè¿™å¯¹æˆ‘å¹³æ—¶å†™ä»£ç ä¹Ÿå¾ˆæœ‰å¯å‘ã€‚

è¿˜æœ‰å°±æ˜¯ Spring çš„ Bean ç”Ÿå‘½å‘¨æœŸï¼Œä» BeanDefinition çš„åˆ›å»ºåˆ° Bean çš„å®ä¾‹åŒ–ã€å±æ€§æ³¨å…¥ã€åˆå§‹åŒ–å›è°ƒï¼Œå†åˆ°æœ€åçš„é”€æ¯ï¼Œæ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯æŒºå¤æ‚çš„ã€‚çœ‹äº†æºç ä¹‹åå¯¹ `@PostConstruct`ã€`@PreDestroy` è¿™äº›æ³¨è§£çš„æ‰§è¡Œæ—¶æœºå°±æ›´æ¸…æ¥šäº†ã€‚

ä¸è¿‡è¯´å®è¯ï¼ŒSpring çš„æºç ç¡®å®æ¯”è¾ƒéš¾å•ƒï¼Œæ¶‰åŠçš„æ¦‚å¿µå’ŒæŠ€æœ¯ç‚¹å¤ªå¤šäº†ã€‚æˆ‘ä¸€èˆ¬æ˜¯ç»“åˆä¸€äº›æŠ€æœ¯åšå®¢å’Œ Claude ä¸€èµ·çœ‹ï¼Œè¿™æ ·ç†è§£èµ·æ¥ä¼šç›¸å¯¹å®¹æ˜“ä¸€äº›ã€‚

PSï¼šå…³äºè¿™ä»½å°å†Œçš„ PDF ç‰ˆæœ¬ï¼Œç›®å‰åªæœ‰[æ˜Ÿçƒ](https://javabetter.cn/zhishixingqiu/)çš„ç”¨æˆ·å¯ä»¥è·å–ï¼Œåç»­ä¼šè€ƒè™‘å¼€æ”¾ç»™å¤§å®¶ã€‚

![æ¥¼ä»”çš„ Spring æºç è§£ææ‰‹å†Œ](https://cdn.tobebetterjavaer.com/stutymore/spring-20241207101910.png)

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 5 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šIOCä¸AOP

memoï¼š2025 å¹´ 6 æœˆ 15 æ—¥ä¿®æ”¹è‡³æ­¤ï¼Œä»Šå¤©åœ¨å¸®[çƒå‹ä»¬ä¿®æ”¹ç®€å†](https://javabetter.cn/zhishixingqiu/jianli.html)çš„æ—¶å€™ï¼Œç¢°åˆ°ä¸€ä¸ªä¸­å±±å¤§å­¦æœ¬ç¡•çš„çƒå‹ï¼Œæ ¡å›­è£èª‰åŸºæœ¬ä¸Šæ‹‰æ»¡äº†ï¼Œéå¸¸ä¼˜ç§€ï¼Œé‚£æˆ‘ä¹Ÿå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©åˆ°æ›´å¤šçš„çƒå‹ä»¬ï¼Œå¸®ä»–ä»¬æ‹¿åˆ°æ›´å¥½çš„ offerã€‚

![ä¸­å±±å¤§å­¦çš„çƒå‹](https://cdn.tobebetterjavaer.com/stutymore/spring-20250615120504.png)

### 2.Springæœ‰å“ªäº›æ¨¡å—å‘¢ï¼Ÿ

æˆ‘æŒ‰ç…§å¹³æ—¶å·¥ä½œ/å­¦ä¹ ä¸­æ¥è§¦çš„é¢‘ç‡æ¥è¯´ä¸€ä¸‹ã€‚

é¦–å…ˆæ˜¯ Spring Core æ¨¡å—ï¼Œè¿™æ˜¯æ•´ä¸ª Spring æ¡†æ¶çš„åŸºç¡€ï¼ŒåŒ…å«äº† IoC å®¹å™¨å’Œä¾èµ–æ³¨å…¥ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚è¿˜æœ‰ Spring Beans æ¨¡å—ï¼Œè´Ÿè´£ Bean çš„é…ç½®å’Œç®¡ç†ã€‚è¿™ä¸¤ä¸ªæ¨¡å—åŸºæœ¬ä¸Šæ˜¯å…¶ä»–æ‰€æœ‰æ¨¡å—çš„åŸºç¡€ï¼Œä¸ç®¡ç”¨ Spring çš„å“ªä¸ªåŠŸèƒ½éƒ½ä¼šç”¨åˆ°ã€‚

![Springå®˜ç½‘ï¼šæ¨¡å—åˆ’åˆ†](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-bb7c13ea-3174-4b32-84b8-821849ddc377.png)

ç„¶åæ˜¯ Spring Context ä¸Šä¸‹æ–‡æ¨¡å—ï¼Œå®ƒåœ¨ Core çš„åŸºç¡€ä¸Šæä¾›äº†æ›´å¤šä¼ä¸šçº§çš„åŠŸèƒ½ï¼Œæ¯”å¦‚å›½é™…åŒ–ã€äº‹ä»¶ä¼ æ’­ã€èµ„æºåŠ è½½è¿™äº›ã€‚ApplicationContext å°±æ˜¯åœ¨è¿™ä¸ªæ¨¡å—é‡Œé¢çš„ã€‚

```java
@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        // Spring Bootä¼šè‡ªåŠ¨åˆ›å»ºApplicationContext
        ApplicationContext context = SpringApplication.run(Application.class, args);
    }
}
```

Spring AOP æ¨¡å—æä¾›äº†é¢å‘åˆ‡é¢ç¼–ç¨‹çš„æ”¯æŒï¼Œæˆ‘ä»¬ç”¨çš„ `@Transactional`ã€è‡ªå®šä¹‰åˆ‡é¢è¿™äº›éƒ½æ˜¯åŸºäºè¿™ä¸ªæ¨¡å—ã€‚

Web å¼€å‘æ–¹é¢ï¼ŒSpring Web æ¨¡å—æä¾›äº†åŸºç¡€çš„ Web åŠŸèƒ½ï¼ŒSpring WebMVC å°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ MVC æ¡†æ¶ï¼Œç”¨æ¥å¤„ç† HTTP è¯·æ±‚å’Œå“åº”ã€‚ç°åœ¨è¿˜æœ‰ Spring WebFluxï¼Œæ”¯æŒå“åº”å¼ç¼–ç¨‹ã€‚

æ¯”å¦‚è¯´[æŠ€æœ¯æ´¾](https://javabetter.cn/zhishixingqiu/paicoding.html)é¡¹ç›®ä¸­ï¼Œ`GlobalExceptionHandler` ç±»å°±ä½¿ç”¨äº† `@RestControllerAdvice` æ¥å®ç°ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†ã€‚

```java
@RestControllerAdvice
public class GlobalExceptionHandler {
    @ExceptionHandler(value = ForumAdviceException.class)
    public ResVo<String> handleForumAdviceException(ForumAdviceException e) {
        return ResVo.fail(e.getStatus());
    }
}
```

æ•°æ®è®¿é—®æ–¹é¢ï¼ŒSpring JDBC ç®€åŒ–äº† JDBC çš„ä½¿ç”¨ï¼Œåœ¨[æŠ€æœ¯æ´¾](https://javabetter.cn/zhishixingqiu/paicoding.html)é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°± `JdbcTemplate` æ¥æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨ã€æ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ã€‚

![æŠ€æœ¯æ´¾æºç ï¼šJdbcTemplate](https://cdn.tobebetterjavaer.com/stutymore/spring-20250616105042.png)

Spring ORM æä¾›äº†å¯¹ MyBatis-Plus ç­‰ ORM æ¡†æ¶çš„é›†æˆæ”¯æŒã€‚åœ¨[æŠ€æœ¯æ´¾](https://javabetter.cn/zhishixingqiu/paicoding.html)é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°±ç”¨äº† `@TableName`ã€`@TableField` ç­‰æ³¨è§£è¿›è¡Œå¯¹è±¡å…³ç³»æ˜ å°„ï¼Œé€šè¿‡ç»§æ‰¿ BaseMapper æ¥è·å–é€šç”¨çš„ CRUD èƒ½åŠ›ã€‚

![æŠ€æœ¯æ´¾æºç ï¼šBaseMapper](https://cdn.tobebetterjavaer.com/stutymore/spring-20250616105224.png)

Spring Test æ¨¡å—æä¾›äº†æµ‹è¯•æ”¯æŒï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°è¿›è¡Œå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ã€‚æˆ‘ä»¬å†™æµ‹è¯•ç”¨ä¾‹çš„æ—¶å€™ç»å¸¸ç”¨ `@SpringBootTest` è¿™äº›æ³¨è§£ã€‚æ¯”å¦‚è¯´åœ¨[æŠ€æœ¯æ´¾](https://javabetter.cn/zhishixingqiu/paicoding.html)é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°±ç”¨ `@SpringBootTest` æ³¨è§£æ¥åŠ è½½ Spring ä¸Šä¸‹æ–‡ï¼Œè¿›è¡Œé›†æˆæµ‹è¯•ã€‚

```java
@Slf4j
@SpringBootTest(classes = QuickForumApplication.class)
@RunWith(SpringJUnit4ClassRunner.class)
public class BasicTest {
}
```

è¿˜æœ‰ä¸€äº›å…¶ä»–çš„æ¨¡å—ï¼Œæ¯”å¦‚ Spring Security è´Ÿè´£å®‰å…¨è®¤è¯ï¼ŒSpring Batch å¤„ç†æ‰¹å¤„ç†ä»»åŠ¡ç­‰ç­‰ã€‚

ç°åœ¨æˆ‘ä»¬åŸºæœ¬éƒ½æ˜¯ç”¨ Spring Boot æ¥å¼€å‘ï¼Œå®ƒæŠŠè¿™äº›æ¨¡å—éƒ½æ•´åˆå¥½äº†ï¼Œç”¨èµ·æ¥æ›´æ–¹ä¾¿ã€‚

![æŠ€æœ¯æ´¾ï¼šæŠ€æœ¯é€‰å‹](https://cdn.tobebetterjavaer.com/stutymore/spring-20250616105807.png)

memoï¼š2025 å¹´ 6 æœˆ 16 æ—¥ä¿®æ”¹è‡³æ­¤ï¼Œä»Šå¤©åœ¨å¸®[çƒå‹ä»¬ä¿®æ”¹ç®€å†](https://javabetter.cn/zhishixingqiu/jianli.html)çš„æ—¶å€™ï¼Œç¢°åˆ°ä¸€ä¸ªå¤§è¿æµ·äº‹å¤§å­¦ç¡•æ²³å—ç†å·¥å¤§å­¦æœ¬çš„çƒå‹ï¼Œä»–è£èª‰å¥–é¡¹é‡Œæåˆ°çš„ä¼˜ç§€ç ”ç©¶ç”Ÿã€å¥–å­¦é‡‘ã€è‹±è¯­å››å…­çº§ï¼Œæˆ‘å¸Œæœ›çœ‹åˆ°çš„åŒå­¦ä¹Ÿéƒ½èƒ½äº‰å–ä¸€ä¸‹ï¼Œä¸è¦æŠŠè¿™äº›è£èª‰æ‹±æ‰‹è®©äººï¼Œæˆ–è€…å‹æ ¹å°±ä¸çŸ¥é“ï¼Œæˆ–è€…ä¸å±‘äºå»å‚åŠ ï¼Œåˆ°æ—¶å€™ä½ ç®€å†ä¸Šè¿™ä¸€æ å°±ä¼šæ¯”è¾ƒè‹ç™½ã€‚

![å¤§è¿æµ·äº‹å¤§å­¦ç¡•æ²³å—ç†å·¥å¤§å­¦æœ¬çš„çƒå‹](https://cdn.tobebetterjavaer.com/stutymore/spring-20250616110317.png)

### 3.Springæœ‰å“ªäº›å¸¸ç”¨æ³¨è§£å‘¢ï¼Ÿ

Spring çš„æ³¨è§£æŒºå¤šçš„ï¼Œæˆ‘æŒ‰ç…§ä¸åŒçš„åŠŸèƒ½åˆ†ç±»æ¥è¯´ä¸€ä¸‹å¹³æ—¶ç”¨å¾—æœ€å¤šçš„é‚£äº›ã€‚

é¦–å…ˆæ˜¯ Bean ç®¡ç†ç›¸å…³çš„æ³¨è§£ã€‚`@Component` æ˜¯æœ€åŸºç¡€çš„ï¼Œç”¨æ¥æ ‡è¯†ä¸€ä¸ªç±»æ˜¯ Spring ç»„ä»¶ã€‚åƒ `@Service`ã€`@Repository`ã€`@Controller` è¿™äº›éƒ½æ˜¯ `@Component` çš„ç‰¹åŒ–ç‰ˆæœ¬ï¼Œåˆ†åˆ«ç”¨åœ¨æœåŠ¡å±‚ã€æ•°æ®è®¿é—®å±‚å’Œæ§åˆ¶å™¨å±‚ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringå¸¸ç”¨æ³¨è§£](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-8d0a1518-a425-4887-9735-45321095d927.png)

ä¾èµ–æ³¨å…¥æ–¹é¢ï¼Œ`@Autowired` æ˜¯ç”¨å¾—æœ€å¤šçš„ï¼Œå¯ä»¥æ ‡æ³¨åœ¨å­—æ®µã€setter æ–¹æ³•æˆ–è€…æ„é€ æ–¹æ³•ä¸Šã€‚`@Qualifier` åœ¨æœ‰å¤šä¸ªåŒç±»å‹ Bean çš„æ—¶å€™ç”¨æ¥æŒ‡å®šå…·ä½“æ³¨å…¥å“ªä¸€ä¸ªã€‚`@Resource` å’Œ `@Autowired` åŠŸèƒ½å·®ä¸å¤šï¼Œä¸è¿‡å®ƒæ˜¯æŒ‰åç§°æ³¨å…¥çš„ã€‚

![æŠ€æœ¯æ´¾æºç ï¼š@Resourceå’Œ@Autowired](https://cdn.tobebetterjavaer.com/stutymore/spring-20250617110609.png)


é…ç½®ç›¸å…³çš„æ³¨è§£ä¹Ÿå¾ˆå¸¸ç”¨ã€‚`@Configuration` æ ‡è¯†é…ç½®ç±»ï¼Œ`@Bean` ç”¨æ¥å®šä¹‰ Beanï¼Œ`@Value` ç”¨æ¥æ³¨å…¥é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§å€¼ã€‚æˆ‘ä»¬é¡¹ç›®é‡Œçš„æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€Redis é…ç½®è¿™äº›éƒ½æ˜¯ç”¨ `@Value` æ¥æ³¨å…¥çš„ã€‚`@PropertySource` ç”¨æ¥æŒ‡å®šé…ç½®æ–‡ä»¶çš„ä½ç½®ã€‚

![æŠ€æœ¯æ´¾æºç ï¼š@Value](https://cdn.tobebetterjavaer.com/stutymore/spring-20250617110755.png)

Web å¼€å‘çš„æ³¨è§£å°±æ›´å¤šäº†ã€‚`@RestController` ç›¸å½“äº `@Controller` åŠ  `@ResponseBody`ï¼Œç”¨æ¥åš RESTful æ¥å£ã€‚

![æŠ€æœ¯æ´¾æºç ï¼šweb å¼€å‘çš„æ³¨è§£](https://cdn.tobebetterjavaer.com/stutymore/spring-20250617110859.png)

`@RequestMapping` åŠå…¶å˜ä½“`@GetMapping`ã€`@PostMapping`ã€`@PutMapping`ã€`@DeleteMapping` ç”¨æ¥æ˜ å°„ HTTP è¯·æ±‚ã€‚`@PathVariable` è·å–è·¯å¾„å‚æ•°ï¼Œ`@RequestParam` è·å–è¯·æ±‚å‚æ•°ï¼Œ`@RequestBody` æ¥æ”¶ JSON æ•°æ®ã€‚

AOP ç›¸å…³çš„æ³¨è§£ï¼Œ`@Aspect` å®šä¹‰åˆ‡é¢ï¼Œ`@Pointcut` å®šä¹‰åˆ‡ç‚¹ï¼Œ`@Before`ã€`@After`ã€`@Around` è¿™äº›å®šä¹‰é€šçŸ¥ç±»å‹ã€‚

![æŠ€æœ¯æ´¾æºç ï¼šAOP ç›¸å…³æ³¨è§£](https://cdn.tobebetterjavaer.com/stutymore/spring-20250617111100.png)

ä¸è¿‡æˆ‘ä»¬ç”¨å¾—æœ€å¤šçš„è¿˜æ˜¯`@Transactional`ï¼ŒåŸºæœ¬ä¸Š Service å±‚éœ€è¦ä¿è¯äº‹åŠ¡åŸå­æ€§çš„æ–¹æ³•éƒ½ä¼šåŠ ä¸Šè¿™ä¸ªæ³¨è§£ã€‚

ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„ï¼Œ`@PostConstruct` åœ¨ Bean åˆå§‹åŒ–åæ‰§è¡Œï¼Œ`@PreDestroy` åœ¨ Bean é”€æ¯å‰æ‰§è¡Œã€‚æµ‹è¯•çš„æ—¶å€™ `@SpringBootTest` ä¹Ÿç»å¸¸ç”¨åˆ°ã€‚

![æŠ€æœ¯æ´¾æºç ï¼š@PostConstruct](https://cdn.tobebetterjavaer.com/stutymore/spring-20250617111256.png)

è¿˜æœ‰ä¸€äº› Spring Boot ç‰¹æœ‰çš„æ³¨è§£ï¼Œæ¯”å¦‚ `@SpringBootApplication` è¿™ä¸ªå¯åŠ¨ç±»æ³¨è§£ï¼Œ`@ConditionalOnProperty` åšæ¡ä»¶è£…é…ï¼Œ`@EnableAutoConfiguration` å¼€å¯è‡ªåŠ¨é…ç½®ç­‰ç­‰ã€‚

![æŠ€æœ¯æ´¾æºç ï¼š@ConditionalOnProperty](https://cdn.tobebetterjavaer.com/stutymore/spring-20250617111359.png)

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¾®ä¼—é“¶è¡ŒåŒå­¦ 1 Java åç«¯ä¸€é¢çš„åŸé¢˜ï¼šè¯´è¯´ Spring å¸¸è§çš„æ³¨è§£ï¼Ÿ

memoï¼š2025 å¹´ 6 æœˆ 17 æ—¥ä¿®æ”¹è‡³æ­¤ï¼Œä»Šå¤©åœ¨å¸®[çƒå‹ä»¬ä¿®æ”¹ç®€å†](https://javabetter.cn/zhishixingqiu/jianli.html)çš„æ—¶å€™ï¼Œç¢°åˆ°ä¸€ä¸ªå­¦é™¢æœ¬çš„çƒå‹ï¼Œä»–çš„è£èª‰å¥–é¡¹è¿˜æ˜¯ OKçš„ï¼Œæ€åº¦ä¹Ÿéå¸¸å¥½ï¼Œä¹‹å‰æœ‰å­¦é™¢æœ¬çƒå‹æ‹¿åˆ°æ»´æ»´ SP offer çš„ï¼Œå¸Œæœ›è¿™ä½çƒå‹ä¹Ÿèƒ½å¤Ÿæˆä¸ºæ˜Ÿçƒé‡Œæ–°çš„æ¦œæ ·ã€‚

![é—½æ±Ÿå­¦é™¢çš„çƒå‹](https://cdn.tobebetterjavaer.com/stutymore/spring-20250617111727.png)

### 4.ğŸŒŸSpringç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ

Spring æ¡†æ¶é‡Œé¢ç¡®å®ç”¨äº†å¾ˆå¤šè®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»å¹³æ—¶å·¥ä½œä¸­èƒ½è§‚å¯Ÿåˆ°çš„å‡ ä¸ªæ¥è¯´è¯´ã€‚

é¦–å…ˆæ˜¯å·¥å‚æ¨¡å¼ï¼Œè¿™ä¸ªåœ¨ Spring é‡Œç”¨å¾—éå¸¸å¤šã€‚BeanFactory å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„å·¥å‚ï¼Œå®ƒè´Ÿè´£åˆ›å»ºå’Œç®¡ç†æ‰€æœ‰çš„ Bean å¯¹è±¡ã€‚æˆ‘ä»¬å¹³æ—¶ç”¨çš„ ApplicationContext å…¶å®ä¹Ÿæ˜¯ BeanFactory çš„ä¸€ä¸ªå®ç°ã€‚å½“æˆ‘ä»¬é€šè¿‡ `@Autowired` è·å–ä¸€ä¸ª Bean çš„æ—¶å€™ï¼Œåº•å±‚å°±æ˜¯é€šè¿‡å·¥å‚æ¨¡å¼æ¥åˆ›å»ºå’Œè·å–å¯¹è±¡çš„ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringä¸­ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-ee1c5cee-8462-4bae-93ea-ec936cc77640.png)

å•ä¾‹æ¨¡å¼ä¹Ÿæ˜¯ Spring çš„é»˜è®¤è¡Œä¸ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring å®¹å™¨ä¸­çš„ Bean éƒ½æ˜¯å•ä¾‹çš„ï¼Œæ•´ä¸ªåº”ç”¨ä¸­åªä¼šæœ‰ä¸€ä¸ªå®ä¾‹ã€‚è¿™æ ·å¯ä»¥èŠ‚çœå†…å­˜ï¼Œæé«˜æ€§èƒ½ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `@Scope` æ³¨è§£æ¥æ”¹å˜ Bean çš„ä½œç”¨åŸŸï¼Œæ¯”å¦‚è®¾ç½®ä¸º prototype å°±æ˜¯æ¯æ¬¡è·å–éƒ½åˆ›å»ºæ–°å®ä¾‹ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼š@Scopeæ³¨è§£](https://cdn.tobebetterjavaer.com/stutymore/spring-20250618113356.png)

ä»£ç†æ¨¡å¼åœ¨ AOP ä¸­ç”¨å¾—ç‰¹åˆ«å¤šã€‚Spring AOP çš„åº•å±‚å®ç°å°±æ˜¯åŸºäºåŠ¨æ€ä»£ç†çš„ï¼Œå¯¹äºå®ç°äº†æ¥å£çš„ç±»ç”¨ JDK åŠ¨æ€ä»£ç†ï¼Œæ²¡æœ‰å®ç°æ¥å£çš„ç±»ç”¨ CGLIB ä»£ç†ã€‚æ¯”å¦‚æˆ‘ä»¬ç”¨ `@Transactional` æ³¨è§£çš„æ—¶å€™ï¼ŒSpring ä¼šä¸ºæˆ‘ä»¬çš„ç±»åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå‰åæ·»åŠ äº‹åŠ¡å¤„ç†é€»è¾‘ã€‚

æ¨¡æ¿æ–¹æ³•æ¨¡å¼åœ¨ Spring é‡Œä¹Ÿå¾ˆå¸¸è§ï¼Œæ¯”å¦‚ JdbcTemplateã€‚å®ƒå®šä¹‰äº†æ•°æ®åº“æ“ä½œçš„åŸºæœ¬æµç¨‹ï¼šè·å–è¿æ¥ã€æ‰§è¡Œ SQLã€å¤„ç†ç»“æœã€å…³é—­è¿æ¥ï¼Œä½†æ˜¯å…·ä½“çš„ SQL è¯­å¥å’Œç»“æœå¤„ç†é€»è¾‘ç”±æˆ‘ä»¬æ¥å®ç°ã€‚

![æŠ€æœ¯æ´¾æºç ï¼šJdbcTemplate](https://cdn.tobebetterjavaer.com/stutymore/spring-20250618114035.png)

è§‚å¯Ÿè€…æ¨¡å¼åœ¨ Spring çš„äº‹ä»¶æœºåˆ¶ä¸­æœ‰æ‰€ä½“ç°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ ApplicationEvent å’Œ ApplicationListener æ¥å®ç°äº‹ä»¶çš„å‘å¸ƒå’Œç›‘å¬ã€‚æ¯”å¦‚ç”¨æˆ·æ³¨å†ŒæˆåŠŸåï¼Œæˆ‘ä»¬å¯ä»¥å‘å¸ƒä¸€ä¸ªç”¨æˆ·æ³¨å†Œäº‹ä»¶ï¼Œç„¶åæœ‰å¤šä¸ªç›‘å¬å™¨æ¥å¤„ç†åç»­çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚å‘é€é‚®ä»¶ã€è®°å½•æ—¥å¿—ç­‰ã€‚

![æŠ€æœ¯æ´¾æºç ï¼šApplicationListener](https://cdn.tobebetterjavaer.com/stutymore/spring-20250618114211.png)

è¿™äº›è®¾è®¡æ¨¡å¼çš„åº”ç”¨è®© Spring æ¡†æ¶æ—¢çµæ´»åˆå¼ºå¤§ï¼Œä¹Ÿè®©æˆ‘åœ¨å®é™…çš„å¼€å‘ä¸­å­¦åˆ°å¾ˆå¤šç»å…¸çš„è®¾è®¡æ€æƒ³ã€‚

#### Springå¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼ï¼Ÿ

ä¼ ç»Ÿçš„å•ä¾‹æ¨¡å¼æ˜¯åœ¨ç±»çš„å†…éƒ¨æ§åˆ¶åªèƒ½åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œæ¯”å¦‚ç”¨ private æ„é€ æ–¹æ³•åŠ  `static getInstance()` è¿™ç§æ–¹å¼ã€‚ä½†æ˜¯ Spring çš„å•ä¾‹æ˜¯å®¹å™¨çº§åˆ«çš„ï¼ŒåŒä¸€ä¸ª Bean åœ¨æ•´ä¸ª Spring å®¹å™¨ä¸­åªä¼šæœ‰ä¸€ä¸ªå®ä¾‹ã€‚

å…·ä½“çš„å®ç°æœºåˆ¶æ˜¯è¿™æ ·çš„ï¼šSpring åœ¨å¯åŠ¨çš„æ—¶å€™ä¼šæŠŠæ‰€æœ‰çš„ Bean å®šä¹‰ä¿¡æ¯åŠ è½½è¿›æ¥ï¼Œç„¶ååœ¨ DefaultSingletonBeanRegistry è¿™ä¸ªç±»é‡Œé¢ç»´æŠ¤äº†ä¸€ä¸ªå« singletonObjects çš„ ConcurrentHashMapï¼Œè¿™ä¸ª Map å°±æ˜¯ç”¨æ¥å­˜å‚¨å•ä¾‹ Bean çš„ã€‚key æ˜¯ Bean çš„åç§°ï¼Œvalue å°±æ˜¯ Bean çš„å®ä¾‹å¯¹è±¡ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šDefaultSingletonBeanRegistry](https://cdn.tobebetterjavaer.com/stutymore/spring-20250618115033.png)

å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡è·å–æŸä¸ª Bean çš„æ—¶å€™ï¼ŒSpring ä¼šå…ˆæ£€æŸ¥ singletonObjects è¿™ä¸ª Map é‡Œé¢æœ‰æ²¡æœ‰è¿™ä¸ª Beanï¼Œå¦‚æœæ²¡æœ‰å°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œç„¶åæ”¾åˆ° Map é‡Œé¢ã€‚åé¢å†è·å–åŒä¸€ä¸ª Bean çš„æ—¶å€™ï¼Œç›´æ¥ä» Map é‡Œé¢å–å°±è¡Œäº†ï¼Œè¿™æ ·å°±ä¿è¯äº†å•ä¾‹ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šregisterSingleton](https://cdn.tobebetterjavaer.com/stutymore/spring-20250618115153.png)

è¿˜æœ‰ä¸€ä¸ªç»†èŠ‚å°±æ˜¯ Spring ä¸ºäº†è§£å†³å¾ªç¯ä¾èµ–çš„é—®é¢˜ï¼Œè¿˜ç”¨äº†ä¸‰çº§ç¼“å­˜ã€‚é™¤äº† singletonObjects è¿™ä¸ªä¸€çº§ç¼“å­˜ï¼Œè¿˜æœ‰ earlySingletonObjects äºŒçº§ç¼“å­˜å’Œ singletonFactories ä¸‰çº§ç¼“å­˜ã€‚è¿™æ ·å³ä½¿æœ‰å¾ªç¯ä¾èµ–ï¼ŒSpring ä¹Ÿèƒ½æ­£ç¡®å¤„ç†ã€‚

è€Œä¸” Spring çš„å•ä¾‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºç”¨çš„æ˜¯ ConcurrentHashMapï¼Œå¤šçº¿ç¨‹è®¿é—®ä¸ä¼šæœ‰é—®é¢˜ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„æºç¨‹é¢ç»åŒå­¦ 10 Java æš‘æœŸå®ä¹ ä¸€é¢é¢è¯•åŸé¢˜ï¼šSpring IoC çš„è®¾è®¡æ¨¡å¼ï¼ŒAOP çš„è®¾è®¡æ¨¡å¼
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°å…¬å¸é¢ç»åˆé›†åŒå­¦ 1 Java åç«¯é¢è¯•åŸé¢˜ï¼šSpring æ¡†æ¶ä½¿ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼ï¼Ÿ
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„åŒå­¦ 1 è´å£³æ‰¾æˆ¿åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šSpringç”¨äº†ä»€ä¹ˆè®¾è®¡æ¨¡å¼ï¼Ÿ
> 4. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¿«æ‰‹åŒå­¦ 4 ä¸€é¢åŸé¢˜ï¼šSpringä¸­ä½¿ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Œä»¥å…¶ä¸­ä¸€ç§æ¨¡å¼ä¸¾ä¾‹è¯´æ˜ï¼ŸSpringå¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼ï¼Ÿ

memoï¼š2025 å¹´ 6 æœˆ 20 æ—¥ä¿®æ”¹è‡³æ­¤ï¼Œä»Šå¤©[å¸®çƒå‹ä¿®æ”¹ç®€å†](https://javabetter.cn/zhishixingqiu/jianli.html)çš„æ—¶å€™ï¼Œæœ‰ç¢°åˆ°é‡åº†é‚®ç”µå¤§å­¦æœ¬ï¼Œç”µå­ç§‘æŠ€å¤§å­¦ç¡•çš„çƒå‹ï¼ŒæœŸé—´è¿˜æœ‰è¿‡æ¸…åå¤§å­¦ç§‘ç ”é¡¹ç›®çš„ç»å†ï¼ŒåŸºæœ¬ä¸Šä¹Ÿæ˜¯æŠŠå­¦å†è¿™å—æ‹‰çš„æ»¡ä¸­æ»¡äº†ï¼Œé‚£å¸Œæœ›æ˜Ÿçƒèƒ½å¸®åŠ©åˆ°æ›´å¤šé™¢æ ¡çš„åŒå­¦ï¼Œä¸ç®¡æ˜¯å·¥ä½œå…šè¿˜æ˜¯å­¦ç”Ÿå…šï¼Œéƒ½å¸Œæœ›å¤§å®¶éƒ½æ‹¿åˆ°æ›´å¥½çš„ offerã€‚

![é‡é‚®æœ¬ï¼Œç”µå­ç§‘æŠ€å¤§å­¦ç¡•çš„çƒå‹](https://cdn.tobebetterjavaer.com/stutymore/spring-20250621062819.png)

### 5.Springå®¹å™¨å’ŒWebå®¹å™¨ä¹‹é—´çš„åŒºåˆ«çŸ¥é“å—ï¼Ÿï¼ˆè¡¥å……ï¼‰

>2024 å¹´ 7 æœˆ 11 æ—¥å¢è¡¥

é¦–å…ˆä»æ¦‚å¿µä¸Šæ¥è¯´ï¼ŒSpring å®¹å™¨æ˜¯ä¸€ä¸ª IoC å®¹å™¨ï¼Œä¸»è¦è´Ÿè´£ç®¡ç† Java å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œä¾èµ–å…³ç³»ã€‚è€Œ Web å®¹å™¨ï¼Œæ¯”å¦‚ Tomcatã€Jetty è¿™äº›ï¼Œæ˜¯ç”¨æ¥è¿è¡Œ Web åº”ç”¨çš„å®¹å™¨ï¼Œè´Ÿè´£å¤„ç† HTTP è¯·æ±‚å’Œå“åº”ï¼Œç®¡ç† Servlet çš„ç”Ÿå‘½å‘¨æœŸã€‚

```java
/**
 * SpringUtil.java
 * ç”¨äºè·å– Spring å®¹å™¨ä¸­çš„ Beanï¼ŒæŠ€æœ¯æ´¾æºç ï¼šhttps://github.com/itwanger/paicoding
 */
@Component
public class SpringUtil implements ApplicationContextAware {
    private volatile static ApplicationContext context;
    
    @Override
    public void setApplicationContext(ApplicationContext applicationContext) {
        SpringUtil.context = applicationContext;
    }
    
    public static <T> T getBean(Class<T> bean) {
        return context.getBean(bean);
    }
}
```

ä»åŠŸèƒ½ä¸Šçœ‹ï¼ŒSpring å®¹å™¨ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å±‚é¢çš„å¯¹è±¡ç®¡ç†ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„ Serviceã€Daoã€Controller è¿™äº› Bean éƒ½æ˜¯ç”± Spring å®¹å™¨æ¥åˆ›å»ºå’Œç®¡ç†çš„ã€‚è€Œ Web å®¹å™¨ä¸»è¦å¤„ç†ç½‘ç»œé€šä¿¡ï¼Œæ¯”å¦‚æ¥æ”¶ HTTP è¯·æ±‚ã€è§£æè¯·æ±‚å‚æ•°ã€è°ƒç”¨ç›¸åº”çš„ Servletï¼Œç„¶åæŠŠå“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

![åšå®¢å›­ hiy1995ï¼šweb å®¹å™¨](https://cdn.tobebetterjavaer.com/stutymore/spring-20250621063345.png)

åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¿™ä¸¤ä¸ªå®¹å™¨æ˜¯ç›¸è¾…ç›¸æˆçš„ã€‚æˆ‘ä»¬çš„ Web é¡¹ç›®éƒ¨ç½²åœ¨ Tomcat ä¸Šçš„æ—¶å€™ï¼ŒTomcat ä¼šè´Ÿè´£æ¥æ”¶ HTTP è¯·æ±‚ï¼Œç„¶åæŠŠè¯·æ±‚äº¤ç»™ DispatcherServlet å¤„ç†ï¼Œè€Œ DispatcherServlet åˆä¼šå» Spring å®¹å™¨ä¸­æŸ¥æ‰¾ç›¸åº”çš„ Controller æ¥å¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚

```java
/**
 * GlobalViewInterceptor.java
 * ç”¨äºå…¨å±€æ‹¦æˆªå™¨ï¼ŒæŠ€æœ¯æ´¾æºç ï¼šhttps://github.com/itwanger/paicoding
 */
@Component
public class GlobalViewInterceptor implements HandlerInterceptor {
    @Autowired
    private GlobalInitService globalInitService;
    
    @Override
    public boolean preHandle(HttpServletRequest request, 
                           HttpServletResponse response, 
                           Object handler) {
        // Web å®¹å™¨çš„ HTTP è¯·æ±‚ + Spring å®¹å™¨çš„ä¸šåŠ¡æœåŠ¡
    }
}
```

è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„åŒºåˆ«æ˜¯ç”Ÿå‘½å‘¨æœŸã€‚Web å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸè·Ÿ Web åº”ç”¨ç¨‹åºçš„éƒ¨ç½²å’Œå¸è½½ç›¸å…³ï¼Œè€Œ Spring å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸæ˜¯åœ¨ Web åº”ç”¨å¯åŠ¨çš„æ—¶å€™åˆå§‹åŒ–ï¼Œåº”ç”¨å…³é—­çš„æ—¶å€™é”€æ¯ã€‚

ç°åœ¨æˆ‘ä»¬éƒ½ç”¨ Spring Boot äº†ï¼ŒSpring Boot å†…ç½®äº† Tomcatï¼ŒæŠŠ Web å®¹å™¨å’Œ Spring å®¹å™¨éƒ½æ•´åˆåœ¨ä¸€èµ·äº†ï¼Œæˆ‘ä»¬åªéœ€è¦è¿è¡Œä¸€ä¸ª jar åŒ…å°±å¯ä»¥äº†ã€‚

```java
@SpringBootApplication
public class QuickForumApplication {
    public static void main(String[] args) {
        SpringApplication.run(QuickForumApplication.class, args);
    }
}
```

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å»å“ªå„¿åŒå­¦ 1 æŠ€æœ¯äºŒé¢åŸé¢˜ï¼šspringçš„å®¹å™¨ã€webå®¹å™¨ã€springmvcçš„å®¹å™¨ä¹‹é—´çš„åŒºåˆ«

<MZNXQRcodeBanner />

memoï¼š2024 å¹´ 7 æœˆ 11 æ—¥ä¿®æ”¹è‡³æ­¤ï¼Œä»Šå¤©åœ¨å¸®[çƒå‹ä»¬ä¿®æ”¹ç®€å†](https://javabetter.cn/zhishixingqiu/jianli.html)çš„æ—¶å€™ï¼Œç¢°åˆ°åŒ—äº¬äº¤é€šå¤§å­¦æœ¬ï¼ŒåŒ—äº¬èˆªç©ºèˆªå¤©å¤§å­¦ç¡•çš„çƒå‹ï¼Œå¥¹çš„ç®€å†ä¸Šæœ‰å¾ˆå¤šæ ¡å›­è£èª‰å¥–é¡¹ï¼Œåƒä¼˜ç§€å­¦ç”Ÿã€å¥–å­¦é‡‘ã€è‹±è¯­å››å…­çº§ç­‰ï¼Œè¿™äº›éƒ½æ˜¯éå¸¸å¥½çš„åŠ åˆ†é¡¹ã€‚

![åŒ—äº¬äº¤é€šå¤§å­¦æœ¬ï¼ŒåŒ—äº¬èˆªç©ºèˆªå¤©å¤§å­¦ç¡•çš„çƒå‹](https://cdn.tobebetterjavaer.com/stutymore/spring-20250621064205.png)

## IoC

### 6.ğŸŒŸè¯´ä¸€è¯´ä»€ä¹ˆæ˜¯IoCï¼Ÿ

æ¨èé˜…è¯»ï¼š[IoC æ‰«ç›²](https://javabetter.cn/springboot/ioc.html)

IoC çš„å…¨ç§°æ˜¯ Inversion of Controlï¼Œä¹Ÿå°±æ˜¯æ§åˆ¶åè½¬ã€‚è¿™é‡Œçš„â€œæ§åˆ¶â€æŒ‡çš„æ˜¯å¯¹è±¡åˆ›å»ºå’Œä¾èµ–å…³ç³»ç®¡ç†çš„æ§åˆ¶æƒã€‚

![å›¾ç‰‡æ¥æºäºç½‘ç»œï¼šIoC](https://cdn.tobebetterjavaer.com/stutymore/spring-20240310191630.png)

ä»¥å‰æˆ‘ä»¬å†™ä»£ç çš„æ—¶å€™ï¼Œå¦‚æœ A ç±»éœ€è¦ç”¨åˆ° B ç±»ï¼Œæˆ‘ä»¬å°±åœ¨ A ç±»é‡Œé¢ç›´æ¥ new ä¸€ä¸ª B å¯¹è±¡å‡ºæ¥ï¼Œè¿™æ · A ç±»å°±æ§åˆ¶äº† B ç±»å¯¹è±¡çš„åˆ›å»ºã€‚

```java
// ä¼ ç»Ÿæ–¹å¼ï¼šå¯¹è±¡ä¸»åŠ¨åˆ›å»ºä¾èµ–
public class UserService {
    private UserDao userDao;
    
    public UserService() {
        // ä¸»åŠ¨åˆ›å»ºä¾èµ–å¯¹è±¡
        this.userDao = new UserDaoImpl();
    }
}
```

æœ‰äº† IoC ä¹‹åï¼Œè¿™ä¸ªæ§åˆ¶æƒå°±â€œåè½¬â€äº†ï¼Œä¸å†ç”± A ç±»æ¥æ§åˆ¶ B å¯¹è±¡çš„åˆ›å»ºï¼Œè€Œæ˜¯äº¤ç»™å¤–éƒ¨çš„å®¹å™¨æ¥ç®¡ç†ã€‚

```java
/** 
 * ä½¿ç”¨ Spring IoC å®¹å™¨æ¥ç®¡ç† UserDao çš„åˆ›å»ºå’Œæ³¨å…¥
 * æŠ€æœ¯æ´¾æºç ï¼šhttps://github.com/itwanger/paicoding
 */
@Service
public class UserServiceImpl implements UserService {
    @Autowired
    private UserDao userDao;
    
    // ä¸éœ€è¦ä¸»åŠ¨åˆ›å»º UserDaoï¼Œç”± Spring å®¹å™¨æ³¨å…¥
    public BaseUserInfoDTO getAndUpdateUserIpInfoBySessionId(String session, String clientIp) {
        // ç›´æ¥ä½¿ç”¨æ³¨å…¥çš„ userDao
        return userDao.getBySessionId(session);
    }
}
```

----è¿™éƒ¨åˆ†é¢è¯•ä¸­å¯ä»¥ä¸èƒŒ start----

æ²¡æœ‰ IoC ä¹‹å‰ï¼š

>æˆ‘éœ€è¦ä¸€ä¸ªå¥³æœ‹å‹ï¼Œåˆšå¥½å¤§è¡—ä¸Šçªç„¶çœ‹åˆ°äº†ä¸€ä¸ªå°å§å§ï¼Œäººå¾ˆå¥½çœ‹ï¼Œäºæ˜¯æˆ‘å°±è‡ªå·±ä¸»åŠ¨ä¸Šå»æ­è®ªï¼Œè¦å¥¹çš„å¾®ä¿¡å·ï¼Œæ‰¾æœºä¼šèŠå¤©å…³å¿ƒå¥¹ï¼Œç„¶åçº¦å¥¹å‡ºæ¥åƒé¥­ï¼Œæ‰“å¬å¥¹çš„çˆ±å¥½ï¼Œä¸‰è§‚ã€‚ã€‚ã€‚


æœ‰äº† IoC ä¹‹åï¼š

>æˆ‘éœ€è¦ä¸€ä¸ªå¥³æœ‹å‹ï¼Œäºæ˜¯æˆ‘å°±å»æ‰¾å©šä»‹æ‰€ï¼Œå‘Šè¯‰å©šä»‹æ‰€ï¼Œæˆ‘éœ€è¦ä¸€ä¸ªé•¿çš„åƒèµµéœ²æ€çš„ï¼Œä¼šæ‰“ Dota2 çš„ï¼Œäºæ˜¯å©šä»‹æ‰€åœ¨å®ƒçš„äººæ‰åº“é‡Œå¼€å§‹æ‰¾ï¼Œæ‰¾ä¸åˆ°å®ƒå°±ç›´æ¥è¯´æ²¡æœ‰ï¼Œæ‰¾åˆ°å®ƒå°±ç›´æ¥ä»‹ç»ç»™æˆ‘ã€‚

å©šä»‹æ‰€å°±ç›¸å½“äºä¸€ä¸ª IoC å®¹å™¨ï¼Œæˆ‘å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘éœ€è¦çš„å¥³æœ‹å‹å°±æ˜¯å¦ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä¸ç”¨å…³å¿ƒå¥³æœ‹å‹æ˜¯æ€ä¹ˆæ¥çš„ï¼Œæˆ‘åªéœ€è¦å‘Šè¯‰å©šä»‹æ‰€æˆ‘éœ€è¦ä»€ä¹ˆæ ·çš„å¥³æœ‹å‹ï¼Œå©šä»‹æ‰€å°±å¸®æˆ‘å»æ‰¾ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå¼•å…¥IoCä¹‹å‰å’Œå¼•å…¥IoCä¹‹å](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-619da277-c15e-4dd7-9f2b-dbd809a9aaa0.png)

----è¿™éƒ¨åˆ†é¢è¯•ä¸­å¯ä»¥ä¸èƒŒ end----

#### DIå’ŒIoCçš„åŒºåˆ«äº†è§£å—ï¼Ÿ

IoC çš„æ€æƒ³æ˜¯æŠŠå¯¹è±¡åˆ›å»ºå’Œä¾èµ–å…³ç³»çš„æ§åˆ¶æƒç”±ä¸šåŠ¡ä»£ç è½¬ç§»ç»™ Spring å®¹å™¨ã€‚è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒæŠ½è±¡çš„æ¦‚å¿µï¼Œå‘Šè¯‰æˆ‘ä»¬åº”è¯¥æ€ä¹ˆå»è®¾è®¡ç³»ç»Ÿæ¶æ„ã€‚

![Martin Fowlerâ€™s Definition](https://cdn.tobebetterjavaer.com/stutymore/spring-20241117132929.png)

è€Œ DIï¼Œä¹Ÿå°±æ˜¯ä¾èµ–æ³¨å…¥ï¼Œå®ƒæ˜¯å®ç° IoC è¿™ç§æ€æƒ³çš„å…·ä½“æŠ€æœ¯æ‰‹æ®µã€‚åœ¨ Spring é‡Œï¼Œæˆ‘ä»¬ç”¨ `@Autowired` æ³¨è§£å°±æ˜¯åœ¨ä½¿ç”¨ DI çš„å­—æ®µæ³¨å…¥æ–¹å¼ã€‚

```java
@Service
public class ArticleReadServiceImpl implements ArticleReadService {
    @Autowired
    private ArticleDao articleDao;  // å­—æ®µæ³¨å…¥
    
    @Autowired
    private UserDao userDao;
}
```

ä»å®ç°è§’åº¦æ¥çœ‹ï¼ŒDI é™¤äº†å­—æ®µæ³¨å…¥ï¼Œè¿˜æœ‰æ„é€ æ–¹æ³•æ³¨å…¥å’Œ Setter æ–¹æ³•æ³¨å…¥ç­‰æ–¹å¼ã€‚åœ¨åš[æŠ€æœ¯æ´¾](https://javabetter.cn/zhishixingqiu/paicoding.html)é¡¹ç›®çš„æ—¶å€™ï¼Œæˆ‘å°±å°è¯•è¿‡æ„é€ æ–¹æ³•æ³¨å…¥çš„æ–¹å¼ã€‚

![æŠ€æœ¯æ´¾æºç ï¼šæ„é€ æ–¹æ³•çš„æ³¨å…¥æ–¹å¼](https://cdn.tobebetterjavaer.com/stutymore/spring-20250622091928.png)

å½“ç„¶äº†ï¼ŒDI å¹¶ä¸æ˜¯å®ç° IoC çš„å”¯ä¸€æ–¹å¼ï¼Œè¿˜æœ‰ Service Locator æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡å®ç° ApplicationContextAware æ¥å£æ¥è·å– Spring å®¹å™¨ä¸­çš„ Beanã€‚

![æŠ€æœ¯æ´¾æºç ï¼šIoC çš„Service Locator æ¨¡å¼](https://cdn.tobebetterjavaer.com/stutymore/spring-20250622093007.png)

ä¹‹æ‰€ä»¥ ID åæˆä¸º IoC çš„é¦–é€‰å®ç°æ–¹å¼ï¼Œæ˜¯å› ä¸ºä»£ç æ›´æ¸…æ™°ã€å¯è¯»æ€§æ›´é«˜ã€‚

```
IoCï¼ˆæ§åˆ¶åè½¬ï¼‰
â”œâ”€â”€ DIï¼ˆä¾èµ–æ³¨å…¥ï¼‰          â† ä¸»è¦å®ç°æ–¹å¼
â”‚   â”œâ”€â”€ æ„é€ å™¨æ³¨å…¥
â”‚   â”œâ”€â”€ å­—æ®µæ³¨å…¥
â”‚   â””â”€â”€ Setteræ³¨å…¥
â”œâ”€â”€ æœåŠ¡å®šä½å™¨æ¨¡å¼
â”œâ”€â”€ å·¥å‚æ¨¡å¼
â””â”€â”€ å…¶ä»–å®ç°æ–¹å¼
```

#### ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ IoC å‘¢ï¼Ÿ

åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å®ç°æŸä¸€ä¸ªåŠŸèƒ½ï¼Œå¯èƒ½è‡³å°‘éœ€è¦ä¸¤ä¸ªä»¥ä¸Šçš„å¯¹è±¡æ¥ååŠ©å®Œæˆï¼Œåœ¨æ²¡æœ‰ Spring ä¹‹å‰ï¼Œæ¯ä¸ªå¯¹è±¡åœ¨éœ€è¦å®ƒçš„åˆä½œå¯¹è±¡æ—¶ï¼Œéœ€è¦è‡ªå·± new ä¸€ä¸ªï¼Œæ¯”å¦‚è¯´ A è¦ä½¿ç”¨ Bï¼ŒA å°±å¯¹ B äº§ç”Ÿäº†ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯ A å’Œ B ä¹‹é—´å­˜åœ¨äº†ä¸€ç§è€¦åˆå…³ç³»ã€‚

```java
// ä¼ ç»Ÿæ–¹å¼ï¼šå¯¹è±¡è‡ªå·±åˆ›å»ºä¾èµ–
public class UserService {
    private UserDao userDao = new UserDaoImpl(); // ç¡¬ç¼–ç ä¾èµ–
    
    public User getUser(Long id) {
        return userDao.findById(id);
    }
}
```

æœ‰äº† Spring ä¹‹åï¼Œåˆ›å»º B çš„å·¥ä½œäº¤ç»™äº† Spring æ¥å®Œæˆï¼ŒSpring åˆ›å»ºå¥½äº† B å¯¹è±¡åå°±æ”¾åˆ°å®¹å™¨ä¸­ï¼ŒA å‘Šè¯‰ Spring æˆ‘éœ€è¦ Bï¼ŒSpring å°±ä»å®¹å™¨ä¸­å–å‡º B äº¤ç»™ A æ¥ä½¿ç”¨ã€‚

```java
// IoC æ–¹å¼ï¼šä¾èµ–ç”±å¤–éƒ¨æ³¨å…¥
@Service
public class UserServiceImpl implements UserService {
    @Autowired
    private UserDao userDao; // ä¾èµ–æ³¨å…¥ï¼Œä¸å…³å¿ƒå…·ä½“å®ç°
    
    public User getUser(Long id) {
        return userDao.findById(id);
    }
}
```

è‡³äº B æ˜¯æ€ä¹ˆæ¥çš„ï¼ŒA å°±ä¸å†å…³å¿ƒäº†ï¼ŒSpring å®¹å™¨æƒ³é€šè¿‡ newnew åˆ›å»º B è¿˜æ˜¯ new åˆ›å»º Bï¼Œæ— æ‰€è°“ã€‚

è¿™å°±æ˜¯ IoC çš„å¥½å¤„ï¼Œå®ƒé™ä½äº†å¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦ï¼Œè®©æ¯ä¸ªå¯¹è±¡åªå…³æ³¨è‡ªå·±çš„ä¸šåŠ¡å®ç°ï¼Œä¸å…³å¿ƒå…¶ä»–å¯¹è±¡æ˜¯æ€ä¹ˆåˆ›å»ºçš„ã€‚

æ¨èé˜…è¯»ï¼š[å­¤å‚²è‹ç‹¼ï¼šè°ˆè°ˆå¯¹ Spring IOC çš„ç†è§£](https://www.cnblogs.com/xdp-gacl/p/4249939.html)

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³ 25 å±Šæ—¥å¸¸å®ä¹ ä¸€é¢åŸé¢˜ï¼šè¯´è¯´ä½ å¯¹ AOP å’Œ IoC çš„ç†è§£ã€‚
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°å…¬å¸é¢ç»åˆé›†åŒå­¦ 1 Java åç«¯é¢è¯•åŸé¢˜ï¼šä»‹ç» Spring IoC å’Œ AOP?
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„æ‹›å•†é“¶è¡Œé¢ç»åŒå­¦ 6 æ‹›é“¶ç½‘ç»œç§‘æŠ€é¢è¯•åŸé¢˜ï¼šSpringBootæ¡†æ¶çš„AOPã€IOC/DIï¼Ÿ
> 4. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 8 é¢è¯•åŸé¢˜ï¼šIOCï¼ŒAOP
> 5. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¿«æ‰‹åŒå­¦ 4 ä¸€é¢åŸé¢˜ï¼šè§£é‡Šä¸‹ä»€ä¹ˆæ˜¯IOCå’ŒAOPï¼Ÿåˆ†åˆ«è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼ŸIOCå’ŒDIçš„åŒºåˆ«ï¼Ÿ

memoï¼š2025 å¹´ 6 æœˆ 22 æ—¥ä¿®æ”¹è‡³æ­¤ï¼Œä»Šå¤©[æœ‰çƒå‹å‘å–œæŠ¥è¯´æ‹¿åˆ°äº†ä¸¤ä¸ª offer](https://javabetter.cn/zhishixingqiu/)ï¼Œä¸€ä¸ªæ˜¯åš B ç«¯ç”µå•†çš„ï¼Œå¦ä¸€ä¸ªæ˜¯å¤–ä¼ï¼Œä¸»è¦åš Power BI çš„ä½ä»£ç å¼€å‘ï¼Œæˆ‘çš„å»ºè®®æ˜¯å»å¤–ä¼ï¼Œå› ä¸ºå®ä¹ æœ€é‡è¦çš„æ˜¯æ··ä¸ª titleï¼Œæœ‰æ›´å¤šçš„æ—¶é—´ï¼Œå¯ä»¥å»å­¦ä¹ æ˜Ÿçƒé‡Œçš„é¡¹ç›®ï¼Œå…¶å®ä¼šæ›´å®åœ¨ã€‚

![çƒå‹æ‹¿åˆ°äº†å¤–ä¼å’Œç”µå•†çš„ offer](https://cdn.tobebetterjavaer.com/stutymore/spring-äºŒå“¥ï¼Œç›®å‰æ‹¿åˆ°äº†ä¸¤ä¸ªofferã€‚ç¬¬ä¸€ä¸ªæ˜¯åšbç«¯ç”µ.png)

### 7.èƒ½è¯´ä¸€ä¸‹IoCçš„å®ç°æœºåˆ¶å—ï¼Ÿ

å¥½çš„ï¼ŒSpring IoC çš„å®ç°æœºåˆ¶è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œæˆ‘å°½é‡ç”¨æ¯”è¾ƒé€šä¿—çš„æ–¹å¼æ¥è§£é‡Šä¸€ä¸‹æ•´ä¸ªæµç¨‹ã€‚

![é¢æ¸£é€†è¢­ï¼šminiç‰ˆæœ¬Spring IoC](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-1d55c63d-2d12-43b1-9f43-428f5f4a1413.png)


ç¬¬ä¸€æ­¥æ˜¯åŠ è½½ Bean çš„å®šä¹‰ä¿¡æ¯ã€‚Spring ä¼šæ‰«ææˆ‘ä»¬é…ç½®çš„åŒ…è·¯å¾„ï¼Œæ‰¾åˆ°æ‰€æœ‰æ ‡æ³¨äº† `@Component`ã€`@Service`ã€`@Repository` è¿™äº›æ³¨è§£çš„ç±»ï¼Œç„¶åæŠŠè¿™äº›ç±»çš„å…ƒä¿¡æ¯å°è£…æˆ BeanDefinition å¯¹è±¡ã€‚

```java
// Beanå®šä¹‰ä¿¡æ¯
public class BeanDefinition {
    private String beanClassName;     // ç±»å
    private String scope;            // ä½œç”¨åŸŸ
    private boolean lazyInit;        // æ˜¯å¦æ‡’åŠ è½½
    private String[] dependsOn;      // ä¾èµ–çš„Bean
    private ConstructorArgumentValues constructorArgumentValues; // æ„é€ å‚æ•°
    private MutablePropertyValues propertyValues; // å±æ€§å€¼
}
```

ç¬¬äºŒæ­¥æ˜¯ Bean å·¥å‚çš„å‡†å¤‡ã€‚Spring ä¼šåˆ›å»ºä¸€ä¸ª DefaultListableBeanFactory ä½œä¸º Bean å·¥å‚æ¥è´Ÿè´£ Bean çš„åˆ›å»ºå’Œç®¡ç†ã€‚

![æŠ€æœ¯æ´¾æºç ï¼šDefaultListableBeanFactory](https://cdn.tobebetterjavaer.com/stutymore/spring-20250623094742.png)

ç¬¬ä¸‰æ­¥æ˜¯ Bean çš„å®ä¾‹åŒ–å’Œåˆå§‹åŒ–ã€‚è¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼ŒSpring ä¼šæ ¹æ® BeanDefinition æ¥åˆ›å»º Bean å®ä¾‹ã€‚

![IoCçš„å®ç°æœºåˆ¶](https://cdn.tobebetterjavaer.com/stutymore/spring-20250623101221.png)

å¯¹äºå•ä¾‹ Beanï¼ŒSpring ä¼šå…ˆæ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨å°±åˆ›å»ºæ–°å®ä¾‹ã€‚åˆ›å»ºå®ä¾‹çš„æ—¶å€™ä¼šé€šè¿‡åå°„è°ƒç”¨æ„é€ æ–¹æ³•ï¼Œç„¶åè¿›è¡Œå±æ€§æ³¨å…¥ï¼Œæœ€åæ‰§è¡Œåˆå§‹åŒ–å›è°ƒæ–¹æ³•ã€‚

```java
// ç®€åŒ–çš„Beanåˆ›å»ºæµç¨‹
public class AbstractBeanFactory {
    
    protected Object createBean(String beanName, BeanDefinition bd) {
        // 1. å®ä¾‹åŒ–å‰å¤„ç†
        Object bean = resolveBeforeInstantiation(beanName, bd);
        if (bean != null) {
            return bean;
        }
        
        // 2. å®é™…åˆ›å»ºBean
        return doCreateBean(beanName, bd);
    }
    
    protected Object doCreateBean(String beanName, BeanDefinition bd) {
        // 2.1 å®ä¾‹åŒ–
        Object bean = createBeanInstance(beanName, bd);
        
        // 2.2 å±æ€§å¡«å……ï¼ˆä¾èµ–æ³¨å…¥ï¼‰
        populateBean(beanName, bd, bean);
        
        // 2.3 åˆå§‹åŒ–
        Object exposedObject = initializeBean(beanName, bean, bd);
        
        return exposedObject;
    }
}
```

ä¾èµ–æ³¨å…¥çš„å®ç°ä¸»è¦æ˜¯é€šè¿‡åå°„æ¥å®Œæˆçš„ã€‚æ¯”å¦‚æˆ‘ä»¬ç”¨ `@Autowired` æ ‡æ³¨äº†ä¸€ä¸ªå­—æ®µï¼ŒSpring åœ¨åˆ›å»º Bean çš„æ—¶å€™ä¼šæ‰«æè¿™ä¸ªå­—æ®µï¼Œç„¶åä»å®¹å™¨ä¸­æ‰¾åˆ°å¯¹åº”ç±»å‹çš„ Beanï¼Œé€šè¿‡åå°„çš„æ–¹å¼è®¾ç½®åˆ°è¿™ä¸ªå­—æ®µä¸Šã€‚

![è´°å¸ˆå…„çš„å± å®°åœºï¼šå„ä¸ªæ³¨è§£çš„æ³¨å…¥æµç¨‹](https://cdn.tobebetterjavaer.com/stutymore/spring-20250628110426.png)

#### ä½ æ˜¯æ€ä¹ˆç†è§£ Spring IoC çš„ï¼Ÿ

IoC æœ¬è´¨ä¸Šä¸€ä¸ªè¶…çº§å·¥å‚ï¼Œè¿™ä¸ªå·¥å‚çš„äº§å“å°±æ˜¯å„ç§ Bean å¯¹è±¡ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå·¥å‚è¿è¡Œ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-7678c40f-a48d-4bd5-80f8-e902ad688e11.png)

æˆ‘ä»¬é€šè¿‡ `@Component`ã€`@Service` è¿™äº›æ³¨è§£å‘Šè¯‰å·¥å‚ï¼šâ€œæˆ‘è¦ç”Ÿäº§ä»€ä¹ˆæ ·çš„äº§å“ï¼Œè¿™ä¸ªäº§å“æœ‰ä»€ä¹ˆç‰¹æ€§ï¼Œéœ€è¦ä»€ä¹ˆåŸææ–™â€ã€‚

ç„¶åå·¥å‚é‡Œå„ç§ç”Ÿäº§çº¿ï¼Œåœ¨ Spring ä¸­å°±æ˜¯å„ç§ BeanPostProcessorã€‚æ¯”å¦‚ `AutowiredAnnotationBeanPostProcessor` ä¸“é—¨è´Ÿè´£å¤„ç† `@Autowired` æ³¨è§£ã€‚

å·¥å‚é‡Œè¿˜æœ‰å„ç§ç¼“å­˜æœºåˆ¶ç”¨æ¥å­˜æ”¾äº§å“ï¼Œæ¯”å¦‚è¯´ singletonObjects æ˜¯æˆå“ä»“åº“ï¼Œå­˜æ”¾å®Œå·¥çš„å•ä¾‹ Beanï¼›earlySingletonObjects æ˜¯åŠæˆå“ä»“åº“ï¼Œç”¨æ¥è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ã€‚

```java
// Springå•ä¾‹Beanæ³¨å†Œè¡¨
public class DefaultSingletonBeanRegistry {
    // ä¸€çº§ç¼“å­˜ï¼šå®Œæˆåˆå§‹åŒ–çš„å•ä¾‹Bean
    private final Map<String, Object> singletonObjects = new ConcurrentHashMap<>(256);
    
    // äºŒçº§ç¼“å­˜ï¼šæ—©æœŸæš´éœ²çš„å•ä¾‹Beanï¼ˆè§£å†³å¾ªç¯ä¾èµ–ï¼‰
    private final Map<String, Object> earlySingletonObjects = new HashMap<>(16);
    
    // ä¸‰çº§ç¼“å­˜ï¼šå•ä¾‹Beanå·¥å‚
    private final Map<String, ObjectFactory<?>> singletonFactories = new HashMap<>(16);
    
    public Object getSingleton(String beanName) {
        Object singletonObject = this.singletonObjects.get(beanName);
        if (singletonObject == null) {
            singletonObject = this.earlySingletonObjects.get(beanName);
            if (singletonObject == null) {
                ObjectFactory<?> singletonFactory = this.singletonFactories.get(beanName);
                if (singletonFactory != null) {
                    singletonObject = singletonFactory.getObject();
                    this.earlySingletonObjects.put(beanName, singletonObject);
                    this.singletonFactories.remove(beanName);
                }
            }
        }
        return singletonObject;
    }
}
```

æœ€æœ‰æ„æ€çš„æ˜¯ï¼Œè¿™ä¸ªå·¥å‚è¿˜å¾ˆæ™ºèƒ½ï¼Œå®ƒçŸ¥é“äº§å“ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒä¼šæ ¹æ®ä¾èµ–å…³ç³»æ¥å†³å®š Bean çš„åˆ›å»ºé¡ºåºã€‚å¦‚æœå‘ç°å¾ªç¯ä¾èµ–ï¼Œå®ƒè¿˜ä¼šç”¨ä¸‰çº§ç¼“å­˜æœºåˆ¶æ¥å·§å¦™åœ°è§£å†³ã€‚

#### èƒ½æ‰‹å†™ä¸€ä¸ªç®€å•çš„ IoC å®¹å™¨å—ï¼Ÿ

1ã€é¦–å…ˆå®šä¹‰åŸºç¡€çš„æ³¨è§£ï¼Œæ¯”å¦‚è¯´ `@Component`ã€`@Autowired` ç­‰ã€‚

```java
// ç»„ä»¶æ³¨è§£
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface Component {
}

// è‡ªåŠ¨æ³¨å…¥æ³¨è§£
@Target(ElementType.FIELD)
@Retention(RetentionPolicy.RUNTIME)
public @interface Autowired {
}
```

2ã€æ ¸å¿ƒçš„ IoC å®¹å™¨ç±»ï¼Œè´Ÿè´£æ‰«æåŒ…è·¯å¾„ï¼Œåˆ›å»º Bean å®ä¾‹ï¼Œå¹¶å¤„ç†ä¾èµ–æ³¨å…¥ã€‚

```java
public class SimpleIoC {
    // Beanå®¹å™¨
    private Map<Class<?>, Object> beans = new HashMap<>();
    
    /**
     * æ³¨å†ŒBean
     */
    public void registerBean(Class<?> clazz) {
        try {
            // åˆ›å»ºå®ä¾‹
            Object instance = clazz.getDeclaredConstructor().newInstance();
            beans.put(clazz, instance);
        } catch (Exception e) {
            throw new RuntimeException("åˆ›å»ºBeanå¤±è´¥: " + clazz.getName(), e);
        }
    }
    
    /**
     * è·å–Bean
     */
    @SuppressWarnings("unchecked")
    public <T> T getBean(Class<T> clazz) {
        return (T) beans.get(clazz);
    }
    
    /**
     * ä¾èµ–æ³¨å…¥
     */
    public void inject() {
        for (Object bean : beans.values()) {
            injectFields(bean);
        }
    }
    
    /**
     * å­—æ®µæ³¨å…¥
     */
    private void injectFields(Object bean) {
        Field[] fields = bean.getClass().getDeclaredFields();
        for (Field field : fields) {
            if (field.isAnnotationPresent(Autowired.class)) {
                try {
                    field.setAccessible(true);
                    Object dependency = getBean(field.getType());
                    field.set(bean, dependency);
                } catch (Exception e) {
                    throw new RuntimeException("æ³¨å…¥å¤±è´¥: " + field.getName(), e);
                }
            }
        }
    }
}
```

3ã€ä½¿ç”¨ç¤ºä¾‹ï¼Œå®šä¹‰ä¸€äº› Bean ç±»ï¼Œå¹¶æ³¨å†Œåˆ° IoC å®¹å™¨ä¸­ã€‚

```java
// DAOå±‚
@Component
class UserDao {
    public void save(String user) {
        System.out.println("ä¿å­˜ç”¨æˆ·: " + user);
    }
}

// Serviceå±‚
@Component
class UserService {
    @Autowired
    private UserDao userDao;
    
    public void createUser(String name) {
        userDao.save(name);
        System.out.println("ç”¨æˆ·åˆ›å»ºå®Œæˆ");
    }
}

// æµ‹è¯•
public class Test {
    public static void main(String[] args) {
        SimpleIoC ioc = new SimpleIoC();
        
        // æ³¨å†ŒBean
        ioc.registerBean(UserDao.class);
        ioc.registerBean(UserService.class);
        
        // ä¾èµ–æ³¨å…¥
        ioc.inject();
        
        // ä½¿ç”¨
        UserService userService = ioc.getBean(UserService.class);
        userService.createUser("ç‹äºŒ");
    }
}
```

4ã€å¯ä»¥åŠ ä¸Šç»„ä»¶æ‰«æã€‚

```java
import java.lang.reflect.Field;
import java.util.*;

public class SimpleIoC {
    private Map<Class<?>, Object> beans = new HashMap<>();
    
    /**
     * æ‰«æå¹¶æ³¨å†Œç»„ä»¶
     */
    public void scan(String packageName) {
        // ç®€åŒ–ç‰ˆï¼šæ‰‹åŠ¨æ·»åŠ éœ€è¦æ‰«æçš„ç±»
        List<Class<?>> classes = getClassesInPackage(packageName);
        
        for (Class<?> clazz : classes) {
            if (clazz.isAnnotationPresent(Component.class)) {
                registerBean(clazz);
            }
        }
        
        // ä¾èµ–æ³¨å…¥
        inject();
    }
    
    /**
     * è·å–åŒ…ä¸‹çš„ç±»ï¼ˆç®€åŒ–å®ç°ï¼‰
     */
    private List<Class<?>> getClassesInPackage(String packageName) {
        // é¢è¯•æ—¶å¯ä»¥è¯´ï¼š"å®é™…å®ç°éœ€è¦æ‰«æclasspathï¼Œè¿™é‡Œç®€åŒ–å¤„ç†"
        return Arrays.asList(UserDao.class, UserService.class);
    }
    
    private void registerBean(Class<?> clazz) {
        try {
            Object instance = clazz.getDeclaredConstructor().newInstance();
            beans.put(clazz, instance);
        } catch (Exception e) {
            throw new RuntimeException("åˆ›å»ºBeanå¤±è´¥", e);
        }
    }
    
    @SuppressWarnings("unchecked")
    public <T> T getBean(Class<T> clazz) {
        return (T) beans.get(clazz);
    }
    
    private void inject() {
        for (Object bean : beans.values()) {
            Field[] fields = bean.getClass().getDeclaredFields();
            for (Field field : fields) {
                if (field.isAnnotationPresent(Autowired.class)) {
                    try {
                        field.setAccessible(true);
                        Object dependency = getBean(field.getType());
                        field.set(bean, dependency);
                    } catch (Exception e) {
                        throw new RuntimeException("æ³¨å…¥å¤±è´¥", e);
                    }
                }
            }
        }
    }
}
```

IoC å®¹å™¨çš„æ ¸å¿ƒæ˜¯ç®¡ç†å¯¹è±¡å’Œä¾èµ–æ³¨å…¥ï¼Œé¦–å…ˆå®šä¹‰æ³¨è§£ï¼Œç„¶åå®ç°å®¹å™¨çš„ä¸‰ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼šæ³¨å†ŒBeanã€è·å–Beanã€ä¾èµ–æ³¨å…¥ï¼›å…³é”®æ˜¯ç”¨åå°„åˆ›å»ºå¯¹è±¡å’Œæ³¨å…¥ä¾èµ–ã€‚

memoï¼š2025 å¹´ 6 æœˆ 23 æ—¥ä¿®æ”¹è‡³æ­¤ï¼Œä»Šå¤©[æœ‰çƒå‹å‘å–œæŠ¥è¯´æ‹¿åˆ°äº†äº¬ä¸œçš„ç¤¾æ‹› offer](https://javabetter.cn/zhishixingqiu/)ï¼Œè¿™çœŸçš„è¦æ­å–œä»–ï¼Œä¹Ÿå¸Œæœ›æ‰€æœ‰çœ‹åˆ°è¿™é‡Œçš„å°ä¼™ä¼´éƒ½èƒ½æœ‰ä¸€ä¸ªå¥½çš„ç»“æœã€‚

![çƒå‹æ‹¿åˆ°äº¬ä¸œç¤¾æ‹› offer](https://cdn.tobebetterjavaer.com/stutymore/spring-20250623105438.png)

### 8.è¯´è¯´BeanFactoryå’ŒApplicantContextçš„åŒºåˆ«?

BeanFactory ç®—æ˜¯ Spring çš„â€œå¿ƒè„â€ï¼Œè€Œ ApplicantContext å¯ä»¥è¯´æ˜¯ Spring çš„å®Œæ•´â€œèº«èº¯â€ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šBeanFactoryå’ŒApplicantContext](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-66328446-f89f-4b7a-8d9f-0e1145dd9b2f.png)

BeanFactory æä¾›äº†æœ€åŸºæœ¬çš„ IoC èƒ½åŠ›ã€‚å®ƒå°±åƒæ˜¯ä¸€ä¸ª Bean å·¥å‚ï¼Œè´Ÿè´£ Bean çš„åˆ›å»ºå’Œç®¡ç†ã€‚ä»–é‡‡ç”¨çš„æ˜¯æ‡’åŠ è½½çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰å½“æˆ‘ä»¬çœŸæ­£å»è·å–æŸä¸ª Bean çš„æ—¶å€™ï¼Œå®ƒæ‰ä¼šå»åˆ›å»ºè¿™ä¸ª Beanã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring5 BeanFactoryç»§æ‰¿ä½“ç³»](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-6e6d4b69-f36c-41e6-b8ba-9277be147c9b.png)

å®ƒæœ€ä¸»è¦çš„æ–¹æ³•å°±æ˜¯ `getBean()`ï¼Œè´Ÿè´£ä»å®¹å™¨ä¸­è¿”å›ç‰¹å®šåç§°æˆ–è€…ç±»å‹çš„ Bean å®ä¾‹ã€‚

```java
public class BeanFactoryExample {
    public static void main(String[] args) {
        // åˆ›å»º BeanFactory
        DefaultListableBeanFactory beanFactory = new DefaultListableBeanFactory();
        
        // æ‰‹åŠ¨æ³¨å†Œ Bean å®šä¹‰
        BeanDefinition beanDefinition = new RootBeanDefinition(UserService.class);
        beanFactory.registerBeanDefinition("userService", beanDefinition);
        
        // æ‡’åŠ è½½ï¼šæ­¤æ—¶æ‰åˆ›å»º Bean å®ä¾‹
        UserService userService = beanFactory.getBean("userService", UserService.class);
    }
}
```

ApplicationContext æ˜¯ BeanFactory çš„å­æ¥å£ï¼Œåœ¨ BeanFactory çš„åŸºç¡€ä¸Šæ‰©å±•äº†å¾ˆå¤šä¼ä¸šçº§çš„åŠŸèƒ½ã€‚å®ƒä¸ä»…åŒ…å«äº† BeanFactory çš„æ‰€æœ‰åŠŸèƒ½ï¼Œè¿˜æä¾›äº†å›½é™…åŒ–æ”¯æŒã€äº‹ä»¶å‘å¸ƒæœºåˆ¶ã€AOPã€JDBCã€ORM æ¡†æ¶é›†æˆç­‰ç­‰ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring5 ApplicationContextéƒ¨åˆ†ä½“ç³»ç±»å›¾](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-e201c9a3-f23c-4768-b844-ac7e0ba4bcec.png)

ApplicationContext é‡‡ç”¨çš„æ˜¯é¥¿åŠ è½½çš„æ–¹å¼ï¼Œå®¹å™¨å¯åŠ¨çš„æ—¶å€™å°±ä¼šæŠŠæ‰€æœ‰çš„å•ä¾‹ Bean éƒ½åˆ›å»ºå¥½ï¼Œè™½ç„¶è¿™æ ·ä¼šå¯¼è‡´å¯åŠ¨æ—¶é—´é•¿ä¸€ç‚¹ï¼Œä½†è¿è¡Œæ—¶æ€§èƒ½æ›´å¥½ã€‚

```java
@Configuration
public class AppConfig {
    @Bean
    public UserService userService() {
        return new UserService();
    }
}

public class ApplicationContextExample {
    public static void main(String[] args) {
        // åˆ›å»º ApplicationContextï¼Œå¯åŠ¨æ—¶å°±åˆ›å»ºæ‰€æœ‰ Bean
        ApplicationContext context = new AnnotationConfigApplicationContext(AppConfig.class);
        
        // è·å– Bean
        UserService userService = context.getBean(UserService.class);
        
        // å‘å¸ƒäº‹ä»¶
        context.publishEvent(new CustomEvent("Hello World"));
    }
}
```

ä»ä½¿ç”¨åœºæ™¯æ¥è¯´ï¼Œå®é™…å¼€å‘ä¸­ç”¨å¾—æœ€å¤šçš„æ˜¯ ApplicationContextã€‚åƒ AnnotationConfigApplicationContextã€WebApplicationContext è¿™äº›éƒ½æ˜¯ ApplicationContext çš„å®ç°ç±»ã€‚

å¦å¤–ä¸€ä¸ªé‡è¦çš„åŒºåˆ«æ˜¯ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚ApplicationContext ä¼šè‡ªåŠ¨è°ƒç”¨ Bean çš„åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•ï¼Œè€Œ BeanFactory éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨ç®¡ç†ã€‚

åœ¨ Spring Boot é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `@Autowired` æ³¨å…¥ ApplicationContextï¼Œæˆ–è€…é€šè¿‡å®ç° ApplicationContextAware æ¥å£æ¥è·å– ApplicationContextã€‚

![æŠ€æœ¯æ´¾æºç ï¼šè·å–ApplicationContext](https://cdn.tobebetterjavaer.com/stutymore/spring-20250625111259.png)

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç¾å›¢åŒå­¦ 2 ä¼˜é€‰ç‰©æµè°ƒåº¦æŠ€æœ¯ 2 é¢é¢è¯•åŸé¢˜ï¼šBeanFactoryå’ŒApplicationContext

memoï¼š2025 å¹´ 6 æœˆ 25 æ—¥ä¿®æ”¹è‡³æ­¤ï¼Œä»Šå¤©ç»™ä¸€ä¸ªåç§‘æœ¬ç¡•ç ” 0 çš„[çƒå‹ä¿®æ”¹ç®€å†](https://javabetter.cn/zhishixingqiu/jianli.html)åï¼Œå‘æ¥è¿™æ ·çš„æ„Ÿæ…¨ï¼Œè¦æ˜¯æ—©ç‚¹çŸ¥é“ä½ çš„[ç½‘ç«™](https://javabetter.cn/home.html)å’Œ[æ˜Ÿçƒ](https://javabetter.cn/zhishixingqiu/)å°±å¥½äº†ï¼Œ[æŠ€æœ¯æ´¾](https://javabetter.cn/zhishixingqiu/paicoding.html)ä¸æ¯”å¤–å–å¼ºå¤šäº†ï¼Ÿå†æ¬¡æ„Ÿè°¢äºŒå“¥ã€‚

![çƒå‹å¯¹æ˜Ÿçƒç›¸è§æ¨æ™š](https://cdn.tobebetterjavaer.com/stutymore/spring-20250625111617.png)

### 9.ğŸŒŸé¡¹ç›®å¯åŠ¨æ—¶Springçš„IoCä¼šåšä»€ä¹ˆï¼Ÿ

ç¬¬ä¸€ä»¶äº‹æ˜¯æ‰«æå’Œæ³¨å†Œ Beanã€‚IoC å®¹å™¨ä¼šæ ¹æ®æˆ‘ä»¬çš„é…ç½®ï¼Œæ¯”å¦‚ `@ComponentScan` æŒ‡å®šçš„åŒ…è·¯å¾„ï¼Œå»æ‰«ææ‰€æœ‰æ ‡æ³¨äº† `@Component`ã€`@Service`ã€`@Controller` è¿™äº›æ³¨è§£çš„ç±»ã€‚ç„¶åæŠŠè¿™äº›ç±»çš„å…ƒä¿¡æ¯åŒ…è£…æˆ BeanDefinition å¯¹è±¡ï¼Œæ³¨å†Œåˆ°å®¹å™¨çš„ BeanDefinitionRegistry ä¸­ã€‚è¿™ä¸ªé˜¶æ®µåªæ˜¯æ”¶é›†ä¿¡æ¯ï¼Œè¿˜æ²¡æœ‰çœŸæ­£åˆ›å»ºå¯¹è±¡ã€‚

![pdai.techï¼šIoC](https://cdn.tobebetterjavaer.com/stutymore/spring-20250627101759.png)

ç¬¬äºŒä»¶äº‹æ˜¯ Bean çš„å®ä¾‹åŒ–å’Œæ³¨å…¥ã€‚è¿™æ˜¯æœ€æ ¸å¿ƒçš„è¿‡ç¨‹ï¼ŒIoC å®¹å™¨ä¼šæŒ‰ç…§ä¾èµ–å…³ç³»çš„é¡ºåºå¼€å§‹åˆ›å»º Bean å®ä¾‹ã€‚å¯¹äºå•ä¾‹ Beanï¼Œå®¹å™¨ä¼šé€šè¿‡åå°„è°ƒç”¨æ„é€ æ–¹æ³•åˆ›å»ºå®ä¾‹ï¼Œç„¶åè¿›è¡Œå±æ€§æ³¨å…¥ï¼Œæœ€åæ‰§è¡Œåˆå§‹åŒ–å›è°ƒæ–¹æ³•ã€‚

![Tomå¼¹æ¶æ„ï¼šBean çš„å®ä¾‹åŒ–å’Œæ³¨å…¥](https://cdn.tobebetterjavaer.com/stutymore/spring-20250627102651.png)

åœ¨ä¾èµ–æ³¨å…¥æ—¶ï¼Œå®¹å™¨ä¼šæ ¹æ® `@Autowired`ã€`@Resource` è¿™äº›æ³¨è§£ï¼ŒæŠŠç›¸åº”çš„ä¾èµ–å¯¹è±¡æ³¨å…¥åˆ°ç›®æ ‡ Bean ä¸­ã€‚æ¯”å¦‚ UserService éœ€è¦ UserDaoï¼Œå®¹å™¨å°±ä¼šæŠŠ UserDao çš„å®ä¾‹æ³¨å…¥åˆ° UserService ä¸­ã€‚

#### è¯´è¯´Springçš„Beanå®ä¾‹åŒ–æ–¹å¼ï¼Ÿ

Spring æä¾›äº† 4 ç§æ–¹å¼æ¥å®ä¾‹åŒ– Beanï¼Œä»¥æ»¡è¶³ä¸åŒåœºæ™¯ä¸‹çš„éœ€æ±‚ã€‚

ç¬¬ä¸€ç§æ˜¯é€šè¿‡æ„é€ æ–¹æ³•å®ä¾‹åŒ–ï¼Œè¿™æ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚å½“æˆ‘ä»¬ç”¨ `@Component`ã€`@Service` è¿™äº›æ³¨è§£æ ‡æ³¨ç±»çš„æ—¶å€™ï¼ŒSpring é»˜è®¤é€šè¿‡æ— å‚æ„é€ å™¨æ¥åˆ›å»ºå®ä¾‹çš„ã€‚å¦‚æœç±»åªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ æ–¹æ³•ï¼ŒSpring ä¼šè‡ªåŠ¨è¿›è¡Œæ„é€ æ–¹æ³•æ³¨å…¥ã€‚

```java
@Service
public class UserService {
    private UserDao userDao;
    
    public UserService(UserDao userDao) {  // æ„é€ æ–¹æ³•æ³¨å…¥
        this.userDao = userDao;
    }
}
```

ç¬¬äºŒç§æ˜¯é€šè¿‡é™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–ã€‚æœ‰æ—¶å€™å¯¹è±¡çš„åˆ›å»ºæ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬ä¼šå†™ä¸€ä¸ªé™æ€å·¥å‚æ–¹æ³•æ¥åˆ›å»ºï¼Œç„¶åç”¨ `@Bean` æ³¨è§£æ¥æ ‡æ³¨è¿™ä¸ªæ–¹æ³•ã€‚Spring ä¼šè°ƒç”¨è¿™ä¸ªé™æ€æ–¹æ³•æ¥è·å– Bean å®ä¾‹ã€‚

```java
@Configuration
public class AppConfig {
    @Bean
    public static DataSource createDataSource() {
        // å¤æ‚çš„DataSourceåˆ›å»ºé€»è¾‘
        return new HikariDataSource();
    }
}
```

ç¬¬ä¸‰ç§æ˜¯é€šè¿‡å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–ã€‚è¿™ç§æ–¹å¼æ˜¯å…ˆåˆ›å»ºå·¥å‚å¯¹è±¡ï¼Œç„¶åé€šè¿‡å·¥å‚å¯¹è±¡çš„æ–¹æ³•æ¥åˆ›å»ºBeanï¼š

```java
@Configuration
public class AppConfig {
    @Bean
    public ConnectionFactory connectionFactory() {
        return new ConnectionFactory();
    }
    
    @Bean
    public Connection createConnection(ConnectionFactory factory) {
        return factory.createConnection();
    }
}
```

ç¬¬å››ç§æ˜¯é€šè¿‡ FactoryBean æ¥å£å®ä¾‹åŒ–ã€‚è¿™æ˜¯ Spring æä¾›çš„ä¸€ä¸ªç‰¹æ®Šæ¥å£ï¼Œå½“æˆ‘ä»¬éœ€è¦åˆ›å»ºå¤æ‚å¯¹è±¡çš„æ—¶å€™ç‰¹åˆ«æœ‰ç”¨ï¼š

```java
@Component
public class MyFactoryBean implements FactoryBean<MyObject> {
    @Override
    public MyObject getObject() throws Exception {
        // å¤æ‚çš„å¯¹è±¡åˆ›å»ºé€»è¾‘
        return new MyObject();
    }
    
    @Override
    public Class<?> getObjectType() {
        return MyObject.class;
    }
}
```

åœ¨å®é™…å·¥ä½œä¸­ï¼Œç”¨å¾—æœ€å¤šçš„è¿˜æ˜¯æ„é€ æ–¹æ³•å®ä¾‹åŒ–ï¼Œå› ä¸ºç®€å•ç›´æ¥ã€‚å·¥å‚æ–¹æ³•ä¸€èˆ¬ç”¨åœ¨éœ€è¦å¤æ‚åˆå§‹åŒ–é€»è¾‘çš„åœºæ™¯ï¼Œæ¯”å¦‚æ•°æ®åº“è¿æ¥æ± ã€æ¶ˆæ¯é˜Ÿåˆ—è¿æ¥è¿™äº›ã€‚FactoryBean ä¸»è¦æ˜¯åœ¨æ¡†æ¶å¼€å‘æˆ–è€…éœ€è¦åŠ¨æ€åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ä½¿ç”¨ã€‚

Spring åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ä¼šæ ¹æ® Bean çš„å®šä¹‰è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„æ–¹å¼ï¼Œæˆ‘ä»¬ä½œä¸ºå¼€å‘è€…ä¸»è¦æ˜¯é€šè¿‡æ³¨è§£å’Œé…ç½®æ¥å‘Šè¯‰ Spring åº”è¯¥æ€ä¹ˆåˆ›å»ºå¯¹è±¡ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„åä¸ºé¢ç»åŒå­¦ 8 æŠ€æœ¯äºŒé¢é¢è¯•åŸé¢˜ï¼šè¯´è¯´ Spring çš„ Bean å®ä¾‹åŒ–æ–¹å¼
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç¾å›¢åŒå­¦ 2 ä¼˜é€‰ç‰©æµè°ƒåº¦æŠ€æœ¯ 2 é¢é¢è¯•åŸé¢˜ï¼šbeanåŠ å·¥æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ

memoï¼š2025 å¹´ 6 æœˆ 27 æ—¥ä¿®æ”¹è‡³æ­¤ï¼Œä»Šå¤©çœ‹åˆ°[æœ‰çƒå‹å‘çš„ offer é€‰æ‹©æé—®è´´](https://javabetter.cn/zhishixingqiu/)ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯æ­å·å…­å°é¾™ç¾¤æ ¸ç§‘æŠ€ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºè¿˜æ˜¯éå¸¸å€¼å¾—å»çš„ï¼Œæ¯•ç«Ÿæ˜¯æ­å·çš„ç‹¬è§’å…½å…¬å¸ï¼Œè–ªèµ„å¾…é‡éƒ½ä¸é”™ã€‚

![çƒå‹æ‹¿åˆ°äº†æ­å·ç¾¤æ ¸ç§‘æŠ€çš„ offer](https://cdn.tobebetterjavaer.com/stutymore/spring-20250627103801.png)

### 10.ä½ æ˜¯æ€ä¹ˆç†è§£Beançš„ï¼Ÿ

åœ¨æˆ‘çœ‹æ¥ï¼ŒBean æœ¬è´¨ä¸Šå°±æ˜¯ç”± Spring å®¹å™¨ç®¡ç†çš„ Java å¯¹è±¡ï¼Œä½†å®ƒå’Œæ™®é€šçš„ Java å¯¹è±¡æœ‰å¾ˆå¤§åŒºåˆ«ã€‚æ™®é€šçš„ Java å¯¹è±¡æˆ‘ä»¬æ˜¯é€šè¿‡ new å…³é”®å­—åˆ›å»ºçš„ã€‚è€Œ Bean æ˜¯äº¤ç»™ Spring å®¹å™¨æ¥ç®¡ç†çš„ï¼Œä»åˆ›å»ºåˆ°é”€æ¯éƒ½ç”±å®¹å™¨è´Ÿè´£ã€‚

![stack overflowï¼šbean çš„åˆå§‹åŒ–è¿‡ç¨‹](https://cdn.tobebetterjavaer.com/stutymore/spring-20250628110931.png)

ä»å®é™…ä½¿ç”¨çš„è§’åº¦æ¥è¯´ï¼Œæˆ‘ä»¬é¡¹ç›®é‡Œçš„ Serviceã€Daoã€Controller è¿™äº›éƒ½æ˜¯ Beanã€‚æ¯”å¦‚ UserService è¢«æ ‡æ³¨äº† `@Service` æ³¨è§£ï¼Œå®ƒå°±æˆäº†ä¸€ä¸ª Beanï¼ŒSpring ä¼šè‡ªåŠ¨åˆ›å»ºå®ƒçš„å®ä¾‹ï¼Œç®¡ç†å®ƒçš„ä¾èµ–å…³ç³»ï¼Œå½“å…¶ä»–åœ°æ–¹éœ€è¦ç”¨åˆ° UserService çš„æ—¶å€™ï¼ŒSpring å°±ä¼šæŠŠè¿™ä¸ªå®ä¾‹æ³¨å…¥è¿›å»ã€‚

![æŠ€æœ¯æ´¾æºç ï¼šUserService](https://cdn.tobebetterjavaer.com/stutymore/spring-20250628111222.png)

è¿™ç§ä¾èµ–æ³¨å…¥çš„æ–¹å¼è®©å¯¹è±¡ä¹‹é—´çš„å…³ç³»å˜å¾—æ¾è€¦åˆã€‚

Spring æä¾›äº†å¤šç§ Bean çš„é…ç½®æ–¹å¼ï¼ŒåŸºäºæ³¨è§£çš„æ–¹å¼æ˜¯æœ€å¸¸ç”¨çš„ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šBean çš„å£°æ˜æ–¹å¼](https://cdn.tobebetterjavaer.com/stutymore/spring-20241224163146.png)

åŸºäº XML é…ç½®çš„æ–¹å¼åœ¨ Spring Boot é¡¹ç›®ä¸­å·²ç»ä¸æ€ä¹ˆç”¨äº†ã€‚Java é…ç½®ç±»çš„æ–¹å¼åˆ™å¯ä»¥ç”¨æ¥è§£å†³ä¸€äº›æ¯”è¾ƒå¤æ‚çš„åœºæ™¯ï¼Œæ¯”å¦‚è¯´ä¸»ä»æ•°æ®æºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ `@Primary` æ³¨è§£æ ‡æ³¨ä¸»æ•°æ®æºï¼Œç”¨ `@Qualifier` æ¥æŒ‡å®šå¤‡ç”¨æ•°æ®æºã€‚

```java
@Configuration
public class AppConfig {
    
    @Bean
    @Primary  // ä¸»è¦å€™é€‰è€…
    public DataSource primaryDataSource() {
        return new HikariDataSource();
    }
    
    @Bean
    @Qualifier("secondary")
    public DataSource secondaryDataSource() {
        return new BasicDataSource();
    }
}
```

é‚£åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå½“æˆ‘ä»¬ç›´æ¥ç”¨ `@Autowired` æ³¨è§£æ³¨å…¥ DataSource æ—¶ï¼ŒSpring é»˜è®¤ä¼šä½¿ç”¨ HikariDataSourceï¼›å½“åŠ ä¸Š `@Qualifier("secondary")` æ³¨è§£æ—¶ï¼ŒSpring åˆ™ä¼šæ³¨å…¥ BasicDataSourceã€‚

```java
@Autowired
private DataSource dataSource; // ä¼šæ³¨å…¥ primaryDataSourceï¼ˆå› ä¸ºæœ‰ @Primaryï¼‰

@Autowired
@Qualifier("secondary")
private DataSource secondaryDataSource;
```

#### @Component å’Œ @Bean æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

é¦–å…ˆä»ä½¿ç”¨ä¸Šæ¥è¯´ï¼Œ`@Component` æ˜¯æ ‡æ³¨åœ¨ç±»ä¸Šçš„ï¼Œè€Œ `@Bean` æ˜¯æ ‡æ³¨åœ¨æ–¹æ³•ä¸Šçš„ã€‚`@Component` å‘Šè¯‰ Spring è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œè¯·æŠŠå®ƒæ³¨å†Œä¸º Beanï¼Œè€Œ `@Bean` åˆ™å‘Šè¯‰ Spring è¯·å°†è¿™ä¸ªæ–¹æ³•è¿”å›çš„å¯¹è±¡æ³¨å†Œä¸º Beanã€‚

```java
@Component  // Springè‡ªåŠ¨åˆ›å»ºUserServiceå®ä¾‹
public class UserService {
    @Autowired
    private UserDao userDao;
}

@Configuration
public class AppConfig {
    @Bean  // æˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºDataSourceå®ä¾‹
    public DataSource dataSource() {
        HikariDataSource ds = new HikariDataSource();
        ds.setJdbcUrl("jdbc:mysql://localhost:3306/test");
        ds.setUsername("root");
        ds.setPassword("123456");
        return ds;  // è¿”å›ç»™Springç®¡ç†
    }
}
```

ä»æ§åˆ¶æƒçš„è§’åº¦æ¥è¯´ï¼Œ`@Component` æ˜¯ç”± Spring è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†çš„ã€‚

![æŠ€æœ¯æ´¾æºç ï¼š@Component](https://cdn.tobebetterjavaer.com/stutymore/spring-20250628114006.png)

è€Œ `@Bean` åˆ™æ˜¯ç”±æˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºçš„ï¼Œç„¶åå†äº¤ç»™ Spring ç®¡ç†ï¼Œæˆ‘ä»¬å¯¹å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹æœ‰å®Œå…¨çš„æ§åˆ¶æƒã€‚

![æŠ€æœ¯æ´¾æºç ï¼š@Bean](https://cdn.tobebetterjavaer.com/stutymore/spring-20250628114149.png)

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 9 é¢è¯•åŸé¢˜ï¼šæ€ä¹ˆç†è§£springçš„beanï¼Œ@Component å’Œ @Bean çš„åŒºåˆ«

memoï¼š2025 å¹´ 6 æœˆ 28 æ—¥ä¿®æ”¹è‡³æ­¤ï¼Œä»Šå¤©åœ¨å¸®çƒå‹[ä¿®æ”¹ç®€å†](https://javabetter.cn/zhishixingqiu/)çš„æ—¶å€™ï¼Œåˆç¢°åˆ°ä¸€ä¸ªæ­ç”µæœ¬ç¡•çš„çƒå‹ã€‚æˆ‘è¿™é‡Œæƒ³è¯´çš„ä¸€ç‚¹æ˜¯ï¼Œæ­ç”µçš„è®¡ç®—æœºä¸“ä¸šéå¸¸å¼ºï¼Œè™½ç„¶ä»–åªæ˜¯ä¸€æ‰€åŒéï¼Œå¦‚æœèƒ½æŠŠé¡¹ç›®ç»å†ã€ä¸“ä¸šæŠ€èƒ½å¥½å¥½å†™çš„è¯ï¼Œæ‹¿ä¸ªå¤§å‚çš„é¡¶çº§ offer æ˜¯å®Œå…¨æ²¡é—®é¢˜çš„ã€‚

![æ­å·ç”µå­ç§‘æŠ€å¤§å­¦æœ¬ç¡•çš„çƒå‹](https://cdn.tobebetterjavaer.com/stutymore/spring-è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯.png)

### 11.ğŸŒŸèƒ½è¯´ä¸€ä¸‹Beançš„ç”Ÿå‘½å‘¨æœŸå—ï¼Ÿ

æ¨èé˜…è¯»ï¼š[ä¸‰åˆ†æ¶ï¼šSpring Bean ç”Ÿå‘½å‘¨æœŸï¼Œå¥½åƒäººçš„ä¸€ç”Ÿ](https://mp.weixin.qq.com/s/zb6eA3Se0gQoqL8PylCPLw)

å¥½çš„ã€‚

Bean çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥åˆ†ä¸º 5 ä¸ªä¸»è¦é˜¶æ®µï¼Œæˆ‘æŒ‰ç…§å®é™…çš„æ‰§è¡Œé¡ºåºæ¥è¯´ä¸€ä¸‹ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šBeanç”Ÿå‘½å‘¨æœŸäº”ä¸ªé˜¶æ®µ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-595fce5b-36cb-4dcb-b08c-8205a1e98d8a.png)

ç¬¬ä¸€ä¸ªé˜¶æ®µæ˜¯å®ä¾‹åŒ–ã€‚Spring å®¹å™¨ä¼šæ ¹æ® BeanDefinitionï¼Œé€šè¿‡åå°„è°ƒç”¨ Bean çš„æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡å®ä¾‹ã€‚å¦‚æœæœ‰å¤šä¸ªæ„é€ æ–¹æ³•ï¼ŒSpring ä¼šæ ¹æ®ä¾èµ–æ³¨å…¥çš„è§„åˆ™é€‰æ‹©åˆé€‚çš„æ„é€ æ–¹æ³•ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring Beanç”Ÿå‘½å‘¨æœŸ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-942a927a-86e4-4a01-8f52-9addd89642ff.png)

ç¬¬äºŒé˜¶æ®µæ˜¯å±æ€§èµ‹å€¼ã€‚è¿™ä¸ªé˜¶æ®µ Spring ä¼šç»™ Bean çš„å±æ€§èµ‹å€¼ï¼ŒåŒ…æ‹¬é€šè¿‡ `@Autowired`ã€`@Resource` è¿™äº›æ³¨è§£æ³¨å…¥çš„ä¾èµ–å¯¹è±¡ï¼Œä»¥åŠé€šè¿‡ `@Value` æ³¨å…¥çš„é…ç½®å€¼ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šdoCreateBean æ–¹æ³•æºç ](https://cdn.tobebetterjavaer.com/stutymore/spring-20240311101430.png)

ç¬¬ä¸‰é˜¶æ®µæ˜¯åˆå§‹åŒ–ã€‚è¿™ä¸ªé˜¶æ®µä¼šä¾æ¬¡æ‰§è¡Œï¼š

- `@PostConstruct` æ ‡æ³¨çš„æ–¹æ³•
- InitializingBean æ¥å£çš„ afterPropertiesSet æ–¹æ³•
- é€šè¿‡ `@Bean` çš„ initMethod æŒ‡å®šçš„åˆå§‹åŒ–æ–¹æ³•

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šBeanç”Ÿå‘½å‘¨æœŸæºç è¿½è¸ª](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-d2da20a3-08d0-4648-b9a3-2fff8512b159.png)

æˆ‘åœ¨é¡¹ç›®ä¸­ç»å¸¸ç”¨ `@PostConstruct` æ¥åšä¸€äº›åˆå§‹åŒ–å·¥ä½œï¼Œæ¯”å¦‚ç¼“å­˜é¢„åŠ è½½ã€DB é…ç½®ç­‰ç­‰ã€‚

```java
// CategoryServiceImplä¸­çš„ç¼“å­˜åˆå§‹åŒ–
@PostConstruct
public void init() {
    categoryCaches = CacheBuilder.newBuilder().maximumSize(300).build(new CacheLoader<Long, CategoryDTO>() {
        @Override
        public CategoryDTO load(@NotNull Long categoryId) throws Exception {
            CategoryDO category = categoryDao.getById(categoryId);
            // ...
        }
    });
}

// DynamicConfigContainerä¸­çš„é…ç½®åˆå§‹åŒ–
@PostConstruct
public void init() {
    cache = Maps.newHashMap();
    bindBeansFromLocalCache("dbConfig", cache);
}
```

åˆå§‹åŒ–åï¼ŒSpring è¿˜ä¼šè°ƒç”¨æ‰€æœ‰æ³¨å†Œçš„ BeanPostProcessor åç½®å¤„ç†æ–¹æ³•ã€‚è¿™ä¸ªé˜¶æ®µç»å¸¸ç”¨æ¥åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œæ¯”å¦‚ AOP ä»£ç†ã€‚

ç¬¬äº”é˜¶æ®µæ˜¯ä½¿ç”¨ Beanã€‚æ¯”å¦‚æˆ‘ä»¬çš„ Controller è°ƒç”¨ Serviceï¼ŒService è°ƒç”¨ DAOã€‚

```java
// UserControllerä¸­çš„ä½¿ç”¨ç¤ºä¾‹
@Autowired
private UserService userService;
@GetMapping("/users/{id}")
public UserDTO getUser(@PathVariable Long id) {
    return userService.getUserById(id);
}
// UserServiceä¸­çš„ä½¿ç”¨ç¤ºä¾‹
@Autowired
private UserDao userDao;
public UserDTO getUserById(Long id) {
    return userDao.getById(id);
}
// UserDaoä¸­çš„ä½¿ç”¨ç¤ºä¾‹
@Autowired
private JdbcTemplate jdbcTemplate;
public UserDTO getById(Long id) {
    String sql = "SELECT * FROM users WHERE id = ?";
    return jdbcTemplate.queryForObject(sql, new Object[]{id}, new UserRowMapper());
}
```

æœ€åæ˜¯é”€æ¯é˜¶æ®µã€‚å½“å®¹å™¨å…³é—­æˆ–è€… Bean è¢«ç§»é™¤çš„æ—¶å€™ï¼Œä¼šä¾æ¬¡æ‰§è¡Œï¼š

- `@PreDestroy` æ ‡æ³¨çš„æ–¹æ³•
- DisposableBean æ¥å£çš„ destroy æ–¹æ³•
- é€šè¿‡ `@Bean` çš„ destroyMethod æŒ‡å®šçš„é”€æ¯æ–¹æ³•

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šclose æºç ](https://cdn.tobebetterjavaer.com/stutymore/spring-20240311101658.png)

#### Aware ç±»å‹çš„æ¥å£æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ

Aware æ¥å£åœ¨ Spring ä¸­æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„è®¾è®¡ï¼Œå®ƒä»¬çš„ä½œç”¨æ˜¯è®© Bean èƒ½å¤Ÿæ„ŸçŸ¥åˆ° Spring å®¹å™¨çš„ä¸€äº›å†…éƒ¨ç»„ä»¶ã€‚

ä»è®¾è®¡ç†å¿µæ¥è¯´ï¼ŒAware æ¥å£å®ç°äº†ä¸€ç§â€œå›è°ƒâ€æœºåˆ¶ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼ŒBean ä¸åº”è¯¥ç›´æ¥ä¾èµ– Spring å®¹å™¨ï¼Œè¿™æ ·å¯ä»¥ä¿æŒä»£ç çš„ç‹¬ç«‹æ€§ã€‚ä½†æœ‰äº›æ—¶å€™ï¼ŒBean ç¡®å®éœ€è¦è·å–å®¹å™¨çš„ä¸€äº›ä¿¡æ¯æˆ–è€…ç»„ä»¶ï¼ŒAware æ¥å£å°±æä¾›äº†è¿™æ ·ä¸€ä¸ªèƒ½åŠ›ã€‚

æˆ‘æœ€å¸¸ç”¨çš„ Aware æ¥å£æ˜¯ ApplicationContextAwareï¼Œå®ƒå¯ä»¥è®© Bean è·å–åˆ° ApplicationContext å®¹å™¨æœ¬èº«ã€‚

![æŠ€æœ¯æ´¾æºç ï¼šApplicationContextAware](https://cdn.tobebetterjavaer.com/stutymore/spring-20250630100429.png)

åœ¨[æŠ€æœ¯æ´¾é¡¹ç›®](https://javabetter.cn/zhishixingqiu/paicoding.html)ä¸­ï¼Œæˆ‘å°±é€šè¿‡å®ç° ApplicationContextAware å’Œ EnvironmentAware æ¥å£å°è£…äº†ä¸€ä¸ª SpringUtil å·¥å…·ç±»ï¼Œé€šè¿‡ getBean å’Œ getProperty æ–¹æ³•æ¥è·å– Bean å’Œé…ç½®å±æ€§ã€‚

```java
// é™æ€æ–¹æ³•è·å–Beanï¼Œæ–¹ä¾¿åœ¨éSpringç®¡ç†çš„ç±»ä¸­ä½¿ç”¨
public static <T> T getBean(Class<T> clazz) {
    return context.getBean(clazz);
}

// è·å–é…ç½®å±æ€§
public static String getProperty(String key) {
    return environment.getProperty(key);
}
```

#### å¦‚æœé…ç½®äº† init-method å’Œ destroy-methodï¼ŒSpring ä¼šåœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨å…¶é…ç½®çš„æ–¹æ³•ï¼Ÿ

init-method æŒ‡å®šçš„åˆå§‹åŒ–æ–¹æ³•ä¼šåœ¨ Bean çš„åˆå§‹åŒ–é˜¶æ®µè¢«è°ƒç”¨ï¼Œå…·ä½“çš„æ‰§è¡Œé¡ºåºæ˜¯ï¼š

- å…ˆæ‰§è¡Œ `@PostConstruct` æ ‡æ³¨çš„æ–¹æ³•
- ç„¶åæ‰§è¡Œ InitializingBean æ¥å£çš„ `afterPropertiesSet()` æ–¹æ³•
- æœ€åå†æ‰§è¡Œ init-method æŒ‡å®šçš„æ–¹æ³•

ä¹Ÿå°±æ˜¯è¯´ï¼Œinit-method æ˜¯åœ¨æ‰€æœ‰å…¶ä»–åˆå§‹åŒ–æ–¹æ³•ä¹‹åæ‰§è¡Œçš„ã€‚

```java
@Component
public class MyService {
    @Autowired
    private UserDao userDao;
    
    @PostConstruct
    public void postConstruct() {
        System.out.println("1. @PostConstructæ‰§è¡Œ");
    }
    
    public void customInit() {  // é€šè¿‡@Beançš„initMethodæŒ‡å®š
        System.out.println("3. init-methodæ‰§è¡Œ");
    }
}

@Configuration
public class AppConfig {
    @Bean(initMethod = "customInit")
    public MyService myService() {
        return new MyService();
    }
}
```

destroy-method ä¼šåœ¨ Bean é”€æ¯é˜¶æ®µè¢«è°ƒç”¨ã€‚

```java
@Component
public class MyService {
    @PreDestroy
    public void preDestroy() {
        System.out.println("1. @PreDestroyæ‰§è¡Œ");
    }
    
    public void customDestroy() {  // é€šè¿‡@Beançš„destroyMethodæŒ‡å®š
        System.out.println("3. destroy-methodæ‰§è¡Œ");
    }
}
```

ä¸è¿‡åœ¨å®é™…å¼€å‘ä¸­ï¼Œé€šå¸¸ç”¨ `@PostConstruct` å’Œ `@PreDestroy` å°±å¤Ÿäº†ï¼Œå®ƒä»¬æ›´ç®€æ´ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³ 25 å±Šæ—¥å¸¸å®ä¹ ä¸€é¢åŸé¢˜ï¼šè¯´è¯´ Bean çš„ç”Ÿå‘½å‘¨æœŸ
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç™¾åº¦é¢ç»åŒå­¦ 1 æ–‡å¿ƒä¸€è¨€ 25 å®ä¹  Java åç«¯é¢è¯•åŸé¢˜ï¼šSpringä¸­beanç”Ÿå‘½å‘¨æœŸ
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„8 åç«¯å¼€å‘ç§‹æ‹›ä¸€é¢é¢è¯•åŸé¢˜ï¼šè®²ä¸€ä¸‹Spring Beançš„ç”Ÿå‘½å‘¨æœŸ
> 4. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„åŒå­¦ 1 è´å£³æ‰¾æˆ¿åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šbeanç”Ÿå‘½å‘¨æœŸ
> 5. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¿«æ‰‹åŒå­¦ 4 ä¸€é¢åŸé¢˜ï¼šä»‹ç»ä¸‹Beançš„ç”Ÿå‘½å‘¨æœŸï¼ŸAwareç±»å‹æ¥å£çš„ä½œç”¨ï¼Ÿå¦‚æœé…ç½®äº†init-methodå’Œdestroy-methodï¼ŒSpringä¼šåœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨å…¶é…ç½®çš„æ–¹æ³•ï¼Ÿ

memoï¼š2025 å¹´ 6 æœˆ 30 æ—¥ä¿®æ”¹è‡³æ­¤ã€‚æ˜¨å¤©æœ‰[è¯»è€…å‘æ¶ˆæ¯è¯´æœ‰ä¸‰ä¸ª offer è¦é€‰æ‹©](https://javabetter.cn/zhishixingqiu/)ï¼Œä¸­ç§‘å¤§è¯»åšã€ä¸­æµ·æ²¹ã€å•†é£åŒ—ç ”ï¼Œé—®æˆ‘è¯¥æ€ä¹ˆé€‰æ‹©ï¼Ÿè¯´å®è¯ï¼Œè¿™ä¸‰ä¸ªéƒ½æ˜¯éå¸¸ä¼˜è´¨çš„é€‰æ‹©ï¼Œæˆ‘ä¸ªäººçš„å»ºè®®æ˜¯ä¼˜å…ˆè€ƒè™‘ä¸­ç§‘å¤§è¯»åšï¼Œæ¯•ç«Ÿæ˜¯å›½å†…é¡¶å°–å­¦åºœï¼Œåšå£«æ¯•ä¸šåå¯ä»¥é€‰æ‹©åœ¨é«˜æ ¡ä»»æ•™ï¼Œä¼šæ›´ç¬¦åˆä»–çš„å®¶åº­æ¡ä»¶ï¼Œå½“ç„¶äº†ï¼Œæˆ‘æ·±çŸ¥ï¼Œè¯»åšçš„äº§å‡ºå‹åŠ›éå¸¸å¤§ã€‚

![è¯»è€…æ‹¿åˆ°ä¸­ç§‘å¤§è¯»åšã€ä¸­æµ·æ²¹ã€å•†é£åŒ—ç ”](https://cdn.tobebetterjavaer.com/stutymore/spring-20250630101647.png)

### 12.ä¸ºä»€ä¹ˆIDEAä¸æ¨èä½¿ç”¨@Autowiredæ³¨è§£æ³¨å…¥Beanï¼Ÿ

å‰æƒ…æè¦ï¼šå½“ä½¿ç”¨ `@Autowired` æ³¨è§£æ³¨å…¥ Bean æ—¶ï¼ŒIDEA ä¼šæç¤ºâ€œField injection is not recommendedâ€ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼š@Autowired](https://cdn.tobebetterjavaer.com/stutymore/spring-20241224164722.png)

é¢è¯•å›ç­”ï¼š

ä¸»è¦æœ‰å‡ ä¸ªåŸå› ã€‚

ç¬¬ä¸€ä¸ªæ˜¯å­—æ®µæ³¨å…¥ä¸åˆ©äºå•å…ƒæµ‹è¯•ã€‚å­—æ®µæ³¨å…¥éœ€è¦ä½¿ç”¨åå°„æˆ– Spring å®¹å™¨æ‰èƒ½æ³¨å…¥ä¾èµ–ï¼Œæµ‹è¯•æ›´å¤æ‚ï¼›è€Œæ„é€ æ–¹æ³•æ³¨å…¥å¯ä»¥ç›´æ¥é€šè¿‡æ„é€ æ–¹æ³•ä¼ å…¥ Mock å¯¹è±¡ï¼Œæµ‹è¯•èµ·æ¥æ›´ç®€å•ã€‚

```java
// å­—æ®µæ³¨å…¥çš„æµ‹è¯•å›°éš¾
@Test
public void testUserService() {
    UserService userService = new UserService();
    // æ— æ³•ç›´æ¥è®¾ç½®userRepositoryï¼Œéœ€è¦åå°„æˆ–Springå®¹å™¨
    // userService.userRepository = Mockito.mock(UserRepository.class);
    // éœ€è¦æ‰‹åŠ¨è®¾ç½®ä¾èµ–ï¼Œæµ‹è¯•ä¸æ–¹ä¾¿
    ReflectionTestUtils.setField(userService, "userRepository", Mockito.mock(UserRepository.class));
    userService.doSomething();
    // ...
}

// æ„é€ æ–¹æ³•æ³¨å…¥çš„æµ‹è¯•ç®€å•
@Test
public void testUserService() {
    UserRepository mockRepository = Mockito.mock(UserRepository.class);
    UserService userService = new UserService(mockRepository); // ç›´æ¥æ³¨å…¥
}
```

ç¬¬äºŒä¸ªæ˜¯å­—æ®µæ³¨å…¥ä¼šéšè—å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œè€Œæ„é€ æ–¹æ³•æ³¨å…¥ä¼šåœ¨é¡¹ç›®å¯åŠ¨æ—¶å°±å»æ£€æŸ¥ä¾èµ–å…³ç³»ï¼Œèƒ½æ›´æ—©å‘ç°é—®é¢˜ã€‚

ç¬¬ä¸‰ä¸ªæ˜¯æ„é€ æ–¹æ³•æ³¨å…¥å¯ä»¥ä½¿ç”¨ final å­—æ®µç¡®ä¿ä¾èµ–åœ¨å¯¹è±¡åˆ›å»ºæ—¶å°±è¢«åˆå§‹åŒ–ï¼Œé¿å…äº†åç»­ä¿®æ”¹çš„é£é™©ã€‚

åœ¨[æŠ€æœ¯æ´¾é¡¹ç›®](https://javabetter.cn/zhishixingqiu/paicoding.html)ä¸­ï¼Œæˆ‘ä»¬å·²ç»åœ¨ä½¿ç”¨æ„é€ æ–¹æ³•æ³¨å…¥çš„æ–¹å¼æ¥ç®¡ç†ä¾èµ–å…³ç³»ã€‚

![æŠ€æœ¯æ´¾ï¼šæ„é€ æ–¹æ³•æ³¨å…¥](https://cdn.tobebetterjavaer.com/stutymore/spring-20241224165628.png)

ä¸è¿‡è¯è¯´å›æ¥ï¼Œ`@Autowired` çš„å­—æ®µæ³¨å…¥æ–¹å¼åœ¨ä¸€äº›ç®€å•çš„åœºæ™¯ä¸‹è¿˜æ˜¯å¯ä»¥ç”¨çš„ï¼Œä¸»è¦çœ‹å›¢é˜Ÿçš„ç¼–ç è§„èŒƒå§ã€‚

#### @Autowired å’Œ @Resource æ³¨è§£çš„åŒºåˆ«ï¼Ÿ

é¦–å…ˆä»æ¥æºä¸Šè¯´ï¼Œ`@Autowired` æ˜¯ Spring æ¡†æ¶æä¾›çš„æ³¨è§£ï¼Œè€Œ `@Resource` æ˜¯ Java EE æ ‡å‡†æä¾›çš„æ³¨è§£ã€‚æ¢å¥è¯è¯´ï¼Œ`@Resource` æ˜¯ JDK è‡ªå¸¦çš„ï¼Œè€Œ `@Autowired` æ˜¯ Spring ç‰¹æœ‰çš„ã€‚

è™½ç„¶ IDEA ä¸æ¨èä½¿ç”¨ `@Autowired`ï¼Œä½†å¯¹ `@Resource` æ³¨è§£å´æ²¡æœ‰ä»»ä½•æç¤ºã€‚

![æŠ€æœ¯æ´¾ï¼š@Resource](https://cdn.tobebetterjavaer.com/stutymore/spring-20241224170055.png)

ä»æ³¨å…¥æ–¹å¼ä¸Šè¯´ï¼Œ`@Autowired` é»˜è®¤æŒ‰ç…§ç±»å‹ï¼Œä¹Ÿå°±æ˜¯ byType è¿›è¡Œæ³¨å…¥ï¼Œè€Œ `@Resource` é»˜è®¤æŒ‰ç…§åç§°ï¼Œä¹Ÿå°±æ˜¯ byName è¿›è¡Œæ³¨å…¥ã€‚

å½“å®¹å™¨ä¸­å­˜åœ¨å¤šä¸ªç›¸åŒç±»å‹çš„ Beanï¼Œ æ¯”å¦‚è¯´æœ‰ä¸¤ä¸ª UserRepository çš„å®ç°ç±»ï¼Œç›´æ¥ç”¨ `@Autowired` æ³¨å…¥ UserRepository æ—¶å°±ä¼šæŠ¥é”™ï¼Œå› ä¸º Spring å®¹å™¨ä¸çŸ¥é“è¯¥æ³¨å…¥å“ªä¸ªå®ç°ç±»ã€‚

```java
@Component
public class UserRepository21 implements UserRepository2 {}

@Component
public class UserRepository22 implements UserRepository2 {}

@Component
public class UserService2 {
    @Autowired
    private UserRepository2 userRepository; // å†²çª
}
```

è¿™æ—¶å€™ï¼Œæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œç¬¬ä¸€ç§æ˜¯ä½¿ç”¨ `@Autowired` + `@Qualifier` æŒ‡å®šå…·ä½“çš„ Bean åç§°æ¥è§£å†³å†²çªã€‚

```java
@Component("userRepository21")
public class UserRepository21 implements UserRepository2 {
}
@Component("userRepository22")
public class UserRepository22 implements UserRepository2 {
}
@Autowired
@Qualifier("userRepository22")
private UserRepository2 userRepository22;
```

ç¬¬äºŒç§æ˜¯ä½¿ç”¨ `@Resource` æ³¨è§£æŒ‰åç§°è¿›è¡Œæ³¨å…¥ã€‚

```java
@Resource(name = "userRepository21")
private UserRepository2 userRepository21;
```

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 9 é¢è¯•åŸé¢˜ï¼šä¾èµ–æ³¨å…¥çš„æ—¶å€™ï¼Œç›´æ¥Autowiredæ¯”è¾ƒç›´æ¥ï¼Œä¸ºä»€ä¹ˆæ¨èæ„é€ æ–¹æ³•æ³¨å…¥å‘¢

memoï¼š2025 å¹´ 7 æœˆ 1 æ—¥ä¿®æ”¹è‡³æ­¤ï¼Œä»Šå¤©åœ¨[å¸®çƒå‹ä¿®æ”¹ç®€å†](https://javabetter.cn/zhishixingqiu/)çš„æ—¶å€™ï¼Œç¢°åˆ°ä¸€ä¸ªéƒ‘å·å¤§å­¦æœ¬ç¡•çš„çƒå‹ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æ²³å—çœæœ€å¥½çš„å¤§å­¦äº†ï¼Œä½†ä¹Ÿä»…ä»…æ˜¯ä¸€æ‰€ 211ï¼Œæ‰€ä»¥å¸Œæœ›æ‰€æœ‰æ²³å—çš„åŒå­¦éƒ½èƒ½åŠ æŠŠåŠ²ï¼Œè¯æ˜è‡ªå·±çš„å®åŠ›ï¼Œå»æ‹¿åˆ°æ›´å¥½çš„ offerï¼Œä¸ºæ ¡äº‰å…‰ã€‚

![éƒ‘å·å¤§å­¦æœ¬ç¡•çš„çƒå‹](https://cdn.tobebetterjavaer.com/stutymore/spring-20250701154344.png)

### 13.@Autowiredçš„å®ç°åŸç†äº†è§£å—ï¼Ÿ

`@Autowired` æ˜¯ Spring å®ç°ä¾èµ–æ³¨å…¥çš„æ ¸å¿ƒæ³¨è§£ï¼Œå…¶å®ç°åŸç†åŸºäºåå°„æœºåˆ¶å’Œ BeanPostProcessor æ¥å£ã€‚

æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªä¸»è¦é˜¶æ®µã€‚ç¬¬ä¸€ä¸ªé˜¶æ®µæ˜¯ä¾èµ–æ”¶é›†é˜¶æ®µï¼Œå‘ç”Ÿåœ¨ Bean å®ä¾‹åŒ–ä¹‹åã€å±æ€§èµ‹å€¼ä¹‹å‰ã€‚`Autowired` çš„ Processor ä¼šæ‰«æ Bean çš„æ‰€æœ‰å­—æ®µã€æ–¹æ³•å’Œæ„é€ æ–¹æ³•ï¼Œæ‰¾å‡ºæ ‡æ³¨äº† `@Autowired` æ³¨è§£çš„åœ°æ–¹ï¼Œç„¶åæŠŠè¿™äº›ä¿¡æ¯å°è£…æˆ `Injection` å…ƒæ•°æ®å¯¹è±¡ç¼“å­˜èµ·æ¥ã€‚è¿™ä¸ªè¿‡ç¨‹ç”¨åˆ°äº†å¤§é‡çš„åå°„æ“ä½œï¼Œéœ€è¦åˆ†æç±»çš„ç»“æ„ã€æ³¨è§£ä¿¡æ¯ç­‰ç­‰ã€‚

![MarkusZhangï¼š@Autowired](https://cdn.tobebetterjavaer.com/stutymore/spring-20250711165339.png)

ç¬¬äºŒä¸ªé˜¶æ®µæ˜¯ä¾èµ–æ³¨å…¥é˜¶æ®µï¼ŒSpring ä¼šå–å‡ºä¹‹å‰ç¼“å­˜çš„ `Injection` å…ƒæ•°æ®å¯¹è±¡ï¼Œç„¶åé€ä¸ªå¤„ç†æ¯ä¸ªæ³¨å…¥ç‚¹ã€‚å¯¹äºæ¯ä¸ª `@Autowired` æ ‡æ³¨çš„å­—æ®µæˆ–æ–¹æ³•ï¼ŒSpring ä¼šæ ¹æ®ç±»å‹å»å®¹å™¨ä¸­æŸ¥æ‰¾åŒ¹é…çš„ Beanã€‚

```java
// 1. æŒ‰ç±»å‹æŸ¥æ‰¾ï¼ˆbyTypeï¼‰
Map<String, Object> matchingBeans = BeanFactoryUtils.beansOfTypeIncludingAncestors(
    this.beanFactory, type);

// 2. å¦‚æœæ‰¾åˆ°å¤šä¸ªå€™é€‰è€…ï¼ŒæŒ‰åç§°ç­›é€‰ï¼ˆbyNameï¼‰
String autowiredBeanName = determineAutowireCandidate(matchingBeans, descriptor);

// 3. è€ƒè™‘@Primaryå’Œ@Priorityæ³¨è§£
// 4. æœ€åæŒ‰ç…§å­—æ®µåæˆ–å‚æ•°ååŒ¹é…
```

åœ¨å…·ä½“çš„æ³¨å…¥è¿‡ç¨‹ä¸­ï¼ŒSpring ä¼šä½¿ç”¨åå°„æ¥è®¾ç½®å­—æ®µçš„å€¼æˆ–è€…è°ƒç”¨ setter æ–¹æ³•ã€‚æ¯”å¦‚å¯¹äºå­—æ®µæ³¨å…¥ï¼Œä¼šè°ƒç”¨ `Field.set()` æ–¹æ³•ï¼›å¯¹äº setter æ³¨å…¥ï¼Œä¼šè°ƒç”¨ `Method.invoke()` æ–¹æ³•ã€‚

### 14.ä»€ä¹ˆæ˜¯è‡ªåŠ¨è£…é…ï¼Ÿ

è‡ªåŠ¨è£…é…çš„æœ¬è´¨å°±æ˜¯è®© Spring å®¹å™¨è‡ªåŠ¨å¸®æˆ‘ä»¬å®Œæˆ Bean ä¹‹é—´çš„ä¾èµ–å…³ç³»æ³¨å…¥ï¼Œè€Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»æŒ‡å®šæ¯ä¸ªä¾èµ–ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯â€œæˆ‘ä»¬ä¸ç”¨å‘Šè¯‰ Spring å…·ä½“æ€ä¹ˆæ³¨å…¥ï¼ŒSpring è‡ªå·±ä¼šæƒ³åŠæ³•æ‰¾åˆ°åˆé€‚çš„ Bean æ³¨å…¥è¿›æ¥â€ã€‚

è‡ªåŠ¨è£…é…çš„å·¥ä½œåŸç†ç®€å•æ¥è¯´å°±æ˜¯ï¼ŒSpring å®¹å™¨åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰«æ `@ComponentScan` æŒ‡å®šåŒ…è·¯å¾„ä¸‹çš„æ‰€æœ‰ç±»ï¼Œç„¶åæ ¹æ®ç±»ä¸Šçš„æ³¨è§£ï¼Œæ¯”å¦‚ `@Autowired`ã€`@Resource` ç­‰ï¼Œæ¥åˆ¤æ–­å“ªäº› Bean éœ€è¦è¢«è‡ªåŠ¨è£…é…ã€‚

```java
@Configuration
@ComponentScan("com.github.paicoding.forum.service")
@MapperScan(basePackages = {
    "com.github.paicoding.forum.service.article.repository.mapper",
    "com.github.paicoding.forum.service.user.repository.mapper"
    // ... æ›´å¤šåŒ…è·¯å¾„
})
public class ServiceAutoConfig {
    // Springè‡ªåŠ¨æ‰«ææŒ‡å®šåŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶å¹¶æ³¨å†Œä¸ºBean
}
```

ä¹‹ååˆ†ææ¯ä¸ª Bean çš„ä¾èµ–å…³ç³»ï¼Œåœ¨åˆ›å»º Bean çš„æ—¶å€™ï¼Œæ ¹æ®è£…é…è§„åˆ™è‡ªåŠ¨æ‰¾åˆ°åˆé€‚çš„ä¾èµ– Beanï¼Œæœ€åæ ¹æ®åå°„å°†è¿™äº›ä¾èµ–æ³¨å…¥åˆ°ç›®æ ‡ Bean ä¸­ã€‚

#### Springæä¾›äº†å“ªå‡ ç§è‡ªåŠ¨è£…é…ç±»å‹ï¼Ÿ

Spring çš„è‡ªåŠ¨è£…é…æ–¹å¼æœ‰å¥½å‡ ç§ï¼Œåœ¨ XML é…ç½®æ—¶ä»£ï¼Œä¸»è¦æœ‰ byNameã€byTypeã€constructor å’Œ autodetect å››ç§æ–¹å¼ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringå››ç§è‡ªåŠ¨è£…é…ç±»å‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-034120d9-88c7-490b-af07-7d48f3b6b7bc.png)

åˆ°äº†æ³¨è§£é©±åŠ¨æ—¶ä»£ï¼Œç”¨å¾—æœ€å¤šçš„æ˜¯ `@Autowired` æ³¨è§£ï¼Œé»˜è®¤æŒ‰ç…§ç±»å‹è£…é…ã€‚

```java
@Service
public class UserService {
    @Autowired  // æŒ‰ç±»å‹è‡ªåŠ¨è£…é…
    private UserRepository userRepository;
}
```

å…¶æ¬¡è¿˜æœ‰ `@Resource` æ³¨è§£ï¼Œå®ƒé»˜è®¤æŒ‰ç…§åç§°è£…é…ï¼Œå¦‚æœæ‰¾ä¸åˆ°å¯¹åº”åç§°çš„ Beanï¼Œå°±ä¼šæŒ‰ç±»å‹è£…é…ã€‚

Spring Boot çš„è‡ªåŠ¨è£…é…è¿˜æœ‰ä¸€å¥—æ›´é«˜çº§çš„æœºåˆ¶ï¼Œé€šè¿‡ `@EnableAutoConfiguration` å’Œå„ç§ `@Conditional` æ³¨è§£æ¥å®ç°ï¼Œè¿™ä¸ªæ˜¯æ¡†æ¶çº§åˆ«çš„è‡ªåŠ¨è£…é…ï¼Œä¼šæ ¹æ® classpath ä¸­çš„ç±»å’Œé…ç½®æ¥è‡ªåŠ¨é…ç½® Beanã€‚

![ShawnBlogï¼šSpring Boot çš„è‡ªåŠ¨è£…é…](https://cdn.tobebetterjavaer.com/stutymore/spring-20250702101032.png)

memoï¼š2025 å¹´ 7 æœˆ 2 æ—¥ä¿®æ”¹è‡³æ­¤ï¼Œä»Šå¤©åœ¨[å¸®çƒå‹ä¿®æ”¹ç®€å†](https://javabetter.cn/zhishixingqiu/)çš„æ—¶å€™ï¼Œç¢°åˆ°ä¸€ä¸ªåŒ—äº¬èˆªç©ºèˆªå¤©å¤§å­¦çš„çƒå‹ï¼Œä»–åœ¨é‚®ä»¶ä¸­è¯´åˆ°ï¼šåœ¨æ˜Ÿçƒé‡Œå­¦åˆ°äº†å¥½å¤šä¸œè¥¿ï¼Œç›®å‰æ­£åœ¨å‡†å¤‡[æŠ€æœ¯æ´¾](https://javabetter.cn/zhishixingqiu/paicoding.html)å’Œ MYDBï¼Œæ‰“ç®—å¥½å¥½å†²ç§‹æ‹›ï¼Œèƒ½å¸®åŠ©åˆ°å¤§å®¶æˆ‘çœŸçš„å¾ˆæ¬£æ…°ã€‚

![åŒ—èˆªçƒå‹å¯¹æ˜Ÿçƒçš„è®¤å¯](https://cdn.tobebetterjavaer.com/stutymore/spring-20250702101812.png)

### 15.Beançš„ä½œç”¨åŸŸæœ‰å“ªäº›?

Bean çš„ä½œç”¨åŸŸå†³å®šäº† Bean å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸå’Œåˆ›å»ºç­–ç•¥ï¼Œsingleton æ˜¯é»˜è®¤çš„ä½œç”¨åŸŸã€‚æ•´ä¸ª Spring å®¹å™¨ä¸­åªä¼šæœ‰ä¸€ä¸ª Bean å®ä¾‹ã€‚ä¸ç®¡åœ¨å¤šå°‘ä¸ªåœ°æ–¹æ³¨å…¥è¿™ä¸ª Beanï¼Œæ‹¿åˆ°çš„éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚

```java
@Component  // é»˜è®¤å°±æ˜¯singleton
public class UserService {
    // æ•´ä¸ªåº”ç”¨ä¸­åªæœ‰ä¸€ä¸ªUserServiceå®ä¾‹
}
```

ç”Ÿå‘½å‘¨æœŸå’Œ Spring å®¹å™¨ç›¸åŒï¼Œå®¹å™¨å¯åŠ¨æ—¶åˆ›å»ºï¼Œå®¹å™¨é”€æ¯æ—¶é”€æ¯ã€‚

å®é™…å¼€å‘ä¸­ï¼Œåƒ Serviceã€Dao è¿™äº›ä¸šåŠ¡ç»„ä»¶åŸºæœ¬éƒ½æ˜¯å•ä¾‹çš„ï¼Œå› ä¸ºå•ä¾‹æ—¢èƒ½èŠ‚çœå†…å­˜ï¼Œåˆèƒ½æé«˜æ€§èƒ½ã€‚

å½“æŠŠ scope è®¾ç½®ä¸º prototype æ—¶ï¼Œæ¯æ¬¡ä»å®¹å™¨ä¸­è·å– Bean çš„æ—¶å€™éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚

```java
@Component
@Scope("prototype")
public class OrderProcessor {
    // æ¯æ¬¡æ³¨å…¥æˆ–è·å–éƒ½æ˜¯æ–°çš„å®ä¾‹
}
```

å½“éœ€è¦å¤„ç†ä¸€äº›æœ‰çŠ¶æ€çš„ Bean æ—¶ä¼šç”¨åˆ° prototypeï¼Œæ¯”å¦‚æ¯ä¸ªè®¢å•å¤„ç†å™¨éœ€è¦ç»´æŠ¤ä¸åŒçš„çŠ¶æ€ä¿¡æ¯ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ singleton Bean ä¸­æ³¨å…¥ prototype Bean æ—¶è¦å°å¿ƒï¼Œå› ä¸º singleton Bean åªåˆ›å»ºä¸€æ¬¡ï¼Œæ‰€ä»¥ prototype Bean ä¹Ÿåªä¼šæ³¨å…¥ä¸€æ¬¡ã€‚è¿™æ—¶å€™å¯ä»¥ç”¨ `@Lookup` æ³¨è§£æˆ–è€… ApplicationContext æ¥åŠ¨æ€è·å–ã€‚

```java
@Component
public class SingletonService {
    // é”™è¯¯çš„åšæ³•ï¼ŒprototypeBeanåªä¼šæ³¨å…¥ä¸€æ¬¡
    @Autowired
    private PrototypeBean prototypeBean;
    
    // æ­£ç¡®çš„åšæ³•ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½è·å–æ–°å®ä¾‹
    @Lookup
    public PrototypeBean getPrototypeBean() {
        return null;  // Springä¼šé‡å†™è¿™ä¸ªæ–¹æ³•
    }
}
```

é™¤äº† singleton å’Œ prototypeï¼ŒSpring è¿˜æ”¯æŒå…¶ä»–ä½œç”¨åŸŸï¼Œæ¯”å¦‚ requestã€sessionã€application å’Œ websocketã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring Beanæ”¯æŒä½œç”¨åŸŸ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-08a9cb31-5a4f-4224-94cd-0c0f643a57ea.png)

å¦‚æœä½œç”¨äºæ˜¯ requestï¼Œè¡¨ç¤ºåœ¨ Web åº”ç”¨ä¸­ï¼Œæ¯ä¸ª HTTP è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Bean å®ä¾‹ï¼Œè¯·æ±‚ç»“æŸå Bean å°±è¢«é”€æ¯ã€‚

```java
@Component
@Scope("request")
public class RequestContext {
    // æ¯ä¸ªHTTPè¯·æ±‚éƒ½æœ‰è‡ªå·±çš„å®ä¾‹
}
```

å¦‚æœä½œç”¨äºæ˜¯ sessionï¼Œè¡¨ç¤ºåœ¨ Web åº”ç”¨ä¸­ï¼Œæ¯ä¸ª HTTP ä¼šè¯éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Bean å®ä¾‹ï¼Œä¼šè¯ç»“æŸå Bean è¢«é”€æ¯ã€‚

```java
@Component
@Scope("session")
public class UserSession {
    // æ¯ä¸ªç”¨æˆ·ä¼šè¯éƒ½æœ‰è‡ªå·±çš„å®ä¾‹
}
```

å…¸å‹çš„ä½¿ç”¨åœºæ™¯æ˜¯è´­ç‰©è½¦ã€ç”¨æˆ·ç™»å½•çŠ¶æ€è¿™äº›éœ€è¦åœ¨æ•´ä¸ªä¼šè¯æœŸé—´ä¿æŒçš„ä¿¡æ¯ã€‚

application ä½œç”¨åŸŸè¡¨ç¤ºåœ¨æ•´ä¸ªåº”ç”¨ä¸­åªæœ‰ä¸€ä¸ª Bean å®ä¾‹ï¼Œç±»ä¼¼äº singletonï¼Œä½†å®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸ ServletContext ç»‘å®šã€‚

```java
@Component
@Scope("application")
public class AppConfig {
    // æ•´ä¸ªåº”ç”¨ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹
}
```

websocket ä½œç”¨åŸŸè¡¨ç¤ºåœ¨ WebSocket ä¼šè¯ä¸­æ¯ä¸ªè¿æ¥éƒ½æœ‰è‡ªå·±çš„ Bean å®ä¾‹ã€‚WebSocket è¿æ¥å»ºç«‹æ—¶åˆ›å»ºï¼Œè¿æ¥å…³é—­æ—¶é”€æ¯ã€‚

```java
@Component
@Scope("websocket")
public class WebSocketHandler {
    // æ¯ä¸ªWebSocketè¿æ¥éƒ½æœ‰è‡ªå·±çš„å®ä¾‹
}
```

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„åŒå­¦ 1 è´å£³æ‰¾æˆ¿åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šbeanæ˜¯å•ä¾‹è¿˜æ˜¯å¤šä¾‹çš„ï¼Œå…·ä½“æ€ä¹ˆä¿®æ”¹

memoï¼š2025 å¹´ 7 æœˆ 3 æ—¥ä¿®æ”¹è‡³æ­¤ï¼Œä»Šå¤©åœ¨[å¸®çƒå‹ä¿®æ”¹ç®€å†](https://javabetter.cn/zhishixingqiu/)çš„æ—¶å€™ï¼Œç¢°åˆ°ä¸€ä¸ªéƒ‘å·å¤§å­¦ç¡•ï¼Œæ²³åŒ—å¸ˆèŒƒå¤§å­¦æœ¬çš„çƒå‹ï¼Œæ•´ä½“åœ¨æ ¡çš„ç»å†éå¸¸å‡ºè‰²ï¼Œå¥–å­¦é‡‘ã€è®ºæ–‡æœŸåˆŠåŸºæœ¬ä¸Šéƒ½æ‹‰æ»¡äº†ã€‚é‚£è¿™ä¹ˆå¤šä¼˜ç§€çš„çƒå‹é€‰æ‹©æ¥åˆ°è¿™é‡Œï¼Œä¹Ÿæ˜¯å¯¹æ˜Ÿçƒçš„åˆä¸€æ¬¡è®¤å¯å’Œè‚¯å®šï¼Œæˆ‘ä¹Ÿä¸€å®šä¼šç»§ç»­åŠªåŠ›ï¼Œæä¾›æ›´å¤šä¼˜è´¨çš„å†…å®¹å’ŒæœåŠ¡ã€‚

![éƒ‘å·å¤§å­¦ç¡•ï¼Œæ²³åŒ—å¸ˆèŒƒå¤§å­¦æœ¬çš„çƒå‹](https://cdn.tobebetterjavaer.com/stutymore/spring-20250704144758.png)

### 16.Springä¸­çš„å•ä¾‹Beanä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜å—ï¼Ÿ

é¦–å…ˆè¦æ˜ç¡®ä¸€ç‚¹ã€‚Spring å®¹å™¨æœ¬èº«ä¿è¯äº† Bean åˆ›å»ºè¿‡ç¨‹çš„çº¿ç¨‹å®‰å…¨ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ä¼šå‡ºç°å¤šä¸ªçº¿ç¨‹åŒæ—¶åˆ›å»ºåŒä¸€ä¸ªå•ä¾‹ Bean çš„æƒ…å†µã€‚ä½†æ˜¯ Bean åˆ›å»ºå®Œæˆåçš„ä½¿ç”¨è¿‡ç¨‹ï¼ŒSpring å°±ä¸ç®¡äº†ã€‚

æ¢å¥è¯è¯´ï¼Œå•ä¾‹ Bean åœ¨è¢«åˆ›å»ºåï¼Œå¦‚æœå®ƒçš„å†…éƒ¨çŠ¶æ€æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å°±å¯èƒ½ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringå•ä¾‹Beançº¿ç¨‹å®‰å…¨é—®é¢˜](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-35dacef4-1a9e-45e1-b3f2-5a91227eb244.png)

æ¯”å¦‚è¯´åœ¨[æŠ€æœ¯æ´¾é¡¹ç›®](https://javabetter.cn/zhishixingqiu/paicoding.html)ä¸­ï¼Œæœ‰ä¸€ä¸ªæ•æ„Ÿè¯è¿‡æ»¤çš„ Beanï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ volatile å…³é”®å­—æ¥ä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å¯è§æ€§ã€‚

```java
@Service
public class SensitiveService {
    private volatile SensitiveWordBs sensitiveWordBs; // ä½¿ç”¨volatileä¿è¯å¯è§æ€§
    
    @PostConstruct
    public void refresh() {
        // é‡æ–°åˆå§‹åŒ–sensitiveWordBs
    }
}
```

å¦‚æœ Bean ä¸­æ²¡æœ‰æˆå‘˜å˜é‡ï¼Œæˆ–è€…æˆå‘˜å˜é‡éƒ½æ˜¯ä¸å¯å˜çš„ï¼Œfinal ä¿®é¥°çš„ï¼Œé‚£ä¹ˆå°±ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

```java
@Service
public class UserServiceImpl implements UserService {
    @Resource
    private UserDao userDao;
    @Autowired
    private CountService countService;
    // åªæœ‰ä¾èµ–æ³¨å…¥çš„æ— çŠ¶æ€å­—æ®µ
}

@Service
public class ConfigService {
    private final String appName;  // finalä¿®é¥°ï¼Œä¸å¯å˜
    
    public ConfigService(@Value("${app.name}") String appName) {
        this.appName = appName;
    }
}
```

#### å•ä¾‹Beançš„çº¿ç¨‹å®‰å…¨é—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ

ç¬¬ä¸€ç§ï¼Œä½¿ç”¨å±€éƒ¨å˜é‡ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨æ— çŠ¶æ€çš„å•ä¾‹ Beanï¼ŒæŠŠæ‰€æœ‰çŠ¶æ€éƒ½é€šè¿‡æ–¹æ³•å‚æ•°ä¼ é€’ï¼š

```java
@Service
public class UserService {
    @Autowired
    private UserDao userDao;
    
    // æ— çŠ¶æ€æ–¹æ³•ï¼Œæ‰€æœ‰æ•°æ®é€šè¿‡å‚æ•°ä¼ é€’
    public User processUser(Long userId, String operation) {
        User user = userDao.findById(userId);
        // å¤„ç†é€»è¾‘...
        return user;
    }
}
```

ç¬¬äºŒç§ï¼Œå½“ç¡®å®éœ€è¦ç»´æŠ¤çº¿ç¨‹ç›¸å…³çš„çŠ¶æ€æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ [ThreadLocal](https://javabetter.cn/thread/ThreadLocal.html) æ¥ä¿å­˜çŠ¶æ€ã€‚ThreadLocal å¯ä»¥ä¿è¯æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å˜é‡å‰¯æœ¬ï¼Œäº’ä¸å¹²æ‰°ã€‚

```java
@Service
public class UserContextService {
    private static final ThreadLocal<User> userThreadLocal = new ThreadLocal<>();
    
    public void setCurrentUser(User user) {
        userThreadLocal.set(user);
    }
    
    public User getCurrentUser() {
        return userThreadLocal.get();
    }
    
    public void clear() {
        userThreadLocal.remove(); // é˜²æ­¢å†…å­˜æ³„æ¼
    }
}
```

ç¬¬ä¸‰ç§ï¼Œå¦‚æœéœ€è¦ç¼“å­˜æ•°æ®æˆ–è€…è®¡æ•°ï¼Œä½¿ç”¨ JUC åŒ…ä¸‹çš„çº¿ç¨‹å®‰å…¨ç±»ï¼Œæ¯”å¦‚è¯´ [AtomicInteger](https://javabetter.cn/thread/atomic.html)ã€[ConcurrentHashMap](https://javabetter.cn/thread/ConcurrentHashMap.html)ã€[CopyOnWriteArrayList](https://javabetter.cn/thread/CopyOnWriteArrayList.html) ç­‰ã€‚

```java
@Service
public class CacheService {
    // ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„é›†åˆ
    private final ConcurrentHashMap<String, Object> cache = new ConcurrentHashMap<>();
    private final AtomicLong counter = new AtomicLong(0);
    
    public void put(String key, Object value) {
        cache.put(key, value);
        counter.incrementAndGet();
    }
}
```

ç¬¬å››ç§ï¼Œå¯¹äºå¤æ‚çš„çŠ¶æ€æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ synchronized æˆ– Lockï¼š

```java
@Service
public class CacheService {
    private final Map<String, Object> cache = new HashMap<>();
    private final ReentrantLock lock = new ReentrantLock();
    
    public void put(String key, Object value) {
        lock.lock();
        try {
            cache.put(key, value);
        } finally {
            lock.unlock();
        }
    }
}
```

ç¬¬äº”ç§ï¼Œå¦‚æœ Bean ç¡®å®éœ€è¦ç»´æŠ¤çŠ¶æ€ï¼Œå¯ä»¥è€ƒè™‘å°†å…¶æ”¹ä¸º prototype ä½œç”¨åŸŸï¼Œè¿™æ ·æ¯æ¬¡æ³¨å…¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œé¿å…äº†å¤šçº¿ç¨‹å…±äº«åŒä¸€ä¸ªå®ä¾‹çš„é—®é¢˜ã€‚

```java
@Service
@Scope("prototype") // æ¯æ¬¡æ³¨å…¥éƒ½åˆ›å»ºæ–°å®ä¾‹
public class StatefulService {
    private String state; // ç°åœ¨æ¯ä¸ªå®ä¾‹éƒ½æœ‰ç‹¬ç«‹çŠ¶æ€
    
    public void setState(String state) {
        this.state = state;
    }
}
```

æˆ–è€…ä½¿ç”¨ request ä½œç”¨åŸŸï¼Œè¿™æ ·æ¯ä¸ª HTTP è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚

```java
@Service
@Scope("request")
public class RequestScopedService {
    private String requestData;
    // æ¯ä¸ªè¯·æ±‚éƒ½æœ‰ç‹¬ç«‹çš„å®ä¾‹
}
```

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„é˜¿é‡Œé¢ç»åŒå­¦ 1 é—²é±¼åç«¯ä¸€é¢çš„åŸé¢˜ï¼šspringçš„beançš„å¹¶å‘å®‰å…¨é—®é¢˜

memoï¼š2025 å¹´ 7 æœˆ 4 æ—¥ä¿®æ”¹è‡³æ­¤ï¼Œä»Šå¤©åœ¨[å¸®çƒå‹ä¿®æ”¹ç®€å†](https://javabetter.cn/zhishixingqiu/)çš„æ—¶å€™ï¼Œç¢°åˆ°ä¸€ä¸ªæ­¦æ±‰ç†å·¥å¤§å­¦æœ¬ç¡•çš„çƒå‹ã€‚è¯´çœŸçš„ï¼Œå’Œæ­¦æ±‰ç†å·¥å¤§å­¦æŒºæœ‰ç¼˜çš„ï¼Œ2023 å¹´å»æ­¦æ±‰ï¼Œå°±çº¿ä¸‹è§äº†ä¸€åæ­¦ç†çš„çƒå‹ï¼Œ[ä»–å½“æ—¶ç­¾çº¦çš„æ˜¯å°ç±³](https://t.zsxq.com/LfG3B)ï¼Œéå¸¸ä¼˜ç§€ã€‚

![æ­¦æ±‰ç†å·¥å¤§å­¦æœ¬ç¡•çš„çƒå‹](https://cdn.tobebetterjavaer.com/stutymore/spring-2023.09-2026.06.png)

### 17.ä»€ä¹ˆæ˜¯å¾ªç¯ä¾èµ–?

ç®€å•æ¥è¯´å°±æ˜¯ä¸¤ä¸ªæˆ–å¤šä¸ª Bean ç›¸äº’ä¾èµ–ï¼Œæ¯”å¦‚è¯´ A ä¾èµ– Bï¼ŒB ä¾èµ– Aï¼Œæˆ–è€… C ä¾èµ– Cï¼Œå°±æˆäº†å¾ªç¯ä¾èµ–ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringå¾ªç¯ä¾èµ–](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-f8fea53f-56fa-4cca-9199-ec7f648da625.png)

### 18.ğŸŒŸSpringæ€ä¹ˆè§£å†³å¾ªç¯ä¾èµ–å‘¢ï¼Ÿ

Spring é€šè¿‡ä¸‰çº§ç¼“å­˜æœºåˆ¶æ¥è§£å†³å¾ªç¯ä¾èµ–ï¼š

1. ä¸€çº§ç¼“å­˜ï¼šå­˜æ”¾å®Œå…¨åˆå§‹åŒ–å¥½çš„å•ä¾‹ Beanã€‚
2. äºŒçº§ç¼“å­˜ï¼šå­˜æ”¾æå‰æš´éœ²çš„ Beanï¼Œå®ä¾‹åŒ–å®Œæˆï¼Œä½†æœªåˆå§‹åŒ–å®Œæˆã€‚
3. ä¸‰çº§ç¼“å­˜ï¼šå­˜æ”¾ Bean å·¥å‚ï¼Œç”¨äºç”Ÿæˆæå‰æš´éœ²çš„ Beanã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šä¸‰çº§ç¼“å­˜](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-01d92863-a2cb-4f61-8d8d-30ecf0279b28.png)

ä»¥ Aã€B ä¸¤ä¸ªç±»å‘ç”Ÿå¾ªç¯ä¾èµ–ä¸ºä¾‹ï¼š

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå¾ªç¯ä¾èµ–](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-cfc09f84-f8e1-4702-80b6-d115843e81fe.png)

ç¬¬ 1 æ­¥ï¼šå¼€å§‹åˆ›å»º Bean Aã€‚

- Spring è°ƒç”¨ A çš„æ„é€ æ–¹æ³•ï¼Œåˆ›å»º A çš„å®ä¾‹ã€‚æ­¤æ—¶ A å¯¹è±¡å·²å­˜åœ¨ï¼Œä½† bå±æ€§è¿˜æ˜¯ nullã€‚
- å°† A çš„å¯¹è±¡å·¥å‚æ”¾å…¥ä¸‰çº§ç¼“å­˜ã€‚
- å¼€å§‹è¿›è¡Œ A çš„å±æ€§æ³¨å…¥ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šA å¯¹è±¡å·¥å‚](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-1a8bdc29-ff43-4ff4-9b61-3eedd9da59b3.png)

ç¬¬ 2 æ­¥ï¼šA éœ€è¦æ³¨å…¥ Bï¼Œå¼€å§‹åˆ›å»º Bean Bã€‚

- å‘ç°éœ€è¦ Bï¼Œä½† B è¿˜ä¸å­˜åœ¨ï¼Œæ‰€ä»¥å¼€å§‹åˆ›å»º Bã€‚
- è°ƒç”¨ B çš„æ„é€ æ–¹æ³•ï¼Œåˆ›å»º B çš„å®ä¾‹ã€‚æ­¤æ—¶ B å¯¹è±¡å·²å­˜åœ¨ï¼Œä½† a å±æ€§è¿˜æ˜¯ nullã€‚
- å°† B çš„å¯¹è±¡å·¥å‚æ”¾å…¥ä¸‰çº§ç¼“å­˜ã€‚
- å¼€å§‹è¿›è¡Œ B çš„å±æ€§æ³¨å…¥ã€‚

ç¬¬ 3 æ­¥ï¼šB éœ€è¦æ³¨å…¥ Aï¼Œä»ç¼“å­˜ä¸­è·å– Aã€‚

- B éœ€è¦æ³¨å…¥ Aï¼Œå…ˆä»ä¸€çº§ç¼“å­˜æ‰¾ Aï¼Œæ²¡æ‰¾åˆ°ã€‚
- å†ä»äºŒçº§ç¼“å­˜æ‰¾ Aï¼Œä¹Ÿæ²¡æ‰¾åˆ°ã€‚
- æœ€åä»ä¸‰çº§ç¼“å­˜æ‰¾ Aï¼Œæ‰¾åˆ°äº† A çš„å¯¹è±¡å·¥å‚ã€‚
- è°ƒç”¨ A çš„å¯¹è±¡å·¥å‚å¾—åˆ° A çš„å®ä¾‹ã€‚è¿™æ—¶ A å·²ç»å®ä¾‹åŒ–äº†ï¼Œè™½ç„¶è¿˜æ²¡å®Œå…¨åˆå§‹åŒ–ã€‚
- å°† A ä»ä¸‰çº§ç¼“å­˜ç§»åˆ°äºŒçº§ç¼“å­˜ã€‚
- B æ‹¿åˆ° A çš„å¼•ç”¨ï¼Œå®Œæˆå±æ€§æ³¨å…¥ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šA æ”¾å…¥äºŒçº§ç¼“å­˜ï¼ŒB æ”¾å…¥ä¸€çº§ç¼“å­˜](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-bf2507bf-96aa-4b88-a58b-7ec41d11bc70.png)

ç¬¬ 4 æ­¥ï¼šB å®Œæˆåˆå§‹åŒ–ã€‚

- B çš„å±æ€§æ³¨å…¥å®Œæˆï¼Œæ‰§è¡Œ `@PostConstruct` ç­‰åˆå§‹åŒ–é€»è¾‘ã€‚
- B å®Œå…¨åˆ›å»ºå®Œæˆï¼Œä»ä¸‰çº§ç¼“å­˜ç§»é™¤ï¼Œæ”¾å…¥ä¸€çº§ç¼“å­˜ã€‚

ç¬¬ 5 æ­¥ï¼šA å®Œæˆåˆå§‹åŒ–ã€‚

- å›åˆ° A çš„åˆ›å»ºè¿‡ç¨‹ï¼ŒA æ‹¿åˆ°å®Œæ•´çš„ B å®ä¾‹ï¼Œå®Œæˆå±æ€§æ³¨å…¥ã€‚
- A æ‰§è¡Œåˆå§‹åŒ–é€»è¾‘ï¼Œåˆ›å»ºå®Œæˆã€‚
- A ä»äºŒçº§ç¼“å­˜ç§»é™¤ï¼Œæ”¾å…¥ä¸€çº§ç¼“å­˜ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šAB éƒ½å¥½äº†](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-022f7cb9-2c83-4fe9-b252-b02bd0fb2435.png)

ç”¨ä»£ç æ¥æ¨¡æ‹Ÿè¿™ä¸ªè¿‡ç¨‹ï¼Œæ˜¯è¿™æ ·çš„ï¼š

```java
// æ¨¡æ‹ŸSpringçš„è§£å†³è¿‡ç¨‹
public class CircularDependencyDemo {
    // ä¸‰çº§ç¼“å­˜
    Map<String, Object> singletonObjects = new HashMap<>();
    Map<String, Object> earlySingletonObjects = new HashMap<>();
    Map<String, ObjectFactory> singletonFactories = new HashMap<>();
    
    public Object getBean(String beanName) {
        // å…ˆä»ä¸€çº§ç¼“å­˜è·å–
        Object bean = singletonObjects.get(beanName);
        if (bean != null) return bean;
        
        // å†ä»äºŒçº§ç¼“å­˜è·å–
        bean = earlySingletonObjects.get(beanName);
        if (bean != null) return bean;
        
        // æœ€åä»ä¸‰çº§ç¼“å­˜è·å–
        ObjectFactory factory = singletonFactories.get(beanName);
        if (factory != null) {
            bean = factory.getObject();
            earlySingletonObjects.put(beanName, bean);  // ç§»åˆ°äºŒçº§ç¼“å­˜
            singletonFactories.remove(beanName);        // ä»ä¸‰çº§ç¼“å­˜ç§»é™¤
        }
        
        return bean;
    }
}
```

#### å“ªäº›æƒ…å†µä¸‹Springæ— æ³•è§£å†³å¾ªç¯ä¾èµ–ï¼Ÿ

Spring è™½ç„¶èƒ½è§£å†³å¤§éƒ¨åˆ†å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½†ç¡®å®æœ‰å‡ ç§æƒ…å†µæ˜¯æ— æ³•å¤„ç†çš„ï¼Œæˆ‘æ¥è¯¦ç»†è¯´è¯´ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå¾ªç¯ä¾èµ–çš„å‡ ç§æƒ…å½¢](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-37bb576d-b4af-42ed-91f4-d846ceb012b6.png)

ç¬¬ä¸€ç§ï¼Œæ„é€ æ–¹æ³•çš„å¾ªç¯ä¾èµ–ï¼Œè¿™ç§æƒ…å†µ Spring ä¼šç›´æ¥æŠ›å‡º BeanCurrentlyInCreationException å¼‚å¸¸ã€‚

```java
@Component
public class A {
    private B b;
    
    public A(B b) {  // æ„é€ æ–¹æ³•æ³¨å…¥
        this.b = b;
    }
}

@Component
public class B {
    private A a;
    
    public B(A a) {  // æ„é€ æ–¹æ³•æ³¨å…¥
        this.a = a;
    }
}
```

å› ä¸ºæ„é€ æ–¹æ³•æ³¨å…¥å‘ç”Ÿåœ¨å®ä¾‹åŒ–é˜¶æ®µï¼Œåˆ›å»º A çš„æ—¶å€™å¿…é¡»å…ˆæœ‰ Bï¼Œä½†åˆ›å»º Båˆå¿…é¡»å…ˆæœ‰ Aï¼Œè¿™æ—¶å€™ä¸¤ä¸ªå¯¹è±¡éƒ½è¿˜æ²¡åˆ›å»ºå‡ºæ¥ï¼Œæ— æ³•æå‰æš´éœ²åˆ°ç¼“å­˜ä¸­ã€‚

ç¬¬äºŒç§ï¼Œprototype ä½œç”¨åŸŸçš„å¾ªç¯ä¾èµ–ã€‚prototype ä½œç”¨åŸŸçš„ Bean æ¯æ¬¡è·å–éƒ½ä¼šåˆ›å»ºæ–°å®ä¾‹ï¼ŒSpring æ— æ³•ç¼“å­˜è¿™äº›å®ä¾‹ï¼Œæ‰€ä»¥ä¹Ÿæ— æ³•è§£å†³å¾ªç¯ä¾èµ–ã€‚

----é¢è¯•ä¸­å¯ä»¥ä¸èƒŒï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ start----

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå®ä¾‹ï¼Œå…ˆæ˜¯ PrototypeBeanAï¼š

```java
@Component
@Scope("prototype")
public class PrototypeBeanA {
    private final PrototypeBeanB prototypeBeanB;

    @Autowired
    public PrototypeBeanA(PrototypeBeanB prototypeBeanB) {
        this.prototypeBeanB = prototypeBeanB;
    }
}
```

ç„¶åæ˜¯ PrototypeBeanBï¼š

```java
@Component
@Scope("prototype")
public class PrototypeBeanB {
    private final PrototypeBeanA prototypeBeanA;

    @Autowired
    public PrototypeBeanB(PrototypeBeanA prototypeBeanA) {
        this.prototypeBeanA = prototypeBeanA;
    }
}
```

å†ç„¶åæ˜¯æµ‹è¯•ï¼š

```java
@SpringBootApplication
public class DemoApplication {

    public static void main(String[] args) {
        SpringApplication.run(DemoApplication.class, args);
    }

    @Bean
    CommandLineRunner commandLineRunner(ApplicationContext ctx) {
        return args -> {
            // å°è¯•è·å–PrototypeBeanAçš„å®ä¾‹
            PrototypeBeanA beanA = ctx.getBean(PrototypeBeanA.class);
        };
    }
}
```

è¿è¡Œç»“æœï¼š

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šå¾ªç¯ä¾èµ–](https://cdn.tobebetterjavaer.com/stutymore/spring-20240310202703.png)

----é¢è¯•ä¸­å¯ä»¥ä¸èƒŒï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ end----

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³ 25 å±Šæ—¥å¸¸å®ä¹ ä¸€é¢åŸé¢˜ï¼šå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–ï¼Ÿ
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç™¾åº¦é¢ç»åŒå­¦ 1 æ–‡å¿ƒä¸€è¨€ 25 å®ä¹  Java åç«¯é¢è¯•åŸé¢˜ï¼šSpringå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–ï¼Ÿ
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¾—ç‰©é¢ç»åŒå­¦ 9 é¢è¯•é¢˜ç›®åŸé¢˜ï¼šSpringæºç çœ‹è¿‡å—ï¼ŸSpringçš„ä¸‰çº§ç¼“å­˜çŸ¥é“å—ï¼Ÿ
> 4. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„é˜¿é‡Œäº‘é¢ç»åŒå­¦ 22 é¢ç»ï¼šspringä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜

memoï¼š2025 å¹´ 7 æœˆ 5 æ—¥ä¿®æ”¹è‡³æ­¤ã€‚ä»Šå¤© [VIP ç¾¤](https://javabetter.cn/zhishixingqiu/)æ¥äº†éå¸¸å¤šçš„çƒå‹ï¼Œä¸çŸ¥ä¸è§‰æˆ‘ä»¬å·²ç» 12 ç¾¤äº†ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¤§å®¶åº­äº†ï¼Œå¸Œæœ›å¤§å®¶éƒ½èƒ½åœ¨è¿™é‡Œæ‰¾åˆ°è‡ªå·±çš„å½’å±æ„Ÿï¼Œæˆ‘ä»¬ä¸€èµ·å­¦ä¹ ï¼Œä¸€èµ·è¿›æ­¥ã€‚

![äºŒå“¥çš„ç¼–ç¨‹æ˜Ÿçƒå·²ç» 12 ç¾¤äº†](https://cdn.tobebetterjavaer.com/stutymore/spring-20250705072809.png)

### 19.ä¸ºä»€ä¹ˆéœ€è¦ä¸‰çº§ç¼“å­˜è€Œä¸æ˜¯ä¸¤çº§ï¼Ÿ

Spring è®¾è®¡ä¸‰çº§ç¼“å­˜ä¸»è¦æ˜¯ä¸ºäº†è§£å†³ AOP ä»£ç†çš„é—®é¢˜ã€‚

æˆ‘ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹ã€‚å‡è®¾æˆ‘ä»¬æœ‰ A å’Œ B ä¸¤ä¸ªç±»ç›¸äº’ä¾èµ–ï¼ŒA çš„æŸä¸ªæ–¹æ³•ä¸Šé¢è¿˜æ ‡æ³¨äº† `@Transactional` æ³¨è§£ï¼Œè¿™æ„å‘³ç€ A æœ€ç»ˆéœ€è¦è¢« Spring åˆ›å»ºæˆä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚

```java
@Component
public class A {
    @Autowired
    private B b;
    
    @Transactional  // Aéœ€è¦è¢«AOPä»£ç†
    public void doSomething() {
        // ä¸šåŠ¡é€»è¾‘
    }
}

@Component
public class B {
    @Autowired
    private A a;
}
```

å¦‚æœåªæœ‰äºŒçº§ç¼“å­˜çš„è¯ï¼Œå½“åˆ›å»º A çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æŠŠ A çš„åŸå§‹å¯¹è±¡æå‰æ”¾åˆ°ç¼“å­˜é‡Œé¢ï¼Œç„¶å B åœ¨åˆ›å»ºçš„æ—¶å€™ä»ç¼“å­˜ä¸­æ‹¿åˆ° A çš„åŸå§‹å¯¹è±¡ã€‚

```java
// å‡è®¾åªæœ‰ä¸¤çº§ç¼“å­˜
Map<String, Object> singletonObjects = new HashMap<>();     // å®Œæ•´Bean
Map<String, Object> earlySingletonObjects = new HashMap<>(); // åŠæˆå“Bean
```

ä½†æ˜¯é—®é¢˜æ¥äº†ï¼ŒA å®Œæˆåˆå§‹åŒ–åï¼Œç”±äºæœ‰ `@Transactional` æ³¨è§£ï¼ŒSpring ä¼šæŠŠ A åŒ…è£…æˆä¸€ä¸ªä»£ç†å¯¹è±¡æ”¾åˆ°å®¹å™¨ä¸­ã€‚è¿™æ ·å°±å‡ºç°äº†ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜ï¼šB é‡Œé¢æŒæœ‰çš„æ˜¯ A çš„åŸå§‹å¯¹è±¡ï¼Œè€Œå®¹å™¨ä¸­å­˜çš„æ˜¯ A çš„ä»£ç†å¯¹è±¡ï¼ŒåŒä¸€ä¸ª Bean å±…ç„¶æœ‰ä¸¤ä¸ªä¸åŒçš„å®ä¾‹ï¼Œè¿™è‚¯å®šæ˜¯ä¸å¯¹çš„ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šäºŒçº§ç¼“å­˜ä¸è¡Œçš„åŸå› ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-6ece8a46-25b1-459b-8cfa-19fc696dd7d6.png)

ä¸‰çº§ç¼“å­˜å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œè®¾è®¡çš„ã€‚ä¸‰çº§ç¼“å­˜é‡Œé¢å­˜æ”¾çš„ä¸æ˜¯ Bean çš„å®ä¾‹ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯¹è±¡å·¥å‚ï¼Œè¿™æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ã€‚

å½“ B éœ€è¦ A çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨è¿™ä¸ªå¯¹è±¡å·¥å‚çš„ getObject æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•é‡Œé¢ä¼šåˆ¤æ–­ A æ˜¯å¦éœ€è¦è¢«ä»£ç†ã€‚å¦‚æœéœ€è¦ä»£ç†ï¼Œå°±åˆ›å»º A çš„ä»£ç†å¯¹è±¡è¿”å›ç»™ Bï¼›å¦‚æœä¸éœ€è¦ä»£ç†ï¼Œå°±è¿”å› A çš„åŸå§‹å¯¹è±¡ã€‚è¿™æ ·å°±ä¿è¯äº† B æ‹¿åˆ°çš„ A å’Œæœ€ç»ˆæ”¾å…¥å®¹å™¨çš„ A æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚

```java
Map<String, ObjectFactory<?>> singletonFactories = new HashMap<>();
// Springæºç ä¸­çš„é€»è¾‘
addSingletonFactory(beanName, () -> getEarlyBeanReference(beanName, mbd, bean));
protected Object getEarlyBeanReference(String beanName, RootBeanDefinition mbd, Object bean) {
    Object exposedObject = bean;
    if (!mbd.isSynthetic() && hasInstantiationAwareBeanPostProcessors()) {
        for (BeanPostProcessor bp : getBeanPostProcessors()) {
            if (bp instanceof SmartInstantiationAwareBeanPostProcessor) {
                SmartInstantiationAwareBeanPostProcessor ibp = (SmartInstantiationAwareBeanPostProcessor) bp;
                // å…³é”®ï¼šå¦‚æœéœ€è¦ä»£ç†ï¼Œè¿™é‡Œä¼šåˆ›å»ºä»£ç†å¯¹è±¡
                exposedObject = ibp.getEarlyBeanReference(exposedObject, beanName);
            }
        }
    }
    return exposedObject;
}
```

ç®€å•æ¥è¯´ï¼Œä¸‰çº§ç¼“å­˜çš„æ ¸å¿ƒä½œç”¨å°±æ˜¯å»¶è¿Ÿå†³ç­–ã€‚å®ƒè®© Spring åœ¨çœŸæ­£éœ€è¦ Bean çš„æ—¶å€™æ‰å†³å®šè¿”å›åŸå§‹å¯¹è±¡è¿˜æ˜¯ä»£ç†å¯¹è±¡ï¼Œè¿™æ ·å°±é¿å…äº†å¯¹è±¡ä¸ä¸€è‡´çš„é—®é¢˜ã€‚å¦‚æœæ²¡æœ‰ä¸‰çº§ç¼“å­˜ï¼ŒSpring è¦ä¹ˆæ— æ³•åœ¨å¾ªç¯ä¾èµ–çš„æƒ…å†µä¸‹æ”¯æŒ AOPï¼Œè¦ä¹ˆå°±ä¼šå‡ºç°åŒä¸€ä¸ª Bean æœ‰å¤šä¸ªå®ä¾‹çš„é—®é¢˜ï¼Œè¿™äº›éƒ½æ˜¯ä¸å¯æ¥å—çš„ã€‚

![å¹¸äº‘æ•™è‚²ï¼šä¸‰çº§ç¼“å­˜å’Œå¾ªç¯ä¾èµ–](https://cdn.tobebetterjavaer.com/stutymore/spring-20250706065436.png)

#### å¦‚æœç¼ºå°‘äºŒçº§ç¼“å­˜ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ

äºŒçº§ç¼“å­˜ earlySingletonObjects ä¸»è¦æ˜¯ç”¨æ¥å­˜æ”¾é‚£äº›å·²ç»é€šè¿‡ä¸‰çº§ç¼“å­˜çš„å¯¹è±¡å·¥å‚åˆ›å»ºå‡ºæ¥çš„æ—©æœŸ Bean å¼•ç”¨ã€‚

![Minorç‹æ™ºï¼šä¸‰çº§ç¼“å­˜](https://cdn.tobebetterjavaer.com/stutymore/spring-20250706065722.png)

å‡è®¾æˆ‘ä»¬æœ‰ Aã€Bã€C ä¸‰ä¸ª Beanï¼ŒA ä¾èµ– B å’Œ Cï¼ŒB å’Œ C éƒ½ä¾èµ– Aï¼Œå½¢æˆäº†ä¸€ä¸ªå¤æ‚çš„å¾ªç¯ä¾èµ–ã€‚åœ¨æ²¡æœ‰äºŒçº§ç¼“å­˜çš„æƒ…å†µä¸‹ï¼Œæ¯æ¬¡ B æˆ–è€… C éœ€è¦è·å– A çš„æ—¶å€™ï¼Œéƒ½éœ€è¦è°ƒç”¨ä¸‰çº§ç¼“å­˜ä¸­ A çš„ `ObjectFactory.getObject()` æ–¹æ³•ã€‚è¿™æ„å‘³ç€å¦‚æœ A éœ€è¦è¢«ä»£ç†çš„è¯ï¼Œä»£ç†å¯¹è±¡å¯èƒ½ä¼šè¢«é‡å¤åˆ›å»ºå¤šæ¬¡ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ã€‚

```java
// æ²¡æœ‰äºŒçº§ç¼“å­˜çš„ä¼ªä»£ç 
public Object getSingleton(String beanName) {
    Object singletonObject = singletonObjects.get(beanName);
    
    if (singletonObject == null && isSingletonCurrentlyInCreation(beanName)) {
        // ç›´æ¥ä»ä¸‰çº§ç¼“å­˜è·å–
        ObjectFactory<?> singletonFactory = singletonFactories.get(beanName);
        if (singletonFactory != null) {
            return singletonFactory.getObject(); // æ¯æ¬¡éƒ½ä¼šåˆ›å»ºæ–°çš„ä»£ç†å¯¹è±¡ï¼
        }
    }
    return singletonObject;
}
```

æˆ‘ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ã€‚æ¯”å¦‚ A æœ‰ `@Transactional` æ³¨è§£éœ€è¦è¢« AOP ä»£ç†ï¼ŒB åœ¨åˆå§‹åŒ–çš„æ—¶å€™éœ€è¦ Aï¼Œä¼šè°ƒç”¨ä¸€æ¬¡å¯¹è±¡å·¥å‚åˆ›å»º A çš„ä»£ç†å¯¹è±¡ã€‚æ¥ç€ C åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¹Ÿéœ€è¦ Aï¼Œåˆä¼šè°ƒç”¨ä¸€æ¬¡å¯¹è±¡å·¥å‚ï¼Œå¯èƒ½åˆåˆ›å»ºäº†ä¸€ä¸ª A çš„ä»£ç†å¯¹è±¡ã€‚è¿™æ · B å’Œ C æ‹¿åˆ°çš„å¯èƒ½å°±æ˜¯ä¸¤ä¸ªä¸åŒçš„ A ä»£ç†å¯¹è±¡ï¼Œè¿™å°±è¿åäº†å•ä¾‹ Bean çš„è¯­ä¹‰ã€‚

```java
@Service
public class ServiceA {
    @Autowired
    private ServiceB serviceB;
    
    @Transactional  // éœ€è¦ AOP ä»£ç†
    public void methodA() {
        // ä¸šåŠ¡é€»è¾‘
    }
}

@Service
public class ServiceB {
    @Autowired
    private ServiceA serviceA;  // è·å¾—ä»£ç†å¯¹è±¡ A1
    
    @Autowired
    private ServiceC serviceC;
}

@Service
public class ServiceC {
    @Autowired
    private ServiceA serviceA;  // å¯èƒ½è·å¾—ä»£ç†å¯¹è±¡ A2
}
```

äºŒçº§ç¼“å­˜å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å½“ç¬¬ä¸€æ¬¡é€šè¿‡å¯¹è±¡å·¥å‚åˆ›å»ºäº† A çš„æ—©æœŸå¼•ç”¨ä¹‹åï¼Œå°±æŠŠè¿™ä¸ªå¼•ç”¨æ”¾åˆ°äºŒçº§ç¼“å­˜ä¸­ï¼ŒåŒæ—¶ä»ä¸‰çº§ç¼“å­˜ä¸­ç§»é™¤å¯¹è±¡å·¥å‚ã€‚

```java
// ç¬¬ä¸€æ¬¡è·å– A
ObjectFactory<A> factory = singletonFactories.get("serviceA");
Object proxyA = factory.getObject(); // åˆ›å»ºä»£ç†
earlySingletonObjects.put("serviceA", proxyA); // ç¼“å­˜ä»£ç†
singletonFactories.remove("serviceA");

// ç¬¬äºŒæ¬¡è·å– A
Object cachedA = earlySingletonObjects.get("serviceA"); // ç›´æ¥è¿”å›ç¼“å­˜çš„ä»£ç†
// proxyA == cachedA  âœ“
```

åç»­å¦‚æœå†æœ‰å…¶ä»– Bean éœ€è¦ Aï¼Œå°±ç›´æ¥ä»äºŒçº§ç¼“å­˜ä¸­è·å–ï¼Œä¸éœ€è¦å†è°ƒç”¨å¯¹è±¡å·¥å‚äº†ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¿«æ‰‹åŒå­¦ 4 ä¸€é¢åŸé¢˜ï¼šå¾ªç¯ä¾èµ–æœ‰äº†è§£è¿‡å—ï¼Ÿå‡ºç°å¾ªç¯ä¾èµ–çš„åŸå› ï¼Ÿä¸‰å¤§ç¼“å­˜å­˜å‚¨å†…å®¹çš„åŒºåˆ«ï¼Ÿå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–ï¼Ÿå¦‚æœç¼ºå°‘ç¬¬äºŒçº§ç¼“å­˜ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ

<MZNXQRcodeBanner />

memoï¼š2025 å¹´ 7 æœˆ 6 æ—¥ä¿®æ”¹è‡³æ­¤ï¼Œä»Šå¤©åœ¨æ˜Ÿçƒé‡Œçœ‹åˆ°ä¸€ä¸ªçƒå‹çš„[ç§‹æ‹›æ‰“å¡](https://javabetter.cn/zhishixingqiu/)ï¼Œå·²ç»æŒç»­ 30 å¤©äº†ï¼ŒæŒ‰ç…§ä»–è¿™ä¸ªèŠ‚å¥ä¸‹å»ï¼Œäº’è”ç½‘å¤§å‚çš„ offer åŸºæœ¬ä¸Šå°±ç®—æ˜¯é”å®šäº†ã€‚å¹¶ä¸”è¿˜æœ‰å‡†å¤‡ RAG MCP çš„å…«è‚¡ï¼Œå¾ˆæ£’ã€‚

![çƒå‹åœ¨æ˜Ÿçƒé‡Œçš„ç§‹æ‹›æ‰“å¡è®°å½•](https://cdn.tobebetterjavaer.com/stutymore/spring-20250706070700.png)

## AOP

### 20.ğŸŒŸè¯´è¯´ä»€ä¹ˆæ˜¯ AOPï¼Ÿ

AOPï¼Œä¹Ÿå°±æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œç®€å•ç‚¹è¯´ï¼ŒAOP å°±æ˜¯æŠŠä¸€äº›ä¸šåŠ¡é€»è¾‘ä¸­çš„ç›¸åŒä»£ç æŠ½å–åˆ°ä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ä¸­ï¼Œè®©ä¸šåŠ¡é€»è¾‘æ›´åŠ æ¸…çˆ½ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ¨ªå‘æŠ½å–](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-09dbcda4-7c1b-42d6-8520-1a5fc84abbde.png)

----è¿™éƒ¨åˆ†é¢è¯•ä¸­å¯ä»¥ä¸èƒŒï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ start----

ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰å¾ˆå¤šä¸ª Service æ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½éœ€è¦è®°å½•æ‰§è¡Œæ—¥å¿—ã€æ£€æŸ¥æƒé™ã€ç®¡ç†äº‹åŠ¡ç­‰ç­‰ã€‚å¦‚æœæ²¡æœ‰ AOP çš„è¯ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨æ¯ä¸ªæ–¹æ³•é‡Œéƒ½å†™è¿™æ ·çš„ä»£ç ï¼š

```java
public void createUser(User user) {
    log.info("å¼€å§‹æ‰§è¡ŒcreateUseræ–¹æ³•");
    // æƒé™æ£€æŸ¥
    if (!hasPermission()) {
        throw new SecurityException("æ— æƒé™");
    }
    // å¼€å¯äº‹åŠ¡
    transactionManager.begin();
    try {
        // çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘
        userDao.save(user);
        transactionManager.commit();
        log.info("createUseræ–¹æ³•æ‰§è¡ŒæˆåŠŸ");
    } catch (Exception e) {
        transactionManager.rollback();
        log.error("createUseræ–¹æ³•æ‰§è¡Œå¤±è´¥", e);
        throw e;
    }
}
```

å¦‚æœæ¯ä¸ªæ–¹æ³•éƒ½è¿™æ ·å†™ï¼Œä»£ç å°±ä¼šå˜å¾—éå¸¸è‡ƒè‚¿ï¼ŒAOP å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬æŠŠè¿™äº›æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—ã€æƒé™ã€äº‹åŠ¡ç­‰ï¼‰ä»ä¸šåŠ¡ä»£ç ä¸­æŠ½å–å‡ºæ¥ã€‚

è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®šä¹‰ä¸€ä¸ªåˆ‡é¢ï¼Œåœ¨åˆ‡é¢ä¸­ç»Ÿä¸€å¤„ç†è¿™äº›æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼š

```java
@Aspect
@Component
public class LoggingAspect {
    @Before("execution(* com.example.service.*.*(..))")
    public void logBefore(JoinPoint joinPoint) {
        log.info("å¼€å§‹æ‰§è¡Œæ–¹æ³•: " + joinPoint.getSignature().getName());
    }
    @AfterReturning("execution(* com.example.service.*.*(..))")
    public void logAfterReturning(JoinPoint joinPoint) {
        log.info("æ–¹æ³•æ‰§è¡ŒæˆåŠŸ: " + joinPoint.getSignature().getName());
    }
    @AfterThrowing(pointcut = "execution(* com.example.service.*.*(..))",
                   throwing = "ex")
    public void logAfterThrowing(JoinPoint joinPoint, Throwable ex) {
        log.error("æ–¹æ³•æ‰§è¡Œå¤±è´¥: " + joinPoint.getSignature().getName(), ex);
    }
}
```

ç„¶åï¼Œä¸šåŠ¡ä»£ç å°±å˜å¾—éå¸¸å¹²å‡€äº†ï¼š

```java
public void createUser(User user) {
    // åªéœ€è¦å…³æ³¨ä¸šåŠ¡é€»è¾‘ï¼Œä¸éœ€è¦å…³å¿ƒæ—¥å¿—ã€æƒé™ã€äº‹åŠ¡ç­‰
    userDao.save(user);
}
```

----é¢è¯•ä¸­å¯ä»¥ä¸èƒŒï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ end----

ä»æŠ€æœ¯å®ç°ä¸Šæ¥è¯´ï¼ŒAOP ä¸»è¦æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†æ¥å®ç°çš„ã€‚å¦‚æœç›®æ ‡ç±»å®ç°äº†æ¥å£ï¼Œå°±ç”¨ JDK åŠ¨æ€ä»£ç†ï¼›å¦‚æœæ²¡æœ‰å®ç°æ¥å£ï¼Œå°±ç”¨ CGLIB æ¥åˆ›å»ºå­ç±»ä»£ç†ã€‚ä»£ç†å¯¹è±¡ä¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰åæ’å…¥æˆ‘ä»¬å®šä¹‰çš„åˆ‡é¢é€»è¾‘ã€‚

![stack overflowï¼šJDK Proxy vs CGLIB Proxy](https://cdn.tobebetterjavaer.com/stutymore/spring-20250707112900.png)

#### Spring AOP æœ‰å“ªäº›æ ¸å¿ƒæ¦‚å¿µï¼Ÿ

Spring AOP æ˜¯ AOP çš„ä¸€ä¸ªå…·ä½“å®ç°ï¼Œæˆ‘æŒ‰ç…§åœ¨å·¥ä½œ/å­¦ä¹ ä¸­ç†è§£çš„é‡è¦ç¨‹åº¦æ¥è¯´ä¸€ä¸‹ï¼š

![DataFlair Teamï¼šAOP æ ¸å¿ƒæ¦‚å¿µ](https://cdn.tobebetterjavaer.com/stutymore/spring-20250707114823.png)

â‘ ã€**åˆ‡é¢**ï¼šæˆ‘ä»¬å®šä¹‰çš„ä¸€ä¸ªç±»ï¼ŒåŒ…å«äº†è¦åœ¨ä»€ä¹ˆæ—¶å€™ã€ä»€ä¹ˆåœ°æ–¹æ‰§è¡Œä»€ä¹ˆé€»è¾‘ã€‚æ¯”å¦‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ—¥å¿—åˆ‡é¢ï¼Œä¸“é—¨è´Ÿè´£è®°å½•æ–¹æ³•çš„æ‰§è¡Œæƒ…å†µã€‚åœ¨ Spring ä¸­ï¼Œæˆ‘ä»¬ä¼šç”¨ `@Aspect` æ³¨è§£æ¥æ ‡è¯†ä¸€ä¸ªåˆ‡é¢ç±»ã€‚

â‘¡ã€**åˆ‡ç‚¹**ï¼šå®šä¹‰äº†åœ¨å“ªäº›åœ°æ–¹åº”ç”¨åˆ‡é¢é€»è¾‘ã€‚è¯´ç™½äº†å°±æ˜¯å‘Šè¯‰ Springï¼Œæˆ‘è¿™ä¸ªåˆ‡é¢è¦åœ¨å“ªäº›æ–¹æ³•ä¸Šç”Ÿæ•ˆã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªåˆ‡ç‚¹è¡¨è¾¾å¼ï¼Œè®©å®ƒåŒ¹é…æ‰€æœ‰ Service å±‚çš„æ–¹æ³•ï¼Œæˆ–è€…åŒ¹é…æŸä¸ªç‰¹å®šåŒ…ä¸‹çš„æ‰€æœ‰æ–¹æ³•ã€‚åœ¨ Spring ä¸­ç”¨ `@Pointcut` æ³¨è§£æ¥å®šä¹‰ï¼Œé€šå¸¸ä¼šå†™ä¸€äº›è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ `execution( com.example.service..*(..))` è¿™æ ·çš„ã€‚

â‘¢ã€**é€šçŸ¥**ï¼šæ˜¯åˆ‡é¢ä¸­å…·ä½“è¦æ‰§è¡Œçš„ä»£ç é€»è¾‘ã€‚å®ƒæœ‰å‡ ç§ç±»å‹ï¼š`@Before` æ˜¯åœ¨æ–¹æ³•æ‰§è¡Œå‰æ‰§è¡Œï¼Œ`@After` æ˜¯åœ¨æ–¹æ³•æ‰§è¡Œåæ‰§è¡Œï¼Œ`@Around` æ˜¯ç¯ç»•é€šçŸ¥ï¼Œå¯ä»¥åœ¨æ–¹æ³•æ‰§è¡Œå‰åéƒ½æ‰§è¡Œï¼Œ`@AfterReturning` æ˜¯åœ¨æ–¹æ³•æ­£å¸¸è¿”å›åæ‰§è¡Œï¼Œ`@AfterThrowing` æ˜¯åœ¨æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åæ‰§è¡Œã€‚æˆ‘ä¸€èˆ¬ç”¨å¾—æœ€å¤šçš„æ˜¯ `@Around`ï¼Œå› ä¸ºå®ƒæœ€çµæ´»ï¼Œå¯ä»¥æ§åˆ¶æ–¹æ³•æ˜¯å¦æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹å‚æ•°å’Œè¿”å›å€¼ã€‚

â‘£ã€**è¿æ¥ç‚¹**ï¼šè¢«æ‹¦æˆªåˆ°çš„ç‚¹ï¼Œå› ä¸º Spring åªæ”¯æŒæ–¹æ³•ç±»å‹çš„è¿æ¥ç‚¹ï¼Œæ‰€ä»¥åœ¨ Spring ä¸­ï¼Œè¿æ¥ç‚¹æŒ‡çš„æ˜¯è¢«æ‹¦æˆªåˆ°çš„æ–¹æ³•ï¼Œå®é™…ä¸Šè¿æ¥ç‚¹è¿˜å¯ä»¥æ˜¯å­—æ®µæˆ–è€…æ„é€ æ–¹æ³•ã€‚

â‘¤ã€**ç»‡å…¥**ï¼šæ˜¯æŠŠåˆ‡é¢é€»è¾‘åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡çš„è¿‡ç¨‹ã€‚Spring AOP æ˜¯åœ¨è¿è¡Œæ—¶é€šè¿‡åŠ¨æ€ä»£ç†æ¥å®ç°ç»‡å…¥çš„ï¼Œå½“æˆ‘ä»¬ä» Spring å®¹å™¨ä¸­è·å– Bean çš„æ—¶å€™ï¼Œå¦‚æœè¿™ä¸ª Bean éœ€è¦è¢«åˆ‡é¢å¤„ç†ï¼ŒSpring å°±ä¼šè¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡ç»™æˆ‘ä»¬ã€‚

â‘¥ã€**ç›®æ ‡å¯¹è±¡**ï¼šè¢«åˆ‡é¢å¤„ç†çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³æ—¶å†™çš„ Serviceã€Controller ç­‰ç±»ã€‚Spring AOP ä¼šåœ¨ç›®æ ‡å¯¹è±¡ä¸Šç»‡å…¥åˆ‡é¢é€»è¾‘ã€‚

å®ƒä»¬ä¹‹é—´çš„é€»è¾‘å…³ç³»å›¾æ˜¯è¿™æ ·çš„ï¼š

```
åˆ‡é¢ï¼ˆAspectï¼‰
    â”œâ”€â”€ åˆ‡å…¥ç‚¹ï¼ˆPointcutï¼‰â”€â”€â”€ å®šä¹‰åœ¨å“ªé‡Œæ‰§è¡Œ
    â””â”€â”€ é€šçŸ¥ï¼ˆAdviceï¼‰   â”€â”€â”€ å®šä¹‰ä½•æ—¶æ‰§è¡Œä»€ä¹ˆ
            â”œâ”€â”€ @Before
            â”œâ”€â”€ @After
            â”œâ”€â”€ @AfterReturning
            â”œâ”€â”€ @AfterThrowing
            â””â”€â”€ @Around

ç›®æ ‡å¯¹è±¡ï¼ˆTargetï¼‰â”€â”€â†’ ä»£ç†å¯¹è±¡ï¼ˆProxyï¼‰â”€â”€â†’ ç»‡å…¥ï¼ˆWeavingï¼‰
     â†‘                                    â†“
è¿æ¥ç‚¹ï¼ˆJoin Pointï¼‰                    å®¢æˆ·ç«¯è°ƒç”¨
```

#### Spring AOP ç»‡å…¥æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ

ç»‡å…¥æœ‰ä¸‰ç§ä¸»è¦æ–¹å¼ï¼Œæˆ‘æŒ‰ç…§å®ƒä»¬çš„æ‰§è¡Œæ—¶æœºæ¥è¯´ä¸€ä¸‹ã€‚

![AOP ç»‡å…¥æ–¹å¼](https://cdn.tobebetterjavaer.com/stutymore/spring-20250707120111.png)

ç¼–è¯‘æœŸç»‡å…¥æ˜¯åœ¨ç¼–è¯‘ Java æºç çš„æ—¶å€™å°±æŠŠåˆ‡é¢é€»è¾‘ç»‡å…¥åˆ°ç›®æ ‡ç±»ä¸­ã€‚è¿™ç§æ–¹å¼æœ€å…¸å‹çš„å®ç°å°±æ˜¯ AspectJ ç¼–è¯‘å™¨ã€‚å®ƒä¼šåœ¨ç¼–è¯‘çš„æ—¶å€™ç›´æ¥ä¿®æ”¹å­—èŠ‚ç ï¼ŒæŠŠåˆ‡é¢çš„é€»è¾‘æ’å…¥åˆ°ç›®æ ‡æ–¹æ³•ä¸­ã€‚

```java
// æºä»£ç 
@Aspect
public class LoggingAspect {
    @Before("execution(* com.example.service.*.*(..))")
    public void logBefore(JoinPoint joinPoint) {
        System.out.println("æ–¹æ³•æ‰§è¡Œå‰: " + joinPoint.getSignature().getName());
    }
}

@Service
public class UserService {
    public void saveUser(String username) {
        System.out.println("ä¿å­˜ç”¨æˆ·: " + username);
    }
}
```

è¿™æ ·ç”Ÿæˆçš„ class æ–‡ä»¶å°±å·²ç»åŒ…å«äº†åˆ‡é¢é€»è¾‘ï¼Œè¿è¡Œæ—¶ä¸éœ€è¦é¢å¤–çš„ä»£ç†æœºåˆ¶ã€‚

```java
// ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç 
public class UserService {
    public void saveUser(String username) {
        // ç»‡å…¥çš„åˆ‡é¢ä»£ç 
        System.out.println("æ–¹æ³•æ‰§è¡Œå‰: saveUser");
        
        // åŸå§‹ä¸šåŠ¡ä»£ç 
        System.out.println("ä¿å­˜ç”¨æˆ·: " + username);
    }
}
```

ç¼–è¯‘æœŸç»‡å…¥çš„ä¼˜ç‚¹æ˜¯æ€§èƒ½æœ€å¥½ï¼Œå› ä¸ºæ²¡æœ‰ä»£ç†çš„å¼€é”€ï¼Œä½†ç¼ºç‚¹æ˜¯éœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„ç¼–è¯‘å™¨ï¼Œè€Œä¸”æ¯”è¾ƒå¤æ‚ï¼Œåœ¨ Spring é¡¹ç›®ä¸­ç”¨å¾—ä¸å¤šã€‚

ç±»åŠ è½½æœŸç»‡å…¥æ˜¯åœ¨ JVM åŠ è½½ class æ–‡ä»¶çš„æ—¶å€™è¿›è¡Œç»‡å…¥ã€‚è¿™ç§æ–¹å¼é€šè¿‡ Java çš„ Instrumentation API æˆ–è€…è‡ªå®šä¹‰çš„ ClassLoader æ¥å®ç°ï¼Œåœ¨ç±»è¢«åŠ è½½åˆ° JVM ä¹‹å‰ä¿®æ”¹å­—èŠ‚ç ã€‚

```java
public class WeavingClassLoader extends ClassLoader {
    @Override
    protected Class<?> findClass(String name) throws ClassNotFoundException {
        byte[] classBytes = loadClassBytes(name);
        
        // åœ¨è¿™é‡Œè¿›è¡Œå­—èŠ‚ç ç»‡å…¥
        byte[] wovenBytes = weaveAspects(classBytes);
        
        return defineClass(name, wovenBytes, 0, wovenBytes.length);
    }
    
    private byte[] weaveAspects(byte[] classBytes) {
        // ä½¿ç”¨ ASM æˆ–å…¶ä»–å­—èŠ‚ç æ“ä½œåº“è¿›è¡Œç»‡å…¥
        return classBytes;
    }
}
```

AspectJ çš„ Load-Time Weaving å°±æ˜¯è¿™ç§æ–¹å¼çš„å…¸å‹å®ç°ã€‚å®ƒæ¯”ç¼–è¯‘æœŸç»‡å…¥æ›´çµæ´»ä¸€äº›ï¼Œä½†æ˜¯é…ç½®ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦åœ¨ JVM å¯åŠ¨å‚æ•°ä¸­æŒ‡å®š Java agentï¼Œåœ¨ Spring ä¸­ä¹Ÿæœ‰æ”¯æŒï¼Œä½†ç”¨å¾—ä¸æ˜¯ç‰¹åˆ«å¤šã€‚

```shell
# JVM å¯åŠ¨å‚æ•°
java -javaagent:aspectjweaver.jar -jar myapp.jar
```

è¿è¡Œæ—¶ç»‡å…¥æ˜¯æˆ‘ä»¬åœ¨ Spring ä¸­æœ€å¸¸è§çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†æ¥å®ç°ã€‚Spring AOP é‡‡ç”¨çš„å°±æ˜¯è¿™ç§æ–¹å¼ã€‚å½“ Spring å®¹å™¨å¯åŠ¨çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°æŸä¸ª Bean éœ€è¦è¢«åˆ‡é¢å¤„ç†ï¼Œå°±ä¼šä¸ºè¿™ä¸ª Bean åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚å¦‚æœç›®æ ‡ç±»å®ç°äº†æ¥å£ï¼ŒSpring ä¼šä½¿ç”¨ JDK çš„åŠ¨æ€ä»£ç†æŠ€æœ¯ã€‚

```java
// æ¥å£
public interface UserService {
    void saveUser(String username);
}

// å®ç°ç±»
@Service
public class UserServiceImpl implements UserService {
    @Override
    public void saveUser(String username) {
        System.out.println("ä¿å­˜ç”¨æˆ·: " + username);
    }
}

// Spring è‡ªåŠ¨åˆ›å»ºçš„ä»£ç†ï¼ˆä¼ªä»£ç ï¼‰
public class UserServiceProxy implements UserService {
    private UserService target;
    private List<Advisor> advisors;
    
    @Override
    public void saveUser(String username) {
        // æ‰§è¡Œå‰ç½®é€šçŸ¥
        for (Advisor advisor : advisors) {
            if (advisor.getPointcut().matches(this.getClass().getMethod("saveUser", String.class))) {
                advisor.getAdvice().before();
            }
        }
        
        // æ‰§è¡Œç›®æ ‡æ–¹æ³•
        target.saveUser(username);
        
        // æ‰§è¡Œåç½®é€šçŸ¥
        for (Advisor advisor : advisors) {
            advisor.getAdvice().after();
        }
    }
}
```

å¦‚æœç›®æ ‡ç±»æ²¡æœ‰å®ç°æ¥å£ï¼Œå°±ä¼šä½¿ç”¨ CGLIB æ¥åˆ›å»ºä¸€ä¸ªå­ç±»ä½œä¸ºä»£ç†ã€‚è¿è¡Œæ—¶ç»‡å…¥çš„ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œä¸éœ€è¦ç‰¹æ®Šçš„ç¼–è¯‘å™¨æˆ– JVM é…ç½®ï¼Œç¼ºç‚¹æ˜¯æœ‰ä¸€å®šçš„æ€§èƒ½å¼€é”€ï¼Œå› ä¸ºæ¯æ¬¡æ–¹æ³•è°ƒç”¨éƒ½è¦ç»è¿‡ä»£ç†ã€‚

```java
// æ²¡æœ‰æ¥å£çš„ç±»
@Service
public class OrderService {
    public void createOrder(String orderId) {
        System.out.println("åˆ›å»ºè®¢å•: " + orderId);
    }
}

// CGLIB ç”Ÿæˆçš„ä»£ç†å­ç±»ï¼ˆä¼ªä»£ç ï¼‰
public class OrderService$$EnhancerByCGLIB$$12345 extends OrderService {
    private MethodInterceptor interceptor;
    
    @Override
    public void createOrder(String orderId) {
        // é€šè¿‡ MethodInterceptor æ‰§è¡Œåˆ‡é¢é€»è¾‘
        interceptor.intercept(this, getMethod("createOrder"), new Object[]{orderId}, 
                            new MethodProxy() {
                                @Override
                                public Object invokeSuper(Object obj, Object[] args) {
                                    return OrderService.super.createOrder((String) args[0]);
                                }
                            });
    }
}
```

Spring AOP é»˜è®¤çš„ç»‡å…¥æ–¹å¼å°±æ˜¯è¿è¡Œæ—¶ç»‡å…¥ï¼Œä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ï¼Œåªéœ€è¦åŠ ä¸ª `@Aspect` æ³¨è§£å’Œç›¸åº”çš„é€šçŸ¥æ³¨è§£å°±å¯ä»¥äº†ã€‚è™½ç„¶æ€§èƒ½ä¸Šä¸å¦‚ç¼–è¯‘æœŸç»‡å…¥ï¼Œä½†æ˜¯å¯¹äºå¤§éƒ¨åˆ†ä¸šåŠ¡åœºæ™¯æ¥è¯´ï¼Œè¿™ç‚¹æ€§èƒ½å¼€é”€æ˜¯å®Œå…¨å¯ä»¥æ¥å—çš„ã€‚

```java
// Spring AOP çš„ä»£ç†åˆ›å»ºè¿‡ç¨‹
@Configuration
@EnableAspectJAutoProxy  // å¯ç”¨ AOP è‡ªåŠ¨ä»£ç†
public class AopConfig {
}

// Spring å†…éƒ¨çš„ä»£ç†åˆ›å»ºé€»è¾‘ï¼ˆç®€åŒ–ç‰ˆï¼‰
public class DefaultAopProxyFactory implements AopProxyFactory {
    
    @Override
    public AopProxy createAopProxy(AdvisedSupport config) {
        if (config.isOptimize() || config.isProxyTargetClass() || hasNoUserSuppliedProxyInterfaces(config)) {
            // ä½¿ç”¨ CGLIB ä»£ç†
            return new CglibAopProxy(config);
        } else {
            // ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†
            return new JdkDynamicAopProxy(config);
        }
    }
}
```

#### AspectJ æ˜¯ä»€ä¹ˆï¼Ÿ

AspectJ æ˜¯ä¸€ä¸ª AOP æ¡†æ¶ï¼Œå®ƒå¯ä»¥åšå¾ˆå¤š Spring AOP å¹²ä¸äº†çš„äº‹æƒ…ï¼Œæ¯”å¦‚è¯´ç¼–è¯‘æ—¶ã€ç¼–è¯‘åå’Œç±»åŠ è½½æ—¶ç»‡å…¥åˆ‡é¢ã€‚å¹¶ä¸”æä¾›äº†å¾ˆå¤šå¤æ‚çš„åˆ‡ç‚¹è¡¨è¾¾å¼å’Œé€šçŸ¥ç±»å‹ã€‚

![AspectJ å®˜ç½‘](https://cdn.tobebetterjavaer.com/stutymore/spring-20240806100537.png)

Spring AOP åªæ”¯æŒæ–¹æ³•çº§åˆ«çš„æ‹¦æˆªï¼Œè€Œä¸”åªèƒ½æ‹¦æˆª Spring å®¹å™¨ç®¡ç†çš„ Beanã€‚ä½†æ˜¯ AspectJ å¯ä»¥æ‹¦æˆªä»»ä½• Java å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ã€å­—æ®µè®¿é—®ã€æ„é€ æ–¹æ³•æ‰§è¡Œã€å¼‚å¸¸å¤„ç†ç­‰ç­‰ã€‚

```java
// Spring AOP åªèƒ½åšåˆ°è¿™äº›
@Aspect
@Component
public class SpringAopAspect {
    // âœ… å¯ä»¥æ‹¦æˆªï¼špublic æ–¹æ³•è°ƒç”¨
    @Around("execution(public * com.example.service.*.*(..))") 
    public Object aroundPublicMethod(ProceedingJoinPoint pjp) {
        return pjp.proceed();
    }
    
    // âŒ æ— æ³•æ‹¦æˆªï¼šå­—æ®µè®¿é—®
    // âŒ æ— æ³•æ‹¦æˆªï¼šæ„é€ å‡½æ•°
    // âŒ æ— æ³•æ‹¦æˆªï¼šç§æœ‰æ–¹æ³•
    // âŒ æ— æ³•æ‹¦æˆªï¼šé™æ€æ–¹æ³•
}
```

#### Spring AOP æœ‰å“ªäº›é€šçŸ¥æ–¹å¼ï¼Ÿ

Spring AOP æä¾›äº†å¤šç§é€šçŸ¥æ–¹å¼ï¼Œå…è®¸æˆ‘ä»¬åœ¨æ–¹æ³•æ‰§è¡Œçš„ä¸åŒé˜¶æ®µæ’å…¥é€»è¾‘ã€‚å¸¸ç”¨çš„é€šçŸ¥æ–¹å¼æœ‰ï¼š

- å‰ç½®é€šçŸ¥ (@Before)
- è¿”å›é€šçŸ¥ (@AfterReturning)
- å¼‚å¸¸é€šçŸ¥ (@AfterThrowing)
- åç½®é€šçŸ¥ (@After)
- ç¯ç»•é€šçŸ¥ (@Around)

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring AOP é€šçŸ¥æ–¹å¼](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-320fa34f-6620-419c-b17a-4f516a83caeb.png)

å‰ç½®é€šçŸ¥æ˜¯åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œçš„é€šçŸ¥ã€‚è¿™ç§é€šçŸ¥æ¯”è¾ƒç®€å•ï¼Œä¸»è¦ç”¨æ¥åšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œæ¯”å¦‚å‚æ•°æ ¡éªŒã€æƒé™æ£€æŸ¥ã€è®°å½•æ–¹æ³•å¼€å§‹æ‰§è¡Œçš„æ—¥å¿—ç­‰ç­‰ã€‚å‰ç½®é€šçŸ¥æ— æ³•é˜»æ­¢ç›®æ ‡æ–¹æ³•çš„æ‰§è¡Œï¼Œä¹Ÿæ— æ³•ä¿®æ”¹æ–¹æ³•çš„å‚æ•°ï¼Œå®ƒåªèƒ½åœ¨æ–¹æ³•æ‰§è¡Œå‰åšä¸€äº›é¢å¤–çš„æ“ä½œã€‚æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ç»å¸¸ç”¨å®ƒæ¥è®°å½•æ“ä½œæ—¥å¿—ï¼Œæ¯”å¦‚è®°å½•è°åœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨äº†ä»€ä¹ˆæ–¹æ³•ã€‚

```java
@Aspect
@Component
public class LoggingAspect {
    @Before("execution(* com.example.service.*.*(..))")
    public void logBefore(JoinPoint joinPoint) {
        // æ‰“å°æ–¹æ³•åå’Œå‚æ•°
        System.out.println("è°ƒç”¨æ–¹æ³•: " + joinPoint.getSignature().getName());
        System.out.println("å‚æ•°: " + Arrays.toString(joinPoint.getArgs()));
    }
}
```

åç½®é€šçŸ¥æ˜¯åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå®Œæˆåæ‰§è¡Œçš„ï¼Œä¸ç®¡æ–¹æ³•æ˜¯æ­£å¸¸è¿”å›è¿˜æ˜¯æŠ›å‡ºå¼‚å¸¸éƒ½ä¼šæ‰§è¡Œã€‚è¿™ç§é€šçŸ¥ä¸»è¦ç”¨æ¥åšä¸€äº›æ¸…ç†å·¥ä½œï¼Œæ¯”å¦‚é‡Šæ”¾èµ„æºã€è®°å½•æ–¹æ³•æ‰§è¡Œå®Œæˆçš„æ—¥å¿—ç­‰ç­‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåç½®é€šçŸ¥æ‹¿ä¸åˆ°æ–¹æ³•çš„è¿”å›å€¼ï¼Œä¹Ÿæ•è·ä¸åˆ°å¼‚å¸¸ä¿¡æ¯ï¼Œå®ƒå°±æ˜¯çº¯ç²¹çš„åœ¨æ–¹æ³•æ‰§è¡Œååšä¸€äº›æ”¶å°¾å·¥ä½œã€‚

```java
@Aspect
@Component
public class LoggingAspect {
    @After("execution(* com.example.service.*.*(..))")
    public void logAfter(JoinPoint joinPoint) {
        // æ‰“å°æ–¹æ³•æ‰§è¡Œå®Œæˆçš„æ—¥å¿—
        System.out.println("æ–¹æ³•æ‰§è¡Œå®Œæˆ: " + joinPoint.getSignature().getName());
    }
}
```

è¿”å›é€šçŸ¥æ˜¯åœ¨ç›®æ ‡æ–¹æ³•æ­£å¸¸è¿”å›åæ‰§è¡Œçš„ã€‚è¿™ç§é€šçŸ¥å¯ä»¥è·å–åˆ°æ–¹æ³•çš„è¿”å›å€¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ³¨è§£ä¸­æŒ‡å®š returning å‚æ•°æ¥æ¥æ”¶è¿”å›å€¼ã€‚è¿”å›é€šçŸ¥ç»å¸¸ç”¨æ¥åšä¸€äº›åŸºäºè¿”å›ç»“æœçš„åç»­å¤„ç†ï¼Œæ¯”å¦‚ç¼“å­˜æ–¹æ³•çš„è¿”å›ç»“æœã€æ ¹æ®è¿”å›å€¼å‘é€é€šçŸ¥ç­‰ç­‰ã€‚å¦‚æœæ–¹æ³•æŠ›å‡ºå¼‚å¸¸çš„è¯ï¼Œè¿”å›é€šçŸ¥æ˜¯ä¸ä¼šæ‰§è¡Œçš„ã€‚

```java
@Aspect
@Component
public class LoggingAspect {
    @AfterReturning(pointcut = "execution(* com.example.service.*.*(..))", returning = "result")
    public void logAfterReturning(JoinPoint joinPoint, Object result) {
        // æ‰“å°æ–¹æ³•æ‰§è¡Œå®Œæˆçš„æ—¥å¿—
        System.out.println("æ–¹æ³•æ‰§è¡Œå®Œæˆ: " + joinPoint.getSignature().getName());
        // æ‰“å°æ–¹æ³•è¿”å›å€¼
        System.out.println("è¿”å›å€¼: " + result);
    }
}
```

å¼‚å¸¸é€šçŸ¥æ˜¯åœ¨ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åæ‰§è¡Œçš„ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ³¨è§£ä¸­æŒ‡å®š throwing å‚æ•°æ¥æ¥æ”¶å¼‚å¸¸å¯¹è±¡ã€‚å¼‚å¸¸é€šçŸ¥ä¸»è¦ç”¨æ¥åšå¼‚å¸¸å¤„ç†å’Œè®°å½•ï¼Œæ¯”å¦‚è®°å½•é”™è¯¯æ—¥å¿—ã€å‘é€å‘Šè­¦ã€å¼‚å¸¸ç»Ÿè®¡ç­‰ç­‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¼‚å¸¸é€šçŸ¥ä¸èƒ½å¤„ç†å¼‚å¸¸ï¼Œå¼‚å¸¸è¿˜æ˜¯ä¼šç»§ç»­å‘ä¸ŠæŠ›å‡ºã€‚

```java
@Aspect
@Component
public class LoggingAspect {
    @AfterThrowing(pointcut = "execution(* com.example.service.*.*(..))",
                     throwing = "ex")
    public void logAfterThrowing(JoinPoint joinPoint, Throwable ex) {
        // æ‰“å°æ–¹æ³•åå’Œå¼‚å¸¸ä¿¡æ¯
        System.out.println("æ–¹æ³•æ‰§è¡Œå¼‚å¸¸: " + joinPoint.getSignature().getName());
        System.out.println("å¼‚å¸¸ä¿¡æ¯: " + ex.getMessage());
    }
}
```

ç¯ç»•é€šçŸ¥æ˜¯æœ€å¼ºå¤§ä¹Ÿæ˜¯æˆ‘ä»¬ç”¨å¾—æœ€å¤šçš„ä¸€ç§é€šçŸ¥ã€‚å®ƒå¯ä»¥åœ¨æ–¹æ³•æ‰§è¡Œå‰åéƒ½æ‰§è¡Œé€»è¾‘ï¼Œè€Œä¸”å¯ä»¥æ§åˆ¶ç›®æ ‡æ–¹æ³•æ˜¯å¦æ‰§è¡Œï¼Œè¿˜å¯ä»¥ä¿®æ”¹æ–¹æ³•çš„å‚æ•°å’Œè¿”å›å€¼ã€‚ç¯ç»•é€šçŸ¥çš„æ–¹æ³•å¿…é¡»æ¥æ”¶ä¸€ä¸ª ProceedingJoinPoint å‚æ•°ï¼Œé€šè¿‡è°ƒç”¨å…¶ `proceed()` æ–¹æ³•æ¥æ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚

[æŠ€æœ¯æ´¾](https://javabetter.cn/zhishixingqiu/paicoding.html) é¡¹ç›®ä¸­å°±ä¸»è¦æ˜¯é€šè¿‡ç¯ç»•é€šçŸ¥æ¥å®ç°åˆ‡é¢ã€‚

![æŠ€æœ¯æ´¾æºç ï¼šç¯ç»•é€šçŸ¥](https://cdn.tobebetterjavaer.com/stutymore/spring-20250707151431.png)

å¦‚æœæœ‰å¤šä¸ªåˆ‡é¢ï¼Œè¿˜å¯ä»¥é€šè¿‡ `@Order` æ³¨è§£æŒ‡å®šå…ˆåé¡ºåºï¼Œæ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
@Aspect
@Component
public class WebLogAspect {

    private final static Logger logger = LoggerFactory.getLogger(WebLogAspect.class);

    @Pointcut("@annotation(cn.fighter3.spring.aop_demo.WebLog)")
    public void webLog() {}

    @Before("webLog()")
    public void doBefore(JoinPoint joinPoint) throws Throwable {
        // å¼€å§‹æ‰“å°è¯·æ±‚æ—¥å¿—
        ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
        HttpServletRequest request = attributes.getRequest();
        // æ‰“å°è¯·æ±‚ç›¸å…³å‚æ•°
        logger.info("========================================== Start ==========================================");
        // æ‰“å°è¯·æ±‚ url
        logger.info("URL            : {}", request.getRequestURL().toString());
        // æ‰“å° Http method
        logger.info("HTTP Method    : {}", request.getMethod());
        // æ‰“å°è°ƒç”¨ controller çš„å…¨è·¯å¾„ä»¥åŠæ‰§è¡Œæ–¹æ³•
        logger.info("Class Method   : {}.{}", joinPoint.getSignature().getDeclaringTypeName(), joinPoint.getSignature().getName());
        // æ‰“å°è¯·æ±‚çš„ IP
        logger.info("IP             : {}", request.getRemoteAddr());
        // æ‰“å°è¯·æ±‚å…¥å‚
        logger.info("Request Args   : {}",new ObjectMapper().writeValueAsString(joinPoint.getArgs()));
    }

    @After("webLog()")
    public void doAfter() throws Throwable {
        // ç»“æŸåæ‰“ä¸ªåˆ†éš”çº¿ï¼Œæ–¹ä¾¿æŸ¥çœ‹
        logger.info("=========================================== End ===========================================");
    }

    @Around("webLog()")
    public Object doAround(ProceedingJoinPoint proceedingJoinPoint) throws Throwable {
        //å¼€å§‹æ—¶é—´
        long startTime = System.currentTimeMillis();
        Object result = proceedingJoinPoint.proceed();
        // æ‰“å°å‡ºå‚
        logger.info("Response Args  : {}", new ObjectMapper().writeValueAsString(result));
        // æ‰§è¡Œè€—æ—¶
        logger.info("Time-Consuming : {} ms", System.currentTimeMillis() - startTime);
        return result;
    }
}
```

#### Spring AOP å‘ç”Ÿåœ¨ä»€ä¹ˆæ—¶å€™ï¼Ÿ

Spring AOP æ˜¯åœ¨ Bean çš„åˆå§‹åŒ–é˜¶æ®µå‘ç”Ÿçš„ï¼Œå…·ä½“æ¥è¯´æ˜¯åœ¨ Bean ç”Ÿå‘½å‘¨æœŸçš„åç½®å¤„ç†é˜¶æ®µã€‚

åœ¨ Bean å®ä¾‹åŒ–å®Œæˆã€å±æ€§æ³¨å…¥å®Œæˆä¹‹åï¼ŒSpring ä¼šè°ƒç”¨æ‰€æœ‰ BeanPostProcessor çš„ postProcessAfterInitialization æ–¹æ³•ï¼ŒAOP ä»£ç†çš„åˆ›å»ºå°±æ˜¯åœ¨è¿™ä¸ªé˜¶æ®µå®Œæˆçš„ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šBeanPostProcessor](https://cdn.tobebetterjavaer.com/stutymore/spring-20240806102547.png)

#### ç®€å•æ€»ç»“ä¸€ä¸‹ AOP

AOPï¼Œä¹Ÿå°±æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œæ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œæ—¨åœ¨æé«˜ä»£ç çš„æ¨¡å—åŒ–ã€‚æ¯”å¦‚è¯´å¯ä»¥å°†æ—¥å¿—è®°å½•ã€äº‹åŠ¡ç®¡ç†ç­‰åˆ†ç¦»å‡ºæ¥ï¼Œæ¥æé«˜ä»£ç çš„å¯é‡ç”¨æ€§ã€‚

AOP çš„æ ¸å¿ƒæ¦‚å¿µåŒ…æ‹¬åˆ‡é¢ã€è¿æ¥ç‚¹ã€é€šçŸ¥ã€åˆ‡ç‚¹å’Œç»‡å…¥ç­‰ã€‚

â‘  åƒæ—¥å¿—æ‰“å°ã€äº‹åŠ¡ç®¡ç†ç­‰éƒ½å¯ä»¥æŠ½ç¦»ä¸ºåˆ‡é¢ï¼Œå¯ä»¥å£°æ˜åœ¨ç±»çš„æ–¹æ³•ä¸Šã€‚åƒ `@Transactional` æ³¨è§£ï¼Œå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ AOP åº”ç”¨ï¼Œå®ƒå°±æ˜¯é€šè¿‡ AOP æ¥å®ç°äº‹åŠ¡ç®¡ç†çš„ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨æ–¹æ³•ä¸Šæ·»åŠ  `@Transactional` æ³¨è§£ï¼ŒSpring å°±ä¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰åæ·»åŠ äº‹åŠ¡ç®¡ç†çš„é€»è¾‘ã€‚

â‘¡ Spring AOP æ˜¯åŸºäºä»£ç†çš„ï¼Œå®ƒé»˜è®¤ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†å’Œ CGLIB ä»£ç†æ¥å®ç° AOPã€‚

â‘¢ Spring AOP çš„ç»‡å…¥æ–¹å¼æ˜¯è¿è¡Œæ—¶ç»‡å…¥ï¼Œè€Œ AspectJ æ”¯æŒç¼–è¯‘æ—¶ç»‡å…¥ã€ç±»åŠ è½½æ—¶ç»‡å…¥ã€‚

#### AOPå’Œ OOP çš„å…³ç³»ï¼Ÿ

AOP å’Œ OOP æ˜¯äº’è¡¥çš„ç¼–ç¨‹æ€æƒ³ï¼š

1. OOP é€šè¿‡ç±»å’Œå¯¹è±¡å°è£…æ•°æ®å’Œè¡Œä¸ºï¼Œä¸“æ³¨äºæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€‚
2. AOP æä¾›äº†è§£å†³æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—ã€æƒé™ã€äº‹åŠ¡ç­‰ï¼‰çš„æœºåˆ¶ï¼Œå°†è¿™äº›é€»è¾‘é›†ä¸­ç®¡ç†ã€‚


> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„è…¾è®¯ Java åç«¯å®ä¹ ä¸€é¢åŸé¢˜ï¼šè¯´è¯´ AOP çš„åŸç†ã€‚
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³ 25 å±Šæ—¥å¸¸å®ä¹ ä¸€é¢åŸé¢˜ï¼šè¯´è¯´ä½ å¯¹ AOP å’Œ IoC çš„ç†è§£ã€‚
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¿«æ‰‹é¢ç»åŒå­¦ 7 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šè¯´ä¸€ä¸‹ Spring AOP çš„å®ç°åŸç†
> 4. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°å…¬å¸é¢ç»åˆé›†åŒå­¦ 1 Java åç«¯é¢è¯•åŸé¢˜ï¼šä»‹ç» Spring IoC å’Œ AOP?
> 5. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„æ‹›å•†é“¶è¡Œé¢ç»åŒå­¦ 6 æ‹›é“¶ç½‘ç»œç§‘æŠ€é¢è¯•åŸé¢˜ï¼šSpringBootæ¡†æ¶çš„AOPã€IOC/DIï¼Ÿ
> 6. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç¾å›¢é¢ç»åŒå­¦ 4 ä¸€é¢é¢è¯•åŸé¢˜ï¼šSpring AOPå‘ç”Ÿåœ¨ä»€ä¹ˆæ—¶å€™
> 7. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç†æƒ³æ±½è½¦é¢ç»åŒå­¦ 2 ä¸€é¢é¢è¯•åŸé¢˜ï¼šSpring AOPçš„æ¦‚å¿µäº†è§£å—ï¼ŸAOPå’Œ OOP çš„å…³ç³»ï¼Ÿ

memoï¼š2025 å¹´ 7 æœˆ 7 æ—¥ä¿®æ”¹è‡³æ­¤ï¼Œæœ‰çƒå‹æé—®è¦ä¸€ä¸ªè¯¦ç»†ç‰ˆçš„å­¦ä¹ è®¡åˆ’è¡¨ï¼Œæˆ‘ç”¨äº†ä¸€ä¸ªæ—©ä¸Šçš„æ—¶é—´æ•´ç†äº†ä¸€ä¸ªä¸‰ä¸ªæœˆçš„å†²åˆºè®¡åˆ’ï¼ŒåŒ…æ‹¬å…«è‚¡ã€ç®—æ³•ã€é¡¹ç›®çš„å®‰æ’ï¼Œå·²ç»æ”¾åœ¨äº†[ Java é¢è¯•æŒ‡å—](https://javabetter.cn/zhishixingqiu/mianshi.html)ä¸­ï¼Œéœ€è¦çš„å°ä¼™ä¼´å¯ä»¥è‡ªå–åšä¸ªå‚è€ƒã€‚

![å­¦ä¹ è®¡åˆ’è¡¨-ä¸‰ä¸ªæœˆç§‹æ‹›å†²åˆºè®¡åˆ’](https://cdn.tobebetterjavaer.com/stutymore/spring-20250707153345.png)

### 21.ğŸŒŸAOPçš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ

ç­”ï¼šAOP åœ¨å®é™…å·¥ä½œ/ç¼–ç å­¦ä¹ ä¸­æœ‰å¾ˆå¤šåº”ç”¨åœºæ™¯ï¼Œæˆ‘æŒ‰ç…§ä½¿ç”¨é¢‘ç‡æ¥è¯´è¯´å‡ ä¸ªä¸»è¦çš„ã€‚

äº‹åŠ¡ç®¡ç†æ˜¯ç”¨å¾—æœ€å¤šçš„åœºæ™¯ï¼ŒåŸºæœ¬ä¸Šæ¯ä¸ªé¡¹ç›®éƒ½ä¼šç”¨åˆ°ã€‚åªéœ€è¦åœ¨ Service æ–¹æ³•ä¸ŠåŠ ä¸ª `@Transactional` æ³¨è§£ï¼ŒSpring å°±ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬ç®¡ç†äº‹åŠ¡çš„å¼€å¯ã€æäº¤å’Œå›æ»šã€‚

![æŠ€æœ¯æ´¾æºç ï¼š@Transactionaläº‹åŠ¡](https://cdn.tobebetterjavaer.com/stutymore/spring-20250708161139.png)

æ—¥å¿—è®°å½•ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„åº”ç”¨ã€‚åœ¨[æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®](https://javabetter.cn/zhishixingqiu/paicoding.html)ä¸­ï¼Œå°±åˆ©ç”¨äº† AOP æ¥æ‰“å°æ¥å£çš„å…¥å‚å’Œå‡ºå‚æ—¥å¿—ã€æ‰§è¡Œæ—¶é—´ï¼Œæ–¹ä¾¿åæœŸ bug æº¯æºå’Œæ€§èƒ½è°ƒä¼˜ã€‚

![æ²‰é»˜ç‹äºŒï¼šæŠ€æœ¯æ´¾æ•™ç¨‹](https://cdn.tobebetterjavaer.com/stutymore/spring-20240310180334.png)

----è¿™éƒ¨åˆ†é¢è¯•å¯ä»¥ä¸èƒŒï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ start----

ç¬¬ä¸€æ­¥ï¼Œå®šä¹‰ `@MdcDot` æ³¨è§£ï¼š

```java
@Target({ElementType.METHOD, ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface MdcDot {
    String bizCode() default "";
}
```

ç¬¬äºŒæ­¥ï¼Œé…ç½® MdcAspect åˆ‡é¢ï¼Œæ‹¦æˆªå¸¦æœ‰ `@MdcDot` æ³¨è§£çš„æ–¹æ³•æˆ–ç±»ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå‰åè¿›è¡Œ MDC æ“ä½œï¼Œè®°å½•æ–¹æ³•æ‰§è¡Œè€—æ—¶ã€‚

![æŠ€æœ¯æ´¾é¡¹ç›®ï¼šé…ç½® AOP åˆ‡é¢](https://cdn.tobebetterjavaer.com/stutymore/spring-20240310180741.png)

ç¬¬ä¸‰æ­¥ï¼Œåœ¨éœ€è¦çš„åœ°æ–¹åŠ ä¸Š `@MdcDot` æ³¨è§£ã€‚

![æŠ€æœ¯æ´¾é¡¹ç›®ï¼šä½¿ç”¨æ³¨è§£](https://cdn.tobebetterjavaer.com/stutymore/spring-20240310181233.png)

ç¬¬å››æ­¥ï¼Œå½“æ¥å£è¢«è°ƒç”¨æ—¶ï¼Œå°±å¯ä»¥çœ‹åˆ°å¯¹åº”çš„æ‰§è¡Œæ—¥å¿—ã€‚

```
2023-06-16 11:06:13,008 [http-nio-8080-exec-3] INFO |00000000.1686884772947.468581113|101|c.g.p.forum.core.mdc.MdcAspect.handle(MdcAspect.java:47) - æ–¹æ³•æ‰§è¡Œè€—æ—¶: com.github.paicoding.forum.web.front.article.rest.ArticleRestController#recommend = 47
```

----é¢è¯•å¯ä»¥ä¸èƒŒï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ end----

é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰æƒé™æ§åˆ¶ã€æ€§èƒ½ç›‘æ§ã€ç¼“å­˜å¤„ç†ç­‰åœºæ™¯ã€‚æ€»çš„æ¥è¯´ï¼Œä»»ä½•éœ€è¦åœ¨å¤šä¸ªåœ°æ–¹é‡å¤æ‰§è¡Œçš„é€šç”¨é€»è¾‘ï¼Œéƒ½å¯ä»¥è€ƒè™‘ç”¨ AOP æ¥å®ç°ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 5 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šAOPåº”ç”¨åœºæ™¯
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç†æƒ³æ±½è½¦é¢ç»åŒå­¦ 2 ä¸€é¢é¢è¯•åŸé¢˜ï¼šAOPçš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 9 é¢è¯•åŸé¢˜ï¼šé¡¹ç›®ä¸­çš„AOPæ˜¯æ€ä¹ˆç”¨åˆ°çš„

memoï¼š2025 å¹´ 7 æœˆ 8 æ—¥ä¿®æ”¹è‡³æ­¤ï¼Œä»Šå¤©åœ¨æ˜Ÿçƒçš„ VIP ç¾¤é‡Œåˆçœ‹åˆ°åœ¨å¹[é¢æ¸£é€†è¢­](https://javabetter.cn/sidebar/sanfene/nixi.html)çš„ï¼Œçƒå‹è¯´ç¾å›¢ã€å°çº¢ä¹¦å…«è‚¡éƒ½æ²¡é—®é¢˜ï¼Œçœ‹äºŒå“¥çš„è¶³å¤Ÿã€‚

![å¹äºŒå“¥çš„é¢æ¸£é€†è¢­](https://cdn.tobebetterjavaer.com/stutymore/spring-20250708165006.png)

### 22.è¯´è¯´ Spring AOP å’Œ AspectJ åŒºåˆ«?

Spring AOP åªæ”¯æŒæ–¹æ³•çº§åˆ«çš„ç»‡å…¥ï¼Œè€Œä¸”åªèƒ½æ‹¦æˆª Spring å®¹å™¨ç®¡ç†çš„ Beanã€‚ä½†æ˜¯ AspectJ å‡ ä¹å¯ä»¥ç»‡å…¥ä»»ä½•åœ°æ–¹ï¼ŒåŒ…æ‹¬æ–¹æ³•ã€å­—æ®µã€æ„é€ æ–¹æ³•ã€å¼‚å¸¸å¤„ç†ç­‰ç­‰ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring AOPå’ŒAspectJå¯¹æ¯”](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-d1dbe9d9-c55f-4293-8622-d9759064d613.png)

ä»å®ç°æœºåˆ¶ä¸Šæ¥è¯´ï¼ŒSpring AOP æ˜¯åŸºäºåŠ¨æ€ä»£ç†å®ç°çš„ï¼Œåœ¨è¿è¡Œæ—¶ä¸ºç›®æ ‡å¯¹è±¡åˆ›å»ºä»£ç†ï¼Œé€šè¿‡ä»£ç†æ¥æ‰§è¡Œåˆ‡é¢é€»è¾‘ã€‚è€Œ AspectJ æ˜¯é€šè¿‡å­—èŠ‚ç ç»‡å…¥æ¥å®ç°çš„ï¼Œå®ƒç›´æ¥ä¿®æ”¹ç›®æ ‡ç±»çš„å­—èŠ‚ç ï¼ŒæŠŠåˆ‡é¢é€»è¾‘ç¼–ç»‡åˆ°ç›®æ ‡æ–¹æ³•ä¸­ã€‚

åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¤§éƒ¨åˆ†æ—¶å€™ç”¨çš„éƒ½æ˜¯ Spring AOPï¼Œå› ä¸ºå®ƒèƒ½æ»¡è¶³ç»å¤§å¤šæ•°éœ€æ±‚ï¼Œè€Œä¸”ä½¿ç”¨ç®€å•ã€‚åªæœ‰åœ¨é‡åˆ° Spring AOP æ— æ³•è§£å†³çš„é—®é¢˜æ—¶ï¼Œæ¯”å¦‚éœ€è¦ç»‡å…¥ç¬¬ä¸‰æ–¹ jar åŒ…ä¸­çš„æ–¹æ³•ï¼Œæˆ–è€…ç›‘æ§å­—æ®µæ‰ä¼šè€ƒè™‘å¼•å…¥ AspectJã€‚

Spring AOP å€Ÿé‰´äº†å¾ˆå¤š AspectJ çš„æ¦‚å¿µå’Œæ³¨è§£ï¼Œæˆ‘ä»¬åœ¨ Spring ä¸­ä½¿ç”¨çš„ `@Aspect`ã€`@Pointcut` è¿™äº›æ³¨è§£ï¼Œå…¶å®éƒ½æ˜¯ AspectJ å®šä¹‰çš„ã€‚

### 23.è¯´è¯´ AOP å’Œåå°„çš„åŒºåˆ«ï¼Ÿï¼ˆè¡¥å……ï¼‰

>2024 å¹´ 7 æœˆ 27 æ—¥å¢è¡¥ã€‚

åå°„ä¸»è¦æ˜¯ä¸ºäº†è®©ç¨‹åºèƒ½å¤Ÿæ£€æŸ¥å’Œæ“ä½œè‡ªèº«çš„ç»“æ„ï¼Œæ¯”å¦‚è·å–ç±»çš„ä¿¡æ¯ã€è°ƒç”¨æ–¹æ³•ã€è®¿é—®å­—æ®µç­‰ç­‰ã€‚è€Œ AOP åˆ™æ˜¯ä¸ºäº†åœ¨ä¸ä¿®æ”¹ä¸šåŠ¡ä»£ç çš„å‰æä¸‹ï¼ŒåŠ¨æ€åœ°ä¸ºæ–¹æ³•æ·»åŠ é¢å¤–çš„è¡Œä¸ºï¼Œæ¯”å¦‚æ—¥å¿—è®°å½•ã€äº‹åŠ¡ç®¡ç†ç­‰ã€‚

ä»æŠ€æœ¯å®ç°æ¥è¯´ï¼Œåå°„æ˜¯ Java è¯­è¨€æœ¬èº«æä¾›çš„åŠŸèƒ½ï¼Œé€šè¿‡ `java.lang.reflect` åŒ…ä¸‹çš„ API æ¥å®ç°ã€‚è€Œ AOP é€šå¸¸éœ€è¦æ¡†æ¶æ”¯æŒï¼Œæ¯”å¦‚ Spring AOP æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†å®ç°çš„ï¼Œè€ŒåŠ¨æ€ä»£ç†åˆæ˜¯åŸºäºåå°„å®ç°çš„ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¾—ç‰©é¢ç»åŒå­¦ 9 é¢è¯•é¢˜ç›®åŸé¢˜ï¼šæŠ›å¼€Springï¼Œè®²è®²åå°„å’ŒåŠ¨æ€ä»£ç†ï¼Ÿé‚£ä¸‰ç§ä»£ç†æ¨¡å¼æ€ä¹ˆå®ç°çš„ï¼Ÿ

### 24.ğŸŒŸè¯´è¯´JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†çš„åŒºåˆ«ï¼Ÿ

JDK åŠ¨æ€ä»£ç†å’Œ CGLIB ä»£ç†æ˜¯ Spring AOP ç”¨æ¥åˆ›å»ºä»£ç†å¯¹è±¡çš„ä¸¤ç§æ–¹å¼ã€‚

![logbasexï¼šJDK åŠ¨æ€ä»£ç†å’Œ CGLIB ä»£ç†](https://cdn.tobebetterjavaer.com/stutymore/spring-20250709150533.png)

ä»ä½¿ç”¨æ¡ä»¶æ¥è¯´ï¼ŒJDK åŠ¨æ€ä»£ç†è¦æ±‚ç›®æ ‡ç±»å¿…é¡»å®ç°è‡³å°‘ä¸€ä¸ªæ¥å£ï¼Œå› ä¸ºå®ƒæ˜¯åŸºäºæ¥å£æ¥åˆ›å»ºä»£ç†çš„ã€‚è€Œ CGLIB ä»£ç†ä¸éœ€è¦ç›®æ ‡ç±»å®ç°æ¥å£ï¼Œå®ƒæ˜¯é€šè¿‡ç»§æ‰¿ç›®æ ‡ç±»æ¥åˆ›å»ºä»£ç†çš„ã€‚

è¿™æ˜¯ä¸¤è€…æœ€æ ¹æœ¬çš„åŒºåˆ«ã€‚æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ª TransferService æ¥å£å’Œ TransferServiceImpl å®ç°ç±»ï¼Œå¦‚æœç”¨ JDK åŠ¨æ€ä»£ç†ï¼Œåˆ›å»ºçš„ä»£ç†å¯¹è±¡ä¼šå®ç° TransferService æ¥å£ï¼›

![logbasexï¼šJDK åŠ¨æ€ä»£ç†](https://cdn.tobebetterjavaer.com/stutymore/spring-20250709152040.png)

å¦‚æœç”¨ CGLIBï¼Œä»£ç†å¯¹è±¡ä¼šç»§æ‰¿ TransferServiceImpl ç±»ã€‚

![logbasexï¼šCGLIB ä»£ç†](https://cdn.tobebetterjavaer.com/stutymore/spring-20250709152111.png)

ä»å®ç°åŸç†æ¥è¯´ï¼ŒJDK åŠ¨æ€ä»£ç†æ˜¯ Java åŸç”Ÿæ”¯æŒçš„ï¼Œå®ƒé€šè¿‡åå°„æœºåˆ¶åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºä¸€ä¸ªå®ç°äº†æŒ‡å®šæ¥å£çš„ä»£ç†ç±»ã€‚å½“æˆ‘ä»¬è°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œä¼šè¢«è½¬å‘åˆ° InvocationHandler çš„ invoke æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•é‡Œæ’å…¥åˆ‡é¢é€»è¾‘ï¼Œç„¶åå†é€šè¿‡åå°„è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„çœŸå®æ–¹æ³•ã€‚

```java
public class JdkProxyExample {
    public static void main(String[] args) {
        UserService target = new UserServiceImpl();
        
        UserService proxy = (UserService) Proxy.newProxyInstance(
            target.getClass().getClassLoader(),
            target.getClass().getInterfaces(),
            (proxy1, method, args1) -> {
                System.out.println("Before method: " + method.getName());
                Object result = method.invoke(target, args1);
                System.out.println("After method: " + method.getName());
                return result;
            }
        );
        
        proxy.findUser(1L);
    }
}
```


CGLIB åˆ™æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„å­—èŠ‚ç ç”Ÿæˆåº“ï¼Œå®ƒé€šè¿‡ ASM å­—èŠ‚ç æ¡†æ¶åŠ¨æ€ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»ï¼Œç„¶åé‡å†™çˆ¶ç±»çš„æ–¹æ³•æ¥æ’å…¥åˆ‡é¢é€»è¾‘ã€‚

```java
public class CglibProxyExample {
    public static void main(String[] args) {
        Enhancer enhancer = new Enhancer();
        enhancer.setSuperclass(UserController.class);
        enhancer.setCallback(new MethodInterceptor() {
            @Override
            public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable {
                System.out.println("Before method: " + method.getName());
                Object result = proxy.invokeSuper(obj, args);
                System.out.println("After method: " + method.getName());
                return result;
            }
        });
        
        UserController proxy = (UserController) enhancer.create();
        proxy.getUser(1L);
    }
}
```


#### é€‰æ‹© CGLIB è¿˜æ˜¯ JDK åŠ¨æ€ä»£ç†ï¼Ÿ

å¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°ä»»ä½•æ¥å£ï¼Œå°±åªèƒ½ä½¿ç”¨ CGLIB ä»£ç†ï¼Œå°±æ¯”å¦‚è¯´ Controller å±‚çš„ç±»ã€‚

```java
// æ²¡æœ‰å®ç°æ¥å£çš„Controller
@RestController
public class ArticleController {
    @MdcDot(bizCode = "article.create")
    public ResponseVo<String> create(@RequestBody ArticleReq req) {
        // ä¸šåŠ¡é€»è¾‘
    }
}
```


å¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œé€šå¸¸é¦–é€‰ JDK åŠ¨æ€ä»£ç†ï¼Œæ¯”å¦‚è¯´ Service å±‚çš„ç±»ï¼Œä¸€èˆ¬éƒ½ä¼šå…ˆå®šä¹‰æ¥å£ï¼Œå†å®ç°æ¥å£ã€‚

```java
// æ¥å£å®šä¹‰
public interface ArticleService {
    void saveArticle(Article article);
}

// å®ç°ç±»
@Service
public class ArticleServiceImpl implements ArticleService {
    @Transactional(rollbackFor = Exception.class)
    @Override
    public void saveArticle(Article article) {
        // ä¸šåŠ¡é€»è¾‘
    }
}
```

Spring ä¼šæ ¹æ®ç›®æ ‡ç±»çš„æƒ…å†µè‡ªåŠ¨é€‰æ‹©ä»£ç†æ–¹å¼ã€‚å¦‚æœç›®æ ‡ç±»å®ç°äº†æ¥å£ï¼Œé»˜è®¤ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ï¼›å¦‚æœæ²¡æœ‰å®ç°æ¥å£ï¼Œå°±ä½¿ç”¨ CGLIB ä»£ç†ã€‚ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®å¼ºåˆ¶ Spring ä½¿ç”¨ CGLIBï¼Œæ¯”å¦‚åœ¨ `@EnableAspectJAutoProxy` æ³¨è§£ä¸­è®¾ç½® `proxyTargetClass=true`ã€‚

```java
// Spring Booté»˜è®¤é…ç½®
@EnableAspectJAutoProxy(proxyTargetClass = false)
public class AopConfig {
    // proxyTargetClass = false: ä¼˜å…ˆä½¿ç”¨JDKåŠ¨æ€ä»£ç†
    // proxyTargetClass = true:  å¼ºåˆ¶ä½¿ç”¨CGLIBä»£ç†
}
```

#### ä½ ä¼šç”¨ JDK åŠ¨æ€ä»£ç†å—ï¼Ÿ

ä¼šçš„ã€‚

å‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªå°åœºæ™¯ï¼Œå®¢æœä¸­è½¬ï¼Œè§£å†³ç”¨æˆ·é—®é¢˜ï¼š

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç”¨æˆ·å‘å®¢æœæé—®é¢˜](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-c5c4b247-62dd-43a2-a043-da51c58f77c8.png)

æˆ‘ä»¬å¯ä»¥ç”¨ JDK åŠ¨æ€ä»£ç†æ¥å®ç°è¿™ä¸ªåœºæ™¯ã€‚JDK åŠ¨æ€ä»£ç†çš„æ ¸å¿ƒæ˜¯é€šè¿‡åå°„æœºåˆ¶åœ¨è¿è¡Œæ—¶åˆ›å»ºä¸€ä¸ªå®ç°äº†æŒ‡å®šæ¥å£çš„ä»£ç†ç±»ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šJDKåŠ¨æ€ä»£ç†ç±»å›¾](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-65b14a3f-2653-463e-af77-a8875d3d635c.png)

ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºæ¥å£ã€‚

```java
public interface ISolver {
    void solve();
}
```

ç¬¬äºŒæ­¥ï¼Œå®ç°æ¥å£ã€‚

```java
public class Solver implements ISolver {
    @Override
    public void solve() {
        System.out.println("ç–¯ç‹‚æ‰å¤´å‘è§£å†³é—®é¢˜â€¦â€¦");
    }
}
```

ç¬¬ä¸‰æ­¥ï¼Œä½¿ç”¨ç”¨åå°„ç”Ÿæˆç›®æ ‡å¯¹è±¡çš„ä»£ç†ï¼Œè¿™é‡Œç”¨äº†ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»æ–¹å¼é‡å†™ InvocationHandler æ–¹æ³•ã€‚

```java
public class ProxyFactory {

    // ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡
    private Object target;

    public ProxyFactory(Object target) {
        this.target = target;
    }

    // ä¸ºç›®æ ‡å¯¹è±¡ç”Ÿæˆä»£ç†å¯¹è±¡
    public Object getProxyInstance() {
        return Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(),
                new InvocationHandler() {
                    @Override
                    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
                        System.out.println("è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°æ‚¨ï¼Ÿ");

                        // è°ƒç”¨ç›®æ ‡å¯¹è±¡æ–¹æ³•
                        Object returnValue = method.invoke(target, args);

                        System.out.println("é—®é¢˜å·²ç»è§£å†³å•¦ï¼");
                        return null;
                    }
                });
    }
}
```

ç¬¬å››æ­¥ï¼Œç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡å®ä¾‹ï¼Œé€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ç›®æ ‡å¯¹è±¡æ–¹æ³•ã€‚

```java
public class Client {
    public static void main(String[] args) {
        //ç›®æ ‡å¯¹è±¡:ç¨‹åºå‘˜
        ISolver developer = new Solver();
        //ä»£ç†ï¼šå®¢æœå°å§å§
        ISolver csProxy = (ISolver) new ProxyFactory(developer).getProxyInstance();
        //ç›®æ ‡æ–¹æ³•ï¼šè§£å†³é—®é¢˜
        csProxy.solve();
    }
}
```

#### ä½ ä¼šç”¨ CGLIB åŠ¨æ€ä»£ç†å—ï¼Ÿ

ä¼šçš„ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šCGLIBåŠ¨æ€ä»£ç†ç±»å›¾](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-74da87af-20d1-4a5b-a212-3837a15f0bab.png)

ç¬¬ä¸€æ­¥ï¼šå®šä¹‰ç›®æ ‡ç±» Solverï¼Œå®šä¹‰ solve æ–¹æ³•ï¼Œæ¨¡æ‹Ÿè§£å†³é—®é¢˜çš„è¡Œä¸ºã€‚ç›®æ ‡ç±»ä¸éœ€è¦å®ç°ä»»ä½•æ¥å£ï¼Œè¿™ä¸ JDK åŠ¨æ€ä»£ç†çš„è¦æ±‚ä¸åŒã€‚

```java
public class Solver {

    public void solve() {
        System.out.println("ç–¯ç‹‚æ‰å¤´å‘è§£å†³é—®é¢˜â€¦â€¦");
    }
}
```

ç¬¬äºŒæ­¥ï¼šåˆ›å»ºä»£ç†å·¥å‚ ProxyFactoryï¼Œä½¿ç”¨ CGLIB çš„ Enhancer ç±»æ¥ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»ï¼ˆä»£ç†å¯¹è±¡ï¼‰ã€‚CGLIB å…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ªç›®æ ‡ç±»çš„ä»£ç†ç±»ï¼Œå¹¶é‡å†™ç›®æ ‡æ–¹æ³•ã€‚

```java
public class ProxyFactory implements MethodInterceptor {

    //ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡
    private Object target;

    public ProxyFactory(Object target) {
        this.target = target;
    }

    //ä¸ºç›®æ ‡å¯¹è±¡ç”Ÿæˆä»£ç†å¯¹è±¡
    public Object getProxyInstance() {
        //å·¥å…·ç±»
        Enhancer en = new Enhancer();
        //è®¾ç½®çˆ¶ç±»
        en.setSuperclass(target.getClass());
        //è®¾ç½®å›è°ƒå‡½æ•°
        en.setCallback(this);
        //åˆ›å»ºå­ç±»å¯¹è±¡ä»£ç†
        return en.create();
    }

    @Override
    public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable {
        System.out.println("è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°æ‚¨ï¼Ÿ");
        // æ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³•
        Object returnValue = method.invoke(target, args);
        System.out.println("é—®é¢˜å·²ç»è§£å†³å•¦ï¼");
        return null;
    }

}
```

ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºå®¢æˆ·ç«¯ Clientï¼Œè·å–ä»£ç†å¯¹è±¡å¹¶è°ƒç”¨ç›®æ ‡æ–¹æ³•ã€‚

```java
public class Client {
    public static void main(String[] args) {
        //ç›®æ ‡å¯¹è±¡:ç¨‹åºå‘˜
        Solver developer = new Solver();
        //ä»£ç†ï¼šå®¢æœå°å§å§
        Solver csProxy = (Solver) new ProxyFactory(developer).getProxyInstance();
        //ç›®æ ‡æ–¹æ³•ï¼šè§£å†³é—®é¢˜
        csProxy.solve();
    }
}
```

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¸†è½¯åŒå­¦ 3 Java åç«¯ä¸€é¢çš„åŸé¢˜ï¼šcglib çš„åŸç†
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 22 æš‘æœŸå®ä¹ ä¸€é¢é¢è¯•åŸé¢˜ï¼šSpring AOP å®ç°åŸç†
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³é¢ç»åŒå­¦ F é¢è¯•åŸé¢˜ï¼šä¸¤ç§åŠ¨æ€ä»£ç†çš„åŒºåˆ«
> 4. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 8 Java åç«¯å®ä¹ ä¸€é¢é¢è¯•åŸé¢˜ï¼šspringçš„aopæ˜¯å¦‚ä½•å®ç°çš„
> 5. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„è…¾è®¯äº‘æ™ºé¢ç»åŒå­¦ 20 äºŒé¢é¢è¯•åŸé¢˜ï¼šspring aopçš„åº•å±‚åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ
> 6. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç¾å›¢é¢ç»åŒå­¦ 3 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šjavaçš„åå°„æœºåˆ¶ï¼Œåå°„çš„åº”ç”¨åœºæ™¯AOPçš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Œä¸åŠ¨æ€ä»£ç†å’Œåå°„æœ‰ä»€ä¹ˆåŒºåˆ«
> 7. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„æ¯”äºšè¿ªé¢ç»åŒå­¦ 12 Java æŠ€æœ¯é¢è¯•åŸé¢˜ï¼šä»£ç†ä»‹ç»ä¸€ä¸‹ï¼Œjdkå’Œcglibçš„åŒºåˆ«
> 8. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¿«æ‰‹åŒå­¦ 4 ä¸€é¢åŸé¢˜ï¼šSpring AOPçš„å®ç°åŸç†ï¼ŸJDKåŠ¨æ€ä»£ç†å’ŒCGLibåŠ¨æ€ä»£ç†çš„å„è‡ªå®ç°åŠå…¶åŒºåˆ«ï¼Ÿç°åœ¨éœ€è¦ç»Ÿè®¡æ–¹æ³•çš„å…·ä½“æ‰§è¡Œæ—¶é—´ï¼Œè¯´ä¸‹å¦‚ä½•ä½¿ç”¨AOPæ¥å®ç°ï¼Ÿ
> 9. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç†æƒ³æ±½è½¦é¢ç»åŒå­¦ 2 ä¸€é¢é¢è¯•åŸé¢˜ï¼šäº†è§£AOPåº•å±‚æ˜¯æ€ä¹ˆåšçš„å—ï¼Ÿ

<MZNXQRcodeBanner />

memoï¼š2025 å¹´ 7 æœˆ 10 æ—¥ä¿®æ”¹è‡³æ­¤ï¼Œä»Šå¤©åœ¨ç»™çƒå‹ä¿®æ”¹ç®€å†çš„æ—¶å€™ç¢°åˆ°ä¸€ä¸ª[å¯¹æ˜Ÿçƒéå¸¸è®¤å¯çš„çƒå‹](https://javabetter.cn/zhishixingqiu/)ï¼Œä»–åœ¨æˆ‘çš„å¸®åŠ©ä¸‹ä¹Ÿé¡ºåˆ©æ‰¾åˆ°äº†å®ä¹ ï¼Œå¹¶ä¸”å¤§å®¶ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œä»–æåˆ°çš„è¿™äº›è·¯çº¿è§„åˆ’é—®é¢˜ã€ç®€å†ä¹¦å†™é—®é¢˜ã€ç§‹æ‹›å‡†å¤‡é—®é¢˜ã€é¡¹ç›®é—®é¢˜ï¼Œéƒ½å¯ä»¥åœ¨æ˜Ÿçƒé‡Œæ‰¾åˆ°ç­”æ¡ˆã€‚

![çƒå‹å¯¹æ˜Ÿçƒçš„è®¤å¯](https://cdn.tobebetterjavaer.com/stutymore/spring-20250711172049.png)

## äº‹åŠ¡

### 25.ğŸŒŸè¯´è¯´ä½ å¯¹Springäº‹åŠ¡çš„ç†è§£ï¼Ÿ

Spring æä¾›äº†ä¸¤ç§äº‹åŠ¡ç®¡ç†æ–¹å¼ï¼Œç¼–ç¨‹å¼äº‹åŠ¡å’Œå£°æ˜å¼äº‹åŠ¡ã€‚ç¼–ç¨‹å¼äº‹åŠ¡å°±æ˜¯æˆ‘ä»¬è¦æ‰‹åŠ¨è°ƒç”¨äº‹åŠ¡çš„å¼€å§‹ã€æäº¤ã€å›æ»šè¿™äº›æ“ä½œï¼Œè™½ç„¶çµæ´»ä½†æ˜¯ä»£ç æ¯”è¾ƒç¹çã€‚å£°æ˜å¼äº‹åŠ¡åªéœ€è¦åœ¨éœ€è¦äº‹åŠ¡çš„æ–¹æ³•ä¸ŠåŠ ä¸Š `@Transactional` æ³¨è§£å°±å¥½äº†ï¼ŒSpring ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨å¤„ç†äº‹åŠ¡çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚

![Spring TransactionInterceptor](https://cdn.tobebetterjavaer.com/stutymore/spring-20250711173334.png)

----è¿™éƒ¨åˆ†å¯ä»¥ä¸èƒŒï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ start----

ç¼–ç¨‹å¼äº‹åŠ¡å¯ä»¥ä½¿ç”¨ TransactionTemplate å’Œ PlatformTransactionManager æ¥å®ç°ï¼Œå…è®¸æˆ‘ä»¬åœ¨ä»£ç ä¸­ç›´æ¥æ§åˆ¶äº‹åŠ¡çš„è¾¹ç•Œã€‚

```java
public class AccountService {
    private TransactionTemplate transactionTemplate;

    public void setTransactionTemplate(TransactionTemplate transactionTemplate) {
        this.transactionTemplate = transactionTemplate;
    }

    public void transfer(final String out, final String in, final Double money) {
        transactionTemplate.execute(new TransactionCallbackWithoutResult() {
            @Override
            protected void doInTransactionWithoutResult(TransactionStatus status) {
                // è½¬å‡º
                accountDao.outMoney(out, money);
                // è½¬å…¥
                accountDao.inMoney(in, money);
            }
        });
    }
}
```

----è¿™éƒ¨åˆ†å¯ä»¥ä¸èƒŒï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ end----

Spring äº‹åŠ¡çš„åº•å±‚å®ç°æ˜¯é€šè¿‡ AOP æ¥å®Œæˆçš„ã€‚å½“æˆ‘ä»¬åœ¨æ–¹æ³•ä¸ŠåŠ  `@Transactional` æ³¨è§£åï¼ŒSpring ä¼šä¸ºè¿™ä¸ª Bean åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå‰å¼€å¯äº‹åŠ¡ï¼Œæ–¹æ³•æ­£å¸¸è¿”å›æ—¶æäº¤äº‹åŠ¡ï¼Œå¦‚æœæ–¹æ³•æŠ›å‡ºå¼‚å¸¸å°±å›æ»šäº‹åŠ¡ã€‚

å£°æ˜å¼äº‹åŠ¡çš„ä¼˜ç‚¹æ˜¯ä¸éœ€è¦åœ¨ä¸šåŠ¡é€»è¾‘ä»£ç ä¸­æºæ‚äº‹åŠ¡ç®¡ç†çš„ä»£ç ï¼Œç¼ºç‚¹æ˜¯ï¼Œæœ€ç»†ç²’åº¦åªèƒ½åˆ°æ–¹æ³•çº§åˆ«ï¼Œæ— æ³•åˆ°ä»£ç å—çº§åˆ«ã€‚

```java
@Service
public class AccountService {
    @Autowired
    private AccountDao accountDao;

    @Transactional
    public void transfer(String out, String in, Double money) {
        // è½¬å‡º
        accountDao.outMoney(out, money);
        // è½¬å…¥
        accountDao.inMoney(in, money);
    }
}
```

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„äº¬ä¸œåŒå­¦ 10 åç«¯å®ä¹ ä¸€é¢çš„åŸé¢˜ï¼šSpring äº‹åŠ¡æ€ä¹ˆå®ç°çš„
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å†œä¸šé“¶è¡Œé¢ç»åŒå­¦ 7 Java åç«¯é¢è¯•åŸé¢˜ï¼šSpring å¦‚ä½•ä¿è¯äº‹åŠ¡
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„æ¯”äºšè¿ªé¢ç»åŒå­¦ 12 Java æŠ€æœ¯é¢è¯•åŸé¢˜ï¼šSpringçš„äº‹åŠ¡ç”¨è¿‡å—ï¼Œåœ¨é¡¹ç›®é‡Œé¢æ€ä¹ˆä½¿ç”¨çš„
> 4. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„è™¾çš®é¢ç»åŒå­¦ 13 ä¸€é¢é¢è¯•åŸé¢˜ï¼šspringäº‹åŠ¡
> 5. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„é˜¿é‡Œäº‘é¢ç»åŒå­¦ 22 é¢ç»ï¼šå¦‚ä½•ä½¿ç”¨springå®ç°äº‹åŠ¡

memoï¼š2025 å¹´ 7 æœˆ 11 æ—¥ä¿®æ”¹è‡³æ­¤ï¼Œä»Šå¤©[æœ‰çƒå‹åœ¨ VIP ç¾¤é‡Œè®²](https://javabetter.cn/zhishixingqiu/)ï¼Œé¢æ¸£é€†è¢­çš„ Redisã€MySQLã€JVM ç¯‡éå¸¸å¼ºï¼›å¦å¤–ä¸€ä¸ªçƒå‹ä¹Ÿæ˜¯ç»§ç»­å£ç¢‘è¯´ï¼Œé¢è¿‡å‡ æ¬¡å…¨åŒ…è¿‡ã€‚ğŸ˜„

![çƒå‹å¯¹é¢æ¸£é€†è¢­çš„è®¤å¯](https://cdn.tobebetterjavaer.com/stutymore/spring-20250711174214.png)

### 26.è¯´è¯´ Spring çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Ÿ

å¥½ï¼Œäº‹åŠ¡çš„éš”ç¦»çº§åˆ«å®šä¹‰äº†ä¸€ä¸ªäº‹åŠ¡å¯èƒ½å—å…¶ä»–å¹¶å‘äº‹åŠ¡å½±å“çš„ç¨‹åº¦ã€‚SQL æ ‡å‡†å®šä¹‰äº†å››ä¸ªéš”ç¦»çº§åˆ«ï¼ŒSpring éƒ½æ”¯æŒï¼Œå¹¶ä¸”æä¾›äº†å¯¹åº”çš„æœºåˆ¶æ¥é…ç½®å®ƒä»¬ï¼Œå®šä¹‰åœ¨ TransactionDefinition æ¥å£ä¸­ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://cdn.tobebetterjavaer.com/stutymore/spring-20240326082116.png)

â‘ ã€ISOLATION_DEFAULTï¼šä½¿ç”¨æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼ˆä½ ä»¬çˆ±å’‹å’‹æ»´ ğŸ˜ï¼‰ï¼ŒMySQL é»˜è®¤çš„æ˜¯å¯é‡å¤è¯»ï¼ŒOracle é»˜è®¤çš„è¯»å·²æäº¤ã€‚

â‘¡ã€ISOLATION_READ_UNCOMMITTEDï¼šè¯»æœªæäº¤ï¼Œå…è®¸äº‹åŠ¡è¯»å–æœªè¢«å…¶ä»–äº‹åŠ¡æäº¤çš„æ›´æ”¹ã€‚è¿™æ˜¯éš”ç¦»çº§åˆ«æœ€ä½çš„è®¾ç½®ï¼Œå¯èƒ½ä¼šå¯¼è‡´â€œè„è¯»â€é—®é¢˜ã€‚

â‘¢ã€ISOLATION_READ_COMMITTEDï¼šè¯»å·²æäº¤ï¼Œç¡®ä¿äº‹åŠ¡åªèƒ½è¯»å–å·²ç»è¢«å…¶ä»–äº‹åŠ¡æäº¤çš„æ›´æ”¹ã€‚è¿™å¯ä»¥é˜²æ­¢â€œè„è¯»â€ï¼Œä½†ä»ç„¶å¯èƒ½å‘ç”Ÿâ€œä¸å¯é‡å¤è¯»â€å’Œâ€œå¹»è¯»â€é—®é¢˜ã€‚

â‘£ã€ISOLATION_REPEATABLE_READï¼šå¯é‡å¤è¯»ï¼Œç¡®ä¿äº‹åŠ¡å¯ä»¥å¤šæ¬¡ä»ä¸€ä¸ªå­—æ®µä¸­è¯»å–ç›¸åŒçš„å€¼ï¼Œå³åœ¨è¿™ä¸ªäº‹åŠ¡å†…ï¼Œå…¶ä»–äº‹åŠ¡æ— æ³•æ›´æ”¹è¿™ä¸ªå­—æ®µï¼Œä»è€Œé¿å…äº†â€œä¸å¯é‡å¤è¯»â€ï¼Œä½†ä»å¯èƒ½å‘ç”Ÿâ€œå¹»è¯»â€é—®é¢˜ã€‚

â‘¤ã€ISOLATION_SERIALIZABLEï¼šä¸²è¡ŒåŒ–ï¼Œè¿™æ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®ƒå®Œå…¨éš”ç¦»äº†äº‹åŠ¡ï¼Œç¡®ä¿äº‹åŠ¡åºåˆ—åŒ–æ‰§è¡Œï¼Œä»¥æ­¤æ¥é¿å…â€œè„è¯»â€ã€â€œä¸å¯é‡å¤è¯»â€å’Œâ€œå¹»è¯»â€é—®é¢˜ï¼Œä½†æ€§èƒ½å½±å“ä¹Ÿæœ€å¤§ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„åä¸ºé¢ç»åŒå­¦ 8 æŠ€æœ¯äºŒé¢é¢è¯•åŸé¢˜ï¼šSpring ä¸­çš„äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Ÿ
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³é¢ç»åŒå­¦ E ç¬¬äºŒä¸ªéƒ¨é—¨ Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šspring çš„éš”ç¦»æœºåˆ¶ï¼Œé»˜è®¤æ˜¯å“ªä¸€ç§

### 27.ğŸŒŸSpring çš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶ï¼Ÿ

äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶å®šä¹‰äº†æ–¹æ³•åœ¨è¢«å¦ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•è°ƒç”¨æ—¶çš„äº‹åŠ¡è¡Œä¸ºï¼Œè¿™äº›è¡Œä¸ºå®šä¹‰äº†äº‹åŠ¡çš„è¾¹ç•Œå’Œäº‹åŠ¡ä¸Šä¸‹æ–‡å¦‚ä½•åœ¨æ–¹æ³•è°ƒç”¨é“¾ä¸­ä¼ æ’­ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼š6ç§äº‹åŠ¡ä¼ æ’­æœºåˆ¶](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-a6e2a8dc-9771-4d8b-9d91-76ddee98af1a.png)

Spring çš„é»˜è®¤ä¼ æ’­è¡Œä¸ºæ˜¯ PROPAGATION_REQUIREDï¼Œå³å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚

äº‹åŠ¡ä¼ æ’­æœºåˆ¶æ˜¯ä½¿ç”¨ [ThreadLocal](https://javabetter.cn/thread/ThreadLocal.html) å®ç°çš„ï¼Œæ‰€ä»¥ï¼Œå¦‚æœè°ƒç”¨çš„æ–¹æ³•æ˜¯åœ¨æ–°çº¿ç¨‹ä¸­ï¼Œäº‹åŠ¡ä¼ æ’­ä¼šå¤±æ•ˆã€‚

```java
@Transactional
public void parentMethod() {
    new Thread(() -> childMethod()).start();
}

public void childMethod() {
    // è¿™é‡Œçš„æ“ä½œå°†ä¸ä¼šåœ¨ parentMethod çš„äº‹åŠ¡èŒƒå›´å†…æ‰§è¡Œ
}
```

Spring é»˜è®¤çš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯ PROPAFATION_REQUIREDï¼Œå³å¦‚æœå¤šä¸ª `ServiceX#methodX()` éƒ½å·¥ä½œåœ¨äº‹åŠ¡ç¯å¢ƒä¸‹ï¼Œä¸”ç¨‹åºä¸­å­˜åœ¨è¿™æ ·çš„è°ƒç”¨é“¾ `Service1#method1()->Service2#method2()->Service3#method3()`ï¼Œé‚£ä¹ˆè¿™ 3 ä¸ªæœåŠ¡ç±»çš„ 3 ä¸ªæ–¹æ³•éƒ½é€šè¿‡ Spring çš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶å·¥ä½œåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚

#### protected å’Œ private åŠ äº‹åŠ¡ä¼šç”Ÿæ•ˆå—

åœ¨ Spring ä¸­ï¼Œ**åªæœ‰é€šè¿‡ Spring å®¹å™¨çš„ AOP ä»£ç†è°ƒç”¨çš„å…¬å¼€æ–¹æ³•ï¼ˆpublic methodï¼‰ä¸Šçš„`@Transactional`æ³¨è§£æ‰ä¼šç”Ÿæ•ˆ**ã€‚

å¦‚æœåœ¨ protectedã€private æ–¹æ³•ä¸Šä½¿ç”¨`@Transactional`ï¼Œè¿™äº›äº‹åŠ¡æ³¨è§£å°†ä¸ä¼šç”Ÿæ•ˆï¼ŒåŸå› ï¼šSpring é»˜è®¤ä½¿ç”¨åŸºäº JDK çš„åŠ¨æ€ä»£ç†ï¼ˆå½“æ¥å£å­˜åœ¨æ—¶ï¼‰æˆ–åŸºäº CGLIB çš„ä»£ç†ï¼ˆå½“åªæœ‰ç±»æ—¶ï¼‰æ¥å®ç°äº‹åŠ¡ã€‚è¿™ä¸¤ç§ä»£ç†æœºåˆ¶éƒ½åªèƒ½ä»£ç†å…¬å¼€çš„æ–¹æ³•ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„äº¬ä¸œåŒå­¦ 10 åç«¯å®ä¹ ä¸€é¢çš„åŸé¢˜ï¼šäº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³æ˜¥æ‹›åŒå­¦ K ä¸€é¢é¢è¯•åŸé¢˜ï¼šäº‹åŠ¡ä¼ æ’­ï¼Œprotected å’Œ private åŠ äº‹åŠ¡ä¼šç”Ÿæ•ˆå—,è¿˜æœ‰é‚£äº›ä¸ç”Ÿæ•ˆçš„æƒ…å†µ
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„åä¸ºé¢ç»åŒå­¦ 8 æŠ€æœ¯äºŒé¢é¢è¯•åŸé¢˜ï¼šSpring ä¸­çš„äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Ÿ
> 4. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„oppo é¢ç»åŒå­¦ 8 åç«¯å¼€å‘ç§‹æ‹›ä¸€é¢é¢è¯•åŸé¢˜ï¼šè®²ä¸€ä¸‹Springäº‹åŠ¡ä¼ æ’­æœºåˆ¶
> 5. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„é˜¿é‡Œäº‘é¢ç»åŒå­¦ 22 é¢ç»ï¼šä»‹ç»äº‹åŠ¡ä¼ æ’­æ¨¡å‹

### 28.å£°æ˜å¼äº‹åŠ¡å®ç°åŸç†äº†è§£å—ï¼Ÿ

Spring çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†æ˜¯é€šè¿‡ AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰å’Œä»£ç†æœºåˆ¶å®ç°çš„ã€‚

ç¬¬ä¸€æ­¥ï¼Œ**åœ¨ Bean åˆå§‹åŒ–é˜¶æ®µåˆ›å»ºä»£ç†å¯¹è±¡**ï¼š

Spring å®¹å™¨åœ¨åˆå§‹åŒ–å•ä¾‹ Bean çš„æ—¶å€™ï¼Œä¼šéå†æ‰€æœ‰çš„ BeanPostProcessor å®ç°ç±»ï¼Œå¹¶æ‰§è¡Œå…¶ postProcessAfterInitialization æ–¹æ³•ã€‚

åœ¨æ‰§è¡Œ postProcessAfterInitialization æ–¹æ³•æ—¶ä¼šéå†å®¹å™¨ä¸­æ‰€æœ‰çš„åˆ‡é¢ï¼ŒæŸ¥æ‰¾ä¸å½“å‰ Bean åŒ¹é…çš„åˆ‡é¢ï¼Œè¿™é‡Œä¼šè·å–äº‹åŠ¡çš„å±æ€§åˆ‡é¢ï¼Œä¹Ÿå°±æ˜¯ `@Transactional` æ³¨è§£åŠå…¶å±æ€§å€¼ã€‚

ç„¶åæ ¹æ®å¾—åˆ°çš„åˆ‡é¢åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œé»˜è®¤ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†åˆ›å»ºä»£ç†ï¼Œå¦‚æœç›®æ ‡ç±»æ˜¯æ¥å£ï¼Œåˆ™ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ï¼Œå¦åˆ™ä½¿ç”¨ Cglibã€‚

ç¬¬äºŒæ­¥ï¼Œ**åœ¨æ‰§è¡Œç›®æ ‡æ–¹æ³•æ—¶è¿›è¡Œäº‹åŠ¡å¢å¼ºæ“ä½œ**ï¼š

å½“é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ Bean æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šè§¦å‘å¯¹åº”çš„ AOP å¢å¼ºæ‹¦æˆªå™¨ï¼Œå£°æ˜å¼äº‹åŠ¡æ˜¯ä¸€ç§ç¯ç»•å¢å¼ºï¼Œå¯¹åº”æ¥å£ä¸º`MethodInterceptor`ï¼Œäº‹åŠ¡å¢å¼ºå¯¹è¯¥æ¥å£çš„å®ç°ä¸º`TransactionInterceptor`ï¼Œç±»å›¾å¦‚ä¸‹ï¼š

![å›¾ç‰‡æ¥æºç½‘æ˜“æŠ€æœ¯ä¸“æ ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-97493c7f-c596-4e98-a6a8-dab254d6d1ab.png)

äº‹åŠ¡æ‹¦æˆªå™¨`TransactionInterceptor`åœ¨`invoke`æ–¹æ³•ä¸­ï¼Œé€šè¿‡è°ƒç”¨çˆ¶ç±»`TransactionAspectSupport`çš„`invokeWithinTransaction`æ–¹æ³•è¿›è¡Œäº‹åŠ¡å¤„ç†ï¼ŒåŒ…æ‹¬å¼€å¯äº‹åŠ¡ã€äº‹åŠ¡æäº¤ã€å¼‚å¸¸å›æ»šç­‰ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„äº¬ä¸œåŒå­¦ 10 åç«¯å®ä¹ ä¸€é¢çš„åŸé¢˜ï¼šSpring äº‹åŠ¡æ€ä¹ˆå®ç°çš„

### 29.å£°æ˜å¼äº‹åŠ¡åœ¨å“ªäº›æƒ…å†µä¸‹ä¼šå¤±æ•ˆï¼Ÿ

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå£°æ˜å¼äº‹åŠ¡çš„å‡ ç§å¤±æ•ˆçš„æƒ…å†µ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-381e4ec9-a235-4cfa-9b4d-518095a7502a.png)

#### 1ã€@Transactional åº”ç”¨åœ¨é public ä¿®é¥°çš„æ–¹æ³•ä¸Š

å¦‚æœ Transactional æ³¨è§£åº”ç”¨åœ¨é public ä¿®é¥°çš„æ–¹æ³•ä¸Šï¼ŒTransactional å°†ä¼šå¤±æ•ˆã€‚

æ˜¯å› ä¸ºåœ¨ Spring AOP ä»£ç†æ—¶ï¼ŒTransactionInterceptor ï¼ˆäº‹åŠ¡æ‹¦æˆªå™¨ï¼‰åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰åè¿›è¡Œæ‹¦æˆªï¼ŒDynamicAdvisedInterceptorï¼ˆCglibAopProxy çš„å†…éƒ¨ç±»ï¼‰çš„ intercept æ–¹æ³•æˆ– JdkDynamicAopProxy çš„ invoke æ–¹æ³•ä¼šé—´æ¥è°ƒç”¨ AbstractFallbackTransactionAttributeSource çš„ **computeTransactionAttribute**æ–¹æ³•ï¼Œè·å– Transactional æ³¨è§£çš„äº‹åŠ¡é…ç½®ä¿¡æ¯ã€‚

```java
protected TransactionAttribute computeTransactionAttribute(Method method,
    Class<?> targetClass) {
        // Don't allow no-public methods as required.
        if (allowPublicMethodsOnly() && !Modifier.isPublic(method.getModifiers())) {
        return null;
    }
}
```

æ­¤æ–¹æ³•ä¼šæ£€æŸ¥ç›®æ ‡æ–¹æ³•çš„ä¿®é¥°ç¬¦æ˜¯å¦ä¸º publicï¼Œä¸æ˜¯ public åˆ™ä¸ä¼šè·å– @Transactional çš„å±æ€§é…ç½®ä¿¡æ¯ã€‚

#### 2ã€@Transactional æ³¨è§£å±æ€§ propagation è®¾ç½®é”™è¯¯

- TransactionDefinition.PROPAGATION_SUPPORTSï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼›é”™è¯¯ä½¿ç”¨åœºæ™¯ï¼šåœ¨ä¸šåŠ¡é€»è¾‘å¿…é¡»è¿è¡Œåœ¨äº‹åŠ¡ç¯å¢ƒä¸‹ä»¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§çš„æƒ…å†µä¸‹ä½¿ç”¨ SUPPORTSã€‚
- TransactionDefinition.PROPAGATION_NOT_SUPPORTEDï¼šæ€»æ˜¯ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŒ‚èµ·è¯¥äº‹åŠ¡ã€‚é”™è¯¯ä½¿ç”¨åœºæ™¯ï¼šåœ¨éœ€è¦äº‹åŠ¡æ”¯æŒçš„æ“ä½œä¸­ä½¿ç”¨ NOT_SUPPORTEDã€‚
- TransactionDefinition.PROPAGATION_NEVERï¼šæ€»æ˜¯ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚é”™è¯¯ä½¿ç”¨åœºæ™¯ï¼šåœ¨åº”è¯¥åœ¨äº‹åŠ¡ç¯å¢ƒä¸‹æ‰§è¡Œçš„æ“ä½œä¸­ä½¿ç”¨ NEVERã€‚

#### 3ã€@Transactional æ³¨è§£å±æ€§ rollbackFor è®¾ç½®é”™è¯¯

rollbackFor ç”¨æ¥æŒ‡å®šèƒ½å¤Ÿè§¦å‘äº‹åŠ¡å›æ»šçš„å¼‚å¸¸ç±»å‹ã€‚Spring é»˜è®¤æŠ›å‡ºæœªæ£€æŸ¥ unchecked å¼‚å¸¸ï¼ˆç»§æ‰¿è‡ª RuntimeException çš„å¼‚å¸¸ï¼‰æˆ–è€… Error æ‰å›æ»šäº‹åŠ¡ï¼Œå…¶ä»–å¼‚å¸¸ä¸ä¼šè§¦å‘å›æ»šäº‹åŠ¡ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringé»˜è®¤æ”¯æŒçš„å¼‚å¸¸å›æ»š](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-04053b02-3264-4d7f-b868-560a0333f08d.png)

```java
// å¸Œæœ›è‡ªå®šä¹‰çš„å¼‚å¸¸å¯ä»¥è¿›è¡Œå›æ»š
@Transactional(propagation= Propagation.REQUIRED,rollbackFor= MyException.class)
```

è‹¥åœ¨ç›®æ ‡æ–¹æ³•ä¸­æŠ›å‡ºçš„å¼‚å¸¸æ˜¯ rollbackFor æŒ‡å®šçš„å¼‚å¸¸çš„å­ç±»ï¼Œäº‹åŠ¡åŒæ ·ä¼šå›æ»šã€‚

#### 4ã€åŒä¸€ä¸ªç±»ä¸­æ–¹æ³•è°ƒç”¨ï¼Œå¯¼è‡´@Transactional å¤±æ•ˆ

å¼€å‘ä¸­é¿å…ä¸äº†ä¼šå¯¹åŒä¸€ä¸ªç±»é‡Œé¢çš„æ–¹æ³•è°ƒç”¨ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªç±» Testï¼Œå®ƒçš„ä¸€ä¸ªæ–¹æ³• Aï¼ŒA è°ƒç”¨æœ¬ç±»çš„æ–¹æ³• Bï¼ˆä¸è®ºæ–¹æ³• B æ˜¯ç”¨ public è¿˜æ˜¯ private ä¿®é¥°ï¼‰ï¼Œä½†æ–¹æ³• A æ²¡æœ‰å£°æ˜æ³¨è§£äº‹åŠ¡ï¼Œè€Œ B æ–¹æ³•æœ‰ã€‚

åˆ™å¤–éƒ¨è°ƒç”¨æ–¹æ³• A ä¹‹åï¼Œæ–¹æ³• B çš„äº‹åŠ¡æ˜¯ä¸ä¼šèµ·ä½œç”¨çš„ã€‚è¿™ä¹Ÿæ˜¯ç»å¸¸çŠ¯é”™è¯¯çš„ä¸€ä¸ªåœ°æ–¹ã€‚

é‚£ä¸ºå•¥ä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿå…¶å®è¿˜æ˜¯ç”± Spring AOP ä»£ç†é€ æˆçš„ï¼Œå› ä¸ºåªæœ‰äº‹åŠ¡æ–¹æ³•è¢«å½“å‰ç±»ä»¥å¤–çš„ä»£ç è°ƒç”¨æ—¶ï¼Œæ‰ä¼šç”± Spring ç”Ÿæˆçš„ä»£ç†å¯¹è±¡æ¥ç®¡ç†ã€‚

```java
 //@Transactional
@GetMapping("/test")
private Integer A() throws Exception {
    CityInfoDict cityInfoDict = new CityInfoDict();
    cityInfoDict.setCityName("2");
    /**
     * B æ’å…¥å­—æ®µä¸º 3çš„æ•°æ®
     */
    this.insertB();
    /**
     * A æ’å…¥å­—æ®µä¸º 2çš„æ•°æ®
     */
    int insert = cityInfoDictMapper.insert(cityInfoDict);
    return insert;
}

@Transactional()
public Integer insertB() throws Exception {
    CityInfoDict cityInfoDict = new CityInfoDict();
    cityInfoDict.setCityName("3");
    cityInfoDict.setParentCityId(3);

    return cityInfoDictMapper.insert(cityInfoDict);
}
```

è¿™ç§æƒ…å†µæ˜¯æœ€å¸¸è§çš„ä¸€ç§@Transactional æ³¨è§£å¤±æ•ˆåœºæ™¯ã€‚

```java
@Transactional
private Integer A() throws Exception {
    int insert = 0;
    try {
        CityInfoDict cityInfoDict = new CityInfoDict();
        cityInfoDict.setCityName("2");
        cityInfoDict.setParentCityId(2);
        /**
         * A æ’å…¥å­—æ®µä¸º 2çš„æ•°æ®
         */
        insert = cityInfoDictMapper.insert(cityInfoDict);
        /**
         * B æ’å…¥å­—æ®µä¸º 3çš„æ•°æ®
        */
        b.insertB();
    } catch (Exception e) {
        e.printStackTrace();
    }
}
```

å¦‚æœ B æ–¹æ³•å†…éƒ¨æŠ›äº†å¼‚å¸¸ï¼Œè€Œ A æ–¹æ³•æ­¤æ—¶ try catch äº† B æ–¹æ³•çš„å¼‚å¸¸ï¼Œé‚£è¿™ä¸ªäº‹åŠ¡å°±ä¸èƒ½æ­£å¸¸å›æ»šäº†ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼š

```java
org.springframework.transaction.UnexpectedRollbackException: Transaction rolled back because it has been marked as rollback-only
```

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³æ˜¥æ‹›åŒå­¦ K ä¸€é¢é¢è¯•åŸé¢˜ï¼šäº‹åŠ¡ä¼ æ’­ï¼Œprotected å’Œ private åŠ äº‹åŠ¡ä¼šç”Ÿæ•ˆå—,è¿˜æœ‰é‚£äº›ä¸ç”Ÿæ•ˆçš„æƒ…å†µ

GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹](https://javabetter.cn/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## MVC

### 30.Spring MVC çš„æ ¸å¿ƒç»„ä»¶ï¼Ÿ

1.  **DispatcherServlet**ï¼šå‰ç½®æ§åˆ¶å™¨ï¼Œæ˜¯æ•´ä¸ªæµç¨‹æ§åˆ¶çš„**æ ¸å¿ƒ**ï¼Œæ§åˆ¶å…¶ä»–ç»„ä»¶çš„æ‰§è¡Œï¼Œè¿›è¡Œç»Ÿä¸€è°ƒåº¦ï¼Œé™ä½ç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§ï¼Œç›¸å½“äºæ€»æŒ‡æŒ¥ã€‚
2.  **Handler**ï¼šå¤„ç†å™¨ï¼Œå®Œæˆå…·ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼Œç›¸å½“äº Servlet æˆ– Actionã€‚
3.  **HandlerMapping**ï¼šDispatcherServlet æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œé€šè¿‡ HandlerMapping å°†ä¸åŒçš„è¯·æ±‚æ˜ å°„åˆ°ä¸åŒçš„ Handlerã€‚
4.  **HandlerInterceptor**ï¼šå¤„ç†å™¨æ‹¦æˆªå™¨ï¼Œæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¦‚æœéœ€è¦å®Œæˆä¸€äº›æ‹¦æˆªå¤„ç†ï¼Œå¯ä»¥å®ç°è¯¥æ¥å£ã€‚
5.  **HandlerExecutionChain**ï¼šå¤„ç†å™¨æ‰§è¡Œé“¾ï¼ŒåŒ…æ‹¬ä¸¤éƒ¨åˆ†å†…å®¹ï¼šHandler å’Œ HandlerInterceptorï¼ˆç³»ç»Ÿä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„ HandlerInterceptorï¼Œå¦‚æœéœ€è¦é¢å¤–è®¾ç½®æ‹¦æˆªï¼Œå¯ä»¥æ·»åŠ æ‹¦æˆªå™¨ï¼‰ã€‚
6.  **HandlerAdapter**ï¼šå¤„ç†å™¨é€‚é…å™¨ï¼ŒHandler æ‰§è¡Œä¸šåŠ¡æ–¹æ³•ä¹‹å‰ï¼Œéœ€è¦è¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œï¼ŒåŒ…æ‹¬è¡¨å•æ•°æ®çš„éªŒè¯ã€æ•°æ®ç±»å‹çš„è½¬æ¢ã€å°†è¡¨å•æ•°æ®å°è£…åˆ° JavaBean ç­‰ï¼Œè¿™äº›æ“ä½œéƒ½æ˜¯ç”± HandlerApater æ¥å®Œæˆï¼Œå¼€å‘è€…åªéœ€å°†æ³¨æ„åŠ›é›†ä¸­ä¸šåŠ¡é€»è¾‘çš„å¤„ç†ä¸Šï¼ŒDispatcherServlet é€šè¿‡ HandlerAdapter æ‰§è¡Œä¸åŒçš„ Handlerã€‚
7.  **ModelAndView**ï¼šè£…è½½äº†æ¨¡å‹æ•°æ®å’Œè§†å›¾ä¿¡æ¯ï¼Œä½œä¸º Handler çš„å¤„ç†ç»“æœï¼Œè¿”å›ç»™ DispatcherServletã€‚
8.  **ViewResolver**ï¼šè§†å›¾è§£æå™¨ï¼ŒDispatcheServlet é€šè¿‡å®ƒå°†é€»è¾‘è§†å›¾è§£æä¸ºç‰©ç†è§†å›¾ï¼Œæœ€ç»ˆå°†æ¸²æŸ“ç»“æœå“åº”ç»™å®¢æˆ·ç«¯ã€‚

### 31.ğŸŒŸSpring MVC çš„å·¥ä½œæµç¨‹ï¼Ÿ

é¦–å…ˆï¼Œå®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼ŒDispatcherServlet æ‹¦æˆªå¹¶é€šè¿‡ HandlerMapping æ‰¾åˆ°å¯¹åº”çš„æ§åˆ¶å™¨ã€‚

DispatcherServlet ä½¿ç”¨ HandlerAdapter è°ƒç”¨æ§åˆ¶å™¨æ–¹æ³•ï¼Œæ‰§è¡Œå…·ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿”å›ä¸€ä¸ª ModelAndView å¯¹è±¡ã€‚

ç„¶å DispatcherServlet é€šè¿‡ ViewResolver è§£æè§†å›¾ã€‚

æœ€åï¼ŒDispatcherServlet æ¸²æŸ“è§†å›¾å¹¶å°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring MVCçš„å·¥ä½œæµç¨‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-e29a122b-db07-48b8-8289-7251032e87a1.png)

![å›¾ç‰‡æ¥æºäºç½‘ç»œï¼šSpringMVCå·¥ä½œæµç¨‹å›¾](https://cdn.tobebetterjavaer.com/stutymore/spring-20240506102456.png)

![_æœªæ¥å¯æœŸï¼šSpringMVCå·¥ä½œæµç¨‹å›¾](https://cdn.tobebetterjavaer.com/stutymore/spring-20240506103022.png)

â‘ ã€**å‘èµ·è¯·æ±‚**ï¼šå®¢æˆ·ç«¯é€šè¿‡ HTTP åè®®å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ã€‚

â‘¡ã€**å‰ç«¯æ§åˆ¶å™¨**ï¼šè¿™ä¸ªè¯·æ±‚ä¼šå…ˆåˆ°å‰ç«¯æ§åˆ¶å™¨ DispatcherServletï¼Œå®ƒæ˜¯æ•´ä¸ªæµç¨‹çš„å…¥å£ç‚¹ï¼Œè´Ÿè´£æ¥æ”¶è¯·æ±‚å¹¶å°†å…¶åˆ†å‘ç»™ç›¸åº”çš„å¤„ç†å™¨ã€‚

â‘¢ã€**å¤„ç†å™¨æ˜ å°„**ï¼šDispatcherServlet è°ƒç”¨ HandlerMapping æ¥ç¡®å®šå“ªä¸ª Controller åº”è¯¥å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚é€šå¸¸ä¼šæ ¹æ®è¯·æ±‚çš„ URL æ¥ç¡®å®šã€‚

â‘£ã€**å¤„ç†å™¨é€‚é…å™¨**ï¼šä¸€æ—¦æ‰¾åˆ°ç›®æ ‡ Controllerï¼ŒDispatcherServlet ä¼šä½¿ç”¨ HandlerAdapter æ¥è°ƒç”¨ Controller çš„å¤„ç†æ–¹æ³•ã€‚

â‘¤ã€**æ‰§è¡Œå¤„ç†å™¨**ï¼šController å¤„ç†è¯·æ±‚ï¼Œå¤„ç†å®Œåè¿”å›ä¸€ä¸ª ModelAndView å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«æ¨¡å‹æ•°æ®å’Œé€»è¾‘è§†å›¾åã€‚

â‘¥ã€**è§†å›¾è§£æå™¨**ï¼šDispatcherServlet æ¥æ”¶åˆ° ModelAndView åï¼Œä¼šä½¿ç”¨ ViewResolver æ¥è§£æè§†å›¾åç§°ï¼Œæ‰¾åˆ°å…·ä½“çš„è§†å›¾é¡µé¢ã€‚

â‘¦ã€**æ¸²æŸ“è§†å›¾**ï¼šè§†å›¾ä½¿ç”¨æ¨¡å‹æ•°æ®æ¸²æŸ“é¡µé¢ï¼Œç”Ÿæˆæœ€ç»ˆçš„é¡µé¢å†…å®¹ã€‚

â‘§ã€**å“åº”ç»“æœ**ï¼šDispatcherServlet å°†è§†å›¾ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚

**Spring MVC** è™½ç„¶æ•´ä½“æµç¨‹å¤æ‚ï¼Œä½†æ˜¯å®é™…å¼€å‘ä¸­å¾ˆç®€å•ï¼Œå¤§éƒ¨åˆ†çš„ç»„ä»¶ä¸éœ€è¦æˆ‘ä»¬å¼€å‘äººå‘˜åˆ›å»ºå’Œç®¡ç†ï¼ŒçœŸæ­£éœ€è¦å¤„ç†çš„åªæœ‰ **Controller** ã€**View** ã€**Model**ã€‚

åœ¨å‰åç«¯åˆ†ç¦»çš„æƒ…å†µä¸‹ï¼Œæ­¥éª¤ â‘¥ã€â‘¦ã€â‘§ ä¼šç•¥æœ‰ä¸åŒï¼Œåç«¯é€šå¸¸åªéœ€è¦å¤„ç†æ•°æ®ï¼Œå¹¶å°† JSON æ ¼å¼çš„æ•°æ®è¿”å›ç»™å‰ç«¯å°±å¯ä»¥äº†ï¼Œè€Œä¸æ˜¯è¿”å›å®Œæ•´çš„è§†å›¾é¡µé¢ã€‚

#### è¿™ä¸ª Handler æ˜¯ä»€ä¹ˆä¸œè¥¿å•Šï¼Ÿä¸ºä»€ä¹ˆè¿˜éœ€è¦ HandlerAdapter

Handler ä¸€èˆ¬å°±æ˜¯æŒ‡ Controllerï¼ŒController æ˜¯ Spring MVC çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£å¤„ç†è¯·æ±‚ï¼Œè¿”å›å“åº”ã€‚

Spring MVC å…è®¸ä½¿ç”¨å¤šç§ç±»å‹çš„å¤„ç†å™¨ã€‚ä¸ä»…ä»…æ˜¯æ ‡å‡†çš„`@Controller`æ³¨è§£çš„ç±»ï¼Œè¿˜å¯ä»¥æ˜¯å®ç°äº†ç‰¹å®šæ¥å£çš„å…¶ä»–ç±»ï¼ˆå¦‚ HttpRequestHandler æˆ– SimpleControllerHandlerAdapter ç­‰ï¼‰ã€‚è¿™äº›å¤„ç†å™¨å¯èƒ½æœ‰ä¸åŒçš„æ–¹æ³•ç­¾åå’Œäº¤äº’æ–¹å¼ã€‚

HandlerAdapter çš„ä¸»è¦èŒè´£å°±æ˜¯è°ƒç”¨ Handler çš„æ–¹æ³•æ¥å¤„ç†è¯·æ±‚ï¼Œå¹¶ä¸”é€‚é…ä¸åŒç±»å‹çš„å¤„ç†å™¨ã€‚HandlerAdapter ç¡®ä¿ DispatcherServlet å¯ä»¥ä»¥ç»Ÿä¸€çš„æ–¹å¼è°ƒç”¨ä¸åŒç±»å‹çš„å¤„ç†å™¨ï¼Œæ— éœ€å…³å¿ƒå…·ä½“çš„æ‰§è¡Œç»†èŠ‚ã€‚

> 1.  [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„è…¾è®¯ Java åç«¯å®ä¹ ä¸€é¢åŸé¢˜ï¼šè¯´è¯´å‰ç«¯å‘èµ·è¯·æ±‚åˆ° SpringMVC çš„æ•´ä¸ªå¤„ç†æµç¨‹ã€‚
> 2.  [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å›½ä¼é¢è¯•åŸé¢˜ï¼šè¯´è¯´ SpringMVC çš„æµç¨‹å§
> 3.  [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°å…¬å¸é¢ç»åŒå­¦ 5 Java åç«¯é¢è¯•åŸé¢˜ï¼šspringMVC å·¥ä½œæµç¨‹ æˆ‘å¤§æ¦‚å°±æ˜¯æŒ‰é¢æ¸£é€†è¢­é‡Œç­”çš„ï¼Œç­”åˆ°ä¸€åŠæ‰“æ–­æˆ‘ï¼šç„¶åä¼šæœ‰ä¸ª Handlerï¼Œè¿™ä¸ª Handler æ˜¯ä»€ä¹ˆä¸œè¥¿å•Šã€‚å‰é¢ Handler ä¸æ˜¯å·²ç»çŸ¥é“ controller äº†å—ï¼Œæˆ‘ç›´æ¥æ‰§è¡Œä¸å°±è¡Œäº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ Adapter å‘¢ã€‚
> 4. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 8 é¢è¯•åŸé¢˜ï¼šSpringMVCæ¡†æ¶ 
> 5. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å­—èŠ‚è·³åŠ¨åŒå­¦ 17 åç«¯æŠ€æœ¯é¢è¯•åŸé¢˜ï¼šspringmvcæ‰§è¡Œæµç¨‹

### 32.SpringMVC Restful é£æ ¼çš„æ¥å£çš„æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ

PS:è¿™æ˜¯ä¸€é“å…¨æ–°çš„å…«è‚¡ï¼Œæ¯•ç«Ÿ ModelAndView è¿™ç§æ–¹å¼åº”è¯¥æ²¡äººç”¨äº†å§ï¼Ÿç°åœ¨éƒ½æ˜¯å‰åç«¯åˆ†ç¦»æ¥å£ï¼Œå…«è‚¡ä¹Ÿè¯¥æ›´æ–°æ¢ä»£äº†ã€‚

æˆ‘ä»¬éƒ½çŸ¥é“ Restful æ¥å£ï¼Œå“åº”æ ¼å¼æ˜¯ jsonï¼Œè¿™å°±ç”¨åˆ°äº†ä¸€ä¸ªå¸¸ç”¨æ³¨è§£ï¼š**@ResponseBody**

```java
    @GetMapping("/user")
    @ResponseBody
    public User user(){
        return new User(1,"å¼ ä¸‰");
    }
```

åŠ å…¥äº†è¿™ä¸ªæ³¨è§£åï¼Œæ•´ä½“çš„æµç¨‹ä¸Šå’Œä½¿ç”¨ ModelAndView å¤§ä½“ä¸Šç›¸åŒï¼Œä½†æ˜¯ç»†èŠ‚ä¸Šæœ‰ä¸€äº›ä¸åŒï¼š

![Spring MVC Restfulè¯·æ±‚å“åº”ç¤ºæ„å›¾](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-2da963a0-5da9-4b3a-aafd-fd8dbc7e1807.png)

1. å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šå…ˆåˆ°å‰ç«¯æ§åˆ¶å™¨ DispatcherServlet

2. DispatcherServlet æ¥æ”¶åˆ°è¯·æ±‚åä¼šè°ƒç”¨ HandlerMapping å¤„ç†å™¨æ˜ å°„å™¨ã€‚ç”±æ­¤å¾—çŸ¥ï¼Œè¯¥è¯·æ±‚è¯¥ç”±å“ªä¸ª Controller æ¥å¤„ç†

3. DispatcherServlet è°ƒç”¨ HandlerAdapter å¤„ç†å™¨é€‚é…å™¨ï¼Œå‘Šè¯‰å¤„ç†å™¨é€‚é…å™¨åº”è¯¥è¦å»æ‰§è¡Œå“ªä¸ª Controller

4. Controller è¢«å°è£…æˆäº† ServletInvocableHandlerMethodï¼ŒHandlerAdapter å¤„ç†å™¨é€‚é…å™¨å»æ‰§è¡Œ invokeAndHandle æ–¹æ³•ï¼Œå®Œæˆå¯¹ Controller çš„è¯·æ±‚å¤„ç†

5. HandlerAdapter æ‰§è¡Œå®Œå¯¹ Controller çš„è¯·æ±‚ï¼Œä¼šè°ƒç”¨ HandlerMethodReturnValueHandler å»å¤„ç†è¿”å›å€¼ï¼Œä¸»è¦çš„è¿‡ç¨‹ï¼š

   5.1. è°ƒç”¨ RequestResponseBodyMethodProcessorï¼Œåˆ›å»º ServletServerHttpResponseï¼ˆSpring å¯¹åŸç”Ÿ ServerHttpResponse çš„å°è£…ï¼‰å®ä¾‹

   5.2.ä½¿ç”¨ HttpMessageConverter çš„ write æ–¹æ³•ï¼Œå°†è¿”å›å€¼å†™å…¥ ServletServerHttpResponse çš„ OutputStream è¾“å‡ºæµä¸­

   5.3.åœ¨å†™å…¥çš„è¿‡ç¨‹ä¸­ï¼Œä¼šä½¿ç”¨ JsonGeneratorï¼ˆé»˜è®¤ä½¿ç”¨ Jackson æ¡†æ¶ï¼‰å¯¹è¿”å›å€¼è¿›è¡Œ Json åºåˆ—åŒ–

6. æ‰§è¡Œå®Œè¯·æ±‚åï¼Œè¿”å›çš„ ModealAndView ä¸º nullï¼ŒServletServerHttpResponse é‡Œä¹Ÿå·²ç»å†™å…¥äº†å“åº”ï¼Œæ‰€ä»¥ä¸ç”¨å…³å¿ƒ View çš„å¤„ç†

GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹](https://javabetter.cn/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## Spring Boot

### 33.ğŸŒŸä»‹ç»ä¸€ä¸‹ SpringBootï¼Œæœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ

Spring Boot æä¾›äº†ä¸€å¥—é»˜è®¤é…ç½®ï¼Œå®ƒé€šè¿‡çº¦å®šå¤§äºé…ç½®çš„ç†å¿µï¼Œæ¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæ­å»º Spring é¡¹ç›®éª¨æ¶ã€‚

![SpringBootå›¾æ ‡](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-d9164ee6-5c86-4313-8fd9-efb9acfa5f0b.png)

ä»¥å‰çš„ Spring å¼€å‘éœ€è¦é…ç½®å¤§é‡çš„ xml æ–‡ä»¶ï¼Œå¹¶ä¸”éœ€è¦å¼•å…¥å¤§é‡çš„ç¬¬ä¸‰æ–¹ jar åŒ…ï¼Œè¿˜éœ€è¦æ‰‹åŠ¨æ”¾åˆ° classpath ä¸‹ã€‚ç°åœ¨åªéœ€è¦å¼•å…¥ä¸€ä¸ª Starterï¼Œæˆ–è€…ä¸€ä¸ªæ³¨è§£ï¼Œå°±å¯ä»¥è½»æ¾æå®šã€‚

Spring Boot çš„ä¼˜ç‚¹éå¸¸å¤šï¼Œæ¯”å¦‚è¯´ï¼š

1. Spring Boot å†…åµŒäº† Tomcatã€Jettyã€Undertow ç­‰å®¹å™¨ï¼Œç›´æ¥è¿è¡Œ jar åŒ…å°±å¯ä»¥å¯åŠ¨é¡¹ç›®ã€‚
2. Spring Boot å†…ç½®äº† Starter å’Œè‡ªåŠ¨è£…é…ï¼Œé¿å…ç¹ççš„æ‰‹åŠ¨é…ç½®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé¡¹ç›®ä¸­æ·»åŠ äº† spring-boot-starter-webï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½® Tomcat å’Œ Spring MVCã€‚
3. Spring Boot å†…ç½®äº† Actuator å’Œ DevToolsï¼Œä¾¿äºè°ƒè¯•å’Œç›‘æ§ã€‚

#### Spring Bootå¸¸ç”¨æ³¨è§£æœ‰å“ªäº›ï¼Ÿ

1. **@SpringBootApplication**ï¼šSpring Boot åº”ç”¨çš„å…¥å£ï¼Œç”¨åœ¨å¯åŠ¨ç±»ä¸Šã€‚
2. è¿˜æœ‰ä¸€äº› Spring æ¡†æ¶æœ¬èº«çš„æ³¨è§£ï¼Œæ¯”å¦‚ **@Component**ã€**@RestController**ã€**@Service**ã€**@ConfigurationProperties**ã€**@Transactional** ç­‰ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„åä¸º OD é¢ç»ä¸­å‡ºç°è¿‡è¯¥é¢˜ï¼šè®²è®² Spring Boot çš„ç‰¹æ€§ã€‚
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç™¾åº¦é¢ç»åŒå­¦ 1 æ–‡å¿ƒä¸€è¨€ 25 å®ä¹  Java åç«¯é¢è¯•åŸé¢˜ï¼šSpringBootåŸºæœ¬åŸç†
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å›½ä¼é›¶ç¢é¢ç»åŒå­¦ 9 é¢è¯•åŸé¢˜ï¼šSpringbootåŸºäºSpringçš„é…ç½®æœ‰å“ªå‡ ç§
> 4. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„é˜¿é‡Œäº‘é¢ç»åŒå­¦ 22 é¢ç»ï¼šspringbootå¸¸ç”¨æ³¨è§£


### 34.ğŸŒŸSpringBoot è‡ªåŠ¨é…ç½®åŸç†äº†è§£å—ï¼Ÿ

åœ¨ Spring ä¸­ï¼Œè‡ªåŠ¨è£…é…æ˜¯æŒ‡å®¹å™¨åˆ©ç”¨åå°„æŠ€æœ¯ï¼Œæ ¹æ® Bean çš„ç±»å‹ã€åç§°ç­‰è‡ªåŠ¨æ³¨å…¥æ‰€éœ€çš„ä¾èµ–ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringBootè‡ªåŠ¨é…ç½®åŸç†](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-df77ee15-2ff0-4ec7-8e65-e4ebb8ba88f1.png)

åœ¨ Spring Boot ä¸­ï¼Œå¼€å¯è‡ªåŠ¨è£…é…çš„æ³¨è§£æ˜¯`@EnableAutoConfiguration`ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼š@EnableAutoConfiguration æºç ](https://cdn.tobebetterjavaer.com/stutymore/spring-20240316121711.png)

Spring Boot ä¸ºäº†è¿›ä¸€æ­¥ç®€åŒ–ï¼Œç›´æ¥é€šè¿‡ `@SpringBootApplication` æ³¨è§£ä¸€æ­¥æå®šï¼Œè¯¥æ³¨è§£åŒ…å«äº† `@EnableAutoConfiguration` æ³¨è§£ã€‚

main ç±»å¯åŠ¨çš„æ—¶å€™ï¼ŒSpring Boot ä¼šé€šè¿‡åº•å±‚çš„`AutoConfigurationImportSelector` ç±»åŠ è½½è‡ªåŠ¨è£…é…ç±»ã€‚

```java
@AutoConfigurationPackage //å°†mainåŒçº§çš„åŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶æ³¨å†Œåˆ°å®¹å™¨ä¸­
@Import({AutoConfigurationImportSelector.class}) //åŠ è½½è‡ªåŠ¨è£…é…ç±» xxxAutoconfiguration
public @interface EnableAutoConfiguration {
    String ENABLED_OVERRIDE_PROPERTY = "spring.boot.enableautoconfiguration";

    Class<?>[] exclude() default {};

    String[] excludeName() default {};
}
```

`AutoConfigurationImportSelector`å®ç°äº†`ImportSelector`æ¥å£ï¼Œè¯¥æ¥å£çš„ä½œç”¨æ˜¯æ”¶é›†éœ€è¦å¯¼å…¥çš„é…ç½®ç±»ï¼Œé…åˆ `@Import()` å°†ç›¸åº”çš„ç±»å¯¼å…¥åˆ° Spring å®¹å™¨ä¸­ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šAutoConfigurationImportSelectoræºç ](https://cdn.tobebetterjavaer.com/stutymore/spring-20240316122134.png)

è·å–æ³¨å…¥ç±»çš„æ–¹æ³•æ˜¯ `selectImports()`ï¼Œå®ƒå®é™…è°ƒç”¨çš„æ˜¯`getAutoConfigurationEntry()`ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯è·å–è‡ªåŠ¨è£…é…ç±»çš„å…³é”®ã€‚

```java
protected AutoConfigurationEntry getAutoConfigurationEntry(AnnotationMetadata annotationMetadata) {
    // æ£€æŸ¥è‡ªåŠ¨é…ç½®æ˜¯å¦å¯ç”¨ã€‚å¦‚æœ@ConditionalOnClassç­‰æ¡ä»¶æ³¨è§£ä½¿å¾—è‡ªåŠ¨é…ç½®ä¸é€‚ç”¨äºå½“å‰ç¯å¢ƒï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºçš„é…ç½®æ¡ç›®ã€‚
    if (!isEnabled(annotationMetadata)) {
        return EMPTY_ENTRY;
    }

    // è·å–å¯åŠ¨ç±»ä¸Šçš„@EnableAutoConfigurationæ³¨è§£çš„å±æ€§ï¼Œè¿™å¯èƒ½åŒ…æ‹¬å¯¹ç‰¹å®šè‡ªåŠ¨é…ç½®ç±»çš„æ’é™¤ã€‚
    AnnotationAttributes attributes = getAttributes(annotationMetadata);

    // ä»spring.factoriesä¸­è·å–æ‰€æœ‰å€™é€‰çš„è‡ªåŠ¨é…ç½®ç±»ã€‚è¿™æ˜¯é€šè¿‡åŠ è½½META-INF/spring.factoriesæ–‡ä»¶ä¸­å¯¹åº”çš„æ¡ç›®æ¥å®ç°çš„ã€‚
    List<String> configurations = getCandidateConfigurations(annotationMetadata, attributes);

    // ç§»é™¤é…ç½®åˆ—è¡¨ä¸­çš„é‡å¤é¡¹ï¼Œç¡®ä¿æ¯ä¸ªè‡ªåŠ¨é…ç½®ç±»åªè¢«è€ƒè™‘ä¸€æ¬¡ã€‚
    configurations = removeDuplicates(configurations);

    // æ ¹æ®æ³¨è§£å±æ€§è§£æå‡ºéœ€è¦æ’é™¤çš„è‡ªåŠ¨é…ç½®ç±»ã€‚
    Set<String> exclusions = getExclusions(annotationMetadata, attributes);

    // æ£€æŸ¥æ’é™¤çš„ç±»æ˜¯å¦å­˜åœ¨äºå€™é€‰é…ç½®ä¸­ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚
    checkExcludedClasses(configurations, exclusions);

    // ä»å€™é€‰é…ç½®ä¸­ç§»é™¤æ’é™¤çš„ç±»ã€‚
    configurations.removeAll(exclusions);

    // åº”ç”¨è¿‡æ»¤å™¨è¿›ä¸€æ­¥ç­›é€‰è‡ªåŠ¨é…ç½®ç±»ã€‚è¿‡æ»¤å™¨å¯èƒ½åŸºäºæ¡ä»¶æ³¨è§£å¦‚@ConditionalOnBeanç­‰æ¥æ’é™¤ç‰¹å®šçš„é…ç½®ç±»ã€‚
    configurations = getConfigurationClassFilter().filter(configurations);

    // è§¦å‘è‡ªåŠ¨é…ç½®å¯¼å…¥äº‹ä»¶ï¼Œå…è®¸ç›‘å¬å™¨å¯¹è‡ªåŠ¨é…ç½®è¿‡ç¨‹è¿›è¡Œå¹²é¢„ã€‚
    fireAutoConfigurationImportEvents(configurations, exclusions);

    // åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªåŒ…å«æœ€ç»ˆç¡®å®šçš„è‡ªåŠ¨é…ç½®ç±»å’Œæ’é™¤çš„é…ç½®ç±»çš„AutoConfigurationEntryå¯¹è±¡ã€‚
    return new AutoConfigurationEntry(configurations, exclusions);
}
```

æ€»ç»“ï¼šSpring Boot çš„è‡ªåŠ¨è£…é…åŸç†ä¾èµ–äº Spring æ¡†æ¶çš„ä¾èµ–æ³¨å…¥å’Œæ¡ä»¶æ³¨å†Œï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼ŒSpring Boot èƒ½å¤Ÿæ™ºèƒ½åœ°é…ç½® beanï¼Œå¹¶ä¸”åªæœ‰å½“è¿™äº› bean å®é™…éœ€è¦æ—¶æ‰ä¼šè¢«åˆ›å»ºå’Œé…ç½®ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„æ»´æ»´åŒå­¦ 2 æŠ€æœ¯äºŒé¢çš„åŸé¢˜ï¼šSpringBoot å¯åŠ¨æ—¶ä¸ºä»€ä¹ˆèƒ½å¤Ÿè‡ªåŠ¨è£…é…
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 22 æš‘æœŸå®ä¹ ä¸€é¢é¢è¯•åŸé¢˜ï¼šSpring Boot å¦‚ä½•åšåˆ°å¯åŠ¨çš„æ—¶å€™æ³¨å…¥ä¸€äº› bean
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„æ¯”äºšè¿ªé¢ç»åŒå­¦ 3 Java æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šè¯´ä¸€ä¸‹ Spring Boot çš„è‡ªåŠ¨è£…é…åŸç†
> 4. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å†œä¸šé“¶è¡ŒåŒå­¦ 1 é¢è¯•åŸé¢˜ï¼šspring boot çš„è‡ªåŠ¨è£…é…
> 5. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç™¾åº¦é¢ç»åŒå­¦ 1 æ–‡å¿ƒä¸€è¨€ 25 å®ä¹  Java åç«¯é¢è¯•åŸé¢˜ï¼šSpringBootå¦‚ä½•å®ç°è‡ªåŠ¨è£…é…
> 6. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ OPPO é¢ç»åŒå­¦ 1 é¢è¯•åŸé¢˜ï¼šè‡ªåŠ¨é…ç½®æ€ä¹ˆå®ç°çš„ï¼Ÿ

### 35.ğŸŒŸå¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ª SpringBoot Srarter?

åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ Spring Boot Starterï¼Œéœ€è¦è¿™å‡ æ­¥ï¼š

ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ Maven é¡¹ç›®ï¼Œä¾‹å¦‚å‘½åä¸º my-spring-boot-starterã€‚åœ¨ pom.xml æ–‡ä»¶ä¸­æ·»åŠ å¿…è¦çš„ä¾èµ–å’Œé…ç½®ï¼š

```xml
<properties>
    <spring.boot.version>2.3.1.RELEASE</spring.boot.version>
</properties>

<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-autoconfigure</artifactId>
        <version>${spring.boot.version}</version>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter</artifactId>
        <version>${spring.boot.version}</version>
    </dependency>
</dependencies>
```

ç¬¬äºŒæ­¥ï¼Œåœ¨ `src/main/java` ä¸‹åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»ï¼Œæ¯”å¦‚ MyServiceAutoConfiguration.javaï¼šï¼ˆé€šå¸¸æ˜¯ autoconfigure åŒ…ä¸‹ï¼‰ã€‚

```java
@Configuration
@EnableConfigurationProperties(MyStarterProperties.class)
public class MyServiceAutoConfiguration {

    @Bean
    @ConditionalOnMissingBean
    public MyService myService(MyStarterProperties properties) {
        return new MyService(properties.getMessage());
    }
}
```

ç¬¬ä¸‰æ­¥ï¼Œåˆ›å»ºä¸€ä¸ªé…ç½®å±æ€§ç±» MyStarterProperties.javaï¼š

```java
@ConfigurationProperties(prefix = "mystarter")
public class MyStarterProperties {
    private String message = "äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ä¸é”™å•Š!";

    public String getMessage() {
        return message;
    }

    public void setMessage(String message) {
        this.message = message;
    }
}
```

ç¬¬å››æ­¥ï¼Œåˆ›å»ºä¸€ä¸ªç®€å•çš„æœåŠ¡ç±» MyService.javaï¼š

```java
public class MyService {
    private final String message;

    public MyService(String message) {
        this.message = message;
    }

    public String getMessage() {
        return message;
    }
}
```

ç¬¬äº”æ­¥ï¼Œé…ç½® spring.factoriesï¼Œåœ¨ `src/main/resources/META-INF` ç›®å½•ä¸‹åˆ›å»º spring.factories æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ï¼š

```
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
com.itwanger.mystarter.autoconfigure.MyServiceAutoConfiguration
```

ç¬¬å…­æ­¥ï¼Œä½¿ç”¨ Maven æ‰“åŒ…è¿™ä¸ªé¡¹ç›®ï¼š

```shell
mvn clean install
```

ç¬¬ä¸ƒæ­¥ï¼Œåœ¨å…¶ä»–çš„ Spring Boot é¡¹ç›®ä¸­ï¼Œé€šè¿‡ Maven æ¥æ·»åŠ è¿™ä¸ªè‡ªå®šä¹‰çš„ Starter ä¾èµ–ï¼Œå¹¶é€šè¿‡ application.properties é…ç½®æ¬¢è¿æ¶ˆæ¯ï¼š

```xml
mystarter.message=javabetter.cn
```

ç„¶åå°±å¯ä»¥åœ¨ Spring Boot é¡¹ç›®ä¸­æ³¨å…¥ MyStarterProperties æ¥ä½¿ç”¨å®ƒã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/spring-20240409114642.png)

å¯åŠ¨é¡¹ç›®ï¼Œç„¶ååœ¨æµè§ˆå™¨ä¸­è¾“å…¥ `localhost:8081/hello`ï¼Œå°±å¯ä»¥çœ‹åˆ°æ¬¢è¿æ¶ˆæ¯äº†ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://cdn.tobebetterjavaer.com/stutymore/spring-20240409114610.png)

#### Spring Boot Starter çš„åŸç†äº†è§£å—ï¼Ÿ

Spring Boot Starter ä¸»è¦é€šè¿‡èµ·æ­¥ä¾èµ–å’Œè‡ªåŠ¨é…ç½®æœºåˆ¶æ¥ç®€åŒ–é¡¹ç›®çš„æ„å»ºå’Œé…ç½®è¿‡ç¨‹ã€‚

èµ·æ­¥ä¾èµ–æ˜¯ Spring Boot æä¾›çš„ä¸€ç»„é¢„å®šä¹‰ä¾èµ–é¡¹ï¼Œå®ƒä»¬å°†ä¸€ç»„ç›¸å…³çš„åº“å’Œæ¨¡å—æ‰“åŒ…åœ¨ä¸€èµ·ã€‚æ¯”å¦‚ `spring-boot-starter-web` å°±åŒ…å«äº† Spring MVCã€Tomcat å’Œ Jackson ç­‰ä¾èµ–ã€‚

è‡ªåŠ¨é…ç½®æœºåˆ¶æ˜¯ Spring Boot çš„æ ¸å¿ƒç‰¹æ€§ï¼Œé€šè¿‡è‡ªåŠ¨æ‰«æç±»è·¯å¾„ä¸‹çš„ç±»ã€èµ„æºæ–‡ä»¶å’Œé…ç½®æ–‡ä»¶ï¼Œè‡ªåŠ¨åˆ›å»ºå’Œé…ç½®åº”ç”¨ç¨‹åºæ‰€éœ€çš„ Bean å’Œç»„ä»¶ã€‚

æ¯”å¦‚æœ‰äº† `spring-boot-starter-web`ï¼Œæˆ‘ä»¬å¼€å‘è€…å°±ä¸éœ€è¦å†æ‰‹åŠ¨é…ç½® Tomcatã€Spring MVC ç­‰ï¼ŒSpring Boot ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å®Œæˆè¿™äº›å·¥ä½œã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 1 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šä½ å°è£…è¿‡ springboot starter å—ï¼Ÿ
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„è…¾è®¯äº‘æ™ºé¢ç»åŒå­¦ 20 äºŒé¢é¢è¯•åŸé¢˜ï¼šSpring Boot Starter çš„åŸç†äº†è§£å—ï¼Ÿ
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¿«æ‰‹åŒå­¦ 4 ä¸€é¢åŸé¢˜ï¼šä¸ºä»€ä¹ˆä½¿ç”¨SpringBootï¼ŸSpringBootè‡ªåŠ¨è£…é…çš„åŸç†åŠæµç¨‹ï¼Ÿ@Importçš„ä½œç”¨ï¼Ÿå¦‚æœæƒ³è®©SpringBootå¯¹è‡ªå®šä¹‰çš„jaråŒ…è¿›è¡Œè‡ªåŠ¨é…ç½®çš„è¯ï¼Œéœ€è¦æ€ä¹ˆåšï¼Ÿ

### 36.ğŸŒŸSpring Boot å¯åŠ¨åŸç†äº†è§£å—ï¼Ÿ

Spring Boot çš„å¯åŠ¨ç”± SpringApplication ç±»è´Ÿè´£ï¼š

- ç¬¬ä¸€æ­¥ï¼Œåˆ›å»º SpringApplication å®ä¾‹ï¼Œè´Ÿè´£åº”ç”¨çš„å¯åŠ¨å’Œåˆå§‹åŒ–ï¼›
- ç¬¬äºŒæ­¥ï¼Œä» application.yml ä¸­åŠ è½½é…ç½®æ–‡ä»¶å’Œç¯å¢ƒå˜é‡ï¼›
- ç¬¬ä¸‰æ­¥ï¼Œåˆ›å»ºä¸Šä¸‹æ–‡ç¯å¢ƒ ApplicationContextï¼Œå¹¶åŠ è½½ Beanï¼Œå®Œæˆä¾èµ–æ³¨å…¥ï¼›
- ç¬¬å››æ­¥ï¼Œå¯åŠ¨å†…åµŒçš„ Web å®¹å™¨ã€‚
- ç¬¬äº”æ­¥ï¼Œå‘å¸ƒå¯åŠ¨å®Œæˆäº‹ä»¶ ApplicationReadyEventï¼Œå¹¶è°ƒç”¨ ApplicationRunner çš„ run æ–¹æ³•å®Œæˆå¯åŠ¨åçš„é€»è¾‘ã€‚

å…³é”®çš„ä»£ç é€»è¾‘å¦‚ä¸‹ï¼š

```java
public ConfigurableApplicationContext run(String... args) {
    // 1. åˆ›å»ºå¯åŠ¨æ—¶çš„ç›‘å¬å™¨å¹¶è§¦å‘å¯åŠ¨äº‹ä»¶
    SpringApplicationRunListeners listeners = getRunListeners(args);
    listeners.starting();

    // 2. å‡†å¤‡è¿è¡Œç¯å¢ƒ
    ConfigurableEnvironment environment = prepareEnvironment(listeners);
    configureIgnoreBeanInfo(environment);

    // 3. åˆ›å»ºä¸Šä¸‹æ–‡
    ConfigurableApplicationContext context = createApplicationContext();

    try {
        // 4. å‡†å¤‡ä¸Šä¸‹æ–‡
        prepareContext(context, environment, listeners, args);

        // 5. åˆ·æ–°ä¸Šä¸‹æ–‡ï¼Œå®Œæˆ Bean åˆå§‹åŒ–å’Œè£…é…
        refreshContext(context);

        // 6. è°ƒç”¨è¿è¡Œå™¨
        afterRefresh(context, args);

        // 7. è§¦å‘å¯åŠ¨å®Œæˆäº‹ä»¶
        listeners.started(context);
    } catch (Exception ex) {
        handleRunFailure(context, ex, listeners);
    }

    return context;
}
```

![SpringBoot å¯åŠ¨å¤§è‡´æµç¨‹-å›¾ç‰‡æ¥æºç½‘ç»œ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-68744556-a1ba-4e1f-a092-1582875f0da6.png)

ä»¥[æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®](https://javabetter.cn/zhishixingqiu/paicoding.html)ä¸ºä¾‹ã€‚åœ¨å¯åŠ¨ç±» QuickForumApplication ä¸­ï¼Œmain æ–¹æ³•ä¼šè°ƒç”¨ `SpringApplication.run()` å¯åŠ¨é¡¹ç›®ã€‚

![æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®æºç ï¼šå¯åŠ¨ç±»](https://cdn.tobebetterjavaer.com/stutymore/spring-20240422090338.png)

è¯¥æ–¹æ³•è´Ÿè´£ Spring åº”ç”¨çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼ˆApplicationContextï¼‰å‡†å¤‡ï¼ŒåŒ…æ‹¬ï¼š

- æ‰«æé…ç½®æ–‡ä»¶ï¼Œæ·»åŠ ä¾èµ–é¡¹
- åˆå§‹åŒ–å’ŒåŠ è½½ Bean å®šä¹‰
- å¯åŠ¨å†…åµŒçš„ Web å®¹å™¨ç­‰
- å‘å¸ƒå¯åŠ¨å®Œæˆäº‹ä»¶

#### äº†è§£@SpringBootApplication æ³¨è§£å—ï¼Ÿ

`@SpringBootApplication`æ˜¯ Spring Boot çš„æ ¸å¿ƒæ³¨è§£ï¼Œç»å¸¸ç”¨äºä¸»ç±»ä¸Šï¼Œä½œä¸ºé¡¹ç›®å¯åŠ¨å…¥å£çš„æ ‡è¯†ã€‚å®ƒæ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼š

- `@SpringBootConfiguration`ï¼šç»§æ‰¿è‡ª `@Configuration`ï¼Œæ ‡æ³¨è¯¥ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œç›¸å½“äºä¸€ä¸ª Spring é…ç½®æ–‡ä»¶ã€‚
- `@EnableAutoConfiguration`ï¼šå‘Šè¯‰ Spring Boot æ ¹æ® pom.xml ä¸­æ·»åŠ çš„ä¾èµ–è‡ªåŠ¨é…ç½®é¡¹ç›®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ spring-boot-starter-web ä¾èµ–è¢«æ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½® Tomcat å’Œ Spring MVCã€‚
- `@ComponentScan`ï¼šæ‰«æå½“å‰åŒ…åŠå…¶å­åŒ…ä¸‹è¢«`@Component`ã€`@Service`ã€`@Controller`ã€`@Repository` æ³¨è§£æ ‡è®°çš„ç±»ï¼Œå¹¶æ³¨å†Œä¸º Spring Beanã€‚

```java
@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

#### ä¸ºä»€ä¹ˆ Spring Boot åœ¨å¯åŠ¨çš„æ—¶å€™èƒ½å¤Ÿæ‰¾åˆ° main æ–¹æ³•ä¸Šçš„@SpringBootApplication æ³¨è§£ï¼Ÿ

Spring Boot åœ¨å¯åŠ¨æ—¶èƒ½å¤Ÿæ‰¾åˆ°ä¸»ç±»ä¸Šçš„`@SpringBootApplication`æ³¨è§£ï¼Œæ˜¯å› ä¸ºå®ƒåˆ©ç”¨äº† Java çš„åå°„æœºåˆ¶å’Œç±»åŠ è½½æœºåˆ¶ï¼Œç»“åˆ Spring æ¡†æ¶å†…éƒ¨çš„ä¸€ç³»åˆ—å¤„ç†æµç¨‹ã€‚

å½“è¿è¡Œä¸€ä¸ª Spring Boot ç¨‹åºæ—¶ï¼Œé€šå¸¸ä¼šè°ƒç”¨ä¸»ç±»ä¸­çš„`main`æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæ‰§è¡Œ`SpringApplication.run()`ï¼Œæ¯”å¦‚ï¼š

```java
@SpringBootApplication
public class MyApplication {
    public static void main(String[] args) {
        SpringApplication.run(MyApplication.class, args);
    }
}
```

`SpringApplication.run(Class<?> primarySource, String... args)`æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªæ˜¯ä¸»åº”ç”¨ç±»ï¼ˆå³åŒ…å«`main`æ–¹æ³•çš„ç±»ï¼‰ï¼Œç¬¬äºŒä¸ªæ˜¯å‘½ä»¤è¡Œå‚æ•°ã€‚`primarySource`å‚æ•°æä¾›äº†ä¸€ä¸ªèµ·ç‚¹ï¼ŒSpring Boot é€šè¿‡å®ƒæ¥åŠ è½½åº”ç”¨ä¸Šä¸‹æ–‡ã€‚

Spring Boot åˆ©ç”¨ Java åå°„æœºåˆ¶æ¥è¯»å–ä¼ é€’ç»™`run`æ–¹æ³•çš„ç±»ï¼ˆ`MyApplication.class`ï¼‰ã€‚å®ƒä¼šæ£€æŸ¥è¿™ä¸ªç±»ä¸Šçš„æ³¨è§£ï¼ŒåŒ…æ‹¬`@SpringBootApplication`ã€‚

#### Spring Boot é»˜è®¤çš„åŒ…æ‰«æè·¯å¾„æ˜¯ä»€ä¹ˆï¼Ÿ

Spring Boot çš„é»˜è®¤åŒ…æ‰«æè·¯å¾„æ˜¯ä»¥å¯åŠ¨ç±» `@SpringBootApplication` æ³¨è§£æ‰€åœ¨çš„åŒ…ä¸ºæ ¹ç›®å½•çš„ï¼Œå³é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Boot ä¼šæ‰«æå¯åŠ¨ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶ã€‚

æ¯”å¦‚è¯´åœ¨[æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®](https://javabetter.cn/zhishixingqiu/paicoding.html)ä¸­ï¼Œå¯åŠ¨ç±»`QuickForumApplication`æ‰€åœ¨çš„åŒ…æ˜¯`com.github.paicoding.forum.web`ï¼Œé‚£ä¹ˆ Spring Boot é»˜è®¤ä¼šæ‰«æ`com.github.paicoding.forum.web`åŒ…åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶ã€‚

![æ²‰é»˜ç‹äºŒï¼šæŠ€æœ¯æ´¾é¡¹ç›®æˆªå›¾](https://cdn.tobebetterjavaer.com/stutymore/spring-20240327105552.png)

`@SpringBootApplication` æ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œå®ƒé‡Œé¢çš„`@ComponentScan`æ³¨è§£å¯ä»¥æŒ‡å®šè¦æ‰«æçš„åŒ…è·¯å¾„ï¼Œé»˜è®¤æ‰«æå¯åŠ¨ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶ã€‚

```java
@ComponentScan(excludeFilters = { @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),
		@Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) })
public @interface SpringBootApplication {
}
```

æ¯”å¦‚è¯´å¸¦æœ‰ `@Component`ã€`@Service`ã€`@Controller`ã€`@Repository` ç­‰æ³¨è§£çš„ç±»éƒ½ä¼šè¢« Spring Boot æ‰«æåˆ°ï¼Œå¹¶æ³¨å†Œåˆ° Spring å®¹å™¨ä¸­ã€‚

å¦‚æœéœ€è¦è‡ªå®šä¹‰åŒ…æ‰«æè·¯å¾„ï¼Œå¯ä»¥åœ¨`@SpringBootApplication`æ³¨è§£ä¸Šæ·»åŠ `@ComponentScan`æ³¨è§£ï¼ŒæŒ‡å®šè¦æ‰«æçš„åŒ…è·¯å¾„ã€‚

```java
@SpringBootApplication
@ComponentScan(basePackages = {"com.github.paicoding.forum"})
public class QuickForumApplication {
    public static void main(String[] args) {
        SpringApplication.run(QuickForumApplication.class, args);
    }
}
```

è¿™ç§æ–¹å¼ä¼šè¦†ç›–é»˜è®¤çš„åŒ…æ‰«æè·¯å¾„ï¼Œåªæ‰«æ`com.github.paicoding.forum`åŒ…åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„æ»´æ»´åŒå­¦ 2 æŠ€æœ¯äºŒé¢çš„åŸé¢˜ï¼šä¸ºä»€ä¹ˆ Spring Boot å¯åŠ¨æ—¶èƒ½æ‰¾åˆ° Main ç±»ä¸Šé¢çš„æ³¨è§£
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 22 æš‘æœŸå®ä¹ ä¸€é¢é¢è¯•åŸé¢˜ï¼šSpring Boot é»˜è®¤çš„åŒ…æ‰«æè·¯å¾„ï¼Ÿ
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¾®ä¼—é“¶è¡ŒåŒå­¦ 1 Java åç«¯ä¸€é¢çš„åŸé¢˜ï¼š@SpringBootApplication æ³¨è§£äº†è§£å—ï¼Ÿ
> 4. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å›½ä¼é›¶ç¢é¢ç»åŒå­¦ 9 é¢è¯•åŸé¢˜ï¼šSpringbootçš„å·¥ä½œåŸç†ï¼Ÿ
> 5. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 5 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šSpringBootå¯åŠ¨æµç¨‹ï¼ˆå¿˜äº†ï¼‰
> 6. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å“”å“©å“”å“©åŒå­¦ 1 äºŒé¢é¢è¯•åŸé¢˜ï¼šspringBootå¯åŠ¨æœºåˆ¶ï¼Œå¯åŠ¨ä¹‹ååšäº†å“ªäº›æ­¥éª¤

### 37.SpringBoot å’Œ SpringMVC çš„åŒºåˆ«ï¼Ÿï¼ˆè¡¥å……ï¼‰

> 2024 å¹´ 04 æœˆ 04 æ—¥å¢è¡¥

Spring MVC æ˜¯åŸºäº Spring æ¡†æ¶çš„ä¸€ä¸ªæ¨¡å—ï¼Œæä¾›äº†ä¸€ç§ Model-View-Controllerï¼ˆæ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼‰çš„å¼€å‘æ¨¡å¼ã€‚

Spring Boot æ—¨åœ¨ç®€åŒ– Spring åº”ç”¨çš„é…ç½®å’Œéƒ¨ç½²è¿‡ç¨‹ï¼Œæä¾›äº†å¤§é‡çš„è‡ªåŠ¨é…ç½®é€‰é¡¹ï¼Œä»¥åŠè¿è¡Œæ—¶ç¯å¢ƒçš„å†…åµŒ Web æœåŠ¡å™¨ï¼Œè¿™æ ·å°±å¯ä»¥æ›´å¿«é€Ÿåœ°å¼€å‘ä¸€ä¸ª SpringMVC çš„ Web é¡¹ç›®ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„æ»´æ»´åŒå­¦ 2 æŠ€æœ¯äºŒé¢çš„åŸé¢˜ï¼šSpringBoot å’Œ SpringMVC çš„åŒºåˆ«
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 5 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šSpringBootä¸SpringMVCåŒºåˆ«ï¼ˆä¸ä¼šï¼‰

### 38.Spring Boot å’Œ Spring æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿï¼ˆè¡¥å……ï¼‰

> 2024 å¹´ 07 æœˆ 09 æ—¥æ–°å¢

Spring Boot æ˜¯ Spring Framework çš„ä¸€ä¸ªæ‰©å±•ï¼Œæä¾›äº†ä¸€å¥—å¿«é€Ÿé…ç½®å’Œå¼€å‘çš„æœºåˆ¶ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæ­å»º Spring é¡¹ç›®çš„éª¨æ¶ï¼Œæé«˜ç”Ÿäº§æ•ˆç‡ã€‚

| ç‰¹æ€§   | Spring Framework | Spring Boot  |
|--------- |------------ |------------ |
| **ç›®çš„**  | æä¾›ä¼ä¸šçº§çš„å¼€å‘å·¥å…·å’Œåº“ | ç®€åŒ– Spring åº”ç”¨çš„å¼€å‘ã€é…ç½®å’Œéƒ¨ç½²    |
| **é…ç½®æ–¹å¼** | ä¸»è¦é€šè¿‡ XML å’Œæ³¨è§£ç­‰æ‰‹åŠ¨é…ç½®  | æä¾›å¼€ç®±å³ç”¨çš„è‡ªåŠ¨é…ç½®   |
| **å¯åŠ¨å’Œè¿è¡Œ**  | éœ€è¦æ‰“æˆ war åŒ…åˆ° Tomcat ç­‰å®¹å™¨ä¸‹è¿è¡Œ | å·²åµŒå…¥ Tomcat ç­‰å®¹å™¨ï¼Œæ‰“åŒ…æˆ JAR æ–‡ä»¶ç›´æ¥è¿è¡Œ |
| **ä¾èµ–ç®¡ç†**   | æ‰‹åŠ¨æ·»åŠ å’Œç®¡ç†ä¾èµ–  | ä½¿ç”¨ `spring-boot-starter` ç®€åŒ–ä¾èµ–ç®¡ç†  |

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³åŒå­¦ F é¢è¯•åŸé¢˜ï¼šSpring Boot å’Œ Spring çš„åŒºåˆ«
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ OPPO é¢ç»åŒå­¦ 1 é¢è¯•åŸé¢˜ï¼šè¯´ä¸€ä¸‹Springå’ŒSpringbootä¹‹é—´æœ‰ä»€ä¹ˆå·®å¼‚ï¼Ÿ


## Spring Cloud

### 39.å¯¹ SpringCloud äº†è§£å¤šå°‘ï¼Ÿ

Spring Cloud æ˜¯ä¸€ä¸ªåŸºäº Spring Bootï¼Œæä¾›æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿå’Œå¾®æœåŠ¡æ¶æ„çš„å·¥å…·é›†ã€‚ç”¨äºè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä¸€äº›å¸¸è§é—®é¢˜ï¼Œå¦‚é…ç½®ç®¡ç†ã€æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ç­‰ç­‰ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring Cloud Netfilxæ ¸å¿ƒç»„ä»¶](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-92ab53d5-f303-4fc5-bd26-e62cefe374b3.png)

#### ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿ

1.  2014 å¹´ **Martin Fowler** æå‡ºçš„ä¸€ç§æ–°çš„æ¶æ„å½¢å¼ã€‚å¾®æœåŠ¡æ¶æ„æ˜¯ä¸€ç§**æ¶æ„æ¨¡å¼**ï¼Œæå€¡å°†å•ä¸€åº”ç”¨ç¨‹åºåˆ’åˆ†æˆä¸€ç»„å°çš„æœåŠ¡ï¼ŒæœåŠ¡ä¹‹é—´ç›¸äº’åè°ƒï¼Œäº’ç›¸é…åˆï¼Œä¸ºç”¨æˆ·æä¾›æœ€ç»ˆä»·å€¼ã€‚æ¯ä¸ªæœåŠ¡è¿è¡Œåœ¨å…¶ç‹¬ç«‹çš„è¿›ç¨‹ä¸­ï¼ŒæœåŠ¡ä¸æœåŠ¡ä¹‹é—´é‡‡ç”¨è½»é‡çº§çš„é€šä¿¡æœºåˆ¶(å¦‚ HTTP æˆ– Dubbo)äº’ç›¸åä½œï¼Œæ¯ä¸ªæœåŠ¡éƒ½å›´ç»•ç€å…·ä½“çš„ä¸šåŠ¡è¿›è¡Œæ„å»ºï¼Œå¹¶ä¸”èƒ½å¤Ÿè¢«ç‹¬ç«‹çš„éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¦å¤–ï¼Œåº”å°½é‡é¿å…ç»Ÿä¸€çš„ï¼Œé›†ä¸­å¼çš„æœåŠ¡ç®¡ç†æœºåˆ¶ï¼Œå¯¹å…·ä½“çš„ä¸€ä¸ªæœåŠ¡è€Œè¨€ï¼Œåº”æ ¹æ®ä¸šåŠ¡ä¸Šä¸‹æ–‡ï¼Œé€‰æ‹©åˆé€‚çš„è¯­è¨€ã€å·¥å…·(å¦‚ Maven)å¯¹å…¶è¿›è¡Œæ„å»ºã€‚
2.  å¾®æœåŠ¡åŒ–çš„æ ¸å¿ƒå°±æ˜¯å°†ä¼ ç»Ÿçš„ä¸€ç«™å¼åº”ç”¨ï¼Œæ ¹æ®ä¸šåŠ¡æ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªçš„æœåŠ¡ï¼Œå½»åº•åœ°å»è€¦åˆï¼Œæ¯ä¸€ä¸ªå¾®æœåŠ¡æä¾›å•ä¸ªä¸šåŠ¡åŠŸèƒ½çš„æœåŠ¡ï¼Œä¸€ä¸ªæœåŠ¡åšä¸€ä»¶äº‹æƒ…ï¼Œä»æŠ€æœ¯è§’åº¦çœ‹å°±æ˜¯ä¸€ç§å°è€Œç‹¬ç«‹çš„å¤„ç†è¿‡ç¨‹ï¼Œç±»ä¼¼è¿›ç¨‹çš„æ¦‚å¿µï¼Œèƒ½å¤Ÿè‡ªè¡Œå•ç‹¬å¯åŠ¨æˆ–é”€æ¯ï¼Œæ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æ•°æ®åº“ã€‚

#### å¾®æœåŠ¡æ¶æ„ä¸»è¦è¦è§£å†³å“ªäº›é—®é¢˜ï¼Ÿ

1.  æœåŠ¡å¾ˆå¤šï¼Œå®¢æˆ·ç«¯æ€ä¹ˆè®¿é—®ï¼Œå¦‚ä½•æä¾›å¯¹å¤–ç½‘å…³?
2.  è¿™ä¹ˆå¤šæœåŠ¡ï¼ŒæœåŠ¡ä¹‹é—´å¦‚ä½•é€šä¿¡? HTTP è¿˜æ˜¯ RPC?
3.  è¿™ä¹ˆå¤šæœåŠ¡ï¼Œå¦‚ä½•æ²»ç†? æœåŠ¡çš„æ³¨å†Œå’Œå‘ç°ã€‚
4.  æœåŠ¡æŒ‚äº†æ€ä¹ˆåŠï¼Ÿç†”æ–­æœºåˆ¶ã€‚

#### æœ‰å“ªäº›ä¸»æµå¾®æœåŠ¡æ¡†æ¶ï¼Ÿ

1.  Spring Cloud Netflix
2.  Spring Cloud Alibaba
3.  SpringBoot + Dubbo + ZooKeeper

#### SpringCloud æœ‰å“ªäº›æ ¸å¿ƒç»„ä»¶ï¼Ÿ

![SpringCloud](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-2b988a72-0739-4fed-b271-eaf12589444f.png)

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„æ¯”äºšè¿ªåŒå­¦ 1 é¢è¯•åŸé¢˜ï¼šSpringCloud äº†è§£å¤šå°‘ï¼Ÿ

## è¡¥å……

### 40.SpringTask äº†è§£å—ï¼Ÿ

SpringTask æ˜¯ Spring æ¡†æ¶æä¾›çš„ä¸€ä¸ªè½»é‡çº§çš„ä»»åŠ¡è°ƒåº¦æ¡†æ¶ï¼Œå®ƒå…è®¸æˆ‘ä»¬å¼€å‘è€…é€šè¿‡ç®€å•çš„æ³¨è§£æ¥é…ç½®å’Œç®¡ç†å®šæ—¶ä»»åŠ¡ã€‚

â‘ ã€`@Scheduled`ï¼šæœ€å¸¸ç”¨çš„æ³¨è§£ï¼Œç”¨äºæ ‡è®°æ–¹æ³•ä¸ºè®¡åˆ’ä»»åŠ¡çš„æ‰§è¡Œç‚¹ã€‚[æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®](https://javabetter.cn/zhishixingqiu/paicoding.html)ä¸­ï¼Œå°±ä½¿ç”¨è¯¥æ³¨è§£æ¥å®šæ—¶åˆ·æ–° sitemap.xmlï¼š

```java
@Scheduled(cron = "0 15 5 * * ?")
public void autoRefreshCache() {
    log.info("å¼€å§‹åˆ·æ–°sitemap.xmlçš„urlåœ°å€ï¼Œé¿å…å‡ºç°æ•°æ®ä¸ä¸€è‡´é—®é¢˜!");
    refreshSitemap();
    log.info("åˆ·æ–°å®Œæˆï¼");
}
```

`@Scheduled` æ³¨è§£æ”¯æŒå¤šç§è°ƒåº¦é€‰é¡¹ï¼Œå¦‚ fixedRateã€fixedDelay å’Œ cron è¡¨è¾¾å¼ã€‚

â‘¡ã€`@EnableScheduling`ï¼šç”¨äºå¼€å¯å®šæ—¶ä»»åŠ¡çš„æ”¯æŒã€‚

![æŠ€æœ¯æ´¾çš„å¯åŠ¨ç±»å°±æœ‰è¯¥æ³¨è§£çš„å½±å­](https://cdn.tobebetterjavaer.com/stutymore/spring-20240422094511.png)

#### ç”¨SpringTaskèµ„æºå ç”¨å¤ªé«˜ï¼Œæœ‰ä»€ä¹ˆå…¶ä»–çš„æ–¹å¼è§£å†³ï¼Ÿï¼ˆè¡¥å……ï¼‰

>2024å¹´05æœˆ27æ—¥æ–°å¢

**ç¬¬ä¸€ï¼Œä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—**ï¼Œå¦‚ RabbitMQã€Kafkaã€RocketMQ ç­‰ï¼Œå°†ä»»åŠ¡æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç„¶åç”±æ¶ˆè´¹è€…å¼‚æ­¥å¤„ç†è¿™äº›ä»»åŠ¡ã€‚

â‘ ã€åœ¨è®¢å•åˆ›å»ºæ—¶ï¼Œå°†è®¢å•è¶…æ—¶æ£€æŸ¥ä»»åŠ¡æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¹¶è®¾ç½®å»¶è¿Ÿæ—¶é—´ï¼ˆå³è®¢å•è¶…æ—¶æ—¶é—´ï¼‰ã€‚

```java
@Service
public class OrderService {
    @Autowired
    private RabbitTemplate rabbitTemplate;

    public void createOrder(Order order) {
        // åˆ›å»ºè®¢å•é€»è¾‘
        // ...
        
        // å‘é€å»¶è¿Ÿæ¶ˆæ¯
        rabbitTemplate.convertAndSend("orderExchange", "orderTimeoutQueue", order, message -> {
            message.getMessageProperties().setExpiration("600000"); // è®¾ç½®å»¶è¿Ÿæ—¶é—´ï¼ˆ10åˆ†é’Ÿï¼‰
            return message;
        });
    }
}
```

â‘¡ã€ä½¿ç”¨æ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹æ¶ˆæ¯ï¼Œå½“æ¶ˆè´¹åˆ°è¶…æ—¶ä»»åŠ¡æ—¶ï¼Œæ‰§è¡Œè®¢å•è¶…æ—¶å¤„ç†é€»è¾‘ã€‚

```java
@Service
public class OrderTimeoutConsumer {

    @RabbitListener(queues = "orderTimeoutQueue")
    public void handleOrderTimeout(Order order) {
        // å¤„ç†è®¢å•è¶…æ—¶é€»è¾‘
        // ...
    }
}
```

**ç¬¬äºŒï¼Œä½¿ç”¨æ•°æ®åº“è°ƒåº¦å™¨ï¼ˆå¦‚ Quartzï¼‰**ã€‚

â‘ ã€åˆ›å»ºä¸€ä¸ª Quartz ä»»åŠ¡ç±»ï¼Œå¤„ç†è®¢å•è¶…æ—¶é€»è¾‘ã€‚

```java
public class OrderTimeoutJob implements Job {
    @Override
    public void execute(JobExecutionContext context) throws JobExecutionException {
        // è·å–è®¢å•ä¿¡æ¯
        Order order = (Order) context.getJobDetail().getJobDataMap().get("order");

        // å¤„ç†è®¢å•è¶…æ—¶é€»è¾‘
        // ...
    }
}
```

â‘¡ã€åœ¨è®¢å•åˆ›å»ºæ—¶ï¼Œè°ƒåº¦ä¸€ä¸ª Quartz ä»»åŠ¡ï¼Œè®¾ç½®ä»»åŠ¡çš„è§¦å‘æ—¶é—´ä¸ºè®¢å•è¶…æ—¶æ—¶é—´ã€‚

```java
@Service
public class OrderService {
    @Autowired
    private Scheduler scheduler;

    public void createOrder(Order order) {
        // åˆ›å»ºè®¢å•é€»è¾‘
        // ...

        // è°ƒåº¦ Quartz ä»»åŠ¡
        JobDetail jobDetail = JobBuilder.newJob(OrderTimeoutJob.class)
                .usingJobData("order", order)
                .build();

        Trigger trigger = TriggerBuilder.newTrigger()
                .startAt(new Date(System.currentTimeMillis() + 600000)) // è®¾ç½®è§¦å‘æ—¶é—´ï¼ˆ10åˆ†é’Ÿåï¼‰
                .build();

        try {
            scheduler.scheduleJob(jobDetail, trigger);
        } catch (SchedulerException e) {
            e.printStackTrace();
        }
    }
}
```

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¾®ä¼—é“¶è¡ŒåŒå­¦ 1 Java åç«¯ä¸€é¢çš„åŸé¢˜ï¼šSpringTask äº†è§£å—ï¼Ÿ
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„é˜¿é‡Œé¢ç»åŒå­¦ 1 é—²é±¼åç«¯ä¸€é¢çš„åŸé¢˜ï¼šè®¢å•è¶…æ—¶ï¼Œç”¨springtaskèµ„æºå ç”¨å¤ªé«˜ï¼Œæœ‰ä»€ä¹ˆå…¶ä»–çš„æ–¹å¼è§£å†³?

### 41.Spring Cache äº†è§£å—ï¼Ÿ

Spring Cache æ˜¯ Spring æ¡†æ¶æä¾›çš„ä¸€ä¸ªç¼“å­˜æŠ½è±¡ï¼Œå®ƒé€šè¿‡ç»Ÿä¸€çš„æ¥å£æ¥æ”¯æŒå¤šç§ç¼“å­˜å®ç°ï¼ˆå¦‚ Redisã€Caffeine ç­‰ï¼‰ã€‚

å®ƒé€šè¿‡æ³¨è§£ï¼ˆå¦‚ `@Cacheable`ã€`@CachePut`ã€`@CacheEvict`ï¼‰æ¥å®ç°ç¼“å­˜ç®¡ç†ï¼Œæå¤§ç®€åŒ–äº†ä»£ç å®ç°ã€‚

- @Cacheableï¼šç¼“å­˜æ–¹æ³•çš„è¿”å›å€¼ã€‚
- @CachePutï¼šç”¨äºæ›´æ–°ç¼“å­˜ï¼Œæ¯æ¬¡è°ƒç”¨æ–¹æ³•éƒ½ä¼šå°†ç»“æœé‡æ–°å†™å…¥ç¼“å­˜ã€‚
- @CacheEvictï¼šç”¨äºåˆ é™¤ç¼“å­˜ã€‚

ä½¿ç”¨ç¤ºä¾‹ï¼š

![äºŒå“¥çš„Java è¿›é˜¶ä¹‹è·¯ï¼šSpring Cache](https://cdn.tobebetterjavaer.com/stutymore/spring-20241031111306.png)

#### Spring Cache å’Œ Redis æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

1. **Spring Cache** æ˜¯ Spring æ¡†æ¶æä¾›çš„ä¸€ä¸ªç¼“å­˜æŠ½è±¡ï¼Œå®ƒé€šè¿‡æ³¨è§£æ¥å®ç°ç¼“å­˜ç®¡ç†ï¼Œæ”¯æŒå¤šç§ç¼“å­˜å®ç°ï¼ˆå¦‚ Redisã€Caffeine ç­‰ï¼‰ã€‚
2. **Redis** æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ç¼“å­˜ä¸­é—´ä»¶ï¼Œæ”¯æŒå¤šç§æ•°æ®ç±»å‹ï¼ˆå¦‚ Stringã€Hashã€Listã€Setã€ZSetï¼‰ï¼Œè¿˜æ”¯æŒæŒä¹…åŒ–ã€é›†ç¾¤ã€ä¸»ä»å¤åˆ¶ç­‰ã€‚

Spring Cache é€‚åˆç”¨äºå•æœºã€è½»é‡çº§å’ŒçŸ­æ—¶ç¼“å­˜åœºæ™¯ï¼Œèƒ½å¤Ÿé€šè¿‡æ³¨è§£è½»æ¾æ§åˆ¶ç¼“å­˜ç®¡ç†ã€‚

Redis æ˜¯ä¸€ç§åˆ†å¸ƒå¼ç¼“å­˜è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒå¤šç§æ•°æ®ç»“æ„å’Œé«˜å¹¶å‘è®¿é—®ï¼Œé€‚åˆåˆ†å¸ƒå¼ç³»ç»Ÿå’Œé«˜å¹¶å‘åœºæ™¯ï¼Œå¯ä»¥æä¾›æ•°æ®æŒä¹…åŒ–å’Œå¤šç§æ·˜æ±°ç­–ç•¥ã€‚

åœ¨å®é™…å¼€å‘ä¸­ï¼ŒSpring Cache å’Œ Redis å¯ä»¥ç»“åˆä½¿ç”¨ï¼ŒSpring Cache æä¾›ç®¡ç†ç¼“å­˜çš„æ³¨è§£ï¼Œè€Œ Redis åˆ™ä½œä¸ºåˆ†å¸ƒå¼ç¼“å­˜çš„å®ç°ï¼Œæä¾›å…±äº«ç¼“å­˜æ”¯æŒã€‚

#### æœ‰äº† Redis ä¸ºä»€ä¹ˆè¿˜éœ€è¦ Spring Cacheï¼Ÿ

è™½ç„¶ Redis éå¸¸å¼ºå¤§ï¼Œä½† Spring Cache æä¾›äº†ä¸€å±‚ç¼“å­˜æŠ½è±¡ï¼Œç®€åŒ–äº†ç¼“å­˜çš„ç®¡ç†ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨æ–¹æ³•ä¸Šé€šè¿‡æ³¨è§£æ¥å®ç°ç¼“å­˜é€»è¾‘ï¼Œå‡å°‘äº†æ‰‹åŠ¨æ“ä½œ Redis çš„ä»£ç é‡ã€‚

Spring Cache è¿˜èƒ½çµæ´»åˆ‡æ¢åº•å±‚ç¼“å­˜å®ç°ã€‚æ­¤å¤–ï¼ŒSpring Cache æ”¯æŒäº‹åŠ¡æ€§ç¼“å­˜å’Œæ¡ä»¶ç¼“å­˜ï¼Œä¾¿äºåœ¨å¤æ‚åœºæ™¯ä¸­ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚

#### è¯´è¯´Spring Cache çš„åº•å±‚åŸç†ï¼Ÿ

Spring Cache æ˜¯åŸºäº AOP å’Œç¼“å­˜æŠ½è±¡å±‚å®ç°çš„ã€‚å®ƒé€šè¿‡ AOP æ‹¦æˆªè¢« @Cacheableã€@CachePut å’Œ @CacheEvict æ³¨è§£çš„æ–¹æ³•ï¼Œåœ¨æ–¹æ³•è°ƒç”¨å‰åè‡ªåŠ¨æ‰§è¡Œç¼“å­˜é€»è¾‘ã€‚

![é“¿ç„¶æ¶æ„ï¼šSpring Cache æ¶æ„](https://cdn.tobebetterjavaer.com/stutymore/spring-20241031113743.png)

å…¶æä¾›çš„ CacheManager å’Œ Cache ç­‰æ¥å£ï¼Œä¸ä¾èµ–å…·ä½“çš„ç¼“å­˜å®ç°ï¼Œå› æ­¤å¯ä»¥çµæ´»åœ°é›†æˆ Redisã€Caffeine ç­‰å¤šç§ç¼“å­˜ã€‚

- ConcurrentMapCacheManagerï¼šåŸºäº Java ConcurrentMap çš„æœ¬åœ°ç¼“å­˜å®ç°ã€‚
- RedisCacheManagerï¼šåŸºäº Redis çš„åˆ†å¸ƒå¼ç¼“å­˜å®ç°ã€‚
- CaffeineCacheManagerï¼šåŸºäº Caffeine çš„ç¼“å­˜å®ç°ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç¾å›¢åŒå­¦ 9 ä¸€é¢é¢è¯•åŸé¢˜ï¼šä»‹ç»ä¸€ä¸‹springcache å’Œredisï¼ŸSpring cacheå’Œredisä¹‹é—´çš„å„åº”ç”¨åœ¨ä»€ä¹ˆåœºæ™¯ï¼Ÿæœ‰äº†redisä¸ºä»€ä¹ˆè¿˜è¦ç”¨springcaheï¼Ÿspringcache åº•å±‚åŸç†ï¼ŒåŸºäºä»€ä¹ˆå®ç°çš„ï¼Ÿ

---

å›¾æ–‡è¯¦è§£ 41 é“ Spring é¢è¯•é«˜é¢‘é¢˜ï¼Œè¿™æ¬¡åŠæ‰“é¢è¯•å®˜ï¼Œæˆ‘è§‰å¾—ç¨³äº†ï¼ˆæ‰‹åŠ¨ dogï¼‰ã€‚æ•´ç†ï¼šæ²‰é»˜ç‹äºŒï¼Œæˆ³[è½¬è½½é“¾æ¥](https://mp.weixin.qq.com/s/EQge6DmgIqYITM3mAxkatg)ï¼Œä½œè€…ï¼šä¸‰åˆ†æ¶ï¼Œæˆ³[åŸæ–‡é“¾æ¥](https://mp.weixin.qq.com/s/Y17S85ntHm_MLTZMJdtjQQ)ã€‚

_æ²¡æœ‰ä»€ä¹ˆä½¿æˆ‘åœç•™â€”â€”é™¤äº†ç›®çš„ï¼Œçºµç„¶å²¸æ—æœ‰ç«ç‘°ã€æœ‰ç»¿è«ã€æœ‰å®é™çš„æ¸¯æ¹¾ï¼Œæˆ‘æ˜¯ä¸ç³»ä¹‹èˆŸ_ã€‚

**ç³»åˆ—å†…å®¹**ï¼š

- [é¢æ¸£é€†è¢­ Java SE ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/javase.html)
- [é¢æ¸£é€†è¢­ Java é›†åˆæ¡†æ¶ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/javathread.html)
- [é¢æ¸£é€†è¢­ Java å¹¶å‘ç¼–ç¨‹ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/collection.html)
- [é¢æ¸£é€†è¢­ JVM ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/jvm.html)
- [é¢æ¸£é€†è¢­ Spring ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/spring.html)
- [é¢æ¸£é€†è¢­ Redis ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/redis.html)
- [é¢æ¸£é€†è¢­ MyBatis ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/mybatis.html)
- [é¢æ¸£é€†è¢­ MySQL ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/mysql.html)
- [é¢æ¸£é€†è¢­æ“ä½œç³»ç»Ÿç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/os.html)
- [é¢æ¸£é€†è¢­è®¡ç®—æœºç½‘ç»œç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/network.html)
- [é¢æ¸£é€†è¢­ RocketMQ ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/rocketmq.html)
- [é¢æ¸£é€†è¢­åˆ†å¸ƒå¼ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/fenbushi.html)
- [é¢æ¸£é€†è¢­å¾®æœåŠ¡ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/weifuwu.html)
- [é¢æ¸£é€†è¢­è®¾è®¡æ¨¡å¼ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/shejimoshi.html)
- [é¢æ¸£é€†è¢­ Linux ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/linux.html)

---

GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹](https://javabetter.cn/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)
