å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯äºŒå“¥å‘€ï¼ä»Šå¤©æ–°æ¥ä¸ªå®ä¹ ç”Ÿå°äºŒï¼Œä¿¡èª“æ—¦æ—¦è¯´ä»–ç²¾é€š Java å¹¶å‘ï¼Œæˆ‘æ°”ä¸è¿‡ç›´æ¥ä¸€é“ **CyclicBarrierå’ŒCountDownLatchæœ‰ä»€ä¹ˆåŒºåˆ«**å°±æŠŠä»–é—®æ‡µğŸ˜³äº†ã€‚

ä¼—æ‰€å‘¨çŸ¥ï¼ŒJava å¹¶å‘æ˜¯ Java ç¨‹åºå‘˜å¿…é¡»æ‡‚ä½†åˆå¾ˆéš¾æ‡‚çš„ä¸€å—çŸ¥è¯†ç‚¹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¾ˆå°‘æœ‰äººæ•¢è¯´è‡ªå·±ç²¾é€š Java å¹¶å‘çš„ï¼Œä¸€æ˜¯å®¹æ˜“è¢«é¢è¯•å®˜åŠæ‰“ï¼ŒäºŒæ˜¯å¹¶å‘ç¼–ç¨‹æ¶‰åŠåˆ°æ“ä½œç³»ç»Ÿã€å†…å­˜ã€CPU ç­‰è®¡ç®—æœºä¸“ä¸šæ¯”è¾ƒæ ¸å¿ƒçš„å†…å®¹ï¼Œæ¯”è¾ƒè€ƒéªŒä¸€ä¸ªç¨‹åºå‘˜çš„å†…åŠŸã€‚

ä»Šå¤©è¿™ç¯‡æ–‡ç« å°±æ¥ç»™å¤§å®¶ç›˜ç‚¹ä¸€ä¸‹ Java å¹¶å‘åˆ°åº•è¯¥å¦‚ä½•ä»å…¥é—¨åˆ°ç²¾é€šï¼Œè¯·åŠæ—¶ç”¨é¸¡æ¯›æ¸å­æŠŠæ”¶è—å¤¹é‡Œçš„ç°æ¸…ç†ä¸€ä¸‹ã€‚åœ¨é˜…è¯»è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰æ‰€å¸®åŠ©ï¼Œéº»çƒ¦ç‚¹èµå’Œåœ¨çœ‹ï¼Œç®—æ˜¯å¯¹æˆ‘ç å­—çš„è¿™ä»½åšæŒçš„äº¿ç‚¹ç‚¹é¼“åŠ±ã€‚

![](https://cdn.jsdelivr.net/gh/itwanger/toBeBetterJavaer/images/xuexiluxian/java-thread-1.gif)


### ä¸€ã€ä¸ºä»€ä¹ˆè¦å­¦ Java å¹¶å‘ï¼Ÿ

æœ‰å¥è¯ä¸çŸ¥é“å½“è®²ä¸å½“è®²ï¼Œå…ˆè®²äº†å†è¯´ï¼Œå°±æ˜¯â€œå¦‚æœä½ åªæƒ³ CURDï¼Œé‚£ä¹ˆ Java å¹¶å‘ä¸å­¦ä¹Ÿç½¢ï¼â€ä½†å…¶å®å‘¢ï¼Œå¤§å®¶éƒ½å·²ç»è¢«æ•™è‚²çš„å¾ˆæœ‰æ¶µå…»äº†ï¼Œå·¥ä½œä¸­æ‹§ä¸æ‹§èºä¸ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯é¢è¯•ä¸€å®šè¦ä¼šé€ ç«ç®­ï¼Œä¸ç„¶é¢è¯•çš„æœºä¼šéƒ½å¾ˆéš¾æå¾—åˆ°ã€‚

é‚£ä½œä¸º Java ä½“ç³»ä¸­éå¸¸é‡è¦çš„ä¸€ç¯ï¼ŒJava å¹¶å‘è‡ªç„¶æ˜¯å¿…é¡»è¦æŒæ¡çš„ï¼Œæœ€èµ·ç ä¹Ÿå¾—ä¼šèµ·ä¸ªå¤šçº¿ç¨‹å§ï¼Ÿå“ˆå“ˆå“ˆã€‚é«˜çº§ç‚¹çš„ï¼Œåƒå¹³å¸¸å¼€å‘ä¸­ç”¨åˆ°çš„ Tomcat æœåŠ¡å™¨ã€æ¶ˆæ¯ä¸­é—´ä»¶ã€RPC æ¡†æ¶ç­‰ç­‰ï¼Œå®ƒä»¬çš„åº•å±‚éƒ½æ¶‰åŠåˆ°äº†å¹¶å‘ç¼–ç¨‹ã€‚

å½“ç„¶äº†ï¼ŒJava å¹¶å‘æ¶‰åŠåˆ°ä¸œè¥¿å®åœ¨æ˜¯ä¸å°‘ï¼ŒåŒ…æ‹¬æ“ä½œç³»ç»Ÿçš„çŸ¥è¯†ï¼ŒJava è™šæ‹Ÿæœºçš„ä¸€äº›çŸ¥è¯†ï¼ŒJava çº¿ç¨‹æ¨¡å‹çš„çŸ¥è¯†ï¼Œå¤šçº¿ç¨‹ç›¸å…³çš„å…³é”®å­—ï¼Œæ¯”å¦‚è¯´ synchronizedã€volatile ç­‰ï¼Œè¿˜æœ‰é”çš„çŸ¥è¯†ã€JDK æä¾›çš„å·¥å…·ç±»ç­‰ç­‰ï¼Œå­¦èµ·æ¥è¿˜æ˜¯éå¸¸å®¹æ˜“ä»¤äººå¤´å¤§çš„ã€‚

![](https://cdn.jsdelivr.net/gh/itwanger/toBeBetterJavaer/images/xuexiluxian/java-thread-2.png)

å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›é«˜æ•ˆçš„å­¦ä¹ è·¯çº¿å›¾ï¼Œä»¥åŠä¸€äº›ä¼˜è´¨çš„å­¦ä¹ èµ„æºï¼Œä»è€Œå‡å°‘æˆ‘ä»¬å­¦ä¹ Java å¹¶å‘ç¼–ç¨‹æ‰€æŠ•å…¥çš„æ—¶é—´å’Œç²¾åŠ›ã€‚

### äºŒã€Java å¹¶å‘å­¦ä¹ è·¯çº¿å›¾

ç»™å¤§å®¶çœ‹ä¸€å¼  pdai.tech å­¦ä¹ ç½‘ç«™ä¸Šæ€»ç»“çš„ä¸€å¼ å…³äº Java å¹¶å‘ç¼–ç¨‹çš„æ€ç»´å¯¼å›¾ï¼Œéå¸¸æ¸…æ™°ï¼Œä¸€ç›®äº†ç„¶ï¼ŒåŒ…å«äº†ç†è®ºåŸºç¡€ã€çº¿ç¨‹åŸºç¡€ã€synchronizedã€volatileã€finalå…³é”®å­—ï¼Œä»¥åŠJUCæ¡†æ¶ç­‰æ ¸å¿ƒå†…å®¹ã€‚

>ç½‘ç«™åœ°å€ï¼šhttps://pdai.tech/

![](https://cdn.jsdelivr.net/gh/itwanger/toBeBetterJavaer/images/xuexiluxian/java-concurrent-overview-1.png)

å¦‚æœæƒ³æ€»è§ˆ Java å¹¶å‘ç¼–ç¨‹çš„å…³é”®çŸ¥è¯†ç‚¹çš„è¯ï¼Œè¿™å¼ æ€ç»´å¯¼å›¾è¿˜æ˜¯éå¸¸å€¼å¾—å‚è€ƒçš„ã€‚

### ä¸‰ã€ç¡¬æ ¸ Java å¹¶å‘å­¦ä¹ èµ„æ–™

**1ï¼‰è§†é¢‘**

æ‡‚çš„éƒ½æ‡‚ï¼Œçœ‹è§†é¢‘åˆ° B ç«™ã€‚é»‘é©¬çš„ã€ŠJavaå¹¶å‘ç¼–ç¨‹ã€‹è¯„ä»·è¿˜ä¸é”™ï¼Œ300 å¤šä¸ªå°èŠ‚ï¼Œæˆ‘è§‰å¾—è®²çš„æ¯”è¾ƒå¥½çš„æœ‰ä¸‰éƒ¨åˆ†ï¼šsynchronizedä¼˜åŒ–åŸç†ã€AQSå’Œçº¿ç¨‹æ± ã€‚

![](https://cdn.jsdelivr.net/gh/itwanger/toBeBetterJavaer/images/xuexiluxian/java-thread-4.png)

>è§†é¢‘åœ°å€ï¼šhttps://www.bilibili.com/video/BV16J411h7Rd

**2ï¼‰ä¹¦ç±**

çº¸è´¨ä¹¦åªæ¨èä¸€æœ¬ã€Š[Java å¹¶å‘ç¼–ç¨‹å®æˆ˜](https://book.douban.com/subject/10484692/)ã€‹ï¼Œè±†ç“£è¯„åˆ† 9.0ã€‚ä¸è¿‡è¿™æœ¬ä¹¦ç¡®å®æœ‰ç‚¹è€äº†ï¼ŒåŸºæœ¬ä¸Šæ˜¯æŒ‰ç…§ Java 6 æ¥è®²è§£çš„ï¼Œå¸Œæœ›å‡ºç‰ˆç¤¾èƒ½æ—©ç‚¹å‡º 2.0 ç‰ˆã€‚

![](https://cdn.jsdelivr.net/gh/itwanger/toBeBetterJavaer/images/xuexiluxian/java-thread-5.png)

ã€ŠJava å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹è¿™æœ¬ä¹¦ä»æ€»ä½“ä¸Šæ¥çœ‹ï¼Œåˆ†ä¸¤æ¡ä¸»çº¿ï¼š

- ä»‹ç» Java å¹¶å‘åŒ…çš„é‡è¦ç»„ä»¶å’ŒåŸç†
- å¦‚ä½•åˆ©ç”¨è¿™äº›ç»„ä»¶æ¥ä¿è¯çº¿ç¨‹å®‰å…¨

åˆ°åº•è¯¥å¦‚ä½•è·å¾—çº¿ç¨‹å®‰å…¨å‘¢ï¼ŸèƒŒä¼šå¹¶ç†è§£ä¸‹é¢è¿™æ®µè¯ï¼š

>Writing thread-safe code is, at its core, about managing access to state, and in particular to shared, mutable state.

å¦‚æœå‘ç°ä¸æ˜¯å¾ˆå¥½æ‡‚ï¼Œæƒ³ä»å›½å†…ä½œè€…ä¸‹æ‰‹çš„è¯ï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹ã€Š[Javaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯](https://book.douban.com/subject/26591326/)ã€‹å’Œã€Š[å›¾è§£Javaå¹¶å‘ç¼–ç¨‹](https://book.douban.com/subject/35634953/)ã€‹è¿™ä¸¤æœ¬ä¹¦ï¼Œè™½ç„¶è±†ç“£ä¸Šè¯„åˆ†ä¸€èˆ¬ï¼Œä½†å¯¹äºæ„å»º Java å¹¶å‘çš„çŸ¥è¯†ä½“ç³»è¿˜æ˜¯æœ‰å¾ˆå¤§å¸®åŠ©çš„ã€‚

ä¹‹åï¼Œå†å»å•ƒã€ŠJava å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹å°±ä¼šå‘ç°æ²¡æœ‰ä»¥å‰é‚£ä¹ˆè´¹åŠ²äº†ï¼Œè¿™æœ¬ä¹¦ä¹‹æ‰€ä»¥è¢«èª‰ä¸º Java å¹¶å‘ç¼–ç¨‹çš„åœ£ç»ï¼Œç¡®å®å¯ä»¥çœ‹å¾—å‡ºä½œè€…åœ¨å¹¶å‘ç¼–ç¨‹æ–¹é¢æœ‰ç€ä¸°å¯Œçš„ç»éªŒã€‚



**3ï¼‰å¼€æºç”µå­ä¹¦**

æ¨è RedSpiderç¤¾åŒºçš„[æ·±å…¥æµ…å‡º Java å¤šçº¿ç¨‹](http://concurrent.redspider.group/RedSpider.html)ï¼Œæ¯”Java å¹¶å‘ç¼–ç¨‹å®æˆ˜æ›´é€šä¿—æ˜“æ‡‚ä¸€äº›ï¼Œå› ä¸ºé‡Œé¢ç©¿æ’äº†å¾ˆå¤šç²¾ç¾çš„æ‰‹ç»˜å›¾ã€‚

![](https://cdn.jsdelivr.net/gh/itwanger/toBeBetterJavaer/images/xuexiluxian/java-thread-6.png)

>GitHubåœ°å€ï¼šhttps://github.com/RedSpider1/concurrent

è€ƒè™‘åˆ°æœ‰äº›å°ä¼™ä¼´å¯èƒ½éœ€è¦ [PDF ç‰ˆæœ¬](https://mp.weixin.qq.com/s/pxKrjw_5NTdZfHOKCkwn8w)ï¼Œæˆ‘èŠ±äº†ä¸€å‘¨çš„æ—¶é—´æ•´ç†äº†ä¸€ä»½ï¼Œéœ€è¦çš„æˆ³å‰é¢çš„é“¾æ¥å°±å¥½äº†ã€‚

å†æ¨èä¸€ä»½ GitHub ä¸Šæ˜Ÿæ ‡ 3.6k+ çš„ Java å¹¶å‘çŸ¥è¯†ç‚¹æ€»ç»“ï¼š

>https://github.com/CL0610/Java-concurrency

ä»“åº“é‡Œæœ‰ä¸€å¥è¯æˆ‘éå¸¸å–œæ¬¢ï¼Œä¹Ÿåˆ†äº«ç»™å„ä½å°ä¼™ä¼´ï¼š

>åŠªåŠ›çš„æ„ä¹‰ï¼Œå°±æ˜¯ï¼Œåœ¨ä»¥åçš„æ—¥å­é‡Œï¼Œæ”¾çœ¼æœ›å»å…¨æ˜¯è‡ªå·±å–œæ¬¢çš„äººå’Œäº‹ï¼

é¡ºå¸¦å†æ¨èä¸€ä»½å®Œæ•´çš„Java å¹¶å‘å­¦ä¹ ç¬”è®°ï¼š

>http://www.blogjava.net/xylz/archive/2010/07/08/325587.html



**4ï¼‰ä»˜è´¹ä¸“æ **

ç‹å®ä»¤è€å¸ˆåœ¨æå®¢æ—¶é—´ä¸Šå¼€äº†ä¸€é—¨ã€ŠJava å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹çš„ä»˜è´¹ä¸“æ ï¼Œè´¨é‡è¿˜æ˜¯æŒºé«˜çš„ï¼Œå–œæ¬¢çš„å°ä¼™ä¼´å¯ä»¥æˆ³[é“¾æ¥](http://gk.link/a/11cBH)å»è´­ä¹°ã€‚


### å››ã€ä¼˜è´¨å…«è‚¡æ–‡

è¿™é‡Œç»™å¤§å®¶æ¨èä¸¤ä»½ Java å¹¶å‘ç¼–ç¨‹æ–¹é¢çš„å…«è‚¡æ–‡ï¼Œä¸€ä»½æ¥è‡ª[ä¸‰åˆ†æ¶](https://mp.weixin.qq.com/s/1jhBZrAb7bnvkgN1TgAUpw)ï¼Œä¸€ä»½æ¥è‡ªå°ç‰›ï¼Œå…ˆæˆªå›¾ç»™å¤§å®¶çœ‹ä¸€ä¸‹ Java å¹¶å‘æ–¹é¢éƒ½æœ‰å“ªäº›é«˜é¢‘çš„é¢è¯•é¢˜ã€‚

![](https://cdn.jsdelivr.net/gh/itwanger/toBeBetterJavaer/images/xuexiluxian/java-thread-7.png)

ä¸ºäº†æ–¹ä¾¿å¤§å®¶çš„é˜…è¯»å’ŒèƒŒè¯µï¼Œæˆ‘å·²ç»å°†å…¶æ•´ç†åˆ°äº†äºŒå“¥çš„å°ç ´ç«™ã€ŠJava ç¨‹åºå‘˜è¿›é˜¶ä¹‹è·¯ã€‹ä¸Šã€‚è·¯å¾„ä¸€ï¼šJava åŸºç¡€â†’è¿›é˜¶ç¯‡â†’Java å¹¶å‘ç¼–ç¨‹â†’é¢æ¸£é€†è¢­

>https://tobebetterjavaer.com/#/README?id=é¢æ¸£é€†è¢­

è·¯å¾„äºŒï¼šæ±‚èŒé¢è¯•â†’å…«è‚¡æ–‡â†’Java å¹¶å‘ç¼–ç¨‹å…«è‚¡æ–‡ï¼ˆèƒŒè¯µç‰ˆï¼‰

>https://tobebetterjavaer.com/#/docs/baguwen/java-thread

è¿™ä¸¤ä»½å…«è‚¡æ–‡çš„è´¨é‡éƒ½éå¸¸é«˜ï¼Œæ¥çœ‹ä¸€ä¸‹ã€Œ[AQSäº†è§£å¤šå°‘](https://tobebetterjavaer.com/#/docs/thread/sanfene/aqs)ã€å°èŠ‚ä¸‹çš„å†…å®¹ï¼Œå›¾æ–‡å¹¶èŒ‚ï¼Œéå¸¸å®¹æ˜“æ¶ˆåŒ–å’Œå¸æ”¶ã€‚

![](https://cdn.jsdelivr.net/gh/itwanger/toBeBetterJavaer/images/xuexiluxian/java-thread-8.png)

è¯šå®ç‚¹è¯´ï¼Œå¦‚æœèƒ½æŠŠè¿™ä¸¤ä»½å…«è‚¡æ–‡èƒŒä¼šçš„è¯ï¼Œç®€å†ä¸Šå°±çœŸçš„æ•¢å†™â€œç²¾é€šâ€Java å¹¶å‘äº†ã€‚

### äº”ã€Java å¹¶å‘å­¦ä¹ å¿ƒå¾—

Java æä¾›çš„å¹¶å‘ç»„ä»¶ï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š

- ä»é¢„é˜²é˜¶æ®µä¸‹æ‰‹ï¼Œé˜²æ­¢é”™è¯¯å‘ç”Ÿï¼Œæ¯”å¦‚è¯´ synchronized å…³é”®å­—
- ä¸€æ—¦å‘ç”Ÿé”™è¯¯èƒ½åŠæ—¶é‡è¯•ï¼Œæ¯”å¦‚è¯´ CAS

å¯¹äºçº¿ç¨‹æ•°é‡æ¯”è¾ƒå¤šçš„å¹¶å‘åœºæ™¯ï¼Œé‡‡ç”¨é¢„é˜²çš„æªæ–½ä¼šæ¯”è¾ƒåˆç†ï¼Œè¿™æ ·å¤§éƒ¨åˆ†çº¿ç¨‹å°±ä¸ä¼šå› ä¸ºå°æ¦‚ç‡æ—¶é—´çš„ CAS é‡è¯•æµªè´¹æ‰å¤§é‡çš„ CPU å‘¨æœŸï¼›åœ¨çº¿ç¨‹æ•°é‡å°çš„æ—¶å€™ï¼ŒCAS çš„æ„ä¹‰å°±æ¯”è¾ƒå¤§ï¼Œå› ä¸ºé¢„é˜²æªæ–½å¸¦æ¥çš„çº¿ç¨‹åˆ‡æ¢è¦æ¯” CAS ç­‰å¾…çš„å¼€é”€æ›´å¤§ã€‚

æƒ³è¦å­¦å¥½ Java å¹¶å‘ç¼–ç¨‹ï¼Œå°±å¿…é¡»å¾—å¯¹ä¸‹å›¾ä¸­æåˆ°çš„åŸºç¡€æ¦‚å¿µè¿›è¡Œå……åˆ†çš„ç†è§£ã€‚

![](https://cdn.jsdelivr.net/gh/itwanger/toBeBetterJavaer/images/xuexiluxian/java-thread-9.jpg)

åœ¨æˆ‘çœ‹æ¥ï¼Œå¹¶å‘ç¼–ç¨‹ä¸»è¦æ˜¯ç”¨æ¥è§£å†³è¿™ä¸¤ä¸ªç—›ç‚¹çš„ï¼š

- å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€å˜é‡é€ æˆçš„ä¸ä¸€è‡´é—®é¢˜ï¼›
- ä¸ºæé«˜æ€§èƒ½ï¼Œè®¡ç®—æœºçš„å¾ˆå¤šæ‰§è¡Œå•å…ƒéƒ½é…å¤‡äº†ç¼“å­˜ï¼Œé‚£åŠ¿å¿…ä¼šå½±å“å¹¶å‘ç¼–ç¨‹çš„æ•°æ®ä¸€è‡´æ€§ã€‚

éœ€è¦æé†’ä¸€ç‚¹çš„æ˜¯ï¼Œå¤šçº¿ç¨‹å¹¶å‘è™½ç„¶æ˜¯ç”¨æ¥è§£å†³æ€§èƒ½é—®é¢˜çš„ï¼Œä½†å¹¶ä¸æ„å‘³ç€æ‰€æœ‰æƒ…å†µä¸‹éƒ½éœ€è¦å¼€å¯å¤šçº¿ç¨‹ï¼Œæœ‰æ—¶å€™åè€Œä¼šé€‚å¾—å…¶åï¼Œé‚£å¦‚æœä¸æ˜¯ç‰¹åˆ«è¦æ±‚ï¼Œå°½é‡ä¸è¦è¿‡æ—©å¼€å¯å¤šçº¿ç¨‹ã€‚

å¹¶å‘ç¼–ç¨‹æ˜¯ Java ä½“ç³»å½“ä¸­ç›¸å¯¹éš¾æŒæ¡çš„ä¸€å—çŸ¥è¯†ç‚¹ï¼Œæ¯”è¾ƒè€ƒéªŒä¸€åç¨‹åºå‘˜çš„å†…åŠŸï¼Œå…¶å®å¹¶å‘ç¼–ç¨‹æœ€æ—©çš„åº”ç”¨é¢†åŸŸå°±æ˜¯æ“ä½œç³»ç»Ÿçš„å®ç°ã€‚

å¦‚æœä½ å·²ç»æœ‰ä¸€å®šçš„ç¼–ç¨‹ç»éªŒï¼Œå»ºè®®å…ˆå­¦ä¸€ä¸‹ã€Šè®¡ç®—æœºç»„æˆåŸç†ã€‹ï¼Œå¯¹æ“ä½œç³»ç»Ÿã€å†…å­˜ã€CPU å…ˆè¿›è¡Œä¸€äº›å¤§è‡´çš„äº†è§£ï¼Œç„¶åå†æ¥å­¦ä¹  Java å¹¶å‘ç¼–ç¨‹ï¼Œå¯èƒ½å°±ä¼šæ„Ÿè§‰èˆ’æœå¤šäº†ï¼

ç»“åˆæˆ‘å¤šå¹´çš„å·¥ä½œç»éªŒæ¥çœ‹ï¼Œå¹¶å‘ç¼–ç¨‹å¯ä»¥æŠ½è±¡æˆ**ä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜ï¼šåˆ†å·¥ã€åŒæ­¥å’Œäº’æ–¥**ã€‚

1ï¼‰åˆ†å·¥

åˆ†å·¥æŒ‡çš„æ˜¯å¦‚ä½•é«˜æ•ˆåœ°æ‹†è§£ä»»åŠ¡å¹¶åˆ†é…ç»™çº¿ç¨‹ï¼Œåƒå¹¶å‘ç¼–ç¨‹é¢†åŸŸçš„ä¸€äº›è®¾è®¡æ¨¡å¼ï¼Œæ¯”å¦‚è¯´ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…å°±æ˜¯ç”¨æ¥è¿›è¡Œåˆ†å·¥çš„ã€‚

2ï¼‰åŒæ­¥

åŒæ­¥æŒ‡çš„æ˜¯çº¿ç¨‹ä¹‹é—´å¦‚ä½•åä½œï¼Œä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œäº†ä¸€ä¸ªä»»åŠ¡ï¼Œè¦é€šçŸ¥å¦å¤–ä¸€ä¸ªçº¿ç¨‹å¼€å·¥ã€‚è¿˜æ‹¿ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹æ¥è¯´å§ï¼Œå½“é˜Ÿåˆ—æ»¡çš„æ—¶å€™ï¼Œç”Ÿäº§è€…çº¿ç¨‹ç­‰å¾…ï¼Œå½“é˜Ÿåˆ—ä¸æ»¡çš„æ—¶å€™ï¼Œç”Ÿäº§è€…çº¿ç¨‹éœ€è¦è¢«å”¤é†’é‡æ–°æ‰§è¡Œï¼›å½“é˜Ÿåˆ—ç©ºçš„æ—¶å€™ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹å¼€å§‹ç­‰å¾…ï¼Œä¸ç©ºçš„æ—¶å€™ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹è¢«é‡æ–°å”¤é†’ã€‚

3ï¼‰äº’æ–¥

äº’æ–¥æŒ‡çš„æ˜¯ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºï¼Œæ˜¯è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜çš„æ€æ‰‹é”ã€‚

å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªå…±äº«å˜é‡çš„æ—¶å€™ï¼Œå¾ˆå®¹æ˜“å‡ºç°â€œçº¿ç¨‹å®‰å…¨â€é—®é¢˜ï¼Œå› ä¸ºç»“æœå¯èƒ½æ˜¯ä¸ç¡®å®šçš„â€”â€”å¯¼è‡´å‡ºç°è¿™ä¸ªé—®é¢˜çš„æ ¹æºå°±æ˜¯å¯è§æ€§ã€æœ‰åºæ€§å’ŒåŸå­æ€§â€”â€”ä¸ºäº†è§£å†³å®ƒä»¬ï¼ŒJava å¼•å…¥äº†å†…å­˜æ¨¡å‹çš„æ¦‚å¿µï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£â€œçº¿ç¨‹å®‰å…¨â€çš„é—®é¢˜ï¼Œä½†è¦æƒ³å®Œå…¨è§£å†³â€œçº¿ç¨‹å®‰å…¨â€é—®é¢˜ï¼Œè¿˜å¾—é äº’æ–¥ã€‚

äº’æ–¥çš„æ ¸å¿ƒæŠ€æœ¯å°±æ˜¯é”ï¼Œæ¯”å¦‚è¯´ synchronizedï¼Œè¿˜æœ‰å„ç§ Lockã€‚

é”å¯ä»¥è§£å†³çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œä½†åŒæ—¶ä¹Ÿå°±æ„å‘³ç€ç¨‹åºçš„æ€§èƒ½è¦å—åˆ°å½±å“ã€‚

å› æ­¤ï¼ŒJava æä¾›äº†é’ˆå¯¹ä¸åŒåœºæ™¯ä¸‹çš„é”ï¼Œæ¯”å¦‚è¯´è¯»å†™é” ReadWriteLockï¼Œå¯ä»¥è§£å†³å¤šçº¿ç¨‹åŒæ—¶è¯»ï¼Œä½†åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å†™çš„é—®é¢˜ï¼›ä½† ReadWriteLock ä¹Ÿæœ‰è‡ªå·±çš„é—®é¢˜ï¼Œå°±æ˜¯å¦‚æœæœ‰çº¿ç¨‹æ­£åœ¨è¯»ï¼Œå†™çº¿ç¨‹éœ€è¦ç­‰å¾…åº¦çº¿ç¨‹é‡Šæ”¾é”åæ‰èƒ½è·å¾—å†™é”ï¼Œä¹Ÿå°±æ˜¯è¯»çš„è¿‡ç¨‹ä¸­ä¸å…è®¸å†™ï¼Œå±äºä¸€ç§æ‚²è§‚çš„è¯»é”ã€‚

ä¸ºäº†è¿›ä¸€æ­¥æå‡å¹¶å‘æ‰§è¡Œçš„æ•ˆç‡ï¼ŒJava 8 å¼•å…¥äº†ä¸€ä¸ªæ–°çš„è¯»å†™é” StampedLockï¼Œä¸ReadWriteLock ç›¸æ¯”ï¼ŒStampedLockçš„ä¼˜åŠ¿åœ¨äºè¯»çš„è¿‡ç¨‹ä¸­ä¹Ÿå…è®¸è·å–å†™é”åå†™å…¥ï¼Œä½†å¸¦æ¥çš„é—®é¢˜å°±æ˜¯å¯èƒ½è¯»çš„æ•°æ®ä¸ä¸€è‡´ï¼Œéœ€è¦ä¸€ç‚¹é¢å¤–çš„ä»£ç æ¥åˆ¤æ–­è¯»çš„è¿‡ç¨‹ä¸­æ˜¯å¦æœ‰å†™å…¥ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ç§ä¹è§‚çš„é”ã€‚

ä¹è§‚é”çš„æ„æ€å°±æ˜¯ä¼°è®¡è¯»çš„è¿‡ç¨‹ä¸­å¤§æ¦‚ç‡ä¸ä¼šæœ‰å†™å…¥ï¼Œè€Œæ‚²è§‚é”åˆ™æ˜¯è¯»çš„è¿‡ç¨‹ä¸­æ‹’ç»æœ‰å†™å…¥ï¼Œä¸¤è€…çš„åŒºåˆ«å°±åœ¨äºæ€§èƒ½ä¸Šä¼šæœ‰å·®å¼‚ï¼Œä¹è§‚é”éœ€è¦é’ˆå¯¹å°æ¦‚ç‡äº‹ä»¶è¿›è¡Œå¤šä¸€æ­¥çš„æ£€æµ‹ï¼Œä½†æ€§èƒ½ä¹Ÿä¼šæœ‰æ‰€æå‡ï¼›æ‚²è§‚é”æ›´èƒ½ä¿è¯â€œçº¿ç¨‹å®‰å…¨æ€§â€ã€‚

å¬æˆ‘è¿™ä¹ˆä¸€è¯´ï¼Œæ˜¯ä¸æ˜¯ä¸€ä¸‹å­å°±æ¸…æ™°å¤šäº†ï¼

**Java å¹¶å‘ç¼–ç¨‹è™½ç„¶éš¾å­¦ï¼Œä¼šæ¶‰åŠåˆ°æ“ä½œç³»ç»Ÿã€CPUã€å†…å­˜ç­‰ååŸºç¡€æ–¹é¢çš„å†…å®¹ï¼Œä½†å¦‚æœä½ èƒ½åšæŒå­¦ä¸‹å»ï¼Œå†…åŠŸè‡ªç„¶è€Œç„¶å°±æå‡äº†ä¸€å¤§æˆª**ã€‚

å‚è€ƒèµ„æ–™ï¼š

>å°ç†Šçš„æŠ€æœ¯ä¹‹è·¯ï¼šhttps://zhuanlan.zhihu.com/p/25577863
