---
title: Redisé¢è¯•é¢˜ï¼Œ56é“Rediså…«è‚¡æ–‡ï¼ˆ1.9ä¸‡å­—97å¼ æ‰‹ç»˜å›¾ï¼‰ï¼Œé¢æ¸£é€†è¢­å¿…çœ‹ğŸ‘
shortTitle: é¢æ¸£é€†è¢­-Redis
description: ä¸‹è½½æ¬¡æ•°è¶… 1 ä¸‡æ¬¡ï¼Œ1.9 ä¸‡å­— 97 å¼ æ‰‹ç»˜å›¾ï¼Œè¯¦è§£ 56 é“ Redis é¢è¯•é«˜é¢‘é¢˜ï¼ˆè®©å¤©ä¸‹æ²¡æœ‰éš¾èƒŒçš„å…«è‚¡ï¼‰ï¼Œé¢æ¸£èƒŒä¼šè¿™äº› Redis å…«è‚¡æ–‡ï¼Œè¿™æ¬¡åŠæ‰“é¢è¯•å®˜ï¼Œæˆ‘è§‰å¾—ç¨³äº†ï¼ˆæ‰‹åŠ¨ dogï¼‰ã€‚
author: ä¸‰åˆ†æ¶
category:
  - é¢æ¸£é€†è¢­
tag:
  - é¢æ¸£é€†è¢­
head:
  - - meta
    - name: keywords
      content: Redisé¢è¯•é¢˜,Redis,å…«è‚¡æ–‡,é¢è¯•é¢˜
---

1.9 ä¸‡å­— 97 å¼ æ‰‹ç»˜å›¾ï¼Œè¯¦è§£ 56 é“ Redis é¢è¯•é«˜é¢‘é¢˜ï¼ˆè®©å¤©ä¸‹æ²¡æœ‰éš¾èƒŒçš„å…«è‚¡ï¼‰ï¼Œé¢æ¸£èƒŒä¼šè¿™äº› Redis å…«è‚¡æ–‡ï¼Œè¿™æ¬¡åŠæ‰“é¢è¯•å®˜ï¼Œæˆ‘è§‰å¾—ç¨³äº†ï¼ˆæ‰‹åŠ¨ dogï¼‰ã€‚æ•´ç†ï¼šæ²‰é»˜ç‹äºŒï¼Œæˆ³[è½¬è½½é“¾æ¥](https://mp.weixin.qq.com/s/19u34NXALB1nOlBCE6Eg-Q)ï¼Œä½œè€…ï¼šä¸‰åˆ†æ¶ï¼Œæˆ³[åŸæ–‡é“¾æ¥](https://mp.weixin.qq.com/s/iJtNJYgirRugNBnzxkbB4Q)ã€‚

## åŸºç¡€

### 1.è¯´è¯´ä»€ä¹ˆæ˜¯ Redis?

[Redis](https://javabetter.cn/redis/rumen.html) æ˜¯ **Re**mote **Di**ctionary **S**ervice ä¸‰ä¸ªå•è¯ä¸­åŠ ç²—å­—æ¯çš„ç»„åˆï¼Œæ˜¯ä¸€ç§åŸºäºé”®å€¼å¯¹ï¼ˆkey-valueï¼‰çš„ NoSQL æ•°æ®åº“ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRediså›¾æ ‡](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-96e079f9-49a3-4c55-b0a4-47d043732b62.png)

ä½†æ¯”ä¸€èˆ¬çš„é”®å€¼å¯¹ï¼Œæ¯”å¦‚ [HashMap](https://javabetter.cn/collection/hashmap.html) å¼ºå¤§çš„å¤šï¼ŒRedis ä¸­çš„ value æ”¯æŒ stringï¼ˆå­—ç¬¦ä¸²ï¼‰ã€hashï¼ˆå“ˆå¸Œï¼‰ã€ listï¼ˆåˆ—è¡¨ï¼‰ã€setï¼ˆé›†åˆï¼‰ã€zsetï¼ˆæœ‰åºé›†åˆï¼‰ã€Bitmapsï¼ˆä½å›¾ï¼‰ã€ [HyperLogLog](https://www.cnblogs.com/54chensongxia/p/13803465.html)ï¼ˆåŸºæ•°ä¼°ç®—ï¼‰ã€GEOï¼ˆåœ°ç†ä¿¡æ¯å®šä½ï¼‰ç­‰å¤šç§æ•°æ®ç»“æ„ã€‚

è€Œä¸”å› ä¸º Redis çš„æ‰€æœ‰æ•°æ®éƒ½å­˜æ”¾åœ¨å†…å­˜å½“ä¸­ï¼Œæ‰€ä»¥å®ƒçš„è¯»å†™æ€§èƒ½éå¸¸å‡ºè‰²ã€‚

ä¸ä»…å¦‚æ­¤ï¼ŒRedis è¿˜å¯ä»¥å°†å†…å­˜æ•°æ®æŒä¹…åŒ–åˆ°ç¡¬ç›˜ä¸Šï¼Œè¿™æ ·åœ¨å‘ç”Ÿç±»ä¼¼æ–­ç”µæˆ–è€…æœºå™¨æ•…éšœçš„æ—¶å€™ï¼Œå†…å­˜ä¸­çš„æ•°æ®å¹¶ä¸ä¼šâ€œä¸¢å¤±â€ã€‚

é™¤æ­¤ä¹‹å¤–ï¼ŒRedis è¿˜æä¾›äº†é”®è¿‡æœŸã€å‘å¸ƒè®¢é˜…ã€äº‹åŠ¡ã€æµæ°´çº¿ã€Lua è„šæœ¬ç­‰é™„åŠ åŠŸèƒ½ï¼Œæ˜¯äº’è”ç½‘æŠ€æœ¯é¢†åŸŸä¸­ä½¿ç”¨æœ€å¹¿æ³›çš„ç¼“å­˜ä¸­é—´ä»¶ã€‚

#### Redis å’Œ MySQL çš„åŒºåˆ«ï¼Ÿ

- Redisï¼šæ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ NoSQL æ•°æ®åº“ï¼Œè¯»å†™æ€§èƒ½éå¸¸å¥½ï¼Œæ˜¯äº’è”ç½‘æŠ€æœ¯é¢†åŸŸä¸­ä½¿ç”¨æœ€å¹¿æ³›çš„ç¼“å­˜ä¸­é—´ä»¶ã€‚
- MySQLï¼šæ•°æ®å­˜å‚¨åœ¨ç¡¬ç›˜ä¸­çš„å…³ç³»å‹æ•°æ®åº“ï¼Œé€‚ç”¨äºéœ€è¦äº‹åŠ¡æ”¯æŒå’Œå¤æ‚æŸ¥è¯¢çš„åœºæ™¯ã€‚

#### é¡¹ç›®é‡Œå“ªé‡Œç”¨åˆ°äº† Redisï¼Ÿ

åœ¨[æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®](https://javabetter.cn/zhishixingqiu/paicoding.html)ä¸­ï¼Œå¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°äº† Redisï¼Œæ¯”å¦‚è¯´ç”¨æˆ·æ´»è·ƒæ’è¡Œæ¦œã€ä½œè€…ç™½åå•ã€å¸¸ç”¨çƒ­ç‚¹æ•°æ®ï¼ˆæ–‡ç« æ ‡ç­¾ã€æ–‡ç« åˆ†ç±»ï¼‰ã€è®¡æ•°ç»Ÿè®¡ï¼ˆæ–‡ç« ç‚¹èµæ”¶è—è¯„è®ºæ•°ç²‰ä¸æ•°ï¼‰ç­‰ç­‰ã€‚

![æŠ€æœ¯æ´¾ä¸“æ ](https://cdn.tobebetterjavaer.com/stutymore/redis-20240420093229.png)

åƒç”¨æˆ·æ´»è·ƒæ¦œï¼Œä¸»è¦æ˜¯åŸºäº Redis çš„ Zset å®ç°çš„ï¼Œå¯ä»¥æ ¹æ® scoreï¼ˆåˆ†å€¼ï¼‰è¿›è¡Œæ’åºï¼Œå®æ—¶å±•ç¤ºç”¨æˆ·çš„æ´»è·ƒåº¦ã€‚

![æŠ€æœ¯æ´¾é˜…è¯»æ´»è·ƒæ¦œ](https://cdn.tobebetterjavaer.com/stutymore/redis-20240420100012.png)

å½“ç„¶äº†ï¼Œè¿™å—ä¹Ÿå¯ä»¥ä½¿ç”¨ Redis çš„ zrevrangeï¼Œç›´æ¥å€’åºå±•ç¤ºå‰ 8 åç”¨æˆ·ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„åä¸ºä¸€é¢åŸé¢˜ï¼šè¯´ä¸‹ Redis å’Œ HashMap çš„åŒºåˆ«
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å­—èŠ‚è·³åŠ¨å•†ä¸šåŒ–ä¸€é¢çš„åŸé¢˜ï¼šRedis å’Œ MySQL çš„åŒºåˆ«
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å†œä¸šé“¶è¡Œé¢ç»åŒå­¦ 7 Java åç«¯é¢è¯•åŸé¢˜ï¼šRedis ç›¸å…³çš„åŸºç¡€çŸ¥è¯†
> 4. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„åä¸º OD é¢ç»åŒå­¦ 1 ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis çš„äº†è§£, éƒ¨ç½²æ–¹æ¡ˆ?
> 5. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å†œä¸šé“¶è¡Œé¢ç»åŒå­¦ 3 Java åç«¯é¢è¯•åŸé¢˜ï¼šé¡¹ç›®é‡Œå“ªé‡Œç”¨åˆ°äº† Redis
> 6. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„360é¢ç»åŒå­¦ 3 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šç”¨è¿‡rediså— ç”¨æ¥å¹²ä»€ä¹ˆ
> 7. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„æ‹›å•†é“¶è¡Œé¢ç»åŒå­¦ 6 æ‹›é“¶ç½‘ç»œç§‘æŠ€é¢è¯•åŸé¢˜ï¼šäº†è§£MySQLã€Rediså—ï¼Ÿ
> 8. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç™¾åº¦é¢ç»åŒå­¦ 1 æ–‡å¿ƒä¸€è¨€ 25 å®ä¹  Java åç«¯é¢è¯•åŸé¢˜ï¼šé¡¹ç›®ä¸­ä»€ä¹ˆåœ°æ–¹ä½¿ç”¨äº†redisç¼“å­˜ï¼Œredisä¸ºä»€ä¹ˆå¿«ï¼Ÿ
> 9. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å›½ä¼é›¶ç¢é¢ç»åŒå­¦ 9 é¢è¯•åŸé¢˜ï¼šæ•°æ®åº“ç”¨ä»€ä¹ˆå¤šï¼ˆè¯´äº†Mysqlå’ŒRedisï¼‰

### 2.Redis å¯ä»¥ç”¨æ¥å¹²ä»€ä¹ˆï¼Ÿ

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedisçš„ä½œç”¨](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-b02e44b3-3299-450f-b767-4a862b5ac8ff.png)

â‘ ã€ç¼“å­˜

Redis æœ€å¸¸è§çš„ç”¨é€”å°±æ˜¯ä½œä¸ºç¼“å­˜ï¼Œç”±äºæ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥ Redis çš„è¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼Œè¿œè¶…åŸºäºç£ç›˜å­˜å‚¨çš„æ•°æ®åº“ã€‚ä½¿ç”¨ Redis ç¼“å­˜å¯ä»¥æå¤§åœ°æé«˜åº”ç”¨çš„å“åº”é€Ÿåº¦å’Œååé‡ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedisç¼“å­˜](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-d44c2397-5994-452f-8b7b-eb85d2b87685.png)

â‘¡ã€æ’è¡Œæ¦œ/è®¡æ•°å™¨

Redis çš„ ZSet éå¸¸é€‚åˆç”¨æ¥å®ç°æ’è¡Œæ¦œçš„åŠŸèƒ½ï¼ŒåŒæ—¶ Redis çš„åŸå­é€’å¢æ“ä½œå¯ä»¥ç”¨æ¥å®ç°è®¡æ•°å™¨åŠŸèƒ½ã€‚

â‘¢ã€åˆ†å¸ƒå¼é”

Redis å¯ä»¥å®ç°åˆ†å¸ƒå¼é”ï¼Œç”¨æ¥æ§åˆ¶è·¨å¤šä¸ªè¿›ç¨‹æˆ–æœåŠ¡å™¨çš„èµ„æºè®¿é—®ã€‚

ä»¥ä¸€ä¸ª[æŠ€æœ¯æ´¾é¡¹ç›®](https://javabetter.cn/zhishixingqiu/paicoding.html)çš„ç”¨æˆ·æœåŠ¡ä¸ºä¾‹å§ï¼š

- Redis å¯ä»¥ç”¨æ¥å­˜å‚¨ Tokenï¼šç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åï¼Œä½¿ç”¨ Redis çš„ hash å­˜å‚¨ Token
- ä½¿ç”¨ Redis çš„ Zset è®¡æ•°ï¼Œç™»å½•å¤±è´¥è¶…è¿‡ä¸€å®šæ¬¡æ•°ï¼Œé”å®šè´¦å·
- ä½¿ç”¨ Redisson å®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„ç™»å½•ã€æ³¨å†Œç­‰æ“ä½œ

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å†œä¸šé“¶è¡Œé¢ç»åŒå­¦ 7 Java åç«¯é¢è¯•åŸé¢˜ï¼šRedis ç›¸å…³çš„åŸºç¡€çŸ¥è¯†
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å­—èŠ‚è·³åŠ¨åŒå­¦ 7 Java åç«¯å®ä¹ ä¸€é¢çš„åŸé¢˜ï¼šè®²ä¸€ä¸‹ä¸ºä»€ä¹ˆè¦ç”¨ Redis å»å­˜æƒé™åˆ—è¡¨ï¼Ÿ

### 3.Redis æœ‰å“ªäº›æ•°æ®ç±»å‹ï¼Ÿ

Redis æœ‰äº”ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œè¿™äº”ç§æ•°æ®ç±»å‹åˆ†åˆ«æ˜¯ï¼šstringï¼ˆå­—ç¬¦ä¸²ï¼‰ã€hashï¼ˆå“ˆå¸Œï¼‰ã€listï¼ˆåˆ—è¡¨ï¼‰ã€setï¼ˆé›†åˆï¼‰ã€sorted setï¼ˆæœ‰åºé›†åˆï¼Œä¹Ÿå« zsetï¼‰ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedisåŸºæœ¬æ•°æ®ç±»å‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-10434dc7-c7a3-4c1a-b484-de3fb37669ee.png)

#### ç®€å•ä»‹ç»ä¸‹ string

å­—ç¬¦ä¸²æ˜¯æœ€åŸºç¡€çš„æ•°æ®ç±»å‹ï¼Œkey æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸ç”¨å¤šè¯´ï¼Œvalue å¯ä»¥æ˜¯ï¼š

- å­—ç¬¦ä¸²ï¼ˆç®€å•çš„å­—ç¬¦ä¸²ã€å¤æ‚çš„å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ JSONã€XMLï¼‰ï¼‰
- æ•°å­— ï¼ˆæ•´æ•°ã€æµ®ç‚¹æ•°ï¼‰
- ç”šè‡³æ˜¯äºŒè¿›åˆ¶ï¼ˆå›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ï¼‰ï¼Œä½†æœ€å¤§ä¸èƒ½è¶…è¿‡ 512MBã€‚

å­—ç¬¦ä¸²ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªå…¸å‹çš„ä½¿ç”¨åœºæ™¯ï¼š

- ç¼“å­˜åŠŸèƒ½
- è®¡æ•°
- å…±äº« Session
- é™é€Ÿ

#### ç®€å•ä»‹ç»ä¸‹ hash

é”®å€¼å¯¹é›†åˆï¼Œkey æ˜¯å­—ç¬¦ä¸²ï¼Œvalue æ˜¯ä¸€ä¸ª Map é›†åˆï¼Œæ¯”å¦‚è¯´ `value = {name: 'æ²‰é»˜ç‹äºŒ', age: 18}`ï¼Œname å’Œ age å±äºå­—æ®µ fieldï¼Œæ²‰é»˜ç‹äºŒ å’Œ 18 å±äºå€¼ valueã€‚

å“ˆå¸Œä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªå…¸å‹åº”ç”¨åœºæ™¯ï¼š

- ç¼“å­˜ç”¨æˆ·ä¿¡æ¯
- ç¼“å­˜å¯¹è±¡

#### ä»€ä¹ˆä½¿ç”¨hashç±»å‹è€Œä¸ä½¿ç”¨stringç±»å‹åºåˆ—åŒ–å­˜å‚¨ï¼Ÿ

æ¥æ„Ÿå—ä¸€ä¸‹ï¼Œä½¿ç”¨å­—ç¬¦ä¸²ç±»å‹å­˜å‚¨ç”¨æˆ·ä¿¡æ¯å’Œä½¿ç”¨å“ˆå¸Œç±»å‹å­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„åŒºåˆ«ï¼š

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://cdn.tobebetterjavaer.com/stutymore/redis-20240315115713.png)

å¯ä»¥çœ‹å¾—å‡ºï¼Œä½¿ç”¨ hash æ¯”ä½¿ç”¨ string æ›´ä¾¿äºè¿›è¡Œåºåˆ—åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€æ•´ä¸ªç”¨æˆ·å¯¹è±¡åºåˆ—åŒ–ï¼Œç„¶åä½œä¸ºä¸€ä¸ª value å­˜å‚¨åœ¨ Redis ä¸­ï¼Œå­˜å–æ›´åŠ ä¾¿æ·ã€‚

#### ç®€å•ä»‹ç»ä¸‹ list

list æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºã€‚å¯ä»¥æ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆå·¦è¾¹ï¼‰æˆ–è€…å°¾éƒ¨ï¼ˆå³è¾¹ï¼‰ã€‚

åˆ—è¡¨ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªä½¿ç”¨åœºæ™¯ï¼š

- æ¶ˆæ¯é˜Ÿåˆ—
- æ–‡ç« åˆ—è¡¨

#### ç®€å•ä»‹ç»ä¸‹ set

é›†åˆæ˜¯å­—ç¬¦ä¸²çš„æ— åºé›†åˆï¼Œé›†åˆä¸­çš„å…ƒç´ æ˜¯å”¯ä¸€çš„ï¼Œä¸å…è®¸é‡å¤ã€‚å’Œ Java é›†åˆæ¡†æ¶ä¸­çš„ Set æœ‰ç›¸ä¼¼ä¹‹å¤„ã€‚

é›†åˆä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªä½¿ç”¨åœºæ™¯ï¼š

- æ ‡ç­¾ï¼ˆtagï¼‰
- å…±åŒå…³æ³¨

#### ç®€å•ä»‹ç»ä¸‹ sorted set

Zsetï¼Œæœ‰åºé›†åˆï¼Œæ¯” set å¤šäº†ä¸€ä¸ªæ’åºå±æ€§ scoreï¼ˆåˆ†å€¼ï¼‰ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://cdn.tobebetterjavaer.com/stutymore/redis-20240315120652.png)

ä¸»è¦åº”ç”¨åœºæ™¯æœ‰ï¼š

- ç”¨æˆ·ç‚¹èµç»Ÿè®¡
- ç”¨æˆ·æ’åº

æ¯”å¦‚[æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®](https://javabetter.cn/zhishixingqiu/paicoding.html)ä¸­ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨ Zset æ¥å®ç°äº†ç”¨æˆ·æœˆåº¦æ´»è·ƒæ’è¡Œæ¦œã€‚

![æŠ€æœ¯æ´¾ç”¨æˆ·æ´»è·ƒæ¦œ](https://cdn.tobebetterjavaer.com/stutymore/redis-20240315120856.png)

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å­—èŠ‚è·³åŠ¨å•†ä¸šåŒ–ä¸€é¢çš„åŸé¢˜ï¼šè¯´è¯´ Redis çš„ zsetï¼Œä»€ä¹ˆæ˜¯è·³è¡¨ï¼Œæ’å…¥ä¸€ä¸ªèŠ‚ç‚¹è¦æ„å»ºå‡ å±‚ç´¢å¼•
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 9 é£ä¹¦åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis çš„æ•°æ®ç±»å‹ï¼ŒZSet çš„å®ç°
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³æš‘æœŸå®ä¹ åŒå­¦ E ä¸€é¢é¢è¯•åŸé¢˜ï¼šä½ å¯¹ Redis äº†è§£å¤šå°‘ï¼Œè¯´è¯´å¸¸è§çš„æ•°æ®ç»“æ„å’Œåº”ç”¨åœºæ™¯
> 4. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 23 QQ åå°æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis çš„æ•°æ®ç±»å‹
> 5. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¿«æ‰‹é¢ç»åŒå­¦ 7 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šè¯´ä¸€ä¸‹ Redis å¸¸ç”¨çš„æ•°æ®ç»“æ„
> 6. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å†œä¸šé“¶è¡Œé¢ç»åŒå­¦ 7 Java åç«¯é¢è¯•åŸé¢˜ï¼šRedis ç›¸å…³çš„åŸºç¡€çŸ¥è¯†
> 7. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„åä¸ºé¢ç»åŒå­¦ 11 é¢è¯•åŸé¢˜ï¼šé¡¹ç›®ä¸­ä½¿ç”¨äº†redisï¼Œredisæœ‰å“ªäº›æ•°æ®ç±»å‹ï¼Ÿåˆ†åˆ«ä½¿ç”¨çš„åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆä½¿ç”¨hashç±»å‹è€Œä¸ä½¿ç”¨stringç±»å‹åºåˆ—åŒ–å­˜å‚¨ï¼Ÿ

### 4.Redis ä¸ºä»€ä¹ˆå¿«å‘¢ï¼Ÿ

Redis çš„é€Ÿåº¦â¾®å¸¸å¿«ï¼Œå•æœºçš„ Redis å°±å¯ä»¥â½€æ’‘æ¯ç§’åå‡ ä¸‡çš„å¹¶å‘ï¼Œæ€§èƒ½æ˜¯ MySQL çš„â¼â¼—å€ã€‚é€Ÿåº¦å¿«çš„åŸå› ä¸»è¦æœ‰â¼ç‚¹ï¼š

â‘ ã€**åŸºäºå†…å­˜çš„æ•°æ®å­˜å‚¨**ï¼ŒRedis å°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜å½“ä¸­ï¼Œä½¿å¾—æ•°æ®çš„è¯»å†™æ“ä½œé¿å¼€äº†ç£ç›˜ I/Oã€‚è€Œå†…å­˜çš„è®¿é—®é€Ÿåº¦è¿œè¶…ç¡¬ç›˜ï¼Œè¿™æ˜¯ Redis è¯»å†™é€Ÿåº¦å¿«çš„æ ¹æœ¬åŸå› ã€‚

â‘¡ã€**å•çº¿ç¨‹æ¨¡å‹**ï¼ŒRedis ä½¿ç”¨å•çº¿ç¨‹æ¨¡å‹æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œè¿™æ„å‘³ç€åœ¨ä»»ä½•æ—¶åˆ»åªæœ‰ä¸€ä¸ªå‘½ä»¤åœ¨æ‰§è¡Œã€‚è¿™æ ·å°±é¿å…äº†çº¿ç¨‹åˆ‡æ¢å’Œé”ç«äº‰å¸¦æ¥çš„æ¶ˆè€—ã€‚

â‘¢ã€**IO å¤šè·¯å¤â½¤**ï¼ŒåŸºäº Linux çš„ select/epoll æœºåˆ¶ã€‚è¯¥æœºåˆ¶å…è®¸å†…æ ¸ä¸­åŒæ—¶å­˜åœ¨å¤šä¸ªç›‘å¬å¥—æ¥å­—å’Œå·²è¿æ¥å¥—æ¥å­—ï¼Œå†…æ ¸ä¼šä¸€ç›´ç›‘å¬è¿™äº›å¥—æ¥å­—ä¸Šçš„è¿æ¥è¯·æ±‚æˆ–è€…æ•°æ®è¯·æ±‚ï¼Œä¸€æ—¦æœ‰è¯·æ±‚åˆ°è¾¾ï¼Œå°±ä¼šäº¤ç»™ Redis å¤„ç†ï¼Œå°±å®ç°äº†æ‰€è°“çš„ Redis å•ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ª IO è¯»å†™çš„è¯·æ±‚ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedisä½¿ç”¨IOå¤šè·¯å¤ç”¨å’Œè‡ªèº«äº‹ä»¶æ¨¡å‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e05bca61-4600-495c-b92a-25ac822e034e.png)

â‘£ã€**é«˜æ•ˆçš„æ•°æ®ç»“æ„**ï¼ŒRedis æä¾›äº†å¤šç§é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå¦‚å­—ç¬¦ä¸²ï¼ˆStringï¼‰ã€åˆ—è¡¨ï¼ˆListï¼‰ã€é›†åˆï¼ˆSetï¼‰ã€æœ‰åºé›†åˆï¼ˆSorted Setï¼‰ç­‰ï¼Œè¿™äº›æ•°æ®ç»“æ„ç»è¿‡äº†é«˜åº¦ä¼˜åŒ–ï¼Œèƒ½å¤Ÿæ”¯æŒå¿«é€Ÿçš„æ•°æ®æ“ä½œã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„è…¾è®¯ Java åç«¯å®ä¹ ä¸€é¢åŸé¢˜ï¼šRedis ä¸ºä»€ä¹ˆè¯»å†™æ€§èƒ½é«˜ï¼Ÿ
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³æ˜¥æ‹›åŒå­¦ K ä¸€é¢é¢è¯•åŸé¢˜ï¼šä¸ºä»€ä¹ˆ redis å¿«ï¼Œæ·˜æ±°ç­–ç•¥ æŒä¹…åŒ–
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 1 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šå•çº¿ç¨‹çš„ Redis ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ
> 4. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¾®ä¼—é“¶è¡ŒåŒå­¦ 1 Java åç«¯ä¸€é¢çš„åŸé¢˜ï¼šRedis ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ
> 5. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç™¾åº¦é¢ç»åŒå­¦ 1 æ–‡å¿ƒä¸€è¨€ 25 å®ä¹  Java åç«¯é¢è¯•åŸé¢˜ï¼šé¡¹ç›®ä¸­ä»€ä¹ˆåœ°æ–¹ä½¿ç”¨äº†redisç¼“å­˜ï¼Œredisä¸ºä»€ä¹ˆå¿«ï¼Ÿ

### 5.èƒ½è¯´ä¸€ä¸‹ I/O å¤šè·¯å¤ç”¨å—ï¼Ÿ

å¼•ç”¨çŸ¥ä¹ä¸Šä¸€ä¸ªé«˜èµçš„å›ç­”æ¥è§£é‡Šä»€ä¹ˆæ˜¯ I/O å¤šè·¯å¤ç”¨ã€‚å‡è®¾ä½ æ˜¯ä¸€ä¸ªè€å¸ˆï¼Œè®© 30 ä¸ªå­¦ç”Ÿè§£ç­”ä¸€é“é¢˜ç›®ï¼Œç„¶åæ£€æŸ¥å­¦ç”Ÿåšçš„æ˜¯å¦æ­£ç¡®ï¼Œä½ æœ‰ä¸‹é¢å‡ ä¸ªé€‰æ‹©ï¼š

- ç¬¬ä¸€ç§é€‰æ‹©ï¼šæŒ‰é¡ºåºé€ä¸ªæ£€æŸ¥ï¼Œå…ˆæ£€æŸ¥ Aï¼Œç„¶åæ˜¯ Bï¼Œä¹‹åæ˜¯ Cã€Dã€‚ã€‚ã€‚è¿™ä¸­é—´å¦‚æœæœ‰ä¸€ä¸ªå­¦ç”Ÿå¡ä½ï¼Œå…¨ç­éƒ½ä¼šè¢«è€½è¯¯ã€‚è¿™ç§æ¨¡å¼å°±å¥½æ¯”ï¼Œä½ ç”¨å¾ªç¯æŒ¨ä¸ªå¤„ç† socketï¼Œæ ¹æœ¬ä¸å…·æœ‰å¹¶å‘èƒ½åŠ›ã€‚

- ç¬¬äºŒç§é€‰æ‹©ï¼šä½ åˆ›å»º 30 ä¸ªåˆ†èº«ï¼Œæ¯ä¸ªåˆ†èº«æ£€æŸ¥ä¸€ä¸ªå­¦ç”Ÿçš„ç­”æ¡ˆæ˜¯å¦æ­£ç¡®ã€‚ è¿™ç§ç±»ä¼¼äºä¸ºæ¯ä¸€ä¸ªç”¨æˆ·åˆ›å»ºä¸€ä¸ªè¿›ç¨‹æˆ–è€…- çº¿ç¨‹å¤„ç†è¿æ¥ã€‚

- ç¬¬ä¸‰ç§é€‰æ‹©ï¼Œä½ ç«™åœ¨è®²å°ä¸Šç­‰ï¼Œè°è§£ç­”å®Œè°ä¸¾æ‰‹ã€‚è¿™æ—¶ Cã€D ä¸¾æ‰‹ï¼Œè¡¨ç¤ºä»–ä»¬è§£ç­”é—®é¢˜å®Œæ¯•ï¼Œä½ ä¸‹å»ä¾æ¬¡æ£€æŸ¥ Cã€D çš„ç­”æ¡ˆï¼Œç„¶åç»§ç»­å›åˆ°è®²å°ä¸Šç­‰ã€‚æ­¤æ—¶ Eã€A åˆä¸¾æ‰‹ï¼Œç„¶åå»å¤„ç† E å’Œ Aã€‚

ç¬¬ä¸€ç§å°±æ˜¯é˜»å¡ IO æ¨¡å‹ï¼Œç¬¬ä¸‰ç§å°±æ˜¯ I/O å¤ç”¨æ¨¡å‹ã€‚

![å¤šè·¯å¤ç”¨æ¨¡å‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-eb541432-d68a-4dd9-b427-96c4dd607d64.png)

Linux ç³»ç»Ÿæœ‰ä¸‰ç§æ–¹å¼å®ç° IO å¤šè·¯å¤ç”¨ï¼šselectã€poll å’Œ epollã€‚

ä¾‹å¦‚ epoll æ–¹å¼æ˜¯å°†ç”¨æˆ· socket å¯¹åº”çš„ fd æ³¨å†Œè¿› epollï¼Œç„¶å epoll å¸®ä½ ç›‘å¬å“ªäº› socket ä¸Šæœ‰æ¶ˆæ¯åˆ°è¾¾ï¼Œè¿™æ ·å°±é¿å…äº†å¤§é‡çš„æ— ç”¨æ“ä½œã€‚æ­¤æ—¶çš„ socket åº”è¯¥é‡‡ç”¨éé˜»å¡æ¨¡å¼ã€‚

è¿™æ ·ï¼Œæ•´ä¸ªè¿‡ç¨‹åªåœ¨è¿›è¡Œ selectã€pollã€epoll è¿™äº›è°ƒç”¨çš„æ—¶å€™æ‰ä¼šé˜»å¡ï¼Œæ”¶å‘å®¢æˆ·æ¶ˆæ¯æ˜¯ä¸ä¼šé˜»å¡çš„ï¼Œæ•´ä¸ªè¿›ç¨‹æˆ–è€…çº¿ç¨‹å°±è¢«å……åˆ†åˆ©ç”¨èµ·æ¥ï¼Œè¿™å°±æ˜¯äº‹ä»¶é©±åŠ¨ï¼Œæ‰€è°“çš„ reactor æ¨¡å¼ã€‚

### 6. Redis ä¸ºä»€ä¹ˆæ—©æœŸé€‰æ‹©å•çº¿ç¨‹ï¼Ÿ

å®˜æ–¹è§£é‡Šï¼šhttps://redis.io/topics/faq

![å®˜æ–¹å•çº¿ç¨‹è§£é‡Š](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-344b8461-98d4-495b-a697-70275b0abad6.png)
å®˜æ–¹ FAQ è¡¨ç¤ºï¼Œå› ä¸º Redis æ˜¯åŸºäºå†…å­˜çš„æ“ä½œï¼ŒCPU æˆä¸º Redis çš„ç“¶é¢ˆçš„æƒ…å†µå¾ˆå°‘è§ï¼ŒRedis çš„ç“¶é¢ˆæœ€æœ‰å¯èƒ½æ˜¯å†…å­˜çš„å¤§å°æˆ–è€…ç½‘ç»œé™åˆ¶ã€‚

å¦‚æœæƒ³è¦æœ€å¤§ç¨‹åº¦åˆ©ç”¨ CPUï¼Œå¯ä»¥åœ¨ä¸€å°æœºå™¨ä¸Šå¯åŠ¨å¤šä¸ª Redis å®ä¾‹ã€‚

PSï¼šç½‘ä¸Šæœ‰è¿™æ ·çš„å›ç­”ï¼Œåæ§½å®˜æ–¹çš„è§£é‡Šæœ‰äº›æ•·è¡ï¼Œå…¶å®å°±æ˜¯å†å²åŸå› ï¼Œå¼€å‘è€…å«Œå¤šçº¿ç¨‹éº»çƒ¦ï¼Œåæ¥è¿™ä¸ª CPU çš„åˆ©ç”¨é—®é¢˜å°±è¢«æŠ›ç»™äº†ä½¿ç”¨è€…ã€‚

åŒæ—¶ FAQ é‡Œè¿˜æåˆ°äº†ï¼Œ Redis 4.0 ä¹‹åå¼€å§‹å˜æˆå¤šçº¿ç¨‹ï¼Œé™¤äº†ä¸»çº¿ç¨‹å¤–ï¼Œå®ƒä¹Ÿæœ‰åå°çº¿ç¨‹åœ¨å¤„ç†ä¸€äº›è¾ƒä¸ºç¼“æ…¢çš„æ“ä½œï¼Œä¾‹å¦‚æ¸…ç†è„æ•°æ®ã€æ— ç”¨è¿æ¥çš„é‡Šæ”¾ã€å¤§ Key çš„åˆ é™¤ç­‰ç­‰ã€‚

### 7.Redis6.0 ä½¿ç”¨å¤šçº¿ç¨‹æ˜¯æ€ä¹ˆå›äº‹?

Redis ä¸æ˜¯è¯´ç”¨å•çº¿ç¨‹çš„å—ï¼Ÿæ€ä¹ˆ 6.0 æˆäº†å¤šçº¿ç¨‹çš„ï¼Ÿ

Redis6.0 çš„å¤šçº¿ç¨‹æ˜¯ç”¨å¤šçº¿ç¨‹æ¥å¤„ç†æ•°æ®çš„**è¯»å†™å’Œåè®®è§£æ**ï¼Œä½†æ˜¯ Redis**æ‰§è¡Œå‘½ä»¤**è¿˜æ˜¯å•çº¿ç¨‹çš„ã€‚

![Redis6.0å¤šçº¿ç¨‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-b7b24e25-d2dc-4457-994f-95bdb3674b8e.png)
è¿™æ ·åšçš„â½¬çš„æ˜¯å› ä¸º Redis çš„æ€§èƒ½ç“¶é¢ˆåœ¨äºâ½¹ç»œ IO â½½â¾® CPUï¼Œä½¿â½¤å¤šçº¿ç¨‹èƒ½æå‡ IO è¯»å†™çš„æ•ˆç‡ï¼Œä»â½½æ•´ä½“æâ¾¼ Redis çš„æ€§èƒ½ã€‚

### 56.è¯´è¯´ Redis å¸¸ç”¨å‘½ä»¤ï¼ˆè¡¥å……ï¼‰

> 2024 å¹´ 04 æœˆ 11 æ—¥å¢è¡¥

â‘ ã€æ“ä½œå­—ç¬¦ä¸²çš„å‘½ä»¤æœ‰ï¼š

- `SET key value`ï¼šè®¾ç½®é”® key çš„å€¼ä¸º valueã€‚
- `GET key`ï¼šè·å–é”® key çš„å€¼ã€‚
- `DEL key`ï¼šåˆ é™¤é”® keyã€‚
- `INCR key`ï¼šå°†é”® key å­˜å‚¨çš„æ•°å€¼å¢ä¸€ã€‚
- `DECR key`ï¼šå°†é”® key å­˜å‚¨çš„æ•°å€¼å‡ä¸€ã€‚

â‘¡ã€æ“ä½œåˆ—è¡¨çš„å‘½ä»¤æœ‰ï¼š

- `LPUSH key value`ï¼šå°†ä¸€ä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨ key çš„å¤´éƒ¨ã€‚
- `RPUSH key value`ï¼šå°†ä¸€ä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨ key çš„å°¾éƒ¨ã€‚
- `LPOP key`ï¼šç§»é™¤å¹¶è¿”å›åˆ—è¡¨ key çš„å¤´å…ƒç´ ã€‚
- `RPOP key`ï¼šç§»é™¤å¹¶è¿”å›åˆ—è¡¨ key çš„å°¾å…ƒç´ ã€‚
- `LRANGE key start stop`ï¼šè·å–åˆ—è¡¨ key ä¸­æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ ã€‚

â‘¢ã€æ“ä½œé›†åˆçš„å‘½ä»¤æœ‰ï¼š

- `SADD key member`ï¼šå‘é›†åˆ key æ·»åŠ ä¸€ä¸ªå…ƒç´ ã€‚
- `SREM key member`ï¼šä»é›†åˆ key ä¸­ç§»é™¤ä¸€ä¸ªå…ƒç´ ã€‚
- `SMEMBERS key`ï¼šè¿”å›é›†åˆ key ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚

â‘£ã€æ“ä½œæœ‰åºé›†åˆçš„å‘½ä»¤æœ‰ï¼š

- `ZADD key score member`ï¼šå‘æœ‰åºé›†åˆ key æ·»åŠ ä¸€ä¸ªæˆå‘˜ï¼Œæˆ–æ›´æ–°å…¶åˆ†æ•°ã€‚
- `ZRANGE key start stop [WITHSCORES]`ï¼šæŒ‰ç…§ç´¢å¼•åŒºé—´è¿”å›æœ‰åºé›†åˆ key ä¸­çš„æˆå‘˜ï¼Œå¯é€‰ WITHSCORES å‚æ•°è¿”å›åˆ†æ•°ã€‚
- `ZREVRANGE key start stop [WITHSCORES]`ï¼šè¿”å›æœ‰åºé›†åˆ key ä¸­ï¼ŒæŒ‡å®šåŒºé—´å†…çš„æˆå‘˜ï¼ŒæŒ‰åˆ†æ•°é€’å‡ã€‚
- `ZREM key member`ï¼šç§»é™¤æœ‰åºé›†åˆ key ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ã€‚

â‘¤ã€æ“ä½œå“ˆå¸Œçš„å‘½ä»¤æœ‰ï¼š

- `HSET key field value`ï¼šå‘é”®ä¸º key çš„å“ˆå¸Œè¡¨ä¸­è®¾ç½®å­—æ®µ field çš„å€¼ä¸º valueã€‚
- `HGET key field`ï¼šè·å–é”®ä¸º key çš„å“ˆå¸Œè¡¨ä¸­å­—æ®µ field çš„å€¼ã€‚
- `HGETALL key`ï¼šè·å–é”®ä¸º key çš„å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰çš„å­—æ®µå’Œå€¼ã€‚
- `HDEL key field`ï¼šåˆ é™¤é”®ä¸º key çš„å“ˆå¸Œè¡¨ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µã€‚

#### è¯¦ç»†è¯´è¯´ set å‘½ä»¤ï¼Ÿ

åœ¨ Redis ä¸­ï¼Œè®¾ç½®é”®å€¼å¯¹çš„å‘½ä»¤æ˜¯ setã€‚set å‘½ä»¤æœ‰å‡ ä¸ªå¸¸ç”¨çš„å‚æ•°ï¼š

â‘ ã€å¯ä»¥é€šè¿‡ EX æˆ– PX ä¸ºé”®è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆç§’æˆ–æ¯«ç§’ï¼‰

```shell
redis-cli SET session_id "xyz" EX 3600  # è®¾ç½®é”® session_idï¼Œå€¼ä¸º "xyz"ï¼Œè¿‡æœŸæ—¶é—´ä¸º 3600 ç§’
```

â‘¡ã€NX é€‰é¡¹è¡¨ç¤ºåªæœ‰é”®ä¸å­˜åœ¨æ—¶æ‰è®¾ç½®

```shell
redis-cli SET lock_key "locked" NX
```

â‘¢ã€XX é€‰é¡¹è¡¨ç¤ºåªæœ‰é”®å­˜åœ¨æ—¶æ‰è®¾ç½®

```shell
redis-cli SET config "new_config" XX
```

#### sadd å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ

å‘æŒ‡å®š Set ä¸­æ·»åŠ  1 ä¸ªæˆ–å¤šä¸ª memberï¼Œå¦‚æœæŒ‡å®š Set ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªã€‚**æ—¶é—´å¤æ‚åº¦ O(N)** ï¼ŒN ä¸ºæ·»åŠ çš„ member ä¸ªæ•°ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„äº¬ä¸œé¢ç»åŒå­¦ 1 Java æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šè¯´è¯´ Redis å¸¸ç”¨å‘½ä»¤
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å†œä¸šé“¶è¡Œé¢ç»åŒå­¦ 3 Java åç«¯é¢è¯•åŸé¢˜ï¼šè¯´çš„é‚£ä¹ˆå¥½ï¼ŒRedis è®¾ç½® key value çš„å‡½æ•°æ˜¯å•¥
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¿«æ‰‹é¢ç»åŒå­¦ 1 éƒ¨é—¨ä¸»ç«™æŠ€æœ¯éƒ¨é¢è¯•åŸé¢˜ï¼šRedis çš„ sadd å‘½ä»¤æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ

### 54.å•çº¿ç¨‹ Redis çš„ QPS æ˜¯å¤šå°‘ï¼Ÿ(è¡¥å……)

> 2024 å¹´ 4 æœˆ 14 æ—¥å¢è¡¥

Redis çš„ QPSï¼ˆQueries Per Secondï¼Œæ¯ç§’æŸ¥è¯¢ç‡ï¼‰å—å¤šç§å› ç´ å½±å“ï¼ŒåŒ…æ‹¬ç¡¬ä»¶é…ç½®ï¼ˆå¦‚ CPUã€å†…å­˜ã€ç½‘ç»œå¸¦å®½ï¼‰ã€æ•°æ®æ¨¡å‹ã€å‘½ä»¤ç±»å‹ã€ç½‘ç»œå»¶è¿Ÿç­‰ã€‚

æ ¹æ®å®˜æ–¹çš„åŸºå‡†æµ‹è¯•ï¼Œä¸€ä¸ªæ™®é€šæœåŠ¡å™¨çš„ Redis å®ä¾‹é€šå¸¸å¯ä»¥è¾¾åˆ°æ¯ç§’æ•°ä¸‡åˆ°å‡ åä¸‡çš„ QPSã€‚

å¯ä»¥é€šè¿‡ `redis-benchmark` å‘½ä»¤è¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼š

```shell
redis-benchmark -h 127.0.0.1 -p 6379 -c 50 -n 10000
```

- `-h`ï¼šæŒ‡å®š Redis æœåŠ¡å™¨çš„åœ°å€ï¼Œé»˜è®¤æ˜¯ 127.0.0.1ã€‚
- `-p`ï¼šæŒ‡å®š Redis æœåŠ¡å™¨çš„ç«¯å£ï¼Œé»˜è®¤æ˜¯ 6379ã€‚
- `-c`ï¼šå¹¶å‘è¿æ¥æ•°ï¼Œå³åŒæ—¶æœ‰å¤šå°‘ä¸ªå®¢æˆ·ç«¯åœ¨è¿›è¡Œæµ‹è¯•ã€‚
- `-n`ï¼šè¯·æ±‚æ€»æ•°ï¼Œå³æµ‹è¯•è¿‡ç¨‹ä¸­æ€»å…±è¦æ‰§è¡Œå¤šå°‘ä¸ªè¯·æ±‚ã€‚

æˆ‘æœ¬æœºæ˜¯ä¸€å° macOSï¼Œ4 GHz å››æ ¸ Intel Core i7ï¼Œ32 GB 1867 MHz DDR3ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://cdn.tobebetterjavaer.com/stutymore/redis-20240408100900.png)

å¯ä»¥çœ‹å¾—å‡ºï¼Œæ¯ç§’èƒ½å¤„ç†è¶…è¿‡ 10 ä¸‡æ¬¡è¯·æ±‚ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 1 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šå•çº¿ç¨‹ Redis çš„ QPS æ˜¯å¤šå°‘ï¼Ÿ

GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹](https://javabetter.cn/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## æŒä¹…åŒ–

### 8.Redis æŒä¹…åŒ–â½…å¼æœ‰å“ªäº›ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

Redis æ”¯æŒä¸¤ç§ä¸»è¦çš„æŒä¹…åŒ–æ–¹å¼ï¼šRDBï¼ˆRedis DataBaseï¼‰æŒä¹…åŒ–å’Œ AOFï¼ˆAppend Only Fileï¼‰æŒä¹…åŒ–ã€‚è¿™ä¸¤ç§æ–¹å¼å¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åŒæ—¶ä½¿ç”¨ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedisæŒä¹…åŒ–çš„ä¸¤ç§æ–¹å¼](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-3bda4a46-adc3-4f0d-a135-b8ae5d4c0d5d.png)

#### è¯´ä¸€ä¸‹ RDBï¼Ÿ

RDB æŒä¹…åŒ–é€šè¿‡åˆ›å»ºæ•°æ®é›†çš„å¿«ç…§ï¼ˆsnapshotï¼‰æ¥å·¥ä½œï¼Œåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°† Redis åœ¨æŸä¸€æ—¶åˆ»çš„æ•°æ®çŠ¶æ€ä¿å­˜åˆ°ç£ç›˜çš„ä¸€ä¸ª RDB æ–‡ä»¶ä¸­ã€‚

å¯é€šè¿‡ save å’Œ bgsave å‘½ä»¤ä¸¤ä¸ªå‘½ä»¤æ¥æ‰‹åŠ¨è§¦å‘ RDB æŒä¹…åŒ–æ“ä½œï¼š

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šsaveå’Œbgsave](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-ffe56e32-34c5-453d-8859-c2febbe6a038.png)

**â‘ ã€save å‘½ä»¤**ï¼šä¼šåŒæ­¥åœ°å°† Redis çš„æ‰€æœ‰æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸Šçš„ä¸€ä¸ª RDB æ–‡ä»¶ä¸­ã€‚è¿™ä¸ªæ“ä½œä¼šé˜»å¡æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚ç›´åˆ° RDB æ–‡ä»¶è¢«å®Œå…¨å†™å…¥ç£ç›˜ã€‚

å½“ Redis æ•°æ®é›†è¾ƒå¤§æ—¶ï¼Œä½¿ç”¨ SAVE å‘½ä»¤ä¼šå¯¼è‡´ Redis æœåŠ¡å™¨åœæ­¢å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚

ä¸æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé™¤éæ•°æ®é›†éå¸¸å°ï¼Œæˆ–è€…å¯ä»¥æ¥å—æœåŠ¡æš‚æ—¶çš„ä¸å¯ç”¨çŠ¶æ€ã€‚

**â‘¡ã€bgsave å‘½ä»¤**ï¼šä¼šåœ¨åå°å¼‚æ­¥åœ°åˆ›å»º Redis çš„æ•°æ®å¿«ç…§ï¼Œå¹¶å°†å¿«ç…§ä¿å­˜åˆ°ç£ç›˜ä¸Šçš„ RDB æ–‡ä»¶ä¸­ã€‚è¿™ä¸ªå‘½ä»¤ä¼šç«‹å³è¿”å›ï¼ŒRedis æœåŠ¡å™¨å¯ä»¥ç»§ç»­å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ã€‚

åœ¨ BGSAVE å‘½ä»¤æ‰§è¡ŒæœŸé—´ï¼ŒRedis ä¼šç»§ç»­å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¯¹æœåŠ¡çš„å¯ç”¨æ€§å½±å“è¾ƒå°ã€‚å¿«ç…§çš„åˆ›å»ºè¿‡ç¨‹æ˜¯ç”±ä¸€ä¸ªå­è¿›ç¨‹å®Œæˆçš„ï¼Œä¸»è¿›ç¨‹ä¸ä¼šè¢«é˜»å¡ã€‚æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ‰§è¡Œ RDB æŒä¹…åŒ–çš„æ¨èæ–¹å¼ã€‚

ä»¥ä¸‹åœºæ™¯ä¼šè‡ªåŠ¨è§¦å‘ RDB æŒä¹…åŒ–ï¼š

â‘ ã€åœ¨ Redis é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ redis.confï¼‰ä¸­ï¼Œå¯ä»¥é€šè¿‡`save <seconds> <changes>`æŒ‡ä»¤é…ç½®è‡ªåŠ¨è§¦å‘ RDB æŒä¹…åŒ–çš„æ¡ä»¶ã€‚è¿™ä¸ªæŒ‡ä»¤å¯ä»¥è®¾ç½®å¤šæ¬¡ï¼Œæ¯ä¸ªè®¾ç½®å®šä¹‰äº†ä¸€ä¸ªæ—¶é—´é—´éš”ï¼ˆç§’ï¼‰å’Œè¯¥æ—¶é—´å†…å‘ç”Ÿçš„å˜æ›´æ¬¡æ•°é˜ˆå€¼ã€‚

```
save 900 1
save 300 10
save 60 10000
```

è¿™æ„å‘³ç€ï¼š

- å¦‚æœè‡³å°‘æœ‰ 1 ä¸ªé”®è¢«ä¿®æ”¹ï¼Œ900 ç§’åè‡ªåŠ¨è§¦å‘ä¸€æ¬¡ RDB æŒä¹…åŒ–ã€‚
- å¦‚æœè‡³å°‘æœ‰ 10 ä¸ªé”®è¢«ä¿®æ”¹ï¼Œ300 ç§’åè‡ªåŠ¨è§¦å‘ä¸€æ¬¡ RDB æŒä¹…åŒ–ã€‚
- å¦‚æœè‡³å°‘æœ‰ 10000 ä¸ªé”®è¢«ä¿®æ”¹ï¼Œ60 ç§’åè‡ªåŠ¨è§¦å‘ä¸€æ¬¡ RDB æŒä¹…åŒ–ã€‚

æ»¡è¶³ä»¥ä¸Šä»»ä¸€æ¡ä»¶ï¼ŒRDB æŒä¹…åŒ–å°±ä¼šè¢«è‡ªåŠ¨è§¦å‘ã€‚

â‘¡ã€å½“ Redis æœåŠ¡å™¨é€šè¿‡ SHUTDOWN å‘½ä»¤æ­£å¸¸å…³é—­æ—¶ï¼Œå¦‚æœæ²¡æœ‰ç¦ç”¨ RDB æŒä¹…åŒ–ï¼ŒRedis ä¼šè‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡ RDB æŒä¹…åŒ–ï¼Œä»¥ç¡®ä¿æ•°æ®åœ¨ä¸‹æ¬¡å¯åŠ¨æ—¶èƒ½å¤Ÿæ¢å¤ã€‚

â‘¢ã€åœ¨ Redis å¤åˆ¶åœºæ™¯ä¸­ï¼Œå½“ä¸€ä¸ª Redis å®ä¾‹è¢«é…ç½®ä¸ºä»èŠ‚ç‚¹å¹¶ä¸”ä¸ä¸»èŠ‚ç‚¹å»ºç«‹è¿æ¥æ—¶ï¼Œå®ƒå¯èƒ½ä¼šæ ¹æ®é…ç½®æ¥æ”¶ä¸»èŠ‚ç‚¹çš„ RDB æ–‡ä»¶æ¥åˆå§‹åŒ–æ•°æ®é›†ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»èŠ‚ç‚¹ä¼šåœ¨åå°è‡ªåŠ¨è§¦å‘ RDB æŒä¹…åŒ–ï¼Œç„¶åå°†ç”Ÿæˆçš„ RDB æ–‡ä»¶å‘é€ç»™ä»èŠ‚ç‚¹ã€‚

#### è¯´ä¸€ä¸‹ AOFï¼Ÿ

AOF æŒä¹…åŒ–é€šè¿‡è®°å½•æ¯ä¸ªå†™æ“ä½œå‘½ä»¤å¹¶å°†å…¶è¿½åŠ åˆ° AOF æ–‡ä»¶ä¸­æ¥å·¥ä½œï¼Œæ¢å¤æ—¶é€šè¿‡é‡æ–°æ‰§è¡Œè¿™äº›å‘½ä»¤æ¥é‡å»ºæ•°æ®é›†ã€‚

AOF çš„ä¸»è¦ä½œç”¨æ˜¯è§£å†³äº†æ•°æ®æŒä¹…åŒ–çš„å®æ—¶æ€§ï¼Œç›®å‰å·²ç»æ˜¯ Redis æŒä¹…åŒ–çš„ä¸»æµæ–¹å¼ã€‚

AOF çš„å·¥ä½œæµç¨‹æ“ä½œæœ‰å››ä¸ªæ­¥éª¤ï¼šå‘½ä»¤å†™å…¥ ï¼ˆappendï¼‰ã€æ–‡ä»¶åŒæ­¥ï¼ˆsyncï¼‰ã€æ–‡ä»¶é‡å†™ï¼ˆrewriteï¼‰ã€é‡å¯åŠ è½½ï¼ˆloadï¼‰

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šAOFå·¥ä½œæµç¨‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-a9fb6202-b1a1-484d-a4fa-fef519090b44.png)

æµç¨‹å¦‚ä¸‹ï¼š

1ï¼‰å½“ AOF æŒä¹…åŒ–åŠŸèƒ½è¢«å¯ç”¨æ—¶ï¼ˆé€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½® appendonly å‚æ•°ä¸º yes æ¥å¯ç”¨ï¼‰ï¼ŒRedis æœåŠ¡å™¨ä¼šå°†æ¥æ”¶åˆ°çš„æ‰€æœ‰å†™å‘½ä»¤ï¼ˆæ¯”å¦‚ SET, LPUSH, SADD ç­‰ä¿®æ”¹æ•°æ®çš„å‘½ä»¤ï¼‰è¿½åŠ åˆ° AOF ç¼“å†²åŒºï¼ˆbufferï¼‰çš„æœ«å°¾ã€‚

2ï¼‰ä¸ºäº†å°†ç¼“å†²åŒºä¸­çš„å‘½ä»¤æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­çš„ AOF æ–‡ä»¶ï¼ŒRedis æä¾›äº†å‡ ç§ä¸åŒçš„åŒæ­¥ç­–ç•¥ï¼š

- alwaysï¼šæ¯æ¬¡å†™å‘½ä»¤éƒ½ä¼šåŒæ­¥åˆ° AOF æ–‡ä»¶ï¼Œè¿™æä¾›äº†æœ€é«˜çš„æ•°æ®å®‰å…¨æ€§ï¼Œä½†å¯èƒ½å› ä¸ºç£ç›˜ I/O çš„å»¶è¿Ÿè€Œå½±å“æ€§èƒ½ã€‚
- everysecï¼ˆé»˜è®¤ï¼‰ï¼šæ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼Œè¿™æ˜¯ä¸€ç§æŠ˜è¡·æ–¹æ¡ˆï¼Œæä¾›äº†è¾ƒå¥½çš„æ€§èƒ½å’Œæ•°æ®å®‰å…¨æ€§ã€‚å¦‚æœç³»ç»Ÿå´©æºƒï¼Œæœ€å¤šå¯èƒ½ä¸¢å¤±æœ€åä¸€ç§’çš„æ•°æ®ã€‚
- noï¼šåªä¼šåœ¨ AOF å…³é—­æˆ– Redis å…³é—­æ—¶æ‰§è¡Œï¼Œ æˆ–ç”±æ“ä½œç³»ç»Ÿå†…æ ¸è§¦å‘ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå¦‚æœå‘ç”Ÿå®•æœºï¼Œé‚£ä¹ˆä¸¢å¤±çš„æ•°æ®é‡ç”±æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å­˜å†²æ´—ç­–ç•¥å†³å®šã€‚

3ï¼‰éšç€æ“ä½œçš„ä¸æ–­æ‰§è¡Œï¼ŒAOF æ–‡ä»¶ä¼šä¸æ–­å¢é•¿ï¼Œä¸ºäº†å‡å° AOF æ–‡ä»¶å¤§å°ï¼ŒRedis å¯ä»¥é‡å†™ AOF æ–‡ä»¶ï¼š

- é‡å†™è¿‡ç¨‹ä¸ä¼šè§£æåŸå§‹çš„ AOF æ–‡ä»¶ï¼Œè€Œæ˜¯å°†å½“å‰å†…å­˜ä¸­çš„æ•°æ®åº“çŠ¶æ€è½¬æ¢ä¸ºä¸€ç³»åˆ—å†™å‘½ä»¤ï¼Œç„¶åä¿å­˜åˆ°ä¸€ä¸ªæ–°çš„ AOF æ–‡ä»¶ä¸­ã€‚
- AOF é‡å†™æ“ä½œç”± BGREWRITEAOF å‘½ä»¤è§¦å‘ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹æ¥æ‰§è¡Œé‡å†™æ“ä½œï¼Œå› æ­¤ä¸ä¼šé˜»å¡ä¸»è¿›ç¨‹ã€‚
- é‡å†™è¿‡ç¨‹ä¸­ï¼Œæ–°çš„å†™å‘½ä»¤ä¼šç»§ç»­è¿½åŠ åˆ°æ—§çš„ AOF æ–‡ä»¶ä¸­ï¼ŒåŒæ—¶ä¹Ÿä¼šè¢«è®°å½•åˆ°ä¸€ä¸ªç¼“å†²åŒºä¸­ã€‚ä¸€æ—¦é‡å†™å®Œæˆï¼ŒRedis ä¼šå°†è¿™ä¸ªç¼“å†²åŒºä¸­çš„å‘½ä»¤è¿½åŠ åˆ°æ–°çš„ AOF æ–‡ä»¶ä¸­ï¼Œç„¶ååˆ‡æ¢åˆ°æ–°çš„ AOF æ–‡ä»¶ä¸Šï¼Œä»¥ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ã€‚

4ï¼‰å½“ Redis æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œå¦‚æœé…ç½®ä¸ºä½¿ç”¨ AOF æŒä¹…åŒ–æ–¹å¼ï¼Œå®ƒä¼šè¯»å– AOF æ–‡ä»¶ä¸­çš„æ‰€æœ‰å‘½ä»¤å¹¶é‡æ–°æ‰§è¡Œå®ƒä»¬ï¼Œä»¥æ¢å¤æ•°æ®åº“çš„çŠ¶æ€ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³æ˜¥æ‹›åŒå­¦ K ä¸€é¢é¢è¯•åŸé¢˜ï¼šä¸ºä»€ä¹ˆ redis å¿«ï¼Œæ·˜æ±°ç­–ç•¥ æŒä¹…åŒ–
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¿«æ‰‹é¢ç»åŒå­¦ 7 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šè¯´ä¸€ä¸‹ Redis çš„æŒä¹…åŒ–æ–¹å¼
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°å…¬å¸é¢ç»åˆé›†åŒå­¦ 1 Java åç«¯é¢è¯•åŸé¢˜ï¼šRedis çš„æŒä¹…åŒ–æ–¹å¼ï¼ŸRDB å’Œ AOF çš„åŒºåˆ«ï¼ŸRedis å®•æœºå“ªç§æ¢å¤çš„æ¯”è¾ƒå¿«ï¼Ÿ
> 4. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç¾å›¢é¢ç»åŒå­¦ 18 æˆéƒ½åˆ°å®¶é¢è¯•åŸé¢˜ï¼šredisæŒä¹…åŒ–

### 9.RDB å’Œ AOF å„è‡ªæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ

RDB æ˜¯ä¸€ä¸ªéå¸¸ç´§å‡‘çš„å•æ–‡ä»¶ï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶ dump.rdbï¼‰ï¼Œä»£è¡¨äº† Redis åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„æ•°æ®å¿«ç…§ã€‚éå¸¸é€‚åˆç”¨äºå¤‡ä»½æ•°æ®ï¼Œæ¯”å¦‚åœ¨å¤œé—´è¿›è¡Œå¤‡ä»½ï¼Œç„¶åå°† RDB æ–‡ä»¶å¤åˆ¶åˆ°è¿œç¨‹æœåŠ¡å™¨ã€‚ä½†å¯èƒ½ä¼šä¸¢å¤±æœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®ã€‚

AOF çš„æœ€å¤§ä¼˜ç‚¹æ˜¯çµæ´»ï¼Œå®æ—¶æ€§å¥½ï¼Œå¯ä»¥è®¾ç½®ä¸åŒçš„ fsync ç­–ç•¥ï¼Œå¦‚æ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼Œæ¯æ¬¡å†™å…¥å‘½ä»¤å°±åŒæ­¥ï¼Œæˆ–è€…å®Œå…¨ç”±æ“ä½œç³»ç»Ÿæ¥å†³å®šä½•æ—¶åŒæ­¥ã€‚ä½† AOF æ–‡ä»¶å¾€å¾€æ¯”è¾ƒå¤§ï¼Œæ¢å¤é€Ÿåº¦æ…¢ï¼Œå› ä¸ºå®ƒè®°å½•äº†æ¯ä¸ªå†™æ“ä½œã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°å…¬å¸é¢ç»åˆé›†åŒå­¦ 1 Java åç«¯é¢è¯•åŸé¢˜ï¼šRedis çš„æŒä¹…åŒ–æ–¹å¼ï¼ŸRDB å’Œ AOF çš„åŒºåˆ«ï¼ŸRedis å®•æœºå“ªç§æ¢å¤çš„æ¯”è¾ƒå¿«ï¼Ÿ

### 10.RDB å’Œ AOF å¦‚ä½•é€‰æ‹©ï¼Ÿ

å¦‚æœéœ€è¦å°½å¯èƒ½å‡å°‘æ•°æ®ä¸¢å¤±ï¼ŒAOF æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚å°¤å…¶æ˜¯åœ¨é¢‘ç¹å†™å…¥çš„ç¯å¢ƒä¸‹ï¼Œè®¾ç½® AOF æ¯ç§’åŒæ­¥å¯ä»¥æœ€å¤§é™åº¦å‡å°‘æ•°æ®ä¸¢å¤±ã€‚

å¦‚æœæ€§èƒ½æ˜¯é¦–è¦è€ƒè™‘ï¼ŒRDB å¯èƒ½æ›´é€‚åˆã€‚RDB çš„å¿«ç…§ç”Ÿæˆé€šå¸¸å¯¹æ€§èƒ½å½±å“è¾ƒå°ï¼Œå¹¶ä¸”æ•°æ®æ¢å¤é€Ÿåº¦å¿«ã€‚

å¦‚æœç³»ç»Ÿéœ€è¦ç»å¸¸é‡å¯ï¼Œå¹¶ä¸”å¸Œæœ›ç³»ç»Ÿé‡å¯åå¿«é€Ÿæ¢å¤ï¼ŒRDB å¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚è™½ç„¶ AOF ä¹Ÿæä¾›äº†è‰¯å¥½çš„æ¢å¤èƒ½åŠ›ï¼Œä½†é‡å†™ AOF æ–‡ä»¶å¯èƒ½ä¼šæ¯”è¾ƒæ…¢ã€‚

åœ¨è®¸å¤šç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒåŒæ—¶å¯ç”¨ RDB å’Œ AOF è¢«è®¤ä¸ºæ˜¯æœ€ä½³å®è·µï¼š

- ä½¿ç”¨ RDB è¿›è¡Œå¿«ç…§å¤‡ä»½ã€‚
- ä½¿ç”¨ AOF ä¿è¯å´©æºƒåçš„æœ€å¤§æ•°æ®å®Œæ•´æ€§ã€‚


> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç¾å›¢é¢ç»åŒå­¦ 18 æˆéƒ½åˆ°å®¶é¢è¯•åŸé¢˜ï¼šä»€ä¹ˆæ—¶å€™ç”¨rdb ä»€ä¹ˆæ—¶å€™ç”¨aof

### 11.Redis çš„æ•°æ®æ¢å¤ï¼Ÿ

å½“ Redis å‘ç”Ÿäº†æ•…éšœï¼Œå¯ä»¥ä» RDB æˆ–è€… AOF ä¸­æ¢å¤æ•°æ®ã€‚

æ¢å¤çš„è¿‡ç¨‹ä¹Ÿå¾ˆç®€å•ï¼ŒæŠŠ RDB æˆ–è€… AOF æ–‡ä»¶æ‹·è´åˆ° Redis çš„æ•°æ®ç›®å½•ä¸‹ï¼Œå¦‚æœä½¿ç”¨ AOF æ¢å¤ï¼Œé…ç½®æ–‡ä»¶å¼€å¯ AOFï¼Œç„¶åå¯åŠ¨ redis-server å³å¯ã€‚

![Rediså¯åŠ¨åŠ è½½æ•°æ®](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-f9aab5e9-a875-4316-9ec9-0c5650afe5c1.png)

**Redis** å¯åŠ¨æ—¶åŠ è½½æ•°æ®çš„æµç¨‹ï¼š

1. AOF æŒä¹…åŒ–å¼€å¯ä¸”å­˜åœ¨ AOF æ–‡ä»¶æ—¶ï¼Œä¼˜å…ˆåŠ è½½ AOF æ–‡ä»¶ã€‚
2. AOF å…³é—­æˆ–è€… AOF æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼ŒåŠ è½½ RDB æ–‡ä»¶ã€‚
3. åŠ è½½ AOF/RDB æ–‡ä»¶æˆåŠŸåï¼ŒRedis å¯åŠ¨æˆåŠŸã€‚
4. AOF/RDB æ–‡ä»¶å­˜åœ¨é”™è¯¯æ—¶ï¼ŒRedis å¯åŠ¨å¤±è´¥å¹¶æ‰“å°é”™è¯¯ä¿¡æ¯ã€‚

### 12.Redis 4.0 çš„æ··åˆæŒä¹…åŒ–äº†è§£å—ï¼Ÿ

åœ¨ Redis ä¸­ï¼ŒRDB æŒä¹…åŒ–æ˜¯é€šè¿‡åˆ›å»ºæ•°æ®çš„å¿«ç…§æ¥ä¿å­˜æ•°æ®çš„ï¼Œè€Œ AOF æŒä¹…åŒ–åˆ™æ˜¯é€šè¿‡è®°å½•æ¯ä¸ªå†™å…¥å‘½ä»¤æ¥ä¿å­˜æ•°æ®çš„ã€‚

ä¸¤ç§æ–¹å¼å„æœ‰ä¼˜ç¼ºç‚¹ã€‚RDB æŒä¹…åŒ–çš„ä¼˜ç‚¹æ˜¯æ¢å¤å¤§æ•°æ®é›†çš„é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œä½†æ˜¯å¯èƒ½ä¼šä¸¢å¤±æœ€åä¸€æ¬¡å¿«ç…§ä»¥åçš„æ•°æ®ã€‚AOF æŒä¹…åŒ–çš„ä¼˜ç‚¹æ˜¯æ•°æ®çš„å®Œæ•´æ€§æ¯”è¾ƒé«˜ï¼Œé€šå¸¸åªä¼šä¸¢å¤±ä¸€ç§’çš„æ•°æ®ï¼Œä½†æ˜¯å¯¹äºå¤§æ•°æ®é›†ï¼ŒAOF æ–‡ä»¶å¯èƒ½ä¼šæ¯”è¾ƒå¤§ï¼Œæ¢å¤çš„é€Ÿåº¦æ¯”è¾ƒæ…¢ã€‚

åœ¨ Redis 4.0 ç‰ˆæœ¬ä¸­ï¼Œæ··åˆæŒä¹…åŒ–æ¨¡å¼ä¼šåœ¨ AOF é‡å†™çš„æ—¶å€™åŒæ—¶ç”Ÿæˆä¸€ä»½ RDB å¿«ç…§ï¼Œç„¶åå°†è¿™ä»½å¿«ç…§ä½œä¸º AOF æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œæœ€åå†é™„åŠ æ–°çš„å†™å…¥å‘½ä»¤ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ··åˆæŒä¹…åŒ–](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-19c531e5-da95-495a-a4c4-d63a0b8bba95.png)

è¿™æ ·ï¼Œå½“éœ€è¦æ¢å¤æ•°æ®æ—¶ï¼ŒRedis å…ˆåŠ è½½ RDB æ–‡ä»¶æ¥æ¢å¤åˆ°å¿«ç…§æ—¶åˆ»çš„çŠ¶æ€ï¼Œç„¶ååº”ç”¨ RDB ä¹‹åè®°å½•çš„ AOF å‘½ä»¤æ¥æ¢å¤ä¹‹åçš„æ•°æ®æ›´æ”¹ï¼Œæ—¢å¿«åˆå¯é ã€‚

#### å¦‚ä½•è®¾ç½®æŒä¹…åŒ–æ¨¡å¼ï¼Ÿ

å¯ä»¥é€šè¿‡ç¼–è¾‘ Redis çš„é…ç½®æ–‡ä»¶ redis.conf æ¥è¿›è¡Œè®¾ç½®ï¼Œæˆ–è€…åœ¨è¿è¡Œæ—¶é€šè¿‡ Redis å‘½ä»¤è¡ŒåŠ¨æ€è°ƒæ•´ã€‚

RDB æŒä¹…åŒ–é€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®å¿«ç…§ï¼ˆsnapshottingï¼‰è§„åˆ™æ¥å¯ç”¨ã€‚è¿™äº›è§„åˆ™å®šä¹‰äº†åœ¨å¤šå°‘ç§’å†…å¦‚æœæœ‰å¤šå°‘ä¸ªé”®è¢«ä¿®æ”¹ï¼Œåˆ™è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡æŒä¹…åŒ–æ“ä½œã€‚

```shell
save 900 1      # å¦‚æœè‡³å°‘æœ‰1ä¸ªé”®è¢«ä¿®æ”¹ï¼Œ900ç§’åè‡ªåŠ¨ä¿å­˜ä¸€æ¬¡
save 300 10     # å¦‚æœè‡³å°‘æœ‰10ä¸ªé”®è¢«ä¿®æ”¹ï¼Œ300ç§’åè‡ªåŠ¨ä¿å­˜ä¸€æ¬¡
save 60 10000   # å¦‚æœè‡³å°‘æœ‰10000ä¸ªé”®è¢«ä¿®æ”¹ï¼Œ60ç§’åè‡ªåŠ¨ä¿å­˜ä¸€æ¬¡
```

AOF æŒä¹…åŒ–æ˜¯é€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½® appendonly å‚æ•°ä¸º yes æ¥å¯ç”¨çš„ï¼š

```shell
appendonly yes
```

æ­¤å¤–ï¼Œè¿˜å¯ä»¥é…ç½® AOF æ–‡ä»¶çš„å†™å…¥é¢‘ç‡ï¼Œè¿™æ˜¯é€šè¿‡ appendfsync è®¾ç½®çš„ï¼š

```shell
appendfsync always    # æ¯æ¬¡å†™å…¥æ•°æ®éƒ½åŒæ­¥ï¼Œä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œä½†æ€§èƒ½è¾ƒä½
appendfsync everysec  # æ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼ŒæŠ˜è¡·æ–¹æ¡ˆ
appendfsync no        # ç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶åŒæ­¥ï¼Œæ€§èƒ½æœ€å¥½ï¼Œä½†æ•°æ®å®‰å…¨æ€§æœ€ä½
```

ä¸ºäº†ä¼˜åŒ– AOF æ–‡ä»¶çš„å¤§å°ï¼ŒRedis å…è®¸è‡ªåŠ¨æˆ–æ‰‹åŠ¨é‡å†™ AOF æ–‡ä»¶ã€‚å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®é‡å†™çš„è§¦å‘æ¡ä»¶ï¼š

```shell
auto-aof-rewrite-percentage 100  # å¢é•¿åˆ°åŸå¤§å°çš„100%æ—¶è§¦å‘é‡å†™
auto-aof-rewrite-min-size 64mb   # AOF æ–‡ä»¶è‡³å°‘è¾¾åˆ°64MBæ—¶æ‰è€ƒè™‘é‡å†™
```

æ‰‹åŠ¨æ‰§è¡Œ AOF é‡å†™çš„å‘½ä»¤æ˜¯ï¼š

```shell
redis-cli bgrewriteaof
```

å¦‚æœå†³å®šåŒæ—¶ä½¿ç”¨ RDB å’Œ AOFï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­åŒæ—¶å¯ç”¨ä¸¤è€…ã€‚

```shell
save 900 1
appendonly yes
```

è¿˜å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€æ›´æ”¹ï¼š

```shell
redis-cli config set save "900 1 300 10 60 10000"
redis-cli config set appendonly yes
redis-cli config set appendfsync everysec
```

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 1 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis çš„æŒä¹…åŒ–æœºåˆ¶ï¼Ÿ
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°å…¬å¸é¢ç»åˆé›†åŒå­¦ 1 Java åç«¯é¢è¯•åŸé¢˜ï¼šRedis å®•æœºå“ªç§æ¢å¤çš„æ¯”è¾ƒå¿«ï¼Ÿ
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç¾å›¢é¢ç»åŒå­¦ 18 æˆéƒ½åˆ°å®¶é¢è¯•åŸé¢˜ï¼šå¦‚ä½•è®¾ç½®æŒä¹…åŒ–æ¨¡å¼

GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹](https://javabetter.cn/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## é«˜å¯ç”¨

Redis é™¤äº†å•æœºéƒ¨ç½²å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ä¸»ä»å¤åˆ¶ã€å“¨å…µæ¨¡å¼å’Œé›†ç¾¤æ¨¡å¼æ¥å®ç°é«˜å¯ç”¨ã€‚

**ä¸»ä»å¤åˆ¶**ï¼ˆMaster-Slave Replicationï¼‰ï¼šå…è®¸ä¸€ä¸ª Redis æœåŠ¡å™¨ï¼ˆä¸»èŠ‚ç‚¹ï¼‰å°†æ•°æ®å¤åˆ¶åˆ°ä¸€ä¸ªæˆ–å¤šä¸ª Redis æœåŠ¡å™¨ï¼ˆä»èŠ‚ç‚¹ï¼‰ã€‚è¿™ç§æ–¹å¼å¯ä»¥å®ç°è¯»å†™åˆ†ç¦»ï¼Œé€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚

**å“¨å…µæ¨¡å¼**ï¼ˆSentinelï¼‰ï¼šç”¨äºç›‘æ§ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œå®ç°è‡ªåŠ¨æ•…éšœè½¬ç§»å’Œç³»ç»Ÿæ¶ˆæ¯é€šçŸ¥ã€‚å¦‚æœä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œå“¨å…µå¯ä»¥è‡ªåŠ¨å°†ä¸€ä¸ªä»èŠ‚ç‚¹å‡çº§ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚

**é›†ç¾¤æ¨¡å¼**ï¼ˆClusterï¼‰ï¼šRedis é›†ç¾¤é€šè¿‡åˆ†ç‰‡çš„æ–¹å¼å­˜å‚¨æ•°æ®ï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨æ•°æ®çš„ä¸€éƒ¨åˆ†ï¼Œç”¨æˆ·è¯·æ±‚å¯ä»¥å¹¶è¡Œå¤„ç†ã€‚é›†ç¾¤æ¨¡å¼æ”¯æŒè‡ªåŠ¨åˆ†åŒºã€æ•…éšœè½¬ç§»ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸åœæœºçš„æƒ…å†µä¸‹è¿›è¡ŒèŠ‚ç‚¹å¢åŠ æˆ–åˆ é™¤ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„åä¸º OD é¢ç»åŒå­¦ 1 ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis çš„äº†è§£, éƒ¨ç½²æ–¹æ¡ˆ?

### 13.ä¸»ä»å¤åˆ¶äº†è§£å—ï¼Ÿ

ä¸»ä»å¤åˆ¶ï¼ˆMaster-Slave Replicationï¼‰æ˜¯æŒ‡å°†ä¸€å° Redis æœåŠ¡å™¨çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°å…¶ä»–çš„ Redis æœåŠ¡å™¨ã€‚

å‰è€…ç§°ä¸ºä¸»èŠ‚ç‚¹ï¼ˆmasterï¼‰ï¼Œåè€…ç§°ä¸ºä»èŠ‚ç‚¹ï¼ˆslaveï¼‰ã€‚ä¸”æ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”±ä¸»èŠ‚ç‚¹åˆ°ä»èŠ‚ç‚¹ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedisä¸»ä»å¤åˆ¶ç®€å›¾](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-60497f1e-8afb-44b3-bb7a-d4c29e5ac484.png)

åœ¨ Redis ä¸»ä»æ¶æ„ä¸­ï¼Œä¸»èŠ‚ç‚¹è´Ÿè´£å¤„ç†æ‰€æœ‰çš„å†™æ“ä½œï¼Œå¹¶å°†è¿™äº›æ“ä½œå¼‚æ­¥å¤åˆ¶åˆ°ä»èŠ‚ç‚¹ã€‚ä»èŠ‚ç‚¹ä¸»è¦ç”¨äºè¯»å–æ“ä½œï¼Œä»¥åˆ†æ‹…ä¸»èŠ‚ç‚¹çš„å‹åŠ›å’Œæé«˜è¯»æ€§èƒ½ã€‚

#### ä¸»ä»å¤åˆ¶ä¸»è¦çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?

â‘ ã€**æ•°æ®å†—ä½™ï¼š** ä¸»ä»å¤åˆ¶å®ç°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼ã€‚

â‘¡ã€**æ•…éšœæ¢å¤ï¼š** å¦‚æœä¸»èŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œå¯ä»¥å°†ä¸€ä¸ªä»èŠ‚ç‚¹æå‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œä»è€Œå®ç°æ•…éšœçš„å¿«é€Ÿæ¢å¤ã€‚

é€šå¸¸ä¼šä½¿ç”¨ Sentinel å“¨å…µæ¥å®ç°è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼Œå½“ä¸»èŠ‚ç‚¹æŒ‚æ‰æ—¶ï¼ŒSentinel ä¼šè‡ªåŠ¨å°†ä¸€ä¸ªä»èŠ‚ç‚¹å‡çº§ä¸ºä¸»èŠ‚ç‚¹ï¼Œä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚

```shell
# sentinel.conf

port 26379
sentinel monitor mymaster 192.168.1.1 6379 2
sentinel down-after-milliseconds mymaster 5000
sentinel failover-timeout mymaster 60000
sentinel parallel-syncs mymaster 1
```

å‡å¦‚æ˜¯ä»èŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œä¸»èŠ‚ç‚¹ä¸å—å½±å“ï¼Œä½†åº”è¯¥å°½å¿«ä¿®å¤å¹¶é‡å¯æŒ‚æ‰çš„ä»èŠ‚ç‚¹ï¼Œä½¿å…¶é‡æ–°åŠ å…¥é›†ç¾¤å¹¶ä»ä¸»èŠ‚ç‚¹åŒæ­¥æ•°æ®ã€‚

â‘¢ã€**è´Ÿè½½å‡è¡¡ï¼š** åœ¨ä¸»ä»å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥ç”±ä¸»èŠ‚ç‚¹æä¾›å†™æœåŠ¡ï¼Œç”±ä»èŠ‚ç‚¹æä¾›è¯»æœåŠ¡ _ï¼ˆå³å†™ Redis æ—¶è¿æ¥ä¸»èŠ‚ç‚¹ï¼Œè¯» Redis æ—¶è¿æ¥ä»èŠ‚ç‚¹ï¼‰_ï¼Œåˆ†æ‹…æœåŠ¡å™¨è´Ÿè½½ã€‚å°¤å…¶æ˜¯åœ¨å†™å°‘è¯»å¤šçš„åœºæ™¯ä¸‹ï¼Œé€šè¿‡å¤šä¸ªä»èŠ‚ç‚¹åˆ†æ‹…è¯»è´Ÿè½½ï¼Œå¯ä»¥å¤§å¤§æé«˜ Redis æœåŠ¡å™¨çš„å¹¶å‘é‡ã€‚

â‘£ã€**é«˜å¯ç”¨åŸºçŸ³ï¼š** é™¤äº†ä¸Šè¿°ä½œç”¨ä»¥å¤–ï¼Œä¸»ä»å¤åˆ¶è¿˜æ˜¯å“¨å…µå’Œé›†ç¾¤èƒ½å¤Ÿå®æ–½çš„ **åŸºç¡€**ã€‚

#### ä¸»ä»å¤åˆ¶å‡ºç°æ•°æ®ä¸ä¸€è‡´æ€ä¹ˆåŠï¼Ÿ

Redis çš„ä¸»ä»å¤åˆ¶æ˜¯å¼‚æ­¥è¿›è¡Œçš„ï¼Œè¿™æ„å‘³ç€ä¸»èŠ‚ç‚¹åœ¨æ‰§è¡Œå®Œå†™æ“ä½œåï¼Œä¼šç«‹å³è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè€Œä¸æ˜¯ç­‰å¾…ä»èŠ‚ç‚¹å®Œæˆæ•°æ®åŒæ­¥ã€‚

åœ¨ä¸»èŠ‚ç‚¹å°†æ•°æ®åŒæ­¥åˆ°ä»èŠ‚ç‚¹çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°ç½‘ç»œå»¶è¿Ÿæˆ–ä¸­æ–­ï¼Œä»è€Œå¯¼è‡´ä»èŠ‚ç‚¹çš„æ•°æ®æ»åäºä¸»èŠ‚ç‚¹ã€‚

ä¸ºäº†è§£å†³æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œåº”è¯¥å°½é‡ä¿è¯ä¸»ä»èŠ‚ç‚¹ä¹‹é—´çš„ç½‘ç»œè¿æ¥çŠ¶å†µè‰¯å¥½ï¼Œæ¯”å¦‚è¯´é¿å…åœ¨ä¸åŒæœºæˆ¿ä¹‹é—´éƒ¨ç½²ä¸»ä»èŠ‚ç‚¹ï¼Œä»¥å‡å°‘ç½‘ç»œå»¶è¿Ÿã€‚ä½†å¯èƒ½ä¼šå¸¦æ¥æ–°çš„é—®é¢˜ï¼Œå°±æ˜¯æ•´ä¸ªæœºæˆ¿éƒ½æŒ‚æ‰çš„æƒ…å†µã€‚

æ­¤å¤–ï¼ŒRedis æœ¬èº«ä¹Ÿæä¾›äº†ä¸€äº›æœºåˆ¶æ¥è§£å†³æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´é€šè¿‡ Redis çš„ `INFO replication` å‘½ä»¤ç›‘æ§ä¸»ä»èŠ‚ç‚¹çš„å¤åˆ¶è¿›åº¦ï¼ŒåŠæ—¶å‘ç°å’Œå¤„ç†å¤åˆ¶å»¶è¿Ÿã€‚

å…·ä½“åšæ³•æ˜¯è·å–ä¸»èŠ‚ç‚¹çš„ master_repl_offset å’Œä»èŠ‚ç‚¹çš„ slave_repl_offsetï¼Œè®¡ç®—ä¸¤è€…çš„å·®å€¼ã€‚å¦‚æœå·®å€¼è¶…è¿‡é¢„è®¾çš„é˜ˆå€¼ï¼Œé‡‡å–æªæ–½ï¼ˆå¦‚åœæ­¢ä»èŠ‚ç‚¹çš„æ•°æ®è¯»å–ï¼‰ä»¥å‡å°‘è¯»åˆ°ä¸ä¸€è‡´æ•°æ®çš„æƒ…å†µã€‚

![æå®¢æ—¶é—´ï¼šRedis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜](https://cdn.tobebetterjavaer.com/stutymore/redis-20240709135618.png)

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¾—ç‰©é¢ç»åŒå­¦ 1 é¢è¯•åŸé¢˜ï¼šRedisåˆ†å¸ƒå¼ï¼Œä¸»ä»ï¼Œä¸€ä¸ªèŠ‚ç‚¹æŒ‚æ‰æ€ä¹ˆåŠ
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³é¢ç»åŒå­¦ F é¢è¯•åŸé¢˜ï¼šredisçš„ä¸»ä»æ¶æ„å’Œä¸»ä»å“¨å…µåŒºåˆ«

### 14.Redis ä¸»ä»æœ‰å‡ ç§å¸¸è§çš„æ‹“æ‰‘ç»“æ„ï¼Ÿ

Redis çš„å¤åˆ¶æ‹“æ‰‘ç»“æ„å¯ä»¥æ”¯æŒå•å±‚æˆ–å¤šå±‚å¤åˆ¶å…³ç³»ï¼Œæ ¹æ®æ‹“æ‰‘å¤æ‚æ€§å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ï¼šä¸€ä¸»ä¸€ä»ã€ä¸€ä¸»å¤šä»ã€æ ‘çŠ¶ä¸»ä»ç»“æ„ã€‚

1.ä¸€ä¸»ä¸€ä»ç»“æ„

ä¸€ä¸»ä¸€ä»ç»“æ„æ˜¯æœ€ç®€å•çš„å¤åˆ¶æ‹“æ‰‘ç»“æ„ï¼Œç”¨äºä¸»èŠ‚ç‚¹å‡ºç°å®•æœºæ—¶ä»èŠ‚ç‚¹æä¾›æ•…éšœè½¬ç§»æ”¯æŒã€‚

![ä¸€ä¸»ä¸€ä»ç»“æ„](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-5d91a67c-dbff-4a8d-bf9d-1fe7602d5a27.png) 2.ä¸€ä¸»å¤šä»ç»“æ„

ä¸€ä¸»å¤šä»ç»“æ„ï¼ˆåˆç§°ä¸ºæ˜Ÿå½¢æ‹“æ‰‘ç»“æ„ï¼‰ä½¿å¾—åº”ç”¨ç«¯å¯ä»¥åˆ©ç”¨å¤šä¸ªä»èŠ‚ç‚¹å®ç°è¯»å†™åˆ†ç¦»ï¼ˆè§å›¾ 6-5ï¼‰ã€‚å¯¹äºè¯»å æ¯”è¾ƒå¤§çš„åœºæ™¯ï¼Œå¯ä»¥æŠŠè¯»å‘½ä»¤å‘é€åˆ°ä»èŠ‚ç‚¹æ¥åˆ†æ‹…ä¸»èŠ‚ç‚¹å‹åŠ›ã€‚

![ä¸€ä¸»å¤šä»ç»“æ„](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-71074254-699a-480b-bbb0-c68f364a380b.png) 3.æ ‘çŠ¶ä¸»ä»ç»“æ„

æ ‘çŠ¶ä¸»ä»ç»“æ„ï¼ˆåˆç§°ä¸ºæ ‘çŠ¶æ‹“æ‰‘ç»“æ„ï¼‰ä½¿å¾—ä»èŠ‚ç‚¹ä¸ä½†å¯ä»¥å¤åˆ¶ä¸»èŠ‚ç‚¹æ•°æ®ï¼ŒåŒæ—¶å¯ä»¥ä½œä¸ºå…¶ä»–ä»èŠ‚ç‚¹çš„ä¸»èŠ‚ç‚¹ç»§ç»­å‘ä¸‹å±‚å¤åˆ¶ã€‚é€šè¿‡å¼•å…¥å¤åˆ¶ä¸­é—´å±‚ï¼Œå¯ä»¥æœ‰æ•ˆé™ä½ä¸»èŠ‚ç‚¹è´Ÿè½½å’Œéœ€è¦ä¼ é€ç»™ä»èŠ‚ç‚¹çš„æ•°æ®é‡ã€‚

![æ ‘çŠ¶ä¸»ä»ç»“æ„](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-dff14203-5e01-4d1b-a775-10ee444ada54.png)

### 15.Redis çš„ä¸»ä»å¤åˆ¶åŸç†äº†è§£å—ï¼Ÿ

Redis ä¸»ä»å¤åˆ¶çš„å·¥ä½œæµç¨‹å¤§æ¦‚å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ æ­¥ï¼š
![Redisä¸»ä»å¤åˆ¶å·¥ä½œæµç¨‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-21123b1e-68b4-436b-ac84-3365a49a81bd.png)

1.  ä¿å­˜ä¸»èŠ‚ç‚¹ï¼ˆmasterï¼‰ä¿¡æ¯
    è¿™ä¸€æ­¥åªæ˜¯ä¿å­˜ä¸»èŠ‚ç‚¹ä¿¡æ¯ï¼Œä¿å­˜ä¸»èŠ‚ç‚¹çš„ ip å’Œ portã€‚
2.  ä¸»ä»å»ºç«‹è¿æ¥
    ä»èŠ‚ç‚¹ï¼ˆslaveï¼‰å‘ç°æ–°çš„ä¸»èŠ‚ç‚¹åï¼Œä¼šå°è¯•å’Œä¸»èŠ‚ç‚¹å»ºç«‹ç½‘ç»œè¿æ¥ã€‚
3.  å‘é€ ping å‘½ä»¤
    è¿æ¥å»ºç«‹æˆåŠŸåä»èŠ‚ç‚¹å‘é€ ping è¯·æ±‚è¿›è¡Œé¦–æ¬¡é€šä¿¡ï¼Œä¸»è¦æ˜¯æ£€æµ‹ä¸»ä»ä¹‹é—´ç½‘ç»œå¥—æ¥å­—æ˜¯å¦å¯ç”¨ã€ä¸»èŠ‚ç‚¹å½“å‰æ˜¯å¦å¯æ¥å—å¤„ç†å‘½ä»¤ã€‚
4.  æƒé™éªŒè¯
    å¦‚æœä¸»èŠ‚ç‚¹è¦æ±‚å¯†ç éªŒè¯ï¼Œä»èŠ‚ç‚¹å¿…é¡»æ­£ç¡®çš„å¯†ç æ‰èƒ½é€šè¿‡éªŒè¯ã€‚
5.  åŒæ­¥æ•°æ®é›†
    ä¸»ä»å¤åˆ¶è¿æ¥æ­£å¸¸é€šä¿¡åï¼Œä¸»èŠ‚ç‚¹ä¼šæŠŠæŒæœ‰çš„æ•°æ®å…¨éƒ¨å‘é€ç»™ä»èŠ‚ç‚¹ã€‚
6.  å‘½ä»¤æŒç»­å¤åˆ¶
    æ¥ä¸‹æ¥ä¸»èŠ‚ç‚¹ä¼šæŒç»­åœ°æŠŠå†™å‘½ä»¤å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä¿è¯ä¸»ä»æ•°æ®ä¸€è‡´æ€§ã€‚

### 16.è¯´è¯´ä¸»ä»æ•°æ®åŒæ­¥çš„æ–¹å¼ï¼Ÿ

Redis åœ¨ 2.8 åŠä»¥ä¸Šç‰ˆæœ¬ä½¿ç”¨ psync å‘½ä»¤å®Œæˆä¸»ä»æ•°æ®åŒæ­¥ï¼ŒåŒæ­¥è¿‡ç¨‹åˆ†ä¸ºï¼šå…¨é‡å¤åˆ¶å’Œéƒ¨åˆ†å¤åˆ¶ã€‚

![ä¸»ä»æ•°æ®åŒæ­¥æ–¹å¼](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-7518f715-6dee-4e70-b972-8aed9879e451.png)

**å…¨é‡å¤åˆ¶**
ä¸€èˆ¬ç”¨äºåˆæ¬¡å¤åˆ¶åœºæ™¯ï¼ŒRedis æ—©æœŸæ”¯æŒçš„å¤åˆ¶åŠŸèƒ½åªæœ‰å…¨é‡å¤åˆ¶ï¼Œå®ƒä¼šæŠŠä¸»èŠ‚ç‚¹å…¨éƒ¨æ•°æ®ä¸€æ¬¡æ€§å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œå½“æ•°æ®é‡è¾ƒå¤§æ—¶ï¼Œä¼šå¯¹ä¸»ä»èŠ‚ç‚¹å’Œç½‘ç»œé€ æˆå¾ˆå¤§çš„å¼€é”€ã€‚

å…¨é‡å¤åˆ¶çš„å®Œæ•´è¿è¡Œæµç¨‹å¦‚ä¸‹ï¼š
![å…¨é‡å¤åˆ¶](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-aa8d2960-b341-49cc-b04c-201241fd15de.png)

1. å‘é€ psync å‘½ä»¤è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œç”±äºæ˜¯ç¬¬ä¸€æ¬¡è¿›è¡Œå¤åˆ¶ï¼Œä»èŠ‚ç‚¹æ²¡æœ‰å¤åˆ¶åç§»é‡å’Œä¸»èŠ‚ç‚¹çš„è¿è¡Œ IDï¼Œæ‰€ä»¥å‘é€ psync-1ã€‚
2. ä¸»èŠ‚ç‚¹æ ¹æ® psync-1 è§£æå‡ºå½“å‰ä¸ºå…¨é‡å¤åˆ¶ï¼Œå›å¤+FULLRESYNC å“åº”ã€‚
3. ä»èŠ‚ç‚¹æ¥æ”¶ä¸»èŠ‚ç‚¹çš„å“åº”æ•°æ®ä¿å­˜è¿è¡Œ ID å’Œåç§»é‡ offset
4. ä¸»èŠ‚ç‚¹æ‰§è¡Œ bgsave ä¿å­˜ RDB æ–‡ä»¶åˆ°æœ¬åœ°
5. ä¸»èŠ‚ç‚¹å‘é€ RDB æ–‡ä»¶ç»™ä»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹æŠŠæ¥æ”¶çš„ RDB æ–‡ä»¶ä¿å­˜åœ¨æœ¬åœ°å¹¶ç›´æ¥ä½œä¸ºä»èŠ‚ç‚¹çš„æ•°æ®æ–‡ä»¶
6. å¯¹äºä»èŠ‚ç‚¹å¼€å§‹æ¥æ”¶ RDB å¿«ç…§åˆ°æ¥æ”¶å®ŒæˆæœŸé—´ï¼Œä¸»èŠ‚ç‚¹ä»ç„¶å“åº”è¯»å†™å‘½ä»¤ï¼Œå› æ­¤ä¸»èŠ‚ç‚¹ä¼šæŠŠè¿™æœŸé—´å†™å‘½ä»¤æ•°æ®ä¿å­˜åœ¨å¤åˆ¶å®¢æˆ·ç«¯ç¼“å†²åŒºå†…ï¼Œå½“ä»èŠ‚ç‚¹åŠ è½½å®Œ RDB æ–‡ä»¶åï¼Œä¸»èŠ‚ç‚¹å†æŠŠç¼“å†²åŒºå†…çš„æ•°æ®å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä¿è¯ä¸»ä»ä¹‹é—´æ•°æ®ä¸€è‡´æ€§ã€‚
7. ä»èŠ‚ç‚¹æ¥æ”¶å®Œä¸»èŠ‚ç‚¹ä¼ é€æ¥çš„å…¨éƒ¨æ•°æ®åä¼šæ¸…ç©ºè‡ªèº«æ—§æ•°æ®
8. ä»èŠ‚ç‚¹æ¸…ç©ºæ•°æ®åå¼€å§‹åŠ è½½ RDB æ–‡ä»¶
9. ä»èŠ‚ç‚¹æˆåŠŸåŠ è½½å®Œ RDB åï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹å¼€å¯äº† AOF æŒä¹…åŒ–åŠŸèƒ½ï¼Œ å®ƒä¼šç«‹åˆ»åš bgrewriteaof æ“ä½œï¼Œä¸ºäº†ä¿è¯å…¨é‡å¤åˆ¶å AOF æŒä¹…åŒ–æ–‡ä»¶ç«‹åˆ»å¯ç”¨ã€‚

**éƒ¨åˆ†å¤åˆ¶**
éƒ¨åˆ†å¤åˆ¶ä¸»è¦æ˜¯ Redis é’ˆå¯¹å…¨é‡å¤åˆ¶çš„è¿‡é«˜å¼€é”€åšå‡ºçš„ä¸€ç§ä¼˜åŒ–æªæ–½ï¼Œ ä½¿ç”¨ psync{runId}{offset}å‘½ä»¤å®ç°ã€‚å½“ä»èŠ‚ç‚¹ï¼ˆslaveï¼‰æ­£åœ¨å¤åˆ¶ä¸»èŠ‚ç‚¹ ï¼ˆmasterï¼‰æ—¶ï¼Œå¦‚æœå‡ºç°ç½‘ç»œé—ªæ–­æˆ–è€…å‘½ä»¤ä¸¢å¤±ç­‰å¼‚å¸¸æƒ…å†µæ—¶ï¼Œä»èŠ‚ç‚¹ä¼šå‘ ä¸»èŠ‚ç‚¹è¦æ±‚è¡¥å‘ä¸¢å¤±çš„å‘½ä»¤æ•°æ®ï¼Œå¦‚æœä¸»èŠ‚ç‚¹çš„å¤åˆ¶ç§¯å‹ç¼“å†²åŒºå†…å­˜åœ¨è¿™éƒ¨åˆ†æ•°æ®åˆ™ç›´æ¥å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œè¿™æ ·å°±å¯ä»¥ä¿æŒä¸»ä»èŠ‚ç‚¹å¤åˆ¶çš„ä¸€è‡´æ€§ã€‚
![éƒ¨åˆ†å¤åˆ¶](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-87600c72-cc6a-4656-81b2-e71864c97f23.png)

1.  å½“ä¸»ä»èŠ‚ç‚¹ä¹‹é—´ç½‘ç»œå‡ºç°ä¸­æ–­æ—¶ï¼Œå¦‚æœè¶…è¿‡ repl-timeout æ—¶é—´ï¼Œä¸»èŠ‚ç‚¹ä¼šè®¤ä¸ºä»èŠ‚ç‚¹æ•…éšœå¹¶ä¸­æ–­å¤åˆ¶è¿æ¥
2.  ä¸»ä»è¿æ¥ä¸­æ–­æœŸé—´ä¸»èŠ‚ç‚¹ä¾ç„¶å“åº”å‘½ä»¤ï¼Œä½†å› å¤åˆ¶è¿æ¥ä¸­æ–­å‘½ä»¤æ— æ³•å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä¸è¿‡ä¸»èŠ‚ç‚¹å†…éƒ¨å­˜åœ¨çš„å¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼Œä¾ç„¶å¯ä»¥ä¿å­˜æœ€è¿‘ä¸€æ®µæ—¶é—´çš„å†™å‘½ä»¤æ•°æ®ï¼Œé»˜è®¤æœ€å¤§ç¼“å­˜ 1MBã€‚
3.  å½“ä¸»ä»èŠ‚ç‚¹ç½‘ç»œæ¢å¤åï¼Œä»èŠ‚ç‚¹ä¼šå†æ¬¡è¿ä¸Šä¸»èŠ‚ç‚¹
4.  å½“ä¸»ä»è¿æ¥æ¢å¤åï¼Œç”±äºä»èŠ‚ç‚¹ä¹‹å‰ä¿å­˜äº†è‡ªèº«å·²å¤åˆ¶çš„åç§»é‡å’Œä¸»èŠ‚ç‚¹çš„è¿è¡Œ IDã€‚å› æ­¤ä¼šæŠŠå®ƒä»¬å½“ä½œ psync å‚æ•°å‘é€ç»™ä¸»èŠ‚ç‚¹ï¼Œè¦æ±‚è¿›è¡Œéƒ¨åˆ†å¤åˆ¶æ“ä½œã€‚
5.  ä¸»èŠ‚ç‚¹æ¥åˆ° psync å‘½ä»¤åé¦–å…ˆæ ¸å¯¹å‚æ•° runId æ˜¯å¦ä¸è‡ªèº«ä¸€è‡´ï¼Œå¦‚æœä¸€ è‡´ï¼Œè¯´æ˜ä¹‹å‰å¤åˆ¶çš„æ˜¯å½“å‰ä¸»èŠ‚ç‚¹ï¼›ä¹‹åæ ¹æ®å‚æ•° offset åœ¨è‡ªèº«å¤åˆ¶ç§¯å‹ç¼“å†²åŒºæŸ¥æ‰¾ï¼Œå¦‚æœåç§»é‡ä¹‹åçš„æ•°æ®å­˜åœ¨ç¼“å†²åŒºä¸­ï¼Œåˆ™å¯¹ä»èŠ‚ç‚¹å‘é€+CONTINUE å“åº”ï¼Œè¡¨ç¤ºå¯ä»¥è¿›è¡Œéƒ¨åˆ†å¤åˆ¶ã€‚
6.  ä¸»èŠ‚ç‚¹æ ¹æ®åç§»é‡æŠŠå¤åˆ¶ç§¯å‹ç¼“å†²åŒºé‡Œçš„æ•°æ®å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä¿è¯ä¸»ä»å¤åˆ¶è¿›å…¥æ­£å¸¸çŠ¶æ€ã€‚

### 17.ä¸»ä»å¤åˆ¶å­˜åœ¨å“ªäº›é—®é¢˜å‘¢ï¼Ÿ

ä¸»ä»å¤åˆ¶è™½å¥½ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼š

- ä¸€æ—¦ä¸»èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œéœ€è¦æ‰‹åŠ¨å°†ä¸€ä¸ªä»èŠ‚ç‚¹æ™‹å‡ä¸ºä¸»èŠ‚ç‚¹ï¼ŒåŒæ—¶éœ€è¦ä¿®æ”¹åº”ç”¨æ–¹çš„ä¸»èŠ‚ç‚¹åœ°å€ï¼Œè¿˜éœ€è¦å‘½ä»¤å…¶ä»–ä»èŠ‚ç‚¹å»å¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹ï¼Œæ•´ä¸ªè¿‡ç¨‹éƒ½éœ€è¦äººå·¥å¹²é¢„ã€‚
- ä¸»èŠ‚ç‚¹çš„å†™èƒ½åŠ›å—åˆ°å•æœºçš„é™åˆ¶ã€‚
- ä¸»èŠ‚ç‚¹çš„å­˜å‚¨èƒ½åŠ›å—åˆ°å•æœºçš„é™åˆ¶ã€‚

ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ Redis çš„é«˜å¯ç”¨é—®é¢˜ï¼Œç¬¬äºŒã€ä¸‰ä¸ªé—®é¢˜å±äº Redis çš„åˆ†å¸ƒå¼é—®é¢˜ã€‚

### 18.Redis å“¨å…µäº†è§£å—ï¼Ÿ

å“¨å…µæœºåˆ¶æ˜¯ Redis æä¾›çš„ä¸€ä¸ªé«˜å¯ç”¨æ€§è§£å†³æ–¹æ¡ˆï¼Œç”¨äºç›‘æ§ Redis çš„ä¸»ä»å¤åˆ¶ï¼Œä»¥è‡ªåŠ¨å®Œæˆæ•…éšœè½¬ç§»å’Œé€šçŸ¥ç®¡ç†å‘˜ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedis Sentinel](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-8b1a055c-f077-49ff-9432-c194d4fc3639.png)

å“¨å…µä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š

- **å“¨å…µèŠ‚ç‚¹ï¼š** å“¨å…µèŠ‚ç‚¹æ˜¯ç‰¹æ®Šçš„ Redis èŠ‚ç‚¹ï¼Œä¸å­˜å‚¨æ•°æ®ï¼Œåªå¯¹æ•°æ®èŠ‚ç‚¹è¿›è¡Œç›‘æ§ã€‚
- **æ•°æ®èŠ‚ç‚¹ï¼š** ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹éƒ½æ˜¯æ•°æ®èŠ‚ç‚¹ã€‚

å“¨å…µçš„ä¸»è¦åŠŸèƒ½æœ‰ï¼š

- **ç›‘æ§ï¼ˆMonitoringï¼‰ï¼š** å“¨å…µ Sentinel ä¼šä¸æ–­æ£€æŸ¥ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚
- **é€šçŸ¥ï¼ˆNotificationï¼‰ï¼š** Sentinel å¯ä»¥å‘ç®¡ç†å‘˜æˆ–å…¶ä»–åº”ç”¨ç¨‹åºå‘é€é€šçŸ¥ï¼Œå‘ŠçŸ¥ Redis å®ä¾‹çš„çŠ¶æ€å˜åŒ–ã€‚
- **è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼ˆAutomatic failoverï¼‰ï¼š** å½“ Sentinel æ£€æµ‹åˆ°ä¸»èŠ‚ç‚¹ä¸å¯ç”¨æ—¶ï¼Œä¼šè‡ªåŠ¨å°†ä¸€ä¸ªä»èŠ‚ç‚¹æå‡ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œå¹¶è®©å…¶ä»–ä»èŠ‚ç‚¹å¼€å§‹å¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹ã€‚
- **é…ç½®æä¾›è€…ï¼ˆConfiguration providerï¼‰ï¼š** å®¢Sentinel å®¢æˆ·ç«¯å¯ä»¥ä» Sentinel é›†ç¾¤è·å–å½“å‰çš„ä¸»èŠ‚ç‚¹åœ°å€ï¼Œä»¥å®ç°åŠ¨æ€é…ç½®ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„æ¯”äºšè¿ªé¢ç»åŒå­¦ 1 é¢è¯•åŸé¢˜ï¼šRedisçš„å“¨å…µæœºåˆ¶äº†è§£å—ï¼Ÿ

### 19.Redis å“¨å…µå®ç°åŸç†çŸ¥é“å—ï¼Ÿ

å“¨å…µæ¨¡å¼æ˜¯é€šè¿‡å“¨å…µèŠ‚ç‚¹å®Œæˆå¯¹æ•°æ®èŠ‚ç‚¹çš„ç›‘æ§ã€ä¸‹çº¿ã€æ•…éšœè½¬ç§»ã€‚
![Redis Sentinelå·¥ä½œæµç¨‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-4074d72a-886a-4892-8f55-80112005aad8.png)

- **å®šæ—¶ç›‘æ§**
  ![ä¸‰ä¸ªå®šæ—¶ä»»åŠ¡](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e7708f8d-ef34-4255-b5d0-cb300c649716.png)Redis Sentinel é€šè¿‡ä¸‰ä¸ªå®šæ—¶ç›‘æ§ä»»åŠ¡å®Œæˆå¯¹å„ä¸ªèŠ‚ç‚¹å‘ç°å’Œç›‘æ§ï¼š
  1. æ¯éš” 10 ç§’ï¼Œæ¯ä¸ª Sentinel èŠ‚ç‚¹ä¼šå‘ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹å‘é€ info å‘½ä»¤è·å–æœ€æ–°çš„æ‹“æ‰‘ç»“æ„
  2. æ¯éš” 2 ç§’ï¼Œæ¯ä¸ª Sentinel èŠ‚ç‚¹ä¼šå‘ Redis æ•°æ®èŠ‚ç‚¹çš„**sentinel**ï¼šhello é¢‘é“ä¸Šå‘é€è¯¥ Sentinel èŠ‚ç‚¹å¯¹äºä¸»èŠ‚ç‚¹çš„åˆ¤æ–­ä»¥åŠå½“å‰ Sentinel èŠ‚ç‚¹çš„ä¿¡æ¯
  3. æ¯éš” 1 ç§’ï¼Œæ¯ä¸ª Sentinel èŠ‚ç‚¹ä¼šå‘ä¸»èŠ‚ç‚¹ã€ä»èŠ‚ç‚¹ã€å…¶ä½™ Sentinel èŠ‚ç‚¹å‘é€ä¸€æ¡ ping å‘½ä»¤åšä¸€æ¬¡å¿ƒè·³æ£€æµ‹ï¼Œæ¥ç¡®è®¤è¿™äº›èŠ‚ç‚¹å½“å‰æ˜¯å¦å¯è¾¾
- **ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿**
  ä¸»è§‚ä¸‹çº¿å°±æ˜¯å“¨å…µèŠ‚ç‚¹è®¤ä¸ºæŸä¸ªèŠ‚ç‚¹æœ‰é—®é¢˜ï¼Œå®¢è§‚ä¸‹çº¿å°±æ˜¯è¶…è¿‡ä¸€å®šæ•°é‡çš„å“¨å…µèŠ‚ç‚¹è®¤ä¸ºä¸»èŠ‚ç‚¹æœ‰é—®é¢˜ã€‚
  ![ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-11839a24-9249-48a5-8c9d-888aa80d91dc.png)

1. ä¸»è§‚ä¸‹çº¿
   æ¯ä¸ª Sentinel èŠ‚ç‚¹ä¼šæ¯éš” 1 ç§’å¯¹ä¸»èŠ‚ç‚¹ã€ä»èŠ‚ç‚¹ã€å…¶ä»– Sentinel èŠ‚ç‚¹å‘é€ ping å‘½ä»¤åšå¿ƒè·³æ£€æµ‹ï¼Œå½“è¿™äº›èŠ‚ç‚¹è¶…è¿‡ down-after-milliseconds æ²¡æœ‰è¿›è¡Œæœ‰æ•ˆå›å¤ï¼ŒSentinel èŠ‚ç‚¹å°±ä¼šå¯¹è¯¥èŠ‚ç‚¹åšå¤±è´¥åˆ¤å®šï¼Œè¿™ä¸ªè¡Œä¸ºå«åšä¸»è§‚ä¸‹çº¿ã€‚

2. å®¢è§‚ä¸‹çº¿
   å½“ Sentinel ä¸»è§‚ä¸‹çº¿çš„èŠ‚ç‚¹æ˜¯ä¸»èŠ‚ç‚¹æ—¶ï¼Œè¯¥ Sentinel èŠ‚ç‚¹ä¼šé€šè¿‡ sentinel is- master-down-by-addr å‘½ä»¤å‘å…¶ä»– Sentinel èŠ‚ç‚¹è¯¢é—®å¯¹ä¸»èŠ‚ç‚¹çš„åˆ¤æ–­ï¼Œå½“è¶…è¿‡ \<quorum>ä¸ªæ•°ï¼ŒSentinel èŠ‚ç‚¹è®¤ä¸ºä¸»èŠ‚ç‚¹ç¡®å®æœ‰é—®é¢˜ï¼Œè¿™æ—¶è¯¥ Sentinel èŠ‚ç‚¹ä¼šåšå‡ºå®¢è§‚ä¸‹çº¿çš„å†³å®š

- **é¢†å¯¼è€… Sentinel èŠ‚ç‚¹é€‰ä¸¾**
  Sentinel èŠ‚ç‚¹ä¹‹é—´ä¼šåšä¸€ä¸ªé¢†å¯¼è€…é€‰ä¸¾çš„å·¥ä½œï¼Œé€‰å‡ºä¸€ä¸ª Sentinel èŠ‚ç‚¹ä½œä¸ºé¢†å¯¼è€…è¿›è¡Œæ•…éšœè½¬ç§»çš„å·¥ä½œã€‚Redis ä½¿ç”¨äº† Raft ç®—æ³•å®ç°é¢†å¯¼è€…é€‰ä¸¾ã€‚

- **æ•…éšœè½¬ç§»**

  é¢†å¯¼è€…é€‰ä¸¾å‡ºçš„ Sentinel èŠ‚ç‚¹è´Ÿè´£æ•…éšœè½¬ç§»ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š
  ![æ•…éšœè½¬ç§»](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-0618a5e2-e94f-40d7-888a-e78019ba8f93.png)

  1. åœ¨ä»èŠ‚ç‚¹åˆ—è¡¨ä¸­é€‰å‡ºä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œè¿™ä¸€æ­¥æ˜¯ç›¸å¯¹å¤æ‚ä¸€äº›çš„ä¸€æ­¥
  2. Sentinel é¢†å¯¼è€…èŠ‚ç‚¹ä¼šå¯¹ç¬¬ä¸€æ­¥é€‰å‡ºæ¥çš„ä»èŠ‚ç‚¹æ‰§è¡Œ slaveof no one å‘½ä»¤è®©å…¶æˆä¸ºä¸»èŠ‚ç‚¹
  3. Sentinel é¢†å¯¼è€…èŠ‚ç‚¹ä¼šå‘å‰©ä½™çš„ä»èŠ‚ç‚¹å‘é€å‘½ä»¤ï¼Œè®©å®ƒä»¬æˆä¸ºæ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹
  4. Sentinel èŠ‚ç‚¹é›†åˆä¼šå°†åŸæ¥çš„ä¸»èŠ‚ç‚¹æ›´æ–°ä¸ºä»èŠ‚ç‚¹ï¼Œå¹¶ä¿æŒç€å¯¹å…¶å…³æ³¨ï¼Œå½“å…¶æ¢å¤åå‘½ä»¤å®ƒå»å¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹

### 20.é¢†å¯¼è€… Sentinel èŠ‚ç‚¹é€‰ä¸¾äº†è§£å—ï¼Ÿ

Redis ä½¿ç”¨äº† Raft ç®—æ³•å® ç°é¢†å¯¼è€…é€‰ä¸¾ï¼Œå¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š
![é¢†å¯¼è€…SentinelèŠ‚ç‚¹é€‰ä¸¾](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-6586ae3c-6b33-4c9f-8137-f02fc0e6cfae.png)

1. æ¯ä¸ªåœ¨çº¿çš„ Sentinel èŠ‚ç‚¹éƒ½æœ‰èµ„æ ¼æˆä¸ºé¢†å¯¼è€…ï¼Œå½“å®ƒç¡®è®¤ä¸»èŠ‚ç‚¹ä¸»è§‚ ä¸‹çº¿æ—¶å€™ï¼Œä¼šå‘å…¶ä»– Sentinel èŠ‚ç‚¹å‘é€ sentinel is-master-down-by-addr å‘½ä»¤ï¼Œ è¦æ±‚å°†è‡ªå·±è®¾ç½®ä¸ºé¢†å¯¼è€…ã€‚
2. æ”¶åˆ°å‘½ä»¤çš„ Sentinel èŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰åŒæ„è¿‡å…¶ä»– Sentinel èŠ‚ç‚¹çš„ sentinel is-master-down-by-addr å‘½ä»¤ï¼Œå°†åŒæ„è¯¥è¯·æ±‚ï¼Œå¦åˆ™æ‹’ç»ã€‚
3. å¦‚æœè¯¥ Sentinel èŠ‚ç‚¹å‘ç°è‡ªå·±çš„ç¥¨æ•°å·²ç»å¤§äºç­‰äº maxï¼ˆquorumï¼Œ numï¼ˆsentinelsï¼‰/2+1ï¼‰ï¼Œé‚£ä¹ˆå®ƒå°†æˆä¸ºé¢†å¯¼è€…ã€‚
4. å¦‚æœæ­¤è¿‡ç¨‹æ²¡æœ‰é€‰ä¸¾å‡ºé¢†å¯¼è€…ï¼Œå°†è¿›å…¥ä¸‹ä¸€æ¬¡é€‰ä¸¾ã€‚

### 21.æ–°çš„ä¸»èŠ‚ç‚¹æ˜¯æ€æ ·è¢«æŒ‘é€‰å‡ºæ¥çš„ï¼Ÿ

é€‰å‡ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œå¤§æ¦‚åˆ†ä¸ºè¿™ä¹ˆå‡ æ­¥ï¼š
![æ–°çš„ä¸»èŠ‚ç‚¹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-03976d35-20b6-4efe-aa9c-7d3759460d34.png)

1.  è¿‡æ»¤ï¼šâ€œä¸å¥åº·â€ï¼ˆä¸»è§‚ä¸‹çº¿ã€æ–­çº¿ï¼‰ã€5 ç§’å†…æ²¡æœ‰å›å¤è¿‡ Sentinel èŠ‚ ç‚¹ ping å“åº”ã€ä¸ä¸»èŠ‚ç‚¹å¤±è”è¶…è¿‡ down-after-milliseconds\*10 ç§’ã€‚
2.  é€‰æ‹© slave-priorityï¼ˆä»èŠ‚ç‚¹ä¼˜å…ˆçº§ï¼‰æœ€é«˜çš„ä»èŠ‚ç‚¹åˆ—è¡¨ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿”å›ï¼Œä¸å­˜åœ¨åˆ™ç»§ç»­ã€‚
3.  é€‰æ‹©å¤åˆ¶åç§»é‡æœ€å¤§çš„ä»èŠ‚ç‚¹ï¼ˆå¤åˆ¶çš„æœ€å®Œæ•´ï¼‰ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿” å›ï¼Œä¸å­˜åœ¨åˆ™ç»§ç»­ã€‚
4.  é€‰æ‹© runid æœ€å°çš„ä»èŠ‚ç‚¹ã€‚

### 22.Redis é›†ç¾¤äº†è§£å—ï¼Ÿ

å‰é¢è¯´åˆ°äº†ä¸»ä»å­˜åœ¨é«˜å¯ç”¨å’Œåˆ†å¸ƒå¼çš„é—®é¢˜ï¼Œå“¨å…µè§£å†³äº†é«˜å¯ç”¨çš„é—®é¢˜ï¼Œè€Œé›†ç¾¤å°±æ˜¯ç»ˆææ–¹æ¡ˆï¼Œä¸€ä¸¾è§£å†³é«˜å¯ç”¨å’Œåˆ†å¸ƒå¼é—®é¢˜ã€‚

![Redis é›†ç¾¤ç¤ºæ„å›¾](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-5cbc6009-251e-4d5b-8f22-8d543938eccb.png)

1. **æ•°æ®åˆ†åŒºï¼š** æ•°æ®åˆ†åŒº _(æˆ–ç§°æ•°æ®åˆ†ç‰‡)_ æ˜¯é›†ç¾¤æœ€æ ¸å¿ƒçš„åŠŸèƒ½ã€‚é›†ç¾¤å°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œä¸€æ–¹é¢ çªç ´äº† Redis å•æœºå†…å­˜å¤§å°çš„é™åˆ¶ï¼Œ**å­˜å‚¨å®¹é‡å¤§å¤§å¢åŠ **ï¼›**å¦ä¸€æ–¹é¢** æ¯ä¸ªä¸»èŠ‚ç‚¹éƒ½å¯ä»¥å¯¹å¤–æä¾›è¯»æœåŠ¡å’Œå†™æœåŠ¡ï¼Œ**å¤§å¤§æé«˜äº†é›†ç¾¤çš„å“åº”èƒ½åŠ›**ã€‚

2. **é«˜å¯ç”¨ï¼š** é›†ç¾¤æ”¯æŒä¸»ä»å¤åˆ¶å’Œä¸»èŠ‚ç‚¹çš„ **è‡ªåŠ¨æ•…éšœè½¬ç§»** _ï¼ˆä¸å“¨å…µç±»ä¼¼ï¼‰_ï¼Œå½“ä»»ä¸€èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œé›†ç¾¤ä»ç„¶å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡ã€‚

### 55.åˆ‡ç‰‡é›†ç¾¤äº†è§£å—ï¼Ÿï¼ˆè¡¥å……ï¼‰

>2024å¹´04æœˆ26æ—¥æ–°å¢

åˆ‡ç‰‡é›†ç¾¤æ˜¯ä¸€ç§å°†æ•°æ®åˆ†ç‰‡å­˜å‚¨åœ¨å¤šä¸ª Redis å®ä¾‹ä¸Šçš„é›†ç¾¤æ¶æ„ï¼Œæ¯ä¸ª Redis å®ä¾‹è´Ÿè´£å­˜å‚¨éƒ¨åˆ†æ•°æ®ã€‚æ¯”å¦‚è¯´æŠŠ 25G çš„æ•°æ®å¹³å‡åˆ†ä¸º 5 ä»½ï¼Œæ¯ä»½ 5Gï¼Œç„¶åå¯åŠ¨ 5 ä¸ª Redis å®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹ä¿å­˜ä¸€ä»½æ•°æ®ã€‚

![æå®¢æ—¶é—´ï¼šåˆ‡ç‰‡é›†ç¾¤æ¶æ„å›¾](https://cdn.tobebetterjavaer.com/stutymore/redis-20240408104101.png)

#### æ•°æ®å’Œå®ä¾‹ä¹‹é—´å¦‚ä½•æ˜ å°„å‘¢ï¼Ÿ

åœ¨ Redis 3.0 ä¹‹å‰ï¼Œå®˜æ–¹å¹¶æ²¡æœ‰é’ˆå¯¹åˆ‡ç‰‡é›†ç¾¤æä¾›å…·ä½“çš„è§£å†³æ–¹æ¡ˆï¼›ä½†æ˜¯åœ¨ Redis 3.0 ä¹‹åï¼Œå®˜æ–¹æä¾›äº† Redis Clusterï¼Œå®ƒæ˜¯ Redis å®˜æ–¹æ¨èçš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆã€‚

åœ¨ Redis Cluster ä¸­ï¼Œæ•°æ®å’Œå®ä¾‹ä¹‹é—´çš„æ˜ å°„æ˜¯é€šè¿‡å“ˆå¸Œæ§½ï¼ˆhash slotï¼‰æ¥å®ç°çš„ã€‚Redis Cluster æœ‰ 16384 ä¸ªå“ˆå¸Œæ§½ï¼Œæ¯ä¸ªé”®æ ¹æ®å…¶åå­—çš„ CRC16 å€¼è¢«æ˜ å°„åˆ°è¿™äº›å“ˆå¸Œæ§½ä¸Šã€‚ç„¶åï¼Œè¿™äº›å“ˆå¸Œæ§½ä¼šè¢«å‡åŒ€åœ°åˆ†é…åˆ°æ‰€æœ‰çš„ Redis å®ä¾‹ä¸Šã€‚

> CRC16 æ˜¯ä¸€ç§å“ˆå¸Œç®—æ³•ï¼Œå®ƒå¯ä»¥å°†ä»»æ„é•¿åº¦çš„è¾“å…¥æ•°æ®æ˜ å°„ä¸ºä¸€ä¸ª 16 ä½çš„å“ˆå¸Œå€¼ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ§½](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e0ed9d62-3406-40db-8b01-c931f1020612.png)

ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ 3 ä¸ª Redis å®ä¾‹ï¼Œé‚£ä¹ˆæ¯ä¸ªå®ä¾‹å¯èƒ½ä¼šè´Ÿè´£å¤§çº¦ 5461 ä¸ªå“ˆå¸Œæ§½ã€‚

å½“éœ€è¦å­˜å‚¨æˆ–æ£€ç´¢ä¸€ä¸ªé”®å€¼å¯¹æ—¶ï¼ŒRedis Cluster ä¼šå…ˆè®¡ç®—è¿™ä¸ªé”®çš„å“ˆå¸Œæ§½ï¼Œç„¶åæ‰¾åˆ°è´Ÿè´£è¿™ä¸ªå“ˆå¸Œæ§½çš„ Redis å®ä¾‹ï¼Œæœ€ååœ¨è¿™ä¸ªå®ä¾‹ä¸Šè¿›è¡Œæ“ä½œã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 1 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis åˆ‡ç‰‡é›†ç¾¤ï¼Ÿæ•°æ®å’Œå®ä¾‹ä¹‹é—´çš„å¦‚ä½•è¿›è¡Œæ˜ å°„ï¼Ÿ
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¿«æ‰‹é¢ç»åŒå­¦ 1 éƒ¨é—¨ä¸»ç«™æŠ€æœ¯éƒ¨é¢è¯•åŸé¢˜ï¼šRedisçš„clusteré›†ç¾¤å¦‚ä½•å®ç°ï¼Ÿ

### 23.é›†ç¾¤ä¸­æ•°æ®å¦‚ä½•åˆ†åŒºï¼Ÿ

åœ¨ Redis é›†ç¾¤ä¸­ï¼Œæ•°æ®åˆ†åŒºæ˜¯é€šè¿‡å°†æ•°æ®åˆ†æ•£åˆ°ä¸åŒçš„èŠ‚ç‚¹æ¥å®ç°çš„ï¼Œå¸¸è§çš„æ•°æ®åˆ†åŒºè§„åˆ™æœ‰ä¸‰ç§ï¼šèŠ‚ç‚¹å–ä½™åˆ†åŒºã€ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºã€è™šæ‹Ÿæ§½åˆ†åŒºã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šåˆ†å¸ƒå¼æ•°æ®åˆ†åŒº](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-ceb49e41-dfd7-4d1e-91f9-c299437227d2.png)

#### è¯´è¯´èŠ‚ç‚¹å–ä½™åˆ†åŒº

èŠ‚ç‚¹å–ä½™åˆ†åŒºæ˜¯ä¸€ç§ç®€å•çš„åˆ†åŒºç­–ç•¥ï¼Œå…¶ä¸­æ•°æ®é¡¹é€šè¿‡å¯¹æŸä¸ªå€¼ï¼ˆé€šå¸¸æ˜¯é”®çš„å“ˆå¸Œå€¼ï¼‰è¿›è¡Œå–ä½™æ“ä½œæ¥åˆ†é…åˆ°ä¸åŒçš„èŠ‚ç‚¹ã€‚

ç±»ä¼¼ HashMap ä¸­çš„å–ä½™æ“ä½œï¼Œæ•°æ®é¡¹çš„é”®ç»è¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—åï¼Œå¯¹èŠ‚ç‚¹æ•°é‡å–ä½™ï¼Œç„¶åå°†æ•°æ®é¡¹åˆ†é…åˆ°ä½™æ•°å¯¹åº”çš„èŠ‚ç‚¹ä¸Šã€‚

ç¼ºç‚¹æ˜¯æ‰©ç¼©å®¹æ—¶ï¼Œå¤§å¤šæ•°æ•°æ®éœ€è¦é‡æ–°åˆ†é…ï¼Œå› ä¸ºèŠ‚ç‚¹æ€»æ•°çš„æ”¹å˜ä¼šå½±å“å–ä½™ç»“æœï¼Œè¿™å¯èƒ½å¯¼è‡´å¤§é‡æ•°æ®è¿ç§»ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šèŠ‚ç‚¹å–ä½™åˆ†åŒº](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-8b1fcaec-37e6-420a-9ca2-03615232af17.png)

#### è¯´è¯´ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº

ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºçš„åŸç†æ˜¯ï¼šå°†å“ˆå¸Œå€¼ç©ºé—´ç»„ç»‡æˆä¸€ä¸ªç¯ï¼Œæ•°æ®é¡¹å’ŒèŠ‚ç‚¹éƒ½æ˜ å°„åˆ°è¿™ä¸ªç¯ä¸Šã€‚æ•°æ®é¡¹ç”±å…¶å“ˆå¸Œå€¼ç›´æ¥æ˜ å°„åˆ°ç¯ä¸Šï¼Œç„¶åé¡ºæ—¶é’ˆåˆ†é…åˆ°é‡åˆ°çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚

ä»è€Œæ¥å‡å°‘èŠ‚ç‚¹å˜åŠ¨æ—¶æ•°æ®è¿ç§»çš„é‡ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-89bd1c1c-251c-4f53-bba3-fe945b2ae9e2.png)

Key 1 å’Œ Key 2 ä¼šè½å…¥åˆ° Node 1 ä¸­ï¼ŒKey 3ã€Key 4 ä¼šè½å…¥åˆ° Node 2 ä¸­ï¼ŒKey 5 è½å…¥åˆ° Node 3 ä¸­ï¼ŒKey 6 è½å…¥åˆ° Node 4 ä¸­ã€‚

è¿™ç§æ–¹å¼ç›¸æ¯”èŠ‚ç‚¹å–ä½™æœ€å¤§çš„å¥½å¤„åœ¨äºåŠ å…¥å’Œåˆ é™¤èŠ‚ç‚¹åªå½±å“å“ˆå¸Œç¯ä¸­ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œå¯¹å…¶ä»–èŠ‚ç‚¹æ— å½±å“ã€‚

ä½†å®ƒè¿˜æ˜¯å­˜åœ¨é—®é¢˜ï¼š

- èŠ‚ç‚¹åœ¨åœ†ç¯ä¸Šåˆ†å¸ƒä¸å¹³å‡ï¼Œä¼šé€ æˆéƒ¨åˆ†ç¼“å­˜èŠ‚ç‚¹çš„å‹åŠ›è¾ƒå¤§
- å½“æŸä¸ªèŠ‚ç‚¹æ•…éšœæ—¶ï¼Œè¿™ä¸ªèŠ‚ç‚¹æ‰€è¦æ‰¿æ‹…çš„æ‰€æœ‰è®¿é—®éƒ½ä¼šè¢«é¡ºç§»åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œä¼šå¯¹åé¢è¿™ä¸ªèŠ‚ç‚¹é€ æˆå‹åŠ›ã€‚

#### è¯´è¯´è™šæ‹Ÿæ§½åˆ†åŒºï¼Ÿ

åœ¨è™šæ‹Ÿæ§½ï¼ˆä¹Ÿå«å“ˆå¸Œæ§½ï¼‰åˆ†åŒºä¸­ï¼Œå­˜åœ¨å›ºå®šæ•°é‡çš„æ§½ä½ï¼ˆä¾‹å¦‚ Redis Cluster æœ‰ 16384 ä¸ªæ§½ï¼‰ï¼Œæ¯ä¸ªé”®é€šè¿‡å“ˆå¸Œç®—æ³•ï¼ˆCRC16ï¼‰æ˜ å°„åˆ°è¿™äº›æ§½ä¸Šï¼Œæ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹è´Ÿè´£ç®¡ç†ä¸€å®šèŒƒå›´å†…çš„æ§½ã€‚

è¿™ç§åˆ†åŒºå¯ä»¥çµæ´»åœ°å°†æ§½ï¼ˆä»¥åŠæ§½ä¸­çš„æ•°æ®ï¼‰ä»ä¸€ä¸ªèŠ‚ç‚¹è¿ç§»åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»è€Œå®ç°å¹³æ»‘æ‰©å®¹å’Œç¼©å®¹ï¼›æ•°æ®åˆ†å¸ƒä¹Ÿæ›´åŠ å‡åŒ€ï¼ŒRedis Cluster é‡‡ç”¨çš„æ­£æ˜¯è¿™ç§åˆ†åŒºæ–¹å¼ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šè™šæ‹Ÿæ§½åˆ†é…](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e0ed9d62-3406-40db-8b01-c931f1020612.png)

åœ¨è™šæ‹Ÿæ§½åˆ†åŒºä¸­ï¼Œæ§½æ˜¯æ•°æ®ç®¡ç†å’Œè¿ç§»çš„åŸºæœ¬å•ä½ã€‚å‡è®¾ç³»ç»Ÿä¸­æœ‰ 4 ä¸ªå®é™…èŠ‚ç‚¹ï¼Œå‡è®¾ä¸ºå…¶åˆ†é…äº† 16 ä¸ªæ§½(0-15)ï¼›

- æ§½ 0-3 ä½äºèŠ‚ç‚¹ node1ï¼›
- æ§½ 4-7 ä½äºèŠ‚ç‚¹ node2ï¼›
- æ§½ 8-11 ä½äºèŠ‚ç‚¹ node3ï¼›
- æ§½ 12-15 ä½äºèŠ‚ç‚¹ node4ã€‚

å¦‚æœæ­¤æ—¶åˆ é™¤ `node2`ï¼Œåªéœ€è¦å°†æ§½ 4-7 é‡æ–°åˆ†é…å³å¯ï¼Œä¾‹å¦‚å°†æ§½ 4-5 åˆ†é…ç»™ `node1`ï¼Œæ§½ 6 åˆ†é…ç»™ `node3`ï¼Œæ§½ 7 åˆ†é…ç»™ `node4`ï¼Œæ•°æ®åœ¨èŠ‚ç‚¹ä¸Šçš„åˆ†å¸ƒä»ç„¶è¾ƒä¸ºå‡è¡¡ã€‚

å¦‚æœæ­¤æ—¶å¢åŠ  node5ï¼Œä¹Ÿåªéœ€è¦å°†ä¸€éƒ¨åˆ†æ§½åˆ†é…ç»™ node5 å³å¯ï¼Œæ¯”å¦‚è¯´å°†æ§½ 3ã€æ§½ 7ã€æ§½ 11ã€æ§½ 15 è¿ç§»ç»™ node5ï¼ŒèŠ‚ç‚¹ä¸Šçš„å…¶ä»–æ§½ä½ä¿ç•™ã€‚

å½“ç„¶äº†ï¼Œè¿™å–å†³äº `CRC16(key) % æ§½çš„ä¸ªæ•°` çš„å…·ä½“ç»“æœã€‚å› ä¸ºåœ¨ Redis Cluster ä¸­ï¼Œæ§½çš„ä¸ªæ•°åˆšå¥½æ˜¯ 2 çš„ 14 æ¬¡æ–¹ï¼Œè¿™å’Œ HashMap ä¸­æ•°ç»„çš„é•¿åº¦å¿…é¡»æ˜¯ 2 çš„å¹‚æ¬¡æ–¹æœ‰ç€å¼‚æ›²åŒå·¥ä¹‹å¦™ã€‚

å®ƒèƒ½ä¿è¯æ‰©å®¹åï¼Œå¤§éƒ¨åˆ†æ•°æ®åœç•™åœ¨æ‰©å®¹å‰çš„ä½ç½®ï¼Œåªæœ‰å°‘éƒ¨åˆ†æ•°æ®éœ€è¦è¿ç§»åˆ°æ–°çš„æ§½ä¸Šã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³æš‘æœŸå®ä¹ åŒå­¦ E ä¸€é¢é¢è¯•åŸé¢˜ï¼šä½ çŸ¥é“ Redis çš„ä¸€è‡´æ€§ hash å—
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 1 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis æ‰©å®¹ä¹‹åï¼Œå“ˆå¸Œæ§½çš„ä½ç½®æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Ÿ

### 24.èƒ½è¯´è¯´ Redis é›†ç¾¤çš„åŸç†å—ï¼Ÿ

Redis é›†ç¾¤é€šè¿‡æ•°æ®åˆ†åŒºæ¥å®ç°æ•°æ®çš„åˆ†å¸ƒå¼å­˜å‚¨ï¼Œé€šè¿‡è‡ªåŠ¨æ•…éšœè½¬ç§»å®ç°é«˜å¯ç”¨ã€‚

##### é›†ç¾¤åˆ›å»º

æ•°æ®åˆ†åŒºæ˜¯åœ¨é›†ç¾¤åˆ›å»ºçš„æ—¶å€™å®Œæˆçš„ã€‚

![é›†ç¾¤åˆ›å»º](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-046a512c-baab-4e3a-9409-2af58088cceb.png)

**è®¾ç½®èŠ‚ç‚¹**
Redis é›†ç¾¤ä¸€èˆ¬ç”±å¤šä¸ªèŠ‚ç‚¹ç»„æˆï¼ŒèŠ‚ç‚¹æ•°é‡è‡³å°‘ä¸º 6 ä¸ªæ‰èƒ½ä¿è¯ç»„æˆå®Œæ•´é«˜å¯ç”¨çš„é›†ç¾¤ã€‚æ¯ä¸ªèŠ‚ç‚¹éœ€è¦å¼€å¯é…ç½® cluster-enabled yesï¼Œè®© Redis è¿è¡Œåœ¨é›†ç¾¤æ¨¡å¼ä¸‹ã€‚
![èŠ‚ç‚¹å’Œæ¡æ‰‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e6064ba6-fd6f-4270-92f9-68c0bb98fd4b.png)
**èŠ‚ç‚¹æ¡æ‰‹**
èŠ‚ç‚¹æ¡æ‰‹æ˜¯æŒ‡ä¸€æ‰¹è¿è¡Œåœ¨é›†ç¾¤æ¨¡å¼ä¸‹çš„èŠ‚ç‚¹é€šè¿‡ Gossip åè®®å½¼æ­¤é€šä¿¡ï¼Œ è¾¾åˆ°æ„ŸçŸ¥å¯¹æ–¹çš„è¿‡ç¨‹ã€‚èŠ‚ç‚¹æ¡æ‰‹æ˜¯é›†ç¾¤å½¼æ­¤é€šä¿¡çš„ç¬¬ä¸€æ­¥ï¼Œç”±å®¢æˆ·ç«¯å‘èµ·å‘½ ä»¤ï¼šcluster meet{ip}{port}ã€‚å®ŒæˆèŠ‚ç‚¹æ¡æ‰‹ä¹‹åï¼Œä¸€ä¸ªä¸ªçš„ Redis èŠ‚ç‚¹å°±ç»„æˆäº†ä¸€ä¸ªå¤šèŠ‚ç‚¹çš„é›†ç¾¤ã€‚

**åˆ†é…æ§½ï¼ˆslotï¼‰**
Redis é›†ç¾¤æŠŠæ‰€æœ‰çš„æ•°æ®æ˜ å°„åˆ° 16384 ä¸ªæ§½ä¸­ã€‚æ¯ä¸ªèŠ‚ç‚¹å¯¹åº”è‹¥å¹²ä¸ªæ§½ï¼Œåªæœ‰å½“èŠ‚ç‚¹åˆ†é…äº†æ§½ï¼Œæ‰èƒ½å“åº”å’Œè¿™äº›æ§½å…³è”çš„é”®å‘½ä»¤ã€‚é€šè¿‡ cluster addslots å‘½ä»¤ä¸ºèŠ‚ç‚¹åˆ†é…æ§½ã€‚

![åˆ†é…æ§½](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-15341792-e7a6-428c-a109-22827e02be5f.png)

##### æ•…éšœè½¬ç§»

Redis é›†ç¾¤çš„æ•…éšœè½¬ç§»å’Œå“¨å…µçš„æ•…éšœè½¬ç§»ç±»ä¼¼ï¼Œä½†æ˜¯ Redis é›†ç¾¤ä¸­æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½è¦æ‰¿æ‹…çŠ¶æ€ç»´æŠ¤çš„ä»»åŠ¡ã€‚

**æ•…éšœå‘ç°**
Redis é›†ç¾¤å†…èŠ‚ç‚¹é€šè¿‡ ping/pong æ¶ˆæ¯å®ç°èŠ‚ç‚¹é€šä¿¡ï¼Œé›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šå®šæœŸå‘å…¶ä»–èŠ‚ç‚¹å‘é€ ping æ¶ˆæ¯ï¼Œæ¥æ”¶èŠ‚ç‚¹å›å¤ pong æ¶ˆæ¯ä½œä¸ºå“åº”ã€‚å¦‚æœåœ¨ cluster-node-timeout æ—¶é—´å†…é€šä¿¡ä¸€ç›´å¤±è´¥ï¼Œåˆ™å‘é€èŠ‚ ç‚¹ä¼šè®¤ä¸ºæ¥æ”¶èŠ‚ç‚¹å­˜åœ¨æ•…éšœï¼ŒæŠŠæ¥æ”¶èŠ‚ç‚¹æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼ˆpfailï¼‰çŠ¶æ€ã€‚
![ä¸»è§‚ä¸‹çº¿](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-84a2a89e-f9ea-4681-b748-1a4f1dee172b.png)
å½“æŸä¸ªèŠ‚ç‚¹åˆ¤æ–­å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸»è§‚ä¸‹çº¿åï¼Œç›¸åº”çš„èŠ‚ç‚¹çŠ¶æ€ä¼šè·Ÿéšæ¶ˆæ¯åœ¨é›†ç¾¤å†…ä¼ æ’­ã€‚é€šè¿‡ Gossip æ¶ˆæ¯ä¼ æ’­ï¼Œé›†ç¾¤å†…èŠ‚ç‚¹ä¸æ–­æ”¶é›†åˆ°æ•…éšœèŠ‚ç‚¹çš„ä¸‹çº¿æŠ¥å‘Šã€‚å½“ åŠæ•°ä»¥ä¸ŠæŒæœ‰æ§½çš„ä¸»èŠ‚ç‚¹éƒ½æ ‡è®°æŸä¸ªèŠ‚ç‚¹æ˜¯ä¸»è§‚ä¸‹çº¿æ—¶ã€‚è§¦å‘å®¢è§‚ä¸‹çº¿æµç¨‹ã€‚
![ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-b61a6109-7aea-45ab-a53c-267eebb9180a.png)

**æ•…éšœæ¢å¤**

æ•…éšœèŠ‚ç‚¹å˜ä¸ºå®¢è§‚ä¸‹çº¿åï¼Œå¦‚æœä¸‹çº¿èŠ‚ç‚¹æ˜¯æŒæœ‰æ§½çš„ä¸»èŠ‚ç‚¹åˆ™éœ€è¦åœ¨å®ƒ çš„ä»èŠ‚ç‚¹ä¸­é€‰å‡ºä¸€ä¸ªæ›¿æ¢å®ƒï¼Œä»è€Œä¿è¯é›†ç¾¤çš„é«˜å¯ç”¨ã€‚

![æ•…éšœæ¢å¤æµç¨‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-0e5a49b3-cb5a-4aef-a81f-fce50a012a39.png)

1. èµ„æ ¼æ£€æŸ¥
   æ¯ä¸ªä»èŠ‚ç‚¹éƒ½è¦æ£€æŸ¥æœ€åä¸ä¸»èŠ‚ç‚¹æ–­çº¿æ—¶é—´ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰èµ„æ ¼æ›¿æ¢æ•…éšœ çš„ä¸»èŠ‚ç‚¹ã€‚
2. å‡†å¤‡é€‰ä¸¾æ—¶é—´
   å½“ä»èŠ‚ç‚¹ç¬¦åˆæ•…éšœè½¬ç§»èµ„æ ¼åï¼Œæ›´æ–°è§¦å‘æ•…éšœé€‰ä¸¾çš„æ—¶é—´ï¼Œåªæœ‰åˆ°è¾¾è¯¥ æ—¶é—´åæ‰èƒ½æ‰§è¡Œåç»­æµç¨‹ã€‚
3. å‘èµ·é€‰ä¸¾
   å½“ä»èŠ‚ç‚¹å®šæ—¶ä»»åŠ¡æ£€æµ‹åˆ°è¾¾æ•…éšœé€‰ä¸¾æ—¶é—´ï¼ˆfailover_auth_timeï¼‰åˆ°è¾¾åï¼Œå‘èµ·é€‰ä¸¾æµç¨‹ã€‚
4. é€‰ä¸¾æŠ•ç¥¨
   æŒæœ‰æ§½çš„ä¸»èŠ‚ç‚¹å¤„ç†æ•…éšœé€‰ä¸¾æ¶ˆæ¯ã€‚æŠ•ç¥¨è¿‡ç¨‹å…¶å®æ˜¯ä¸€ä¸ªé¢†å¯¼è€…é€‰ä¸¾çš„è¿‡ç¨‹ï¼Œå¦‚é›†ç¾¤å†…æœ‰ N ä¸ªæŒæœ‰æ§½çš„ä¸»èŠ‚ ç‚¹ä»£è¡¨æœ‰ N å¼ é€‰ç¥¨ã€‚ç”±äºåœ¨æ¯ä¸ªé…ç½®çºªå…ƒå†…æŒæœ‰æ§½çš„ä¸»èŠ‚ç‚¹åªèƒ½æŠ•ç¥¨ç»™ä¸€ä¸ª ä»èŠ‚ç‚¹ï¼Œå› æ­¤åªèƒ½æœ‰ä¸€ä¸ªä»èŠ‚ç‚¹è·å¾— N/2+1 çš„é€‰ç¥¨ï¼Œä¿è¯èƒ½å¤Ÿæ‰¾å‡ºå”¯ä¸€çš„ä»èŠ‚ç‚¹ã€‚
   ![é€‰ä¸¾æŠ•ç¥¨](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-d0e16ea3-6683-43f4-82a3-80478703ae06.png)
5. æ›¿æ¢ä¸»èŠ‚ç‚¹
   å½“ä»èŠ‚ç‚¹æ”¶é›†åˆ°è¶³å¤Ÿçš„é€‰ç¥¨ä¹‹åï¼Œè§¦å‘æ›¿æ¢ä¸»èŠ‚ç‚¹æ“ä½œã€‚

> **éƒ¨ç½² Redis é›†ç¾¤è‡³å°‘éœ€è¦å‡ ä¸ªç‰©ç†èŠ‚ç‚¹ï¼Ÿ**

åœ¨æŠ•ç¥¨é€‰ä¸¾çš„ç¯èŠ‚ï¼Œæ•…éšœä¸»èŠ‚ç‚¹ä¹Ÿç®—åœ¨æŠ•ç¥¨æ•°å†…ï¼Œå‡è®¾é›†ç¾¤å†…èŠ‚ç‚¹è§„æ¨¡æ˜¯ 3 ä¸» 3 ä»ï¼Œå…¶ä¸­æœ‰ 2 ä¸ªä¸»èŠ‚ç‚¹éƒ¨ç½²åœ¨ä¸€å°æœºå™¨ä¸Šï¼Œå½“è¿™å°æœºå™¨å®•æœºæ—¶ï¼Œç”±äºä»èŠ‚ç‚¹æ— æ³•æ”¶é›†åˆ° 3/2+1 ä¸ªä¸»èŠ‚ç‚¹é€‰ç¥¨å°†å¯¼è‡´æ•…éšœè½¬ç§»å¤±è´¥ã€‚è¿™ä¸ªé—®é¢˜ä¹Ÿé€‚ç”¨äºæ•…éšœå‘ç°ç¯èŠ‚ã€‚å› æ­¤éƒ¨ç½²é›†ç¾¤æ—¶æ‰€æœ‰ä¸»èŠ‚ç‚¹æœ€å°‘éœ€è¦éƒ¨ç½²åœ¨ 3 å°ç‰©ç†æœºä¸Šæ‰èƒ½é¿å…å•ç‚¹é—®é¢˜ã€‚

### 25.è¯´è¯´é›†ç¾¤çš„ä¼¸ç¼©ï¼Ÿ

Redis é›†ç¾¤æä¾›äº†çµæ´»çš„èŠ‚ç‚¹æ‰©å®¹å’Œæ”¶ç¼©æ–¹æ¡ˆï¼Œå¯ä»¥åœ¨ä¸å½±å“é›†ç¾¤å¯¹å¤–æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œä¸ºé›†ç¾¤æ·»åŠ èŠ‚ç‚¹è¿›è¡Œæ‰©å®¹ä¹Ÿå¯ä»¥ä¸‹çº¿éƒ¨åˆ†èŠ‚ç‚¹è¿›è¡Œç¼©å®¹ã€‚
![é›†ç¾¤çš„ä¼¸ç¼©](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-dd3e9494-eddb-4861-85f7-2646018d93f6.png)å…¶å®ï¼Œé›†ç¾¤æ‰©å®¹å’Œç¼©å®¹çš„å…³é”®ç‚¹ï¼Œå°±åœ¨äºæ§½å’ŒèŠ‚ç‚¹çš„å¯¹åº”å…³ç³»ï¼Œæ‰©å®¹å’Œç¼©å®¹å°±æ˜¯å°†ä¸€éƒ¨åˆ†`æ§½`å’Œ`æ•°æ®`è¿ç§»ç»™æ–°èŠ‚ç‚¹ã€‚

ä¾‹å¦‚ä¸‹é¢ä¸€ä¸ªé›†ç¾¤ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯¹åº”è‹¥å¹²ä¸ªæ§½ï¼Œæ¯ä¸ªæ§½å¯¹åº”ä¸€å®šçš„æ•°æ®ï¼Œå¦‚æœå¸Œæœ›åŠ å…¥ 1 ä¸ªèŠ‚ç‚¹å¸Œæœ›å®ç°é›†ç¾¤æ‰©å®¹æ—¶ï¼Œéœ€è¦é€šè¿‡ç›¸å…³å‘½ä»¤æŠŠä¸€éƒ¨åˆ†æ§½å’Œå†…å®¹è¿ç§»ç»™æ–°èŠ‚ç‚¹ã€‚
![æ‰©å®¹å®ä¾‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-1d24bb63-2b05-4db9-bd6b-983f16a4830e.png)ç¼©å®¹ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œå…ˆæŠŠæ§½å’Œæ•°æ®è¿ç§»åˆ°å…¶å®ƒèŠ‚ç‚¹ï¼Œå†æŠŠå¯¹åº”çš„èŠ‚ç‚¹ä¸‹çº¿ã€‚

GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹](https://javabetter.cn/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## ç¼“å­˜è®¾è®¡

### 26.ä»€ä¹ˆæ˜¯ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜ç©¿é€ã€ç¼“å­˜é›ªå´©ï¼Ÿ

ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿å’Œç¼“å­˜é›ªå´©æ˜¯æŒ‡åœ¨ä½¿ç”¨ Redis åšä¸ºç¼“å­˜æ—¶å¯èƒ½é‡åˆ°çš„ä¸‰ç§é—®é¢˜ã€‚

#### ä»€ä¹ˆæ˜¯ç¼“å­˜å‡»ç©¿ï¼Ÿ

ç¼“å­˜å‡»ç©¿æ˜¯æŒ‡æŸä¸€ä¸ªæˆ–å°‘æ•°å‡ ä¸ªæ•°æ®è¢«é«˜é¢‘è®¿é—®ï¼Œå½“è¿™äº›æ•°æ®åœ¨ç¼“å­˜ä¸­è¿‡æœŸçš„é‚£ä¸€åˆ»ï¼Œå¤§é‡è¯·æ±‚å°±ä¼šç›´æ¥åˆ°è¾¾æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“ç¬é—´å‹åŠ›è¿‡å¤§ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç¼“å­˜å‡»ç©¿](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-86579ee6-9dae-4274-a5cc-af6812f48da4.png)

è§£å†³â½…æ¡ˆï¼š

â‘ ã€åŠ é”æ›´æ–°ï¼Œâ½å¦‚è¯·æ±‚æŸ¥è¯¢ Aï¼Œå‘ç°ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œå¯¹ A è¿™ä¸ª key åŠ é”ï¼ŒåŒæ—¶å»æ•°æ®åº“æŸ¥è¯¢æ•°æ®ï¼Œå†™â¼Šç¼“å­˜ï¼Œå†è¿”å›ç»™â½¤æˆ·ï¼Œè¿™æ ·åâ¾¯çš„è¯·æ±‚å°±å¯ä»¥ä»ç¼“å­˜ä¸­æ‹¿åˆ°æ•°æ®äº†ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šåŠ é”æ›´æ–°](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-cf63911a-8501-493e-a375-8b47a9f33358.png)

â‘¡ã€å°†è¿‡æœŸæ—¶é—´ç»„åˆå†™åœ¨ value ä¸­ï¼Œé€šè¿‡å¼‚æ­¥çš„â½…å¼ä¸æ–­çš„åˆ·æ–°è¿‡æœŸæ—¶é—´ï¼Œé˜²â½Œæ­¤ç±»ç°è±¡ã€‚

#### ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Ÿ

ç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼Œç”±äºç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼ˆå› ä¸ºæ•°æ®æ ¹æœ¬å°±ä¸å­˜åœ¨ï¼‰ï¼Œè¯·æ±‚æ¯æ¬¡éƒ½ä¼šç©¿è¿‡ç¼“å­˜å»æŸ¥è¯¢æ•°æ®åº“ã€‚å¦‚æœè¿™ç§æŸ¥è¯¢éå¸¸é¢‘ç¹ï¼Œå°±ä¼šç»™æ•°æ®åº“é€ æˆå¾ˆå¤§çš„å‹åŠ›ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç¼“å­˜ç©¿é€](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-029951e6-8b99-4364-a570-010853deb594.png)

ç¼“å­˜ç©¿é€æ„å‘³ç€ç¼“å­˜å¤±å»äº†å‡è½»æ•°æ®å‹åŠ›çš„æ„ä¹‰ã€‚ç¼“å­˜ç©¿é€å¯èƒ½æœ‰ä¸¤ç§åŸå› ï¼š

1. è‡ªèº«ä¸šåŠ¡ä»£ç é—®é¢˜
2. æ¶æ„æ”»å‡»ï¼Œçˆ¬è™«é€ æˆç©ºå‘½ä¸­

å®ƒä¸»è¦æœ‰ä¸¤ç§è§£å†³åŠæ³•ï¼š

â‘ ã€**ç¼“å­˜ç©ºå€¼/é»˜è®¤å€¼**

åœ¨æ•°æ®åº“æ— æ³•å‘½ä¸­ä¹‹åï¼ŒæŠŠä¸€ä¸ªç©ºå¯¹è±¡æˆ–è€…é»˜è®¤å€¼ä¿å­˜åˆ°ç¼“å­˜ï¼Œä¹‹åå†è®¿é—®è¿™ä¸ªæ•°æ®ï¼Œå°±ä¼šä»ç¼“å­˜ä¸­è·å–ï¼Œè¿™æ ·å°±ä¿æŠ¤äº†æ•°æ®åº“ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç¼“å­˜ç©ºå€¼/é»˜è®¤å€¼](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-288af5a2-ae5a-427a-95e9-b4a658b01386.png)

ç¼“å­˜ç©ºå€¼æœ‰ä¸¤å¤§é—®é¢˜ï¼š

1. ç©ºå€¼åšäº†ç¼“å­˜ï¼Œæ„å‘³ç€ç¼“å­˜å±‚ä¸­å­˜äº†æ›´å¤šçš„é”®ï¼Œéœ€è¦æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼ˆå¦‚æœæ˜¯æ”»å‡»ï¼Œé—®é¢˜æ›´ä¸¥é‡ï¼‰ï¼Œæ¯”è¾ƒæœ‰æ•ˆçš„æ–¹æ³•æ˜¯é’ˆå¯¹è¿™ç±»æ•°æ®è®¾ç½®ä¸€ä¸ªè¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œè®©å…¶è‡ªåŠ¨å‰”é™¤ã€‚
2. ç¼“å­˜å±‚å’Œå­˜å‚¨å±‚çš„æ•°æ®ä¼šæœ‰ä¸€æ®µæ—¶é—´çª—å£çš„ä¸ä¸€è‡´ï¼Œå¯èƒ½ä¼šå¯¹ä¸šåŠ¡æœ‰ä¸€å®šå½±å“ã€‚

ä¾‹å¦‚è¿‡æœŸæ—¶é—´è®¾ç½®ä¸º 5 åˆ†é’Ÿï¼Œå¦‚æœæ­¤æ—¶å­˜å‚¨å±‚æ·»åŠ äº†è¿™ä¸ªæ•°æ®ï¼Œé‚£æ­¤æ®µæ—¶é—´å°±ä¼šå‡ºç°ç¼“å­˜å±‚å’Œå­˜å‚¨å±‚æ•°æ®çš„ä¸ä¸€è‡´ã€‚

è¿™æ—¶å€™å¯ä»¥åˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—æˆ–è€…å…¶å®ƒå¼‚æ­¥æ–¹å¼æ¸…ç†ç¼“å­˜ä¸­çš„ç©ºå¯¹è±¡ã€‚

â‘¡ã€**å¸ƒéš†è¿‡æ»¤å™¨**

é™¤äº†ç¼“å­˜ç©ºå¯¹è±¡ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨å­˜å‚¨å’Œç¼“å­˜ä¹‹å‰ï¼ŒåŠ ä¸€ä¸ªå¸ƒéš†è¿‡æ»¤å™¨ï¼Œåšä¸€å±‚è¿‡æ»¤ã€‚

å¸ƒéš†è¿‡æ»¤å™¨é‡Œä¼šä¿å­˜æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœåˆ¤æ–­æ•°æ®ä¸å­˜åœ¨ï¼Œå°±ä¸ä¼šè®¿é—®å­˜å‚¨ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå¸ƒéš†è¿‡æ»¤å™¨](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-0e18ea40-a2e5-4fa6-989e-e771f6e4b0fc.png)

ä¸¤ç§è§£å†³æ–¹æ¡ˆçš„å¯¹æ¯”ï¼š

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç¼“å­˜ç©ºå¯¹è±¡å’Œå¸ƒéš†è¿‡æ»¤å™¨æ–¹æ¡ˆ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e8a382c9-4379-44ab-b1dc-fb598a228105.png)

#### ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ

ç¼“å­˜é›ªå´©æ˜¯æŒ‡åœ¨æŸä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œç”±äºå¤§é‡çš„ç¼“å­˜æ•°æ®åŒæ—¶è¿‡æœŸæˆ–ç¼“å­˜æœåŠ¡å™¨çªç„¶å®•æœºäº†ï¼Œå¯¼è‡´æ‰€æœ‰çš„è¯·æ±‚éƒ½è½åˆ°äº†æ•°æ®åº“ä¸Šï¼ˆæ¯”å¦‚ MySQLï¼‰ï¼Œä»è€Œå¯¹æ•°æ®åº“é€ æˆå·¨å¤§å‹åŠ›ï¼Œç”šè‡³å¯¼è‡´æ•°æ®åº“å´©æºƒçš„ç°è±¡ã€‚

æ€»ä¹‹å°±æ˜¯ï¼Œå´©äº†ï¼Œå´©çš„éå¸¸ä¸¥é‡ï¼Œå°±å«é›ªå´©äº†ï¼ˆç”µå½±ç”µè§†é‡Œåº”è¯¥çœ‹åˆ°è¿‡ï¼Œéå¸¸å¤¸å¼ ï¼‰ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç¼“å­˜é›ªå´©](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-1464fe22-c463-4850-8989-b899510cb10e.png)

#### å¦‚ä½•è§£å†³ç¼“å­˜é›ªå´©å‘¢ï¼Ÿ

ç¬¬ä¸€ç§ï¼šæé«˜ç¼“å­˜å¯ç”¨æ€§

**01ã€é›†ç¾¤éƒ¨ç½²**ï¼šé‡‡ç”¨åˆ†å¸ƒå¼ç¼“å­˜è€Œä¸æ˜¯å•ä¸€ç¼“å­˜æœåŠ¡å™¨ï¼Œå¯ä»¥é™ä½å•ç‚¹æ•…éšœçš„é£é™©ã€‚å³ä½¿æŸä¸ªç¼“å­˜èŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œå…¶ä»–èŠ‚ç‚¹ä»ç„¶å¯ä»¥æä¾›æœåŠ¡ï¼Œä»è€Œé¿å…å¯¹æ•°æ®åº“çš„å¤§é‡ç›´æ¥è®¿é—®ã€‚

å¯ä»¥åˆ©ç”¨ Redis Clusterã€‚

![Rajat Pachauriï¼šRedis Cluster](https://cdn.tobebetterjavaer.com/stutymore/redis-20240326220634.png)

æˆ–è€…ç¬¬ä¸‰æ–¹é›†ç¾¤æ–¹æ¡ˆ Codisã€‚

![æå®¢æ—¶é—´ï¼šCodis](https://cdn.tobebetterjavaer.com/stutymore/redis-20240326220408.png)

**02ã€å¤‡ä»½ç¼“å­˜**ï¼šå¯¹äºå…³é”®æ•°æ®ï¼Œé™¤äº†åœ¨ä¸»ç¼“å­˜ä¸­å­˜å‚¨ï¼Œè¿˜å¯ä»¥åœ¨å¤‡ç”¨ç¼“å­˜ä¸­ä¿å­˜ä¸€ä»½ã€‚å½“ä¸»ç¼“å­˜ä¸å¯ç”¨æ—¶ï¼Œå¯ä»¥å¿«é€Ÿåˆ‡æ¢åˆ°å¤‡ç”¨ç¼“å­˜ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§ã€‚

åœ¨[æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®](https://javabetter.cn/zhishixingqiu/paicoding.html)ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†å¤šçº§ç¼“å­˜çš„ç­–ç•¥ï¼Œå…¶ä¸­å°±åŒ…æ‹¬ä½¿ç”¨æœ¬åœ°ç¼“å­˜ Guava Cache å’Œ Caffeine æ¥ä½œä¸ºäºŒçº§ç¼“å­˜ï¼Œåœ¨ Redis å‡ºç°é—®é¢˜æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°æœ¬åœ°ç¼“å­˜ã€‚

è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºâ€œé™çº§â€ï¼Œæ„å‘³ç€ç³»ç»Ÿåœ¨å¤±å»ä¼˜å…ˆçº§é«˜çš„èµ„æºæ—¶ä»èƒ½ç»§ç»­æä¾›æœåŠ¡ã€‚

![æŠ€æœ¯æ´¾æ•™ç¨‹](https://cdn.tobebetterjavaer.com/stutymore/redis-20240421105333.png)

å½“ä» Redis è·å–æ•°æ®å¤±è´¥æ—¶ï¼Œå°è¯•ä»æœ¬åœ°ç¼“å­˜è¯»å–æ•°æ®ã€‚

```java
LoadingCache<String, UserPermissions> permissionsCache = Caffeine.newBuilder()
    .maximumSize(1000)
    .expireAfterWrite(10, TimeUnit.MINUTES)
    .build(this::loadPermissionsFromRedis);

public UserPermissions loadPermissionsFromRedis(String userId) {
    try {
        return redisClient.getPermissions(userId);
    } catch (Exception ex) {
        // Redis å¼‚å¸¸å¤„ç†ï¼Œå°è¯•ä»æœ¬åœ°ç¼“å­˜è·å–
        return permissionsCache.getIfPresent(userId);
    }
}
```

ç¬¬äºŒç§ï¼šè¿‡æœŸæ—¶é—´

å¯¹äºç¼“å­˜æ•°æ®ï¼Œè®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œé¿å…å¤§é‡ç¼“å­˜æ•°æ®åŒæ—¶è¿‡æœŸã€‚å¯ä»¥é€šè¿‡åœ¨åŸæœ‰è¿‡æœŸæ—¶é—´çš„åŸºç¡€ä¸Šæ·»åŠ ä¸€ä¸ªéšæœºå€¼æ¥å®ç°ï¼Œè¿™æ ·å¯ä»¥åˆ†æ•£ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œå‡å°‘åŒä¸€æ—¶é—´å¯¹æ•°æ®åº“çš„è®¿é—®å‹åŠ›ã€‚

ç¬¬ä¸‰ç§ï¼šé™æµå’Œé™çº§

é€šè¿‡è®¾ç½®åˆç†çš„ç³»ç»Ÿé™æµç­–ç•¥ï¼Œå¦‚ä»¤ç‰Œæ¡¶æˆ–æ¼æ–—ç®—æ³•ï¼Œæ¥æ§åˆ¶è®¿é—®æµé‡ï¼Œé˜²æ­¢åœ¨ç¼“å­˜å¤±æ•ˆæ—¶æ•°æ®åº“è¢«æ‰“å®ã€‚

æ­¤å¤–ï¼Œç³»ç»Ÿå¯ä»¥å®ç°é™çº§ç­–ç•¥ï¼Œåœ¨ç¼“å­˜é›ªå´©æˆ–ç³»ç»Ÿå‹åŠ›è¿‡å¤§æ—¶ï¼Œæš‚æ—¶å…³é—­ä¸€äº›éæ ¸å¿ƒæœåŠ¡ï¼Œç¡®ä¿æ ¸å¿ƒæœåŠ¡çš„æ­£å¸¸è¿è¡Œã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 22 æš‘æœŸå®ä¹ ä¸€é¢é¢è¯•åŸé¢˜ï¼šç¼“å­˜é›ªå´©ï¼Œå¦‚ä½•è§£å†³
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¿«æ‰‹é¢ç»åŒå­¦ 7 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šè¯´ä¸€ä¸‹ ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜é›ªå´©
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å­—èŠ‚è·³åŠ¨åŒå­¦ 7 Java åç«¯å®ä¹ ä¸€é¢çš„åŸé¢˜ï¼šRedis å®•æœºä¼šä¸ä¼šå¯¹æƒé™ç³»ç»Ÿæœ‰å½±å“ï¼Ÿ
> 4. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å­—èŠ‚è·³åŠ¨åŒå­¦ 7 Java åç«¯å®ä¹ ä¸€é¢çš„åŸé¢˜ï¼šè¯´ä¸€ä¸‹ Redis é›ªå´©ã€ç©¿é€ã€å‡»ç©¿ç­‰åœºæ™¯çš„è§£å†³æ–¹æ¡ˆ
> 5. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³åŒå­¦ F é¢è¯•åŸé¢˜ï¼šç¼“å­˜å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼ˆå¼•ç”³åˆ°å¤šçº§ç¼“å­˜ï¼‰ï¼Œå¤šçº§ç¼“å­˜ï¼ˆredisï¼Œnginxï¼Œæœ¬åœ°ç¼“å­˜ï¼‰çš„å®ç°æ€è·¯

### 27.èƒ½è¯´è¯´å¸ƒéš†è¿‡æ»¤å™¨å—ï¼Ÿ

å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰æ˜¯ä¸€ç§ç©ºé—´æ•ˆç‡æé«˜çš„æ¦‚ç‡å‹æ•°æ®ç»“æ„ï¼Œç”¨äºå¿«é€Ÿæ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºä¸€ä¸ªé›†åˆä¸­ã€‚

å¸ƒéš†è¿‡æ»¤å™¨ç”±ä¸€ä¸ªé•¿åº¦ä¸º m çš„ä½æ•°ç»„å’Œ k ä¸ªå“ˆå¸Œå‡½æ•°ç»„æˆã€‚

- å¼€å§‹æ—¶ï¼Œå¸ƒéš†è¿‡æ»¤å™¨çš„æ¯ä¸ªä½éƒ½è¢«è®¾ç½®ä¸º 0ã€‚
- å½“ä¸€ä¸ªå…ƒç´ è¢«æ·»åŠ åˆ°è¿‡æ»¤å™¨ä¸­æ—¶ï¼Œå®ƒä¼šè¢« k ä¸ªå“ˆå¸Œå‡½æ•°åˆ†åˆ«è®¡ç®—å¾—åˆ° k ä¸ªä½ç½®ï¼Œç„¶åå°†ä½æ•°ç»„ä¸­å¯¹åº”çš„ä½è®¾ç½®ä¸º 1ã€‚
- å½“æ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºè¿‡æ»¤å™¨ä¸­æ—¶ï¼ŒåŒæ ·ä½¿ç”¨ k ä¸ªå“ˆå¸Œå‡½æ•°è®¡ç®—ä½ç½®ï¼Œå¦‚æœä»»ä¸€ä½ç½®çš„ä½ä¸º 0ï¼Œåˆ™è¯¥å…ƒç´ è‚¯å®šä¸åœ¨è¿‡æ»¤å™¨ä¸­ï¼›å¦‚æœæ‰€æœ‰ä½ç½®çš„ä½éƒ½ä¸º 1ï¼Œåˆ™è¯¥å…ƒç´ å¯èƒ½åœ¨è¿‡æ»¤å™¨ä¸­ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå¸ƒéš†è¿‡æ»¤å™¨](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-d0b8d85c-85dc-4843-b4be-d5d48338a44e.png)

å› ä¸ºå¸ƒéš†è¿‡æ»¤å™¨å ç”¨çš„å†…å­˜ç©ºé—´éå¸¸å°ï¼Œæ‰€ä»¥æŸ¥è¯¢æ•ˆç‡ä¹Ÿéå¸¸é«˜ï¼Œæ‰€ä»¥åœ¨ Redis ç¼“å­˜ä¸­ï¼Œä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥å¿«é€Ÿåˆ¤æ–­è¯·æ±‚çš„æ•°æ®æ˜¯å¦åœ¨ç¼“å­˜ä¸­ã€‚

ä½†æ˜¯å¸ƒéš†è¿‡æ»¤å™¨ä¹Ÿæœ‰ä¸€å®šçš„ç¼ºç‚¹ï¼Œå› ä¸ºæ˜¯é€šè¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—çš„ï¼Œæ‰€ä»¥å­˜åœ¨å“ˆå¸Œå†²çªçš„é—®é¢˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¯¯åˆ¤ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å­—èŠ‚è·³åŠ¨åŒå­¦ 7 Java åç«¯å®ä¹ ä¸€é¢çš„åŸé¢˜ï¼šæœ‰äº†è§£è¿‡å¸ƒéš†è¿‡æ»¤å™¨å—ï¼Ÿ

### 28.å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®â¼€è‡´æ€§ï¼Ÿ

åœ¨[æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®](https://javabetter.cn/zhishixingqiu/paicoding.html)ä¸­ï¼Œæˆ‘é‡‡ç”¨çš„æ˜¯å…ˆå†™ MySQLï¼Œå†åˆ é™¤ Redis çš„æ–¹å¼æ¥ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§ã€‚

![æŠ€æœ¯æ´¾æ•™ç¨‹](https://cdn.tobebetterjavaer.com/stutymore/redis-20240325221330.png)

å¯¹äºç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼Œè¯·æ±‚ B æŸ¥è¯¢åˆ°çš„ç¼“å­˜æ•°æ®æ˜¯ 10ï¼Œä½† MySQL è¢«è¯·æ±‚ A æ›´æ–°ä¸ºäº† 11ï¼Œæ­¤æ—¶æ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´ã€‚

ä½†ä¹Ÿåªå­˜åœ¨è¿™ä¸€æ¬¡ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå¯¹äºä¸æ˜¯å¼ºä¸€è‡´æ€§çš„ä¸šåŠ¡ï¼Œå¯ä»¥å®¹å¿ã€‚

å½“è¯·æ±‚ B ç¬¬äºŒæ¬¡æŸ¥è¯¢æ—¶ï¼Œå› ä¸ºè¯·æ±‚ A æ›´æ–°å®Œæ•°æ®åº“æŠŠç¼“å­˜åˆ é™¤äº†ï¼Œæ‰€ä»¥è¯·æ±‚ B è¿™æ¬¡ä¸ä¼šå‘½ä¸­ç¼“å­˜ï¼Œä¼šé‡æ–°æŸ¥ä¸€æ¬¡ MySQLï¼Œç„¶åå›å†™åˆ° Redisã€‚

ç¼“å­˜å’Œæ•°æ®åº“åˆä¸€è‡´äº†ã€‚

#### é‚£å†æ¥è¯´è¯´ä¸ºä»€ä¹ˆè¦åˆ é™¤ç¼“å­˜è€Œä¸æ˜¯æ›´æ–°ç¼“å­˜

å› ä¸ºç›¸å¯¹è€Œè¨€ï¼Œåˆ é™¤ç¼“å­˜çš„é€Ÿåº¦æ¯”æ›´æ–°ç¼“å­˜çš„é€Ÿåº¦è¦å¿«å¾—å¤šã€‚ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾å•†å“ product_123 çš„å½“å‰åº“å­˜æ˜¯ 10ï¼Œç°åœ¨æœ‰ä¸€æ¬¡è´­ä¹°æ“ä½œï¼Œåº“å­˜å‡ 1ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–° Redis ä¸­çš„åº“å­˜ä¿¡æ¯ã€‚

```java
product_id = "product_123"
# å‡è®¾è¿™æ˜¯è´­ä¹°æ“ä½œåçš„æ–°åº“å­˜å€¼
new_stock = 9

# æ›´æ–°Redisä¸­çš„åº“å­˜ä¿¡æ¯
redis.set(product_id, new_stock)
```

æ›´æ–°æ“ä½œè‡³å°‘æ¶‰åŠåˆ°ä¸¤ä¸ªæ­¥éª¤ï¼šè®¡ç®—æ–°çš„åº“å­˜å€¼å’Œæ›´æ–° Redis ä¸­çš„åº“å­˜å€¼ã€‚

å‡å¦‚æ˜¯ç›´æ¥åˆ é™¤æ“ä½œï¼Œç›´æ¥å°±ä¸€æ­¥åˆ°ä½äº†ï¼š

```java
product_id = "product_123"

# åˆ é™¤Redisä¸­çš„åº“å­˜ç¼“å­˜
redis.del(product_id)
```

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šåˆ é™¤ç¼“å­˜å’Œæ›´æ–°ç¼“å­˜](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-ebad0a67-3012-4466-a4dc-e834104c48f8.png)

å‡å¦‚æ˜¯æ›´æ–°ç¼“å­˜ï¼Œé‚£ä¹ˆå¯èƒ½è¯·æ±‚ A æ›´æ–°å®Œ MySQL ååœ¨æ›´æ–° Redis ä¸­ï¼Œè¯·æ±‚ B å·²ç»è¯»å–åˆ° Redis ä¸­çš„æ—§å€¼è¿”å›äº†ï¼Œåˆä¸€æ¬¡å¯¼è‡´äº†ç¼“å­˜å’Œæ•°æ®åº“ä¸ä¸€è‡´ã€‚

#### é‚£å†è¯´è¯´ä¸ºä»€ä¹ˆè¦å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜

å› ä¸ºæ›´æ–°æ•°æ®åº“çš„é€Ÿåº¦æ¯”åˆ é™¤ç¼“å­˜çš„é€Ÿåº¦è¦æ…¢å¾—å¤šã€‚å› ä¸ºæ›´æ–° MySQL æ˜¯ç£ç›˜ IO æ“ä½œï¼Œè€Œ Redis æ˜¯å†…å­˜æ“ä½œã€‚å†…å­˜æ“ä½œæ¯”ç£ç›˜ IO å¿«å¾—å¤šï¼ˆè¿™æ˜¯ç¡¬ä»¶å±‚é¢çš„å¤©ç„¶å·®è·ï¼‰ã€‚

é‚£å‡å¦‚æ˜¯å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼Œå°±ä¼šé€ æˆè¿™æ ·çš„æƒ…å†µï¼š

ç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œæ•°æ®åº“åˆæ²¡æœ‰å®Œæˆæ›´æ–°ï¼Œæ­¤æ—¶æœ‰è¯·æ±‚è¿›æ¥è¯»å–æ•°æ®ï¼Œå¹¶å†™å…¥åˆ°ç¼“å­˜ï¼Œé‚£ä¹ˆåœ¨æ›´æ–°å®Œç¼“å­˜åï¼Œç¼“å­˜ä¸­è¿™ä¸ª key å°±æˆäº†ä¸€ä¸ªè„æ•°æ®ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå…ˆæ›´æ•°æ®åº“è¿˜æ˜¯å…ˆåˆ ç¼“å­˜](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-5c929a9e-a723-43b3-8f3c-f22c83765f9d.png)

ç›®å‰æœ€æµè¡Œçš„ç¼“å­˜è¯»å†™ç­–ç•¥ Cache Aside Patternï¼ˆ[æ—è·¯ç¼“å­˜æ¨¡å¼](https://coolshell.cn/articles/17416.html)ï¼‰å°±æ˜¯é‡‡ç”¨çš„å…ˆå†™æ•°æ®åº“ï¼Œå†åˆ ç¼“å­˜çš„æ–¹å¼ã€‚

- å¤±æ•ˆï¼šåº”ç”¨ç¨‹åºå…ˆä»ç¼“å­˜è¯»å–æ•°æ®ï¼Œå¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œå†ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®ï¼ŒæˆåŠŸåï¼Œæ”¾å…¥ç¼“å­˜ã€‚
- å‘½ä¸­ï¼šåº”ç”¨ç¨‹åºä»ç¼“å­˜è¯»å–æ•°æ®ï¼Œå¦‚æœæ•°æ®å­˜åœ¨ï¼Œç›´æ¥è¿”å›ã€‚
- æ›´æ–°ï¼šå…ˆæŠŠæ•°æ®å†™å…¥æ•°æ®åº“ï¼ŒæˆåŠŸåï¼Œå†è®©ç¼“å­˜å¤±æ•ˆã€‚

![å·¦è€³æœµè€—å­ï¼šCache Aside Pattern](https://cdn.tobebetterjavaer.com/stutymore/redis-20240325224814.png)

#### é‚£å‡å¦‚å¯¹ä¸€è‡´æ€§è¦æ±‚å¾ˆé«˜ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®ä¸ä¸€è‡´çš„åŸå› ï¼Œå¸¸è§çš„æœ‰ä¸¤ç§ï¼š

- ç¼“å­˜åˆ é™¤å¤±è´¥
- å¹¶å‘å¯¼è‡´å†™å…¥äº†è„æ•°æ®

é‚£é€šå¸¸æœ‰å››ç§æ–¹æ¡ˆå¯ä»¥è§£å†³ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/redis-20240325225250.png)

**â‘ ã€å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯ç¼“å­˜è¢«åˆ é™¤**

ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚ Kafkaã€RabbitMQï¼‰ä¿è¯æ•°æ®åº“æ›´æ–°å’Œç¼“å­˜æ›´æ–°ä¹‹é—´çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚å½“æ•°æ®åº“æ›´æ–°å®Œæˆåï¼Œå°†æ›´æ–°äº‹ä»¶å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ã€‚æœ‰ä¸“é—¨çš„æœåŠ¡ç›‘å¬è¿™äº›äº‹ä»¶å¹¶è´Ÿè´£æ›´æ–°æˆ–åˆ é™¤ç¼“å­˜ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ¶ˆæ¯é˜Ÿåˆ—ä¿è¯keyè¢«åˆ é™¤](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e4a61193-515a-409f-a436-2733abc3a86e.png)

è¿™ç§æ–¹æ¡ˆå¾ˆä¸é”™ï¼Œç¼ºç‚¹æ˜¯å¯¹ä¸šåŠ¡ä»£ç æœ‰ä¸€å®šçš„ä¾µå…¥ï¼Œæ¯•ç«Ÿå¼•å…¥äº†æ¶ˆæ¯é˜Ÿåˆ—å˜›ã€‚

**â‘¡ã€æ•°æ®åº“è®¢é˜…+æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯ç¼“å­˜è¢«åˆ é™¤**

å¯ä»¥ä¸“é—¨èµ·ä¸€ä¸ªæœåŠ¡ï¼ˆæ¯”å¦‚ [Canal](https://github.com/alibaba/canal)ï¼Œé˜¿é‡Œå·´å·´ MySQL binlog å¢é‡è®¢é˜…&æ¶ˆè´¹ç»„ä»¶ï¼‰å»ç›‘å¬ MySQL çš„ binlogï¼Œè·å–éœ€è¦æ“ä½œçš„æ•°æ®ã€‚

![æŠ€æœ¯æ´¾æ•™ç¨‹](https://cdn.tobebetterjavaer.com/stutymore/redis-20240325225809.png)

ç„¶åç”¨ä¸€ä¸ªå…¬å…±çš„æœåŠ¡è·å–è®¢é˜…ç¨‹åºä¼ æ¥çš„ä¿¡æ¯ï¼Œè¿›è¡Œç¼“å­˜åˆ é™¤ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ•°æ®åº“è®¢é˜…+æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯keyè¢«åˆ é™¤](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-37c07418-9cd8-43d9-90e7-0cb43b329025.png)

è¿™ç§æ–¹å¼è™½ç„¶é™ä½äº†å¯¹ä¸šåŠ¡çš„ä¾µå…¥ï¼Œä½†å¢åŠ äº†æ•´ä¸ªç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œé€‚åˆåŸºå»ºå®Œå–„çš„å¤§å‚ã€‚

**â‘¢ã€å»¶æ—¶åŒåˆ é˜²æ­¢è„æ•°æ®**

ç®€å•è¯´ï¼Œå°±æ˜¯åœ¨ç¬¬ä¸€æ¬¡åˆ é™¤ç¼“å­˜ä¹‹åï¼Œè¿‡ä¸€æ®µæ—¶é—´ä¹‹åï¼Œå†æ¬¡åˆ é™¤ç¼“å­˜ã€‚

ä¸»è¦é’ˆå¯¹ç¼“å­˜ä¸å­˜åœ¨ï¼Œä½†å†™å…¥äº†è„æ•°æ®çš„æƒ…å†µã€‚åœ¨å…ˆåˆ ç¼“å­˜ï¼Œå†å†™æ•°æ®åº“çš„æ›´æ–°ç­–ç•¥ä¸‹å‘ç”Ÿçš„æ¯”è¾ƒå¤šã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå»¶æ—¶åŒåˆ ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-fab24753-9c53-4432-9413-5feba07ae1e3.png)

è¿™ç§æ–¹å¼çš„å»¶æ—¶æ—¶é—´éœ€è¦ä»”ç»†è€ƒé‡å’Œæµ‹è¯•ã€‚

**â‘£ï¼šè®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´å…œåº•**

è¿™æ˜¯ä¸€ä¸ªæœ´ç´ ä½†æœ‰ç”¨çš„å…œåº•ç­–ç•¥ï¼Œç»™ç¼“å­˜è®¾ç½®ä¸€ä¸ªåˆç†çš„è¿‡æœŸæ—¶é—´ï¼Œå³ä½¿å‘ç”Ÿäº†ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œä¹Ÿä¸ä¼šæ°¸è¿œä¸ä¸€è‡´ä¸‹å»ï¼Œç¼“å­˜è¿‡æœŸåï¼Œè‡ªç„¶å°±ä¸€è‡´äº†ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„åä¸ºé¢ç»åŒå­¦ 8 æŠ€æœ¯äºŒé¢é¢è¯•åŸé¢˜ï¼šæ€æ ·ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Ÿ
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 23 QQ åå°æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šæ•°æ®ä¸€è‡´æ€§é—®é¢˜
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¾®ä¼—é“¶è¡ŒåŒå­¦ 1 Java åç«¯ä¸€é¢çš„åŸé¢˜ï¼šMySQL å’Œç¼“å­˜ä¸€è‡´æ€§é—®é¢˜äº†è§£å—ï¼Ÿ

### 29.å¦‚ä½•ä¿è¯æœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜çš„ä¸€è‡´ï¼Ÿ

åœ¨[æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®](https://javabetter.cn/zhishixingqiu/paicoding.html)ä¸­ï¼Œå°±é‡‡ç”¨äº†æœ¬åœ°ç¼“å­˜ Caffeineï¼ˆæˆ–è€… Guava Cacheï¼‰ + Redis ç¼“å­˜çš„ç­–ç•¥ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå»¶æ—¶åŒåˆ ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-6d4ab7e6-8337-4576-bbf0-79202a1c3331.png)

å½“æ•°æ®åº“å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæˆ‘ä»¬ç›´æ¥åˆ é™¤ Redis ç¼“å­˜ä¸­çš„ key å°±å¯ä»¥äº†ï¼Œå› ä¸ºä¸‹ä¸€æ¬¡è¯·æ±‚ä¼šå°†æ•°æ®åº“åŒæ­¥åˆ° Redis ç¼“å­˜ä¸­ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæœ¬åœ°ç¼“å­˜/åˆ†å¸ƒå¼ç¼“å­˜ä¿æŒä¸€è‡´](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-20c15f0d-fb3c-4922-94b1-edcd856658be.png)

é‚£ä¸ºäº†ä¿è¯æœ¬åœ°ç¼“å­˜å’Œ Redis ç¼“å­˜çš„ä¸€è‡´æ€§ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨çš„ç­–ç•¥æœ‰ï¼š

â‘ ã€è®¾ç½®æœ¬åœ°ç¼“å­˜çš„è¿‡æœŸæ—¶é—´ï¼Œè¿™æ˜¯æœ€ç®€å•ä¹Ÿæ˜¯æœ€ç›´æ¥çš„æ–¹æ³•ï¼Œå½“æœ¬åœ°ç¼“å­˜è¿‡æœŸæ—¶ï¼Œå°±ä» Redis ç¼“å­˜ä¸­å»åŒæ­¥ã€‚

â‘¡ã€ä½¿ç”¨ Redis çš„ Pub/Sub æœºåˆ¶ï¼Œå½“ Redis ç¼“å­˜å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå‘å¸ƒä¸€ä¸ªæ¶ˆæ¯ï¼Œæœ¬åœ°ç¼“å­˜è®¢é˜…è¿™ä¸ªæ¶ˆæ¯ï¼Œç„¶ååˆ é™¤å¯¹åº”çš„æœ¬åœ°ç¼“å­˜ã€‚

â‘¢ã€Redis ç¼“å­˜å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¯”å¦‚ RocketMQã€RabbitMQ å»æ›´æ–°æœ¬åœ°ç¼“å­˜ã€‚

åœ¨æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† CacheBuilder æ¥å®Œæˆ Guava Cache çš„æ„å»ºï¼Œåƒä¸€äº›ç®€å•çš„ç¼“å­˜åœºæ™¯ï¼Œæ¯”å¦‚è¯´è·å–èœå•åˆ†ç±»ã€è·å–ç™»å½•éªŒè¯ç ã€è·å–ç”¨æˆ·è½¬å­˜å›¾ç‰‡ç­‰ï¼Œéƒ½ä½¿ç”¨äº† Guava Cacheã€‚

![æŠ€æœ¯æ´¾æ•™ç¨‹ï¼šGuava](https://cdn.tobebetterjavaer.com/stutymore/redis-20240507105407.png)

åƒé¦–é¡µä¾§è¾¹æ ã€ä¸“æ ä¾§è¾¹æ ã€æ–‡ç« è¯¦æƒ…ä¾§è¾¹æ ç­‰ç¼“å­˜åœºæ™¯ï¼Œä½¿ç”¨äº† Caffeine ä½œä¸ºæœ¬åœ°ç¼“å­˜ï¼Œä»£ç æ˜¯é€šè¿‡ @Cacheableã€@CacheEvitã€@CachePut ç­‰æ³¨è§£å®ç°çš„ã€‚

![æŠ€æœ¯æ´¾æ•™ç¨‹ï¼šCaffeine](https://cdn.tobebetterjavaer.com/stutymore/redis-20240507110254.png)

åƒç”¨æˆ· Session å’Œç½‘ç«™åœ°å›¾ SiteMap ç­‰ç¼“å­˜åœºæ™¯ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨äº† Redis æ¥ä½œä¸ºç¼“å­˜ã€‚

![æŠ€æœ¯æ´¾æ•™ç¨‹ï¼šRedis](https://cdn.tobebetterjavaer.com/stutymore/redis-20240507110652.png)

#### å¦‚æœåœ¨é¡¹ç›®ä¸­å¤šä¸ªåœ°æ–¹éƒ½è¦ä½¿ç”¨åˆ°äºŒçº§ç¼“å­˜çš„é€»è¾‘ï¼Œå¦‚ä½•è®¾è®¡è¿™ä¸€å—ï¼Ÿ

åœ¨è®¾è®¡æ—¶ï¼Œåº”è¯¥æ¸…æ¥šåœ°åŒºåˆ†ä½•æ—¶ä½¿ç”¨ä¸€çº§ç¼“å­˜å’Œä½•æ—¶ä½¿ç”¨äºŒçº§ç¼“å­˜ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¯¹äºé¢‘ç¹è®¿é—®ä½†ä¸ç»å¸¸æ›´æ”¹çš„æ•°æ®ï¼Œå¯ä»¥æ”¾åœ¨æœ¬åœ°ç¼“å­˜ä¸­ä»¥æä¾›æœ€å¿«çš„è®¿é—®é€Ÿåº¦ã€‚è€Œå¯¹äºéœ€è¦å…±äº«æˆ–è€…ä¸€è‡´æ€§è¦æ±‚è¾ƒé«˜çš„æ•°æ®ï¼Œåº”å½“æ”¾åœ¨ä¸€çº§ç¼“å­˜ä¸­ã€‚

#### æœ¬åœ°ç¼“å­˜å’ŒRedisç¼“å­˜çš„åŒºåˆ«å’Œæ•ˆç‡å¯¹æ¯”ï¼Ÿ

Redis å¯ä»¥éƒ¨ç½²åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ”¯æŒæ•°æ®åˆ†ç‰‡ï¼Œé€‚ç”¨äºè·¨æœåŠ¡å™¨çš„ç¼“å­˜å…±äº«ã€‚è€Œæœ¬åœ°ç¼“å­˜åªèƒ½åœ¨å•ä¸ªæœåŠ¡å™¨ä¸Šä½¿ç”¨ã€‚

Redis è¿˜å¯ä»¥æŒä¹…åŒ–æ•°æ®ï¼Œæ”¯æŒæ•°æ®å¤‡ä»½å’Œæ¢å¤ï¼Œé€‚ç”¨äºå¯¹æ•°æ®å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ã€‚å¹¶ä¸”æ”¯æŒå‘å¸ƒ/è®¢é˜…ã€äº‹åŠ¡ã€Lua è„šæœ¬ç­‰é«˜çº§åŠŸèƒ½ã€‚

æ•ˆç‡ä¸Šï¼ŒRedis å’Œæœ¬åœ°ç¼“å­˜éƒ½æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè¯»å†™é€Ÿåº¦éƒ½éå¸¸å¿«ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å­—èŠ‚è·³åŠ¨åŒå­¦ 7 Java åç«¯å®ä¹ ä¸€é¢çš„åŸé¢˜ï¼šæ€ä¹ˆä¿è¯äºŒçº§ç¼“å­˜å’Œ Redis ç¼“å­˜çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„åä¸ºé¢ç»åŒå­¦ 11 é¢è¯•åŸé¢˜ï¼šä½¿ç”¨çš„guava cacheå’Œredisæ˜¯å¦‚ä½•ç»„åˆä½¿ç”¨çš„ï¼Ÿå¦‚æœåœ¨é¡¹ç›®ä¸­å¤šä¸ªåœ°æ–¹éƒ½è¦ä½¿ç”¨åˆ°äºŒçº§ç¼“å­˜çš„é€»è¾‘ï¼Œå¦‚ä½•è®¾è®¡è¿™ä¸€å—ï¼Ÿ
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å»å“ªå„¿åŒå­¦ 1  æŠ€æœ¯äºŒé¢çš„åŸé¢˜ï¼šrediså’Œæœ¬åœ°ç¼“å­˜çš„åŒºåˆ«ï¼Œå“ªä¸ªæ•ˆç‡é«˜

### 30.æ€ä¹ˆå¤„ç†çƒ­ keyï¼Ÿ

æ¨èé˜…è¯»ï¼š

- [é˜¿é‡Œï¼šå‘ç°å¹¶å¤„ç† Redis çš„å¤§ Key å’Œçƒ­ Key](https://help.aliyun.com/zh/redis/user-guide/identify-and-handle-large-keys-and-hotkeys)
- [è‘£å®—ç£Šï¼šRedis çƒ­ Key å‘ç°ä»¥åŠè§£å†³åŠæ³•](https://dongzl.github.io/2021/01/14/03-Redis-Hot-Key/index.html)

æ‰€è°“çš„çƒ­ keyï¼Œå°±æ˜¯æŒ‡åœ¨å¾ˆçŸ­æ—¶é—´å†…è¢«é¢‘ç¹è®¿é—®çš„é”®ã€‚

æ¯”å¦‚ï¼Œçƒ­é—¨æ–°é—»æˆ–çƒ­é—¨å•†å“ï¼Œè¿™ç±» key é€šå¸¸ä¼šæœ‰å¤§æµé‡çš„è®¿é—®ï¼Œå¯¹å­˜å‚¨è¿™ç±»ä¿¡æ¯çš„ Redis æ¥è¯´ï¼Œæ˜¯ä¸å°çš„å‹åŠ›ã€‚

> æŸå¤©æŸæµé‡æ˜æ˜Ÿçªç„¶çˆ†å‡ºä¸€ä¸ªå¤§ç“œï¼Œå¾®åšçªç„¶å°±å´©äº†ï¼Œè¿™å°±æ˜¯çƒ­ key çš„å‹åŠ›ã€‚

å†æ¯”å¦‚è¯´ Redis æ˜¯é›†ç¾¤éƒ¨ç½²ï¼Œçƒ­ key å¯èƒ½ä¼šé€ æˆæ•´ä½“æµé‡çš„ä¸å‡è¡¡ï¼ˆç½‘ç»œå¸¦å®½ã€CPU å’Œå†…å­˜èµ„æºï¼‰ï¼Œä¸ªåˆ«èŠ‚ç‚¹å‡ºç° OPS è¿‡å¤§çš„æƒ…å†µï¼Œæç«¯æƒ…å†µä¸‹çƒ­ç‚¹ key ç”šè‡³ä¼šè¶…è¿‡ Redis æœ¬èº«èƒ½å¤Ÿæ‰¿å—çš„ OPSã€‚

> OPSï¼ˆOperations Per Secondï¼‰æ˜¯ Redis çš„ä¸€ä¸ªé‡è¦æŒ‡æ ‡ï¼Œè¡¨ç¤º Redis æ¯ç§’é’Ÿèƒ½å¤Ÿå¤„ç†çš„å‘½ä»¤æ•°ã€‚

é€šå¸¸ä»¥ Key è¢«è¯·æ±‚çš„é¢‘ç‡æ¥åˆ¤å®šï¼Œæ¯”å¦‚ï¼š

- **QPS é›†ä¸­åœ¨ç‰¹å®šçš„ Key**ï¼šæ€»çš„ QPSï¼ˆæ¯ç§’æŸ¥è¯¢ç‡ï¼‰ä¸º 10000ï¼Œå…¶ä¸­ä¸€ä¸ª Key çš„ QPS é£™åˆ°äº† 8000ã€‚
- **å¸¦å®½ä½¿ç”¨ç‡é›†ä¸­åœ¨ç‰¹å®šçš„ Key**ï¼šä¸€ä¸ªæ‹¥æœ‰ä¸Šåƒæˆå‘˜ä¸”æ€»å¤§å°ä¸º 1M çš„å“ˆå¸Œ Keyï¼Œæ¯ç§’å‘é€å¤§é‡çš„ HGETALL è¯·æ±‚ã€‚
- **CPU ä½¿ç”¨ç‡é›†ä¸­åœ¨ç‰¹å®šçš„ Key**ï¼šä¸€ä¸ªæ‹¥æœ‰æ•°ä¸‡ä¸ªæˆå‘˜çš„ ZSET Keyï¼Œæ¯ç§’å‘é€å¤§é‡çš„ ZRANGE è¯·æ±‚ã€‚

> - HGETALL å‘½ä»¤ç”¨äºè¿”å›å“ˆå¸Œè¡¨ä¸­ï¼Œæ‰€æœ‰çš„å­—æ®µå’Œå€¼ã€‚
> - ZRANGE å‘½ä»¤ç”¨äºè¿”å›æœ‰åºé›†ä¸­ï¼ŒæŒ‡å®šåŒºé—´å†…çš„æˆå‘˜ã€‚

#### æ€ä¹ˆå¤„ç†çƒ­ keyï¼Ÿ

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šçƒ­keyå¤„ç†](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-6fa972ec-5531-48f2-a608-4465d79d4518.png)

å¯¹çƒ­ key çš„å¤„ç†ï¼Œæœ€å…³é”®çš„æ˜¯å¯¹çƒ­ key çš„ç›‘æ§:

â‘ ã€å®¢æˆ·ç«¯

å®¢æˆ·ç«¯å…¶å®æ˜¯è·ç¦» keyâ€œæœ€è¿‘â€çš„åœ°æ–¹ï¼Œå› ä¸º Redis å‘½ä»¤å°±æ˜¯ä»å®¢æˆ·ç«¯å‘å‡ºçš„ï¼Œä¾‹å¦‚åœ¨å®¢æˆ·ç«¯è®¾ç½®å…¨å±€å­—å…¸ï¼ˆkey å’Œè°ƒç”¨æ¬¡æ•°ï¼‰ï¼Œæ¯æ¬¡è°ƒç”¨ Redis å‘½ä»¤æ—¶ï¼Œä½¿ç”¨è¿™ä¸ªå­—å…¸è¿›è¡Œè®°å½•ã€‚

â‘¡ã€ä»£ç†ç«¯

åƒ Twemproxyã€Codis è¿™äº›åŸºäºä»£ç†çš„ Redis åˆ†å¸ƒå¼æ¶æ„ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯çš„è¯·æ±‚éƒ½æ˜¯é€šè¿‡ä»£ç†ç«¯å®Œæˆçš„ï¼Œå¯ä»¥åœ¨ä»£ç†ç«¯è¿›è¡Œç›‘æ§ã€‚

â‘¢ã€Redis æœåŠ¡ç«¯

ä½¿ç”¨ monitor å‘½ä»¤ç»Ÿè®¡çƒ­ç‚¹ key æ˜¯å¾ˆå¤šå¼€å‘å’Œè¿ç»´äººå‘˜é¦–å…ˆæƒ³åˆ°çš„æ–¹æ¡ˆï¼Œmonitor å‘½ä»¤å¯ä»¥ç›‘æ§åˆ° Redis æ‰§è¡Œçš„æ‰€æœ‰å‘½ä»¤ã€‚

> monitor å‘½ä»¤çš„ä½¿ç”¨ï¼š`redis-cli monitor`

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šmonitor](https://cdn.tobebetterjavaer.com/stutymore/redis-20240309085135.png)

è¿˜å¯ä»¥é€šè¿‡ bigkeys å‚æ•°æ¥åˆ†æçƒ­ Keyã€‚

> bigkeys å‘½ä»¤çš„ä½¿ç”¨ï¼š`redis-cli --bigkeys`

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šbigkeys](https://cdn.tobebetterjavaer.com/stutymore/redis-20240309090340.png)

åªè¦ç›‘æ§åˆ°äº†çƒ­ keyï¼Œå¯¹çƒ­ key çš„å¤„ç†å°±ç®€å•äº†ï¼š

â‘ ã€æŠŠçƒ­ key æ‰“æ•£åˆ°ä¸åŒçš„æœåŠ¡å™¨ï¼Œé™ä½å‹â¼’ã€‚

åŸºæœ¬æ€è·¯å°±æ˜¯ç»™çƒ­ Key åŠ ä¸Šå‰ç¼€æˆ–è€…åç¼€ï¼Œè§ä¸‹ä¾‹ï¼š

```java
// N ä¸º Redis å®ä¾‹ä¸ªæ•°ï¼ŒM ä¸º N çš„ 2å€
const M = N * 2
//ç”Ÿæˆéšæœºæ•°
random = GenRandom(0, M)
//æ„é€ å¤‡ä»½æ–° Key
bakHotKey = hotKey + "_" + random
data = redis.GET(bakHotKey)
if data == NULL {
    data = redis.GET(hotKey)
    if data == NULL {
        data = GetFromDB()
        // å¯ä»¥åˆ©ç”¨åŸå­é”æ¥å†™å…¥æ•°æ®ä¿è¯æ•°æ®ä¸€è‡´æ€§
        redis.SET(hotKey, data, expireTime)
        redis.SET(bakHotKey, data, expireTime + GenRandom(0, 5))
    } else {
        redis.SET(bakHotKey, data, expireTime + GenRandom(0, 5))
    }
}
```

â‘¡ã€åŠ â¼Šâ¼†çº§ç¼“å­˜ï¼Œå½“å‡ºç°çƒ­ Key åï¼ŒæŠŠçƒ­ Key åŠ è½½åˆ° JVM ä¸­ï¼Œåç»­é’ˆå¯¹è¿™äº›çƒ­ Key çš„è¯·æ±‚ï¼Œç›´æ¥ä» JVM ä¸­è¯»å–ã€‚

è¿™äº›æœ¬åœ°çš„ç¼“å­˜å·¥å…·æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ Caffeineã€Guava ç­‰ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ HashMap ä½œä¸ºæœ¬åœ°ç¼“å­˜éƒ½æ˜¯å¯ä»¥çš„ã€‚

æ³¨æ„ï¼Œå¦‚æœå¯¹çƒ­ Key è¿›è¡Œæœ¬åœ°ç¼“å­˜ï¼Œéœ€è¦é˜²æ­¢æœ¬åœ°ç¼“å­˜è¿‡å¤§ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„åä¸º OD çš„é¢è¯•ä¸­å‡ºç°è¿‡è¯¥é¢˜ï¼šè®²ä¸€è®² Redis çš„çƒ­ Key å’Œå¤§ Key

### 31.ç¼“å­˜é¢„çƒ­æ€ä¹ˆåšå‘¢ï¼Ÿ

ç¼“å­˜é¢„çƒ­æ˜¯æŒ‡åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œæå‰å°†ä¸€äº›é¢„å®šä¹‰çš„æ•°æ®åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œä»¥é¿å…åœ¨ç³»ç»Ÿè¿è¡ŒåˆæœŸç”±äºç¼“å­˜æœªå‘½ä¸­ï¼ˆcache missï¼‰å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€‚

é€šè¿‡ç¼“å­˜é¢„çƒ­ï¼Œå¯ä»¥ç¡®ä¿ç³»ç»Ÿåœ¨ä¸Šçº¿åèƒ½å¤Ÿç«‹å³æä¾›é«˜æ•ˆçš„æœåŠ¡ï¼Œå‡å°‘é¦–æ¬¡è®¿é—®æ—¶çš„å»¶è¿Ÿã€‚

ç¼“å­˜é¢„çƒ­çš„æ–¹æ³•æœ‰å¤šç§ï¼Œåœ¨[æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®](https://javabetter.cn/zhishixingqiu/paicoding.html)ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†é¡¹ç›®å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½å’Œå®šæ—¶é¢„çƒ­ä¸¤ç§æ–¹å¼ï¼Œæ¯”å¦‚è¯´æ¯å¤©å®šæ—¶æ›´æ–°ç«™ç‚¹åœ°å›¾åˆ° Redis ç¼“å­˜ä¸­ã€‚

```java
/**
 * é‡‡ç”¨å®šæ—¶å™¨æ–¹æ¡ˆï¼Œæ¯å¤©5:15åˆ†åˆ·æ–°ç«™ç‚¹åœ°å›¾ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§
 */
@Scheduled(cron = "0 15 5 * * ?")
public void autoRefreshCache() {
    log.info("å¼€å§‹åˆ·æ–°sitemap.xmlçš„urlåœ°å€ï¼Œé¿å…å‡ºç°æ•°æ®ä¸ä¸€è‡´é—®é¢˜!");
    refreshSitemap();
    log.info("åˆ·æ–°å®Œæˆï¼");
}

@Override
public void refreshSitemap() {
    initSiteMap();
}

private synchronized void initSiteMap() {
    long lastId = 0L;
    RedisClient.del(SITE_MAP_CACHE_KEY);
    while (true) {
        List<SimpleArticleDTO> list = articleDao.getBaseMapper().listArticlesOrderById(lastId, SCAN_SIZE);

        // åˆ·æ–°ç«™ç‚¹åœ°å›¾ä¿¡æ¯
        Map<String, Long> map = list.stream().collect(Collectors.toMap(s -> String.valueOf(s.getId()), s -> s.getCreateTime().getTime(), (a, b) -> a));
        RedisClient.hMSet(SITE_MAP_CACHE_KEY, map);
        if (list.size() < SCAN_SIZE) {
            break;
        }
        lastId = list.get(list.size() - 1).getId();
    }
}
```


> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 1 æŠ€æœ¯äºŒé¢é¢è¯•åŸé¢˜ï¼šä»€ä¹ˆæ˜¯ç¼“å­˜é¢„çƒ­ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ

### 32.çƒ­ç‚¹ key é‡å»ºï¼Ÿé—®é¢˜ï¼Ÿè§£å†³ï¼Ÿ

å¼€å‘çš„æ—¶å€™ä¸€èˆ¬ä½¿ç”¨â€œç¼“å­˜+è¿‡æœŸæ—¶é—´â€çš„ç­–ç•¥ï¼Œæ—¢å¯ä»¥åŠ é€Ÿæ•°æ®è¯»å†™ï¼Œåˆä¿è¯æ•°æ®çš„å®šæœŸæ›´æ–°ï¼Œè¿™ç§æ¨¡å¼åŸºæœ¬èƒ½å¤Ÿæ»¡è¶³ç»å¤§éƒ¨åˆ†éœ€æ±‚ã€‚

ä½†æ˜¯æœ‰ä¸¤ä¸ªé—®é¢˜å¦‚æœåŒæ—¶å‡ºç°ï¼Œå¯èƒ½å°±ä¼šå‡ºç°æ¯”è¾ƒå¤§çš„é—®é¢˜ï¼š

- å½“å‰ key æ˜¯ä¸€ä¸ªçƒ­ç‚¹ keyï¼ˆä¾‹å¦‚ä¸€ä¸ªçƒ­é—¨çš„å¨±ä¹æ–°é—»ï¼‰ï¼Œå¹¶å‘é‡éå¸¸å¤§ã€‚

- é‡å»ºç¼“å­˜ä¸èƒ½åœ¨çŸ­æ—¶é—´å®Œæˆï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªå¤æ‚è®¡ç®—ï¼Œä¾‹å¦‚å¤æ‚çš„ SQLã€å¤šæ¬¡ IOã€å¤šä¸ªä¾èµ–ç­‰ã€‚ åœ¨ç¼“å­˜å¤±æ•ˆçš„ç¬é—´ï¼Œæœ‰å¤§é‡çº¿ç¨‹æ¥é‡å»ºç¼“å­˜ï¼Œé€ æˆåç«¯è´Ÿè½½åŠ å¤§ï¼Œç”šè‡³å¯èƒ½ä¼šè®©åº”ç”¨å´©æºƒã€‚

> **æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ**

è¦è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿä¸æ˜¯å¾ˆå¤æ‚ï¼Œè§£å†³é—®é¢˜çš„è¦ç‚¹åœ¨äºï¼š

- å‡å°‘é‡å»ºç¼“å­˜çš„æ¬¡æ•°ã€‚
- æ•°æ®å°½å¯èƒ½ä¸€è‡´ã€‚
- è¾ƒå°‘çš„æ½œåœ¨å±é™©ã€‚

æ‰€ä»¥ä¸€èˆ¬é‡‡ç”¨å¦‚ä¸‹æ–¹å¼ï¼š

1.  äº’æ–¥é”ï¼ˆmutex keyï¼‰
    è¿™ç§æ–¹æ³•åªå…è®¸ä¸€ä¸ªçº¿ç¨‹é‡å»ºç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…é‡å»ºç¼“å­˜çš„çº¿ç¨‹æ‰§è¡Œå®Œï¼Œé‡æ–°ä»ç¼“å­˜è·å–æ•°æ®å³å¯ã€‚
2.  æ°¸è¿œä¸è¿‡æœŸ
    â€œæ°¸è¿œä¸è¿‡æœŸâ€åŒ…å«ä¸¤å±‚æ„æ€ï¼š

- ä»ç¼“å­˜å±‚é¢æ¥çœ‹ï¼Œç¡®å®æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°çƒ­ç‚¹ key è¿‡æœŸåäº§ç”Ÿçš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯â€œç‰©ç†â€ä¸è¿‡æœŸã€‚
- ä»åŠŸèƒ½å±‚é¢æ¥çœ‹ï¼Œä¸ºæ¯ä¸ª value è®¾ç½®ä¸€ä¸ªé€»è¾‘è¿‡æœŸæ—¶é—´ï¼Œå½“å‘ç°è¶…è¿‡é€»è¾‘è¿‡æœŸæ—¶é—´åï¼Œä¼šä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹å»æ„å»ºç¼“å­˜ã€‚

### 33.æ— åº•æ´é—®é¢˜å—ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ

> **ä»€ä¹ˆæ˜¯æ— åº•æ´é—®é¢˜ï¼Ÿ**

2010 å¹´ï¼ŒFacebook çš„ Memcache èŠ‚ç‚¹å·²ç»è¾¾åˆ°äº† 3000 ä¸ªï¼Œæ‰¿è½½ç€ TB çº§åˆ«çš„ç¼“å­˜æ•°æ®ã€‚ä½†å¼€å‘å’Œè¿ç»´äººå‘˜å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºäº†æ»¡è¶³ä¸šåŠ¡è¦æ±‚æ·»åŠ äº†å¤§é‡æ–° Memcache èŠ‚ç‚¹ï¼Œä½†æ˜¯å‘ç°æ€§èƒ½ä¸ä½†æ²¡æœ‰å¥½è½¬åè€Œä¸‹é™äº†ï¼Œå½“æ—¶å°†è¿™ ç§ç°è±¡ç§°ä¸ºç¼“å­˜çš„â€œ**æ— åº•æ´**â€ç°è±¡ã€‚

é‚£ä¹ˆä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè¿™ç§ç°è±¡å‘¢?

é€šå¸¸æ¥è¯´æ·»åŠ èŠ‚ç‚¹ä½¿å¾— Memcache é›†ç¾¤ æ€§èƒ½åº”è¯¥æ›´å¼ºäº†ï¼Œä½†äº‹å®å¹¶éå¦‚æ­¤ã€‚é”®å€¼æ•°æ®åº“ç”±äºé€šå¸¸é‡‡ç”¨å“ˆå¸Œå‡½æ•°å°† key æ˜ å°„åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šï¼Œé€ æˆ key çš„åˆ†å¸ƒä¸ä¸šåŠ¡æ— å…³ï¼Œä½†æ˜¯ç”±äºæ•°æ®é‡å’Œè®¿é—®é‡çš„æŒç»­å¢é•¿ï¼Œé€ æˆéœ€è¦æ·»åŠ å¤§é‡èŠ‚ç‚¹åšæ°´å¹³æ‰©å®¹ï¼Œå¯¼è‡´é”®å€¼åˆ†å¸ƒåˆ°æ›´å¤šçš„ èŠ‚ç‚¹ä¸Šï¼Œæ‰€ä»¥æ— è®ºæ˜¯ Memcache è¿˜æ˜¯ Redis çš„åˆ†å¸ƒå¼ï¼Œæ‰¹é‡æ“ä½œé€šå¸¸éœ€è¦ä»ä¸åŒèŠ‚ç‚¹ä¸Šè·å–ï¼Œç›¸æ¯”äºå•æœºæ‰¹é‡æ“ä½œåªæ¶‰åŠä¸€æ¬¡ç½‘ç»œæ“ä½œï¼Œåˆ†å¸ƒå¼æ‰¹é‡æ“ä½œä¼šæ¶‰åŠå¤šæ¬¡ç½‘ç»œæ—¶é—´ã€‚

> **æ— åº•æ´é—®é¢˜å¦‚ä½•ä¼˜åŒ–å‘¢ï¼Ÿ**

å…ˆåˆ†æä¸€ä¸‹æ— åº•æ´é—®é¢˜ï¼š

- å®¢æˆ·ç«¯ä¸€æ¬¡æ‰¹é‡æ“ä½œä¼šæ¶‰åŠå¤šæ¬¡ç½‘ç»œæ“ä½œï¼Œä¹Ÿå°±æ„å‘³ç€æ‰¹é‡æ“ä½œä¼šéšç€èŠ‚ç‚¹çš„å¢å¤šï¼Œè€—æ—¶ä¼šä¸æ–­å¢å¤§ã€‚

- ç½‘ç»œè¿æ¥æ•°å˜å¤šï¼Œå¯¹èŠ‚ç‚¹çš„æ€§èƒ½ä¹Ÿæœ‰ä¸€å®šå½±å“ã€‚

å¸¸è§çš„ä¼˜åŒ–æ€è·¯å¦‚ä¸‹ï¼š

- å‘½ä»¤æœ¬èº«çš„ä¼˜åŒ–ï¼Œä¾‹å¦‚ä¼˜åŒ–æ“ä½œè¯­å¥ç­‰ã€‚

- å‡å°‘ç½‘ç»œé€šä¿¡æ¬¡æ•°ã€‚

- é™ä½æ¥å…¥æˆæœ¬ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯ä½¿ç”¨é•¿è¿/è¿æ¥æ± ã€NIO ç­‰ã€‚

GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹](https://javabetter.cn/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## Redis è¿ç»´

### 34.Redis æŠ¥å†…å­˜ä¸è¶³æ€ä¹ˆå¤„ç†ï¼Ÿ

Redis å†…å­˜ä¸è¶³æœ‰è¿™ä¹ˆå‡ ç§å¤„ç†æ–¹å¼ï¼š

- ä¿®æ”¹é…ç½®æ–‡ä»¶ redis.conf çš„ maxmemory å‚æ•°ï¼Œå¢åŠ  Redis å¯ç”¨å†…å­˜
- ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤ set maxmemory åŠ¨æ€è®¾ç½®å†…å­˜ä¸Šé™
- ä¿®æ”¹å†…å­˜æ·˜æ±°ç­–ç•¥ï¼ŒåŠæ—¶é‡Šæ”¾å†…å­˜ç©ºé—´
- ä½¿ç”¨ Redis é›†ç¾¤æ¨¡å¼ï¼Œè¿›è¡Œæ¨ªå‘æ‰©å®¹ã€‚

### 35.Redis çš„è¿‡æœŸæ•°æ®å›æ”¶ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ

Redis æ”¯æŒä¸ºé”®è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå½“é”®çš„è¿‡æœŸæ—¶é—´åˆ°è¾¾åï¼ŒRedis ä¼šè‡ªåŠ¨åˆ é™¤è¿™äº›é”®ã€‚è¿‡æœŸå›æ”¶ç­–ç•¥ä¸»è¦æœ‰ä¸¤ç§ï¼šæƒ°æ€§åˆ é™¤å’Œå®šæœŸåˆ é™¤ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šRedis çš„è¿‡æœŸæ·˜æ±°ç­–ç•¥](https://cdn.tobebetterjavaer.com/stutymore/redis-20240326214119.png)

#### ä»€ä¹ˆæ˜¯æƒ°æ€§åˆ é™¤ï¼Ÿ

å½“æŸä¸ªé”®è¢«è®¿é—®æ—¶ï¼Œå¦‚æœå‘ç°å®ƒå·²ç»è¿‡æœŸï¼ŒRedis ä¼šç«‹å³åˆ é™¤è¯¥é”®ã€‚è¿™æ„å‘³ç€å¦‚æœä¸€ä¸ªå·²è¿‡æœŸçš„é”®ä»æœªè¢«è®¿é—®ï¼Œå®ƒä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œå¯èƒ½ä¼šå ç”¨é¢å¤–çš„å†…å­˜ã€‚

#### ä»€ä¹ˆæ˜¯å®šæœŸåˆ é™¤ï¼Ÿ

Redis ä¼šå®šæœŸéšæœºæµ‹è¯•ä¸€äº›é”®ï¼Œå¹¶åˆ é™¤å…¶ä¸­å·²è¿‡æœŸçš„é”®ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯ Redis å†…éƒ¨è‡ªåŠ¨æ‰§è¡Œçš„ï¼Œæ—¨åœ¨å‡å°‘è¿‡æœŸé”®å¯¹å†…å­˜çš„å ç”¨ã€‚å¯ä»¥é€šè¿‡ `config get hz` å‘½ä»¤æŸ¥çœ‹å½“å‰çš„ hz å€¼ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šconfig get hz](https://cdn.tobebetterjavaer.com/stutymore/redis-20240326214800.png)

ç»“æœæ˜¾ç¤º hz çš„å€¼ä¸º "10"ã€‚è¿™æ„å‘³ç€ Redis æœåŠ¡å™¨æ¯ç§’æ‰§è¡Œå…¶å†…éƒ¨å®šæ—¶ä»»åŠ¡ï¼ˆå¦‚è¿‡æœŸé”®çš„æ¸…ç†ï¼‰çš„é¢‘ç‡æ˜¯ 10 æ¬¡ã€‚å¯ä»¥é€šè¿‡ `CONFIG SET hz 20` è¿›è¡Œè°ƒæ•´ï¼Œæˆ–è€…ç›´æ¥é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„ hz è®¾ç½®ã€‚

![äºŒå“¥æœ¬åœ° Redis çš„é…ç½®æ–‡ä»¶è·¯å¾„å’Œ hz çš„é»˜è®¤å€¼](https://cdn.tobebetterjavaer.com/stutymore/redis-20240326215240.png)

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 22 æš‘æœŸå®ä¹ ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis key åˆ é™¤ç­–ç•¥
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å»å“ªå„¿é¢ç»åŒå­¦ 1 æŠ€æœ¯ 2é¢é¢è¯•åŸé¢˜ï¼šrediså†…å­˜æ·˜æ±°å’Œè¿‡æœŸç­–ç•¥

### 36.Redis æœ‰å“ªäº›å†…å­˜æ·˜æ±°ç­–ç•¥ï¼Ÿ

å½“ Redis å†…å­˜ä½¿ç”¨è¾¾åˆ°è®¾ç½®çš„æœ€å¤§å€¼æ—¶ï¼ˆé€šè¿‡ maxmemory å‚æ•°è®¾ç½®ï¼‰ï¼Œå®ƒä¼šæ ¹æ®é…ç½®çš„å†…å­˜æ·˜æ±°ç­–ç•¥æ¥å†³å®šå¦‚ä½•å¤„ç†æ–°çš„å†™è¯·æ±‚ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRediså…­ç§å†…å­˜æº¢å‡ºæ§åˆ¶ç­–ç•¥](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-5be7405c-ee11-4d2b-bea4-9598f10a1b17.png)

Redis æä¾›äº†ä»¥ä¸‹å‡ ç§æ·˜æ±°ç­–ç•¥ï¼š

1. noevictionï¼šé»˜è®¤ç­–ç•¥ï¼Œä¸è¿›è¡Œä»»ä½•æ•°æ®æ·˜æ±°ï¼Œç›´æ¥è¿”å›é”™è¯¯ä¿¡æ¯ã€‚é€‚ç”¨äºä¸èƒ½ä¸¢å¤±æ•°æ®çš„åœºæ™¯ã€‚
2. volatile-lruï¼šä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­ï¼Œä½¿ç”¨ LRU ç®—æ³•æ·˜æ±°æœ€ä¸å¸¸ç”¨çš„é”®ã€‚
3. allkeys-lruï¼šä»æ‰€æœ‰é”®ä¸­ï¼Œä½¿ç”¨ LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ç®—æ³•æ·˜æ±°æœ€ä¸å¸¸ç”¨çš„é”®ã€‚é€‚ç”¨äºç¼“å­˜åœºæ™¯ï¼Œä¼˜å…ˆä¿ç•™æœ€è¿‘ä½¿ç”¨çš„æ•°æ®ã€‚
4. allkeys-randomï¼šä»æ‰€æœ‰é”®ä¸­éšæœºæ·˜æ±°é”®ã€‚
5. volatile-randomï¼šä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­éšæœºæ·˜æ±°é”®ã€‚
6. volatile-ttlï¼šä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­æ·˜æ±°å³å°†è¿‡æœŸï¼ˆTTLï¼ŒTime To Liveï¼Œå­˜æ´»æ—¶é—´ï¼‰çš„é”®ã€‚
7. allkeys-lfuï¼šå¯¹æ‰€æœ‰çš„ key ä½¿ç”¨ LFU ç®—æ³•è¿›è¡Œåˆ é™¤ã€‚
8. volatile-lfuï¼šå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ key ä½¿ç”¨ LFU ç®—æ³•è¿›è¡Œåˆ é™¤ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³æ˜¥æ‹›åŒå­¦ K ä¸€é¢é¢è¯•åŸé¢˜ï¼šä¸ºä»€ä¹ˆ redis å¿«ï¼Œæ·˜æ±°ç­–ç•¥ æŒä¹…åŒ–
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å»å“ªå„¿é¢ç»åŒå­¦ 1 æŠ€æœ¯ 2é¢é¢è¯•åŸé¢˜ï¼šrediså†…å­˜æ·˜æ±°å’Œè¿‡æœŸç­–ç•¥

### 37.Redis é˜»å¡ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ

Redis å‘ç”Ÿé˜»å¡ï¼Œå¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ’æŸ¥ï¼š
![Redisé˜»å¡æ’æŸ¥](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e6a35258-7a78-4489-90b7-e47a4190802b.png)

- **API æˆ–æ•°æ®ç»“æ„ä½¿ç”¨ä¸åˆç†**

  é€šå¸¸ Redis æ‰§è¡Œå‘½ä»¤é€Ÿåº¦éå¸¸å¿«ï¼Œä½†æ˜¯ä¸åˆç†åœ°ä½¿ç”¨å‘½ä»¤ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ‰§è¡Œé€Ÿåº¦å¾ˆæ…¢ï¼Œå¯¼è‡´é˜»å¡ï¼Œå¯¹äºé«˜å¹¶å‘çš„åœºæ™¯ï¼Œåº”è¯¥å°½é‡é¿å…åœ¨å¤§å¯¹è±¡ä¸Šæ‰§è¡Œç®—æ³•å¤æ‚ åº¦è¶…è¿‡ Oï¼ˆnï¼‰çš„å‘½ä»¤ã€‚

  å¯¹æ…¢æŸ¥è¯¢çš„å¤„ç†åˆ†ä¸ºä¸¤æ­¥ï¼š

  1. å‘ç°æ…¢æŸ¥è¯¢ï¼š slowlog get{n}å‘½ä»¤å¯ä»¥è·å–æœ€è¿‘ çš„ n æ¡æ…¢æŸ¥è¯¢å‘½ä»¤ï¼›
  2. å‘ç°æ…¢æŸ¥è¯¢åï¼Œå¯ä»¥ä»ä¸¤ä¸ªæ–¹å‘å»ä¼˜åŒ–æ…¢æŸ¥è¯¢ï¼š
     1ï¼‰ä¿®æ”¹ä¸ºä½ç®—æ³•å¤æ‚åº¦çš„å‘½ä»¤ï¼Œå¦‚ hgetall æ”¹ä¸º hmget ç­‰ï¼Œç¦ç”¨ keysã€sort ç­‰å‘½ ä»¤
     2ï¼‰è°ƒæ•´å¤§å¯¹è±¡ï¼šç¼©å‡å¤§å¯¹è±¡æ•°æ®æˆ–æŠŠå¤§å¯¹è±¡æ‹†åˆ†ä¸ºå¤šä¸ªå°å¯¹è±¡ï¼Œé˜²æ­¢ä¸€æ¬¡å‘½ä»¤æ“ä½œè¿‡å¤šçš„æ•°æ®ã€‚

- **CPU é¥±å’Œçš„é—®é¢˜**

  å•çº¿ç¨‹çš„ Redis å¤„ç†å‘½ä»¤æ—¶åªèƒ½ä½¿ç”¨ä¸€ä¸ª CPUã€‚è€Œ CPU é¥±å’Œæ˜¯æŒ‡ Redis å•æ ¸ CPU ä½¿ç”¨ç‡è·‘åˆ°æ¥è¿‘ 100%ã€‚

  é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œå¤„ç†æ­¥éª¤ä¸€èˆ¬å¦‚ä¸‹ï¼š

  1. åˆ¤æ–­å½“å‰ Redis å¹¶å‘é‡æ˜¯å¦å·²ç»è¾¾åˆ°æé™ï¼Œå¯ä»¥ä½¿ç”¨ç»Ÿè®¡å‘½ä»¤ redis-cli-h{ip}-p{port}--stat è·å–å½“å‰ Redis ä½¿ç”¨æƒ…å†µ
  2. å¦‚æœ Redis çš„è¯·æ±‚å‡ ä¸‡+ï¼Œé‚£ä¹ˆå¤§æ¦‚å°±æ˜¯ Redis çš„ OPS å·²ç»åˆ°äº†æé™ï¼Œåº”è¯¥åšé›†ç¾¤åŒ–æ°´å“æ‰©å±•æ¥åˆ†æ‘Š OPS å‹åŠ›
  3. å¦‚æœåªæœ‰å‡ ç™¾å‡ åƒï¼Œé‚£ä¹ˆå°±å¾—æ’æŸ¥å‘½ä»¤å’Œå†…å­˜çš„ä½¿ç”¨

- **æŒä¹…åŒ–ç›¸å…³çš„é˜»å¡**

  å¯¹äºå¼€å¯äº†æŒä¹…åŒ–åŠŸèƒ½çš„ Redis èŠ‚ç‚¹ï¼Œéœ€è¦æ’æŸ¥æ˜¯å¦æ˜¯æŒä¹…åŒ–å¯¼è‡´çš„é˜»å¡ã€‚

  1. fork é˜»å¡
     fork æ“ä½œå‘ç”Ÿåœ¨ RDB å’Œ AOF é‡å†™æ—¶ï¼ŒRedis ä¸»çº¿ç¨‹è°ƒç”¨ fork æ“ä½œäº§ç”Ÿå…±äº« å†…å­˜çš„å­è¿›ç¨‹ï¼Œç”±å­è¿›ç¨‹å®ŒæˆæŒä¹…åŒ–æ–‡ä»¶é‡å†™å·¥ä½œã€‚å¦‚æœ fork æ“ä½œæœ¬èº«è€—æ—¶è¿‡é•¿ï¼Œå¿…ç„¶ä¼šå¯¼è‡´ä¸»çº¿ç¨‹çš„é˜»å¡ã€‚
  2. AOF åˆ·ç›˜é˜»å¡
     å½“æˆ‘ä»¬å¼€å¯ AOF æŒä¹…åŒ–åŠŸèƒ½æ—¶ï¼Œæ–‡ä»¶åˆ·ç›˜çš„æ–¹å¼ä¸€èˆ¬é‡‡ç”¨æ¯ç§’ä¸€æ¬¡ï¼Œåå°çº¿ç¨‹æ¯ç§’å¯¹ AOF æ–‡ä»¶åš fsync æ“ä½œã€‚å½“ç¡¬ç›˜å‹åŠ›è¿‡å¤§æ—¶ï¼Œfsync æ“ä½œéœ€è¦ç­‰ å¾…ï¼Œç›´åˆ°å†™å…¥å®Œæˆã€‚å¦‚æœä¸»çº¿ç¨‹å‘ç°è·ç¦»ä¸Šä¸€æ¬¡çš„ fsync æˆåŠŸè¶…è¿‡ 2 ç§’ï¼Œä¸ºäº† æ•°æ®å®‰å…¨æ€§å®ƒä¼šé˜»å¡ç›´åˆ°åå°çº¿ç¨‹æ‰§è¡Œ fsync æ“ä½œå®Œæˆã€‚
  3. HugePage å†™æ“ä½œé˜»å¡
     å¯¹äºå¼€å¯ Transparent HugePages çš„ æ“ä½œç³»ç»Ÿï¼Œæ¯æ¬¡å†™å‘½ä»¤å¼•èµ·çš„å¤åˆ¶å†…å­˜é¡µå•ä½ç”± 4K å˜ä¸º 2MBï¼Œæ”¾å¤§äº† 512 å€ï¼Œä¼šæ‹–æ…¢å†™æ“ä½œçš„æ‰§è¡Œæ—¶é—´ï¼Œå¯¼è‡´å¤§é‡å†™æ“ä½œæ…¢æŸ¥è¯¢ã€‚

### 38.å¤§ key é—®é¢˜äº†è§£å—ï¼Ÿ

å¤§ key æŒ‡çš„æ˜¯å­˜å‚¨äº†å¤§é‡æ•°æ®çš„é”®ï¼Œæ¯”å¦‚ï¼š

- å•ä¸ªç®€å•çš„ key å­˜å‚¨çš„ value å¾ˆå¤§ï¼Œsize è¶…è¿‡ 10KB
- hashï¼Œsetï¼Œzsetï¼Œlist ä¸­å­˜å‚¨è¿‡å¤šçš„å…ƒç´ ï¼ˆä»¥ä¸‡ä¸ºå•ä½ï¼‰

æ¨èé˜…è¯»ï¼š[é˜¿é‡Œï¼šå‘ç°å¹¶å¤„ç† Redis çš„å¤§ Key å’Œçƒ­ Key](https://help.aliyun.com/zh/redis/user-guide/identify-and-handle-large-keys-and-hotkeys)

**å¤§ key ä¼šé€ æˆä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ**

- å®¢æˆ·ç«¯è€—æ—¶å¢åŠ ï¼Œç”šè‡³è¶…æ—¶
- å¯¹å¤§ key è¿›è¡Œ IO æ“ä½œæ—¶ï¼Œä¼šä¸¥é‡å ç”¨å¸¦å®½å’Œ CPU
- é€ æˆ Redis é›†ç¾¤ä¸­æ•°æ®å€¾æ–œ
- ä¸»åŠ¨åˆ é™¤ã€è¢«åŠ¨åˆ ç­‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´é˜»å¡

**å¦‚ä½•æ‰¾åˆ°å¤§ key?**

â‘ ã€bigkeys å‚æ•°ï¼šä½¿ç”¨ bigkeys å‘½ä»¤ä»¥éå†çš„æ–¹å¼åˆ†æ Redis å®ä¾‹ä¸­çš„æ‰€æœ‰ Keyï¼Œå¹¶è¿”å›æ•´ä½“ç»Ÿè®¡ä¿¡æ¯ä¸æ¯ä¸ªæ•°æ®ç±»å‹ä¸­ Top1 çš„å¤§ Key

> bigkeys å‘½ä»¤çš„ä½¿ç”¨ï¼š`redis-cli --bigkeys`

![](https://cdn.tobebetterjavaer.com/stutymore/redis-20240309091503.png)

â‘¡ã€redis-rdb-toolsï¼šredis-rdb-tools æ˜¯ç”± Python è¯­è¨€ç¼–å†™çš„ç”¨æ¥åˆ†æ Redis ä¸­ rdb å¿«ç…§æ–‡ä»¶çš„å·¥å…·ã€‚

æºç åœ°å€ï¼š[https://github.com/sripathikrishnan/redis-rdb-tools/](https://github.com/sripathikrishnan/redis-rdb-tools/)

> rdbï¼Œå…¨ç§° Redis DataBaseï¼Œæ˜¯ Redis åœ¨å†…å­˜ä¸­çš„æ•°æ®æ ¼å¼çš„ä¸€ç§æŒä¹…åŒ–å­˜å‚¨æ–¹å¼ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/redis-20240309092121.png)

æ¨èé˜…è¯»ï¼š[RDB è¯¦è§£](https://redisbook.readthedocs.io/en/latest/internal/rdb.html)

**å¦‚ä½•å¤„ç†å¤§ key?**

![å¤§keyå¤„ç†](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e4aaafda-fce1-47f0-8b2b-7261d47b720b.png)

â‘ ã€**åˆ é™¤å¤§ key**

- å½“ Redis ç‰ˆæœ¬å¤§äº 4.0 æ—¶ï¼Œå¯ä½¿ç”¨ UNLINK å‘½ä»¤å®‰å…¨åœ°åˆ é™¤å¤§ Keyï¼Œè¯¥å‘½ä»¤èƒ½å¤Ÿä»¥éé˜»å¡çš„æ–¹å¼ï¼Œé€æ­¥åœ°æ¸…ç†ä¼ å…¥çš„å¤§ Keyã€‚
- å½“ Redis ç‰ˆæœ¬å°äº 4.0 æ—¶ï¼Œå»ºè®®é€šè¿‡ SCAN å‘½ä»¤æ‰§è¡Œå¢é‡è¿­ä»£æ‰«æ keyï¼Œç„¶ååˆ¤æ–­è¿›è¡Œåˆ é™¤ã€‚

â‘¡ã€**å‹ç¼©å’Œæ‹†åˆ† key**

- å½“ vaule æ˜¯ string æ—¶ï¼Œæ¯”è¾ƒéš¾æ‹†åˆ†ï¼Œåˆ™ä½¿ç”¨åºåˆ—åŒ–ã€å‹ç¼©ç®—æ³•å°† key çš„å¤§å°æ§åˆ¶åœ¨åˆç†èŒƒå›´å†…ï¼Œä½†æ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–éƒ½ä¼šå¸¦æ¥é¢å¤–çš„æ€§èƒ½æ¶ˆè€—ã€‚
- å½“ value æ˜¯ stringï¼Œå‹ç¼©ä¹‹åä»ç„¶æ˜¯å¤§ key æ—¶ï¼Œåˆ™éœ€è¦è¿›è¡Œæ‹†åˆ†ï¼Œå°†ä¸€ä¸ªå¤§ key åˆ†ä¸ºä¸åŒçš„éƒ¨åˆ†ï¼Œè®°å½•æ¯ä¸ªéƒ¨åˆ†çš„ keyï¼Œä½¿ç”¨ multiget ç­‰æ“ä½œå®ç°äº‹åŠ¡è¯»å–ã€‚
- å½“ value æ˜¯ list/set ç­‰é›†åˆç±»å‹æ—¶ï¼Œæ ¹æ®é¢„ä¼°çš„æ•°æ®è§„æ¨¡æ¥è¿›è¡Œåˆ†ç‰‡ï¼Œä¸åŒçš„å…ƒç´ è®¡ç®—ååˆ†åˆ°ä¸åŒçš„ç‰‡ã€‚

> 1. åä¸º OD çš„é¢è¯•ä¸­å‡ºç°è¿‡è¯¥é¢˜ï¼šè®²ä¸€è®² Redis çš„çƒ­ Key å’Œå¤§ Key

### 39.Redis å¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Ÿ

1.  Master æœ€å¥½ä¸è¦åšä»»ä½•æŒä¹…åŒ–å·¥ä½œï¼ŒåŒ…æ‹¬å†…å­˜å¿«ç…§å’Œ AOF æ—¥å¿—æ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯ä¸è¦å¯ç”¨å†…å­˜å¿«ç…§åšæŒä¹…åŒ–ã€‚
2.  å¦‚æœæ•°æ®æ¯”è¾ƒå…³é”®ï¼ŒæŸä¸ª Slave å¼€å¯ AOF å¤‡ä»½æ•°æ®ï¼Œç­–ç•¥ä¸ºæ¯ç§’åŒæ­¥ä¸€æ¬¡ã€‚
3.  ä¸ºäº†ä¸»ä»å¤åˆ¶çš„é€Ÿåº¦å’Œè¿æ¥çš„ç¨³å®šæ€§ï¼ŒSlave å’Œ Master æœ€å¥½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…ã€‚
4.  å°½é‡é¿å…åœ¨å‹åŠ›è¾ƒå¤§çš„ä¸»åº“ä¸Šå¢åŠ ä»åº“ã€‚
5.  Master è°ƒç”¨ BGREWRITEAOF é‡å†™ AOF æ–‡ä»¶ï¼ŒAOF åœ¨é‡å†™çš„æ—¶å€™ä¼šå å¤§é‡çš„ CPU å’Œå†…å­˜èµ„æºï¼Œå¯¼è‡´æœåŠ¡ load è¿‡é«˜ï¼Œå‡ºç°çŸ­æš‚æœåŠ¡æš‚åœç°è±¡ã€‚
6.  ä¸ºäº† Master çš„ç¨³å®šæ€§ï¼Œä¸»ä»å¤åˆ¶ä¸è¦ç”¨å›¾çŠ¶ç»“æ„ï¼Œç”¨å•å‘é“¾è¡¨ç»“æ„æ›´ç¨³å®šï¼Œå³ä¸»ä»å…³ä¸ºï¼šMaster<â€“Slave1<â€“Slave2<â€“Slave3â€¦ï¼Œè¿™æ ·çš„ç»“æ„ä¹Ÿæ–¹ä¾¿è§£å†³å•ç‚¹æ•…éšœé—®é¢˜ï¼Œå®ç° Slave å¯¹ Master çš„æ›¿æ¢ï¼Œä¹Ÿå³ï¼Œå¦‚æœ Master æŒ‚äº†ï¼Œå¯ä»¥ç«‹é©¬å¯ç”¨ Slave1 åš Masterï¼Œå…¶ä»–ä¸å˜ã€‚

GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹](https://javabetter.cn/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## Redis åº”ç”¨

### 40.ä½¿ç”¨ Redis å¦‚ä½•å®ç°å¼‚æ­¥é˜Ÿåˆ—ï¼Ÿ

æˆ‘ä»¬çŸ¥é“ redis æ”¯æŒå¾ˆå¤šç§ç»“æ„çš„æ•°æ®ï¼Œé‚£ä¹ˆå¦‚ä½•ä½¿ç”¨ redis ä½œä¸ºå¼‚æ­¥é˜Ÿåˆ—ä½¿ç”¨å‘¢ï¼Ÿ
ä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

- **ä½¿ç”¨ list ä½œä¸ºé˜Ÿåˆ—ï¼Œlpush ç”Ÿäº§æ¶ˆæ¯ï¼Œrpop æ¶ˆè´¹æ¶ˆæ¯**

è¿™ç§æ–¹å¼ï¼Œæ¶ˆè´¹è€…æ­»å¾ªç¯ rpop ä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹æ¶ˆæ¯ã€‚ä½†æ˜¯è¿™æ ·ï¼Œå³ä½¿é˜Ÿåˆ—é‡Œæ²¡æœ‰æ¶ˆæ¯ï¼Œä¹Ÿä¼šè¿›è¡Œ rpopï¼Œä¼šå¯¼è‡´ Redis CPU çš„æ¶ˆè€—ã€‚
![listä½œä¸ºé˜Ÿåˆ—](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e4b192a1-3ba7-4f4e-98de-e93f437cff7c.png)
å¯ä»¥é€šè¿‡è®©æ¶ˆè´¹è€…ä¼‘çœ çš„æ–¹å¼çš„æ–¹å¼æ¥å¤„ç†ï¼Œä½†æ˜¯è¿™æ ·åˆä¼šåˆæ¶ˆæ¯çš„å»¶è¿Ÿé—®é¢˜ã€‚

-**ä½¿ç”¨ list ä½œä¸ºé˜Ÿåˆ—ï¼Œlpush ç”Ÿäº§æ¶ˆæ¯ï¼Œbrpop æ¶ˆè´¹æ¶ˆæ¯**

brpop æ˜¯ rpop çš„é˜»å¡ç‰ˆæœ¬ï¼Œlist ä¸ºç©ºçš„æ—¶å€™ï¼Œå®ƒä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ° list ä¸­æœ‰å€¼æˆ–è€…è¶…æ—¶ã€‚
![listä½œä¸ºé˜Ÿåˆ—ï¼Œbrpop](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e9581e51-ffc8-4326-9af4-07816743dc88.png)

è¿™ç§æ–¹å¼åªèƒ½å®ç°ä¸€å¯¹ä¸€çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚

- **ä½¿ç”¨ Redis çš„ pub/sub æ¥è¿›è¡Œæ¶ˆæ¯çš„å‘å¸ƒ/è®¢é˜…**

å‘å¸ƒ/è®¢é˜…æ¨¡å¼å¯ä»¥ 1ï¼šN çš„æ¶ˆæ¯å‘å¸ƒ/è®¢é˜…ã€‚å‘å¸ƒè€…å°†æ¶ˆæ¯å‘å¸ƒåˆ°æŒ‡å®šçš„é¢‘é“é¢‘é“ï¼ˆchannelï¼‰ï¼Œè®¢é˜…ç›¸åº”é¢‘é“çš„å®¢æˆ·ç«¯éƒ½èƒ½æ”¶åˆ°æ¶ˆæ¯ã€‚

![pub/sub](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-bc6d05be-3701-4e23-b4ca-6330c949f020.png)
ä½†æ˜¯è¿™ç§æ–¹å¼ä¸æ˜¯å¯é çš„ï¼Œå®ƒä¸ä¿è¯è®¢é˜…è€…ä¸€å®šèƒ½æ”¶åˆ°æ¶ˆæ¯ï¼Œä¹Ÿä¸è¿›è¡Œæ¶ˆæ¯çš„å­˜å‚¨ã€‚

æ‰€ä»¥ï¼Œä¸€èˆ¬çš„å¼‚æ­¥é˜Ÿåˆ—çš„å®ç°è¿˜æ˜¯äº¤ç»™ä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚

### 41.Redis å¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—?

å¯ä»¥ä½¿ç”¨ Redis çš„ zsetï¼ˆæœ‰åºé›†åˆï¼‰æ¥å®ç°å»¶æ—¶é˜Ÿåˆ—ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šzsetå®ç°å»¶æ—¶é˜Ÿåˆ—](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-54bbcc36-0b00-4142-a6eb-bf2ef48c2213.png)

ç¬¬ä¸€æ­¥ï¼Œå°†ä»»åŠ¡æ·»åŠ åˆ° zset ä¸­ï¼Œscore ä¸ºä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´æˆ³ï¼Œvalue ä¸ºä»»åŠ¡çš„å†…å®¹ã€‚

```bash
ZADD delay_queue 1617024000 task1
```

ç¬¬äºŒæ­¥ï¼Œå®šæœŸï¼ˆä¾‹å¦‚æ¯ç§’ï¼‰ä» zset ä¸­è·å– score å°äºå½“å‰æ—¶é—´æˆ³çš„ä»»åŠ¡ï¼Œç„¶åæ‰§è¡Œä»»åŠ¡ã€‚

```bash
ZREMRANGEBYSCORE delay_queue -inf 1617024000
```

ç¬¬ä¸‰æ­¥ï¼Œä»»åŠ¡æ‰§è¡Œåï¼Œä» zset ä¸­åˆ é™¤ä»»åŠ¡ã€‚

```bash
ZREM delay_queue task1
```

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 23 QQ åå°æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis å®ç°å»¶è¿Ÿé˜Ÿåˆ—

### 42.Redis æ”¯æŒäº‹åŠ¡å—ï¼Ÿ

Redis æ”¯æŒç®€å•çš„äº‹åŠ¡ï¼Œå¯ä»¥å°†å¤šä¸ªå‘½ä»¤æ‰“åŒ…ï¼Œç„¶åä¸€æ¬¡æ€§çš„ï¼ŒæŒ‰ç…§é¡ºåºæ‰§è¡Œã€‚

ä¸»è¦é€šè¿‡ multiã€execã€discardã€watch ç­‰å‘½ä»¤æ¥å®ç°ï¼š

- multiï¼šæ ‡è®°ä¸€ä¸ªäº‹åŠ¡å—çš„å¼€å§‹
- execï¼šæ‰§è¡Œæ‰€æœ‰äº‹åŠ¡å—å†…çš„å‘½ä»¤
- discardï¼šå–æ¶ˆäº‹åŠ¡ï¼Œæ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡å—å†…çš„æ‰€æœ‰å‘½ä»¤
- watchï¼šç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ª keyï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ª key è¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­

![](https://cdn.tobebetterjavaer.com/stutymore/redis-20240314101439.png)

è¿™é‡Œç®€å•è¯´ä¸€ä¸‹ Redis äº‹åŠ¡çš„åŸç†ï¼š

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedisäº‹åŠ¡](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-2ed7ae21-16a6-4716-ac89-117a8c76d3db.png)

- ä½¿ç”¨ MULTI å‘½ä»¤å¼€å§‹ä¸€ä¸ªäº‹åŠ¡ã€‚ä»è¿™ä¸ªå‘½ä»¤æ‰§è¡Œä¹‹åå¼€å§‹ï¼Œæ‰€æœ‰çš„åç»­å‘½ä»¤éƒ½ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯è¢«æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ä¸­ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒRedis åªæ˜¯è®°å½•ä¸‹äº†è¿™äº›å‘½ä»¤ã€‚
- ä½¿ç”¨ EXEC å‘½ä»¤è§¦å‘äº‹åŠ¡çš„æ‰§è¡Œã€‚ä¸€æ—¦æ‰§è¡Œäº† EXECï¼Œä¹‹å‰ MULTI åé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤ä¼šè¢«åŸå­åœ°ï¼ˆatomicï¼‰æ‰§è¡Œã€‚è¿™é‡Œçš„â€œåŸå­â€æ„å‘³ç€è¿™äº›å‘½ä»¤è¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆï¼ˆåœ¨å‡ºç°é”™è¯¯æ—¶ï¼‰å…¨éƒ¨ä¸æ‰§è¡Œã€‚
- å¦‚æœåœ¨æ‰§è¡Œ EXEC ä¹‹å‰å†³å®šä¸æ‰§è¡Œäº‹åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ DISCARD å‘½ä»¤æ¥å–æ¶ˆäº‹åŠ¡ã€‚è¿™ä¼šæ¸…ç©ºäº‹åŠ¡é˜Ÿåˆ—å¹¶é€€å‡ºäº‹åŠ¡çŠ¶æ€ã€‚
- WATCH å‘½ä»¤ç”¨äºå®ç°ä¹è§‚é”ã€‚WATCH å‘½ä»¤å¯ä»¥ç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ªé”®ï¼Œå¦‚æœåœ¨æ‰§è¡Œäº‹åŠ¡çš„è¿‡ç¨‹ä¸­ï¼ˆå³åœ¨æ‰§è¡Œ MULTI ä¹‹åï¼Œæ‰§è¡Œ EXEC ä¹‹å‰ï¼‰ï¼Œè¢«ç›‘è§†çš„é”®è¢«å…¶ä»–å‘½ä»¤æ”¹å˜äº†ï¼Œé‚£ä¹ˆå½“æ‰§è¡Œ EXEC æ—¶ï¼Œäº‹åŠ¡å°†è¢«å–æ¶ˆï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚

**Redis äº‹åŠ¡çš„æ³¨æ„ç‚¹æœ‰å“ªäº›ï¼Ÿ**

Redis äº‹åŠ¡æ˜¯ä¸æ”¯æŒå›æ»šçš„ï¼Œä¸åƒ MySQL çš„äº‹åŠ¡ä¸€æ ·ï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œï¼›ä¸€æ—¦ EXEC å‘½ä»¤è¢«è°ƒç”¨ï¼Œæ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«æ‰§è¡Œï¼Œå³ä½¿æœ‰äº›å‘½ä»¤å¯èƒ½æ‰§è¡Œå¤±è´¥ã€‚å¤±è´¥çš„å‘½ä»¤ä¸ä¼šå½±å“åˆ°å…¶ä»–å‘½ä»¤çš„æ‰§è¡Œã€‚

**Redis äº‹åŠ¡ä¸ºä»€ä¹ˆä¸æ”¯æŒå›æ»šï¼Ÿ**

å¼•å…¥äº‹åŠ¡å›æ»šæœºåˆ¶ä¼šå¤§å¤§å¢åŠ  Redis çš„å¤æ‚æ€§ï¼Œå› ä¸ºéœ€è¦è·Ÿè¸ªäº‹åŠ¡ä¸­æ¯ä¸ªå‘½ä»¤çš„çŠ¶æ€ï¼Œå¹¶åœ¨å‘ç”Ÿé”™è¯¯æ—¶é€†å‘æ‰§è¡Œå‘½ä»¤ä»¥æ¢å¤åŸå§‹çŠ¶æ€ã€‚

Redis æ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„æ•°æ®å­˜å‚¨ç³»ç»Ÿï¼Œå…¶è®¾è®¡é‡ç‚¹æ˜¯å®ç°é«˜æ€§èƒ½ã€‚äº‹åŠ¡å›æ»šéœ€è¦é¢å¤–çš„èµ„æºå’Œæ—¶é—´æ¥ç®¡ç†å’Œæ‰§è¡Œï¼Œè¿™ä¸ Redis çš„è®¾è®¡ç›®æ ‡ç›¸è¿èƒŒã€‚å› æ­¤ï¼ŒRedis é€‰æ‹©ä¸æ”¯æŒäº‹åŠ¡å›æ»šã€‚

æ¢å¥è¯è¯´ï¼Œ**å°±æ˜¯æˆ‘ Redis ä¸æƒ³æ”¯æŒäº‹åŠ¡ï¼Œä¹Ÿæ²¡æœ‰è¿™ä¸ªå¿…è¦**ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„åä¸ºä¸€é¢åŸé¢˜ï¼šè¯´ä¸‹ Redis äº‹åŠ¡

### 43.Redis å’Œ Lua è„šæœ¬çš„ä½¿ç”¨äº†è§£å—ï¼Ÿ

Redis çš„äº‹åŠ¡åŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œå¹³æ—¶çš„å¼€å‘ä¸­ï¼Œå¯ä»¥åˆ©ç”¨ Lua è„šæœ¬æ¥å¢å¼º Redis çš„å‘½ä»¤ã€‚

Lua è„šæœ¬èƒ½ç»™å¼€å‘äººå‘˜å¸¦æ¥è¿™äº›å¥½å¤„ï¼š

- Lua è„šæœ¬åœ¨ Redis ä¸­æ˜¯åŸå­æ‰§è¡Œçš„ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­é—´ä¸ä¼šæ’å…¥å…¶ä»–å‘½ä»¤ã€‚
- Lua è„šæœ¬å¯ä»¥å¸®åŠ©å¼€å‘å’Œè¿ç»´äººå‘˜åˆ›é€ å‡ºè‡ªå·±å®šåˆ¶çš„å‘½ä»¤ï¼Œå¹¶å¯ä»¥å°†è¿™ äº›å‘½ä»¤å¸¸é©»åœ¨ Redis å†…å­˜ä¸­ï¼Œå®ç°å¤ç”¨çš„æ•ˆæœã€‚
- Lua è„šæœ¬å¯ä»¥å°†å¤šæ¡å‘½ä»¤ä¸€æ¬¡æ€§æ‰“åŒ…ï¼Œæœ‰æ•ˆåœ°å‡å°‘ç½‘ç»œå¼€é”€ã€‚

æ¯”å¦‚è¿™ä¸€æ®µå¾ˆï¼ˆçƒ‚ï¼‰ç»ï¼ˆå¤§ï¼‰å…¸ï¼ˆè¡—ï¼‰çš„ç§’æ€ç³»ç»Ÿåˆ©ç”¨ lua æ‰£å‡ Redis åº“å­˜çš„è„šæœ¬ï¼š

```java
   -- åº“å­˜æœªé¢„çƒ­
   if (redis.call('exists', KEYS[2]) == 1) then
        return -9;
    end;
    -- ç§’æ€å•†å“åº“å­˜å­˜åœ¨
    if (redis.call('exists', KEYS[1]) == 1) then
        local stock = tonumber(redis.call('get', KEYS[1]));
        local num = tonumber(ARGV[1]);
        -- å‰©ä½™åº“å­˜å°‘äºè¯·æ±‚æ•°é‡
        if (stock < num) then
            return -3
        end;
        -- æ‰£å‡åº“å­˜
        if (stock >= num) then
            redis.call('incrby', KEYS[1], 0 - num);
            -- æ‰£å‡æˆåŠŸ
            return 1
        end;
        return -2;
    end;
    -- ç§’æ€å•†å“åº“å­˜ä¸å­˜åœ¨
    return -1;
```

### 44.Redis çš„ç®¡é“äº†è§£å—ï¼Ÿ

Redis æä¾›ä¸‰ç§å°†å®¢æˆ·ç«¯å¤šæ¡å‘½ä»¤æ‰“åŒ…å‘é€ç»™æœåŠ¡ç«¯æ‰§è¡Œçš„æ–¹å¼ï¼š

Pipelining(ç®¡é“) ã€ Transactions(äº‹åŠ¡) å’Œ Lua Scripts(Lua è„šæœ¬) ã€‚

**Pipelining**ï¼ˆç®¡é“ï¼‰

Redis ç®¡é“æ˜¯ä¸‰è€…ä¹‹ä¸­æœ€ç®€å•çš„ï¼Œå½“å®¢æˆ·ç«¯éœ€è¦æ‰§è¡Œå¤šæ¡ redis å‘½ä»¤æ—¶ï¼Œå¯ä»¥é€šè¿‡ç®¡é“ä¸€æ¬¡æ€§å°†è¦æ‰§è¡Œçš„å¤šæ¡å‘½ä»¤å‘é€ç»™æœåŠ¡ç«¯ï¼Œå…¶ä½œç”¨æ˜¯ä¸ºäº†é™ä½ RTT(Round Trip Time) å¯¹æ€§èƒ½çš„å½±å“ï¼Œæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨ nc å‘½ä»¤å°†ä¸¤æ¡æŒ‡ä»¤å‘é€ç»™ redis æœåŠ¡ç«¯ã€‚

Redis æœåŠ¡ç«¯æ¥æ”¶åˆ°ç®¡é“å‘é€è¿‡æ¥çš„å¤šæ¡å‘½ä»¤åï¼Œä¼šä¸€ç›´æ‰§å‘½ä»¤ï¼Œå¹¶å°†å‘½ä»¤çš„æ‰§è¡Œç»“æœè¿›è¡Œç¼“å­˜ï¼Œç›´åˆ°æœ€åä¸€æ¡å‘½ä»¤æ‰§è¡Œå®Œæˆï¼Œå†æ‰€æœ‰å‘½ä»¤çš„æ‰§è¡Œç»“æœä¸€æ¬¡æ€§è¿”å›ç»™å®¢æˆ·ç«¯ ã€‚
![Pipeliningç¤ºæ„å›¾`](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-38aee4c1-efd2-495e-8a6d-164d21a129b1.png)

**Pipelining çš„ä¼˜åŠ¿**

åœ¨æ€§èƒ½æ–¹é¢ï¼Œ Pipelining æœ‰ä¸‹é¢ä¸¤ä¸ªä¼˜åŠ¿ï¼š

- **èŠ‚çœäº† RTT**ï¼šå°†å¤šæ¡å‘½ä»¤æ‰“åŒ…ä¸€æ¬¡æ€§å‘é€ç»™æœåŠ¡ç«¯ï¼Œå‡å°‘äº†å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´çš„ç½‘ç»œè°ƒç”¨æ¬¡æ•°
- **å‡å°‘äº†ä¸Šä¸‹æ–‡åˆ‡æ¢**ï¼šå½“å®¢æˆ·ç«¯/æœåŠ¡ç«¯éœ€è¦ä»ç½‘ç»œä¸­è¯»å†™æ•°æ®æ—¶ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œç³»ç»Ÿè°ƒç”¨æ˜¯éå¸¸è€—æ—¶çš„æ“ä½œï¼Œå…¶ä¸­è®¾è®¡åˆ°ç¨‹åºç”±ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œå†ä»å†…æ ¸æ€åˆ‡æ¢å›ç”¨æˆ·æ€çš„è¿‡ç¨‹ã€‚å½“æˆ‘ä»¬æ‰§è¡Œ 10 æ¡ redis å‘½ä»¤çš„æ—¶å€™ï¼Œå°±ä¼šå‘ç”Ÿ 10 æ¬¡ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä½†å¦‚æœæˆ‘ä»¬ä½¿ç”¨ Pipeining å°†å¤šæ¡å‘½ä»¤æ‰“åŒ…æˆä¸€æ¡ä¸€æ¬¡æ€§å‘é€ç»™æœåŠ¡ç«¯ï¼Œå°±åªä¼šäº§ç”Ÿä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚

### 45.Redis å®ç°åˆ†å¸ƒå¼é”äº†è§£å—ï¼Ÿ

Redis å®ç°åˆ†å¸ƒå¼é”çš„æœ¬è´¨ï¼Œå°±æ˜¯åœ¨ Redis é‡Œé¢å ä¸€ä¸ªâ€œèŒ…å‘â€ï¼Œå½“åˆ«çš„å®¢æˆ·ç«¯ä¹Ÿæ¥å å‘æ—¶ï¼Œå‘ç°å·²ç»æœ‰å®¢æˆ·ç«¯è¹²åœ¨é‚£é‡Œäº†ï¼Œå°±åªå¥½æ”¾å¼ƒæˆ–è€…ç¨åå†è¯•ã€‚

**å¯ä»¥ä½¿ç”¨ Redis çš„ SET å‘½ä»¤å®ç°åˆ†å¸ƒå¼é”**ã€‚SET å‘½ä»¤æ”¯æŒè®¾ç½®é”®å€¼å¯¹çš„åŒæ—¶æ·»åŠ è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢æ­»é”çš„å‘ç”Ÿã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šsetåŸå­å‘½ä»¤](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-710cdd19-98ea-4e96-b579-ff1ebb0d5de9.png)

```
SET key value NX PX 30000
```

- `key` æ˜¯é”åã€‚
- `value` æ˜¯é”çš„æŒæœ‰è€…æ ‡è¯†ï¼Œå¯ä»¥ä½¿ç”¨ UUID ä½œä¸º valueã€‚
- `NX` åªåœ¨é”®ä¸å­˜åœ¨æ—¶è®¾ç½®ã€‚
- `PX 30000`ï¼šè®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸º 30 ç§’ï¼ˆé˜²æ­¢æ­»é”ï¼‰ã€‚

ä¸Šé¢è¿™æ®µå‘½ä»¤å…¶å®æ˜¯ setnx å’Œ expire ç»„åˆåœ¨ä¸€èµ·çš„åŸå­å‘½ä»¤ï¼Œç®—æ˜¯æ¯”è¾ƒå®Œå–„çš„ä¸€ä¸ªåˆ†å¸ƒå¼é”äº†ã€‚

>å½“ç„¶ï¼Œå®é™…çš„å¼€å‘ä¸­ï¼Œæ²¡äººä¼šå»è‡ªå·±å†™åˆ†å¸ƒå¼é”çš„å‘½ä»¤ï¼Œå› ä¸ºæœ‰ä¸“ä¸šçš„è½®å­â€”â€”[Redisson](https://xie.infoq.cn/article/d8e897f768eb1a358a0fd6300)ã€‚ï¼ˆæˆ³é“¾æ¥è·³è½¬è‡³æ‚Ÿç©ºèŠæ¶æ„ï¼šåˆ†å¸ƒå¼é”ä¸­çš„ç‹è€…æ–¹æ¡ˆ - Redissonï¼‰

#### Redisson äº†è§£å—ï¼Ÿ

![å›¾ç‰‡æ¥æºäºç½‘ç»œ](https://cdn.tobebetterjavaer.com/stutymore/redis-20240308174708.png)

Redisson æ˜¯ä¸€ä¸ªåŸºäº Redis çš„ Java é©»å†…å­˜æ•°æ®ç½‘æ ¼ï¼ˆIn-Memory Data Gridï¼‰ï¼Œæä¾›äº†ä¸€ç³»åˆ— API ç”¨æ¥æ“ä½œ Redisï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„åŠŸèƒ½å°±æ˜¯åˆ†å¸ƒå¼é”ã€‚

```java
RLock lock = redisson.getLock("lock");
lock.lock();
try {
    // do something
} finally {
    lock.unlock();
}
```

æ™®é€šé”çš„å®ç°æºç æ˜¯åœ¨ RedissonLock ç±»ä¸­ï¼Œä¹Ÿæ˜¯é€šè¿‡ Lua è„šæœ¬å°è£…ä¸€äº› Redis å‘½ä»¤æ¥å®ç°çš„çš„ï¼Œæ¯”å¦‚è¯´ tryLockInnerAsync æºç ï¼š

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šRedissonLock](https://cdn.tobebetterjavaer.com/stutymore/redis-20240425120229.png)

å…¶ä¸­ hincrby å‘½ä»¤ç”¨äºå¯¹å“ˆå¸Œè¡¨ä¸­çš„å­—æ®µå€¼æ‰§è¡Œè‡ªå¢æ“ä½œï¼Œpexpire å‘½ä»¤ç”¨äºè®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ã€‚æ¯” SETNX æ›´ä¼˜é›…ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„è…¾è®¯ Java åç«¯å®ä¹ ä¸€é¢åŸé¢˜ï¼šåˆ†å¸ƒå¼é”ç”¨äº† Redis çš„ä»€ä¹ˆæ•°æ®ç»“æ„
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°å…¬å¸é¢ç»åˆé›†åŒå­¦ 1 Java åç«¯é¢è¯•åŸé¢˜ï¼šRedisson çš„åº•å±‚åŸç†ï¼Ÿä»¥åŠä¸ SETNX çš„åŒºåˆ«ï¼Ÿ
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç™¾åº¦é¢ç»åŒå­¦ 1 æ–‡å¿ƒä¸€è¨€ 25 å®ä¹  Java åç«¯é¢è¯•åŸé¢˜ï¼šredisåˆ†å¸ƒå¼é”çš„å®ç°åŸç†ï¼Ÿsetnxï¼Ÿ
> 4. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³åŒå­¦ F é¢è¯•åŸé¢˜ï¼šè‡ªå·±å®ç°redisåˆ†å¸ƒå¼é”çš„å‘ï¼ˆä¸»åŠ¨æäº†Redissionï¼‰

GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹](https://javabetter.cn/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## åº•å±‚ç»“æ„

è¿™ä¸€éƒ¨åˆ†å°±æ¯”è¾ƒæ·±äº†ï¼Œå¦‚æœä¸æ˜¯ç®€å†ä¸Šå†™äº†ç²¾é€š Redisï¼Œåº”è¯¥ä¸ä¼šæ€ä¹ˆé—®ã€‚

### 46.è¯´è¯´ Redis åº•å±‚æ•°æ®ç»“æ„ï¼Ÿ

Redis çš„åº•å±‚æ•°æ®ç»“æ„æœ‰**åŠ¨æ€å­—ç¬¦ä¸²(sds)**ã€**é“¾è¡¨(list)**ã€**å­—å…¸(ht)**ã€**è·³è·ƒè¡¨(skiplist)**ã€**æ•´æ•°é›†åˆ(intset)**ã€**å‹ç¼©åˆ—è¡¨(ziplist)** ç­‰ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedis Objectå¯¹åº”çš„æ˜ å°„](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-a1b2d2f9-6895-4749-9bda-9314f08bca68.png)

æ¯”å¦‚è¯´ string æ˜¯é€šè¿‡ SDS å®ç°çš„ï¼Œlist æ˜¯é€šè¿‡é“¾è¡¨å®ç°çš„ï¼Œhash æ˜¯é€šè¿‡å­—å…¸å®ç°çš„ï¼Œset æ˜¯é€šè¿‡å­—å…¸å®ç°çš„ï¼Œzset æ˜¯é€šè¿‡è·³è·ƒè¡¨å®ç°çš„ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç±»å‹-ç¼–ç -ç»“æ„](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-7cf91aa9-8db5-4abe-803e-a9e8f3bcb9e4.png)

#### ç®€å•ä»‹ç»ä¸‹ SDS

Redis æ˜¯é€šè¿‡ C è¯­è¨€å®ç°çš„ï¼Œä½† Redis å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨ C è¯­è¨€çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯è‡ªå·±å®ç°äº†ä¸€ç§å«åšåŠ¨æ€å­—ç¬¦ä¸² SDS çš„ç±»å‹ã€‚

```c
struct sdshdr {
    int len; // buf ä¸­å·²ä½¿ç”¨çš„é•¿åº¦
    int free; // buf ä¸­æœªä½¿ç”¨çš„é•¿åº¦
    char buf[]; // æ•°æ®ç©ºé—´
};
```

å› ä¸º C è¯­â¾”çš„å­—ç¬¦ä¸²ä¸è®°å½•â¾ƒèº«çš„â»“åº¦ä¿¡æ¯ï¼Œå½“éœ€è¦è·å–å­—ç¬¦ä¸²â»“åº¦æ—¶ï¼Œéœ€è¦éå†æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(N)ã€‚

â½½ SDS ä¿å­˜äº†â»“åº¦ä¿¡æ¯ï¼Œè¿™æ ·å°±å°†è·å–å­—ç¬¦ä¸²â»“åº¦çš„æ—¶é—´ç”± O(N) é™ä½åˆ°äº† O(1)ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSDS](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-7c038f2c-b5ee-4229-9449-713fab3b1855.png)

#### ç®€å•ä»‹ç»ä¸‹é“¾è¡¨ linkedlist

Redis çš„é“¾è¡¨æ˜¯â¼€ä¸ªåŒå‘â½†ç¯é“¾è¡¨ç»“æ„ï¼Œå’Œ Java ä¸­çš„ [LinkedList](https://javabetter.cn/collection/linkedlist.html) ç±»ä¼¼ã€‚

é“¾è¡¨çš„èŠ‚ç‚¹ç”±â¼€ä¸ªå«åš listNode çš„ç»“æ„æ¥è¡¨ç¤ºï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰æŒ‡å‘å…¶å‰ç½®èŠ‚ç‚¹å’Œåç½®èŠ‚ç‚¹çš„æŒ‡é’ˆï¼ŒåŒæ—¶å¤´èŠ‚ç‚¹çš„å‰ç½®å’Œå°¾èŠ‚ç‚¹çš„åç½®å‡æŒ‡å‘ nullã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šé“¾è¡¨linkedlist](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-1adef9c0-8feb-4836-8997-84bda96e2498.png)

#### ç®€å•ä»‹ç»ä¸‹å­—å…¸ dict

â½¤äºä¿å­˜é”®å€¼å¯¹çš„æŠ½è±¡æ•°æ®ç»“æ„ã€‚Redis ä½¿â½¤ hash è¡¨ä½œä¸ºåº•å±‚å®ç°ï¼Œä¸€ä¸ªå“ˆå¸Œè¡¨é‡Œå¯ä»¥æœ‰å¤šä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹ï¼Œè€Œæ¯ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹å°±ä¿å­˜äº†å­—å…¸é‡Œä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚

æ¯ä¸ªå­—å…¸å¸¦æœ‰ä¸¤ä¸ª hash è¡¨ï¼Œä¾›å¹³æ—¶ä½¿â½¤å’Œ rehash æ—¶ä½¿â½¤ï¼Œhash è¡¨ä½¿â½¤é“¾åœ°å€æ³•æ¥è§£å†³é”®å†²çªï¼Œè¢«åˆ†é…åˆ°åŒâ¼€ä¸ªç´¢å¼•ä½ç½®çš„å¤šä¸ªé”®å€¼å¯¹ä¼šå½¢æˆâ¼€ä¸ªå•å‘é“¾è¡¨ï¼Œåœ¨å¯¹ hash è¡¨è¿›â¾æ‰©å®¹æˆ–è€…ç¼©å®¹çš„æ—¶å€™ï¼Œä¸ºäº†æœåŠ¡çš„å¯â½¤æ€§ï¼Œrehash çš„è¿‡ç¨‹ä¸æ˜¯â¼€æ¬¡æ€§å®Œæˆçš„ï¼Œâ½½æ˜¯æ¸è¿›å¼çš„ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå­—å…¸](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-9934b4a2-c253-4d42-acf4-c6c940840779.png)

#### ç®€å•ä»‹ç»ä¸‹è·³è·ƒè¡¨ skiplist

æ¨èé˜…è¯»ï¼š[å…¨ç½‘æœ€è¯¦ç»†çš„è·³è¡¨æ–‡ç« ](https://www.jianshu.com/p/9d8296562806)

è·³è·ƒè¡¨ï¼ˆä¹Ÿç§°è·³è¡¨ï¼‰æ˜¯æœ‰åºé›†åˆ Zset çš„åº•å±‚å®ç°ä¹‹â¼€ã€‚åœ¨ Redis 7.0 ä¹‹å‰ï¼Œå¦‚æœæœ‰åºé›†åˆçš„å…ƒç´ ä¸ªæ•°å°äº 128 ä¸ªï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ çš„å€¼å°äº 64 å­—èŠ‚æ—¶ï¼ŒRedis ä¼šä½¿ç”¨å‹ç¼©åˆ—è¡¨ä½œä¸º Zset çš„åº•å±‚å®ç°ï¼Œå¦åˆ™ä¼šä½¿ç”¨è·³è¡¨ï¼›åœ¨ Redis 7.0 ä¹‹åï¼Œå‹ç¼©åˆ—è¡¨å·²ç»åºŸå¼ƒï¼Œäº¤ç”± listpack æ¥æ›¿ä»£ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šè·³è¡¨](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-886ee2a8-fb02-4908-bbba-d4ad2a211094.png)

è·³è¡¨ç”± zskiplist å’Œ zskiplistNode ç»„æˆï¼Œzskiplist â½¤äºä¿å­˜è·³è¡¨çš„åŸºæœ¬ä¿¡æ¯ï¼ˆè¡¨å¤´ã€è¡¨å°¾ã€â»“åº¦ã€å±‚é«˜ç­‰ï¼‰ã€‚

```c
typedef struct zskiplist {
    struct zskiplistNode *header, *tail;
    unsigned long length;
    int level;
} zskiplist;
```

zskiplistNode â½¤äºè¡¨ç¤ºè·³è¡¨èŠ‚ç‚¹ï¼Œæ¯ä¸ªè·³è¡¨èŠ‚ç‚¹çš„å±‚â¾¼æ˜¯ä¸å›ºå®šçš„ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰â¼€ä¸ªæŒ‡å‘ä¿å­˜äº†å½“å‰èŠ‚ç‚¹çš„åˆ†å€¼å’Œæˆå‘˜å¯¹è±¡çš„æŒ‡é’ˆã€‚

```c
typedef struct zskiplistNode {
    sds ele;
    double score;
    struct zskiplistNode *backward;
    struct zskiplistLevel {
        struct zskiplistNode *forward;
        unsigned int span;
    } level[];
} zskiplistNode;
```

#### ç®€å•ä»‹ç»ä¸‹æ•´æ•°é›†åˆ intset

â½¤äºä¿å­˜æ•´æ•°å€¼çš„é›†åˆæŠ½è±¡æ•°æ®ç»“æ„ï¼Œä¸ä¼šå‡ºç°é‡å¤å…ƒç´ ï¼Œåº•å±‚å®ç°ä¸ºæ•°ç»„ã€‚

![æ•´æ•°é›†åˆintset](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-833dbfb2-7c79-4e7b-a143-8a4a2936cdd8.png)

#### ç®€å•ä»‹ç»ä¸‹å‹ç¼©åˆ—è¡¨ ziplist

å‹ç¼©åˆ—è¡¨æ˜¯ä¸ºèŠ‚çº¦å†…å­˜â½½å¼€å‘çš„é¡ºåºæ€§æ•°æ®ç»“æ„ï¼Œå®ƒå¯ä»¥åŒ…å«ä»»æ„å¤šä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥ä¿å­˜â¼€ä¸ªå­—èŠ‚æ•°ç»„æˆ–è€…æ•´æ•°å€¼ã€‚

![å‹ç¼©åˆ—è¡¨ç»„æˆ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-99bcbe82-1d91-41bf-8900-a240856071f5.png)

#### ç®€å•ä»‹ç»ä¸‹ç´§å‡‘åˆ—è¡¨ listpack

listpack æ˜¯ Redis ç”¨æ¥æ›¿ä»£å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰çš„ä¸€ç§å†…å­˜æ›´åŠ ç´§å‡‘çš„æ•°æ®ç»“æ„ã€‚

![æå®¢æ—¶é—´ï¼šlistpack](https://cdn.tobebetterjavaer.com/stutymore/redis-20240403105313.png)

ä¸ºäº†é¿å… ziplist å¼•èµ·çš„è¿é”æ›´æ–°é—®é¢˜ï¼Œlistpack ä¸­çš„å…ƒç´ ä¸å†åƒ ziplist é‚£æ ·ï¼Œä¿å­˜å…¶å‰ä¸€ä¸ªå…ƒç´ çš„é•¿åº¦ï¼Œè€Œæ˜¯ä¿å­˜å½“å‰å…ƒç´ çš„ç¼–ç ç±»å‹ã€æ•°æ®ï¼Œä»¥åŠç¼–ç ç±»å‹å’Œæ•°æ®çš„é•¿åº¦ã€‚

![æå®¢æ—¶é—´ï¼šlistpack çš„å…ƒç´ ](https://cdn.tobebetterjavaer.com/stutymore/redis-20240403105754.png)

listpack æ¯ä¸ªå…ƒç´ é¡¹ä¸å†ä¿å­˜ä¸Šä¸€ä¸ªå…ƒç´ çš„é•¿åº¦ï¼Œè€Œæ˜¯ä¼˜åŒ–å…ƒç´ å†…å­—æ®µçš„é¡ºåºï¼Œæ¥ä¿è¯æ—¢å¯ä»¥ä»å‰ä¹Ÿå¯ä»¥å‘åéå†ã€‚

ä½†å› ä¸º List/Hash/Set/ZSet éƒ½ä¸¥é‡ä¾èµ– ziplistï¼Œæ‰€ä»¥è¿™ä¸ªæ›¿æ¢ä¹‹è·¯å¾ˆæ¼«é•¿ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å­—èŠ‚è·³åŠ¨å•†ä¸šåŒ–ä¸€é¢çš„åŸé¢˜ï¼šè¯´è¯´ Redis çš„ zsetï¼Œä»€ä¹ˆæ˜¯è·³è¡¨ï¼Œæ’å…¥ä¸€ä¸ªèŠ‚ç‚¹è¦æ„å»ºå‡ å±‚ç´¢å¼•
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 9 é£ä¹¦åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šRedis çš„æ•°æ®ç±»å‹ï¼ŒZSet çš„å®ç°
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³æš‘æœŸå®ä¹ åŒå­¦ E ä¸€é¢é¢è¯•åŸé¢˜ï¼šä½ çŸ¥é“ Redis çš„ zset åº•å±‚å®ç°å—
> 4. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 23 QQ åå°æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šzset çš„åº•å±‚åŸç†
> 5. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¿«æ‰‹é¢ç»åŒå­¦ 7 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šè¯´ä¸€ä¸‹ ZSet åº•å±‚ç»“æ„

### 47.Redis çš„ SDS å’Œ C ä¸­å­—ç¬¦ä¸²ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ

C è¯­è¨€ä½¿ç”¨äº†ä¸€ä¸ªé•¿åº¦ä¸º `N+1` çš„å­—ç¬¦æ•°ç»„æ¥è¡¨ç¤ºé•¿åº¦ä¸º `N` çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”å­—ç¬¦æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ æ€»æ˜¯ `\0`ï¼Œè¿™ç§ç®€å•çš„å­—ç¬¦ä¸²è¡¨ç¤ºæ–¹å¼ ä¸ç¬¦åˆ Redis å¯¹å­—ç¬¦ä¸²åœ¨å®‰å…¨æ€§ã€æ•ˆç‡ä»¥åŠåŠŸèƒ½æ–¹é¢çš„è¦æ±‚ã€‚

![Cè¯­è¨€çš„å­—ç¬¦ä¸²](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-2541fd26-4e84-467d-8d8c-c731154a85d7.png)

**C è¯­è¨€çš„å­—ç¬¦ä¸²å¯èƒ½æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ**

è¿™æ ·ç®€å•çš„æ•°æ®ç»“æ„å¯èƒ½ä¼šé€ æˆä»¥ä¸‹ä¸€äº›é—®é¢˜ï¼š

- **è·å–å­—ç¬¦ä¸²é•¿åº¦å¤æ‚åº¦é«˜** ï¼šå› ä¸º C ä¸ä¿å­˜æ•°ç»„çš„é•¿åº¦ï¼Œæ¯æ¬¡éƒ½éœ€è¦éå†ä¸€éæ•´ä¸ªæ•°ç»„ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼›
- ä¸èƒ½æœç» **ç¼“å†²åŒºæº¢å‡º/å†…å­˜æ³„æ¼** çš„é—®é¢˜ : C å­—ç¬¦ä¸²ä¸è®°å½•è‡ªèº«é•¿åº¦å¸¦æ¥çš„å¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯å®¹æ˜“é€ æˆç¼“å­˜åŒºæº¢å‡ºï¼ˆbuffer overflowï¼‰ï¼Œä¾‹å¦‚åœ¨å­—ç¬¦ä¸²æ‹¼æ¥çš„æ—¶å€™ï¼Œæ–°çš„
- C å­—ç¬¦ä¸² **åªèƒ½ä¿å­˜æ–‡æœ¬æ•°æ®** â†’ å› ä¸º C è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²å¿…é¡»ç¬¦åˆæŸç§ç¼–ç ï¼ˆæ¯”å¦‚ ASCIIï¼‰ï¼Œä¾‹å¦‚ä¸­é—´å‡ºç°çš„ `'\0'` å¯èƒ½ä¼šè¢«åˆ¤å®šä¸ºæå‰ç»“æŸçš„å­—ç¬¦ä¸²è€Œè¯†åˆ«ä¸äº†ï¼›

**Redis å¦‚ä½•è§£å†³ï¼Ÿä¼˜åŠ¿ï¼Ÿ**

![Redis sds](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-fc26a4e7-1c8d-4e82-b7f8-1f6b43d16d38.png)

ç®€å•æ¥è¯´ä¸€ä¸‹ Redis å¦‚ä½•è§£å†³çš„ï¼š

1. **å¤šå¢åŠ  len è¡¨ç¤ºå½“å‰å­—ç¬¦ä¸²çš„é•¿åº¦**ï¼šè¿™æ ·å°±å¯ä»¥ç›´æ¥è·å–é•¿åº¦äº†ï¼Œå¤æ‚åº¦ O(1)ï¼›
2. **è‡ªåŠ¨æ‰©å±•ç©ºé—´**ï¼šå½“ SDS éœ€è¦å¯¹å­—ç¬¦ä¸²è¿›è¡Œä¿®æ”¹æ—¶ï¼Œé¦–å…ˆå€ŸåŠ©äº `len` å’Œ `alloc` æ£€æŸ¥ç©ºé—´æ˜¯å¦æ»¡è¶³ä¿®æ”¹æ‰€éœ€çš„è¦æ±‚ï¼Œå¦‚æœç©ºé—´ä¸å¤Ÿçš„è¯ï¼ŒSDS ä¼šè‡ªåŠ¨æ‰©å±•ç©ºé—´ï¼Œé¿å…äº†åƒ C å­—ç¬¦ä¸²æ“ä½œä¸­çš„æº¢å‡ºæƒ…å†µï¼›
3. **æœ‰æ•ˆé™ä½å†…å­˜åˆ†é…æ¬¡æ•°**ï¼šC å­—ç¬¦ä¸²åœ¨æ¶‰åŠå¢åŠ æˆ–è€…æ¸…é™¤æ“ä½œæ—¶ä¼šæ”¹å˜åº•å±‚æ•°ç»„çš„å¤§å°é€ æˆé‡æ–°åˆ†é…ï¼ŒSDS ä½¿ç”¨äº† **ç©ºé—´é¢„åˆ†é…** å’Œ **æƒ°æ€§ç©ºé—´é‡Šæ”¾** æœºåˆ¶ï¼Œç®€å•ç†è§£å°±æ˜¯æ¯æ¬¡åœ¨æ‰©å±•æ—¶æ˜¯æˆå€çš„å¤šåˆ†é…çš„ï¼Œåœ¨ç¼©å®¹æ˜¯ä¹Ÿæ˜¯å…ˆç•™ç€å¹¶ä¸æ­£å¼å½’è¿˜ç»™ OSï¼›
4. **äºŒè¿›åˆ¶å®‰å…¨**ï¼šC è¯­è¨€å­—ç¬¦ä¸²åªèƒ½ä¿å­˜ `ascii` ç ï¼Œå¯¹äºå›¾ç‰‡ã€éŸ³é¢‘ç­‰ä¿¡æ¯æ— æ³•ä¿å­˜ï¼ŒSDS æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œå†™å…¥ä»€ä¹ˆè¯»å–å°±æ˜¯ä»€ä¹ˆï¼Œä¸åšä»»ä½•è¿‡æ»¤å’Œé™åˆ¶ï¼›

### 48.å­—å…¸æ˜¯å¦‚ä½•å®ç°çš„ï¼ŸRehash äº†è§£å—ï¼Ÿ

å­—å…¸æ˜¯ Redis æœåŠ¡å™¨ä¸­å‡ºç°æœ€ä¸ºé¢‘ç¹çš„å¤åˆå‹æ•°æ®ç»“æ„ã€‚é™¤äº† **hash** ç»“æ„çš„æ•°æ®ä¼šç”¨åˆ°å­—å…¸å¤–ï¼Œæ•´ä¸ª Redis æ•°æ®åº“çš„æ‰€æœ‰ `key` å’Œ `value` ä¹Ÿç»„æˆäº†ä¸€ä¸ª **å…¨å±€å­—å…¸**ï¼Œè¿˜æœ‰å¸¦è¿‡æœŸæ—¶é—´çš„ `key` ä¹Ÿæ˜¯ä¸€ä¸ªå­—å…¸ã€‚_(å­˜å‚¨åœ¨ RedisDb æ•°æ®ç»“æ„ä¸­)_

**å­—å…¸ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ**

**Redis** ä¸­çš„å­—å…¸ç›¸å½“äº Java ä¸­çš„ **HashMap**ï¼Œå†…éƒ¨å®ç°ä¹Ÿå·®ä¸å¤šç±»ä¼¼ï¼Œé‡‡ç”¨å“ˆå¸Œä¸è¿ç®—è®¡ç®—ä¸‹æ ‡ä½ç½®ï¼›é€šè¿‡ **"æ•°ç»„ + é“¾è¡¨" **çš„**é“¾åœ°å€æ³•** æ¥è§£å†³å“ˆå¸Œå†²çªï¼ŒåŒæ—¶è¿™æ ·çš„ç»“æ„ä¹Ÿå¸æ”¶äº†ä¸¤ç§ä¸åŒæ•°æ®ç»“æ„çš„ä¼˜ç‚¹ã€‚

![Rediså­—å…¸ç»“æ„](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-e08347a6-efd5-47c0-9adb-23baff82dbbd.png)

**å­—å…¸æ˜¯æ€ä¹ˆæ‰©å®¹çš„ï¼Ÿ**

å­—å…¸ç»“æ„å†…éƒ¨åŒ…å« **ä¸¤ä¸ª hashtable**ï¼Œé€šå¸¸æƒ…å†µä¸‹åªæœ‰ä¸€ä¸ªå“ˆå¸Œè¡¨ ht[0] æœ‰å€¼ï¼Œåœ¨æ‰©å®¹çš„æ—¶å€™ï¼ŒæŠŠ ht[0]é‡Œçš„å€¼ rehash åˆ° ht[1]ï¼Œç„¶åè¿›è¡Œ **æ¸è¿›å¼ rehash** â€”â€”æ‰€è°“æ¸è¿›å¼ rehashï¼ŒæŒ‡çš„æ˜¯è¿™ä¸ª rehash çš„åŠ¨ä½œå¹¶ä¸æ˜¯ä¸€æ¬¡æ€§ã€é›†ä¸­å¼åœ°å®Œæˆçš„ï¼Œè€Œæ˜¯åˆ†å¤šæ¬¡ã€æ¸è¿›å¼åœ°å®Œæˆçš„ã€‚

å¾…æ¬è¿ç»“æŸåï¼Œh[1]å°±å–ä»£ h[0]å­˜å‚¨å­—å…¸çš„å…ƒç´ ã€‚

### 49.è·³è¡¨æ˜¯å¦‚ä½•å®ç°çš„ï¼ŸåŸç†ï¼Ÿ

è·³è¡¨ï¼ˆskiplistï¼‰æ˜¯ä¸€ç§æœ‰åºçš„æ•°æ®ç»“æ„ï¼Œå®ƒé€šè¿‡åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­ç»´æŒå¤šä¸ªæŒ‡å‘å…¶å®ƒèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä»è€Œè¾¾åˆ°å¿«é€Ÿè®¿é—®èŠ‚ç‚¹çš„ç›®çš„ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šè·³è¡¨](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-08391728-5ba8-42a0-a287-9284451e0ee7.png)

#### ä¸ºä»€ä¹ˆä½¿ç”¨è·³è¡¨ï¼Ÿ

é¦–å…ˆï¼Œå› ä¸º zset è¦æ”¯æŒéšæœºçš„æ’å…¥å’Œåˆ é™¤ï¼Œæ‰€ä»¥å®ƒ **ä¸å®œä½¿ç”¨æ•°ç»„æ¥å®ç°**ï¼Œå…³äºæ’åºé—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆå®¹æ˜“å°±æƒ³åˆ° **çº¢é»‘æ ‘/ å¹³è¡¡æ ‘** è¿™æ ·çš„æ ‘å½¢ç»“æ„ï¼Œä¸ºä»€ä¹ˆ Redis ä¸ä½¿ç”¨è¿™æ ·ä¸€äº›ç»“æ„å‘¢ï¼Ÿ

1. **æ€§èƒ½è€ƒè™‘ï¼š** åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œæ ‘å½¢ç»“æ„éœ€è¦æ‰§è¡Œä¸€äº›ç±»ä¼¼äº rebalance è¿™æ ·çš„å¯èƒ½æ¶‰åŠæ•´æ£µæ ‘çš„æ“ä½œï¼Œç›¸å¯¹æ¥è¯´è·³è·ƒè¡¨çš„å˜åŒ–åªæ¶‰åŠå±€éƒ¨ï¼›
2. **å®ç°è€ƒè™‘ï¼š** åœ¨å¤æ‚åº¦ä¸çº¢é»‘æ ‘ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œè·³è·ƒè¡¨å®ç°èµ·æ¥æ›´ç®€å•ï¼Œçœ‹èµ·æ¥ä¹Ÿæ›´åŠ ç›´è§‚ï¼›

åŸºäºä»¥ä¸Šçš„ä¸€äº›è€ƒè™‘ï¼ŒRedis åŸºäº **William Pugh** çš„è®ºæ–‡åšå‡ºä¸€äº›æ”¹è¿›åé‡‡ç”¨äº† **è·³è·ƒè¡¨** è¿™æ ·çš„ç»“æ„ã€‚

æœ¬è´¨æ˜¯è§£å†³æŸ¥æ‰¾é—®é¢˜ã€‚

#### è·³è·ƒè¡¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ

è·³è·ƒè¡¨çš„èŠ‚ç‚¹é‡Œæœ‰è¿™äº›å…ƒç´ ï¼š

â‘ ã€**å±‚**

è·³è·ƒè¡¨èŠ‚ç‚¹çš„ level æ•°ç»„å¯ä»¥åŒ…å«å¤šä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘å…¶å®ƒèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œç¨‹åºå¯ä»¥é€šè¿‡è¿™äº›å±‚æ¥åŠ å¿«è®¿é—®å…¶å®ƒèŠ‚ç‚¹çš„é€Ÿåº¦ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå±‚çš„æ•°é‡æœˆå¤šï¼Œè®¿é—®å…¶å®ƒèŠ‚ç‚¹çš„é€Ÿåº¦å°±è¶Šå¿«ã€‚

æ¯æ¬¡åˆ›å»ºä¸€ä¸ªæ–°çš„è·³è·ƒè¡¨èŠ‚ç‚¹çš„æ—¶å€™ï¼Œç¨‹åºéƒ½æ ¹æ®å¹‚æ¬¡å®šå¾‹ï¼Œéšæœºç”Ÿæˆä¸€ä¸ªä»‹äº 1 å’Œ 32 ä¹‹é—´çš„å€¼ä½œä¸º level æ•°ç»„çš„å¤§å°ï¼Œè¿™ä¸ªå¤§å°å°±æ˜¯å±‚çš„â€œé«˜åº¦â€

â‘¡ã€**å‰è¿›æŒ‡é’ˆ**

æ¯ä¸ªå±‚éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘è¡¨å°¾çš„å‰è¿›æŒ‡é’ˆï¼ˆ`level[i].forward` å±æ€§ï¼‰ï¼Œç”¨äºä»è¡¨å¤´å‘è¡¨å°¾æ–¹å‘è®¿é—®èŠ‚ç‚¹ã€‚

æˆ‘ä»¬çœ‹ä¸€ä¸‹è·³è·ƒè¡¨ä»è¡¨å¤´åˆ°è¡¨å°¾ï¼Œéå†æ‰€æœ‰èŠ‚ç‚¹çš„è·¯å¾„ï¼š

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šé€šè¿‡å‰è¿›æŒ‡é’ˆéå†](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-b153f782-e2e5-4f98-b251-04f06e16c073.png)

â‘¢ã€**è·¨åº¦**

å±‚çš„è·¨åº¦ç”¨äºè®°å½•ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è·ç¦»ã€‚è·¨åº¦æ˜¯ç”¨æ¥è®¡ç®—æ’ä½ï¼ˆrankï¼‰çš„ï¼šåœ¨æŸ¥æ‰¾æŸä¸ªèŠ‚ç‚¹çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ²¿é€”è®¿é—®è¿‡çš„æ‰€æœ‰å±‚çš„è·¨åº¦ç´¯è®¡èµ·æ¥ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯ç›®æ ‡èŠ‚ç‚¹åœ¨è·³è·ƒè¡¨ä¸­çš„æ’ä½ã€‚

ä¾‹å¦‚æŸ¥æ‰¾ï¼Œåˆ†å€¼ä¸º 3.0ã€æˆå‘˜å¯¹è±¡ä¸º o3 çš„èŠ‚ç‚¹æ—¶ï¼Œæ²¿é€”ç»å†çš„å±‚ï¼šæŸ¥æ‰¾çš„è¿‡ç¨‹åªç»è¿‡äº†ä¸€ä¸ªå±‚ï¼Œå¹¶ä¸”å±‚çš„è·¨åº¦ä¸º 3ï¼Œæ‰€ä»¥ç›®æ ‡èŠ‚ç‚¹åœ¨è·³è·ƒè¡¨ä¸­çš„æ’ä½ä¸º 3ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šè®¡ç®—èŠ‚ç‚¹çš„æ’ä½](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-d2395b7e-2f31-4ca8-b06d-2cb47afaeb74.png)

â‘£ã€**åˆ†å€¼å’Œæˆå‘˜**

èŠ‚ç‚¹çš„åˆ†å€¼ï¼ˆscore å±æ€§ï¼‰æ˜¯ä¸€ä¸ª double ç±»å‹çš„æµ®ç‚¹æ•°ï¼Œè·³è·ƒè¡¨ä¸­æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æŒ‰åˆ†å€¼ä»å°åˆ°å¤§æ¥æ’åºã€‚

èŠ‚ç‚¹çš„æˆå‘˜å¯¹è±¡ï¼ˆobj å±æ€§ï¼‰æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œè€Œå­—ç¬¦ä¸²å¯¹è±¡åˆ™ä¿å­˜è¿™ä¸€ä¸ª SDS å€¼ã€‚

#### ä¸ºä»€ä¹ˆ hash è¡¨èŒƒå›´æŸ¥è¯¢æ•ˆç‡æ¯”è·³è¡¨ä½ï¼Ÿ

å“ˆå¸Œè¡¨æ˜¯ä¸€ç§åŸºäºé”®å€¼å¯¹çš„æ•°æ®ç»“æ„ï¼Œä¸»è¦ç”¨äºå¿«é€ŸæŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚

å“ˆå¸Œè¡¨é€šè¿‡è®¡ç®—é”®çš„å“ˆå¸Œå€¼æ¥ç¡®å®šå€¼çš„å­˜å‚¨ä½ç½®ï¼Œè¿™ä½¿å¾—å®ƒåœ¨å•ä¸ªå…ƒç´ çš„è®¿é—®ä¸Šéå¸¸é«˜æ•ˆï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚

ç„¶è€Œï¼Œå“ˆå¸Œè¡¨å†…çš„å…ƒç´ æ˜¯æ— åºçš„ã€‚å› æ­¤ï¼Œå¯¹äºèŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚æŸ¥æ‰¾æ‰€æœ‰åœ¨æŸä¸ªèŒƒå›´å†…çš„å…ƒç´ ï¼‰ï¼Œå“ˆå¸Œè¡¨æ— æ³•ç›´æ¥æ”¯æŒï¼Œå¿…é¡»éå†æ•´ä¸ªè¡¨æ¥æ£€æŸ¥å“ªäº›å…ƒç´ æ»¡è¶³æ¡ä»¶ï¼Œè¿™ä½¿å¾—å…¶åœ¨èŒƒå›´æŸ¥è¯¢ä¸Šçš„æ•ˆç‡ä½ä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚

è·³è¡¨æ˜¯ä¸€ç§æœ‰åºçš„æ•°æ®ç»“æ„ï¼Œèƒ½å¤Ÿä¿æŒå…ƒç´ çš„æ’åºé¡ºåºã€‚

å®ƒé€šè¿‡å¤šå±‚çš„é“¾è¡¨ç»“æ„å®ç°å¿«é€Ÿçš„æ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾æ“ä½œï¼Œå…¶ä¸­æ¯ä¸€å±‚éƒ½æ˜¯ä¸‹ä¸€å±‚çš„ä¸€ä¸ªå­é›†ï¼Œå¹¶ä¸”å…ƒç´ åœ¨æ¯ä¸€å±‚éƒ½æ˜¯æœ‰åºçš„ã€‚

å½“è¿›è¡ŒèŒƒå›´æŸ¥è¯¢æ—¶ï¼Œè·³è¡¨å¯ä»¥ä»æœ€é«˜å±‚å¼€å§‹ï¼Œå¿«é€Ÿå®šä½åˆ°èŒƒå›´çš„èµ·å§‹ç‚¹ï¼Œç„¶åæ²¿ç€ä¸‹ä¸€å±‚ç»§ç»­ç›´åˆ°æ‰¾åˆ°èŒƒå›´çš„ç»“æŸç‚¹ã€‚è¿™ç§åˆ†å±‚çš„ç»“æ„ä½¿å¾—è·³è¡¨åœ¨è¿›è¡ŒèŒƒå›´æŸ¥è¯¢æ—¶éå¸¸é«˜æ•ˆï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(log n) åŠ ä¸ŠèŒƒå›´å†…å…ƒç´ çš„æ•°é‡ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³æš‘æœŸå®ä¹ åŒå­¦ E ä¸€é¢é¢è¯•åŸé¢˜ï¼šä¸ºä»€ä¹ˆ hash è¡¨èŒƒå›´æŸ¥è¯¢æ•ˆç‡æ¯”è·³è¡¨ä½
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 23 QQ åå°æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šzset çš„åº•å±‚åŸç†

### 50.å‹ç¼©åˆ—è¡¨äº†è§£å—ï¼Ÿ

å‹ç¼©åˆ—è¡¨æ˜¯ Redis **ä¸ºäº†èŠ‚çº¦å†…å­˜** è€Œä½¿ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œæ˜¯ç”±ä¸€ç³»åˆ—ç‰¹æ®Šç¼–ç çš„è¿ç»­å†…å­˜å¿«ç»„æˆçš„é¡ºåºå‹æ•°æ®ç»“æ„ã€‚

ä¸€ä¸ªå‹ç¼©åˆ—è¡¨å¯ä»¥åŒ…å«ä»»æ„å¤šä¸ªèŠ‚ç‚¹ï¼ˆentryï¼‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥ä¿å­˜ä¸€ä¸ªå­—èŠ‚æ•°ç»„æˆ–è€…ä¸€ä¸ªæ•´æ•°å€¼ã€‚

![å‹ç¼©åˆ—è¡¨ç»„æˆéƒ¨åˆ†](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-6be492f7-9f92-4607-a4c4-81a612a3d7bd.png)å‹ç¼©åˆ—è¡¨ç”±è¿™ä¹ˆå‡ éƒ¨åˆ†ç»„æˆï¼š

- **zlbyttes**:è®°å½•æ•´ä¸ªå‹ç¼©åˆ—è¡¨å ç”¨çš„å†…å­˜å­—èŠ‚æ•°
- **zltail**:è®°å½•å‹ç¼©åˆ—è¡¨è¡¨å°¾èŠ‚ç‚¹è·ç¦»å‹ç¼©åˆ—è¡¨çš„èµ·å§‹åœ°å€æœ‰å¤šå°‘å­—èŠ‚
- **zllen**:è®°å½•å‹ç¼©åˆ—è¡¨åŒ…å«çš„èŠ‚ç‚¹æ•°é‡
- **entryX**:åˆ—è¡¨èŠ‚ç‚¹
- **zlend**:ç”¨äºæ ‡è®°å‹ç¼©åˆ—è¡¨çš„æœ«ç«¯

![å‹ç¼©åˆ—è¡¨ç¤ºä¾‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-b5d224c2-53ee-40a3-9efc-2feb7dd3d7a8.png)

### 51.å¿«é€Ÿåˆ—è¡¨ quicklist äº†è§£å—ï¼Ÿ

Redis æ—©æœŸç‰ˆæœ¬å­˜å‚¨ list åˆ—è¡¨æ•°æ®ç»“æ„ä½¿ç”¨çš„æ˜¯å‹ç¼©åˆ—è¡¨ ziplist å’Œæ™®é€šçš„åŒå‘é“¾è¡¨ linkedlistï¼Œä¹Ÿå°±æ˜¯è¯´å½“å…ƒç´ å°‘æ—¶ä½¿ç”¨ ziplistï¼Œå½“å…ƒç´ å¤šæ—¶ç”¨ linkedlistã€‚

ä½†è€ƒè™‘åˆ°é“¾è¡¨çš„é™„åŠ ç©ºé—´ç›¸å¯¹è¾ƒé«˜ï¼Œ`prev` å’Œ `next` æŒ‡é’ˆå°±è¦å å» `16` ä¸ªå­—èŠ‚ï¼ˆ64 ä½æ“ä½œç³»ç»Ÿå ç”¨ `8` ä¸ªå­—èŠ‚ï¼‰ï¼Œå¦å¤–æ¯ä¸ªèŠ‚ç‚¹çš„å†…å­˜éƒ½æ˜¯å•ç‹¬åˆ†é…ï¼Œä¼šå®¶å…·å†…å­˜çš„ç¢ç‰‡åŒ–ï¼Œå½±å“å†…å­˜ç®¡ç†æ•ˆç‡ã€‚

åæ¥ Redis æ–°ç‰ˆæœ¬ï¼ˆ3.2ï¼‰å¯¹åˆ—è¡¨æ•°æ®ç»“æ„è¿›è¡Œäº†æ”¹é€ ï¼Œä½¿ç”¨ `quicklist` ä»£æ›¿äº† `ziplist` å’Œ `linkedlist`ï¼Œquicklist æ˜¯ç»¼åˆè€ƒè™‘äº†æ—¶é—´æ•ˆç‡ä¸ç©ºé—´æ•ˆç‡å¼•å…¥çš„æ–°å‹æ•°æ®ç»“æ„ã€‚

quicklist ç”± list å’Œ ziplist ç»“åˆè€Œæˆï¼Œå®ƒæ˜¯ä¸€ä¸ªç”± ziplist å……å½“èŠ‚ç‚¹çš„åŒå‘é“¾è¡¨ã€‚
![quicklist](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-3b9785b0-6573-4c2d-8b7d-d5d1be799e26.png)

GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹](https://javabetter.cn/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## è¡¥å……

### 52.å‡å¦‚ Redis é‡Œé¢æœ‰ 1 äº¿ä¸ª keyï¼Œå…¶ä¸­æœ‰ 10w ä¸ª key æ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚ä½•å°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Ÿ

ä½¿ç”¨ `keys` æŒ‡ä»¤å¯ä»¥æ‰«å‡ºæŒ‡å®šæ¨¡å¼çš„ key åˆ—è¡¨ã€‚ä½†æ˜¯è¦æ³¨æ„ keys æŒ‡ä»¤ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ä¸€æ®µæ—¶é—´ï¼Œçº¿ä¸ŠæœåŠ¡ä¼šåœé¡¿ï¼Œç›´åˆ°æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ï¼ŒæœåŠ¡æ‰èƒ½æ¢å¤ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨ `scan` æŒ‡ä»¤ï¼Œ`scan` æŒ‡ä»¤å¯ä»¥æ— é˜»å¡çš„æå–å‡ºæŒ‡å®šæ¨¡å¼çš„ `key` åˆ—è¡¨ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€å®šçš„é‡å¤æ¦‚ç‡ï¼Œåœ¨å®¢æˆ·ç«¯åšä¸€æ¬¡å»é‡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æ•´ä½“æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ¯”ç›´æ¥ç”¨ `keys` æŒ‡ä»¤é•¿ã€‚

### 57.Redis çš„ç§’æ€åœºæ™¯ä¸‹æ‰®æ¼”äº†ä»€ä¹ˆè§’è‰²ï¼Ÿï¼ˆè¡¥å……ï¼‰

ç§’æ€ä¸»è¦æ˜¯æŒ‡å¤§é‡ç”¨æˆ·é›†ä¸­åœ¨çŸ­æ—¶é—´å†…å¯¹æœåŠ¡å™¨è¿›è¡Œè®¿é—®ï¼Œä»è€Œå¯¼è‡´æœåŠ¡å™¨è´Ÿè½½å‰§å¢ï¼Œå¯èƒ½å‡ºç°ç³»ç»Ÿå“åº”ç¼“æ…¢ç”šè‡³å´©æºƒçš„æƒ…å†µã€‚

é’ˆå¯¹ç§’æ€çš„åœºæ™¯æ¥è¯´ï¼Œæœ€ç»ˆæŠ¢åˆ°å•†å“çš„ç”¨æˆ·æ˜¯å›ºå®šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ 100 ä¸ªäººå’Œ 10000 ä¸ªäººæ¥æŠ¢ä¸€ä¸ªå•†å“ï¼Œæœ€ç»ˆéƒ½åªèƒ½æœ‰ 100 ä¸ªäººæŠ¢åˆ°ã€‚

ä½†æ˜¯å¯¹äºç§’æ€æ´»åŠ¨çš„åˆå¿ƒæ¥è¯´ï¼Œè‚¯å®šæ˜¯å¸Œæœ›å‚ä¸çš„ç”¨æˆ·è¶Šå¤šè¶Šå¥½ï¼Œä½†çœŸæ­£å¼€å§‹ä¸‹å•æ—¶ï¼Œæœ€å¥½èƒ½æŠŠè¯·æ±‚æ§åˆ¶åœ¨æœåŠ¡å™¨èƒ½å¤Ÿæ‰¿å—çš„èŒƒå›´ä¹‹å†…ï¼ˆğŸ˜‚ï¼‰ã€‚

![è®¸ä»¤æ³¢-ç§’æ€ç³»ç»Ÿçš„è®¾è®¡](https://cdn.tobebetterjavaer.com/stutymore/redis-20240420102552.png)

è§£å†³è¿™ä¸€é—®é¢˜çš„å…³é”®å°±åœ¨äºé”™å³°å‰Šå³°å’Œé™æµã€‚å½“ç„¶äº†ï¼Œå‰ç«¯é¡µé¢çš„é™æ€åŒ–ã€æŒ‰é’®é˜²æŠ–ä¹Ÿèƒ½å¤Ÿæœ‰æ•ˆçš„å‡è½»æœåŠ¡å™¨çš„å‹åŠ›ã€‚

- é¡µé¢é™æ€åŒ–ï¼šå°†å•†å“è¯¦æƒ…ç­‰é¡µé¢é™æ€åŒ–ï¼Œä½¿ç”¨ CDN åˆ†å‘ã€‚
- æŒ‰é’®é˜²æŠ–ï¼šé¿å…ç”¨æˆ·å› é¢‘ç¹ç‚¹å‡»é€ æˆçš„é¢å¤–è¯·æ±‚ï¼Œæ¯”å¦‚è®¾å®šé—´éš”æ—¶é—´åæ‰èƒ½å†æ¬¡ç‚¹å‡»ã€‚

#### å¦‚ä½•å®ç°é”™å³°å‰Šå³°å‘¢ï¼Ÿ

é’ˆå¯¹è½¦æµé‡çš„æ™šé«˜å³°å’Œæ—©é«˜å³°ï¼Œæœ€å¼ºæœ‰åŠ›çš„åŠæ³•å°±æ˜¯é™è¡Œï¼Œä½†é™è¡Œä¸æ˜¯æ— æŸçš„ï¼Œæ¯•ç«Ÿé™è¡Œçš„ç‰Œå·æ— æ³•å‡ºè¡Œã€‚

æ— æŸçš„æ–¹å¼å°±æ˜¯æœ‰çš„è½¦è¾†æ—©å‡ºå‘ï¼Œæœ‰çš„è½¦è¾†æ™šå‡ºå‘ï¼Œè¿™æ ·å°±èƒ½å¤Ÿå®ç°é”™å³°å‡ºè¡Œã€‚

åœ¨ç§’æ€åœºæ™¯ä¸‹ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼å®ç°é”™å³°å‰Šå³°ï¼š

â‘ ã€**é¢„çƒ­ç¼“å­˜**ï¼šæå‰å°†çƒ­ç‚¹æ•°æ®åŠ è½½åˆ° Redis ç¼“å­˜ä¸­ï¼Œå‡å°‘å¯¹æ•°æ®åº“çš„è®¿é—®å‹åŠ›ã€‚

â‘¡ã€**æ¶ˆæ¯é˜Ÿåˆ—**ï¼šå¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå°†è¯·æ±‚å¼‚æ­¥å¤„ç†ï¼Œå‡å°‘ç¬æ—¶è¯·æ±‚å‹åŠ›ã€‚æ¶ˆæ¯é˜Ÿåˆ—å°±åƒä¸€ä¸ªæ°´åº“ï¼Œå¯ä»¥å‰Šå‡ä¸Šæ¸¸çš„æ´ªå³°æµé‡ã€‚

![è®¸ä»¤æ³¢-æ’é˜Ÿ](https://cdn.tobebetterjavaer.com/stutymore/redis-20240420104633.png)

â‘¢ã€**å¤šé˜¶æ®µå¤šæ—¶é—´çª—å£**ï¼šå°†ç§’æ€æ´»åŠ¨åˆ†ä¸ºå¤šä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µè®¾ç½®ä¸åŒçš„æ—¶é—´çª—å£ï¼Œè®©ç”¨æˆ·åœ¨ä¸åŒçš„æ—¶é—´æ®µå†…å‚ä¸ç§’æ€æ´»åŠ¨ã€‚

â‘£ã€**æ’å…¥ç­”é¢˜ç³»ç»Ÿ**ï¼šåœ¨ç§’æ€æ´»åŠ¨ä¸­åŠ å…¥ç­”é¢˜ç¯èŠ‚ï¼Œåªæœ‰ç­”å¯¹é¢˜ç›®çš„ç”¨æˆ·æ‰èƒ½å‚ä¸ç§’æ€æ´»åŠ¨ï¼Œè¿™æ ·å¯ä»¥å‡å°‘æ— æ•ˆè¯·æ±‚ã€‚

![è®¸ä»¤æ³¢-ç­”é¢˜](https://cdn.tobebetterjavaer.com/stutymore/redis-20240420104921.png)

#### å¦‚ä½•é™æµå‘¢ï¼Ÿ

é‡‡ç”¨ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œå®ƒå°±åƒåœ¨å¸éƒ½ä¹°è½¦ï¼Œæ‘‡åˆ°å·æ‰æœ‰èµ„æ ¼ï¼Œæ²¡æ‘‡åˆ°å°±åªèƒ½ç­‰ä¸‹ä¸€æ¬¡ï¼ˆğŸ˜ï¼‰ã€‚

åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç»´æŠ¤ä¸€ä¸ªå®¹å™¨ï¼ŒæŒ‰ç…§å›ºå®šçš„é€Ÿç‡å¾€å®¹å™¨ä¸­æ”¾ä»¤ç‰Œï¼ˆtokenï¼‰ï¼Œå½“è¯·æ±‚åˆ°æ¥æ—¶ï¼Œä»å®¹å™¨ä¸­å–å‡ºä¸€ä¸ªä»¤ç‰Œï¼Œå¦‚æœå®¹å™¨ä¸­æ²¡æœ‰ä»¤ç‰Œï¼Œåˆ™æ‹’ç»è¯·æ±‚ã€‚

![æå­æŒï¼šä»¤ç‰Œæ¡¶](https://cdn.tobebetterjavaer.com/stutymore/redis-20240420114025.png)

ç¬¬ä¸€æ­¥ï¼Œä½¿ç”¨ Redis åˆå§‹åŒ–ä»¤ç‰Œæ¡¶ï¼š

```shell
redis-cli SET "token_bucket" "100"
```

ç¬¬äºŒæ­¥ï¼Œä½¿ç”¨ Lua è„šæœ¬å®ç°ä»¤ç‰Œæ¡¶ç®—æ³•ï¼›å‡è®¾æ¯ç§’å‘æ¡¶ä¸­æ·»åŠ  10 ä¸ªä»¤ç‰Œï¼Œä½†ä¸è¶…è¿‡æ¡¶çš„æœ€å¤§å®¹é‡ã€‚

```lua
-- Lua è„šæœ¬æ¥æ·»åŠ ä»¤ç‰Œï¼Œå¹¶ç¡®ä¿ä¸è¶…è¿‡æœ€å¤§å®¹é‡
local bucket = KEYS[1]
local add_count = tonumber(ARGV[1])
local max_tokens = tonumber(ARGV[2])
local current = tonumber(redis.call('GET', bucket) or 0)
local new_count = math.min(current + add_count, max_tokens)
redis.call('SET', bucket, tostring(new_count))
return new_count
```

ç¬¬ä¸‰æ­¥ï¼Œä½¿ç”¨ Shell è„šæœ¬è°ƒç”¨ Lua è„šæœ¬ï¼š

```shell
#!/bin/bash
while true; do
    redis-cli EVAL "$(cat add_tokens.lua)" 1 token_bucket 10 100
    sleep 1
done
```

ç¬¬å››æ­¥ï¼Œå½“è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œéœ€è¦æ£€æŸ¥å¹¶æ¶ˆè€—ä¸€ä¸ªä»¤ç‰Œã€‚

```lua
-- Lua è„šæœ¬æ¥æ¶ˆè€—ä¸€ä¸ªä»¤ç‰Œ
local bucket = KEYS[1]
local tokens = tonumber(redis.call('GET', bucket) or 0)
if tokens > 0 then
    redis.call('DECR', bucket)
    return 1  -- æˆåŠŸæ¶ˆè€—ä»¤ç‰Œ
else
    return 0  -- ä»¤ç‰Œä¸è¶³
end
```

è°ƒç”¨ Lua è„šæœ¬ï¼š

```shell
redis-cli EVAL "$(cat consume_token.lua)" 1 token_bucket
```

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å†œä¸šé“¶è¡Œé¢ç»åŒå­¦ 3 Java åç«¯é¢è¯•åŸé¢˜ï¼šç§’æ€é—®é¢˜ï¼ˆé”™å³°ã€å‰Šå³°ã€å‰ç«¯ã€æµé‡æ§åˆ¶ï¼‰

---

å›¾æ–‡è¯¦è§£ 56 é“ Redis é¢è¯•é«˜é¢‘é¢˜ï¼Œè¿™æ¬¡åŠæ‰“é¢è¯•å®˜ï¼Œæˆ‘è§‰å¾—ç¨³äº†ï¼ˆæ‰‹åŠ¨ dogï¼‰ã€‚æ•´ç†ï¼šæ²‰é»˜ç‹äºŒï¼Œæˆ³[è½¬è½½é“¾æ¥](https://mp.weixin.qq.com/s/19u34NXALB1nOlBCE6Eg-Q)ï¼Œä½œè€…ï¼šä¸‰åˆ†æ¶ï¼Œæˆ³[åŸæ–‡é“¾æ¥](https://mp.weixin.qq.com/s/iJtNJYgirRugNBnzxkbB4Q)ã€‚

_æ²¡æœ‰ä»€ä¹ˆä½¿æˆ‘åœç•™â€”â€”é™¤äº†ç›®çš„ï¼Œçºµç„¶å²¸æ—æœ‰ç«ç‘°ã€æœ‰ç»¿è«ã€æœ‰å®é™çš„æ¸¯æ¹¾ï¼Œæˆ‘æ˜¯ä¸ç³»ä¹‹èˆŸ_ã€‚

**ç³»åˆ—å†…å®¹**ï¼š

- [é¢æ¸£é€†è¢­ Java SE ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/javase.html)
- [é¢æ¸£é€†è¢­ Java é›†åˆæ¡†æ¶ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/javathread.html)
- [é¢æ¸£é€†è¢­ Java å¹¶å‘ç¼–ç¨‹ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/collection.html)
- [é¢æ¸£é€†è¢­ JVM ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/jvm.html)
- [é¢æ¸£é€†è¢­ Spring ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/spring.html)
- [é¢æ¸£é€†è¢­ Redis ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/redis.html)
- [é¢æ¸£é€†è¢­ MyBatis ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/mybatis.html)
- [é¢æ¸£é€†è¢­ MySQL ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/mysql.html)
- [é¢æ¸£é€†è¢­æ“ä½œç³»ç»Ÿç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/os.html)
- [é¢æ¸£é€†è¢­è®¡ç®—æœºç½‘ç»œç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/network.html)
- [é¢æ¸£é€†è¢­ RocketMQ ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/rocketmq.html)
- [é¢æ¸£é€†è¢­åˆ†å¸ƒå¼ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/fenbushi.html)
- [é¢æ¸£é€†è¢­å¾®æœåŠ¡ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/weifuwu.html)
- [é¢æ¸£é€†è¢­è®¾è®¡æ¨¡å¼ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/shejimoshi.html)
- [é¢æ¸£é€†è¢­ Linux ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/linux.html)

---

GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹](https://javabetter.cn/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)
