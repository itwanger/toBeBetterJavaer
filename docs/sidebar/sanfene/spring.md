---
title: é¢æ¸£é€†è¢­ï¼ˆSpringé¢è¯•é¢˜å…«è‚¡æ–‡ï¼‰å¿…çœ‹ğŸ‘
shortTitle: é¢æ¸£é€†è¢­-Spring
description: å›¾æ–‡è¯¦è§£ 35 é“Springé¢è¯•é«˜é¢‘é¢˜ï¼Œè¿™æ¬¡åŠæ‰“é¢è¯•å®˜ï¼Œæˆ‘è§‰å¾—ç¨³äº†ï¼ˆæ‰‹åŠ¨ dogï¼‰
author: ä¸‰åˆ†æ¶
category:
  - é¢æ¸£é€†è¢­
tag:
  - é¢æ¸£é€†è¢­
head:
  - - meta
    - name: keywords
      content: Springé¢è¯•é¢˜,Spring,é¢è¯•é¢˜,å…«è‚¡æ–‡,java
---

> å›¾æ–‡è¯¦è§£ 35 é“Springé¢è¯•é«˜é¢‘é¢˜ï¼Œè¿™æ¬¡åŠæ‰“é¢è¯•å®˜ï¼Œæˆ‘è§‰å¾—ç¨³äº†ï¼ˆæ‰‹åŠ¨ dogï¼‰ã€‚æ•´ç†ï¼šæ²‰é»˜ç‹äºŒï¼Œæˆ³[è½¬è½½é“¾æ¥](https://mp.weixin.qq.com/s/EQge6DmgIqYITM3mAxkatg)ï¼Œä½œè€…ï¼šä¸‰åˆ†æ¶ï¼Œæˆ³[åŸæ–‡é“¾æ¥](https://mp.weixin.qq.com/s/Y17S85ntHm_MLTZMJdtjQQ)ã€‚

## åŸºç¡€

### 1.Spring æ˜¯ä»€ä¹ˆï¼Ÿç‰¹æ€§ï¼Ÿæœ‰å“ªäº›æ¨¡å—ï¼Ÿ

![Spring Logo](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-165c27b4-2ea0-409a-8fa5-389c105db0fa.png)

ä¸€å¥è¯æ¦‚æ‹¬ï¼š**Spring æ˜¯ä¸€ä¸ªè½»é‡çº§ã€éå…¥ä¾µå¼çš„æ§åˆ¶åè½¬ (IoC) å’Œé¢å‘åˆ‡é¢ (AOP) çš„æ¡†æ¶ã€‚**

2003 å¹´ï¼Œä¸€ä¸ªéŸ³ä¹å®¶ Rod Johnson å†³å®šå‘å±•ä¸€ä¸ªè½»é‡çº§çš„ Java å¼€å‘æ¡†æ¶ï¼Œ`Spring`ä½œä¸º Java æˆ˜åœºçš„é¾™éª‘å…µæ¸æ¸å´›èµ·ï¼Œå¹¶æ·˜æ±°äº†`EJB`è¿™ä¸ªä¼ ç»Ÿçš„é‡è£…éª‘å…µã€‚

![Springé‡è¦ç‰ˆæœ¬](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-5d9efb93-03a5-400c-8429-3be7c5eeddfb.png)

åˆ°äº†ç°åœ¨ï¼Œä¼ä¸šçº§å¼€å‘çš„æ ‡é…åŸºæœ¬å°±æ˜¯ **Spring5** + **Spring Boot 2** + **JDK 8**

> Spring æœ‰å“ªäº›ç‰¹æ€§å‘¢ï¼Ÿ

Spring æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼š

![Springç‰¹æ€§](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-a0f0ef9d-3289-41ea-94c2-34b7e37ef854.png)

1.  **IOC** å’Œ **DI** çš„æ”¯æŒ

Spring çš„æ ¸å¿ƒå°±æ˜¯ä¸€ä¸ªå¤§çš„å·¥å‚å®¹å™¨ï¼Œå¯ä»¥ç»´æŠ¤æ‰€æœ‰å¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–å…³ç³»ï¼ŒSpring å·¥å‚ç”¨äºç”Ÿæˆ Beanï¼Œå¹¶ä¸”ç®¡ç† Bean çš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ç°**é«˜å†…èšä½è€¦åˆ**çš„è®¾è®¡ç†å¿µã€‚

2.  AOP ç¼–ç¨‹çš„æ”¯æŒ

Spring æä¾›äº†**é¢å‘åˆ‡é¢ç¼–ç¨‹**ï¼Œå¯ä»¥æ–¹ä¾¿çš„å®ç°å¯¹ç¨‹åºè¿›è¡Œæƒé™æ‹¦æˆªã€è¿è¡Œç›‘æ§ç­‰åˆ‡é¢åŠŸèƒ½ã€‚

3.  å£°æ˜å¼äº‹åŠ¡çš„æ”¯æŒ

æ”¯æŒé€šè¿‡é…ç½®å°±æ¥å®Œæˆå¯¹äº‹åŠ¡çš„ç®¡ç†ï¼Œè€Œä¸éœ€è¦é€šè¿‡ç¡¬ç¼–ç çš„æ–¹å¼ï¼Œä»¥å‰é‡å¤çš„ä¸€äº›äº‹åŠ¡æäº¤ã€å›æ»šçš„ JDBC ä»£ç ï¼Œéƒ½å¯ä»¥ä¸ç”¨è‡ªå·±å†™äº†ã€‚

4.  å¿«æ·æµ‹è¯•çš„æ”¯æŒ

Spring å¯¹ Junit æä¾›æ”¯æŒï¼Œå¯ä»¥é€šè¿‡**æ³¨è§£**å¿«æ·åœ°æµ‹è¯• Spring ç¨‹åºã€‚

5.  å¿«é€Ÿé›†æˆåŠŸèƒ½

æ–¹ä¾¿é›†æˆå„ç§ä¼˜ç§€æ¡†æ¶ï¼ŒSpring ä¸æ’æ–¥å„ç§ä¼˜ç§€çš„å¼€æºæ¡†æ¶ï¼Œå…¶å†…éƒ¨æä¾›äº†å¯¹å„ç§ä¼˜ç§€æ¡†æ¶ï¼ˆå¦‚ï¼šStrutsã€Hibernateã€MyBatisã€Quartz ç­‰ï¼‰çš„ç›´æ¥æ”¯æŒã€‚

6.  å¤æ‚ API æ¨¡æ¿å°è£…

Spring å¯¹ JavaEE å¼€å‘ä¸­éå¸¸éš¾ç”¨çš„ä¸€äº› APIï¼ˆJDBCã€JavaMailã€è¿œç¨‹è°ƒç”¨ç­‰ï¼‰éƒ½æä¾›äº†æ¨¡æ¿åŒ–çš„å°è£…ï¼Œè¿™äº›å°è£… API çš„æä¾›ä½¿å¾—åº”ç”¨éš¾åº¦å¤§å¤§é™ä½ã€‚

### 2.Spring æœ‰å“ªäº›æ¨¡å—å‘¢ï¼Ÿ

Spring æ¡†æ¶æ˜¯åˆ†æ¨¡å—å­˜åœ¨ï¼Œé™¤äº†æœ€æ ¸å¿ƒçš„`Spring Core Container`æ˜¯å¿…è¦æ¨¡å—ä¹‹å¤–ï¼Œå…¶ä»–æ¨¡å—éƒ½æ˜¯`å¯é€‰`ï¼Œå¤§çº¦æœ‰ 20 å¤šä¸ªæ¨¡å—ã€‚

![Springæ¨¡å—åˆ’åˆ†](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-bb7c13ea-3174-4b32-84b8-821849ddc377.png)

æœ€ä¸»è¦çš„ä¸ƒå¤§æ¨¡å—ï¼š

1.  **Spring Core**ï¼šSpring æ ¸å¿ƒï¼Œå®ƒæ˜¯æ¡†æ¶æœ€åŸºç¡€çš„éƒ¨åˆ†ï¼Œæä¾› IOC å’Œä¾èµ–æ³¨å…¥ DI ç‰¹æ€§ã€‚
2.  **Spring Context**ï¼šSpring ä¸Šä¸‹æ–‡å®¹å™¨ï¼Œå®ƒæ˜¯ BeanFactory åŠŸèƒ½åŠ å¼ºçš„ä¸€ä¸ªå­æ¥å£ã€‚
3.  **Spring Web**ï¼šå®ƒæä¾› Web åº”ç”¨å¼€å‘çš„æ”¯æŒã€‚
4.  **Spring MVC**ï¼šå®ƒé’ˆå¯¹ Web åº”ç”¨ä¸­ MVC æ€æƒ³çš„å®ç°ã€‚
5.  **Spring DAO**ï¼šæä¾›å¯¹ JDBC æŠ½è±¡å±‚ï¼Œç®€åŒ–äº† JDBC ç¼–ç ï¼ŒåŒæ—¶ï¼Œç¼–ç æ›´å…·æœ‰å¥å£®æ€§ã€‚
6.  **Spring ORM**ï¼šå®ƒæ”¯æŒç”¨äºæµè¡Œçš„ ORM æ¡†æ¶çš„æ•´åˆï¼Œæ¯”å¦‚ï¼šSpring + Hibernateã€Spring + iBatisã€Spring + JDO çš„æ•´åˆç­‰ã€‚
7.  **Spring AOP**ï¼šå³é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œå®ƒæä¾›äº†ä¸ AOP è”ç›Ÿå…¼å®¹çš„ç¼–ç¨‹å®ç°ã€‚

### 3.Spring æœ‰å“ªäº›å¸¸ç”¨æ³¨è§£å‘¢ï¼Ÿ

Spring æœ‰å¾ˆå¤šæ¨¡å—ï¼Œç”šè‡³å¹¿ä¹‰çš„ SpringBootã€SpringCloud ä¹Ÿç®—æ˜¯ Spring çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬æ¥åˆ†æ¨¡å—ï¼ŒæŒ‰åŠŸèƒ½æ¥çœ‹ä¸€ä¸‹ä¸€äº›å¸¸ç”¨çš„æ³¨è§£ï¼š

![Springå¸¸ç”¨æ³¨è§£](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-8d0a1518-a425-4887-9735-45321095d927.png)

**Web**:

- @Controllerï¼šç»„åˆæ³¨è§£ï¼ˆç»„åˆäº†@Component æ³¨è§£ï¼‰ï¼Œåº”ç”¨åœ¨ MVC å±‚ï¼ˆæ§åˆ¶å±‚ï¼‰ã€‚
- @RestControllerï¼šè¯¥æ³¨è§£ä¸ºä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œç›¸å½“äº@Controller å’Œ@ResponseBody çš„ç»„åˆï¼Œæ³¨è§£åœ¨ç±»ä¸Šï¼Œæ„å‘³ç€ï¼Œè¯¥ Controller çš„æ‰€æœ‰æ–¹æ³•éƒ½é»˜è®¤åŠ ä¸Šäº†@ResponseBodyã€‚
- @RequestMappingï¼šç”¨äºæ˜ å°„ Web è¯·æ±‚ï¼ŒåŒ…æ‹¬è®¿é—®è·¯å¾„å’Œå‚æ•°ã€‚å¦‚æœæ˜¯ Restful é£æ ¼æ¥å£ï¼Œè¿˜å¯ä»¥æ ¹æ®è¯·æ±‚ç±»å‹ä½¿ç”¨ä¸åŒçš„æ³¨è§£ï¼š
  - @GetMapping
  - @PostMapping
  - @PutMapping
  - @DeleteMapping
- @ResponseBodyï¼šæ”¯æŒå°†è¿”å›å€¼æ”¾åœ¨ response å†…ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªé¡µé¢ï¼Œé€šå¸¸ç”¨æˆ·è¿”å› json æ•°æ®ã€‚
- @RequestBodyï¼šå…è®¸ request çš„å‚æ•°åœ¨ request ä½“ä¸­ï¼Œè€Œä¸æ˜¯åœ¨ç›´æ¥è¿æ¥åœ¨åœ°å€åé¢ã€‚
- @PathVariableï¼šç”¨äºæ¥æ”¶è·¯å¾„å‚æ•°ï¼Œæ¯”å¦‚ `@RequestMapping(â€œ/hello/{name}â€)`ç”³æ˜çš„è·¯å¾„ï¼Œå°†æ³¨è§£æ”¾åœ¨å‚æ•°ä¸­å‰ï¼Œå³å¯è·å–è¯¥å€¼ï¼Œé€šå¸¸ä½œä¸º Restful çš„æ¥å£å®ç°æ–¹æ³•ã€‚
- @RestControllerï¼šè¯¥æ³¨è§£ä¸ºä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œç›¸å½“äº@Controller å’Œ@ResponseBody çš„ç»„åˆï¼Œæ³¨è§£åœ¨ç±»ä¸Šï¼Œæ„å‘³ç€ï¼Œè¯¥ Controller çš„æ‰€æœ‰æ–¹æ³•éƒ½é»˜è®¤åŠ ä¸Šäº†@ResponseBodyã€‚

**å®¹å™¨**:

- @Componentï¼šè¡¨ç¤ºä¸€ä¸ªå¸¦æ³¨é‡Šçš„ç±»æ˜¯ä¸€ä¸ªâ€œç»„ä»¶â€ï¼Œæˆä¸º Spring ç®¡ç†çš„ Beanã€‚å½“ä½¿ç”¨åŸºäºæ³¨è§£çš„é…ç½®å’Œç±»è·¯å¾„æ‰«ææ—¶ï¼Œè¿™äº›ç±»è¢«è§†ä¸ºè‡ªåŠ¨æ£€æµ‹çš„å€™é€‰å¯¹è±¡ã€‚åŒæ—¶@Component è¿˜æ˜¯ä¸€ä¸ªå…ƒæ³¨è§£ã€‚
- @Serviceï¼šç»„åˆæ³¨è§£ï¼ˆç»„åˆäº†@Component æ³¨è§£ï¼‰ï¼Œåº”ç”¨åœ¨ service å±‚ï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰ã€‚
- @Repositoryï¼šç»„åˆæ³¨è§£ï¼ˆç»„åˆäº†@Component æ³¨è§£ï¼‰ï¼Œåº”ç”¨åœ¨ dao å±‚ï¼ˆæ•°æ®è®¿é—®å±‚ï¼‰ã€‚
- @Autowiredï¼šSpring æä¾›çš„å·¥å…·ï¼ˆç”± Spring çš„ä¾èµ–æ³¨å…¥å·¥å…·ï¼ˆBeanPostProcessorã€BeanFactoryPostProcessorï¼‰è‡ªåŠ¨æ³¨å…¥ï¼‰ã€‚
- @Qualifierï¼šè¯¥æ³¨è§£é€šå¸¸è·Ÿ @Autowired ä¸€èµ·ä½¿ç”¨ï¼Œå½“æƒ³å¯¹æ³¨å…¥çš„è¿‡ç¨‹åšæ›´å¤šçš„æ§åˆ¶ï¼Œ@Qualifier å¯å¸®åŠ©é…ç½®ï¼Œæ¯”å¦‚ä¸¤ä¸ªä»¥ä¸Šç›¸åŒç±»å‹çš„ Bean æ—¶ Spring æ— æ³•æŠ‰æ‹©ï¼Œç”¨åˆ°æ­¤æ³¨è§£
- @Configurationï¼šå£°æ˜å½“å‰ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼ˆç›¸å½“äºä¸€ä¸ª Spring é…ç½®çš„ xml æ–‡ä»¶ï¼‰
- @Valueï¼šå¯ç”¨åœ¨å­—æ®µï¼Œæ„é€ å™¨å‚æ•°è·Ÿæ–¹æ³•å‚æ•°ï¼ŒæŒ‡å®šä¸€ä¸ªé»˜è®¤å€¼ï¼Œæ”¯æŒ `#{} è·Ÿ \${}` ä¸¤ä¸ªæ–¹å¼ã€‚ä¸€èˆ¬å°† SpringbBoot ä¸­çš„ application.properties é…ç½®çš„å±æ€§å€¼èµ‹å€¼ç»™å˜é‡ã€‚
- @Beanï¼šæ³¨è§£åœ¨æ–¹æ³•ä¸Šï¼Œå£°æ˜å½“å‰æ–¹æ³•çš„è¿”å›å€¼ä¸ºä¸€ä¸ª Beanã€‚è¿”å›çš„ Bean å¯¹åº”çš„ç±»ä¸­å¯ä»¥å®šä¹‰ init()æ–¹æ³•å’Œ destroy()æ–¹æ³•ï¼Œç„¶ååœ¨`@Bean(initMethod=â€initâ€,destroyMethod=â€destroyâ€)`å®šä¹‰ï¼Œåœ¨æ„é€ ä¹‹åæ‰§è¡Œ initï¼Œåœ¨é”€æ¯ä¹‹å‰æ‰§è¡Œ destroyã€‚
- @Scope:å®šä¹‰æˆ‘ä»¬é‡‡ç”¨ä»€ä¹ˆæ¨¡å¼å»åˆ›å»º Beanï¼ˆæ–¹æ³•ä¸Šï¼Œå¾—æœ‰@Beanï¼‰ å…¶è®¾ç½®ç±»å‹åŒ…æ‹¬ï¼šSingleton ã€Prototypeã€Request ã€ Sessionã€GlobalSessionã€‚

**AOP**:

- @Aspect:å£°æ˜ä¸€ä¸ªåˆ‡é¢ï¼ˆç±»ä¸Šï¼‰ ä½¿ç”¨@Afterã€@Beforeã€@Around å®šä¹‰å»ºè¨€ï¼ˆadviceï¼‰ï¼Œå¯ç›´æ¥å°†æ‹¦æˆªè§„åˆ™ï¼ˆåˆ‡ç‚¹ï¼‰ä½œä¸ºå‚æ•°ã€‚
  - `@After` ï¼šåœ¨æ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œï¼ˆæ–¹æ³•ä¸Šï¼‰ã€‚
  - `@Before`ï¼š åœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œï¼ˆæ–¹æ³•ä¸Šï¼‰ã€‚
  - `@Around`ï¼š åœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰ä¸ä¹‹åæ‰§è¡Œï¼ˆæ–¹æ³•ä¸Šï¼‰ã€‚
  - `@PointCut`ï¼š å£°æ˜åˆ‡ç‚¹ åœ¨ java é…ç½®ç±»ä¸­ä½¿ç”¨@EnableAspectJAutoProxy æ³¨è§£å¼€å¯ Spring å¯¹ AspectJ ä»£ç†çš„æ”¯æŒï¼ˆç±»ä¸Šï¼‰ã€‚

**äº‹åŠ¡ï¼š**

- @Transactionalï¼šåœ¨è¦å¼€å¯äº‹åŠ¡çš„æ–¹æ³•ä¸Šä½¿ç”¨@Transactional æ³¨è§£ï¼Œå³å¯å£°æ˜å¼å¼€å¯äº‹åŠ¡ã€‚

### 4.Spring ä¸­åº”ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼å‘¢ï¼Ÿ

Spring æ¡†æ¶ä¸­å¹¿æ³›ä½¿ç”¨äº†ä¸åŒç±»å‹çš„è®¾è®¡æ¨¡å¼ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹åˆ°åº•æœ‰å“ªäº›è®¾è®¡æ¨¡å¼?

![Springä¸­ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-ee1c5cee-8462-4bae-93ea-ec936cc77640.png)

1. **å·¥å‚æ¨¡å¼** : Spring å®¹å™¨æœ¬è´¨æ˜¯ä¸€ä¸ªå¤§å·¥å‚ï¼Œä½¿ç”¨å·¥å‚æ¨¡å¼é€šè¿‡ BeanFactoryã€ApplicationContext åˆ›å»º bean å¯¹è±¡ã€‚
2. **ä»£ç†æ¨¡å¼** : Spring AOP åŠŸèƒ½åŠŸèƒ½å°±æ˜¯é€šè¿‡ä»£ç†æ¨¡å¼æ¥å®ç°çš„ï¼Œåˆ†ä¸ºåŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†ã€‚
3. **å•ä¾‹æ¨¡å¼** : Spring ä¸­çš„ Bean é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ï¼Œè¿™æ ·æœ‰åˆ©äºå®¹å™¨å¯¹ Bean çš„ç®¡ç†ã€‚
4. **æ¨¡æ¿æ¨¡å¼** : Spring ä¸­ JdbcTemplateã€RestTemplate ç­‰ä»¥ Template ç»“å°¾çš„å¯¹æ•°æ®åº“ã€ç½‘ç»œç­‰ç­‰è¿›è¡Œæ“ä½œçš„æ¨¡æ¿ç±»ï¼Œå°±ä½¿ç”¨åˆ°äº†æ¨¡æ¿æ¨¡å¼ã€‚
5. **è§‚å¯Ÿè€…æ¨¡å¼**: Spring äº‹ä»¶é©±åŠ¨æ¨¡å‹å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼å¾ˆç»å…¸çš„ä¸€ä¸ªåº”ç”¨ã€‚
6. **é€‚é…å™¨æ¨¡å¼** :Spring AOP çš„å¢å¼ºæˆ–é€šçŸ¥ (Advice) ä½¿ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼ã€Spring MVC ä¸­ä¹Ÿæ˜¯ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼é€‚é… Controllerã€‚
7. **ç­–ç•¥æ¨¡å¼**ï¼šSpring ä¸­æœ‰ä¸€ä¸ª Resource æ¥å£ï¼Œå®ƒçš„ä¸åŒå®ç°ç±»ï¼Œä¼šæ ¹æ®ä¸åŒçš„ç­–ç•¥å»è®¿é—®èµ„æºã€‚

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)


å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## IOC

### 5.è¯´ä¸€è¯´ä»€ä¹ˆæ˜¯ IOCï¼Ÿä»€ä¹ˆæ˜¯ DI?

Java æ˜¯é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ï¼Œä¸€ä¸ªä¸ªå®ä¾‹å¯¹è±¡ç›¸äº’åˆä½œç»„æˆäº†ä¸šåŠ¡é€»è¾‘ï¼ŒåŸæ¥ï¼Œæˆ‘ä»¬éƒ½æ˜¯åœ¨ä»£ç é‡Œåˆ›å»ºå¯¹è±¡å’Œå¯¹è±¡çš„ä¾èµ–ã€‚

æ‰€è°“çš„**IOC**ï¼ˆæ§åˆ¶åè½¬ï¼‰ï¼šå°±æ˜¯ç”±å®¹å™¨æ¥è´Ÿè´£æ§åˆ¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œå¯¹è±¡é—´çš„å…³ç³»ã€‚ä»¥å‰æ˜¯æˆ‘ä»¬æƒ³è¦ä»€ä¹ˆï¼Œå°±è‡ªå·±åˆ›å»ºä»€ä¹ˆï¼Œç°åœ¨æ˜¯æˆ‘ä»¬éœ€è¦ä»€ä¹ˆï¼Œå®¹å™¨å°±ç»™æˆ‘ä»¬é€æ¥ä»€ä¹ˆã€‚

![å¼•å…¥IOCä¹‹å‰å’Œå¼•å…¥IOCä¹‹å](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-619da277-c15e-4dd7-9f2b-dbd809a9aaa0.png)

ä¹Ÿå°±æ˜¯è¯´ï¼Œæ§åˆ¶å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„ä¸å†æ˜¯å¼•ç”¨å®ƒçš„å¯¹è±¡ï¼Œè€Œæ˜¯å®¹å™¨ã€‚å¯¹å…·ä½“å¯¹è±¡ï¼Œä»¥å‰æ˜¯å®ƒæ§åˆ¶å…¶å®ƒå¯¹è±¡ï¼Œç°åœ¨æ‰€æœ‰å¯¹è±¡éƒ½è¢«å®¹å™¨æ§åˆ¶ï¼Œæ‰€ä»¥è¿™å°±å«**æ§åˆ¶åè½¬**ã€‚

![æ§åˆ¶åè½¬ç¤ºæ„å›¾](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-440f5d0e-f4db-462c-97fb-d54407a354d5.png)

**DIï¼ˆä¾èµ–æ³¨å…¥ï¼‰**ï¼šæŒ‡çš„æ˜¯å®¹å™¨åœ¨å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™æŠŠå®ƒä¾èµ–çš„ç±»æ³¨å…¥ç»™å®ƒã€‚æœ‰çš„è¯´æ³• IOC å’Œ DI æ˜¯ä¸€å›äº‹ï¼Œæœ‰çš„è¯´æ³•æ˜¯ IOC æ˜¯æ€æƒ³ï¼ŒDI æ˜¯ IOC çš„å®ç°ã€‚

> **ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ IOC å‘¢ï¼Ÿ**

æœ€ä¸»è¦çš„æ˜¯ä¸¤ä¸ªå­—**è§£è€¦**ï¼Œç¡¬ç¼–ç ä¼šé€ æˆå¯¹è±¡é—´çš„è¿‡åº¦è€¦åˆï¼Œä½¿ç”¨ IOC ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç”¨å…³å¿ƒå¯¹è±¡é—´çš„ä¾èµ–ï¼Œä¸“å¿ƒå¼€å‘åº”ç”¨å°±è¡Œã€‚

### 6.èƒ½ç®€å•è¯´ä¸€ä¸‹ Spring IOC çš„å®ç°æœºåˆ¶å—ï¼Ÿ

PS:è¿™é“é¢˜è€ä¸‰åœ¨é¢è¯•ä¸­è¢«é—®åˆ°è¿‡ï¼Œé—®æ³•æ˜¯â€œ**ä½ æœ‰è‡ªå·±å®ç°è¿‡ç®€å•çš„ Spring å—ï¼Ÿ**â€

Spring çš„ IOC æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå¤§å·¥å‚ï¼Œæˆ‘ä»¬æƒ³æƒ³ä¸€ä¸ªå·¥å‚æ˜¯æ€ä¹ˆè¿è¡Œçš„å‘¢ï¼Ÿ

![å·¥å‚è¿è¡Œ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-7678c40f-a48d-4bd5-80f8-e902ad688e11.png)

- **ç”Ÿäº§äº§å“**ï¼šä¸€ä¸ªå·¥å‚æœ€æ ¸å¿ƒçš„åŠŸèƒ½å°±æ˜¯ç”Ÿäº§äº§å“ã€‚åœ¨ Spring é‡Œï¼Œä¸ç”¨ Bean è‡ªå·±æ¥å®ä¾‹åŒ–ï¼Œè€Œæ˜¯äº¤ç»™ Springï¼Œåº”è¯¥æ€ä¹ˆå®ç°å‘¢ï¼Ÿâ€”â€”ç­”æ¡ˆæ¯«æ— ç–‘é—®ï¼Œ**åå°„**ã€‚

  é‚£ä¹ˆè¿™ä¸ªå‚å­çš„ç”Ÿäº§ç®¡ç†æ˜¯æ€ä¹ˆåšçš„ï¼Ÿä½ åº”è¯¥ä¹ŸçŸ¥é“â€”â€”**å·¥å‚æ¨¡å¼**ã€‚

- **åº“å­˜äº§å“**ï¼šå·¥å‚ä¸€èˆ¬éƒ½æ˜¯æœ‰åº“æˆ¿çš„ï¼Œç”¨æ¥åº“å­˜äº§å“ï¼Œæ¯•ç«Ÿç”Ÿäº§çš„äº§å“ä¸èƒ½ç«‹é©¬å°±æ‹‰èµ°ã€‚Spring æˆ‘ä»¬éƒ½çŸ¥é“æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œè¿™ä¸ªå®¹å™¨é‡Œå­˜çš„å°±æ˜¯å¯¹è±¡ï¼Œä¸èƒ½æ¯æ¬¡æ¥å–å¯¹è±¡ï¼Œéƒ½å¾—ç°åœºæ¥åå°„åˆ›å»ºå¯¹è±¡ï¼Œå¾—æŠŠåˆ›å»ºå‡ºçš„å¯¹è±¡å­˜èµ·æ¥ã€‚

- **è®¢å•å¤„ç†**ï¼šè¿˜æœ‰æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œå·¥å‚æ ¹æ®ä»€ä¹ˆæ¥æä¾›äº§å“å‘¢ï¼Ÿè®¢å•ã€‚è¿™äº›è®¢å•å¯èƒ½äº”èŠ±å…«é—¨ï¼Œæœ‰çº¿ä¸Šç­¾ç­¾çš„ã€æœ‰åˆ°å·¥å‚ç­¾çš„ã€è¿˜æœ‰å·¥å‚é”€å”®ä¸Šé—¨ç­¾çš„â€¦â€¦æœ€åç»è¿‡å¤„ç†ï¼ŒæŒ‡å¯¼å·¥å‚çš„å‡ºè´§ã€‚

  åœ¨ Spring é‡Œï¼Œä¹Ÿæœ‰è¿™æ ·çš„è®¢å•ï¼Œå®ƒå°±æ˜¯æˆ‘ä»¬ bean çš„å®šä¹‰å’Œä¾èµ–å…³ç³»ï¼Œå¯ä»¥æ˜¯ xml å½¢å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯æˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„æ³¨è§£å½¢å¼ã€‚

æˆ‘ä»¬ç®€å•åœ°å®ç°ä¸€ä¸ª mini ç‰ˆçš„ Spring IOCï¼š

![miniç‰ˆæœ¬Spring IOC](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-1d55c63d-2d12-43b1-9f43-428f5f4a1413.png)

**Bean å®šä¹‰ï¼š**

Bean é€šè¿‡ä¸€ä¸ªé…ç½®æ–‡ä»¶å®šä¹‰ï¼ŒæŠŠå®ƒè§£ææˆä¸€ä¸ªç±»å‹ã€‚

- beans.properties

  å·æ‡’ï¼Œè¿™é‡Œç›´æ¥ç”¨äº†æœ€æ–¹ä¾¿è§£æçš„ propertiesï¼Œè¿™é‡Œç›´æ¥ç”¨ä¸€ä¸ª`<key,value>`ç±»å‹çš„é…ç½®æ¥ä»£è¡¨ Bean çš„å®šä¹‰ï¼Œå…¶ä¸­ key æ˜¯ beanNameï¼Œvalue æ˜¯ class

  ```java
  userDao:cn.fighter3.bean.UserDao
  ```

- BeanDefinition.java

  bean å®šä¹‰ç±»ï¼Œé…ç½®æ–‡ä»¶ä¸­ bean å®šä¹‰å¯¹åº”çš„å®ä½“

  ```java
  public class BeanDefinition {

      private String beanName;

      private Class beanClass;
       //çœç•¥getterã€setter
   }
  ```

- ResourceLoader.java

  èµ„æºåŠ è½½å™¨ï¼Œç”¨æ¥å®Œæˆé…ç½®æ–‡ä»¶ä¸­é…ç½®çš„åŠ è½½

  ```java
  public class ResourceLoader {

      public static Map<String, BeanDefinition> getResource() {
          Map<String, BeanDefinition> beanDefinitionMap = new HashMap<>(16);
          Properties properties = new Properties();
          try {
              InputStream inputStream = ResourceLoader.class.getResourceAsStream("/beans.properties");
              properties.load(inputStream);
              Iterator<String> it = properties.stringPropertyNames().iterator();
              while (it.hasNext()) {
                  String key = it.next();
                  String className = properties.getProperty(key);
                  BeanDefinition beanDefinition = new BeanDefinition();
                  beanDefinition.setBeanName(key);
                  Class clazz = Class.forName(className);
                  beanDefinition.setBeanClass(clazz);
                  beanDefinitionMap.put(key, beanDefinition);
              }
              inputStream.close();
          } catch (IOException | ClassNotFoundException e) {
              e.printStackTrace();
          }
          return beanDefinitionMap;
      }

  }
  ```

- BeanRegister.java

  å¯¹è±¡æ³¨å†Œå™¨ï¼Œè¿™é‡Œç”¨äºå•ä¾‹ bean çš„ç¼“å­˜ï¼Œæˆ‘ä»¬å¤§å¹…ç®€åŒ–ï¼Œé»˜è®¤æ‰€æœ‰ bean éƒ½æ˜¯å•ä¾‹çš„ã€‚å¯ä»¥çœ‹åˆ°æ‰€è°“å•ä¾‹æ³¨å†Œï¼Œä¹Ÿå¾ˆç®€å•ï¼Œä¸è¿‡æ˜¯å¾€ HashMap é‡Œå­˜å¯¹è±¡ã€‚

  ```java
  public class BeanRegister {

      //å•ä¾‹Beanç¼“å­˜
      private Map<String, Object> singletonMap = new HashMap<>(32);

      /**
       * è·å–å•ä¾‹Bean
       *
       * @param beanName beanåç§°
       * @return
       */
      public Object getSingletonBean(String beanName) {
          return singletonMap.get(beanName);
      }

      /**
       * æ³¨å†Œå•ä¾‹bean
       *
       * @param beanName
       * @param bean
       */
      public void registerSingletonBean(String beanName, Object bean) {
          if (singletonMap.containsKey(beanName)) {
              return;
          }
          singletonMap.put(beanName, bean);
      }

  }
  ```

- **BeanFactory.java**

![BeanFactory](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-c6b3b707-cf53-4c7c-a6f9-8560950806fc.png)

  - å¯¹è±¡å·¥å‚ï¼Œæˆ‘ä»¬æœ€**æ ¸å¿ƒ**çš„ä¸€ä¸ªç±»ï¼Œåœ¨å®ƒåˆå§‹åŒ–çš„æ—¶å€™ï¼Œåˆ›å»ºäº† bean æ³¨å†Œå™¨ï¼Œå®Œæˆäº†èµ„æºçš„åŠ è½½ã€‚

  - è·å– bean çš„æ—¶å€™ï¼Œå…ˆä»å•ä¾‹ç¼“å­˜ä¸­å–ï¼Œå¦‚æœæ²¡æœ‰å–åˆ°ï¼Œå°±åˆ›å»ºå¹¶æ³¨å†Œä¸€ä¸ª bean

    ```java
    public class BeanFactory {

        private Map<String, BeanDefinition> beanDefinitionMap = new HashMap<>();

        private BeanRegister beanRegister;

        public BeanFactory() {
            //åˆ›å»ºbeanæ³¨å†Œå™¨
            beanRegister = new BeanRegister();
            //åŠ è½½èµ„æº
            this.beanDefinitionMap = new ResourceLoader().getResource();
        }

        /**
         * è·å–bean
         *
         * @param beanName beanåç§°
         * @return
         */
        public Object getBean(String beanName) {
            //ä»beanç¼“å­˜ä¸­å–
            Object bean = beanRegister.getSingletonBean(beanName);
            if (bean != null) {
                return bean;
            }
            //æ ¹æ®beanå®šä¹‰ï¼Œåˆ›å»ºbean
            return createBean(beanDefinitionMap.get(beanName));
        }

        /**
         * åˆ›å»ºBean
         *
         * @param beanDefinition beanå®šä¹‰
         * @return
         */
        private Object createBean(BeanDefinition beanDefinition) {
            try {
                Object bean = beanDefinition.getBeanClass().newInstance();
                //ç¼“å­˜bean
                beanRegister.registerSingletonBean(beanDefinition.getBeanName(), bean);
                return bean;
            } catch (InstantiationException | IllegalAccessException e) {
                e.printStackTrace();
            }
            return null;
        }
    }
    ```

- æµ‹è¯•

  - UserDao.java

    æˆ‘ä»¬çš„ Bean ç±»ï¼Œå¾ˆç®€å•

    ```java
    public class UserDao {

        public void queryUserInfo(){
            System.out.println("A good man.");
        }
    }
    ```

  - å•å…ƒæµ‹è¯•

    ```java
    public class ApiTest {
        @Test
        public void test_BeanFactory() {
            //1.åˆ›å»ºbeanå·¥å‚(åŒæ—¶å®Œæˆäº†åŠ è½½èµ„æºã€åˆ›å»ºæ³¨å†Œå•ä¾‹beanæ³¨å†Œå™¨çš„æ“ä½œ)
            BeanFactory beanFactory = new BeanFactory();

            //2.ç¬¬ä¸€æ¬¡è·å–beanï¼ˆé€šè¿‡åå°„åˆ›å»ºbeanï¼Œç¼“å­˜beanï¼‰
            UserDao userDao1 = (UserDao) beanFactory.getBean("userDao");
            userDao1.queryUserInfo();

            //3.ç¬¬äºŒæ¬¡è·å–beanï¼ˆä»ç¼“å­˜ä¸­è·å–beanï¼‰
            UserDao userDao2 = (UserDao) beanFactory.getBean("userDao");
            userDao2.queryUserInfo();
        }
    }
    ```

  - è¿è¡Œç»“æœ

    ```java
    A good man.
    A good man.
    ```

è‡³æ­¤ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¹ä¸+ç ´èˆ¹ç‰ˆçš„ Spring å°±å®Œæˆäº†ï¼Œä»£ç ä¹Ÿæ¯”è¾ƒå®Œæ•´ï¼Œæœ‰æ¡ä»¶çš„å¯ä»¥è·‘ä¸€ä¸‹ã€‚

PS:å› ä¸ºæ—¶é—´+ç¯‡å¹…çš„é™åˆ¶ï¼Œè¿™ä¸ª demo æ¯”è¾ƒç®€é™‹ï¼Œæ²¡æœ‰é¢å‘æ¥å£ã€æ²¡æœ‰è§£è€¦ã€è¾¹ç•Œæ£€æŸ¥ã€å¼‚å¸¸å¤„ç†â€¦â€¦å¥å£®æ€§ã€æ‰©å±•æ€§éƒ½æœ‰å¾ˆå¤§çš„ä¸è¶³ï¼Œæ„Ÿå…´è¶£å¯ä»¥å­¦ä¹ å‚è€ƒ[15]ã€‚

### 7.è¯´è¯´ BeanFactory å’Œ ApplicantContext?

å¯ä»¥è¿™ä¹ˆå½¢å®¹ï¼ŒBeanFactory æ˜¯ Spring çš„â€œå¿ƒè„â€ï¼ŒApplicantContext æ˜¯å®Œæ•´çš„â€œèº«èº¯â€ã€‚

![BeanFactoryå’ŒApplicantContextçš„æ¯”å–»](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-66328446-f89f-4b7a-8d9f-0e1145dd9b2f.png)

- BeanFactoryï¼ˆBean å·¥å‚ï¼‰æ˜¯ Spring æ¡†æ¶çš„åŸºç¡€è®¾æ–½ï¼Œé¢å‘ Spring æœ¬èº«ã€‚
- ApplicantContextï¼ˆåº”ç”¨ä¸Šä¸‹æ–‡ï¼‰å»ºç«‹åœ¨ BeanFactoty åŸºç¡€ä¸Šï¼Œé¢å‘ä½¿ç”¨ Spring æ¡†æ¶çš„å¼€å‘è€…ã€‚

###### BeanFactory æ¥å£

BeanFactory æ˜¯ç±»çš„é€šç”¨å·¥å‚ï¼Œå¯ä»¥åˆ›å»ºå¹¶ç®¡ç†å„ç§ç±»çš„å¯¹è±¡ã€‚

Spring ä¸º BeanFactory æä¾›äº†å¾ˆå¤šç§å®ç°ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ XmlBeanFactoryï¼Œä½†åœ¨ Spring 3.2 ä¸­å·²è¢«åºŸå¼ƒï¼Œå»ºè®®ä½¿ç”¨ XmlBeanDefinitionReaderã€DefaultListableBeanFactoryã€‚

![Spring5 BeanFactoryç»§æ‰¿ä½“ç³»](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-6e6d4b69-f36c-41e6-b8ba-9277be147c9b.png)

BeanFactory æ¥å£ä½äºç±»ç»“æ„æ ‘çš„é¡¶ç«¯ï¼Œå®ƒæœ€ä¸»è¦çš„æ–¹æ³•å°±æ˜¯ getBean(String var1)ï¼Œè¿™ä¸ªæ–¹æ³•ä»å®¹å™¨ä¸­è¿”å›ç‰¹å®šåç§°çš„ Beanã€‚

BeanFactory çš„åŠŸèƒ½é€šè¿‡å…¶å®ƒçš„æ¥å£å¾—åˆ°äº†ä¸æ–­çš„æ‰©å±•ï¼Œæ¯”å¦‚ AbstractAutowireCapableBeanFactory å®šä¹‰äº†å°†å®¹å™¨ä¸­çš„ Bean æŒ‰ç…§æŸç§è§„åˆ™ï¼ˆæ¯”å¦‚æŒ‰åå­—åŒ¹é…ã€æŒ‰ç±»å‹åŒ¹é…ç­‰ï¼‰è¿›è¡Œè‡ªåŠ¨è£…é…çš„æ–¹æ³•ã€‚

è¿™é‡Œçœ‹ä¸€ä¸ª XMLBeanFactoryï¼ˆå·²è¿‡æœŸï¼‰ è·å– bean çš„ä¾‹å­ï¼š

```java
public class HelloWorldApp{
   public static void main(String[] args) {
      BeanFactory factory = new XmlBeanFactory (new ClassPathResource("beans.xml"));
      HelloWorld obj = (HelloWorld) factory.getBean("helloWorld");
      obj.getMessage();
   }
}
```

###### ApplicationContext æ¥å£

ApplicationContext ç”± BeanFactory æ´¾ç”Ÿè€Œæ¥ï¼Œæä¾›äº†æ›´å¤šé¢å‘å®é™…åº”ç”¨çš„åŠŸèƒ½ã€‚å¯ä»¥è¿™ä¹ˆè¯´ï¼Œä½¿ç”¨ BeanFactory å°±æ˜¯æ‰‹åŠ¨æ¡£ï¼Œä½¿ç”¨ ApplicationContext å°±æ˜¯è‡ªåŠ¨æ¡£ã€‚

![Spring5 ApplicationContextéƒ¨åˆ†ä½“ç³»ç±»å›¾](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-e201c9a3-f23c-4768-b844-ac7e0ba4bcec.png)

ApplicationContext ç»§æ‰¿äº† HierachicalBeanFactory å’Œ ListableBeanFactory æ¥å£ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼Œè¿˜é€šè¿‡å…¶ä»–çš„æ¥å£æ‰©å±•äº† BeanFactory çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

- Bean instantiation/wiring

- Bean çš„å®ä¾‹åŒ–/ä¸²è”
- è‡ªåŠ¨çš„ BeanPostProcessor æ³¨å†Œ
- è‡ªåŠ¨çš„ BeanFactoryPostProcessor æ³¨å†Œ
- æ–¹ä¾¿çš„ MessageSource è®¿é—®ï¼ˆi18nï¼‰
- ApplicationEvent çš„å‘å¸ƒä¸ BeanFactory æ‡’åŠ è½½çš„æ–¹å¼ä¸åŒï¼Œå®ƒæ˜¯é¢„åŠ è½½ï¼Œæ‰€ä»¥ï¼Œæ¯ä¸€ä¸ª bean éƒ½åœ¨ ApplicationContext å¯åŠ¨ä¹‹åå®ä¾‹åŒ–

è¿™æ˜¯ ApplicationContext çš„ä½¿ç”¨ä¾‹å­ï¼š

```java
public class HelloWorldApp{
   public static void main(String[] args) {
      ApplicationContext context=new ClassPathXmlApplicationContext("beans.xml");
      HelloWorld obj = (HelloWorld) context.getBean("helloWorld");
      obj.getMessage();
   }
}
```

ApplicationContext åŒ…å« BeanFactory çš„æ‰€æœ‰ç‰¹æ€§ï¼Œé€šå¸¸æ¨èä½¿ç”¨å‰è€…ã€‚

### 8.ä½ çŸ¥é“ Spring å®¹å™¨å¯åŠ¨é˜¶æ®µä¼šå¹²ä»€ä¹ˆå—ï¼Ÿ

PSï¼šè¿™é“é¢˜è€ä¸‰é¢è¯•è¢«é—®åˆ°è¿‡

Spring çš„ IOC å®¹å™¨å·¥ä½œçš„è¿‡ç¨‹ï¼Œå…¶å®å¯ä»¥åˆ’åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š**å®¹å™¨å¯åŠ¨é˜¶æ®µ**å’Œ**Bean å®ä¾‹åŒ–é˜¶æ®µ**ã€‚

å…¶ä¸­å®¹å™¨å¯åŠ¨é˜¶æ®µä¸»è¦åšçš„å·¥ä½œæ˜¯åŠ è½½å’Œè§£æé…ç½®æ–‡ä»¶ï¼Œä¿å­˜åˆ°å¯¹åº”çš„ Bean å®šä¹‰ä¸­ã€‚

![å®¹å™¨å¯åŠ¨å’ŒBeanå®ä¾‹åŒ–é˜¶æ®µ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-8f8103f7-2a51-4858-856e-96a4ac400d76.png)

å®¹å™¨å¯åŠ¨å¼€å§‹ï¼Œé¦–å…ˆä¼šé€šè¿‡æŸç§é€”å¾„åŠ è½½ Congiguration MetaDataï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå®¹å™¨éœ€è¦ä¾èµ–æŸäº›å·¥å…·ç±»ï¼ˆBeanDefinitionReaderï¼‰å¯¹åŠ è½½çš„ Congiguration MetaData è¿›è¡Œè§£æå’Œåˆ†æï¼Œå¹¶å°†åˆ†æåçš„ä¿¡æ¯ç»„ä¸ºç›¸åº”çš„ BeanDefinitionã€‚

![xmlé…ç½®ä¿¡æ¯æ˜ å°„æ³¨å†Œè¿‡ç¨‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-dfb3d8c4-ba8d-4a2c-aef2-4ad425f7180c.png)

æœ€åæŠŠè¿™äº›ä¿å­˜äº† Bean å®šä¹‰å¿…è¦ä¿¡æ¯çš„ BeanDefinitionï¼Œæ³¨å†Œåˆ°ç›¸åº”çš„ BeanDefinitionRegistryï¼Œè¿™æ ·å®¹å™¨å¯åŠ¨å°±å®Œæˆäº†ã€‚

### 9.èƒ½è¯´ä¸€ä¸‹ Spring Bean ç”Ÿå‘½å‘¨æœŸå—ï¼Ÿ

å¯ä»¥çœ‹çœ‹ï¼š[Spring Bean ç”Ÿå‘½å‘¨æœŸï¼Œå¥½åƒäººçš„ä¸€ç”Ÿã€‚ã€‚](https://mp.weixin.qq.com/s/zb6eA3Se0gQoqL8PylCPLw)

åœ¨ Spring ä¸­ï¼ŒåŸºæœ¬å®¹å™¨ BeanFactory å’Œæ‰©å±•å®¹å™¨ ApplicationContext çš„å®ä¾‹åŒ–æ—¶æœºä¸å¤ªä¸€æ ·ï¼ŒBeanFactory é‡‡ç”¨çš„æ˜¯å»¶è¿Ÿåˆå§‹åŒ–çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯åªæœ‰åœ¨ç¬¬ä¸€æ¬¡ getBean()çš„æ—¶å€™ï¼Œæ‰ä¼šå®ä¾‹åŒ– Beanï¼›ApplicationContext å¯åŠ¨ä¹‹åä¼šå®ä¾‹åŒ–æ‰€æœ‰çš„ Bean å®šä¹‰ã€‚

Spring IOC ä¸­ Bean çš„ç”Ÿå‘½å‘¨æœŸå¤§è‡´åˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼š**å®ä¾‹åŒ–**ï¼ˆInstantiationï¼‰ã€**å±æ€§èµ‹å€¼**ï¼ˆPopulateï¼‰ã€**åˆå§‹åŒ–**ï¼ˆInitializationï¼‰ã€**é”€æ¯**ï¼ˆDestructionï¼‰ã€‚

![Beanç”Ÿå‘½å‘¨æœŸå››ä¸ªé˜¶æ®µ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-595fce5b-36cb-4dcb-b08c-8205a1e98d8a.png)

æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªç¨å¾®è¯¦ç»†ä¸€äº›çš„è¿‡ç¨‹ï¼š

- **å®ä¾‹åŒ–**ï¼šç¬¬ 1 æ­¥ï¼Œå®ä¾‹åŒ–ä¸€ä¸ª Bean å¯¹è±¡
- **å±æ€§èµ‹å€¼**ï¼šç¬¬ 2 æ­¥ï¼Œä¸º Bean è®¾ç½®ç›¸å…³å±æ€§å’Œä¾èµ–
- **åˆå§‹åŒ–**ï¼šåˆå§‹åŒ–çš„é˜¶æ®µçš„æ­¥éª¤æ¯”è¾ƒå¤šï¼Œ5ã€6 æ­¥æ˜¯çœŸæ­£çš„åˆå§‹åŒ–ï¼Œç¬¬ 3ã€4 æ­¥ä¸ºåœ¨åˆå§‹åŒ–å‰æ‰§è¡Œï¼Œç¬¬ 7 æ­¥åœ¨åˆå§‹åŒ–åæ‰§è¡Œï¼Œåˆå§‹åŒ–å®Œæˆä¹‹åï¼ŒBean å°±å¯ä»¥è¢«ä½¿ç”¨äº†
- **é”€æ¯**ï¼šç¬¬ 8~10 æ­¥ï¼Œç¬¬ 8 æ­¥å…¶å®ä¹Ÿå¯ä»¥ç®—åˆ°é”€æ¯é˜¶æ®µï¼Œä½†ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„é”€æ¯ï¼Œè€Œæ˜¯å…ˆåœ¨ä½¿ç”¨å‰æ³¨å†Œäº†é”€æ¯çš„ç›¸å…³è°ƒç”¨æ¥å£ï¼Œä¸ºäº†åé¢ç¬¬ 9ã€10 æ­¥çœŸæ­£é”€æ¯ Bean æ—¶å†æ‰§è¡Œç›¸åº”çš„æ–¹æ³•

![SpringBeanç”Ÿå‘½å‘¨æœŸ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-942a927a-86e4-4a01-8f52-9addd89642ff.png)

ç®€å•æ€»ç»“ä¸€ä¸‹ï¼ŒBean ç”Ÿå‘½å‘¨æœŸé‡Œåˆå§‹åŒ–çš„è¿‡ç¨‹ç›¸å¯¹æ­¥éª¤ä¼šå¤šä¸€äº›ï¼Œæ¯”å¦‚å‰ç½®ã€åç½®çš„å¤„ç†ã€‚

æœ€åé€šè¿‡ä¸€ä¸ªå®ä¾‹æ¥çœ‹ä¸€ä¸‹å…·ä½“çš„ç»†èŠ‚ï¼š
![Beanä¸€ç”Ÿå®ä¾‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-a3b7714e-38f2-433d-97c6-acb1d20f2887.png)

- å®šä¹‰ä¸€ä¸ª`PersonBean`ç±»ï¼Œå®ç°`DisposableBean`,`InitializingBean`, `BeanFactoryAware`, `BeanNameAware`è¿™ 4 ä¸ªæ¥å£ï¼ŒåŒæ—¶è¿˜æœ‰è‡ªå®šä¹‰çš„`init-method`å’Œ`destroy-method`ã€‚

```java
public class PersonBean implements InitializingBean, BeanFactoryAware, BeanNameAware, DisposableBean {

    /**
     * èº«ä»½è¯å·
     */
    private Integer no;

    /**
     * å§“å
     */
    private String name;

    public PersonBean() {
        System.out.println("1.è°ƒç”¨æ„é€ æ–¹æ³•ï¼šæˆ‘å‡ºç”Ÿäº†ï¼");
    }

    public Integer getNo() {
        return no;
    }

    public void setNo(Integer no) {
        this.no = no;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
        System.out.println("2.è®¾ç½®å±æ€§ï¼šæˆ‘çš„åå­—å«"+name);
    }

    @Override
    public void setBeanName(String s) {
        System.out.println("3.è°ƒç”¨BeanNameAware#setBeanNameæ–¹æ³•:æˆ‘è¦ä¸Šå­¦äº†ï¼Œèµ·äº†ä¸ªå­¦å");
    }

    @Override
    public void setBeanFactory(BeanFactory beanFactory) throws BeansException {
        System.out.println("4.è°ƒç”¨BeanFactoryAware#setBeanFactoryæ–¹æ³•ï¼šé€‰å¥½å­¦æ ¡äº†");
    }

    @Override
    public void afterPropertiesSet() throws Exception {
        System.out.println("6.InitializingBean#afterPropertiesSetæ–¹æ³•ï¼šå…¥å­¦ç™»è®°");
    }

    public void init() {
        System.out.println("7.è‡ªå®šä¹‰initæ–¹æ³•ï¼šåŠªåŠ›ä¸Šå­¦ing");
    }

    @Override
    public void destroy() throws Exception {
        System.out.println("9.DisposableBean#destroyæ–¹æ³•ï¼šå¹³æ·¡çš„ä¸€ç”Ÿè½å¹•äº†");
    }

    public void destroyMethod() {
        System.out.println("10.è‡ªå®šä¹‰destroyæ–¹æ³•:ç¡äº†ï¼Œåˆ«æƒ³å«é†’æˆ‘");
    }

    public void work(){
        System.out.println("Beanä½¿ç”¨ä¸­ï¼šå·¥ä½œï¼Œåªæœ‰å¯¹ç¤¾ä¼šæ²¡æœ‰ç”¨çš„äººæ‰æ”¾å‡ã€‚ã€‚");
    }

}
```

- å®šä¹‰ä¸€ä¸ª`MyBeanPostProcessor`å®ç°`BeanPostProcessor`æ¥å£ã€‚

```java
public class MyBeanPostProcessor implements BeanPostProcessor {

    @Override
    public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {
        System.out.println("5.BeanPostProcessor.postProcessBeforeInitializationæ–¹æ³•ï¼šåˆ°å­¦æ ¡æŠ¥åå•¦");
        return bean;
    }

    @Override
    public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
        System.out.println("8.BeanPostProcessor#postProcessAfterInitializationæ–¹æ³•ï¼šç»ˆäºæ¯•ä¸šï¼Œæ‹¿åˆ°æ¯•ä¸šè¯å•¦ï¼");
        return bean;
    }
}

```

- é…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®š`init-method`å’Œ`destroy-method`å±æ€§

```java
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean name="myBeanPostProcessor" class="cn.fighter3.spring.life.MyBeanPostProcessor" />
    <bean name="personBean" class="cn.fighter3.spring.life.PersonBean"
          init-method="init" destroy-method="destroyMethod">
        <property name="idNo" value= "80669865"/>
        <property name="name" value="å¼ é“é’¢" />
    </bean>

</beans>
```

- æµ‹è¯•

```java
public class Main {

    public static void main(String[] args) {
        ApplicationContext context = new ClassPathXmlApplicationContext("spring-config.xml");
        PersonBean personBean = (PersonBean) context.getBean("personBean");
        personBean.work();
        ((ClassPathXmlApplicationContext) context).destroy();
    }
}

```

- è¿è¡Œç»“æœï¼š

```java
1.è°ƒç”¨æ„é€ æ–¹æ³•ï¼šæˆ‘å‡ºç”Ÿäº†ï¼
2.è®¾ç½®å±æ€§ï¼šæˆ‘çš„åå­—å«å¼ é“é’¢
3.è°ƒç”¨BeanNameAware#setBeanNameæ–¹æ³•:æˆ‘è¦ä¸Šå­¦äº†ï¼Œèµ·äº†ä¸ªå­¦å
4.è°ƒç”¨BeanFactoryAware#setBeanFactoryæ–¹æ³•ï¼šé€‰å¥½å­¦æ ¡äº†
5.BeanPostProcessor#postProcessBeforeInitializationæ–¹æ³•ï¼šåˆ°å­¦æ ¡æŠ¥åå•¦
6.InitializingBean#afterPropertiesSetæ–¹æ³•ï¼šå…¥å­¦ç™»è®°
7.è‡ªå®šä¹‰initæ–¹æ³•ï¼šåŠªåŠ›ä¸Šå­¦ing
8.BeanPostProcessor#postProcessAfterInitializationæ–¹æ³•ï¼šç»ˆäºæ¯•ä¸šï¼Œæ‹¿åˆ°æ¯•ä¸šè¯å•¦ï¼
Beanä½¿ç”¨ä¸­ï¼šå·¥ä½œï¼Œåªæœ‰å¯¹ç¤¾ä¼šæ²¡æœ‰ç”¨çš„äººæ‰æ”¾å‡ã€‚ã€‚
9.DisposableBean#destroyæ–¹æ³•ï¼šå¹³æ·¡çš„ä¸€ç”Ÿè½å¹•äº†
10.è‡ªå®šä¹‰destroyæ–¹æ³•:ç¡äº†ï¼Œåˆ«æƒ³å«é†’æˆ‘
```

å…³äºæºç ï¼ŒBean åˆ›å»ºè¿‡ç¨‹å¯ä»¥æŸ¥çœ‹`AbstractBeanFactory#doGetBean`æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œå¯ä»¥çœ‹åˆ° Bean çš„å®ä¾‹åŒ–ï¼Œèµ‹å€¼ã€åˆå§‹åŒ–çš„è¿‡ç¨‹ï¼Œè‡³äºæœ€ç»ˆçš„é”€æ¯ï¼Œå¯ä»¥çœ‹çœ‹`ConfigurableApplicationContext#close()`ã€‚

![Beanç”Ÿå‘½å‘¨æœŸæºç è¿½è¸ª](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-d2da20a3-08d0-4648-b9a3-2fff8512b159.png)

### 10.Bean å®šä¹‰å’Œä¾èµ–å®šä¹‰æœ‰å“ªäº›æ–¹å¼ï¼Ÿ

æœ‰ä¸‰ç§æ–¹å¼ï¼š**ç›´æ¥ç¼–ç æ–¹å¼**ã€**é…ç½®æ–‡ä»¶æ–¹å¼**ã€**æ³¨è§£æ–¹å¼**ã€‚

![Beanä¾èµ–é…ç½®æ–¹å¼](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-89f0f50d-a9e4-4dec-b267-cb1a526cb340.png)

- ç›´æ¥ç¼–ç æ–¹å¼ï¼šæˆ‘ä»¬ä¸€èˆ¬æ¥è§¦ä¸åˆ°ç›´æ¥ç¼–ç çš„æ–¹å¼ï¼Œä½†å…¶å®å…¶å®ƒçš„æ–¹å¼æœ€ç»ˆéƒ½è¦é€šè¿‡ç›´æ¥ç¼–ç æ¥å®ç°ã€‚
- é…ç½®æ–‡ä»¶æ–¹å¼ï¼šé€šè¿‡ xmlã€propreties ç±»å‹çš„é…ç½®æ–‡ä»¶ï¼Œé…ç½®ç›¸åº”çš„ä¾èµ–å…³ç³»ï¼ŒSpring è¯»å–é…ç½®æ–‡ä»¶ï¼Œå®Œæˆä¾èµ–å…³ç³»çš„æ³¨å…¥ã€‚
- æ³¨è§£æ–¹å¼ï¼šæ³¨è§£æ–¹å¼åº”è¯¥æ˜¯æˆ‘ä»¬ç”¨çš„æœ€å¤šçš„ä¸€ç§æ–¹å¼äº†ï¼Œåœ¨ç›¸åº”çš„åœ°æ–¹ä½¿ç”¨æ³¨è§£ä¿®é¥°ï¼ŒSpring ä¼šæ‰«ææ³¨è§£ï¼Œå®Œæˆä¾èµ–å…³ç³»çš„æ³¨å…¥ã€‚

### 11.æœ‰å“ªäº›ä¾èµ–æ³¨å…¥çš„æ–¹æ³•ï¼Ÿ

Spring æ”¯æŒ**æ„é€ æ–¹æ³•æ³¨å…¥**ã€**å±æ€§æ³¨å…¥**ã€**å·¥å‚æ–¹æ³•æ³¨å…¥**,å…¶ä¸­å·¥å‚æ–¹æ³•æ³¨å…¥ï¼Œåˆå¯ä»¥åˆ†ä¸º**é™æ€å·¥å‚æ–¹æ³•æ³¨å…¥**å’Œ**éé™æ€å·¥å‚æ–¹æ³•æ³¨å…¥**ã€‚

![Springä¾èµ–æ³¨å…¥æ–¹æ³•](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-491f8444-54ba-4628-b8eb-8418a2197096.png)

- **æ„é€ æ–¹æ³•æ³¨å…¥**

  é€šè¿‡è°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•ï¼Œå°†æ¥å£å®ç°ç±»é€šè¿‡æ„é€ æ–¹æ³•å˜é‡ä¼ å…¥

  ```java
   public CatDaoImpl(String message){
     this. message = message;
   }
  ```

  ```java
  <bean id="CatDaoImpl" class="com.CatDaoImpl">
    <constructor-arg value=" message "></constructor-arg>
  </bean>
  ```

- **å±æ€§æ³¨å…¥**

  é€šè¿‡ Setter æ–¹æ³•å®Œæˆè°ƒç”¨ç±»æ‰€éœ€ä¾èµ–çš„æ³¨å…¥

  ```java
   public class Id {
      private int id;

      public int getId() { return id; }

      public void setId(int id) { this.id = id; }
  }
  ```

  ```java
  <bean id="id" class="com.id ">
    <property name="id" value="123"></property>
  </bean>
  ```

- **å·¥å‚æ–¹æ³•æ³¨å…¥**

  - **é™æ€å·¥å‚æ³¨å…¥**

    é™æ€å·¥å‚é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯é€šè¿‡è°ƒç”¨é™æ€å·¥å‚çš„æ–¹æ³•æ¥è·å–è‡ªå·±éœ€è¦çš„å¯¹è±¡ï¼Œä¸ºäº†è®© Spring ç®¡ç†æ‰€æœ‰å¯¹è±¡ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥é€šè¿‡"å·¥ç¨‹ç±».é™æ€æ–¹æ³•()"æ¥è·å–å¯¹è±¡ï¼Œè€Œæ˜¯ä¾ç„¶é€šè¿‡ Spring æ³¨å…¥çš„å½¢å¼è·å–ï¼š

    ```java
    public class DaoFactory { //é™æ€å·¥å‚

       public static final FactoryDao getStaticFactoryDaoImpl(){
          return new StaticFacotryDaoImpl();
       }
    }

    public class SpringAction {

     //æ³¨å…¥å¯¹è±¡
     private FactoryDao staticFactoryDao;

     //æ³¨å…¥å¯¹è±¡çš„ set æ–¹æ³•
     public void setStaticFactoryDao(FactoryDao staticFactoryDao) {
         this.staticFactoryDao = staticFactoryDao;
     }

    }
    ```

    ```java
    //factory-method="getStaticFactoryDaoImpl"æŒ‡å®šè°ƒç”¨å“ªä¸ªå·¥å‚æ–¹æ³•
     <bean name="springAction" class=" SpringAction" >
       <!--ä½¿ç”¨é™æ€å·¥å‚çš„æ–¹æ³•æ³¨å…¥å¯¹è±¡,å¯¹åº”ä¸‹é¢çš„é…ç½®æ–‡ä»¶-->
       <property name="staticFactoryDao" ref="staticFactoryDao"></property>
     </bean>

     <!--æ­¤å¤„è·å–å¯¹è±¡çš„æ–¹å¼æ˜¯ä»å·¥å‚ç±»ä¸­è·å–é™æ€æ–¹æ³•-->
    <bean name="staticFactoryDao" class="DaoFactory"
      factory-method="getStaticFactoryDaoImpl"></bean>
    ```

  - **éé™æ€å·¥å‚æ³¨å…¥**

    éé™æ€å·¥å‚ï¼Œä¹Ÿå«å®ä¾‹å·¥å‚ï¼Œæ„æ€æ˜¯å·¥å‚æ–¹æ³•ä¸æ˜¯é™æ€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é¦–å…ˆ new ä¸€ä¸ªå·¥å‚å®ä¾‹ï¼Œå†è°ƒç”¨æ™®é€šçš„å®ä¾‹æ–¹æ³•ã€‚

    ```java
    //éé™æ€å·¥å‚
    public class DaoFactory {
       public FactoryDao getFactoryDaoImpl(){
         return new FactoryDaoImpl();
       }
     }

    public class SpringAction {
      //æ³¨å…¥å¯¹è±¡
      private FactoryDao factoryDao;

      public void setFactoryDao(FactoryDao factoryDao) {
        this.factoryDao = factoryDao;
      }
    }
    ```

    ```java
     <bean name="springAction" class="SpringAction">
       <!--ä½¿ç”¨éé™æ€å·¥å‚çš„æ–¹æ³•æ³¨å…¥å¯¹è±¡,å¯¹åº”ä¸‹é¢çš„é…ç½®æ–‡ä»¶-->
       <property name="factoryDao" ref="factoryDao"></property>
     </bean>

     <!--æ­¤å¤„è·å–å¯¹è±¡çš„æ–¹å¼æ˜¯ä»å·¥å‚ç±»ä¸­è·å–å®ä¾‹æ–¹æ³•-->
     <bean name="daoFactory" class="com.DaoFactory"></bean>

    <bean name="factoryDao" factory-bean="daoFactory" factory-method="getFactoryDaoImpl"></bean>
    ```

### 12.Spring æœ‰å“ªäº›è‡ªåŠ¨è£…é…çš„æ–¹å¼ï¼Ÿ

> **ä»€ä¹ˆæ˜¯è‡ªåŠ¨è£…é…ï¼Ÿ**

Spring IOC å®¹å™¨çŸ¥é“æ‰€æœ‰ Bean çš„é…ç½®ä¿¡æ¯ï¼Œæ­¤å¤–ï¼Œé€šè¿‡ Java åå°„æœºåˆ¶è¿˜å¯ä»¥è·çŸ¥å®ç°ç±»çš„ç»“æ„ä¿¡æ¯ï¼Œå¦‚æ„é€ æ–¹æ³•çš„ç»“æ„ã€å±æ€§ç­‰ä¿¡æ¯ã€‚æŒæ¡æ‰€æœ‰ Bean çš„è¿™äº›ä¿¡æ¯åï¼ŒSpring IOC å®¹å™¨å°±å¯ä»¥æŒ‰ç…§æŸç§è§„åˆ™å¯¹å®¹å™¨ä¸­çš„ Bean è¿›è¡Œè‡ªåŠ¨è£…é…ï¼Œè€Œæ— é¡»é€šè¿‡æ˜¾å¼çš„æ–¹å¼è¿›è¡Œä¾èµ–é…ç½®ã€‚

Spring æä¾›çš„è¿™ç§æ–¹å¼ï¼Œå¯ä»¥æŒ‰ç…§æŸäº›è§„åˆ™è¿›è¡Œ Bean çš„è‡ªåŠ¨è£…é…ï¼Œ`<bean>`å…ƒç´ æä¾›äº†ä¸€ä¸ªæŒ‡å®šè‡ªåŠ¨è£…é…ç±»å‹çš„å±æ€§ï¼š`autowire="<è‡ªåŠ¨è£…é…ç±»å‹>"`

> **Spring æä¾›äº†å“ªå‡ ç§è‡ªåŠ¨è£…é…ç±»å‹ï¼Ÿ**

Spring æä¾›äº† 4 ç§è‡ªåŠ¨è£…é…ç±»å‹ï¼š

![Springå››ç§è‡ªåŠ¨è£…é…ç±»å‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-034120d9-88c7-490b-af07-7d48f3b6b7bc.png)

- **byName**ï¼šæ ¹æ®åç§°è¿›è¡Œè‡ªåŠ¨åŒ¹é…ï¼Œå‡è®¾ Boss åˆä¸€ä¸ªåä¸º car çš„å±æ€§ï¼Œå¦‚æœå®¹å™¨ä¸­åˆšå¥½æœ‰ä¸€ä¸ªåä¸º car çš„ beanï¼ŒSpring å°±ä¼šè‡ªåŠ¨å°†å…¶è£…é…ç»™ Boss çš„ car å±æ€§
- **byType**ï¼šæ ¹æ®ç±»å‹è¿›è¡Œè‡ªåŠ¨åŒ¹é…ï¼Œå‡è®¾ Boss æœ‰ä¸€ä¸ª Car ç±»å‹çš„å±æ€§ï¼Œå¦‚æœå®¹å™¨ä¸­åˆšå¥½æœ‰ä¸€ä¸ª Car ç±»å‹çš„ Beanï¼ŒSpring å°±ä¼šè‡ªåŠ¨å°†å…¶è£…é…ç»™ Boss è¿™ä¸ªå±æ€§
- **constructor**ï¼šä¸ byType ç±»ä¼¼ï¼Œ åªä¸è¿‡å®ƒæ˜¯é’ˆå¯¹æ„é€ å‡½æ•°æ³¨å…¥è€Œè¨€çš„ã€‚å¦‚æœ Boss æœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæ„é€ å‡½æ•°åŒ…å«ä¸€ä¸ª Car ç±»å‹çš„å…¥å‚ï¼Œå¦‚æœå®¹å™¨ä¸­æœ‰ä¸€ä¸ª Car ç±»å‹çš„ Beanï¼Œåˆ™ Spring å°†è‡ªåŠ¨æŠŠè¿™ä¸ª Bean ä½œä¸º Boss æ„é€ å‡½æ•°çš„å…¥å‚ï¼›å¦‚æœå®¹å™¨ä¸­æ²¡æœ‰æ‰¾åˆ°å’Œæ„é€ å‡½æ•°å…¥å‚åŒ¹é…ç±»å‹çš„ Beanï¼Œåˆ™ Spring å°†æŠ›å‡ºå¼‚å¸¸ã€‚
- **autodetect**ï¼šæ ¹æ® Bean çš„è‡ªçœæœºåˆ¶å†³å®šé‡‡ç”¨ byType è¿˜æ˜¯ constructor è¿›è¡Œè‡ªåŠ¨è£…é…ï¼Œå¦‚æœ Bean æä¾›äº†é»˜è®¤çš„æ„é€ å‡½æ•°ï¼Œåˆ™é‡‡ç”¨ byTypeï¼Œå¦åˆ™é‡‡ç”¨ constructorã€‚

### 13.Spring ä¸­çš„ Bean çš„ä½œç”¨åŸŸæœ‰å“ªäº›?

Spring çš„ Bean ä¸»è¦æ”¯æŒäº”ç§ä½œç”¨åŸŸï¼š

![Spring Beanæ”¯æŒä½œç”¨åŸŸ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-08a9cb31-5a4f-4224-94cd-0c0f643a57ea.png)

- **singleton** : åœ¨ Spring å®¹å™¨ä»…å­˜åœ¨ä¸€ä¸ª Bean å®ä¾‹ï¼ŒBean ä»¥å•å®ä¾‹çš„æ–¹å¼å­˜åœ¨ï¼Œæ˜¯ Bean é»˜è®¤çš„ä½œç”¨åŸŸã€‚
- **prototype** : æ¯æ¬¡ä»å®¹å™¨é‡è°ƒç”¨ Bean æ—¶ï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚

ä»¥ä¸‹ä¸‰ä¸ªä½œç”¨åŸŸäºåªåœ¨ Web åº”ç”¨ä¸­é€‚ç”¨ï¼š

- **request** : æ¯ä¸€æ¬¡ HTTP è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ Beanï¼Œè¯¥ Bean ä»…åœ¨å½“å‰ HTTP Request å†…æœ‰æ•ˆã€‚
- **session** : åŒä¸€ä¸ª HTTP Session å…±äº«ä¸€ä¸ª Beanï¼Œä¸åŒçš„ HTTP Session ä½¿ç”¨ä¸åŒçš„ Beanã€‚
- **globalSession**ï¼šåŒä¸€ä¸ªå…¨å±€ Session å…±äº«ä¸€ä¸ª Beanï¼Œåªç”¨äºåŸºäº Protlet çš„ Web åº”ç”¨ï¼ŒSpring5 ä¸­å·²ç»ä¸å­˜åœ¨äº†ã€‚

### 14.Spring ä¸­çš„å•ä¾‹ Bean ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜å—ï¼Ÿ

é¦–å…ˆç»“è®ºåœ¨è¿™ï¼šSpring ä¸­çš„å•ä¾‹ Bean**ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„**ã€‚

å› ä¸ºå•ä¾‹ Beanï¼Œæ˜¯å…¨å±€åªæœ‰ä¸€ä¸ª Beanï¼Œæ‰€æœ‰çº¿ç¨‹å…±äº«ã€‚å¦‚æœè¯´å•ä¾‹ Beanï¼Œæ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹ä¸­çš„æ“ä½œä¸ä¼šå¯¹ Bean ä¸­çš„æˆå‘˜å˜é‡æ‰§è¡Œ**æŸ¥è¯¢**ä»¥å¤–çš„æ“ä½œï¼Œé‚£ä¹ˆè¿™ä¸ªå•ä¾‹ Bean æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æ¯”å¦‚ Spring mvc çš„ Controllerã€Serviceã€Dao ç­‰ï¼Œè¿™äº› Bean å¤§å¤šæ˜¯æ— çŠ¶æ€çš„ï¼Œåªå…³æ³¨äºæ–¹æ³•æœ¬èº«ã€‚

å‡å¦‚è¿™ä¸ª Bean æ˜¯æœ‰çŠ¶æ€çš„ï¼Œä¹Ÿå°±æ˜¯ä¼šå¯¹ Bean ä¸­çš„æˆå‘˜å˜é‡è¿›è¡Œå†™æ“ä½œï¼Œé‚£ä¹ˆå¯èƒ½å°±å­˜åœ¨çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚

![Springå•ä¾‹Beançº¿ç¨‹å®‰å…¨é—®é¢˜](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-35dacef4-1a9e-45e1-b3f2-5a91227eb244.png)

> **å•ä¾‹ Bean çº¿ç¨‹å®‰å…¨é—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ**

å¸¸è§çš„æœ‰è¿™ä¹ˆäº›è§£å†³åŠæ³•ï¼š

1. å°† Bean å®šä¹‰ä¸ºå¤šä¾‹

   è¿™æ ·æ¯ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚è¿‡æ¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Beanï¼Œä½†æ˜¯è¿™æ ·å®¹å™¨å°±ä¸å¥½ç®¡ç† Beanï¼Œä¸èƒ½è¿™ä¹ˆåŠã€‚

2. åœ¨ Bean å¯¹è±¡ä¸­å°½é‡é¿å…å®šä¹‰å¯å˜çš„æˆå‘˜å˜é‡

   å‰Šè¶³é€‚å±¥äº†å±äºæ˜¯ï¼Œä¹Ÿä¸èƒ½è¿™ä¹ˆå¹²ã€‚

3. å°† Bean ä¸­çš„æˆå‘˜å˜é‡ä¿å­˜åœ¨ ThreadLocal ä¸­ â­

   æˆ‘ä»¬çŸ¥é“ ThredLoca èƒ½ä¿è¯å¤šçº¿ç¨‹ä¸‹å˜é‡çš„éš”ç¦»ï¼Œå¯ä»¥åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ª ThreadLocal æˆå‘˜å˜é‡ï¼Œå°†éœ€è¦çš„å¯å˜æˆå‘˜å˜é‡ä¿å­˜åœ¨ ThreadLocal é‡Œï¼Œè¿™æ˜¯æ¨èçš„ä¸€ç§æ–¹å¼ã€‚

### 15.è¯´è¯´å¾ªç¯ä¾èµ–?

> **ä»€ä¹ˆæ˜¯å¾ªç¯ä¾èµ–ï¼Ÿ**

![Springå¾ªç¯ä¾èµ–](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-f8fea53f-56fa-4cca-9199-ec7f648da625.png)

Spring å¾ªç¯ä¾èµ–ï¼šç®€å•è¯´å°±æ˜¯è‡ªå·±ä¾èµ–è‡ªå·±ï¼Œæˆ–è€…å’Œåˆ«çš„ Bean ç›¸äº’ä¾èµ–ã€‚

![é¸¡å’Œè›‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-0035fd25-2972-4642-a8ec-ee44a566a5bd.png)

åªæœ‰å•ä¾‹çš„ Bean æ‰å­˜åœ¨å¾ªç¯ä¾èµ–çš„æƒ…å†µï¼Œ**åŸå‹**(Prototype)æƒ…å†µä¸‹ï¼ŒSpring ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚åŸå› å¾ˆç®€å•ï¼ŒAB å¾ªç¯ä¾èµ–ï¼ŒA å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå‘ç°ä¾èµ– Bï¼Œåˆ›å»º B å®ä¾‹ï¼Œåˆ›å»º B çš„æ—¶å€™å‘ç°éœ€è¦ Aï¼Œåˆ›å»º A1 å®ä¾‹â€¦â€¦æ— é™å¥—å¨ƒï¼Œç›´æ¥æŠŠç³»ç»Ÿå¹²å®ã€‚

> **Spring å¯ä»¥è§£å†³å“ªäº›æƒ…å†µçš„å¾ªç¯ä¾èµ–ï¼Ÿ**

Spring ä¸æ”¯æŒåŸºäºæ„é€ å™¨æ³¨å…¥çš„å¾ªç¯ä¾èµ–ï¼Œä½†æ˜¯å‡å¦‚ AB å¾ªç¯ä¾èµ–ï¼Œå¦‚æœä¸€ä¸ªæ˜¯æ„é€ å™¨æ³¨å…¥ï¼Œä¸€ä¸ªæ˜¯ setter æ³¨å…¥å‘¢ï¼Ÿ

çœ‹çœ‹å‡ ç§æƒ…å½¢ï¼š

![å¾ªç¯ä¾èµ–çš„å‡ ç§æƒ…å½¢](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-37bb576d-b4af-42ed-91f4-d846ceb012b6.png)

ç¬¬å››ç§å¯ä»¥è€Œç¬¬äº”ç§ä¸å¯ä»¥çš„åŸå› æ˜¯ Spring åœ¨åˆ›å»º Bean æ—¶é»˜è®¤ä¼šæ ¹æ®è‡ªç„¶æ’åºè¿›è¡Œåˆ›å»ºï¼Œæ‰€ä»¥ A ä¼šå…ˆäº B è¿›è¡Œåˆ›å»ºã€‚

æ‰€ä»¥ç®€å•æ€»ç»“ï¼Œå½“å¾ªç¯ä¾èµ–çš„å®ä¾‹éƒ½é‡‡ç”¨ setter æ–¹æ³•æ³¨å…¥çš„æ—¶å€™ï¼ŒSpring å¯ä»¥æ”¯æŒï¼Œéƒ½é‡‡ç”¨æ„é€ å™¨æ³¨å…¥çš„æ—¶å€™ï¼Œä¸æ”¯æŒï¼Œæ„é€ å™¨æ³¨å…¥å’Œ setter æ³¨å…¥åŒæ—¶å­˜åœ¨çš„æ—¶å€™ï¼Œçœ‹å¤©ã€‚

### 16.é‚£ Spring æ€ä¹ˆè§£å†³å¾ªç¯ä¾èµ–çš„å‘¢ï¼Ÿ

> PSï¼šå…¶å®æ­£ç¡®ç­”æ¡ˆæ˜¯å¼€å‘äººå‘˜åšå¥½è®¾è®¡ï¼Œåˆ«è®© Bean å¾ªç¯ä¾èµ–ï¼Œä½†æ˜¯æ²¡åŠæ³•ï¼Œé¢è¯•å®˜ä¸æƒ³å¬è¿™ä¸ªã€‚

æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå•ä¾‹ Bean åˆå§‹åŒ–å®Œæˆï¼Œè¦ç»å†ä¸‰æ­¥ï¼š

![Beanåˆå§‹åŒ–æ­¥éª¤](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-867066f1-49d1-4e57-94f9-4c66a3a8797e.png)

æ³¨å…¥å°±å‘ç”Ÿåœ¨ç¬¬äºŒæ­¥ï¼Œ**å±æ€§èµ‹å€¼**ï¼Œç»“åˆè¿™ä¸ªè¿‡ç¨‹ï¼ŒSpring é€šè¿‡**ä¸‰çº§ç¼“å­˜**è§£å†³äº†å¾ªç¯ä¾èµ–ï¼š

1.  ä¸€çº§ç¼“å­˜ : `Map<String,Object>` **singletonObjects**ï¼Œå•ä¾‹æ± ï¼Œç”¨äºä¿å­˜å®ä¾‹åŒ–ã€å±æ€§èµ‹å€¼ï¼ˆæ³¨å…¥ï¼‰ã€åˆå§‹åŒ–å®Œæˆçš„ bean å®ä¾‹
2.  äºŒçº§ç¼“å­˜ : `Map<String,Object>` **earlySingletonObjects**ï¼Œæ—©æœŸæ›å…‰å¯¹è±¡ï¼Œç”¨äºä¿å­˜å®ä¾‹åŒ–å®Œæˆçš„ bean å®ä¾‹
3.  ä¸‰çº§ç¼“å­˜ : `Map<String,ObjectFactory<?>>` **singletonFactories**ï¼Œæ—©æœŸæ›å…‰å¯¹è±¡å·¥å‚ï¼Œç”¨äºä¿å­˜ bean åˆ›å»ºå·¥å‚ï¼Œä»¥ä¾¿äºåé¢æ‰©å±•æœ‰æœºä¼šåˆ›å»ºä»£ç†å¯¹è±¡ã€‚

![ä¸‰çº§ç¼“å­˜](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-01d92863-a2cb-4f61-8d8d-30ecf0279b28.png)

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–çš„è¿‡ç¨‹ï¼š

å½“ Aã€B ä¸¤ä¸ªç±»å‘ç”Ÿå¾ªç¯ä¾èµ–æ—¶ï¼š
![å¾ªç¯ä¾èµ–](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-cfc09f84-f8e1-4702-80b6-d115843e81fe.png)

A å®ä¾‹çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼š

1. åˆ›å»º A å®ä¾‹ï¼Œå®ä¾‹åŒ–çš„æ—¶å€™æŠŠ A å¯¹è±¡â¼¯â¼šæ”¾â¼Šä¸‰çº§ç¼“å­˜ï¼Œè¡¨ç¤º A å¼€å§‹å®ä¾‹åŒ–äº†ï¼Œè™½ç„¶æˆ‘è¿™ä¸ªå¯¹è±¡è¿˜ä¸å®Œæ•´ï¼Œä½†æ˜¯å…ˆæ›å…‰å‡ºæ¥è®©å¤§å®¶çŸ¥é“

![1](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-1a8bdc29-ff43-4ff4-9b61-3eedd9da59b3.png)

2. A æ³¨â¼Šå±æ€§æ—¶ï¼Œå‘ç°ä¾èµ– Bï¼Œæ­¤æ—¶ B è¿˜æ²¡æœ‰è¢«åˆ›å»ºå‡ºæ¥ï¼Œæ‰€ä»¥å»å®ä¾‹åŒ– B

3. åŒæ ·ï¼ŒB æ³¨â¼Šå±æ€§æ—¶å‘ç°ä¾èµ– Aï¼Œå®ƒå°±ä¼šä»ç¼“å­˜é‡Œæ‰¾ A å¯¹è±¡ã€‚ä¾æ¬¡ä»â¼€çº§åˆ°ä¸‰çº§ç¼“å­˜æŸ¥è¯¢ Aï¼Œä»ä¸‰çº§ç¼“å­˜é€šè¿‡å¯¹è±¡â¼¯â¼šæ‹¿åˆ° Aï¼Œå‘ç° A è™½ç„¶ä¸å¤ªå®Œå–„ï¼Œä½†æ˜¯å­˜åœ¨ï¼ŒæŠŠ A æ”¾â¼Šâ¼†çº§ç¼“å­˜ï¼ŒåŒæ—¶åˆ é™¤ä¸‰çº§ç¼“å­˜ä¸­çš„ Aï¼Œæ­¤æ—¶ï¼ŒB å·²ç»å®ä¾‹åŒ–å¹¶ä¸”åˆå§‹åŒ–å®Œæˆï¼ŒæŠŠ B æ”¾å…¥â¼€çº§ç¼“å­˜ã€‚

![2](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-bf2507bf-96aa-4b88-a58b-7ec41d11bc70.png)

4. æ¥ç€ A ç»§ç»­å±æ€§èµ‹å€¼ï¼Œé¡ºåˆ©ä»â¼€çº§ç¼“å­˜æ‹¿åˆ°å®ä¾‹åŒ–ä¸”åˆå§‹åŒ–å®Œæˆçš„ B å¯¹è±¡ï¼ŒA å¯¹è±¡åˆ›å»ºä¹Ÿå®Œæˆï¼Œåˆ é™¤â¼†çº§ç¼“å­˜ä¸­çš„ Aï¼ŒåŒæ—¶æŠŠ A æ”¾â¼Šâ¼€çº§ç¼“å­˜

5. æœ€åï¼Œâ¼€çº§ç¼“å­˜ä¸­ä¿å­˜ç€å®ä¾‹åŒ–ã€åˆå§‹åŒ–éƒ½å®Œæˆçš„ Aã€B å¯¹è±¡

![5](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-022f7cb9-2c83-4fe9-b252-b02bd0fb2435.png)

æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±çŸ¥é“ä¸ºä»€ä¹ˆ Spring èƒ½è§£å†³ setter æ³¨å…¥çš„å¾ªç¯ä¾èµ–äº†ï¼Œå› ä¸ºå®ä¾‹åŒ–å’Œå±æ€§èµ‹å€¼æ˜¯åˆ†å¼€çš„ï¼Œæ‰€ä»¥é‡Œé¢æœ‰æ“ä½œçš„ç©ºé—´ã€‚å¦‚æœéƒ½æ˜¯æ„é€ å™¨æ³¨å…¥çš„åŒ–ï¼Œé‚£ä¹ˆéƒ½å¾—åœ¨å®ä¾‹åŒ–è¿™ä¸€æ­¥å®Œæˆæ³¨å…¥ï¼Œæ‰€ä»¥è‡ªç„¶æ˜¯æ— æ³•æ”¯æŒäº†ã€‚

### 17.ä¸ºä»€ä¹ˆè¦ä¸‰çº§ç¼“å­˜ï¼Ÿâ¼†çº§ä¸â¾å—ï¼Ÿ

ä¸è¡Œï¼Œä¸»è¦æ˜¯ä¸ºäº†**â½£æˆä»£ç†å¯¹è±¡**ã€‚å¦‚æœæ˜¯æ²¡æœ‰ä»£ç†çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨äºŒçº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–ä¹Ÿæ˜¯ OK çš„ã€‚ä½†æ˜¯å¦‚æœå­˜åœ¨ä»£ç†ï¼Œä¸‰çº§æ²¡æœ‰é—®é¢˜ï¼ŒäºŒçº§å°±ä¸è¡Œäº†ã€‚

å› ä¸ºä¸‰çº§ç¼“å­˜ä¸­æ”¾çš„æ˜¯â½£æˆå…·ä½“å¯¹è±¡çš„åŒ¿åå†…éƒ¨ç±»ï¼Œè·å– Object çš„æ—¶å€™ï¼Œå®ƒå¯ä»¥â½£æˆä»£ç†å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥è¿”å›æ™®é€šå¯¹è±¡ã€‚ä½¿â½¤ä¸‰çº§ç¼“å­˜ä¸»è¦æ˜¯ä¸ºäº†ä¿è¯ä¸ç®¡ä»€ä¹ˆæ—¶å€™ä½¿â½¤çš„éƒ½æ˜¯â¼€ä¸ªå¯¹è±¡ã€‚

å‡è®¾åªæœ‰â¼†çº§ç¼“å­˜çš„æƒ…å†µï¼Œå¾€â¼†çº§ç¼“å­˜ä¸­æ”¾çš„æ˜¾ç¤ºâ¼€ä¸ªæ™®é€šçš„ Bean å¯¹è±¡ï¼ŒBean åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ BeanPostProcessor å»â½£æˆä»£ç†å¯¹è±¡ä¹‹åï¼Œè¦†ç›–æ‰â¼†çº§ç¼“å­˜ä¸­çš„æ™®é€š Bean å¯¹è±¡ï¼Œé‚£ä¹ˆå¯èƒ½å°±å¯¼è‡´å–åˆ°çš„ Bean å¯¹è±¡ä¸ä¸€è‡´äº†ã€‚

![äºŒçº§ç¼“å­˜ä¸è¡Œçš„åŸå› ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-6ece8a46-25b1-459b-8cfa-19fc696dd7d6.png)

### 18.@Autowired çš„å®ç°åŸç†ï¼Ÿ

å®ç°@Autowired çš„å…³é”®æ˜¯ï¼š**AutowiredAnnotationBeanPostProcessor**

åœ¨ Bean çš„åˆå§‹åŒ–é˜¶æ®µï¼Œä¼šé€šè¿‡ Bean åç½®å¤„ç†å™¨æ¥è¿›è¡Œä¸€äº›å‰ç½®å’Œåç½®çš„å¤„ç†ã€‚

å®ç°@Autowired çš„åŠŸèƒ½ï¼Œä¹Ÿæ˜¯é€šè¿‡åç½®å¤„ç†å™¨æ¥å®Œæˆçš„ã€‚è¿™ä¸ªåç½®å¤„ç†å™¨å°±æ˜¯ AutowiredAnnotationBeanPostProcessorã€‚

- Spring åœ¨åˆ›å»º bean çš„è¿‡ç¨‹ä¸­ï¼Œæœ€ç»ˆä¼šè°ƒç”¨åˆ° doCreateBean()æ–¹æ³•ï¼Œåœ¨ doCreateBean()æ–¹æ³•ä¸­ä¼šè°ƒç”¨ populateBean()æ–¹æ³•ï¼Œæ¥ä¸º bean è¿›è¡Œå±æ€§å¡«å……ï¼Œå®Œæˆè‡ªåŠ¨è£…é…ç­‰å·¥ä½œã€‚

- åœ¨ populateBean()æ–¹æ³•ä¸­ä¸€å…±è°ƒç”¨äº†ä¸¤æ¬¡åç½®å¤„ç†å™¨ï¼Œç¬¬ä¸€æ¬¡æ˜¯ä¸ºäº†åˆ¤æ–­æ˜¯å¦éœ€è¦å±æ€§å¡«å……ï¼Œå¦‚æœä¸éœ€è¦è¿›è¡Œå±æ€§å¡«å……ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥è¿›è¡Œ returnï¼Œå¦‚æœéœ€è¦è¿›è¡Œå±æ€§å¡«å……ï¼Œé‚£ä¹ˆæ–¹æ³•å°±ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œåé¢ä¼šè¿›è¡Œç¬¬äºŒæ¬¡åç½®å¤„ç†å™¨çš„è°ƒç”¨ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨åˆ° AutowiredAnnotationBeanPostProcessor çš„ postProcessPropertyValues()æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­å°±ä¼šè¿›è¡Œ@Autowired æ³¨è§£çš„è§£æï¼Œç„¶åå®ç°è‡ªåŠ¨è£…é…ã€‚

```java
/**
* å±æ€§èµ‹å€¼
**/
protected void populateBean(String beanName, RootBeanDefinition mbd, @Nullable BeanWrapper bw) {
          //â€¦â€¦â€¦â€¦
          if (hasInstAwareBpps) {
              if (pvs == null) {
                  pvs = mbd.getPropertyValues();
              }

              PropertyValues pvsToUse;
              for(Iterator var9 = this.getBeanPostProcessorCache().instantiationAware.iterator(); var9.hasNext(); pvs = pvsToUse) {
                  InstantiationAwareBeanPostProcessor bp = (InstantiationAwareBeanPostProcessor)var9.next();
                  pvsToUse = bp.postProcessProperties((PropertyValues)pvs, bw.getWrappedInstance(), beanName);
                  if (pvsToUse == null) {
                      if (filteredPds == null) {
                          filteredPds = this.filterPropertyDescriptorsForDependencyCheck(bw, mbd.allowCaching);
                      }
                      //æ‰§è¡Œåå¤„ç†å™¨ï¼Œå¡«å……å±æ€§ï¼Œå®Œæˆè‡ªåŠ¨è£…é…
                      //è°ƒç”¨InstantiationAwareBeanPostProcessorçš„postProcessPropertyValues()æ–¹æ³•
                      pvsToUse = bp.postProcessPropertyValues((PropertyValues)pvs, filteredPds, bw.getWrappedInstance(), beanName);
                      if (pvsToUse == null) {
                          return;
                      }
                  }
              }
          }
         //â€¦â€¦â€¦â€¦
  }
```

* postProcessorPropertyValues()æ–¹æ³•çš„æºç å¦‚ä¸‹ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ï¼Œä¼šå…ˆè°ƒç”¨ findAutowiringMetadata()æ–¹æ³•è§£æå‡º bean ä¸­å¸¦æœ‰@Autowired æ³¨è§£ã€@Inject å’Œ@Value æ³¨è§£çš„å±æ€§å’Œæ–¹æ³•ã€‚ç„¶åè°ƒç”¨ metadata.inject()æ–¹æ³•ï¼Œè¿›è¡Œå±æ€§å¡«å……ã€‚

```java
  public PropertyValues postProcessProperties(PropertyValues pvs, Object bean, String beanName) {
      //@Autowiredæ³¨è§£ã€@Injectå’Œ@Valueæ³¨è§£çš„å±æ€§å’Œæ–¹æ³•
      InjectionMetadata metadata = this.findAutowiringMetadata(beanName, bean.getClass(), pvs);

      try {
          //å±æ€§å¡«å……
          metadata.inject(bean, beanName, pvs);
          return pvs;
      } catch (BeanCreationException var6) {
          throw var6;
      } catch (Throwable var7) {
          throw new BeanCreationException(beanName, "Injection of autowired dependencies failed", var7);
      }
  }
```

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)


å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## AOP

### 19.è¯´è¯´ä»€ä¹ˆæ˜¯ AOPï¼Ÿ

AOPï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚ç®€å•è¯´ï¼Œå°±æ˜¯æŠŠä¸€äº›ä¸šåŠ¡é€»è¾‘ä¸­çš„ç›¸åŒçš„ä»£ç æŠ½å–åˆ°ä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ä¸­ï¼Œè®©ä¸šåŠ¡é€»è¾‘æ›´åŠ æ¸…çˆ½ã€‚

![æ¨ªå‘æŠ½å–](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-09dbcda4-7c1b-42d6-8520-1a5fc84abbde.png)

å…·ä½“æ¥è¯´ï¼Œå‡å¦‚æˆ‘ç°åœ¨è¦ crud å†™ä¸€å †ä¸šåŠ¡ï¼Œå¯æ˜¯å¦‚ä½•ä¸šåŠ¡ä»£ç å‰åå‰åè¿›è¡Œæ‰“å°æ—¥å¿—å’Œå‚æ•°çš„æ ¡éªŒå‘¢ï¼Ÿ

æˆ‘ä»¬å¯ä»¥æŠŠ`æ—¥å¿—è®°å½•`å’Œ`æ•°æ®æ ¡éªŒ`å¯é‡ç”¨çš„åŠŸèƒ½æ¨¡å—åˆ†ç¦»å‡ºæ¥ï¼Œç„¶ååœ¨ç¨‹åºçš„æ‰§è¡Œçš„åˆé€‚çš„åœ°æ–¹åŠ¨æ€åœ°æ¤å…¥è¿™äº›ä»£ç å¹¶æ‰§è¡Œã€‚è¿™æ ·å°±ç®€åŒ–äº†ä»£ç çš„ä¹¦å†™ã€‚

![AOPåº”ç”¨ç¤ºä¾‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-4754b4c0-0356-4077-a2f9-55e246cf8ba0.png)

ä¸šåŠ¡é€»è¾‘ä»£ç ä¸­æ²¡æœ‰å‚å’Œé€šç”¨é€»è¾‘çš„ä»£ç ï¼Œä¸šåŠ¡æ¨¡å—æ›´ç®€æ´ï¼ŒåªåŒ…å«æ ¸å¿ƒä¸šåŠ¡ä»£ç ã€‚å®ç°äº†ä¸šåŠ¡é€»è¾‘å’Œé€šç”¨é€»è¾‘çš„ä»£ç åˆ†ç¦»ï¼Œä¾¿äºç»´æŠ¤å’Œå‡çº§ï¼Œé™ä½äº†ä¸šåŠ¡é€»è¾‘å’Œé€šç”¨é€»è¾‘çš„è€¦åˆæ€§ã€‚

AOP å¯ä»¥å°†éå¸ƒåº”ç”¨å„å¤„çš„åŠŸèƒ½åˆ†ç¦»å‡ºæ¥å½¢æˆå¯é‡ç”¨çš„ç»„ä»¶ã€‚åœ¨ç¼–è¯‘æœŸé—´ã€è£…è½½æœŸé—´æˆ–è¿è¡ŒæœŸé—´å®ç°åœ¨ä¸ä¿®æ”¹æºä»£ç çš„æƒ…å†µä¸‹ç»™ç¨‹åºåŠ¨æ€æ·»åŠ åŠŸèƒ½ã€‚ä»è€Œå®ç°å¯¹ä¸šåŠ¡é€»è¾‘çš„éš”ç¦»ï¼Œæé«˜ä»£ç çš„æ¨¡å—åŒ–èƒ½åŠ›ã€‚

![Javaè¯­è¨€æ‰§è¡Œè¿‡ç¨‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-2b9859e5-019c-4e87-a449-990d3deae135.png)

AOP çš„æ ¸å¿ƒå…¶å®å°±æ˜¯**åŠ¨æ€ä»£ç†**ï¼Œå¦‚æœæ˜¯å®ç°äº†æ¥å£çš„è¯å°±ä¼šä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ï¼Œå¦åˆ™ä½¿ç”¨ CGLIB ä»£ç†ï¼Œä¸»è¦åº”ç”¨äºå¤„ç†ä¸€äº›å…·æœ‰æ¨ªåˆ‡æ€§è´¨çš„ç³»ç»Ÿçº§æœåŠ¡ï¼Œå¦‚æ—¥å¿—æ”¶é›†ã€äº‹åŠ¡ç®¡ç†ã€å®‰å…¨æ£€æŸ¥ã€ç¼“å­˜ã€å¯¹è±¡æ± ç®¡ç†ç­‰ã€‚

> **AOP æœ‰å“ªäº›æ ¸å¿ƒæ¦‚å¿µï¼Ÿ**

- **åˆ‡é¢**ï¼ˆAspectï¼‰ï¼šç±»æ˜¯å¯¹ç‰©ä½“ç‰¹å¾çš„æŠ½è±¡ï¼Œåˆ‡é¢å°±æ˜¯å¯¹æ¨ªåˆ‡å…³æ³¨ç‚¹çš„æŠ½è±¡
- **è¿æ¥ç‚¹**ï¼ˆJoinpointï¼‰ï¼šè¢«æ‹¦æˆªåˆ°çš„ç‚¹ï¼Œå› ä¸º Spring åªæ”¯æŒæ–¹æ³•ç±»å‹çš„è¿æ¥ç‚¹ï¼Œæ‰€ä»¥åœ¨ Spring ä¸­è¿æ¥ç‚¹æŒ‡çš„å°±æ˜¯è¢«æ‹¦æˆªåˆ°çš„æ–¹æ³•ï¼Œå®é™…ä¸Šè¿æ¥ç‚¹è¿˜å¯ä»¥æ˜¯å­—æ®µæˆ–è€…æ„é€ å™¨
- **åˆ‡ç‚¹**ï¼ˆPointcutï¼‰ï¼šå¯¹è¿æ¥ç‚¹è¿›è¡Œæ‹¦æˆªçš„å®šä½
- **é€šçŸ¥**ï¼ˆAdviceï¼‰ï¼šæ‰€è°“é€šçŸ¥æŒ‡çš„å°±æ˜¯æŒ‡æ‹¦æˆªåˆ°è¿æ¥ç‚¹ä¹‹åè¦æ‰§è¡Œçš„ä»£ç ï¼Œä¹Ÿå¯ä»¥ç§°ä½œ**å¢å¼º**
- **ç›®æ ‡å¯¹è±¡** ï¼ˆTargetï¼‰ï¼šä»£ç†çš„ç›®æ ‡å¯¹è±¡
- **ç»‡å…¥**ï¼ˆWeabingï¼‰ï¼šç»‡å…¥æ˜¯å°†å¢å¼ºæ·»åŠ åˆ°ç›®æ ‡ç±»çš„å…·ä½“è¿æ¥ç‚¹ä¸Šçš„è¿‡ç¨‹ã€‚

  - ç¼–è¯‘æœŸç»‡å…¥ï¼šåˆ‡é¢åœ¨ç›®æ ‡ç±»ç¼–è¯‘æ—¶è¢«ç»‡å…¥

  - ç±»åŠ è½½æœŸç»‡å…¥ï¼šåˆ‡é¢åœ¨ç›®æ ‡ç±»åŠ è½½åˆ° JVM æ—¶è¢«ç»‡å…¥ã€‚éœ€è¦ç‰¹æ®Šçš„ç±»åŠ è½½å™¨ï¼Œå®ƒå¯ä»¥åœ¨ç›®æ ‡ç±»è¢«å¼•å…¥åº”ç”¨ä¹‹å‰å¢å¼ºè¯¥ç›®æ ‡ç±»çš„å­—èŠ‚ç ã€‚

  - è¿è¡ŒæœŸç»‡å…¥ï¼šåˆ‡é¢åœ¨åº”ç”¨è¿è¡Œçš„æŸä¸ªæ—¶åˆ»è¢«ç»‡å…¥ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨ç»‡å…¥åˆ‡é¢æ—¶ï¼ŒAOP å®¹å™¨ä¼šä¸ºç›®æ ‡å¯¹è±¡åŠ¨æ€åœ°åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚SpringAOP å°±æ˜¯ä»¥è¿™ç§æ–¹å¼ç»‡å…¥åˆ‡é¢ã€‚

    Spring é‡‡ç”¨è¿è¡ŒæœŸç»‡å…¥ï¼Œè€Œ AspectJ é‡‡ç”¨ç¼–è¯‘æœŸç»‡å…¥å’Œç±»åŠ è½½å™¨ç»‡å…¥ã€‚

- **å¼•ä»‹**ï¼ˆintroductionï¼‰ï¼šå¼•ä»‹æ˜¯ä¸€ç§ç‰¹æ®Šçš„å¢å¼ºï¼Œå¯ä»¥åŠ¨æ€åœ°ä¸ºç±»æ·»åŠ ä¸€äº›å±æ€§å’Œæ–¹æ³•

> **AOP æœ‰å“ªäº›ç¯ç»•æ–¹å¼ï¼Ÿ**

AOP ä¸€èˆ¬æœ‰ **5 ç§**ç¯ç»•æ–¹å¼ï¼š

- å‰ç½®é€šçŸ¥ (@Before)
- è¿”å›é€šçŸ¥ (@AfterReturning)
- å¼‚å¸¸é€šçŸ¥ (@AfterThrowing)
- åç½®é€šçŸ¥ (@After)
- ç¯ç»•é€šçŸ¥ (@Around)

![ç¯ç»•æ–¹å¼](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-320fa34f-6620-419c-b17a-4f516a83caeb.png)

å¤šä¸ªåˆ‡é¢çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡ @Order æŒ‡å®šå…ˆåé¡ºåºï¼Œæ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚

### 20.è¯´è¯´ä½ å¹³æ—¶æœ‰ç”¨åˆ° AOP å—ï¼Ÿ

PSï¼šè¿™é“é¢˜è€ä¸‰çš„åŒäº‹é¢è¯•å€™é€‰äººçš„æ—¶å€™é—®åˆ°äº†ï¼Œå€™é€‰äººè¯´äº†ä¸€å † AOP åŸç†ï¼ŒåŒäº‹å°±åŠ¿æ¥ä¸€å¥ï¼Œä½ èƒ½ç°åœºå†™ä¸€ä¸‹ AOP çš„åº”ç”¨å—ï¼Ÿç»“æœâ€”â€”åœºé¢ä¸€åº¦å¾ˆå°´å°¬ã€‚è™½ç„¶æˆ‘å¯¹é¢è¯•å†™è¿™ç§ç™¾åº¦å°±èƒ½å‡ºæ¥çš„ä¸œè¥¿æŒä¿ç•™æ„è§ï¼Œä½†æ˜¯è¿˜æ˜¯åŠ ä¸Šäº†è¿™ä¸€é—®ï¼Œæ¯•ç«Ÿæ‹›äººæœ€åéƒ½æ˜¯è¦æ’¸ä»£ç çš„ã€‚

è¿™é‡Œç»™å‡ºä¸€ä¸ªå°ä¾‹å­ï¼ŒSpringBoot é¡¹ç›®ä¸­ï¼Œåˆ©ç”¨ AOP æ‰“å°æ¥å£çš„å…¥å‚å’Œå‡ºå‚æ—¥å¿—ï¼Œä»¥åŠæ‰§è¡Œæ—¶é—´ï¼Œè¿˜æ˜¯æ¯”è¾ƒå¿«æ·çš„ã€‚

- å¼•å…¥ä¾èµ–ï¼šå¼•å…¥ AOP ä¾èµ–

  ```java
          <dependency>
              <groupId>org.springframework.boot</groupId>
              <artifactId>spring-boot-starter-aop</artifactId>
          </dependency>
  ```

- è‡ªå®šä¹‰æ³¨è§£ï¼šè‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£ä½œä¸ºåˆ‡ç‚¹

  ```java
  @Retention(RetentionPolicy.RUNTIME)
  @Target({ElementType.METHOD})
  @Documented
  public @interface WebLog {
  }
  ```

- é…ç½® AOP åˆ‡é¢ï¼š

  - @Aspectï¼šæ ‡è¯†åˆ‡é¢

  - @Pointcutï¼šè®¾ç½®åˆ‡ç‚¹ï¼Œè¿™é‡Œä»¥è‡ªå®šä¹‰æ³¨è§£ä¸ºåˆ‡ç‚¹ï¼Œå®šä¹‰åˆ‡ç‚¹æœ‰å¾ˆå¤šå…¶å®ƒç§æ–¹å¼ï¼Œè‡ªå®šä¹‰æ³¨è§£æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§ã€‚
  - @Beforeï¼šåœ¨åˆ‡ç‚¹ä¹‹å‰ç»‡å…¥ï¼Œæ‰“å°äº†ä¸€äº›å…¥å‚ä¿¡æ¯
  - @Aroundï¼šç¯ç»•åˆ‡ç‚¹ï¼Œæ‰“å°è¿”å›å‚æ•°å’Œæ¥å£æ‰§è¡Œæ—¶é—´

  ```java
  @Aspect
  @Component
  public class WebLogAspect {

      private final static Logger logger         = LoggerFactory.getLogger(WebLogAspect.class);

      /**
       * ä»¥è‡ªå®šä¹‰ @WebLog æ³¨è§£ä¸ºåˆ‡ç‚¹
       **/
      @Pointcut("@annotation(cn.fighter3.spring.aop_demo.WebLog)")
      public void webLog() {}

      /**
       * åœ¨åˆ‡ç‚¹ä¹‹å‰ç»‡å…¥
       */
      @Before("webLog()")
      public void doBefore(JoinPoint joinPoint) throws Throwable {
          // å¼€å§‹æ‰“å°è¯·æ±‚æ—¥å¿—
          ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
          HttpServletRequest request = attributes.getRequest();
          // æ‰“å°è¯·æ±‚ç›¸å…³å‚æ•°
          logger.info("========================================== Start ==========================================");
          // æ‰“å°è¯·æ±‚ url
          logger.info("URL            : {}", request.getRequestURL().toString());
          // æ‰“å° Http method
          logger.info("HTTP Method    : {}", request.getMethod());
          // æ‰“å°è°ƒç”¨ controller çš„å…¨è·¯å¾„ä»¥åŠæ‰§è¡Œæ–¹æ³•
          logger.info("Class Method   : {}.{}", joinPoint.getSignature().getDeclaringTypeName(), joinPoint.getSignature().getName());
          // æ‰“å°è¯·æ±‚çš„ IP
          logger.info("IP             : {}", request.getRemoteAddr());
          // æ‰“å°è¯·æ±‚å…¥å‚
          logger.info("Request Args   : {}",new ObjectMapper().writeValueAsString(joinPoint.getArgs()));
      }

      /**
       * åœ¨åˆ‡ç‚¹ä¹‹åç»‡å…¥
       * @throws Throwable
       */
      @After("webLog()")
      public void doAfter() throws Throwable {
          // ç»“æŸåæ‰“ä¸ªåˆ†éš”çº¿ï¼Œæ–¹ä¾¿æŸ¥çœ‹
          logger.info("=========================================== End ===========================================");
      }

      /**
       * ç¯ç»•
       */
      @Around("webLog()")
      public Object doAround(ProceedingJoinPoint proceedingJoinPoint) throws Throwable {
          //å¼€å§‹æ—¶é—´
          long startTime = System.currentTimeMillis();
          Object result = proceedingJoinPoint.proceed();
          // æ‰“å°å‡ºå‚
          logger.info("Response Args  : {}", new ObjectMapper().writeValueAsString(result));
          // æ‰§è¡Œè€—æ—¶
          logger.info("Time-Consuming : {} ms", System.currentTimeMillis() - startTime);
          return result;
      }

  }
  ```

- ä½¿ç”¨ï¼šåªéœ€è¦åœ¨æ¥å£ä¸ŠåŠ ä¸Šè‡ªå®šä¹‰æ³¨è§£

  ```java
      @GetMapping("/hello")
      @WebLog(desc = "è¿™æ˜¯ä¸€ä¸ªæ¬¢è¿æ¥å£")
      public String hello(String name){
          return "Hello "+name;
      }
  ```

* æ‰§è¡Œç»“æœï¼šå¯ä»¥çœ‹åˆ°æ—¥å¿—æ‰“å°äº†å…¥å‚ã€å‡ºå‚å’Œæ‰§è¡Œæ—¶é—´
![æ‰§è¡Œç»“æœ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-9c14f774-44b9-41b3-a8c0-f2a54385f6ff.png)

### 21.è¯´è¯´ JDK åŠ¨æ€ä»£ç†å’Œ CGLIB ä»£ç† ï¼Ÿ

Spring çš„ AOP æ˜¯é€šè¿‡[åŠ¨æ€ä»£ç†](https://mp.weixin.qq.com/s/aZtfwik0weJN5JzYc-JxYg)æ¥å®ç°çš„ï¼ŒåŠ¨æ€ä»£ç†ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ JDK åŠ¨æ€ä»£ç†å’Œ Cglib åŠ¨æ€ä»£ç†ï¼Œè¿™ä¸¤ç§åŠ¨æ€ä»£ç†çš„ä½¿ç”¨å’ŒåŸç†æœ‰äº›ä¸åŒã€‚

**JDK åŠ¨æ€ä»£ç†**

1.  **Interface**ï¼šå¯¹äº JDK åŠ¨æ€ä»£ç†ï¼Œç›®æ ‡ç±»éœ€è¦å®ç°ä¸€ä¸ª Interfaceã€‚
2.  **InvocationHandler**ï¼šInvocationHandler æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¯ä»¥é€šè¿‡å®ç°è¿™ä¸ªæ¥å£ï¼Œå®šä¹‰æ¨ªåˆ‡é€»è¾‘ï¼Œå†é€šè¿‡åå°„æœºåˆ¶ï¼ˆinvokeï¼‰è°ƒç”¨ç›®æ ‡ç±»çš„ä»£ç ï¼Œåœ¨æ¬¡è¿‡ç¨‹ï¼Œå¯èƒ½åŒ…è£…é€»è¾‘ï¼Œå¯¹ç›®æ ‡æ–¹æ³•è¿›è¡Œå‰ç½®åç½®å¤„ç†ã€‚
3.  **Proxy**ï¼šProxy åˆ©ç”¨ InvocationHandler åŠ¨æ€åˆ›å»ºä¸€ä¸ªç¬¦åˆç›®æ ‡ç±»å®ç°çš„æ¥å£çš„å®ä¾‹ï¼Œç”Ÿæˆç›®æ ‡ç±»çš„ä»£ç†å¯¹è±¡ã€‚

**CgLib åŠ¨æ€ä»£ç†**

1.  ä½¿ç”¨ JDK åˆ›å»ºä»£ç†æœ‰ä¸€å¤§é™åˆ¶ï¼Œå®ƒåªèƒ½ä¸ºæ¥å£åˆ›å»ºä»£ç†å®ä¾‹ï¼Œè€Œ CgLib åŠ¨æ€ä»£ç†å°±æ²¡æœ‰è¿™ä¸ªé™åˆ¶ã€‚
2.  CgLib åŠ¨æ€ä»£ç†æ˜¯ä½¿ç”¨å­—èŠ‚ç å¤„ç†æ¡†æ¶ **ASM**ï¼Œå…¶åŸç†æ˜¯é€šè¿‡å­—èŠ‚ç æŠ€æœ¯ä¸ºä¸€ä¸ªç±»åˆ›å»ºå­ç±»ï¼Œå¹¶åœ¨å­ç±»ä¸­é‡‡ç”¨æ–¹æ³•æ‹¦æˆªçš„æŠ€æœ¯æ‹¦æˆªæ‰€æœ‰çˆ¶ç±»æ–¹æ³•çš„è°ƒç”¨ï¼Œé¡ºåŠ¿ç»‡å…¥æ¨ªåˆ‡é€»è¾‘ã€‚
3.  **CgLib** åˆ›å»ºçš„åŠ¨æ€ä»£ç†å¯¹è±¡æ€§èƒ½æ¯” JDK åˆ›å»ºçš„åŠ¨æ€ä»£ç†å¯¹è±¡çš„æ€§èƒ½é«˜ä¸å°‘ï¼Œä½†æ˜¯ CGLib åœ¨åˆ›å»ºä»£ç†å¯¹è±¡æ—¶æ‰€èŠ±è´¹çš„æ—¶é—´å´æ¯” JDK å¤šå¾—å¤šï¼Œæ‰€ä»¥å¯¹äºå•ä¾‹çš„å¯¹è±¡ï¼Œå› ä¸ºæ— éœ€é¢‘ç¹åˆ›å»ºå¯¹è±¡ï¼Œç”¨ CGLib åˆé€‚ï¼Œåä¹‹ï¼Œä½¿ç”¨ JDK æ–¹å¼è¦æ›´ä¸ºåˆé€‚ä¸€äº›ã€‚åŒæ—¶ï¼Œç”±äº CGLib ç”±äºæ˜¯é‡‡ç”¨åŠ¨æ€åˆ›å»ºå­ç±»çš„æ–¹æ³•ï¼Œå¯¹äº final æ–¹æ³•ï¼Œæ— æ³•è¿›è¡Œä»£ç†ã€‚

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå¸¸è§çš„å°åœºæ™¯ï¼Œå®¢æœä¸­è½¬ï¼Œè§£å†³ç”¨æˆ·é—®é¢˜ï¼š

![ç”¨æˆ·å‘å®¢æœæé—®é¢˜](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-c5c4b247-62dd-43a2-a043-da51c58f77c8.png)

**JDK åŠ¨æ€ä»£ç†å®ç°ï¼š**

![JDKåŠ¨æ€ä»£ç†ç±»å›¾](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-65b14a3f-2653-463e-af77-a8875d3d635c.png)

- æ¥å£

  ```java
  public interface ISolver {
      void solve();
  }
  ```

- ç›®æ ‡ç±»:éœ€è¦å®ç°å¯¹åº”æ¥å£

  ```java
  public class Solver implements ISolver {
      @Override
      public void solve() {
          System.out.println("ç–¯ç‹‚æ‰å¤´å‘è§£å†³é—®é¢˜â€¦â€¦");
      }
  }
  ```

- æ€ä»£ç†å·¥å‚:ProxyFactoryï¼Œç›´æ¥ç”¨åå°„æ–¹å¼ç”Ÿæˆä¸€ä¸ªç›®æ ‡å¯¹è±¡çš„ä»£ç†å¯¹è±¡ï¼Œè¿™é‡Œç”¨äº†ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»æ–¹å¼é‡å†™ InvocationHandler æ–¹æ³•ï¼Œå®ç°æ¥å£é‡å†™ä¹Ÿå·®ä¸å¤š

  ```java
  public class ProxyFactory {

      // ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡
      private Object target;

      public ProxyFactory(Object target) {
          this.target = target;
      }

      // ä¸ºç›®æ ‡å¯¹è±¡ç”Ÿæˆä»£ç†å¯¹è±¡
      public Object getProxyInstance() {
          return Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(),
                  new InvocationHandler() {
                      @Override
                      public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
                          System.out.println("è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°æ‚¨ï¼Ÿ");

                          // è°ƒç”¨ç›®æ ‡å¯¹è±¡æ–¹æ³•
                          Object returnValue = method.invoke(target, args);

                          System.out.println("é—®é¢˜å·²ç»è§£å†³å•¦ï¼");
                          return null;
                      }
                  });
      }
  }
  ```

- å®¢æˆ·ç«¯ï¼šClientï¼Œç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡å®ä¾‹ï¼Œé€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ç›®æ ‡å¯¹è±¡æ–¹æ³•

  ```java
  public class Client {
      public static void main(String[] args) {
          //ç›®æ ‡å¯¹è±¡:ç¨‹åºå‘˜
          ISolver developer = new Solver();
          //ä»£ç†ï¼šå®¢æœå°å§å§
          ISolver csProxy = (ISolver) new ProxyFactory(developer).getProxyInstance();
          //ç›®æ ‡æ–¹æ³•ï¼šè§£å†³é—®é¢˜
          csProxy.solve();
      }
  }
  ```

**Cglib åŠ¨æ€ä»£ç†å®ç°ï¼š**

![CglibåŠ¨æ€ä»£ç†ç±»å›¾](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-74da87af-20d1-4a5b-a212-3837a15f0bab.png)

- ç›®æ ‡ç±»ï¼šSolverï¼Œè¿™é‡Œç›®æ ‡ç±»ä¸ç”¨å†å®ç°æ¥å£ã€‚

  ```java
  public class Solver {

      public void solve() {
          System.out.println("ç–¯ç‹‚æ‰å¤´å‘è§£å†³é—®é¢˜â€¦â€¦");
      }
  }
  ```

- åŠ¨æ€ä»£ç†å·¥å‚ï¼š

  ```java
  public class ProxyFactory implements MethodInterceptor {

     //ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡
      private Object target;

      public ProxyFactory(Object target) {
          this.target = target;
      }

      //ä¸ºç›®æ ‡å¯¹è±¡ç”Ÿæˆä»£ç†å¯¹è±¡
      public Object getProxyInstance() {
          //å·¥å…·ç±»
          Enhancer en = new Enhancer();
          //è®¾ç½®çˆ¶ç±»
          en.setSuperclass(target.getClass());
          //è®¾ç½®å›è°ƒå‡½æ•°
          en.setCallback(this);
          //åˆ›å»ºå­ç±»å¯¹è±¡ä»£ç†
          return en.create();
      }

      @Override
      public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable {
          System.out.println("è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°æ‚¨ï¼Ÿ");
          // æ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³•
          Object returnValue = method.invoke(target, args);
          System.out.println("é—®é¢˜å·²ç»è§£å†³å•¦ï¼");
          return null;
      }

  }
  ```

- å®¢æˆ·ç«¯ï¼šClient

  ```java
  public class Client {
      public static void main(String[] args) {
          //ç›®æ ‡å¯¹è±¡:ç¨‹åºå‘˜
          Solver developer = new Solver();
          //ä»£ç†ï¼šå®¢æœå°å§å§
          Solver csProxy = (Solver) new ProxyFactory(developer).getProxyInstance();
          //ç›®æ ‡æ–¹æ³•ï¼šè§£å†³é—®é¢˜
          csProxy.solve();
      }
  }
  ```

### 22.è¯´è¯´ Spring AOP å’Œ AspectJ AOP åŒºåˆ«?

**Spring AOP**

Spring AOP å±äº`è¿è¡Œæ—¶å¢å¼º`ï¼Œä¸»è¦å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š

1.  åŸºäºåŠ¨æ€ä»£ç†æ¥å®ç°ï¼Œé»˜è®¤å¦‚æœä½¿ç”¨æ¥å£çš„ï¼Œç”¨ JDK æä¾›çš„åŠ¨æ€ä»£ç†å®ç°ï¼Œå¦‚æœæ˜¯æ–¹æ³•åˆ™ä½¿ç”¨ CGLIB å®ç°

2.  Spring AOP éœ€è¦ä¾èµ– IOC å®¹å™¨æ¥ç®¡ç†ï¼Œå¹¶ä¸”åªèƒ½ä½œç”¨äº Spring å®¹å™¨ï¼Œä½¿ç”¨çº¯ Java ä»£ç å®ç°

3.  åœ¨æ€§èƒ½ä¸Šï¼Œç”±äº Spring AOP æ˜¯åŸºäº**åŠ¨æ€ä»£ç†**æ¥å®ç°çš„ï¼Œåœ¨å®¹å™¨å¯åŠ¨æ—¶éœ€è¦ç”Ÿæˆä»£ç†å®ä¾‹ï¼Œåœ¨æ–¹æ³•è°ƒç”¨ä¸Šä¹Ÿä¼šå¢åŠ æ ˆçš„æ·±åº¦ï¼Œä½¿å¾— Spring AOP çš„æ€§èƒ½ä¸å¦‚ AspectJ çš„é‚£ä¹ˆå¥½ã€‚

4.  Spring AOP è‡´åŠ›äºè§£å†³ä¼ä¸šçº§å¼€å‘ä¸­æœ€æ™®éçš„ AOP(æ–¹æ³•ç»‡å…¥)ã€‚

**AspectJ**

AspectJ æ˜¯ä¸€ä¸ªæ˜“ç”¨çš„åŠŸèƒ½å¼ºå¤§çš„ AOP æ¡†æ¶ï¼Œå±äº`ç¼–è¯‘æ—¶å¢å¼º`ï¼Œ å¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥æ•´åˆåˆ°å…¶å®ƒæ¡†æ¶ä¸­ï¼Œæ˜¯ AOP ç¼–ç¨‹çš„å®Œå…¨è§£å†³æ–¹æ¡ˆã€‚AspectJ éœ€è¦ç”¨åˆ°å•ç‹¬çš„ç¼–è¯‘å™¨ ajcã€‚

AspectJ å±äº**é™æ€ç»‡å…¥**ï¼Œé€šè¿‡ä¿®æ”¹ä»£ç æ¥å®ç°ï¼Œåœ¨å®é™…è¿è¡Œä¹‹å‰å°±å®Œæˆäº†ç»‡å…¥ï¼Œæ‰€ä»¥è¯´å®ƒç”Ÿæˆçš„ç±»æ˜¯æ²¡æœ‰é¢å¤–è¿è¡Œæ—¶å¼€é”€çš„ï¼Œä¸€èˆ¬æœ‰å¦‚ä¸‹å‡ ä¸ªç»‡å…¥çš„æ—¶æœºï¼š

1.  ç¼–è¯‘æœŸç»‡å…¥ï¼ˆCompile-time weavingï¼‰ï¼šå¦‚ç±» A ä½¿ç”¨ AspectJ æ·»åŠ äº†ä¸€ä¸ªå±æ€§ï¼Œç±» B å¼•ç”¨äº†å®ƒï¼Œè¿™ä¸ªåœºæ™¯å°±éœ€è¦ç¼–è¯‘æœŸçš„æ—¶å€™å°±è¿›è¡Œç»‡å…¥ï¼Œå¦åˆ™æ²¡æ³•ç¼–è¯‘ç±» Bã€‚

2.  ç¼–è¯‘åç»‡å…¥ï¼ˆPost-compile weavingï¼‰ï¼šä¹Ÿå°±æ˜¯å·²ç»ç”Ÿæˆäº† .class æ–‡ä»¶ï¼Œæˆ–å·²ç»æ‰“æˆ jar åŒ…äº†ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬éœ€è¦å¢å¼ºå¤„ç†çš„è¯ï¼Œå°±è¦ç”¨åˆ°ç¼–è¯‘åç»‡å…¥ã€‚

3.  ç±»åŠ è½½åç»‡å…¥ï¼ˆLoad-time weavingï¼‰ï¼šæŒ‡çš„æ˜¯åœ¨åŠ è½½ç±»çš„æ—¶å€™è¿›è¡Œç»‡å…¥ï¼Œè¦å®ç°è¿™ä¸ªæ—¶æœŸçš„ç»‡å…¥ï¼Œæœ‰å‡ ç§å¸¸è§çš„æ–¹æ³•

æ•´ä½“å¯¹æ¯”å¦‚ä¸‹ï¼š

![Spring AOPå’ŒAspectJå¯¹æ¯”](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-d1dbe9d9-c55f-4293-8622-d9759064d613.png)


GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)


å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## äº‹åŠ¡

Spring äº‹åŠ¡çš„æœ¬è´¨å…¶å®å°±æ˜¯æ•°æ®åº“å¯¹äº‹åŠ¡çš„æ”¯æŒï¼Œæ²¡æœ‰æ•°æ®åº“çš„äº‹åŠ¡æ”¯æŒï¼ŒSpring æ˜¯æ— æ³•æä¾›äº‹åŠ¡åŠŸèƒ½çš„ã€‚Spring åªæä¾›ç»Ÿä¸€äº‹åŠ¡ç®¡ç†æ¥å£ï¼Œå…·ä½“å®ç°éƒ½æ˜¯ç”±å„æ•°æ®åº“è‡ªå·±å®ç°ï¼Œæ•°æ®åº“äº‹åŠ¡çš„æäº¤å’Œå›æ»šæ˜¯é€šè¿‡æ•°æ®åº“è‡ªå·±çš„äº‹åŠ¡æœºåˆ¶å®ç°ã€‚

### 23.Spring äº‹åŠ¡çš„ç§ç±»ï¼Ÿ

Spring æ”¯æŒ`ç¼–ç¨‹å¼äº‹åŠ¡`ç®¡ç†å’Œ`å£°æ˜å¼`äº‹åŠ¡ç®¡ç†ä¸¤ç§æ–¹å¼ï¼š

![Springäº‹åŠ¡åˆ†ç±»](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-d3ee77fa-926d-4c39-91f8-a8b1544a9134.png)

1.  ç¼–ç¨‹å¼äº‹åŠ¡

ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†ä½¿ç”¨ TransactionTemplateï¼Œéœ€è¦æ˜¾å¼æ‰§è¡Œäº‹åŠ¡ã€‚

2.  å£°æ˜å¼äº‹åŠ¡

1.  å£°æ˜å¼äº‹åŠ¡ç®¡ç†å»ºç«‹åœ¨ AOP ä¹‹ä¸Šçš„ã€‚å…¶æœ¬è´¨æ˜¯é€šè¿‡ AOP åŠŸèƒ½ï¼Œå¯¹æ–¹æ³•å‰åè¿›è¡Œæ‹¦æˆªï¼Œå°†äº‹åŠ¡å¤„ç†çš„åŠŸèƒ½ç¼–ç»‡åˆ°æ‹¦æˆªçš„æ–¹æ³•ä¸­ï¼Œä¹Ÿå°±æ˜¯åœ¨ç›®æ ‡æ–¹æ³•å¼€å§‹ä¹‹å‰å¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œåœ¨æ‰§è¡Œå®Œç›®æ ‡æ–¹æ³•ä¹‹åæ ¹æ®æ‰§è¡Œæƒ…å†µæäº¤æˆ–è€…å›æ»šäº‹åŠ¡
1.  ä¼˜ç‚¹æ˜¯ä¸éœ€è¦åœ¨ä¸šåŠ¡é€»è¾‘ä»£ç ä¸­æºæ‚äº‹åŠ¡ç®¡ç†çš„ä»£ç ï¼Œåªéœ€åœ¨é…ç½®æ–‡ä»¶ä¸­åšç›¸å…³çš„äº‹åŠ¡è§„åˆ™å£°æ˜æˆ–é€šè¿‡ @Transactional æ³¨è§£çš„æ–¹å¼ï¼Œä¾¿å¯ä»¥å°†äº‹åŠ¡è§„åˆ™åº”ç”¨åˆ°ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œå‡å°‘ä¸šåŠ¡ä»£ç çš„æ±¡æŸ“ã€‚å”¯ä¸€ä¸è¶³åœ°æ–¹æ˜¯ï¼Œæœ€ç»†ç²’åº¦åªèƒ½ä½œç”¨åˆ°æ–¹æ³•çº§åˆ«ï¼Œæ— æ³•åšåˆ°åƒç¼–ç¨‹å¼äº‹åŠ¡é‚£æ ·å¯ä»¥ä½œç”¨åˆ°ä»£ç å—çº§åˆ«ã€‚

### 24.Spring çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Ÿ

Spring çš„æ¥å£ TransactionDefinition ä¸­å®šä¹‰äº†è¡¨ç¤ºéš”ç¦»çº§åˆ«çš„å¸¸é‡ï¼Œå½“ç„¶å…¶å®ä¸»è¦è¿˜æ˜¯å¯¹åº”æ•°æ®åº“çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼š

1. ISOLATION_DEFAULTï¼šä½¿ç”¨åç«¯æ•°æ®åº“é»˜è®¤çš„éš”ç¦»ç•Œåˆ«ï¼ŒMySQL é»˜è®¤å¯é‡å¤è¯»ï¼ŒOracle é»˜è®¤è¯»å·²æäº¤ã€‚
2. ISOLATION_READ_UNCOMMITTEDï¼šè¯»æœªæäº¤
3. ISOLATION_READ_COMMITTEDï¼šè¯»å·²æäº¤
4. ISOLATION_REPEATABLE_READï¼šå¯é‡å¤è¯»
5. ISOLATION_SERIALIZABLEï¼šä¸²è¡ŒåŒ–

### 25.Spring çš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶ï¼Ÿ

Spring äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶è¯´çš„æ˜¯ï¼Œå½“å¤šä¸ªäº‹åŠ¡åŒæ—¶å­˜åœ¨çš„æ—¶å€™â€”â€”ä¸€èˆ¬æŒ‡çš„æ˜¯å¤šä¸ªäº‹åŠ¡æ–¹æ³•ç›¸äº’è°ƒç”¨æ—¶ï¼ŒSpring å¦‚ä½•å¤„ç†è¿™äº›äº‹åŠ¡çš„è¡Œä¸ºã€‚

äº‹åŠ¡ä¼ æ’­æœºåˆ¶æ˜¯ä½¿ç”¨ç®€å•çš„ ThreadLocal å®ç°çš„ï¼Œæ‰€ä»¥ï¼Œå¦‚æœè°ƒç”¨çš„æ–¹æ³•æ˜¯åœ¨æ–°çº¿ç¨‹è°ƒç”¨çš„ï¼Œäº‹åŠ¡ä¼ æ’­å®é™…ä¸Šæ˜¯ä¼šå¤±æ•ˆçš„ã€‚

![7ç§äº‹åŠ¡ä¼ æ’­æœºåˆ¶](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-a6e2a8dc-9771-4d8b-9d91-76ddee98af1a.png)

Spring é»˜è®¤çš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯ PROPAFATION_REQUIREDï¼Œå®ƒé€‚åˆç»å¤§å¤šæ•°æƒ…å†µï¼Œå¦‚æœå¤šä¸ª ServiceX#methodX()éƒ½å·¥ä½œåœ¨äº‹åŠ¡ç¯å¢ƒä¸‹ï¼ˆå‡è¢« Spring äº‹åŠ¡å¢å¼ºï¼‰ï¼Œä¸”ç¨‹åºä¸­å­˜åœ¨è°ƒç”¨é“¾ `Service1#method1()->Service2#method2()->Service3#method3()`ï¼Œé‚£ä¹ˆè¿™ 3 ä¸ªæœåŠ¡ç±»çš„ä¸‰ä¸ªæ–¹æ³•é€šè¿‡ Spring çš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶éƒ½å·¥ä½œåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚

### 26.å£°æ˜å¼äº‹åŠ¡å®ç°åŸç†äº†è§£å—ï¼Ÿ

å°±æ˜¯é€šè¿‡ AOP/åŠ¨æ€ä»£ç†ã€‚

- **åœ¨ Bean åˆå§‹åŒ–é˜¶æ®µåˆ›å»ºä»£ç†å¯¹è±¡**ï¼šSpring å®¹å™¨åœ¨åˆå§‹åŒ–æ¯ä¸ªå•ä¾‹ bean çš„æ—¶å€™ï¼Œä¼šéå†å®¹å™¨ä¸­çš„æ‰€æœ‰ BeanPostProcessor å®ç°ç±»ï¼Œå¹¶æ‰§è¡Œå…¶ postProcessAfterInitialization æ–¹æ³•ï¼Œåœ¨æ‰§è¡Œ AbstractAutoProxyCreator ç±»çš„ postProcessAfterInitialization æ–¹æ³•æ—¶ä¼šéå†å®¹å™¨ä¸­æ‰€æœ‰çš„åˆ‡é¢ï¼ŒæŸ¥æ‰¾ä¸å½“å‰å®ä¾‹åŒ– bean åŒ¹é…çš„åˆ‡é¢ï¼Œè¿™é‡Œä¼šè·å–äº‹åŠ¡å±æ€§åˆ‡é¢ï¼ŒæŸ¥æ‰¾@Transactional æ³¨è§£åŠå…¶å±æ€§å€¼ï¼Œç„¶åæ ¹æ®å¾—åˆ°çš„åˆ‡é¢åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†åˆ›å»ºä»£ç†ï¼Œå¦‚æœç›®æ ‡ç±»æ˜¯æ¥å£ï¼Œåˆ™ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ï¼Œå¦åˆ™ä½¿ç”¨ Cglibã€‚

- **åœ¨æ‰§è¡Œç›®æ ‡æ–¹æ³•æ—¶è¿›è¡Œäº‹åŠ¡å¢å¼ºæ“ä½œ**ï¼šå½“é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ Bean æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šè§¦å‘å¯¹åº”çš„ AOP å¢å¼ºæ‹¦æˆªå™¨ï¼Œå£°æ˜å¼äº‹åŠ¡æ˜¯ä¸€ç§ç¯ç»•å¢å¼ºï¼Œå¯¹åº”æ¥å£ä¸º`MethodInterceptor`ï¼Œäº‹åŠ¡å¢å¼ºå¯¹è¯¥æ¥å£çš„å®ç°ä¸º`TransactionInterceptor`ï¼Œç±»å›¾å¦‚ä¸‹ï¼š

![å›¾ç‰‡æ¥æºç½‘æ˜“æŠ€æœ¯ä¸“æ ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-97493c7f-c596-4e98-a6a8-dab254d6d1ab.png)

  äº‹åŠ¡æ‹¦æˆªå™¨`TransactionInterceptor`åœ¨`invoke`æ–¹æ³•ä¸­ï¼Œé€šè¿‡è°ƒç”¨çˆ¶ç±»`TransactionAspectSupport`çš„`invokeWithinTransaction`æ–¹æ³•è¿›è¡Œäº‹åŠ¡å¤„ç†ï¼ŒåŒ…æ‹¬å¼€å¯äº‹åŠ¡ã€äº‹åŠ¡æäº¤ã€å¼‚å¸¸å›æ»šã€‚

### 27.å£°æ˜å¼äº‹åŠ¡åœ¨å“ªäº›æƒ…å†µä¸‹ä¼šå¤±æ•ˆï¼Ÿ

![å£°æ˜å¼äº‹åŠ¡çš„å‡ ç§å¤±æ•ˆçš„æƒ…å†µ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-381e4ec9-a235-4cfa-9b4d-518095a7502a.png)

**1ã€@Transactional åº”ç”¨åœ¨é public ä¿®é¥°çš„æ–¹æ³•ä¸Š**

å¦‚æœ Transactional æ³¨è§£åº”ç”¨åœ¨é public ä¿®é¥°çš„æ–¹æ³•ä¸Šï¼ŒTransactional å°†ä¼šå¤±æ•ˆã€‚

æ˜¯å› ä¸ºåœ¨ Spring AOP ä»£ç†æ—¶ï¼ŒTransactionInterceptor ï¼ˆäº‹åŠ¡æ‹¦æˆªå™¨ï¼‰åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰åè¿›è¡Œæ‹¦æˆªï¼ŒDynamicAdvisedInterceptorï¼ˆCglibAopProxy çš„å†…éƒ¨ç±»ï¼‰çš„ intercept æ–¹æ³• æˆ– JdkDynamicAopProxy çš„ invoke æ–¹æ³•ä¼šé—´æ¥è°ƒç”¨ AbstractFallbackTransactionAttributeSource çš„ **computeTransactionAttribute**æ–¹æ³•ï¼Œè·å– Transactional æ³¨è§£çš„äº‹åŠ¡é…ç½®ä¿¡æ¯ã€‚

```java
protected TransactionAttribute computeTransactionAttribute(Method method,
    Class<?> targetClass) {
        // Don't allow no-public methods as required.
        if (allowPublicMethodsOnly() && !Modifier.isPublic(method.getModifiers())) {
        return null;
}
```

æ­¤æ–¹æ³•ä¼šæ£€æŸ¥ç›®æ ‡æ–¹æ³•çš„ä¿®é¥°ç¬¦æ˜¯å¦ä¸º publicï¼Œä¸æ˜¯ public åˆ™ä¸ä¼šè·å–@Transactional çš„å±æ€§é…ç½®ä¿¡æ¯ã€‚

**2ã€@Transactional æ³¨è§£å±æ€§ propagation è®¾ç½®é”™è¯¯**

- TransactionDefinition.PROPAGATION_SUPPORTSï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡çš„æ–¹å¼ç»§ç»­è¿è¡Œã€‚
- TransactionDefinition.PROPAGATION_NOT_SUPPORTEDï¼šä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚
- TransactionDefinition.PROPAGATION_NEVERï¼šä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚

**3ã€@Transactional æ³¨è§£å±æ€§ rollbackFor è®¾ç½®é”™è¯¯**

rollbackFor å¯ä»¥æŒ‡å®šèƒ½å¤Ÿè§¦å‘äº‹åŠ¡å›æ»šçš„å¼‚å¸¸ç±»å‹ã€‚Spring é»˜è®¤æŠ›å‡ºäº†æœªæ£€æŸ¥ unchecked å¼‚å¸¸ï¼ˆç»§æ‰¿è‡ª RuntimeException çš„å¼‚å¸¸ï¼‰æˆ–è€… Error æ‰å›æ»šäº‹åŠ¡ï¼Œå…¶ä»–å¼‚å¸¸ä¸ä¼šè§¦å‘å›æ»šäº‹åŠ¡ã€‚

![Springé»˜è®¤æ”¯æŒçš„å¼‚å¸¸å›æ»š](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-04053b02-3264-4d7f-b868-560a0333f08d.png)

```java
// å¸Œæœ›è‡ªå®šä¹‰çš„å¼‚å¸¸å¯ä»¥è¿›è¡Œå›æ»š
@Transactional(propagation= Propagation.REQUIRED,rollbackFor= MyException.class
```

è‹¥åœ¨ç›®æ ‡æ–¹æ³•ä¸­æŠ›å‡ºçš„å¼‚å¸¸æ˜¯ rollbackFor æŒ‡å®šçš„å¼‚å¸¸çš„å­ç±»ï¼Œäº‹åŠ¡åŒæ ·ä¼šå›æ»šã€‚

**4ã€åŒä¸€ä¸ªç±»ä¸­æ–¹æ³•è°ƒç”¨ï¼Œå¯¼è‡´@Transactional å¤±æ•ˆ**

å¼€å‘ä¸­é¿å…ä¸äº†ä¼šå¯¹åŒä¸€ä¸ªç±»é‡Œé¢çš„æ–¹æ³•è°ƒç”¨ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªç±» Testï¼Œå®ƒçš„ä¸€ä¸ªæ–¹æ³• Aï¼ŒA å†è°ƒç”¨æœ¬ç±»çš„æ–¹æ³• Bï¼ˆä¸è®ºæ–¹æ³• B æ˜¯ç”¨ public è¿˜æ˜¯ private ä¿®é¥°ï¼‰ï¼Œä½†æ–¹æ³• A æ²¡æœ‰å£°æ˜æ³¨è§£äº‹åŠ¡ï¼Œè€Œ B æ–¹æ³•æœ‰ã€‚åˆ™å¤–éƒ¨è°ƒç”¨æ–¹æ³• A ä¹‹åï¼Œæ–¹æ³• B çš„äº‹åŠ¡æ˜¯ä¸ä¼šèµ·ä½œç”¨çš„ã€‚è¿™ä¹Ÿæ˜¯ç»å¸¸çŠ¯é”™è¯¯çš„ä¸€ä¸ªåœ°æ–¹ã€‚

é‚£ä¸ºå•¥ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Ÿå…¶å®è¿™è¿˜æ˜¯ç”±äºä½¿ç”¨ Spring AOP ä»£ç†é€ æˆçš„ï¼Œå› ä¸ºåªæœ‰å½“äº‹åŠ¡æ–¹æ³•è¢«å½“å‰ç±»ä»¥å¤–çš„ä»£ç è°ƒç”¨æ—¶ï¼Œæ‰ä¼šç”± Spring ç”Ÿæˆçš„ä»£ç†å¯¹è±¡æ¥ç®¡ç†ã€‚

```java
 //@Transactional
     @GetMapping("/test")
     private Integer A() throws Exception {
         CityInfoDict cityInfoDict = new CityInfoDict();
         cityInfoDict.setCityName("2");
         /**
          * B æ’å…¥å­—æ®µä¸º 3çš„æ•°æ®
          */
         this.insertB();
        /**
         * A æ’å…¥å­—æ®µä¸º 2çš„æ•°æ®
         */
        int insert = cityInfoDictMapper.insert(cityInfoDict);
        return insert;
    }

    @Transactional()
    public Integer insertB() throws Exception {
        CityInfoDict cityInfoDict = new CityInfoDict();
        cityInfoDict.setCityName("3");
        cityInfoDict.setParentCityId(3);

        return cityInfoDictMapper.insert(cityInfoDict);
    }

```

è¿™ç§æƒ…å†µæ˜¯æœ€å¸¸è§çš„ä¸€ç§@Transactional æ³¨è§£å¤±æ•ˆåœºæ™¯

```java
@Transactional
private Integer A() throws Exception {
    int insert = 0;
    try {
        CityInfoDict cityInfoDict = new CityInfoDict();
        cityInfoDict.setCityName("2");
        cityInfoDict.setParentCityId(2);
        /**
         * A æ’å…¥å­—æ®µä¸º 2çš„æ•°æ®
         */
        insert = cityInfoDictMapper.insert(cityInfoDict);
        /**
         * B æ’å…¥å­—æ®µä¸º 3çš„æ•°æ®
        */
        b.insertB();
    } catch (Exception e) {
        e.printStackTrace();
    }
}

```

å¦‚æœ B æ–¹æ³•å†…éƒ¨æŠ›äº†å¼‚å¸¸ï¼Œè€Œ A æ–¹æ³•æ­¤æ—¶ try catch äº† B æ–¹æ³•çš„å¼‚å¸¸ï¼Œé‚£è¿™ä¸ªäº‹åŠ¡å°±ä¸èƒ½æ­£å¸¸å›æ»šäº†ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼š

```java
org.springframework.transaction.UnexpectedRollbackException: Transaction rolled back because it has been marked as rollback-only
```

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)


å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## MVC

### 28.Spring MVC çš„æ ¸å¿ƒç»„ä»¶ï¼Ÿ

1.  **DispatcherServlet**ï¼šå‰ç½®æ§åˆ¶å™¨ï¼Œæ˜¯æ•´ä¸ªæµç¨‹æ§åˆ¶çš„**æ ¸å¿ƒ**ï¼Œæ§åˆ¶å…¶ä»–ç»„ä»¶çš„æ‰§è¡Œï¼Œè¿›è¡Œç»Ÿä¸€è°ƒåº¦ï¼Œé™ä½ç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§ï¼Œç›¸å½“äºæ€»æŒ‡æŒ¥ã€‚
2.  **Handler**ï¼šå¤„ç†å™¨ï¼Œå®Œæˆå…·ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼Œç›¸å½“äº Servlet æˆ– Actionã€‚
3.  **HandlerMapping**ï¼šDispatcherServlet æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œé€šè¿‡ HandlerMapping å°†ä¸åŒçš„è¯·æ±‚æ˜ å°„åˆ°ä¸åŒçš„ Handlerã€‚
4.  **HandlerInterceptor**ï¼šå¤„ç†å™¨æ‹¦æˆªå™¨ï¼Œæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¦‚æœéœ€è¦å®Œæˆä¸€äº›æ‹¦æˆªå¤„ç†ï¼Œå¯ä»¥å®ç°è¯¥æ¥å£ã€‚
5.  **HandlerExecutionChain**ï¼šå¤„ç†å™¨æ‰§è¡Œé“¾ï¼ŒåŒ…æ‹¬ä¸¤éƒ¨åˆ†å†…å®¹ï¼šHandler å’Œ HandlerInterceptorï¼ˆç³»ç»Ÿä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„ HandlerInterceptorï¼Œå¦‚æœéœ€è¦é¢å¤–è®¾ç½®æ‹¦æˆªï¼Œå¯ä»¥æ·»åŠ æ‹¦æˆªå™¨ï¼‰ã€‚
6.  **HandlerAdapter**ï¼šå¤„ç†å™¨é€‚é…å™¨ï¼ŒHandler æ‰§è¡Œä¸šåŠ¡æ–¹æ³•ä¹‹å‰ï¼Œéœ€è¦è¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œï¼ŒåŒ…æ‹¬è¡¨å•æ•°æ®çš„éªŒè¯ã€æ•°æ®ç±»å‹çš„è½¬æ¢ã€å°†è¡¨å•æ•°æ®å°è£…åˆ° JavaBean ç­‰ï¼Œè¿™äº›æ“ä½œéƒ½æ˜¯ç”± HandlerApater æ¥å®Œæˆï¼Œå¼€å‘è€…åªéœ€å°†æ³¨æ„åŠ›é›†ä¸­ä¸šåŠ¡é€»è¾‘çš„å¤„ç†ä¸Šï¼ŒDispatcherServlet é€šè¿‡ HandlerAdapter æ‰§è¡Œä¸åŒçš„ Handlerã€‚
7.  **ModelAndView**ï¼šè£…è½½äº†æ¨¡å‹æ•°æ®å’Œè§†å›¾ä¿¡æ¯ï¼Œä½œä¸º Handler çš„å¤„ç†ç»“æœï¼Œè¿”å›ç»™ DispatcherServletã€‚
8.  **ViewResolver**ï¼šè§†å›¾è§£æå™¨ï¼ŒDispatcheServlet é€šè¿‡å®ƒå°†é€»è¾‘è§†å›¾è§£æä¸ºç‰©ç†è§†å›¾ï¼Œæœ€ç»ˆå°†æ¸²æŸ“ç»“æœå“åº”ç»™å®¢æˆ·ç«¯ã€‚

### 29.Spring MVC çš„å·¥ä½œæµç¨‹ï¼Ÿ

![Spring MVCçš„å·¥ä½œæµç¨‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-e29a122b-db07-48b8-8289-7251032e87a1.png)

1. å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šå…ˆåˆ°å‰ç«¯æ§åˆ¶å™¨ DispatcherServlet(ä¹Ÿå«ä¸­å¤®æ§åˆ¶å™¨)ã€‚
2. DispatcherServlet æ¥æ”¶åˆ°è¯·æ±‚åä¼šè°ƒç”¨ HandlerMapping å¤„ç†å™¨æ˜ å°„å™¨ã€‚ç”±æ­¤å¾—çŸ¥ï¼Œè¯¥è¯·æ±‚è¯¥ç”±å“ªä¸ª Controller æ¥å¤„ç†ï¼ˆå¹¶æœªè°ƒç”¨ Controllerï¼Œåªæ˜¯å¾—çŸ¥ï¼‰
3. DispatcherServlet è°ƒç”¨ HandlerAdapter å¤„ç†å™¨é€‚é…å™¨ï¼Œå‘Šè¯‰å¤„ç†å™¨é€‚é…å™¨åº”è¯¥è¦å»æ‰§è¡Œå“ªä¸ª Controller
4. HandlerAdapter å¤„ç†å™¨é€‚é…å™¨å»æ‰§è¡Œ Controller å¹¶å¾—åˆ° ModelAndView(æ•°æ®å’Œè§†å›¾)ï¼Œå¹¶å±‚å±‚è¿”å›ç»™ DispatcherServlet
5. DispatcherServlet å°† ModelAndView äº¤ç»™ ViewReslover è§†å›¾è§£æå™¨è§£æï¼Œç„¶åè¿”å›çœŸæ­£çš„è§†å›¾ã€‚
6. DispatcherServlet å°†æ¨¡å‹æ•°æ®å¡«å……åˆ°è§†å›¾ä¸­
7. DispatcherServlet å°†ç»“æœå“åº”ç»™å®¢æˆ·ç«¯

**Spring MVC** è™½ç„¶æ•´ä½“æµç¨‹å¤æ‚ï¼Œä½†æ˜¯å®é™…å¼€å‘ä¸­å¾ˆç®€å•ï¼Œå¤§éƒ¨åˆ†çš„ç»„ä»¶ä¸éœ€è¦å¼€å‘äººå‘˜åˆ›å»ºå’Œç®¡ç†ï¼Œåªéœ€è¦é€šè¿‡é…ç½®æ–‡ä»¶çš„æ–¹å¼å®Œæˆé…ç½®å³å¯ï¼ŒçœŸæ­£éœ€è¦å¼€å‘äººå‘˜è¿›è¡Œå¤„ç†çš„åªæœ‰ **Handlerï¼ˆControllerï¼‰** ã€**View** ã€**Model**ã€‚

å½“ç„¶æˆ‘ä»¬ç°åœ¨å¤§éƒ¨åˆ†çš„å¼€å‘éƒ½æ˜¯å‰åç«¯åˆ†ç¦»ï¼ŒRestful é£æ ¼æ¥å£ï¼Œåç«¯åªéœ€è¦è¿”å› Json æ•°æ®å°±è¡Œäº†ã€‚

### 30.SpringMVC Restful é£æ ¼çš„æ¥å£çš„æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ

PS:è¿™æ˜¯ä¸€é“å…¨æ–°çš„å…«è‚¡ï¼Œæ¯•ç«Ÿ ModelAndView è¿™ç§æ–¹å¼åº”è¯¥æ²¡äººç”¨äº†å§ï¼Ÿç°åœ¨éƒ½æ˜¯å‰åç«¯åˆ†ç¦»æ¥å£ï¼Œå…«è‚¡ä¹Ÿè¯¥æ›´æ–°æ¢ä»£äº†ã€‚

æˆ‘ä»¬éƒ½çŸ¥é“ Restful æ¥å£ï¼Œå“åº”æ ¼å¼æ˜¯ jsonï¼Œè¿™å°±ç”¨åˆ°äº†ä¸€ä¸ªå¸¸ç”¨æ³¨è§£ï¼š**@ResponseBody**

```java
    @GetMapping("/user")
    @ResponseBody
    public User user(){
        return new User(1,"å¼ ä¸‰");
    }
```

åŠ å…¥äº†è¿™ä¸ªæ³¨è§£åï¼Œæ•´ä½“çš„æµç¨‹ä¸Šå’Œä½¿ç”¨ ModelAndView å¤§ä½“ä¸Šç›¸åŒï¼Œä½†æ˜¯ç»†èŠ‚ä¸Šæœ‰ä¸€äº›ä¸åŒï¼š

![Spring MVC Restfulè¯·æ±‚å“åº”ç¤ºæ„å›¾](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-2da963a0-5da9-4b3a-aafd-fd8dbc7e1807.png)

1. å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šå…ˆåˆ°å‰ç«¯æ§åˆ¶å™¨ DispatcherServlet

2. DispatcherServlet æ¥æ”¶åˆ°è¯·æ±‚åä¼šè°ƒç”¨ HandlerMapping å¤„ç†å™¨æ˜ å°„å™¨ã€‚ç”±æ­¤å¾—çŸ¥ï¼Œè¯¥è¯·æ±‚è¯¥ç”±å“ªä¸ª Controller æ¥å¤„ç†

3. DispatcherServlet è°ƒç”¨ HandlerAdapter å¤„ç†å™¨é€‚é…å™¨ï¼Œå‘Šè¯‰å¤„ç†å™¨é€‚é…å™¨åº”è¯¥è¦å»æ‰§è¡Œå“ªä¸ª Controller

4. Controller è¢«å°è£…æˆäº† ServletInvocableHandlerMethodï¼ŒHandlerAdapter å¤„ç†å™¨é€‚é…å™¨å»æ‰§è¡Œ invokeAndHandle æ–¹æ³•ï¼Œå®Œæˆå¯¹ Controller çš„è¯·æ±‚å¤„ç†

5. HandlerAdapter æ‰§è¡Œå®Œå¯¹ Controller çš„è¯·æ±‚ï¼Œä¼šè°ƒç”¨ HandlerMethodReturnValueHandler å»å¤„ç†è¿”å›å€¼ï¼Œä¸»è¦çš„è¿‡ç¨‹ï¼š

   5.1. è°ƒç”¨ RequestResponseBodyMethodProcessorï¼Œåˆ›å»º ServletServerHttpResponseï¼ˆSpring å¯¹åŸç”Ÿ ServerHttpResponse çš„å°è£…ï¼‰å®ä¾‹

   5.2.ä½¿ç”¨ HttpMessageConverter çš„ write æ–¹æ³•ï¼Œå°†è¿”å›å€¼å†™å…¥ ServletServerHttpResponse çš„ OutputStream è¾“å‡ºæµä¸­

   5.3.åœ¨å†™å…¥çš„è¿‡ç¨‹ä¸­ï¼Œä¼šä½¿ç”¨ JsonGeneratorï¼ˆé»˜è®¤ä½¿ç”¨ Jackson æ¡†æ¶ï¼‰å¯¹è¿”å›å€¼è¿›è¡Œ Json åºåˆ—åŒ–

6. æ‰§è¡Œå®Œè¯·æ±‚åï¼Œè¿”å›çš„ ModealAndView ä¸º nullï¼ŒServletServerHttpResponse é‡Œä¹Ÿå·²ç»å†™å…¥äº†å“åº”ï¼Œæ‰€ä»¥ä¸ç”¨å…³å¿ƒ View çš„å¤„ç†

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)


å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## Spring Boot

### 31.ä»‹ç»ä¸€ä¸‹ SpringBootï¼Œæœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ

Spring Boot åŸºäº Spring å¼€å‘ï¼ŒSpirng Boot æœ¬èº«å¹¶ä¸æä¾› Spring æ¡†æ¶çš„æ ¸å¿ƒç‰¹æ€§ä»¥åŠæ‰©å±•åŠŸèƒ½ï¼Œåªæ˜¯ç”¨äºå¿«é€Ÿã€æ•æ·åœ°å¼€å‘æ–°ä¸€ä»£åŸºäº Spring æ¡†æ¶çš„åº”ç”¨ç¨‹åºã€‚å®ƒå¹¶ä¸æ˜¯ç”¨æ¥æ›¿ä»£ Spring çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯å’Œ Spring æ¡†æ¶ç´§å¯†ç»“åˆç”¨äºæå‡ Spring å¼€å‘è€…ä½“éªŒçš„å·¥å…·ã€‚

![SpringBootå›¾æ ‡](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-d9164ee6-5c86-4313-8fd9-efb9acfa5f0b.png)

Spring Boot ä»¥`çº¦å®šå¤§äºé…ç½®`æ ¸å¿ƒæ€æƒ³å¼€å±•å·¥ä½œï¼Œç›¸æ¯” Spring å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š

1. Spring Boot å¯ä»¥å¿«é€Ÿåˆ›å»ºç‹¬ç«‹çš„ Spring åº”ç”¨ç¨‹åºã€‚
2. Spring Boot å†…åµŒäº†å¦‚ Tomcatï¼ŒJetty å’Œ Undertow è¿™æ ·çš„å®¹å™¨ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥ç›´æ¥è·‘èµ·æ¥ï¼Œç”¨ä¸ç€å†åšéƒ¨ç½²å·¥ä½œäº†ã€‚
3. Spring Boot æ— éœ€å†åƒ Spring ä¸€æ ·ä½¿ç”¨ä¸€å †ç¹ççš„ xml æ–‡ä»¶é…ç½®ã€‚
4. Spring Boot å¯ä»¥è‡ªåŠ¨é…ç½®(æ ¸å¿ƒ)Springã€‚SpringBoot å°†åŸæœ‰çš„ XML é…ç½®æ”¹ä¸º Java é…ç½®ï¼Œå°† bean æ³¨å…¥æ”¹ä¸ºä½¿ç”¨æ³¨è§£æ³¨å…¥çš„æ–¹å¼(@Autowire)ï¼Œå¹¶å°†å¤šä¸ª xmlã€properties é…ç½®æµ“ç¼©åœ¨ä¸€ä¸ª appliaction.yml é…ç½®æ–‡ä»¶ä¸­ã€‚
5. Spring Boot æä¾›äº†ä¸€äº›ç°æœ‰çš„åŠŸèƒ½ï¼Œå¦‚é‡åº¦å·¥å…·ï¼Œè¡¨å•æ•°æ®éªŒè¯ä»¥åŠä¸€äº›å¤–éƒ¨é…ç½®è¿™æ ·çš„ä¸€äº›ç¬¬ä¸‰æ–¹åŠŸèƒ½ã€‚
6. Spring Boot å¯ä»¥å¿«é€Ÿæ•´åˆå¸¸ç”¨ä¾èµ–ï¼ˆå¼€å‘åº“ï¼Œä¾‹å¦‚ spring-webmvcã€jackson-jsonã€validation-api å’Œ tomcat ç­‰ï¼‰ï¼Œæä¾›çš„ POM å¯ä»¥ç®€åŒ– Maven çš„é…ç½®ã€‚å½“æˆ‘ä»¬å¼•å…¥æ ¸å¿ƒä¾èµ–æ—¶ï¼ŒSpringBoot ä¼šè‡ªå¼•å…¥å…¶ä»–ä¾èµ–ã€‚

### 32.SpringBoot è‡ªåŠ¨é…ç½®åŸç†äº†è§£å—ï¼Ÿ

SpringBoot å¼€å¯è‡ªåŠ¨é…ç½®çš„æ³¨è§£æ˜¯`@EnableAutoConfiguration` ï¼Œå¯åŠ¨ç±»ä¸Šçš„æ³¨è§£`@SpringBootApplication`æ˜¯ä¸€ä¸ªå¤åˆæ³¨è§£ï¼ŒåŒ…å«äº†@EnableAutoConfigurationï¼š

![SpringBootè‡ªåŠ¨é…ç½®åŸç†](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-df77ee15-2ff0-4ec7-8e65-e4ebb8ba88f1.png)

- `EnableAutoConfiguration` åªæ˜¯ä¸€ä¸ªç®€å•çš„æ³¨è§£ï¼Œè‡ªåŠ¨è£…é…æ ¸å¿ƒåŠŸèƒ½çš„å®ç°å®é™…æ˜¯é€šè¿‡ `AutoConfigurationImportSelector`ç±»

  ```java
  @AutoConfigurationPackage //å°†mainåŒçº§çš„åŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶æ³¨å†Œåˆ°å®¹å™¨ä¸­
  @Import({AutoConfigurationImportSelector.class}) //åŠ è½½è‡ªåŠ¨è£…é…ç±» xxxAutoconfiguration
  public @interface EnableAutoConfiguration {
      String ENABLED_OVERRIDE_PROPERTY = "spring.boot.enableautoconfiguration";

      Class<?>[] exclude() default {};

      String[] excludeName() default {};
  }
  ```

- `AutoConfigurationImportSelector`å®ç°äº†`ImportSelector`æ¥å£ï¼Œè¿™ä¸ªæ¥å£çš„ä½œç”¨å°±æ˜¯æ”¶é›†éœ€è¦å¯¼å…¥çš„é…ç½®ç±»ï¼Œé…åˆ`@Import(ï¼‰`å°±å¯ä»¥å°†ç›¸åº”çš„ç±»å¯¼å…¥åˆ° Spring å®¹å™¨ä¸­

- è·å–æ³¨å…¥ç±»çš„æ–¹æ³•æ˜¯ selectImports()ï¼Œå®ƒå®é™…è°ƒç”¨çš„æ˜¯`getAutoConfigurationEntry`ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯è·å–è‡ªåŠ¨è£…é…ç±»çš„å…³é”®ï¼Œä¸»è¦æµç¨‹å¯ä»¥åˆ†ä¸ºè¿™ä¹ˆå‡ æ­¥ï¼š

  1. è·å–æ³¨è§£çš„å±æ€§ï¼Œç”¨äºåé¢çš„æ’é™¤
  2. **è·å–æ‰€æœ‰éœ€è¦è‡ªåŠ¨è£…é…çš„é…ç½®ç±»çš„è·¯å¾„**ï¼šè¿™ä¸€æ­¥æ˜¯æœ€å…³é”®çš„ï¼Œä» META-INF/spring.factories è·å–è‡ªåŠ¨é…ç½®ç±»çš„è·¯å¾„
  3. å»æ‰é‡å¤çš„é…ç½®ç±»å’Œéœ€è¦æ’é™¤çš„é‡å¤ç±»ï¼ŒæŠŠéœ€è¦è‡ªåŠ¨åŠ è½½çš„é…ç½®ç±»çš„è·¯å¾„å­˜å‚¨èµ·æ¥

```java
    protected AutoConfigurationImportSelector.AutoConfigurationEntry getAutoConfigurationEntry(AnnotationMetadata annotationMetadata) {
        if (!this.isEnabled(annotationMetadata)) {
            return EMPTY_ENTRY;
        } else {
            //1.è·å–åˆ°æ³¨è§£çš„å±æ€§
            AnnotationAttributes attributes = this.getAttributes(annotationMetadata);
            //2.è·å–éœ€è¦è‡ªåŠ¨è£…é…çš„æ‰€æœ‰é…ç½®ç±»ï¼Œè¯»å–META-INF/spring.factoriesï¼Œè·å–è‡ªåŠ¨é…ç½®ç±»è·¯å¾„
            List<String> configurations = this.getCandidateConfigurations(annotationMetadata, attributes);
            //3.1.ç§»é™¤é‡å¤çš„é…ç½®
            configurations = this.removeDuplicates(configurations);
            //3.2.å¤„ç†éœ€è¦æ’é™¤çš„é…ç½®
            Set<String> exclusions = this.getExclusions(annotationMetadata, attributes);
            this.checkExcludedClasses(configurations, exclusions);
            configurations.removeAll(exclusions);
            configurations = this.getConfigurationClassFilter().filter(configurations);
            this.fireAutoConfigurationImportEvents(configurations, exclusions);
            return new AutoConfigurationImportSelector.AutoConfigurationEntry(configurations, exclusions);
        }
    }
```

### 33.å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ª SpringBoot Srarter?

çŸ¥é“äº†è‡ªåŠ¨é…ç½®åŸç†ï¼Œåˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ SpringBoot Starter ä¹Ÿå¾ˆç®€å•ã€‚

1. åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå‘½åä¸º demo-spring-boot-starterï¼Œå¼•å…¥ SpringBoot ç›¸å…³ä¾èµ–

```java
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-configuration-processor</artifactId>
            <optional>true</optional>
        </dependency>
```

2. ç¼–å†™é…ç½®æ–‡ä»¶

   è¿™é‡Œå®šä¹‰äº†å±æ€§é…ç½®çš„å‰ç¼€

   ```java
   @ConfigurationProperties(prefix = "hello")
   public class HelloProperties {

       private String name;

       //çœç•¥getterã€setter
   }
   ```

3. è‡ªåŠ¨è£…é…

   åˆ›å»ºè‡ªåŠ¨é…ç½®ç±» HelloPropertiesConfigure

   ```java
   @Configuration
   @EnableConfigurationProperties(HelloProperties.class)
   public class HelloPropertiesConfigure {
   }
   ```

4. é…ç½®è‡ªåŠ¨ç±»

   åœ¨`/resources/META-INF/spring.factories`æ–‡ä»¶ä¸­æ·»åŠ è‡ªåŠ¨é…ç½®ç±»è·¯å¾„

   ```java
   org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
     cn.fighter3.demo.starter.configure.HelloPropertiesConfigure
   ```

5. æµ‹è¯•

   - åˆ›å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œå¼•å…¥è‡ªå®šä¹‰ starter ä¾èµ–

     ```java
             <dependency>
                 <groupId>cn.fighter3</groupId>
                 <artifactId>demo-spring-boot-starter</artifactId>
                 <version>0.0.1-SNAPSHOT</version>
             </dependency>
     ```

   - åœ¨é…ç½®æ–‡ä»¶é‡Œæ·»åŠ é…ç½®

     ```
     hello.name=å¼ ä¸‰
     ```

   - æµ‹è¯•ç±»

     ```java
     @RunWith(SpringRunner.class)
     @SpringBootTest
     public class HelloTest {
         @Autowired
         HelloProperties helloProperties;

         @Test
         public void hello(){
             System.out.println("ä½ å¥½ï¼Œ"+helloProperties.getName());
         }
     }
     ```

- è¿è¡Œç»“æœ

![è¿è¡Œç»“æœ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-3ff3cc21-6a56-434b-a89e-d2b55d558bd6.png)

è‡³æ­¤ï¼Œéšæ‰‹å†™çš„ä¸€ä¸ªè‡ªå®šä¹‰ SpringBoot-Starter å°±å®Œæˆäº†ï¼Œè™½ç„¶æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯å®Œæˆäº†ä¸»è¦çš„è‡ªåŠ¨è£…é…çš„èƒ½åŠ›ã€‚

### 34.Springboot å¯åŠ¨åŸç†ï¼Ÿ

SpringApplication è¿™ä¸ªç±»ä¸»è¦åšäº†ä»¥ä¸‹å››ä»¶äº‹æƒ…ï¼š

1.  æ¨æ–­åº”ç”¨çš„ç±»å‹æ˜¯æ™®é€šçš„é¡¹ç›®è¿˜æ˜¯ Web é¡¹ç›®
2.  æŸ¥æ‰¾å¹¶åŠ è½½æ‰€æœ‰å¯ç”¨åˆå§‹åŒ–å™¨ ï¼Œ è®¾ç½®åˆ° initializers å±æ€§ä¸­
3.  æ‰¾å‡ºæ‰€æœ‰çš„åº”ç”¨ç¨‹åºç›‘å¬å™¨ï¼Œè®¾ç½®åˆ° listeners å±æ€§ä¸­
4.  æ¨æ–­å¹¶è®¾ç½® main æ–¹æ³•çš„å®šä¹‰ç±»ï¼Œæ‰¾åˆ°è¿è¡Œçš„ä¸»ç±»

SpringBoot å¯åŠ¨å¤§è‡´æµç¨‹å¦‚ä¸‹ ï¼š

![SpringBoot å¯åŠ¨å¤§è‡´æµç¨‹-å›¾ç‰‡æ¥æºç½‘ç»œ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-68744556-a1ba-4e1f-a092-1582875f0da6.png)

## Spring Cloud

### 35.å¯¹ SpringCloud äº†è§£å¤šå°‘ï¼Ÿ

SpringCloud æ˜¯ Spring å®˜æ–¹æ¨å‡ºçš„å¾®æœåŠ¡æ²»ç†æ¡†æ¶ã€‚

![Spring Cloud Netfilxæ ¸å¿ƒç»„ä»¶-æ¥æºå‚è€ƒ[2]](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-92ab53d5-f303-4fc5-bd26-e62cefe374b3.png)

> **ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿ**

1.  2014 å¹´ **Martin Fowler** æå‡ºçš„ä¸€ç§æ–°çš„æ¶æ„å½¢å¼ã€‚å¾®æœåŠ¡æ¶æ„æ˜¯ä¸€ç§**æ¶æ„æ¨¡å¼**ï¼Œæå€¡å°†å•ä¸€åº”ç”¨ç¨‹åºåˆ’åˆ†æˆä¸€ç»„å°çš„æœåŠ¡ï¼ŒæœåŠ¡ä¹‹é—´ç›¸äº’åè°ƒï¼Œäº’ç›¸é…åˆï¼Œä¸ºç”¨æˆ·æä¾›æœ€ç»ˆä»·å€¼ã€‚æ¯ä¸ªæœåŠ¡è¿è¡Œåœ¨å…¶ç‹¬ç«‹çš„è¿›ç¨‹ä¸­ï¼ŒæœåŠ¡ä¸æœåŠ¡ä¹‹é—´é‡‡ç”¨è½»é‡çº§çš„é€šä¿¡æœºåˆ¶(å¦‚ HTTP æˆ– Dubbo)äº’ç›¸åä½œï¼Œæ¯ä¸ªæœåŠ¡éƒ½å›´ç»•ç€å…·ä½“çš„ä¸šåŠ¡è¿›è¡Œæ„å»ºï¼Œå¹¶ä¸”èƒ½å¤Ÿè¢«ç‹¬ç«‹çš„éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¦å¤–ï¼Œåº”å°½é‡é¿å…ç»Ÿä¸€çš„ï¼Œé›†ä¸­å¼çš„æœåŠ¡ç®¡ç†æœºåˆ¶ï¼Œå¯¹å…·ä½“çš„ä¸€ä¸ªæœåŠ¡è€Œè¨€ï¼Œåº”æ ¹æ®ä¸šåŠ¡ä¸Šä¸‹æ–‡ï¼Œé€‰æ‹©åˆé€‚çš„è¯­è¨€ã€å·¥å…·(å¦‚ Maven)å¯¹å…¶è¿›è¡Œæ„å»ºã€‚
2.  å¾®æœåŠ¡åŒ–çš„æ ¸å¿ƒå°±æ˜¯å°†ä¼ ç»Ÿçš„ä¸€ç«™å¼åº”ç”¨ï¼Œæ ¹æ®ä¸šåŠ¡æ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªçš„æœåŠ¡ï¼Œå½»åº•åœ°å»è€¦åˆï¼Œæ¯ä¸€ä¸ªå¾®æœåŠ¡æä¾›å•ä¸ªä¸šåŠ¡åŠŸèƒ½çš„æœåŠ¡ï¼Œä¸€ä¸ªæœåŠ¡åšä¸€ä»¶äº‹æƒ…ï¼Œä»æŠ€æœ¯è§’åº¦çœ‹å°±æ˜¯ä¸€ç§å°è€Œç‹¬ç«‹çš„å¤„ç†è¿‡ç¨‹ï¼Œç±»ä¼¼è¿›ç¨‹çš„æ¦‚å¿µï¼Œèƒ½å¤Ÿè‡ªè¡Œå•ç‹¬å¯åŠ¨æˆ–é”€æ¯ï¼Œæ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æ•°æ®åº“ã€‚

> **å¾®æœåŠ¡æ¶æ„ä¸»è¦è¦è§£å†³å“ªäº›é—®é¢˜ï¼Ÿ**

1.  æœåŠ¡å¾ˆå¤šï¼Œå®¢æˆ·ç«¯æ€ä¹ˆè®¿é—®ï¼Œå¦‚ä½•æä¾›å¯¹å¤–ç½‘å…³?
2.  è¿™ä¹ˆå¤šæœåŠ¡ï¼ŒæœåŠ¡ä¹‹é—´å¦‚ä½•é€šä¿¡? HTTP è¿˜æ˜¯ RPC?
3.  è¿™ä¹ˆå¤šæœåŠ¡ï¼Œå¦‚ä½•æ²»ç†? æœåŠ¡çš„æ³¨å†Œå’Œå‘ç°ã€‚
4.  æœåŠ¡æŒ‚äº†æ€ä¹ˆåŠï¼Ÿç†”æ–­æœºåˆ¶ã€‚

> **æœ‰å“ªäº›ä¸»æµå¾®æœåŠ¡æ¡†æ¶ï¼Ÿ**

1.  Spring Cloud Netflix
2.  Spring Cloud Alibaba
3.  SpringBoot + Dubbo + ZooKeeper

> **SpringCloud æœ‰å“ªäº›æ ¸å¿ƒç»„ä»¶ï¼Ÿ**

![SpringCloud](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-2b988a72-0739-4fed-b271-eaf12589444f.png)

PS:å¾®æœåŠ¡åé¢æœ‰æœºä¼šå†æ‰©å±•ï¼Œå…¶å®é¢è¯•ä¸€èˆ¬éƒ½æ˜¯ç»“åˆé¡¹ç›®å»é—®ã€‚

---

*æ²¡æœ‰ä»€ä¹ˆä½¿æˆ‘åœç•™â€”â€”é™¤äº†ç›®çš„ï¼Œçºµç„¶å²¸æ—æœ‰ç«ç‘°ã€æœ‰ç»¿è«ã€æœ‰å®é™çš„æ¸¯æ¹¾ï¼Œæˆ‘æ˜¯ä¸ç³»ä¹‹èˆŸ*ã€‚


**ç³»åˆ—å†…å®¹**ï¼š

- [é¢æ¸£é€†è¢­ Java SE ç¯‡ğŸ‘](https://tobebetterjavaer.com/sidebar/sanfene/javase.html)
- [é¢æ¸£é€†è¢­ Java é›†åˆæ¡†æ¶ç¯‡ğŸ‘](https://tobebetterjavaer.com/sidebar/sanfene/javathread.html)
- [é¢æ¸£é€†è¢­ Java å¹¶å‘ç¼–ç¨‹ç¯‡ğŸ‘](https://tobebetterjavaer.com/sidebar/sanfene/collection.html)
- [é¢æ¸£é€†è¢­ JVM ç¯‡ğŸ‘](https://tobebetterjavaer.com/sidebar/sanfene/jvm.html)
- [é¢æ¸£é€†è¢­ Spring ç¯‡ğŸ‘](https://tobebetterjavaer.com/sidebar/sanfene/spring.html)
- [é¢æ¸£é€†è¢­ Redis ç¯‡ğŸ‘](https://tobebetterjavaer.com/sidebar/sanfene/redis.html)
- [é¢æ¸£é€†è¢­ MyBatis ç¯‡ğŸ‘](https://tobebetterjavaer.com/sidebar/sanfene/mybatis.html)
- [é¢æ¸£é€†è¢­ MySQL ç¯‡ğŸ‘](https://tobebetterjavaer.com/sidebar/sanfene/mysql.html)
- [é¢æ¸£é€†è¢­æ“ä½œç³»ç»Ÿç¯‡ğŸ‘](https://tobebetterjavaer.com/sidebar/sanfene/os.html)
- [é¢æ¸£é€†è¢­è®¡ç®—æœºç½‘ç»œç¯‡ğŸ‘](https://tobebetterjavaer.com/sidebar/sanfene/network.html)
- [é¢æ¸£é€†è¢­RocketMQç¯‡ğŸ‘](https://tobebetterjavaer.com/sidebar/sanfene/rocketmq.html)

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)


å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

>  å›¾æ–‡è¯¦è§£ 35 é“Springé¢è¯•é«˜é¢‘é¢˜ï¼Œè¿™æ¬¡åŠæ‰“é¢è¯•å®˜ï¼Œæˆ‘è§‰å¾—ç¨³äº†ï¼ˆæ‰‹åŠ¨ dogï¼‰ã€‚æ•´ç†ï¼šæ²‰é»˜ç‹äºŒï¼Œæˆ³[è½¬è½½é“¾æ¥](https://mp.weixin.qq.com/s/EQge6DmgIqYITM3mAxkatg)ï¼Œä½œè€…ï¼šä¸‰åˆ†æ¶ï¼Œæˆ³[åŸæ–‡é“¾æ¥](https://mp.weixin.qq.com/s/Y17S85ntHm_MLTZMJdtjQQ)ã€‚
