---
title: Springé¢è¯•é¢˜ï¼Œ37é“Springå…«è‚¡æ–‡ï¼ˆ1.3ä¸‡å­—63å¼ æ‰‹ç»˜å›¾ï¼‰ï¼Œé¢æ¸£é€†è¢­å¿…çœ‹ğŸ‘
shortTitle: é¢æ¸£é€†è¢­-Spring
description: ä¸‹è½½æ¬¡æ•°è¶… 1 ä¸‡æ¬¡ï¼Œ1.3 ä¸‡å­— 63 å¼ æ‰‹ç»˜å›¾ï¼Œè¯¦è§£ 37 é“ Spring é¢è¯•é«˜é¢‘é¢˜ï¼ˆè®©å¤©ä¸‹æ²¡æœ‰éš¾èƒŒçš„å…«è‚¡ï¼‰ï¼Œé¢æ¸£èƒŒä¼šè¿™äº› Spring å…«è‚¡æ–‡ï¼Œè¿™æ¬¡åŠæ‰“é¢è¯•å®˜ï¼Œæˆ‘è§‰å¾—ç¨³äº†ï¼ˆæ‰‹åŠ¨ dogï¼‰ã€‚
author: ä¸‰åˆ†æ¶
category:
  - é¢æ¸£é€†è¢­
tag:
  - é¢æ¸£é€†è¢­
head:
  - - meta
    - name: keywords
      content: Springé¢è¯•é¢˜,Spring,é¢è¯•é¢˜,å…«è‚¡æ–‡,java,springå…¨å®¶æ¡¶
---

1.3 ä¸‡å­— 63 å¼ æ‰‹ç»˜å›¾ï¼Œè¯¦è§£ 37 é“ Spring é¢è¯•é«˜é¢‘é¢˜ï¼ˆè®©å¤©ä¸‹æ²¡æœ‰éš¾èƒŒçš„å…«è‚¡ï¼‰ï¼Œé¢æ¸£èƒŒä¼šè¿™äº› Spring å…«è‚¡æ–‡ï¼Œè¿™æ¬¡åŠæ‰“é¢è¯•å®˜ï¼Œæˆ‘è§‰å¾—ç¨³äº†ï¼ˆæ‰‹åŠ¨ dogï¼‰ã€‚æ•´ç†ï¼šæ²‰é»˜ç‹äºŒï¼Œæˆ³[è½¬è½½é“¾æ¥](https://mp.weixin.qq.com/s/EQge6DmgIqYITM3mAxkatg)ï¼Œä½œè€…ï¼šä¸‰åˆ†æ¶ï¼Œæˆ³[åŸæ–‡é“¾æ¥](https://mp.weixin.qq.com/s/Y17S85ntHm_MLTZMJdtjQQ)ã€‚

## åŸºç¡€

### 1.Spring æ˜¯ä»€ä¹ˆï¼Ÿç‰¹æ€§ï¼Ÿæœ‰å“ªäº›æ¨¡å—ï¼Ÿ

![Spring Logo](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-165c27b4-2ea0-409a-8fa5-389c105db0fa.png)

ä¸€å¥è¯æ¦‚æ‹¬ï¼š**Spring æ˜¯ä¸€ä¸ªè½»é‡çº§ã€éå…¥ä¾µå¼çš„æ§åˆ¶åè½¬ (IoC) å’Œé¢å‘åˆ‡é¢ (AOP) çš„æ¡†æ¶ã€‚**

2003 å¹´ï¼Œä¸€ä¸ªéŸ³ä¹å®¶ Rod Johnson å†³å®šå‘å±•ä¸€ä¸ªè½»é‡çº§çš„ Java å¼€å‘æ¡†æ¶ï¼Œ`Spring`ä½œä¸º Java æˆ˜åœºçš„é¾™éª‘å…µæ¸æ¸å´›èµ·ï¼Œå¹¶æ·˜æ±°äº†`EJB`è¿™ä¸ªä¼ ç»Ÿçš„é‡è£…éª‘å…µã€‚

![Springé‡è¦ç‰ˆæœ¬](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-5d9efb93-03a5-400c-8429-3be7c5eeddfb.png)

åˆ°äº†ç°åœ¨ï¼Œä¼ä¸šçº§å¼€å‘çš„æ ‡é…åŸºæœ¬å°±æ˜¯ **Spring5** + **Spring Boot 2** + **JDK 8**

> Spring æœ‰å“ªäº›ç‰¹æ€§å‘¢ï¼Ÿ

Spring æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼š

![Springç‰¹æ€§](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-a0f0ef9d-3289-41ea-94c2-34b7e37ef854.png)

1.  **IoC** å’Œ **DI** çš„æ”¯æŒ

Spring çš„æ ¸å¿ƒå°±æ˜¯ä¸€ä¸ªå¤§çš„å·¥å‚å®¹å™¨ï¼Œå¯ä»¥ç»´æŠ¤æ‰€æœ‰å¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–å…³ç³»ï¼ŒSpring å·¥å‚ç”¨äºç”Ÿæˆ Beanï¼Œå¹¶ä¸”ç®¡ç† Bean çš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ç°**é«˜å†…èšä½è€¦åˆ**çš„è®¾è®¡ç†å¿µã€‚

2.  AOP ç¼–ç¨‹çš„æ”¯æŒ

Spring æä¾›äº†**é¢å‘åˆ‡é¢ç¼–ç¨‹**ï¼Œå¯ä»¥æ–¹ä¾¿çš„å®ç°å¯¹ç¨‹åºè¿›è¡Œæƒé™æ‹¦æˆªã€è¿è¡Œç›‘æ§ç­‰åˆ‡é¢åŠŸèƒ½ã€‚

3.  å£°æ˜å¼äº‹åŠ¡çš„æ”¯æŒ

æ”¯æŒé€šè¿‡é…ç½®å°±æ¥å®Œæˆå¯¹äº‹åŠ¡çš„ç®¡ç†ï¼Œè€Œä¸éœ€è¦é€šè¿‡ç¡¬ç¼–ç çš„æ–¹å¼ï¼Œä»¥å‰é‡å¤çš„ä¸€äº›äº‹åŠ¡æäº¤ã€å›æ»šçš„ JDBC ä»£ç ï¼Œéƒ½å¯ä»¥ä¸ç”¨è‡ªå·±å†™äº†ã€‚

4.  å¿«æ·æµ‹è¯•çš„æ”¯æŒ

Spring å¯¹ Junit æä¾›æ”¯æŒï¼Œå¯ä»¥é€šè¿‡**æ³¨è§£**å¿«æ·åœ°æµ‹è¯• Spring ç¨‹åºã€‚

5.  å¿«é€Ÿé›†æˆåŠŸèƒ½

æ–¹ä¾¿é›†æˆå„ç§ä¼˜ç§€æ¡†æ¶ï¼ŒSpring ä¸æ’æ–¥å„ç§ä¼˜ç§€çš„å¼€æºæ¡†æ¶ï¼Œå…¶å†…éƒ¨æä¾›äº†å¯¹å„ç§ä¼˜ç§€æ¡†æ¶ï¼ˆå¦‚ï¼šStrutsã€Hibernateã€MyBatisã€Quartz ç­‰ï¼‰çš„ç›´æ¥æ”¯æŒã€‚

6.  å¤æ‚ API æ¨¡æ¿å°è£…

Spring å¯¹ JavaEE å¼€å‘ä¸­éå¸¸éš¾ç”¨çš„ä¸€äº› APIï¼ˆJDBCã€JavaMailã€è¿œç¨‹è°ƒç”¨ç­‰ï¼‰éƒ½æä¾›äº†æ¨¡æ¿åŒ–çš„å°è£…ï¼Œè¿™äº›å°è£… API çš„æä¾›ä½¿å¾—åº”ç”¨éš¾åº¦å¤§å¤§é™ä½ã€‚

### 2.Spring æœ‰å“ªäº›æ¨¡å—å‘¢ï¼Ÿ

Spring æ¡†æ¶æ˜¯åˆ†æ¨¡å—å­˜åœ¨ï¼Œé™¤äº†æœ€æ ¸å¿ƒçš„`Spring Core Container`æ˜¯å¿…è¦æ¨¡å—ä¹‹å¤–ï¼Œå…¶ä»–æ¨¡å—éƒ½æ˜¯`å¯é€‰`ï¼Œå¤§çº¦æœ‰ 20 å¤šä¸ªæ¨¡å—ã€‚

![Springæ¨¡å—åˆ’åˆ†](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-bb7c13ea-3174-4b32-84b8-821849ddc377.png)

æœ€ä¸»è¦çš„ä¸ƒå¤§æ¨¡å—ï¼š

1.  **Spring Core**ï¼šSpring æ ¸å¿ƒï¼Œå®ƒæ˜¯æ¡†æ¶æœ€åŸºç¡€çš„éƒ¨åˆ†ï¼Œæä¾› IoC å’Œä¾èµ–æ³¨å…¥ DI ç‰¹æ€§ã€‚
2.  **Spring Context**ï¼šSpring ä¸Šä¸‹æ–‡å®¹å™¨ï¼Œå®ƒæ˜¯ BeanFactory åŠŸèƒ½åŠ å¼ºçš„ä¸€ä¸ªå­æ¥å£ã€‚
3.  **Spring Web**ï¼šå®ƒæä¾› Web åº”ç”¨å¼€å‘çš„æ”¯æŒã€‚
4.  **Spring MVC**ï¼šå®ƒé’ˆå¯¹ Web åº”ç”¨ä¸­ MVC æ€æƒ³çš„å®ç°ã€‚
5.  **Spring DAO**ï¼šæä¾›å¯¹ JDBC æŠ½è±¡å±‚ï¼Œç®€åŒ–äº† JDBC ç¼–ç ï¼ŒåŒæ—¶ï¼Œç¼–ç æ›´å…·æœ‰å¥å£®æ€§ã€‚
6.  **Spring ORM**ï¼šå®ƒæ”¯æŒç”¨äºæµè¡Œçš„ ORM æ¡†æ¶çš„æ•´åˆï¼Œæ¯”å¦‚ï¼šSpring + Hibernateã€Spring + iBatisã€Spring + JDO çš„æ•´åˆç­‰ã€‚
7.  **Spring AOP**ï¼šå³é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œå®ƒæä¾›äº†ä¸ AOP è”ç›Ÿå…¼å®¹çš„ç¼–ç¨‹å®ç°ã€‚

### 3.Spring æœ‰å“ªäº›å¸¸ç”¨æ³¨è§£å‘¢ï¼Ÿ

Spring æä¾›äº†å¤§é‡çš„æ³¨è§£æ¥ç®€åŒ– Java åº”ç”¨çš„å¼€å‘å’Œé…ç½®ï¼Œä¸»è¦ç”¨äº Web å¼€å‘ã€å¾€å®¹å™¨æ³¨å…¥ Beanã€AOPã€äº‹åŠ¡æ§åˆ¶ç­‰ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringå¸¸ç”¨æ³¨è§£](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-8d0a1518-a425-4887-9735-45321095d927.png)

#### Web å¼€å‘æ–¹é¢æœ‰å“ªäº›æ³¨è§£å‘¢ï¼Ÿ

â‘ ã€`@Controller`ï¼šç”¨äºæ ‡æ³¨æ§åˆ¶å±‚ç»„ä»¶ã€‚

â‘¡ã€`@RestController`ï¼šæ˜¯`@Controller` å’Œ `@ResponseBody` çš„ç»“åˆä½“ï¼Œè¿”å› JSON æ•°æ®æ—¶ä½¿ç”¨ã€‚

â‘¢ã€`@RequestMapping`ï¼šç”¨äºæ˜ å°„è¯·æ±‚ URL åˆ°å…·ä½“çš„æ–¹æ³•ä¸Šï¼Œè¿˜å¯ä»¥ç»†åˆ†ä¸ºï¼š

- `@GetMapping`ï¼šåªèƒ½ç”¨äºå¤„ç† GET è¯·æ±‚
- `@PostMapping`ï¼šåªèƒ½ç”¨äºå¤„ç† POST è¯·æ±‚
- `@DeleteMapping`ï¼šåªèƒ½ç”¨äºå¤„ç† DELETE è¯·æ±‚

â‘£ã€`@ResponseBody`ï¼šç›´æ¥å°†è¿”å›çš„æ•°æ®æ”¾å…¥ HTTP å“åº”æ­£æ–‡ä¸­ï¼Œä¸€èˆ¬ç”¨äºè¿”å› JSON æ•°æ®ã€‚

â‘¤ã€`@RequestBody`ï¼šè¡¨ç¤ºä¸€ä¸ªæ–¹æ³•å‚æ•°åº”è¯¥ç»‘å®šåˆ° Web è¯·æ±‚ä½“ã€‚

â‘¥ã€`@PathVariable`ï¼šç”¨äºæ¥æ”¶è·¯å¾„å‚æ•°ï¼Œæ¯”å¦‚ `@RequestMapping(â€œ/hello/{name}â€)`ï¼Œè¿™é‡Œçš„ name å°±æ˜¯è·¯å¾„å‚æ•°ã€‚

â‘¦ã€`@RequestParam`ï¼šç”¨äºæ¥æ”¶è¯·æ±‚å‚æ•°ã€‚æ¯”å¦‚ `@RequestParam(name = "key") String key`ï¼Œè¿™é‡Œçš„ key å°±æ˜¯è¯·æ±‚å‚æ•°ã€‚

#### å®¹å™¨ç±»æ³¨è§£æœ‰å“ªäº›å‘¢ï¼Ÿ

- `@Component`ï¼šæ ‡è¯†ä¸€ä¸ªç±»ä¸º Spring ç»„ä»¶ï¼Œä½¿å…¶èƒ½å¤Ÿè¢« Spring å®¹å™¨è‡ªåŠ¨æ‰«æå’Œç®¡ç†ã€‚
- `@Service`ï¼šæ ‡è¯†ä¸€ä¸ªä¸šåŠ¡é€»è¾‘ç»„ä»¶ï¼ˆæœåŠ¡å±‚ï¼‰ã€‚æ¯”å¦‚ `@Service("userService")`ï¼Œè¿™é‡Œçš„ userService å°±æ˜¯ Bean çš„åç§°ã€‚
- `@Repository`ï¼šæ ‡è¯†ä¸€ä¸ªæ•°æ®è®¿é—®ç»„ä»¶ï¼ˆæŒä¹…å±‚ï¼‰ã€‚
- `@Autowired`ï¼šæŒ‰ç±»å‹è‡ªåŠ¨æ³¨å…¥ä¾èµ–ã€‚
- `@Configuration`ï¼šç”¨äºå®šä¹‰é…ç½®ç±»ï¼Œå¯æ›¿æ¢ XML é…ç½®æ–‡ä»¶ã€‚
- `@Value`ï¼šç”¨äºå°† Spring Boot ä¸­ application.properties é…ç½®çš„å±æ€§å€¼èµ‹å€¼ç»™å˜é‡ã€‚

#### AOP æ–¹é¢æœ‰å“ªäº›æ³¨è§£å‘¢ï¼Ÿ

`@Aspect` ç”¨äºå£°æ˜ä¸€ä¸ªåˆ‡é¢ï¼Œå¯ä»¥é…åˆå…¶ä»–æ³¨è§£ä¸€èµ·ä½¿ç”¨ï¼Œæ¯”å¦‚ï¼š

- `@After`ï¼šåœ¨æ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œã€‚
- `@Before`ï¼šåœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œã€‚
- `@Around`ï¼šæ–¹æ³•å‰åå‡æ‰§è¡Œã€‚
- `@PointCut`ï¼šå®šä¹‰åˆ‡ç‚¹ï¼ŒæŒ‡å®šéœ€è¦æ‹¦æˆªçš„æ–¹æ³•ã€‚

#### äº‹åŠ¡æ³¨è§£æœ‰å“ªäº›ï¼Ÿ

ä¸»è¦å°±æ˜¯ `@Transactional`ï¼Œç”¨äºå£°æ˜ä¸€ä¸ªæ–¹æ³•éœ€è¦äº‹åŠ¡æ”¯æŒã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¾®ä¼—é“¶è¡ŒåŒå­¦ 1 Java åç«¯ä¸€é¢çš„åŸé¢˜ï¼šè¯´è¯´ Spring å¸¸è§çš„æ³¨è§£ï¼Ÿ

### 4.Spring ä¸­åº”ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼å‘¢ï¼Ÿ

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringä¸­ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-ee1c5cee-8462-4bae-93ea-ec936cc77640.png)

Spring æ¡†æ¶ä¸­ç”¨äº†è›®å¤šè®¾è®¡æ¨¡å¼çš„ï¼š

â‘ ã€**å·¥å‚æ¨¡å¼**ï¼šIoC å®¹å™¨æœ¬èº«å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå·¨å¤§çš„å·¥å‚ï¼Œè´Ÿè´£åˆ›å»ºå’Œç®¡ç† Bean çš„ç”Ÿå‘½å‘¨æœŸå’Œä¾èµ–å…³ç³»ã€‚

åƒ BeanFactory å’Œ ApplicationContext æ¥å£éƒ½æä¾›äº†å·¥å‚æ¨¡å¼çš„å®ç°ï¼Œè´Ÿè´£å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£… Beanã€‚

â‘¡ã€**ä»£ç†æ¨¡å¼**ï¼šAOP çš„å®ç°å°±æ˜¯åŸºäºä»£ç†æ¨¡å¼çš„ï¼Œå¦‚æœé…ç½®äº†äº‹åŠ¡ç®¡ç†ï¼ŒSpring ä¼šä½¿ç”¨ä»£ç†æ¨¡å¼åˆ›å»ºä¸€ä¸ªè¿æ¥æ•°æ®åº“çš„ä»£ç†å¯¹è±¡ï¼Œæ¥è¿›è¡Œäº‹åŠ¡ç®¡ç†ã€‚

â‘¢ã€**å•ä¾‹æ¨¡å¼**ï¼šSpring å®¹å™¨ä¸­çš„ Bean é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ Bean çš„å”¯ä¸€æ€§ï¼Œå‡å°‘ç³»ç»Ÿå¼€é”€ã€‚

â‘£ã€**æ¨¡æ¿æ¨¡å¼**ï¼šSpring ä¸­çš„ JdbcTemplateï¼ŒHibernateTemplate ç­‰ä»¥ Template ç»“å°¾çš„ç±»ï¼Œéƒ½ä½¿ç”¨äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€‚

æ¯”å¦‚ï¼Œæˆ‘ä»¬ä½¿ç”¨ JdbcTemplateï¼Œåªéœ€è¦æä¾› SQL è¯­å¥å’Œéœ€è¦çš„å‚æ•°å°±å¯ä»¥äº†ï¼Œè‡³äºå¦‚ä½•åˆ›å»ºè¿æ¥ã€æ‰§è¡Œ SQLã€å¤„ç†ç»“æœé›†ç­‰éƒ½ç”± JdbcTemplate è¿™ä¸ªæ¨¡æ¿æ–¹æ³•æ¥å®Œæˆã€‚

â‘£ã€**è§‚å¯Ÿè€…æ¨¡å¼**ï¼šSpring äº‹ä»¶é©±åŠ¨æ¨¡å‹å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼å¾ˆç»å…¸çš„ä¸€ä¸ªåº”ç”¨ï¼ŒSpring ä¸­çš„ ApplicationListener å°±æ˜¯è§‚å¯Ÿè€…ï¼Œå½“æœ‰äº‹ä»¶ï¼ˆApplicationEventï¼‰è¢«å‘å¸ƒï¼ŒApplicationListener å°±èƒ½æ¥æ”¶åˆ°ä¿¡æ¯ã€‚

â‘¤ã€**é€‚é…å™¨æ¨¡å¼**ï¼šSpring MVC ä¸­çš„ HandlerAdapter å°±ç”¨äº†é€‚é…å™¨æ¨¡å¼ã€‚å®ƒå…è®¸ DispatcherServlet é€šè¿‡ç»Ÿä¸€çš„é€‚é…å™¨æ¥å£ä¸å¤šç§ç±»å‹çš„è¯·æ±‚å¤„ç†å™¨è¿›è¡Œäº¤äº’ã€‚

â‘¥ã€**ç­–ç•¥æ¨¡å¼**ï¼šSpring ä¸­æœ‰ä¸€ä¸ª Resource æ¥å£ï¼Œå®ƒçš„ä¸åŒå®ç°ç±»ï¼Œä¼šæ ¹æ®ä¸åŒçš„ç­–ç•¥å»è®¿é—®èµ„æºã€‚

```java
public interface ResourceLoader {

    String CLASSPATH_URL_PREFIX = ResourceUtils.CLASSPATH_URL_PREFIX;

    Resource getResource(String location);

    ClassLoader getClassLoader();
}
```

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„æºç¨‹é¢ç»åŒå­¦ 10 Java æš‘æœŸå®ä¹ ä¸€é¢é¢è¯•åŸé¢˜ï¼šSpring IoC çš„è®¾è®¡æ¨¡å¼ï¼ŒAOP çš„è®¾è®¡æ¨¡å¼
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°å…¬å¸é¢ç»åˆé›†åŒå­¦ 1 Java åç«¯é¢è¯•åŸé¢˜ï¼šSpring æ¡†æ¶ä½¿ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼ï¼Ÿ

GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹](https://javabetter.cn/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## IoC

### 5.è¯´ä¸€è¯´ä»€ä¹ˆæ˜¯ IoCï¼Ÿä»€ä¹ˆæ˜¯ DIï¼Ÿ

æ¨èé˜…è¯»ï¼š[IoC æ‰«ç›²](https://javabetter.cn/springboot/ioc.html)

æ‰€è°“çš„**IoC**ï¼ˆæ§åˆ¶åè½¬ï¼ŒInversion of Controlï¼‰ï¼Œå°±æ˜¯ç”±å®¹å™¨æ¥æ§åˆ¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œå¯¹è±¡ä¹‹é—´çš„å…³ç³»ã€‚ä»¥å‰æ˜¯æˆ‘ä»¬æƒ³è¦ä»€ä¹ˆå°±è‡ªå·±åˆ›å»ºä»€ä¹ˆï¼Œç°åœ¨æ˜¯æˆ‘ä»¬éœ€è¦ä»€ä¹ˆå®¹å™¨å°±å¸®æˆ‘ä»¬é€æ¥ä»€ä¹ˆã€‚

![å¼•å…¥IoCä¹‹å‰å’Œå¼•å…¥IoCä¹‹å](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-619da277-c15e-4dd7-9f2b-dbd809a9aaa0.png)

ä¹Ÿå°±æ˜¯è¯´ï¼Œæ§åˆ¶å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„ä¸å†æ˜¯å¼•ç”¨å®ƒçš„å¯¹è±¡ï¼Œè€Œæ˜¯å®¹å™¨ï¼Œè¿™å°±å«**æ§åˆ¶åè½¬**ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ§åˆ¶åè½¬ç¤ºæ„å›¾](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-440f5d0e-f4db-462c-97fb-d54407a354d5.png)

æ²¡æœ‰ IoC ä¹‹å‰ï¼š

```java
æˆ‘éœ€è¦ä¸€ä¸ªå¥³æœ‹å‹ï¼Œåˆšå¥½å¤§è¡—ä¸Šçªç„¶çœ‹åˆ°äº†ä¸€ä¸ªå°å§å§ï¼Œäººå¾ˆå¥½çœ‹ï¼Œäºæ˜¯æˆ‘å°±è‡ªå·±ä¸»åŠ¨ä¸Šå»æ­è®ªï¼Œè¦å¥¹çš„å¾®ä¿¡å·ï¼Œæ‰¾æœºä¼šèŠå¤©å…³å¿ƒå¥¹ï¼Œç„¶åçº¦å¥¹å‡ºæ¥åƒé¥­ï¼Œæ‰“å¬å¥¹çš„çˆ±å¥½ï¼Œä¸‰è§‚ã€‚ã€‚ã€‚
```

æœ‰äº† IoC ä¹‹åï¼š

```java
æˆ‘éœ€è¦ä¸€ä¸ªå¥³æœ‹å‹ï¼Œäºæ˜¯æˆ‘å°±å»æ‰¾å©šä»‹æ‰€ï¼Œå‘Šè¯‰å©šä»‹æ‰€ï¼Œæˆ‘éœ€è¦ä¸€ä¸ªé•¿çš„åƒèµµéœ²æ€çš„ï¼Œä¼šæ‰“ Dota2 çš„ï¼Œäºæ˜¯å©šä»‹æ‰€åœ¨å®ƒçš„äººæ‰åº“é‡Œå¼€å§‹æ‰¾ï¼Œæ‰¾ä¸åˆ°å®ƒå°±ç›´æ¥è¯´æ²¡æœ‰ï¼Œæ‰¾åˆ°å®ƒå°±ç›´æ¥ä»‹ç»ç»™æˆ‘ã€‚
```

å©šä»‹æ‰€å°±ç›¸å½“äºä¸€ä¸ª IoC å®¹å™¨ï¼Œæˆ‘å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘éœ€è¦çš„å¥³æœ‹å‹å°±æ˜¯å¦ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä¸ç”¨å…³å¿ƒå¥³æœ‹å‹æ˜¯æ€ä¹ˆæ¥çš„ï¼Œæˆ‘åªéœ€è¦å‘Šè¯‰å©šä»‹æ‰€æˆ‘éœ€è¦ä»€ä¹ˆæ ·çš„å¥³æœ‹å‹ï¼Œå©šä»‹æ‰€å°±å¸®æˆ‘å»æ‰¾ã€‚

Spring å€¡å¯¼çš„å¼€å‘æ–¹å¼å°±æ˜¯è¿™æ ·ï¼Œæ‰€æœ‰çš„ç±»åˆ›å»ºéƒ½é€šè¿‡ Spring å®¹å™¨æ¥ï¼Œä¸å†æ˜¯å¼€å‘è€…å» newï¼Œå» = null é”€æ¯ï¼Œè¿™äº›åˆ›å»ºå’Œé”€æ¯çš„å·¥ä½œéƒ½äº¤ç»™ Spring å®¹å™¨æ¥ã€‚

äºæ˜¯ï¼Œå¯¹äºæŸä¸ªå¯¹è±¡æ¥è¯´ï¼Œä»¥å‰æ˜¯å®ƒæ§åˆ¶å®ƒä¾èµ–çš„å¯¹è±¡ï¼Œç°åœ¨æ˜¯æ‰€æœ‰å¯¹è±¡éƒ½è¢« Spring æ§åˆ¶ï¼Œè¿™å°±æ˜¯**æ§åˆ¶åè½¬**ã€‚

![å›¾ç‰‡æ¥æºäºç½‘ç»œ](https://cdn.tobebetterjavaer.com/stutymore/spring-20240310191630.png)

#### è¯´è¯´ä»€ä¹ˆæ˜¯ DIï¼Ÿ

**DIï¼ˆä¾èµ–æ³¨å…¥ï¼ŒDependency Injectionï¼‰**ï¼šæœ‰äººè¯´ IoC å’Œ DI æ˜¯ä¸€å›äº‹ï¼Œæœ‰äººè¯´ IoC æ˜¯æ€æƒ³ï¼ŒDI æ˜¯ IoC çš„å®ç°ã€‚2004 å¹´ï¼ŒMartin Fowler åœ¨ä»–çš„æ–‡ç« ã€Šæ§åˆ¶åè½¬å®¹å™¨&ä¾èµ–æ³¨å…¥æ¨¡å¼ã€‹é¦–æ¬¡æå‡ºäº†ä¾èµ–æ³¨å…¥è¿™ä¸ªåè¯ã€‚

> æ§åˆ¶åè½¬è¿™ä¸ªè¯å¤ªå®½æ³›ï¼Œå¹¶ä¸èƒ½å¾ˆå¥½åœ°è§£é‡Šè¿™ä¸ªæ¡†æ¶çš„å…·ä½“å®ç°ï¼Œäºæ˜¯å°±æƒ³åˆ°äº†ä¸€ä¸ªæ–°åè¯ï¼šä¾èµ–æ³¨å…¥ã€‚

æ‰“ä¸ªæ¯”æ–¹ï¼Œä½ ç°åœ¨æƒ³åƒéŸ­èœé¦…çš„é¥ºå­ï¼Œè¿™æ—¶å€™å°±æœ‰äººç”¨é’ˆç®¡å¾€ä½ åƒçš„é¥ºå­é‡Œæ³¨å…¥éŸ­èœé¸¡è›‹é¦…ã€‚å°±å¥½åƒ A ç±»éœ€è¦ B ç±»ï¼Œä»¥å‰æ˜¯ A ç±»è‡ªå·± new ä¸€ä¸ª B ç±»ï¼Œç°åœ¨æ˜¯æœ‰äººæŠŠ B ç±»æ³¨å…¥åˆ° A ç±»é‡Œã€‚

#### ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ IoC å‘¢ï¼Ÿ

åœ¨å¹³æ—¶çš„ Java å¼€å‘ä¸­ï¼Œå¦‚æœæˆ‘ä»¬è¦å®ç°æŸä¸€ä¸ªåŠŸèƒ½ï¼Œå¯èƒ½è‡³å°‘éœ€è¦ä¸¤ä¸ªä»¥ä¸Šçš„å¯¹è±¡æ¥ååŠ©å®Œæˆï¼Œåœ¨æ²¡æœ‰ Spring ä¹‹å‰ï¼Œæ¯ä¸ªå¯¹è±¡åœ¨éœ€è¦å®ƒçš„åˆä½œå¯¹è±¡æ—¶ï¼Œéœ€è¦è‡ªå·± new ä¸€ä¸ªï¼Œæ¯”å¦‚è¯´ A è¦ä½¿ç”¨ Bï¼ŒA å°±å¯¹ B äº§ç”Ÿäº†ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯ A å’Œ B ä¹‹é—´å­˜åœ¨äº†ä¸€ç§è€¦åˆå…³ç³»ã€‚

æœ‰äº† Spring ä¹‹åï¼Œå°±ä¸ä¸€æ ·äº†ï¼Œåˆ›å»º B çš„å·¥ä½œäº¤ç»™äº† Spring æ¥å®Œæˆï¼ŒSpring åˆ›å»ºå¥½äº† B å¯¹è±¡åå°±æ”¾åˆ°å®¹å™¨ä¸­ï¼ŒA å‘Šè¯‰ Spring æˆ‘éœ€è¦ Bï¼ŒSpring å°±ä»å®¹å™¨ä¸­å–å‡º B äº¤ç»™ A æ¥ä½¿ç”¨ã€‚

è‡³äº B æ˜¯æ€ä¹ˆæ¥çš„ï¼ŒA å°±ä¸å†å…³å¿ƒäº†ï¼ŒSpring å®¹å™¨æƒ³é€šè¿‡ newnew åˆ›å»º B è¿˜æ˜¯ new åˆ›å»º Bï¼Œæ— æ‰€è°“ã€‚

è¿™å°±æ˜¯ IoC çš„å¥½å¤„ï¼Œå®ƒé™ä½äº†å¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦ï¼Œä½¿å¾—ç¨‹åºæ›´åŠ çµæ´»ï¼Œæ›´åŠ æ˜“äºç»´æŠ¤ã€‚

æ¨èé˜…è¯»ï¼š[å­¤å‚²è‹ç‹¼ï¼šè°ˆè°ˆå¯¹ Spring IOC çš„ç†è§£](https://www.cnblogs.com/xdp-gacl/p/4249939.html)

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³ 25 å±Šæ—¥å¸¸å®ä¹ ä¸€é¢åŸé¢˜ï¼šè¯´è¯´ä½ å¯¹ AOP å’Œ IoC çš„ç†è§£ã€‚
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°å…¬å¸é¢ç»åˆé›†åŒå­¦ 1 Java åç«¯é¢è¯•åŸé¢˜ï¼šä»‹ç» Spring IoC å’Œ AOP?
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„æ‹›å•†é“¶è¡Œé¢ç»åŒå­¦ 6 æ‹›é“¶ç½‘ç»œç§‘æŠ€é¢è¯•åŸé¢˜ï¼šSpringBootæ¡†æ¶çš„AOPã€IOC/DIï¼Ÿ

### 6.èƒ½ç®€å•è¯´ä¸€ä¸‹ Spring IoC çš„å®ç°æœºåˆ¶å—ï¼Ÿ

PS:è¿™é“é¢˜è€ä¸‰åœ¨é¢è¯•ä¸­è¢«é—®åˆ°è¿‡ï¼Œé—®æ³•æ˜¯â€œ**ä½ æœ‰è‡ªå·±å®ç°è¿‡ç®€å•çš„ Spring å—ï¼Ÿ**â€

Spring çš„ IoC æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå¤§å·¥å‚ï¼Œæˆ‘ä»¬æƒ³æƒ³ä¸€ä¸ªå·¥å‚æ˜¯æ€ä¹ˆè¿è¡Œçš„å‘¢ï¼Ÿ

![å·¥å‚è¿è¡Œ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-7678c40f-a48d-4bd5-80f8-e902ad688e11.png)

- **ç”Ÿäº§äº§å“**ï¼šä¸€ä¸ªå·¥å‚æœ€æ ¸å¿ƒçš„åŠŸèƒ½å°±æ˜¯ç”Ÿäº§äº§å“ã€‚åœ¨ Spring é‡Œï¼Œä¸ç”¨ Bean è‡ªå·±æ¥å®ä¾‹åŒ–ï¼Œè€Œæ˜¯äº¤ç»™ Springï¼Œåº”è¯¥æ€ä¹ˆå®ç°å‘¢ï¼Ÿâ€”â€”ç­”æ¡ˆæ¯«æ— ç–‘é—®ï¼Œ**åå°„**ã€‚

  é‚£ä¹ˆè¿™ä¸ªå‚å­çš„ç”Ÿäº§ç®¡ç†æ˜¯æ€ä¹ˆåšçš„ï¼Ÿä½ åº”è¯¥ä¹ŸçŸ¥é“â€”â€”**å·¥å‚æ¨¡å¼**ã€‚

- **åº“å­˜äº§å“**ï¼šå·¥å‚ä¸€èˆ¬éƒ½æ˜¯æœ‰åº“æˆ¿çš„ï¼Œç”¨æ¥åº“å­˜äº§å“ï¼Œæ¯•ç«Ÿç”Ÿäº§çš„äº§å“ä¸èƒ½ç«‹é©¬å°±æ‹‰èµ°ã€‚Spring æˆ‘ä»¬éƒ½çŸ¥é“æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œè¿™ä¸ªå®¹å™¨é‡Œå­˜çš„å°±æ˜¯å¯¹è±¡ï¼Œä¸èƒ½æ¯æ¬¡æ¥å–å¯¹è±¡ï¼Œéƒ½å¾—ç°åœºæ¥åå°„åˆ›å»ºå¯¹è±¡ï¼Œå¾—æŠŠåˆ›å»ºå‡ºçš„å¯¹è±¡å­˜èµ·æ¥ã€‚

- **è®¢å•å¤„ç†**ï¼šè¿˜æœ‰æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œå·¥å‚æ ¹æ®ä»€ä¹ˆæ¥æä¾›äº§å“å‘¢ï¼Ÿè®¢å•ã€‚è¿™äº›è®¢å•å¯èƒ½äº”èŠ±å…«é—¨ï¼Œæœ‰çº¿ä¸Šç­¾ç­¾çš„ã€æœ‰åˆ°å·¥å‚ç­¾çš„ã€è¿˜æœ‰å·¥å‚é”€å”®ä¸Šé—¨ç­¾çš„â€¦â€¦æœ€åç»è¿‡å¤„ç†ï¼ŒæŒ‡å¯¼å·¥å‚çš„å‡ºè´§ã€‚

  åœ¨ Spring é‡Œï¼Œä¹Ÿæœ‰è¿™æ ·çš„è®¢å•ï¼Œå®ƒå°±æ˜¯æˆ‘ä»¬ bean çš„å®šä¹‰å’Œä¾èµ–å…³ç³»ï¼Œå¯ä»¥æ˜¯ xml å½¢å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯æˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„æ³¨è§£å½¢å¼ã€‚

æˆ‘ä»¬ç®€å•åœ°å®ç°ä¸€ä¸ª mini ç‰ˆçš„ Spring IoCï¼š

![miniç‰ˆæœ¬Spring IoC](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-1d55c63d-2d12-43b1-9f43-428f5f4a1413.png)

**Bean å®šä¹‰ï¼š**

Bean é€šè¿‡ä¸€ä¸ªé…ç½®æ–‡ä»¶å®šä¹‰ï¼ŒæŠŠå®ƒè§£ææˆä¸€ä¸ªç±»å‹ã€‚

- beans.properties

  å·æ‡’ï¼Œè¿™é‡Œç›´æ¥ç”¨äº†æœ€æ–¹ä¾¿è§£æçš„ propertiesï¼Œè¿™é‡Œç›´æ¥ç”¨ä¸€ä¸ª`<key,value>`ç±»å‹çš„é…ç½®æ¥ä»£è¡¨ Bean çš„å®šä¹‰ï¼Œå…¶ä¸­ key æ˜¯ beanNameï¼Œvalue æ˜¯ class

  ```java
  userDao:cn.fighter3.bean.UserDao
  ```

- BeanDefinition.java

  bean å®šä¹‰ç±»ï¼Œé…ç½®æ–‡ä»¶ä¸­ bean å®šä¹‰å¯¹åº”çš„å®ä½“

  ```java
  public class BeanDefinition {

      private String beanName;

      private Class beanClass;
       //çœç•¥getterã€setter
   }
  ```

- ResourceLoader.java

  èµ„æºåŠ è½½å™¨ï¼Œç”¨æ¥å®Œæˆé…ç½®æ–‡ä»¶ä¸­é…ç½®çš„åŠ è½½

  ```java
  public class ResourceLoader {

      public static Map<String, BeanDefinition> getResource() {
          Map<String, BeanDefinition> beanDefinitionMap = new HashMap<>(16);
          Properties properties = new Properties();
          try {
              InputStream inputStream = ResourceLoader.class.getResourceAsStream("/beans.properties");
              properties.load(inputStream);
              Iterator<String> it = properties.stringPropertyNames().iterator();
              while (it.hasNext()) {
                  String key = it.next();
                  String className = properties.getProperty(key);
                  BeanDefinition beanDefinition = new BeanDefinition();
                  beanDefinition.setBeanName(key);
                  Class clazz = Class.forName(className);
                  beanDefinition.setBeanClass(clazz);
                  beanDefinitionMap.put(key, beanDefinition);
              }
              inputStream.close();
          } catch (IOException | ClassNotFoundException e) {
              e.printStackTrace();
          }
          return beanDefinitionMap;
      }

  }
  ```

- BeanRegister.java

  å¯¹è±¡æ³¨å†Œå™¨ï¼Œè¿™é‡Œç”¨äºå•ä¾‹ bean çš„ç¼“å­˜ï¼Œæˆ‘ä»¬å¤§å¹…ç®€åŒ–ï¼Œé»˜è®¤æ‰€æœ‰ bean éƒ½æ˜¯å•ä¾‹çš„ã€‚å¯ä»¥çœ‹åˆ°æ‰€è°“å•ä¾‹æ³¨å†Œï¼Œä¹Ÿå¾ˆç®€å•ï¼Œä¸è¿‡æ˜¯å¾€ HashMap é‡Œå­˜å¯¹è±¡ã€‚

  ```java
  public class BeanRegister {

      //å•ä¾‹Beanç¼“å­˜
      private Map<String, Object> singletonMap = new HashMap<>(32);

      /**
       * è·å–å•ä¾‹Bean
       *
       * @param beanName beanåç§°
       * @return
       */
      public Object getSingletonBean(String beanName) {
          return singletonMap.get(beanName);
      }

      /**
       * æ³¨å†Œå•ä¾‹bean
       *
       * @param beanName
       * @param bean
       */
      public void registerSingletonBean(String beanName, Object bean) {
          if (singletonMap.containsKey(beanName)) {
              return;
          }
          singletonMap.put(beanName, bean);
      }

  }
  ```

- **BeanFactory.java**

![BeanFactory](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-c6b3b707-cf53-4c7c-a6f9-8560950806fc.png)

- å¯¹è±¡å·¥å‚ï¼Œæˆ‘ä»¬æœ€**æ ¸å¿ƒ**çš„ä¸€ä¸ªç±»ï¼Œåœ¨å®ƒåˆå§‹åŒ–çš„æ—¶å€™ï¼Œåˆ›å»ºäº† bean æ³¨å†Œå™¨ï¼Œå®Œæˆäº†èµ„æºçš„åŠ è½½ã€‚

- è·å– bean çš„æ—¶å€™ï¼Œå…ˆä»å•ä¾‹ç¼“å­˜ä¸­å–ï¼Œå¦‚æœæ²¡æœ‰å–åˆ°ï¼Œå°±åˆ›å»ºå¹¶æ³¨å†Œä¸€ä¸ª bean

  ```java
  public class BeanFactory {

      private Map<String, BeanDefinition> beanDefinitionMap = new HashMap<>();

      private BeanRegister beanRegister;

      public BeanFactory() {
          //åˆ›å»ºbeanæ³¨å†Œå™¨
          beanRegister = new BeanRegister();
          //åŠ è½½èµ„æº
          this.beanDefinitionMap = new ResourceLoader().getResource();
      }

      /**
       * è·å–bean
       *
       * @param beanName beanåç§°
       * @return
       */
      public Object getBean(String beanName) {
          //ä»beanç¼“å­˜ä¸­å–
          Object bean = beanRegister.getSingletonBean(beanName);
          if (bean != null) {
              return bean;
          }
          //æ ¹æ®beanå®šä¹‰ï¼Œåˆ›å»ºbean
          return createBean(beanDefinitionMap.get(beanName));
      }

      /**
       * åˆ›å»ºBean
       *
       * @param beanDefinition beanå®šä¹‰
       * @return
       */
      private Object createBean(BeanDefinition beanDefinition) {
          try {
              Object bean = beanDefinition.getBeanClass().newInstance();
              //ç¼“å­˜bean
              beanRegister.registerSingletonBean(beanDefinition.getBeanName(), bean);
              return bean;
          } catch (InstantiationException | IllegalAccessException e) {
              e.printStackTrace();
          }
          return null;
      }
  }
  ```

- æµ‹è¯•

  - UserDao.java

    æˆ‘ä»¬çš„ Bean ç±»ï¼Œå¾ˆç®€å•

    ```java
    public class UserDao {

        public void queryUserInfo(){
            System.out.println("A good man.");
        }
    }
    ```

  - å•å…ƒæµ‹è¯•

    ```java
    public class ApiTest {
        @Test
        public void test_BeanFactory() {
            //1.åˆ›å»ºbeanå·¥å‚(åŒæ—¶å®Œæˆäº†åŠ è½½èµ„æºã€åˆ›å»ºæ³¨å†Œå•ä¾‹beanæ³¨å†Œå™¨çš„æ“ä½œ)
            BeanFactory beanFactory = new BeanFactory();

            //2.ç¬¬ä¸€æ¬¡è·å–beanï¼ˆé€šè¿‡åå°„åˆ›å»ºbeanï¼Œç¼“å­˜beanï¼‰
            UserDao userDao1 = (UserDao) beanFactory.getBean("userDao");
            userDao1.queryUserInfo();

            //3.ç¬¬äºŒæ¬¡è·å–beanï¼ˆä»ç¼“å­˜ä¸­è·å–beanï¼‰
            UserDao userDao2 = (UserDao) beanFactory.getBean("userDao");
            userDao2.queryUserInfo();
        }
    }
    ```

  - è¿è¡Œç»“æœ

    ```java
    A good man.
    A good man.
    ```

è‡³æ­¤ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¹ä¸+ç ´èˆ¹ç‰ˆçš„ Spring å°±å®Œæˆäº†ï¼Œä»£ç ä¹Ÿæ¯”è¾ƒå®Œæ•´ï¼Œæœ‰æ¡ä»¶çš„å¯ä»¥è·‘ä¸€ä¸‹ã€‚

PS:å› ä¸ºæ—¶é—´+ç¯‡å¹…çš„é™åˆ¶ï¼Œè¿™ä¸ª demo æ¯”è¾ƒç®€é™‹ï¼Œæ²¡æœ‰é¢å‘æ¥å£ã€æ²¡æœ‰è§£è€¦ã€è¾¹ç•Œæ£€æŸ¥ã€å¼‚å¸¸å¤„ç†â€¦â€¦å¥å£®æ€§ã€æ‰©å±•æ€§éƒ½æœ‰å¾ˆå¤§çš„ä¸è¶³ï¼Œæ„Ÿå…´è¶£å¯ä»¥å­¦ä¹ å‚è€ƒ[15]ã€‚

### 7.è¯´è¯´ BeanFactory å’Œ ApplicantContext?

å¯ä»¥è¿™ä¹ˆæ¯”å–»ï¼ŒBeanFactory æ˜¯ Spring çš„â€œå¿ƒè„â€ï¼Œè€Œ ApplicantContext æ˜¯ Spring çš„å®Œæ•´â€œèº«èº¯â€ã€‚

- BeanFactory ä¸»è¦è´Ÿè´£é…ç½®ã€åˆ›å»ºå’Œç®¡ç† beanï¼Œä¸º Spring æä¾›äº†åŸºæœ¬çš„ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰æ”¯æŒã€‚
- ApplicationContext æ˜¯ BeanFactory çš„å­æ¥å£ï¼Œåœ¨ BeanFactory çš„åŸºç¡€ä¸Šæ·»åŠ äº†ä¼ä¸šçº§çš„åŠŸèƒ½æ”¯æŒã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šBeanFactoryå’ŒApplicantContext](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-66328446-f89f-4b7a-8d9f-0e1145dd9b2f.png)

#### è¯¦ç»†è¯´è¯´ BeanFactory

BeanFactory ä½äºæ•´ä¸ª Spring IoC å®¹å™¨çš„é¡¶ç«¯ï¼ŒApplicationContext ç®—æ˜¯ BeanFactory çš„å­æ¥å£ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring5 BeanFactoryç»§æ‰¿ä½“ç³»](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-6e6d4b69-f36c-41e6-b8ba-9277be147c9b.png)

å®ƒæœ€ä¸»è¦çš„æ–¹æ³•å°±æ˜¯ `getBean()`ï¼Œè¿™ä¸ªæ–¹æ³•è´Ÿè´£ä»å®¹å™¨ä¸­è¿”å›ç‰¹å®šåç§°æˆ–è€…ç±»å‹çš„ Bean å®ä¾‹ã€‚

æ¥çœ‹ä¸€ä¸ª XMLBeanFactoryï¼ˆå·²è¿‡æ—¶ï¼‰ è·å– bean çš„ä¾‹å­ï¼š

```java
class HelloWorldApp{
   public static void main(String[] args) {
      BeanFactory factory = new XmlBeanFactory (new ClassPathResource("beans.xml"));
      HelloWorld obj = (HelloWorld) factory.getBean("itwanger");
      obj.getMessage();
   }
}
```

#### è¯·è¯¦ç»†è¯´è¯´ ApplicationContext

ApplicationContext ç»§æ‰¿äº† HierachicalBeanFactory å’Œ ListableBeanFactory æ¥å£ï¼Œç®—æ˜¯ BeanFactory çš„è‡ªåŠ¨æŒ¡ç‰ˆæœ¬ï¼Œæ˜¯ Spring åº”ç”¨çš„é»˜è®¤æ–¹å¼ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring5 ApplicationContextéƒ¨åˆ†ä½“ç³»ç±»å›¾](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-e201c9a3-f23c-4768-b844-ac7e0ba4bcec.png)

ApplicationContext ä¼šåœ¨å¯åŠ¨æ—¶é¢„å…ˆåˆ›å»ºå’Œé…ç½®æ‰€æœ‰çš„å•ä¾‹ beanï¼Œå¹¶æ”¯æŒå¦‚ JDBCã€ORM æ¡†æ¶çš„é›†æˆï¼Œå†…ç½®é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰çš„æ”¯æŒï¼Œå¯ä»¥é…ç½®å£°æ˜å¼äº‹åŠ¡ç®¡ç†ç­‰ã€‚

è¿™æ˜¯ ApplicationContext çš„ä½¿ç”¨ä¾‹å­ï¼š

```java
class MainApp {
    public static void main(String[] args) {
        // ä½¿ç”¨ AppConfig é…ç½®ç±»åˆå§‹åŒ– ApplicationContext
        ApplicationContext context = new AnnotationConfigApplicationContext(AppConfig.class);

        // ä» ApplicationContext è·å– messageService çš„ bean
        MessageService service = context.getBean(MessageService.class);

        // ä½¿ç”¨ bean
        service.printMessage();
    }
}
```

é€šè¿‡ AnnotationConfigApplicationContext ç±»ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Java é…ç½®ç±»æ¥åˆå§‹åŒ– ApplicationContextï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨ Java ä»£ç æ¥é…ç½® Spring å®¹å™¨ã€‚

```java
@Configuration
@ComponentScan(basePackages = "com.github.paicoding.forum.test.javabetter.spring1") // æ›¿æ¢ä¸ºä½ çš„åŒ…å
public class AppConfig {
}
```

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç¾å›¢åŒå­¦ 2 ä¼˜é€‰ç‰©æµè°ƒåº¦æŠ€æœ¯ 2 é¢é¢è¯•åŸé¢˜ï¼šBeanFactoryå’ŒApplicationContext

### 8.ä½ çŸ¥é“ Spring å®¹å™¨å¯åŠ¨é˜¶æ®µä¼šå¹²ä»€ä¹ˆå—ï¼Ÿ

Spring çš„ IoC å®¹å™¨å·¥ä½œçš„è¿‡ç¨‹ï¼Œå…¶å®å¯ä»¥åˆ’åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š**å®¹å™¨å¯åŠ¨é˜¶æ®µ**å’Œ**Bean å®ä¾‹åŒ–é˜¶æ®µ**ã€‚

å…¶ä¸­å®¹å™¨å¯åŠ¨é˜¶æ®µä¸»è¦åšçš„å·¥ä½œæ˜¯åŠ è½½å’Œè§£æé…ç½®æ–‡ä»¶ï¼Œä¿å­˜åˆ°å¯¹åº”çš„ Bean å®šä¹‰ä¸­ã€‚

![å®¹å™¨å¯åŠ¨å’ŒBeanå®ä¾‹åŒ–é˜¶æ®µ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-8f8103f7-2a51-4858-856e-96a4ac400d76.png)

å®¹å™¨å¯åŠ¨å¼€å§‹ï¼Œé¦–å…ˆä¼šé€šè¿‡æŸç§é€”å¾„åŠ è½½ Congiguration MetaDataï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå®¹å™¨éœ€è¦ä¾èµ–æŸäº›å·¥å…·ç±»ï¼ˆBeanDefinitionReaderï¼‰å¯¹åŠ è½½çš„ Congiguration MetaData è¿›è¡Œè§£æå’Œåˆ†æï¼Œå¹¶å°†åˆ†æåçš„ä¿¡æ¯ç»„ä¸ºç›¸åº”çš„ BeanDefinitionã€‚

![xmlé…ç½®ä¿¡æ¯æ˜ å°„æ³¨å†Œè¿‡ç¨‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-dfb3d8c4-ba8d-4a2c-aef2-4ad425f7180c.png)

æœ€åæŠŠè¿™äº›ä¿å­˜äº† Bean å®šä¹‰å¿…è¦ä¿¡æ¯çš„ BeanDefinitionï¼Œæ³¨å†Œåˆ°ç›¸åº”çš„ BeanDefinitionRegistryï¼Œè¿™æ ·å®¹å™¨å¯åŠ¨å°±å®Œæˆäº†ã€‚

#### è¯´è¯´ Spring çš„ Bean å®ä¾‹åŒ–æ–¹å¼

Spring æä¾›äº† 4 ç§ä¸åŒçš„æ–¹å¼æ¥å®ä¾‹åŒ– Beanï¼Œä»¥æ»¡è¶³ä¸åŒåœºæ™¯ä¸‹çš„éœ€æ±‚ã€‚

#### è¯´è¯´æ„é€ æ–¹æ³•çš„æ–¹å¼

åœ¨ç±»ä¸Šä½¿ç”¨@Componentï¼ˆæˆ–@Serviceã€@Repository ç­‰ç‰¹å®šäºåœºæ™¯çš„æ³¨è§£ï¼‰æ ‡æ³¨ç±»ï¼Œç„¶åé€šè¿‡æ„é€ æ–¹æ³•æ³¨å…¥ä¾èµ–ã€‚

```java
@Component
public class ExampleBean {
    private DependencyBean dependency;

    @Autowired
    public ExampleBean(DependencyBean dependency) {
        this.dependency = dependency;
    }
}
```

#### è¯´è¯´é™æ€å·¥å‚çš„æ–¹å¼

åœ¨è¿™ç§æ–¹å¼ä¸­ï¼ŒBean æ˜¯ç”±ä¸€ä¸ªé™æ€æ–¹æ³•åˆ›å»ºçš„ï¼Œè€Œä¸æ˜¯ç›´æ¥é€šè¿‡æ„é€ æ–¹æ³•ã€‚

```java
public class ClientService {
    private static ClientService clientService = new ClientService();

    private ClientService() {}

    public static ClientService createInstance() {
        return clientService;
    }
}
```

#### è¯´è¯´å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–çš„æ–¹å¼

ä¸é™æ€å·¥å‚æ–¹æ³•ç›¸æ¯”ï¼Œå®ä¾‹å·¥å‚æ–¹æ³•ä¾èµ–äºæŸä¸ªç±»çš„å®ä¾‹æ¥åˆ›å»º Beanã€‚è¿™é€šå¸¸ç”¨åœ¨éœ€è¦é€šè¿‡å·¥å‚å¯¹è±¡çš„éé™æ€æ–¹æ³•æ¥åˆ›å»º Bean çš„åœºæ™¯ã€‚

```java
public class ServiceLocator {
    public ClientService createClientServiceInstance() {
        return new ClientService();
    }
}
```

#### è¯´è¯´ FactoryBean æ¥å£å®ä¾‹åŒ–æ–¹å¼

FactoryBean æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ Bean ç±»å‹ï¼Œå¯ä»¥åœ¨ Spring å®¹å™¨ä¸­è¿”å›å…¶ä»–å¯¹è±¡çš„å®ä¾‹ã€‚é€šè¿‡å®ç° FactoryBean æ¥å£ï¼Œå¯ä»¥è‡ªå®šä¹‰å®ä¾‹åŒ–é€»è¾‘ï¼Œè¿™å¯¹äºæ„å»ºå¤æ‚çš„åˆå§‹åŒ–é€»è¾‘éå¸¸æœ‰ç”¨ã€‚

```java
public class ToolFactoryBean implements FactoryBean<Tool> {
    private int factoryId;
    private int toolId;

    @Override
    public Tool getObject() throws Exception {
        return new Tool(toolId);
    }

    @Override
    public Class<?> getObjectType() {
        return Tool.class;
    }

    @Override
    public boolean isSingleton() {
        return true;
    }

    // setter and getter methods for factoryId and toolId
}
```

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„åä¸ºé¢ç»åŒå­¦ 8 æŠ€æœ¯äºŒé¢é¢è¯•åŸé¢˜ï¼šè¯´è¯´ Spring çš„ Bean å®ä¾‹åŒ–æ–¹å¼
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç¾å›¢åŒå­¦ 2 ä¼˜é€‰ç‰©æµè°ƒåº¦æŠ€æœ¯ 2 é¢é¢è¯•åŸé¢˜ï¼šbeanåŠ å·¥æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ

### 9.èƒ½è¯´ä¸€ä¸‹ Spring Bean ç”Ÿå‘½å‘¨æœŸå—ï¼Ÿ

æ¨èé˜…è¯»ï¼š[ä¸‰åˆ†æ¶ï¼šSpring Bean ç”Ÿå‘½å‘¨æœŸï¼Œå¥½åƒäººçš„ä¸€ç”Ÿ](https://mp.weixin.qq.com/s/zb6eA3Se0gQoqL8PylCPLw)

åœ¨ Spring ä¸­ï¼ŒåŸºæœ¬å®¹å™¨ BeanFactory å’Œæ‰©å±•å®¹å™¨ ApplicationContext çš„å®ä¾‹åŒ–æ—¶æœºä¸å¤ªä¸€æ ·ï¼ŒBeanFactory é‡‡ç”¨çš„æ˜¯å»¶è¿Ÿåˆå§‹åŒ–çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰åœ¨ç¬¬ä¸€æ¬¡ `getBean()` è·å– Bean çš„æ—¶å€™ï¼Œæ‰ä¼šå®ä¾‹åŒ– Beanã€‚

è€Œ ApplicationContext ä¼šåœ¨å¯åŠ¨æ—¶é¢„å…ˆåˆ›å»ºå¹¶åˆå§‹åŒ–æ‰€æœ‰çš„ Beanï¼Œå¹¶ä¸”åŒ…å«äº† BeanFactory çš„æ‰€æœ‰åŠŸèƒ½ï¼Œè¿˜å¢åŠ äº†å›½é™…åŒ–æ”¯æŒã€äº‹ä»¶ä¼ æ’­ç­‰åŠŸèƒ½ã€‚åœ¨ Spring Boot é¡¹ç›®ä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨çš„æ˜¯ ApplicationContextã€‚

![ä¸‰åˆ†æ¶ï¼šBeanFactory å’Œ ApplicationContext çš„ä¸åŒ](https://cdn.tobebetterjavaer.com/stutymore/spring-20240311095813.png)

Spring ä¸­ Bean çš„ç”Ÿå‘½å‘¨æœŸå¤§è‡´åˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼š**å®ä¾‹åŒ–**ï¼ˆInstantiationï¼‰ã€**å±æ€§èµ‹å€¼**ï¼ˆPopulateï¼‰ã€**åˆå§‹åŒ–**ï¼ˆInitializationï¼‰ã€**é”€æ¯**ï¼ˆDestructionï¼‰ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šBeanç”Ÿå‘½å‘¨æœŸå››ä¸ªé˜¶æ®µ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-595fce5b-36cb-4dcb-b08c-8205a1e98d8a.png)

å¯¹åº”çš„å®Œæ•´æ­¥éª¤å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring Beanç”Ÿå‘½å‘¨æœŸ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-942a927a-86e4-4a01-8f52-9addd89642ff.png)

- **å®ä¾‹åŒ–**ï¼šSpring å®¹å™¨æ ¹æ® Bean çš„å®šä¹‰åˆ›å»º Bean çš„å®ä¾‹ï¼Œç›¸å½“äºæ‰§è¡Œæ„é€ æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ new ä¸€ä¸ªå¯¹è±¡ã€‚
- **å±æ€§èµ‹å€¼**ï¼šç›¸å½“äºæ‰§è¡Œ setter æ–¹æ³•ä¸ºå­—æ®µèµ‹å€¼ã€‚
- **åˆå§‹åŒ–**ï¼šåˆå§‹åŒ–é˜¶æ®µå…è®¸æ‰§è¡Œè‡ªå®šä¹‰çš„é€»è¾‘ï¼Œæ¯”å¦‚è®¾ç½®æŸäº›å¿…è¦çš„å±æ€§å€¼ã€å¼€å¯èµ„æºã€æ‰§è¡Œé¢„åŠ è½½æ“ä½œç­‰ï¼Œä»¥ç¡®ä¿ Bean åœ¨ä½¿ç”¨ä¹‹å‰æ˜¯å®Œå…¨é…ç½®å¥½çš„ã€‚
- **é”€æ¯**ï¼šç›¸å½“äºæ‰§è¡Œ `= null`ï¼Œé‡Šæ”¾èµ„æºã€‚

å¯ä»¥åœ¨æºç  `AbstractAutowireCapableBeanFactory` ä¸­çš„ `doCreateBean` æ–¹æ³•ä¸­ï¼Œçœ‹åˆ° Bean çš„å‰ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸï¼š

```java
protected Object doCreateBean(String beanName, RootBeanDefinition mbd, @Nullable Object[] args) throws BeanCreationException {
    BeanWrapper instanceWrapper = null;
    if (mbd.isSingleton()) {
        instanceWrapper = (BeanWrapper)this.factoryBeanInstanceCache.remove(beanName);
    }

    if (instanceWrapper == null) {
        // å®ä¾‹åŒ–é˜¶æ®µ
        instanceWrapper = this.createBeanInstance(beanName, mbd, args);
    }

    ...

    Object exposedObject = bean;

    try {
        // å±æ€§èµ‹å€¼é˜¶æ®µ
        this.populateBean(beanName, mbd, instanceWrapper);
        // åˆå§‹åŒ–é˜¶æ®µ
        exposedObject = this.initializeBean(beanName, exposedObject, mbd);
    } catch (Throwable var18) {
        ...
    }

    ...
}
```

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šBeanç”Ÿå‘½å‘¨æœŸæºç è¿½è¸ª](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-d2da20a3-08d0-4648-b9a3-2fff8512b159.png)

æºç ä½ç½®ï¼Œè§ä¸‹å›¾ï¼š

![](https://cdn.tobebetterjavaer.com/stutymore/spring-20240311101430.png)

è‡³äºé”€æ¯ï¼Œæ˜¯åœ¨å®¹å™¨å…³é—­çš„æ—¶å€™è°ƒç”¨çš„ï¼Œè¯¦è§ `ConfigurableApplicationContext` çš„ `close` æ–¹æ³•ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/spring-20240311101658.png)

**è¯·åœ¨ä¸€ä¸ªå·²æœ‰çš„ Spring Boot é¡¹ç›®ä¸­é€šè¿‡å•å…ƒæµ‹è¯•çš„å½¢å¼æ¥å±•ç¤º Spring Bean çš„ç”Ÿå‘½å‘¨æœŸ**ã€‚

ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºä¸€ä¸ª LifecycleDemoBean ç±»ï¼š

```java
public class LifecycleDemoBean implements InitializingBean, DisposableBean {

    // ä½¿ç”¨@Valueæ³¨è§£æ³¨å…¥å±æ€§å€¼ï¼Œè¿™é‡Œæ¼”ç¤ºäº†å¦‚ä½•ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–å€¼
    // å¦‚æœé…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰å®šä¹‰lifecycle.demo.bean.nameï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼"default name"
    @Value("${lifecycle.demo.bean.name:default name}")
    private String name;

    // æ„é€ æ–¹æ³•ï¼šåœ¨Beanå®ä¾‹åŒ–æ—¶è°ƒç”¨
    public LifecycleDemoBean() {
        System.out.println("LifecycleDemoBean: å®ä¾‹åŒ–");
    }

    // å±æ€§èµ‹å€¼ï¼šSpringé€šè¿‡åå°„è°ƒç”¨setteræ–¹æ³•ä¸ºBeançš„å±æ€§æ³¨å…¥å€¼
    public void setName(String name) {
        System.out.println("LifecycleDemoBean: å±æ€§èµ‹å€¼");
        this.name = name;
    }

    // ä½¿ç”¨@PostConstructæ³¨è§£çš„æ–¹æ³•ï¼šåœ¨Beançš„å±æ€§èµ‹å€¼å®Œæˆåè°ƒç”¨ï¼Œç”¨äºæ‰§è¡Œåˆå§‹åŒ–é€»è¾‘
    @PostConstruct
    public void postConstruct() {
        System.out.println("LifecycleDemoBean: @PostConstructï¼ˆåˆå§‹åŒ–ï¼‰");
    }

    // å®ç°InitializingBeanæ¥å£ï¼šafterPropertiesSetæ–¹æ³•åœ¨@PostConstructæ³¨è§£çš„æ–¹æ³•ä¹‹åè°ƒç”¨
    // ç”¨äºæ‰§è¡Œæ›´å¤šçš„åˆå§‹åŒ–é€»è¾‘
    @Override
    public void afterPropertiesSet() throws Exception {
        System.out.println("LifecycleDemoBean: afterPropertiesSetï¼ˆInitializingBeanï¼‰");
    }

    // è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•ï¼šåœ¨XMLé…ç½®æˆ–Javaé…ç½®ä¸­æŒ‡å®šï¼Œæ‰§è¡Œç‰¹å®šçš„åˆå§‹åŒ–é€»è¾‘
    public void customInit() {
        System.out.println("LifecycleDemoBean: customInitï¼ˆè‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•ï¼‰");
    }

    // ä½¿ç”¨@PreDestroyæ³¨è§£çš„æ–¹æ³•ï¼šåœ¨å®¹å™¨é”€æ¯Beanä¹‹å‰è°ƒç”¨ï¼Œç”¨äºæ‰§è¡Œæ¸…ç†å·¥ä½œ
    @PreDestroy
    public void preDestroy() {
        System.out.println("LifecycleDemoBean: @PreDestroyï¼ˆé”€æ¯å‰ï¼‰");
    }

    // å®ç°DisposableBeanæ¥å£ï¼šdestroyæ–¹æ³•åœ¨@PreDestroyæ³¨è§£çš„æ–¹æ³•ä¹‹åè°ƒç”¨
    // ç”¨äºæ‰§è¡Œæ¸…ç†èµ„æºç­‰é”€æ¯é€»è¾‘
    @Override
    public void destroy() throws Exception {
        System.out.println("LifecycleDemoBean: destroyï¼ˆDisposableBeanï¼‰");
    }

    // è‡ªå®šä¹‰é”€æ¯æ–¹æ³•ï¼šåœ¨XMLé…ç½®æˆ–Javaé…ç½®ä¸­æŒ‡å®šï¼Œæ‰§è¡Œç‰¹å®šçš„æ¸…ç†é€»è¾‘
    public void customDestroy() {
        System.out.println("LifecycleDemoBean: customDestroyï¼ˆè‡ªå®šä¹‰é”€æ¯æ–¹æ³•ï¼‰");
    }
}
```

#### â‘ ã€å®ä¾‹åŒ–

å®ä¾‹åŒ–æ˜¯åˆ›å»º Bean å®ä¾‹çš„è¿‡ç¨‹ï¼Œå³åœ¨å†…å­˜ä¸­ä¸º Bean å¯¹è±¡åˆ†é…ç©ºé—´ã€‚è¿™ä¸€æ­¥æ˜¯é€šè¿‡è°ƒç”¨ Bean çš„æ„é€ æ–¹æ³•å®Œæˆçš„ã€‚

```java
public LifecycleDemoBean() {
    System.out.println("LifecycleDemoBean: å®ä¾‹åŒ–");
}
```

åœ¨è¿™é‡Œï¼Œå½“ Spring åˆ›å»º LifecycleDemoBean çš„å®ä¾‹æ—¶ï¼Œä¼šè°ƒç”¨å…¶æ— å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯å®ä¾‹åŒ–ã€‚

#### â‘¡ã€å±æ€§èµ‹å€¼

åœ¨å®ä¾‹åŒ–ä¹‹åï¼ŒSpring å°†æ ¹æ® Bean å®šä¹‰ä¸­çš„é…ç½®ä¿¡æ¯ï¼Œé€šè¿‡åå°„æœºåˆ¶ä¸º Bean çš„å±æ€§èµ‹å€¼ã€‚

```java
@Value("${lifecycle.demo.bean.name:default name}")
private String name;

public void setName(String name) {
    System.out.println("LifecycleDemoBean: å±æ€§èµ‹å€¼");
    this.name = name;
}
```

`@Value`æ³¨è§£å’Œ setter æ–¹æ³•ä½“ç°äº†å±æ€§èµ‹å€¼çš„è¿‡ç¨‹ã€‚`@Value`æ³¨è§£è®© Spring æ³¨å…¥é…ç½®å€¼ï¼ˆæˆ–é»˜è®¤å€¼ï¼‰ï¼Œsetter æ–¹æ³•åˆ™æ˜¯å±æ€§èµ‹å€¼çš„å…·ä½“æ“ä½œã€‚

#### â‘¢ã€åˆå§‹åŒ–

åˆå§‹åŒ–é˜¶æ®µå…è®¸æ‰§è¡Œè‡ªå®šä¹‰çš„åˆå§‹åŒ–é€»è¾‘ï¼Œæ¯”å¦‚æ£€æŸ¥å¿…è¦çš„å±æ€§æ˜¯å¦å·²ç»è®¾ç½®ã€å¼€å¯èµ„æºç­‰ã€‚Spring æä¾›äº†å¤šç§æ–¹å¼æ¥é…ç½®åˆå§‹åŒ–é€»è¾‘ã€‚

1ã€ä½¿ç”¨ `@PostConstruct` æ³¨è§£çš„æ–¹æ³•

```java
@PostConstruct
public void postConstruct() {
    System.out.println("LifecycleDemoBean: @PostConstructï¼ˆåˆå§‹åŒ–ï¼‰");
}
```

`@PostConstruct`æ³¨è§£çš„æ–¹æ³•åœ¨ Bean çš„æ‰€æœ‰å±æ€§éƒ½è¢«èµ‹å€¼åï¼Œä¸”ç”¨æˆ·è‡ªå®šä¹‰çš„åˆå§‹åŒ–æ–¹æ³•ä¹‹å‰è°ƒç”¨ã€‚

2ã€å®ç° `InitializingBean` æ¥å£çš„ `afterPropertiesSet` æ–¹æ³•

```java
@Override
public void afterPropertiesSet() throws Exception {
    System.out.println("LifecycleDemoBean: afterPropertiesSetï¼ˆInitializingBeanï¼‰");
}
```

afterPropertiesSet æ–¹æ³•æä¾›äº†å¦ä¸€ç§åˆå§‹åŒ– Bean çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯åœ¨æ‰€æœ‰å±æ€§èµ‹å€¼åè°ƒç”¨ã€‚

3ã€è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•

```java
public void customInit() {
    System.out.println("LifecycleDemoBean: customInitï¼ˆè‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•ï¼‰");
}
```

éœ€è¦åœ¨é…ç½®ç±»ä¸­æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ï¼š

```java
@Bean(initMethod = "customInit")
public LifecycleDemoBean lifecycleDemoBean() {
    return new LifecycleDemoBean();
}
```

#### â‘£ã€é”€æ¯

é”€æ¯é˜¶æ®µå…è®¸æ‰§è¡Œè‡ªå®šä¹‰çš„é”€æ¯é€»è¾‘ï¼Œæ¯”å¦‚é‡Šæ”¾èµ„æºã€‚ç±»ä¼¼äºåˆå§‹åŒ–é˜¶æ®µï¼ŒSpring ä¹Ÿæä¾›äº†å¤šç§æ–¹å¼æ¥é…ç½®é”€æ¯é€»è¾‘ã€‚

1ã€ä½¿ç”¨ `@PreDestroy` æ³¨è§£çš„æ–¹æ³•

```java
@PreDestroy
public void preDestroy() {
    System.out.println("LifecycleDemoBean: @PreDestroyï¼ˆé”€æ¯å‰ï¼‰");
}
```

`@PreDestroy`æ³¨è§£çš„æ–¹æ³•åœ¨ Bean è¢«é”€æ¯å‰è°ƒç”¨ã€‚

2ã€å®ç° `DisposableBean` æ¥å£çš„ `destroy` æ–¹æ³•

```java
@Override
public void destroy() throws Exception {
    System.out.println("LifecycleDemoBean: destroyï¼ˆDisposableBeanï¼‰");
}
```

destroy æ–¹æ³•æä¾›äº†å¦ä¸€ç§é”€æ¯ Bean çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯åœ¨ Bean è¢«é”€æ¯å‰è°ƒç”¨ã€‚

3ã€è‡ªå®šä¹‰é”€æ¯æ–¹æ³•

```java
public void customDestroy() {
    System.out.println("LifecycleDemoBean: customDestroyï¼ˆè‡ªå®šä¹‰é”€æ¯æ–¹æ³•ï¼‰");
}
```

éœ€è¦åœ¨é…ç½®ç±»ä¸­æŒ‡å®šé”€æ¯æ–¹æ³•ï¼š

```java
@Bean(destroyMethod = "customDestroy")
public LifecycleDemoBean lifecycleDemoBean() {
    return new LifecycleDemoBean();
}
```

ç¬¬äºŒæ­¥ï¼Œæ³¨å†Œ Bean å¹¶æŒ‡å®šè‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•å’Œé”€æ¯æ–¹æ³•ï¼š

```java
@Configuration
public class LifecycleDemoConfig {

    @Bean(initMethod = "customInit", destroyMethod = "customDestroy")
    public LifecycleDemoBean lifecycleDemoBean() {
        return new LifecycleDemoBean();
    }
}
```

ç¬¬ä¸‰æ­¥ï¼Œç¼–å†™å•å…ƒæµ‹è¯•ï¼š

```java
@SpringBootTest
public class LifecycleDemoTest {

    @Autowired
    private ApplicationContext context;

    @Test
    public void testBeanLifecycle() {
        System.out.println("è·å–LifecycleDemoBeanå®ä¾‹...");
        LifecycleDemoBean bean = context.getBean(LifecycleDemoBean.class);
    }
}
```

è¿è¡Œå•å…ƒæµ‹è¯•ï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼š

```java
LifecycleDemoBean: å®ä¾‹åŒ–
LifecycleDemoBean: @PostConstructï¼ˆåˆå§‹åŒ–ï¼‰
LifecycleDemoBean: afterPropertiesSetï¼ˆInitializingBeanï¼‰
LifecycleDemoBean: customInitï¼ˆè‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•ï¼‰
è·å–LifecycleDemoBeanå®ä¾‹...
LifecycleDemoBean: @PreDestroyï¼ˆé”€æ¯å‰ï¼‰
LifecycleDemoBean: destroyï¼ˆDisposableBeanï¼‰
LifecycleDemoBean: customDestroyï¼ˆè‡ªå®šä¹‰é”€æ¯æ–¹æ³•ï¼‰
```

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³ 25 å±Šæ—¥å¸¸å®ä¹ ä¸€é¢åŸé¢˜ï¼šè¯´è¯´ Bean çš„ç”Ÿå‘½å‘¨æœŸ
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç™¾åº¦é¢ç»åŒå­¦ 1 æ–‡å¿ƒä¸€è¨€ 25 å®ä¹  Java åç«¯é¢è¯•åŸé¢˜ï¼šSpringä¸­beanç”Ÿå‘½å‘¨æœŸ

### 10.Bean å®šä¹‰å’Œä¾èµ–å®šä¹‰æœ‰å“ªäº›æ–¹å¼ï¼Ÿ

æœ‰ä¸‰ç§æ–¹å¼ï¼š**ç›´æ¥ç¼–ç æ–¹å¼**ã€**é…ç½®æ–‡ä»¶æ–¹å¼**ã€**æ³¨è§£æ–¹å¼**ã€‚

![Beanä¾èµ–é…ç½®æ–¹å¼](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-89f0f50d-a9e4-4dec-b267-cb1a526cb340.png)

- ç›´æ¥ç¼–ç æ–¹å¼ï¼šæˆ‘ä»¬ä¸€èˆ¬æ¥è§¦ä¸åˆ°ç›´æ¥ç¼–ç çš„æ–¹å¼ï¼Œä½†å…¶å®å…¶å®ƒçš„æ–¹å¼æœ€ç»ˆéƒ½è¦é€šè¿‡ç›´æ¥ç¼–ç æ¥å®ç°ã€‚
- é…ç½®æ–‡ä»¶æ–¹å¼ï¼šé€šè¿‡ xmlã€propreties ç±»å‹çš„é…ç½®æ–‡ä»¶ï¼Œé…ç½®ç›¸åº”çš„ä¾èµ–å…³ç³»ï¼ŒSpring è¯»å–é…ç½®æ–‡ä»¶ï¼Œå®Œæˆä¾èµ–å…³ç³»çš„æ³¨å…¥ã€‚
- æ³¨è§£æ–¹å¼ï¼šæ³¨è§£æ–¹å¼åº”è¯¥æ˜¯æˆ‘ä»¬ç”¨çš„æœ€å¤šçš„ä¸€ç§æ–¹å¼äº†ï¼Œåœ¨ç›¸åº”çš„åœ°æ–¹ä½¿ç”¨æ³¨è§£ä¿®é¥°ï¼ŒSpring ä¼šæ‰«ææ³¨è§£ï¼Œå®Œæˆä¾èµ–å…³ç³»çš„æ³¨å…¥ã€‚

### 11.æœ‰å“ªäº›ä¾èµ–æ³¨å…¥çš„æ–¹æ³•ï¼Ÿ

Spring æ”¯æŒ**æ„é€ æ–¹æ³•æ³¨å…¥**ã€**å±æ€§æ³¨å…¥**ã€**å·¥å‚æ–¹æ³•æ³¨å…¥**,å…¶ä¸­å·¥å‚æ–¹æ³•æ³¨å…¥ï¼Œåˆå¯ä»¥åˆ†ä¸º**é™æ€å·¥å‚æ–¹æ³•æ³¨å…¥**å’Œ**éé™æ€å·¥å‚æ–¹æ³•æ³¨å…¥**ã€‚

![Springä¾èµ–æ³¨å…¥æ–¹æ³•](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-491f8444-54ba-4628-b8eb-8418a2197096.png)

- **æ„é€ æ–¹æ³•æ³¨å…¥**

  é€šè¿‡è°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•ï¼Œå°†æ¥å£å®ç°ç±»é€šè¿‡æ„é€ æ–¹æ³•å˜é‡ä¼ å…¥

  ```java
   public CatDaoImpl(String message){
     this. message = message;
   }
  ```

  ```java
  <bean id="CatDaoImpl" class="com.CatDaoImpl">
    <constructor-arg value=" message "></constructor-arg>
  </bean>
  ```

- **å±æ€§æ³¨å…¥**

  é€šè¿‡ Setter æ–¹æ³•å®Œæˆè°ƒç”¨ç±»æ‰€éœ€ä¾èµ–çš„æ³¨å…¥

  ```java
   public class Id {
      private int id;

      public int getId() { return id; }

      public void setId(int id) { this.id = id; }
  }
  ```

  ```java
  <bean id="id" class="com.id ">
    <property name="id" value="123"></property>
  </bean>
  ```

- **å·¥å‚æ–¹æ³•æ³¨å…¥**

  - **é™æ€å·¥å‚æ³¨å…¥**

    é™æ€å·¥å‚é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯é€šè¿‡è°ƒç”¨é™æ€å·¥å‚çš„æ–¹æ³•æ¥è·å–è‡ªå·±éœ€è¦çš„å¯¹è±¡ï¼Œä¸ºäº†è®© Spring ç®¡ç†æ‰€æœ‰å¯¹è±¡ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥é€šè¿‡"å·¥ç¨‹ç±».é™æ€æ–¹æ³•()"æ¥è·å–å¯¹è±¡ï¼Œè€Œæ˜¯ä¾ç„¶é€šè¿‡ Spring æ³¨å…¥çš„å½¢å¼è·å–ï¼š

    ```java
    public class DaoFactory { //é™æ€å·¥å‚

       public static final FactoryDao getStaticFactoryDaoImpl(){
          return new StaticFacotryDaoImpl();
       }
    }

    public class SpringAction {

     //æ³¨å…¥å¯¹è±¡
     private FactoryDao staticFactoryDao;

     //æ³¨å…¥å¯¹è±¡çš„ set æ–¹æ³•
     public void setStaticFactoryDao(FactoryDao staticFactoryDao) {
         this.staticFactoryDao = staticFactoryDao;
     }

    }
    ```

    ```java
    //factory-method="getStaticFactoryDaoImpl"æŒ‡å®šè°ƒç”¨å“ªä¸ªå·¥å‚æ–¹æ³•
     <bean name="springAction" class=" SpringAction" >
       <!--ä½¿ç”¨é™æ€å·¥å‚çš„æ–¹æ³•æ³¨å…¥å¯¹è±¡,å¯¹åº”ä¸‹é¢çš„é…ç½®æ–‡ä»¶-->
       <property name="staticFactoryDao" ref="staticFactoryDao"></property>
     </bean>

     <!--æ­¤å¤„è·å–å¯¹è±¡çš„æ–¹å¼æ˜¯ä»å·¥å‚ç±»ä¸­è·å–é™æ€æ–¹æ³•-->
    <bean name="staticFactoryDao" class="DaoFactory"
      factory-method="getStaticFactoryDaoImpl"></bean>
    ```

  - **éé™æ€å·¥å‚æ³¨å…¥**

    éé™æ€å·¥å‚ï¼Œä¹Ÿå«å®ä¾‹å·¥å‚ï¼Œæ„æ€æ˜¯å·¥å‚æ–¹æ³•ä¸æ˜¯é™æ€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é¦–å…ˆ new ä¸€ä¸ªå·¥å‚å®ä¾‹ï¼Œå†è°ƒç”¨æ™®é€šçš„å®ä¾‹æ–¹æ³•ã€‚

    ```java
    //éé™æ€å·¥å‚
    public class DaoFactory {
       public FactoryDao getFactoryDaoImpl(){
         return new FactoryDaoImpl();
       }
     }

    public class SpringAction {
      //æ³¨å…¥å¯¹è±¡
      private FactoryDao factoryDao;

      public void setFactoryDao(FactoryDao factoryDao) {
        this.factoryDao = factoryDao;
      }
    }
    ```

    ```java
     <bean name="springAction" class="SpringAction">
       <!--ä½¿ç”¨éé™æ€å·¥å‚çš„æ–¹æ³•æ³¨å…¥å¯¹è±¡,å¯¹åº”ä¸‹é¢çš„é…ç½®æ–‡ä»¶-->
       <property name="factoryDao" ref="factoryDao"></property>
     </bean>

     <!--æ­¤å¤„è·å–å¯¹è±¡çš„æ–¹å¼æ˜¯ä»å·¥å‚ç±»ä¸­è·å–å®ä¾‹æ–¹æ³•-->
     <bean name="daoFactory" class="com.DaoFactory"></bean>

    <bean name="factoryDao" factory-bean="daoFactory" factory-method="getFactoryDaoImpl"></bean>
    ```

### 12.Spring æœ‰å“ªäº›è‡ªåŠ¨è£…é…çš„æ–¹å¼ï¼Ÿ

> **ä»€ä¹ˆæ˜¯è‡ªåŠ¨è£…é…ï¼Ÿ**

Spring IoC å®¹å™¨çŸ¥é“æ‰€æœ‰ Bean çš„é…ç½®ä¿¡æ¯ï¼Œæ­¤å¤–ï¼Œé€šè¿‡ Java åå°„æœºåˆ¶è¿˜å¯ä»¥è·çŸ¥å®ç°ç±»çš„ç»“æ„ä¿¡æ¯ï¼Œå¦‚æ„é€ æ–¹æ³•çš„ç»“æ„ã€å±æ€§ç­‰ä¿¡æ¯ã€‚æŒæ¡æ‰€æœ‰ Bean çš„è¿™äº›ä¿¡æ¯åï¼ŒSpring IoC å®¹å™¨å°±å¯ä»¥æŒ‰ç…§æŸç§è§„åˆ™å¯¹å®¹å™¨ä¸­çš„ Bean è¿›è¡Œè‡ªåŠ¨è£…é…ï¼Œè€Œæ— é¡»é€šè¿‡æ˜¾å¼çš„æ–¹å¼è¿›è¡Œä¾èµ–é…ç½®ã€‚

Spring æä¾›çš„è¿™ç§æ–¹å¼ï¼Œå¯ä»¥æŒ‰ç…§æŸäº›è§„åˆ™è¿›è¡Œ Bean çš„è‡ªåŠ¨è£…é…ï¼Œ`<bean>`å…ƒç´ æä¾›äº†ä¸€ä¸ªæŒ‡å®šè‡ªåŠ¨è£…é…ç±»å‹çš„å±æ€§ï¼š`autowire="<è‡ªåŠ¨è£…é…ç±»å‹>"`

> **Spring æä¾›äº†å“ªå‡ ç§è‡ªåŠ¨è£…é…ç±»å‹ï¼Ÿ**

Spring æä¾›äº† 4 ç§è‡ªåŠ¨è£…é…ç±»å‹ï¼š

![Springå››ç§è‡ªåŠ¨è£…é…ç±»å‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-034120d9-88c7-490b-af07-7d48f3b6b7bc.png)

- **byName**ï¼šæ ¹æ®åç§°è¿›è¡Œè‡ªåŠ¨åŒ¹é…ï¼Œå‡è®¾ Boss åˆä¸€ä¸ªåä¸º car çš„å±æ€§ï¼Œå¦‚æœå®¹å™¨ä¸­åˆšå¥½æœ‰ä¸€ä¸ªåä¸º car çš„ beanï¼ŒSpring å°±ä¼šè‡ªåŠ¨å°†å…¶è£…é…ç»™ Boss çš„ car å±æ€§
- **byType**ï¼šæ ¹æ®ç±»å‹è¿›è¡Œè‡ªåŠ¨åŒ¹é…ï¼Œå‡è®¾ Boss æœ‰ä¸€ä¸ª Car ç±»å‹çš„å±æ€§ï¼Œå¦‚æœå®¹å™¨ä¸­åˆšå¥½æœ‰ä¸€ä¸ª Car ç±»å‹çš„ Beanï¼ŒSpring å°±ä¼šè‡ªåŠ¨å°†å…¶è£…é…ç»™ Boss è¿™ä¸ªå±æ€§
- **constructor**ï¼šä¸ byType ç±»ä¼¼ï¼Œ åªä¸è¿‡å®ƒæ˜¯é’ˆå¯¹æ„é€ å‡½æ•°æ³¨å…¥è€Œè¨€çš„ã€‚å¦‚æœ Boss æœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæ„é€ å‡½æ•°åŒ…å«ä¸€ä¸ª Car ç±»å‹çš„å…¥å‚ï¼Œå¦‚æœå®¹å™¨ä¸­æœ‰ä¸€ä¸ª Car ç±»å‹çš„ Beanï¼Œåˆ™ Spring å°†è‡ªåŠ¨æŠŠè¿™ä¸ª Bean ä½œä¸º Boss æ„é€ å‡½æ•°çš„å…¥å‚ï¼›å¦‚æœå®¹å™¨ä¸­æ²¡æœ‰æ‰¾åˆ°å’Œæ„é€ å‡½æ•°å…¥å‚åŒ¹é…ç±»å‹çš„ Beanï¼Œåˆ™ Spring å°†æŠ›å‡ºå¼‚å¸¸ã€‚
- **autodetect**ï¼šæ ¹æ® Bean çš„è‡ªçœæœºåˆ¶å†³å®šé‡‡ç”¨ byType è¿˜æ˜¯ constructor è¿›è¡Œè‡ªåŠ¨è£…é…ï¼Œå¦‚æœ Bean æä¾›äº†é»˜è®¤çš„æ„é€ å‡½æ•°ï¼Œåˆ™é‡‡ç”¨ byTypeï¼Œå¦åˆ™é‡‡ç”¨ constructorã€‚

### 13.Spring ä¸­çš„ Bean çš„ä½œç”¨åŸŸæœ‰å“ªäº›?

Spring çš„ Bean ä¸»è¦æ”¯æŒäº”ç§ä½œç”¨åŸŸï¼š

![Spring Beanæ”¯æŒä½œç”¨åŸŸ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-08a9cb31-5a4f-4224-94cd-0c0f643a57ea.png)

- **singleton** : åœ¨ Spring å®¹å™¨ä»…å­˜åœ¨ä¸€ä¸ª Bean å®ä¾‹ï¼ŒBean ä»¥å•å®ä¾‹çš„æ–¹å¼å­˜åœ¨ï¼Œæ˜¯ Bean é»˜è®¤çš„ä½œç”¨åŸŸã€‚
- **prototype** : æ¯æ¬¡ä»å®¹å™¨é‡è°ƒç”¨ Bean æ—¶ï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚

ä»¥ä¸‹ä¸‰ä¸ªä½œç”¨åŸŸäºåªåœ¨ Web åº”ç”¨ä¸­é€‚ç”¨ï¼š

- **request** : æ¯ä¸€æ¬¡ HTTP è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ Beanï¼Œè¯¥ Bean ä»…åœ¨å½“å‰ HTTP Request å†…æœ‰æ•ˆã€‚
- **session** : åŒä¸€ä¸ª HTTP Session å…±äº«ä¸€ä¸ª Beanï¼Œä¸åŒçš„ HTTP Session ä½¿ç”¨ä¸åŒçš„ Beanã€‚
- **globalSession**ï¼šåŒä¸€ä¸ªå…¨å±€ Session å…±äº«ä¸€ä¸ª Beanï¼Œåªç”¨äºåŸºäº Protlet çš„ Web åº”ç”¨ï¼ŒSpring5 ä¸­å·²ç»ä¸å­˜åœ¨äº†ã€‚

### 14.Spring ä¸­çš„å•ä¾‹ Bean ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜å—ï¼Ÿ

Spring Bean çš„é»˜è®¤ä½œç”¨åŸŸæ˜¯å•ä¾‹ï¼ˆSingletonï¼‰ï¼Œè¿™æ„å‘³ç€ Spring å®¹å™¨ä¸­åªä¼šå­˜åœ¨ä¸€ä¸ª Bean å®ä¾‹ï¼Œå¹¶ä¸”è¯¥å®ä¾‹ä¼šè¢«å¤šä¸ªçº¿ç¨‹å…±äº«ã€‚

å¦‚æœå•ä¾‹ Bean æ˜¯æ— çŠ¶æ€çš„ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå•ä¾‹ Bean æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æ¯”å¦‚ Spring MVC ä¸­çš„ Controllerã€Serviceã€Dao ç­‰ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯æ— çŠ¶æ€çš„ã€‚

ä½†å¦‚æœ Bean çš„å†…éƒ¨çŠ¶æ€æ˜¯å¯å˜çš„ï¼Œä¸”æ²¡æœ‰è¿›è¡Œé€‚å½“çš„åŒæ­¥å¤„ç†ï¼Œå°±å¯èƒ½å‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringå•ä¾‹Beançº¿ç¨‹å®‰å…¨é—®é¢˜](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-35dacef4-1a9e-45e1-b3f2-5a91227eb244.png)

#### å•ä¾‹ Bean çº¿ç¨‹å®‰å…¨é—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ

ç¬¬ä¸€ï¼Œä½¿ç”¨å±€éƒ¨å˜é‡ã€‚å±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å±€éƒ¨å˜é‡å‰¯æœ¬ã€‚å°½é‡ä½¿ç”¨å±€éƒ¨å˜é‡è€Œä¸æ˜¯å…±äº«çš„æˆå‘˜å˜é‡ã€‚

```java
public class MyService {
    public void process() {
        int localVar = 0;
        // ä½¿ç”¨å±€éƒ¨å˜é‡è¿›è¡Œæ“ä½œ
    }
}
```

ç¬¬äºŒï¼Œå°½é‡ä½¿ç”¨æ— çŠ¶æ€çš„ Beanï¼Œå³ä¸åœ¨ Bean ä¸­ä¿å­˜ä»»ä½•å¯å˜çš„çŠ¶æ€ä¿¡æ¯ã€‚

```java
public class MyStatelessService {
    public void process() {
        // æ— çŠ¶æ€å¤„ç†
    }
}
```

ç¬¬ä¸‰ï¼ŒåŒæ­¥è®¿é—®ã€‚å¦‚æœ Bean ä¸­ç¡®å®éœ€è¦ä¿å­˜å¯å˜çŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡ [synchronized å…³é”®å­—](https://javabetter.cn/thread/synchronized-1.html)æˆ–è€… [Lock æ¥å£](https://javabetter.cn/thread/reentrantLock.html)æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚

```java
public class MyService {
    private int sharedVar;

    public synchronized void increment() {
        sharedVar++;
    }
}
```

æˆ–è€…å°† Bean ä¸­çš„æˆå‘˜å˜é‡ä¿å­˜åˆ° ThreadLocal ä¸­ï¼Œ[ThreadLocal](https://javabetter.cn/thread/ThreadLocal.html) å¯ä»¥ä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å˜é‡çš„éš”ç¦»ã€‚

```java
public class MyService {
    private ThreadLocal<Integer> localVar = ThreadLocal.withInitial(() -> 0);

    public void process() {
        localVar.set(localVar.get() + 1);
    }
}
```

å†æˆ–è€…ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„å·¥å…·ç±»ï¼Œæ¯”å¦‚è¯´ [AtomicInteger](https://javabetter.cn/thread/atomic.html)ã€[ConcurrentHashMap](https://javabetter.cn/thread/ConcurrentHashMap.html)ã€[CopyOnWriteArrayList](https://javabetter.cn/thread/CopyOnWriteArrayList.html) ç­‰ã€‚

```java
public class MyService {
    private ConcurrentHashMap<String, String> map = new ConcurrentHashMap<>();

    public void putValue(String key, String value) {
        map.put(key, value);
    }
}
```

ç¬¬å››ï¼Œå°† Bean å®šä¹‰ä¸ºåŸå‹ä½œç”¨åŸŸï¼ˆPrototypeï¼‰ã€‚åŸå‹ä½œç”¨åŸŸçš„ Bean æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œå› æ­¤ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

```java
@Component
@Scope("prototype")
public class MyService {
    // å®ä¾‹å˜é‡
}
```


> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„é˜¿é‡Œé¢ç»åŒå­¦ 1 é—²é±¼åç«¯ä¸€é¢çš„åŸé¢˜ï¼šspringçš„beançš„å¹¶å‘å®‰å…¨é—®é¢˜


### 15.è¯´è¯´å¾ªç¯ä¾èµ–?

A ä¾èµ– Bï¼ŒB ä¾èµ– Aï¼Œæˆ–è€… C ä¾èµ– Cï¼Œå°±æˆäº†å¾ªç¯ä¾èµ–ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringå¾ªç¯ä¾èµ–](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-f8fea53f-56fa-4cca-9199-ec7f648da625.png)

å½“ç„¶äº†ï¼Œå¾ªç¯ä¾èµ–åªå‘ç”Ÿåœ¨ Singleton ä½œç”¨åŸŸçš„ Bean ä¹‹é—´ï¼Œå› ä¸ºå¦‚æœæ˜¯ Prototype ä½œç”¨åŸŸçš„ Beanï¼ŒSpring ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚

åŸå› å¾ˆç®€å•ï¼ŒAB å¾ªç¯ä¾èµ–ï¼ŒA å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå‘ç°ä¾èµ– Bï¼Œåˆ›å»º B å®ä¾‹ï¼Œåˆ›å»º B çš„æ—¶å€™å‘ç°éœ€è¦ Aï¼Œåˆ›å»º A1 å®ä¾‹â€¦â€¦æ— é™å¥—å¨ƒã€‚ã€‚ã€‚ã€‚

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå®ä¾‹ï¼Œå…ˆæ˜¯ PrototypeBeanAï¼š

```java
@Component
@Scope("prototype")
public class PrototypeBeanA {
    private final PrototypeBeanB prototypeBeanB;

    @Autowired
    public PrototypeBeanA(PrototypeBeanB prototypeBeanB) {
        this.prototypeBeanB = prototypeBeanB;
    }
}
```

ç„¶åæ˜¯ PrototypeBeanBï¼š

```java
@Component
@Scope("prototype")
public class PrototypeBeanB {
    private final PrototypeBeanA prototypeBeanA;

    @Autowired
    public PrototypeBeanB(PrototypeBeanA prototypeBeanA) {
        this.prototypeBeanA = prototypeBeanA;
    }
}
```

å†ç„¶åæ˜¯æµ‹è¯•ï¼š

```java
@SpringBootApplication
public class DemoApplication {

    public static void main(String[] args) {
        SpringApplication.run(DemoApplication.class, args);
    }

    @Bean
    CommandLineRunner commandLineRunner(ApplicationContext ctx) {
        return args -> {
            // å°è¯•è·å–PrototypeBeanAçš„å®ä¾‹
            PrototypeBeanA beanA = ctx.getBean(PrototypeBeanA.class);
        };
    }
}
```

è¿è¡Œç»“æœï¼š

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šå¾ªç¯ä¾èµ–](https://cdn.tobebetterjavaer.com/stutymore/spring-20240310202703.png)

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå½“ Spring åº”ç”¨å¯åŠ¨å¹¶å°è¯•è·å– PrototypeBeanA æˆ– PrototypeBeanB çš„å®ä¾‹æ—¶ï¼Œå°†ä¼šé‡åˆ°é—®é¢˜ã€‚å› ä¸ºå®ƒä»¬äº’ç›¸ä¾èµ–ï¼Œè€Œ Spring æ— æ³•è§£å†³ Prototype ä½œç”¨åŸŸ bean çš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚

#### Spring å¯ä»¥è§£å†³å“ªäº›æƒ…å†µçš„å¾ªç¯ä¾èµ–ï¼Ÿ

çœ‹çœ‹è¿™å‡ ç§æƒ…å½¢ï¼ˆAB å¾ªç¯ä¾èµ–ï¼‰ï¼š

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå¾ªç¯ä¾èµ–çš„å‡ ç§æƒ…å½¢](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-37bb576d-b4af-42ed-91f4-d846ceb012b6.png)

ä¹Ÿå°±æ˜¯è¯´ï¼š

- AB å‡é‡‡ç”¨æ„é€ å™¨æ³¨å…¥ï¼Œä¸æ”¯æŒ
- AB å‡é‡‡ç”¨ setter æ³¨å…¥ï¼Œæ”¯æŒ
- AB å‡é‡‡ç”¨å±æ€§è‡ªåŠ¨æ³¨å…¥ï¼Œæ”¯æŒ
- A ä¸­æ³¨å…¥çš„ B ä¸º setter æ³¨å…¥ï¼ŒB ä¸­æ³¨å…¥çš„ A ä¸ºæ„é€ å™¨æ³¨å…¥ï¼Œæ”¯æŒ
- B ä¸­æ³¨å…¥çš„ A ä¸º setter æ³¨å…¥ï¼ŒA ä¸­æ³¨å…¥çš„ B ä¸ºæ„é€ å™¨æ³¨å…¥ï¼Œä¸æ”¯æŒ

ç¬¬å››ç§å¯ä»¥ï¼Œç¬¬äº”ç§ä¸å¯ä»¥çš„åŸå› æ˜¯ Spring åœ¨åˆ›å»º Bean æ—¶é»˜è®¤ä¼šæ ¹æ®è‡ªç„¶æ’åºè¿›è¡Œåˆ›å»ºï¼Œæ‰€ä»¥ A ä¼šå…ˆäº B è¿›è¡Œåˆ›å»ºã€‚

ç®€å•æ€»ç»“ä¸‹ï¼Œå½“å¾ªç¯ä¾èµ–çš„å®ä¾‹éƒ½é‡‡ç”¨ setter æ–¹æ³•æ³¨å…¥æ—¶ï¼ŒSpring æ”¯æŒï¼Œéƒ½é‡‡ç”¨æ„é€ å™¨æ³¨å…¥çš„æ—¶å€™ï¼Œä¸æ”¯æŒï¼›æ„é€ å™¨æ³¨å…¥å’Œ setter æ³¨å…¥åŒæ—¶å­˜åœ¨çš„æ—¶å€™ï¼Œçœ‹å¤©ï¼ˆğŸ˜‚ï¼‰ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³ 25 å±Šæ—¥å¸¸å®ä¹ ä¸€é¢åŸé¢˜ï¼šå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–ï¼Ÿ

### 16.é‚£ Spring æ€ä¹ˆè§£å†³å¾ªç¯ä¾èµ–çš„å‘¢ï¼Ÿ

> å¼€å‘äººå‘˜åšå¥½è®¾è®¡ï¼Œåˆ«è®© Bean å¾ªç¯ä¾èµ–ï¼Œä½†é¢è¯•å®˜æ—¢ç„¶è¿™ä¹ˆå‚»é€¼åœ°é—®äº†è¿™ä¸ªé—®é¢˜ï¼Œè‚¯å®šä¸æƒ³å¬è¿™ä¸ªæœ€æ­£ç¡®çš„ç­”æ¡ˆï¼ˆğŸ˜‚ï¼‰ã€‚åªèƒ½ç¡¬ç€å¤´çš®ä½œç­”äº†ã€‚

æˆ‘ä»¬çŸ¥é“ï¼ŒSingleton çš„ Bean è¦åˆå§‹åŒ–å®Œæˆï¼Œéœ€è¦ç»å†è¿™ä¸‰æ­¥ï¼š

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šBeanåˆå§‹åŒ–æ­¥éª¤](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-867066f1-49d1-4e57-94f9-4c66a3a8797e.png)

æ³¨å…¥å‘ç”Ÿåœ¨ç¬¬äºŒæ­¥ï¼Œ**å±æ€§èµ‹å€¼**ï¼ŒSpring å¯ä»¥åœ¨è¿™ä¸€æ­¥é€šè¿‡**ä¸‰çº§ç¼“å­˜**æ¥è§£å†³äº†å¾ªç¯ä¾èµ–ï¼š

1. ä¸€çº§ç¼“å­˜ : `Map<String,Object>` **singletonObjects**ï¼Œå•ä¾‹æ± ï¼Œç”¨äºä¿å­˜å®ä¾‹åŒ–ã€å±æ€§èµ‹å€¼ï¼ˆæ³¨å…¥ï¼‰ã€åˆå§‹åŒ–å®Œæˆçš„ bean å®ä¾‹
2. äºŒçº§ç¼“å­˜ : `Map<String,Object>` **earlySingletonObjects**ï¼Œæ—©æœŸæ›å…‰å¯¹è±¡ï¼Œç”¨äºä¿å­˜å®ä¾‹åŒ–å®Œæˆçš„ bean å®ä¾‹
3. ä¸‰çº§ç¼“å­˜ : `Map<String,ObjectFactory<?>>` **singletonFactories**ï¼Œæ—©æœŸæ›å…‰å¯¹è±¡å·¥å‚ï¼Œç”¨äºä¿å­˜ bean åˆ›å»ºå·¥å‚ï¼Œä»¥ä¾¿åé¢æœ‰æœºä¼šåˆ›å»ºä»£ç†å¯¹è±¡ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šä¸‰çº§ç¼“å­˜](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-01d92863-a2cb-4f61-8d8d-30ecf0279b28.png)

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–çš„è¿‡ç¨‹ï¼š

å½“ Aã€B ä¸¤ä¸ªç±»å‘ç”Ÿå¾ªç¯ä¾èµ–æ—¶ï¼š

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå¾ªç¯ä¾èµ–](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-cfc09f84-f8e1-4702-80b6-d115843e81fe.png)

A å®ä¾‹çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼š

â‘ ã€åˆ›å»º A å®ä¾‹ï¼Œå®ä¾‹åŒ–çš„æ—¶å€™æŠŠ A çš„å¯¹è±¡â¼¯â¼šæ”¾â¼Šä¸‰çº§ç¼“å­˜ï¼Œè¡¨ç¤º A å¼€å§‹å®ä¾‹åŒ–äº†ï¼Œè™½ç„¶æˆ‘è¿™ä¸ªå¯¹è±¡è¿˜ä¸å®Œæ•´ï¼Œä½†æ˜¯å…ˆæ›å…‰å‡ºæ¥è®©å¤§å®¶çŸ¥é“ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šA å¯¹è±¡å·¥å‚](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-1a8bdc29-ff43-4ff4-9b61-3eedd9da59b3.png)

â‘¡ã€A æ³¨â¼Šå±æ€§æ—¶ï¼Œå‘ç°ä¾èµ– Bï¼Œæ­¤æ—¶ B è¿˜æ²¡æœ‰è¢«åˆ›å»ºå‡ºæ¥ï¼Œæ‰€ä»¥å»å®ä¾‹åŒ– B

â‘¢ã€åŒæ ·ï¼ŒB æ³¨â¼Šå±æ€§æ—¶å‘ç°ä¾èµ– Aï¼Œå®ƒå°±ä»ç¼“å­˜é‡Œæ‰¾ A å¯¹è±¡ã€‚ä¾æ¬¡ä»â¼€çº§åˆ°ä¸‰çº§ç¼“å­˜æŸ¥è¯¢ Aã€‚

å‘ç°å¯ä»¥ä»ä¸‰çº§ç¼“å­˜ä¸­é€šè¿‡å¯¹è±¡â¼¯â¼šæ‹¿åˆ° Aï¼Œè™½ç„¶ A ä¸å¤ªå®Œå–„ï¼Œä½†æ˜¯å­˜åœ¨ï¼Œå°±æŠŠ A æ”¾â¼Šâ¼†çº§ç¼“å­˜ï¼ŒåŒæ—¶åˆ é™¤ä¸‰çº§ç¼“å­˜ä¸­çš„ Aï¼Œæ­¤æ—¶ï¼ŒB å·²ç»å®ä¾‹åŒ–å¹¶ä¸”åˆå§‹åŒ–å®Œæˆäº†ï¼ŒæŠŠ B æ”¾å…¥â¼€çº§ç¼“å­˜ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ”¾å…¥ä¸€çº§ç¼“å­˜](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-bf2507bf-96aa-4b88-a58b-7ec41d11bc70.png)

â‘£ã€æ¥ç€ A ç»§ç»­å±æ€§èµ‹å€¼ï¼Œé¡ºåˆ©ä»â¼€çº§ç¼“å­˜æ‹¿åˆ°å®ä¾‹åŒ–ä¸”åˆå§‹åŒ–å®Œæˆçš„ B å¯¹è±¡ï¼ŒA å¯¹è±¡åˆ›å»ºä¹Ÿå®Œæˆï¼Œåˆ é™¤â¼†çº§ç¼“å­˜ä¸­çš„ Aï¼ŒåŒæ—¶æŠŠ A æ”¾â¼Šâ¼€çº§ç¼“å­˜

â‘¤ã€æœ€åï¼Œâ¼€çº§ç¼“å­˜ä¸­ä¿å­˜ç€å®ä¾‹åŒ–ã€åˆå§‹åŒ–éƒ½å®Œæˆçš„ Aã€B å¯¹è±¡

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šAB éƒ½å¥½äº†](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-022f7cb9-2c83-4fe9-b252-b02bd0fb2435.png)

åˆ°æ­¤ï¼Œæˆ‘ä»¬å°±çŸ¥é“ä¸ºä»€ä¹ˆ Spring èƒ½è§£å†³ setter æ³¨å…¥çš„å¾ªç¯ä¾èµ–äº†ï¼Œå› ä¸ºå®ä¾‹åŒ–å’Œå±æ€§èµ‹å€¼æ˜¯åˆ†å¼€çš„ï¼Œé‡Œé¢æœ‰æ“ä½œçš„ç©ºé—´ã€‚

å¦‚æœéƒ½æ˜¯æ„é€ å™¨æ³¨å…¥çš„è¯ï¼Œé‚£ä¹ˆéƒ½å¾—åœ¨å®ä¾‹åŒ–è¿™ä¸€æ­¥å®Œæˆæ³¨å…¥ï¼Œæ²¡æœ‰å¯æ“ä½œçš„ç©ºé—´ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³ 25 å±Šæ—¥å¸¸å®ä¹ ä¸€é¢åŸé¢˜ï¼šå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–ï¼Ÿ
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç™¾åº¦é¢ç»åŒå­¦ 1 æ–‡å¿ƒä¸€è¨€ 25 å®ä¹  Java åç«¯é¢è¯•åŸé¢˜ï¼šSpringå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–ï¼Ÿ

### 17.ä¸ºä»€ä¹ˆè¦ä¸‰çº§ç¼“å­˜ï¼Ÿâ¼†çº§ä¸â¾å—ï¼Ÿ

ä¸è¡Œï¼Œä¸»è¦æ˜¯ä¸ºäº†**â½£æˆä»£ç†å¯¹è±¡**ã€‚å¦‚æœæ˜¯æ²¡æœ‰ä»£ç†çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨äºŒçº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–ä¹Ÿæ˜¯ OK çš„ã€‚ä½†æ˜¯å¦‚æœå­˜åœ¨ä»£ç†ï¼Œä¸‰çº§æ²¡æœ‰é—®é¢˜ï¼ŒäºŒçº§å°±ä¸è¡Œäº†ã€‚

å› ä¸ºä¸‰çº§ç¼“å­˜ä¸­æ”¾çš„æ˜¯â½£æˆå…·ä½“å¯¹è±¡çš„åŒ¿åå†…éƒ¨ç±»ï¼Œè·å– Object çš„æ—¶å€™ï¼Œå®ƒå¯ä»¥â½£æˆä»£ç†å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥è¿”å›æ™®é€šå¯¹è±¡ã€‚ä½¿â½¤ä¸‰çº§ç¼“å­˜ä¸»è¦æ˜¯ä¸ºäº†ä¿è¯ä¸ç®¡ä»€ä¹ˆæ—¶å€™ä½¿â½¤çš„éƒ½æ˜¯â¼€ä¸ªå¯¹è±¡ã€‚

å‡è®¾åªæœ‰â¼†çº§ç¼“å­˜çš„æƒ…å†µï¼Œå¾€â¼†çº§ç¼“å­˜ä¸­æ”¾çš„æ˜¾ç¤ºâ¼€ä¸ªæ™®é€šçš„ Bean å¯¹è±¡ï¼ŒBean åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ BeanPostProcessor å»â½£æˆä»£ç†å¯¹è±¡ä¹‹åï¼Œè¦†ç›–æ‰â¼†çº§ç¼“å­˜ä¸­çš„æ™®é€š Bean å¯¹è±¡ï¼Œé‚£ä¹ˆå¯èƒ½å°±å¯¼è‡´å–åˆ°çš„ Bean å¯¹è±¡ä¸ä¸€è‡´äº†ã€‚

![äºŒçº§ç¼“å­˜ä¸è¡Œçš„åŸå› ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-6ece8a46-25b1-459b-8cfa-19fc696dd7d6.png)

### 18.@Autowired çš„å®ç°åŸç†ï¼Ÿ

å®ç°@Autowired çš„å…³é”®æ˜¯ï¼š**AutowiredAnnotationBeanPostProcessor**

åœ¨ Bean çš„åˆå§‹åŒ–é˜¶æ®µï¼Œä¼šé€šè¿‡ Bean åç½®å¤„ç†å™¨æ¥è¿›è¡Œä¸€äº›å‰ç½®å’Œåç½®çš„å¤„ç†ã€‚

å®ç°@Autowired çš„åŠŸèƒ½ï¼Œä¹Ÿæ˜¯é€šè¿‡åç½®å¤„ç†å™¨æ¥å®Œæˆçš„ã€‚è¿™ä¸ªåç½®å¤„ç†å™¨å°±æ˜¯ AutowiredAnnotationBeanPostProcessorã€‚

- Spring åœ¨åˆ›å»º bean çš„è¿‡ç¨‹ä¸­ï¼Œæœ€ç»ˆä¼šè°ƒç”¨åˆ° doCreateBean()æ–¹æ³•ï¼Œåœ¨ doCreateBean()æ–¹æ³•ä¸­ä¼šè°ƒç”¨ populateBean()æ–¹æ³•ï¼Œæ¥ä¸º bean è¿›è¡Œå±æ€§å¡«å……ï¼Œå®Œæˆè‡ªåŠ¨è£…é…ç­‰å·¥ä½œã€‚

- åœ¨ populateBean()æ–¹æ³•ä¸­ä¸€å…±è°ƒç”¨äº†ä¸¤æ¬¡åç½®å¤„ç†å™¨ï¼Œç¬¬ä¸€æ¬¡æ˜¯ä¸ºäº†åˆ¤æ–­æ˜¯å¦éœ€è¦å±æ€§å¡«å……ï¼Œå¦‚æœä¸éœ€è¦è¿›è¡Œå±æ€§å¡«å……ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥è¿›è¡Œ returnï¼Œå¦‚æœéœ€è¦è¿›è¡Œå±æ€§å¡«å……ï¼Œé‚£ä¹ˆæ–¹æ³•å°±ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œåé¢ä¼šè¿›è¡Œç¬¬äºŒæ¬¡åç½®å¤„ç†å™¨çš„è°ƒç”¨ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨åˆ° AutowiredAnnotationBeanPostProcessor çš„ postProcessPropertyValues()æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­å°±ä¼šè¿›è¡Œ@Autowired æ³¨è§£çš„è§£æï¼Œç„¶åå®ç°è‡ªåŠ¨è£…é…ã€‚

```java
/**
* å±æ€§èµ‹å€¼
**/
protected void populateBean(String beanName, RootBeanDefinition mbd, @Nullable BeanWrapper bw) {
          //â€¦â€¦â€¦â€¦
          if (hasInstAwareBpps) {
              if (pvs == null) {
                  pvs = mbd.getPropertyValues();
              }

              PropertyValues pvsToUse;
              for(Iterator var9 = this.getBeanPostProcessorCache().instantiationAware.iterator(); var9.hasNext(); pvs = pvsToUse) {
                  InstantiationAwareBeanPostProcessor bp = (InstantiationAwareBeanPostProcessor)var9.next();
                  pvsToUse = bp.postProcessProperties((PropertyValues)pvs, bw.getWrappedInstance(), beanName);
                  if (pvsToUse == null) {
                      if (filteredPds == null) {
                          filteredPds = this.filterPropertyDescriptorsForDependencyCheck(bw, mbd.allowCaching);
                      }
                      //æ‰§è¡Œåå¤„ç†å™¨ï¼Œå¡«å……å±æ€§ï¼Œå®Œæˆè‡ªåŠ¨è£…é…
                      //è°ƒç”¨InstantiationAwareBeanPostProcessorçš„postProcessPropertyValues()æ–¹æ³•
                      pvsToUse = bp.postProcessPropertyValues((PropertyValues)pvs, filteredPds, bw.getWrappedInstance(), beanName);
                      if (pvsToUse == null) {
                          return;
                      }
                  }
              }
          }
         //â€¦â€¦â€¦â€¦
  }
```

- postProcessorPropertyValues()æ–¹æ³•çš„æºç å¦‚ä¸‹ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ï¼Œä¼šå…ˆè°ƒç”¨ findAutowiringMetadata()æ–¹æ³•è§£æå‡º bean ä¸­å¸¦æœ‰@Autowired æ³¨è§£ã€@Inject å’Œ@Value æ³¨è§£çš„å±æ€§å’Œæ–¹æ³•ã€‚ç„¶åè°ƒç”¨ metadata.inject()æ–¹æ³•ï¼Œè¿›è¡Œå±æ€§å¡«å……ã€‚

```java
  public PropertyValues postProcessProperties(PropertyValues pvs, Object bean, String beanName) {
      //@Autowiredæ³¨è§£ã€@Injectå’Œ@Valueæ³¨è§£çš„å±æ€§å’Œæ–¹æ³•
      InjectionMetadata metadata = this.findAutowiringMetadata(beanName, bean.getClass(), pvs);

      try {
          //å±æ€§å¡«å……
          metadata.inject(bean, beanName, pvs);
          return pvs;
      } catch (BeanCreationException var6) {
          throw var6;
      } catch (Throwable var7) {
          throw new BeanCreationException(beanName, "Injection of autowired dependencies failed", var7);
      }
  }
```

GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹](https://javabetter.cn/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## AOP

### 19.è¯´è¯´ä»€ä¹ˆæ˜¯ AOPï¼Ÿ

AOPï¼Œä¹Ÿå°±æ˜¯ Aspect-oriented Programmingï¼Œè¯‘ä¸ºé¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚

ç®€å•ç‚¹è¯´ï¼Œå°±æ˜¯æŠŠä¸€äº›ä¸šåŠ¡é€»è¾‘ä¸­çš„ç›¸åŒä»£ç æŠ½å–åˆ°ä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ä¸­ï¼Œè®©ä¸šåŠ¡é€»è¾‘æ›´åŠ æ¸…çˆ½ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šæ¨ªå‘æŠ½å–](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-09dbcda4-7c1b-42d6-8520-1a5fc84abbde.png)

ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚æˆ‘ä»¬ç°åœ¨éœ€è¦åœ¨ä¸šåŠ¡ä»£ç å¼€å§‹å‰è¿›è¡Œå‚æ•°æ ¡éªŒï¼Œåœ¨ç»“æŸåæ‰“å°æ—¥å¿—ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

æˆ‘ä»¬å¯ä»¥æŠŠ`æ—¥å¿—è®°å½•`å’Œ`æ•°æ®æ ¡éªŒ`è¿™ä¸¤ä¸ªåŠŸèƒ½æŠ½å–å‡ºæ¥ï¼Œå½¢æˆä¸€ä¸ªåˆ‡é¢ï¼Œç„¶ååœ¨ä¸šåŠ¡ä»£ç ä¸­å¼•å…¥è¿™ä¸ªåˆ‡é¢ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°ä¸šåŠ¡é€»è¾‘å’Œé€šç”¨é€»è¾‘çš„åˆ†ç¦»ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šAOPåº”ç”¨ç¤ºä¾‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-4754b4c0-0356-4077-a2f9-55e246cf8ba0.png)

ä¸šåŠ¡ä»£ç ä¸å†å…³å¿ƒè¿™äº›é€šç”¨é€»è¾‘ï¼Œåªéœ€è¦å…³å¿ƒè‡ªå·±çš„ä¸šåŠ¡å®ç°ï¼Œè¿™æ ·å°±å®ç°äº†ä¸šåŠ¡é€»è¾‘å’Œé€šç”¨é€»è¾‘çš„åˆ†ç¦»ã€‚

æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ Java è¯­è¨€çš„æ‰§è¡Œè¿‡ç¨‹ï¼š

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šJava æ‰§è¡Œè¿‡ç¨‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-2b9859e5-019c-4e87-a449-990d3deae135.png)

AOP çš„æ ¸å¿ƒæ˜¯**åŠ¨æ€ä»£ç†**ï¼Œå¯ä»¥ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†æ¥å®ç°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ CGLIB æ¥å®ç°ã€‚

#### AOP æœ‰å“ªäº›æ ¸å¿ƒæ¦‚å¿µï¼Ÿ

- **åˆ‡é¢**ï¼ˆAspectï¼‰ï¼šç±»æ˜¯å¯¹ç‰©ä½“ç‰¹å¾çš„æŠ½è±¡ï¼Œåˆ‡é¢å°±æ˜¯å¯¹æ¨ªåˆ‡å…³æ³¨ç‚¹çš„æŠ½è±¡
- **è¿æ¥ç‚¹**ï¼ˆJoin Pointï¼‰ï¼šè¢«æ‹¦æˆªåˆ°çš„ç‚¹ï¼Œå› ä¸º Spring åªæ”¯æŒæ–¹æ³•ç±»å‹çš„è¿æ¥ç‚¹ï¼Œæ‰€ä»¥åœ¨ Spring ä¸­ï¼Œè¿æ¥ç‚¹æŒ‡çš„æ˜¯è¢«æ‹¦æˆªåˆ°çš„æ–¹æ³•ï¼Œå®é™…ä¸Šè¿æ¥ç‚¹è¿˜å¯ä»¥æ˜¯å­—æ®µæˆ–è€…æ„é€ æ–¹æ³•
- **åˆ‡ç‚¹**ï¼ˆPointcutï¼‰ï¼šå¯¹è¿æ¥ç‚¹è¿›è¡Œæ‹¦æˆªçš„å®šä½
- **é€šçŸ¥**ï¼ˆAdviceï¼‰ï¼šæŒ‡æ‹¦æˆªåˆ°è¿æ¥ç‚¹ä¹‹åè¦æ‰§è¡Œçš„ä»£ç ï¼Œä¹Ÿå¯ä»¥ç§°ä½œ**å¢å¼º**
- **ç›®æ ‡å¯¹è±¡** ï¼ˆTargetï¼‰ï¼šä»£ç†çš„ç›®æ ‡å¯¹è±¡
- **å¼•ä»‹**ï¼ˆintroductionï¼‰ï¼šä¸€ç§ç‰¹æ®Šçš„å¢å¼ºï¼Œå¯ä»¥åŠ¨æ€åœ°ä¸ºç±»æ·»åŠ ä¸€äº›å±æ€§å’Œæ–¹æ³•
- **ç»‡å…¥**ï¼ˆWeabingï¼‰ï¼šç»‡å…¥æ˜¯å°†å¢å¼ºæ·»åŠ åˆ°ç›®æ ‡ç±»çš„å…·ä½“è¿æ¥ç‚¹ä¸Šçš„è¿‡ç¨‹ã€‚å¯ä»¥åˆ†ä¸º 3 ç§ç±»å‹çš„ç»‡å…¥ï¼š

â‘ ã€ç¼–è¯‘æœŸç»‡å…¥ï¼šåˆ‡é¢åœ¨ç›®æ ‡ç±»ç¼–è¯‘æ—¶è¢«ç»‡å…¥ã€‚

â‘¡ã€ç±»åŠ è½½æœŸç»‡å…¥ï¼šåˆ‡é¢åœ¨ç›®æ ‡ç±»åŠ è½½åˆ° JVM æ—¶è¢«ç»‡å…¥ã€‚éœ€è¦ç‰¹æ®Šçš„ç±»åŠ è½½å™¨ï¼Œå®ƒå¯ä»¥åœ¨ç›®æ ‡ç±»è¢«å¼•å…¥åº”ç”¨ä¹‹å‰å¢å¼ºè¯¥ç›®æ ‡ç±»çš„å­—èŠ‚ç ã€‚

â‘¢ã€è¿è¡ŒæœŸç»‡å…¥ï¼šåˆ‡é¢åœ¨åº”ç”¨è¿è¡Œçš„æŸä¸ªæ—¶åˆ»è¢«ç»‡å…¥ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨ç»‡å…¥åˆ‡é¢æ—¶ï¼ŒAOP å®¹å™¨ä¼šä¸ºç›®æ ‡å¯¹è±¡åŠ¨æ€åœ°åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚Spring AOP å°±æ˜¯ä»¥è¿™ç§æ–¹å¼ç»‡å…¥åˆ‡é¢ã€‚

Spring é‡‡ç”¨è¿è¡ŒæœŸç»‡å…¥ï¼Œè€Œ AspectJ é‡‡ç”¨ç¼–è¯‘æœŸç»‡å…¥å’Œç±»åŠ è½½å™¨ç»‡å…¥ã€‚

#### AOP æœ‰å“ªäº›ç¯ç»•æ–¹å¼ï¼Ÿ

AOP ä¸€èˆ¬æœ‰ **5 ç§**ç¯ç»•æ–¹å¼ï¼š

- å‰ç½®é€šçŸ¥ (@Before)
- è¿”å›é€šçŸ¥ (@AfterReturning)
- å¼‚å¸¸é€šçŸ¥ (@AfterThrowing)
- åç½®é€šçŸ¥ (@After)
- ç¯ç»•é€šçŸ¥ (@Around)

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç¯ç»•æ–¹å¼](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-320fa34f-6620-419c-b17a-4f516a83caeb.png)

å¤šä¸ªåˆ‡é¢çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡ `@Order` æŒ‡å®šå…ˆåé¡ºåºï¼Œæ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
@Aspect
@Component
public class WebLogAspect {

    private final static Logger logger = LoggerFactory.getLogger(WebLogAspect.class);

    @Pointcut("@annotation(cn.fighter3.spring.aop_demo.WebLog)")
    public void webLog() {}

    @Before("webLog()")
    public void doBefore(JoinPoint joinPoint) throws Throwable {
        // å¼€å§‹æ‰“å°è¯·æ±‚æ—¥å¿—
        ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
        HttpServletRequest request = attributes.getRequest();
        // æ‰“å°è¯·æ±‚ç›¸å…³å‚æ•°
        logger.info("========================================== Start ==========================================");
        // æ‰“å°è¯·æ±‚ url
        logger.info("URL            : {}", request.getRequestURL().toString());
        // æ‰“å° Http method
        logger.info("HTTP Method    : {}", request.getMethod());
        // æ‰“å°è°ƒç”¨ controller çš„å…¨è·¯å¾„ä»¥åŠæ‰§è¡Œæ–¹æ³•
        logger.info("Class Method   : {}.{}", joinPoint.getSignature().getDeclaringTypeName(), joinPoint.getSignature().getName());
        // æ‰“å°è¯·æ±‚çš„ IP
        logger.info("IP             : {}", request.getRemoteAddr());
        // æ‰“å°è¯·æ±‚å…¥å‚
        logger.info("Request Args   : {}",new ObjectMapper().writeValueAsString(joinPoint.getArgs()));
    }

    @After("webLog()")
    public void doAfter() throws Throwable {
        // ç»“æŸåæ‰“ä¸ªåˆ†éš”çº¿ï¼Œæ–¹ä¾¿æŸ¥çœ‹
        logger.info("=========================================== End ===========================================");
    }

    @Around("webLog()")
    public Object doAround(ProceedingJoinPoint proceedingJoinPoint) throws Throwable {
        //å¼€å§‹æ—¶é—´
        long startTime = System.currentTimeMillis();
        Object result = proceedingJoinPoint.proceed();
        // æ‰“å°å‡ºå‚
        logger.info("Response Args  : {}", new ObjectMapper().writeValueAsString(result));
        // æ‰§è¡Œè€—æ—¶
        logger.info("Time-Consuming : {} ms", System.currentTimeMillis() - startTime);
        return result;
    }
}
```

æ€»ç»“ä¸€ä¸‹ï¼š

AOPï¼Œä¹Ÿå°±æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œæ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œæ—¨åœ¨æé«˜ä»£ç çš„æ¨¡å—åŒ–ã€‚æ¯”å¦‚è¯´å¯ä»¥å°†æ—¥å¿—è®°å½•ã€äº‹åŠ¡ç®¡ç†ç­‰åˆ†ç¦»å‡ºæ¥ï¼Œæ¥æé«˜ä»£ç çš„å¯é‡ç”¨æ€§ã€‚

AOP çš„æ ¸å¿ƒæ¦‚å¿µåŒ…æ‹¬åˆ‡é¢ï¼ˆAspectï¼‰ã€è¿æ¥ç‚¹ï¼ˆJoin Pointï¼‰ã€é€šçŸ¥ï¼ˆAdviceï¼‰ã€åˆ‡ç‚¹ï¼ˆPointcutï¼‰å’Œç»‡å…¥ï¼ˆWeavingï¼‰ç­‰ã€‚

â‘  åƒæ—¥å¿—æ‰“å°ã€äº‹åŠ¡ç®¡ç†ç­‰éƒ½å¯ä»¥æŠ½ç¦»ä¸ºåˆ‡é¢ï¼Œå¯ä»¥å£°æ˜åœ¨ç±»çš„æ–¹æ³•ä¸Šã€‚

â‘¡ åœ¨ Spring AOP ä¸­ï¼Œè¿æ¥ç‚¹æ€»æ˜¯è¡¨ç¤ºæ–¹æ³•çš„æ‰§è¡Œã€‚

â‘¢ Spring AOP æ”¯æŒäº”ç§ç±»å‹çš„é€šçŸ¥ï¼šå‰ç½®é€šçŸ¥ã€åç½®é€šçŸ¥ã€ç¯ç»•é€šçŸ¥ã€å¼‚å¸¸é€šçŸ¥ã€æœ€ç»ˆé€šçŸ¥ç­‰ã€‚

â‘£ åœ¨ AOP ä¸­ï¼Œåˆ‡ç‚¹ç”¨äºæŒ‡å®šæˆ‘ä»¬æƒ³è¦åœ¨å“ªäº›è¿æ¥ç‚¹ä¸Šæ‰§è¡Œé€šçŸ¥çš„è§„åˆ™ã€‚

â‘¤ ç»‡å…¥æ˜¯æŒ‡å°†åˆ‡é¢åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡å¹¶åˆ›å»ºæ–°çš„ä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ã€‚Spring AOP é»˜è®¤åœ¨è¿è¡Œæ—¶é€šè¿‡åŠ¨æ€ä»£ç†æ–¹å¼å®ç°ç»‡å…¥ã€‚

åƒ `@Transactional` æ³¨è§£ï¼Œå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ AOP åº”ç”¨ï¼Œå®ƒå°±æ˜¯é€šè¿‡ AOP æ¥å®ç°äº‹åŠ¡ç®¡ç†çš„ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨æ–¹æ³•ä¸Šæ·»åŠ  `@Transactional` æ³¨è§£ï¼ŒSpring å°±ä¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰åæ·»åŠ äº‹åŠ¡ç®¡ç†çš„é€»è¾‘ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„è…¾è®¯ Java åç«¯å®ä¹ ä¸€é¢åŸé¢˜ï¼šè¯´è¯´ AOP çš„åŸç†ã€‚
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³ 25 å±Šæ—¥å¸¸å®ä¹ ä¸€é¢åŸé¢˜ï¼šè¯´è¯´ä½ å¯¹ AOP å’Œ IoC çš„ç†è§£ã€‚
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¿«æ‰‹é¢ç»åŒå­¦ 7 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šè¯´ä¸€ä¸‹ Spring AOP çš„å®ç°åŸç†
> 4. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°å…¬å¸é¢ç»åˆé›†åŒå­¦ 1 Java åç«¯é¢è¯•åŸé¢˜ï¼šä»‹ç» Spring IoC å’Œ AOP?
> 5. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„æ‹›å•†é“¶è¡Œé¢ç»åŒå­¦ 6 æ‹›é“¶ç½‘ç»œç§‘æŠ€é¢è¯•åŸé¢˜ï¼šSpringBootæ¡†æ¶çš„AOPã€IOC/DIï¼Ÿ

### 20.ä½ å¹³æ—¶æœ‰ç”¨åˆ° AOP å—ï¼Ÿ

æœ‰ï¼Œæˆ‘åœ¨[æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®](https://javabetter.cn/zhishixingqiu/paicoding.html)ä¸­å°±æœ‰ä½¿ç”¨ï¼Œæˆ‘åˆ©ç”¨ AOP æ‰“å°äº†æ¥å£çš„å…¥å‚å’Œå‡ºå‚æ—¥å¿—ï¼Œä»¥åŠæ‰§è¡Œæ—¶é—´ã€‚

![æ²‰é»˜ç‹äºŒï¼šæŠ€æœ¯æ´¾æ•™ç¨‹](https://cdn.tobebetterjavaer.com/stutymore/spring-20240310180334.png)

æˆ‘æ˜¯è¿™æ ·ä½¿ç”¨çš„ã€‚

ç¬¬ä¸€æ­¥ï¼Œè‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£ä½œä¸ºåˆ‡ç‚¹

```java
@Target({ElementType.METHOD, ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface MdcDot {
    String bizCode() default "";
}
```

ç¬¬äºŒæ­¥ï¼Œé…ç½® AOP åˆ‡é¢ï¼š

- `@Aspect`ï¼šæ ‡è¯†åˆ‡é¢
- `@Pointcut`ï¼šè®¾ç½®åˆ‡ç‚¹ï¼Œè¿™é‡Œä»¥è‡ªå®šä¹‰æ³¨è§£ä¸ºåˆ‡ç‚¹
- `@Around`ï¼šç¯ç»•åˆ‡ç‚¹ï¼Œæ‰“å°æ–¹æ³•ç­¾åå’Œæ‰§è¡Œæ—¶é—´

![æŠ€æœ¯æ´¾é¡¹ç›®ï¼šé…ç½® AOP åˆ‡é¢](https://cdn.tobebetterjavaer.com/stutymore/spring-20240310180741.png)

ç¬¬ä¸‰æ­¥ï¼Œåœ¨ä½¿ç”¨çš„åœ°æ–¹åŠ ä¸Šè‡ªå®šä¹‰æ³¨è§£

![æŠ€æœ¯æ´¾é¡¹ç›®ï¼šä½¿ç”¨æ³¨è§£](https://cdn.tobebetterjavaer.com/stutymore/spring-20240310181233.png)

ç¬¬å››æ­¥ï¼Œå½“æ¥å£è¢«è°ƒç”¨æ—¶ï¼Œå°±å¯ä»¥çœ‹åˆ°å¯¹åº”çš„æ‰§è¡Œæ—¥å¿—ã€‚

```
2023-06-16 11:06:13,008 [http-nio-8080-exec-3] INFO |00000000.1686884772947.468581113|101|c.g.p.forum.core.mdc.MdcAspect.handle(MdcAspect.java:47) - æ–¹æ³•æ‰§è¡Œè€—æ—¶: com.github.paicoding.forum.web.front.article.rest.ArticleRestController#recommend = 47
```

### 21.è¯´è¯´ JDK åŠ¨æ€ä»£ç†å’Œ CGLIB ä»£ç†ï¼Ÿ

Spring çš„ AOP æ˜¯é€šè¿‡[åŠ¨æ€ä»£ç†](https://mp.weixin.qq.com/s/aZtfwik0weJN5JzYc-JxYg)æ¥å®ç°çš„ï¼ŒåŠ¨æ€ä»£ç†ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼šJDK åŠ¨æ€ä»£ç†å’Œ CGLIB ä»£ç†ã€‚

â‘ ã€JDK åŠ¨æ€ä»£ç†æ˜¯åŸºäºæ¥å£çš„ä»£ç†æ–¹å¼ï¼Œå®ƒä½¿ç”¨ Java åŸç”Ÿçš„ `java.lang.reflect.Proxy` ç±»å’Œ `java.lang.reflect.InvocationHandler` æ¥å£æ¥åˆ›å»ºå’Œç®¡ç†ä»£ç†å¯¹è±¡ã€‚

1. **åŸºäº Interface**ï¼šJDK åŠ¨æ€ä»£ç†è¦æ±‚ç›®æ ‡å¯¹è±¡å¿…é¡»å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ã€‚ä»£ç†å¯¹è±¡ä¸æ˜¯ç›´æ¥ç»§æ‰¿è‡ªç›®æ ‡å¯¹è±¡ï¼Œè€Œæ˜¯å®ç°äº†ä¸ç›®æ ‡å¯¹è±¡ç›¸åŒçš„æ¥å£ã€‚
2. **ä½¿ç”¨ InvocationHandler**ï¼šåœ¨è°ƒç”¨ä»£ç†å¯¹è±¡çš„ä»»ä½•æ–¹æ³•æ—¶ï¼Œè°ƒç”¨éƒ½ä¼šè¢«è½¬å‘åˆ°ä¸€ä¸ª InvocationHandler å®ä¾‹çš„ invoke æ–¹æ³•ã€‚å¯ä»¥åœ¨è¿™ä¸ª invoke æ–¹æ³•ä¸­å®šä¹‰æ‹¦æˆªé€»è¾‘ï¼Œæ¯”å¦‚æ–¹æ³•è°ƒç”¨å‰åæ‰§è¡Œçš„æ“ä½œã€‚
3. **åŸºäº Proxy**ï¼šProxy åˆ©ç”¨ InvocationHandler åŠ¨æ€åˆ›å»ºä¸€ä¸ªç¬¦åˆç›®æ ‡ç±»å®ç°çš„æ¥å£å®ä¾‹ï¼Œç”Ÿæˆç›®æ ‡ç±»çš„ä»£ç†å¯¹è±¡ã€‚

â‘¡ã€CGLIBï¼ˆCode Generation Libraryï¼‰æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹ä»£ç ç”Ÿæˆåº“ï¼Œå®ƒé€šè¿‡ç»§æ‰¿æ–¹å¼å®ç°ä»£ç†ï¼Œä¸éœ€è¦æ¥å£ï¼Œè¢«å¹¿æ³›åº”ç”¨äº Spring AOP ä¸­ï¼Œç”¨äºæä¾›æ–¹æ³•æ‹¦æˆªæ“ä½œã€‚

![å›¾ç‰‡æ¥æºäºç½‘ç»œ](https://cdn.tobebetterjavaer.com/stutymore/spring-20240321105653.png)

1. **åŸºäºç»§æ‰¿**ï¼ŒCGLIB é€šè¿‡åœ¨è¿è¡Œæ—¶ç”Ÿæˆç›®æ ‡å¯¹è±¡çš„å­ç±»æ¥åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œå¹¶åœ¨å­ç±»ä¸­è¦†ç›–é final çš„æ–¹æ³•ã€‚å› æ­¤ï¼Œå®ƒä¸è¦æ±‚ç›®æ ‡å¯¹è±¡å¿…é¡»å®ç°æ¥å£ã€‚
2. **åŸºäº ASM**ï¼ŒASM æ˜¯ä¸€ä¸ª Java å­—èŠ‚ç æ“ä½œå’Œåˆ†ææ¡†æ¶ï¼ŒCGLIB å¯ä»¥é€šè¿‡ ASM è¯»å–ç›®æ ‡ç±»çš„å­—èŠ‚ç ï¼Œç„¶åä¿®æ”¹å­—èŠ‚ç ç”Ÿæˆæ–°çš„ç±»ã€‚å®ƒåœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä¸€ä¸ªè¢«ä»£ç†ç±»çš„å­ç±»ï¼Œå¹¶åœ¨å­ç±»ä¸­è¦†ç›–çˆ¶ç±»çš„æ–¹æ³•ï¼Œé€šè¿‡æ–¹æ³•æ‹¦æˆªæŠ€æœ¯æ’å…¥å¢å¼ºä»£ç ã€‚

#### é€‰æ‹© CGLIB è¿˜æ˜¯ JDK åŠ¨æ€ä»£ç†ï¼Ÿ

- å¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°ä»»ä½•æ¥å£ï¼Œåˆ™åªèƒ½ä½¿ç”¨ CGLIB ä»£ç†ã€‚å¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œé€šå¸¸é¦–é€‰ JDK åŠ¨æ€ä»£ç†ã€‚
- è™½ç„¶ CGLIB åœ¨ä»£ç†ç±»çš„ç”Ÿæˆè¿‡ç¨‹ä¸­å¯èƒ½æ¶ˆè€—æ›´å¤šèµ„æºï¼Œä½†åœ¨è¿è¡Œæ—¶å…·æœ‰è¾ƒé«˜çš„æ€§èƒ½ã€‚å¯¹äºæ€§èƒ½æ•æ„Ÿä¸”ä»£ç†å¯¹è±¡åˆ›å»ºé¢‘ç‡ä¸é«˜çš„åœºæ™¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ CGLIBã€‚
- JDK åŠ¨æ€ä»£ç†æ˜¯ Java åŸç”Ÿæ”¯æŒçš„ï¼Œä¸éœ€è¦é¢å¤–å¼•å…¥åº“ã€‚è€Œ CGLIB éœ€è¦å°† CGLIB åº“ä½œä¸ºä¾èµ–åŠ å…¥é¡¹ç›®ä¸­ã€‚

#### ä½ ä¼šç”¨ JDK åŠ¨æ€ä»£ç†å’Œ CGLIB å—ï¼Ÿ

å‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªå°åœºæ™¯ï¼Œå®¢æœä¸­è½¬ï¼Œè§£å†³ç”¨æˆ·é—®é¢˜ï¼š

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šç”¨æˆ·å‘å®¢æœæé—®é¢˜](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-c5c4b247-62dd-43a2-a043-da51c58f77c8.png)

â‘ ã€JDK åŠ¨æ€ä»£ç†å®ç°ï¼š

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šJDKåŠ¨æ€ä»£ç†ç±»å›¾](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-65b14a3f-2653-463e-af77-a8875d3d635c.png)

ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºæ¥å£

```java
public interface ISolver {
    void solve();
}
```

ç¬¬äºŒæ­¥ï¼Œå®ç°å¯¹åº”æ¥å£

```java
public class Solver implements ISolver {
    @Override
    public void solve() {
        System.out.println("ç–¯ç‹‚æ‰å¤´å‘è§£å†³é—®é¢˜â€¦â€¦");
    }
}
```

ç¬¬ä¸‰æ­¥ï¼ŒåŠ¨æ€ä»£ç†å·¥å‚:ProxyFactoryï¼Œç›´æ¥ç”¨åå°„æ–¹å¼ç”Ÿæˆä¸€ä¸ªç›®æ ‡å¯¹è±¡çš„ä»£ç†ï¼Œè¿™é‡Œç”¨äº†ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»æ–¹å¼é‡å†™ InvocationHandler æ–¹æ³•ã€‚

```java
public class ProxyFactory {

    // ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡
    private Object target;

    public ProxyFactory(Object target) {
        this.target = target;
    }

    // ä¸ºç›®æ ‡å¯¹è±¡ç”Ÿæˆä»£ç†å¯¹è±¡
    public Object getProxyInstance() {
        return Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(),
                new InvocationHandler() {
                    @Override
                    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
                        System.out.println("è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°æ‚¨ï¼Ÿ");

                        // è°ƒç”¨ç›®æ ‡å¯¹è±¡æ–¹æ³•
                        Object returnValue = method.invoke(target, args);

                        System.out.println("é—®é¢˜å·²ç»è§£å†³å•¦ï¼");
                        return null;
                    }
                });
    }
}
```

ç¬¬äº”æ­¥ï¼Œå®¢æˆ·ç«¯ï¼šClientï¼Œç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡å®ä¾‹ï¼Œé€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ç›®æ ‡å¯¹è±¡æ–¹æ³•

```java
public class Client {
    public static void main(String[] args) {
        //ç›®æ ‡å¯¹è±¡:ç¨‹åºå‘˜
        ISolver developer = new Solver();
        //ä»£ç†ï¼šå®¢æœå°å§å§
        ISolver csProxy = (ISolver) new ProxyFactory(developer).getProxyInstance();
        //ç›®æ ‡æ–¹æ³•ï¼šè§£å†³é—®é¢˜
        csProxy.solve();
    }
}
```

â‘¡ã€CGLIB åŠ¨æ€ä»£ç†å®ç°ï¼š

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šCGLIBåŠ¨æ€ä»£ç†ç±»å›¾](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-74da87af-20d1-4a5b-a212-3837a15f0bab.png)

ç¬¬ä¸€æ­¥ï¼šå®šä¹‰ç›®æ ‡ç±»ï¼ˆSolverï¼‰ï¼Œç›®æ ‡ç±» Solver å®šä¹‰äº†ä¸€ä¸ª solve æ–¹æ³•ï¼Œæ¨¡æ‹Ÿäº†è§£å†³é—®é¢˜çš„è¡Œä¸ºã€‚ç›®æ ‡ç±»ä¸éœ€è¦å®ç°ä»»ä½•æ¥å£ï¼Œè¿™ä¸ JDK åŠ¨æ€ä»£ç†çš„è¦æ±‚ä¸åŒã€‚

```java
public class Solver {

    public void solve() {
        System.out.println("ç–¯ç‹‚æ‰å¤´å‘è§£å†³é—®é¢˜â€¦â€¦");
    }
}
```

ç¬¬äºŒæ­¥ï¼šåŠ¨æ€ä»£ç†å·¥å‚ï¼ˆProxyFactoryï¼‰ï¼ŒProxyFactory ç±»å®ç°äº† MethodInterceptor æ¥å£ï¼Œè¿™æ˜¯ CGLIB æä¾›çš„ä¸€ä¸ªæ–¹æ³•æ‹¦æˆªæ¥å£ï¼Œç”¨äºå®šä¹‰æ–¹æ³•çš„æ‹¦æˆªé€»è¾‘ã€‚

```java
public class ProxyFactory implements MethodInterceptor {

    //ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡
    private Object target;

    public ProxyFactory(Object target) {
        this.target = target;
    }

    //ä¸ºç›®æ ‡å¯¹è±¡ç”Ÿæˆä»£ç†å¯¹è±¡
    public Object getProxyInstance() {
        //å·¥å…·ç±»
        Enhancer en = new Enhancer();
        //è®¾ç½®çˆ¶ç±»
        en.setSuperclass(target.getClass());
        //è®¾ç½®å›è°ƒå‡½æ•°
        en.setCallback(this);
        //åˆ›å»ºå­ç±»å¯¹è±¡ä»£ç†
        return en.create();
    }

    @Override
    public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable {
        System.out.println("è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°æ‚¨ï¼Ÿ");
        // æ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³•
        Object returnValue = method.invoke(target, args);
        System.out.println("é—®é¢˜å·²ç»è§£å†³å•¦ï¼");
        return null;
    }

}
```

- ProxyFactory æ¥æ”¶ä¸€ä¸ª Object ç±»å‹çš„ targetï¼Œå³ç›®æ ‡å¯¹è±¡çš„å®ä¾‹ã€‚
- ä½¿ç”¨ CGLIB çš„ Enhancer ç±»æ¥ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»ï¼ˆä»£ç†å¯¹è±¡ï¼‰ã€‚é€šè¿‡ setSuperclass è®¾ç½®ä»£ç†å¯¹è±¡çš„çˆ¶ç±»ä¸ºç›®æ ‡å¯¹è±¡çš„ç±»ï¼ŒsetCallback è®¾ç½®æ–¹æ³•æ‹¦æˆªå™¨ä¸ºå½“å‰å¯¹è±¡ï¼ˆthisï¼‰ï¼Œæœ€åè°ƒç”¨ create æ–¹æ³•ç”Ÿæˆå¹¶è¿”å›ä»£ç†å¯¹è±¡ã€‚
- é‡å†™ MethodInterceptor æ¥å£çš„ intercept æ–¹æ³•ä»¥æä¾›æ–¹æ³•æ‹¦æˆªé€»è¾‘ã€‚åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰åæ·»åŠ è‡ªå®šä¹‰é€»è¾‘ï¼Œç„¶åé€šè¿‡ method.invoke è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ã€‚

ç¬¬ä¸‰æ­¥ï¼šå®¢æˆ·ç«¯ä½¿ç”¨ä»£ç†ï¼Œé¦–å…ˆåˆ›å»ºç›®æ ‡å¯¹è±¡ï¼ˆSolver çš„å®ä¾‹ï¼‰ï¼Œç„¶åä½¿ç”¨ ProxyFactory åˆ›å»ºè¯¥ç›®æ ‡å¯¹è±¡çš„ä»£ç†ã€‚é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ solve æ–¹æ³•æ—¶ï¼Œä¼šå…ˆæ‰§è¡Œ intercept æ–¹æ³•ä¸­å®šä¹‰çš„é€»è¾‘ï¼Œç„¶åæ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼Œæœ€åå†æ‰§è¡Œ intercept æ–¹æ³•ä¸­çš„åç»­é€»è¾‘ã€‚

```java
public class Client {
    public static void main(String[] args) {
        //ç›®æ ‡å¯¹è±¡:ç¨‹åºå‘˜
        Solver developer = new Solver();
        //ä»£ç†ï¼šå®¢æœå°å§å§
        Solver csProxy = (Solver) new ProxyFactory(developer).getProxyInstance();
        //ç›®æ ‡æ–¹æ³•ï¼šè§£å†³é—®é¢˜
        csProxy.solve();
    }
}
```

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¸†è½¯åŒå­¦ 3 Java åç«¯ä¸€é¢çš„åŸé¢˜ï¼šcglib çš„åŸç†
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 22 æš‘æœŸå®ä¹ ä¸€é¢é¢è¯•åŸé¢˜ï¼šSpring AOP å®ç°åŸç†

### 22.è¯´è¯´ Spring AOP å’Œ AspectJ AOP åŒºåˆ«?

**Spring AOP**

Spring AOP å±äº`è¿è¡Œæ—¶å¢å¼º`ï¼Œä¸»è¦å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š

1.  åŸºäºåŠ¨æ€ä»£ç†æ¥å®ç°ï¼Œé»˜è®¤å¦‚æœä½¿ç”¨æ¥å£çš„ï¼Œç”¨ JDK æä¾›çš„åŠ¨æ€ä»£ç†å®ç°ï¼Œå¦‚æœæ˜¯æ–¹æ³•åˆ™ä½¿ç”¨ CGLIB å®ç°

2.  Spring AOP éœ€è¦ä¾èµ– IoC å®¹å™¨æ¥ç®¡ç†ï¼Œå¹¶ä¸”åªèƒ½ä½œç”¨äº Spring å®¹å™¨ï¼Œä½¿ç”¨çº¯ Java ä»£ç å®ç°

3.  åœ¨æ€§èƒ½ä¸Šï¼Œç”±äº Spring AOP æ˜¯åŸºäº**åŠ¨æ€ä»£ç†**æ¥å®ç°çš„ï¼Œåœ¨å®¹å™¨å¯åŠ¨æ—¶éœ€è¦ç”Ÿæˆä»£ç†å®ä¾‹ï¼Œåœ¨æ–¹æ³•è°ƒç”¨ä¸Šä¹Ÿä¼šå¢åŠ æ ˆçš„æ·±åº¦ï¼Œä½¿å¾— Spring AOP çš„æ€§èƒ½ä¸å¦‚ AspectJ çš„é‚£ä¹ˆå¥½ã€‚

4.  Spring AOP è‡´åŠ›äºè§£å†³ä¼ä¸šçº§å¼€å‘ä¸­æœ€æ™®éçš„ AOP(æ–¹æ³•ç»‡å…¥)ã€‚

**AspectJ**

AspectJ æ˜¯ä¸€ä¸ªæ˜“ç”¨çš„åŠŸèƒ½å¼ºå¤§çš„ AOP æ¡†æ¶ï¼Œå±äº`ç¼–è¯‘æ—¶å¢å¼º`ï¼Œ å¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥æ•´åˆåˆ°å…¶å®ƒæ¡†æ¶ä¸­ï¼Œæ˜¯ AOP ç¼–ç¨‹çš„å®Œå…¨è§£å†³æ–¹æ¡ˆã€‚AspectJ éœ€è¦ç”¨åˆ°å•ç‹¬çš„ç¼–è¯‘å™¨ ajcã€‚

AspectJ å±äº**é™æ€ç»‡å…¥**ï¼Œé€šè¿‡ä¿®æ”¹ä»£ç æ¥å®ç°ï¼Œåœ¨å®é™…è¿è¡Œä¹‹å‰å°±å®Œæˆäº†ç»‡å…¥ï¼Œæ‰€ä»¥è¯´å®ƒç”Ÿæˆçš„ç±»æ˜¯æ²¡æœ‰é¢å¤–è¿è¡Œæ—¶å¼€é”€çš„ï¼Œä¸€èˆ¬æœ‰å¦‚ä¸‹å‡ ä¸ªç»‡å…¥çš„æ—¶æœºï¼š

1.  ç¼–è¯‘æœŸç»‡å…¥ï¼ˆCompile-time weavingï¼‰ï¼šå¦‚ç±» A ä½¿ç”¨ AspectJ æ·»åŠ äº†ä¸€ä¸ªå±æ€§ï¼Œç±» B å¼•ç”¨äº†å®ƒï¼Œè¿™ä¸ªåœºæ™¯å°±éœ€è¦ç¼–è¯‘æœŸçš„æ—¶å€™å°±è¿›è¡Œç»‡å…¥ï¼Œå¦åˆ™æ²¡æ³•ç¼–è¯‘ç±» Bã€‚

2.  ç¼–è¯‘åç»‡å…¥ï¼ˆPost-compile weavingï¼‰ï¼šä¹Ÿå°±æ˜¯å·²ç»ç”Ÿæˆäº† .class æ–‡ä»¶ï¼Œæˆ–å·²ç»æ‰“æˆ jar åŒ…äº†ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬éœ€è¦å¢å¼ºå¤„ç†çš„è¯ï¼Œå°±è¦ç”¨åˆ°ç¼–è¯‘åç»‡å…¥ã€‚

3.  ç±»åŠ è½½åç»‡å…¥ï¼ˆLoad-time weavingï¼‰ï¼šæŒ‡çš„æ˜¯åœ¨åŠ è½½ç±»çš„æ—¶å€™è¿›è¡Œç»‡å…¥ï¼Œè¦å®ç°è¿™ä¸ªæ—¶æœŸçš„ç»‡å…¥ï¼Œæœ‰å‡ ç§å¸¸è§çš„æ–¹æ³•

æ•´ä½“å¯¹æ¯”å¦‚ä¸‹ï¼š

![Spring AOPå’ŒAspectJå¯¹æ¯”](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-d1dbe9d9-c55f-4293-8622-d9759064d613.png)

GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹](https://javabetter.cn/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## äº‹åŠ¡

Spring äº‹åŠ¡çš„æœ¬è´¨å…¶å®å°±æ˜¯æ•°æ®åº“å¯¹äº‹åŠ¡çš„æ”¯æŒï¼Œæ²¡æœ‰æ•°æ®åº“çš„äº‹åŠ¡æ”¯æŒï¼ŒSpring æ˜¯æ— æ³•æä¾›äº‹åŠ¡åŠŸèƒ½çš„ã€‚Spring åªæä¾›ç»Ÿä¸€äº‹åŠ¡ç®¡ç†æ¥å£ï¼Œå…·ä½“å®ç°éƒ½æ˜¯ç”±å„æ•°æ®åº“è‡ªå·±å®ç°ï¼Œæ•°æ®åº“äº‹åŠ¡çš„æäº¤å’Œå›æ»šæ˜¯é€šè¿‡æ•°æ®åº“è‡ªå·±çš„äº‹åŠ¡æœºåˆ¶å®ç°ã€‚

### 23.Spring äº‹åŠ¡çš„ç§ç±»ï¼Ÿ

åœ¨ Spring ä¸­ï¼Œäº‹åŠ¡ç®¡ç†å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼šå£°æ˜å¼äº‹åŠ¡ç®¡ç†å’Œç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringäº‹åŠ¡åˆ†ç±»](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-d3ee77fa-926d-4c39-91f8-a8b1544a9134.png)

#### ä»‹ç»ä¸€ä¸‹ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†ï¼Ÿ

ç¼–ç¨‹å¼äº‹åŠ¡å¯ä»¥ä½¿ç”¨ TransactionTemplate å’Œ PlatformTransactionManager æ¥å®ç°ï¼Œéœ€è¦æ˜¾å¼æ‰§è¡Œäº‹åŠ¡ã€‚å…è®¸æˆ‘ä»¬åœ¨ä»£ç ä¸­ç›´æ¥æ§åˆ¶äº‹åŠ¡çš„è¾¹ç•Œï¼Œé€šè¿‡ç¼–ç¨‹æ–¹å¼æ˜ç¡®æŒ‡å®šäº‹åŠ¡çš„å¼€å§‹ã€æäº¤å’Œå›æ»šã€‚

```java
public class AccountService {
    private TransactionTemplate transactionTemplate;

    public void setTransactionTemplate(TransactionTemplate transactionTemplate) {
        this.transactionTemplate = transactionTemplate;
    }

    public void transfer(final String out, final String in, final Double money) {
        transactionTemplate.execute(new TransactionCallbackWithoutResult() {
            @Override
            protected void doInTransactionWithoutResult(TransactionStatus status) {
                // è½¬å‡º
                accountDao.outMoney(out, money);
                // è½¬å…¥
                accountDao.inMoney(in, money);
            }
        });
    }
}
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† TransactionTemplate æ¥å®ç°ç¼–ç¨‹å¼äº‹åŠ¡ï¼Œé€šè¿‡ execute æ–¹æ³•æ¥æ‰§è¡Œäº‹åŠ¡ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æ–¹æ³•å†…éƒ¨å®ç°äº‹åŠ¡çš„æ§åˆ¶ã€‚

#### ä»‹ç»ä¸€ä¸‹å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼Ÿ

å£°æ˜å¼äº‹åŠ¡æ˜¯å»ºç«‹åœ¨ AOP ä¹‹ä¸Šçš„ã€‚å…¶æœ¬è´¨æ˜¯é€šè¿‡ AOP åŠŸèƒ½ï¼Œå¯¹æ–¹æ³•å‰åè¿›è¡Œæ‹¦æˆªï¼Œå°†äº‹åŠ¡å¤„ç†çš„åŠŸèƒ½ç¼–ç»‡åˆ°æ‹¦æˆªçš„æ–¹æ³•ä¸­ï¼Œä¹Ÿå°±æ˜¯åœ¨ç›®æ ‡æ–¹æ³•å¼€å§‹ä¹‹å‰å¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå®Œä¹‹åæ ¹æ®æ‰§è¡Œæƒ…å†µæäº¤æˆ–è€…å›æ»šäº‹åŠ¡ã€‚

ç›¸æ¯”è¾ƒç¼–ç¨‹å¼äº‹åŠ¡ï¼Œä¼˜ç‚¹æ˜¯ä¸éœ€è¦åœ¨ä¸šåŠ¡é€»è¾‘ä»£ç ä¸­æºæ‚äº‹åŠ¡ç®¡ç†çš„ä»£ç ï¼Œ Spring æ¨èé€šè¿‡ @Transactional æ³¨è§£çš„æ–¹å¼æ¥å®ç°å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼Œä¹Ÿæ˜¯æ—¥å¸¸å¼€å‘ä¸­æœ€å¸¸ç”¨çš„ã€‚

ä¸è¶³çš„åœ°æ–¹æ˜¯ï¼Œå£°æ˜å¼äº‹åŠ¡ç®¡ç†æœ€ç»†ç²’åº¦åªèƒ½ä½œç”¨åˆ°æ–¹æ³•çº§åˆ«ï¼Œæ— æ³•åƒç¼–ç¨‹å¼äº‹åŠ¡é‚£æ ·å¯ä»¥ä½œç”¨åˆ°ä»£ç å—çº§åˆ«ã€‚

```java
@Service
public class AccountService {
    @Autowired
    private AccountDao accountDao;

    @Transactional
    public void transfer(String out, String in, Double money) {
        // è½¬å‡º
        accountDao.outMoney(out, money);
        // è½¬å…¥
        accountDao.inMoney(in, money);
    }
}
```

#### è¯´è¯´ä¸¤è€…çš„åŒºåˆ«ï¼Ÿ

- **ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†**ï¼šéœ€è¦åœ¨ä»£ç ä¸­æ˜¾å¼è°ƒç”¨äº‹åŠ¡ç®¡ç†çš„ API æ¥æ§åˆ¶äº‹åŠ¡çš„è¾¹ç•Œï¼Œæ¯”è¾ƒçµæ´»ï¼Œä½†æ˜¯ä»£ç ä¾µå…¥æ€§è¾ƒå¼ºï¼Œä¸å¤Ÿä¼˜é›…ã€‚
- **å£°æ˜å¼äº‹åŠ¡ç®¡ç†**ï¼šè¿™ç§æ–¹å¼ä½¿ç”¨ Spring çš„ AOP æ¥å£°æ˜äº‹åŠ¡ï¼Œå°†äº‹åŠ¡ç®¡ç†ä»£ç ä»ä¸šåŠ¡ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ã€‚ä¼˜ç‚¹æ˜¯ä»£ç ç®€æ´ï¼Œæ˜“äºç»´æŠ¤ã€‚ä½†ç¼ºç‚¹æ˜¯ä¸å¤Ÿçµæ´»ï¼Œåªèƒ½åœ¨é¢„å®šä¹‰çš„æ–¹æ³•ä¸Šä½¿ç”¨äº‹åŠ¡ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„äº¬ä¸œåŒå­¦ 10 åç«¯å®ä¹ ä¸€é¢çš„åŸé¢˜ï¼šSpring äº‹åŠ¡æ€ä¹ˆå®ç°çš„
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å†œä¸šé“¶è¡Œé¢ç»åŒå­¦ 7 Java åç«¯é¢è¯•åŸé¢˜ï¼šSpring å¦‚ä½•ä¿è¯äº‹åŠ¡

### 24.è¯´è¯´ Spring çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Ÿ

å¥½ï¼Œäº‹åŠ¡çš„éš”ç¦»çº§åˆ«å®šä¹‰äº†ä¸€ä¸ªäº‹åŠ¡å¯èƒ½å—å…¶ä»–å¹¶å‘äº‹åŠ¡å½±å“çš„ç¨‹åº¦ã€‚SQL æ ‡å‡†å®šä¹‰äº†å››ä¸ªéš”ç¦»çº§åˆ«ï¼ŒSpring éƒ½æ”¯æŒï¼Œå¹¶ä¸”æä¾›äº†å¯¹åº”çš„æœºåˆ¶æ¥é…ç½®å®ƒä»¬ï¼Œå®šä¹‰åœ¨ TransactionDefinition æ¥å£ä¸­ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://cdn.tobebetterjavaer.com/stutymore/spring-20240326082116.png)

â‘ ã€ISOLATION_DEFAULTï¼šä½¿ç”¨æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼ˆä½ ä»¬çˆ±å’‹å’‹æ»´ ğŸ˜ï¼‰ï¼ŒMySQL é»˜è®¤çš„æ˜¯å¯é‡å¤è¯»ï¼ŒOracle é»˜è®¤çš„è¯»å·²æäº¤ã€‚

â‘¡ã€ISOLATION_READ_UNCOMMITTEDï¼šè¯»æœªæäº¤ï¼Œå…è®¸äº‹åŠ¡è¯»å–æœªè¢«å…¶ä»–äº‹åŠ¡æäº¤çš„æ›´æ”¹ã€‚è¿™æ˜¯éš”ç¦»çº§åˆ«æœ€ä½çš„è®¾ç½®ï¼Œå¯èƒ½ä¼šå¯¼è‡´â€œè„è¯»â€é—®é¢˜ã€‚

â‘¢ã€ISOLATION_READ_COMMITTEDï¼šè¯»å·²æäº¤ï¼Œç¡®ä¿äº‹åŠ¡åªèƒ½è¯»å–å·²ç»è¢«å…¶ä»–äº‹åŠ¡æäº¤çš„æ›´æ”¹ã€‚è¿™å¯ä»¥é˜²æ­¢â€œè„è¯»â€ï¼Œä½†ä»ç„¶å¯èƒ½å‘ç”Ÿâ€œä¸å¯é‡å¤è¯»â€å’Œâ€œå¹»è¯»â€é—®é¢˜ã€‚

â‘£ã€ISOLATION_REPEATABLE_READï¼šå¯é‡å¤è¯»ï¼Œç¡®ä¿äº‹åŠ¡å¯ä»¥å¤šæ¬¡ä»ä¸€ä¸ªå­—æ®µä¸­è¯»å–ç›¸åŒçš„å€¼ï¼Œå³åœ¨è¿™ä¸ªäº‹åŠ¡å†…ï¼Œå…¶ä»–äº‹åŠ¡æ— æ³•æ›´æ”¹è¿™ä¸ªå­—æ®µï¼Œä»è€Œé¿å…äº†â€œä¸å¯é‡å¤è¯»â€ï¼Œä½†ä»å¯èƒ½å‘ç”Ÿâ€œå¹»è¯»â€é—®é¢˜ã€‚

â‘¤ã€ISOLATION_SERIALIZABLEï¼šä¸²è¡ŒåŒ–ï¼Œè¿™æ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®ƒå®Œå…¨éš”ç¦»äº†äº‹åŠ¡ï¼Œç¡®ä¿äº‹åŠ¡åºåˆ—åŒ–æ‰§è¡Œï¼Œä»¥æ­¤æ¥é¿å…â€œè„è¯»â€ã€â€œä¸å¯é‡å¤è¯»â€å’Œâ€œå¹»è¯»â€é—®é¢˜ï¼Œä½†æ€§èƒ½å½±å“ä¹Ÿæœ€å¤§ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„åä¸ºé¢ç»åŒå­¦ 8 æŠ€æœ¯äºŒé¢é¢è¯•åŸé¢˜ï¼šSpring ä¸­çš„äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Ÿ
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³é¢ç»åŒå­¦ E ç¬¬äºŒä¸ªéƒ¨é—¨ Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šspring çš„éš”ç¦»æœºåˆ¶ï¼Œé»˜è®¤æ˜¯å“ªä¸€ç§

### 25.Spring çš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶ï¼Ÿ

äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶å®šä¹‰äº†åœ¨æ–¹æ³•è¢«å¦ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•çš„äº‹åŠ¡è¡Œä¸ºåº”è¯¥å¦‚ä½•ã€‚

Spring æä¾›äº†ä¸€ç³»åˆ—äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼Œè¿™äº›ä¼ æ’­è¡Œä¸ºå®šä¹‰äº†äº‹åŠ¡çš„è¾¹ç•Œå’Œäº‹åŠ¡ä¸Šä¸‹æ–‡å¦‚ä½•åœ¨æ–¹æ³•è°ƒç”¨é“¾ä¸­ä¼ æ’­ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼š6ç§äº‹åŠ¡ä¼ æ’­æœºåˆ¶](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-a6e2a8dc-9771-4d8b-9d91-76ddee98af1a.png)

- REQUIREDï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚Spring çš„é»˜è®¤ä¼ æ’­è¡Œä¸ºã€‚
- SUPPORTSï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œã€‚
- MANDATORYï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚
- REQUIRES_NEWï¼šæ€»æ˜¯å¯åŠ¨ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™å°†å½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚
- NOT_SUPPORTEDï¼šæ€»æ˜¯ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™å°†å½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚
- NESTEDï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œã€‚å¦‚æœå½“å‰äº‹åŠ¡ä¸å­˜åœ¨ï¼Œåˆ™è¡Œä¸ºä¸ REQUIRED ä¸€æ ·ã€‚åµŒå¥—äº‹åŠ¡æ˜¯ä¸€ä¸ªå­äº‹åŠ¡ï¼Œå®ƒä¾èµ–äºçˆ¶äº‹åŠ¡ã€‚çˆ¶äº‹åŠ¡å¤±è´¥æ—¶ï¼Œä¼šå›æ»šå­äº‹åŠ¡æ‰€åšçš„æ‰€æœ‰æ“ä½œã€‚ä½†å­äº‹åŠ¡å¼‚å¸¸ä¸ä¸€å®šä¼šå¯¼è‡´çˆ¶äº‹åŠ¡çš„å›æ»šã€‚

äº‹åŠ¡ä¼ æ’­æœºåˆ¶æ˜¯ä½¿ç”¨ [ThreadLocal](https://javabetter.cn/thread/ThreadLocal.html) å®ç°çš„ï¼Œæ‰€ä»¥ï¼Œå¦‚æœè°ƒç”¨çš„æ–¹æ³•æ˜¯åœ¨æ–°çº¿ç¨‹ä¸­ï¼Œäº‹åŠ¡ä¼ æ’­ä¼šå¤±æ•ˆã€‚

```java
@Transactional
public void parentMethod() {
    new Thread(() -> childMethod()).start();
}

public void childMethod() {
    // è¿™é‡Œçš„æ“ä½œå°†ä¸ä¼šåœ¨ parentMethod çš„äº‹åŠ¡èŒƒå›´å†…æ‰§è¡Œ
}
```

Spring é»˜è®¤çš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯ PROPAFATION_REQUIREDï¼Œå³å¦‚æœå¤šä¸ª `ServiceX#methodX()` éƒ½å·¥ä½œåœ¨äº‹åŠ¡ç¯å¢ƒä¸‹ï¼Œä¸”ç¨‹åºä¸­å­˜åœ¨è¿™æ ·çš„è°ƒç”¨é“¾ `Service1#method1()->Service2#method2()->Service3#method3()`ï¼Œé‚£ä¹ˆè¿™ 3 ä¸ªæœåŠ¡ç±»çš„ 3 ä¸ªæ–¹æ³•éƒ½é€šè¿‡ Spring çš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶å·¥ä½œåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚

#### protected å’Œ private åŠ äº‹åŠ¡ä¼šç”Ÿæ•ˆå—

åœ¨ Spring ä¸­ï¼Œ**åªæœ‰é€šè¿‡ Spring å®¹å™¨çš„ AOP ä»£ç†è°ƒç”¨çš„å…¬å¼€æ–¹æ³•ï¼ˆpublic methodï¼‰ä¸Šçš„`@Transactional`æ³¨è§£æ‰ä¼šç”Ÿæ•ˆ**ã€‚

å¦‚æœåœ¨ protectedã€private æ–¹æ³•ä¸Šä½¿ç”¨`@Transactional`ï¼Œè¿™äº›äº‹åŠ¡æ³¨è§£å°†ä¸ä¼šç”Ÿæ•ˆï¼ŒåŸå› ï¼šSpring é»˜è®¤ä½¿ç”¨åŸºäº JDK çš„åŠ¨æ€ä»£ç†ï¼ˆå½“æ¥å£å­˜åœ¨æ—¶ï¼‰æˆ–åŸºäº CGLIB çš„ä»£ç†ï¼ˆå½“åªæœ‰ç±»æ—¶ï¼‰æ¥å®ç°äº‹åŠ¡ã€‚è¿™ä¸¤ç§ä»£ç†æœºåˆ¶éƒ½åªèƒ½ä»£ç†å…¬å¼€çš„æ–¹æ³•ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„äº¬ä¸œåŒå­¦ 10 åç«¯å®ä¹ ä¸€é¢çš„åŸé¢˜ï¼šäº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³æ˜¥æ‹›åŒå­¦ K ä¸€é¢é¢è¯•åŸé¢˜ï¼šäº‹åŠ¡ä¼ æ’­ï¼Œprotected å’Œ private åŠ äº‹åŠ¡ä¼šç”Ÿæ•ˆå—,è¿˜æœ‰é‚£äº›ä¸ç”Ÿæ•ˆçš„æƒ…å†µ
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„åä¸ºé¢ç»åŒå­¦ 8 æŠ€æœ¯äºŒé¢é¢è¯•åŸé¢˜ï¼šSpring ä¸­çš„äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Ÿ

### 26.å£°æ˜å¼äº‹åŠ¡å®ç°åŸç†äº†è§£å—ï¼Ÿ

Spring çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†æ˜¯é€šè¿‡ AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰å’Œä»£ç†æœºåˆ¶å®ç°çš„ã€‚

ç¬¬ä¸€æ­¥ï¼Œ**åœ¨ Bean åˆå§‹åŒ–é˜¶æ®µåˆ›å»ºä»£ç†å¯¹è±¡**ï¼š

Spring å®¹å™¨åœ¨åˆå§‹åŒ–å•ä¾‹ Bean çš„æ—¶å€™ï¼Œä¼šéå†æ‰€æœ‰çš„ BeanPostProcessor å®ç°ç±»ï¼Œå¹¶æ‰§è¡Œå…¶ postProcessAfterInitialization æ–¹æ³•ã€‚

åœ¨æ‰§è¡Œ postProcessAfterInitialization æ–¹æ³•æ—¶ä¼šéå†å®¹å™¨ä¸­æ‰€æœ‰çš„åˆ‡é¢ï¼ŒæŸ¥æ‰¾ä¸å½“å‰ Bean åŒ¹é…çš„åˆ‡é¢ï¼Œè¿™é‡Œä¼šè·å–äº‹åŠ¡çš„å±æ€§åˆ‡é¢ï¼Œä¹Ÿå°±æ˜¯ `@Transactional` æ³¨è§£åŠå…¶å±æ€§å€¼ã€‚

ç„¶åæ ¹æ®å¾—åˆ°çš„åˆ‡é¢åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œé»˜è®¤ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†åˆ›å»ºä»£ç†ï¼Œå¦‚æœç›®æ ‡ç±»æ˜¯æ¥å£ï¼Œåˆ™ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ï¼Œå¦åˆ™ä½¿ç”¨ Cglibã€‚

ç¬¬äºŒæ­¥ï¼Œ**åœ¨æ‰§è¡Œç›®æ ‡æ–¹æ³•æ—¶è¿›è¡Œäº‹åŠ¡å¢å¼ºæ“ä½œ**ï¼š

å½“é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ Bean æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šè§¦å‘å¯¹åº”çš„ AOP å¢å¼ºæ‹¦æˆªå™¨ï¼Œå£°æ˜å¼äº‹åŠ¡æ˜¯ä¸€ç§ç¯ç»•å¢å¼ºï¼Œå¯¹åº”æ¥å£ä¸º`MethodInterceptor`ï¼Œäº‹åŠ¡å¢å¼ºå¯¹è¯¥æ¥å£çš„å®ç°ä¸º`TransactionInterceptor`ï¼Œç±»å›¾å¦‚ä¸‹ï¼š

![å›¾ç‰‡æ¥æºç½‘æ˜“æŠ€æœ¯ä¸“æ ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-97493c7f-c596-4e98-a6a8-dab254d6d1ab.png)

äº‹åŠ¡æ‹¦æˆªå™¨`TransactionInterceptor`åœ¨`invoke`æ–¹æ³•ä¸­ï¼Œé€šè¿‡è°ƒç”¨çˆ¶ç±»`TransactionAspectSupport`çš„`invokeWithinTransaction`æ–¹æ³•è¿›è¡Œäº‹åŠ¡å¤„ç†ï¼ŒåŒ…æ‹¬å¼€å¯äº‹åŠ¡ã€äº‹åŠ¡æäº¤ã€å¼‚å¸¸å›æ»šç­‰ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„äº¬ä¸œåŒå­¦ 10 åç«¯å®ä¹ ä¸€é¢çš„åŸé¢˜ï¼šSpring äº‹åŠ¡æ€ä¹ˆå®ç°çš„

### 27.å£°æ˜å¼äº‹åŠ¡åœ¨å“ªäº›æƒ…å†µä¸‹ä¼šå¤±æ•ˆï¼Ÿ

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šå£°æ˜å¼äº‹åŠ¡çš„å‡ ç§å¤±æ•ˆçš„æƒ…å†µ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-381e4ec9-a235-4cfa-9b4d-518095a7502a.png)

#### 1ã€@Transactional åº”ç”¨åœ¨é public ä¿®é¥°çš„æ–¹æ³•ä¸Š

å¦‚æœ Transactional æ³¨è§£åº”ç”¨åœ¨é public ä¿®é¥°çš„æ–¹æ³•ä¸Šï¼ŒTransactional å°†ä¼šå¤±æ•ˆã€‚

æ˜¯å› ä¸ºåœ¨ Spring AOP ä»£ç†æ—¶ï¼ŒTransactionInterceptor ï¼ˆäº‹åŠ¡æ‹¦æˆªå™¨ï¼‰åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰åè¿›è¡Œæ‹¦æˆªï¼ŒDynamicAdvisedInterceptorï¼ˆCglibAopProxy çš„å†…éƒ¨ç±»ï¼‰çš„ intercept æ–¹æ³•æˆ– JdkDynamicAopProxy çš„ invoke æ–¹æ³•ä¼šé—´æ¥è°ƒç”¨ AbstractFallbackTransactionAttributeSource çš„ **computeTransactionAttribute**æ–¹æ³•ï¼Œè·å– Transactional æ³¨è§£çš„äº‹åŠ¡é…ç½®ä¿¡æ¯ã€‚

```java
protected TransactionAttribute computeTransactionAttribute(Method method,
    Class<?> targetClass) {
        // Don't allow no-public methods as required.
        if (allowPublicMethodsOnly() && !Modifier.isPublic(method.getModifiers())) {
        return null;
    }
}
```

æ­¤æ–¹æ³•ä¼šæ£€æŸ¥ç›®æ ‡æ–¹æ³•çš„ä¿®é¥°ç¬¦æ˜¯å¦ä¸º publicï¼Œä¸æ˜¯ public åˆ™ä¸ä¼šè·å– @Transactional çš„å±æ€§é…ç½®ä¿¡æ¯ã€‚

#### 2ã€@Transactional æ³¨è§£å±æ€§ propagation è®¾ç½®é”™è¯¯

- TransactionDefinition.PROPAGATION_SUPPORTSï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼›é”™è¯¯ä½¿ç”¨åœºæ™¯ï¼šåœ¨ä¸šåŠ¡é€»è¾‘å¿…é¡»è¿è¡Œåœ¨äº‹åŠ¡ç¯å¢ƒä¸‹ä»¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§çš„æƒ…å†µä¸‹ä½¿ç”¨ SUPPORTSã€‚
- TransactionDefinition.PROPAGATION_NOT_SUPPORTEDï¼šæ€»æ˜¯ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŒ‚èµ·è¯¥äº‹åŠ¡ã€‚é”™è¯¯ä½¿ç”¨åœºæ™¯ï¼šåœ¨éœ€è¦äº‹åŠ¡æ”¯æŒçš„æ“ä½œä¸­ä½¿ç”¨ NOT_SUPPORTEDã€‚
- TransactionDefinition.PROPAGATION_NEVERï¼šæ€»æ˜¯ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚é”™è¯¯ä½¿ç”¨åœºæ™¯ï¼šåœ¨åº”è¯¥åœ¨äº‹åŠ¡ç¯å¢ƒä¸‹æ‰§è¡Œçš„æ“ä½œä¸­ä½¿ç”¨ NEVERã€‚

#### 3ã€@Transactional æ³¨è§£å±æ€§ rollbackFor è®¾ç½®é”™è¯¯

rollbackFor ç”¨æ¥æŒ‡å®šèƒ½å¤Ÿè§¦å‘äº‹åŠ¡å›æ»šçš„å¼‚å¸¸ç±»å‹ã€‚Spring é»˜è®¤æŠ›å‡ºæœªæ£€æŸ¥ unchecked å¼‚å¸¸ï¼ˆç»§æ‰¿è‡ª RuntimeException çš„å¼‚å¸¸ï¼‰æˆ–è€… Error æ‰å›æ»šäº‹åŠ¡ï¼Œå…¶ä»–å¼‚å¸¸ä¸ä¼šè§¦å‘å›æ»šäº‹åŠ¡ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringé»˜è®¤æ”¯æŒçš„å¼‚å¸¸å›æ»š](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-04053b02-3264-4d7f-b868-560a0333f08d.png)

```java
// å¸Œæœ›è‡ªå®šä¹‰çš„å¼‚å¸¸å¯ä»¥è¿›è¡Œå›æ»š
@Transactional(propagation= Propagation.REQUIRED,rollbackFor= MyException.class)
```

è‹¥åœ¨ç›®æ ‡æ–¹æ³•ä¸­æŠ›å‡ºçš„å¼‚å¸¸æ˜¯ rollbackFor æŒ‡å®šçš„å¼‚å¸¸çš„å­ç±»ï¼Œäº‹åŠ¡åŒæ ·ä¼šå›æ»šã€‚

#### 4ã€åŒä¸€ä¸ªç±»ä¸­æ–¹æ³•è°ƒç”¨ï¼Œå¯¼è‡´@Transactional å¤±æ•ˆ

å¼€å‘ä¸­é¿å…ä¸äº†ä¼šå¯¹åŒä¸€ä¸ªç±»é‡Œé¢çš„æ–¹æ³•è°ƒç”¨ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªç±» Testï¼Œå®ƒçš„ä¸€ä¸ªæ–¹æ³• Aï¼ŒA è°ƒç”¨æœ¬ç±»çš„æ–¹æ³• Bï¼ˆä¸è®ºæ–¹æ³• B æ˜¯ç”¨ public è¿˜æ˜¯ private ä¿®é¥°ï¼‰ï¼Œä½†æ–¹æ³• A æ²¡æœ‰å£°æ˜æ³¨è§£äº‹åŠ¡ï¼Œè€Œ B æ–¹æ³•æœ‰ã€‚

åˆ™å¤–éƒ¨è°ƒç”¨æ–¹æ³• A ä¹‹åï¼Œæ–¹æ³• B çš„äº‹åŠ¡æ˜¯ä¸ä¼šèµ·ä½œç”¨çš„ã€‚è¿™ä¹Ÿæ˜¯ç»å¸¸çŠ¯é”™è¯¯çš„ä¸€ä¸ªåœ°æ–¹ã€‚

é‚£ä¸ºå•¥ä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿå…¶å®è¿˜æ˜¯ç”± Spring AOP ä»£ç†é€ æˆçš„ï¼Œå› ä¸ºåªæœ‰äº‹åŠ¡æ–¹æ³•è¢«å½“å‰ç±»ä»¥å¤–çš„ä»£ç è°ƒç”¨æ—¶ï¼Œæ‰ä¼šç”± Spring ç”Ÿæˆçš„ä»£ç†å¯¹è±¡æ¥ç®¡ç†ã€‚

```java
 //@Transactional
@GetMapping("/test")
private Integer A() throws Exception {
    CityInfoDict cityInfoDict = new CityInfoDict();
    cityInfoDict.setCityName("2");
    /**
     * B æ’å…¥å­—æ®µä¸º 3çš„æ•°æ®
     */
    this.insertB();
    /**
     * A æ’å…¥å­—æ®µä¸º 2çš„æ•°æ®
     */
    int insert = cityInfoDictMapper.insert(cityInfoDict);
    return insert;
}

@Transactional()
public Integer insertB() throws Exception {
    CityInfoDict cityInfoDict = new CityInfoDict();
    cityInfoDict.setCityName("3");
    cityInfoDict.setParentCityId(3);

    return cityInfoDictMapper.insert(cityInfoDict);
}
```

è¿™ç§æƒ…å†µæ˜¯æœ€å¸¸è§çš„ä¸€ç§@Transactional æ³¨è§£å¤±æ•ˆåœºæ™¯ã€‚

```java
@Transactional
private Integer A() throws Exception {
    int insert = 0;
    try {
        CityInfoDict cityInfoDict = new CityInfoDict();
        cityInfoDict.setCityName("2");
        cityInfoDict.setParentCityId(2);
        /**
         * A æ’å…¥å­—æ®µä¸º 2çš„æ•°æ®
         */
        insert = cityInfoDictMapper.insert(cityInfoDict);
        /**
         * B æ’å…¥å­—æ®µä¸º 3çš„æ•°æ®
        */
        b.insertB();
    } catch (Exception e) {
        e.printStackTrace();
    }
}
```

å¦‚æœ B æ–¹æ³•å†…éƒ¨æŠ›äº†å¼‚å¸¸ï¼Œè€Œ A æ–¹æ³•æ­¤æ—¶ try catch äº† B æ–¹æ³•çš„å¼‚å¸¸ï¼Œé‚£è¿™ä¸ªäº‹åŠ¡å°±ä¸èƒ½æ­£å¸¸å›æ»šäº†ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼š

```java
org.springframework.transaction.UnexpectedRollbackException: Transaction rolled back because it has been marked as rollback-only
```

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°ç±³æ˜¥æ‹›åŒå­¦ K ä¸€é¢é¢è¯•åŸé¢˜ï¼šäº‹åŠ¡ä¼ æ’­ï¼Œprotected å’Œ private åŠ äº‹åŠ¡ä¼šç”Ÿæ•ˆå—,è¿˜æœ‰é‚£äº›ä¸ç”Ÿæ•ˆçš„æƒ…å†µ

GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹](https://javabetter.cn/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## MVC

### 28.Spring MVC çš„æ ¸å¿ƒç»„ä»¶ï¼Ÿ

1.  **DispatcherServlet**ï¼šå‰ç½®æ§åˆ¶å™¨ï¼Œæ˜¯æ•´ä¸ªæµç¨‹æ§åˆ¶çš„**æ ¸å¿ƒ**ï¼Œæ§åˆ¶å…¶ä»–ç»„ä»¶çš„æ‰§è¡Œï¼Œè¿›è¡Œç»Ÿä¸€è°ƒåº¦ï¼Œé™ä½ç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§ï¼Œç›¸å½“äºæ€»æŒ‡æŒ¥ã€‚
2.  **Handler**ï¼šå¤„ç†å™¨ï¼Œå®Œæˆå…·ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼Œç›¸å½“äº Servlet æˆ– Actionã€‚
3.  **HandlerMapping**ï¼šDispatcherServlet æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œé€šè¿‡ HandlerMapping å°†ä¸åŒçš„è¯·æ±‚æ˜ å°„åˆ°ä¸åŒçš„ Handlerã€‚
4.  **HandlerInterceptor**ï¼šå¤„ç†å™¨æ‹¦æˆªå™¨ï¼Œæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¦‚æœéœ€è¦å®Œæˆä¸€äº›æ‹¦æˆªå¤„ç†ï¼Œå¯ä»¥å®ç°è¯¥æ¥å£ã€‚
5.  **HandlerExecutionChain**ï¼šå¤„ç†å™¨æ‰§è¡Œé“¾ï¼ŒåŒ…æ‹¬ä¸¤éƒ¨åˆ†å†…å®¹ï¼šHandler å’Œ HandlerInterceptorï¼ˆç³»ç»Ÿä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„ HandlerInterceptorï¼Œå¦‚æœéœ€è¦é¢å¤–è®¾ç½®æ‹¦æˆªï¼Œå¯ä»¥æ·»åŠ æ‹¦æˆªå™¨ï¼‰ã€‚
6.  **HandlerAdapter**ï¼šå¤„ç†å™¨é€‚é…å™¨ï¼ŒHandler æ‰§è¡Œä¸šåŠ¡æ–¹æ³•ä¹‹å‰ï¼Œéœ€è¦è¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œï¼ŒåŒ…æ‹¬è¡¨å•æ•°æ®çš„éªŒè¯ã€æ•°æ®ç±»å‹çš„è½¬æ¢ã€å°†è¡¨å•æ•°æ®å°è£…åˆ° JavaBean ç­‰ï¼Œè¿™äº›æ“ä½œéƒ½æ˜¯ç”± HandlerApater æ¥å®Œæˆï¼Œå¼€å‘è€…åªéœ€å°†æ³¨æ„åŠ›é›†ä¸­ä¸šåŠ¡é€»è¾‘çš„å¤„ç†ä¸Šï¼ŒDispatcherServlet é€šè¿‡ HandlerAdapter æ‰§è¡Œä¸åŒçš„ Handlerã€‚
7.  **ModelAndView**ï¼šè£…è½½äº†æ¨¡å‹æ•°æ®å’Œè§†å›¾ä¿¡æ¯ï¼Œä½œä¸º Handler çš„å¤„ç†ç»“æœï¼Œè¿”å›ç»™ DispatcherServletã€‚
8.  **ViewResolver**ï¼šè§†å›¾è§£æå™¨ï¼ŒDispatcheServlet é€šè¿‡å®ƒå°†é€»è¾‘è§†å›¾è§£æä¸ºç‰©ç†è§†å›¾ï¼Œæœ€ç»ˆå°†æ¸²æŸ“ç»“æœå“åº”ç»™å®¢æˆ·ç«¯ã€‚

### 29.Spring MVC çš„å·¥ä½œæµç¨‹ï¼Ÿ

Spring MVC æ˜¯åŸºäºæ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨çš„ Web æ¡†æ¶ï¼Œå®ƒçš„å·¥ä½œæµç¨‹ä¹Ÿä¸»è¦æ˜¯å›´ç»•ç€ Modelã€Viewã€Controller è¿™ä¸‰ä¸ªç»„ä»¶å±•å¼€çš„ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring MVCçš„å·¥ä½œæµç¨‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-e29a122b-db07-48b8-8289-7251032e87a1.png)

![å›¾ç‰‡æ¥æºäºç½‘ç»œï¼šSpringMVCå·¥ä½œæµç¨‹å›¾](https://cdn.tobebetterjavaer.com/stutymore/spring-20240506102456.png)

![_æœªæ¥å¯æœŸï¼šSpringMVCå·¥ä½œæµç¨‹å›¾](https://cdn.tobebetterjavaer.com/stutymore/spring-20240506103022.png)

â‘ ã€**å‘èµ·è¯·æ±‚**ï¼šå®¢æˆ·ç«¯é€šè¿‡ HTTP åè®®å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ã€‚

â‘¡ã€**å‰ç«¯æ§åˆ¶å™¨**ï¼šè¿™ä¸ªè¯·æ±‚ä¼šå…ˆåˆ°å‰ç«¯æ§åˆ¶å™¨ DispatcherServletï¼Œå®ƒæ˜¯æ•´ä¸ªæµç¨‹çš„å…¥å£ç‚¹ï¼Œè´Ÿè´£æ¥æ”¶è¯·æ±‚å¹¶å°†å…¶åˆ†å‘ç»™ç›¸åº”çš„å¤„ç†å™¨ã€‚

â‘¢ã€**å¤„ç†å™¨æ˜ å°„**ï¼šDispatcherServlet è°ƒç”¨ HandlerMapping æ¥ç¡®å®šå“ªä¸ª Controller åº”è¯¥å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚é€šå¸¸ä¼šæ ¹æ®è¯·æ±‚çš„ URL æ¥ç¡®å®šã€‚

â‘£ã€**å¤„ç†å™¨é€‚é…å™¨**ï¼šä¸€æ—¦æ‰¾åˆ°ç›®æ ‡ Controllerï¼ŒDispatcherServlet ä¼šä½¿ç”¨ HandlerAdapter æ¥è°ƒç”¨ Controller çš„å¤„ç†æ–¹æ³•ã€‚

â‘¤ã€**æ‰§è¡Œå¤„ç†å™¨**ï¼šController å¤„ç†è¯·æ±‚ï¼Œå¤„ç†å®Œåè¿”å›ä¸€ä¸ª ModelAndView å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«æ¨¡å‹æ•°æ®å’Œé€»è¾‘è§†å›¾åã€‚

â‘¥ã€**è§†å›¾è§£æå™¨**ï¼šDispatcherServlet æ¥æ”¶åˆ° ModelAndView åï¼Œä¼šä½¿ç”¨ ViewResolver æ¥è§£æè§†å›¾åç§°ï¼Œæ‰¾åˆ°å…·ä½“çš„è§†å›¾é¡µé¢ã€‚

â‘¦ã€**æ¸²æŸ“è§†å›¾**ï¼šè§†å›¾ä½¿ç”¨æ¨¡å‹æ•°æ®æ¸²æŸ“é¡µé¢ï¼Œç”Ÿæˆæœ€ç»ˆçš„é¡µé¢å†…å®¹ã€‚

â‘§ã€**å“åº”ç»“æœ**ï¼šDispatcherServlet å°†è§†å›¾ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚

**Spring MVC** è™½ç„¶æ•´ä½“æµç¨‹å¤æ‚ï¼Œä½†æ˜¯å®é™…å¼€å‘ä¸­å¾ˆç®€å•ï¼Œå¤§éƒ¨åˆ†çš„ç»„ä»¶ä¸éœ€è¦æˆ‘ä»¬å¼€å‘äººå‘˜åˆ›å»ºå’Œç®¡ç†ï¼ŒçœŸæ­£éœ€è¦å¤„ç†çš„åªæœ‰ **Controller** ã€**View** ã€**Model**ã€‚

åœ¨å‰åç«¯åˆ†ç¦»çš„æƒ…å†µä¸‹ï¼Œæ­¥éª¤ â‘¥ã€â‘¦ã€â‘§ ä¼šç•¥æœ‰ä¸åŒï¼Œåç«¯é€šå¸¸åªéœ€è¦å¤„ç†æ•°æ®ï¼Œå¹¶å°† JSON æ ¼å¼çš„æ•°æ®è¿”å›ç»™å‰ç«¯å°±å¯ä»¥äº†ï¼Œè€Œä¸æ˜¯è¿”å›å®Œæ•´çš„è§†å›¾é¡µé¢ã€‚

#### è¿™ä¸ª Handler æ˜¯ä»€ä¹ˆä¸œè¥¿å•Šï¼Ÿä¸ºä»€ä¹ˆè¿˜éœ€è¦ HandlerAdapter

Handler ä¸€èˆ¬å°±æ˜¯æŒ‡ Controllerï¼ŒController æ˜¯ Spring MVC çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£å¤„ç†è¯·æ±‚ï¼Œè¿”å›å“åº”ã€‚

Spring MVC å…è®¸ä½¿ç”¨å¤šç§ç±»å‹çš„å¤„ç†å™¨ã€‚ä¸ä»…ä»…æ˜¯æ ‡å‡†çš„`@Controller`æ³¨è§£çš„ç±»ï¼Œè¿˜å¯ä»¥æ˜¯å®ç°äº†ç‰¹å®šæ¥å£çš„å…¶ä»–ç±»ï¼ˆå¦‚ HttpRequestHandler æˆ– SimpleControllerHandlerAdapter ç­‰ï¼‰ã€‚è¿™äº›å¤„ç†å™¨å¯èƒ½æœ‰ä¸åŒçš„æ–¹æ³•ç­¾åå’Œäº¤äº’æ–¹å¼ã€‚

HandlerAdapter çš„ä¸»è¦èŒè´£å°±æ˜¯è°ƒç”¨ Handler çš„æ–¹æ³•æ¥å¤„ç†è¯·æ±‚ï¼Œå¹¶ä¸”é€‚é…ä¸åŒç±»å‹çš„å¤„ç†å™¨ã€‚HandlerAdapter ç¡®ä¿ DispatcherServlet å¯ä»¥ä»¥ç»Ÿä¸€çš„æ–¹å¼è°ƒç”¨ä¸åŒç±»å‹çš„å¤„ç†å™¨ï¼Œæ— éœ€å…³å¿ƒå…·ä½“çš„æ‰§è¡Œç»†èŠ‚ã€‚

> 1.  [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„è…¾è®¯ Java åç«¯å®ä¹ ä¸€é¢åŸé¢˜ï¼šè¯´è¯´å‰ç«¯å‘èµ·è¯·æ±‚åˆ° SpringMVC çš„æ•´ä¸ªå¤„ç†æµç¨‹ã€‚
> 2.  [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å›½ä¼é¢è¯•åŸé¢˜ï¼šè¯´è¯´ SpringMVC çš„æµç¨‹å§
> 3.  [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å°å…¬å¸é¢ç»åŒå­¦ 5 Java åç«¯é¢è¯•åŸé¢˜ï¼šspringMVC å·¥ä½œæµç¨‹ æˆ‘å¤§æ¦‚å°±æ˜¯æŒ‰é¢æ¸£é€†è¢­é‡Œç­”çš„ï¼Œç­”åˆ°ä¸€åŠæ‰“æ–­æˆ‘ï¼šç„¶åä¼šæœ‰ä¸ª Handlerï¼Œè¿™ä¸ª Handler æ˜¯ä»€ä¹ˆä¸œè¥¿å•Šã€‚å‰é¢ Handler ä¸æ˜¯å·²ç»çŸ¥é“ controller äº†å—ï¼Œæˆ‘ç›´æ¥æ‰§è¡Œä¸å°±è¡Œäº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ Adapter å‘¢ã€‚

### 30.SpringMVC Restful é£æ ¼çš„æ¥å£çš„æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ

PS:è¿™æ˜¯ä¸€é“å…¨æ–°çš„å…«è‚¡ï¼Œæ¯•ç«Ÿ ModelAndView è¿™ç§æ–¹å¼åº”è¯¥æ²¡äººç”¨äº†å§ï¼Ÿç°åœ¨éƒ½æ˜¯å‰åç«¯åˆ†ç¦»æ¥å£ï¼Œå…«è‚¡ä¹Ÿè¯¥æ›´æ–°æ¢ä»£äº†ã€‚

æˆ‘ä»¬éƒ½çŸ¥é“ Restful æ¥å£ï¼Œå“åº”æ ¼å¼æ˜¯ jsonï¼Œè¿™å°±ç”¨åˆ°äº†ä¸€ä¸ªå¸¸ç”¨æ³¨è§£ï¼š**@ResponseBody**

```java
    @GetMapping("/user")
    @ResponseBody
    public User user(){
        return new User(1,"å¼ ä¸‰");
    }
```

åŠ å…¥äº†è¿™ä¸ªæ³¨è§£åï¼Œæ•´ä½“çš„æµç¨‹ä¸Šå’Œä½¿ç”¨ ModelAndView å¤§ä½“ä¸Šç›¸åŒï¼Œä½†æ˜¯ç»†èŠ‚ä¸Šæœ‰ä¸€äº›ä¸åŒï¼š

![Spring MVC Restfulè¯·æ±‚å“åº”ç¤ºæ„å›¾](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-2da963a0-5da9-4b3a-aafd-fd8dbc7e1807.png)

1. å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šå…ˆåˆ°å‰ç«¯æ§åˆ¶å™¨ DispatcherServlet

2. DispatcherServlet æ¥æ”¶åˆ°è¯·æ±‚åä¼šè°ƒç”¨ HandlerMapping å¤„ç†å™¨æ˜ å°„å™¨ã€‚ç”±æ­¤å¾—çŸ¥ï¼Œè¯¥è¯·æ±‚è¯¥ç”±å“ªä¸ª Controller æ¥å¤„ç†

3. DispatcherServlet è°ƒç”¨ HandlerAdapter å¤„ç†å™¨é€‚é…å™¨ï¼Œå‘Šè¯‰å¤„ç†å™¨é€‚é…å™¨åº”è¯¥è¦å»æ‰§è¡Œå“ªä¸ª Controller

4. Controller è¢«å°è£…æˆäº† ServletInvocableHandlerMethodï¼ŒHandlerAdapter å¤„ç†å™¨é€‚é…å™¨å»æ‰§è¡Œ invokeAndHandle æ–¹æ³•ï¼Œå®Œæˆå¯¹ Controller çš„è¯·æ±‚å¤„ç†

5. HandlerAdapter æ‰§è¡Œå®Œå¯¹ Controller çš„è¯·æ±‚ï¼Œä¼šè°ƒç”¨ HandlerMethodReturnValueHandler å»å¤„ç†è¿”å›å€¼ï¼Œä¸»è¦çš„è¿‡ç¨‹ï¼š

   5.1. è°ƒç”¨ RequestResponseBodyMethodProcessorï¼Œåˆ›å»º ServletServerHttpResponseï¼ˆSpring å¯¹åŸç”Ÿ ServerHttpResponse çš„å°è£…ï¼‰å®ä¾‹

   5.2.ä½¿ç”¨ HttpMessageConverter çš„ write æ–¹æ³•ï¼Œå°†è¿”å›å€¼å†™å…¥ ServletServerHttpResponse çš„ OutputStream è¾“å‡ºæµä¸­

   5.3.åœ¨å†™å…¥çš„è¿‡ç¨‹ä¸­ï¼Œä¼šä½¿ç”¨ JsonGeneratorï¼ˆé»˜è®¤ä½¿ç”¨ Jackson æ¡†æ¶ï¼‰å¯¹è¿”å›å€¼è¿›è¡Œ Json åºåˆ—åŒ–

6. æ‰§è¡Œå®Œè¯·æ±‚åï¼Œè¿”å›çš„ ModealAndView ä¸º nullï¼ŒServletServerHttpResponse é‡Œä¹Ÿå·²ç»å†™å…¥äº†å“åº”ï¼Œæ‰€ä»¥ä¸ç”¨å…³å¿ƒ View çš„å¤„ç†

GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹](https://javabetter.cn/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## Spring Boot

### 31.ä»‹ç»ä¸€ä¸‹ SpringBootï¼Œæœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ

Spring Boot æ˜¯ä¸€ä¸ªå¼€æºçš„ã€ç”¨äºç®€åŒ– Spring åº”ç”¨åˆå§‹åŒ–å’Œå¼€å‘è¿‡ç¨‹çš„æ¡†æ¶ã€‚æä¾›äº†ä¸€å¥—é»˜è®¤é…ç½®ï¼Œçº¦å®šä¼˜äºé…ç½®ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæ­å»º Spring é¡¹ç›®éª¨æ¶ï¼Œæå¤§åœ°æé«˜äº†æˆ‘ä»¬çš„ç”Ÿäº§æ•ˆç‡ï¼Œå†ä¹Ÿä¸ç”¨ä¸º Spring çš„ç¹çé…ç½®è€Œçƒ¦æ¼äº†ã€‚

ä»¥å‰çš„ Spring å¼€å‘éœ€è¦é…ç½®å¤§é‡çš„ xml æ–‡ä»¶ï¼Œå¹¶ä¸”éœ€è¦å¼•å…¥å¤§é‡çš„ç¬¬ä¸‰æ–¹ jar åŒ…ï¼Œè¿˜éœ€è¦æ‰‹åŠ¨æ”¾åˆ° classpath ä¸‹ã€‚

![SpringBootå›¾æ ‡](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-d9164ee6-5c86-4313-8fd9-efb9acfa5f0b.png)

Spring Boot çš„ä¼˜ç‚¹éå¸¸å¤šï¼Œæ¯”å¦‚è¯´ï¼š

1. é€šè¿‡ Intellij IDEA æˆ–è€…å®˜æ–¹çš„ Spring Initializr å°±å¯ä»¥å¿«é€Ÿåˆ›å»ºæ–°é¡¹ç›®ï¼Œåªéœ€è¦é€‰æ‹©éœ€è¦çš„ä¾èµ–å°±å¯ä»¥äº”åˆ†é’Ÿå†…æ­å»ºä¸€ä¸ªé¡¹ç›®éª¨æ¶ã€‚
2. Spring Boot å†…åµŒäº† Tomcatã€Jettyã€Undertow ç­‰å®¹å™¨ï¼Œä¸éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½² WAR åŒ…äº†ï¼Œç›´æ¥è¿è¡Œ jar åŒ…å°±å¯ä»¥å¯åŠ¨é¡¹ç›®ï¼Œè¶…çº§æ–¹ä¾¿ã€‚
3. Spring Boot æ— éœ€å†åƒä»¥å‰ä¸€æ ·åœ¨ web.xmlã€applicationContext.xml ç­‰é…ç½®æ–‡ä»¶é‡Œé…ç½®å¤§é‡çš„å†…å®¹ï¼Œå¤§éƒ¨åˆ†åˆå§‹å·¥ä½œ Spring Boot éƒ½å¸®æˆ‘ä»¬åšå¥½äº†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé¡¹ç›®ä¸­æ·»åŠ äº† spring-boot-starter-webï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½® Tomcat å’Œ Spring MVCã€‚
4. Spring Boot å…è®¸æˆ‘ä»¬é€šè¿‡ yaml æ¥ç®¡ç†åº”ç”¨çš„é…ç½®ï¼Œæ¯”ä¼ ç»Ÿçš„ properties æ–‡ä»¶æ›´åŠ ç®€æ´ã€‚
5. Spring Boot æä¾›äº†ä¸€ç³»åˆ—çš„ Starterï¼Œå¯ä»¥å¿«é€Ÿé›†æˆå¸¸ç”¨çš„æ¡†æ¶ï¼Œä¾‹å¦‚ Spring Data JPAã€Spring Securityã€MyBatis ç­‰ã€‚
6. Spring Boot æä¾›äº†ä¸€ç³»åˆ—çš„ Actuatorï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç›‘æ§å’Œç®¡ç†åº”ç”¨ï¼Œæ¯”å¦‚å¥åº·æ£€æŸ¥ã€å®¡è®¡ã€ç»Ÿè®¡ç­‰ã€‚
7. é…åˆ Spring Cloud å¯ä»¥å¿«é€Ÿæ„å»ºå¾®æœåŠ¡æ¶æ„ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„åä¸º OD é¢ç»ä¸­å‡ºç°è¿‡è¯¥é¢˜ï¼šè®²è®² Spring Boot çš„ç‰¹æ€§ã€‚
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç™¾åº¦é¢ç»åŒå­¦ 1 æ–‡å¿ƒä¸€è¨€ 25 å®ä¹  Java åç«¯é¢è¯•åŸé¢˜ï¼šSpringBootåŸºæœ¬åŸç†
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å›½ä¼é›¶ç¢é¢ç»åŒå­¦ 9 é¢è¯•åŸé¢˜ï¼šSpringbootåŸºäºSpringçš„é…ç½®æœ‰å“ªå‡ ç§



### 32.SpringBoot è‡ªåŠ¨é…ç½®åŸç†äº†è§£å—ï¼Ÿ

åœ¨ Spring ä¸­ï¼Œè‡ªåŠ¨è£…é…æ˜¯æŒ‡å®¹å™¨åˆ©ç”¨åå°„æŠ€æœ¯ï¼Œæ ¹æ® Bean çš„ç±»å‹ã€åç§°ç­‰è‡ªåŠ¨æ³¨å…¥æ‰€éœ€çš„ä¾èµ–ã€‚

åœ¨ Spring Boot ä¸­ï¼Œå¼€å¯è‡ªåŠ¨è£…é…çš„æ³¨è§£æ˜¯`@EnableAutoConfiguration`ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://cdn.tobebetterjavaer.com/stutymore/spring-20240316121711.png)

Spring Boot ä¸ºäº†è¿›ä¸€æ­¥ç®€åŒ–ï¼Œç›´æ¥é€šè¿‡ `@SpringBootApplication` æ³¨è§£ä¸€æ­¥æå®šï¼Œè¿™ä¸ªæ³¨è§£åŒ…å«äº† `@EnableAutoConfiguration` æ³¨è§£ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://cdn.tobebetterjavaer.com/stutymore/spring-20240316121651.png)

â‘ ã€`@EnableAutoConfiguration` åªæ˜¯ä¸€ä¸ªç®€å•çš„æ³¨è§£ï¼Œä½†æ˜¯å®ƒçš„èƒŒåå´æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„è‡ªåŠ¨è£…é…æœºåˆ¶ï¼Œæ ¸å¿ƒæ˜¯`AutoConfigurationImportSelector` ç±»ã€‚

```java
@AutoConfigurationPackage //å°†mainåŒçº§çš„åŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶æ³¨å†Œåˆ°å®¹å™¨ä¸­
@Import({AutoConfigurationImportSelector.class}) //åŠ è½½è‡ªåŠ¨è£…é…ç±» xxxAutoconfiguration
public @interface EnableAutoConfiguration {
    String ENABLED_OVERRIDE_PROPERTY = "spring.boot.enableautoconfiguration";

    Class<?>[] exclude() default {};

    String[] excludeName() default {};
}
```

â‘¡ã€`AutoConfigurationImportSelector`å®ç°äº†`ImportSelector`æ¥å£ï¼Œè¿™ä¸ªæ¥å£çš„ä½œç”¨å°±æ˜¯æ”¶é›†éœ€è¦å¯¼å…¥çš„é…ç½®ç±»ï¼Œé…åˆ`@Import()`å°±å°†ç›¸åº”çš„ç±»å¯¼å…¥åˆ° Spring å®¹å™¨ä¸­ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://cdn.tobebetterjavaer.com/stutymore/spring-20240316122134.png)

â‘¢ã€è·å–æ³¨å…¥ç±»çš„æ–¹æ³•æ˜¯ `selectImports()`ï¼Œå®ƒå®é™…è°ƒç”¨çš„æ˜¯`getAutoConfigurationEntry()`ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯è·å–è‡ªåŠ¨è£…é…ç±»çš„å…³é”®ã€‚

```java
protected AutoConfigurationEntry getAutoConfigurationEntry(AnnotationMetadata annotationMetadata) {
    // æ£€æŸ¥è‡ªåŠ¨é…ç½®æ˜¯å¦å¯ç”¨ã€‚å¦‚æœ@ConditionalOnClassç­‰æ¡ä»¶æ³¨è§£ä½¿å¾—è‡ªåŠ¨é…ç½®ä¸é€‚ç”¨äºå½“å‰ç¯å¢ƒï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºçš„é…ç½®æ¡ç›®ã€‚
    if (!isEnabled(annotationMetadata)) {
        return EMPTY_ENTRY;
    }

    // è·å–å¯åŠ¨ç±»ä¸Šçš„@EnableAutoConfigurationæ³¨è§£çš„å±æ€§ï¼Œè¿™å¯èƒ½åŒ…æ‹¬å¯¹ç‰¹å®šè‡ªåŠ¨é…ç½®ç±»çš„æ’é™¤ã€‚
    AnnotationAttributes attributes = getAttributes(annotationMetadata);

    // ä»spring.factoriesä¸­è·å–æ‰€æœ‰å€™é€‰çš„è‡ªåŠ¨é…ç½®ç±»ã€‚è¿™æ˜¯é€šè¿‡åŠ è½½META-INF/spring.factoriesæ–‡ä»¶ä¸­å¯¹åº”çš„æ¡ç›®æ¥å®ç°çš„ã€‚
    List<String> configurations = getCandidateConfigurations(annotationMetadata, attributes);

    // ç§»é™¤é…ç½®åˆ—è¡¨ä¸­çš„é‡å¤é¡¹ï¼Œç¡®ä¿æ¯ä¸ªè‡ªåŠ¨é…ç½®ç±»åªè¢«è€ƒè™‘ä¸€æ¬¡ã€‚
    configurations = removeDuplicates(configurations);

    // æ ¹æ®æ³¨è§£å±æ€§è§£æå‡ºéœ€è¦æ’é™¤çš„è‡ªåŠ¨é…ç½®ç±»ã€‚
    Set<String> exclusions = getExclusions(annotationMetadata, attributes);

    // æ£€æŸ¥æ’é™¤çš„ç±»æ˜¯å¦å­˜åœ¨äºå€™é€‰é…ç½®ä¸­ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚
    checkExcludedClasses(configurations, exclusions);

    // ä»å€™é€‰é…ç½®ä¸­ç§»é™¤æ’é™¤çš„ç±»ã€‚
    configurations.removeAll(exclusions);

    // åº”ç”¨è¿‡æ»¤å™¨è¿›ä¸€æ­¥ç­›é€‰è‡ªåŠ¨é…ç½®ç±»ã€‚è¿‡æ»¤å™¨å¯èƒ½åŸºäºæ¡ä»¶æ³¨è§£å¦‚@ConditionalOnBeanç­‰æ¥æ’é™¤ç‰¹å®šçš„é…ç½®ç±»ã€‚
    configurations = getConfigurationClassFilter().filter(configurations);

    // è§¦å‘è‡ªåŠ¨é…ç½®å¯¼å…¥äº‹ä»¶ï¼Œå…è®¸ç›‘å¬å™¨å¯¹è‡ªåŠ¨é…ç½®è¿‡ç¨‹è¿›è¡Œå¹²é¢„ã€‚
    fireAutoConfigurationImportEvents(configurations, exclusions);

    // åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªåŒ…å«æœ€ç»ˆç¡®å®šçš„è‡ªåŠ¨é…ç½®ç±»å’Œæ’é™¤çš„é…ç½®ç±»çš„AutoConfigurationEntryå¯¹è±¡ã€‚
    return new AutoConfigurationEntry(configurations, exclusions);
}
```

Spring Boot çš„è‡ªåŠ¨è£…é…åŸç†ä¾èµ–äº Spring æ¡†æ¶çš„ä¾èµ–æ³¨å…¥å’Œæ¡ä»¶æ³¨å†Œï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼ŒSpring Boot èƒ½å¤Ÿæ™ºèƒ½åœ°é…ç½® beanï¼Œå¹¶ä¸”åªæœ‰å½“è¿™äº› bean å®é™…éœ€è¦æ—¶æ‰ä¼šè¢«åˆ›å»ºå’Œé…ç½®ã€‚

![ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringBootè‡ªåŠ¨é…ç½®åŸç†](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-df77ee15-2ff0-4ec7-8e65-e4ebb8ba88f1.png)

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„æ»´æ»´åŒå­¦ 2 æŠ€æœ¯äºŒé¢çš„åŸé¢˜ï¼šSpringBoot å¯åŠ¨æ—¶ä¸ºä»€ä¹ˆèƒ½å¤Ÿè‡ªåŠ¨è£…é…
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 22 æš‘æœŸå®ä¹ ä¸€é¢é¢è¯•åŸé¢˜ï¼šSpring Boot å¦‚ä½•åšåˆ°å¯åŠ¨çš„æ—¶å€™æ³¨å…¥ä¸€äº› bean
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„æ¯”äºšè¿ªé¢ç»åŒå­¦ 3 Java æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šè¯´ä¸€ä¸‹ Spring Boot çš„è‡ªåŠ¨è£…é…åŸç†
> 4. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å†œä¸šé“¶è¡ŒåŒå­¦ 1 é¢è¯•åŸé¢˜ï¼šspring boot çš„è‡ªåŠ¨è£…é…
> 5. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„ç™¾åº¦é¢ç»åŒå­¦ 1 æ–‡å¿ƒä¸€è¨€ 25 å®ä¹  Java åç«¯é¢è¯•åŸé¢˜ï¼šSpringBootå¦‚ä½•å®ç°è‡ªåŠ¨è£…é…

### 33.å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ª SpringBoot Srarter?

åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ Spring Boot Starterï¼Œéœ€è¦è¿™å‡ æ­¥ï¼š

ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ Maven é¡¹ç›®ï¼Œä¾‹å¦‚å‘½åä¸º my-spring-boot-starterã€‚åœ¨ pom.xml æ–‡ä»¶ä¸­æ·»åŠ å¿…è¦çš„ä¾èµ–å’Œé…ç½®ï¼š

```xml
<properties>
    <spring.boot.version>2.3.1.RELEASE</spring.boot.version>
</properties>

<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-autoconfigure</artifactId>
        <version>${spring.boot.version}</version>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter</artifactId>
        <version>${spring.boot.version}</version>
    </dependency>
</dependencies>
```

ç¬¬äºŒæ­¥ï¼Œåœ¨ `src/main/java` ä¸‹åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»ï¼Œæ¯”å¦‚ MyServiceAutoConfiguration.javaï¼šï¼ˆé€šå¸¸æ˜¯ autoconfigure åŒ…ä¸‹ï¼‰ã€‚

```java
@Configuration
@EnableConfigurationProperties(MyStarterProperties.class)
public class MyServiceAutoConfiguration {

    @Bean
    @ConditionalOnMissingBean
    public MyService myService(MyStarterProperties properties) {
        return new MyService(properties.getMessage());
    }
}
```

ç¬¬ä¸‰æ­¥ï¼Œåˆ›å»ºä¸€ä¸ªé…ç½®å±æ€§ç±» MyStarterProperties.javaï¼š

```java
@ConfigurationProperties(prefix = "mystarter")
public class MyStarterProperties {
    private String message = "äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ä¸é”™å•Š!";

    public String getMessage() {
        return message;
    }

    public void setMessage(String message) {
        this.message = message;
    }
}
```

ç¬¬å››æ­¥ï¼Œåˆ›å»ºä¸€ä¸ªç®€å•çš„æœåŠ¡ç±» MyService.javaï¼š

```java
public class MyService {
    private final String message;

    public MyService(String message) {
        this.message = message;
    }

    public String getMessage() {
        return message;
    }
}
```

ç¬¬äº”æ­¥ï¼Œé…ç½® spring.factoriesï¼Œåœ¨ `src/main/resources/META-INF` ç›®å½•ä¸‹åˆ›å»º spring.factories æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ï¼š

```
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
com.itwanger.mystarter.autoconfigure.MyServiceAutoConfiguration
```

ç¬¬å…­æ­¥ï¼Œä½¿ç”¨ Maven æ‰“åŒ…è¿™ä¸ªé¡¹ç›®ï¼š

```shell
mvn clean install
```

ç¬¬ä¸ƒæ­¥ï¼Œåœ¨å…¶ä»–çš„ Spring Boot é¡¹ç›®ä¸­ï¼Œé€šè¿‡ Maven æ¥æ·»åŠ è¿™ä¸ªè‡ªå®šä¹‰çš„ Starter ä¾èµ–ï¼Œå¹¶é€šè¿‡ application.properties é…ç½®æ¬¢è¿æ¶ˆæ¯ï¼š

```xml
mystarter.message=javabetter.cn
```

ç„¶åå°±å¯ä»¥åœ¨ Spring Boot é¡¹ç›®ä¸­æ³¨å…¥ MyStarterProperties æ¥ä½¿ç”¨å®ƒã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/spring-20240409114642.png)

å¯åŠ¨é¡¹ç›®ï¼Œç„¶ååœ¨æµè§ˆå™¨ä¸­è¾“å…¥ `localhost:8081/hello`ï¼Œå°±å¯ä»¥çœ‹åˆ°æ¬¢è¿æ¶ˆæ¯äº†ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://cdn.tobebetterjavaer.com/stutymore/spring-20240409114610.png)

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å­—èŠ‚è·³åŠ¨é¢ç»åŒå­¦ 1 Java åç«¯æŠ€æœ¯ä¸€é¢é¢è¯•åŸé¢˜ï¼šä½ å°è£…è¿‡ springboot starter å—

### 34.Spring Boot å¯åŠ¨åŸç†äº†è§£å—ï¼Ÿ

SpringBoot é¡¹ç›®å¯åŠ¨çš„å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š

![SpringBoot å¯åŠ¨å¤§è‡´æµç¨‹-å›¾ç‰‡æ¥æºç½‘ç»œ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-68744556-a1ba-4e1f-a092-1582875f0da6.png)

Spring Boot åº”ç”¨é€šå¸¸æœ‰ä¸€ä¸ªå¸¦æœ‰ main æ–¹æ³•çš„ä¸»ç±»ï¼Œè¿™ä¸ªç±»ä¸Šæ ‡æ³¨äº† `@SpringBootApplication` æ³¨è§£ï¼Œå®ƒæ˜¯æ•´ä¸ªåº”ç”¨å¯åŠ¨çš„å…¥å£ã€‚è¿™ä¸ªæ³¨è§£ç»„åˆäº† `@SpringBootConfiguration`ã€`@EnableAutoConfiguration` å’Œ `@ComponentScan`ï¼Œè¿™äº›æ³¨è§£å…±åŒæ”¯æŒé…ç½®å’Œç±»è·¯å¾„æ‰«æã€‚

å½“æ‰§è¡Œ main æ–¹æ³•æ—¶ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª SpringApplication çš„å®ä¾‹ã€‚è¿™ä¸ªå®ä¾‹è´Ÿè´£ç®¡ç† Spring åº”ç”¨çš„å¯åŠ¨å’Œåˆå§‹åŒ–ã€‚

![æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®](https://cdn.tobebetterjavaer.com/stutymore/spring-20240422090338.png)

`SpringApplication.run()` æ–¹æ³•è´Ÿè´£å‡†å¤‡å’Œå¯åŠ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆApplicationContextï¼‰ç¯å¢ƒï¼ŒåŒ…æ‹¬ï¼š

- æ‰«æé…ç½®æ–‡ä»¶ï¼Œæ·»åŠ ä¾èµ–é¡¹
- åˆå§‹åŒ–å’ŒåŠ è½½ Bean å®šä¹‰
- å¯åŠ¨å†…åµŒçš„ Web æœåŠ¡å™¨

#### äº†è§£@SpringBootApplication æ³¨è§£å—ï¼Ÿ

`@SpringBootApplication`æ˜¯ Spring Boot çš„æ ¸å¿ƒæ³¨è§£ï¼Œç»å¸¸ç”¨äºä¸»ç±»ä¸Šï¼Œä½œä¸ºé¡¹ç›®å¯åŠ¨å…¥å£çš„æ ‡è¯†ã€‚å®ƒæ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼š

- `@SpringBootConfiguration`ï¼šç»§æ‰¿è‡ª `@Configuration`ï¼Œæ ‡æ³¨è¯¥ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œç›¸å½“äºä¸€ä¸ª Spring é…ç½®æ–‡ä»¶ã€‚
- `@EnableAutoConfiguration`ï¼šå‘Šè¯‰ Spring Boot æ ¹æ® pom.xml ä¸­æ·»åŠ çš„ä¾èµ–è‡ªåŠ¨é…ç½®é¡¹ç›®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ spring-boot-starter-web ä¾èµ–è¢«æ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½® Tomcat å’Œ Spring MVCã€‚
- `@ComponentScan`ï¼šæ‰«æå½“å‰åŒ…åŠå…¶å­åŒ…ä¸‹è¢«`@Component`ã€`@Service`ã€`@Controller`ã€`@Repository` æ³¨è§£æ ‡è®°çš„ç±»ï¼Œå¹¶æ³¨å†Œä¸º Spring Beanã€‚

```java
@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

#### ä¸ºä»€ä¹ˆ Spring Boot åœ¨å¯åŠ¨çš„æ—¶å€™èƒ½å¤Ÿæ‰¾åˆ° main æ–¹æ³•ä¸Šçš„@SpringBootApplication æ³¨è§£ï¼Ÿ

Spring Boot åœ¨å¯åŠ¨æ—¶èƒ½å¤Ÿæ‰¾åˆ°ä¸»ç±»ä¸Šçš„`@SpringBootApplication`æ³¨è§£ï¼Œæ˜¯å› ä¸ºå®ƒåˆ©ç”¨äº† Java çš„åå°„æœºåˆ¶å’Œç±»åŠ è½½æœºåˆ¶ï¼Œç»“åˆ Spring æ¡†æ¶å†…éƒ¨çš„ä¸€ç³»åˆ—å¤„ç†æµç¨‹ã€‚

å½“è¿è¡Œä¸€ä¸ª Spring Boot ç¨‹åºæ—¶ï¼Œé€šå¸¸ä¼šè°ƒç”¨ä¸»ç±»ä¸­çš„`main`æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæ‰§è¡Œ`SpringApplication.run()`ï¼Œæ¯”å¦‚ï¼š

```java
@SpringBootApplication
public class MyApplication {
    public static void main(String[] args) {
        SpringApplication.run(MyApplication.class, args);
    }
}
```

`SpringApplication.run(Class<?> primarySource, String... args)`æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªæ˜¯ä¸»åº”ç”¨ç±»ï¼ˆå³åŒ…å«`main`æ–¹æ³•çš„ç±»ï¼‰ï¼Œç¬¬äºŒä¸ªæ˜¯å‘½ä»¤è¡Œå‚æ•°ã€‚`primarySource`å‚æ•°æä¾›äº†ä¸€ä¸ªèµ·ç‚¹ï¼ŒSpring Boot é€šè¿‡å®ƒæ¥åŠ è½½åº”ç”¨ä¸Šä¸‹æ–‡ã€‚

Spring Boot åˆ©ç”¨ Java åå°„æœºåˆ¶æ¥è¯»å–ä¼ é€’ç»™`run`æ–¹æ³•çš„ç±»ï¼ˆ`MyApplication.class`ï¼‰ã€‚å®ƒä¼šæ£€æŸ¥è¿™ä¸ªç±»ä¸Šçš„æ³¨è§£ï¼ŒåŒ…æ‹¬`@SpringBootApplication`ã€‚

#### Spring Boot é»˜è®¤çš„åŒ…æ‰«æè·¯å¾„æ˜¯ä»€ä¹ˆï¼Ÿ

Spring Boot çš„é»˜è®¤åŒ…æ‰«æè·¯å¾„æ˜¯ä»¥å¯åŠ¨ç±» `@SpringBootApplication` æ³¨è§£æ‰€åœ¨çš„åŒ…ä¸ºæ ¹ç›®å½•çš„ï¼Œå³é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Boot ä¼šæ‰«æå¯åŠ¨ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶ã€‚

æ¯”å¦‚è¯´åœ¨[æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®](https://javabetter.cn/zhishixingqiu/paicoding.html)ä¸­ï¼Œå¯åŠ¨ç±»`QuickForumApplication`æ‰€åœ¨çš„åŒ…æ˜¯`com.github.paicoding.forum.web`ï¼Œé‚£ä¹ˆ Spring Boot é»˜è®¤ä¼šæ‰«æ`com.github.paicoding.forum.web`åŒ…åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶ã€‚

![æ²‰é»˜ç‹äºŒï¼šæŠ€æœ¯æ´¾é¡¹ç›®æˆªå›¾](https://cdn.tobebetterjavaer.com/stutymore/spring-20240327105552.png)

`@SpringBootApplication` æ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œå®ƒé‡Œé¢çš„`@ComponentScan`æ³¨è§£å¯ä»¥æŒ‡å®šè¦æ‰«æçš„åŒ…è·¯å¾„ï¼Œé»˜è®¤æ‰«æå¯åŠ¨ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶ã€‚

```java
@ComponentScan(excludeFilters = { @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),
		@Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) })
public @interface SpringBootApplication {
}
```

æ¯”å¦‚è¯´å¸¦æœ‰ `@Component`ã€`@Service`ã€`@Controller`ã€`@Repository` ç­‰æ³¨è§£çš„ç±»éƒ½ä¼šè¢« Spring Boot æ‰«æåˆ°ï¼Œå¹¶æ³¨å†Œåˆ° Spring å®¹å™¨ä¸­ã€‚

å¦‚æœéœ€è¦è‡ªå®šä¹‰åŒ…æ‰«æè·¯å¾„ï¼Œå¯ä»¥åœ¨`@SpringBootApplication`æ³¨è§£ä¸Šæ·»åŠ `@ComponentScan`æ³¨è§£ï¼ŒæŒ‡å®šè¦æ‰«æçš„åŒ…è·¯å¾„ã€‚

```java
@SpringBootApplication
@ComponentScan(basePackages = {"com.github.paicoding.forum"})
public class QuickForumApplication {
    public static void main(String[] args) {
        SpringApplication.run(QuickForumApplication.class, args);
    }
}
```

è¿™ç§æ–¹å¼ä¼šè¦†ç›–é»˜è®¤çš„åŒ…æ‰«æè·¯å¾„ï¼Œåªæ‰«æ`com.github.paicoding.forum`åŒ…åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„æ»´æ»´åŒå­¦ 2 æŠ€æœ¯äºŒé¢çš„åŸé¢˜ï¼šä¸ºä»€ä¹ˆ Spring Boot å¯åŠ¨æ—¶èƒ½æ‰¾åˆ° Main ç±»ä¸Šé¢çš„æ³¨è§£
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„è…¾è®¯é¢ç»åŒå­¦ 22 æš‘æœŸå®ä¹ ä¸€é¢é¢è¯•åŸé¢˜ï¼šSpring Boot é»˜è®¤çš„åŒ…æ‰«æè·¯å¾„ï¼Ÿ
> 3. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¾®ä¼—é“¶è¡ŒåŒå­¦ 1 Java åç«¯ä¸€é¢çš„åŸé¢˜ï¼š@SpringBootApplication æ³¨è§£äº†è§£å—ï¼Ÿ
> 4. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å›½ä¼é›¶ç¢é¢ç»åŒå­¦ 9 é¢è¯•åŸé¢˜ï¼šSpringbootçš„å·¥ä½œåŸç†ï¼Ÿ

### 36.SpringBoot å’Œ SpringMVC çš„åŒºåˆ«ï¼Ÿï¼ˆè¡¥å……ï¼‰

> 2024 å¹´ 04 æœˆ 04 æ—¥å¢è¡¥

Spring MVC æ˜¯åŸºäº Spring æ¡†æ¶çš„ä¸€ä¸ªæ¨¡å—ï¼Œæä¾›äº†ä¸€ç§ Model-View-Controllerï¼ˆæ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼‰çš„å¼€å‘æ¨¡å¼ã€‚

Spring Boot æ—¨åœ¨ç®€åŒ– Spring åº”ç”¨çš„é…ç½®å’Œéƒ¨ç½²è¿‡ç¨‹ï¼Œæä¾›äº†å¤§é‡çš„è‡ªåŠ¨é…ç½®é€‰é¡¹ï¼Œä»¥åŠè¿è¡Œæ—¶ç¯å¢ƒçš„å†…åµŒ Web æœåŠ¡å™¨ï¼Œè¿™æ ·å°±å¯ä»¥æ›´å¿«é€Ÿåœ°å¼€å‘ä¸€ä¸ª SpringMVC çš„ Web é¡¹ç›®ã€‚

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„æ»´æ»´åŒå­¦ 2 æŠ€æœ¯äºŒé¢çš„åŸé¢˜ï¼šSpringBoot å’Œ SpringMVC çš„åŒºåˆ«

## Spring Cloud

### 35.å¯¹ SpringCloud äº†è§£å¤šå°‘ï¼Ÿ

SpringCloud æ˜¯ Spring å®˜æ–¹æ¨å‡ºçš„å¾®æœåŠ¡æ²»ç†æ¡†æ¶ã€‚

![Spring Cloud Netfilxæ ¸å¿ƒç»„ä»¶-æ¥æºå‚è€ƒ[2]](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-92ab53d5-f303-4fc5-bd26-e62cefe374b3.png)

> **ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿ**

1.  2014 å¹´ **Martin Fowler** æå‡ºçš„ä¸€ç§æ–°çš„æ¶æ„å½¢å¼ã€‚å¾®æœåŠ¡æ¶æ„æ˜¯ä¸€ç§**æ¶æ„æ¨¡å¼**ï¼Œæå€¡å°†å•ä¸€åº”ç”¨ç¨‹åºåˆ’åˆ†æˆä¸€ç»„å°çš„æœåŠ¡ï¼ŒæœåŠ¡ä¹‹é—´ç›¸äº’åè°ƒï¼Œäº’ç›¸é…åˆï¼Œä¸ºç”¨æˆ·æä¾›æœ€ç»ˆä»·å€¼ã€‚æ¯ä¸ªæœåŠ¡è¿è¡Œåœ¨å…¶ç‹¬ç«‹çš„è¿›ç¨‹ä¸­ï¼ŒæœåŠ¡ä¸æœåŠ¡ä¹‹é—´é‡‡ç”¨è½»é‡çº§çš„é€šä¿¡æœºåˆ¶(å¦‚ HTTP æˆ– Dubbo)äº’ç›¸åä½œï¼Œæ¯ä¸ªæœåŠ¡éƒ½å›´ç»•ç€å…·ä½“çš„ä¸šåŠ¡è¿›è¡Œæ„å»ºï¼Œå¹¶ä¸”èƒ½å¤Ÿè¢«ç‹¬ç«‹çš„éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¦å¤–ï¼Œåº”å°½é‡é¿å…ç»Ÿä¸€çš„ï¼Œé›†ä¸­å¼çš„æœåŠ¡ç®¡ç†æœºåˆ¶ï¼Œå¯¹å…·ä½“çš„ä¸€ä¸ªæœåŠ¡è€Œè¨€ï¼Œåº”æ ¹æ®ä¸šåŠ¡ä¸Šä¸‹æ–‡ï¼Œé€‰æ‹©åˆé€‚çš„è¯­è¨€ã€å·¥å…·(å¦‚ Maven)å¯¹å…¶è¿›è¡Œæ„å»ºã€‚
2.  å¾®æœåŠ¡åŒ–çš„æ ¸å¿ƒå°±æ˜¯å°†ä¼ ç»Ÿçš„ä¸€ç«™å¼åº”ç”¨ï¼Œæ ¹æ®ä¸šåŠ¡æ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªçš„æœåŠ¡ï¼Œå½»åº•åœ°å»è€¦åˆï¼Œæ¯ä¸€ä¸ªå¾®æœåŠ¡æä¾›å•ä¸ªä¸šåŠ¡åŠŸèƒ½çš„æœåŠ¡ï¼Œä¸€ä¸ªæœåŠ¡åšä¸€ä»¶äº‹æƒ…ï¼Œä»æŠ€æœ¯è§’åº¦çœ‹å°±æ˜¯ä¸€ç§å°è€Œç‹¬ç«‹çš„å¤„ç†è¿‡ç¨‹ï¼Œç±»ä¼¼è¿›ç¨‹çš„æ¦‚å¿µï¼Œèƒ½å¤Ÿè‡ªè¡Œå•ç‹¬å¯åŠ¨æˆ–é”€æ¯ï¼Œæ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æ•°æ®åº“ã€‚

> **å¾®æœåŠ¡æ¶æ„ä¸»è¦è¦è§£å†³å“ªäº›é—®é¢˜ï¼Ÿ**

1.  æœåŠ¡å¾ˆå¤šï¼Œå®¢æˆ·ç«¯æ€ä¹ˆè®¿é—®ï¼Œå¦‚ä½•æä¾›å¯¹å¤–ç½‘å…³?
2.  è¿™ä¹ˆå¤šæœåŠ¡ï¼ŒæœåŠ¡ä¹‹é—´å¦‚ä½•é€šä¿¡? HTTP è¿˜æ˜¯ RPC?
3.  è¿™ä¹ˆå¤šæœåŠ¡ï¼Œå¦‚ä½•æ²»ç†? æœåŠ¡çš„æ³¨å†Œå’Œå‘ç°ã€‚
4.  æœåŠ¡æŒ‚äº†æ€ä¹ˆåŠï¼Ÿç†”æ–­æœºåˆ¶ã€‚

> **æœ‰å“ªäº›ä¸»æµå¾®æœåŠ¡æ¡†æ¶ï¼Ÿ**

1.  Spring Cloud Netflix
2.  Spring Cloud Alibaba
3.  SpringBoot + Dubbo + ZooKeeper

> **SpringCloud æœ‰å“ªäº›æ ¸å¿ƒç»„ä»¶ï¼Ÿ**

![SpringCloud](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-2b988a72-0739-4fed-b271-eaf12589444f.png)

## è¡¥å……

### 37.SpringTask äº†è§£å—ï¼Ÿ

SpringTask æ˜¯ Spring æ¡†æ¶æä¾›çš„ä¸€ä¸ªè½»é‡çº§çš„ä»»åŠ¡è°ƒåº¦æ¡†æ¶ï¼Œå®ƒå…è®¸æˆ‘ä»¬å¼€å‘è€…é€šè¿‡ç®€å•çš„æ³¨è§£æ¥é…ç½®å’Œç®¡ç†å®šæ—¶ä»»åŠ¡ã€‚

â‘ ã€`@Scheduled`ï¼šæœ€å¸¸ç”¨çš„æ³¨è§£ï¼Œç”¨äºæ ‡è®°æ–¹æ³•ä¸ºè®¡åˆ’ä»»åŠ¡çš„æ‰§è¡Œç‚¹ã€‚[æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®](https://javabetter.cn/zhishixingqiu/paicoding.html)ä¸­ï¼Œå°±ä½¿ç”¨è¯¥æ³¨è§£æ¥å®šæ—¶åˆ·æ–° sitemap.xmlï¼š

```java
@Scheduled(cron = "0 15 5 * * ?")
public void autoRefreshCache() {
    log.info("å¼€å§‹åˆ·æ–°sitemap.xmlçš„urlåœ°å€ï¼Œé¿å…å‡ºç°æ•°æ®ä¸ä¸€è‡´é—®é¢˜!");
    refreshSitemap();
    log.info("åˆ·æ–°å®Œæˆï¼");
}
```

`@Scheduled` æ³¨è§£æ”¯æŒå¤šç§è°ƒåº¦é€‰é¡¹ï¼Œå¦‚ fixedRateã€fixedDelay å’Œ cron è¡¨è¾¾å¼ã€‚

â‘¡ã€`@EnableScheduling`ï¼šç”¨äºå¼€å¯å®šæ—¶ä»»åŠ¡çš„æ”¯æŒã€‚

![æŠ€æœ¯æ´¾çš„å¯åŠ¨ç±»å°±æœ‰è¯¥æ³¨è§£çš„å½±å­](https://cdn.tobebetterjavaer.com/stutymore/spring-20240422094511.png)

#### ç”¨SpringTaskèµ„æºå ç”¨å¤ªé«˜ï¼Œæœ‰ä»€ä¹ˆå…¶ä»–çš„æ–¹å¼è§£å†³ï¼Ÿï¼ˆè¡¥å……ï¼‰

>2024å¹´05æœˆ27æ—¥æ–°å¢

**ç¬¬ä¸€ï¼Œä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—**ï¼Œå¦‚ RabbitMQã€Kafkaã€RocketMQ ç­‰ï¼Œå°†ä»»åŠ¡æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç„¶åç”±æ¶ˆè´¹è€…å¼‚æ­¥å¤„ç†è¿™äº›ä»»åŠ¡ã€‚

â‘ ã€åœ¨è®¢å•åˆ›å»ºæ—¶ï¼Œå°†è®¢å•è¶…æ—¶æ£€æŸ¥ä»»åŠ¡æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¹¶è®¾ç½®å»¶è¿Ÿæ—¶é—´ï¼ˆå³è®¢å•è¶…æ—¶æ—¶é—´ï¼‰ã€‚

```java
@Service
public class OrderService {
    @Autowired
    private RabbitTemplate rabbitTemplate;

    public void createOrder(Order order) {
        // åˆ›å»ºè®¢å•é€»è¾‘
        // ...
        
        // å‘é€å»¶è¿Ÿæ¶ˆæ¯
        rabbitTemplate.convertAndSend("orderExchange", "orderTimeoutQueue", order, message -> {
            message.getMessageProperties().setExpiration("600000"); // è®¾ç½®å»¶è¿Ÿæ—¶é—´ï¼ˆ10åˆ†é’Ÿï¼‰
            return message;
        });
    }
}
```

â‘¡ã€ä½¿ç”¨æ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹æ¶ˆæ¯ï¼Œå½“æ¶ˆè´¹åˆ°è¶…æ—¶ä»»åŠ¡æ—¶ï¼Œæ‰§è¡Œè®¢å•è¶…æ—¶å¤„ç†é€»è¾‘ã€‚

```java
@Service
public class OrderTimeoutConsumer {

    @RabbitListener(queues = "orderTimeoutQueue")
    public void handleOrderTimeout(Order order) {
        // å¤„ç†è®¢å•è¶…æ—¶é€»è¾‘
        // ...
    }
}
```

**ç¬¬äºŒï¼Œä½¿ç”¨æ•°æ®åº“è°ƒåº¦å™¨ï¼ˆå¦‚ Quartzï¼‰**ã€‚

â‘ ã€åˆ›å»ºä¸€ä¸ª Quartz ä»»åŠ¡ç±»ï¼Œå¤„ç†è®¢å•è¶…æ—¶é€»è¾‘ã€‚

```java
public class OrderTimeoutJob implements Job {
    @Override
    public void execute(JobExecutionContext context) throws JobExecutionException {
        // è·å–è®¢å•ä¿¡æ¯
        Order order = (Order) context.getJobDetail().getJobDataMap().get("order");

        // å¤„ç†è®¢å•è¶…æ—¶é€»è¾‘
        // ...
    }
}
```

â‘¡ã€åœ¨è®¢å•åˆ›å»ºæ—¶ï¼Œè°ƒåº¦ä¸€ä¸ª Quartz ä»»åŠ¡ï¼Œè®¾ç½®ä»»åŠ¡çš„è§¦å‘æ—¶é—´ä¸ºè®¢å•è¶…æ—¶æ—¶é—´ã€‚

```java
@Service
public class OrderService {
    @Autowired
    private Scheduler scheduler;

    public void createOrder(Order order) {
        // åˆ›å»ºè®¢å•é€»è¾‘
        // ...

        // è°ƒåº¦ Quartz ä»»åŠ¡
        JobDetail jobDetail = JobBuilder.newJob(OrderTimeoutJob.class)
                .usingJobData("order", order)
                .build();

        Trigger trigger = TriggerBuilder.newTrigger()
                .startAt(new Date(System.currentTimeMillis() + 600000)) // è®¾ç½®è§¦å‘æ—¶é—´ï¼ˆ10åˆ†é’Ÿåï¼‰
                .build();

        try {
            scheduler.scheduleJob(jobDetail, trigger);
        } catch (SchedulerException e) {
            e.printStackTrace();
        }
    }
}
```

> 1. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„å¾®ä¼—é“¶è¡ŒåŒå­¦ 1 Java åç«¯ä¸€é¢çš„åŸé¢˜ï¼šSpringTask äº†è§£å—ï¼Ÿ
> 2. [Java é¢è¯•æŒ‡å—ï¼ˆä»˜è´¹ï¼‰](https://javabetter.cn/zhishixingqiu/mianshi.html)æ”¶å½•çš„é˜¿é‡Œé¢ç»åŒå­¦ 1 é—²é±¼åç«¯ä¸€é¢çš„åŸé¢˜ï¼šè®¢å•è¶…æ—¶ï¼Œç”¨springtaskèµ„æºå ç”¨å¤ªé«˜ï¼Œæœ‰ä»€ä¹ˆå…¶ä»–çš„æ–¹å¼è§£å†³?

---

å›¾æ–‡è¯¦è§£ 37 é“ Spring é¢è¯•é«˜é¢‘é¢˜ï¼Œè¿™æ¬¡åŠæ‰“é¢è¯•å®˜ï¼Œæˆ‘è§‰å¾—ç¨³äº†ï¼ˆæ‰‹åŠ¨ dogï¼‰ã€‚æ•´ç†ï¼šæ²‰é»˜ç‹äºŒï¼Œæˆ³[è½¬è½½é“¾æ¥](https://mp.weixin.qq.com/s/EQge6DmgIqYITM3mAxkatg)ï¼Œä½œè€…ï¼šä¸‰åˆ†æ¶ï¼Œæˆ³[åŸæ–‡é“¾æ¥](https://mp.weixin.qq.com/s/Y17S85ntHm_MLTZMJdtjQQ)ã€‚

_æ²¡æœ‰ä»€ä¹ˆä½¿æˆ‘åœç•™â€”â€”é™¤äº†ç›®çš„ï¼Œçºµç„¶å²¸æ—æœ‰ç«ç‘°ã€æœ‰ç»¿è«ã€æœ‰å®é™çš„æ¸¯æ¹¾ï¼Œæˆ‘æ˜¯ä¸ç³»ä¹‹èˆŸ_ã€‚

**ç³»åˆ—å†…å®¹**ï¼š

- [é¢æ¸£é€†è¢­ Java SE ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/javase.html)
- [é¢æ¸£é€†è¢­ Java é›†åˆæ¡†æ¶ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/javathread.html)
- [é¢æ¸£é€†è¢­ Java å¹¶å‘ç¼–ç¨‹ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/collection.html)
- [é¢æ¸£é€†è¢­ JVM ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/jvm.html)
- [é¢æ¸£é€†è¢­ Spring ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/spring.html)
- [é¢æ¸£é€†è¢­ Redis ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/redis.html)
- [é¢æ¸£é€†è¢­ MyBatis ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/mybatis.html)
- [é¢æ¸£é€†è¢­ MySQL ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/mysql.html)
- [é¢æ¸£é€†è¢­æ“ä½œç³»ç»Ÿç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/os.html)
- [é¢æ¸£é€†è¢­è®¡ç®—æœºç½‘ç»œç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/network.html)
- [é¢æ¸£é€†è¢­ RocketMQ ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/rocketmq.html)
- [é¢æ¸£é€†è¢­åˆ†å¸ƒå¼ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/fenbushi.html)
- [é¢æ¸£é€†è¢­å¾®æœåŠ¡ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/weifuwu.html)
- [é¢æ¸£é€†è¢­è®¾è®¡æ¨¡å¼ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/shejimoshi.html)
- [é¢æ¸£é€†è¢­ Linux ç¯‡ ğŸ‘](https://javabetter.cn/sidebar/sanfene/linux.html)

---

GitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬ Java åŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVM ç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œ500+å¼ æ‰‹ç»˜å›¾ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 10000+ çš„ Java æ•™ç¨‹](https://javabetter.cn/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)
