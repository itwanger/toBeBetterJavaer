# äºŒå“¥ä¿®è®¢ç‰ˆã€Š30å¤©é€Ÿé€šJavaã€‹

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯äºŒå“¥å‘€ã€‚

GitHub ä¸Šæœ‰ä¸€ä¸ªå¾ˆçŸ¥åçš„å¼€æºçŸ¥è¯†åº“ã€Š[CS-Notes](https://github.com/CyC2018/CS-Notes)ã€‹ï¼Œç›®å‰å·²æœ‰ 173k çš„ star æ•°ï¼Œå…¶ä¸­æ”¶å½•äº†ä¸å°‘æˆ‘è®¤ä¸ºè›®ä¸é”™çš„å†…å®¹ï¼Œæ¯”å¦‚è¯´å¤§å®¶ç°åœ¨çœ‹åˆ°çš„ã€Š30å¤©é€Ÿé€šJavaã€‹â€”â€”è¯·åŸè°…æˆ‘èµ·äº†ä¸€ä¸ªå™±å¤´åè¶³çš„åå­—ğŸ˜ã€‚

ä¸€å…±äº”ä¸ªç« èŠ‚ï¼ŒåŸºç¡€ç¯‡ã€IO ç¯‡ã€å®¹å™¨ç¯‡ã€å¹¶å‘ç¯‡å’Œè™šæ‹Ÿæœºç¯‡ï¼Œæˆ‘ç»“åˆã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://javabetter.cn/)ã€‹å¯¹å†…å®¹åšä¸€äº›è¡¥å……å’Œä¼˜åŒ–ï¼Œå¹¶å¯¼å‡ºäº†äº®ç™½ç‰ˆå’Œæš—é»‘ç‰ˆçš„ PDF å’Œ epub ç‰ˆæœ¬ï¼Œå¥½æ–¹ä¾¿å¤§å®¶åœ¨ 30 å¤©å†…çœŸçš„é€Ÿé€š Javaï¼ˆå‡å°‘å¤§å®¶å­¦ä¹ çš„æˆæœ¬ï¼‰ã€‚

- ç”±äºæ—¶é—´ä»“ä¿ƒå’Œä¸ªäººèƒ½åŠ›æœ‰é™ï¼Œæ‰‹å†Œéš¾å…å­˜åœ¨é”™è¯¯å’Œç–æ¼ï¼Œè¿˜è¯·å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚å¾®ä¿¡ itwanger
- è¯¥æ‰‹å†Œä¼šæŒç»­æ›´æ–°ï¼Œå†æ¬¡æ„Ÿè°¢åŸä½œè€… CS-Notesï¼ŒåŸæ–‡æ¡£åœ°å€ï¼š[https://github.com/CyC2018/CS-Notes/](https://github.com/CyC2018/CS-Notes/blob/master/notes/Java%20%E5%9F%BA%E7%A1%80.md)
- æ¨èï¼š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šJava æœ€æ–°å­¦ä¹ è·¯çº¿](https://javabetter.cn/xuexiluxian/java/yitiaolong.html)

**æœ€æ–°ç‰ˆ PDF è·å–**

è®²ä¸ªä¸å¥½ç¬‘çš„ç¬‘è¯ï¼ŒPDF å†…å®¹æ²¡åŠæ³•è‡ªåŠ¨æ›´æ–°ï¼ˆğŸ˜‚ï¼‰ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡ä¸‹é¢çš„æ–¹å¼ï¼š

> å¾®ä¿¡æœç´¢ã€Š**æ²‰é»˜ç‹äºŒ**ã€‹æˆ–è€…å¾®ä¿¡æ‰«ä¸‹é¢çš„äºŒç»´ç ï¼Œå…³æ³¨åå›å¤ã€Š**java**ã€‹å³å¯è·å–æœ€æ–°çš„ PDF ç‰ˆæœ¬ï¼ˆæˆ‘ä¼šä¸å®šæœŸæ›´æ–°ï¼‰ã€‚

![æ‰‹æœºç«¯å¯ä»¥é•¿æŒ‰è¯†åˆ«](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

è·å–æ–¹å¼è§ä¸‹å›¾ï¼ˆæˆ‘ç”¨çš„ PC ç«¯å¾®ä¿¡æˆªå›¾ï¼Œæ‰‹æœºç«¯å·®ä¸å¤šï¼‰ï¼š

![æ— ä»»ä½•å¥—è·¯](https://cdn.tobebetterjavaer.com/stutymore/javase-20240605194117.png)

é™„å…¶ä»–å¹²è´§ç¬”è®°ä¸‹è½½åœ°å€ï¼š

- [äºŒå“¥çš„ Linux é€ŸæŸ¥å¤‡å¿˜æ‰‹å†Œ PDF ä¸‹è½½](https://javabetter.cn/pdf/linux.html)
- [é˜®ä¸€å³° C è¯­è¨€å…¥é—¨æ•™ç¨‹ PDF ä¸‹è½½](https://javabetter.cn/pdf/yuanyifeng-c-language.html)
- [Java æ ¸å¿ƒçŸ¥è¯†ç‚¹æ•´ç† PDF ä¸‹è½½](https://javabetter.cn/pdf/github-java-jiaocheng-115-star.html)
- [æ·±å…¥æµ…å‡º Java å¤šçº¿ç¨‹ PDF ä¸‹è½½](https://javabetter.cn/pdf/java-concurrent.html)
- [Pro Git ä¸­æ–‡ç‰ˆ PDF ä¸‹è½½](https://javabetter.cn/pdf/progit.html)
- [ç»™æ“ä½œç³»ç»Ÿæ‹æ¡çº¿ PDF ä¸‹è½½](https://javabetter.cn/pdf/os.html)

## ç¬¬ä¸€ç« ã€JavaåŸºç¡€ç¯‡

### ä¸€ã€æ•°æ®ç±»å‹

#### åŸºæœ¬ç±»å‹

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šæ•°æ®ç±»å‹](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-grammar/nine-01.png)

Java åŸºæœ¬æ•°æ®ç±»å‹çš„é»˜è®¤å€¼å’Œå ç”¨å¤§å°ï¼š

| æ•°æ®ç±»å‹ | é»˜è®¤å€¼   | å¤§å°   |
| -------- | -------- | ------ |
| boolean  | false    | 1 å­—èŠ‚æˆ– 4 å­—èŠ‚ |
| char     | '\u0000' | 2 å­—èŠ‚ |
| byte     | 0        | 1 å­—èŠ‚ |
| short    | 0        | 2 å­—èŠ‚ |
| int      | 0        | 4 å­—èŠ‚ |
| long     | 0L       | 8 å­—èŠ‚ |
| float    | 0.0f     | 4 å­—èŠ‚ |
| double   | 0.0      | 8 å­—èŠ‚ |

æ¨èé˜…è¯»ï¼š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šJava åŸºæœ¬æ•°æ®ç±»å‹](https://javabetter.cn/basic-grammar/basic-data-type.html)

#### åŒ…è£…ç±»å‹

åŸºæœ¬ç±»å‹éƒ½æœ‰å¯¹åº”çš„åŒ…è£…ç±»å‹ï¼ŒåŸºæœ¬ç±»å‹ä¸å…¶å¯¹åº”çš„åŒ…è£…ç±»å‹ä¹‹é—´çš„èµ‹å€¼ä½¿ç”¨è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±å®Œæˆã€‚

```java
Integer x = 2; // è£…ç®± è°ƒç”¨äº† Integer.valueOf(2)
int y = x; // æ‹†ç®± è°ƒç”¨äº† X.intValue()
```

æ¨èé˜…è¯»ï¼š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šæ‹†ç®±å’Œè£…ç®±](https://javabetter.cn/basic-extra-meal/box.html)

#### ç¼“å­˜æ± 

`new Integer(123)` ä¸ `Integer.valueOf(123)` çš„åŒºåˆ«åœ¨äºï¼š

- `new Integer(123)` æ¯æ¬¡éƒ½ä¼šæ–°å»ºä¸€ä¸ªå¯¹è±¡ï¼›
- `Integer.valueOf(123)` ä¼šä½¿ç”¨ç¼“å­˜æ± ä¸­åˆå§‹åŒ–å¥½çš„å¯¹è±¡ã€‚

```java
Integer x = new Integer(123);
Integer y = new Integer(123);
System.out.println(x == y); // false
Integer z = Integer.valueOf(123);
Integer k = Integer.valueOf(123);
System.out.println(z == k); // true
```

`valueOf()` æ–¹æ³•çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œå…ˆåˆ¤æ–­å€¼æ˜¯å¦åœ¨ç¼“å­˜æ± ä¸­ï¼Œå¦‚æœåœ¨çš„è¯å°±ç›´æ¥è¿”å›ç¼“å­˜æ± çš„å¯¹è±¡ã€‚

```java
public static Integer valueOf(int i) {
    if (i >= IntegerCache.low && i <= IntegerCache.high)
        return IntegerCache.cache[i + (-IntegerCache.low)];
    return new Integer(i);
}
```

åœ¨ Java 8 ä¸­ï¼ŒInteger ç¼“å­˜æ± çš„å¤§å°é»˜è®¤ä¸º -128\~127ã€‚

```java
static final int low = -128;
static final int high;
static final Integer cache[];

static {
    // high value may be configured by property
    int h = 127;
    String integerCacheHighPropValue =
        sun.misc.VM.getSavedProperty("java.lang.Integer.IntegerCache.high");
    if (integerCacheHighPropValue != null) {
        try {
            int i = parseInt(integerCacheHighPropValue);
            i = Math.max(i, 127);
            // Maximum array size is Integer.MAX_VALUE
            h = Math.min(i, Integer.MAX_VALUE - (-low) -1);
        } catch( NumberFormatException nfe) {
            // If the property cannot be parsed into an int, ignore it.
        }
    }
    high = h;

    cache = new Integer[(high - low) + 1];
    int j = low;
    for(int k = 0; k < cache.length; k++)
        cache[k] = new Integer(j++);

    // range [-128, 127] must be interned (JLS7 5.1.7)
    assert IntegerCache.high >= 127;
}
```

ç¼–è¯‘å™¨ä¼šåœ¨è‡ªåŠ¨è£…ç®±è¿‡ç¨‹è°ƒç”¨ `valueOf()` æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå€¼ç›¸åŒä¸”åœ¨ç¼“å­˜æ± å†…çš„ Integer å¯¹è±¡ä½¿ç”¨ == æ¥æ¯”è¾ƒçš„æ—¶å€™ä¼šè¿”å› trueã€‚

```java
Integer m = 123;
Integer n = 123;
System.out.println(m == n); // true
```

åŸºæœ¬ç±»å‹å¯¹åº”çš„ç¼“å†²æ± å¦‚ä¸‹ï¼š

- boolean values true and false
- all byte values
- short values between -128 and 127
- int values between -128 and 127
- char in the range \u0000 to \u007F

åœ¨ Java 8 çš„æ•°å€¼ç±»ç¼“å†²æ± ä¸­ï¼ŒInteger çš„ç¼“å†²æ±  IntegerCache å¾ˆç‰¹æ®Šï¼Œè¿™ä¸ªç¼“å†²æ± çš„ä¸‹ç•Œæ˜¯ - 128ï¼Œä¸Šç•Œé»˜è®¤æ˜¯ 127ï¼Œä½†æ˜¯ä¸Šç•Œæ˜¯å¯è°ƒçš„ã€‚

åœ¨å¯åŠ¨ jvm çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ -XX:AutoBoxCacheMax=&lt;size&gt; æ¥æŒ‡å®šç¼“å†²æ± çš„å¤§å°ï¼Œè¯¥é€‰é¡¹åœ¨ JVM åˆå§‹åŒ–çš„æ—¶å€™ä¼šè®¾å®šä¸€ä¸ªåä¸º java.lang.IntegerCache.high ç³»ç»Ÿå±æ€§ï¼Œç„¶å IntegerCache åˆå§‹åŒ–çš„æ—¶å€™å°±ä¼šè¯»å–è¯¥ç³»ç»Ÿå±æ€§æ¥å†³å®šä¸Šç•Œã€‚

![æ²‰é»˜ç‹äºŒï¼šIntegerCache.high](https://cdn.tobebetterjavaer.com/stutymore/JavaåŸºç¡€-20240602173130.png)


### äºŒã€String

#### æ¦‚è§ˆ

String è¢«å£°æ˜ä¸º finalï¼Œå› æ­¤å®ƒä¸èƒ½è¢«ç»§æ‰¿ã€‚åœ¨ Java 8 ä¸­ï¼ŒString å†…éƒ¨ä½¿ç”¨ char æ•°ç»„å­˜å‚¨æ•°æ®ã€‚

```java
public final class String
    implements java.io.Serializable, Comparable<String>, CharSequence {
    /** The value is used for character storage. */
    private final char value[];
}
```

ä½†åœ¨ Java 9 ä¹‹åï¼ŒString ç±»çš„å®ç°æ”¹ç”¨ byte æ•°ç»„æ¥å­˜å‚¨å­—ç¬¦ä¸²ï¼ŒåŒæ—¶ä½¿ç”¨ `coder` æ¥æ ‡è¯†ä½¿ç”¨äº†å“ªç§ç¼–ç ã€‚

```java
public final class String
    implements java.io.Serializable, Comparable<String>, CharSequence {
    /** The value is used for character storage. */
    private final byte[] value;

    /** The identifier of the encoding used to encode the bytes in {@code value}. */
    private final byte coder;
}
```

value æ•°ç»„è¢«å£°æ˜ä¸º finalï¼Œè¿™æ„å‘³ç€ value å˜é‡åœ¨æ•°ç»„åˆå§‹åŒ–ä¹‹åå°±ä¸èƒ½å†å¼•ç”¨å…¶å®ƒæ•°ç»„å¯¹è±¡äº†ã€‚å¹¶ä¸” String å†…éƒ¨æ²¡æœ‰æ”¹å˜ value æ•°ç»„çš„æ–¹æ³•ï¼Œå› æ­¤å¯ä»¥ä¿è¯ String ä¸å¯å˜ã€‚

æ¨èé˜…è¯»ï¼š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šStringç±»æºç ](https://javabetter.cn/string/string-source.html)

#### å­—ç¬¦ä¸²ä¸å¯å˜çš„å¥½å¤„

**1. å¯ä»¥ç”¨æ¥ä½œä¸º HashMap çš„ key**  

HashMap çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯æ•°ç»„ï¼Œå…¶é”®å€¼å¯¹åœ¨æ•°ç»„ä¸­çš„ä½ç½®æ˜¯é€šè¿‡ `(n - 1) & hash` è®¡ç®—å¾—åˆ°çš„ï¼Œn ä¹Ÿå°±æ˜¯æ•°ç»„çš„é•¿åº¦ï¼Œhash ä¹Ÿå°±æ˜¯é”®çš„å“ˆå¸Œå€¼ã€‚

![æ²‰é»˜ç‹äºŒï¼šå­—ç¬¦ä¸²çš„ä¸å¯å˜æ€§](https://cdn.tobebetterjavaer.com/stutymore/JavaåŸºç¡€-20240604072937.png)

å¦‚æœé”®æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆåœ¨è®¡ç®—é”®çš„å“ˆå¸Œå€¼æ—¶ï¼Œå“ˆå¸Œå€¼ä¹Ÿæ˜¯ä¸ç¡®å®šçš„ï¼Œäºæ˜¯å°±æ— æ³•å‡†ç¡®åœ°åœ¨æ•°ç»„ä¸­å®šä½åˆ°é”®å€¼å¯¹çš„ä½ç½®ã€‚

æ¨èé˜…è¯»ï¼š[HashMap çš„æºç è§£è¯»](https://javabetter.cn/collection/hashmap.html)

**2. å­—ç¬¦ä¸²å¸¸é‡æ± çš„éœ€è¦**  

å› ä¸ºå­—ç¬¦ä¸²çš„ä½¿ç”¨é¢‘ç‡éå¸¸é«˜ï¼Œæ‰€ä»¥ Java è®¾è®¡è€…å°±å†³å®šå°†å­—ç¬¦ä¸²å¸¸é‡æ”¾åˆ°ä¸€ä¸ªå…¬å…±çš„åœ°æ–¹ï¼Œè¿™ä¸ªåœ°æ–¹å«åšå­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString Poolï¼‰ã€‚

é€šè¿‡åŒå¼•å·åˆ›å»ºçš„å­—ç¬¦ä¸²ï¼ˆå¦‚ "æ²‰é»˜ç‹äºŒ"ï¼‰éƒ½ä¼šè¢«åŠ å…¥åˆ°å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘å­—ç¬¦ä¸²çš„åˆ›å»ºï¼ŒèŠ‚çº¦å†…å­˜ç©ºé—´ã€‚

![æ²‰é»˜ç‹äºŒï¼šå­—ç¬¦ä¸²å¸¸é‡æ± ](https://cdn.tobebetterjavaer.com/stutymore/JavaåŸºç¡€-20240604074510.png)

æ¨èé˜…è¯»ï¼š[æ·±å…¥ç†è§£Javaçš„å­—ç¬¦ä¸²å¸¸é‡æ± ](https://javabetter.cn/string/constant-pool.html)

**3. å®‰å…¨æ€§**  

String ç»å¸¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ï¼Œæ¯”å¦‚è¯´æ•°æ®åº“è¿æ¥ä¸­çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå¦‚æœ String æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆåœ¨ä¼ é€’çš„è¿‡ç¨‹ä¸­å°±ä¼šå­˜åœ¨å®‰å…¨éšæ‚£ã€‚

æ¨èé˜…è¯»ï¼š[ä¸ºä»€ä¹ˆ Java å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Ÿ](https://javabetter.cn/string/immutable.html)

#### String, StringBuffer å’Œ StringBuilder	

**1. å¯å˜æ€§**  

- String ä¸å¯å˜
- StringBuffer å’Œ StringBuilder å¯å˜

**2. çº¿ç¨‹å®‰å…¨**  

- String ä¸å¯å˜ï¼Œå› æ­¤æ˜¯çº¿ç¨‹å®‰å…¨çš„
- StringBuilder ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„
- StringBuffer æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå†…éƒ¨ä½¿ç”¨ synchronized è¿›è¡ŒåŒæ­¥

æ¨èé˜…è¯»ï¼š[èŠèŠ Java StringBuilderå’ŒStringBuffer ä¸¤å…„å¼Ÿ](https://javabetter.cn/string/builder-buffer.html)

#### å­—ç¬¦ä¸²å¸¸é‡æ± 

å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString Poolï¼‰ä¿å­˜äº†æ‰€æœ‰å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆliteral stringsï¼‰ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨åŒå¼•å· `""` åˆ›å»ºçš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚å½“ç„¶äº†ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ String çš„ `intern()` æ–¹æ³•å°†å­—ç¬¦ä¸²æ·»åŠ åˆ°å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ã€‚

å½“ä¸€ä¸ªå­—ç¬¦ä¸²è°ƒç”¨ `intern()` æ–¹æ³•æ—¶ï¼Œå¦‚æœ String Pool ä¸­å·²ç»å­˜åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²å’Œè¯¥å­—ç¬¦ä¸²å€¼ç›¸ç­‰ï¼ˆä½¿ç”¨ `equals()` æ–¹æ³•è¿›è¡Œç¡®å®šï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å› String Pool ä¸­å­—ç¬¦ä¸²çš„å¼•ç”¨ï¼›å¦åˆ™ï¼Œå°±ä¼šåœ¨ String Pool ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›è¿™ä¸ªæ–°å­—ç¬¦ä¸²çš„å¼•ç”¨ã€‚

ä¸‹é¢ç¤ºä¾‹ä¸­ï¼Œs1 å’Œ s2 é‡‡ç”¨ `new String()` çš„æ–¹å¼æ–°å»ºäº†ä¸¤ä¸ªä¸åŒå­—ç¬¦ä¸²ï¼Œè€Œ s3 å’Œ s4 æ˜¯é€šè¿‡ `s1.intern()` å’Œ `s2.intern()` æ–¹æ³•è·å–å­—ç¬¦ä¸²çš„å¼•ç”¨ã€‚

`intern()` ä¼šä»å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­è¿”å›è¿™ä¸ªå­—ç¬¦ä¸²å¼•ç”¨ï¼Œå› æ­¤ s3 å’Œ s4 å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªå­—ç¬¦ä¸²ã€‚

```java
String s1 = new String("aaa");
String s2 = new String("aaa");
System.out.println(s1 == s2);           // false
String s3 = s1.intern();
String s4 = s2.intern();
System.out.println(s3 == s4);           // true
```

å¦‚æœæ˜¯é‡‡ç”¨ "bbb" è¿™ç§å­—é¢é‡çš„å½¢å¼åˆ›å»ºå­—ç¬¦ä¸²ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åœ°å°†å­—ç¬¦ä¸²æ”¾å…¥ String Pool ä¸­ã€‚

```java
String s5 = "bbb";
String s6 = "bbb";
System.out.println(s5 == s6);  // true
```


- [å­—ç¬¦ä¸²å¸¸é‡æ± ](https://javabetter.cn/string/constant-pool.html)
- [è¯¦è§£ String.intern() æ–¹æ³•](https://javabetter.cn/string/intern.html)

#### new String("abc")

ä½¿ç”¨è¿™ç§æ–¹å¼ä¸€å…±ä¼šåˆ›å»ºä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼ˆå‰ææ˜¯ String Pool ä¸­è¿˜æ²¡æœ‰ "abc" å­—ç¬¦ä¸²å¯¹è±¡ï¼‰ã€‚

- "abc" å±äºå­—ç¬¦ä¸²å­—é¢é‡ï¼Œå› æ­¤ç¼–è¯‘æ—¶ä¼šåœ¨ String Pool ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼›
- ä½¿ç”¨ new ä¼šåœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œè¿™ä¸ªæ–°å¯¹è±¡åœ¨åˆ›å»ºçš„æ—¶å€™ï¼Œä¼šä½¿ç”¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ "abc" ä½œä¸ºæ„é€ æ–¹æ³•çš„å‚æ•°ã€‚

å¥½ï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±»ï¼Œmain æ–¹æ³•ä¸­ä½¿ç”¨è¿™ç§æ–¹å¼æ¥åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡ã€‚

```java
public class NewStringTest {
    public static void main(String[] args) {
        String s = new String("abc");
    }
}
```

ä½¿ç”¨ `javap -verbose` è¿›è¡Œåç¼–è¯‘ï¼Œå¾—åˆ°ä»¥ä¸‹å†…å®¹ï¼š

```java
// ...
Constant pool:
// ...
   #2 = Class              #18            // java/lang/String
   #3 = String             #19            // abc
// ...
  #18 = Utf8               java/lang/String
  #19 = Utf8               abc
// ...

  public static void main(java.lang.String[]);
    descriptor: ([Ljava/lang/String;)V
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      stack=3, locals=2, args_size=1
         0: new           #2                  // class java/lang/String
         3: dup
         4: ldc           #3                  // String abc
         6: invokespecial #4                  // Method java/lang/String."<init>":(Ljava/lang/String;)V
         9: astore_1
// ...
```

åœ¨ Constant Pool ä¸­ï¼Œ#19 å­˜å‚¨äº†å­—ç¬¦ä¸²å­—é¢é‡ "abc"ï¼Œ#3 æ˜¯ String Pool çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå®ƒæŒ‡å‘ #19 è¿™ä¸ªå­—ç¬¦ä¸²å­—é¢é‡ã€‚

åœ¨ main æ–¹æ³•ä¸­ï¼Œ0: è¡Œä½¿ç”¨ new #2 åœ¨å †ä¸­åˆ›å»ºäº†ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¹¶ä¸”ä½¿ç”¨ ldc #3 å°† String Pool ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡ä½œä¸º String æ„é€ æ–¹æ³•çš„å‚æ•°ã€‚

ä»¥ä¸‹æ˜¯ String æ„é€ æ–¹æ³•çš„æºç ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨å°†ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ä½œä¸ºå¦ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„æ„é€ æ–¹æ³•å‚æ•°æ—¶ï¼Œå¹¶ä¸ä¼šå¤åˆ¶ value æ•°ç»„çš„å†…å®¹ï¼Œè€Œæ˜¯æŒ‡å‘åŒä¸€ä¸ª value æ•°ç»„ã€‚

```java
public String(String original) {
    this.value = original.value;
    this.hash = original.hash;
}
```

> å¾®ä¿¡æœç´¢ã€Š**æ²‰é»˜ç‹äºŒ**ã€‹æˆ–è€…å¾®ä¿¡æ‰«ä¸‹é¢çš„äºŒç»´ç ï¼Œå…³æ³¨åå›å¤ã€Š**java**ã€‹å³å¯è·å–æœ€æ–°çš„ PDF ç‰ˆæœ¬ã€‚

![æ‰‹æœºç«¯å¯ä»¥é•¿æŒ‰è¯†åˆ«](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

### ä¸‰ã€è¿ç®—

#### å‚æ•°ä¼ é€’

Java çš„å‚æ•°æ˜¯ä»¥å€¼ä¼ é€’çš„å½¢å¼ä¼ å…¥æ–¹æ³•ä¸­çš„ï¼Œè€Œä¸æ˜¯å¼•ç”¨ä¼ é€’ã€‚

è¿™æ˜¯ä¸€ä¸ª Dog ç±»ï¼Œæœ‰ä¸€ä¸ªå­—æ®µ nameã€ä¸€ä¸ªæ„é€ æ–¹æ³•ã€ä¸€ä¸ª getName æ–¹æ³•å’Œä¸€ä¸ª setName æ–¹æ³•ï¼Œä»¥åŠä¸€ä¸ª getObjectAddress æ–¹æ³•ï¼Œç”¨æ¥è¿”å›å¯¹è±¡çš„åœ°å€ã€‚

```java
public class Dog {

    String name;

    Dog(String name) {
        this.name = name;
    }

    String getName() {
        return this.name;
    }

    void setName(String name) {
        this.name = name;
    }

    String getObjectAddress() {
        return super.toString();
    }
}
```

ç„¶åæˆ‘ä»¬åœ¨æµ‹è¯•ç±»çš„ main æ–¹æ³•ä¸­åˆ›å»ºä¸€ä¸ª Dog å¯¹è±¡ dogï¼Œå¹¶è°ƒç”¨ func æ–¹æ³•ï¼Œå°† dog å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚

```java
class PassByValueExample {
    public static void main(String[] args) {
        Dog dog = new Dog("A");
        func(dog);
        System.out.println(dog.getName());          // B
    }

    private static void func(Dog dog) {
        dog.setName("B");
    }
}
```

å¯ä»¥çœ‹åˆ°ï¼Œdog çš„ name å‘ç”Ÿäº†æ”¹å˜ï¼Œå› ä¸ºè°ƒç”¨ func æ–¹æ³•æ—¶ï¼Œä¼ å…¥çš„æ˜¯ dog å¯¹è±¡çš„å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¼ å…¥çš„æ˜¯å¯¹è±¡çš„åœ°å€ï¼Œæ‰€ä»¥åœ¨ func æ–¹æ³•ä¸­å¯¹å¯¹è±¡çš„å­—æ®µè¿›è¡Œä¿®æ”¹ï¼Œä¼šå½±å“åˆ°ä¼ å…¥ä¹‹å‰çš„å¯¹è±¡ã€‚

ä½†å¦‚æœåœ¨æ–¹æ³•ä¸­å°†å˜é‡å¼•ç”¨åˆ°å…¶å®ƒå¯¹è±¡ï¼Œé‚£ä¹ˆæ­¤æ—¶æ–¹æ³•é‡Œå’Œæ–¹æ³•å¤–çš„ä¸¤ä¸ªå¼•ç”¨å…¶å®æŒ‡å‘äº†ä¸åŒçš„å¯¹è±¡ï¼Œå› æ­¤ func æ–¹æ³•ä¸­çš„ `dog = new Dog("B")` å¹¶ä¸ä¼šå½±å“ main æ–¹æ³•ä¸­çš„ dog å¯¹è±¡ã€‚

```java
public class PassByValueExample {
    public static void main(String[] args) {
        Dog dog = new Dog("A");
        System.out.println(dog.getObjectAddress()); // Dog@4554617c
        func(dog);
        System.out.println(dog.getObjectAddress()); // Dog@4554617c
        System.out.println(dog.getName());          // A
    }

    private static void func(Dog dog) {
        System.out.println(dog.getObjectAddress()); // Dog@4554617c
        dog = new Dog("B");
        System.out.println(dog.getObjectAddress()); // Dog@74a14482
        System.out.println(dog.getName());          // B
    }
}
```

å› æ­¤ï¼Œåœ¨å°†ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ä¼ å…¥å¦å¤–ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œæœ¬è´¨ä¸Šæ˜¯å°†å¯¹è±¡çš„åœ°å€ä»¥å€¼çš„æ–¹å¼ä¼ é€’åˆ°å½¢å‚ä¸­ã€‚

æ¨èé˜…è¯»ï¼š[Java åˆ°åº•æ˜¯å€¼ä¼ é€’è¿˜æ˜¯å¼•ç”¨ä¼ é€’](https://javabetter.cn/basic-extra-meal/pass-by-value.html)

#### float ä¸ double

Java ä¸èƒ½éšå¼å‘ä¸‹è½¬å‹ï¼Œå› ä¸ºè¿™ä¼šä½¿ç²¾åº¦é™ä½ã€‚

`1.1` å­—é¢é‡å±äº double ç±»å‹ï¼Œä¸èƒ½ç›´æ¥å°† `1.1` èµ‹å€¼ç»™ float å˜é‡ï¼Œå› ä¸ºè¿™æ˜¯å‘ä¸‹è½¬å‹ã€‚

```java
// float f = 1.1;
```

1.1f å­—é¢é‡æ‰æ˜¯ float ç±»å‹ã€‚

```java
float f = 1.1f;
```

#### éšå¼ç±»å‹è½¬æ¢

å› ä¸ºå­—é¢é‡ 1 æ˜¯ int ç±»å‹ï¼Œå®ƒæ¯” short ç±»å‹ç²¾åº¦è¦é«˜ï¼Œå› æ­¤ä¸èƒ½éšå¼åœ°å°† int ç±»å‹å‘ä¸‹è½¬å‹ä¸º short ç±»å‹ã€‚

```java
short s1 = 1;
// s1 = s1 + 1;
```

ä½†æ˜¯ä½¿ç”¨ += æˆ–è€… ++ è¿ç®—ç¬¦ä¼šæ‰§è¡Œéšå¼ç±»å‹è½¬æ¢ã€‚

```java
s1 += 1;
s1++;
```

ä¸Šé¢çš„è¯­å¥ç›¸å½“äºå°† s1 + 1 çš„è®¡ç®—ç»“æœè¿›è¡Œäº†å‘ä¸‹è½¬å‹ï¼š

```java
s1 = (short) (s1 + 1);
```

æ¨èé˜…è¯»ï¼š[è‡ªåŠ¨ç±»å‹è½¬æ¢ä¸å¼ºåˆ¶ç±»å‹è½¬æ¢](https://javabetter.cn/basic-grammar/type-cast.html)

#### switch

ä» Java 7 å¼€å§‹ï¼Œå¯ä»¥åœ¨ switch æ¡ä»¶åˆ¤æ–­è¯­å¥ä¸­ä½¿ç”¨ String å¯¹è±¡ã€‚

```java
String s = "a";
switch (s) {
    case "a":
        System.out.println("aaa");
        break;
    case "b":
        System.out.println("bbb");
        break;
}
```

æ¨èé˜…è¯»ï¼š[switch è¯­å¥çš„ä»‹ç»](https://javabetter.cn/basic-grammar/flow-control.html#_02%E3%80%81switch-%E8%AF%AD%E5%8F%A5)

### å››ã€å…³é”®å­—

#### final

##### 1.å˜é‡

ä½¿ç”¨ final ä¿®é¥°çš„å˜é‡è¢«ç§°ä¸ºå¸¸é‡ï¼Œå¸¸é‡åœ¨å®šä¹‰æ—¶å¿…é¡»è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶ä¸”åˆå§‹åŒ–åå€¼ä¸å¯æ”¹å˜ã€‚

- å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹ï¼Œfinal ä¿®é¥°åçš„å˜é‡å€¼ä¸å¯æ”¹å˜ã€‚
- å¯¹äºå¼•ç”¨æ•°æ®ç±»å‹ï¼Œfinal ä¿®é¥°åçš„å¼•ç”¨ä¸å˜ï¼Œä¹Ÿå°±äº‹ä¸èƒ½å¼•ç”¨å…¶å®ƒå¯¹è±¡ï¼Œä½†æ˜¯è¢«å¼•ç”¨çš„å¯¹è±¡æœ¬èº«æ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚

```java
final int x = 1;
// x = 2;  // cannot assign value to final variable 'x'
final A y = new A();
y.a = 1;
```

##### 2.æ–¹æ³• 

final ä¿®é¥°çš„æ–¹æ³•ä¸èƒ½è¢«å­ç±»é‡å†™ã€‚

##### 3. ç±»

final ä¿®é¥°çš„ç±»ä¸å…è®¸è¢«ç»§æ‰¿ã€‚

æ¨èé˜…è¯»ï¼š[ä¸€æ–‡å½»åº•ææ‡‚ Java final å…³é”®å­—](https://javabetter.cn/oo/final.html)

#### static

##### 1.é™æ€å˜é‡ 

- é™æ€å˜é‡ï¼šåˆç§°ç±»å˜é‡ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ static å…³é”®å­—ä¿®é¥°çš„å˜é‡ï¼Œè¿™ä¸ªå˜é‡æ˜¯å±äºç±»çš„ï¼Œç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å…±äº«é™æ€å˜é‡ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ç±»åæ¥è®¿é—®é™æ€å˜é‡ã€‚é™æ€å˜é‡åœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä»½ã€‚
- å®ä¾‹å˜é‡ï¼šæˆ–è€…å«æˆå‘˜å˜é‡ï¼Œæ¯åˆ›å»ºä¸€ä¸ªå®ä¾‹å°±ä¼šäº§ç”Ÿä¸€ä¸ªå®ä¾‹å˜é‡ï¼Œå®ƒä¸è¯¥å®ä¾‹åŒç”Ÿå…±æ­»ã€‚

```java
public class A {

    private int x;         // å®ä¾‹å˜é‡
    private static int y;  // é™æ€å˜é‡

    public static void main(String[] args) {
        // int x = A.x;  // Non-static field 'x' cannot be referenced from a static context
        A a = new A();
        int x = a.x;
        int y = A.y;
    }
}
```

##### 2.é™æ€æ–¹æ³•

static ä¿®é¥°çš„æ–¹æ³•è¢«ç§°ä¸ºé™æ€æ–¹æ³•ï¼Œå®ƒåœ¨ç±»åŠ è½½çš„æ—¶å€™å°±å­˜åœ¨äº†ï¼Œå®ƒä¸ä¾èµ–äºä»»ä½•å®ä¾‹ã€‚

ä½† static ä¸èƒ½ç”¨æ¥ä¿®é¥°æŠ½è±¡æ–¹æ³•ï¼Œå› ä¸º abstract æ–¹æ³•éœ€è¦å­ç±»é‡å†™å¹¶æä¾›å…·ä½“å®ç°ï¼Œè€Œ static æ–¹æ³•æ˜¯é™æ€çš„ï¼Œæ— æ³•è¢«å­ç±»é‡å†™ï¼Œè¿™ä½¿å¾— static å’Œ abstract ä¿®é¥°ç¬¦æ˜¯å†²çªçš„ã€‚

```java
public abstract class A {
    public static void func1(){
    }
    // public abstract static void func2();  // Illegal combination of modifiers: 'abstract' and 'static'
}
```

é™æ€æ–¹æ³•åªèƒ½è®¿é—®æ‰€å±ç±»çš„é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•ï¼Œå¹¶ä¸”é™æ€æ–¹æ³•ä¸­ä¸èƒ½æœ‰ this å’Œ super å…³é”®å­—ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªå…³é”®å­—ä¸å…·ä½“çš„å¯¹è±¡å…³è”ã€‚

```java
public class A {

    private static int x;
    private int y;

    public static void func1(){
        int a = x;
        // int b = y;  // Non-static field 'y' cannot be referenced from a static context
        // int b = this.y;     // 'A.this' cannot be referenced from a static context
    }
}
```

##### 3.é™æ€ä»£ç å—

é™æ€ä»£ç å—åœ¨ç±»åˆå§‹åŒ–æ—¶è¿è¡Œä¸€æ¬¡ã€‚

```java
public class A {
    static {
        System.out.println("123");
    }

    public static void main(String[] args) {
        A a1 = new A();
        A a2 = new A();
    }
}
```

å¯ä»¥ç”¨ static ä»£ç å—æ¥åˆå§‹åŒ–ä¸€äº›é™æ€å˜é‡ï¼Œå®ƒä¼šä¼˜å…ˆäº main æ–¹æ³•æ‰§è¡Œã€‚

```
123
```

##### 4.é™æ€å†…éƒ¨ç±»

éé™æ€å†…éƒ¨ç±»ä¾èµ–äºå¤–éƒ¨ç±»çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦å…ˆåˆ›å»ºå¤–éƒ¨ç±»çš„å®ä¾‹ï¼Œæ‰èƒ½ç”¨è¿™ä¸ªå®ä¾‹å»åˆ›å»ºéé™æ€å†…éƒ¨ç±»ã€‚è€Œé™æ€å†…éƒ¨ç±»ä¸éœ€è¦ï¼Œå¯ä»¥ç›´æ¥å®ä¾‹åŒ–ã€‚

```java
public class OuterClass {

    class InnerClass {
    }

    static class StaticInnerClass {
    }

    public static void main(String[] args) {
        // InnerClass innerClass = new InnerClass(); // 'OuterClass.this' cannot be referenced from a static context
        OuterClass outerClass = new OuterClass();
        InnerClass innerClass = outerClass.new InnerClass();
        StaticInnerClass staticInnerClass = new StaticInnerClass();
    }
}
```

ä½†é™æ€å†…éƒ¨ç±»ä¸èƒ½è®¿é—®å¤–éƒ¨ç±»çš„éé™æ€å˜é‡å’Œæ–¹æ³•ã€‚

##### 5.é™æ€å¯¼åŒ…

åœ¨ä½¿ç”¨é™æ€å˜é‡å’Œé™æ€æ–¹æ³•æ—¶ä¸ç”¨å†æŒ‡æ˜ ClassNameï¼Œä»è€Œç®€åŒ–ä»£ç ï¼Œä½†å¯è¯»æ€§å¤§å¤§é™ä½ï¼Œä¸æ¨èã€‚

```java
import static com.xxx.ClassName.*
```

##### 6.ä»£ç çš„åˆå§‹åŒ–é¡ºåº

é™æ€å˜é‡å’Œé™æ€ä»£ç å—ä¼˜å…ˆäºå®ä¾‹å˜é‡å’Œæ™®é€šä»£ç å—ï¼Œè€Œé™æ€å˜é‡å’Œé™æ€ä»£ç å—çš„åˆå§‹åŒ–é¡ºåºå–å†³äºå®ƒä»¬åœ¨ä»£ç ä¸­çš„é¡ºåºã€‚

```java
public static String staticField = "é™æ€å˜é‡";

static {
    System.out.println("é™æ€è¯­å¥å—");
}

public String field = "å®ä¾‹å˜é‡";

{
    System.out.println("æ™®é€šè¯­å¥å—");
}
```

æœ€åæ‰æ˜¯æ„é€ æ–¹æ³•çš„åˆå§‹åŒ–ã€‚

```java
public InitialOrderTest() {
    System.out.println("æ„é€ æ–¹æ³•");
}
```

å­˜åœ¨ç»§æ‰¿çš„æƒ…å†µä¸‹ï¼Œåˆå§‹åŒ–é¡ºåºä¸ºï¼š

- çˆ¶ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰
- å­ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰
- çˆ¶ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰
- çˆ¶ç±»ï¼ˆæ„é€ æ–¹æ³•ï¼‰
- å­ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰
- å­ç±»ï¼ˆæ„é€ æ–¹æ³•ï¼‰

æ¨èé˜…è¯»ï¼š[è¯¦è§£ Java static å…³é”®å­—çš„ä½œç”¨](https://javabetter.cn/oo/static.html)

> å¾®ä¿¡æœç´¢ã€Š**æ²‰é»˜ç‹äºŒ**ã€‹æˆ–è€…å¾®ä¿¡æ‰«ä¸‹é¢çš„äºŒç»´ç ï¼Œå…³æ³¨åå›å¤ã€Š**java**ã€‹å³å¯è·å–æœ€æ–°çš„ PDF ç‰ˆæœ¬ã€‚

![æ‰‹æœºç«¯å¯ä»¥é•¿æŒ‰è¯†åˆ«](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

### äº”ã€Object é€šç”¨æ–¹æ³•

#### æ¦‚è§ˆ

ä¸‹é¢ğŸ‘‡ğŸ»è¿™äº›æ–¹æ³•éƒ½æŒºå¸¸ç”¨çš„ï¼Œå…ˆçœ‹ä¸ªå¤§æ¦‚ï¼Œç„¶åæˆ‘ä»¬æ¥æŒ‘ä¸€äº›ä½¿ç”¨é¢‘ç‡éå¸¸é«˜çš„æ–¹æ³•åšä¸€ä¸ªç³»ç»ŸåŒ–åœ°ä»‹ç»ã€‚

```java
public native int hashCode()

public boolean equals(Object obj)

protected native Object clone() throws CloneNotSupportedException

public String toString()

public final native Class<?> getClass()

protected void finalize() throws Throwable {}

public final native void notify()

public final native void notifyAll()

public final native void wait(long timeout) throws InterruptedException

public final void wait(long timeout, int nanos) throws InterruptedException

public final void wait() throws InterruptedException
```

#### equals()

##### 1. ç­‰ä»·å…³ç³»

ä¸¤ä¸ªå¯¹è±¡å…·æœ‰ç­‰ä»·å…³ç³»ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹ 4 ä¸ªæ¡ä»¶ï¼š

â‘ ã€å¯¹ç§°æ€§

```java
x.equals(y) == y.equals(x); // true
```

â‘¡ã€ä¼ é€’æ€§

```java
if (x.equals(y) && y.equals(z))
    x.equals(z); // true;
```

â‘¢ã€ä¸€è‡´æ€§

å¤šæ¬¡è°ƒç”¨ equals() æ–¹æ³•ç»“æœä¸å˜

```java
x.equals(y) == x.equals(y); // true
```

â‘£ã€ä¸ null çš„æ¯”è¾ƒ

å¯¹ä»»ä½•ä¸æ˜¯ null çš„å¯¹è±¡ x è°ƒç”¨ x.equals(null) ç»“æœéƒ½ä¸º false

```java
x.equals(null); // false;
```

##### 2. ç­‰ä»·ä¸ç›¸ç­‰

- å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ == åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ã€‚
- å¯¹äºå¼•ç”¨æ•°æ®ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ == åˆ¤æ–­ä¸¤ä¸ªå˜é‡æ˜¯å¦å¼•ç”¨äº†åŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œ `equals()` æ–¹æ³•ç”¨äºåˆ¤æ–­å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦ç­‰ä»·ã€‚

```java
Integer x = new Integer(1);
Integer y = new Integer(1);
System.out.println(x.equals(y)); // true
System.out.println(x == y);      // false
```

##### 3. å¦‚ä½•å®ç°equalsæ–¹æ³•

â‘ ã€æ£€æŸ¥æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œå¦‚æœæ˜¯ç›´æ¥è¿”å› trueï¼›

â‘¡ã€æ£€æŸ¥æ˜¯å¦æ˜¯åŒä¸€ç±»å‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œç›´æ¥è¿”å› falseï¼›

â‘¢ã€è½¬å‹ååˆ¤æ–­å…³é”®å­—æ®µæ˜¯å¦ç›¸ç­‰ã€‚

```java
public class EqualExample {

    private int x;
    private int y;
    private int z;

    public EqualExample(int x, int y, int z) {
        this.x = x;
        this.y = y;
        this.z = z;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;

        EqualExample that = (EqualExample) o;

        if (x != that.x) return false;
        if (y != that.y) return false;
        return z == that.z;
    }
}
```

#### hashCode()

`hashCode()` æ–¹æ³•ç”¨äºè¿”å›å¯¹è±¡çš„å“ˆå¸Œå€¼ï¼Œè€Œ `equals()` ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç­‰ä»·ã€‚ç­‰ä»·çš„ä¸¤ä¸ªå¯¹è±¡å“ˆå¸Œå€¼ä¸€å®šç›¸åŒï¼Œä½†æ˜¯å“ˆå¸Œå€¼ç›¸åŒçš„ä¸¤ä¸ªå¯¹è±¡ä¸ä¸€å®šç­‰ä»·ï¼Œå› ä¸ºå“ˆå¸Œå€¼çš„è®¡ç®—å…·æœ‰éšæœºæ€§ï¼Œä¸¤ä¸ªå€¼ä¸åŒçš„å¯¹è±¡å¯èƒ½è®¡ç®—å‡ºç›¸åŒçš„å“ˆå¸Œå€¼ã€‚

åœ¨é‡å†™ `equals()` æ–¹æ³•æ—¶åº”è¯¥é‡å†™ `hashCode()` æ–¹æ³•ï¼Œä¿è¯ç­‰ä»·çš„ä¸¤ä¸ªå¯¹è±¡å“ˆå¸Œå€¼ä¹Ÿç›¸ç­‰ã€‚

HashSet å’Œ HashMap ç­‰é›†åˆç±»ä½¿ç”¨äº† `hashCode()` æ–¹æ³•æ¥è®¡ç®—å¯¹è±¡åº”è¯¥å­˜å‚¨çš„ä½ç½®ï¼ˆåº•å±‚æ•°æ®ç»“æ„ä¸ºæ•°ç»„ï¼‰ï¼Œå› æ­¤è¦å°†å¯¹è±¡æ·»åŠ åˆ°è¿™äº›é›†åˆç±»ä¸­ï¼Œéœ€è¦è®©å¯¹åº”çš„ç±»å®ç° `hashCode()` æ–¹æ³•ã€‚

ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæ–°å»ºäº†ä¸¤ä¸ªç­‰ä»·çš„å¯¹è±¡ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ° HashSet ä¸­ã€‚æˆ‘ä»¬å¸Œæœ›å°†è¿™ä¸¤ä¸ªå¯¹è±¡å½“æˆä¸€æ ·çš„ï¼Œåªåœ¨é›†åˆä¸­æ·»åŠ ä¸€ä¸ªã€‚ä½†æ˜¯ EqualExample æ²¡æœ‰å®ç° `hashCode()` æ–¹æ³•ï¼Œå› æ­¤è¿™ä¸¤ä¸ªå¯¹è±¡çš„å“ˆå¸Œå€¼æ˜¯ä¸åŒçš„ï¼Œæœ€ç»ˆå¯¼è‡´é›†åˆæ·»åŠ äº†ä¸¤ä¸ªç­‰ä»·çš„å¯¹è±¡ã€‚

```java
EqualExample e1 = new EqualExample(1, 1, 1);
EqualExample e2 = new EqualExample(1, 1, 1);
System.out.println(e1.equals(e2)); // true
HashSet<EqualExample> set = new HashSet<>();
set.add(e1);
set.add(e2);
System.out.println(set.size());   // 2
```

ç†æƒ³çš„å“ˆå¸Œå‡½æ•°ï¼ˆæ–¹æ³•/ç®—æ³•ï¼‰åº”å½“å…·æœ‰å‡åŒ€æ€§ï¼Œå³ä¸ç›¸ç­‰çš„å¯¹è±¡åº”å½“å‡åŒ€åˆ†å¸ƒåˆ°æ‰€æœ‰å¯èƒ½çš„å“ˆå¸Œå€¼ä¸Šã€‚

è¿™å°±è¦æ±‚äº†å“ˆå¸Œå‡½æ•°è¦æŠŠæ‰€æœ‰åŸŸï¼ˆå­—æ®µï¼‰çš„å€¼éƒ½è€ƒè™‘è¿›æ¥ã€‚å¯ä»¥å°†æ¯ä¸ªåŸŸéƒ½å½“æˆ R è¿›åˆ¶çš„æŸä¸€ä½ï¼Œç„¶åç»„æˆä¸€ä¸ª R è¿›åˆ¶çš„æ•´æ•°ã€‚

R ä¸€èˆ¬å– 31ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå¥‡ç´ æ•°ï¼Œå¦‚æœæ˜¯å¶æ•°çš„è¯ï¼Œå½“å‡ºç°ä¹˜æ³•æº¢å‡ºï¼Œä¿¡æ¯å°±ä¼šä¸¢å¤±ï¼Œå› ä¸ºä¸ 2 ç›¸ä¹˜ç›¸å½“äºå‘å·¦ç§»ä¸€ä½ï¼Œæœ€å·¦è¾¹çš„ä½ä¸¢å¤±ã€‚

å¹¶ä¸”ä¸€ä¸ªæ•°ä¸ 31 ç›¸ä¹˜å¯ä»¥è½¬æ¢æˆç§»ä½å’Œå‡æ³•ï¼š`31*x == (x<<5)-x`ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è¿›è¡Œè¿™ä¸ªä¼˜åŒ–ã€‚

```java
@Override
public int hashCode() {
    int result = 17;
    result = 31 * result + x;
    result = 31 * result + y;
    result = 31 * result + z;
    return result;
}
```

#### toString()

é»˜è®¤è¿”å› `ToStringExample@4554617c` è¿™ç§å½¢å¼ï¼Œå…¶ä¸­ @ åé¢çš„æ•°å€¼ä¸ºå“ˆå¸Œå€¼ï¼ˆæ•£åˆ—ç ï¼‰çš„æ— ç¬¦å·åå…­è¿›åˆ¶è¡¨ç¤ºã€‚

```java
public class ToStringExample {

    private int number;

    public ToStringExample(int number) {
        this.number = number;
    }
}
```

æµ‹è¯•ä¸€ä¸‹ï¼š

```java
ToStringExample example = new ToStringExample(123);
System.out.println(example.toString());
```

è¾“å‡ºç»“æœï¼š

```html
ToStringExample@4554617c
```

#### clone()

##### 1. cloneable æ¥å£

`clone()` æ˜¯ Object çš„ protected æ–¹æ³•ï¼Œå®ƒä¸æ˜¯ publicï¼Œå› æ­¤å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰æ˜¾å¼é‡å†™ `clone()`ï¼Œå…¶å®ƒç±»å°±ä¸èƒ½ç›´æ¥è°ƒç”¨è¯¥ç±»å®ä¾‹çš„ `clone()` æ–¹æ³•ã€‚

```java
public class CloneExample {
    private int a;
    private int b;
}
```

å°è¯•ç›´æ¥è°ƒç”¨ `clone()` æ–¹æ³•ï¼Œç¼–è¯‘å™¨æç¤ºé”™è¯¯ï¼š

```java
CloneExample e1 = new CloneExample();
// CloneExample e2 = e1.clone(); // 'clone()' has protected access in 'java.lang.Object'
```

å¥½ï¼Œè¿™æ¬¡é‡å†™ `clone()` æ–¹æ³•ï¼š

```java
public class CloneExample {
    private int a;
    private int b;

    @Override
    public CloneExample clone() throws CloneNotSupportedException {
        return (CloneExample)super.clone();
    }
}
```

å†æ¬¡å°è¯•è°ƒç”¨ `clone()` æ–¹æ³•ï¼š

```java
CloneExample e1 = new CloneExample();
try {
    CloneExample e2 = e1.clone();
} catch (CloneNotSupportedException e) {
    e.printStackTrace();
}
```

è¾“å‡ºç»“æœï¼š

```html
java.lang.CloneNotSupportedException: CloneExample
```

å“¦å“¦ï¼Œç¼–è¯‘é€šè¿‡äº†ï¼Œä½†è¿è¡Œæ—¶æŠ›å‡º CloneNotSupportedExceptionï¼Œè¿™æ˜¯å› ä¸º CloneExample æ²¡æœ‰å®ç° Cloneable æ¥å£ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`clone()` æ–¹æ³•å¹¶ä¸æ˜¯ Cloneable æ¥å£çš„æ–¹æ³•ï¼Œè€Œæ˜¯ Object çš„ protected æ–¹æ³•ã€‚

Cloneable æ¥å£åªæ˜¯è§„å®šï¼ˆçº¦æŸï¼‰ï¼Œè§„å®šä¸€ä¸ªç±»å¦‚æœæ²¡æœ‰å®ç° Cloneable æ¥å£å°±ç›´æ¥è°ƒç”¨äº† `clone()` æ–¹æ³•ï¼Œå°±ä¼šæŠ›å‡º CloneNotSupportedExceptionã€‚

```java
public class CloneExample implements Cloneable {
    private int a;
    private int b;

    @Override
    public Object clone() throws CloneNotSupportedException {
        return super.clone();
    }
}
```

##### 2. æµ…æ‹·è´

æµ…æ‹·è´ï¼šå¤åˆ¶å¯¹è±¡çš„åŸºæœ¬æ•°æ®ç±»å‹æˆå‘˜å˜é‡ï¼Œå’Œå¼•ç”¨æ•°æ®ç±»å‹æˆå‘˜å˜é‡çš„å¼•ç”¨ï¼Œå¯¼è‡´æ–°å¯¹è±¡å’ŒåŸå¯¹è±¡å…±äº«åŒä¸€å¼•ç”¨å¯¹è±¡ã€‚

```java
public class ShallowCloneExample implements Cloneable {

    private int[] arr;

    public ShallowCloneExample() {
        arr = new int[10];
        for (int i = 0; i < arr.length; i++) {
            arr[i] = i;
        }
    }

    public void set(int index, int value) {
        arr[index] = value;
    }

    public int get(int index) {
        return arr[index];
    }

    @Override
    protected ShallowCloneExample clone() throws CloneNotSupportedException {
        return (ShallowCloneExample) super.clone();
    }
}
```

è¿›è¡Œæµ…æ‹·è´ï¼Œæ”¹å˜ e1 çš„ arr æ•°ç»„ï¼Œe2 çš„ arr æ•°ç»„ä¹Ÿä¼šæ”¹å˜ã€‚

```java
ShallowCloneExample e1 = new ShallowCloneExample();
ShallowCloneExample e2 = null;
try {
    e2 = e1.clone();
} catch (CloneNotSupportedException e) {
    e.printStackTrace();
}
e1.set(2, 222);
System.out.println(e2.get(2)); // 222
```

##### 3. æ·±æ‹·è´

æ·±æ‹·è´ï¼šä¸ä»…å¤åˆ¶å¯¹è±¡çš„åŸºæœ¬æ•°æ®ç±»å‹æˆå‘˜å˜é‡ï¼Œè¿˜é€’å½’å¤åˆ¶å¼•ç”¨ç±»å‹æˆå‘˜å˜é‡æ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œä½¿å¾—æ–°å¯¹è±¡å’ŒåŸå¯¹è±¡å®Œå…¨ç‹¬ç«‹ã€‚

```java
public class DeepCloneExample implements Cloneable {

    private int[] arr;

    public DeepCloneExample() {
        arr = new int[10];
        for (int i = 0; i < arr.length; i++) {
            arr[i] = i;
        }
    }

    public void set(int index, int value) {
        arr[index] = value;
    }

    public int get(int index) {
        return arr[index];
    }

    @Override
    protected DeepCloneExample clone() throws CloneNotSupportedException {
        DeepCloneExample result = (DeepCloneExample) super.clone();
        result.arr = new int[arr.length];
        for (int i = 0; i < arr.length; i++) {
            result.arr[i] = arr[i];
        }
        return result;
    }
}
```

è¿›è¡Œæ·±æ‹·è´ï¼Œæ”¹å˜ e1 çš„ arr æ•°ç»„ï¼Œe2 çš„ arr æ•°ç»„ä¸ä¼šæ”¹å˜ã€‚

```java
DeepCloneExample e1 = new DeepCloneExample();
DeepCloneExample e2 = null;
try {
    e2 = e1.clone();
} catch (CloneNotSupportedException e) {
    e.printStackTrace();
}
e1.set(2, 222);
System.out.println(e2.get(2)); // 2
```

##### 4. clone() çš„æ›¿ä»£æ–¹æ¡ˆ

ä½¿ç”¨ `clone()` æ–¹æ³•æ¥æ‹·è´ä¸€ä¸ªå¯¹è±¡æ—¢å¤æ‚åˆæœ‰é£é™©ï¼Œä¸€éœ€è¦ç±»å‹è½¬æ¢ï¼ŒäºŒå¯èƒ½æŠ›å‡ºå¼‚å¸¸ã€‚

Effective Java ä¸€ä¹¦ä¸Šè®²åˆ°ï¼Œæœ€å¥½ä¸è¦å»ä½¿ç”¨ `clone()`ï¼Œå¯ä»¥ä½¿ç”¨æ‹·è´æ„é€ æ–¹æ³•æˆ–è€…æ‹·è´å·¥å‚æ¥æ‹·è´ä¸€ä¸ªå¯¹è±¡ã€‚

```java
public class CloneConstructorExample {

    private int[] arr;

    public CloneConstructorExample() {
        arr = new int[10];
        for (int i = 0; i < arr.length; i++) {
            arr[i] = i;
        }
    }

    public CloneConstructorExample(CloneConstructorExample original) {
        arr = new int[original.arr.length];
        for (int i = 0; i < original.arr.length; i++) {
            arr[i] = original.arr[i];
        }
    }

    public void set(int index, int value) {
        arr[index] = value;
    }

    public int get(int index) {
        return arr[index];
    }
}
```

ä½¿ç”¨æ‹·è´æ„é€ æ–¹æ³•æ¥æ‹·è´ä¸€ä¸ªå¯¹è±¡ï¼Œç®€å•é«˜æ•ˆã€‚

```java
CloneConstructorExample e1 = new CloneConstructorExample();
CloneConstructorExample e2 = new CloneConstructorExample(e1);
e1.set(2, 222);
System.out.println(e2.get(2)); // 2
```

æ¨èé˜…è¯»ï¼š[æ·±å…¥ç†è§£Javaæµ…æ‹·è´ä¸æ·±æ‹·è´](https://javabetter.cn/basic-extra-meal/deep-copy.html)

### å…­ã€ç»§æ‰¿

#### è®¿é—®æƒé™

Java ä¸­æœ‰ä¸‰ä¸ªè®¿é—®æƒé™ä¿®é¥°ç¬¦ï¼šprivateã€protected ä»¥åŠ publicï¼Œå¦‚æœä¸åŠ è®¿é—®ä¿®é¥°ç¬¦ï¼Œè¡¨ç¤ºåŒ…çº§å¯è§ã€‚

å¯ä»¥å¯¹ç±»æˆ–ç±»ä¸­çš„æˆå‘˜ï¼ˆå­—æ®µå’Œæ–¹æ³•ï¼‰åŠ ä¸Šè®¿é—®ä¿®é¥°ç¬¦ã€‚

- ç±»å¯è§è¡¨ç¤ºå…¶å®ƒç±»å¯ä»¥ç”¨è¿™ä¸ªç±»åˆ›å»ºå®ä¾‹å¯¹è±¡ã€‚
- æˆå‘˜å¯è§è¡¨ç¤ºå…¶å®ƒç±»å¯ä»¥ç”¨è¿™ä¸ªç±»çš„å®ä¾‹å¯¹è±¡è®¿é—®åˆ°è¯¥æˆå‘˜ï¼›

protected ç”¨äºä¿®é¥°æˆå‘˜ï¼Œè¡¨ç¤ºåœ¨ç»§æ‰¿ä½“ç³»ä¸­æˆå‘˜å¯¹äºå­ç±»å¯è§ï¼Œä½†æ˜¯è¿™ä¸ªè®¿é—®ä¿®é¥°ç¬¦å¯¹äºç±»æ²¡æœ‰æ„ä¹‰ã€‚

è®¾è®¡è‰¯å¥½çš„æ¨¡å—ä¼šéšè—æ‰€æœ‰çš„å®ç°ç»†èŠ‚ï¼ŒæŠŠå®ƒçš„ API ä¸å®ƒçš„å®ç°æ¸…æ™°åœ°éš”ç¦»å¼€æ¥ã€‚æ¨¡å—ä¹‹é—´åªé€šè¿‡å®ƒä»¬çš„ API è¿›è¡Œé€šä¿¡ï¼Œä¸€ä¸ªæ¨¡å—ä¸éœ€è¦çŸ¥é“å…¶ä»–æ¨¡å—çš„å†…éƒ¨å·¥ä½œæƒ…å†µï¼Œè¿™ä¸ªæ¦‚å¿µè¢«ç§°ä¸ºä¿¡æ¯éšè—æˆ–å°è£…ã€‚å› æ­¤è®¿é—®æƒé™åº”å½“å°½å¯èƒ½åœ°ä½¿æ¯ä¸ªç±»æˆ–è€…æˆå‘˜ä¸è¢«å¤–ç•Œè®¿é—®ã€‚

å¦‚æœå­ç±»çš„æ–¹æ³•é‡å†™äº†çˆ¶ç±»çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå­ç±»ä¸­è¯¥æ–¹æ³•çš„è®¿é—®çº§åˆ«ä¸å…è®¸ä½äºçˆ¶ç±»çš„è®¿é—®çº§åˆ«ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿å¯ä»¥ä½¿ç”¨çˆ¶ç±»å®ä¾‹çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨å­ç±»å®ä¾‹å»ä»£æ›¿ï¼Œä¹Ÿå°±æ˜¯ç¡®ä¿æ»¡è¶³é‡Œæ°æ›¿æ¢åŸåˆ™ã€‚

å­—æ®µå†³ä¸èƒ½æ˜¯å…¬æœ‰çš„ï¼Œå› ä¸ºè¿™ä¹ˆåšçš„è¯å°±å¤±å»äº†å¯¹è¿™ä¸ªå­—æ®µä¿®æ”¹è¡Œä¸ºçš„æ§åˆ¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥å¯¹å…¶éšæ„ä¿®æ”¹ã€‚

ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼ŒAccessExample æ‹¥æœ‰ id å…¬æœ‰å­—æ®µï¼Œå¦‚æœåœ¨æŸä¸ªæ—¶åˆ»ï¼Œæˆ‘ä»¬æƒ³è¦ä½¿ç”¨ int å­˜å‚¨ id å­—æ®µï¼Œé‚£ä¹ˆå°±éœ€è¦ä¿®æ”¹æ‰€æœ‰çš„å®¢æˆ·ç«¯ä»£ç ã€‚

```java
public class AccessExample {
    public String id;
}
```

å¯ä»¥ä½¿ç”¨å…¬æœ‰çš„ getter å’Œ setter æ–¹æ³•æ¥æ›¿æ¢å…¬æœ‰å­—æ®µï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥æ§åˆ¶å¯¹å­—æ®µçš„ä¿®æ”¹è¡Œä¸ºã€‚

```java
public class AccessExample {

    private int id;

    public String getId() {
        return id + "";
    }

    public void setId(String id) {
        this.id = Integer.valueOf(id);
    }
}
```

ä½†æ˜¯ä¹Ÿæœ‰ä¾‹å¤–ï¼Œå¦‚æœæ˜¯åŒ…çº§ç§æœ‰çš„ç±»æˆ–è€…ç§æœ‰çš„åµŒå¥—ç±»ï¼Œé‚£ä¹ˆç›´æ¥æš´éœ²æˆå‘˜ä¸ä¼šæœ‰ç‰¹åˆ«å¤§çš„å½±å“ã€‚

```java
public class AccessWithInnerClassExample {

    private class InnerClass {
        int x;
    }

    private InnerClass innerClass;

    public AccessWithInnerClassExample() {
        innerClass = new InnerClass();
    }

    public int getValue() {
        return innerClass.x;  // ç›´æ¥è®¿é—®
    }
}
```

æ¨èé˜…è¯»ï¼š[Javaè®¿é—®æƒé™ä¿®é¥°ç¬¦](https://javabetter.cn/oo/access-control.html)

#### æŠ½è±¡ç±»ä¸æ¥å£

##### 1. æŠ½è±¡ç±»

æŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•éƒ½ä½¿ç”¨ abstract å…³é”®å­—è¿›è¡Œå£°æ˜ã€‚å¦‚æœä¸€ä¸ªç±»ä¸­åŒ…å«æŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å¿…é¡»å£°æ˜ä¸ºæŠ½è±¡ç±»ã€‚

æŠ½è±¡ç±»å’Œæ™®é€šç±»æœ€å¤§çš„åŒºåˆ«æ˜¯ï¼ŒæŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œåªèƒ½è¢«ç»§æ‰¿ã€‚

```java
public abstract class AbstractClassExample {

    protected int x;
    private int y;

    public abstract void func1();

    public void func2() {
        System.out.println("func2");
    }
}
```

ç»§æ‰¿ï¼š

```java
public class AbstractExtendClassExample extends AbstractClassExample {
    @Override
    public void func1() {
        System.out.println("func1");
    }
}
```

æŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ã€‚

```java
// AbstractClassExample ac1 = new AbstractClassExample(); // 'AbstractClassExample' is abstract; cannot be instantiated
AbstractClassExample ac2 = new AbstractExtendClassExample();
ac2.func1();
```

##### 2. æ¥å£

æ¥å£æ˜¯æŠ½è±¡ç±»çš„å»¶ä¼¸ï¼Œåœ¨ Java 8 ä¹‹å‰ï¼Œå®ƒå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªå®Œå…¨æŠ½è±¡çš„ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸èƒ½æœ‰ä»»ä½•çš„æ–¹æ³•å®ç°ã€‚

ä» Java 8 å¼€å§‹ï¼Œæ¥å£ä¹Ÿå¯ä»¥æ‹¥æœ‰é»˜è®¤çš„æ–¹æ³•å®ç°ï¼Œè¿™æ˜¯å› ä¸ºä¸æ”¯æŒé»˜è®¤æ–¹æ³•çš„æ¥å£ç»´æŠ¤æˆæœ¬å¤ªé«˜äº†ã€‚åœ¨ Java 8 ä¹‹å‰ï¼Œå¦‚æœä¸€ä¸ªæ¥å£æƒ³è¦æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œé‚£ä¹ˆè¦ä¿®æ”¹æ‰€æœ‰å®ç°äº†è¯¥æ¥å£çš„ç±»ï¼Œè®©å®ƒä»¬éƒ½å®ç°æ–°å¢çš„æ–¹æ³•ã€‚

æ¥å£çš„æˆå‘˜ï¼ˆå­—æ®µ + æ–¹æ³•ï¼‰é»˜è®¤éƒ½æ˜¯ public çš„ï¼Œå¹¶ä¸”ä¸å…è®¸å®šä¹‰ä¸º private æˆ–è€… protectedã€‚ä» Java 9 å¼€å§‹ï¼Œå…è®¸å°†æ–¹æ³•å®šä¹‰ä¸º privateï¼Œè¿™æ ·å°±èƒ½å®šä¹‰æŸäº›å¤ç”¨çš„ä»£ç åˆä¸ä¼šæŠŠæ–¹æ³•æš´éœ²å‡ºå»ã€‚

æ¥å£çš„å­—æ®µé»˜è®¤éƒ½æ˜¯ static å’Œ final çš„ã€‚

```java
public interface InterfaceExample {

    void func1();

    default void func2(){
        System.out.println("func2");
    }

    int x = 123;
    // int y;               // Variable 'y' might not have been initialized
    public int z = 0;       // Modifier 'public' is redundant for interface fields
    // private int k = 0;   // Modifier 'private' not allowed here
    // protected int l = 0; // Modifier 'protected' not allowed here
    // private void fun3(); // Modifier 'private' not allowed here
}
```

æ¥å£çš„å®ç°ï¼š

```java
public class InterfaceImplementExample implements InterfaceExample {
    @Override
    public void func1() {
        System.out.println("func1");
    }
}
```

æ¥å£ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨æ¥å£å¼•ç”¨æ¥æŒ‡å‘å®ç°äº†è¯¥æ¥å£çš„ç±»ã€‚

```java
// InterfaceExample ie1 = new InterfaceExample(); // 'InterfaceExample' is abstract; cannot be instantiated
InterfaceExample ie2 = new InterfaceImplementExample();
ie2.func1();
System.out.println(InterfaceExample.x);
```

##### 3. æŠ½è±¡ç±»å’Œæ¥å£æ¯”è¾ƒ 

- ä»è®¾è®¡å±‚é¢ä¸Šçœ‹ï¼ŒæŠ½è±¡ç±»æä¾›äº†ä¸€ç§ IS-A çš„å…³ç³»ï¼Œéœ€è¦æ»¡è¶³é‡Œå¼æ›¿æ¢åŸåˆ™ï¼Œå³å­ç±»å¯¹è±¡å¿…é¡»èƒ½å¤Ÿæ›¿æ¢æ‰æ‰€æœ‰çˆ¶ç±»å¯¹è±¡ã€‚è€Œæ¥å£æ›´åƒæ˜¯ä¸€ç§ LIKE-A å…³ç³»ï¼Œå®ƒåªæ˜¯æä¾›ä¸€ç§æ–¹æ³•å®ç°å¥‘çº¦ï¼Œå¹¶ä¸è¦æ±‚æ¥å£å’Œå®ç°æ¥å£çš„ç±»å…·æœ‰ IS-A å…³ç³»ã€‚
- ä»ä½¿ç”¨ä¸Šæ¥çœ‹ï¼Œä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œä½†æ˜¯ä¸èƒ½ç»§æ‰¿å¤šä¸ªæŠ½è±¡ç±»ã€‚
- æ¥å£çš„å­—æ®µåªèƒ½æ˜¯ static å’Œ final ç±»å‹çš„ï¼Œè€ŒæŠ½è±¡ç±»çš„å­—æ®µæ²¡æœ‰è¿™ç§é™åˆ¶ã€‚
- æ¥å£çš„æˆå‘˜åªèƒ½æ˜¯ public çš„ï¼Œè€ŒæŠ½è±¡ç±»çš„æˆå‘˜å¯ä»¥æœ‰å¤šç§è®¿é—®æƒé™ã€‚

##### 4. æŠ½è±¡ç±»å’Œæ¥å£çš„ä½¿ç”¨é€‰æ‹©

ä½¿ç”¨æ¥å£ï¼š

- éœ€è¦è®©ä¸ç›¸å…³çš„ç±»éƒ½å®ç°ä¸€ä¸ªæ–¹æ³•ï¼Œä¾‹å¦‚ä¸ç›¸å…³çš„ç±»éƒ½å¯ä»¥å®ç° Comparable æ¥å£ä¸­çš„ `compareTo()` æ–¹æ³•ï¼›
- éœ€è¦ä½¿ç”¨å¤šé‡ç»§æ‰¿ã€‚

ä½¿ç”¨æŠ½è±¡ç±»ï¼š

- éœ€è¦åœ¨å‡ ä¸ªç›¸å…³çš„ç±»ä¸­å…±äº«ä»£ç ã€‚
- éœ€è¦èƒ½æ§åˆ¶ç»§æ‰¿æ¥çš„æˆå‘˜è®¿é—®æƒé™ï¼Œè€Œä¸æ˜¯éƒ½ä¸º publicã€‚
- éœ€è¦ç»§æ‰¿éé™æ€å’Œéå¸¸é‡å­—æ®µã€‚

åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæ¥å£ä¼˜å…ˆäºæŠ½è±¡ç±»ã€‚å› ä¸ºæ¥å£æ²¡æœ‰æŠ½è±¡ç±»ä¸¥æ ¼çš„ç±»å±‚æ¬¡ç»“æ„è¦æ±‚ï¼Œå¯ä»¥çµæ´»åœ°ä¸ºä¸€ä¸ªç±»æ·»åŠ è¡Œä¸ºã€‚å¹¶ä¸”ä» Java 8 å¼€å§‹ï¼Œæ¥å£ä¹Ÿå¯ä»¥æœ‰é»˜è®¤çš„æ–¹æ³•å®ç°ï¼Œä½¿å¾—ä¿®æ”¹æ¥å£çš„æˆæœ¬ä¹Ÿå˜çš„å¾ˆä½ã€‚

æ¨èé˜…è¯»ï¼š

- [æ¥å£](https://javabetter.cn/oo/interface.html)
- [æŠ½è±¡ç±»](https://javabetter.cn/oo/abstract.html)


#### super å…³é”®å­—

- å¯ä»¥ä½¿ç”¨ `super()` è®¿é—®çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œä»è€Œå§”æ‰˜çˆ¶ç±»å®Œæˆä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œã€‚åº”è¯¥æ³¨æ„åˆ°ï¼Œå­ç±»ä¸€å®šä¼šè°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•æ¥å®Œæˆåˆå§‹åŒ–å·¥ä½œï¼Œä¸€èˆ¬æ˜¯è°ƒç”¨çˆ¶ç±»çš„é»˜è®¤æ„é€ æ–¹æ³•ï¼Œå¦‚æœå­ç±»éœ€è¦è°ƒç”¨çˆ¶ç±»å…¶å®ƒçš„æ„é€ æ–¹æ³•ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ `super()`ã€‚
- è®¿é—®çˆ¶ç±»çš„æˆå‘˜ï¼šå¦‚æœå­ç±»é‡å†™äº†çˆ¶ç±»çš„æŸä¸ªæ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ super å…³é”®å­—æ¥å¼•ç”¨çˆ¶ç±»çš„æ–¹æ³•å®ç°ã€‚

```java
public class SuperExample {

    protected int x;
    protected int y;

    public SuperExample(int x, int y) {
        this.x = x;
        this.y = y;
    }

    public void func() {
        System.out.println("SuperExample.func()");
    }
}
```

ä½¿ç”¨ `super()` è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼š

```java
public class SuperExtendExample extends SuperExample {

    private int z;

    public SuperExtendExample(int x, int y, int z) {
        super(x, y);
        this.z = z;
    }

    @Override
    public void func() {
        super.func();
        System.out.println("SuperExtendExample.func()");
    }
}
```

æµ‹è¯•ï¼š

```java
SuperExample e = new SuperExtendExample(1, 2, 3);
e.func();
```

è¾“å‡ºç»“æœï¼š

```html
SuperExample.func()
SuperExtendExample.func()
```

æ¨èé˜…è¯»ï¼š[this å’Œ super](https://javabetter.cn/oo/this-super.html)

#### é‡å†™ä¸é‡è½½

##### 1. é‡å†™ï¼ˆOverrideï¼‰ 

é‡å†™å­˜åœ¨äºç»§æ‰¿ä½“ç³»ä¸­ï¼ŒæŒ‡å­ç±»å®ç°äº†ä¸€ä¸ªä¸çˆ¶ç±»åœ¨æ–¹æ³•å£°æ˜ä¸Šå®Œå…¨ç›¸åŒçš„æ–¹æ³•ã€‚

ä¸ºäº†æ»¡è¶³é‡Œå¼æ›¿æ¢åŸåˆ™ï¼Œé‡å†™æœ‰ä»¥ä¸‹ä¸‰ä¸ªé™åˆ¶ï¼š

- å­ç±»æ–¹æ³•çš„è®¿é—®æƒé™å¿…é¡»å¤§äºç­‰äºçˆ¶ç±»æ–¹æ³•ï¼›
- å­ç±»æ–¹æ³•çš„è¿”å›ç±»å‹å¿…é¡»æ˜¯çˆ¶ç±»æ–¹æ³•è¿”å›ç±»å‹æˆ–ä¸ºå…¶å­ç±»å‹ã€‚
- å­ç±»æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹å¿…é¡»æ˜¯çˆ¶ç±»æŠ›å‡ºå¼‚å¸¸ç±»å‹æˆ–ä¸ºå…¶å­ç±»å‹ã€‚

ä½¿ç”¨ `@Override` æ³¨è§£ï¼Œå¯ä»¥è®©ç¼–è¯‘å™¨å¸®å¿™æ£€æŸ¥æ˜¯å¦æ»¡è¶³ä¸Šé¢çš„ä¸‰ä¸ªé™åˆ¶æ¡ä»¶ã€‚

ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼ŒSubClass ä¸º SuperClass çš„å­ç±»ï¼ŒSubClass é‡å†™äº† SuperClass çš„ `func()` æ–¹æ³•ã€‚å…¶ä¸­ï¼š

- å­ç±»æ–¹æ³•è®¿é—®æƒé™ä¸º publicï¼Œå¤§äºçˆ¶ç±»çš„ protectedã€‚
- å­ç±»çš„è¿”å›ç±»å‹ä¸º ArrayList\<Integer\>ï¼Œæ˜¯çˆ¶ç±»è¿”å›ç±»å‹ List\<Integer\> çš„å­ç±»ã€‚
- å­ç±»æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ä¸º Exceptionï¼Œæ˜¯çˆ¶ç±»æŠ›å‡ºå¼‚å¸¸ Throwable çš„å­ç±»ã€‚
- å­ç±»é‡å†™æ–¹æ³•ä½¿ç”¨ `@Override` æ³¨è§£ï¼Œä»è€Œè®©ç¼–è¯‘å™¨è‡ªåŠ¨æ£€æŸ¥æ˜¯å¦æ»¡è¶³é™åˆ¶æ¡ä»¶ã€‚

```java
class SuperClass {
    protected List<Integer> func() throws Throwable {
        return new ArrayList<>();
    }
}

class SubClass extends SuperClass {
    @Override
    public ArrayList<Integer> func() throws Exception {
        return new ArrayList<>();
    }
}
```

åœ¨è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå…ˆä»æœ¬ç±»ä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰å¯¹åº”çš„æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰å†åˆ°çˆ¶ç±»ä¸­æŸ¥çœ‹ï¼Œçœ‹æ˜¯å¦ä»çˆ¶ç±»ç»§æ‰¿æ¥ã€‚å¦åˆ™å°±è¦å¯¹å‚æ•°è¿›è¡Œè½¬å‹ï¼Œè½¬æˆçˆ¶ç±»ä¹‹åçœ‹æ˜¯å¦æœ‰å¯¹åº”çš„æ–¹æ³•ã€‚æ€»çš„æ¥è¯´ï¼Œæ–¹æ³•è°ƒç”¨çš„ä¼˜å…ˆçº§ä¸ºï¼š

- this.func(this)
- super.func(this)
- this.func(super)
- super.func(super)


```java
class A {

    public void show(A obj) {
        System.out.println("A.show(A)");
    }

    public void show(C obj) {
        System.out.println("A.show(C)");
    }
}

class B extends A {

    @Override
    public void show(A obj) {
        System.out.println("B.show(A)");
    }
}

class C extends B {
}

class D extends C {
}
```

æµ‹è¯•ï¼š

```java
public static void main(String[] args) {

    A a = new A();
    B b = new B();
    C c = new C();
    D d = new D();

    // åœ¨ A ä¸­å­˜åœ¨ show(A obj)ï¼Œç›´æ¥è°ƒç”¨
    a.show(a); // A.show(A)
    // åœ¨ A ä¸­ä¸å­˜åœ¨ show(B obj)ï¼Œå°† B è½¬å‹æˆå…¶çˆ¶ç±» A
    a.show(b); // A.show(A)
    // åœ¨ B ä¸­å­˜åœ¨ä» A ç»§æ‰¿æ¥çš„ show(C obj)ï¼Œç›´æ¥è°ƒç”¨
    b.show(c); // A.show(C)
    // åœ¨ B ä¸­ä¸å­˜åœ¨ show(D obj)ï¼Œä½†æ˜¯å­˜åœ¨ä» A ç»§æ‰¿æ¥çš„ show(C obj)ï¼Œå°† D è½¬å‹æˆå…¶çˆ¶ç±» C
    b.show(d); // A.show(C)

    // å¼•ç”¨çš„è¿˜æ˜¯ B å¯¹è±¡ï¼Œæ‰€ä»¥ ba å’Œ b çš„è°ƒç”¨ç»“æœä¸€æ ·
    A ba = new B();
    ba.show(c); // A.show(C)
    ba.show(d); // A.show(C)
}
```

##### 2. é‡è½½ï¼ˆOverloadï¼‰ 

é‡è½½å­˜åœ¨äºåŒä¸€ä¸ªç±»ä¸­ï¼ŒæŒ‡ä¸€ä¸ªæ–¹æ³•ä¸å·²ç»å­˜åœ¨çš„æ–¹æ³•åç§°ä¸Šç›¸åŒï¼Œä½†æ˜¯å‚æ•°ç±»å‹ã€ä¸ªæ•°ã€é¡ºåºè‡³å°‘æœ‰ä¸€ä¸ªä¸åŒã€‚

åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œè¿”å›å€¼ä¸åŒï¼Œå…¶å®ƒéƒ½ç›¸åŒä¸ç®—æ˜¯é‡è½½ã€‚

```java
class OverloadingExample {
    public void show(int x) {
        System.out.println(x);
    }

    public void show(int x, String y) {
        System.out.println(x + " " + y);
    }
}
```

æµ‹è¯•ï¼š

```java
public static void main(String[] args) {
    OverloadingExample example = new OverloadingExample();
    example.show(1);
    example.show(1, "2");
}
```

æ¨èé˜…è¯»ï¼š[é‡è½½å’Œé‡å†™](https://javabetter.cn/basic-extra-meal/override-overload.html)

> å¾®ä¿¡æœç´¢ã€Š**æ²‰é»˜ç‹äºŒ**ã€‹æˆ–è€…å¾®ä¿¡æ‰«ä¸‹é¢çš„äºŒç»´ç ï¼Œå…³æ³¨åå›å¤ã€Š**java**ã€‹å³å¯è·å–æœ€æ–°çš„ PDF ç‰ˆæœ¬ã€‚

![æ‰‹æœºç«¯å¯ä»¥é•¿æŒ‰è¯†åˆ«](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

### ä¸ƒã€åå°„

æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ª **Class** å¯¹è±¡ï¼ŒåŒ…å«äº†ä¸ç±»æœ‰å…³çš„ä¿¡æ¯ã€‚å½“ç¼–è¯‘ä¸€ä¸ªæ–°ç±»æ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªåŒåçš„ .class æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å†…å®¹ä¿å­˜ç€ Class å¯¹è±¡ã€‚

ç±»åŠ è½½ç›¸å½“äº Class å¯¹è±¡çš„åŠ è½½ï¼Œç±»åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰åŠ¨æ€åŠ è½½åˆ° JVM ä¸­ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ `Class.forName("com.mysql.jdbc.Driver")` è¿™ç§æ–¹å¼æ¥æ§åˆ¶ç±»çš„åŠ è½½ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª Class å¯¹è±¡ã€‚

åå°„å¯ä»¥æä¾›è¿è¡Œæ—¶çš„ç±»ä¿¡æ¯ï¼Œå¹¶ä¸”è¿™ä¸ªç±»å¯ä»¥åœ¨è¿è¡Œæ—¶æ‰åŠ è½½è¿›æ¥ï¼Œç”šè‡³åœ¨ç¼–è¯‘æ—¶æœŸè¯¥ç±»çš„ .class ä¸å­˜åœ¨ä¹Ÿå¯ä»¥åŠ è½½è¿›æ¥ã€‚

Class å’Œ java.lang.reflect ä¸€èµ·å¯¹åå°„æä¾›äº†æ”¯æŒï¼Œjava.lang.reflect ç±»åº“ä¸»è¦åŒ…å«äº†ä»¥ä¸‹ä¸‰ä¸ªç±»ï¼š

-  **Field** ï¼šå¯ä»¥ä½¿ç”¨ `get()` å’Œ `set()` æ–¹æ³•è¯»å–å’Œä¿®æ”¹ Field å¯¹è±¡å…³è”çš„å­—æ®µï¼›
-  **Method** ï¼šå¯ä»¥ä½¿ç”¨ `invoke()` æ–¹æ³•è°ƒç”¨ä¸ Method å¯¹è±¡å…³è”çš„æ–¹æ³•ï¼›
-  **Constructor** ï¼šå¯ä»¥ç”¨ Constructor çš„ `newInstance()` åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚

**åå°„çš„ä¼˜ç‚¹ï¼š**  

-  **å¯æ‰©å±•æ€§**   ï¼šåº”ç”¨ç¨‹åºå¯ä»¥åˆ©ç”¨å…¨é™å®šååˆ›å»ºå¯æ‰©å±•å¯¹è±¡çš„å®ä¾‹ï¼Œæ¥ä½¿ç”¨æ¥è‡ªå¤–éƒ¨çš„ç”¨æˆ·è‡ªå®šä¹‰ç±»ã€‚
-  **ç±»æµè§ˆå™¨å’Œå¯è§†åŒ–å¼€å‘ç¯å¢ƒ**   ï¼šä¸€ä¸ªç±»æµè§ˆå™¨éœ€è¦å¯ä»¥æšä¸¾ç±»çš„æˆå‘˜ã€‚å¯è§†åŒ–å¼€å‘ç¯å¢ƒï¼ˆå¦‚ IDEï¼‰å¯ä»¥ä»åˆ©ç”¨åå°„ä¸­å¯ç”¨çš„ç±»å‹ä¿¡æ¯ä¸­å—ç›Šï¼Œä»¥å¸®åŠ©ç¨‹åºå‘˜ç¼–å†™æ­£ç¡®çš„ä»£ç ã€‚
-  **è°ƒè¯•å™¨å’Œæµ‹è¯•å·¥å…·**   ï¼š è°ƒè¯•å™¨éœ€è¦èƒ½å¤Ÿæ£€æŸ¥ä¸€ä¸ªç±»é‡Œçš„ç§æœ‰æˆå‘˜ã€‚æµ‹è¯•å·¥å…·å¯ä»¥åˆ©ç”¨åå°„æ¥è‡ªåŠ¨åœ°è°ƒç”¨ç±»é‡Œå®šä¹‰çš„å¯è¢«å‘ç°çš„ API å®šä¹‰ï¼Œä»¥ç¡®ä¿ä¸€ç»„æµ‹è¯•ä¸­æœ‰è¾ƒé«˜çš„ä»£ç è¦†ç›–ç‡ã€‚

**åå°„çš„ç¼ºç‚¹ï¼š**  

å°½ç®¡åå°„éå¸¸å¼ºå¤§ï¼Œä½†ä¹Ÿä¸èƒ½æ»¥ç”¨ã€‚å¦‚æœä¸€ä¸ªåŠŸèƒ½å¯ä»¥ä¸ç”¨åå°„å®Œæˆï¼Œé‚£ä¹ˆæœ€å¥½å°±ä¸ç”¨ã€‚åœ¨æˆ‘ä»¬ä½¿ç”¨åå°„æŠ€æœ¯æ—¶ï¼Œä¸‹é¢å‡ æ¡å†…å®¹åº”è¯¥ç‰¢è®°äºå¿ƒã€‚

-  **æ€§èƒ½å¼€é”€**   ï¼šåå°„æ¶‰åŠäº†åŠ¨æ€ç±»å‹çš„è§£æï¼Œæ‰€ä»¥ JVM æ— æ³•å¯¹è¿™äº›ä»£ç è¿›è¡Œä¼˜åŒ–ã€‚å› æ­¤ï¼Œåå°„æ“ä½œçš„æ•ˆç‡è¦æ¯”é‚£äº›éåå°„æ“ä½œä½å¾—å¤šã€‚æˆ‘ä»¬åº”è¯¥é¿å…åœ¨ç»å¸¸è¢«æ‰§è¡Œçš„ä»£ç æˆ–å¯¹æ€§èƒ½è¦æ±‚å¾ˆé«˜çš„ç¨‹åºä¸­ä½¿ç”¨åå°„ã€‚
-  **å®‰å…¨é™åˆ¶**   ï¼šä½¿ç”¨åå°„æŠ€æœ¯è¦æ±‚ç¨‹åºå¿…é¡»åœ¨ä¸€ä¸ªæ²¡æœ‰å®‰å…¨é™åˆ¶çš„ç¯å¢ƒä¸­è¿è¡Œã€‚å¦‚æœä¸€ä¸ªç¨‹åºå¿…é¡»åœ¨æœ‰å®‰å…¨é™åˆ¶çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œå¦‚ Appletï¼Œé‚£ä¹ˆè¿™å°±æ˜¯ä¸ªé—®é¢˜äº†ã€‚
-  **å†…éƒ¨æš´éœ²**   ï¼šç”±äºåå°„å…è®¸ä»£ç æ‰§è¡Œä¸€äº›åœ¨æ­£å¸¸æƒ…å†µä¸‹ä¸è¢«å…è®¸çš„æ“ä½œï¼ˆæ¯”å¦‚è®¿é—®ç§æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼‰ï¼Œæ‰€ä»¥ä½¿ç”¨åå°„å¯èƒ½ä¼šå¯¼è‡´æ„æ–™ä¹‹å¤–çš„å‰¯ä½œç”¨ï¼Œè¿™å¯èƒ½å¯¼è‡´ä»£ç åŠŸèƒ½å¤±è°ƒå¹¶ç ´åå¯ç§»æ¤æ€§ã€‚åå°„ä»£ç ç ´åäº†æŠ½è±¡æ€§ï¼Œå› æ­¤å½“å¹³å°å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œä»£ç çš„è¡Œä¸ºå°±æœ‰å¯èƒ½ä¹Ÿéšç€å˜åŒ–ã€‚

æ¨èé˜…è¯»ï¼š[Java åå°„è¯¦è§£](https://javabetter.cn/basic-extra-meal/fanshe.html)

### å…«ã€å¼‚å¸¸

Throwable å¯ä»¥ç”¨æ¥è¡¨ç¤ºä»»ä½•å¯ä»¥ä½œä¸ºå¼‚å¸¸æŠ›å‡ºçš„ç±»ï¼Œåˆ†ä¸ºä¸¤ç§ï¼š  **Error**   å’Œ **Exception**ã€‚å…¶ä¸­ Error ç”¨æ¥è¡¨ç¤º JVM æ— æ³•å¤„ç†çš„é”™è¯¯ï¼ŒException åˆ†ä¸ºä¸¤ç§ï¼š

-   **å—æ£€å¼‚å¸¸**  ï¼šéœ€è¦ç”¨ try...catch... è¯­å¥æ•è·å¹¶è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”å¯ä»¥ä»å¼‚å¸¸ä¸­æ¢å¤ï¼›
-   **éå—æ£€å¼‚å¸¸**  ï¼šç¨‹åºè¿è¡Œæ—¶é”™è¯¯ï¼Œä¾‹å¦‚é™¤ 0 ä¼šå¼•å‘ Arithmetic Exceptionï¼Œæ­¤æ—¶ç¨‹åºå´©æºƒå¹¶ä¸”æ— æ³•æ¢å¤ã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ï¼šå¼‚å¸¸](https://cdn.tobebetterjavaer.com/studymore/gailan-20230326090207.png)

æ¨èé˜…è¯»ï¼š[ä¸€æ–‡å½»åº•ææ‡‚Javaå¼‚å¸¸å¤„ç†](https://javabetter.cn/exception/gailan.html)

### ä¹ã€æ³›å‹

```java
public class Box<T> {
    // T stands for "Type"
    private T t;
    public void set(T t) { this.t = t; }
    public T get() { return t; }
}
```

æ¨èé˜…è¯»ï¼š[Java æ³›å‹æ·±å…¥è§£æ](https://javabetter.cn/collection/generic.html)

### åã€æ³¨è§£

Java æ³¨è§£æ˜¯é™„åŠ åœ¨ä»£ç ä¸­çš„ä¸€äº›å…ƒä¿¡æ¯ï¼Œç”¨äºä¸€äº›å·¥å…·åœ¨ç¼–è¯‘ã€è¿è¡Œæ—¶è¿›è¡Œè§£æå’Œä½¿ç”¨ï¼Œèµ·åˆ°è¯´æ˜ã€é…ç½®çš„åŠŸèƒ½ã€‚æ³¨è§£ä¸ä¼šä¹Ÿä¸èƒ½å½±å“ä»£ç çš„å®é™…é€»è¾‘ï¼Œä»…ä»…èµ·åˆ°è¾…åŠ©æ€§çš„ä½œç”¨ã€‚

æ¨èé˜…è¯»ï¼š[æ·±å…¥ç†è§£Javaä¸­çš„æ³¨è§£](https://javabetter.cn/basic-extra-meal/annotation.html)

### åä¸€ã€ç‰¹æ€§

#### Java å„ç‰ˆæœ¬çš„æ–°ç‰¹æ€§

**New highlights in Java SE 8**  

1. Lambda Expressions
2. Pipelines and Streams
3. Date and Time API
4. Default Methods
5. Type Annotations
6. Nashhorn JavaScript Engine
7. Concurrent Accumulators
8. Parallel operations
9. PermGen Error Removed

**New highlights in Java SE 7**  

1. Strings in Switch Statement
2. Type Inference for Generic Instance Creation
3. Multiple Exception Handling
4. Support for Dynamic Languages
5. Try with Resources
6. Java nio Package
7. Binary Literals, Underscore in literals
8. Diamond Syntax

æ¨èé˜…è¯»ï¼š
- [Java 8 Streamæµ](https://javabetter.cn/java8/stream.html)
- [Java 8 Optionalæœ€ä½³æŒ‡å—](https://javabetter.cn/java8/optional.html)
- [æ·±å…¥æµ…å‡ºJava 8 Lambdaè¡¨è¾¾å¼](https://javabetter.cn/java8/Lambda.html)
- [Java 14 å¼€ç®±ï¼Œæ–°ç‰¹æ€§Recordã€instanceofã€switché¦™é¦™é¦™é¦™](https://javabetter.cn/java8/java14.html)

#### JRE or JDK

- JREï¼šJava Runtime Environmentï¼ŒJava è¿è¡Œç¯å¢ƒçš„ç®€ç§°ï¼Œä¸º Java çš„è¿è¡Œæä¾›æ‰€éœ€ç¯å¢ƒã€‚å®ƒæ˜¯ä¸€ä¸ª JVM ç¨‹åºï¼Œä¸»è¦åŒ…æ‹¬äº† JVM çš„æ ‡å‡†å®ç°å’Œä¸€äº› Java åŸºæœ¬ç±»åº“ã€‚
- JDKï¼šJava Development Kitï¼ŒJava å¼€å‘å·¥å…·åŒ…ï¼Œæä¾›äº† Java çš„å¼€å‘åŠè¿è¡Œç¯å¢ƒã€‚JDK æ˜¯ Java å¼€å‘çš„æ ¸å¿ƒï¼Œé›†æˆäº† JRE ä»¥åŠä¸€äº›å…¶å®ƒçš„å·¥å…·ï¼Œæ¯”å¦‚ç¼–è¯‘ Java æºç çš„ç¼–è¯‘å™¨ javac ç­‰ã€‚

### å‚è€ƒèµ„æ–™

CS-Notesï¼ŒåŸæ–‡æ¡£åœ°å€ï¼š[https://github.com/CyC2018/CS-Notes/](https://github.com/CyC2018/CS-Notes/blob/master/notes/Java%20%E5%9F%BA%E7%A1%80.md)

## ç¬¬äºŒç« ã€IO ç¯‡

### ä¸€ã€æ¦‚è§ˆ

Java çš„ I/O å¤§æ¦‚å¯ä»¥åˆ†æˆä»¥ä¸‹å‡ ç±»ï¼š

- ç£ç›˜æ“ä½œï¼šFile
- å­—èŠ‚æ“ä½œï¼šInputStream å’Œ OutputStream
- å­—ç¬¦æ“ä½œï¼šReader å’Œ Writer
- å¯¹è±¡æ“ä½œï¼šSerializable
- ç½‘ç»œæ“ä½œï¼šSocket
- æ–°çš„è¾“å…¥/è¾“å‡ºï¼šNIO

### äºŒã€ç£ç›˜æ“ä½œ

File ç±»å¯ä»¥ç”¨äºè¡¨ç¤ºæ–‡ä»¶å’Œç›®å½•çš„ä¿¡æ¯ï¼Œä½†æ˜¯å®ƒä¸è¡¨ç¤ºæ–‡ä»¶çš„å†…å®¹ã€‚

æ¥çœ‹ä¸€ä¸ªé€’å½’åˆ—å‡ºç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„ä¾‹å­ï¼š

```java
public static void listAllFiles(File dir) {
    if (dir == null || !dir.exists()) {
        return;
    }
    if (dir.isFile()) {
        System.out.println(dir.getName());
        return;
    }
    for (File file : dir.listFiles()) {
        listAllFiles(file);
    }
}
```

ä» Java 7 å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨ Paths å’Œ Files ä»£æ›¿ Fileã€‚

æ¨èé˜…è¯»ï¼š

- [Java Fileï¼šIO æµçš„èµ·ç‚¹ä¸ç»ˆç‚¹](https://javabetter.cn/io/file-path.html)
- [èŠèŠ Java NIO ä¸­çš„Paths å’Œ Files](https://javabetter.cn/nio/paths-files.html)

### ä¸‰ã€å­—èŠ‚æ“ä½œ

#### å®ç°æ–‡ä»¶å¤åˆ¶

```java
public static void copyFile(String src, String dist) throws IOException {
    FileInputStream in = new FileInputStream(src);
    FileOutputStream out = new FileOutputStream(dist);

    byte[] buffer = new byte[20 * 1024];
    int cnt;

    // read() æœ€å¤šè¯»å– buffer.length ä¸ªå­—èŠ‚
    // è¿”å›çš„æ˜¯å®é™…è¯»å–çš„ä¸ªæ•°
    // è¿”å› -1 çš„æ—¶å€™è¡¨ç¤ºè¯»åˆ° eofï¼Œå³æ–‡ä»¶å°¾
    while ((cnt = in.read(buffer, 0, buffer.length)) != -1) {
        out.write(buffer, 0, cnt);
    }

    in.close();
    out.close();
}
```

#### è£…é¥°è€…æ¨¡å¼

Java I/O ä½¿ç”¨äº†è£…é¥°è€…æ¨¡å¼æ¥å®ç°ã€‚

![cyc2018ï¼šInputStream](https://cdn.tobebetterjavaer.com/stutymore/java-io-20240606165832.png)

ä»¥ InputStream ä¸ºä¾‹ï¼š

- InputStream æ˜¯æŠ½è±¡ç»„ä»¶ï¼›
- FileInputStream æ˜¯ InputStream çš„å­ç±»ï¼Œå±äºå…·ä½“ç»„ä»¶ï¼Œæä¾›äº†å­—èŠ‚æµçš„è¾“å…¥æ“ä½œï¼›
- FilterInputStream å±äºæŠ½è±¡è£…é¥°è€…ï¼Œè£…é¥°è€…ç”¨äºè£…é¥°ç»„ä»¶ï¼Œä¸ºç»„ä»¶æä¾›é¢å¤–çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ BufferedInputStream ä¸º FileInputStream æä¾›ç¼“å­˜çš„åŠŸèƒ½ã€‚

å®ä¾‹åŒ–ä¸€ä¸ªå…·æœ‰ç¼“å­˜åŠŸèƒ½çš„å­—èŠ‚æµå¯¹è±¡æ—¶ï¼Œåªéœ€è¦åœ¨ FileInputStream å¯¹è±¡ä¸Šå†å¥—ä¸€å±‚ BufferedInputStream å¯¹è±¡å³å¯ã€‚

```java
FileInputStream fileInputStream = new FileInputStream(filePath);
BufferedInputStream bufferedInputStream = new BufferedInputStream(fileInputStream);
```

DataInputStream è£…é¥°è€…æä¾›äº†å¯¹æ›´å¤šæ•°æ®ç±»å‹è¿›è¡Œè¾“å…¥çš„æ“ä½œï¼Œæ¯”å¦‚ intã€double ç­‰åŸºæœ¬ç±»å‹ã€‚

### å››ã€å­—ç¬¦æ“ä½œ

#### ç¼–ç ä¸è§£ç 

ç¼–ç å°±æ˜¯æŠŠå­—ç¬¦è½¬æ¢ä¸ºå­—èŠ‚ï¼Œè€Œè§£ç æ˜¯æŠŠå­—èŠ‚é‡æ–°ç»„åˆæˆå­—ç¬¦ã€‚

å¦‚æœç¼–ç å’Œè§£ç è¿‡ç¨‹ä½¿ç”¨ä¸åŒçš„ç¼–ç æ–¹å¼é‚£ä¹ˆå°±å‡ºç°äº†ä¹±ç ã€‚

- GBK ç¼–ç ä¸­ï¼Œä¸­æ–‡å­—ç¬¦å  2 ä¸ªå­—èŠ‚ï¼Œè‹±æ–‡å­—ç¬¦å  1 ä¸ªå­—èŠ‚ï¼›
- UTF-8 ç¼–ç ä¸­ï¼Œä¸­æ–‡å­—ç¬¦å  3 ä¸ªå­—èŠ‚ï¼Œè‹±æ–‡å­—ç¬¦å  1 ä¸ªå­—èŠ‚ï¼›
- UTF-16be ç¼–ç ä¸­ï¼Œä¸­æ–‡å­—ç¬¦å’Œè‹±æ–‡å­—ç¬¦éƒ½å  2 ä¸ªå­—èŠ‚ã€‚

UTF-16be ä¸­çš„ be æŒ‡çš„æ˜¯ Big Endianï¼Œä¹Ÿå°±æ˜¯å¤§ç«¯ã€‚ç›¸åº”åœ°ä¹Ÿæœ‰ UTF-16leï¼Œle æŒ‡çš„æ˜¯ Little Endianï¼Œä¹Ÿå°±æ˜¯å°ç«¯ã€‚

Java çš„å†…å­˜ç¼–ç ä½¿ç”¨åŒå­—èŠ‚ç¼–ç  UTF-16beï¼Œè¿™ä¸æ˜¯æŒ‡ Java åªæ”¯æŒè¿™ä¸€ç§ç¼–ç æ–¹å¼ï¼Œè€Œæ˜¯è¯´ char è¿™ç§ç±»å‹ä½¿ç”¨ UTF-16be è¿›è¡Œç¼–ç ã€‚char ç±»å‹å  16 ä½ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªå­—èŠ‚ï¼ŒJava ä½¿ç”¨è¿™ç§åŒå­—èŠ‚ç¼–ç æ˜¯ä¸ºäº†è®©ä¸€ä¸ªä¸­æ–‡æˆ–è€…ä¸€ä¸ªè‹±æ–‡éƒ½èƒ½ä½¿ç”¨ä¸€ä¸ª char æ¥å­˜å‚¨ã€‚

æ¨èé˜…è¯»ï¼š[è§£å†³ä¸­æ–‡ä¹±ç ï¼šå­—ç¬¦ç¼–ç å…¨æ”»ç•¥ - ASCIIã€Unicodeã€UTF-8ã€GB2312è¯¦è§£](https://javabetter.cn/basic-extra-meal/java-unicode.html)

#### String çš„ç¼–ç æ–¹å¼

String å¯ä»¥çœ‹æˆä¸€ä¸ªå­—ç¬¦åºåˆ—ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªç¼–ç æ–¹å¼å°†å®ƒç¼–ç ä¸ºå­—èŠ‚åºåˆ—ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªç¼–ç æ–¹å¼å°†ä¸€ä¸ªå­—èŠ‚åºåˆ—è§£ç ä¸º Stringã€‚

```java
String str1 = "ä¸­æ–‡";
byte[] bytes = str1.getBytes("UTF-8");
String str2 = new String(bytes, "UTF-8");
System.out.println(str2);
```

åœ¨è°ƒç”¨æ— å‚æ•° `getBytes()` æ–¹æ³•æ—¶ï¼Œé»˜è®¤çš„ç¼–ç æ–¹å¼ä¸æ˜¯ UTF-16beã€‚åŒå­—èŠ‚ç¼–ç çš„å¥½å¤„æ˜¯å¯ä»¥ä½¿ç”¨ä¸€ä¸ª char å­˜å‚¨ä¸­æ–‡å’Œè‹±æ–‡ï¼Œè€Œå°† String è½¬ä¸º `bytes[]` å­—èŠ‚æ•°ç»„å°±ä¸å†éœ€è¦è¿™ä¸ªå¥½å¤„ï¼Œå› æ­¤ä¹Ÿå°±ä¸å†éœ€è¦åŒå­—èŠ‚ç¼–ç ã€‚`getBytes()` çš„é»˜è®¤ç¼–ç æ–¹å¼ä¸å¹³å°æœ‰å…³ï¼Œä¸€èˆ¬ä¸º UTF-8ã€‚

```java
byte[] bytes = str1.getBytes();
```

#### Reader ä¸ Writer

ä¸ç®¡æ˜¯ç£ç›˜è¿˜æ˜¯ç½‘ç»œä¼ è¾“ï¼Œæœ€å°çš„å­˜å‚¨å•å…ƒéƒ½æ˜¯å­—èŠ‚ï¼Œè€Œä¸æ˜¯å­—ç¬¦ã€‚ä½†æ˜¯åœ¨ç¨‹åºä¸­æ“ä½œçš„é€šå¸¸æ˜¯å­—ç¬¦å½¢å¼çš„æ•°æ®ï¼Œå› æ­¤éœ€è¦æä¾›å¯¹å­—ç¬¦è¿›è¡Œæ“ä½œçš„æ–¹æ³•ã€‚

- InputStreamReader å®ç°ä»å­—èŠ‚æµè§£ç æˆå­—ç¬¦æµï¼›
- OutputStreamWriter å®ç°å­—ç¬¦æµç¼–ç æˆä¸ºå­—èŠ‚æµã€‚

æ¨èé˜…è¯»ï¼š[Java å­—ç¬¦æµï¼šReaderå’ŒWriterçš„æ•…äº‹](https://javabetter.cn/io/reader-writer.html)

#### å®ç°é€è¡Œè¾“å‡ºæ–‡æœ¬æ–‡ä»¶çš„å†…å®¹

```java
public static void readFileContent(String filePath) throws IOException {

    FileReader fileReader = new FileReader(filePath);
    BufferedReader bufferedReader = new BufferedReader(fileReader);

    String line;
    while ((line = bufferedReader.readLine()) != null) {
        System.out.println(line);
    }

    // è£…é¥°è€…æ¨¡å¼ä½¿å¾— BufferedReader ç»„åˆäº†ä¸€ä¸ª Reader å¯¹è±¡
    // åœ¨è°ƒç”¨ BufferedReader çš„ close() æ–¹æ³•æ—¶ä¼šå»è°ƒç”¨ Reader çš„ close() æ–¹æ³•
    // å› æ­¤åªè¦ä¸€ä¸ª close() è°ƒç”¨å³å¯
    bufferedReader.close();
}
```

> å¾®ä¿¡æœç´¢ã€Š**æ²‰é»˜ç‹äºŒ**ã€‹æˆ–è€…å¾®ä¿¡æ‰«ä¸‹é¢çš„äºŒç»´ç ï¼Œå…³æ³¨åå›å¤ã€Š**java**ã€‹å³å¯è·å–æœ€æ–°çš„ PDF ç‰ˆæœ¬ã€‚

![æ‰‹æœºç«¯å¯ä»¥é•¿æŒ‰è¯†åˆ«](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

### äº”ã€å¯¹è±¡æ“ä½œ

#### åºåˆ—åŒ–

åºåˆ—åŒ–å°±æ˜¯å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆå­—èŠ‚åºåˆ—ï¼Œæ–¹ä¾¿å­˜å‚¨å’Œä¼ è¾“ã€‚

- åºåˆ—åŒ–ï¼š`ObjectOutputStream.writeObject()`
- ååºåˆ—åŒ–ï¼š`ObjectInputStream.readObject()`

ä¸ä¼šå¯¹é™æ€å˜é‡è¿›è¡Œåºåˆ—åŒ–ï¼Œå› ä¸ºåºåˆ—åŒ–åªæ˜¯ä¿å­˜å¯¹è±¡çš„çŠ¶æ€ï¼Œé™æ€å˜é‡å±äºç±»çš„çŠ¶æ€ã€‚

æ¨èé˜…è¯»ï¼š[Java åºåˆ—æµï¼šJava å¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–](https://javabetter.cn/io/serialize.html)

#### Serializable

åºåˆ—åŒ–çš„ç±»éœ€è¦å®ç° Serializable æ¥å£ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæ ‡å‡†ï¼Œæ²¡æœ‰ä»»ä½•æ–¹æ³•éœ€è¦å®ç°ï¼Œä½†æ˜¯å¦‚æœä¸å»å®ç°å®ƒçš„è¯è€Œè¿›è¡Œåºåˆ—åŒ–ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

```java
public static void main(String[] args) throws IOException, ClassNotFoundException {

    A a1 = new A(123, "abc");
    String objectFile = "file/a1";

    ObjectOutputStream objectOutputStream = new ObjectOutputStream(new FileOutputStream(objectFile));
    objectOutputStream.writeObject(a1);
    objectOutputStream.close();

    ObjectInputStream objectInputStream = new ObjectInputStream(new FileInputStream(objectFile));
    A a2 = (A) objectInputStream.readObject();
    objectInputStream.close();
    System.out.println(a2);
}

private static class A implements Serializable {

    private int x;
    private String y;

    A(int x, String y) {
        this.x = x;
        this.y = y;
    }

    @Override
    public String toString() {
        return "x = " + x + "  " + "y = " + y;
    }
}
```

æ¨èé˜…è¯»ï¼š[Java Serializable æ¥å£ï¼šæ˜æ˜å°±ä¸€ä¸ªç©ºçš„æ¥å£å˜›](https://javabetter.cn/io/Serializbale.html)

#### transient

transient å…³é”®å­—å¯ä»¥ä½¿ä¸€äº›å±æ€§ï¼ˆå­—æ®µï¼‰ä¸ä¼šè¢«åºåˆ—åŒ–ã€‚

ArrayList ä¸­å­˜å‚¨æ•°æ®çš„æ•°ç»„ elementData æ˜¯ç”¨ transient ä¿®é¥°çš„ï¼Œå› ä¸ºè¿™ä¸ªæ•°ç»„æ˜¯åŠ¨æ€æ‰©å±•çš„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç©ºé—´éƒ½è¢«ä½¿ç”¨ï¼Œå› æ­¤å°±ä¸éœ€è¦æ‰€æœ‰çš„å†…å®¹éƒ½è¢«åºåˆ—åŒ–ã€‚

é€šè¿‡é‡å†™åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ–¹æ³•ï¼Œä½¿å¾—å¯ä»¥åªåºåˆ—åŒ–æ•°ç»„ä¸­æœ‰å†…å®¹çš„é‚£éƒ¨åˆ†æ•°æ®ã€‚

```java
private transient Object[] elementData;
```

æ¨èé˜…è¯»ï¼š[æ·±å…¥æ¢è®¨ Java transient å…³é”®å­—](https://javabetter.cn/io/transient.html)

### å…­ã€ç½‘ç»œæ“ä½œ

Java ä¸­çš„ç½‘ç»œæ”¯æŒï¼š

- InetAddressï¼šç”¨äºè¡¨ç¤ºç½‘ç»œä¸Šçš„ç¡¬ä»¶èµ„æºï¼Œå³ IP åœ°å€ï¼›
- URLï¼šç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼›
- Socketsï¼šä½¿ç”¨ TCP åè®®å®ç°ç½‘ç»œé€šä¿¡ï¼›
- Datagramï¼šä½¿ç”¨ UDP åè®®å®ç°ç½‘ç»œé€šä¿¡ã€‚

#### InetAddress

æ²¡æœ‰å…¬æœ‰çš„æ„é€ æ–¹æ³•ï¼Œåªèƒ½é€šè¿‡é™æ€æ–¹æ³•æ¥åˆ›å»ºå®ä¾‹ã€‚

```java
InetAddress.getByName(String host);
InetAddress.getByAddress(byte[] address);
```

#### URL

å¯ä»¥ç›´æ¥ä» URL ä¸­è¯»å–å­—èŠ‚æµæ•°æ®ã€‚

```java
public static void main(String[] args) throws IOException {

    URL url = new URL("https://www.javabetter.cn");

    /* å­—èŠ‚æµ */
    InputStream is = url.openStream();

    /* å­—ç¬¦æµ */
    InputStreamReader isr = new InputStreamReader(is, "utf-8");

    /* æä¾›ç¼“å­˜åŠŸèƒ½ */
    BufferedReader br = new BufferedReader(isr);

    String line;
    while ((line = br.readLine()) != null) {
        System.out.println(line);
    }

    br.close();
}
```

æ¨èé˜…è¯»ï¼š[Javaç½‘ç»œç¼–ç¨‹çš„åŸºç¡€ï¼šè®¡ç®—æœºç½‘ç»œ](https://javabetter.cn/socket/network-base.html)

#### Sockets

![cyc2018ï¼šæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ¨¡å‹](https://cdn.tobebetterjavaer.com/stutymore/java-io-20240606170549.png)

- ServerSocketï¼šæœåŠ¡å™¨ç«¯ç±»
- Socketï¼šå®¢æˆ·ç«¯ç±»
- æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é€šè¿‡ InputStream å’Œ OutputStream è¿›è¡Œè¾“å…¥è¾“å‡ºã€‚

æ¨èé˜…è¯»ï¼š[Java Socketï¼šé£é¸½ä¼ ä¹¦çš„ç½‘ç»œå¥—æ¥å­—](https://javabetter.cn/socket/socket.html)

#### Datagram

- DatagramSocketï¼šé€šä¿¡ç±»
- DatagramPacketï¼šæ•°æ®åŒ…ç±»

### ä¸ƒã€NIO

æ–°çš„è¾“å…¥/è¾“å‡º (NIO) åº“æ˜¯åœ¨ JDK 1.4 ä¸­å¼•å…¥çš„ï¼Œå¼¥è¡¥äº†åŸæ¥ I/O çš„ä¸è¶³ï¼Œæä¾›äº†é«˜é€Ÿçš„ã€é¢å‘å—çš„ I/Oã€‚

#### æµä¸å—

I/O ä¸ NIO æœ€é‡è¦çš„åŒºåˆ«æ˜¯æ•°æ®æ‰“åŒ…å’Œä¼ è¾“çš„æ–¹å¼ï¼ŒI/O ä»¥æµçš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œè€Œ NIO ä»¥å—çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚

é¢å‘æµçš„ I/O ä¸€æ¬¡å¤„ç†ä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼šä¸€ä¸ªè¾“å…¥æµäº§ç”Ÿä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼Œä¸€ä¸ªè¾“å‡ºæµæ¶ˆè´¹ä¸€ä¸ªå­—èŠ‚æ•°æ®ã€‚ä¸ºæµå¼æ•°æ®åˆ›å»ºè¿‡æ»¤å™¨éå¸¸å®¹æ˜“ï¼Œé“¾æ¥å‡ ä¸ªè¿‡æ»¤å™¨ï¼Œä»¥ä¾¿æ¯ä¸ªè¿‡æ»¤å™¨åªè´Ÿè´£å¤æ‚å¤„ç†æœºåˆ¶çš„ä¸€éƒ¨åˆ†ã€‚ä¸åˆ©çš„ä¸€é¢æ˜¯ï¼Œé¢å‘æµçš„ I/O é€šå¸¸ç›¸å½“æ…¢ã€‚

é¢å‘å—çš„ I/O ä¸€æ¬¡å¤„ç†ä¸€ä¸ªæ•°æ®å—ï¼ŒæŒ‰å—å¤„ç†æ•°æ®æ¯”æŒ‰æµå¤„ç†æ•°æ®è¦å¿«å¾—å¤šã€‚ä½†æ˜¯é¢å‘å—çš„ I/O ç¼ºå°‘ä¸€äº›é¢å‘æµçš„ I/O æ‰€å…·æœ‰çš„ä¼˜é›…æ€§å’Œç®€å•æ€§ã€‚

I/O åŒ…å’Œ NIO å·²ç»å¾ˆå¥½åœ°é›†æˆäº†ï¼Œjava.io.\* å·²ç»ä»¥ NIO ä¸ºåŸºç¡€é‡æ–°å®ç°äº†ï¼Œæ‰€ä»¥ç°åœ¨å®ƒå¯ä»¥åˆ©ç”¨ NIO çš„ä¸€äº›ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼Œjava.io.\* åŒ…ä¸­çš„ä¸€äº›ç±»åŒ…å«ä»¥å—çš„å½¢å¼è¯»å†™æ•°æ®çš„æ–¹æ³•ï¼Œè¿™ä½¿å¾—å³ä½¿åœ¨é¢å‘æµçš„ç³»ç»Ÿä¸­ï¼Œå¤„ç†é€Ÿåº¦ä¹Ÿä¼šæ›´å¿«ã€‚

#### é€šé“ä¸ç¼“å†²åŒº

##### 1. é€šé“

é€šé“ Channel æ˜¯å¯¹åŸ I/O åŒ…ä¸­æµçš„æ¨¡æ‹Ÿï¼Œå¯ä»¥é€šè¿‡å®ƒè¯»å–å’Œå†™å…¥æ•°æ®ã€‚

é€šé“ä¸æµçš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œæµåªèƒ½åœ¨ä¸€ä¸ªæ–¹å‘ä¸Šç§»åŠ¨(ä¸€ä¸ªæµå¿…é¡»æ˜¯ InputStream æˆ–è€… OutputStream çš„å­ç±»)ï¼Œè€Œé€šé“æ˜¯åŒå‘çš„ï¼Œå¯ä»¥ç”¨äºè¯»ã€å†™æˆ–è€…åŒæ—¶ç”¨äºè¯»å†™ã€‚

é€šé“åŒ…æ‹¬ä»¥ä¸‹ç±»å‹ï¼š

- FileChannelï¼šä»æ–‡ä»¶ä¸­è¯»å†™æ•°æ®ï¼›
- DatagramChannelï¼šé€šè¿‡ UDP è¯»å†™ç½‘ç»œä¸­æ•°æ®ï¼›
- SocketChannelï¼šé€šè¿‡ TCP è¯»å†™ç½‘ç»œä¸­æ•°æ®ï¼›
- ServerSocketChannelï¼šå¯ä»¥ç›‘å¬æ–°è¿›æ¥çš„ TCP è¿æ¥ï¼Œå¯¹æ¯ä¸€ä¸ªæ–°è¿›æ¥çš„è¿æ¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ª SocketChannelã€‚

##### 2. ç¼“å†²åŒº

å‘é€ç»™é€šé“çš„æ‰€æœ‰æ•°æ®éƒ½å¿…é¡»é¦–å…ˆæ”¾åˆ°ç¼“å†²åŒºä¸­ï¼ŒåŒæ ·åœ°ï¼Œä»é€šé“ä¸­è¯»å–çš„ä»»ä½•æ•°æ®éƒ½è¦å…ˆè¯»åˆ°ç¼“å†²åŒºä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ä¼šç›´æ¥å¯¹é€šé“è¿›è¡Œè¯»å†™æ•°æ®ï¼Œè€Œæ˜¯è¦å…ˆç»è¿‡ç¼“å†²åŒºã€‚

ç¼“å†²åŒºå®è´¨ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä½†å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚ç¼“å†²åŒºæä¾›äº†å¯¹æ•°æ®çš„ç»“æ„åŒ–è®¿é—®ï¼Œè€Œä¸”è¿˜å¯ä»¥è·Ÿè¸ªç³»ç»Ÿçš„è¯»/å†™è¿›ç¨‹ã€‚

ç¼“å†²åŒºåŒ…æ‹¬ä»¥ä¸‹ç±»å‹ï¼š

- ByteBuffer
- CharBuffer
- ShortBuffer
- IntBuffer
- LongBuffer
- FloatBuffer
- DoubleBuffer

#### ç¼“å†²åŒºçŠ¶æ€å˜é‡

- capacityï¼šæœ€å¤§å®¹é‡ï¼›
- positionï¼šå½“å‰å·²ç»è¯»å†™çš„å­—èŠ‚æ•°ï¼›
- limitï¼šè¿˜å¯ä»¥è¯»å†™çš„å­—èŠ‚æ•°ã€‚

çŠ¶æ€å˜é‡çš„æ”¹å˜è¿‡ç¨‹ä¸¾ä¾‹ï¼š

â‘  æ–°å»ºä¸€ä¸ªå¤§å°ä¸º 8 ä¸ªå­—èŠ‚çš„ç¼“å†²åŒºï¼Œæ­¤æ—¶ position ä¸º 0ï¼Œè€Œ limit = capacity = 8ã€‚capacity å˜é‡ä¸ä¼šæ”¹å˜ï¼Œä¸‹é¢çš„è®¨è®ºä¼šå¿½ç•¥å®ƒã€‚

![cyc2018ï¼šlimit = capacity](https://cdn.tobebetterjavaer.com/stutymore/java-io-20240606180609.png)

â‘¡ ä»è¾“å…¥é€šé“ä¸­è¯»å– 5 ä¸ªå­—èŠ‚æ•°æ®å†™å…¥ç¼“å†²åŒºä¸­ï¼Œæ­¤æ—¶ position ä¸º 5ï¼Œlimit ä¿æŒä¸å˜ã€‚

![cyc2018ï¼šposition ä¸å˜](https://cdn.tobebetterjavaer.com/stutymore/java-io-20240606180749.png)

â‘¢ åœ¨å°†ç¼“å†²åŒºçš„æ•°æ®å†™åˆ°è¾“å‡ºé€šé“ä¹‹å‰ï¼Œéœ€è¦å…ˆè°ƒç”¨ `flip()` æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°† limit è®¾ç½®ä¸ºå½“å‰ positionï¼Œå¹¶å°† position è®¾ç½®ä¸º 0ã€‚

![cyc2018ï¼šlimit å’Œ position é‡æ–°æ”¹å˜](https://cdn.tobebetterjavaer.com/stutymore/java-io-20240606180846.png)

â‘£ ä»ç¼“å†²åŒºä¸­å– 4 ä¸ªå­—èŠ‚åˆ°è¾“å‡ºç¼“å†²ä¸­ï¼Œæ­¤æ—¶ position è®¾ä¸º 4ã€‚

![cyc2018ï¼šè¯»å– 4 ä¸ªå­—èŠ‚](https://cdn.tobebetterjavaer.com/stutymore/java-io-20240606180919.png)

â‘¤ æœ€åéœ€è¦è°ƒç”¨ `clear()` æ–¹æ³•æ¥æ¸…ç©ºç¼“å†²åŒºï¼Œæ­¤æ—¶ position å’Œ limit éƒ½è¢«è®¾ç½®ä¸ºæœ€åˆä½ç½®ã€‚

![cyc2018ï¼šæ¢å¤åˆ°åˆå§‹çŠ¶æ€](https://cdn.tobebetterjavaer.com/stutymore/java-io-20240606180948.png)

æ¨èé˜…è¯»ï¼š[è¯¦è§£Java NIOçš„Bufferç¼“å†²åŒºå’ŒChannelé€šé“](https://javabetter.cn/nio/buffer-channel.html)

#### æ–‡ä»¶ NIO å®ä¾‹

ä»¥ä¸‹å±•ç¤ºäº†ä½¿ç”¨ NIO å¿«é€Ÿå¤åˆ¶æ–‡ä»¶çš„å®ä¾‹ï¼š

```java
public static void fastCopy(String src, String dist) throws IOException {

    /* è·å¾—æºæ–‡ä»¶çš„è¾“å…¥å­—èŠ‚æµ */
    FileInputStream fin = new FileInputStream(src);

    /* è·å–è¾“å…¥å­—èŠ‚æµçš„æ–‡ä»¶é€šé“ */
    FileChannel fcin = fin.getChannel();

    /* è·å–ç›®æ ‡æ–‡ä»¶çš„è¾“å‡ºå­—èŠ‚æµ */
    FileOutputStream fout = new FileOutputStream(dist);

    /* è·å–è¾“å‡ºå­—èŠ‚æµçš„æ–‡ä»¶é€šé“ */
    FileChannel fcout = fout.getChannel();

    /* ä¸ºç¼“å†²åŒºåˆ†é… 1024 ä¸ªå­—èŠ‚ */
    ByteBuffer buffer = ByteBuffer.allocateDirect(1024);

    while (true) {

        /* ä»è¾“å…¥é€šé“ä¸­è¯»å–æ•°æ®åˆ°ç¼“å†²åŒºä¸­ */
        int r = fcin.read(buffer);

        /* read() è¿”å› -1 è¡¨ç¤º EOF */
        if (r == -1) {
            break;
        }

        /* åˆ‡æ¢è¯»å†™ */
        buffer.flip();

        /* æŠŠç¼“å†²åŒºçš„å†…å®¹å†™å…¥è¾“å‡ºæ–‡ä»¶ä¸­ */
        fcout.write(buffer);

        /* æ¸…ç©ºç¼“å†²åŒº */
        buffer.clear();
    }
}
```

#### é€‰æ‹©å™¨

NIO å¸¸å¸¸è¢«å«åšéé˜»å¡ IOï¼Œä¸»è¦æ˜¯å› ä¸º NIO åœ¨ç½‘ç»œé€šä¿¡ä¸­çš„éé˜»å¡ç‰¹æ€§è¢«å¹¿æ³›ä½¿ç”¨ã€‚

NIO å®ç°äº† IO å¤šè·¯å¤ç”¨ä¸­çš„ Reactor æ¨¡å‹ï¼Œä¸€ä¸ªçº¿ç¨‹ Thread ä½¿ç”¨ä¸€ä¸ªé€‰æ‹©å™¨ Selector é€šè¿‡è½®è¯¢çš„æ–¹å¼å»ç›‘å¬å¤šä¸ªé€šé“ Channel ä¸Šçš„äº‹ä»¶ï¼Œä»è€Œè®©ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å¤„ç†å¤šä¸ªäº‹ä»¶ã€‚

é€šè¿‡é…ç½®ç›‘å¬çš„é€šé“ Channel ä¸ºéé˜»å¡ï¼Œé‚£ä¹ˆå½“ Channel ä¸Šçš„ IO äº‹ä»¶è¿˜æœªåˆ°è¾¾æ—¶ï¼Œå°±ä¸ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ä¸€ç›´ç­‰å¾…ï¼Œè€Œæ˜¯ç»§ç»­è½®è¯¢å…¶å®ƒ Channelï¼Œæ‰¾åˆ° IO äº‹ä»¶å·²ç»åˆ°è¾¾çš„ Channel æ‰§è¡Œã€‚

å› ä¸ºåˆ›å»ºå’Œåˆ‡æ¢çº¿ç¨‹çš„å¼€é”€å¾ˆå¤§ï¼Œå› æ­¤ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†å¤šä¸ªäº‹ä»¶è€Œä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªäº‹ä»¶ï¼Œå¯¹äº IO å¯†é›†å‹çš„åº”ç”¨å…·æœ‰å¾ˆå¥½åœ°æ€§èƒ½ã€‚

åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰ SocketChannel æ‰èƒ½é…ç½®ä¸ºéé˜»å¡ï¼ŒFileChannel ä¸èƒ½ï¼Œä¸º FileChannel é…ç½®éé˜»å¡ä¹Ÿæ²¡æœ‰æ„ä¹‰ã€‚

![CYC2018ï¼šIO å¤šè·¯å¤ç”¨](https://cdn.tobebetterjavaer.com/stutymore/java-io-20240606181154.png)

##### 1. åˆ›å»ºé€‰æ‹©å™¨

```java
Selector selector = Selector.open();
```

##### 2. å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š

```java
ServerSocketChannel ssChannel = ServerSocketChannel.open();
ssChannel.configureBlocking(false);
ssChannel.register(selector, SelectionKey.OP_ACCEPT);
```

é€šé“å¿…é¡»é…ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œå¦åˆ™ä½¿ç”¨é€‰æ‹©å™¨å°±æ²¡æœ‰ä»»ä½•æ„ä¹‰äº†ï¼Œå› ä¸ºå¦‚æœé€šé“åœ¨æŸä¸ªäº‹ä»¶ä¸Šè¢«é˜»å¡ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¸èƒ½å“åº”å…¶å®ƒäº‹ä»¶ï¼Œå¿…é¡»ç­‰å¾…è¿™ä¸ªäº‹ä»¶å¤„ç†å®Œæ¯•æ‰èƒ½å»å¤„ç†å…¶å®ƒäº‹ä»¶ï¼Œæ˜¾ç„¶è¿™å’Œé€‰æ‹©å™¨çš„ä½œç”¨èƒŒé“è€Œé©°ã€‚

åœ¨å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šæ—¶ï¼Œè¿˜éœ€è¦æŒ‡å®šè¦æ³¨å†Œçš„å…·ä½“äº‹ä»¶ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç±»ï¼š

- SelectionKey.OP_CONNECT
- SelectionKey.OP_ACCEPT
- SelectionKey.OP_READ
- SelectionKey.OP_WRITE

å®ƒä»¬åœ¨ SelectionKey çš„å®šä¹‰å¦‚ä¸‹ï¼š

```java
public static final int OP_READ = 1 << 0;
public static final int OP_WRITE = 1 << 2;
public static final int OP_CONNECT = 1 << 3;
public static final int OP_ACCEPT = 1 << 4;
```

å¯ä»¥çœ‹å‡ºæ¯ä¸ªäº‹ä»¶å¯ä»¥è¢«å½“æˆä¸€ä¸ªä½åŸŸï¼Œä»è€Œç»„æˆäº‹ä»¶é›†æ•´æ•°ã€‚ä¾‹å¦‚ï¼š

```java
int interestSet = SelectionKey.OP_READ | SelectionKey.OP_WRITE;
```

##### 3. ç›‘å¬äº‹ä»¶

```java
int num = selector.select();
```

ä½¿ç”¨ `select()` æ¥ç›‘å¬åˆ°è¾¾çš„äº‹ä»¶ï¼Œå®ƒä¼šä¸€ç›´é˜»å¡ç›´åˆ°æœ‰è‡³å°‘ä¸€ä¸ªäº‹ä»¶åˆ°è¾¾ã€‚

##### 4. è·å–åˆ°è¾¾çš„äº‹ä»¶

```java
Set<SelectionKey> keys = selector.selectedKeys();
Iterator<SelectionKey> keyIterator = keys.iterator();
while (keyIterator.hasNext()) {
    SelectionKey key = keyIterator.next();
    if (key.isAcceptable()) {
        // ...
    } else if (key.isReadable()) {
        // ...
    }
    keyIterator.remove();
}
```

##### 5. äº‹ä»¶å¾ªç¯

å› ä¸ºä¸€æ¬¡ `select()` è°ƒç”¨ä¸èƒ½å¤„ç†å®Œæ‰€æœ‰çš„äº‹ä»¶ï¼Œå¹¶ä¸”æœåŠ¡å™¨ç«¯æœ‰å¯èƒ½éœ€è¦ä¸€ç›´ç›‘å¬äº‹ä»¶ï¼Œå› æ­¤æœåŠ¡å™¨ç«¯å¤„ç†äº‹ä»¶çš„ä»£ç ä¸€èˆ¬ä¼šæ”¾åœ¨ä¸€ä¸ªæ­»å¾ªç¯å†…ã€‚

```java
while (true) {
    int num = selector.select();
    Set<SelectionKey> keys = selector.selectedKeys();
    Iterator<SelectionKey> keyIterator = keys.iterator();
    while (keyIterator.hasNext()) {
        SelectionKey key = keyIterator.next();
        if (key.isAcceptable()) {
            // ...
        } else if (key.isReadable()) {
            // ...
        }
        keyIterator.remove();
    }
}
```

#### å¥—æ¥å­— NIO å®ä¾‹

```java
public class NIOServer {

    public static void main(String[] args) throws IOException {

        Selector selector = Selector.open();

        ServerSocketChannel ssChannel = ServerSocketChannel.open();
        ssChannel.configureBlocking(false);
        ssChannel.register(selector, SelectionKey.OP_ACCEPT);

        ServerSocket serverSocket = ssChannel.socket();
        InetSocketAddress address = new InetSocketAddress("127.0.0.1", 8888);
        serverSocket.bind(address);

        while (true) {

            selector.select();
            Set<SelectionKey> keys = selector.selectedKeys();
            Iterator<SelectionKey> keyIterator = keys.iterator();

            while (keyIterator.hasNext()) {

                SelectionKey key = keyIterator.next();

                if (key.isAcceptable()) {

                    ServerSocketChannel ssChannel1 = (ServerSocketChannel) key.channel();

                    // æœåŠ¡å™¨ä¼šä¸ºæ¯ä¸ªæ–°è¿æ¥åˆ›å»ºä¸€ä¸ª SocketChannel
                    SocketChannel sChannel = ssChannel1.accept();
                    sChannel.configureBlocking(false);

                    // è¿™ä¸ªæ–°è¿æ¥ä¸»è¦ç”¨äºä»å®¢æˆ·ç«¯è¯»å–æ•°æ®
                    sChannel.register(selector, SelectionKey.OP_READ);

                } else if (key.isReadable()) {

                    SocketChannel sChannel = (SocketChannel) key.channel();
                    System.out.println(readDataFromSocketChannel(sChannel));
                    sChannel.close();
                }

                keyIterator.remove();
            }
        }
    }

    private static String readDataFromSocketChannel(SocketChannel sChannel) throws IOException {

        ByteBuffer buffer = ByteBuffer.allocate(1024);
        StringBuilder data = new StringBuilder();

        while (true) {

            buffer.clear();
            int n = sChannel.read(buffer);
            if (n == -1) {
                break;
            }
            buffer.flip();
            int limit = buffer.limit();
            char[] dst = new char[limit];
            for (int i = 0; i < limit; i++) {
                dst[i] = (char) buffer.get(i);
            }
            data.append(dst);
            buffer.clear();
        }
        return data.toString();
    }
}
```

å®¢æˆ·ç«¯ï¼š

```java
public class NIOClient {

    public static void main(String[] args) throws IOException {
        Socket socket = new Socket("127.0.0.1", 8888);
        OutputStream out = socket.getOutputStream();
        String s = "hello world";
        out.write(s.getBytes());
        out.close();
    }
}
```

æ¨èé˜…è¯»ï¼š[ä¸€æ–‡å½»åº•ç†è§£Java IOæ¨¡å‹](https://javabetter.cn/nio/moxing.html)

#### å†…å­˜æ˜ å°„æ–‡ä»¶

å†…å­˜æ˜ å°„æ–‡ä»¶ I/O æ˜¯ä¸€ç§è¯»å’Œå†™æ–‡ä»¶æ•°æ®çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥æ¯”å¸¸è§„çš„åŸºäºæµæˆ–è€…åŸºäºé€šé“çš„ I/O å¿«å¾—å¤šã€‚

å‘å†…å­˜æ˜ å°„æ–‡ä»¶å†™å…¥å¯èƒ½æ˜¯å±é™©çš„ï¼Œåªæ˜¯æ”¹å˜æ•°ç»„çš„å•ä¸ªå…ƒç´ è¿™æ ·çš„ç®€å•æ“ä½œï¼Œå°±å¯èƒ½ä¼šç›´æ¥ä¿®æ”¹ç£ç›˜ä¸Šçš„æ–‡ä»¶ã€‚ä¿®æ”¹æ•°æ®ä¸å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜æ˜¯æ²¡æœ‰åˆ†å¼€çš„ã€‚

ä¸‹é¢ä»£ç è¡Œå°†æ–‡ä»¶çš„å‰ 1024 ä¸ªå­—èŠ‚æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œ`map()` æ–¹æ³•è¿”å›ä¸€ä¸ª MappedByteBufferï¼Œå®ƒæ˜¯ ByteBuffer çš„å­ç±»ã€‚å› æ­¤ï¼Œå¯ä»¥åƒä½¿ç”¨å…¶ä»–ä»»ä½• ByteBuffer ä¸€æ ·ä½¿ç”¨æ–°æ˜ å°„çš„ç¼“å†²åŒºï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨éœ€è¦æ—¶è´Ÿè´£æ‰§è¡Œæ˜ å°„ã€‚

```java
MappedByteBuffer mbb = fc.map(FileChannel.MapMode.READ_WRITE, 0, 1024);
```

#### å¯¹æ¯”

NIO ä¸æ™®é€š I/O çš„åŒºåˆ«ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š

- NIO æ˜¯éé˜»å¡çš„ï¼›
- NIO é¢å‘å—ï¼ŒI/O é¢å‘æµã€‚

### å…«ã€å‚è€ƒèµ„æ–™

[https://github.com/CyC2018/CS-Notes/](https://github.com/CyC2018/CS-Notes/blob/master/notes/Java%20%E5%AE%B9%E5%99%A8.md)

> å¾®ä¿¡æœç´¢ã€Š**æ²‰é»˜ç‹äºŒ**ã€‹æˆ–è€…å¾®ä¿¡æ‰«ä¸‹é¢çš„äºŒç»´ç ï¼Œå…³æ³¨åå›å¤ã€Š**java**ã€‹å³å¯è·å–æœ€æ–°çš„ PDF ç‰ˆæœ¬ã€‚

![æ‰‹æœºç«¯å¯ä»¥é•¿æŒ‰è¯†åˆ«](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## èŠ±çµ®

è¯¥ PDF æ–‡æ¡£æ˜¯æˆ‘åœ¨å­¦ä¹  CSNotes æ—¶çš„ä¸€äº›ä¼˜åŒ–å’Œè¡¥å……ï¼ŒåŠ äº†å¾ˆå¤šäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ä¸Šçš„å†…å®¹ï¼Œå¯ä»¥è¿›è¡Œå¾ˆå¥½çš„äº’è¡¥ã€‚æ•´ç†ä¸æ˜“ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°å¤§å®¶ï¼ˆâ¤ï¸ï¼‰ã€‚

æœ€æ–°ç‰ˆæ›´æ–°å®Œæˆåæˆ‘ä¼šæ”¾åˆ°ç½‘ç›˜ä¸­ï¼Œå¾®ä¿¡æœç´¢ã€Š**æ²‰é»˜ç‹äºŒ**ã€‹æˆ–è€…å¾®ä¿¡æ‰«ä¸‹é¢çš„äºŒç»´ç ï¼Œå…³æ³¨åå›å¤ã€Š**Java**ã€‹å³å¯è·å–æœ€æ–°çš„ PDF ç‰ˆæœ¬ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

é™„å…¶ä»–å¹²è´§ç¬”è®°ä¸‹è½½åœ°å€ï¼š

- [äºŒå“¥çš„ Linux é€ŸæŸ¥å¤‡å¿˜æ‰‹å†Œ PDF ä¸‹è½½](https://javabetter.cn/pdf/linux.html)
- [é˜®ä¸€å³° C è¯­è¨€å…¥é—¨æ•™ç¨‹ PDF ä¸‹è½½](https://javabetter.cn/pdf/yuanyifeng-c-language.html)
- [Java æ ¸å¿ƒçŸ¥è¯†ç‚¹æ•´ç† PDF ä¸‹è½½](https://javabetter.cn/pdf/github-java-jiaocheng-115-star.html)
- [æ·±å…¥æµ…å‡º Java å¤šçº¿ç¨‹ PDF ä¸‹è½½](https://javabetter.cn/pdf/java-concurrent.html)
- [Pro Git ä¸­æ–‡ç‰ˆ PDF ä¸‹è½½](https://javabetter.cn/pdf/progit.html)
- [ç»™æ“ä½œç³»ç»Ÿæ‹æ¡çº¿ PDF ä¸‹è½½](https://javabetter.cn/pdf/os.html)

## ç¬¬ä¸‰ç« ã€å®¹å™¨/é›†åˆæ¡†æ¶

### ä¸€ã€æ¦‚è§ˆ

å®¹å™¨ï¼Œä¹Ÿå«é›†åˆæ¡†æ¶ï¼Œä¸»è¦åŒ…æ‹¬ Collection å’Œ Mapï¼ŒCollection åˆç»†åˆ†ä¸º Setã€List å’Œ Queueï¼ŒSet ä¸å¸¸ç”¨ï¼ŒList ä¹Ÿå°±æ˜¯åˆ—è¡¨ï¼ŒQueue æ˜¯é˜Ÿåˆ—ï¼›Map æ˜¯é”®å€¼å¯¹é›†åˆã€‚

![äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯-å®¹å™¨æ¦‚è§ˆ](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/gailan-01.png)

æ¨èé˜…è¯»ï¼š[Javaé›†åˆæ¡†æ¶å…¨é¢è§£æ](https://javabetter.cn/collection/gailan.html)

#### Collection

##### 1. Set

- TreeSetï¼šåŸºäºçº¢é»‘æ ‘å®ç°ï¼Œæ”¯æŒæœ‰åºæ“ä½œï¼Œä¾‹å¦‚æ ¹æ®ä¸€ä¸ªèŒƒå›´æŸ¥æ‰¾å…ƒç´ çš„æ“ä½œã€‚ä½†æ˜¯æŸ¥æ‰¾æ•ˆç‡ä¸å¦‚ HashSetï¼ŒHashSet æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ä¸º `O(1)`ï¼ŒTreeSet åˆ™ä¸º `O(logN)`ã€‚
- HashSetï¼šåŸºäºå“ˆå¸Œè¡¨å®ç°ï¼Œæ”¯æŒå¿«é€ŸæŸ¥æ‰¾ï¼Œä½†ä¸æ”¯æŒæœ‰åºæ€§æ“ä½œã€‚å¹¶ä¸”å¤±å»äº†å…ƒç´ çš„æ’å…¥é¡ºåºï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨ Iterator éå† HashSet å¾—åˆ°çš„ç»“æœæ˜¯ä¸ç¡®å®šçš„ã€‚
- LinkedHashSetï¼šå…·æœ‰ HashSet çš„æŸ¥æ‰¾æ•ˆç‡ï¼Œå¹¶ä¸”å†…éƒ¨ä½¿ç”¨åŒå‘é“¾è¡¨ç»´æŠ¤å…ƒç´ çš„æ’å…¥é¡ºåºã€‚

##### 2. List

- [ArrayList](https://javabetter.cn/collection/arraylist.html)ï¼šåŸºäºåŠ¨æ€æ•°ç»„å®ç°ï¼Œæ”¯æŒéšæœºè®¿é—®ã€‚
- Vectorï¼šå’Œ ArrayList ç±»ä¼¼ï¼Œä½†å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå‡ ä¹å·²æ·˜æ±°ã€‚
- [LinkedList](https://javabetter.cn/collection/linkedlist.html)ï¼šåŸºäºåŒå‘é“¾è¡¨å®ç°ï¼Œåªèƒ½é¡ºåºè®¿é—®ï¼Œä½†æ˜¯å¯ä»¥å¿«é€Ÿåœ°åœ¨é“¾è¡¨ä¸­é—´æ’å…¥å’Œåˆ é™¤å…ƒç´ ã€‚ä¸ä»…å¦‚æ­¤ï¼ŒLinkedList è¿˜å¯ä»¥ç”¨ä½œæ ˆã€é˜Ÿåˆ—ã€‚

##### 3. Queue

- LinkedListï¼šæ„ä¸æ„å¤–ï¼ŒLinkedList ä¹Ÿå¯ä»¥ç”¨å®ƒæ¥å®ç°åŒå‘é˜Ÿåˆ—ã€‚
- [PriorityQueue](https://javabetter.cn/collection/PriorityQueue.html)ï¼šåŸºäºå †ç»“æ„å®ç°ï¼Œå¯ä»¥ç”¨å®ƒæ¥å®ç°ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚
- [ArrayDeque](https://javabetter.cn/collection/arraydeque.html)ï¼šåŒç«¯é˜Ÿåˆ—ï¼Œå¯ä»¥ç”¨æ¥å–ä»£ä»¥å‰çš„ Stackã€‚

#### Map

- [TreeMap](https://javabetter.cn/collection/treemap.html)ï¼šåŸºäºçº¢é»‘æ ‘å®ç°ã€‚
- [HashMap](https://javabetter.cn/collection/hashmap.html)ï¼šåŸºäºå“ˆå¸Œè¡¨å®ç°ã€‚
- HashTableï¼šå’Œ HashMap ç±»ä¼¼ï¼Œä½†å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¿™æ„å‘³ç€åŒä¸€æ—¶åˆ»å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™å…¥ HashTable ä¸ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚å®ƒæ˜¯é—ç•™ç±»ï¼Œå·²ä¸æ¨èä½¿ç”¨ï¼Œæ›¿ä»£å“æ˜¯ [ConcurrentHashMap](https://javabetter.cn/thread/ConcurrentHashMap.html)ã€‚
- [LinkedHashMap](https://javabetter.cn/collection/linkedhashmap.html)ï¼šä½¿ç”¨åŒå‘é“¾è¡¨æ¥ç»´æŠ¤å…ƒç´ çš„é¡ºåºï¼Œé¡ºåºä¸ºæ’å…¥é¡ºåºæˆ–è€…æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰é¡ºåºã€‚

### äºŒã€å®¹å™¨ä¸­çš„è®¾è®¡æ¨¡å¼

#### è¿­ä»£å™¨æ¨¡å¼

Collection ç»§æ‰¿äº† Iterable æ¥å£ï¼Œå…¶ä¸­çš„ `iterator()` æ–¹æ³•èƒ½å¤Ÿäº§ç”Ÿä¸€ä¸ª Iterator å¯¹è±¡ï¼Œé€šè¿‡è¿™ä¸ªå¯¹è±¡å°±å¯ä»¥è¿­ä»£éå† Collection ä¸­çš„å…ƒç´ ã€‚

![CYC2018-è¿­ä»£å™¨](https://cdn.tobebetterjavaer.com/stutymore/java-collection-20240606160103.png)

JDK 1.5 ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ foreach æ¥éå†é›†åˆï¼Œéå¸¸æ–¹ä¾¿ã€‚

```java
List<String> list = new ArrayList<>();
list.add("a");
list.add("b");
for (String item : list) {
    System.out.println(item);
}
```

æ¨èé˜…è¯»ï¼š[Javaè¿­ä»£å™¨Iteratorå’ŒIterableæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ](https://javabetter.cn/collection/iterator-iterable.html)

#### é€‚é…å™¨æ¨¡å¼

`java.util.Arrays#asList()` å¯ä»¥æŠŠæ•°ç»„ç±»å‹è½¬æ¢ä¸º List ç±»å‹ã€‚

```java
@SafeVarargs
public static <T> List<T> asList(T... a)
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`asList()` çš„å‚æ•°ä¸ºæ³›å‹çš„å˜é•¿å‚æ•°ï¼Œä¸èƒ½ä½¿ç”¨åŸºæœ¬æ•°æ®ç±»å‹çš„æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œåªèƒ½ä½¿ç”¨ç›¸åº”çš„åŒ…è£…å™¨ç±»å‹æ•°ç»„ã€‚

```java
Integer[] arr = {1, 2, 3};
List list = Arrays.asList(arr);
```

ä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼è°ƒç”¨ asList()ï¼š

```java
List list = Arrays.asList(1, 2, 3);
```

> å¾®ä¿¡æœç´¢ã€Š**æ²‰é»˜ç‹äºŒ**ã€‹æˆ–è€…å¾®ä¿¡æ‰«ä¸‹é¢çš„äºŒç»´ç ï¼Œå…³æ³¨åå›å¤ã€Š**java**ã€‹å³å¯è·å–æœ€æ–°çš„ PDF ç‰ˆæœ¬ã€‚

![æ‰‹æœºç«¯å¯ä»¥é•¿æŒ‰è¯†åˆ«](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

### ä¸‰ã€æºç åˆ†æ

>å¦‚æœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œä»¥ä¸‹æºç åˆ†æå‡åŸºäº JDK 1.8ã€‚

#### ArrayList

##### 1. æ¦‚è§ˆ

å› ä¸º ArrayList æ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼Œæ‰€ä»¥æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ã€‚RandomAccess æ¥å£æ ‡è¯†è¯¥ç±»æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ã€‚

```java
public class ArrayList<E> extends AbstractList<E>
        implements List<E>, RandomAccess, Cloneable, java.io.Serializable
```

æ•°ç»„çš„é»˜è®¤å¤§å°ä¸º 10ã€‚

```java
private static final int DEFAULT_CAPACITY = 10;
```

![CYC2018ï¼šArrayList](https://cdn.tobebetterjavaer.com/stutymore/java-collection-20240606160600.png)

##### 2. æ‰©å®¹

æ·»åŠ å…ƒç´ æ—¶ï¼Œ`ensureCapacityInternal()` æ–¹æ³•ä¼šç¡®è®¤å®¹é‡æ˜¯å¦è¶³å¤Ÿï¼Œå¦‚æœä¸å¤Ÿæ—¶ï¼Œéœ€è¦ä½¿ç”¨ `grow()` æ–¹æ³•è¿›è¡Œæ‰©å®¹ï¼Œæ–°å®¹é‡çš„å¤§å°ä¸º `oldCapacity + (oldCapacity >> 1)`ï¼Œå³ `oldCapacity+oldCapacity/2`ã€‚

å…¶ä¸­ oldCapacity >> 1 éœ€è¦å–æ•´ï¼Œæ‰€ä»¥æ–°å®¹é‡å¤§çº¦æ˜¯æ—§å®¹é‡çš„ 1.5 å€å·¦å³ã€‚ï¼ˆoldCapacity ä¸ºå¶æ•°å°±æ˜¯ 1.5 å€ï¼Œä¸ºå¥‡æ•°å°±æ˜¯ 1.5 å€-0.5ï¼‰

æ‰©å®¹æ“ä½œéœ€è¦è°ƒç”¨ `Arrays.copyOf()` æŠŠåŸæ•°ç»„å¤åˆ¶åˆ°æ–°æ•°ç»„ä¸­ï¼Œè¿™ä¸ªæ“ä½œä»£ä»·å¾ˆé«˜ï¼Œå› æ­¤æœ€å¥½åœ¨åˆ›å»º ArrayList å¯¹è±¡æ—¶å°±æŒ‡å®šæ°å½“çš„å®¹é‡å¤§å°ï¼Œä»¥å‡å°‘æ‰©å®¹æ“ä½œçš„æ¬¡æ•°ã€‚

```java
public boolean add(E e) {
    ensureCapacityInternal(size + 1);  // Increments modCount!!
    elementData[size++] = e;
    return true;
}

private void ensureCapacityInternal(int minCapacity) {
    if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {
        minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);
    }
    ensureExplicitCapacity(minCapacity);
}

private void ensureExplicitCapacity(int minCapacity) {
    modCount++;
    // overflow-conscious code
    if (minCapacity - elementData.length > 0)
        grow(minCapacity);
}

private void grow(int minCapacity) {
    // overflow-conscious code
    int oldCapacity = elementData.length;
    int newCapacity = oldCapacity + (oldCapacity >> 1);
    if (newCapacity - minCapacity < 0)
        newCapacity = minCapacity;
    if (newCapacity - MAX_ARRAY_SIZE > 0)
        newCapacity = hugeCapacity(minCapacity);
    // minCapacity is usually close to size, so this is a win:
    elementData = Arrays.copyOf(elementData, newCapacity);
}
```

##### 3. åˆ é™¤å…ƒç´ 

éœ€è¦è°ƒç”¨ `System.arraycopy()` å°† index+1 åé¢çš„å…ƒç´ å¤åˆ¶åˆ° index ä½ç½®ä¸Šï¼Œè¯¥æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O(N)ï¼Œå› æ­¤ ArrayList åˆ é™¤å…ƒç´ çš„ä»£ä»·æ˜¯éå¸¸é«˜çš„ã€‚

```java
public E remove(int index) {
    rangeCheck(index);
    modCount++;
    E oldValue = elementData(index);
    int numMoved = size - index - 1;
    if (numMoved > 0)
        System.arraycopy(elementData, index+1, elementData, index, numMoved);
    elementData[--size] = null; // clear to let GC do its work
    return oldValue;
}
```

##### 4. åºåˆ—åŒ–

ArrayList åŸºäºæ•°ç»„å®ç°ï¼Œå¹¶ä¸”å…·æœ‰åŠ¨æ€æ‰©å®¹ç‰¹æ€§ï¼Œå› æ­¤ä¿å­˜å…ƒç´ çš„æ•°ç»„ä¸ä¸€å®šéƒ½ä¼šè¢«ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰å¿…è¦å…¨éƒ¨è¿›è¡Œåºåˆ—åŒ–ã€‚

ä¿å­˜å…ƒç´ çš„æ•°ç»„ elementData ä½¿ç”¨äº† transient å…³é”®å­—ä¿®é¥°ï¼Œè¯¥å…³é”®å­—å£°æ˜æ•°ç»„é»˜è®¤ä¸ä¼šè¢«åºåˆ—åŒ–ã€‚

```java
transient Object[] elementData; // non-private to simplify nested class access
```

ArrayList å®ç°äº† `writeObject()` å’Œ `readObject()` æ¥æ§åˆ¶åªåºåˆ—åŒ–æ•°ç»„ä¸­æœ‰å…ƒç´ å¡«å……çš„é‚£éƒ¨åˆ†å†…å®¹ã€‚

```java
private void readObject(java.io.ObjectInputStream s)
    throws java.io.IOException, ClassNotFoundException {
    elementData = EMPTY_ELEMENTDATA;

    // Read in size, and any hidden stuff
    s.defaultReadObject();

    // Read in capacity
    s.readInt(); // ignored

    if (size > 0) {
        // be like clone(), allocate array based upon size not capacity
        ensureCapacityInternal(size);

        Object[] a = elementData;
        // Read in all elements in the proper order.
        for (int i=0; i<size; i++) {
            a[i] = s.readObject();
        }
    }
}
```

åºåˆ—åŒ–ï¼š

```java
private void writeObject(java.io.ObjectOutputStream s)
    throws java.io.IOException{
    // Write out element count, and any hidden stuff
    int expectedModCount = modCount;
    s.defaultWriteObject();

    // Write out size as capacity for behavioural compatibility with clone()
    s.writeInt(size);

    // Write out all elements in the proper order.
    for (int i=0; i<size; i++) {
        s.writeObject(elementData[i]);
    }

    if (modCount != expectedModCount) {
        throw new ConcurrentModificationException();
    }
}
```

åºåˆ—åŒ–æ—¶éœ€è¦ä½¿ç”¨ ObjectOutputStream çš„ `writeObject()` å°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµå¹¶è¾“å‡ºã€‚è€Œ `writeObject()` æ–¹æ³•åœ¨ä¼ å…¥çš„å¯¹è±¡å­˜åœ¨ `writeObject()` çš„æ—¶å€™ä¼šå»åå°„è°ƒç”¨è¯¥å¯¹è±¡çš„ `writeObject()` æ¥å®ç°åºåˆ—åŒ–ã€‚ååºåˆ—åŒ–ä½¿ç”¨çš„æ˜¯ ObjectInputStream çš„ `readObject()` æ–¹æ³•ï¼ŒåŸç†ç±»ä¼¼ã€‚

```java
ArrayList list = new ArrayList();
ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(file));
oos.writeObject(list);
```

æ¨èé˜…è¯»ï¼š[æ·±å…¥æ¢è®¨ Java ArrayList](https://javabetter.cn/collection/arraylist.html)

##### 5. Fail-Fast

modCount ç”¨æ¥è®°å½• ArrayList ç»“æ„å‘ç”Ÿå˜åŒ–çš„æ¬¡æ•°ã€‚ç»“æ„å‘ç”Ÿå˜åŒ–æ˜¯æŒ‡æ·»åŠ æˆ–è€…åˆ é™¤è‡³å°‘ä¸€ä¸ªå…ƒç´ çš„æ‰€æœ‰æ“ä½œï¼Œæˆ–è€…æ˜¯è°ƒæ•´å†…éƒ¨æ•°ç»„çš„å¤§å°ï¼Œä»…ä»…åªæ˜¯è®¾ç½®å…ƒç´ çš„å€¼ä¸ç®—ç»“æ„å‘ç”Ÿå˜åŒ–ã€‚

åœ¨è¿›è¡Œåºåˆ—åŒ–æˆ–è€…è¿­ä»£ç­‰æ“ä½œæ—¶ï¼Œéœ€è¦æ¯”è¾ƒæ“ä½œå‰å modCount æ˜¯å¦æ”¹å˜ï¼Œå¦‚æœæ”¹å˜äº†éœ€è¦æŠ›å‡º ConcurrentModificationExceptionã€‚ä»£ç å‚è€ƒä¸ŠèŠ‚åºåˆ—åŒ–ä¸­çš„ `writeObject()` æ–¹æ³•ã€‚

æ¨èé˜…è¯»ï¼š[é˜¿é‡ŒJavaå¼€å‘è§„çº¦ï¼šç¦æ­¢åœ¨foreaché‡Œæ‰§è¡Œå…ƒç´ çš„åˆ é™¤æ“ä½œ](https://javabetter.cn/collection/fail-fast.html)

#### Vector

##### 1. åŒæ­¥

Vector çš„å®ç°ä¸ ArrayList ç±»ä¼¼ï¼Œä½†æ˜¯ä½¿ç”¨äº† synchronized è¿›è¡ŒåŒæ­¥ã€‚

```java
public synchronized boolean add(E e) {
    modCount++;
    ensureCapacityHelper(elementCount + 1);
    elementData[elementCount++] = e;
    return true;
}

public synchronized E get(int index) {
    if (index >= elementCount)
        throw new ArrayIndexOutOfBoundsException(index);

    return elementData(index);
}
```

##### 2. æ‰©å®¹

Vector çš„æ„é€ æ–¹æ³•å¯ä»¥ä¼ å…¥ capacityIncrement å‚æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨æ‰©å®¹æ—¶ä½¿å®¹é‡ capacity å¢é•¿ capacityIncrementã€‚å¦‚æœè¿™ä¸ªå‚æ•°çš„å€¼å°äºç­‰äº 0ï¼Œæ‰©å®¹æ—¶æ¯æ¬¡éƒ½ä»¤ capacity ä¸ºåŸæ¥çš„ä¸¤å€ã€‚

```java
public Vector(int initialCapacity, int capacityIncrement) {
    super();
    if (initialCapacity < 0)
        throw new IllegalArgumentException("Illegal Capacity: "+
                                           initialCapacity);
    this.elementData = new Object[initialCapacity];
    this.capacityIncrement = capacityIncrement;
} 

private void grow(int minCapacity) {
    // overflow-conscious code
    int oldCapacity = elementData.length;
    int newCapacity = oldCapacity + ((capacityIncrement > 0) ?
                                     capacityIncrement : oldCapacity);
    if (newCapacity - minCapacity < 0)
        newCapacity = minCapacity;
    if (newCapacity - MAX_ARRAY_SIZE > 0)
        newCapacity = hugeCapacity(minCapacity);
    elementData = Arrays.copyOf(elementData, newCapacity);
}
```

è°ƒç”¨æ²¡æœ‰ capacityIncrement çš„æ„é€ å‡½æ•°æ—¶ï¼ŒcapacityIncrement å€¼è¢«è®¾ç½®ä¸º 0ï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤æƒ…å†µä¸‹ Vector æ¯æ¬¡æ‰©å®¹æ—¶å®¹é‡éƒ½ä¼šç¿»å€ã€‚

```java
public Vector(int initialCapacity) {
    this(initialCapacity, 0);
}

public Vector() {
    this(10);
}
```

##### 3. ä¸ ArrayList çš„æ¯”è¾ƒ

- Vector æ˜¯åŒæ­¥çš„ï¼Œå› æ­¤å¼€é”€æ¯” ArrayList è¦å¤§ï¼Œè®¿é—®é€Ÿåº¦æ›´æ…¢ã€‚æœ€å¥½ä½¿ç”¨ ArrayList è€Œä¸æ˜¯ Vectorï¼Œå®é™…ä¸Š Vector å‡ ä¹å·²ç»ä¸å†ä½¿ç”¨äº†ã€‚
- Vector æ¯æ¬¡æ‰©å®¹è¯·æ±‚å…¶å¤§å°çš„ 2 å€ï¼ˆä¹Ÿå¯ä»¥é€šè¿‡æ„é€ å‡½æ•°è®¾ç½®å¢é•¿çš„å®¹é‡ï¼‰ï¼Œè€Œ ArrayList æ˜¯ 1.5 å€ã€‚

##### 4. æ›¿ä»£æ–¹æ¡ˆ

å¯ä»¥ä½¿ç”¨ `Collections.synchronizedList();` å¾—åˆ°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ ArrayListã€‚

```java
List<String> list = new ArrayList<>();
List<String> synList = Collections.synchronizedList(list);
```

ä¹Ÿå¯ä»¥ä½¿ç”¨ concurrent å¹¶å‘åŒ…ä¸‹çš„ [CopyOnWriteArrayList](https://javabetter.cn/thread/CopyOnWriteArrayList.html) ç±»ã€‚

```java
List<String> list = new CopyOnWriteArrayList<>();
```

#### CopyOnWriteArrayList

##### 1. è¯»å†™åˆ†ç¦»

å†™æ“ä½œæ˜¯åœ¨æ•°ç»„çš„æ‹·è´ä¸Šè¿›è¡Œçš„ï¼Œè¯»æ“ä½œè¿˜æ˜¯åœ¨åŸå§‹æ•°ç»„ä¸­è¿›è¡Œï¼Œè¯»å†™åˆ†ç¦»ï¼Œäº’ä¸å½±å“ã€‚

å†™æ“ä½œéœ€è¦åŠ é”ï¼Œé˜²æ­¢å¹¶å‘å†™å…¥æ—¶æ•°æ®ä¸¢å¤±ã€‚å†™æ“ä½œç»“æŸä¹‹åéœ€è¦æŠŠåŸå§‹æ•°ç»„æŒ‡å‘æ–°çš„å¤åˆ¶æ•°ç»„ã€‚

```java
public boolean add(E e) {
    final ReentrantLock lock = this.lock;
    lock.lock();
    try {
        Object[] elements = getArray();
        int len = elements.length;
        Object[] newElements = Arrays.copyOf(elements, len + 1);
        newElements[len] = e;
        setArray(newElements);
        return true;
    } finally {
        lock.unlock();
    }
}

final void setArray(Object[] a) {
    array = a;
}
```

è¯»ï¼š

```java
@SuppressWarnings("unchecked")
private E get(Object[] a, int index) {
    return (E) a[index];
}
```

##### 2. é€‚ç”¨åœºæ™¯

CopyOnWriteArrayList åœ¨å†™æ“ä½œçš„åŒæ—¶å…è®¸è¯»æ“ä½œï¼Œå¤§å¤§æé«˜äº†è¯»æ“ä½œçš„æ€§èƒ½ï¼Œå› æ­¤å¾ˆé€‚åˆè¯»å¤šå†™å°‘çš„åº”ç”¨åœºæ™¯ã€‚

ä½†æ˜¯ CopyOnWriteArrayList æœ‰å…¶ç¼ºé™·ï¼š

- å†…å­˜å ç”¨ï¼šåœ¨å†™æ“ä½œæ—¶éœ€è¦å¤åˆ¶ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œä½¿å¾—å†…å­˜å ç”¨ä¸ºåŸæ¥çš„ä¸¤å€å·¦å³ï¼›
- æ•°æ®ä¸ä¸€è‡´ï¼šè¯»æ“ä½œä¸èƒ½è¯»å–å®æ—¶æ€§çš„æ•°æ®ï¼Œå› ä¸ºéƒ¨åˆ†å†™æ“ä½œçš„æ•°æ®è¿˜æœªåŒæ­¥åˆ°è¯»æ•°ç»„ä¸­ã€‚

æ‰€ä»¥ CopyOnWriteArrayList ä¸é€‚åˆå†…å­˜æ•æ„Ÿä»¥åŠå¯¹å®æ—¶æ€§è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ã€‚

æ¨èé˜…è¯»ï¼š[åŠæ‰“Javaå¹¶å‘é¢è¯•å®˜ä¹‹CopyOnWriteArrayList](https://javabetter.cn/thread/CopyOnWriteArrayList.html)

#### LinkedList

##### 1. æ¦‚è§ˆ

![cyc2018ï¼šLinkedList](https://cdn.tobebetterjavaer.com/stutymore/java-collection-20240606162054.png)

LinkedList åŸºäºåŒå‘é“¾è¡¨å®ç°ï¼Œä½¿ç”¨ Node å­˜å‚¨é“¾è¡¨èŠ‚ç‚¹ä¿¡æ¯ã€‚

```java
private static class Node<E> {
    E item;
    Node<E> next;
    Node<E> prev;
}
```

æ¯ä¸ªé“¾è¡¨å­˜å‚¨äº† first å’Œ last æŒ‡é’ˆï¼š

```java
transient Node<E> first;
transient Node<E> last;
```

##### 2. ä¸ ArrayList çš„æ¯”è¾ƒ

ArrayList åŸºäºåŠ¨æ€æ•°ç»„å®ç°ï¼ŒLinkedList åŸºäºåŒå‘é“¾è¡¨å®ç°ã€‚ArrayList å’Œ LinkedList çš„åŒºåˆ«å¯ä»¥å½’ç»“ä¸ºæ•°ç»„å’Œé“¾è¡¨çš„åŒºåˆ«ï¼š

- æ•°ç»„æ”¯æŒéšæœºè®¿é—®ï¼Œä½†æ’å…¥å’Œåˆ é™¤çš„ä»£ä»·å¾ˆé«˜ï¼Œéœ€è¦ç§»åŠ¨å¤§é‡å…ƒç´ ï¼›
- é“¾è¡¨ä¸æ”¯æŒéšæœºè®¿é—®ï¼Œä½†æ’å…¥åˆ é™¤åªéœ€è¦æ”¹å˜æŒ‡é’ˆã€‚

æ¨èé˜…è¯»ï¼š[æ·±å…¥æ¢è®¨ Java LinkedList](https://javabetter.cn/collection/linkedlist.html)

#### HashMap

>æ³¨æ„ï¼Œä¸ºäº†ä¾¿äºç†è§£ï¼Œä»¥ä¸‹æºç åˆ†æä»¥ JDK 1.7 ä¸ºä¸»ã€‚

##### 1. å­˜å‚¨ç»“æ„

HashMap å†…éƒ¨åŒ…å«äº†ä¸€ä¸ª Entry ç±»å‹çš„æ•°ç»„ tableã€‚Entry å­˜å‚¨ç€é”®å€¼å¯¹ã€‚å®ƒåŒ…å«äº†å››ä¸ªå­—æ®µï¼Œä» next å­—æ®µæˆ‘ä»¬å¯ä»¥çœ‹å‡º Entry æ˜¯ä¸€ä¸ªé“¾è¡¨ã€‚

![cyc2018ï¼šHashMap](https://cdn.tobebetterjavaer.com/stutymore/java-collection-20240606162421.png)

å³æ•°ç»„ä¸­çš„æ¯ä¸ªä½ç½®è¢«å½“æˆä¸€ä¸ªæ¡¶ï¼Œä¸€ä¸ªæ¡¶å­˜æ”¾ä¸€ä¸ªé“¾è¡¨ã€‚HashMap ä½¿ç”¨æ‹‰é“¾æ³•æ¥è§£å†³å†²çªï¼ŒåŒä¸€ä¸ªé“¾è¡¨ä¸­å­˜æ”¾å“ˆå¸Œå€¼å’Œæ•°ç»„é•¿åº¦å–æ¨¡è¿ç®—ç»“æœç›¸åŒçš„ Entryã€‚



```java
transient Entry[] table;

static class Entry<K,V> implements Map.Entry<K,V> {
    final K key;
    V value;
    Entry<K,V> next;
    int hash;

    Entry(int h, K k, V v, Entry<K,V> n) {
        value = v;
        next = n;
        key = k;
        hash = h;
    }

    public final K getKey() {
        return key;
    }

    public final V getValue() {
        return value;
    }

    public final V setValue(V newValue) {
        V oldValue = value;
        value = newValue;
        return oldValue;
    }

    public final boolean equals(Object o) {
        if (!(o instanceof Map.Entry))
            return false;
        Map.Entry e = (Map.Entry)o;
        Object k1 = getKey();
        Object k2 = e.getKey();
        if (k1 == k2 || (k1 != null && k1.equals(k2))) {
            Object v1 = getValue();
            Object v2 = e.getValue();
            if (v1 == v2 || (v1 != null && v1.equals(v2)))
                return true;
        }
        return false;
    }

    public final int hashCode() {
        return Objects.hashCode(getKey()) ^ Objects.hashCode(getValue());
    }

    public final String toString() {
        return getKey() + "=" + getValue();
    }
}
```

##### 2. æ‹‰é“¾æ³•çš„å·¥ä½œåŸç†

```java
HashMap<String, String> map = new HashMap<>();
map.put("K1", "V1");
map.put("K2", "V2");
map.put("K3", "V3");
```

- æ–°å»ºä¸€ä¸ª HashMapï¼Œé»˜è®¤å¤§å°ä¸º 16ï¼›
- æ’å…¥ &lt;K1,V1\> é”®å€¼å¯¹ï¼Œå…ˆè®¡ç®— K1 çš„ hashCode ä¸º 115ï¼Œä½¿ç”¨é™¤ç•™ä½™æ•°æ³•å¾—åˆ°æ‰€åœ¨çš„æ¡¶ä¸‹æ ‡ 115%16=3ã€‚
- æ’å…¥ &lt;K2,V2\> é”®å€¼å¯¹ï¼Œå…ˆè®¡ç®— K2 çš„ hashCode ä¸º 118ï¼Œä½¿ç”¨é™¤ç•™ä½™æ•°æ³•å¾—åˆ°æ‰€åœ¨çš„æ¡¶ä¸‹æ ‡ 118%16=6ã€‚
- æ’å…¥ &lt;K3,V3\> é”®å€¼å¯¹ï¼Œå…ˆè®¡ç®— K3 çš„ hashCode ä¸º 118ï¼Œä½¿ç”¨é™¤ç•™ä½™æ•°æ³•å¾—åˆ°æ‰€åœ¨çš„æ¡¶ä¸‹æ ‡ 118%16=6ï¼Œæ’åœ¨ &lt;K2,V2\> çš„å‰é¢ã€‚

éœ€è¦æ³¨æ„åˆ°ï¼Œé“¾è¡¨çš„æ’å…¥æ˜¯ä»¥å¤´æ’æ³•æ–¹å¼è¿›è¡Œçš„ï¼Œä¾‹å¦‚ä¸Šé¢çš„ &lt;K3,V3\> ä¸æ˜¯æ’åœ¨ &lt;K2,V2\> åé¢ï¼Œè€Œæ˜¯æ’å…¥åœ¨é“¾è¡¨å¤´éƒ¨ã€‚

![cyc2018ï¼šæ‹‰é“¾æ³•](https://cdn.tobebetterjavaer.com/stutymore/java-collection-20240606162624.png)

æŸ¥æ‰¾éœ€è¦åˆ†æˆä¸¤æ­¥è¿›è¡Œï¼š

- è®¡ç®—é”®å€¼å¯¹æ‰€åœ¨çš„æ¡¶ï¼›
- åœ¨é“¾è¡¨ä¸Šé¡ºåºæŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¾ç„¶å’Œé“¾è¡¨çš„é•¿åº¦æˆæ­£æ¯”ã€‚



##### 3. put æ“ä½œ

```java
public V put(K key, V value) {
    if (table == EMPTY_TABLE) {
        inflateTable(threshold);
    }
    // é”®ä¸º null å•ç‹¬å¤„ç†
    if (key == null)
        return putForNullKey(value);
    int hash = hash(key);
    // ç¡®å®šæ¡¶ä¸‹æ ‡
    int i = indexFor(hash, table.length);
    // å…ˆæ‰¾å‡ºæ˜¯å¦å·²ç»å­˜åœ¨é”®ä¸º key çš„é”®å€¼å¯¹ï¼Œå¦‚æœå­˜åœ¨çš„è¯å°±æ›´æ–°è¿™ä¸ªé”®å€¼å¯¹çš„å€¼ä¸º value
    for (Entry<K,V> e = table[i]; e != null; e = e.next) {
        Object k;
        if (e.hash == hash && ((k = e.key) == key || key.equals(k))) {
            V oldValue = e.value;
            e.value = value;
            e.recordAccess(this);
            return oldValue;
        }
    }

    modCount++;
    // æ’å…¥æ–°é”®å€¼å¯¹
    addEntry(hash, key, value, i);
    return null;
}
```

HashMap å…è®¸æ’å…¥é”®ä¸º null çš„é”®å€¼å¯¹ã€‚ä½†æ˜¯å› ä¸ºæ— æ³•è°ƒç”¨ null çš„ `hashCode()` æ–¹æ³•ï¼Œä¹Ÿå°±æ— æ³•ç¡®å®šè¯¥é”®å€¼å¯¹çš„æ¡¶ä¸‹æ ‡ï¼Œåªèƒ½é€šè¿‡å¼ºåˆ¶æŒ‡å®šä¸€ä¸ªæ¡¶ä¸‹æ ‡æ¥å­˜æ”¾ã€‚HashMap ä½¿ç”¨ç¬¬ 0 ä¸ªæ¡¶å­˜æ”¾é”®ä¸º null çš„é”®å€¼å¯¹ã€‚

```java
private V putForNullKey(V value) {
    for (Entry<K,V> e = table[0]; e != null; e = e.next) {
        if (e.key == null) {
            V oldValue = e.value;
            e.value = value;
            e.recordAccess(this);
            return oldValue;
        }
    }
    modCount++;
    addEntry(0, null, value, 0);
    return null;
}
```

ä½¿ç”¨é“¾è¡¨çš„å¤´æ’æ³•ï¼Œä¹Ÿå°±æ˜¯æ–°çš„é”®å€¼å¯¹æ’åœ¨é“¾è¡¨çš„å¤´éƒ¨ï¼Œè€Œä¸æ˜¯é“¾è¡¨çš„å°¾éƒ¨ã€‚

```java
void addEntry(int hash, K key, V value, int bucketIndex) {
    if ((size >= threshold) && (null != table[bucketIndex])) {
        resize(2 * table.length);
        hash = (null != key) ? hash(key) : 0;
        bucketIndex = indexFor(hash, table.length);
    }

    createEntry(hash, key, value, bucketIndex);
}

void createEntry(int hash, K key, V value, int bucketIndex) {
    Entry<K,V> e = table[bucketIndex];
    // å¤´æ’æ³•ï¼Œé“¾è¡¨å¤´éƒ¨æŒ‡å‘æ–°çš„é”®å€¼å¯¹
    table[bucketIndex] = new Entry<>(hash, key, value, e);
    size++;
}
```

Entry çš„æ„é€ æ–¹æ³•ï¼š

```java
Entry(int h, K k, V v, Entry<K,V> n) {
    value = v;
    next = n;
    key = k;
    hash = h;
}
```

##### 4. ç¡®å®šæ¡¶ä¸‹æ ‡

å¾ˆå¤šæ“ä½œéƒ½éœ€è¦å…ˆç¡®å®šä¸€ä¸ªé”®å€¼å¯¹æ‰€åœ¨çš„æ¡¶ä¸‹æ ‡ã€‚

```java
int hash = hash(key);
int i = indexFor(hash, table.length);
```

###### 4.1 è®¡ç®— hash å€¼

```java
final int hash(Object k) {
    int h = hashSeed;
    if (0 != h && k instanceof String) {
        return sun.misc.Hashing.stringHash32((String) k);
    }

    h ^= k.hashCode();

    // This function ensures that hashCodes that differ only by
    // constant multiples at each bit position have a bounded
    // number of collisions (approximately 8 at default load factor).
    h ^= (h >>> 20) ^ (h >>> 12);
    return h ^ (h >>> 7) ^ (h >>> 4);
}
```

HashMap çš„ hash æ–¹æ³•å…ˆè·å–ä¸€ä¸ª hashSeedï¼Œç„¶åå¯¹ key çš„ `hashCode()` è¿›è¡Œå¤„ç†ã€‚å¦‚æœ key æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œå°±è°ƒç”¨ `sun.misc.Hashing.stringHash32()` æ–¹æ³•è®¡ç®—å­—ç¬¦ä¸²çš„ hash å€¼ã€‚

æ¥çœ‹ä¸€ä¸‹ Ojbect çš„ `hashCode()` æ–¹æ³•ï¼š

```java
public final int hashCode() {
    return Objects.hashCode(key) ^ Objects.hashCode(value);
}
```

###### 4.2 å–æ¨¡ 

ä»¤ x = 1\<\<4ï¼Œå³ x ä¸º 2 çš„ 4 æ¬¡æ–¹ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š

```
x   : 00010000
x-1 : 00001111
```

ä»¤ä¸€ä¸ªæ•° y ä¸ x-1 åšä¸è¿ç®—ï¼Œå¯ä»¥å»é™¤ y ä½çº§è¡¨ç¤ºçš„ç¬¬ 4 ä½ä»¥ä¸Šæ•°ï¼š

```
y       : 10110010
x-1     : 00001111
y&(x-1) : 00000010
```

è¿™ä¸ªæ€§è´¨å’Œ y å¯¹ x å–æ¨¡æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼š

```
y   : 10110010
x   : 00010000
y%x : 00000010
```

æˆ‘ä»¬çŸ¥é“ï¼Œä½è¿ç®—çš„ä»£ä»·æ¯”æ±‚æ¨¡è¿ç®—å°çš„å¤šï¼Œå› æ­¤åœ¨è¿›è¡Œè¿™ç§è®¡ç®—æ—¶ç”¨ä½è¿ç®—çš„è¯èƒ½å¸¦æ¥æ›´é«˜çš„æ€§èƒ½ã€‚

ç¡®å®šæ¡¶ä¸‹æ ‡çš„æœ€åä¸€æ­¥æ˜¯å°† key çš„ hash å€¼å¯¹æ¡¶ä¸ªæ•°å–æ¨¡ï¼š`hash%capacity`ï¼Œå¦‚æœèƒ½ä¿è¯ capacity ä¸º 2 çš„ n æ¬¡æ–¹ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†è¿™ä¸ªæ“ä½œè½¬æ¢ä¸ºä½è¿ç®—ã€‚

```java
static int indexFor(int h, int length) {
    return h & (length-1);
}
```

##### 5. æ‰©å®¹-åŸºæœ¬åŸç†

è®¾ HashMap çš„ table é•¿åº¦ä¸º Mï¼Œéœ€è¦å­˜å‚¨çš„é”®å€¼å¯¹æ•°é‡ä¸º Nï¼Œå¦‚æœå“ˆå¸Œå‡½æ•°æ»¡è¶³å‡åŒ€æ€§çš„è¦æ±‚ï¼Œé‚£ä¹ˆæ¯æ¡é“¾è¡¨çš„é•¿åº¦å¤§çº¦ä¸º N/Mï¼Œå› æ­¤æŸ¥æ‰¾çš„å¤æ‚åº¦ä¸º O(N/M)ã€‚

ä¸ºäº†è®©æŸ¥æ‰¾çš„æˆæœ¬é™ä½ï¼Œåº”è¯¥ä½¿ N/M å°½å¯èƒ½å°ï¼Œå› æ­¤éœ€è¦ä¿è¯ M å°½å¯èƒ½å¤§ï¼Œä¹Ÿå°±æ˜¯è¯´ table è¦å°½å¯èƒ½å¤§ã€‚HashMap é‡‡ç”¨åŠ¨æ€æ‰©å®¹æ¥æ ¹æ®å½“å‰çš„ N å€¼æ¥è°ƒæ•´ M å€¼ï¼Œä½¿å¾—ç©ºé—´æ•ˆç‡å’Œæ—¶é—´æ•ˆç‡éƒ½èƒ½å¾—åˆ°ä¿è¯ã€‚

å’Œæ‰©å®¹ç›¸å…³çš„å‚æ•°ä¸»è¦æœ‰ï¼šcapacityã€sizeã€threshold å’Œ load_factorã€‚

| å‚æ•° | å«ä¹‰ |
| :--: | :-- |
| capacity | table çš„å®¹é‡å¤§å°ï¼Œé»˜è®¤ä¸º 16ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ capacity å¿…é¡»ä¿è¯ä¸º 2 çš„ n æ¬¡æ–¹ã€‚|
| size | é”®å€¼å¯¹æ•°é‡ã€‚ |
| threshold | size çš„ä¸´ç•Œå€¼ï¼Œå½“ size å¤§äºç­‰äº threshold å°±å¿…é¡»è¿›è¡Œæ‰©å®¹æ“ä½œã€‚ |
| loadFactor | è£…è½½å› å­ï¼Œtable èƒ½å¤Ÿä½¿ç”¨çš„æ¯”ä¾‹ï¼Œ`threshold = (int)(capacity* loadFactor)`ã€‚ |

```java
static final int DEFAULT_INITIAL_CAPACITY = 16;

static final int MAXIMUM_CAPACITY = 1 << 30;

static final float DEFAULT_LOAD_FACTOR = 0.75f;

transient Entry[] table;

transient int size;

int threshold;

final float loadFactor;

transient int modCount;
```

ä»ä¸‹é¢çš„æ·»åŠ å…ƒç´ ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œå½“éœ€è¦æ‰©å®¹æ—¶ï¼Œä»¤ capacity ä¸ºåŸæ¥çš„ä¸¤å€ã€‚

```java
void addEntry(int hash, K key, V value, int bucketIndex) {
    Entry<K,V> e = table[bucketIndex];
    table[bucketIndex] = new Entry<>(hash, key, value, e);
    if (size++ >= threshold)
        resize(2 * table.length);
}
```

æ‰©å®¹ä½¿ç”¨ `resize()` å®ç°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰©å®¹æ“ä½œåŒæ ·éœ€è¦æŠŠ oldTable çš„æ‰€æœ‰é”®å€¼å¯¹é‡æ–°æ’å…¥ newTable ä¸­ï¼Œå› æ­¤è¿™ä¸€æ­¥æ˜¯å¾ˆè´¹æ—¶çš„ã€‚

```java
void resize(int newCapacity) {
    Entry[] oldTable = table;
    int oldCapacity = oldTable.length;
    if (oldCapacity == MAXIMUM_CAPACITY) {
        threshold = Integer.MAX_VALUE;
        return;
    }
    Entry[] newTable = new Entry[newCapacity];
    transfer(newTable);
    table = newTable;
    threshold = (int)(newCapacity * loadFactor);
}

void transfer(Entry[] newTable) {
    Entry[] src = table;
    int newCapacity = newTable.length;
    for (int j = 0; j < src.length; j++) {
        Entry<K,V> e = src[j];
        if (e != null) {
            src[j] = null;
            do {
                Entry<K,V> next = e.next;
                int i = indexFor(e.hash, newCapacity);
                e.next = newTable[i];
                newTable[i] = e;
                e = next;
            } while (e != null);
        }
    }
}
```

##### 6. æ‰©å®¹-é‡æ–°è®¡ç®—æ¡¶ä¸‹æ ‡

åœ¨è¿›è¡Œæ‰©å®¹æ—¶ï¼Œéœ€è¦æŠŠé”®å€¼å¯¹é‡æ–°è®¡ç®—æ¡¶ä¸‹æ ‡ï¼Œä»è€Œæ”¾åˆ°å¯¹åº”çš„æ¡¶ä¸Šã€‚åœ¨å‰é¢æåˆ°ï¼ŒHashMap ä½¿ç”¨ `hash%capacity` æ¥ç¡®å®šæ¡¶ä¸‹æ ‡ã€‚HashMap capacity ä¸º 2 çš„ n æ¬¡æ–¹è¿™ä¸€ç‰¹ç‚¹èƒ½å¤Ÿæå¤§é™ä½é‡æ–°è®¡ç®—æ¡¶ä¸‹æ ‡æ“ä½œçš„å¤æ‚åº¦ã€‚

å‡è®¾åŸæ•°ç»„é•¿åº¦ capacity ä¸º 16ï¼Œæ‰©å®¹ä¹‹å new capacity ä¸º 32ï¼š

```html
capacity     : 00010000
new capacity : 00100000
```

å¯¹äºä¸€ä¸ª Keyï¼Œå®ƒçš„å“ˆå¸Œå€¼ hash åœ¨ç¬¬ 5 ä½ï¼š

- ä¸º 0ï¼Œé‚£ä¹ˆ hash%00010000 = hash%00100000ï¼Œæ¡¶ä½ç½®å’ŒåŸæ¥ä¸€è‡´ï¼›
- ä¸º 1ï¼Œhash%00010000 = hash%00100000 + 16ï¼Œæ¡¶ä½ç½®æ˜¯åŸä½ç½® + 16ã€‚

##### 7. è®¡ç®—æ•°ç»„å®¹é‡

HashMap æ„é€ æ–¹æ³•å…è®¸ç”¨æˆ·ä¼ å…¥çš„å®¹é‡ä¸æ˜¯ 2 çš„ n æ¬¡æ–¹ï¼Œå› ä¸ºå®ƒå¯ä»¥è‡ªåŠ¨åœ°å°†ä¼ å…¥çš„å®¹é‡è½¬æ¢ä¸º 2 çš„ n æ¬¡æ–¹ã€‚

å…ˆè€ƒè™‘å¦‚ä½•æ±‚ä¸€ä¸ªæ•°çš„æ©ç ï¼Œå¯¹äº 10010000ï¼Œå®ƒçš„æ©ç ä¸º 11111111ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å¾—åˆ°ï¼š

```
mask |= mask >> 1    11011000
mask |= mask >> 2    11111110
mask |= mask >> 4    11111111
```

mask+1 æ˜¯å¤§äºåŸå§‹æ•°å­—çš„æœ€å°çš„ 2 çš„ n æ¬¡æ–¹ã€‚

```
num     10010000
mask+1 100000000
```

ä»¥ä¸‹æ˜¯ HashMap ä¸­è®¡ç®—æ•°ç»„å®¹é‡çš„ä»£ç ï¼š

```java
static final int tableSizeFor(int cap) {
    int n = cap - 1;
    n |= n >>> 1;
    n |= n >>> 2;
    n |= n >>> 4;
    n |= n >>> 8;
    n |= n >>> 16;
    return (n < 0) ? 1 : (n >= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;
}
```

##### 8. é“¾è¡¨è½¬çº¢é»‘æ ‘

ä» JDK 1.8 å¼€å§‹ï¼Œä¸€ä¸ªæ¡¶å­˜å‚¨çš„é“¾è¡¨é•¿åº¦å¤§äºç­‰äº 8 æ—¶ä¼šå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚

##### 9. ä¸ Hashtable çš„æ¯”è¾ƒ

- Hashtable ä½¿ç”¨ synchronized æ¥è¿›è¡ŒåŒæ­¥ã€‚
- HashMap å¯ä»¥æ’å…¥é”®ä¸º null çš„ Entryã€‚
- HashMap çš„è¿­ä»£å™¨æ˜¯ fail-fast è¿­ä»£å™¨ã€‚
- HashMap ä¸èƒ½ä¿è¯éšç€æ—¶é—´çš„æ¨ç§» Map ä¸­çš„å…ƒç´ æ¬¡åºæ˜¯ä¸å˜çš„ã€‚

æ¨èé˜…è¯»ï¼š[Java HashMapè¯¦è§£](https://javabetter.cn/collection/hashmap.html)

#### ConcurrentHashMap

##### 1. å­˜å‚¨ç»“æ„

![cyc2018ï¼šConcurrentHashMap](https://cdn.tobebetterjavaer.com/stutymore/java-collection-20240606163737.png)

```java
static final class HashEntry<K,V> {
    final int hash;
    final K key;
    volatile V value;
    volatile HashEntry<K,V> next;
}
```

ConcurrentHashMap å’Œ HashMap å®ç°ä¸Šç±»ä¼¼ï¼Œæœ€ä¸»è¦çš„å·®åˆ«æ˜¯ ConcurrentHashMap é‡‡ç”¨äº†åˆ†æ®µé”ï¼ˆSegmentï¼‰ï¼Œæ¯ä¸ªåˆ†æ®µé”ç»´æŠ¤ç€å‡ ä¸ªæ¡¶ï¼ˆHashEntryï¼‰ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è®¿é—®ä¸åŒåˆ†æ®µé”ä¸Šçš„æ¡¶ï¼Œä»è€Œä½¿å…¶å¹¶å‘åº¦æ›´é«˜ï¼ˆå¹¶å‘åº¦å°±æ˜¯ Segment çš„ä¸ªæ•°ï¼‰ã€‚

Segment ç»§æ‰¿è‡ª ReentrantLockã€‚

```java
static final class Segment<K,V> extends ReentrantLock implements Serializable {

    private static final long serialVersionUID = 2249069246763182397L;

    static final int MAX_SCAN_RETRIES =
        Runtime.getRuntime().availableProcessors() > 1 ? 64 : 1;

    transient volatile HashEntry<K,V>[] table;

    transient int count;

    transient int modCount;

    transient int threshold;

    final float loadFactor;
}
```

å¤šä¸ªåˆ†æ®µé”ï¼š

```java
final Segment<K,V>[] segments;
```

é»˜è®¤çš„å¹¶å‘çº§åˆ«ä¸º 16ï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤åˆ›å»º 16 ä¸ª Segmentã€‚

```java
static final int DEFAULT_CONCURRENCY_LEVEL = 16;
```

##### 2. size æ“ä½œ

æ¯ä¸ª Segment ç»´æŠ¤äº†ä¸€ä¸ª count å˜é‡æ¥ç»Ÿè®¡è¯¥ Segment ä¸­çš„é”®å€¼å¯¹ä¸ªæ•°ã€‚

```java
/**
 * The number of elements. Accessed only either within locks
 * or among other volatile reads that maintain visibility.
 */
transient int count;
```

åœ¨æ‰§è¡Œ size æ“ä½œæ—¶ï¼Œéœ€è¦éå†æ‰€æœ‰ Segment ç„¶åæŠŠ count ç´¯è®¡èµ·æ¥ã€‚

ConcurrentHashMap åœ¨æ‰§è¡Œ size æ“ä½œæ—¶å…ˆå°è¯•ä¸åŠ é”ï¼Œå¦‚æœè¿ç»­ä¸¤æ¬¡ä¸åŠ é”æ“ä½œå¾—åˆ°çš„ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆå¯ä»¥è®¤ä¸ºè¿™ä¸ªç»“æœæ˜¯æ­£ç¡®çš„ã€‚

å°è¯•æ¬¡æ•°ä½¿ç”¨ RETRIES_BEFORE_LOCK å®šä¹‰ï¼Œè¯¥å€¼ä¸º 2ï¼Œretries åˆå§‹å€¼ä¸º -1ï¼Œå› æ­¤å°è¯•æ¬¡æ•°ä¸º 3ã€‚

å¦‚æœå°è¯•çš„æ¬¡æ•°è¶…è¿‡ 3 æ¬¡ï¼Œå°±éœ€è¦å¯¹æ¯ä¸ª Segment åŠ é”ã€‚

```java
/**
 * Number of unsynchronized retries in size and containsValue
 * methods before resorting to locking. This is used to avoid
 * unbounded retries if tables undergo continuous modification
 * which would make it impossible to obtain an accurate result.
 */
static final int RETRIES_BEFORE_LOCK = 2;

public int size() {
    // Try a few times to get accurate count. On failure due to
    // continuous async changes in table, resort to locking.
    final Segment<K,V>[] segments = this.segments;
    int size;
    boolean overflow; // true if size overflows 32 bits
    long sum;         // sum of modCounts
    long last = 0L;   // previous sum
    int retries = -1; // first iteration isn't retry
    try {
        for (;;) {
            // è¶…è¿‡å°è¯•æ¬¡æ•°ï¼Œåˆ™å¯¹æ¯ä¸ª Segment åŠ é”
            if (retries++ == RETRIES_BEFORE_LOCK) {
                for (int j = 0; j < segments.length; ++j)
                    ensureSegment(j).lock(); // force creation
            }
            sum = 0L;
            size = 0;
            overflow = false;
            for (int j = 0; j < segments.length; ++j) {
                Segment<K,V> seg = segmentAt(segments, j);
                if (seg != null) {
                    sum += seg.modCount;
                    int c = seg.count;
                    if (c < 0 || (size += c) < 0)
                        overflow = true;
                }
            }
            // è¿ç»­ä¸¤æ¬¡å¾—åˆ°çš„ç»“æœä¸€è‡´ï¼Œåˆ™è®¤ä¸ºè¿™ä¸ªç»“æœæ˜¯æ­£ç¡®çš„
            if (sum == last)
                break;
            last = sum;
        }
    } finally {
        if (retries > RETRIES_BEFORE_LOCK) {
            for (int j = 0; j < segments.length; ++j)
                segmentAt(segments, j).unlock();
        }
    }
    return overflow ? Integer.MAX_VALUE : size;
}
```

##### 3. JDK 1.8 çš„æ”¹åŠ¨

JDK 1.7 ä½¿ç”¨åˆ†æ®µé”æœºåˆ¶æ¥å®ç°å¹¶å‘æ›´æ–°æ“ä½œï¼Œæ ¸å¿ƒç±»ä¸º Segmentï¼Œå®ƒç»§æ‰¿è‡ªé‡å…¥é” ReentrantLockï¼Œå¹¶å‘åº¦ä¸ Segment æ•°é‡ç›¸ç­‰ã€‚

JDK 1.8 ä½¿ç”¨äº† CAS æ“ä½œæ¥æ”¯æŒæ›´é«˜çš„å¹¶å‘åº¦ï¼Œåœ¨ CAS æ“ä½œå¤±è´¥æ—¶ä½¿ç”¨å†…ç½®é” synchronizedã€‚

å¹¶ä¸” JDK 1.8 çš„å®ç°ä¹Ÿåœ¨é“¾è¡¨è¿‡é•¿æ—¶ä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚

æ¨èé˜…è¯»ï¼š[åŠæ‰“Javaå¹¶å‘é¢è¯•å®˜ä¹‹ConcurrentHashMap](https://javabetter.cn/thread/ConcurrentHashMap.html)

#### LinkedHashMap

##### å­˜å‚¨ç»“æ„

ç»§æ‰¿è‡ª HashMapï¼Œå› æ­¤å…·æœ‰å’Œ HashMap ä¸€æ ·çš„å¿«é€ŸæŸ¥æ‰¾ç‰¹æ€§ã€‚

```java
public class LinkedHashMap<K,V> extends HashMap<K,V> implements Map<K,V>
```

å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œç”¨æ¥ç»´æŠ¤æ’å…¥é¡ºåºæˆ–è€… LRU é¡ºåºã€‚

```java
/**
 * The head (eldest) of the doubly linked list.
 */
transient LinkedHashMap.Entry<K,V> head;

/**
 * The tail (youngest) of the doubly linked list.
 */
transient LinkedHashMap.Entry<K,V> tail;
```

accessOrder å†³å®šäº†é¡ºåºï¼Œé»˜è®¤ä¸º falseï¼Œæ­¤æ—¶ç»´æŠ¤çš„æ˜¯æ’å…¥é¡ºåºã€‚

```java
final boolean accessOrder;
```

LinkedHashMap æœ€é‡è¦çš„æ˜¯ç”¨äºç»´æŠ¤é¡ºåºçš„æ–¹æ³•ï¼Œå®ƒä»¬ä¼šåœ¨ putã€get ç­‰æ–¹æ³•ä¸­è¢«è°ƒç”¨ã€‚

```java
void afterNodeAccess(Node<K,V> p) { }
void afterNodeInsertion(boolean evict) { }
```

##### afterNodeAccess()

å½“ä¸€ä¸ªèŠ‚ç‚¹è¢«è®¿é—®æ—¶ï¼Œå¦‚æœ accessOrder ä¸º trueï¼Œåˆ™ä¼šå°†è¯¥èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å°¾éƒ¨ã€‚ä¹Ÿå°±æ˜¯è¯´æŒ‡å®šä¸º LRU é¡ºåºä¹‹åï¼Œåœ¨æ¯æ¬¡è®¿é—®ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œä¼šå°†è¿™ä¸ªèŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å°¾éƒ¨ï¼Œä¿è¯é“¾è¡¨å°¾éƒ¨æ˜¯æœ€è¿‘è®¿é—®çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆé“¾è¡¨å¤´éƒ¨å°±æ˜¯æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„èŠ‚ç‚¹ã€‚

```java
void afterNodeAccess(Node<K,V> e) { // move node to last
    LinkedHashMap.Entry<K,V> last;
    if (accessOrder && (last = tail) != e) {
        LinkedHashMap.Entry<K,V> p =
            (LinkedHashMap.Entry<K,V>)e, b = p.before, a = p.after;
        p.after = null;
        if (b == null)
            head = a;
        else
            b.after = a;
        if (a != null)
            a.before = b;
        else
            last = b;
        if (last == null)
            head = p;
        else {
            p.before = last;
            last.after = p;
        }
        tail = p;
        ++modCount;
    }
}
```

##### afterNodeInsertion()

åœ¨ put ç­‰æ“ä½œä¹‹åæ‰§è¡Œï¼Œå½“ `removeEldestEntry()` æ–¹æ³•è¿”å› true æ—¶ä¼šç§»é™¤æœ€æ™šçš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯é“¾è¡¨å¤´éƒ¨èŠ‚ç‚¹ firstã€‚

evict åªæœ‰åœ¨æ„å»º Map çš„æ—¶å€™æ‰ä¸º falseï¼Œåœ¨è¿™é‡Œä¸º trueã€‚

```java
void afterNodeInsertion(boolean evict) { // possibly remove eldest
    LinkedHashMap.Entry<K,V> first;
    if (evict && (first = head) != null && removeEldestEntry(first)) {
        K key = first.key;
        removeNode(hash(key), key, null, false, true);
    }
}
```

`removeEldestEntry()` é»˜è®¤ä¸º falseï¼Œå¦‚æœéœ€è¦è®©å®ƒä¸º trueï¼Œéœ€è¦ç»§æ‰¿ LinkedHashMap å¹¶ä¸”è¦†ç›–è¿™ä¸ªæ–¹æ³•çš„å®ç°ï¼Œè¿™åœ¨å®ç° LRU çš„ç¼“å­˜ä¸­ç‰¹åˆ«æœ‰ç”¨ï¼Œé€šè¿‡ç§»é™¤æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„èŠ‚ç‚¹ï¼Œä»è€Œä¿è¯ç¼“å­˜ç©ºé—´è¶³å¤Ÿï¼Œå¹¶ä¸”ç¼“å­˜çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®ã€‚

```java
protected boolean removeEldestEntry(Map.Entry<K,V> eldest) {
    return false;
}
```

##### LRU ç¼“å­˜

ä»¥ä¸‹æ˜¯ä½¿ç”¨ LinkedHashMap å®ç°çš„ä¸€ä¸ª LRU ç¼“å­˜ï¼š

- è®¾å®šæœ€å¤§ç¼“å­˜ç©ºé—´ MAX_ENTRIES  ä¸º 3ï¼›
- ä½¿ç”¨ LinkedHashMap çš„æ„é€ æ–¹æ³•å°† accessOrder è®¾ç½®ä¸º trueï¼Œå¼€å¯ LRU é¡ºåºï¼›
- è¦†ç›– `removeEldestEntry()` æ–¹æ³•å®ç°ï¼Œåœ¨èŠ‚ç‚¹å¤šäº MAX_ENTRIES å°±ä¼šå°†æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„æ•°æ®ç§»é™¤ã€‚

```java
class LRUCache<K, V> extends LinkedHashMap<K, V> {
    private static final int MAX_ENTRIES = 3;

    protected boolean removeEldestEntry(Map.Entry eldest) {
        return size() > MAX_ENTRIES;
    }

    LRUCache() {
        super(MAX_ENTRIES, 0.75f, true);
    }
}
```

æ¥æµ‹è¯•ä¸€ä¸‹ï¼š

```java
public static void main(String[] args) {
    LRUCache<Integer, String> cache = new LRUCache<>();
    cache.put(1, "a");
    cache.put(2, "b");
    cache.put(3, "c");
    cache.get(1);
    cache.put(4, "d");
    System.out.println(cache.keySet());
}
```

ç»“æœä¸ºï¼š

```html
[3, 1, 4]
```

æ¨èé˜…è¯»ï¼š[Java LinkedHashMapè¯¦è§£](https://javabetter.cn/collection/linkedhashmap.html)

#### WeakHashMap

##### å­˜å‚¨ç»“æ„

WeakHashMap çš„ Entry ç»§æ‰¿è‡ª WeakReferenceï¼Œè¢« WeakReference å…³è”çš„å¯¹è±¡åœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶ä¼šè¢«å›æ”¶ã€‚

WeakHashMap ä¸»è¦ç”¨æ¥å®ç°ç¼“å­˜ï¼Œé€šè¿‡ä½¿ç”¨ WeakHashMap æ¥å¼•ç”¨ç¼“å­˜å¯¹è±¡ï¼Œç”± JVM å¯¹è¿™éƒ¨åˆ†ç¼“å­˜è¿›è¡Œå›æ”¶ã€‚

```java
private static class Entry<K,V> extends WeakReference<Object> implements Map.Entry<K,V>
```

##### ConcurrentCache

Tomcat ä¸­çš„ ConcurrentCache ä½¿ç”¨äº† WeakHashMap æ¥å®ç°ç¼“å­˜åŠŸèƒ½ã€‚

ConcurrentCache é‡‡å–çš„æ˜¯åˆ†ä»£ç¼“å­˜ï¼š

- ç»å¸¸ä½¿ç”¨çš„å¯¹è±¡æ”¾å…¥ eden ä¸­ï¼Œeden ä½¿ç”¨ ConcurrentHashMap å®ç°ï¼Œä¸ç”¨æ‹…å¿ƒä¼šè¢«å›æ”¶ï¼ˆä¼Šç”¸å›­ï¼‰ï¼›
- ä¸å¸¸ç”¨çš„å¯¹è±¡æ”¾å…¥ longtermï¼Œlongterm ä½¿ç”¨ WeakHashMap å®ç°ï¼Œè¿™äº›è€å¯¹è±¡ä¼šè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ã€‚
- å½“è°ƒç”¨  `get()` æ–¹æ³•æ—¶ï¼Œä¼šå…ˆä» eden åŒºè·å–ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°çš„è¯å†åˆ° longterm è·å–ï¼Œå½“ä» longterm è·å–åˆ°å°±æŠŠå¯¹è±¡æ”¾å…¥ eden ä¸­ï¼Œä»è€Œä¿è¯ç»å¸¸è¢«è®¿é—®çš„èŠ‚ç‚¹ä¸å®¹æ˜“è¢«å›æ”¶ã€‚
- å½“è°ƒç”¨ `put()` æ–¹æ³•æ—¶ï¼Œå¦‚æœ eden çš„å¤§å°è¶…è¿‡äº† sizeï¼Œé‚£ä¹ˆå°±å°† eden ä¸­çš„æ‰€æœ‰å¯¹è±¡éƒ½æ”¾å…¥ longterm ä¸­ï¼Œåˆ©ç”¨è™šæ‹Ÿæœºå›æ”¶æ‰ä¸€éƒ¨åˆ†ä¸ç»å¸¸ä½¿ç”¨çš„å¯¹è±¡ã€‚

```java
public final class ConcurrentCache<K, V> {

    private final int size;

    private final Map<K, V> eden;

    private final Map<K, V> longterm;

    public ConcurrentCache(int size) {
        this.size = size;
        this.eden = new ConcurrentHashMap<>(size);
        this.longterm = new WeakHashMap<>(size);
    }

    public V get(K k) {
        V v = this.eden.get(k);
        if (v == null) {
            v = this.longterm.get(k);
            if (v != null)
                this.eden.put(k, v);
        }
        return v;
    }

    public void put(K k, V v) {
        if (this.eden.size() >= size) {
            this.longterm.putAll(this.eden);
            this.eden.clear();
        }
        this.eden.put(k, v);
    }
}
```


### å‚è€ƒèµ„æ–™

[https://github.com/CyC2018/CS-Notes/](https://github.com/CyC2018/CS-Notes/blob/master/notes/Java%20%E5%AE%B9%E5%99%A8.md)

> å¾®ä¿¡æœç´¢ã€Š**æ²‰é»˜ç‹äºŒ**ã€‹æˆ–è€…å¾®ä¿¡æ‰«ä¸‹é¢çš„äºŒç»´ç ï¼Œå…³æ³¨åå›å¤ã€Š**java**ã€‹å³å¯è·å–æœ€æ–°çš„ PDF ç‰ˆæœ¬ã€‚

![æ‰‹æœºç«¯å¯ä»¥é•¿æŒ‰è¯†åˆ«](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)