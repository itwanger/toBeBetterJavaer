![](https://cdn.tobebetterjavaer.com/stutymore/readme-fengmian.png)

# ç¬¬ä¸€ç« ï¼šå°å†Œç®€ä»‹

ä»¥ä¸Šå°±æ˜¯å°å†Œçš„å°é¢äº†ï¼Œè‡ªæˆ‘æ„Ÿè§‰è¿˜ä¸é”™å“ˆï¼Œç®€æ´å¤§æ–¹ï¼Œä½†åŒ…å«çš„ä¿¡æ¯åˆè¶³å¤Ÿçš„ä¸°å¯Œï¼š

- å°å†Œåå­—ï¼šäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯
- å°å†Œä½œè€…ï¼šæ²‰é»˜ç‹äºŒ
- å°å†Œå“è´¨ï¼šèƒ½åœ¨ GitHub å–å¾— 7600+ star è‡ªè®¤ä¸ºå“è´¨æ˜¯æœ‰ç›®å…±ç¹çš„ï¼Œå°¤å…¶æ˜¯å›½å†…è¿˜æœ‰ä¸å°‘å°ä¼™ä¼´åœ¨è®¿é—® GitHub çš„æ—¶å€™å¾ˆä¸é¡ºåˆ©ã€‚
- å°å†Œé£æ ¼ï¼šé€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜ã€æ·±åº¦è§£æï¼Œæ–°æ‰‹å¯ä»¥æ‹¿æ¥å…¥é—¨ï¼Œè€æ‰‹å¯ä»¥æ‹¿æ¥è¿›é˜¶ï¼Œé‡è¦çš„çŸ¥è¯†ï¼Œæ¯”å¦‚è¯´é¢è¯•é«˜é¢‘çš„å†…å®¹ä¼šä»åº”ç”¨åˆ°æºç æŒ–ä¸ªåº•æœå¤©ï¼Œè¿˜ä¼šç©¿æ’ä»‹ç»ä¸€äº›è®¡ç®—æœºåº•å±‚çŸ¥è¯†ï¼ŒåŠ›æ±‚è®²ä¸ªæ˜ç™½ï¼‰
- å°å†Œç®€ä»‹ï¼šè¿™æ˜¯ä¸€ä»½é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜çš„Javaå­¦ä¹ æŒ‡å—ï¼Œå†…å®¹æ¶µç›–JavaåŸºç¡€ã€Javaå¹¶å‘ç¼–ç¨‹ã€Javaè™šæ‹Ÿæœºã€Javaé¢è¯•ç­‰æ ¸å¿ƒçŸ¥è¯†ç‚¹ã€‚å­¦Javaï¼Œå°±è®¤å‡†äºŒå“¥çš„Javaè¿›é˜¶ä¹‹è·¯ğŸ˜„
- å°å†Œå“ä½ï¼šåº•éƒ¨ç”¨äº†æ¢µé«˜ 1889 å¹´çš„ã€Šæ˜Ÿç©ºã€‹ï¼ˆthe starry nightï¼‰ï¼Œç»ç¾çš„æ¼©æ¶¡æ˜Ÿç©ºï¼Œè€€çœ¼çš„æœˆäº®ï¼Œå®é™çš„æ‘åº„ï¼Œè¿˜æœ‰ä¸€é¢—ç‡ƒçƒ§ç€ç«ç„°çš„å·¨å¤§æŸæ ‘ï¼Œæˆ‘æƒ³å°å†Œçš„è‰ºæœ¯å“ä½ä¹Ÿæ˜¯æ°åˆ°å¥½å¤„çš„ã€‚
- å°å†Œè§’è‰²ï¼šä¸ºäº†å¢åŠ å°å†Œçš„è¶£å‘³æ€§ï¼Œæˆ‘ç‰¹æ„ä¸ºæ­¤è¿½åŠ äº†ä¸¤ä¸ªè™šæ‹Ÿè§’è‰²ï¼Œä¸€ä¸ªäºŒå“¥ï¼Œä¸€ä¸ªä¸‰å¦¹ï¼ŒäºŒå“¥è´Ÿè´£æ•™ï¼Œä¸‰å¦¹è´Ÿè´£å­¦ã€‚è¿™æ ·å¤§å®¶åœ¨å­¦ä¹  Java çš„æ—¶å€™ä»£å…¥æ„Ÿä¹Ÿä¼šæ›´å¼ºçƒˆä¸€äº›ï¼Œå¸Œæœ›è¿™æ ·çš„è®¾å®šèƒ½åšå¾—å¤§å®¶çš„æ¬¢å¿ƒã€‚

## å°å†ŒåŒ…å«å“ªäº›å†…å®¹ï¼Ÿ

ä¸‰å¦¹å‡ºåœºï¼šâ€œäºŒå“¥ï¼Œå¸®è¯»è€…æœ‹å‹ä»¬é—®ä¸€ä¸‹å“ˆï¼Œä¸ºä»€ä¹ˆä¼šæœ‰ã€ŠäºŒå“¥çš„Javaè¿›é˜¶ä¹‹è·¯ã€‹è¿™ä»½å°å†Œå‘¢ï¼Ÿâ€

*äºŒå“¥å·´æ‹‰å·´æ‹‰ ing...*

å°å†Œçš„å†…å®¹ä¸»è¦æ¥æºäºæˆ‘çš„å¼€æºçŸ¥è¯†åº“ã€Š[Javaç¨‹åºå‘˜è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ï¼Œç›®å‰åœ¨ GitHub ä¸Šæ”¶è· 7600+ starï¼Œæ·±å—è¯»è€…å–œçˆ±ã€‚å°å†Œä¹‹æ‰€ä»¥å«ã€ŠäºŒå“¥çš„Javaè¿›é˜¶ä¹‹è·¯ã€‹ï¼Œæ˜¯å› ä¸ºè¿™æ ·æ›´æ–¹ä¾¿å°å†Œçš„è¯»è€…çŸ¥é“è¿™ä»½å°å†Œçš„ä½œè€…æ˜¯è°ï¼ŒIP æ„Ÿæ›´å¼ºçƒˆä¸€äº›ã€‚

å¦‚æœæœ‰è¯»è€…æ˜¯ç¬¬ä¸€æ¬¡é˜…è¯»è¿™ä»½å°å†Œï¼Œè‚¯å®šåˆä¼šé—®ï¼Œâ€œäºŒå“¥æ˜¯å“ªä¸ªé¸Ÿäººï¼Ÿâ€

å™¢å™¢å™¢å™¢ï¼Œæ­£æ˜¯é„™äººäº†ï¼Œä¸€ä¸ªè‹±ä¿Šæ½‡æ´’çš„ç”·äººï¼ˆè§ä¸‹å›¾ï¼‰ï¼Œä½ å¯ä»¥é€šè¿‡æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·â€œ**æ²‰é»˜ç‹äºŒ**â€äº†è§£æ›´å¤šå…³äºæˆ‘çš„ä¿¡æ¯ï¼Œæ€»ä¹‹ï¼Œå°±æ˜¯ä¸€ä¸ªéå¸¸å–œæ¬¢ç‹å°æ³¢çš„ç¨‹åºå‘˜äº†ï¼Œå†™å¾—ä¸€æ‰‹é£è¶£å¹½é»˜çš„æŠ€æœ¯æ–‡ç« ï¼Œæ‰€ä»¥è¢«è¯»è€…â€œå°Šç§°â€ä¸ºäºŒå“¥å°±å¯¹äº†ã€‚ç°å®ä¸­ï¼Œä¸‰å¦¹ä¹Ÿæ˜¯çœŸå®å­˜åœ¨çš„å“¦ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/readme-ece0be3e-d176-447c-bff9-59d9f02c7a65.jpg)

ã€Š**äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯**ã€‹æ˜¯æˆ‘è‡ªå­¦ Java ä»¥æ¥æ‰€æœ‰åŸåˆ›æ–‡ç« å’Œå­¦ä¹ èµ„æ–™çš„å¤§èšåˆã€‚[åœ¨çº¿ç½‘ç«™](https://tobebetterjavaer.com/)å’Œ [GitHub ä»“åº“](https://github.com/itwanger/toBeBetterJavaer)é‡Œçš„å†…å®¹åŒ…æ‹¬ Java åŸºç¡€ã€Java å¹¶å‘ç¼–ç¨‹ã€Java è™šæ‹Ÿæœºã€Java ä¼ä¸šçº§å¼€å‘ï¼ˆåŒ…æ‹¬å¼€å‘/æ„å»º/æµ‹è¯•ã€JavaWebã€SSMã€Spring Bootã€Linuxã€Nginxã€Dockerã€k8sã€å¾®æœåŠ¡&åˆ†å¸ƒå¼ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ï¼‰ã€Java é¢è¯•ç­‰æ ¸å¿ƒå†…å®¹ã€‚è¿™ä¹Ÿæ˜¯å°å†Œæœ€ç»ˆç‰ˆä¼šè¦†ç›–çš„å†…å®¹ã€‚

å°å†Œæ—¨åœ¨ä¸ºå­¦ä¹  Java çš„å°ä¼™ä¼´æä¾›ä¸€ç³»åˆ—ï¼š

 - **ä¼˜è´¨çš„åŸåˆ› Java æ•™ç¨‹**
 - **å…¨é¢æ¸…æ™°çš„ Java å­¦ä¹ è·¯çº¿**
 - **å…è´¹ä½†é è°±çš„ Java å­¦ä¹ èµ„æ–™**
 - **ç²¾é€‰çš„ Java å²—æ±‚èŒé¢è¯•æŒ‡å—**
 - **Java ä¼ä¸šçº§å¼€å‘æ‰€éœ€çš„å¿…å¤‡æŠ€æœ¯**

æ¥ä¸‹æ¥ï¼Œé€ä½  4 ä¸ªâ€œæå¿ƒæè‚ºâ€çš„é˜…è¯»å»ºè®®ï¼š

- å¦‚æœä½ æ˜¯é›¶åŸºç¡€çš„å°ç™½ï¼Œå¯ä»¥æŒ‰ç…§å°å†Œçš„é¡ºåºä¸€è·¯è¯»ä¸‹å»ï¼Œå°å†Œçš„å†…å®¹å®‰æ’éƒ½æ˜¯ç»è¿‡æˆ‘ç²¾å¿ƒå®‰æ’çš„ï¼›
- å¦åˆ™ï¼Œè¯·æŒ‰ç…§ç›®å½•æŒ‰éœ€é˜…è¯»ï¼Œè¯¥è·³è¿‡çš„è·³è¿‡ï¼Œè¯¥æ”¾æ…¢èŠ‚å¥çš„æ”¾æ…¢èŠ‚å¥ã€‚
- å°å†Œä¸­ä¼šæœ‰ä¸€ä¸ªè™šæ‹Ÿäººç‰©ï¼Œä¸‰å¦¹ï¼Œå½“ç„¶å¥¹çš„åŸå‹ä¹Ÿæ˜¯çœŸå®å­˜åœ¨çš„ï¼Œç›®çš„å°±æ˜¯é€šè¿‡æˆ‘ä»¬ä¹‹é—´çš„å¯¹è¯ï¼Œæ¥å¢å¼ºæ–‡ç« çš„è¶£å‘³æ€§ï¼Œä»¥ä¾¿ä½ èƒ½æ›´è½»æ¾åœ°è·å–çŸ¥è¯†ã€‚
- æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œâ€œå…‰çœ‹ä¸ç»ƒå‡æŠŠæˆâ€ï¼Œè¯·åœ¨é˜…è¯»çš„è¿‡ç¨‹ä¸­æŠŠè¯¥æ•²çš„ä»£ç æ•²äº†ï¼ŒæŠŠè¯¥è®°çš„ç¬”è®°è®°äº†ï¼Œè¯­é›€ã€æ€ç»´å¯¼å›¾ã€GitHub ä»“åº“éƒ½å¯ä»¥ï¼Œå…»æˆå¥½çš„å­¦ä¹ ä¹ æƒ¯ã€‚

è¿™é‡Œå±•ç¤ºä¸€ä¸‹æš—é»‘ç‰ˆçš„ PDF è§†å›¾ï¼Œå¤§å®¶å…ˆæ„Ÿå—ä¸€ä¸‹ï¼Œæ‰‹ç»˜å›¾éƒ½ç”»å¾—éå¸¸ç”¨å¿ƒã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/readme-20230411224013.png)

è¿™æ˜¯ epub ç‰ˆæœ¬çš„é˜…è¯»æ•ˆæœï¼Œæ„Ÿè§‰å·¦å³ç¿»åŠ¨çš„æ•ˆæœå¥½èˆ’æœï¼Œä¸€æ¬¡å¯ä»¥çœ‹ä¸¤é¡µï¼ŒçœŸçš„å°±åƒåœ¨è¯»çº¸è´¨ç‰ˆä¹¦ç±ä¸€æ ·ï¼Œä½“éªŒéå¸¸æ£’ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/readme-20230412002314.png)

å¦‚æœä½ å–œæ¬¢åœ¨çº¿é˜…è¯»ï¼Œè¯·æˆ³ä¸‹é¢è¿™ä¸ªç½‘å€ï¼š

> [https://tobebetterjavaer.com](https://tobebetterjavaer.com)

é¦–é¡µè§ä¸‹å›¾ï¼ŒåŒæ ·ç®€æ´ã€æ¸…æ–°ã€æ–¹ä¾¿æ²‰æµ¸å¼é˜…è¯»ï¼š

![](https://cdn.tobebetterjavaer.com/stutymore/readme-20230411102619.png)

ä½ ä¹Ÿå¯ä»¥åˆ°æŠ€æœ¯æ´¾çš„[æ•™ç¨‹æ ï¼ˆæˆ³è¿™é‡Œï¼‰](https://paicoding.com/column)é‡Œé˜…è¯»ï¼Œç›®å‰æ­£åœ¨è¿è½½æ›´æ–°ä¸­ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/readme-20230410215012.png)

>æŠ€æœ¯æ´¾æ˜¯ä¸€ä¸ªåŸºäº Spring Bootã€MyBatis-Plusã€MySQLã€Redisã€ElasticSearchã€MongoDBã€Dockerã€RabbitMQ ç­‰æŠ€æœ¯æ ˆå®ç°çš„ç¤¾åŒºç³»ç»Ÿï¼Œé‡‡ç”¨ä¸»æµçš„äº’è”ç½‘æŠ€æœ¯æ¶æ„ã€å…¨æ–°çš„UIè®¾è®¡ã€æ”¯æŒä¸€é”®æºç éƒ¨ç½²ï¼Œæ‹¥æœ‰å®Œæ•´çš„æ–‡ç« &æ•™ç¨‹å‘å¸ƒ/æœç´¢/è¯„è®º/ç»Ÿè®¡æµç¨‹ç­‰ï¼Œ[ä»£ç å®Œå…¨å¼€æºï¼ˆå¯æˆ³ï¼‰](https://github.com/itwanger/paicoding)ï¼Œæ²¡æœ‰ä»»ä½•äºŒæ¬¡å°è£…ï¼Œæ˜¯ä¸€ä¸ªéå¸¸é€‚åˆäºŒæ¬¡å¼€å‘/å®æˆ˜çš„ç°ä»£åŒ–ç¤¾åŒºé¡¹ç›®ğŸ‘ ã€‚

å¦‚æœä½ åœ¨é˜…è¯»è¿‡ç¨‹ä¸­æ„Ÿè§‰è¿™ä»½å°å†Œå†™çš„è¿˜ä¸é”™ï¼Œç”šè‡³æœ‰äº¿ç‚¹ç‚¹æ”¶è·ï¼Œ**è¯·è‚†æ— å¿Œæƒ®åœ°æŠŠè¿™ä»½å°å†Œåˆ†äº«ç»™ä½ çš„åŒäº‹ã€åŒå­¦ã€èˆå‹ã€æœ‹å‹ï¼Œè®©ä»–ä»¬ä¹Ÿè¿›æ­¥äº¿ç‚¹ç‚¹ï¼Œèµ äººç«ç‘°æ‰‹æœ‰ä½™é¦™å˜›**ã€‚

å¦‚æœè¿™ä»½å°å†Œæœ‰å¹¸è¢«æ›´å¤šäººçœ‹å¾—åˆ°ï¼Œæˆ‘çš„è™šè£å¿ƒä¹Ÿä¼šå¾—åˆ°æ°å½“çš„æ»¡è¶³ï¼Œå˜¿å˜¿ğŸ˜œ

## å¦‚ä½•è·å–æœ€æ–°ç‰ˆï¼Ÿ

å°å†Œåˆ†ä¸º 3 ä¸ªç‰ˆæœ¬ï¼Œæš—é»‘ç‰ˆï¼ˆé€‚åˆå¤œæœï¼‰ã€äº®ç™½ç‰ˆï¼ˆé€‚åˆæ‰“å°ï¼‰ã€epub ç‰ˆï¼Œå¯ä»¥è¯´å‡èšäº†äºŒå“¥åå¤šå¹´æ¥å­¦ä¹  Java çš„å¿ƒè¡€ï¼Œ33 ä¸‡+ï¼Œç»å¯¹ä¸è™šå¸‚é¢ä¸Šä»»ä½•ä¸€æœ¬ Java å®ä½“ä¹¦ï¼

![](https://cdn.tobebetterjavaer.com/stutymore/readme-wecom-temp-cbe8e183acdd8daa542c94ab7f4a7eec.png)

å°å†Œä¼šæŒç»­ä¿æŒ**æ›´æ–°**ï¼Œå¦‚æœæƒ³è·å¾—æœ€æ–°ç‰ˆï¼Œè¯·åœ¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å· **æ²‰é»˜ç‹äºŒ** åå°å›å¤ **222** è·å–ï¼ˆä½ æ‡‚æˆ‘çš„æ„æ€å§ï¼Œæˆ‘è‚¯å®šæ˜¯è¶³å¤ŸäºŒæ‰æœ‰è¿™æ ·çš„å‹‡æ°”å®šä¹‰è¿™æ ·ä¸€ä¸ªå…³é”®å­—ï¼‰ï¼

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## é¢è¯•æŒ‡å—ï¼ˆé…å¥—æ•™ç¨‹ï¼‰

ã€ŠJava é¢è¯•æŒ‡å—ã€‹æ˜¯[äºŒå“¥ç¼–ç¨‹æ˜Ÿçƒçš„](https://tobebetterjavaer.com/zhishixingqiu/)çš„ä¸€ä¸ªå†…éƒ¨å°å†Œï¼Œå’Œã€ŠJava è¿›é˜¶ä¹‹è·¯ã€‹å†…å®¹äº’è¡¥ã€‚ç›¸æ¯”å¼€æºçš„ç‰ˆæœ¬æ¥è¯´ï¼Œã€ŠJava é¢è¯•æŒ‡å—ã€‹æ·»åŠ äº†ä¸‹é¢è¿™äº›æ¿å—å’Œå†…å®¹ï¼š

- é¢è¯•å‡†å¤‡ç¯‡ï¼ˆ20+ç¯‡ï¼‰ï¼Œæ‰‹æŠŠæ‰‹æ•™ä½ å¦‚ä½•å‡†å¤‡é¢è¯•ã€‚
- èŒåœºä¿®ç‚¼ç¯‡ï¼ˆ10+ç¯‡ï¼‰ï¼Œæ‰‹æ‘¸æ‰‹æ•™ä½ å¦‚ä½•åœ¨èŒåœºä¸­å¦‚é±¼å¾—æ°´ã€‚
- æŠ€æœ¯æå‡ç¯‡ï¼ˆ30+ç¯‡ï¼‰ï¼Œæ‰‹æ‹‰æ‰‹æ•™ä½ å¦‚ä½•æˆä¸ºå›¢é˜Ÿä¸å¯æˆ–ç¼ºçš„æŠ€æœ¯æ”»åšå°èƒ½æ‰‹ã€‚
- é¢ç»åˆ†äº«ç¯‡ï¼ˆ20+ç¯‡ï¼‰ï¼Œæ‰‹ç‰µæ‰‹æ•™ä½ å¦‚ä½•åœ¨é¢è¯•ä¸­çŸ¥å½¼çŸ¥å·±ï¼Œç™¾æˆ˜ä¸æ®†ã€‚
- åœºæ™¯è®¾è®¡ç¯‡ï¼ˆ20+ç¯‡ï¼‰ï¼Œæ‰‹æ¡æ‰‹æ•™ä½ å¦‚ä½•åœ¨é¢è¯•ä¸­è„±é¢–è€Œå‡ºã€‚

### å†…å®¹æ¦‚è§ˆ

#### é¢è¯•å‡†å¤‡ç¯‡

æ‰€è°“ä¸´é˜µç£¨æªï¼Œä¸å¿«ä¹Ÿå…‰ã€‚æ›´ä½•å†µæå‰åšå¥½å……è¶³çš„å‡†å¤‡å‘¢ï¼Ÿè¿™ 20+ç¯‡æ–‡ç« ä¼šç³»ç»Ÿåœ°å¼•å¯¼ä½ è¯¥å¦‚ä½•åšå‡†å¤‡ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/readme-20230411111002.png)

#### èŒåœºä¿®ç‚¼ç¯‡

å¦‚ä½•å¹³æ»‘åº¦è¿‡è¯•ç”¨æœŸï¼Ÿå¦‚ä½•å¹³æ»‘åº¦è¿‡ 35 å²ç¨‹åºå‘˜å±æœºï¼Ÿå¦‚ä½•åœ¨ç¹é‡çš„å·¥ä½œä¸­æŒç»­æˆé•¿ï¼Ÿå¦‚ä½•åšå‰¯ä¸šï¼Ÿç­‰ç­‰ï¼Œéƒ½æ˜¯å¤§å®¶è¿«åˆ‡å…³å¿ƒçš„é—®é¢˜ï¼Œè¿™ 10+ç¯‡æ–‡ç« ä¼šä¸€ä¸€ä¸ºä½ æ­æ™“ç­”æ¡ˆã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/readme-20230411111200.png)

#### æŠ€æœ¯æå‡ç¯‡

ç¼–ç¨‹èƒ½åŠ›ã€æŠ€æœ¯åŠŸåº•ï¼Œæ˜¯æˆ‘ä»¬ç¨‹åºå‘˜å®‰èº«ç«‹å‘½ä¹‹æœ¬ï¼Œæ˜¯æˆ‘ä»¬æ±‚èŒ/å·¥ä½œçš„æœ€æ ¸å¿ƒçš„æ­¦å™¨ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/readme-20230411112059.png)

#### é¢ç»åˆ†äº«ç¯‡

çŸ¥å½¼çŸ¥å·±ï¼Œæ–¹èƒ½ç™¾æˆ˜ä¸æ®†ï¼Œæˆ‘ä»¬å¿…é¡»å¾—ç«™åœ¨å­¦é•¿å­¦å§çš„è‚©è†€ä¸Šï¼Œæ‰èƒ½èµ°å¾—æ›´è¿œæ›´å¿«ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/readme-20230411112435.png)

#### åœºæ™¯è®¾è®¡é¢˜ç¯‡

è¿™é‡Œæ”¶å½•çš„éƒ½æ˜¯ç²¾åï¼Œè®©å¤©åº•ä¸‹æ²¡æœ‰éš¾èƒŒçš„å…«è‚¡æ–‡ï¼›åœºæ™¯è®¾è®¡é¢˜ç¯‡é¡µéƒ½æ˜¯é¢è¯•ä¸­ç»å¸¸è€ƒå¯Ÿçš„å¤§é¡¹ï¼Œå¯ä»¥è®©ä½ å’Œé¢è¯•å®˜å¯¹çº¿åŠå°æ—¶ï¼ˆğŸ˜ï¼‰

![](https://cdn.tobebetterjavaer.com/stutymore/readme-20230411112637.png)

### æ˜Ÿçƒå…¶ä»–èµ„æº

é™¤äº†ã€ŠJava é¢è¯•æŒ‡å—ã€‹å¤–ï¼Œæ˜Ÿçƒè¿˜æä¾›äº†ã€Šç¼–ç¨‹å–µå®æˆ˜é¡¹ç›®ç¬”è®°ã€‹ã€ã€ŠäºŒå“¥çš„ LeetCode åˆ·é¢˜ç¬”è®°ã€‹ï¼Œä»¥åŠæŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®é…å¥—çš„ 120+ç¯‡ç¡¬æ ¸æ•™ç¨‹ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/readme-20230411113022.png)

è¿™é‡Œé‡ç‚¹ä»‹ç»ä¸€ä¸‹æŠ€æœ¯æ´¾å§ï¼Œè¿™ä¸ªé¡¹ç›®ä¸Šçº¿åï¼Œä¸€ç›´å¹¿å—å¥½è¯„ï¼Œè¯»è€…æœ‹å‹ä»¬çš„è®¤å¯åº¦éå¸¸é«˜ï¼Œé¡¹ç›®é…å¥—çš„æ•™ç¨‹ä¹Ÿè¶³å¤Ÿçš„ç¡¬æ ¸ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/zhishixingqiu/readme-75e5d61a-55e8-46b8-a261-31bd0d86b81a.png)

è¿™æ˜¯éƒ¨åˆ†ç›®å½•ï¼ˆå…±è®¡ 120 ç¯‡ï¼Œå¤§å‚ç¯‡ã€åŸºç¡€ç¯‡ã€è¿›é˜¶ç¯‡ã€å·¥ç¨‹ç¯‡ï¼Œå…¨éƒ¨è½åœ°ï¼‰ã€‚

å¼€ç¯‡ï¼š

- æŠ€æœ¯ç­”ç–‘ï¼ˆâ­ï¸ï¼‰
- æŠ€æœ¯æ´¾é—®é¢˜åé¦ˆåŠè§£å†³æ–¹æ¡ˆï¼ˆâ­ï¸ï¼‰
- è¸©å‘å®å½•ä¹‹æœ¬åœ°ç¼“å­˜Caffeineé‡‡å‘å®å½•ï¼ˆâ­ï¸ï¼‰
- æŠ€æœ¯æ´¾ç³»ç»Ÿæ¶æ„ã€åŠŸèƒ½æ¨¡å—ä¸€è§ˆï¼ˆâ­ï¸â­ï¸â­ï¸â­ï¸â­ï¸ï¼‰

å¤§å‚ç¯‡ï¼š

- æŠ€æœ¯æ´¾äº§å“è°ƒç ”ï¼Œè®©ä½ äº†è§£äº§å“è¯ç”ŸèƒŒåçš„æ•…äº‹ï¼ˆâ­ï¸â­ï¸ï¼‰
- æŠ€æœ¯æ´¾äº§å“è®¾è®¡ï¼ˆâ­ï¸ï¼‰
- æŠ€æœ¯æ´¾äº¤äº’è§†è§‰è®¾è®¡ï¼ˆâ­ï¸ï¼‰
- æŠ€æœ¯æ´¾æ•´ä½“æ¶æ„æ–¹æ¡ˆè®¾è®¡å…¨è¿‡ç¨‹ï¼ˆâ­ï¸â­ï¸â­ï¸ï¼‰
- æŠ€æœ¯æ–¹æ¡ˆè¯¦ç»†è®¾è®¡ï¼ˆâ­ï¸â­ï¸â­ï¸â­ï¸ï¼‰
- æŠ€æœ¯æ´¾é¡¹ç›®ç®¡ç†æµç¨‹ï¼ˆâ­ï¸â­ï¸ï¼‰
- æŠ€æœ¯æ´¾é¡¹ç›®ç®¡ç†ç ”å‘é˜¶æ®µï¼ˆâ­ï¸â­ï¸â­ï¸ï¼‰

åŸºç¡€ç¯‡ï¼š

- æŠ€æœ¯æ´¾ä¸­å®ä½“å¯¹è±¡ DOã€DTOã€VO åˆ°åº•ä»£è¡¨äº†ä»€ä¹ˆï¼ˆâ­ï¸ï¼‰
- é€šè¿‡æŠ€æœ¯æ´¾é¡¹ç›®è®²è§£ MVC åˆ†å±‚æ¶æ„çš„åº”ç”¨ï¼ˆâ­ï¸â­ï¸ï¼‰
- æŠ€æœ¯æ´¾æ•´åˆæœ¬åœ°ç¼“å­˜ä¹‹Guavaï¼ˆâ­ï¸â­ï¸â­ï¸ï¼‰
- æŠ€æœ¯æ´¾æ•´åˆæœ¬åœ°ç¼“å­˜ä¹‹Caffeineï¼ˆâ­ï¸â­ï¸â­ï¸â­ï¸ï¼‰
- æŠ€æœ¯æ´¾æ•´åˆ Redisï¼ˆâ­ï¸ï¼‰
- æŠ€æœ¯æ´¾ä¸­åŸºäº Redis çš„ç¼“å­˜ç¤ºä¾‹ï¼ˆâ­ï¸â­ï¸â­ï¸ï¼‰
- æŠ€æœ¯æ´¾ä¸­åŸºäºCacheableæ³¨è§£å®ç°ç¼“å­˜ç¤ºä¾‹ï¼ˆâ­ï¸â­ï¸ï¼‰
- æŠ€æœ¯æ´¾ä¸­çš„äº‹åŠ¡ä½¿ç”¨å®ä¾‹ï¼ˆâ­ï¸â­ï¸â­ï¸ï¼‰
- äº‹åŠ¡ä½¿ç”¨çš„ 7 æ¡æ³¨æ„äº‹é¡¹ï¼ˆâ­ï¸â­ï¸â­ï¸ï¼‰
- æŠ€æœ¯æ´¾ä¸­çš„å¤šé…ç½®æ–‡ä»¶è¯´æ˜ï¼ˆâ­ï¸ï¼‰
- æŠ€æœ¯æ´¾æ•´åˆ Logback/lombok é…ç½®æ—¥å¿—è¾“å‡ºï¼ˆâ­ï¸ï¼‰
- æŠ€æœ¯æ´¾æ•´åˆé‚®ä»¶æœåŠ¡å®ç°é‚®ä»¶å‘é€ï¼ˆâ­ï¸ï¼‰
- Web ä¸‰å¤§ç»„ä»¶ä¹‹ Filter åœ¨æŠ€æœ¯æ´¾ä¸­çš„åº”ç”¨ï¼ˆâ­ï¸ï¼‰
- Web ä¸‰å¤§ç»„ä»¶ä¹‹ Servlet åœ¨æŠ€æœ¯æ´¾ä¸­çš„åº”ç”¨ï¼ˆâ­ï¸ï¼‰
- Web ä¸‰å¤§ç»„ä»¶ä¹‹ listenter åœ¨æŠ€æœ¯æ´¾ä¸­çš„åº”ç”¨ï¼ˆâ­ï¸ï¼‰
- æŠ€æœ¯æ´¾å®æ—¶åœ¨çº¿äººæ•°ç»Ÿè®¡-å•æœºç‰ˆï¼ˆâ­ï¸ï¼‰

è¿›é˜¶ç¯‡ï¼š

- æŠ€æœ¯æ´¾ä¹‹æ‰«ç ç™»å½•å®ç°åŸç†ï¼ˆâ­ï¸ï¼‰
- æŠ€æœ¯æ´¾èº«ä»½éªŒè¯ä¹‹sessionä¸ cookieï¼ˆâ­ï¸ï¼‰
- æŠ€æœ¯æ´¾ä¸­åŸºäºå¼‚å¸¸æ—¥å¿—çš„æŠ¥è­¦é€šçŸ¥ï¼ˆâ­ï¸ï¼‰

æ‰©å±•ç¯‡ï¼š

- æŠ€æœ¯æ´¾çš„æ•°æ®åº“è¡¨è‡ªåŠ¨åˆå§‹åŒ–å®ç°æ–¹æ¡ˆï¼ˆâ­ï¸â­ï¸â­ï¸â­ï¸â­ï¸ï¼‰
- æŠ€æœ¯æ´¾ä¸­åŸºäº filter å®ç°è¯·æ±‚æ—¥å¿—è®°å½•ï¼ˆâ­ï¸ï¼‰

å·¥ç¨‹ç¯‡ï¼š

- æŠ€æœ¯æ´¾é¡¹ç›®å·¥ç¨‹æ­å»ºæ‰‹å†Œï¼ˆâ­ï¸â­ï¸â­ï¸â­ï¸ï¼‰
- æŠ€æœ¯æ´¾æœ¬åœ°å¤šæœºå™¨éƒ¨ç½²å¼€å‘æ•™ç¨‹ï¼ˆâ­ï¸â­ï¸ï¼‰
- æŠ€æœ¯æ´¾æœåŠ¡å™¨éƒ¨ç½²æŒ‡å¯¼æ‰‹å†Œï¼ˆâ­ï¸â­ï¸ï¼‰
- æŠ€æœ¯æ´¾çš„ MVC åˆ†å±‚æ¶æ„ï¼ˆâ­ï¸â­ï¸ï¼‰
- æŠ€æœ¯æ´¾ Docker æœ¬æœºéƒ¨ç½²å¼€å‘æ‰‹å†Œï¼ˆâ­ï¸â­ï¸â­ï¸ï¼‰
- æŠ€æœ¯æ´¾å¤šç¯å¢ƒé…ç½®ç®¡ç†ï¼ˆâ­ï¸ï¼‰

æ¬£èµä¸€ä¸‹æŠ€æœ¯æ´¾å®æˆ˜é¡¹ç›®çš„é¦–é¡µå§ï¼Œç»å£æ¸…æ–°ã€é«˜çº§ã€ä¸Šæ¡£æ¬¡ï¼

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/zhishixingqiu/readme-72345f90-68dc-421d-97c5-0ebf411212ae.png)

### æ˜Ÿçƒé™æ—¶ä¼˜æƒ 

ä¸€å¹´å‰ï¼Œæ˜Ÿçƒçš„å®šä»·æ˜¯ 99 å…ƒä¸€å¹´ï¼Œç¬¬ä¸€æ‰¹ä¼˜æƒ åˆ¸çš„é¢åº¦æ˜¯ 30 å…ƒï¼Œç­‰äºè¯´ 69 å…ƒçš„ä½ä»·å°±å¯ä»¥åŠ å…¥ï¼Œå†æ‰£é™¤æ‰æ˜Ÿçƒæ‰‹ç»­è´¹ï¼Œå‡ ä¹å°±æ˜¯çº¯ç²¹åšå…¬ç›Šã€‚

éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ˜Ÿçƒç§¯ç´¯çš„å¹²è´§/èµ„æºè¶Šæ¥è¶Šå¤šï¼Œæˆ‘èŠ±åœ¨æ˜Ÿçƒä¸Šçš„æ—¶é—´ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œ[æ˜Ÿçƒçš„çŸ¥è¯†å›¾è°±](https://tobebetterjavaer.com/zhishixingqiu/map.html)é‡Œæ²‰æ·€çš„é—®é¢˜ï¼Œä½ å¯ä»¥æˆ³è¿™ä¸ª[é“¾æ¥](https://tobebetterjavaer.com/zhishixingqiu/map.html)å»æ„Ÿå—ä¸€ä¸‹ã€‚æœ‰å­¦ä¹ è®¡åˆ’å•Šã€æœ‰å­¦ç”Ÿå…šç§‹æ‹›&æ˜¥æ‹›&offeré€‰æ‹©&è€ƒç ”&å®ä¹ &ä¸“å‡æœ¬&åŸ¹è®­ç­çš„é—®é¢˜å•Šã€æœ‰å·¥ä½œå…šæ–¹å‘é€‰æ‹©&è½¬è¡Œ&æ±‚èŒ&èŒä¸šè§„åˆ’çš„é—®é¢˜å•Šï¼Œè¿˜æœ‰å¤§å¤§å°å°çš„æŠ€æœ¯ç»†èŠ‚ï¼Œæˆ‘éƒ½ç«­å°½å…¨åŠ›å»å¸®åŠ©çƒå‹ï¼Œå¹¶ä¸”å¾—åˆ°äº†çƒå‹çš„è®¤å¯å’Œå°Šé‡ã€‚

ç›®å‰æ˜Ÿçƒå·²ç» 2100+ äººäº†ï¼Œæ‰€ä»¥æ˜Ÿçƒä¹Ÿæ¶¨ä»·åˆ°äº† 119 å…ƒï¼Œåç»­ä¼šè®²æ˜Ÿçƒçš„ä»·æ ¼è°ƒæ•´ä¸º 139 å…ƒ/å¹´ï¼Œæ‰€ä»¥æƒ³åŠ å…¥çš„å°ä¼™ä¼´ä¸€å®šè¦è¶æ—©ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/readme-20230411113706.png)

ä½ å¯ä»¥æ·»åŠ æˆ‘çš„å¾®ä¿¡ï¼ˆæ²¡æœ‰â¼¿æœºå·å†ç”³è¯·å¾®ä¿¡ï¼Œæ•…ä½¿â½¤ä¼ä¸šå¾®ä¿¡ã€‚ä¸è¿‡ï¼Œè¯·æ”¾â¼¼ï¼Œè¿™ä¸ªå·çš„æ¶ˆæ¯ä¹Ÿæ˜¯
æˆ‘æœ¬â¼ˆå¤„ç†ï¼Œå¹³æ—¶æœ€å¸¸çœ‹è¿™ä¸ªå¾®ä¿¡ï¼‰é¢†å–æ˜Ÿçƒä¸“å±ä¼˜æƒ åˆ¸(æ¨è)ï¼Œé™æ—¶ 89/å¹´ åŠ â¼Š(ç»­è´¹åŠä»·)ï¼

<img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/zhishixingqiu/readme-c773d5ff-4458-4d92-868b-2d1d95d6a409.png" title="äºŒå“¥çš„ç¼–ç¨‹æ˜Ÿçƒ" width="300" />


æˆ–è€…ä½ ä¹Ÿå¯ä»¥å¾®ä¿¡æ‰«ç æˆ–è€…é•¿æŒ‰è‡ªåŠ¨è¯†åˆ«é¢†å– 30 å…ƒä¼˜æƒ åˆ¸ï¼Œ**89/å¹´** åŠ å…¥ï¼

<img src="https://cdn.tobebetterjavaer.com/stutymore/readme-20230411114734.png" title="äºŒå“¥çš„ç¼–ç¨‹æ˜Ÿçƒ" width="300" />

å¯¹äº†ï¼Œ**åŠ å…¥æ˜Ÿçƒåè®°å¾—èŠ± 10 åˆ†é’Ÿæ—¶é—´çœ‹ä¸€ä¸‹æ˜Ÿçƒçš„ä¸¤ä¸ªç½®é¡¶è´´ï¼Œä½ ä¼šå‘ç°ç‰©è¶…æ‰€å€¼**ï¼

æˆåŠŸæ²¡æœ‰ä¸€è¹´è€Œå°±ï¼Œæ²¡æœ‰ä¸€é£å†²å¤©ï¼Œä½†åªè¦ä½ èƒ½å¤Ÿä¸€æ­¥ä¸€ä¸ªè„šå°ï¼Œå°±èƒ½å–å¾—ä½ å¿ƒæ»¡æ„è¶³çš„å¥½ç»“æœï¼Œè¯·ç»™è‡ªå·±ä¸€ä¸ªæœºä¼šï¼

æœ€åï¼ŒæŠŠäºŒå“¥çš„åº§å³é“­é€ç»™ä½ ï¼š**æ²¡æœ‰ä»€ä¹ˆä½¿æˆ‘åœç•™â€”â€”é™¤äº†ç›®çš„ï¼Œçºµç„¶å²¸æ—æœ‰ç«ç‘°ã€æœ‰ç»¿è«ã€æœ‰å®é™çš„æ¸¯æ¹¾ï¼Œæˆ‘æ˜¯ä¸ç³»ä¹‹èˆŸ**ã€‚

å…±å‹‰ â›½ï¸ã€‚

## å¦‚ä½•è´¡çŒ®ï¼Ÿ

å¯¹äº†ï¼Œå¦‚æœä½ åœ¨é˜…è¯»çš„è¿‡ç¨‹ä¸­é‡åˆ°ä¸€äº›é”™è¯¯ï¼Œæ¬¢è¿åˆ°æˆ‘çš„å¼€æºä»“åº“æäº¤ issueã€PRï¼ˆå®¡æ ¸é€šè¿‡åå¯æˆä¸º Contributorï¼‰ï¼Œæˆ‘ä¼šç¬¬ä¸€æ—¶é—´ä¿®æ­£ï¼Œæ„Ÿè°¢ä½ ä¸ºåæ¥è€…åšå‡ºçš„è´¡çŒ®ã€‚

>- GitHubï¼š[https://github.com/itwanger/toBeBetterJavaer](https://github.com/itwanger/toBeBetterJavaer)
>- ç äº‘ï¼š[https://gitee.com/itwanger/toBeBetterJavaer](https://gitee.com/itwanger/toBeBetterJavaer)

## æ›´æ–°è®°å½•

### V1.0-2023å¹´04æœˆ11æ—¥

ç¬¬ä¸€ç‰ˆã€ŠäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ã€‹æ­£å¼å®Œç»“å‘å¸ƒï¼

# ç¬¬äºŒç« ï¼šJavaæ¦‚è¿°åŠç¯å¢ƒé…ç½®

## 2.1 Javaç®€ä»‹

â€œäºŒå“¥ï¼Œåˆ°åº•ä»€ä¹ˆæ˜¯ Javaï¼Ÿç»™æˆ‘è¯´è¯´å‘—ã€‚â€

â€œä¸‰å¦¹å•Šï¼Œè¿™å°±ç›´å¥”ä¸»é¢˜äº†å•Šï¼Œå…ˆå»ç»™å“¥ä¹°åŒ…çƒŸå§ï¼Œå“¥å…ˆè€ƒéªŒè€ƒéªŒä½ çš„è¯šå¿ƒã€‚â€

ï¼ˆäº”åˆ†é’Ÿè¿‡åï¼‰

â€œä¸‰å¦¹å•Šï¼Œä½ æ€ä¹ˆè¿˜ä¸å»ï¼Ÿâ€

â€œäºŒå“¥ï¼Œæé’±å•Šã€‚â€

>çœŸæ˜¯äº²å¦¹å•Šï¼Œä¹°åŒ…çƒŸè¿˜å¾—æˆ‘æé’±ï¼Œå…³é”®æ˜¯è¿˜å¾—ç»™è·‘è…¿è´¹ã€‚ååˆ†é’Ÿåï¼Œä¸‰å¦¹ä»æ¥¼ä¸‹å°å–éƒ¨ä¹°äº†ä¸€åŒ…ç†ŠçŒ«å›æ¥äº†ï¼Œæˆ‘ç”¨ Zippo ç«æœºç‚¹äº†ä¸€æ”¯â€”â€”è¿™ç«æœºæ˜¯ 21 å²ç”Ÿæ—¥çš„æ—¶å€™åˆæ‹å¥³å‹é€æˆ‘çš„ï¼Œè´¨é‡ç¡®å®ä¸é”™ï¼Œç°åœ¨è¿˜åœ¨ç”¨ã€‚

â€œä¸‰å¦¹å•Šï¼Œå¬æˆ‘æ…¢æ…¢æ¥ç»™ä½ è§£é‡Šã€‚â€

### 01ã€Javaç”±æ¥

Java æ˜¯ä¸€é—¨è®¡ç®—æœºç¼–ç¨‹è¯­è¨€ï¼Œé«˜çº§ã€å¥å£®ã€é¢å‘å¯¹è±¡ï¼Œå¹¶ä¸”éå¸¸å®‰å…¨ã€‚å®ƒç”± Sun å…¬å¸åœ¨ 1995 å¹´å¼€å‘ï¼Œä¸»åŠ›å¼€å‘å« James Goslingï¼Œè¢«ç§°ä¸º Java ä¹‹çˆ¶ï¼Œå°±æ˜¯ä¸‹å›¾è¿™ä½ï¼Œå¤´ç§ƒçš„å‰å®³ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/one-01.png)

â€œä¸‰å¦¹å•Šï¼Œä½ è¦ä¸è¦å†è€ƒè™‘è€ƒè™‘ï¼Ÿåšç¨‹åºå‘˜ä¸å®¹æ˜“å•Šï¼Œå¾ˆå®¹æ˜“å¤´ç§ƒçš„ï¼â€

â€œäºŒå“¥ï¼Œä½ å’‹æ²¡æœ‰ç§ƒå‘¢ï¼Ÿæ˜¯å› ä¸ºä½ ä¸å¤Ÿå‰å®³å—ï¼Ÿâ€

>è¿™å­©å­ï¼Œå˜´å’‹è¿™ä¹ˆæŸå‘¢ï¼Ÿ

Java åœ¨å«â€œJavaâ€ä¹‹å‰ï¼Œå…¶å®å« Oakï¼ˆæ©¡æ ‘çš„æ„æ€ï¼Œæˆ‘æ„Ÿè§‰å¥½åƒæ¯” Java å¥½å¬ä¸€äº›ï¼‰ã€‚æ€ä¹ˆæƒ³åˆ°æ©¡æ ‘çš„å‘¢ï¼ŸJames Gosling ååœ¨åŠå…¬å®¤ï¼Œæœ›å‘çª—å¤–ï¼Œè§†é‡é‡Œå‡ºç°äº†ä¸€é¢—æ©¡æ ‘ã€‚ä¸è¿‡ï¼Œé—æ†¾çš„æ˜¯ï¼ŒOak å·²ç»è¢«å¦å¤–ä¸€å®¶å…¬å¸æ³¨å†Œäº†ï¼Œå› æ­¤ 1995 å¹´ 5 æœˆ 23 æ—¥ï¼ŒOak è¯­è¨€æ”¹åä¸º Javaã€‚

Java è¿™åå­—å¹¶ä¸æ˜¯ James Gosling çš„é¦–é€‰ï¼Œä¹Ÿä¸æ˜¯å‘½åå›¢é˜Ÿçš„é¦–é€‰ã€‚å›¢é˜Ÿå…¶ä»–äººå‘˜æ›´é’ç Silkï¼ˆä¸ç»¸ï¼‰ï¼Œä½† Gosling ä¸å–œæ¬¢ï¼Œä»–æœ¬äººå–œæ¬¢çš„æ˜¯ Lyricï¼ˆæŠ’æƒ…è¯—ï¼‰ï¼Œä½†æ²¡é€šè¿‡å¾‹å¸ˆè¿™ä¸€å…³ã€‚æœ€åï¼Œæ’åœ¨ç¬¬å››ä½çš„â€œJavaâ€è„±é¢–è€Œå‡ºã€‚æ˜¯ä¸æ˜¯åƒæäº†å©´å„¿æ²¡ç”Ÿä¸‹æ¥ä¹‹å‰ï¼Œå®¶äººå°±ç€æ€¥ç€èµ·åçš„é‚£ç§æ„Ÿè§‰ï¼Œè¿™ä¸ªä½ è§‰å¾—ä¸è¡Œï¼Œé‚£ä¸ªä»–è§‰å¾—ä¸è¡Œï¼Œæœ€åå«äº†â€œç‹—è›‹â€ï¼ˆğŸ˜†ï¼‰ã€‚

James Gosling å›å¿†è¯´ï¼Œâ€œJavaâ€æ˜¯ä¸€ä¸ªå« Mark Opperman çš„äººæè®®çš„ï¼Œä»–æ˜¯åœ¨ä¸€å®¶å’–å•¡åº—å¾—åˆ°çµæ„Ÿçš„ã€‚å¥‡å¦™çš„æ˜¯ï¼Œâ€œJavaâ€è¿™ä¸ªå•è¯ä¹Ÿæ˜¯å°åº¦å°¼è¥¿äºšçˆªå“‡å²›çš„è‹±æ–‡åï¼Œå› ç”Ÿäº§å’–å•¡è€Œé—»åï¼Œå·§ä¸å·§ï¼Ÿ

ä½¿ç”¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨ï¼ˆæ¯”å¦‚è¯´ [wxMEdit](https://wxmedit.github.io/zh_CN/)ï¼‰æ‰“å¼€ç”± Java æºä»£ç ç¼–è¯‘å‡ºçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆ.class æ–‡ä»¶ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»ï¼Œå…ˆä¸ç€æ€¥ï¼‰ï¼Œå°±å¯ä»¥çœ‹å¾—åˆ°ï¼Œæœ€å‰é¢çš„ 8 ä¸ªå­—ç¬¦æ˜¯ CA FE BA BEï¼ˆå®šä¹‰æ–‡ä»¶ç±»å‹çš„é­”æ•°ï¼‰ï¼Œå³è¯ç»„â€œCAFE BABEâ€ï¼ˆå’–å•¡å±‹å®è´ï¼‰ï¼Œæ˜¯ä¸æ˜¯è¿˜æŒºæœ‰æ„æ€çš„ï¼Ÿ

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/one-02.png)

â€œäºŒå“¥ï¼Œèƒ½ç»™æˆ‘å±•ç¤ºä¸€æ®µ Java ä»£ç å—ï¼Ÿæˆ‘æƒ³è¿‘è·ç¦»æ„Ÿå—ä¸€ä¸‹ã€‚â€

â€œä¸‰å¦¹å•Šï¼Œé©¬ä¸Šå°±æ¥ã€‚â€

>æˆ‘å™¼é‡Œå•ªå•¦åœ¨é”®ç›˜ä¸Šä¸€é˜µç‹‚æŒ‰ï¼Œè¯¦ç»†è§[https://tobebetterjavaer.com/overview/hello-world.html](https://tobebetterjavaer.com/overview/hello-world.html)

â€œå¥½ï¼Œä½ çœ‹ï¼Œå°±è¿™æ ·å­ã€‚â€

```java
public class HelloWorld {
    public static void main(String[] args) {
        System.out.println("Hello World");
    }
}
```

â€œäºŒå“¥ï¼Œè¿™éƒ½ä»€ä¹ˆè·Ÿä»€ä¹ˆå•Šï¼Œçœ‹å¾—ä¸€å¤´é›¾æ°´ã€‚â€

â€œä¸‰å¦¹å•Šï¼Œå…ˆä¸è¦ç€æ€¥ï¼ŒHello World è¿™æ®µä»£ç ä»¥åå†æ…¢æ…¢æ¶ˆåŒ–ï¼Œç°åœ¨å°±æ˜¯è®©å®ƒæ¥ç»™ä½ æ‰“ä¸ªæ‹›å‘¼ã€‚â€

â€œå¥½å§ã€‚â€

### 02ã€Javaå‘å±•ç®€å²

20 ä¸–çºª 90 å¹´ä»£ï¼Œå•ç‰‡å¼è®¡ç®—æœºç³»ç»Ÿè¯ç”Ÿã€‚å•ç‰‡å¼è®¡ç®—æœºç³»ç»Ÿä¸ä»…å»‰ä»·ï¼ˆä¹‹å‰çš„è®¡ç®—æœºéå¸¸åºå¤§ï¼Œå¹¶ä¸”æ˜‚è´µï¼‰ï¼Œè€Œä¸”åŠŸèƒ½å¼ºå¤§ï¼Œå¯ä»¥å¤§å¹…åº¦æå‡æ¶ˆè´¹æ€§ç”µå­äº§å“çš„æ™ºèƒ½åŒ–ç¨‹åº¦ã€‚

Sun å…¬å¸ä¸ºäº†æŠ¢å å¸‚åœºå…ˆæœºï¼Œåœ¨ 1991 å¹´æˆç«‹äº†ä¸€ä¸ªç”±è©¹å§†æ–¯Â·é«˜æ–¯æ—ï¼ˆJames Goslingï¼‰é¢†å¯¼çš„ï¼Œåä¸ºâ€œGreenâ€çš„é¡¹ç›®ç»„ï¼Œç›®çš„æ˜¯å¼€å‘ä¸€ç§èƒ½å¤Ÿåœ¨å„ç§æ¶ˆè´¹æ€§ç”µå­äº§å“ä¸Šè¿è¡Œçš„ç¨‹åºæ¶æ„ã€‚

é¡¹ç›®ç»„é¦–å…ˆè€ƒè™‘çš„æ˜¯é‡‡ç”¨ C++ æ¥ç¼–å†™ç¨‹åºï¼Œä½† C++ è¿‡äºå¤æ‚å’Œåºå¤§ï¼Œå†åŠ ä¸Šæ¶ˆè´¹ç”µå­äº§å“æ‰€é‡‡ç”¨çš„åµŒå…¥å¼å¤„ç†å™¨èŠ¯ç‰‡çš„ç§ç±»ç¹æ‚ï¼Œéœ€è¦è®©ç¼–å†™çš„ç¨‹åºèƒ½å¤Ÿè·¨å¹³å°è¿è¡Œå¹¶ä¸å®¹æ˜“â€”â€”C++ åœ¨è·¨å¹³å°æ–¹é¢åšå¾—å¹¶ä¸å¥½ã€‚

æ€å‰æƒ³åï¼Œé¡¹ç›®ç»„æœ€åå†³å®šï¼šåœ¨ C++ çš„åŸºç¡€ä¸Šåˆ›å»ºä¸€ç§æ–°çš„ç¼–ç¨‹è¯­è¨€ï¼Œæ—¢èƒ½å¤Ÿå‰”é™¤ C++ å¤æ‚çš„æŒ‡é’ˆå’Œå†…å­˜ç®¡ç†ï¼Œè¿˜èƒ½å¤Ÿå…¼å®¹å„ç§è®¾å¤‡ã€‚è¿™è¯­è¨€æœ€åˆçš„åå­—å«åš **Greentalk**ï¼Œæ–‡ä»¶æ‰©å±•åä¸º `.gt`ã€‚è¿™ä¸ªåå­—å«çš„æ¯”è¾ƒéšæ„ï¼Œå°±å› ä¸ºé¡¹ç›®ç»„å« Greenï¼Œæ²¡ä»€ä¹ˆç‰¹æ®Šçš„å¯“æ„ã€‚

**Oak** æ˜¯â€œJavaâ€çš„ç¬¬äºŒä¸ªåå­—ï¼Œè¿™æ¬¡å°±æœ‰ç‚¹æ„ä¹‰äº†ã€‚Oakï¼ˆæ©¡æ ‘ï¼‰æ˜¯åŠ›é‡çš„è±¡å¾ï¼Œè¢«ç¾å›½ã€æ³•å›½ã€å¾·å›½ç­‰è®¸å¤šæ¬§ç¾å›½å®¶é€‰ä¸ºå›½æ ‘ã€‚æ©¡æ ‘é•¿ä¸‹é¢è¿™æ ·ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/two-01.png)

1992 å¹´ï¼ŒOak çš„é›å½¢æœ‰äº†ï¼Œä½†é¡¹ç›®ç»„åœ¨å‘ç¡¬ä»¶ç”Ÿäº§å•†è¿›è¡Œå•†æ¼”çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰è·å¾—è®¤å¯ï¼Œäºæ˜¯ Oak å°±è¢«æç½®ä¸€æ—äº†ã€‚

1994 å¹´ï¼Œé¡¹ç›®ç»„å‘ç° Java æ›´é€‚åˆè¿›è¡Œ Internet ç¼–ç¨‹ã€‚éšåï¼Œé¡¹ç›®ç»„ç”¨ Oak è¯­è¨€ç ”å‘äº†ä¸€ç§èƒ½å°†å°ç¨‹åºåµŒå…¥åˆ°ç½‘é¡µä¸­æ‰§è¡Œçš„æŠ€æœ¯â€”â€”Appletã€‚Applet ä¸ä»…èƒ½åµŒå…¥ç½‘é¡µï¼Œè¿˜èƒ½å¤ŸéšåŒç½‘é¡µåœ¨ç½‘ç»œä¸Šè¿›è¡Œä¼ è¾“ã€‚

ä¸å¾—ä¸æ„Ÿæ…¨ä¸€ä¸‹ï¼ŒæŠ€æœ¯çš„æ›´æ–°è¿­ä»£æ˜¯çœŸçš„å¿«ï¼ŒApplet æ‹¯æ•‘äº† Oakï¼Œå¹¶ä½¿å…¶èœ•å˜æˆé¡¶å¤©ç«‹åœ°çš„ Javaï¼Œä½† Applet å¾ˆæ—©ä¹‹å‰å°±è¢«æ— æƒ…åœ°æ‹æ­»åœ¨äº†æ²™æ»©ä¸Šã€‚æ˜¯ä¸æ˜¯å¾ˆæ®‹é…·ï¼Ÿ

1995 å¹´ï¼ŒOak è¢«é‡æ–°å‘½åä¸ºâ€œJavaâ€ï¼Œå› ä¸º Oak è¢«åˆ«çš„å…¬å¸æ³¨å†Œè¿‡äº†ã€‚æ–°çš„åå­—æœ€å¥½èƒ½å¤Ÿè¡¨è¾¾å‡ºæŠ€æœ¯çš„æœ¬è´¨ï¼šdynamicï¼ˆåŠ¨æ€çš„ï¼‰ã€revolutionaryï¼ˆé©å‘½æ€§çš„ï¼‰ã€Silkï¼ˆåƒä¸ç»¸ä¸€æ ·æŸ”è½¯çš„ï¼‰ã€Coolï¼ˆç‚«é…·çš„ï¼‰ç­‰ç­‰ã€‚å¦å¤–ï¼Œåå­—ä¸€å®šè¦å®¹æ˜“æ‹¼å†™ï¼Œå¿µèµ·æ¥ä¹Ÿæ¯”è¾ƒæœ‰è¶£ã€‚

é€‰æ¥é€‰å»ï¼Œé¡¹ç›®ç»„æœ€åé€‰æ‹©äº†â€œJavaâ€ï¼Œä¸­æ–‡å«â€œçˆªå“‡â€ã€‚ç»†å¿ƒçš„å°ä¼™ä¼´å¯èƒ½ä¼šå‘ç°ï¼ŒJava è¿™ä¸ªå•è¯é‡Œæœ‰ä¸€ä¸ªæ•æ„Ÿè¯ï¼Œæ‰€ä»¥æœ‰æ®µæ—¶é—´å¾®ä¿¡ï¼ˆæ–‡ç« ä¸“è¾‘åè¿™å—ï¼‰ä¸ºäº†ç¦æ•æ„Ÿè¯ï¼Œç«Ÿç„¶æŠŠ Java éƒ½ç¦äº†ï¼Œæˆ‘å½“æ—¶å°±åªèƒ½ç”¨çˆªå“‡æ¥ä»£æ›¿ Javaï¼Œæ‰‹åŠ¨ç‹—å¤´ã€‚

â€œJavaâ€æ˜¯å°åº¦å°¼è¥¿äºšçˆªå“‡å²›çš„è‹±æ–‡åï¼Œå› ç”Ÿäº§å’–å•¡è€Œé—»åï¼Œæ‰€ä»¥ï¼Œå°ä¼™ä¼´ä¹Ÿçœ‹åˆ°äº†ï¼ŒJava è¿™ä¸ªå•è¯ç»å¸¸å’Œä¸€æ¯å†’ç€çƒ­æ°”çš„å’–å•¡ä¸€èµ·å‡ºç°ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/two-02.png)

åŒå¹´ï¼ŒSun å…¬å¸åœ¨ SunWorld å¤§ä¼šä¸Šæ­£å¼å‘å¸ƒäº† Java 1.0 ç‰ˆæœ¬ï¼Œç¬¬ä¸€æ¬¡æå‡ºäº†â€œWrite Once, Run anywhereâ€çš„å£å·ã€‚ã€Šæ—¶ä»£ã€‹æ‚å¿—å°† Java è¯„ä¸º 1995 å¹´åå¤§æœ€ä½³äº§å“ä¹‹ä¸€ã€‚

1996 å¹´ 1 æœˆ 23 æ—¥ï¼ŒJDK 1.0 å‘å¸ƒï¼ŒJava è¯­è¨€æœ‰äº†ç¬¬ä¸€ä¸ªæ­£å¼ç‰ˆæœ¬çš„è¿è¡Œç¯å¢ƒã€‚JDK 1.0 æ˜¯ä¸€ä¸ªçº¯è§£é‡Šæ‰§è¡Œçš„ Java è™šæ‹Ÿæœºï¼Œä»£è¡¨æŠ€æœ¯æœ‰ï¼šJava è™šæ‹Ÿæœºã€AWTï¼ˆå›¾å½¢åŒ–ç•Œé¢ï¼‰ã€Appletã€‚

4 æœˆï¼Œåä¸ªä¸»è¦çš„æ“ä½œç³»ç»Ÿå’Œè®¡ç®—æœºä¾›åº”å•†å®£ç§°å°†åœ¨äº§å“ä¸­åµŒå…¥ Java æŠ€æœ¯ã€‚9 æœˆï¼Œå·²æœ‰å¤§çº¦ 8.3 ä¸‡ç½‘é¡µåº”ç”¨é‡‡ç”¨äº† Java æ¥åˆ¶ä½œã€‚5 æœˆåº•ï¼Œç¬¬ä¸€å±Š JavaOne å¤§ä¼šåœ¨æ—§é‡‘å±±ä¸¾è¡Œï¼Œä»æ­¤ï¼ŒJavaOne æˆä¸ºå…¨ä¸–ç•Œæ•°ç™¾ä¸‡ Java è¯­è¨€å¼€å‘è€…çš„æŠ€æœ¯ç››ä¼šã€‚

 1997 å¹´ 2 æœˆ 19 æ—¥ï¼ŒJDK 1.1 å‘å¸ƒï¼Œä»£è¡¨æŠ€æœ¯æœ‰ï¼šJAR æ–‡ä»¶æ ¼å¼ã€JDBCã€JavaBeansã€RMIï¼ˆè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼‰ã€‚

1998 å¹´ 12 æœˆ 4 æ—¥ï¼ŒJDK 1.2 å‘å¸ƒï¼Œè¿™æ˜¯ä¸€ä¸ªé‡Œç¨‹ç¢‘å¼çš„ç‰ˆæœ¬ã€‚Sun åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­æŠŠ Java æ‹†åˆ†ä¸ºä¸‰ä¸ªæ–¹å‘ï¼šé¢å‘æ¡Œé¢å¼€å‘çš„ J2SEã€é¢å‘ä¼ä¸šå¼€å‘çš„ J2EEï¼Œé¢å‘ç§»åŠ¨å¼€å‘çš„ J2MEã€‚ä»£è¡¨æŠ€æœ¯æœ‰ï¼šEJBã€Swingã€‚

2000 å¹´ 5 æœˆ 8 æ—¥ï¼ŒJDK 1.3 å‘å¸ƒï¼Œå¯¹ Java 2D åšäº†å¤§å¹…ä¿®æ”¹ã€‚

2002 å¹´ 2 æœˆ 13 æ—¥ï¼ŒJDK 1.4 å‘å¸ƒï¼Œè¿™æ˜¯ Java çœŸæ­£èµ°å‘æˆç†Ÿçš„ä¸€ä¸ªç‰ˆæœ¬ï¼ŒIBMã€å¯Œå£«é€šï¼ˆäºŒå“¥æ›¾åœ¨è¿™å®¶ä¸–ç•Œ 500 å¼ºçš„æ—¥ä¼å·¥ä½œè¿‡ä¸‰å¹´åŠæ—¶é—´ï¼‰ç­‰è‘—åå…¬å¸éƒ½æœ‰å‚ä¸ã€‚ä»£è¡¨æŠ€æœ¯æœ‰ï¼šæ­£åˆ™è¡¨è¾¾å¼ã€NIOã€‚

2004 å¹´ 9 æœˆ 30 æ—¥ï¼ŒJDK 5 å‘å¸ƒï¼Œæ³¨æ„ Sun æŠŠâ€œ1.xâ€çš„å‘½åæ–¹å¼æŠ›å¼ƒäº†ã€‚JDK 5 åœ¨ Java è¯­æ³•çš„æ˜“ç”¨æ€§ä¸Šåšå‡ºäº†éå¸¸å¤§çš„æ”¹è¿›ï¼Œæ¯”å¦‚è¯´ï¼šè‡ªåŠ¨è£…ç®±ã€æ³›å‹ã€åŠ¨æ€æ³¨è§£ã€æšä¸¾ã€å¯å˜å‚æ•°ã€foreach å¾ªç¯ã€‚

2006 å¹´ 12 æœˆ 11 æ—¥ï¼ŒJDK 6 å‘å¸ƒï¼ŒJ2SE å˜æˆäº† Java SE 6ï¼ŒJ2EE å˜æˆäº† Java EE 6ï¼ŒJ2ME å˜æˆäº† Java ME 6ã€‚JDK 6 ææ€•æ˜¯ Java å†å²ä¸Šä½¿ç”¨å¯¿å‘½æœ€é•¿çš„ä¸€ä¸ªç‰ˆæœ¬äº†ã€‚ä¸»è¦çš„åŸå› æœ‰ï¼šä»£ç å¤æ‚æ€§çš„å¢åŠ ã€ä¸–ç•Œç»æµå±æœºã€Oracle å¯¹ Sun çš„æ”¶è´­ã€‚

JDK 6 çš„æœ€åä¸€ä¸ªå‡çº§è¡¥ä¸ä¸º Java SE 6 Update 211ï¼Œ äº 2018 å¹´ 10 æœˆ 18 æ—¥å‘å¸ƒâ€”â€”12 å¹´çš„è·¨åº¦å•Šï¼

2009 å¹´ 2 æœˆ 19 æ—¥ï¼ŒJDK 7 å‘å¸ƒï¼Œä½†åŠŸèƒ½æ˜¯é˜‰å‰²çš„ã€‚å¾ˆå¤šç¿˜é¦–ä»¥ç›¼çš„åŠŸèƒ½éƒ½æ²¡æœ‰å®Œæˆï¼Œæ¯”å¦‚è¯´ Lambda  è¡¨è¾¾å¼ã€‚ä¸»è¦æ˜¯å› ä¸º Sun å…¬å¸åœ¨å•†ä¸šä¸Šé™·å…¥äº†æ³¥æ²¼ï¼Œå·²ç»æ— åŠ›æ¨åŠ¨ JDK 7 çš„ç ”å‘å·¥ä½œã€‚

2009 å¹´ 4 æœˆ 20 æ—¥ï¼ŒOracle ä»¥ 74 äº¿ç¾å…ƒçš„ä»·æ ¼æ”¶è´­äº†å¸‚å€¼æ›¾è¶…è¿‡ 2000 äº¿ç¾å…ƒçš„ Sun å…¬å¸â€”â€”å¤ªé˜³ç»ˆç©¶è¿˜æ˜¯è½å±±äº†ã€‚å¯¹äº Java è¯­è¨€è¿™ä¸ªå­©å­æ¥è¯´ï¼Œå¯ä»¥è¯´æ˜¯å¥½äº‹ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯åäº‹ã€‚å¥½äº‹æ˜¯ Oracle æœ‰é’±ï¼Œèƒ½å¤Ÿæ³¨å…¥èµ„é‡‘æ¨åŠ¨ Java çš„å‘å±•ï¼›åå¤„å°±æ˜¯ Oracle æ˜¯åçˆ¸ï¼Œå¯¹ Java è‚¯å®šæ²¡æœ‰ Sun é‚£ä¹ˆäº²ï¼Œèµ°çš„æ˜¯æå…·å•†ä¸šåŒ–çš„é“è·¯ã€‚

2014 å¹´ 3 æœˆ 18 æ—¥ï¼ŒJDK 8 ç»ˆäºæ¥äº†ï¼Œæ­¥ä¼æ˜¯é‚£ä¹ˆè¹’è·šï¼Œä½†ç»ˆç©¶è¿˜æ˜¯æ¥äº†ã€‚å¸¦ç€æœ€å¼ºæœ‰åŠ›çš„æ­¦å™¨â€”â€”Lambda è¡¨è¾¾å¼è€Œæ¥ã€‚è™½ç„¶ JDK 19 é©¬ä¸Šå°±å‘å¸ƒäº†ï¼Œä½†â€œæ–°ç‰ˆä»»ä½ å‘ï¼Œæˆ‘ç”¨ Java 8â€çš„æ¢—è‡³ä»Šè¿˜æµä¼ ç€ã€‚

2017 å¹´ 9 æœˆ 21 æ—¥ï¼ŒJDK 9 å‘å¸ƒã€‚ä»æ­¤ä»¥åï¼ŒJDK æ›´æ–°ç‰ˆæœ¬çš„é€Ÿåº¦ä»¤å¼€å‘è€…åº”æ¥ä¸æš‡ï¼ŒåŠå¹´ä¸€ä¸ªç‰ˆæœ¬ï¼Œè™½ç„¶ Oracle çš„ç›®çš„æ˜¯å¥½çš„ï¼Œä¸ºäº†é¿å…å› åŠŸèƒ½å¢åŠ è€Œå¼•å‘çš„è·³ç¥¨é£é™©ï¼Œä½†ä¸å¾—ä¸æ‰¿è®¤ï¼Œç‰ˆæœ¬æ›´æ–°çš„èŠ‚å¥å®åœ¨æ˜¯æœ‰ç‚¹è¿‡äºé¢‘ç¹ã€‚

è¿™å°±å¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼Œå¥½ä¸å®¹æ˜“æ›´æ–°ä¸€ä¸ªç‰ˆæœ¬ï¼Œç”¨äº†å…­ä¸ªæœˆåï¼ŒOracle ä¸ç»´æŠ¤äº†ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼ŒOracle ç»™å‡ºçš„è§£å†³æ–¹æ¡ˆæŒºå¥‡è‘©çš„ï¼Œæ¯å…­ä¸ª JDK å¤§ç‰ˆæœ¬æ‰ä¼šè¢«é•¿æœŸæ”¯æŒï¼ˆLong Term Supportï¼ŒLTSï¼‰ã€‚

JDK 8 æ˜¯ LTS ç‰ˆï¼Œ2018 å¹´ 9 æœˆ 25 æ—¥å‘å¸ƒçš„ JDK 11 æ˜¯ LTS ç‰ˆï¼Œ 2018 å¹´ 3 æœˆ 20 æ—¥å‘å¸ƒçš„ JDK 10 å°±å¯ä»¥ä¸€ç¬”å¸¦è¿‡äº†ã€‚

2021 å¹´å‘å¸ƒçš„ JDK 17 æ˜¯ç›®å‰æœ€æ–°çš„ LTS ç‰ˆæœ¬ã€‚

JDK 12ã€JDK 13ã€JDK 14ã€JDK 15ã€JDK 16ã€JDK 18ã€JDK 19 éƒ½æ˜¯è¿‡æ¸¡äº§å“ï¼Œå°±å¥½åƒæ˜¯è¯•éªŒå“ä¸€æ ·ï¼Œä¸å¤ªå—å¼€å‘è€…å¾…è§ã€‚

Java å‘å±•åˆ°ä»Šå¤©å·²ç» 20 å¤šå¹´äº†ï¼Œä½œä¸ºä¸€ä¸ªç¼–ç¨‹è¯­è¨€ç¡®å®ä¸ç®€å•ï¼ŒJava ä»£è¡¨çš„é¢å‘å¯¹è±¡æ€æƒ³ç¡®å®ç»™å·¥ç¨‹é¢†åŸŸå¸¦æ¥äº†é©å‘½æ€§çš„å˜åŒ–ï¼Œå…³é”®æ˜¯ Java ä¸€ç›´åœ¨æ‹¥æŠ±å˜åŒ–ã€‚

å¤§æ•°æ®æ–¹é¢ï¼Œæœ‰ Apache Kafkaã€Apache Samzaã€Apache Stormã€Apache Sparkã€Apache Flinkï¼Œé™¤äº† Spark æ˜¯åŸºäº JVM çš„å‡½æ•°è¯­è¨€ Scala ç¼–å†™çš„ï¼Œå…¶ä½™éƒ½æ˜¯ Java ç¼–å†™çš„ã€‚

Java åœ¨äº‘æ—¶ä»£é¢ä¸´ç€ä»¥ Go è¯­è¨€ä¸ºä¸»çš„å®¹å™¨ï¼ˆDocker ç­‰æŠ€æœ¯ï¼‰ç”Ÿæ€åœˆçš„æŒ‘æˆ˜ï¼Œä½†æ˜¯ï¼ŒJava çš„å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿè¶Šæ¥è¶Šå¤šï¼ŒJava åœ¨äº‘è®¡ç®—ä¸åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è¿˜æ˜¯æ‰®æ¼”ç€ä¸»è¦è§’è‰²ï¼Œå¹¶ä¸”å½¢æˆäº†ä¸€ä¸ªå¤§å‹çš„ç”Ÿæ€åœˆã€‚

è™½ç„¶ Java å’Œ C++ï¼ŒC ä¸€æ ·ï¼Œéƒ½â€œè€â€äº†ï¼Œè¢«å…¶ä»–è¯­è¨€ä¸æ–­åœ°æŒ‘æˆ˜ï¼Œä½†åªæœ‰å¼ºè€…æ‰æœ‰æœºä¼šæ¥å—æŒ‘æˆ˜ï¼Œå¯¹å§ï¼Ÿæˆ‘ç›¸ä¿¡ï¼ŒJava çš„æœªæ¥ä¾ç„¶å¾ˆå…‰æ˜ã€‚

### 03ã€Javaç‰¹æ€§

å°½ç®¡ Java å·²ç» 25 å²äº†ï¼Œä½†ä»ç„¶â€œå®åˆ€æœªè€â€ã€‚åœ¨ Stack Overflow 2019 å¹´æµè¡Œç¼–ç¨‹è¯­è¨€è°ƒæŸ¥æŠ¥å‘Šä¸­ï¼ŒJava ä½å±…ç¬¬ 5 ä½ï¼Œæœ‰ 41% çš„å—è°ƒå¼€å‘è€…è®¤ä¸º Java ä»ç„¶æ˜¯ä¸€é—¨å—æ¬¢è¿çš„ç¼–ç¨‹è¯­è¨€ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/three-01.png)

å›½å†…å¯¹ Java çš„ä½¿ç”¨ç‡è¿œè¶…å›½å¤–ï¼Œæ‰€ä»¥å›½å†… Java çš„å¸‚åœºå æœ‰ç‡æ›´å¤§ï¼Œä¸ç®¡æ˜¯ 2020 å¹´è¿˜æ˜¯ 2021ã€2022ã€2023 å¹´ï¼ŒçŸ­æ—¶é—´å†…ï¼ŒJava çš„éœ¸ä¸»åœ°ä½å¾ˆéš¾æ’¼åŠ¨ã€‚

è™½ç„¶è¿™äº›å¹´ Java å¾ˆå·çš„è¯ï¼Œç”šåš£å°˜ä¸Šï¼Œæˆ‘åªèƒ½è¯´è¿™æ ·çš„å£°éŸ³æ¯å¹´éƒ½æœ‰ï¼Œå¬å¬å°±å¥½äº†ã€‚

å¾ˆå¤šå¤§å‹çš„äº’è”ç½‘å…¬å¸éƒ½åœ¨ä½¿ç”¨ Javaï¼Œå›½å†…æœ€æœ‰åçš„å½“å±é˜¿é‡Œå·´å·´ï¼Œå›½å¤–æœ€æœ‰åçš„å½“å±è°·æ­Œã€‚é‚£ä¸ºä»€ä¹ˆ Java å¦‚æ­¤æµè¡Œå‘¢ï¼Ÿ

#### **1ï¼‰ç®€å•æ€§**

Java ä¸ºå¼€å‘è€…æä¾›äº†ç®€å•æ˜“ç”¨çš„ç”¨æˆ·ä½“éªŒï¼Œä¸å…¶ä»–é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€ç›¸æ¯”ï¼ŒJava çš„è®¾è®¡å’Œç”Ÿæ€åº“å…·æœ‰å·¨å¤§çš„ä¼˜åŠ¿ã€‚Java å‰”é™¤äº† C++ ä¸­å¾ˆå°‘ä½¿ç”¨ã€éš¾ä»¥ç†è§£ã€æ˜“æ··æ·†çš„ç‰¹åˆ«ï¼Œæ¯”å¦‚è¯´æŒ‡é’ˆè¿ç®—ã€æ“ä½œç¬¦é‡è½½ï¼Œå†…å­˜ç®¡ç†ç­‰ã€‚

Java å¯ä»¥åšåˆ°å †æ ˆåˆ†é…ã€åƒåœ¾å›æ”¶å’Œè‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šä¸ºå¼€å‘è€…å‡è½»äº†å…¥é—¨çš„éš¾åº¦ã€‚

#### **2ï¼‰å¯ç§»æ¤æ€§**

å¦‚æœ Java ç›´æ¥ç¼–è¯‘æˆæ“ä½œç³»ç»Ÿèƒ½è¯†çš„äºŒè¿›åˆ¶ç ï¼Œå¯èƒ½ä¸€ä¸ªæ ‡è¯†åœ¨ Windows æ“ä½œç³»ç»Ÿä¸‹æ˜¯1100ï¼Œè€Œ Linux ä¸‹æ˜¯ 1001ï¼Œè¿™æ ·çš„è¯ï¼Œåœ¨ Windows æ“ä½œç³»ç»Ÿä¸‹å¯ä»¥è¿è¡Œçš„ç¨‹åºåˆ°äº† Linux ç¯å¢ƒä¸‹å°±æ— æ³•è¿è¡Œã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJava å…ˆç¼–è¯‘ç”Ÿæˆå­—èŠ‚ç ï¼Œå†ç”± JVMï¼ˆJava è™šæ‹Ÿæœºï¼‰æ¥è§£é‡Šæ‰§è¡Œï¼Œç›®çš„å°±æ˜¯å°†ç»Ÿä¸€çš„å­—èŠ‚ç è½¬æˆæ“ä½œç³»ç»Ÿå¯ä»¥è¯†åˆ«çš„äºŒè¿›åˆ¶ç ï¼Œç„¶åæ‰§è¡Œã€‚è€Œé’ˆå¯¹ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œéƒ½æœ‰ç›¸åº”ç‰ˆæœ¬çš„ JVMï¼Œæ‰€ä»¥ Java å°±å®ç°äº†å¯ç§»æ¤æ€§ã€‚

#### **3ï¼‰å®‰å…¨æ€§**

Java é€‚ç”¨äºç½‘ç»œ/åˆ†å¸ƒå¼ç¯å¢ƒï¼Œä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®æ ‡ï¼Œåœ¨å®‰å…¨æ–¹é¢æŠ•å…¥äº†å·¨å¤§çš„ç²¾åŠ›ã€‚ä½¿ç”¨ Java å¯ä»¥æ„å»ºé˜²ç—…æ¯’ã€é˜²ç¯¡æ”¹çš„ç¨‹åºã€‚

ä»ä¸€å¼€å§‹ï¼ŒJava å°±è®¾è®¡äº†å¾ˆå¤šå¯ä»¥é˜²èŒƒæ”»å‡»çš„æœºåˆ¶ï¼Œæ¯”å¦‚è¯´ï¼š

- è¿è¡Œæ—¶å †æ ˆæº¢å‡ºï¼Œè¿™æ˜¯è •è™«ç—…æ¯’å¸¸ç”¨çš„æ”»å‡»æ‰‹æ®µã€‚
- å­—èŠ‚ç éªŒè¯ï¼Œå¯ä»¥ç¡®ä¿ä»£ç ç¬¦åˆ JVM è§„èŒƒå¹¶é˜²æ­¢æ¶æ„ä»£ç ç ´åè¿è¡Œæ—¶ç¯å¢ƒã€‚
- å®‰å…¨çš„ç±»åŠ è½½ï¼Œå¯ä»¥é˜²æ­¢ä¸å—ä¿¡ä»»çš„ä»£ç å¹²æ‰° Java ç¨‹åºçš„è¿è¡Œã€‚
- å…¨é¢çš„ API æ”¯æŒå¹¿æ³›çš„åŠ å¯†æœåŠ¡ï¼ŒåŒ…æ‹¬æ•°å­—ç­¾åã€æ¶ˆæ¯æ‘˜è¦ã€ï¼ˆå¯¹ç§°ã€éå¯¹ç§°ï¼‰å¯†ç ã€å¯†é’¥ç”Ÿæˆå™¨ã€‚
- å®‰å…¨é€šä¿¡ï¼Œæ”¯æŒ HTTPSã€SSLï¼Œä¿æŠ¤ä¼ è¾“çš„æ•°æ®å®Œæ•´æ€§å’Œéšç§æ€§ã€‚

#### **4ï¼‰å¹¶å‘æ€§**

Java åœ¨å¤šçº¿ç¨‹æ–¹é¢åšå¾—éå¸¸çªå‡ºï¼Œåªè¦æ“ä½œç³»ç»Ÿæ”¯æŒï¼ŒJava ä¸­çš„çº¿ç¨‹å°±å¯ä»¥åˆ©ç”¨å¤šä¸ªå¤„ç†å™¨ï¼Œå¸¦æ¥äº†æ›´å¥½çš„äº¤äº’å“åº”å’Œå®æ—¶è¡Œä¸ºã€‚

### 04ã€Javaåº”ç”¨é¢†åŸŸ

â€œäºŒå“¥ï¼Œé‚£ Java è¿˜ä¼šç»§ç»­æµè¡Œä¸‹å»å—ï¼Ÿâ€ä¸‰å¦¹çœ¨äº†çœ¨å¥¹çš„é•¿ç«æ¯›ï¼Œå¯¹æˆ‘è¯´ã€‚

â€œå½“ç„¶ï¼è¿™ä¸»è¦å¾—ç›Šäº Java å¹¿æ³›çš„åº”ç”¨åœºæ™¯ã€‚â€æˆ‘æ–©é’‰æˆªé“åœ°å›ç­”åˆ°ã€‚

#### **å¤§æ•°æ®é¢†åŸŸï¼š**

ä¸ Python ä¸€æ ·ï¼ŒJava åœ¨å¤§æ•°æ®é¢†åŸŸå æ®ç€ä¸»å¯¼åœ°ä½ï¼Œå¾ˆå¤šç”¨äºå¤„ç†å¤§è§„æ¨¡æ•°æ®çš„æ¡†æ¶éƒ½æ˜¯åŸºäº Java å¼€å‘çš„ã€‚

- Apache Hadoopï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­å¤„ç†å¤§è§„æ¨¡æ•°æ®é›†ã€‚Hadoop é‡‡ç”¨äº†ä¸»å‰¯æ¶æ„æ¨¡å¼ï¼Œå…¶ä¸­ä¸»èŠ‚ç‚¹è´Ÿè´£æ§åˆ¶æ•´ä¸ªåˆ†å¸ƒå¼è®¡ç®—æ ˆã€‚Hadoop åœ¨éœ€è¦å¤„ç†å’Œåˆ†æå¤§è§„æ¨¡æ•°æ®çš„å…¬å¸å½“ä¸­å¾ˆæµè¡Œã€‚
- Apache Sparkï¼Œå¤§å‹çš„ ETLï¼ˆæ•°æ®ä»“åº“æŠ€æœ¯ï¼‰ã€é¢„æµ‹åˆ†æå’ŒæŠ¥è¡¨ç¨‹åºç»å¸¸ä½¿ç”¨åˆ° Sparkã€‚
- Apache Mahoutï¼Œç”¨äºæœºå™¨å­¦ä¹ ï¼Œæ¯”å¦‚åˆ†ç±»ã€èšç±»å’Œæ¨èã€‚
- JFreechartï¼Œç”¨äºå¯è§†åŒ–æ•°æ®ï¼Œå¯ä»¥ç”¨å®ƒåˆ¶ä½œå„ç§å›¾è¡¨ï¼Œæ¯”å¦‚é¥¼å›¾ã€æŸ±çŠ¶å›¾ã€çº¿å›¾ã€æ•£ç‚¹å›¾ã€ç›’çŠ¶å›¾ã€ç›´æ–¹å›¾ç­‰ç­‰ã€‚
- Deeplearning4jï¼Œç”¨äºæ„å»ºå„ç§ç±»å‹çš„ç¥ç»ç½‘ç»œï¼Œå¯ä»¥ä¸ Spark é›†æˆï¼Œè¿è¡Œåœ¨ GPUï¼ˆå›¾å½¢å¤„ç†å™¨ï¼‰ä¸Šã€‚
- Apache Stormï¼Œç”¨äºå¤„ç†å®æ—¶æ•°æ®æµï¼Œä¸€ä¸ª Storm èŠ‚ç‚¹å¯ä»¥åœ¨ç§’çº§å¤„ç†æ•°ç™¾ä¸‡ä¸ªä½œä¸šã€‚

#### **ç‰©è”ç½‘ï¼ˆIoTï¼‰é¢†åŸŸï¼š**

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/three-02.png)

Oracle è¡¨ç¤ºï¼Œçµæ´»æ€§å’Œæµè¡Œåº¦æ˜¯ IoT ç¨‹åºå‘˜é€‰æ‹© Java çš„ä¸»è¦åŸå› ã€‚Java æä¾›äº†å¤§é‡çš„ API åº“ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åº”ç”¨åˆ°åµŒå…¥å¼åº”ç”¨ç¨‹åºä¸­ã€‚ç›¸æ¯”å…¶ä»–ç¼–ç¨‹è¯­è¨€ï¼Œæ¯”å¦‚ C è¯­è¨€ï¼ŒJava åœ¨åˆ‡æ¢å¹³å°æ—¶æ›´åŠ é¡ºç•…ï¼Œä¸å®¹æ˜“å‡ºé”™ã€‚

#### **é‡‘èæœåŠ¡é¢†åŸŸï¼š**

- èŠå¤©æœºå™¨äººï¼Œç”±äºå¯ç§»æ¤æ€§ã€å¯ç»´æŠ¤æ€§ã€å¯è§†åŒ–ç­‰è¯¸å¤šæ–¹é¢çš„å› ç´ ï¼ŒJava æˆäº†å¼€å‘èŠå¤©æœºå™¨äººæœ€å¥½çš„å·¥å…·ã€‚
- æ¬ºè¯ˆæ£€æµ‹å’Œç®¡ç†ï¼Œé“¶è¡Œå’Œé‡‘èå…¬å¸ä½¿ç”¨ AIï¼ˆäººå·¥æ™ºèƒ½ï¼‰å·¥å…·æ¥è¿›è¡Œé‡‘èæ¬ºè¯ˆå’Œä¿¡ç”¨å¡æ¬ºè¯ˆæ£€æµ‹ï¼Œè€Œ Java å¸¸ç”¨æ¥å¼€å‘è¿™äº› AI å·¥å…·ã€‚
- äº¤æ˜“ç³»ç»Ÿï¼ŒJava è™šæ‹Ÿæœºæä¾›çš„åŠ¨æ€è¿è¡Œæ—¶ç¼–è¯‘ä¼˜åŒ–åœ¨å¾ˆå¤šæƒ…å†µä¸‹æ¯”ç¼–è¯‘å‹è¯­è¨€ï¼ˆå¦‚ C++ï¼‰å…·æœ‰æ›´å¥½çš„æ€§èƒ½ï¼Œè®©äº¤æ˜“ç³»ç»Ÿè¿è¡Œå¾—æ›´é¡ºç•…ã€‚
- ç§»åŠ¨é’±åŒ…ï¼ŒåŸºäº AI å’Œ Java ç®—æ³•å¼€å‘çš„ç§»åŠ¨é’±åŒ…ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·åœ¨èŠ±é’±æ—¶åšå‡ºæ›´æ™ºèƒ½çš„å†³ç­–ã€‚

#### **Web é¢†åŸŸï¼š**

Java æŠ€æœ¯å¯¹ Web é¢†åŸŸçš„å‘å±•æ³¨å…¥äº†å¼ºå¤§çš„åŠ¨åŠ›ï¼Œä¸»æµçš„ Java Web å¼€å‘æ¡†æ¶æœ‰å¾ˆå¤šï¼š

-  Spring æ¡†æ¶ï¼Œä¸€ä¸ªè½»é‡çº§çš„æ§åˆ¶åè½¬ï¼ˆIoCï¼‰å’Œé¢å‘åˆ‡é¢ï¼ˆAOPï¼‰çš„å®¹å™¨æ¡†æ¶ï¼Œæ¸—é€äº† Java EE æŠ€æœ¯çš„æ–¹æ–¹é¢é¢ï¼Œç»å¤§éƒ¨åˆ† Java åº”ç”¨éƒ½å¯ä»¥ä» Spring æ¡†æ¶ä¸­å—ç›Šã€‚
- Spring MVC æ¡†æ¶ï¼Œæ˜¯ä¸€ç§åŸºäº Java å®ç°çš„ MVCï¼ˆModel-View-Controllerï¼‰è®¾è®¡æ¨¡å¼çš„è¯·æ±‚é©±åŠ¨ç±»å‹çš„è½»é‡çº§ Web æ¡†æ¶ã€‚
- MyBatis æ¡†æ¶ï¼Œä¸€ä¸ªä¼˜ç§€çš„æ•°æ®æŒä¹…å±‚æ¡†æ¶ï¼Œå¯åœ¨å®ä½“ç±»å’Œ SQL è¯­å¥ä¹‹é—´å»ºç«‹æ˜ å°„å…³ç³»ï¼Œæ˜¯ä¸€ç§åŠè‡ªåŠ¨åŒ–çš„ ORMï¼ˆObject Relational Mappingï¼Œå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰å®ç°ã€‚
- JavaServer Faces æ¡†æ¶ï¼Œç”± Oracle å¼€å‘ï¼Œèƒ½å¤Ÿå°†è¡¨ç¤ºå±‚ä¸åº”ç”¨ç¨‹åºä»£ç è½»æ¾è¿æ¥ï¼Œå®ƒæä¾›äº†ä¸€ä¸ª API é›†ï¼Œç”¨äºè¡¨ç¤ºå’Œç®¡ç† UI ç»„ä»¶ã€‚

æ€»ä¹‹ï¼ŒOracle å®£ç§°ï¼ŒJava æ­£è¿è¡Œåœ¨ 97% çš„ä¼ä¸šè®¡ç®—æœºä¸Šâ€”â€”æœ‰ç‚¹å‰å®³çš„æ ·å­ã€‚

### 05ã€å­¦Javaæœ‰é’±é€”å—ï¼Ÿ

â€œäºŒå“¥ï¼Œå­¦ Java åˆ°åº•æœ‰æ²¡æœ‰å‰é€”å•Šï¼Ÿæˆ‘æ¯•ä¸šä»¥åèƒ½ä¸èƒ½æ‰¾åˆ°å·¥ä½œå•Šï¼Ÿâ€

â€œä¸‰å¦¹å•Šï¼Œå°±ç›®å‰æ¥è¯´ï¼ŒJava ä¸ä»…ä»…æ˜¯ä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒè¿˜æ˜¯ä¸€ä¸ªç”±ä¸€ç³»åˆ—è®¡ç®—æœºè½¯ä»¶å’Œè§„èŒƒç»„æˆçš„æŠ€æœ¯ä½“ç³»ï¼Œè¿™ä¸ªæŠ€æœ¯ä½“ç³»æä¾›äº†å®Œæ•´çš„ç”¨äºè½¯ä»¶å¼€å‘å’Œè·¨å¹³å°éƒ¨ç½²çš„æ”¯æŒç¯å¢ƒï¼Œå¹¶å¹¿æ³›åº”ç”¨äºä»¥ä¸‹è¿™äº›åœºåˆã€‚â€

- 1ï¼‰æ¡Œé¢åº”ç”¨ç¨‹åºï¼›
- 2ï¼‰Web åº”ç”¨ç¨‹åºï¼›
- 3ï¼‰ä¼ä¸šåº”ç”¨ç¨‹åºï¼Œä½“ç°å‡ºäº† Java çš„å®‰å…¨æ€§ã€è´Ÿè½½å‡è¡¡å’Œé›†ç¾¤çš„ä¼˜åŠ¿ï¼›
- 4ï¼‰ç§»åŠ¨ç«¯åº”ç”¨ç¨‹åºï¼Œä¸»è¦æ˜¯å®‰å“ï¼›
- 5ï¼‰åµŒå…¥å¼ç³»ç»Ÿï¼›
- 6ï¼‰æœºå™¨äººæŠ€æœ¯ï¼›
- 7ï¼‰æ¸¸æˆã€‚

æ—¶è‡³ä»Šæ—¥ï¼ŒJava æŠ€æœ¯ä½“ç³»å·²ç»å¸å¼•äº†  1000 å¤šä¸‡è½¯ä»¶å¼€å‘è€…ï¼ˆéšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿™æ•°å­—ä¼šè¶Šæ¥è¶Šå¤§ï¼‰ï¼Œæ˜¯å…¨çƒæœ€å¤§çš„è½¯ä»¶å¼€å‘å›¢é˜Ÿã€‚Java èƒ½å¤Ÿè·å¾—å¦‚æ­¤å¹¿æ³›çš„è®¤å¯ï¼Œé™¤äº†å®ƒæ˜¯ä¸€é—¨ç»“æ„ä¸¥è°¨ã€é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ä¹‹å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–ä¸å¯å¿½è§†çš„ä¼˜ç‚¹ï¼š

- æ‘†è„±äº†ç¡¬ä»¶å¹³å°çš„æŸç¼šï¼Œå®ç°äº†â€œä¸€æ¬¡ç¼–å†™ï¼Œå¤„å¤„è¿è¡Œâ€çš„ç†å¿µï¼›
- å†…å­˜ç®¡ç†ç›¸å¯¹å®‰å…¨ï¼Œé¿å…äº†ç»å¤§éƒ¨åˆ†å†…å­˜æ³„éœ²å’ŒæŒ‡é’ˆè¶Šç•Œçš„é—®é¢˜ï¼›
- å®ç°äº†çƒ­ç‚¹ä»£ç æ£€æµ‹å’Œè¿è¡Œæ—¶ç¼–è¯‘ï¼Œä½¿å¾— Java åº”ç”¨èƒ½éšç€è¿è¡Œæ—¶é—´çš„å¢é•¿è€Œè·å¾—æ›´é«˜çš„æ€§èƒ½ï¼›
- æœ‰ä¸€å¥—å®Œå–„çš„åº”ç”¨ç¨‹åºæ¥å£ï¼Œè¿˜æœ‰æ— æ•°æ¥è‡ªå•†ä¸šæœºæ„å’Œå¼€æºç¤¾åŒºçš„ç¬¬ä¸‰æ–¹ç±»åº“ã€‚

è¿™ä¸€åˆ‡çš„ä¸€åˆ‡ï¼Œéƒ½è®©è½¯ä»¶å¼€å‘çš„æ•ˆç‡å¤§å¤§çš„æé«˜ã€‚

ä¸‹å›¾æ˜¯å·ç§°å²ä¸Šæœ€æƒ¨çš„ 2023 å±Šç§‹æ‹› Java å²—çš„è–ªèµ„çŠ¶å†µï¼Œåƒ 22 å±Šçš„è–ªèµ„å¾…é‡è¿œæ¯”è¿™ä¸ªå¥½å¾—å¤šï¼Œä½†å…¶å®å·²ç»æ¯”å¾ˆå¤šå…¶ä»–è¡Œä¸šå¥½å¤ªå¤šäº†ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/what-is-java-d5e8b87c-741b-49c8-a6d9-7b8bb9ba803b.png)

24 å±ŠåŠä»¥åçš„èµ·è–ªè‚¯å®šä¼šæ¯”è¿™ä¸ªå¥½å¾—å¤šï¼Œè¿™ä¸Šé¢å¤§ä¸“ã€æ™®æœ¬çš„æ¡ˆä¾‹æ¯”è¾ƒå°‘ï¼Œæ˜¯å› ä¸ºç½‘ä¸Šçˆ†çš„äººæ¯”è¾ƒå°‘ï¼Œä½†å…¶å®è¿™éƒ¨åˆ†ç¾¤ä½“ä¹Ÿæ˜¯éå¸¸å¤§çš„ï¼Œæ‰€ä»¥ï¼Œå­¦ä¹  Java è¿˜æ˜¯å¾ˆæœ‰â€œ**é’±ç§ƒ**â€çš„ã€‚

â€œå™¢å™¢å™¢å™¢ï¼Œé‚£å¥½å§ï¼Œæˆ‘å…ˆè·Ÿç€ã€Š[Javaè¿›é˜¶ä¹‹è·¯](https://tobebetterjavaer.com/)ã€‹å­¦èµ·æ¥ï¼â€

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 2.2 å®‰è£…JDK

å› ä¸º Java ç¨‹åºå¿…é¡»è¿è¡Œåœ¨ JVM ä¹‹ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬ Java ç¨‹åºå‘˜åœ¨å­¦ä¹  Java ä¹‹å‰ï¼Œè¦åšçš„ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯å®‰è£… JDKã€‚

ä»€ä¹ˆï¼Ÿ

åˆæ˜¯ JVM åˆæ˜¯ JDK çš„ï¼Œèƒ½ä¸èƒ½è®²æ¸…æ¥šä¸€ç‚¹ã€‚

è¦æ‰¯æ¸…æ¥šè¿™ä¸¤è€…ä¹‹é—´çš„å…³ç³»ï¼Œå°±å¿…é¡»å¾—å†æ‰¯å‡ºå¦å¤–ä¸€ä¸ªåè¯ JREï¼Œå“ˆå“ˆå“ˆã€‚

å®ƒä»¬ä¹‹é—´çš„å…³ç³»å¯ä»¥ç”¨è¿™å¹…å›¾æ¥è¡¨ç¤ºã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/jdk-install-config-6f6fdb4a-7a44-4e76-b4ea-71c070a5b220.png)

çœŸçš„æ˜¯äººç”Ÿæ— å¸¸ï¼Œå¤§è‚ åŒ…å°è‚ å•Šã€‚

### 01ã€JVMã€JREã€JDK æœ‰ä»€ä¹ˆå…³ç³»

JDKï¼ˆJava Development Kitï¼‰æ˜¯ç”¨äºå¼€å‘ Java åº”ç”¨ç¨‹åºçš„è½¯ä»¶ç¯å¢ƒã€‚é‡Œé¢åŒ…å«è¿è¡Œæ—¶ç¯å¢ƒï¼ˆJREï¼‰å’Œå…¶ä»– Java å¼€å‘æ‰€éœ€çš„å·¥å…·ï¼Œæ¯”å¦‚è¯´è§£é‡Šå™¨ï¼ˆjavaï¼‰ã€ç¼–è¯‘å™¨ï¼ˆjavacï¼‰ã€æ–‡æ¡£ç”Ÿæˆå™¨ï¼ˆjavadocï¼‰ç­‰ç­‰ã€‚

JREï¼ˆJava Runtime Environmentï¼‰æ˜¯ç”¨äºè¿è¡Œ Java åº”ç”¨ç¨‹åºçš„è½¯ä»¶ç¯å¢ƒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåªæƒ³è¿è¡Œ Java ç¨‹åºè€Œä¸éœ€è¦å¼€å‘ Java ç¨‹åºçš„è¯ï¼Œåªéœ€è¦å®‰è£… JRE å°±å¯ä»¥äº†ã€‚

JVM (Java Virtual Machine) ï¼Œä¹Ÿå°±æ˜¯ Java è™šæ‹Ÿæœºï¼Œç”±ä¸€å¥—å­—èŠ‚ç æŒ‡ä»¤é›†ã€ä¸€ç»„å¯„å­˜å™¨ã€ä¸€ä¸ªæ ˆã€ä¸€ä¸ªåƒåœ¾å›æ”¶å †å’Œä¸€ä¸ªå­˜å‚¨æ–¹æ³•åŸŸç­‰ç»„æˆï¼Œå±è”½äº†ä¸åŒæ“ä½œç³»ç»Ÿï¼ˆmacOSã€Windowsã€Linuxï¼‰çš„å·®å¼‚æ€§ï¼Œä½¿å¾— Java èƒ½å¤Ÿâ€œä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„è¿è¡Œâ€ã€‚

æ¯”å¦‚è¯´æˆ‘ç”¨ macOS ç”Ÿæˆäº†ä¸€ä¸ª jar åŒ…ï¼ˆé‡Œé¢æ˜¯æ‰“åŒ…å¥½çš„å­—èŠ‚ç â€”â€”å¯ä»¥åœ¨ Java è™šæ‹Ÿæœºä¸Šè¿è¡Œçš„ç›®æ ‡ä»£ç ï¼‰ï¼Œå¯ä»¥ä¸¢ç»™ Windows ç”¨æˆ·ç›´æ¥è¿è¡Œï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¸Šä¼ åˆ° Linux æœåŠ¡å™¨è¿è¡Œã€‚

è¿™æ˜¯ Oracle å®˜æ–¹ç»™å‡ºçš„ JDKã€JREã€JVM å…³ç³»å›¾ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/jdk-install-config-cbc87f87-6351-4356-936b-77850cc682d5.png)

é‚£é’ˆå¯¹ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œå®˜æ–¹ä¹Ÿæä¾›äº†ä¸åŒçš„ JDK å®‰è£…åŒ…ã€‚

å¦‚æœä½ ç”¨ç™¾åº¦å»æœï¼Œå—¯ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/jdk-install-config-31e739ff-b69f-47b6-9db4-8843cd8a716a.png)

æ€»ä¹‹ï¼Œæ˜¯æŠŠå®˜æ–¹ç»™åƒäº†ã€‚

å¦‚æœä½ ç”¨[è°·æ­Œ](https://tobebetterjavaer.com/nice-article/itmind/)å»æœâ€œJDKâ€å…³é”®å­—ï¼Œèƒ½æœåˆ°å®˜æ–¹çš„ä¸‹è½½é“¾æ¥ã€‚

> [https://www.oracle.com/java/technologies/downloads/](https://www.oracle.com/java/technologies/downloads/)

å¥½ï¼Œå¦‚æœä½ æƒ³å®‰è£… JDK ï¼Œåˆ°å®˜æ–¹ä¸‹è½½ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/jdk-install-config-e5b91a70-2a23-4ebd-896a-5ff19f0075b1.png)

æœ€æ–°ç‰ˆæ˜¯ JDK 18ï¼ˆçŸ­æœŸç‰ˆæœ¬ï¼‰ï¼Œä¸Šä¸€ä¸ªé•¿æœŸæ”¯æŒç‰ˆæœ¬æ˜¯ JDK 17ï¼Œæ¨èå®‰è£… JDK 8ï¼Œå“ˆå“ˆå“ˆå“ˆï¼Œå®ƒå‡ä»»å®ƒå‡ï¼Œæˆ‘ç”¨ Java 8ã€‚å¾€ä¸‹ç¿»å°±èƒ½æ‰¾åˆ°äº†ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/jdk-install-config-a32db267-febe-4852-b528-deaacb43247d.png)


æ ¹æ®ä½ çš„æ“ä½œç³»ç»Ÿä¸‹è½½å¯¹åº”çš„å®‰è£…åŒ…ï¼Œåˆ† Windowsï¼ˆexe åç¼€ï¼‰å’Œ macOSï¼ˆdmg åç¼€ï¼‰ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/jdk-install-config-20230408164612.png)

ä¸‹è½½ååŒå‡»å®‰è£…ï¼Œç„¶åé…ç½®ç¯å¢ƒå˜é‡å°± OK äº†ã€‚

### 02ã€Windows å®‰è£… JDK

å®‰è£…æ­¥éª¤å°±çœç•¥äº†ï¼Œå‚»ç“œå¼ä¸‹ä¸€æ­¥å°±å¥½ã€‚è¿™é‡Œåªè¯´ä¸€ä¸‹ç¯å¢ƒå˜é‡çš„é…ç½®ï¼Œåœ¨ç”µè„‘æ¡Œé¢å³é”®ç‚¹å‡» â€œæ­¤ç”µè„‘â€çš„â€œå±æ€§â€é€‰é¡¹ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/jdk-install-config-a0a78e05-886f-425a-8ba9-d27314f7a21c.png)

é€‰æ‹©â€œé«˜çº§ç³»ç»Ÿè®¾ç½®â€é€‰é¡¹

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/jdk-install-config-fdc94ada-ae44-4a93-ba0d-92860119ad9c.png)

ç‚¹å‡»ä¸‹é¢çš„â€œç¯å¢ƒå˜é‡â€é€‰é¡¹

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/jdk-install-config-919eb8f0-9869-450c-a6cb-50318dd3e2e5.png)

ç‚¹å‡»â€œç³»ç»Ÿå˜é‡â€ä¸‹é¢çš„â€æ–°å»ºâ€œé€‰é¡¹

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/jdk-install-config-a4c05c3e-f305-4d6a-96d2-fe345e980c3b.png)

åœ¨â€å˜é‡åâ€œå¤„å¡«ä¸Šâ€Java_Homeâ€œï¼Œâ€å˜é‡å€¼â€œä¸º JDK å®‰è£…è·¯å¾„ï¼Œæ¯”å¦‚è¯´â€`D:\Program Files\Java\jdk1.8.0_91`â€œ

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/jdk-install-config-26be5706-036d-4fae-99fa-d5f14b7380d4.png)

å‚è€ƒé“¾æ¥ï¼šhttps://www.cnblogs.com/cnwutianhao/p/5487758.html

å†è¯´ä¸€ç§é«˜çº§ç‚¹çš„å®‰è£…æ–¹æ³•ã€‚

Windows ç”¨æˆ·å»ºè®®å…ˆå®‰è£… [Chocolatey](https://tobebetterjavaer.com/gongju/choco.html)ï¼Œè¿™æ˜¯ä¸€ä¸ª Windows ä¸‹çš„å‘½ä»¤è¡Œè½¯ä»¶ç®¡ç†å™¨ï¼Œå¯ä»¥æ–¹ä¾¿å¼€å‘è€…åƒåœ¨ Linux ä¸‹ä½¿ç”¨ yum å‘½ä»¤æ¥å®‰è£…è½¯ä»¶ï¼Œæˆ–è€…åƒåœ¨ macOS ä¸‹ä½¿ç”¨ brew å‘½ä»¤æ¥å®‰è£…è½¯ä»¶ï¼Œéå¸¸é…·ç‚«ã€‚

å®‰è£…å®Œæˆåï¼Œç›´æ¥æ‰§è¡Œ `choco install jdk8` å°±å¯ä»¥å®‰è£… JDK 8 äº†ï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨å°† Java åŠ å…¥åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œä¸ç”¨å†å»ã€Œæˆ‘çš„ç”µè„‘ã€ã€Œç¯å¢ƒå˜é‡ã€ä¸­æ–°å»º JAVA_HOME å¹¶å¤åˆ¶ JDK å®‰è£…è·¯å¾„é…ç½® PATH å˜é‡äº†

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongju/choco-80a6ced8-c25d-4371-8096-b95be48af768)

### 03ã€macOS å®‰è£… JDK

macOS ç”¨æˆ·å»ºè®®å…ˆå®‰è£… [Homebrew](https://tobebetterjavaer.com/gongju/brew.html)ï¼Œè¿™æ˜¯ä¸€ä¸ª macOS ä¸‹çš„å‘½ä»¤è¡Œè½¯ä»¶ç®¡ç†å™¨ï¼Œå¯ä»¥é€šè¿‡ä¸€è¡Œå‘½ä»¤å®‰è£… Appleï¼ˆæˆ– Linux ç³»ç»Ÿï¼‰æ²¡æœ‰é¢„è£…ä½†ä½ éœ€è¦çš„è½¯ä»¶ã€‚

å®‰è£…å®Œæˆåï¼Œç›´æ¥æ‰§è¡Œ `brew install openjdk@8` å°±å¯ä»¥å®‰è£… JDK 8 äº†ã€‚

å¦‚æœéœ€è¦åœ¨ macOS å®‰è£…å¤šä¸ªç‰ˆæœ¬çš„ JDK ï¼Œæ¯”å¦‚è¯´ JDK 17ï¼Œå¤šä¸ªç‰ˆæœ¬çš„ JDK æ€ä¹ˆç®¡ç†å‘¢ï¼Ÿå¯ä»¥å®‰è£…ä¸€ä¸‹ [jEnv](https://www.jenv.be/)ï¼Œä¸€ä¸ªå¸®åŠ©æˆ‘ä»¬ç®¡ç† JAVA_HOME çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œåœ¨ GitHub ä¸Šå·²ç»æ”¶è· 4.3k çš„ starã€‚

å®‰è£…ï¼š

```
brew install jenv
```

åœ¨ zsh ä¸­é…ç½® jenvï¼š

```
export PATH="$HOME/.jenv/bin:$PATH"
eval "$(jenv init -)"
```

é€šè¿‡ `vim ~/.zshrc` æŠŠä»¥ä¸Šå†…å®¹æ·»åŠ åˆ°é…ç½®æ–‡ä»¶ä¸­å¹¶ä¿å­˜ï¼ˆsource ä¸‹å¯ä»¥ç«‹å³ç”Ÿæ•ˆï¼‰

![](https://cdn.tobebetterjavaer.com/stutymore/jdk-install-config-20230408165518.png)

ä¹‹åé€šè¿‡ä»¥ä¸‹æ–¹å¼æ·»åŠ  JDK åˆ° jenv ä¸­ï¼š

```
jenv add /usr/local/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home/
```

JDK çš„å®‰è£…è·¯å¾„å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹æ³• get åˆ°ã€‚

ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒJDK çš„é»˜è®¤å®‰è£…è·¯å¾„ä¸º `/Library/Java/JavaVirtualMachines/`ï¼Œè¿›å…¥è¯¥ç›®å½•å°±å¯ä»¥çœ‹åˆ°ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/jdk-install-config-20230408173945.png)

è¿˜å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è·å–å½“å‰å®‰è£…çš„ JDK è·¯å¾„ã€‚

```
/usr/libexec/java_home
```

![](https://cdn.tobebetterjavaer.com/stutymore/jdk-install-config-20230408174048.png)

æ·»åŠ  JDK çš„è·¯å¾„åå¯ä»¥é€šè¿‡ `jenv versions` æŸ¥çœ‹æ‰€æœ‰æ·»åŠ åˆ° jenv è¿›è¡Œç®¡ç†çš„ JDK ç‰ˆæœ¬ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/jdk-install-config-20230408174158.png)

å¸¦ `*` çš„è¡¨ç¤ºå½“å‰é»˜è®¤çš„ JDK ç‰ˆæœ¬ã€‚

å¯ä»¥é€šè¿‡ `jenv global xxx` åˆ‡æ¢å…¨å±€çš„ JDK ç‰ˆæœ¬ã€‚

```
jenv global 17
```

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongju/brew-cc01fad8-53e9-4474-8923-08e97ac7090a.png)

æ˜¯ä¸æ˜¯è´¼æ–¹ä¾¿ï¼Ÿå†ä¹Ÿä¸ç”¨æ•´è¿™ `echo 'export PATH="/usr/local/opt/openjdk@17/bin:$PATH"' >> ~/.zshrc` ç©æ„æ·»åŠ  JDK åˆ° PATH ç¯å¢ƒå˜é‡äº†ï¼

æƒ³ç”¨å“ªä¸ª JDK ç‰ˆæœ¬å¯ä»¥éšæ—¶åˆ‡æ¢ã€‚

çˆ½ï¼Œå®åœ¨æ˜¯çˆ½ï¼

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 2.3 å®‰è£…IDEA

IntelliJ IDEA ç®€ç§° IDEAï¼Œæ˜¯ä¸šç•Œå…¬è®¤ä¸ºæœ€å¥½çš„ Java é›†æˆå¼€å‘å·¥å…·ï¼Œå°¤å…¶æ˜¯åœ¨ä»£ç è‡ªåŠ¨æç¤ºã€ä»£ç é‡æ„ã€ä»£ç ç‰ˆæœ¬ç®¡ç†ã€å•å…ƒæµ‹è¯•ã€ä»£ç åˆ†æç­‰æ–¹é¢æœ‰ç€äº®çœ¼çš„å‘æŒ¥ã€‚

IDEA äº§äºæ·å…‹ï¼Œå¼€å‘äººå‘˜ä»¥ä¸¥è°¨è‘—ç§°çš„ä¸œæ¬§ç¨‹åºå‘˜ä¸ºä¸»ï¼Œåˆ†ä¸ºç¤¾åŒºç‰ˆå’Œä»˜è´¹ç‰ˆä¸¤ä¸ªç‰ˆæœ¬ã€‚å¦‚æœåªæ˜¯å­¦ä¹  Java SE ç¤¾åŒºç‰ˆå°±è¶³å¤Ÿç”¨äº†ã€‚æƒ³è¦æ›´å¤šåŠŸèƒ½çš„è¯ï¼Œæ¯”å¦‚è¯´ Spring initializr åŠŸèƒ½ï¼Œéœ€è¦ä¸‹è½½ä»˜è´¹ç‰ˆã€‚

å›æƒ³èµ·æˆ‘æœ€åˆå­¦ Java çš„æ—¶å€™ï¼Œè€å¸ˆè¦æ±‚æˆ‘ä»¬åœ¨è®°äº‹æœ¬ä¸Šæ•²ä»£ç ï¼Œåœ¨å‘½ä»¤è¡Œä¸­ç¼–è¯‘å’Œæ‰§è¡Œ Java ä»£ç ï¼Œæå¾—å…¨ç­ä¸‰åˆ†ä¹‹äºŒçš„åŒå­¦éƒ½åšå¥½äº†æ”¾å¼ƒå­¦ä¹  Java çš„æ‰“ç®—ã€‚

é‰´äºæ­¤ï¼Œæˆ‘å¼ºçƒˆæ¨èå¤§å®¶ä½¿ç”¨é›†æˆå¼€å‘å·¥å…·ï¼Œæ¯”å¦‚è¯´ IntelliJ IDEA æ¥å­¦ä¹ ã€‚

ä¸ºäº†ç…§é¡¾åˆ°åˆšå­¦ Java çš„é›¶åŸºç¡€å®å®ï¼Œæˆ‘è¿™é‡ŒæŠŠ macOS ç³»ç»Ÿå’Œ Windows ç³»ç»Ÿçš„å®‰è£…æ–¹æ³•éƒ½ä»‹ç»ä¸€ä¸‹ï¼ŒçœŸæ‰‹æ‘¸æ‰‹æ•™å­¦ã€‚

### 01ã€Windows

#### ä¸‹è½½ IDEA

IntelliJ IDEA çš„å®˜æ–¹ä¸‹è½½åœ°å€ä¸ºï¼š[https://www.jetbrains.com/idea/download/](https://www.jetbrains.com/idea/download)

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/IDEA-install-config-d7ac2335-4c65-442c-931e-994e00db4235.png)

UItimate ä¸ºä»˜è´¹ç‰ˆï¼Œä¸»è¦é’ˆå¯¹çš„æ˜¯ä¼ä¸šçº§å¼€å‘ç”¨æˆ·ï¼›Community ä¸ºå…è´¹ç‰ˆï¼Œä¸»è¦é’ˆå¯¹çš„æ˜¯ä¸ªäººç”¨æˆ·ã€‚

> éœ€è¦æ¿€æ´»çš„æˆ³è¿™é‡Œ[æ¿€æ´»](https://tobebetterjavaer.com/nice-article/itmind/)

åŠŸèƒ½ä¸Šçš„å·®åˆ«å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/IDEA-install-config-43e0ec45-acee-4c18-b0ff-ac7f4fc054f9.png)

è¿™é‡Œé€‰æ‹©å…è´¹ç‰ˆä¸ºä¾‹ï¼Œç‚¹å‡»ã€ŒDownloadã€è¿›è¡Œä¸‹è½½ã€‚ç¨ç­‰ä¸€åˆ†é’Ÿæ—¶é—´ï¼Œå¤§æ¦‚ 580Mã€‚

#### å®‰è£… IDEA

åŒå‡»è¿è¡Œ IDEA å®‰è£…ç¨‹åºï¼Œä¸€æ­¥æ­¥å‚»ç“œå¼çš„ä¸‹ä¸€æ­¥å°±è¡Œäº†ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/IDEA-install-config-8d0b11b3-99da-45c5-b9c3-a5d4e26077b5.png)

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/IDEA-install-config-3747b308-9b27-4068-9c47-46bc7098f8d4.png)

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/IDEA-install-config-5765a40b-e3c1-4021-b1de-73ae27774008.png)

ä¸ºäº†æ–¹ä¾¿å¯åŠ¨ IDEAï¼Œå¯ä»¥å‹¾é€‰ã€64-bit launcherã€‘å¤é€‰æ¡†ã€‚ä¸ºäº†å…³è” Java æºæ–‡ä»¶ï¼Œå¯ä»¥å‹¾é€‰ã€.javaã€‘å¤é€‰æ¡†ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/IDEA-install-config-15b6f6f4-308d-41d8-869a-4eb625f65eb0.png)

ç‚¹å‡»ã€Installã€‘åï¼Œéœ€è¦é™é™åœ°ç­‰å¾…ä¸€ä¼šï¼Œå¤§æ¦‚ä¸€åˆ†é’Ÿçš„æ—¶é—´ï¼Œè¶æœºä¼‘æ¯ä¸€ä¸‹çœ¼ç›ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/IDEA-install-config-2a80c17a-dbb6-4411-b88b-5bf1398db411.png)

å®‰è£…å®Œæˆåçš„ç•Œé¢å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/IDEA-install-config-2afe2860-e3ef-4370-a0a5-f0075487f159.png)

#### å¯åŠ¨ IDEA

å›åˆ°æ¡Œé¢ï¼ŒåŒå‡»è¿è¡Œ IDEA çš„å¿«æ·æ–¹å¼ï¼Œå¯åŠ¨ IDEAã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/IDEA-install-config-937da9b9-56e3-4970-ab50-e24f4b3549da.png)

å‡è£…é˜…è¯»å®Œæ¡æ¬¾åï¼Œå‹¾é€‰åŒæ„å¤é€‰æ¡†ï¼Œç‚¹å‡»ã€Continueã€‘

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/IDEA-install-config-0426d0d2-26eb-4376-bcaa-cede00fc2622.png)

å¦‚æœæƒ³è¦å¸®åŠ© IDEA æ”¶é›†æ”¹è¿›ä¿¡æ¯ï¼Œå¯ä»¥ç‚¹å‡»ã€Send Usage Statisticsã€‘ï¼›å¦åˆ™ç‚¹å‡»ã€Don't sendã€‘ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/IDEA-install-config-b880a884-dbf5-4ce8-b0c1-345d60c72eff.png)

åˆ°æ­¤ï¼ŒIntellij IDEA çš„å®‰è£…å°±å®Œæˆäº†ï¼Œå¾ˆç®€å•ã€‚

### 02ã€macOS

#### ä¸‹è½½ IDEA

1ã€æ‰“å¼€ [https://www.jetbrains.com/idea/](https://www.jetbrains.com/idea/download/#section=mac)ï¼Œç‚¹å‡» Download æŒ‰é’®

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/IDEA-install-config-38cc7637-ed3f-44c0-b244-aafafd3634b6.png)

2ã€é€‰æ‹© Community ç‰ˆæœ¬ï¼Œæ——èˆ°ç‰ˆéœ€è¦æ¿€æ´»ï¼Œä½ å¯ä»¥æˆ³è¿™é‡Œ[æ¿€æ´»](https://tobebetterjavaer.com/nice-article/itmind/)ï¼‰ã€‚

ç¡®å®šåç‚¹å‡» Download ä¸‹è½½

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/IDEA-install-config-b17d0ff0-d33c-4d19-86e0-cd491c0cc613.png)

å¦‚ä½•æŸ¥çœ‹ Mac ç”µè„‘æ˜¯ Intel è¿˜æ˜¯ Apple Silicon çš„ CPUï¼Ÿ

åœ¨ Mac ä¸Šï¼Œå•å‡»èœå•æ å·¦ä¸Šè§’çš„ Apple å›¾æ ‡ï¼Œç„¶åé€‰æ‹©â€œå…³äºæœ¬æœºâ€ï¼ˆAbout This Macï¼‰é€‰é¡¹ã€‚

- å¦‚æœåœ¨â€œèŠ¯ç‰‡â€éƒ¨åˆ†ä¸­çœ‹åˆ° Apple M1ï¼ˆæˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰ï¼Œåˆ™æ„å‘³ç€ä½¿ç”¨çš„æ˜¯å¸¦æœ‰ Apple Silicon CPU çš„ Macã€‚
- å¦‚æœåœ¨â€œå¤„ç†å™¨â€éƒ¨åˆ†ä¸­çœ‹åˆ°è‹±ç‰¹å°”å¤„ç†å™¨ï¼Œåˆ™è¡¨ç¤ºæ­£åœ¨ä½¿ç”¨å¸¦æœ‰è‹±ç‰¹å°”èŠ¯ç‰‡çš„ Macã€‚

ç§ï¼Œæˆ‘çš„å°±æ˜¯è‹±ç‰¹å°”èŠ¯ç‰‡çš„ï¼ˆIntelï¼‰ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/IDEA-install-config-3977e9b4-9c26-4e00-bc88-1ac1f2f89d5e.png)

3ã€æ‰“å¼€å¦‚ä¸‹é¡µé¢ï¼ŒIntelliJ IDEA ä¾¿ä¼šå¼€å§‹è‡ªåŠ¨ä¸‹è½½ã€‚è‹¥æœªå¼€å§‹è‡ªåŠ¨ä¸‹è½½ï¼Œå¯ä»¥ç‚¹å‡»å¦‚ä¸‹çº¢æ¡†å†…çš„ direct linkã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/IDEA-install-config-5b074f76-71c7-405e-871e-de1ee1d6376e.png)

ä¸­æ–‡é¡µé¢å¦‚ä¸‹æ‰€ç¤ºï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/IDEA-install-config-f88924e5-6470-4d44-8f85-922875a3c565.png)

4ã€IntelliJ IDEA ä¸‹è½½å®Œæˆï¼Œåœ¨ä¸‹è½½æ–‡ä»¶å¤¹å†…ä¾¿ä¼šå‡ºç° ideaIC-2020.3.2.dmg çš„æ–‡ä»¶ï¼ˆä½ åº”è¯¥æ˜¯æ›´æ–°çš„ç‰ˆæœ¬ï¼‰ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/IDEA-install-config-7aec8534-ea7b-41f5-bc68-e6d2fb20e6c1.png)

#### å®‰è£… IDEA

1ã€åŒå‡» ideaIC-2020.3.2.dmg æ–‡ä»¶å¼€å§‹å®‰è£…

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/IDEA-install-config-23195fb7-3a1c-4466-bf17-4f681ef0be5e.png)

2ã€æŠŠ IntelliJ IDEA CE.app æ‹–å…¥ Applications æ–‡ä»¶å¤¹

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/IDEA-install-config-7bd55d3b-54ce-4e4e-8e21-aa94f15d105a.png)

3ã€åœ¨ Applications ä¸­å¯ä»¥æ‰¾åˆ° IntelliJ IDEA CE.appï¼Œè¯´æ˜å®‰è£…å®Œæˆ

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/IDEA-install-config-96c1a054-8429-416a-ad5d-7fa3f360c19f.png)

#### æ‰“å¼€ IDEA

é¦–æ¬¡æ‰“å¼€ IntelliJ IDEA åå±•ç°çš„ç¬¬ä¸€ä¸ªé¡µé¢å¦‚ä¸‹æ‰€ç¤ºã€‚è‡³æ­¤ï¼ŒIntelliJ IDEA ä¸‹è½½ã€å®‰è£…å’Œæ‰“å¼€å°±æå®šäº†ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/IDEA-install-config-7637a241-8524-4e0a-bb2a-a3bd1c575c9a.png)

### 03ã€å°ç»“

æœ¬æ–‡è¯¦ç»†åœ°ä»‹ç»äº†å¦‚ä½•åœ¨macOSå’ŒWindowsæ“ä½œç³»ç»Ÿä¸Šå®‰è£…Intellij IDEAã€‚ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„æ“ä½œç³»ç»Ÿé€‰æ‹©ä¸åŒçš„å®‰è£…åŒ…ï¼Œç„¶åä¸ºè‡ªå·±æ­å»ºä¸€ä¸ªé«˜æ•ˆçš„ç¼–ç¨‹ç¯å¢ƒã€‚


-----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 2.4 ç¬¬ä¸€ä¸ªJavaç¨‹åº

â€œä¸‰å¦¹ï¼Œä»Šå¤©ï¼Œæˆ‘ä»¬æ¥ç¼–å†™ç¬¬ä¸€ä¸ª Java ç¨‹åºï¼ŒHello World æœŸå¾…å—ï¼Ÿâ€

ä¸‰å¦¹ç‚¹äº†ç‚¹å¤´ï¼Œè¡¨ç¤ºè®¤åŒï¼ˆğŸ˜‚ï¼‰ã€‚

â€œå¥½çš„ï¼Œé‚£æˆ‘ä»¬ç›´æ¥å¼€å§‹ã€‚â€

æ‰“å¼€ [Intellij IDEA](https://tobebetterjavaer.com/overview/IDEA-install-config.html)ï¼Œæ–°å»ºä¸€ä¸ªå­¦ä¹  Java çš„é¡¹ç›®ï¼Œç‚¹å‡» File â†’ New â†’ Projectã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/hello-world-3810664d-49fb-4bed-ad32-3cb962ab5201.png)

é€‰æ‹© JDK ç‰ˆæœ¬ï¼Œæ¯”å¦‚ä¹‹å‰æˆ‘ä»¬[å®‰è£…çš„ JDK 8](https://tobebetterjavaer.com/overview/jdk-install-config.html)ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/hello-world-3773144f-ba5a-4639-8747-70eb815f1ccd.png)

ä½ ä¹Ÿå¯ä»¥é€‰æ‹© JDK 11 æˆ–è€…æœ€æ–°çš„ JDK 17 æˆ–è€…æ·»åŠ æ–°çš„ JDK ç‰ˆæœ¬ï¼Œä½†ï¼ˆä¸å»ºè®®ï¼‰ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/hello-world-85e3860b-3207-45c1-85d6-09c7cfd83c77.png)

ç„¶åç‚¹å‡»ã€Œnextã€ï¼Œç›´åˆ°å¡«å†™é¡¹ç›®åå­—ï¼Œæ¯”å¦‚è¯´ tobebetterjavaerdemoã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/hello-world-aad8ff0b-61e4-4dc1-9f5b-70f64f34a49b.png)

ç„¶åç‚¹å‡» finishï¼Œä¹‹åå°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ–°å»ºçš„é¡¹ç›®ç•Œé¢äº†ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/hello-world-5ef6024a-86e4-4fb7-860c-526ed867ab4a.png)

å¦‚æœä½ çš„ Intellij IDEA ä¸»é¢˜å’ŒäºŒå“¥ä¸ä¸€æ ·ï¼Œæ²¡å…³ç³»ï¼Œå½“ç„¶äº†ï¼Œå¦‚æœä½ ä¹Ÿæ˜¯ä¸ªæœ‰é¢œå€¼è¿½æ±‚çš„å®¶ä¼™ï¼Œå¯ä»¥å®‰è£… Vuesion Theme æ’ä»¶ï¼Œå®‰è£…æ–¹æ³•[æˆ³è¿™é‡Œ](https://tobebetterjavaer.com/ide/shenji-chajian-10.html)ã€‚

â€œOKï¼Œåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»æŠŠå­¦ä¹  Java çš„ç¯å¢ƒå‡†å¤‡å¥½äº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å†™ç¬¬ä¸€ä¸ª Hello World ç¨‹åºäº†ã€‚â€æˆ‘è‡ªä¿¡åœ°å¯¹ä¸‰å¦¹è¯´ã€‚

ä¸€èˆ¬æˆ‘ä»¬ä¼šæŠŠæºä»£ç æ”¾åœ¨ src ç›®å½•ä¸‹ï¼ˆsource çš„å‰ç¼€ï¼Œæ‰€ä»¥å­¦ç¼–ç¨‹ï¼Œè‹±è¯­ä¸­å¸¸ç”¨çš„å•è¯å¿…é¡»å¾—ä¼šï¼Œä¸ä¼šå°±å»å­¦ï¼‰ã€‚

å³é”® src ç›®å½•ï¼Œåœ¨èœå•ä¸­ä¾æ¬¡é€‰æ‹© New â†’ Java Classã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/hello-world-3dcc212c-bc06-49b0-989a-d3d129586064.png)

å¡«å†™ Class åï¼Œä¹Ÿå°±æ˜¯ç±»åï¼ˆä¸çŸ¥é“ç±»åæ˜¯å•¥ï¼Œåé¢ä¼šè®²ï¼‰ï¼Œæ³¨æ„å¤§å°å†™æ•æ„Ÿï¼Œç„¶åæŒ‰ä¸‹ enter é”®ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/hello-world-c4e95c3f-1832-4fc5-bfe7-ce5def0129e2.png)

å°±ä¼šå‡ºç°è¿™æ ·çš„ä»£ç ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/hello-world-380bd820-3b92-4195-86cc-1af30836ce38.png)

æ³¨é‡Šæ˜¯äºŒå“¥é…ç½®å¥½çš„ï¼Œä½ å¦‚æœæ²¡é…ç½®å¯èƒ½æ²¡æœ‰ï¼Œ`public class HelloWorld {}` æ˜¯ Intellij IDEA å¸®æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆçš„ã€‚

ä¹‹ååœ¨å¤§æ‹¬å·é‡Œé¢é”®å…¥ `main` ç­‰ Intellij IDEA ç»™å‡ºæç¤ºåé”®å…¥ enter é”®ã€‚

Intellij IDEA å°±ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆ main æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¿™æ®µä»£ç ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/hello-world-e0acad2b-1735-42d9-b843-5d65d48c0946.png)

ç„¶ååœ¨ main æ–¹æ³•ä¸­é”®å…¥ `so` ç­‰å‡ºç°æç¤ºåé”®å…¥ enter é”®ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/hello-world-9733e9ba-9e38-41d6-8a58-e73062ee9ed2.png)

Intellij IDEA å°±ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨æ·»åŠ  `System.out.println()`ï¼Œè¿™æ˜¯ä¸€ä¸ªå‘æ§åˆ¶å°è¾“å‡ºçš„æ–¹æ³•ï¼ˆå°ç™½å…ˆä¸ç®¡å®ƒæ˜¯ä»€ä¹ˆæ„æ€ï¼Œåé¢ä¼šè®²ï¼‰ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/hello-world-8eb1a438-88d8-4ea2-8861-af96862518fc.png)

æ¥ç€åœ¨ `println()` çš„å°æ‹¬å·ä¸­é”®å…¥ `"Hello World"`ï¼Œæ³¨æ„æ˜¯è‹±æ–‡çš„åŒå¼•å·ï¼Œä¸­æ–‡çš„ä¼šæŠ¥é”™å“¦ï¼Œä¸‰å¦¹ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/hello-world-f5aa5fd1-4498-4022-b6e6-cc50f23dacb7.png)

ç„¶ååœ¨ HelloWorld.java çš„ä»£ç ç¼–è¾‘å™¨ï¼Œä¹Ÿå°±æ˜¯å…‰æ ‡æ‰€åœ¨çš„ä½ç½®å³é”®ï¼Œé€‰æ‹©ã€ŒRun 'HelloWorld.main()'ã€ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/hello-world-98e26e22-4811-4546-a88f-59a67d2d93ca.png)

ç­‰ Intellij IDEA ç¼–è¯‘&è¿è¡Œåå°±å¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°è¿™æ ·çš„è¾“å‡ºå†…å®¹ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/hello-world-39d0d413-a2c6-4238-bead-f29183d271c7.png)

è¿™å°±è¡¨æ˜æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ª Java ä»£ç å®Œæˆäº†ï¼Œæ­å–œè‡ªå·±ä¸€ä¸‹å§ï¼Œä¸‰å¦¹ï¼

â€œäºŒå“¥ï¼Œä½ å¤ªæ£’äº†ï¼Œå¥½æ¿€åŠ¨å“¦ï¼ï¼ï¼ï¼ï¼ï¼ï¼â€

ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥ç®€å•è§£é‡Šä¸€ä¸‹è¿™æ®µä»£ç ã€‚

ç¬¬ä¸€ä¸ª Java ç¨‹åºéå¸¸ç®€å•ï¼Œæˆ‘ä»¬æ¥æ”¹ä¸€ä¸‹è¾“å‡ºå†…å®¹ï¼ŒæŠŠ Hello World æ›¿æ¢æ‰ï¼š

```java
public class HelloWorld {
    public static void main(String[] args) {
        System.out.println("ä¸‰å¦¹ï¼Œå°‘çœ‹æ‰‹æœºå°‘æ‰“æ¸¸æˆï¼Œå¥½å¥½å­¦ï¼Œç¾ç¾å“’ã€‚");
    }
}
```

- class å…³é”®å­—ï¼šç”¨äºåœ¨ Java ä¸­å£°æ˜ä¸€ä¸ª[ç±»](https://tobebetterjavaer.com/oo/object-class.html)ã€‚
- public å…³é”®å­—ï¼šä¸€ä¸ªè¡¨ç¤ºå¯è§æ€§çš„[è®¿é—®ä¿®é¥°ç¬¦](https://tobebetterjavaer.com/oo/access-control.html)ã€‚
- [static å…³é”®å­—](https://tobebetterjavaer.com/oo/static.html)ï¼šæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å£°æ˜ä»»ä½•ä¸€ä¸ªæ–¹æ³•ï¼Œè¢« static ä¿®é¥°åçš„æ–¹æ³•ç§°ä¹‹ä¸ºé™æ€æ–¹æ³•ã€‚é™æ€æ–¹æ³•ä¸éœ€è¦ä¸ºå…¶åˆ›å»ºå¯¹è±¡å°±èƒ½è°ƒç”¨ã€‚
- void å…³é”®å­—ï¼šè¡¨ç¤ºè¯¥æ–¹æ³•ä¸è¿”å›ä»»ä½•å€¼ã€‚
- main å…³é”®å­—ï¼šè¡¨ç¤ºè¯¥æ–¹æ³•ä¸ºä¸»æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ç¨‹åºè¿è¡Œçš„å…¥å£ã€‚`main()` æ–¹æ³•ç”± Java è™šæ‹Ÿæœºæ‰§è¡Œï¼Œé…åˆä¸Š static å…³é”®å­—åï¼Œå¯ä»¥ä¸ç”¨åˆ›å»ºå¯¹è±¡å°±å¯ä»¥è°ƒç”¨ï¼Œå¯ä»¥èŠ‚çœä¸å°‘å†…å­˜ç©ºé—´ã€‚
- `String [] args`ï¼š`main()` æ–¹æ³•çš„å‚æ•°ï¼Œç±»å‹ä¸º [String](https://tobebetterjavaer.com/string/immutable.html) [æ•°ç»„](https://tobebetterjavaer.com/array/array.html)ï¼Œå‚æ•°åä¸º argsã€‚
- `System.out.println()`ï¼šä¸€ä¸ª Java è¯­å¥ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯å°†ä¼ é€’çš„å‚æ•°æ‰“å°åˆ°æ§åˆ¶å°ã€‚System æ˜¯ java.lang åŒ…ä¸­çš„ä¸€ä¸ª final ç±»ï¼Œè¯¥ç±»æä¾›çš„è®¾æ–½åŒ…æ‹¬æ ‡å‡†è¾“å…¥ï¼Œæ ‡å‡†è¾“å‡ºå’Œé”™è¯¯è¾“å‡ºæµç­‰ç­‰ã€‚out æ˜¯ System ç±»çš„é™æ€æˆå‘˜å­—æ®µï¼Œç±»å‹ä¸º [PrintStream](https://tobebetterjavaer.com/io/print.html)ï¼Œå®ƒä¸ä¸»æœºçš„æ ‡å‡†è¾“å‡ºæ§åˆ¶å°è¿›è¡Œæ˜ å°„ã€‚println æ˜¯ PrintStream ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œé€šè¿‡è°ƒç”¨ print æ–¹æ³•å¹¶æ·»åŠ ä¸€ä¸ªæ¢è¡Œç¬¦å®ç°çš„ã€‚

â€œå®åœ¨è®°ä¸ä½ä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘ä»¬åé¢è¿˜ä¼šè®²å“¦ï¼ˆå¯ä»¥è·³è½¬çš„åœ°æ–¹éƒ½ä¼šå±•å¼€ç»†è®²ï¼‰ã€‚â€æˆ‘çš„è¯ä»¤ä¸‰å¦¹æ„Ÿåˆ°éå¸¸å¼€å¿ƒã€‚

å¥½ï¼Œæ¥ä¸‹æ¥å†å‘Šè¯‰ä½ ä¸€ç‚¹é¢å¤–çš„çŸ¥è¯†ç‚¹ï¼ˆå¦‚æœè§‰å¾—æ¯”è¾ƒéš¾å¯è·³è¿‡ï¼‰ï¼Œä¸‰å¦¹ã€‚

åœ¨ Intellij IDEA çš„ terminal é¢æ¿ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å¯¹åº”çš„ java æºä»£ç æ–‡ä»¶å’Œç¼–è¯‘åçš„ .class æ–‡ä»¶ã€‚

å¯ä»¥åœ¨å¯¹åº”çš„æ–‡ä»¶ä¸Šå³é”®é€‰æ‹© open in terminal æ‰“å¼€ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/hello-world-20230408184558.png)

å¯ä»¥é€šè¿‡ pwd å‘½ä»¤æŸ¥çœ‹å½“å‰åŒ…è·¯å¾„ï¼Œé€šè¿‡ ls å‘½ä»¤æŸ¥çœ‹åŒ…è·¯å¾„ä¸‹é¢æœ‰å“ªäº›æ–‡ä»¶ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/hello-world-20230408184256.png)

class æ–‡ä»¶åœ¨ target ç›®å½•ä¸‹ï¼Œclasses ä¸º src/main ç›®å½•ä¸‹çš„ class æ–‡ä»¶ï¼›test-classes ä¸º src/test ç›®å½•ä¸‹çš„ class æ–‡ä»¶ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/hello-world-20230408184835.png)

â€œäºŒå“¥ï¼Œ.class æ–‡ä»¶å’Œ .java æºä»£ç ï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿâ€ä¸‰å¦¹è¿˜æ˜¯æŒºå–œæ¬¢å­¦ä¹ çš„å˜›ï¼Œå‘ç°çš„é—®é¢˜éƒ½å¾ˆå…³é”®ã€‚

â€œä¸é”™ä¸é”™ï¼Œéƒ½èƒ½æŒ–æ˜åˆ°è¿™ä¸ªç‚¹äº†ã€‚â€

.java æ˜¯æºä»£ç ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¼€å‘äººå‘˜å¯ä»¥çœ‹æ‡‚çš„ï¼Œå¯ä»¥ç¼–å†™çš„ï¼›.class æ˜¯å­—èŠ‚ç æ–‡ä»¶ï¼Œæ˜¯ç»è¿‡ javac ç¼–è¯‘åçš„æ–‡ä»¶ï¼Œæ˜¯äº¤ç»™ [JVM](https://tobebetterjavaer.com/jvm/what-is-jvm.html) æ‰§è¡Œçš„æ–‡ä»¶ã€‚

â€œä¸‰å¦¹ï¼Œè¿™é‡Œå†é¡ºå¸¦ç»™ä½ è®²ä¸€ä¸‹ï¼ŒJava æ˜¯ç¼–è¯‘å‹è¯­è¨€è¿˜æ˜¯è§£é‡Šå‹è¯­è¨€ã€‚â€

â€œå¥½å•Šï¼Œæˆ‘æ­£è¦é—®è¿™ä¸ªâ€˜ç¼–è¯‘â€™åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿâ€

Java çš„ç¬¬ä¸€é“å·¥åºæ˜¯é€šè¿‡ javac å‘½ä»¤æŠŠ Java æºç ç¼–è¯‘æˆå­—èŠ‚ç ã€‚

æ¯”å¦‚è¯´æˆ‘ä»¬å¯ä»¥ä¸»åŠ¨æ‰§è¡Œ `javac Hello.java` å‘½ä»¤å°†æºä»£ç æ–‡ä»¶ç¼–è¯‘ä¸º Hello.class æ–‡ä»¶ï¼ˆç”¨ Intellij IDEA çš„è¯ï¼Œå¹¶ä¸éœ€è¦æˆ‘ä»¬ä¸»åŠ¨å»ç¼–è¯‘ã€Œjavacã€ï¼Œç›´æ¥è¿è¡Œå°±å¯ä»¥è‡ªåŠ¨ç”Ÿæˆ .class æ–‡ä»¶ï¼‰ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/hello-world-20230408185202.png)

ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ java å‘½ä»¤è¿è¡Œå­—èŠ‚ç ï¼ˆæ¯”å¦‚è¯´ `java Hello`ï¼‰ï¼Œæ­¤æ—¶å°±æœ‰ 2 ç§å¤„ç†æ–¹å¼äº†ã€‚

- 1ã€å­—èŠ‚ç ç”± JVM é€æ¡è§£é‡Šæ‰§è¡Œã€‚
- 2ã€éƒ¨åˆ†å­—èŠ‚ç å¯èƒ½ç”± [JITï¼ˆå³æ—¶ç¼–è¯‘ï¼Œæˆ³é“¾æ¥äº†è§£](https://tobebetterjavaer.com/jvm/jit.html)ï¼‰ç¼–è¯‘ä¸ºæœºå™¨æŒ‡ä»¤ç›´æ¥æ‰§è¡Œã€‚

â‘ ã€é€æ¡è§£é‡Šæ‰§è¡Œï¼š

é€æ¡è§£é‡Šæ‰§è¡Œæ˜¯ Java è™šæ‹Ÿæœºçš„åŸºæœ¬æ‰§è¡Œæ¨¡å¼ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒJava è™šæ‹Ÿæœºä¼šé€æ¡è¯»å–å­—èŠ‚ç æ–‡ä»¶ä¸­çš„æŒ‡ä»¤ï¼Œå¹¶å°†å…¶è§£é‡Šä¸ºå¯¹åº”çš„åº•å±‚æ“ä½œã€‚è§£é‡Šæ‰§è¡Œçš„ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œå¯åŠ¨é€Ÿåº¦è¾ƒå¿«ï¼Œä½†ç”±äºæ¯æ¬¡æ‰§è¡Œéƒ½éœ€è¦å¯¹å­—èŠ‚ç è¿›è¡Œè§£é‡Šï¼Œå› æ­¤æ‰§è¡Œæ•ˆç‡ç›¸å¯¹è¾ƒä½ã€‚

æ€»ç»“ä¸€ä¸‹é€æ¡è§£é‡Šæ‰§è¡Œçš„ç‰¹ç‚¹ï¼š

- å®ç°ç®€å•
- å¯åŠ¨é€Ÿåº¦è¾ƒå¿«
- æ‰§è¡Œæ•ˆç‡è¾ƒä½

â‘¡ã€JIT å³æ—¶ç¼–è¯‘ï¼š

ä¸ºäº†æé«˜ Java ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ï¼ŒJava è™šæ‹Ÿæœºå¼•å…¥äº†å³æ—¶ç¼–è¯‘ï¼ˆ[JITï¼ŒJust-In-Time Compilation](https://tobebetterjavaer.com/jvm/jit.html)ï¼‰æŠ€æœ¯ã€‚åœ¨ JIT æ¨¡å¼ä¸‹ï¼ŒJava è™šæ‹Ÿæœºä¼šåœ¨è¿è¡Œæ—¶å°†é¢‘ç¹æ‰§è¡Œçš„å­—èŠ‚ç ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨ç ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥åœ¨ç¡¬ä»¶ä¸Šè¿è¡Œï¼Œè€Œä¸éœ€è¦å†æ¬¡è§£é‡Šã€‚è¿™æ ·åšçš„ç»“æœæ˜¯æ˜¾è‘—æé«˜äº†ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒJIT ç¼–è¯‘å™¨å¹¶ä¸ä¼šç¼–è¯‘æ‰€æœ‰çš„å­—èŠ‚ç ï¼Œè€Œæ˜¯æ ¹æ®ä¸€å®šçš„ç­–ç•¥ï¼Œä»…ç¼–è¯‘è¢«é¢‘ç¹è°ƒç”¨çš„ä»£ç æ®µï¼ˆçƒ­ç‚¹ä»£ç ï¼‰ã€‚

æ€»ç»“ä¸€ä¸‹ JIT å³æ—¶ç¼–è¯‘çš„ç‰¹ç‚¹ï¼š

- æé«˜æ‰§è¡Œæ•ˆç‡
- ç¼–è¯‘çƒ­ç‚¹ä»£ç 
- åŠ¨æ€ä¼˜åŒ–

å®é™…ä¸Šï¼Œç°ä»£ Java è™šæ‹Ÿæœºï¼ˆå¦‚ HotSpotï¼‰é€šå¸¸ä¼šç»“åˆè¿™ä¸¤ç§æ‰§è¡Œæ–¹å¼ï¼Œå³è§£é‡Šæ‰§è¡Œå’Œ JIT å³æ—¶ç¼–è¯‘ã€‚åœ¨ç¨‹åºè¿è¡ŒåˆæœŸï¼ŒJava è™šæ‹Ÿæœºä¼šé‡‡ç”¨è§£é‡Šæ‰§è¡Œï¼Œä»¥å‡å°‘å¯åŠ¨æ—¶é—´ã€‚éšç€ç¨‹åºçš„è¿è¡Œï¼ŒJava è™šæ‹Ÿæœºä¼šè¯†åˆ«å‡ºçƒ­ç‚¹ä»£ç å¹¶ä½¿ç”¨ JIT ç¼–è¯‘å™¨å°†å…¶ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨ç ï¼Œä»è€Œæé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚è¿™ç§ç»“åˆç­–ç•¥ç§°ä¸ºæ··åˆæ¨¡å¼ã€‚


ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ºäº†è·¨å¹³å°ï¼ŒJava æºä»£ç é¦–å…ˆä¼šç¼–è¯‘æˆå­—èŠ‚ç ï¼Œå­—èŠ‚ç ä¸æ˜¯æœºå™¨è¯­è¨€ï¼Œéœ€è¦ JVM æ¥è§£é‡Šã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/hello-world-20230408190024.png)

æœ‰äº† JVM è¿™ä¸ªä¸­é—´å±‚ï¼ŒJava çš„è¿è¡Œæ•ˆç‡å°±æ²¡æœ‰ç›´æ¥æŠŠæºä»£ç ç¼–è¯‘ä¸ºæœºå™¨ç æ¥å¾—æ•ˆç‡æ›´é«˜ï¼Œè¿™ä¸ªåº”è¯¥èƒ½ç†è§£å—ï¼Œå¤šäº†ä¸­é—´å•†å˜›ã€‚æ‰€ä»¥ä¸ºäº†æé«˜æ•ˆç‡ï¼ŒJVM å¼•å…¥äº† JIT ç¼–è¯‘å™¨ï¼ŒæŠŠä¸€äº›ç»å¸¸æ‰§è¡Œçš„å­—èŠ‚ç ç›´æ¥ææˆæœºå™¨ç ã€‚

æ‰€ä»¥ï¼ŒJava æ˜¯è§£é‡Šå’Œç¼–è¯‘å¹¶å­˜ã€‚ä½†é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šè¯´â€œJava æ˜¯ç¼–è¯‘å‹è¯­è¨€â€ï¼Œå°½ç®¡è¿™æ ·å¹¶ä¸å‡†ç¡®ï¼Œä¸»è¦æ˜¯ JIT æ˜¯åé¢æ‰å‡ºç°çš„ï¼Œâ€œå…ˆå…¥ä¸ºä¸»å˜›â€ã€‚

â€œå¥½çš„ï¼ŒäºŒå“¥ï¼Œæˆ‘äº†è§£äº†ã€‚â€

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

# ç¬¬ä¸‰ç« ï¼šJavaè¯­æ³•åŸºç¡€

## 3.1 Javaå…³é”®å­—å’Œä¿ç•™å­—

â€œäºŒå“¥ï¼Œå°±[ä¹‹å‰ä½ ç»™æˆ‘å±•ç¤ºçš„ Java ä»£ç ](https://tobebetterjavaer.com/overview/hello-world.html)ä¸­ï¼Œæœ‰ publicã€staticã€voidã€main ç­‰ç­‰ï¼Œå®ƒä»¬åº”è¯¥éƒ½æ˜¯å…³é”®å­—å§ï¼Ÿâ€ä¸‰å¦¹çš„è„¸ä¸Šæ³›ç€ç”œç”œçš„ç¬‘å®¹ï¼Œæˆ‘æƒ³å¥¹åœ¨å­¦ä¹  Java æ–¹é¢å·²ç»å˜å¾—è¶Šæ¥è¶Šè‡ªä¿¡äº†ã€‚

â€œæ˜¯çš„ï¼Œä¸‰å¦¹ã€‚Java ä¸­çš„å…³é”®å­—å¯ä¸å°‘å‘¢ï¼ä½ ä¸€ä¸‹å­å¯èƒ½è®°ä¸äº†é‚£ä¹ˆå¤šï¼Œä¸è¿‡ï¼Œå…ˆä¿ç•™ä¸ªå°è±¡å§ï¼Œå¯¹ä»¥åçš„å­¦ä¹ ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚è¿™äº›å°ä»£ç éƒ½å¾ˆç®€å•ï¼Œä½ å¯ä»¥ç…§ç€ç§ä¸€ç§ï¼Œæ„Ÿå—ä¸€ä¸‹ã€‚â€

>PSï¼šè¿™é‡Œæˆ‘ä»¬æŒ‰ç…§é¦–å­—æ¯çš„è‡ªç„¶é¡ºåºæ’åˆ—æ¥ç®€è¿°ä¸€ä¸‹ï¼Œäº†è§£å³å¯ï¼Œè®°ä¸ä½æ²¡å…³ç³»å“¦ã€‚è¿™äº›å…³é”®å­—æˆ‘ä»¬åœ¨åç»­çš„å­¦ä¹ ä¸­ä¼šè¯¦ç»†è®²è§£çš„ï¼Œç›´åˆ°ä½ ææ‡‚ä¸ºæ­¢ã€‚

**1ã€abstractï¼š** ç”¨äºå£°æ˜[æŠ½è±¡ç±»](https://tobebetterjavaer.com/oo/abstract.html)ï¼Œä»¥åŠæŠ½è±¡æ–¹æ³•ã€‚

```java
abstract class Animal {
    abstract void makeSound();

    public void sleep() {
        System.out.println("The animal is sleeping.");
    }
}

class Dog extends Animal {
    void makeSound() {
        System.out.println("The dog barks.");
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º Animal çš„æŠ½è±¡ç±»ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³• `makeSound()` å’Œä¸€ä¸ªå…·ä½“æ–¹æ³• `sleep()`ã€‚

**2ã€booleanï¼š** Java ä¸­çš„ä¸€ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œè¡¨ç¤ºå¸ƒå°”å€¼ï¼Œå³çœŸï¼ˆtrueï¼‰æˆ–å‡ï¼ˆfalseï¼‰ã€‚boolean æ•°æ®ç±»å‹å¸¸ç”¨äºåˆ¤æ–­æ¡ä»¶ã€å¾ªç¯æ§åˆ¶å’Œé€»è¾‘è¿ç®—ç­‰åœºæ™¯ã€‚

```java
boolean isStudent = true;

if (isStudent) {
    System.out.println("This person is a student.");
} else {
    System.out.println("This person is not a student.");
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª boolean å˜é‡ï¼šisStudentã€‚é€šè¿‡ if è¯­å¥ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™äº›å˜é‡çš„å€¼è¿›è¡Œä¸åŒçš„æ“ä½œã€‚

**3ã€breakï¼š** ç”¨äºè·³å‡ºå¾ªç¯ç»“æ„ï¼ˆå¦‚ forã€while å’Œ do-while å¾ªç¯ï¼‰æˆ– switch è¯­å¥ã€‚å½“é‡åˆ° break è¯­å¥æ—¶ï¼Œç¨‹åºå°†ç«‹å³è·³å‡ºå½“å‰å¾ªç¯æˆ– switch è¯­å¥ï¼Œç»§ç»­æ‰§è¡Œç´§è·Ÿåœ¨å¾ªç¯æˆ– switch è¯­å¥åé¢çš„ä»£ç ã€‚

```java
for (int i = 0; i < 10; i++) {
    if (i == 5) {
        break;
    }
    System.out.println("i: " + i);
}
System.out.println("Loop ended.");
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ for å¾ªç¯éå† 0 åˆ° 9 çš„æ•´æ•°ã€‚å½“ i ç­‰äº 5 æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ break è¯­å¥è·³å‡ºå¾ªç¯ã€‚

**4ã€byteï¼š** ç”¨äºè¡¨ç¤ºä¸€ä¸ª 8 ä½ï¼ˆ1 å­—èŠ‚ï¼‰æœ‰ç¬¦å·æ•´æ•°ã€‚å®ƒçš„å€¼èŒƒå›´æ˜¯ -128ï¼ˆ-2^7ï¼‰åˆ° 127ï¼ˆ2^7 - 1ï¼‰ã€‚

ç”±äº byte ç±»å‹å ç”¨çš„ç©ºé—´è¾ƒå°ï¼Œå®ƒé€šå¸¸ç”¨äºå¤„ç†å¤§é‡çš„æ•°æ®ï¼Œå¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œä¼ è¾“ç­‰åœºæ™¯ï¼Œä»¥èŠ‚çœå†…å­˜ç©ºé—´ã€‚

```java
byte minByte = -128;
byte maxByte = 127;
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸‰ä¸ª byte ç±»å‹çš„å˜é‡ï¼šminByteã€maxByteï¼Œå¹¶åˆ†åˆ«èµ‹äºˆäº†ä¸åŒçš„å€¼ã€‚

**5ã€caseï¼š** é€šå¸¸ä¸ switch è¯­å¥ä¸€èµ·ä½¿ç”¨ã€‚switch è¯­å¥å…è®¸æ ¹æ®æŸä¸ªå˜é‡çš„å€¼æ¥é€‰æ‹©æ‰§è¡Œä¸åŒçš„ä»£ç å—ã€‚åœ¨ switch è¯­å¥ä¸­ï¼Œcase ç”¨äºæ ‡è¯†æ¯ä¸ªå¯èƒ½çš„å€¼å’Œå¯¹åº”çš„ä»£ç å—ã€‚

ä¾‹å­æˆ‘ä»¬ç›´æ¥æ”¾åˆ° switch ä¸­ä¸€èµ·è®²ã€‚

**6ã€catchï¼š** ç”¨äºæ•è· try è¯­å¥ä¸­çš„[å¼‚å¸¸](https://tobebetterjavaer.com/exception/gailan.html)ã€‚åœ¨ try å—ä¸­å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œåœ¨ catch å—ä¸­å¯ä»¥æ•è·è¿™äº›å¼‚å¸¸å¹¶è¿›è¡Œå¤„ç†ã€‚catch å—å¯ä»¥æœ‰å¤šä¸ªï¼Œæ¯ä¸ª catch å—å¯ä»¥æ•è·ç‰¹å®šç±»å‹çš„å¼‚å¸¸ã€‚åœ¨ catch å—ä¸­ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼Œä¾‹å¦‚è¾“å‡ºé”™è¯¯ä¿¡æ¯ã€è¿›è¡Œæ—¥å¿—è®°å½•ã€æ¢å¤ç¨‹åºçŠ¶æ€ç­‰ã€‚

```java
try {
    int num = Integer.parseInt("abc");
} catch (NumberFormatException e) {
    System.out.println("Invalid number format");
}
```

è¿™ä¸ªç¨‹åºä½¿ç”¨ try-catch è¯­å¥æ•è· NumberFormatException å¼‚å¸¸ã€‚åœ¨ try å—ä¸­ï¼Œå°è¯•å°†å­—ç¬¦ä¸² "abc" è½¬æ¢ä¸ºæ•´æ•°ç±»å‹ï¼Œç”±äºè¿™ä¸ªå­—ç¬¦ä¸²ä¸æ˜¯æœ‰æ•ˆçš„æ•°å­—æ ¼å¼ï¼Œå°†ä¼šæŠ›å‡º NumberFormatException å¼‚å¸¸ã€‚åœ¨ catch å—ä¸­ï¼Œæ•è·åˆ°äº†è¿™ä¸ªå¼‚å¸¸ï¼Œå¹¶è¾“å‡ºä¸€æ¡é”™è¯¯ä¿¡æ¯ã€‚

**7ã€charï¼š** ç”¨äºå£°æ˜ä¸€ä¸ªå­—ç¬¦ç±»å‹çš„å˜é‡ã€‚char ç±»å‹çš„å˜é‡å¯ä»¥å­˜å‚¨ä»»æ„çš„ [Unicode å­—ç¬¦](https://tobebetterjavaer.com/basic-extra-meal/java-unicode.html)ï¼Œå¯ä»¥ä½¿ç”¨å•å¼•å·å°†å­—ç¬¦æ‹¬èµ·æ¥æ¥è¡¨ç¤ºã€‚

```java
char c = 'A';
```

è¿™ä¸ªç¨‹åºåˆ›å»ºäº†ä¸€ä¸ª char ç±»å‹çš„å˜é‡ cï¼Œå¹¶å°†å…¶èµ‹å€¼ä¸ºå¤§å†™å­—æ¯ Aã€‚

**8ã€classï¼š** ç”¨äºå£°æ˜ä¸€ä¸ª[ç±»](https://tobebetterjavaer.com/oo/object-class.html)ã€‚

```java
public class Person {
    private String name;
    private int age;

    public Person(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public void sayHello() {
        System.out.println("Hello, my name is " + name + " and I am " + age + " years old.");
    }
}
```

**9ã€continueï¼š** ç”¨äºç»§ç»­ä¸‹ä¸€ä¸ªå¾ªç¯ï¼Œå¯ä»¥åœ¨æŒ‡å®šæ¡ä»¶ä¸‹è·³è¿‡å…¶ä½™ä»£ç ã€‚

```java
for (int i = 1; i <= 10; i++) {
    if (i % 2 == 0) {
        continue;
    }
    System.out.println(i);
}
```

**10ã€defaultï¼š** ç”¨äºæŒ‡å®š switch è¯­å¥ä¸­é™¤å» case æ¡ä»¶ä¹‹å¤–çš„é»˜è®¤ä»£ç å—ã€‚è¿™ä¸ªæˆ‘ä»¬æ”¾åˆ° switch é‡Œä¸€èµ·æ¼”ç¤ºã€‚

**11ã€doï¼š** é€šå¸¸å’Œ while å…³é”®å­—é…åˆä½¿ç”¨ï¼Œdo åç´§è·Ÿå¾ªç¯ä½“ã€‚

```java
int i = 1;
do {
    System.out.println(i);
    i++;
} while (i <= 10);
```

do-while å¾ªç¯ä¸ while å¾ªç¯ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äº do-while å¾ªç¯ä¼šå…ˆæ‰§è¡Œå¾ªç¯ä½“ä¸­çš„ä»£ç ï¼Œç„¶åå†æ£€æŸ¥å¾ªç¯æ¡ä»¶ã€‚å› æ­¤ï¼Œdo-while å¾ªç¯è‡³å°‘ä¼šæ‰§è¡Œä¸€æ¬¡å¾ªç¯ä½“ä¸­çš„ä»£ç ã€‚

**12ã€doubleï¼š** ç”¨äºå£°æ˜ä¸€ä¸ªåŒç²¾åº¦æµ®ç‚¹ç±»å‹çš„å˜é‡ã€‚

```java
double a = 3.14;
double b = 2.0;
double c = a + b;
```

**13ã€elseï¼š** ç”¨äºæŒ‡ç¤º if è¯­å¥ä¸­çš„å¤‡ç”¨åˆ†æ”¯ã€‚

```java
int score = 75;
if (score >= 60) {
    System.out.println("åŠæ ¼äº†");
} else {
    System.out.println("æŒ‚ç§‘äº†");
}
```

**14ã€enumï¼š** ç”¨äºå®šä¹‰ä¸€ç»„å›ºå®šçš„å¸¸é‡ï¼ˆ[æšä¸¾](https://tobebetterjavaer.com/basic-extra-meal/enum.html)ï¼‰ã€‚

```java
public enum PlayerType {
    TENNIS,
    FOOTBALL,
    BASKETBALL
}
```

**15ã€extendsï¼š** ç”¨äºæŒ‡ç¤ºä¸€ä¸ªç±»æ˜¯ä»å¦ä¸€ä¸ªç±»æˆ–æ¥å£[ç»§æ‰¿](https://tobebetterjavaer.com/oo/extends-bigsai.html)çš„ã€‚

```java
class Animal {
    public void eat() {
        System.out.println("åŠ¨ç‰©æ­£åœ¨åƒä¸œè¥¿");
    }
}

class Dog extends Animal {
    public void bark() {
        System.out.println("ç‹—åœ¨æ±ªæ±ªå«");
    }
}

public class ExtendsDemo {
    public static void main(String[] args) {
        Dog dog = new Dog();
        dog.eat();
        dog.bark();
    }
}
```

Animal ç±»ä¸­æœ‰ä¸€ä¸ª `eat()` æ–¹æ³•ï¼Œè¾“å‡ºå­—ç¬¦ä¸² "åŠ¨ç‰©æ­£åœ¨åƒä¸œè¥¿"ã€‚Dog ç±»ç»§æ‰¿è‡ª Animal ç±»ï¼Œå¹¶å®šä¹‰äº†ä¸€ä¸ª `bark()` æ–¹æ³•ï¼Œè¾“å‡ºå­—ç¬¦ä¸² "ç‹—åœ¨æ±ªæ±ªå«"ã€‚

**16ã€finalï¼š** [ç”¨äºè¡¨ç¤ºæŸä¸ªå˜é‡ã€æ–¹æ³•æˆ–ç±»æ˜¯æœ€ç»ˆçš„ï¼Œä¸èƒ½è¢«ä¿®æ”¹æˆ–ç»§æ‰¿](https://tobebetterjavaer.com/oo/final.html)ã€‚

â‘ ã€final å˜é‡ï¼šè¡¨ç¤ºä¸€ä¸ªå¸¸é‡ï¼Œä¸€æ—¦è¢«èµ‹å€¼ï¼Œå…¶å€¼å°±ä¸èƒ½å†è¢«ä¿®æ”¹ã€‚è¿™åœ¨å£°æ˜ä¸å¯å˜çš„å€¼æ—¶éå¸¸æœ‰ç”¨ã€‚

```java
final double PI = 3.14159265359;
```

â‘¡ã€final æ–¹æ³•è¡¨ç¤ºä¸€ä¸ªä¸èƒ½è¢«å­ç±»é‡å†™çš„æ–¹æ³•ã€‚è¿™åœ¨è®¾è®¡ç±»æ—¶ï¼Œç¡®ä¿æŸä¸ªæ–¹æ³•çš„å®ç°ä¸ä¼šè¢«å­ç±»ä¿®æ”¹æ—¶éå¸¸æœ‰ç”¨ã€‚

```java
class Animal {
    final void makeSound() {
        System.out.println("åŠ¨ç‰©å‘å‡ºå£°éŸ³.");
    }
}

class Dog extends Animal {
    // é”™è¯¯: æ— æ³•è¦†ç›–æ¥è‡ª Animal çš„ final æ–¹æ³•
    // void makeSound() {
    //     System.out.println("ç‹—å å«.");
    // }
}

public class Main {
    public static void main(String[] args) {
        Dog dog = new Dog();
        dog.makeSound();
    }
}
```

â‘¢ã€final ç±»è¡¨ç¤ºä¸€ä¸ªä¸èƒ½è¢«ç»§æ‰¿çš„ç±»ã€‚è¿™åœ¨è®¾è®¡ç±»æ—¶ï¼Œç¡®ä¿å…¶ä¸ä¼šè¢«å…¶ä»–ç±»ç»§æ‰¿æ—¶éå¸¸æœ‰ç”¨ã€‚[String ç±»å°±æ˜¯ final çš„](https://tobebetterjavaer.com/oo/final.html)ã€‚

```java
final class Animal {
    void makeSound() {
        System.out.println("åŠ¨ç‰©å‘å‡ºå£°éŸ³.");
    }
}

// é”™è¯¯: ç±»å‹ Dog æ— æ³•ç»§æ‰¿ final ç±» Animal
// class Dog extends Animal {
//     void makeSound() {
//         System.out.println("ç‹—å å«.");
//     }
// }

public class Main {
    public static void main(String[] args) {
        Animal animal = new Animal();
        animal.makeSound();
    }
}
```

**17ã€finallyï¼š** å’Œ `try-catch` é…åˆä½¿ç”¨ï¼Œè¡¨ç¤ºæ— è®ºæ˜¯å¦å¤„ç†å¼‚å¸¸ï¼Œæ€»æ˜¯æ‰§è¡Œ finally å—ä¸­çš„ä»£ç ã€‚

```java
try {
    int x = 10 / 0;  // æŠ›å‡ºå¼‚å¸¸
} catch (Exception e) {
    System.out.println("å‘ç”Ÿäº†å¼‚å¸¸ï¼š" + e.getMessage());
} finally {
    System.out.println("finally å—è¢«æ‰§è¡Œ");
}
```

**18ã€floatï¼š** è¡¨ç¤ºå•ç²¾åº¦æµ®ç‚¹æ•°ã€‚

```java
float f1 = 3.14f;   // æ³¨æ„è¦åœ¨æ•°å­—åé¢åŠ ä¸Š f è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª float ç±»å‹
float f2 = 1.23e-4f;   // ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºå°æ•°
```

åœ¨ Java ä¸­ï¼Œæµ®ç‚¹æ•°é»˜è®¤æ˜¯ double ç±»å‹ï¼Œå¦‚æœè¦ä½¿ç”¨ float ç±»å‹çš„æ•°æ®ï¼Œéœ€è¦åœ¨æ•°å­—åé¢åŠ ä¸Šä¸€ä¸ª f æˆ–è€… Fï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª float ç±»å‹çš„å­—é¢é‡ã€‚å¦å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºæµ®ç‚¹æ•°ï¼Œä¾‹å¦‚ 1.23e-4 è¡¨ç¤º 0.000123ã€‚

**19ã€forï¼š** ç”¨äºå£°æ˜ä¸€ä¸ª for å¾ªç¯ï¼Œå¦‚æœå¾ªç¯æ¬¡æ•°æ˜¯å›ºå®šçš„ï¼Œå»ºè®®ä½¿ç”¨ for å¾ªç¯ã€‚

```java
int[] arr = {1, 2, 3, 4, 5};
for (int i = 0; i < arr.length; i++) {
    System.out.println("arr[" + i + "] = " + arr[i]);
}
```

**20ã€ifï¼š** ç”¨äºæŒ‡å®šæ¡ä»¶ï¼Œå¦‚æœæ¡ä»¶ä¸ºçœŸï¼Œåˆ™æ‰§è¡Œå¯¹åº”ä»£ç ã€‚

```java
int n = -3;
if (n > 0) {
    System.out.println(n + " æ˜¯æ­£æ•°");
} else if (n < 0) {
    System.out.println(n + " æ˜¯è´Ÿæ•°");
} else {
    System.out.println(n + " æ˜¯é›¶");
}
```

**21ã€implementsï¼š** ç”¨äºå®ç°[æ¥å£](https://tobebetterjavaer.com/oo/interface.html)ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªå®ç°äº† Runnable æ¥å£çš„ç±»çš„ç¤ºä¾‹ï¼š

```java
public class MyThread implements Runnable {
    public void run() {
        // çº¿ç¨‹æ‰§è¡Œçš„ä»£ç 
    }
}
```

**22ã€importï¼š** ç”¨äºå¯¼å…¥å¯¹åº”çš„ç±»æˆ–è€…æ¥å£ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¦ä½¿ç”¨ Java æ ‡å‡†åº“ä¸­çš„ ArrayList ç±»ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š

```java
import java.util.ArrayList;
```

**23ã€instanceofï¼š** [ç”¨äºåˆ¤æ–­å¯¹è±¡æ˜¯å¦å±äºæŸä¸ªç±»å‹ï¼ˆclassï¼‰](https://tobebetterjavaer.com/basic-extra-meal/instanceof.html)ã€‚

```java
ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸€ä¸ª Person ç±»å’Œä¸€ä¸ª Student ç±»ï¼ŒStudent ç±»ç»§æ‰¿è‡ª Person ç±»ï¼Œå¯ä»¥ä½¿ç”¨ instanceof è¿ç®—ç¬¦æ¥åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸º Person ç±»æˆ–å…¶å­ç±»çš„å®ä¾‹ï¼š
Person p = new Student();
if (p instanceof Person) {
    System.out.println("p is an instance of Person");
}
if (p instanceof Student) {
    System.out.println("p is an instance of Student");
}
```

**24ã€intï¼š** ç”¨äºè¡¨ç¤ºæ•´æ•°å€¼ã€‚

```java
int x;           // å£°æ˜ä¸€ä¸ª int ç±»å‹çš„å˜é‡ x
x = 10;          // å°†æ•´æ•°å€¼ 10 èµ‹ç»™å˜é‡ x
int y = 20;     // å£°æ˜å¹¶åˆå§‹åŒ–ä¸€ä¸ª int ç±»å‹çš„å˜é‡ yï¼Œèµ‹å€¼ä¸ºæ•´æ•°å€¼ 20
```

**25ã€interfaceï¼š** ç”¨äºå£°æ˜æ¥å£ã€‚ä¼šå®šä¹‰ä¸€ç»„æ–¹æ³•çš„ç­¾åï¼ˆå³æ–¹æ³•åã€å‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼ç±»å‹ï¼‰ï¼Œä½†æ²¡æœ‰æ–¹æ³•ä½“ã€‚å…¶ä»–ç±»å¯ä»¥å®ç°æ¥å£ï¼Œå¹¶æä¾›æ–¹æ³•çš„å…·ä½“å®ç°ã€‚

```java
public interface MyInterface {
    void method1();
    int method2(String param);
}
```

**26ã€longï¼š** ç”¨äºè¡¨ç¤ºé•¿æ•´æ•°å€¼ã€‚

```java
long x;           // å£°æ˜ä¸€ä¸ª long ç±»å‹çš„å˜é‡ x
x = 10000000000L; // å°†é•¿æ•´æ•°å€¼ 10000000000 èµ‹ç»™å˜é‡ xï¼Œéœ€è¦åœ¨æ•°å­—åé¢åŠ ä¸Š L æˆ– l è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª long ç±»å‹çš„å€¼
long y = 20000000000L; // å£°æ˜å¹¶åˆå§‹åŒ–ä¸€ä¸ª long ç±»å‹çš„å˜é‡ yï¼Œèµ‹å€¼ä¸ºé•¿æ•´æ•°å€¼ 20000000000
```

**27ã€nativeï¼š** [ç”¨äºå£°æ˜ä¸€ä¸ªæœ¬åœ°æ–¹æ³•](https://tobebetterjavaer.com/oo/native-method.html)ï¼Œæœ¬åœ°æ–¹æ³•æ˜¯æŒ‡åœ¨ Java ä»£ç ä¸­å£°æ˜ä½†åœ¨æœ¬åœ°ä»£ç ï¼ˆé€šå¸¸æ˜¯ C æˆ– C++ ä»£ç ï¼‰ä¸­å®ç°çš„æ–¹æ³•ï¼Œå®ƒé€šå¸¸ç”¨äºä¸æ“ä½œç³»ç»Ÿæˆ–å…¶ä»–æœ¬åœ°åº“è¿›è¡Œäº¤äº’ã€‚

```java
public native void nativeMethod();
```

**28ã€newï¼š** ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚

ä»¥ä¸‹æ˜¯ä½¿ç”¨ new å…³é”®å­—åˆ›å»ºå¯¹è±¡å®ä¾‹çš„åŸºæœ¬è¯­æ³•ï¼š

```java
ClassName obj = new ClassName();
```

ä»¥ä¸‹æ˜¯ä½¿ç”¨ new å…³é”®å­—åˆ›å»ºæ•°ç»„å®ä¾‹çš„åŸºæœ¬è¯­æ³•ï¼š

```java
int[] arr = new int[10];
```

**29ã€nullï¼š** å¦‚æœä¸€ä¸ªå˜é‡æ˜¯ç©ºçš„ï¼ˆä»€ä¹ˆå¼•ç”¨ä¹Ÿæ²¡æœ‰æŒ‡å‘ï¼‰ï¼Œå°±å¯ä»¥å°†å®ƒèµ‹å€¼ä¸º nullï¼Œå’Œ[ç©ºæŒ‡é’ˆ](https://tobebetterjavaer.com/exception/npe.html)å¼‚å¸¸æ¯æ¯ç›¸å…³ã€‚

```java
String str = null; // å£°æ˜ä¸€ä¸ªå­—ç¬¦ä¸²å¼•ç”¨ï¼Œåˆå§‹åŒ–ä¸º null
MyClass obj = null; // å£°æ˜ä¸€ä¸ª MyClass ç±»å‹çš„å¼•ç”¨ï¼Œåˆå§‹åŒ–ä¸º null
```

**30ã€packageï¼š** ç”¨äºå£°æ˜ç±»æ‰€åœ¨çš„[åŒ…](https://tobebetterjavaer.com/oo/package.html)ã€‚

```java
package com.example.mypackage;
```

**31ã€privateï¼š** ä¸€ä¸ª[è®¿é—®æƒé™ä¿®é¥°ç¬¦](https://tobebetterjavaer.com/oo/access-control.html)ï¼Œè¡¨ç¤ºæ–¹æ³•æˆ–å˜é‡åªå¯¹å½“å‰ç±»å¯è§ã€‚

```java
public class MyClass {
    private int x; // ç§æœ‰å±æ€§ xï¼Œåªèƒ½åœ¨å½“å‰ç±»çš„å†…éƒ¨è®¿é—®

    private void foo() {
        // ç§æœ‰æ–¹æ³• fooï¼Œåªèƒ½åœ¨å½“å‰ç±»çš„å†…éƒ¨è°ƒç”¨
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒMyClass ç±»æœ‰ä¸€ä¸ªç§æœ‰å±æ€§ x å’Œä¸€ä¸ªç§æœ‰æ–¹æ³• `foo()`ã€‚è¿™äº›æˆå‘˜åªèƒ½åœ¨ MyClass ç±»çš„å†…éƒ¨è®¿é—®å’Œè°ƒç”¨ï¼Œå¯¹å…¶ä»–ç±»ä¸å¯è§ã€‚

**32ã€protectedï¼š** ä¸€ä¸ªè®¿é—®æƒé™ä¿®é¥°ç¬¦ï¼Œè¡¨ç¤ºæ–¹æ³•æˆ–å˜é‡å¯¹åŒä¸€åŒ…å†…çš„ç±»å’Œæ‰€æœ‰å­ç±»å¯è§ã€‚

```java
package com.example.mypackage;

public class MyBaseClass {
    protected int x; // å—ä¿æŠ¤çš„å±æ€§ xï¼Œå¯ä»¥è¢«å­ç±»å’ŒåŒä¸€åŒ…ä¸­çš„å…¶ä»–ç±»è®¿é—®

    protected void foo() {
        // å—ä¿æŠ¤çš„æ–¹æ³• fooï¼Œå¯ä»¥è¢«å­ç±»å’ŒåŒä¸€åŒ…ä¸­çš„å…¶ä»–ç±»è°ƒç”¨
    }
}

package com.example.mypackage;

public class MySubClass extends MyBaseClass {
    public void bar() {
        x = 10; // å¯ä»¥è®¿é—® MyBaseClass ä¸­çš„å—ä¿æŠ¤å±æ€§ x
        foo(); // å¯ä»¥è°ƒç”¨ MyBaseClass ä¸­çš„å—ä¿æŠ¤æ–¹æ³• foo
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒMyBaseClass ç±»æœ‰ä¸€ä¸ªå—ä¿æŠ¤çš„å±æ€§ x å’Œä¸€ä¸ªå—ä¿æŠ¤çš„æ–¹æ³• `foo()`ã€‚è¿™äº›æˆå‘˜å¯ä»¥è¢«å­ç±»å’ŒåŒä¸€åŒ…ä¸­çš„å…¶ä»–ç±»è®¿é—®å’Œè°ƒç”¨ã€‚MySubClass ç±»ç»§æ‰¿è‡ª MyBaseClass ç±»ï¼Œå¹¶å¯ä»¥è®¿é—®å’Œä¿®æ”¹ MyBaseClass ä¸­çš„å—ä¿æŠ¤æˆå‘˜ã€‚

**33ã€publicï¼š** ä¸€ä¸ªè®¿é—®æƒé™ä¿®é¥°ç¬¦ï¼Œé™¤äº†å¯ä»¥å£°æ˜æ–¹æ³•å’Œå˜é‡ï¼ˆæ‰€æœ‰ç±»å¯è§ï¼‰ï¼Œè¿˜å¯ä»¥å£°æ˜ç±»ã€‚`main()` æ–¹æ³•å¿…é¡»å£°æ˜ä¸º publicã€‚

```java
public class MyClass {
    public int x; // å…¬æœ‰å±æ€§ xï¼Œå¯ä»¥è¢«ä»»ä½•ç±»è®¿é—®

    public void foo() {
        // å…¬æœ‰æ–¹æ³• fooï¼Œå¯ä»¥è¢«ä»»ä½•ç±»è°ƒç”¨
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒMyClass ç±»æœ‰ä¸€ä¸ªå…¬æœ‰å±æ€§ x å’Œä¸€ä¸ªå…¬æœ‰æ–¹æ³• `foo()`ã€‚è¿™äº›æˆå‘˜å¯ä»¥è¢«ä»»ä½•ç±»è®¿é—®å’Œè°ƒç”¨ï¼Œæ— è®ºè¿™äº›ç±»æ˜¯å¦åœ¨åŒä¸€ä¸ªåŒ…ä¸­ã€‚

**35ã€returnï¼š** ç”¨äºä»æ–¹æ³•ä¸­è¿”å›ä¸€ä¸ªå€¼æˆ–ç»ˆæ­¢æ–¹æ³•çš„æ‰§è¡Œã€‚return è¯­å¥å¯ä»¥å°†æ–¹æ³•çš„è®¡ç®—ç»“æœè¿”å›ç»™è°ƒç”¨è€…ï¼Œæˆ–è€…åœ¨æ–¹æ³•æ‰§è¡Œåˆ°æŸä¸ªç‰¹å®šæ¡ä»¶æ—¶æå‰ç»“æŸæ–¹æ³•ã€‚

```java
public int add(int a, int b) {
    int sum = a + b;
    return sum; // è¿”å› sum çš„å€¼ï¼Œå¹¶ç»“æŸæ–¹æ³•çš„æ‰§è¡Œ
}
```

æ­¤å¤–ï¼Œreturn è¯­å¥è¿˜å¯ä»¥ç”¨äºæå‰ç»“æŸæ–¹æ³•çš„æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬è¦ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦ä¸ºå¶æ•°ï¼š

```java
public static boolean isEven(int number) {
    if (number % 2 == 0) {
        return true;
    }
    return false;
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸º isEven çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ªæ•´æ•°å‚æ•° numberã€‚å¦‚æœ number æ˜¯å¶æ•°ï¼Œæˆ‘ä»¬ä½¿ç”¨ return è¯­å¥æå‰è¿”å› trueã€‚å¦åˆ™ï¼Œæ–¹æ³•æ‰§è¡Œå°†ç»§ç»­ï¼Œæœ€åè¿”å› falseã€‚

**36ã€shortï¼š** ç”¨äºè¡¨ç¤ºçŸ­æ•´æ•°ï¼Œå ç”¨ 2 ä¸ªå­—èŠ‚ï¼ˆ16 ä½ï¼‰çš„å†…å­˜ç©ºé—´ã€‚

```java
short x = 10; // å£°æ˜ä¸€ä¸ª short ç±»å‹çš„å˜é‡ xï¼Œèµ‹å€¼ä¸º 10
short y = 20; // å£°æ˜ä¸€ä¸ª short ç±»å‹çš„å˜é‡ yï¼Œèµ‹å€¼ä¸º 20
```

**37ã€staticï¼š** è¡¨ç¤ºè¯¥å˜é‡æˆ–æ–¹æ³•æ˜¯[é™æ€å˜é‡æˆ–é™æ€æ–¹æ³•](https://tobebetterjavaer.com/oo/static.html)ã€‚

```java
public class MyClass {
    public static int x; // é™æ€å˜é‡ xï¼Œå±äºç±»çš„æˆå‘˜

    public static void foo() {
        // é™æ€æ–¹æ³• fooï¼Œå±äºç±»çš„æˆå‘˜
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒMyClass ç±»æœ‰ä¸€ä¸ªé™æ€å˜é‡ x å’Œä¸€ä¸ªé™æ€æ–¹æ³• `foo()`ã€‚è¿™äº›æˆå‘˜å±äºç±»çš„æˆå‘˜ï¼Œå¯ä»¥é€šè¿‡ç±»åç›´æ¥è®¿é—®ï¼Œä¸éœ€è¦åˆ›å»ºå¯¹è±¡ã€‚

**38ã€strictfpï¼ˆstrict floating-pointï¼‰ï¼š** å¹¶ä¸å¸¸è§ï¼Œé€šå¸¸ç”¨äºä¿®é¥°ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºé™åˆ¶æµ®ç‚¹æ•°è®¡ç®—çš„ç²¾åº¦å’Œèˆå…¥è¡Œä¸ºã€‚å½“ä½ åœ¨ç±»ã€æ¥å£æˆ–æ–¹æ³•ä¸Šä½¿ç”¨ strictfp æ—¶ï¼Œè¯¥èŒƒå›´å†…çš„æ‰€æœ‰æµ®ç‚¹æ•°è®¡ç®—å°†éµå¾ª IEEE 754 æ ‡å‡†çš„è§„å®šï¼Œä»¥ç¡®ä¿è·¨å¹³å°çš„æµ®ç‚¹æ•°è®¡ç®—çš„ä¸€è‡´æ€§ã€‚

ä¸åŒçš„ç¡¬ä»¶å¹³å°å’Œ JVM å®ç°å¯èƒ½å¯¹æµ®ç‚¹æ•°è®¡ç®—çš„ç²¾åº¦å’Œèˆå…¥è¡Œä¸ºæœ‰å·®å¼‚ï¼Œè¿™å¯èƒ½å¯¼è‡´åœ¨ä¸åŒç¯å¢ƒä¸­è¿è¡Œç›¸åŒçš„æµ®ç‚¹æ•°è®¡ç®—ä»£ç äº§ç”Ÿä¸åŒçš„ç»“æœã€‚ä½¿ç”¨ strictfp å…³é”®å­—å¯ä»¥ç¡®ä¿åœ¨æ‰€æœ‰å¹³å°ä¸Šè·å¾—ç›¸åŒçš„æµ®ç‚¹æ•°è®¡ç®—ç»“æœï¼Œé¿å…è®¡ç®—ç»“æœçš„ä¸ä¸€è‡´é—®é¢˜ã€‚

ä½†è¯·æ³¨æ„ï¼Œä½¿ç”¨ strictfp å¯èƒ½ä¼šå¯¹æ€§èƒ½äº§ç”Ÿå½±å“ï¼Œå› ä¸ºå¯èƒ½éœ€è¦æ›´å¤šçš„è®¡ç®—å’Œè½¬æ¢æ¥ç¡®ä¿éµå¾ª IEEE 754 æ ‡å‡†ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨ strictfp æ—¶ï¼Œéœ€è¦æƒè¡¡ç²¾åº¦å’Œä¸€è‡´æ€§ä¸æ€§èƒ½ä¹‹é—´çš„å…³ç³»ã€‚

```java
public strictfp class MyClass {
    public static void main(String[] args) {
        double a = 0.1;
        double b = 0.2;
        double result = a + b;
        System.out.println("Result: " + result);
    }
}
```

è¾“å‡ºï¼š

```
Result: 0.30000000000000004
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒMyClass ç±»è¢«å£°æ˜ä¸º strictfpï¼Œå› æ­¤ç±»ä¸­çš„æ‰€æœ‰æµ®ç‚¹æ•°è®¡ç®—éƒ½å°†éµå¾ª IEEE 754 æ ‡å‡†ã€‚

åœ¨å¤§å¤šæ•°ç°ä»£æ“ä½œç³»ç»Ÿä¸Šï¼Œä½¿ç”¨ strictfp å¯èƒ½ä¸ä¼šäº§ç”Ÿæ˜¾è‘—å·®å¼‚ï¼Œå› ä¸ºå¤§å®¶éƒ½éµå¾ª IEEE 754 æ ‡å‡†ï¼Œé™¤éæ˜¯ä¸€äº›è¾ƒæ—§çš„ç¡¬ä»¶å¹³å°ã€‚

IEEE 754 æ ‡å‡†ï¼ˆIEEE Standard for Floating-Point Arithmeticï¼‰æ˜¯ä¸€ä¸ªå®šä¹‰æµ®ç‚¹æ•°è¡¨ç¤ºå’Œè¿ç®—çš„å›½é™…æ ‡å‡†ã€‚ç”±å›½é™…ç”µæ°”å’Œç”µå­å·¥ç¨‹å¸ˆåä¼šï¼ˆIEEEï¼‰åˆ¶å®šï¼Œé¦–æ¬¡å‘å¸ƒäº1985å¹´ã€‚

IEEE 754 æ ‡å‡†ä¸»è¦è§„å®šäº†ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

æµ®ç‚¹æ•°è¡¨ç¤ºï¼šæ ‡å‡†å®šä¹‰äº†ä¸¤ç§æµ®ç‚¹æ•°æ ¼å¼ï¼Œå•ç²¾åº¦ï¼ˆ32ä½ï¼‰å’ŒåŒç²¾åº¦ï¼ˆ64ä½ï¼‰ã€‚è¿™ä¸¤ç§æ ¼å¼åˆ†åˆ«ç”±ç¬¦å·ä½ã€æŒ‡æ•°ä½å’Œå°¾æ•°ä½ç»„æˆï¼Œç”¨äºè¡¨ç¤ºæµ®ç‚¹æ•°çš„å¤§å°å’Œç²¾åº¦ã€‚

å››èˆäº”å…¥å’Œèˆå…¥æ¨¡å¼ï¼šæ ‡å‡†å®šä¹‰äº†å¤šç§èˆå…¥æ¨¡å¼ï¼Œä¾‹å¦‚å‘æœ€æ¥è¿‘çš„æ•°èˆå…¥ï¼ˆRound to Nearest, Ties to Evenï¼‰ã€å‘é›¶èˆå…¥ï¼ˆRound toward Zeroï¼‰ã€å‘æ­£æ— ç©·èˆå…¥ï¼ˆRound toward +âˆï¼‰å’Œå‘è´Ÿæ— ç©·èˆå…¥ï¼ˆRound toward -âˆï¼‰ç­‰ã€‚è¿™äº›æ¨¡å¼æŒ‡å¯¼äº†æµ®ç‚¹æ•°è®¡ç®—è¿‡ç¨‹ä¸­å¦‚ä½•å¤„ç†ç²¾åº¦æŸå¤±å’Œèˆå…¥è¯¯å·®ã€‚

ç‰¹æ®Šå€¼ï¼šæ ‡å‡†å®šä¹‰äº†ä¸€äº›ç‰¹æ®Šçš„æµ®ç‚¹æ•°å€¼ï¼Œå¦‚æ­£æ— ç©·ï¼ˆ+âˆï¼‰ã€è´Ÿæ— ç©·ï¼ˆ-âˆï¼‰å’Œéæ•°å€¼ï¼ˆNaNï¼‰ã€‚è¿™äº›ç‰¹æ®Šå€¼ç”¨äºè¡¨ç¤ºæµ®ç‚¹æ•°è®¡ç®—ä¸­å¯èƒ½å‡ºç°çš„æº¢å‡ºã€ä¸‹æº¢å’Œæœªå®šä¹‰ç»“æœç­‰æƒ…å†µã€‚

æµ®ç‚¹æ•°è¿ç®—ï¼šæ ‡å‡†è§„å®šäº†æµ®ç‚¹æ•°çš„åŸºæœ¬è¿ç®—ï¼ˆåŠ ã€å‡ã€ä¹˜ã€é™¤ï¼‰å’Œæ¯”è¾ƒè¿ç®—ï¼ˆç­‰äºã€ä¸ç­‰äºã€å¤§äºã€å°äºã€å¤§äºç­‰äºã€å°äºç­‰äºï¼‰çš„è¡Œä¸ºå’Œç»“æœã€‚è¿™äº›è¿ç®—éœ€è¦éµå¾ªæ ‡å‡†ä¸­è§„å®šçš„è¡¨ç¤ºã€èˆå…¥å’Œç‰¹æ®Šå€¼å¤„ç†è§„åˆ™ã€‚

æ¥çœ‹ç¤ºä¾‹

```java
public class Ieee754Demo {

    public static void main(String[] args) {
        float a = 0.1f;
        float b = 0.2f;
        float c = a + b;

        System.out.println("a = " + a);
        System.out.println("b = " + b);
        System.out.println("c = a + b = " + c);

        double x = 1.0 / 0.0;
        double y = -1.0 / 0.0;
        double z = 0.0 / 0.0;

        System.out.println("x = 1.0 / 0.0 = " + x);
        System.out.println("y = -1.0 / 0.0 = " + y);
        System.out.println("z = 0.0 / 0.0 = " + z);
    }
}
```

è¾“å‡ºç»“æœï¼š

![](https://cdn.tobebetterjavaer.com/stutymore/override-overload-20230408151129.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ° IEEE 754 æ ‡å‡†ä¸­çš„æµ®ç‚¹æ•°è¡¨ç¤ºå’Œè¿ç®—ï¼š

- å•ç²¾åº¦æµ®ç‚¹æ•°çš„åŠ æ³•ï¼šå˜é‡ a å’Œ b åˆ†åˆ«å­˜å‚¨äº† 0.1 å’Œ 0.2ï¼Œå®ƒä»¬çš„å’Œ c ç­‰äº 0.3ã€‚ç”±äºæµ®ç‚¹æ•°è¡¨ç¤ºçš„ç²¾åº¦é™åˆ¶ï¼Œc çš„å®é™…å€¼å¯èƒ½ä¸ç†è®ºå€¼ç•¥æœ‰è¯¯å·®ã€‚
- ç‰¹æ®Šå€¼ï¼šå˜é‡ xã€y å’Œ z åˆ†åˆ«å­˜å‚¨äº†æ­£æ— ç©·ï¼ˆ+âˆï¼‰ã€è´Ÿæ— ç©·ï¼ˆ-âˆï¼‰å’Œéæ•°å€¼ï¼ˆNaNï¼‰ã€‚è¿™äº›ç‰¹æ®Šå€¼æ˜¯ç”±é™¤æ³•è¿ç®—äº§ç”Ÿçš„ï¼Œå½“è¢«é™¤æ•°ä¸º 0 æˆ–ç»“æœæ— æ³•è¡¨ç¤ºæ—¶ï¼Œä¼šè¿”å›ç›¸åº”çš„ç‰¹æ®Šå€¼ã€‚

**39ã€superï¼š** å¯ç”¨äº[è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•æˆ–è€…å­—æ®µ](https://tobebetterjavaer.com/oo/this-super.html)ã€‚

```java
class Animal {
    protected String name;

    public Animal(String name) {
        this.name = name;
    }

    public void eat() {
        System.out.println(name + " is eating.");
    }
}

public class Dog extends Animal {
    public Dog(String name) {
        super(name); // è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•
    }

    public void bark() {
        System.out.println(name + " is barking.");
    }

    public void eat() {
        super.eat(); // è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•
        System.out.println(name + " is eating bones.");
    }
}
```

**40ã€switchï¼š** ç”¨äºæ ¹æ®æŸä¸ªå˜é‡çš„å€¼é€‰æ‹©æ‰§è¡Œä¸åŒçš„ä»£ç å—ã€‚switch è¯­å¥é€šå¸¸ä¸ case å’Œ default ä¸€èµ·ä½¿ç”¨ã€‚æ¯ä¸ª case å­å¥è¡¨ç¤ºä¸€ä¸ªå¯èƒ½çš„å€¼å’Œå¯¹åº”çš„ä»£ç å—ï¼Œè€Œ default å­å¥ç”¨äºå¤„ç†ä¸åœ¨ case å­å¥ä¸­çš„å€¼ã€‚

```java
public class Main {
    public static void main(String[] args) {
        int dayOfWeek = 3;

        switch (dayOfWeek) {
            case 1:
                System.out.println("Monday");
                break;
            case 2:
                System.out.println("Tuesday");
                break;
            case 3:
                System.out.println("Wednesday");
                break;
            case 4:
                System.out.println("Thursday");
                break;
            case 5:
                System.out.println("Friday");
                break;
            case 6:
                System.out.println("Saturday");
                break;
            case 7:
                System.out.println("Sunday");
                break;
            default:
                System.out.println("Invalid day");
                break;
        }
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸º dayOfWeek çš„æ•´æ•°å˜é‡ï¼Œå¹¶èµ‹äºˆäº†ä¸€ä¸ªå€¼ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ switch è¯­å¥æ ¹æ® dayOfWeek çš„å€¼æ¥è¾“å‡ºå¯¹åº”çš„æ˜ŸæœŸå‡ ã€‚æ¯ä¸ª case å­å¥è¡¨ç¤º dayOfWeek å¯èƒ½çš„å€¼ï¼Œåé¢ç´§è·Ÿç€è¦æ‰§è¡Œçš„ä»£ç ã€‚ä½¿ç”¨ break è¯­å¥è·³å‡º switch è¯­å¥ï¼Œé¿å…æ‰§è¡Œå…¶ä»– case å­å¥çš„ä»£ç ã€‚å¦‚æœ dayOfWeek çš„å€¼ä¸åœ¨ case å­å¥ä¸­ï¼Œdefault å­å¥å°†è¢«æ‰§è¡Œã€‚

**41ã€synchronizedï¼š** [ç”¨äºæŒ‡å®šå¤šçº¿ç¨‹ä»£ç ä¸­çš„åŒæ­¥æ–¹æ³•ã€å˜é‡æˆ–è€…ä»£ç å—](https://tobebetterjavaer.com/thread/synchronized-1.html)ã€‚

```java
public class MyClass {
    private int count;

    public synchronized void increment() {
        count++; // åŒæ­¥æ–¹æ³•
    }

    public void doSomething() {
        synchronized(this) { // åŒæ­¥ä»£ç å—
            // æ‰§è¡Œä¸€äº›éœ€è¦åŒæ­¥çš„æ“ä½œ
        }
    }
}
```

**42ã€thisï¼š** [å¯ç”¨äºåœ¨æ–¹æ³•æˆ–æ„é€ æ–¹æ³•ä¸­å¼•ç”¨å½“å‰å¯¹è±¡](https://tobebetterjavaer.com/oo/this-super.html)ã€‚

```java
public class MyClass {
    private int num;

    public MyClass(int num) {
        this.num = num; // ä½¿ç”¨ this å…³é”®å­—å¼•ç”¨å½“å‰å¯¹è±¡çš„æˆå‘˜å˜é‡
    }

    public void doSomething() {
        System.out.println("Doing something with " + this.num); // ä½¿ç”¨ this å…³é”®å­—å¼•ç”¨å½“å‰å¯¹è±¡çš„æˆå‘˜å˜é‡
    }

    public MyClass getThis() {
        return this; // è¿”å›å½“å‰å¯¹è±¡æœ¬èº«
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒMyClass ç±»æœ‰ä¸€ä¸ªç§æœ‰æˆå‘˜å˜é‡ numï¼Œå¹¶å®šä¹‰äº†ä¸€ä¸ªæ„é€ æ–¹æ³•ã€ä¸€ä¸ªæ–¹æ³•å’Œä¸€ä¸ªè¿”å›å½“å‰å¯¹è±¡çš„æ–¹æ³•ã€‚åœ¨æ„é€ æ–¹æ³•ä¸­ï¼Œä½¿ç”¨ this å…³é”®å­—å¼•ç”¨å½“å‰å¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œå¹¶å°†ä¼ å…¥çš„å‚æ•°èµ‹å€¼ç»™è¯¥æˆå‘˜å˜é‡ã€‚åœ¨æ–¹æ³• `doSomething()` ä¸­ï¼Œä½¿ç”¨ this å…³é”®å­—å¼•ç”¨å½“å‰å¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œå¹¶è¾“å‡ºè¯¥æˆå‘˜å˜é‡çš„å€¼ã€‚åœ¨æ–¹æ³• `getThis()` ä¸­ï¼Œç›´æ¥è¿”å›å½“å‰å¯¹è±¡æœ¬èº«ã€‚

**43ã€throwï¼š** ä¸»åŠ¨æŠ›å‡º[å¼‚å¸¸](https://tobebetterjavaer.com/exception/gailan.html)ã€‚

```java
public class MyClass {
    public void doSomething(int num) throws Exception {
        if (num < 0) {
            throw new Exception("num must be greater than zero"); // æ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸
        }
        // æ‰§è¡Œä¸€äº›æ“ä½œ
    }
}
```

**44ã€throwsï¼š** ç”¨äºå£°æ˜å¼‚å¸¸ã€‚

```java
public class MyClass {
    public void doSomething(int num) throws Exception {
        if (num < 0) {
            throw new Exception("num must be greater than zero"); // æ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸
        }
        // æ‰§è¡Œä¸€äº›æ“ä½œ
    }
}
```

**45ã€transientï¼š**  [ä¿®é¥°çš„å­—æ®µä¸ä¼šè¢«åºåˆ—åŒ–](https://tobebetterjavaer.com/io/transient.html)ã€‚

```java
public class MyClass implements Serializable {
    private int id;
    private String name;
    private transient String password;

    public MyClass(int id, String name, String password) {
        this.id = id;
        this.name = name;
        this.password = password;
    }

    // çœç•¥ getter å’Œ setter æ–¹æ³•

    @Override
    public String toString() {
        return "MyClass{" +
                "id=" + id +
                ", name='" + name + '\'' +
                ", password='" + password + '\'' +
                '}';
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒMyClass ç±»å®ç°äº† Serializable æ¥å£ï¼Œè¡¨ç¤ºè¯¥ç±»çš„å¯¹è±¡å¯ä»¥è¢«åºåˆ—åŒ–ã€‚è¯¥ç±»æœ‰ä¸‰ä¸ªæˆå‘˜å˜é‡ï¼Œåˆ†åˆ«æ˜¯ idã€name å’Œ passwordã€‚å…¶ä¸­ï¼Œpassword æˆå‘˜å˜é‡è¢«æ ‡è®°ä¸º transientï¼Œè¡¨ç¤ºåœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­å¿½ç•¥è¿™ä¸ªæˆå‘˜å˜é‡ã€‚

**45ã€tryï¼š** ç”¨äºåŒ…è£¹è¦æ•è·å¼‚å¸¸çš„ä»£ç å—ã€‚

```java
try {
    // å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»£ç 
    int result = 1 / 0;
} catch (Exception e) {
    // å¼‚å¸¸å¤„ç†ä»£ç 
    e.printStackTrace();
}
```

**46ã€voidï¼š** ç”¨äºæŒ‡å®šæ–¹æ³•æ²¡æœ‰è¿”å›å€¼ã€‚

```java
public void doSomething() {
    // æ–¹æ³•ä½“
}
```

**47ã€volatileï¼š** ä¿è¯ä¸åŒçº¿ç¨‹å¯¹å®ƒä¿®é¥°çš„å˜é‡è¿›è¡Œæ“ä½œæ—¶çš„[å¯è§æ€§](https://tobebetterjavaer.com/thread/volatile.html)ï¼Œå³ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå˜é‡çš„å€¼ï¼Œæ–°å€¼å¯¹å…¶ä»–çº¿ç¨‹æ¥è¯´æ˜¯ç«‹å³å¯è§çš„ã€‚

```java
public class MyThread extends Thread {
    private volatile boolean running = true;

    @Override
    public void run() {
        while (running) {
            // çº¿ç¨‹æ‰§è¡Œçš„ä»£ç 
        }
    }

    public void stopThread() {
        running = false;
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒMyThread ç±»ç»§æ‰¿äº† Thread ç±»ï¼Œé‡å†™äº† `run()` æ–¹æ³•ã€‚MyThread ç±»æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡ runningï¼Œè¢«æ ‡è®°ä¸º volatileï¼Œè¡¨ç¤ºè¿™ä¸ªå˜é‡æ˜¯å…±äº«çš„ï¼Œå¯èƒ½ä¼šè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ã€‚åœ¨ `run()` æ–¹æ³•ä¸­ï¼Œä½¿ç”¨ while å¾ªç¯æ£€æŸ¥ running å˜é‡çš„å€¼ï¼Œå¦‚æœ running ä¸º trueï¼Œå°±ç»§ç»­æ‰§è¡Œå¾ªç¯ä½“ä¸­çš„ä»£ç ã€‚åœ¨å¦ä¸€ä¸ªæ–¹æ³• `stopThread()` ä¸­ï¼Œå°† running å˜é‡çš„å€¼è®¾ç½®ä¸º falseï¼Œè¡¨ç¤ºéœ€è¦åœæ­¢çº¿ç¨‹ã€‚

**48ã€whileï¼š** å¦‚æœå¾ªç¯æ¬¡æ•°ä¸å›ºå®šï¼Œå»ºè®®ä½¿ç”¨ while å¾ªç¯ã€‚

```java
int i = 0;
while (i < 10) {
    System.out.println(i);
    i++;
}
```


â€œå¥½äº†ï¼Œä¸‰å¦¹ï¼Œå…³äº Java ä¸­çš„å…³é”®å­—å°±å…ˆè¯´è¿™ 48 ä¸ªå§ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå¤§æ¦‚çš„ä»‹ç»ï¼Œåé¢è¿˜ä¼šå¯¹ä¸€äº›ç‰¹æ®Šçš„å…³é”®å­—å•ç‹¬æ‹å‡ºæ¥è¯¦ç»†åœ°è®²ï¼Œæ¯”å¦‚è¯´é‡è¦çš„ staticã€final ç­‰ç­‰ï¼Œæœ‰é“¾æ¥çš„éƒ½æ˜¯åé¢ä¼šè¯¦ç»†è®²çš„ã€‚â€è½¬åŠ¨äº†ä¸€ä¸‹åƒµç¡¬çš„è„–å­åï¼Œæˆ‘å¯¹ä¸‰å¦¹è¯´ã€‚

â€œé™¤äº†è¿™äº›å…³é”®å­—ï¼ŒJava ä¸­è¿˜æœ‰ä¸¤ä¸ªéå¸¸ç‰¹æ®Šçš„ä¿ç•™å­—ï¼ˆgoto å’Œ constï¼‰ï¼Œå®ƒä»¬ä¸èƒ½åœ¨ç¨‹åºä¸­ä½¿ç”¨ã€‚â€

â€œgoto åœ¨ Cè¯­è¨€ä¸­å«åšâ€˜æ— é™è·³è½¬â€™è¯­å¥ï¼Œåœ¨ Java ä¸­ï¼Œä¸å†ä½¿ç”¨ goto è¯­å¥ï¼Œå› ä¸ºæ— é™è·³è½¬ä¼šç ´åç¨‹åºç»“æ„ã€‚â€

Java ä¸­ç¡®å®å¯ä»¥ä½¿ç”¨æ ‡ç­¾ï¼ˆlabelï¼‰ä¸ break å’Œ continue è¯­å¥ç»“åˆæ¥å®ç°ç±»ä¼¼ goto çš„è·³è½¬åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š

```java
public class LabelDemo {
    public static void main(String[] args) {
        outerLoop:
        for (int i = 0; i < 3; i++) {
            for (int j = 0; j < 3; j++) {
                if (i == 1 && j == 1) {
                    System.out.println("è·³è¿‡ outerLoop ä¸­çš„å½“å‰è¿­ä»£");
                    continue outerLoop;
                }
                System.out.println("i: " + i + ", j: " + j);
            }
        }
        System.out.println("ç»“æŸ");
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸¤å±‚åµŒå¥—å¾ªç¯ã€‚å¤–å±‚å¾ªç¯æœ‰ä¸€ä¸ªåä¸º outerLoop çš„æ ‡ç­¾ã€‚å½“ i ç­‰äº 1 ä¸” j ç­‰äº 1 æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ continue outerLoop è¯­å¥è·³è¿‡å¤–å±‚å¾ªç¯ä¸­çš„å½“å‰è¿­ä»£ã€‚è¿™ä¸ goto çš„è¡Œä¸ºç±»ä¼¼ã€‚

æ¥çœ‹è¾“å‡ºç»“æœï¼š

```
i: 0, j: 0
i: 0, j: 1
i: 0, j: 2
i: 1, j: 0
è·³è¿‡ outerLoop ä¸­çš„å½“å‰è¿­ä»£
i: 2, j: 0
i: 2, j: 1
i: 2, j: 2
ç»“æŸ
```

å°½ç®¡å¯ä»¥ä½¿ç”¨æ ‡ç­¾å®ç°ç±»ä¼¼ goto çš„è·³è½¬åŠŸèƒ½ï¼Œä½†è¿™ç§ç”¨æ³•åœ¨ Java ä¸­ä»ç„¶è¾ƒå°‘è§ï¼Œå› ä¸ºè¿‡åº¦ä½¿ç”¨å¯èƒ½å¯¼è‡´ä»£ç éš¾ä»¥ç†è§£å’Œç»´æŠ¤ã€‚é€šå¸¸å»ºè®®å°½å¯èƒ½ä½¿ç”¨å…¶ä»–æ§åˆ¶ç»“æ„ï¼ˆå¦‚ ifã€for å’Œ while è¯­å¥ï¼‰æ¥ç»„ç»‡ä»£ç ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ if å’Œ for è¯­å¥æ›¿ä»£æ ‡ç­¾è·³è½¬çš„ç¤ºä¾‹ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå¸ƒå°”å˜é‡ skipIteration æ¥å†³å®šæ˜¯å¦è·³è¿‡å¤–å±‚å¾ªç¯çš„å½“å‰è¿­ä»£ï¼š

```java
public class IfForDemo {
    public static void main(String[] args) {
        for (int i = 0; i < 3; i++) {
            boolean skipIteration = false;
            for (int j = 0; j < 3; j++) {
                if (i == 1 && j == 1) {
                    System.out.println("è·³è¿‡å¤–å±‚å¾ªç¯ä¸­çš„å½“å‰è¿­ä»£");
                    skipIteration = true;
                    break;
                }
                System.out.println("i: " + i + ", j: " + j);
            }
            if (skipIteration) {
                continue;
            }
        }
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå½“ i ç­‰äº 1 ä¸” j ç­‰äº 1 æ—¶ï¼Œæˆ‘ä»¬å°† skipIteration è®¾ç½®ä¸º trueï¼Œç„¶åä½¿ç”¨ break è¯­å¥è·³å‡ºå†…å±‚å¾ªç¯ã€‚åœ¨å¤–å±‚å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥ skipIteration å˜é‡çš„å€¼ï¼Œå¦‚æœä¸º trueï¼Œåˆ™è·³è¿‡å¤–å±‚å¾ªç¯çš„å½“å‰è¿­ä»£ã€‚

è¿™ä¸ªç¤ºä¾‹çš„è¾“å‡ºç»“æœä¸ä¹‹å‰çš„ç¤ºä¾‹ç›¸åŒï¼š

```
i: 0, j: 0
i: 0, j: 1
i: 0, j: 2
i: 1, j: 0
è·³è¿‡å¤–å±‚å¾ªç¯ä¸­çš„å½“å‰è¿­ä»£
i: 2, j: 0
i: 2, j: 1
i: 2, j: 2
```

â€œconst åœ¨ [Cè¯­è¨€](https://tobebetterjavaer.com/xuexiluxian/c.html)ä¸­æ˜¯å£°æ˜å¸¸é‡çš„å…³é”®å­—ï¼Œåœ¨ Java ä¸­å¯ä»¥ä½¿ç”¨ public static final ä¸‰ä¸ªå…³é”®å­—çš„ç»„åˆæ¥è¾¾åˆ°å¸¸é‡çš„æ•ˆæœã€‚â€

```java
public class Circle {
    public static final double PI = 3.14159;

    public static double calculateArea(double radius) {
        return PI * radius * radius;
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ public static final å…³é”®å­—ç»„åˆå®šä¹‰äº†ä¸€ä¸ªåä¸º PI çš„å¸¸é‡ã€‚å› ä¸ºå®ƒæ˜¯ public çš„ï¼Œæ‰€ä»¥å…¶ä»–ç±»å¯ä»¥è®¿é—®è¿™ä¸ªå¸¸é‡ã€‚å› ä¸ºå®ƒæ˜¯ static çš„ï¼Œæ‰€ä»¥å®ƒä¸ç±»å…³è”ï¼Œè€Œä¸æ˜¯ç±»çš„å®ä¾‹ã€‚å› ä¸ºå®ƒæ˜¯ final çš„ï¼Œæ‰€ä»¥å®ƒçš„å€¼ä¸èƒ½è¢«æ›´æ”¹ã€‚

â€œå¥½çš„äºŒå“¥ï¼Œæˆ‘äº†è§£äº†ï¼Œä½ ä¼‘æ¯ä¼šï¼Œæˆ‘å†è®°ä¸€è®°ã€‚â€

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 3.2 Javaæ³¨é‡Š

â€œäºŒå“¥ï¼ŒJava ä¸­çš„æ³¨é‡Šå¥½åƒçœŸæ²¡ä»€ä¹ˆå¯è®²çš„ï¼Œæˆ‘å·²ç»æå‰é¢„ä¹ äº†ï¼Œä¸è¿‡æ˜¯å•è¡Œæ³¨é‡Šï¼Œå¤šè¡Œæ³¨é‡Šï¼Œè¿˜æœ‰æ–‡æ¡£æ³¨é‡Šã€‚â€ä¸‰å¦¹çš„è„¸ä¸Šæ³›ç€ç”œç”œçš„ç¬‘å®¹ï¼Œå¥¹ç«Ÿç„¶æå‰é¢„ä¹ äº†æ¥ä¸‹æ¥è¦å­¦ä¹ çš„çŸ¥è¯†ï¼Œæœ‰ä¸€ç§â€œå£«åˆ«ä¸‰æ—¥ï¼Œå½“åˆ®ç›®ç›¸çœ‹â€çš„æ„Ÿè§‰ã€‚

â€œæ³¨é‡Šçš„ç§ç±»ç¡®å®ä¸å¤šï¼Œä½†è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œä¸”å¬å“¥æ¥ç»™ä½ è¯´é“è¯´é“ã€‚â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/fourteen-01.png)

### 01ã€å•è¡Œæ³¨é‡Š

å•è¡Œæ³¨é‡Šé€šå¸¸ç”¨äºè§£é‡Šæ–¹æ³•å†…æŸå•è¡Œä»£ç çš„ä½œç”¨ã€‚

```java
public void method() {
    int age = 18; // age ç”¨äºè¡¨ç¤ºå¹´é¾„
}
```

**ä½†å¦‚æœå†™åœ¨è¡Œå°¾çš„è¯ï¼Œå…¶å®æ˜¯ä¸ç¬¦åˆé˜¿é‡Œå·´å·´çš„å¼€å‘è§„çº¦çš„**ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/fourteen-02.png)

æ­£ç¡®çš„å•è¡Œæ³¨é‡Šå¦‚ä¸Šå›¾ä¸­æ‰€è¯´ï¼Œåœ¨è¢«æ³¨é‡Šè¯­å¥ä¸Šæ–¹å¦èµ·ä¸€è¡Œï¼Œä½¿ç”¨ `//` æ³¨é‡Šã€‚

```java
public void method() {
    // age ç”¨äºè¡¨ç¤ºå¹´é¾„
    int age = 18;
}
```

### 02ã€å¤šè¡Œæ³¨é‡Š

å¤šè¡Œæ³¨é‡Šä½¿ç”¨çš„é¢‘ç‡å…¶å®å¹¶ä¸é«˜ï¼Œé€šå¸¸ç”¨äºè§£é‡Šä¸€æ®µä»£ç çš„ä½œç”¨ã€‚

```java
/*
age ç”¨äºè¡¨ç¤ºå¹´çºª
name ç”¨äºè¡¨ç¤ºå§“å
*/
int age = 18;
String name = "æ²‰é»˜ç‹äºŒ";
```

ä»¥ `/*` å¼€å§‹ï¼Œä»¥ `*/` ç»“æŸï¼Œä½†ä¸å¦‚ç”¨å¤šä¸ª `//` æ¥å¾—ç—›å¿«ï¼Œå› ä¸º `*` å’Œ `/` ä¸åœ¨ä¸€èµ·ï¼Œæ•²èµ·æ¥éº»çƒ¦ã€‚

```java
// age ç”¨äºè¡¨ç¤ºå¹´çºª
// name ç”¨äºè¡¨ç¤ºå§“å
int age = 18;
String name = "æ²‰é»˜ç‹äºŒ";
```

### 03ã€æ–‡æ¡£æ³¨é‡Š

æ–‡æ¡£æ³¨é‡Šå¯ç”¨åœ¨ä¸‰ä¸ªåœ°æ–¹ï¼Œç±»ã€å­—æ®µå’Œæ–¹æ³•ï¼Œç”¨æ¥è§£é‡Šå®ƒä»¬æ˜¯å¹²å˜›çš„ã€‚

```java
/**
 * å¾®ä¿¡æœç´¢ã€Œæ²‰é»˜ç‹äºŒã€ï¼Œå›å¤ Java
 */
public class Demo {
    /**
     * å§“å
     */
    private int age;

    /**
     * main æ–¹æ³•ä½œä¸ºç¨‹åºçš„å…¥å£
     *
     * @param args å‚æ•°
     */
    public static void main(String[] args) {

    }
}
```

PSï¼šåœ¨ Intellij IDEA ä¸­ï¼ŒæŒ‰ä¸‹ `/**` åæ•²ä¸‹å›è½¦é”®å°±å¯ä»¥è‡ªåŠ¨æ·»åŠ æ–‡æ¡£æ³¨é‡Šçš„æ ¼å¼ï¼Œ`*/` æ˜¯è‡ªåŠ¨è¡¥å…¨çš„ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•é€šè¿‡ javadoc å‘½ä»¤ç”Ÿæˆä»£ç æ–‡æ¡£ã€‚

**ç¬¬ä¸€æ­¥**ï¼Œåœ¨è¯¥ç±»æ–‡ä»¶ä¸Šå³é”®ï¼Œæ‰¾åˆ°ã€ŒOpen in Terminalã€ å¯ä»¥æ‰“å¼€å‘½ä»¤è¡Œçª—å£ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/fourteen-03.png)

**ç¬¬äºŒæ­¥**ï¼Œæ‰§è¡Œ javadoc å‘½ä»¤ `javadoc Demo.java -encoding utf-8`ã€‚`-encoding utf-8` å¯ä»¥ä¿è¯ä¸­æ–‡ä¸å‘ç”Ÿä¹±ç ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/fourteen-04.png)

**ç¬¬ä¸‰æ­¥ï¼Œ**æ‰§è¡Œ `ls -l` å‘½ä»¤å°±å¯ä»¥çœ‹åˆ°ç”Ÿæˆä»£ç æ–‡æ¡£æ—¶äº§ç”Ÿçš„æ–‡ä»¶ï¼Œä¸»è¦æ˜¯ä¸€äº›å¯ä»¥ç»„æˆç½‘é¡µçš„ htmlã€js å’Œ css æ–‡ä»¶ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/fourteen-05.png)

**ç¬¬å››æ­¥**ï¼Œæ‰§è¡Œ `open index.html` å‘½ä»¤å¯ä»¥é€šè¿‡é»˜è®¤çš„æµè§ˆå™¨æ‰“å¼€æ–‡æ¡£æ³¨é‡Šã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/fourteen-06.png)

ç‚¹å‡»ã€ŒDemoã€ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°è¯¥ç±»æ›´å…·ä½“çš„æ³¨é‡Šæ–‡æ¡£ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/fourteen-07.png)

### 04ã€æ–‡æ¡£æ³¨é‡Šçš„æ³¨æ„äº‹é¡¹

1ï¼‰`javadoc` å‘½ä»¤åªèƒ½ä¸º public å’Œ protected ä¿®é¥°çš„å­—æ®µã€æ–¹æ³•å’Œç±»ç”Ÿæˆæ–‡æ¡£ã€‚

default å’Œ private ä¿®é¥°çš„å­—æ®µå’Œæ–¹æ³•çš„æ³¨é‡Šå°†ä¼šè¢«å¿½ç•¥æ‰ã€‚å› ä¸ºæˆ‘ä»¬æœ¬æ¥å°±ä¸å¸Œæœ›è¿™äº›å­—æ®µå’Œæ–¹æ³•æš´éœ²ç»™è°ƒç”¨è€…ã€‚

å¦‚æœç±»ä¸æ˜¯ public çš„è¯ï¼Œjavadoc ä¼šæ‰§è¡Œå¤±è´¥ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/fourteen-08.png)

2ï¼‰æ–‡æ¡£æ³¨é‡Šä¸­å¯ä»¥åµŒå…¥ä¸€äº› HTML æ ‡è®°ï¼Œæ¯”å¦‚è¯´æ®µè½æ ‡è®° `<p>`ï¼Œè¶…é“¾æ¥æ ‡è®° `<a></a>` ç­‰ç­‰ï¼Œä½†ä¸è¦ä½¿ç”¨æ ‡é¢˜æ ‡è®°ï¼Œæ¯”å¦‚è¯´ `<h1>`ï¼Œå› ä¸º javadoc ä¼šæ’å…¥è‡ªå·±çš„æ ‡é¢˜ï¼Œå®¹æ˜“å‘ç”Ÿå†²çªã€‚

3ï¼‰æ–‡æ¡£æ³¨é‡Šä¸­å¯ä»¥æ’å…¥ä¸€äº› `@` æ³¨è§£ï¼Œæ¯”å¦‚è¯´ `@see` å¼•ç”¨å…¶ä»–ç±»ï¼Œ`@version` ç‰ˆæœ¬å·ï¼Œ`@param` å‚æ•°æ ‡è¯†ç¬¦ï¼Œ`@author` ä½œè€…æ ‡è¯†ç¬¦ï¼Œ`@deprecated` å·²åºŸå¼ƒæ ‡è¯†ç¬¦ï¼Œç­‰ç­‰ã€‚

### 05ã€æ³¨é‡Šè§„çº¦

1ï¼‰ç±»ã€å­—æ®µã€æ–¹æ³•å¿…é¡»ä½¿ç”¨æ–‡æ¡£æ³¨é‡Šï¼Œä¸èƒ½ä½¿ç”¨å•è¡Œæ³¨é‡Šå’Œå¤šè¡Œæ³¨é‡Šã€‚å› ä¸ºæ³¨é‡Šæ–‡æ¡£åœ¨ IDE ç¼–è¾‘çª—å£ä¸­å¯ä»¥æ‚¬æµ®æç¤ºï¼Œæé«˜ç¼–ç æ•ˆç‡ã€‚

æ¯”å¦‚è¯´ï¼Œåœ¨ä½¿ç”¨ [String ç±»](https://tobebetterjavaer.com/string/immutable.html)çš„æ—¶å€™ï¼Œé¼ æ ‡æ‚¬åœåœ¨ String ä¸Šæ—¶å¯ä»¥å¾—åˆ°ä»¥ä¸‹æç¤ºã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/fourteen-09.png)

2ï¼‰æ‰€æœ‰çš„[æŠ½è±¡æ–¹æ³•](https://tobebetterjavaer.com/oo/abstract.html)(åŒ…æ‹¬æ¥å£ä¸­çš„æ–¹æ³•)å¿…é¡»è¦ç”¨ Javadoc æ³¨é‡Šã€é™¤äº†è¿”å›å€¼ã€å‚æ•°ã€ å¼‚å¸¸è¯´æ˜å¤–ï¼Œè¿˜å¿…é¡»æŒ‡å‡ºè¯¥æ–¹æ³•åšä»€ä¹ˆäº‹æƒ…ï¼Œå®ç°ä»€ä¹ˆåŠŸèƒ½ã€‚

3ï¼‰æ‰€æœ‰çš„ç±»éƒ½å¿…é¡»æ·»åŠ åˆ›å»ºè€…å’Œåˆ›å»ºæ—¥æœŸã€‚

Intellij IDEA ä¸­å¯ä»¥åœ¨ã€ŒFile and Code Templatesã€ä¸­è®¾ç½®ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/overview/fourteen-10.png)

è¯­æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š

```
/**
* å¾®ä¿¡æœç´¢ã€Œæ²‰é»˜ç‹äºŒã€ï¼Œå›å¤ Java
* @author æ²‰é»˜ç‹äºŒ
* @date ${DATE}
*/
```

è®¾ç½®å¥½åï¼Œåœ¨æ–°å»ºä¸€ä¸ªç±»çš„æ—¶å€™å°±å¯ä»¥è‡ªåŠ¨ç”Ÿæˆäº†ã€‚

```java
/**
 * å¾®ä¿¡æœç´¢ã€Œæ²‰é»˜ç‹äºŒã€ï¼Œå›å¤ Java
 *
 * @author æ²‰é»˜ç‹äºŒ
 * @date 2020/11/16
 */
public class Test {
}
```

4ï¼‰æ‰€æœ‰çš„[æšä¸¾](https://tobebetterjavaer.com/basic-extra-meal/enum.html)ç±»å‹å­—æ®µå¿…é¡»è¦æœ‰æ³¨é‡Šï¼Œè¯´æ˜æ¯ä¸ªæ•°æ®é¡¹çš„ç”¨é€”ã€‚

5ï¼‰ä»£ç ä¿®æ”¹çš„åŒæ—¶ï¼Œæ³¨é‡Šä¹Ÿè¦è¿›è¡Œç›¸åº”çš„ä¿®æ”¹ã€‚

â€œå¥½äº†ï¼Œä¸‰å¦¹ï¼Œå…³äº Java ä¸­çš„æ³¨é‡Šå°±å…ˆè¯´è¿™ä¹ˆå¤šå§ã€‚â€è½¬åŠ¨äº†ä¸€ä¸‹åƒµç¡¬çš„è„–å­åï¼Œæˆ‘å¯¹ä¸‰å¦¹è¯´ã€‚â€œè®°ä½ä¸€ç‚¹ï¼Œæ³¨é‡Šæ˜¯ç¨‹åºå›ºæœ‰çš„ä¸€éƒ¨åˆ†ã€‚â€

- ç¬¬ä¸€ã€æ³¨é‡Šè¦èƒ½å¤Ÿå‡†ç¡®åæ˜ è®¾è®¡æ€æƒ³å’Œä»£ç é€»è¾‘;
- ç¬¬äºŒã€æ³¨é‡Šè¦èƒ½å¤Ÿæè¿°ä¸šåŠ¡å« ä¹‰ï¼Œä½¿åˆ«çš„ç¨‹åºå‘˜èƒ½å¤Ÿè¿…é€Ÿäº†è§£åˆ°ä»£ç èƒŒåçš„ä¿¡æ¯ã€‚

å®Œå…¨æ²¡æœ‰æ³¨é‡Šçš„å¤§æ®µä»£ç å¯¹äºé˜…è¯»è€…å½¢åŒ å¤©ä¹¦ï¼Œæ³¨é‡Šæ˜¯ç»™è‡ªå·±çœ‹çš„ï¼Œå³ä½¿éš”å¾ˆé•¿æ—¶é—´ï¼Œä¹Ÿèƒ½æ¸…æ™°ç†è§£å½“æ—¶çš„æ€è·¯;æ³¨é‡Šä¹Ÿæ˜¯ç»™ç»§ä»»è€…çœ‹ çš„ï¼Œä½¿å…¶èƒ½å¤Ÿå¿«é€Ÿæ¥æ›¿è‡ªå·±çš„å·¥ä½œã€‚

-----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 3.3 Javaæ•°æ®ç±»å‹

â€œJava æ˜¯ä¸€ç§é™æ€ç±»å‹çš„ç¼–ç¨‹è¯­è¨€ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰å˜é‡å¿…é¡»åœ¨ä½¿ç”¨ä¹‹å‰å£°æ˜å¥½ï¼Œä¹Ÿå°±æ˜¯å¿…é¡»å¾—å…ˆæŒ‡å®šå˜é‡çš„ç±»å‹å’Œåç§°ã€‚â€æˆ‘å¸äº†ä¸€å£éº¦é¦™å¯å¯å¥¶èŒ¶åå¯¹ä¸‰å¦¹è¯´ã€‚

Java ä¸­çš„æ•°æ®ç±»å‹å¯åˆ†ä¸º 2 ç§ï¼š

1ï¼‰**åŸºæœ¬æ•°æ®ç±»å‹**ã€‚

åŸºæœ¬æ•°æ®ç±»å‹æ˜¯ Java è¯­è¨€æ“ä½œæ•°æ®çš„åŸºç¡€ï¼ŒåŒ…æ‹¬ booleanã€charã€byteã€shortã€intã€longã€float å’Œ doubleï¼Œå…± 8 ç§ã€‚

2ï¼‰**å¼•ç”¨æ•°æ®ç±»å‹**ã€‚

é™¤äº†åŸºæœ¬æ•°æ®ç±»å‹ä»¥å¤–çš„ç±»å‹ï¼Œéƒ½æ˜¯æ‰€è°“çš„å¼•ç”¨ç±»å‹ã€‚å¸¸è§çš„æœ‰[æ•°ç»„](https://tobebetterjavaer.com/array/array.html)ï¼ˆå¯¹ï¼Œæ²¡é”™ï¼Œæ•°ç»„æ˜¯å¼•ç”¨ç±»å‹ï¼Œåé¢æˆ‘ä»¬ä¼šè®²ï¼‰ã€classï¼ˆä¹Ÿå°±æ˜¯[ç±»](https://tobebetterjavaer.com/oo/object-class.html)ï¼‰ï¼Œä»¥åŠ[æ¥å£](https://tobebetterjavaer.com/oo/interface.html)ï¼ˆæŒ‡å‘çš„æ˜¯å®ç°æ¥å£çš„ç±»çš„å¯¹è±¡ï¼‰ã€‚

æ¥ä¸ªæ€ç»´å¯¼å›¾ï¼Œæ„Ÿå—ä¸‹ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-grammar/nine-01.png)

[å˜é‡](https://tobebetterjavaer.com/oo/var.html)å¯ä»¥åˆ†ä¸ºå±€éƒ¨å˜é‡ã€æˆå‘˜å˜é‡ã€é™æ€å˜é‡ã€‚

å½“å˜é‡æ˜¯å±€éƒ¨å˜é‡çš„æ—¶å€™ï¼Œå¿…é¡»å¾—å…ˆåˆå§‹åŒ–ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¸å…è®¸ä½ ä½¿ç”¨å®ƒã€‚æ‹¿ int æ¥ä¸¾ä¾‹å§ï¼Œçœ‹ä¸‹å›¾ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-grammar/nine-02.png)

å½“å˜é‡æ˜¯æˆå‘˜å˜é‡æˆ–è€…é™æ€å˜é‡æ—¶ï¼Œå¯ä»¥ä¸è¿›è¡Œåˆå§‹åŒ–ï¼Œå®ƒä»¬ä¼šæœ‰ä¸€ä¸ªé»˜è®¤å€¼ï¼Œä»ç„¶ä»¥ int ä¸ºä¾‹ï¼Œæ¥çœ‹ä»£ç ï¼š

```java
/**
 * @author å¾®ä¿¡æœã€Œæ²‰é»˜ç‹äºŒã€ï¼Œå›å¤å…³é”®å­— PDF
 */
public class LocalVar {
    private int a;
    static int b;

    public static void main(String[] args) {
        LocalVar lv = new LocalVar();
        System.out.println(lv.a);
        System.out.println(b);
    }
}
```

æ¥çœ‹è¾“å‡ºç»“æœï¼š

```
0
0
```

ç§è§æ²¡ï¼Œint ä½œä¸ºæˆå‘˜å˜é‡æ—¶æˆ–è€…é™æ€å˜é‡æ—¶çš„é»˜è®¤å€¼æ˜¯ 0ã€‚é‚£ä¸åŒçš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ˜¯æœ‰ä¸åŒçš„é»˜è®¤å€¼å’Œå¤§å°çš„ï¼Œæ¥ä¸ªè¡¨æ ¼æ„Ÿå—ä¸‹ã€‚

| æ•°æ®ç±»å‹ | é»˜è®¤å€¼   | å¤§å°   |
| -------- | -------- | ------ |
| boolean  | false    | 1 æ¯”ç‰¹ |
| char     | '\u0000' | 2 å­—èŠ‚ |
| byte     | 0        | 1 å­—èŠ‚ |
| short    | 0        | 2 å­—èŠ‚ |
| int      | 0        | 4 å­—èŠ‚ |
| long     | 0L       | 8 å­—èŠ‚ |
| float    | 0.0f     | 4 å­—èŠ‚ |
| double   | 0.0      | 8 å­—èŠ‚ |

### 01ã€æ¯”ç‰¹å’Œå­—èŠ‚

é‚£ä¸‰å¦¹å¯èƒ½è¦é—®ï¼Œâ€œæ¯”ç‰¹å’Œå­—èŠ‚æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿâ€

æ¯”ç‰¹å¸ï¼ˆBitcoinï¼‰å¬è¯´è¿‡å§ï¼Ÿå­—èŠ‚è·³åŠ¨ï¼ˆByte Danceï¼‰å¬è¯´è¿‡å§ï¼Ÿè¿™äº›åå­—å½“ç„¶ä¸æ˜¯ä¹±èµ·çš„ï¼Œç¡®å®å’Œæ¯”ç‰¹ã€å­—èŠ‚æœ‰å…³ç³»ã€‚

#### **1ï¼‰bitï¼ˆæ¯”ç‰¹ï¼‰**

æ¯”ç‰¹ä½œä¸ºä¿¡æ¯æŠ€æœ¯çš„æœ€åŸºæœ¬å­˜å‚¨å•ä½ï¼Œéå¸¸å°ï¼Œä½†å¤§åé¼é¼çš„æ¯”ç‰¹å¸å°±æ˜¯ä»¥æ­¤å‘½åçš„ï¼Œå®ƒçš„ç®€å†™ä¸ºå°å†™å­—æ¯â€œbâ€ã€‚

å¤§å®¶éƒ½çŸ¥é“ï¼Œè®¡ç®—æœºæ˜¯ä»¥äºŒè¿›åˆ¶å­˜å‚¨æ•°æ®çš„ï¼ŒäºŒè¿›åˆ¶çš„ä¸€ä½ï¼Œå°±æ˜¯ 1 æ¯”ç‰¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯”ç‰¹è¦ä¹ˆä¸º 0 è¦ä¹ˆä¸º 1ã€‚

#### **2ï¼‰Byteï¼ˆå­—èŠ‚ï¼‰**

é€šå¸¸æ¥è¯´ï¼Œä¸€ä¸ªè‹±æ–‡å­—ç¬¦æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªä¸­æ–‡å­—ç¬¦æ˜¯ä¸¤ä¸ªå­—èŠ‚ã€‚å­—èŠ‚ä¸æ¯”ç‰¹çš„æ¢ç®—å…³ç³»æ˜¯ï¼š1 å­—èŠ‚ = 8 æ¯”ç‰¹ã€‚

åœ¨å¾€ä¸Šçš„å•ä½å°±æ˜¯ KBï¼Œå¹¶ä¸æ˜¯ 1000 å­—èŠ‚ï¼Œå› ä¸ºè®¡ç®—æœºåªè®¤è¯†äºŒè¿›åˆ¶ï¼Œå› æ­¤æ˜¯ 2 çš„ 10 æ¬¡æ–¹ï¼Œä¹Ÿå°±æ˜¯ 1024 ä¸ªå­—èŠ‚ã€‚

ï¼ˆç»ˆäºçŸ¥é“ 1024 å’Œç¨‹åºå‘˜çš„å…³ç³»äº†å§ï¼Ÿç‹—å¤´ä¿å‘½ï¼‰

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-grammar/nine-03.png)

### 02ã€åŸºæœ¬æ•°æ®ç±»å‹

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥è¯¦ç»†åœ°äº†è§£ä¸€ä¸‹ 8 ç§åŸºæœ¬æ•°æ®ç±»å‹ã€‚

#### 1ï¼‰å¸ƒå°”

å¸ƒå°”ï¼ˆbooleanï¼‰ä»…ç”¨äºå­˜å‚¨ä¸¤ä¸ªå€¼ï¼štrue å’Œ falseï¼Œä¹Ÿå°±æ˜¯çœŸå’Œå‡ï¼Œé€šå¸¸ç”¨äºæ¡ä»¶çš„åˆ¤æ–­ã€‚ä»£ç ç¤ºä¾‹ï¼š

```java
boolean hasMoney = true;
boolean hasGirlFriend = false;
```

#### 2ï¼‰byte

ä¸€ä¸ªå­—èŠ‚å¯ä»¥è¡¨ç¤º 2^8 = 256 ä¸ªä¸åŒçš„å€¼ã€‚ç”±äº byte æ˜¯æœ‰ç¬¦å·çš„ï¼Œå®ƒçš„å€¼å¯ä»¥æ˜¯è´Ÿæ•°æˆ–æ­£æ•°ï¼Œå…¶å–å€¼èŒƒå›´æ˜¯ -128 åˆ° 127ï¼ˆåŒ…æ‹¬ -128 å’Œ 127ï¼‰ã€‚

åœ¨ç½‘ç»œä¼ è¾“ã€å¤§æ–‡ä»¶è¯»å†™æ—¶ï¼Œä¸ºäº†èŠ‚çœç©ºé—´ï¼Œå¸¸ç”¨å­—èŠ‚æ¥ä½œä¸ºæ•°æ®çš„ä¼ è¾“æ–¹å¼ã€‚ä»£ç ç¤ºä¾‹ï¼š

```java
byte b; // å£°æ˜ä¸€ä¸ª byte ç±»å‹å˜é‡
b = 10; // å°†å€¼ 10 èµ‹ç»™å˜é‡ b
byte c = -100; // å£°æ˜å¹¶åˆå§‹åŒ–ä¸€ä¸ª byte ç±»å‹å˜é‡ cï¼Œèµ‹å€¼ä¸º -100
```

#### 3ï¼‰short

short çš„å–å€¼èŒƒå›´åœ¨ -32,768 å’Œ 32,767 ä¹‹é—´ï¼ŒåŒ…å« 32,767ã€‚ä»£ç ç¤ºä¾‹ï¼š

```java
short s; // å£°æ˜ä¸€ä¸ª short ç±»å‹å˜é‡
s = 1000; // å°†å€¼ 1000 èµ‹ç»™å˜é‡ s
short t = -2000; // å£°æ˜å¹¶åˆå§‹åŒ–ä¸€ä¸ª short ç±»å‹å˜é‡ tï¼Œèµ‹å€¼ä¸º -2000
```

å®é™…å¼€å‘ä¸­ï¼Œshort æ¯”è¾ƒå°‘ç”¨ï¼Œæ•´å‹ç”¨ int å°± OKã€‚

#### 3ï¼‰int

int çš„å–å€¼èŒƒå›´åœ¨ -2,147,483,648ï¼ˆ-2 ^ 31ï¼‰å’Œ 2,147,483,647ï¼ˆ2 ^ 31 -1ï¼‰ï¼ˆå«ï¼‰ä¹‹é—´ã€‚å¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œæ•´å‹æ•°æ®å°±ç”¨ intã€‚ä»£ç ç¤ºä¾‹ï¼š

```java
int i; // å£°æ˜ä¸€ä¸ª int ç±»å‹å˜é‡
i = 1000000; // å°†å€¼ 1000000 èµ‹ç»™å˜é‡ i
int j = -2000000; // å£°æ˜å¹¶åˆå§‹åŒ–ä¸€ä¸ª int ç±»å‹å˜é‡ jï¼Œèµ‹å€¼ä¸º -2000000
```

#### 5ï¼‰long

long çš„å–å€¼èŒƒå›´åœ¨ -9,223,372,036,854,775,808(-2^63) å’Œ 9,223,372,036,854,775,807(2^63 -1)ï¼ˆå«ï¼‰ä¹‹é—´ã€‚å¦‚æœ int å­˜å‚¨ä¸ä¸‹ï¼Œå°±ç”¨ longã€‚ä»£ç ç¤ºä¾‹ï¼š

```java
long l; // å£°æ˜ä¸€ä¸ª long ç±»å‹å˜é‡
l = 100000000000L; // å°†å€¼ 100000000000L èµ‹ç»™å˜é‡ lï¼ˆæ³¨æ„è¦åŠ ä¸Š L åç¼€ï¼‰
long m = -20000000000L; // å£°æ˜å¹¶åˆå§‹åŒ–ä¸€ä¸ª long ç±»å‹å˜é‡ mï¼Œèµ‹å€¼ä¸º -20000000000L
```

ä¸ºäº†å’Œ int ä½œåŒºåˆ†ï¼Œlong å‹å˜é‡åœ¨å£°æ˜çš„æ—¶å€™ï¼Œæœ«å°¾è¦å¸¦ä¸Šå¤§å†™çš„â€œLâ€ã€‚ä¸ç”¨å°å†™çš„â€œlâ€ï¼Œæ˜¯å› ä¸ºå°å†™çš„â€œlâ€å®¹æ˜“å’Œæ•°å­—â€œ1â€æ··æ·†ã€‚

#### 6ï¼‰float

float æ˜¯å•ç²¾åº¦çš„æµ®ç‚¹æ•°ï¼ˆå•ç²¾åº¦æµ®ç‚¹æ•°çš„æœ‰æ•ˆæ•°å­—å¤§çº¦ä¸º 6 åˆ° 7 ä½ï¼‰ï¼Œ32 ä½ï¼ˆ4 å­—èŠ‚ï¼‰ï¼Œéµå¾ª IEEE 754ï¼ˆäºŒè¿›åˆ¶æµ®ç‚¹æ•°ç®—æœ¯æ ‡å‡†ï¼‰ï¼Œå–å€¼èŒƒå›´ä¸º 1.4E-45 åˆ° 3.4E+38ã€‚float ä¸é€‚åˆç”¨äºç²¾ç¡®çš„æ•°å€¼ï¼Œæ¯”å¦‚è¯´é‡‘é¢ã€‚ä»£ç ç¤ºä¾‹ï¼š

```java
float f; // å£°æ˜ä¸€ä¸ª float ç±»å‹å˜é‡
f = 3.14159f; // å°†å€¼ 3.14159f èµ‹ç»™å˜é‡ fï¼ˆæ³¨æ„è¦åŠ ä¸Š f åç¼€ï¼‰
float g = -2.71828f; // å£°æ˜å¹¶åˆå§‹åŒ–ä¸€ä¸ª float ç±»å‹å˜é‡ gï¼Œèµ‹å€¼ä¸º -2.71828f
```

ä¸ºäº†å’Œ double ä½œåŒºåˆ†ï¼Œfloat å‹å˜é‡åœ¨å£°æ˜çš„æ—¶å€™ï¼Œæœ«å°¾è¦å¸¦ä¸Šå°å†™çš„â€œfâ€ã€‚ä¸éœ€è¦ä½¿ç”¨å¤§å†™çš„â€œFâ€ï¼Œæ˜¯å› ä¸ºå°å†™çš„â€œfâ€å¾ˆå®¹æ˜“è¾¨åˆ«ã€‚

#### 7ï¼‰double

double æ˜¯åŒç²¾åº¦æµ®ç‚¹æ•°ï¼ˆåŒç²¾åº¦æµ®ç‚¹æ•°çš„æœ‰æ•ˆæ•°å­—å¤§çº¦ä¸º 15 åˆ° 17 ä½ï¼‰ï¼Œå  64 ä½ï¼ˆ8 å­—èŠ‚ï¼‰ï¼Œä¹Ÿéµå¾ª IEEE 754 æ ‡å‡†ï¼Œå–å€¼èŒƒå›´å¤§çº¦ Â±4.9E-324 åˆ° Â±1.7976931348623157E308ã€‚double åŒæ ·ä¸é€‚åˆç”¨äºç²¾ç¡®çš„æ•°å€¼ï¼Œæ¯”å¦‚è¯´é‡‘é¢ã€‚

ä»£ç ç¤ºä¾‹ï¼š

```java
double myDouble = 3.141592653589793;
```

åœ¨è¿›è¡Œé‡‘èè®¡ç®—æˆ–éœ€è¦ç²¾ç¡®å°æ•°è®¡ç®—çš„åœºæ™¯ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ [BigDecimal ç±»](https://tobebetterjavaer.com/basic-grammar/bigdecimal-biginteger.html)æ¥é¿å…æµ®ç‚¹æ•°èˆå…¥è¯¯å·®ã€‚BigDecimal å¯ä»¥è¡¨ç¤ºä¸€ä¸ªä»»æ„å¤§å°ä¸”ç²¾åº¦å®Œå…¨å‡†ç¡®çš„æµ®ç‚¹æ•°ã€‚

> åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¦‚æœä¸æ˜¯ç‰¹åˆ«å¤§çš„é‡‘é¢ï¼ˆç²¾ç¡®åˆ° 0.01 å…ƒï¼Œä¹Ÿå°±æ˜¯ä¸€åˆ†é’±ï¼‰ï¼Œä¸€èˆ¬å»ºè®®ä¹˜ä»¥ 100 è½¬æˆæ•´å‹è¿›è¡Œå¤„ç†ã€‚

#### 8ï¼‰char

char ç”¨äºè¡¨ç¤º Unicode å­—ç¬¦ï¼Œå  16 ä½ï¼ˆ2 å­—èŠ‚ï¼‰çš„å­˜å‚¨ç©ºé—´ï¼Œå–å€¼èŒƒå›´ä¸º 0 åˆ° 65,535ã€‚

ä»£ç ç¤ºä¾‹ï¼š

```java
char letterA = 'A'; // ç”¨è‹±æ–‡çš„å•å¼•å·åŒ…è£¹ä½ã€‚
```

æ³¨æ„ï¼Œå­—ç¬¦å­—é¢é‡åº”è¯¥ç”¨å•å¼•å·ï¼ˆ''ï¼‰åŒ…å›´ï¼Œè€Œä¸æ˜¯åŒå¼•å·ï¼ˆ""ï¼‰ï¼Œå› ä¸º[åŒå¼•å·è¡¨ç¤ºå­—ç¬¦ä¸²å­—é¢é‡](https://tobebetterjavaer.com/string/constant-pool.html)ã€‚

### 03ã€å•ç²¾åº¦å’ŒåŒç²¾åº¦

å•ç²¾åº¦ï¼ˆsingle-precisionï¼‰å’ŒåŒç²¾åº¦ï¼ˆdouble-precisionï¼‰æ˜¯æŒ‡ä¸¤ç§ä¸åŒç²¾åº¦çš„æµ®ç‚¹æ•°è¡¨ç¤ºæ–¹æ³•ã€‚

å•ç²¾åº¦æ˜¯è¿™æ ·çš„æ ¼å¼ï¼Œ1 ä½ç¬¦å·ï¼Œ8 ä½æŒ‡æ•°ï¼Œ23 ä½å°æ•°ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-grammar/nine-04.png)

å•ç²¾åº¦æµ®ç‚¹æ•°é€šå¸¸å ç”¨ 32 ä½ï¼ˆ4 å­—èŠ‚ï¼‰å­˜å‚¨ç©ºé—´ã€‚æ•°å€¼èŒƒå›´å¤§çº¦æ˜¯ Â±1.4E-45 åˆ° Â±3.4028235E38ï¼Œç²¾åº¦å¤§çº¦ä¸º 6 åˆ° 9 ä½æœ‰æ•ˆæ•°å­—ã€‚

åŒç²¾åº¦æ˜¯è¿™æ ·çš„æ ¼å¼ï¼Œ1 ä½ç¬¦å·ï¼Œ11 ä½æŒ‡æ•°ï¼Œ52 ä¸ºå°æ•°ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-grammar/nine-05.png)

åŒç²¾åº¦æµ®ç‚¹æ•°é€šå¸¸å ç”¨ 64 ä½ï¼ˆ8 å­—èŠ‚ï¼‰å­˜å‚¨ç©ºé—´ï¼Œæ•°å€¼èŒƒå›´å¤§çº¦æ˜¯ Â±4.9E-324 åˆ° Â±1.7976931348623157E308ï¼Œç²¾åº¦å¤§çº¦ä¸º 15 åˆ° 17 ä½æœ‰æ•ˆæ•°å­—ã€‚

è®¡ç®—ç²¾åº¦å–å†³äºå°æ•°ä½ï¼ˆå°¾æ•°ï¼‰ã€‚å°æ•°ä½è¶Šå¤šï¼Œåˆ™èƒ½è¡¨ç¤ºçš„æ•°è¶Šå¤§ï¼Œé‚£ä¹ˆè®¡ç®—ç²¾åº¦åˆ™è¶Šé«˜ã€‚

ä¸€ä¸ªæ•°ç”±è‹¥å¹²ä½æ•°å­—ç»„æˆï¼Œå…¶ä¸­å½±å“æµ‹é‡ç²¾åº¦çš„æ•°å­—ç§°ä½œæœ‰æ•ˆæ•°å­—ï¼Œä¹Ÿç§°æœ‰æ•ˆæ•°ä½ã€‚æœ‰æ•ˆæ•°å­—æŒ‡ç§‘å­¦è®¡ç®—ä¸­ç”¨ä»¥è¡¨ç¤ºä¸€ä¸ªæµ®ç‚¹æ•°ç²¾åº¦çš„é‚£äº›æ•°å­—ã€‚ä¸€èˆ¬åœ°ï¼ŒæŒ‡ä¸€ä¸ªç”¨å°æ•°å½¢å¼è¡¨ç¤ºçš„æµ®ç‚¹æ•°ä¸­ï¼Œä»ç¬¬ä¸€ä¸ªéé›¶çš„æ•°å­—ç®—èµ·çš„æ‰€æœ‰æ•°å­—ã€‚å¦‚ 1.24 å’Œ 0.00124 çš„æœ‰æ•ˆæ•°å­—éƒ½æœ‰ 3 ä½ã€‚

ä»¥ä¸‹æ˜¯ç¡®å®šæœ‰æ•ˆæ•°å­—çš„ä¸€äº›åŸºæœ¬è§„åˆ™ï¼š

- éé›¶æ•°å­—æ€»æ˜¯æœ‰æ•ˆçš„ã€‚
- ä½äºä¸¤ä¸ªéé›¶æ•°å­—ä¹‹é—´çš„é›¶æ˜¯æœ‰æ•ˆçš„ã€‚
- å¯¹äºå°æ•°ï¼Œä»å·¦ä¾§å¼€å§‹çš„ç¬¬ä¸€ä¸ªéé›¶æ•°å­—ä¹‹å‰çš„é›¶æ˜¯æ— æ•ˆçš„ã€‚
- å¯¹äºæ•´æ•°ï¼Œä»å³ä¾§å¼€å§‹çš„ç¬¬ä¸€ä¸ªéé›¶æ•°å­—ä¹‹åçš„é›¶æ˜¯æ— æ•ˆçš„ã€‚

ä¸‹é¢æ˜¯ä¸€äº›ç¤ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•ç¡®å®šæœ‰æ•ˆæ•°å­—ï¼š

- 1234ï¼š4 ä¸ªæœ‰æ•ˆæ•°å­—ï¼ˆæ‰€æœ‰æ•°å­—éƒ½æ˜¯éé›¶æ•°å­—ï¼‰
- 1002ï¼š4 ä¸ªæœ‰æ•ˆæ•°å­—ï¼ˆé›¶ä½äºä¸¤ä¸ªéé›¶æ•°å­—ä¹‹é—´ï¼‰
- 0.00234ï¼š3 ä¸ªæœ‰æ•ˆæ•°å­—ï¼ˆä»å·¦ä¾§å¼€å§‹çš„å‰ä¸¤ä¸ªé›¶æ˜¯æ— æ•ˆçš„ï¼‰
- 1200ï¼š2 ä¸ªæœ‰æ•ˆæ•°å­—ï¼ˆä»å³ä¾§å¼€å§‹çš„ä¸¤ä¸ªé›¶æ˜¯æ— æ•ˆçš„ï¼‰

### 04ã€int å’Œ char ç±»å‹äº’è½¬

int å’Œ char ä¹‹é—´æ¯”è¾ƒç‰¹æ®Šï¼Œå¯ä»¥äº’è½¬ï¼Œä¹Ÿä¼šåœ¨ä»¥åçš„å­¦ä¹ å½“ä¸­ç»å¸¸é‡åˆ°ã€‚

1ï¼‰å¯ä»¥é€šè¿‡[å¼ºåˆ¶ç±»å‹è½¬æ¢](https://tobebetterjavaer.com/basic-grammar/type-cast.html)å°†æ•´å‹ int è½¬æ¢ä¸ºå­—ç¬¦ charã€‚

```java
int value_int = 65;
char value_char  = (char) value_int;
System.out.println(value_char);
```

è¾“å‡º `A`(å…¶ [ASCII å€¼](https://tobebetterjavaer.com/basic-extra-meal/java-unicode.html)å¯ä»¥é€šè¿‡æ•´æ•° 65 æ¥è¡¨ç¤º)ã€‚

2ï¼‰å¯ä»¥ä½¿ç”¨ `Character.forDigit()` æ–¹æ³•å°†æ•´å‹ int è½¬æ¢ä¸ºå­—ç¬¦ charï¼Œå‚æ•° radix ä¸ºåŸºæ•°ï¼Œåè¿›åˆ¶ä¸º 10ï¼Œåå…­è¿›åˆ¶ä¸º 16ã€‚ã€‚

```java
int radix = 10;
int value_int = 6;
char value_char = Character.forDigit(value_int , radix);
System.out.println(value_char );
```

Character ä¸º char çš„åŒ…è£…å™¨ç±»å‹ã€‚æˆ‘ä»¬éšåä¼šè®²ã€‚

3ï¼‰å¯ä»¥ä½¿ç”¨ int çš„åŒ…è£…å™¨ç±»å‹ Integer çš„ `toString()` æ–¹æ³•+String çš„ `charAt()` æ–¹æ³•è½¬æˆ charã€‚

```java
int value_int = 1;
char value_char = Integer.toString(value_int).charAt(0);
System.out.println(value_char );
```

4ï¼‰char è½¬ int

å½“ç„¶äº†ï¼Œå¦‚æœåªæ˜¯ç®€å•çš„ char è½¬ intï¼Œç›´æ¥èµ‹å€¼å°±å¯ä»¥äº†ã€‚

```java
int a = 'a';
```

å› ä¸ºå‘ç”Ÿäº†[è‡ªåŠ¨ç±»å‹è½¬æ¢](https://tobebetterjavaer.com/basic-grammar/type-cast.html)ï¼Œåé¢ä¼šç»†è®²ã€‚

### 05ã€åŒ…è£…å™¨ç±»å‹

åŒ…è£…å™¨ç±»å‹ï¼ˆWrapper Typesï¼‰æ˜¯ Java ä¸­çš„ä¸€ç§ç‰¹æ®Šç±»å‹ï¼Œç”¨äºå°†åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå¦‚ intã€floatã€char ç­‰ï¼‰è½¬æ¢ä¸ºå¯¹åº”çš„[å¯¹è±¡ç±»å‹](https://tobebetterjavaer.com/oo/object-class.html)ã€‚

Java æä¾›äº†ä»¥ä¸‹åŒ…è£…å™¨ç±»å‹ï¼Œä¸åŸºæœ¬æ•°æ®ç±»å‹ä¸€ä¸€å¯¹åº”ï¼š

- Byteï¼ˆå¯¹åº” byteï¼‰
- Shortï¼ˆå¯¹åº” shortï¼‰
- Integerï¼ˆå¯¹åº” intï¼‰
- Longï¼ˆå¯¹åº” longï¼‰
- Floatï¼ˆå¯¹åº” floatï¼‰
- Doubleï¼ˆå¯¹åº” doubleï¼‰
- Characterï¼ˆå¯¹åº” charï¼‰
- Booleanï¼ˆå¯¹åº” booleanï¼‰

åŒ…è£…å™¨ç±»å‹å…è®¸æˆ‘ä»¬ä½¿ç”¨åŸºæœ¬æ•°æ®ç±»å‹æä¾›çš„å„ç§å®ç”¨æ–¹æ³•ï¼Œå¹¶å…¼å®¹éœ€è¦å¯¹è±¡ç±»å‹çš„åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Integer ç±»çš„ parseInt æ–¹æ³•å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°ï¼Œæˆ–ä½¿ç”¨ Character ç±»çš„ isDigit æ–¹æ³•æ£€æŸ¥å­—ç¬¦æ˜¯å¦ä¸ºæ•°å­—ï¼Œè¿˜æœ‰å‰é¢æåˆ°çš„ `Character.forDigit()` æ–¹æ³•ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨åŒ…è£…å™¨ç±»å‹ï¼š

```java
// ä½¿ç”¨ Integer åŒ…è£…å™¨ç±»å‹
Integer integerValue = new Integer(42);
System.out.println("æ•´æ•°å€¼: " + integerValue);

// å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°
String numberString = "123";
int parsedNumber = Integer.parseInt(numberString);
System.out.println("æ•´æ•°å€¼: " + parsedNumber);

// ä½¿ç”¨ Character åŒ…è£…å™¨ç±»å‹
Character charValue = new Character('A');
System.out.println("å­—ç¬¦: " + charValue);

// æ£€æŸ¥å­—ç¬¦æ˜¯å¦ä¸ºæ•°å­—
char testChar = '9';
if (Character.isDigit(testChar)) {
System.out.println("å­—ç¬¦æ˜¯ä¸ªæ•°å­—.");
}
```

ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª [Integer ç±»å‹](https://tobebetterjavaer.com/basic-extra-meal/int-cache.html)çš„å¯¹è±¡ integerValue å¹¶ä¸ºå…¶èµ‹å€¼ 42ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†å…¶å€¼æ‰“å°åˆ°æ§åˆ¶å°ã€‚

æˆ‘ä»¬æœ‰ä¸€ä¸ªåŒ…å«æ•°å­—çš„[å­—ç¬¦ä¸²](https://tobebetterjavaer.com/string/immutable.html) numberStringã€‚æˆ‘ä»¬ä½¿ç”¨ `Integer.parseInt()` æ–¹æ³•å°†å…¶è½¬æ¢ä¸ºæ•´æ•° parsedNumberã€‚ç„¶åï¼Œæˆ‘ä»¬å°†è½¬æ¢åçš„å€¼æ‰“å°åˆ°æ§åˆ¶å°ã€‚

æˆ‘ä»¬æœ‰ä¸€ä¸ªå­—ç¬¦å˜é‡ testCharï¼Œå¹¶ä¸ºå…¶èµ‹å€¼å­—ç¬¦ '9'ã€‚æˆ‘ä»¬ä½¿ç”¨ `Character.isDigit()` æ–¹æ³•æ£€æŸ¥ testChar æ˜¯å¦ä¸ºæ•°å­—å­—ç¬¦ã€‚å¦‚æœæ˜¯æ•°å­—å­—ç¬¦ï¼Œæˆ‘ä»¬å°†è¾“å‡ºä¸€æ¡æ¶ˆæ¯åˆ°æ§åˆ¶å°ã€‚

ä» Java 5 å¼€å§‹ï¼Œ[è‡ªåŠ¨è£…ç®±ï¼ˆAutoboxingï¼‰å’Œè‡ªåŠ¨æ‹†ç®±ï¼ˆUnboxingï¼‰æœºåˆ¶](https://tobebetterjavaer.com/basic-extra-meal/box.html)å…è®¸æˆ‘ä»¬åœ¨åŸºæœ¬æ•°æ®ç±»å‹å’ŒåŒ…è£…å™¨ç±»å‹ä¹‹é—´è‡ªåŠ¨è½¬æ¢ï¼Œæ— éœ€æ˜¾å¼åœ°è°ƒç”¨æ„é€ æ–¹æ³•æˆ–è½¬æ¢æ–¹æ³•ï¼ˆé“¾æ¥é‡Œä¼šç»†è®²ï¼‰ã€‚

```java
Integer integerValue = 42; // è‡ªåŠ¨è£…ç®±ï¼Œç­‰åŒäº new Integer(42)
int primitiveValue = integerValue; // è‡ªåŠ¨æ‹†ç®±ï¼Œç­‰åŒäº integerValue.intValue()
```

### 06ã€å¼•ç”¨æ•°æ®ç±»å‹

åŸºæœ¬æ•°æ®ç±»å‹åœ¨ä½œä¸ºæˆå‘˜å˜é‡å’Œé™æ€å˜é‡çš„æ—¶å€™æœ‰é»˜è®¤å€¼ï¼Œå¼•ç”¨æ•°æ®ç±»å‹ä¹Ÿæœ‰çš„ï¼ˆå­¦å®Œæ•°ç»„&å­—ç¬¦ä¸²ï¼Œä»¥åŠé¢å‘å¯¹è±¡ç¼–ç¨‹åä¼šæ›´åŠ æ¸…æ¥šï¼Œè¿™é‡Œå…ˆç®€å•è¿‡ä¸€ä¸‹ï¼‰ã€‚

[String](https://tobebetterjavaer.com/string/immutable.html) æ˜¯æœ€å…¸å‹çš„å¼•ç”¨æ•°æ®ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æ‹¿ String ç±»ä¸¾ä¾‹ï¼Œçœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼š

```java
/**
 * @author å¾®ä¿¡æœã€Œæ²‰é»˜ç‹äºŒã€ï¼Œå›å¤å…³é”®å­— PDF
 */
public class LocalRef {
    private String a;
    static String b;

    public static void main(String[] args) {
        LocalRef lv = new LocalRef();
        System.out.println(lv.a);
        System.out.println(b);
    }
}
```

è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
null
null
```

null åœ¨ Java ä¸­æ˜¯ä¸€ä¸ªå¾ˆç¥å¥‡çš„å­˜åœ¨ï¼Œåœ¨ä½ ä»¥åçš„ç¨‹åºç”Ÿæ¶¯ä¸­ï¼Œè§å®ƒçš„æ¬¡æ•°ä¸ä¼šå°‘ï¼Œå°¤å…¶æ˜¯ä¼´éšç€ä»¤äººçƒ¦æ¼çš„â€œ[ç©ºæŒ‡é’ˆå¼‚å¸¸](https://tobebetterjavaer.com/exception/npe.html)â€ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ `NullPointerException`ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œå¼•ç”¨æ•°æ®ç±»å‹çš„é»˜è®¤å€¼ä¸º nullï¼ŒåŒ…æ‹¬æ•°ç»„å’Œæ¥å£ã€‚

é‚£ä½ æ˜¯ä¸æ˜¯å¾ˆå¥½å¥‡ï¼Œä¸ºä»€ä¹ˆ[æ•°ç»„](https://tobebetterjavaer.com/array/array.html)å’Œ[æ¥å£](https://tobebetterjavaer.com/oo/interface.html)ä¹Ÿæ˜¯å¼•ç”¨æ•°æ®ç±»å‹å•Šï¼Ÿ

å…ˆæ¥çœ‹æ•°ç»„ï¼š

```java
int [] arrays = {1,2,3};
System.out.println(arrays);
```

arrays æ˜¯ä¸€ä¸ª int ç±»å‹çš„æ•°ç»„ï¼Œå¯¹å§ï¼Ÿæ‰“å°ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
[I@2d209079
```

`[I` è¡¨ç¤ºæ•°ç»„æ˜¯ int ç±»å‹çš„ï¼Œ@ åé¢æ˜¯åå…­è¿›åˆ¶çš„ hashCodeâ€”â€”è¿™æ ·çš„æ‰“å°ç»“æœå¤ªâ€œäººæ€§åŒ–â€äº†ï¼Œä¸€èˆ¬äººè¡¨ç¤ºçœ‹ä¸æ‡‚ï¼ä¸ºä»€ä¹ˆä¼šè¿™æ ·æ˜¾ç¤ºå‘¢ï¼ŸæŸ¥çœ‹ä¸€ä¸‹ `java.lang.Object` ç±»çš„ `toString()` æ–¹æ³•å°±æ˜ç™½äº†ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-grammar/nine-06.png)

æ•°ç»„è™½ç„¶æ²¡æœ‰æ˜¾å¼å®šä¹‰æˆä¸€ä¸ªç±»ï¼Œä½†å®ƒçš„ç¡®æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç»§æ‰¿äº†ç¥–å…ˆç±» Object çš„æ‰€æœ‰æ–¹æ³•ã€‚é‚£ä¸ºä»€ä¹ˆæ•°ç»„ä¸å•ç‹¬å®šä¹‰ä¸€ä¸ªç±»æ¥è¡¨ç¤ºå‘¢ï¼Ÿå°±åƒå­—ç¬¦ä¸² String ç±»é‚£æ ·å‘¢ï¼Ÿ

ä¸€ä¸ªåˆç†çš„è§£é‡Šæ˜¯ Java å°†å…¶éšè—äº†ã€‚å‡å¦‚çœŸçš„å­˜åœ¨ä¸€ä¸ª Array.javaï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å‡æƒ³å®ƒçœŸå®çš„æ ·å­ï¼Œå®ƒå¿…é¡»è¦å®šä¹‰ä¸€ä¸ªå®¹å™¨æ¥å­˜æ”¾æ•°ç»„çš„å…ƒç´ ï¼Œå°±åƒ String ç±»é‚£æ ·ã€‚

```java
public final class String
    implements java.io.Serializable, Comparable<String>, CharSequence {
    /** The value is used for character storage. */
    private final char value[];
}
```

æ•°ç»„å†…éƒ¨å®šä¹‰æ•°ç»„ï¼Ÿæ²¡å¿…è¦çš„ï¼

å†æ¥çœ‹æ¥å£ï¼š

```java
List<String> list = new ArrayList<>();
System.out.println(list);
```

[List](https://tobebetterjavaer.com/collection/gailan.html) æ˜¯ä¸€ä¸ªéå¸¸å…¸å‹çš„æ¥å£ï¼š

```java
public interface List<E> extends Collection<E> {}
```

è€Œ [ArrayList](https://tobebetterjavaer.com/collection/arraylist.html) æ˜¯ List æ¥å£çš„ä¸€ä¸ªå®ç°ï¼š

```java
public class ArrayList<E> extends AbstractList<E>
        implements List<E>, RandomAccess, Cloneable, java.io.Serializable
{}
```

å¯¹äºæ¥å£ç±»å‹çš„å¼•ç”¨å˜é‡æ¥è¯´ï¼Œä½ æ²¡æ³•ç›´æ¥ new ä¸€ä¸ªï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-grammar/nine-07.png)

åªèƒ½ new ä¸€ä¸ªå®ç°å®ƒçš„ç±»çš„å¯¹è±¡â€”â€”é‚£è‡ªç„¶æ¥å£ä¹Ÿæ˜¯å¼•ç”¨æ•°æ®ç±»å‹äº†ã€‚

æ¥çœ‹ä¸€ä¸‹åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹ä¹‹é—´æœ€å¤§çš„å·®åˆ«ã€‚

åŸºæœ¬æ•°æ®ç±»å‹ï¼š

- 1ã€å˜é‡åæŒ‡å‘å…·ä½“çš„æ•°å€¼ã€‚
- 2ã€åŸºæœ¬æ•°æ®ç±»å‹å­˜å‚¨åœ¨æ ˆä¸Šã€‚

å¼•ç”¨æ•°æ®ç±»å‹ï¼š

- 1ã€å˜é‡åæŒ‡å‘çš„æ˜¯å­˜å‚¨å¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œåœ¨æ ˆä¸Šã€‚
- 2ã€å†…å­˜åœ°å€æŒ‡å‘çš„å¯¹è±¡å­˜å‚¨åœ¨å †ä¸Šã€‚

### 07ã€å †å’Œæ ˆ

çœ‹åˆ°è¿™ï¼Œä¸‰å¦¹æ˜¯ä¸æ˜¯åˆè¦é—®ï¼Œâ€œå †æ˜¯ä»€ä¹ˆï¼Œæ ˆåˆæ˜¯ä»€ä¹ˆï¼Ÿâ€

å †æ˜¯å †ï¼ˆheapï¼‰ï¼Œæ ˆæ˜¯æ ˆï¼ˆstackï¼‰ï¼Œå¦‚æœçœ‹åˆ°â€œå †æ ˆâ€çš„è¯ï¼Œè¯·ä¸è¦æ€€ç–‘è‡ªå·±ï¼Œé‚£æ˜¯ç¿»è¯‘çš„é”™ï¼Œå †æ ˆä¹Ÿæ˜¯æ ˆï¼Œåæ­£æˆ‘å¾ˆä¸å–œæ¬¢â€œå †æ ˆâ€è¿™ç§å«æ³•ï¼Œå®¹æ˜“è®©æ–°äººæ‰å‘é‡Œã€‚

å †æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶åœ¨å†…å­˜ä¸­ç”³è¯·çš„ç©ºé—´ï¼ˆå¯ç†è§£ä¸ºåŠ¨æ€çš„è¿‡ç¨‹ï¼‰ï¼›åˆ‡è®°ï¼Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶ï¼›å› æ­¤ï¼ŒJava ä¸­çš„å¯¹è±¡å°±æ”¾åœ¨è¿™é‡Œï¼Œè¿™æ ·åšçš„å¥½å¤„å°±æ˜¯ï¼š

> å½“éœ€è¦ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œåªéœ€è¦é€šè¿‡ new å…³é”®å­—å†™ä¸€è¡Œä»£ç å³å¯ï¼Œå½“æ‰§è¡Œè¿™è¡Œä»£ç æ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨å†…å­˜çš„â€œå †â€åŒºåˆ†é…ç©ºé—´â€”â€”è¿™æ ·å°±å¾ˆçµæ´»ã€‚

æ ˆï¼Œèƒ½å¤Ÿå’Œå¤„ç†å™¨ï¼ˆCPUï¼Œä¹Ÿå°±æ˜¯è„‘å­ï¼‰ç›´æ¥å…³è”ï¼Œå› æ­¤è®¿é—®é€Ÿåº¦æ›´å¿«ã€‚æ—¢ç„¶è®¿é—®é€Ÿåº¦å¿«ï¼Œè¦å¥½å¥½åˆ©ç”¨å•Šï¼Java å°±æŠŠå¯¹è±¡çš„å¼•ç”¨æ”¾åœ¨æ ˆé‡Œã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºå¼•ç”¨çš„ä½¿ç”¨é¢‘ç‡é«˜å—ï¼Ÿ

ä¸æ˜¯çš„ï¼Œå› ä¸º Java åœ¨ç¼–è¯‘ç¨‹åºæ—¶ï¼Œå¿…é¡»æ˜ç¡®çš„çŸ¥é“å­˜å‚¨åœ¨æ ˆé‡Œçš„ä¸œè¥¿çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¦åˆ™å°±æ²¡æ³•é‡Šæ”¾æ—§çš„å†…å­˜æ¥å¼€è¾Ÿæ–°çš„å†…å­˜ç©ºé—´å­˜æ”¾å¼•ç”¨â€”â€”ç©ºé—´å°±é‚£ä¹ˆå¤§ï¼Œå‰æµªè¦æŠŠåæµªæ‹æ­»åœ¨æ²™æ»©ä¸Šå•Šã€‚

è¿™ä¹ˆè¯´å°±ç†è§£äº†å§ï¼Ÿ

å¦‚æœè¿˜ä¸ç†è§£çš„è¯ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ªè§†é¢‘ï¼Œè®²çš„éå¸¸ä¸é”™ï¼š[ä»€ä¹ˆæ˜¯å †ï¼Ÿä»€ä¹ˆæ˜¯æ ˆï¼Ÿä»–ä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«å’Œè”ç³»ï¼Ÿ](https://www.zhihu.com/question/19729973/answer/2238950166)

ç”¨å›¾æ¥è¡¨ç¤ºä¸€ä¸‹ï¼Œå·¦ä¾§æ˜¯æ ˆï¼Œå³ä¾§æ˜¯å †ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/basic-grammar/basic-data-type-dc26645a-3ed8-4ad4-815d-52528ad12d6b.png)

è¿™é‡Œå†è¡¥å……ä¸€äº›é¢å¤–çš„çŸ¥è¯†ç‚¹ï¼Œèƒ½çœ‹æ‡‚å°±ç»§ç»­å¸æ”¶ï¼Œçœ‹ä¸æ‡‚å¯ä»¥å…ˆå»å­¦ä¸‹ä¸€èŠ‚ï¼Œä»¥åå†æ¥è¡¥ï¼Œæ²¡å…³ç³»çš„ã€‚å­¦ä¹ å°±æ˜¯è¿™æ ·ï¼Œå¯ä»¥è·³è¿‡ï¼Œå¯ä»¥æ¸©æ•…ã€‚

ä¸¾ä¸ªä¾‹å­ã€‚

```java
String a = new String("æ²‰é»˜ç‹äºŒ")
```

è¿™æ®µä»£ç ä¼šå…ˆåœ¨å †é‡Œåˆ›å»ºä¸€ä¸ª æ²‰é»˜ç‹äºŒçš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œç„¶åå†æŠŠå¯¹è±¡çš„å¼•ç”¨ a æ”¾åˆ°æ ˆé‡Œé¢ã€‚è¿™é‡Œé¢è¿˜ä¼šæ¶‰åŠåˆ°[å­—ç¬¦ä¸²å¸¸é‡æ± ](https://tobebetterjavaer.com/string/constant-pool.html)ï¼Œåé¢ä¼šè®²ã€‚

é‚£ä¹ˆå¯¹äºè¿™æ ·ä¸€æ®µä»£ç ï¼Œæœ‰åŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡ï¼Œæœ‰å¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œå †å’Œæ ˆéƒ½æ˜¯å¦‚ä½•å­˜å‚¨ä»–ä»¬çš„å‘¢ï¼Ÿ

```java
public void test()
{
    int i = 4;
    int y = 2;
    Object o1 = new Object();
}
```

æˆ‘æ¥ç”»ä¸ªå›¾è¡¨ç¤ºä¸‹ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/basic-grammar/basic-data-type-3d5b3e40-1abb-4624-8282-b83e58388825.png)

åº”è¯¥ä¸€ç›®äº†ç„¶äº†å§ï¼Ÿ

â€œå¥½äº†ï¼Œä¸‰å¦¹ï¼Œå…³äº Java ä¸­çš„æ•°æ®ç±»å‹å°±å…ˆè¯´è¿™ä¹ˆå¤šå§ï¼Œä½ æ˜¯ä¸æ˜¯å·²ç»æ¸…æ¥šäº†ï¼Ÿâ€è½¬åŠ¨äº†ä¸€ä¸‹åƒµç¡¬çš„è„–å­åï¼Œæˆ‘å¯¹ä¸‰å¦¹è¯´ã€‚

### 08ã€å°ç»“

æœ¬æ–‡è¯¦ç»†æ¢è®¨äº† Java æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬æ¯”ç‰¹ä¸å­—èŠ‚ã€åŸºæœ¬æ•°æ®ç±»å‹ã€å•ç²¾åº¦ä¸åŒç²¾åº¦ã€int ä¸ char äº’è½¬ã€åŒ…è£…å™¨ç±»å‹ã€å¼•ç”¨æ•°æ®ç±»å‹ä»¥åŠå †ä¸æ ˆçš„å†…å­˜æ¨¡å‹ã€‚é€šè¿‡é˜…è¯»æœ¬æ–‡ï¼Œä½ å°†å…¨é¢äº†è§£ Java æ•°æ®ç±»å‹çš„æ¦‚å¿µä¸ä½¿ç”¨æ–¹æ³•ï¼Œä¸º Java ç¼–ç¨‹æ‰“ä¸‹åšå®åŸºç¡€ã€‚

---

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 3.4 Javaæ•°æ®ç±»å‹è½¬æ¢

â€œä¸‰å¦¹ï¼Œä»Šå¤©æˆ‘ä»¬æ¥èŠèŠ Java ä¸­çš„æ•°æ®ç±»å‹è½¬æ¢ã€‚â€æˆ‘å¼€é—¨è§å±±åœ°å¯¹ä¸‰å¦¹è¯´ã€‚

â€œå¥½å•Šã€‚â€ä¸‰å¦¹æ„‰å¿«åœ°è¯´ã€‚

æ•°æ®ç±»å‹è½¬æ¢çš„ç›®çš„æ˜¯ç¡®ä¿åœ¨è¡¨è¾¾å¼æ±‚å€¼æ—¶ï¼Œä¸åŒç±»å‹çš„æ•°æ®èƒ½å¤Ÿç›¸äº’å…¼å®¹ã€‚

### 01ã€è‡ªåŠ¨ç±»å‹è½¬æ¢

è‡ªåŠ¨ç±»å‹è½¬æ¢ï¼ˆè‡ªåŠ¨ç±»å‹æå‡ï¼‰æ˜¯ Java ç¼–è¯‘å™¨åœ¨ä¸éœ€è¦æ˜¾å¼è½¬æ¢çš„æƒ…å†µä¸‹ï¼Œå°†ä¸€ç§åŸºæœ¬æ•°æ®ç±»å‹è‡ªåŠ¨è½¬æ¢ä¸ºå¦ä¸€ç§åŸºæœ¬æ•°æ®ç±»å‹çš„è¿‡ç¨‹ã€‚è¿™ç§è½¬æ¢é€šå¸¸å‘ç”Ÿåœ¨è¡¨è¾¾å¼æ±‚å€¼æœŸé—´ï¼Œå½“ä¸åŒç±»å‹çš„æ•°æ®éœ€è¦ç›¸äº’å…¼å®¹æ—¶ã€‚è‡ªåŠ¨ç±»å‹è½¬æ¢éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š

- å¦‚æœä»»ä½•æ“ä½œæ•°æ˜¯ double ç±»å‹ï¼Œå…¶ä»–æ“ä½œæ•°å°†è¢«è½¬æ¢ä¸º double ç±»å‹ã€‚
- å¦åˆ™ï¼Œå¦‚æœä»»ä½•æ“ä½œæ•°æ˜¯ float ç±»å‹ï¼Œå…¶ä»–æ“ä½œæ•°å°†è¢«è½¬æ¢ä¸º float ç±»å‹ã€‚
- å¦åˆ™ï¼Œå¦‚æœä»»ä½•æ“ä½œæ•°æ˜¯ long ç±»å‹ï¼Œå…¶ä»–æ“ä½œæ•°å°†è¢«è½¬æ¢ä¸º long ç±»å‹ã€‚
- å¦åˆ™ï¼Œæ‰€æœ‰æ“ä½œæ•°å°†è¢«è½¬æ¢ä¸º int ç±»å‹ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè‡ªåŠ¨ç±»å‹è½¬æ¢åªå‘ç”Ÿåœ¨å…¼å®¹ç±»å‹ä¹‹é—´ã€‚ä¾‹å¦‚ï¼Œä»è¾ƒå°çš„æ•°æ®ç±»å‹ï¼ˆå¦‚ intï¼‰åˆ°è¾ƒå¤§çš„æ•°æ®ç±»å‹ï¼ˆå¦‚ long æˆ– doubleï¼‰çš„è½¬æ¢æ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºè¾ƒå¤§çš„æ•°æ®ç±»å‹å¯ä»¥å®¹çº³è¾ƒå°æ•°æ®ç±»å‹çš„æ‰€æœ‰å¯èƒ½å€¼ã€‚

```
byte -> short -> int -> long -> float -> double
char -> int -> long -> float -> double
```

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†è‡ªåŠ¨ç±»å‹è½¬æ¢ï¼š

```java
int intValue = 5;
double doubleValue = 2.5;

// è‡ªåŠ¨ç±»å‹è½¬æ¢ï¼šintValue è¢«è½¬æ¢ä¸º double ç±»å‹
double result = intValue * doubleValue;
System.out.println("ç»“æœ: " + result); // è¾“å‡ºï¼šç»“æœ: 12.5
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª int ç±»å‹çš„å˜é‡ intValue å’Œä¸€ä¸ª double ç±»å‹çš„å˜é‡ doubleValueã€‚å½“æˆ‘ä»¬å°†å®ƒä»¬ç›¸ä¹˜æ—¶ï¼Œæ ¹æ®è‡ªåŠ¨ç±»å‹è½¬æ¢çš„è§„åˆ™ï¼ŒintValue å°†è¢«è½¬æ¢ä¸º double ç±»å‹ï¼Œä»¥ä¾¿å°†ä¸¤ä¸ª double ç±»å‹çš„æ“ä½œæ•°ç›¸ä¹˜ã€‚æœ€ç»ˆç»“æœå°†æ˜¯ä¸€ä¸ª double ç±»å‹çš„å€¼ï¼š12.5ã€‚

å†æ¥ä¸¾ä¸ªä¾‹å­ï¼Œé¡¾å®¢åˆ°è¶…å¸‚è´­ç‰©ï¼Œè´­ä¹°ç‰™è† 2 ç›’ï¼Œé¢å·¾çº¸ 4 ç›’ã€‚å…¶ä¸­ç‰™è†çš„ä»·æ ¼æ˜¯ 10.9 å…ƒï¼Œé¢å·¾çº¸çš„ä»·æ ¼æ˜¯ 5.8 å…ƒï¼Œæ±‚å•†å“æ€»ä»·æ ¼ã€‚å®ç°ä»£ç å¦‚ä¸‹ï¼š

```java
float price1 = 10.9f; // å®šä¹‰ç‰™è†çš„ä»·æ ¼ï¼Œå•ç²¾åº¦æµ®ç‚¹å‹float
double price2 = 5.8; // å®šä¹‰é¢å·¾çº¸çš„ä»·æ ¼ï¼ŒåŒç²¾åº¦æµ®ç‚¹å‹double
int num1 = 2; // å®šä¹‰ç‰™è†çš„æ•°é‡ï¼Œæ•´å‹ int
int num2 = 4; // å®šä¹‰é¢å·¾çº¸çš„æ•°é‡
double res = price1 * num1 + price2 * num2; // è®¡ç®—æ€»ä»·
System.out.println("ä¸€å…±ä»˜ç»™æ”¶é“¶å‘˜" + res + "å…ƒ"); // è¾“å‡ºæ€»ä»·
```

ä¸Šè¿°ä»£ç ä¸­é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ª float ç±»å‹çš„å˜é‡å­˜å‚¨ç‰™è†çš„ä»·æ ¼ï¼Œç„¶åå®šä¹‰äº†ä¸€ä¸ª double ç±»å‹çš„å˜é‡å­˜å‚¨é¢å·¾çº¸çš„ä»·æ ¼ï¼Œå†å®šä¹‰ä¸¤ä¸ª int ç±»å‹çš„å˜é‡å­˜å‚¨ç‰©å“çš„æ•°é‡ï¼Œæœ€åè¿›è¡Œäº†ä¹˜è¿ç®—ä»¥åŠå’Œè¿ç®—ä¹‹åï¼Œå°†ç»“æœå‚¨å­˜åœ¨ä¸€ä¸ª double ç±»å‹çš„å˜é‡ä¸­è¿›è¡Œè¾“å‡ºã€‚

```
ä¸€å…±ä»˜ç»™æ”¶é“¶å‘˜44.99999923706055å…ƒ
```

ä»æ‰§è¡Œç»“æœçœ‹å‡ºï¼Œfloatã€int å’Œ double ä¸‰ç§æ•°æ®ç±»å‹å‚ä¸è¿ç®—ï¼Œæœ€åè¾“å‡ºçš„ç»“æœä¸º double ç±»å‹çš„æ•°æ®ã€‚è¿™ç§è½¬æ¢ä¸€èˆ¬ç§°ä¸ºâ€œè¡¨è¾¾å¼ä¸­ç±»å‹çš„è‡ªåŠ¨æå‡â€ã€‚

è‡ªåŠ¨ç±»å‹æå‡æœ‰å¥½å¤„ï¼Œä½†å®ƒä¹Ÿä¼šå¼•èµ·ä»¤äººç–‘æƒ‘çš„ç¼–è¯‘é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çœ‹èµ·æ¥æ­£ç¡®çš„ç¨‹åºå´ä¼šå¼•èµ·é—®é¢˜ï¼š

```java
byte b = 50;

b = b * 2; // Type mismatch: cannot convert from int to byte
```

å¦‚ä¸Šæ‰€ç¤ºï¼Œç¬¬äºŒè¡Œä¼šæŠ¥â€œç±»å‹ä¸åŒ¹é…ï¼šæ— æ³•ä»intè½¬æ¢ä¸ºbyteâ€é”™è¯¯ã€‚

è¯¥ç¨‹åºè¯•å›¾å°†ä¸€ä¸ªå®Œå…¨åˆæ³•çš„ byte å‹çš„å€¼ 50*2 å­˜å‚¨ç»™ä¸€ä¸ª byte å‹çš„å˜é‡ã€‚ä½†æ˜¯å½“è¡¨è¾¾å¼æ±‚å€¼çš„æ—¶å€™ï¼Œæ“ä½œæ•°è¢«è‡ªåŠ¨çš„æå‡ä¸º int å‹ï¼Œè®¡ç®—ç»“æœä¹Ÿè¢«æå‡ä¸º int å‹ã€‚è¿™æ ·è¡¨è¾¾å¼çš„ç»“æœç°åœ¨æ˜¯ int å‹ï¼Œä¸å¼ºåˆ¶è½¬æ¢å®ƒå°±ä¸èƒ½è¢«èµ‹ä¸º byte å‹ã€‚

æ‰€ä»¥åº”è¯¥ä½¿ç”¨ä¸€ä¸ªæ˜¾ç¤ºçš„å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä¾‹å¦‚ï¼š

```java
byte b = 50;
b = (byte)(b*2);
```

è¿™æ ·å°±èƒ½äº§ç”Ÿæ­£ç¡®çš„å€¼ 100ã€‚

æ³¨æ„ï¼šchar ç±»å‹æ¯”è¾ƒç‰¹æ®Šï¼Œchar è‡ªåŠ¨è½¬æ¢æˆ intã€longã€float å’Œ doubleï¼Œä½† byte å’Œ short ä¸èƒ½è‡ªåŠ¨è½¬æ¢ä¸º charï¼Œè€Œä¸” char ä¹Ÿä¸èƒ½è‡ªåŠ¨è½¬æ¢ä¸º byte æˆ– shortã€‚

### 02ã€å¼ºåˆ¶ç±»å‹è½¬æ¢

å¼ºåˆ¶ç±»å‹è½¬æ¢æ˜¯ Java ä¸­å°†ä¸€ç§æ•°æ®ç±»å‹æ˜¾å¼è½¬æ¢ä¸ºå¦ä¸€ç§æ•°æ®ç±»å‹çš„è¿‡ç¨‹ã€‚ä¸è‡ªåŠ¨ç±»å‹è½¬æ¢ä¸åŒï¼Œå¼ºåˆ¶ç±»å‹è½¬æ¢éœ€è¦ç¨‹åºå‘˜æ˜¾å¼åœ°æŒ‡å®šè¦æ‰§è¡Œçš„è½¬æ¢ã€‚å¼ºåˆ¶ç±»å‹è½¬æ¢åœ¨ä»¥ä¸‹æƒ…å†µä¸­å¯èƒ½éœ€è¦ï¼š

- å°†è¾ƒå¤§çš„æ•°æ®ç±»å‹è½¬æ¢ä¸ºè¾ƒå°çš„æ•°æ®ç±»å‹ã€‚
- å°†æµ®ç‚¹æ•°è½¬æ¢ä¸ºæ•´æ•°ã€‚
- å°†å­—ç¬¦ç±»å‹è½¬æ¢ä¸ºæ•°å€¼ç±»å‹ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¼ºåˆ¶ç±»å‹è½¬æ¢å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±æˆ–ç²¾åº¦é™ä½ï¼Œå› ä¸ºç›®æ ‡ç±»å‹å¯èƒ½æ— æ³•å®¹çº³åŸå§‹ç±»å‹çš„æ‰€æœ‰å¯èƒ½å€¼ã€‚å› æ­¤ï¼Œåœ¨è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢æ—¶ï¼Œéœ€è¦ç¡®ä¿è½¬æ¢åçš„å€¼ä»ç„¶åœ¨ç›®æ ‡ç±»å‹çš„èŒƒå›´å†…ã€‚

```
double -> float -> long -> int -> char -> short -> byte
```

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼š

```java
double doubleValue = 42.8;

// å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼šå°† double ç±»å‹è½¬æ¢ä¸º int ç±»å‹
int intValue = (int) doubleValue;
System.out.println("æ•´æ•°å€¼: " + intValue); // è¾“å‡ºï¼šæ•´æ•°å€¼: 42
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª double ç±»å‹çš„å˜é‡ doubleValueã€‚æˆ‘ä»¬å¸Œæœ›å°†å…¶è½¬æ¢ä¸º int ç±»å‹çš„å˜é‡ intValueã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢è¯­æ³•ï¼Œå³åœ¨è¦è½¬æ¢çš„å˜é‡ä¹‹å‰åŠ ä¸Šç›®æ ‡ç±»å‹çš„æ‹¬å·ï¼ˆå¦‚ (int)ï¼‰ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°† doubleValue è½¬æ¢ä¸º int ç±»å‹æ—¶ï¼Œå°æ•°éƒ¨åˆ†å°†è¢«æˆªæ–­ã€‚å› æ­¤ï¼Œè¾“å‡ºç»“æœå°†æ˜¯ï¼šInteger value: 42ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç²¾åº¦ä¸¢å¤±æ˜¯å¯ä»¥æ¥å—çš„ï¼Œä½†åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æ›´åŠ å°å¿ƒåœ°å¤„ç†ç±»å‹è½¬æ¢ä»¥é¿å…æ•°æ®ä¸¢å¤±ã€‚

é¡¾å®¢åˆ°è¶…å¸‚è´­ç‰©ï¼Œè´­ä¹°ç‰™è† 2 ç›’ï¼Œé¢å·¾çº¸ 4 ç›’ã€‚å…¶ä¸­ç‰™è†çš„ä»·æ ¼æ˜¯ 10.9 å…ƒï¼Œé¢å·¾çº¸çš„ä»·æ ¼æ˜¯ 5.8 å…ƒï¼Œæ±‚å•†å“æ€»ä»·æ ¼ï¼Œåœ¨è®¡ç®—æ€»ä»·æ—¶é‡‡ç”¨ int ç±»å‹çš„æ•°æ®è¿›è¡Œå­˜å‚¨ã€‚å®ç°ä»£ç å¦‚ä¸‹ï¼š

```java
float price1 = 10.9f;
double price2 = 5.8;
int num1 = 2;
int num2 = 4;
int res2 = (int) (price1 * num1 + price2 * num2);
System.out.println("ä¸€å…±ä»˜ç»™æ”¶é“¶å‘˜" + res2 + "å…ƒ");
```

åœ¨ä¸Šè¿°å®ä¾‹ä¸­ï¼Œæœ‰ double ç±»å‹ã€float ç±»å‹å’Œ int ç±»å‹çš„æ•°æ®å‚ä¸è¿ç®—ï¼Œå…¶è¿ç®—ç»“æœé»˜è®¤ä¸º double ç±»å‹ï¼Œé¢˜ç›®è¦æ±‚çš„ç»“æœä¸º int ç±»å‹ï¼Œå› ä¸º int ç±»å‹çš„å–å€¼èŒƒå›´è¦å°äº double ç±»å‹çš„å–å€¼èŒƒå›´ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚

```
ä¸€å…±ä»˜ç»™æ”¶é“¶å‘˜44å…ƒ
```

---

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 3.5 JavaåŸºæœ¬æ•°æ®ç±»å‹ç¼“å­˜æ± 

â€œä¸‰å¦¹ï¼Œä»Šå¤©æˆ‘ä»¬æ¥è¡¥ä¸€ä¸ªå°çš„çŸ¥è¯†ç‚¹ï¼šJava åŸºæœ¬æ•°æ®ç±»å‹ç¼“å­˜æ± ã€‚â€æˆ‘å–äº†ä¸€å£æ¸ææ³¡çš„èŒ¶åå¯¹ä¸‰å¦¹è¯´ï¼Œâ€œè€ƒä½ ä¸€ä¸ªé—®é¢˜å“ˆï¼š`new Integer(18) ä¸ Integer.valueOf(18)` çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿâ€

â€œéš¾é“ä¸ä¸€æ ·å—ï¼Ÿâ€ä¸‰å¦¹æœ‰ç‚¹è¯§å¼‚ã€‚

â€œä¸ä¸€æ ·çš„ã€‚â€æˆ‘ç¬‘ç€è¯´ã€‚

- `new Integer(18)` æ¯æ¬¡éƒ½ä¼šæ–°å»ºä¸€ä¸ªå¯¹è±¡;
- `Integer.valueOf(18)` ä¼šä½¿â½¤ç”¨ç¼“å­˜æ± ä¸­çš„å¯¹è±¡ï¼Œå¤šæ¬¡è°ƒç”¨åªä¼šå–åŒâ¼€ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚

æ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼š

```java
Integer x = new Integer(18);
Integer y = new Integer(18);
System.out.println(x == y);

Integer z = Integer.valueOf(18);
Integer k = Integer.valueOf(18);
System.out.println(z == k);

Integer m = Integer.valueOf(300);
Integer p = Integer.valueOf(300);
System.out.println(m == p);
```

æ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœå§ï¼š

```
false
true
false
```

â€œç¬¬ä¸€ä¸ª falseï¼Œæˆ‘çŸ¥é“åŸå› ï¼Œå› ä¸º new å‡ºæ¥çš„æ˜¯ä¸åŒçš„å¯¹è±¡ï¼Œåœ°å€ä¸åŒã€‚â€ä¸‰å¦¹è§£é‡Šé“ï¼Œâ€œç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªæˆ‘è®¤ä¸ºéƒ½åº”è¯¥æ˜¯ true å•Šï¼Œä¸ºä»€ä¹ˆç¬¬ä¸‰ä¸ªä¼šè¾“å‡º false å‘¢ï¼Ÿè¿™ä¸ªæˆ‘ç†è§£ä¸äº†ã€‚â€

â€œå…¶å®åŸå› ä¹Ÿå¾ˆç®€å•ã€‚â€æˆ‘èƒ¸æœ‰æˆç«¹åœ°è¯´ã€‚

åŸºæœ¬æ•°æ®ç±»å‹çš„åŒ…è£…ç±»é™¤äº† Float å’Œ Double ä¹‹å¤–ï¼Œå…¶ä»–å…­ä¸ªåŒ…è£…å™¨ç±»ï¼ˆByteã€Shortã€Integerã€Longã€Characterã€Booleanï¼‰éƒ½æœ‰å¸¸é‡ç¼“å­˜æ± ã€‚

- Byteï¼š-128~127ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰çš„ byte å€¼
- Shortï¼š-128~127
- Longï¼š-128~127
- Characterï¼š\u0000 - \u007F
- Booleanï¼štrue å’Œ false

æ‹¿ Integer æ¥ä¸¾ä¾‹å­ï¼ŒInteger ç±»å†…éƒ¨ä¸­å†…ç½®äº† 256 ä¸ª Integer ç±»å‹çš„ç¼“å­˜æ•°æ®ï¼Œå½“ä½¿ç”¨çš„æ•°æ®èŒƒå›´åœ¨ -128~127 ä¹‹é—´æ—¶ï¼Œä¼šç›´æ¥è¿”å›å¸¸é‡æ± ä¸­æ•°æ®çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯åˆ›å»ºå¯¹è±¡ï¼Œè¶…è¿‡è¿™ä¸ªèŒƒå›´æ—¶ä¼šåˆ›å»ºæ–°çš„å¯¹è±¡ã€‚

 18 åœ¨ -128~127 ä¹‹é—´ï¼Œ300 ä¸åœ¨ã€‚

æ¥çœ‹ä¸€ä¸‹ valueOf æ–¹æ³•çš„æºç å§ã€‚

```java
public static Integer valueOf(int i) {
    if (i >=IntegerCache.low && i <=IntegerCache.high)
        return IntegerCache.cache[i + (-IntegerCache.low)];
    return new Integer(i);
}
```

â€œå“¦ï¼ŒåŸæ¥æ˜¯å› ä¸º Integer.IntegerCache è¿™ä¸ªå†…éƒ¨ç±»çš„åŸå› å•Šï¼â€ä¸‰å¦¹å¥½åƒå‘ç°äº†æ–°å¤§é™†ã€‚

â€œæ˜¯æ»´ã€‚æ¥çœ‹ä¸€ä¸‹ IntegerCache è¿™ä¸ªé™æ€å†…éƒ¨ç±»çš„æºç å§ã€‚â€

```java
private static class IntegerCache {
    static final int low = -128;
    static final int high;
    static final Integer cache[];

    static {
        // high value may be configured by property
        int h = 127;
        String integerCacheHighPropValue =
                sun.misc.VM.getSavedProperty("java.lang.Integer.IntegerCache.high");
        if (integerCacheHighPropValue != null) {
            try {
                int i = parseInt(integerCacheHighPropValue);
                i = Math.max(i, 127);
                // Maximum array size is Integer.MAX_VALUE
                h = Math.min(i, Integer.MAX_VALUE - (-low) -1);
            } catch( NumberFormatException nfe) {
                // If the property cannot be parsed into an int, ignore it.
            }
        }
        high = h;

        cache = new Integer[(high - low) + 1];
        int j = low;
        for(int k = 0; k < cache.length; k++)
            cache[k] = new Integer(j++);

        // range [-128, 127] must be interned (JLS7 5.1.7)
        assert Integer.IntegerCache.high >= 127;
    }

    private IntegerCache() {}
}
```

è¯¦ç»†è§£é‡Šä¸‹ï¼šå½“æˆ‘ä»¬é€šè¿‡ `Integer.valueOf()` æ–¹æ³•è·å–æ•´æ•°å¯¹è±¡æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥è¯¥æ•´æ•°æ˜¯å¦åœ¨ IntegerCache ä¸­ï¼Œå¦‚æœåœ¨ï¼Œåˆ™è¿”å›ç¼“å­˜ä¸­çš„å¯¹è±¡ï¼Œå¦åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡å¹¶ç¼“å­˜èµ·æ¥ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½¿ç”¨ `new Integer()` åˆ›å»ºå¯¹è±¡ï¼Œå³ä½¿å€¼åœ¨ -128 åˆ° 127 èŒƒå›´å†…ï¼Œä¹Ÿä¸ä¼šè¢«ç¼“å­˜ï¼Œæ¯æ¬¡éƒ½ä¼šåˆ›å»ºæ–°çš„å¯¹è±¡ã€‚å› æ­¤ï¼Œæ¨èä½¿ç”¨ `Integer.valueOf()` æ–¹æ³•è·å–æ•´æ•°å¯¹è±¡ã€‚

[å­¦ä¹  static å…³é”®å­—](https://tobebetterjavaer.com/oo/static.html)çš„æ—¶å€™ï¼Œä¼šè¯¦ç»†è§£é‡Šé™æ€ä»£ç å—ï¼Œä½ æš‚æ—¶å…ˆè®°ä½ï¼Œä¸‰å¦¹ï¼Œé™æ€ä»£ç å—é€šå¸¸ç”¨æ¥åˆå§‹åŒ–ä¸€äº›é™æ€å˜é‡ï¼Œå®ƒä¼šä¼˜å…ˆäº main() æ–¹æ³•æ‰§è¡Œã€‚

åœ¨é™æ€ä»£ç å—ä¸­ï¼Œlow ä¸º -128ï¼Œä¹Ÿå°±æ˜¯ç¼“å­˜æ± çš„æœ€å°å€¼ï¼›high é»˜è®¤ä¸º 127ï¼Œä¹Ÿå°±æ˜¯ç¼“å­˜æ± çš„æœ€å¤§å€¼ï¼Œå…±è®¡ 256 ä¸ªã€‚

*å¯ä»¥åœ¨ JVM å¯åŠ¨çš„æ—¶å€™ï¼Œé€šè¿‡ `-XX:AutoBoxCacheMax=NNN` æ¥è®¾ç½®ç¼“å­˜æ± çš„å¤§å°ï¼Œå½“ç„¶äº†ï¼Œä¸èƒ½æ— é™å¤§ï¼Œæœ€å¤§åˆ° `Integer.MAX_VALUE -129`*

ä¹‹åï¼Œåˆå§‹åŒ– cache æ•°ç»„çš„å¤§å°ï¼Œç„¶åéå†å¡«å……ï¼Œä¸‹æ ‡ä» 0 å¼€å§‹ã€‚

â€œæ˜ç™½äº†å§ï¼Ÿä¸‰å¦¹ã€‚â€æˆ‘å–äº†ä¸€å£æ°´åï¼Œæ‰­å¤´çœ‹äº†çœ‹æ—è¾¹çš„ä¸‰å¦¹ã€‚

â€œè¿™æ®µä»£ç ä¸éš¾ç†è§£ï¼Œéš¾ç†è§£çš„æ˜¯ `assert Integer.IntegerCache.high >= 127;`ï¼Œè¿™è¡Œä»£ç æ˜¯å¹²å˜›çš„å‘€ï¼Ÿâ€ä¸‰å¦¹å¾ˆæ˜¯ä¸è§£ã€‚

â€œå“¦å“¦ï¼Œä½ æŒºç»†å¿ƒçš„å‘€ï¼â€ä¸‰å¦¹çœŸä¸é”™ï¼Œæ±‚çŸ¥æ¬²æœ›è¶Šæ¥è¶Šå¼ºçƒˆäº†ã€‚

assert æ˜¯ Java ä¸­çš„ä¸€ä¸ªå…³é”®å­—ï¼Œå¯“æ„æ˜¯æ–­è¨€ï¼Œä¸ºäº†æ–¹ä¾¿è°ƒè¯•ç¨‹åºï¼Œå¹¶ä¸æ˜¯å‘å¸ƒç¨‹åºçš„ç»„æˆéƒ¨åˆ†ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–­è¨€æ˜¯å…³é—­çš„ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œè¿è¡Œ Java ç¨‹åºçš„æ—¶å€™åŠ ä¸Š `-ea` å‚æ•°æ‰“å¼€æ–­è¨€ã€‚

æ¥çœ‹è¿™æ®µä»£ç ã€‚

```java
public class AssertTest {
    public static void main(String[] args) {
        int high = 126;
        assert high >= 127;
    }
}
```

å‡è®¾æ‰‹åŠ¨è®¾ç½®çš„ç¼“å­˜æ± å¤§å°ä¸º 126ï¼Œæ˜¾ç„¶ä¸å¤ªç¬¦åˆç¼“å­˜æ± çš„é¢„æœŸå€¼ 127ï¼Œç»“æœä¼šè¾“å‡ºä»€ä¹ˆå‘¢ï¼Ÿ

ç›´æ¥åœ¨ Intellij IDEA ä¸­æ‰“å¼€å‘½ä»¤è¡Œç»ˆç«¯ï¼Œè¿›å…¥ classes æ–‡ä»¶ï¼Œæ‰§è¡Œï¼š

```
 /usr/libexec/java_home -v 1.8 --exec java -ea com.itwanger.s51.AssertTest
```

*æˆ‘ç”¨çš„ macOS ç¯å¢ƒï¼Œè£…äº†å¥½å¤šä¸ªç‰ˆæœ¬çš„ JDKï¼Œè¯¥å‘½ä»¤å¯ä»¥åˆ‡æ¢åˆ° JDK 8*

ä¹Ÿå¯ä»¥ä¸æŒ‡å®š Java ç‰ˆæœ¬ç›´æ¥æ‰§è¡Œï¼ˆåŠ ä¸Š `-ea` å‚æ•°ï¼‰ï¼š

```
java -ea com.itwanger.s51.AssertTest
```

â€œå‘€ï¼ŒæŠ¥é”™äº†å‘€ã€‚â€ä¸‰å¦¹å–Šé“ã€‚

```
Exception in thread "main" java.lang.AssertionError
        at com.itwanger.s51.AssertTest.main(AssertTest.java:9)
```

â€œæ˜¯æ»´ï¼Œå› ä¸º 126 å°äº 127ã€‚â€æˆ‘å›ç­”é“ã€‚

â€œåŸæ¥ assert æ˜¯è¿™æ ·ç”¨çš„å•Šï¼Œæˆ‘æ˜ç™½äº†ã€‚â€ä¸‰å¦¹è¡¨ç¤ºå­¦ä¼šäº†ã€‚

åœ¨ Java ä¸­ï¼Œé’ˆå¯¹ä¸€äº›åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå¦‚ Integerã€Longã€Boolean ç­‰ï¼‰ï¼ŒJava ä¼šåœ¨ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºä¸€äº›å¸¸ç”¨çš„å¯¹è±¡å¹¶ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œä»¥æé«˜ç¨‹åºçš„æ€§èƒ½å’ŒèŠ‚çœå†…å­˜å¼€é”€ã€‚è¿™äº›å¸¸ç”¨å¯¹è±¡è¢«ç¼“å­˜åœ¨ä¸€ä¸ªå›ºå®šçš„èŒƒå›´å†…ï¼Œè¶…å‡ºè¿™ä¸ªèŒƒå›´çš„å€¼ä¼šè¢«é‡æ–°åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚

ä½¿ç”¨æ•°æ®ç±»å‹ç¼“å­˜æ± å¯ä»¥æœ‰æ•ˆæé«˜ç¨‹åºçš„æ€§èƒ½å’ŒèŠ‚çœå†…å­˜å¼€é”€ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ç‰¹å®šçš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œç¼“å­˜æ± å¯èƒ½ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚ç¼“å­˜æ± ä¸­çš„å¯¹è±¡è¢«ä¸åŒçš„çº¿ç¨‹åŒæ—¶ä¿®æ”¹ï¼Œå¯¼è‡´æ•°æ®é”™è¯¯ç­‰é—®é¢˜ã€‚å› æ­¤ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚æ¥å†³å®šæ˜¯å¦ä½¿ç”¨æ•°æ®ç±»å‹ç¼“å­˜æ± ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 3.6 Javaè¿ç®—ç¬¦

â€œäºŒå“¥ï¼Œè®©æˆ‘ç›²çŒœä¸€ä¸‹å“ˆï¼Œè¿ç®—ç¬¦æ˜¯ä¸æ˜¯æŒ‡çš„å°±æ˜¯åŠ å‡ä¹˜é™¤å•Šï¼Ÿâ€ä¸‰å¦¹çš„è„¸ä¸Šæ³›ç€ç”œç”œçš„ç¬‘å®¹ï¼Œæˆ‘æƒ³å¥¹ä¸€å®šå¯¹æå‡ºçš„é—®é¢˜å¾ˆæœ‰è‡ªä¿¡ã€‚

â€œæ˜¯çš„ï¼Œä¸‰å¦¹ã€‚è¿ç®—ç¬¦åœ¨ Java ä¸­å æ®ç€é‡è¦çš„ä½ç½®ï¼Œå¯¹ç¨‹åºçš„æ‰§è¡Œæœ‰ç€å¾ˆå¤§çš„å¸®åŠ©ã€‚é™¤äº†å¸¸è§çš„åŠ å‡ä¹˜é™¤ï¼Œè¿˜æœ‰è®¸å¤šå…¶ä»–ç±»å‹çš„è¿ç®—ç¬¦ï¼Œæ¥çœ‹ä¸‹é¢è¿™å¼ æ€ç»´å¯¼å›¾ã€‚â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-grammar/eleven-01.png)


### 01ã€ç®—æœ¯è¿ç®—ç¬¦

ç®—æœ¯è¿ç®—ç¬¦é™¤äº†æœ€å¸¸è§çš„åŠ å‡ä¹˜é™¤ï¼Œè¿˜æœ‰ä¸€ä¸ªå–ä½™çš„è¿ç®—ç¬¦ï¼Œç”¨äºå¾—åˆ°é™¤æ³•è¿ç®—åçš„ä½™æ•°ï¼Œæ¥ä¸²ä»£ç æ„Ÿå—ä¸‹ã€‚

```java
int a = 10;
int b = 5;

System.out.println(a + b);//15
System.out.println(a - b);//5
System.out.println(a * b);//50
System.out.println(a / b);//2
System.out.println(a % b);//0

b = 3;
System.out.println(a + b);//13
System.out.println(a - b);//7
System.out.println(a * b);//30
System.out.println(a / b);//3
System.out.println(a % b);//1
```

å¯¹äºåˆå­¦è€…æ¥è¯´ï¼ŒåŠ æ³•ï¼ˆ+ï¼‰ã€å‡æ³•ï¼ˆ-ï¼‰ã€ä¹˜æ³•ï¼ˆ*ï¼‰å¾ˆå¥½ç†è§£ï¼Œä½†é™¤æ³•ï¼ˆ/ï¼‰å’Œå–ä½™ï¼ˆ%ï¼‰ä¼šæœ‰ä¸€ç‚¹ç‚¹ç–‘æƒ‘ã€‚åœ¨ä»¥å¾€çš„è®¤çŸ¥é‡Œï¼Œ10/3 æ˜¯é™¤ä¸å°½çš„ï¼Œç»“æœåº”è¯¥æ˜¯ 3.333333...ï¼Œè€Œä¸åº”è¯¥æ˜¯ 3ã€‚ç›¸åº”çš„ï¼Œä½™æ•°ä¹Ÿä¸åº”è¯¥æ˜¯ 1ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

å› ä¸ºæ•°å­—åœ¨ç¨‹åºä¸­å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯æ•´å‹ï¼Œä¸€ç§æ˜¯æµ®ç‚¹å‹ï¼ˆä¸æ¸…æ¥šçš„åŒå­¦å¯ä»¥å›å¤´çœ‹çœ‹[æ•°æ®ç±»å‹é‚£ç¯‡](https://tobebetterjavaer.com/basic-grammar/basic-data-type.html)ï¼‰ï¼Œæ•´å‹å’Œæ•´å‹çš„è¿ç®—ç»“æœå°±æ˜¯æ•´å‹ï¼Œä¸ä¼šå‡ºç°æµ®ç‚¹å‹ã€‚å¦åˆ™ï¼Œå°±ä¼šå‡ºç°æµ®ç‚¹å‹ã€‚

```java
int a = 10;
float c = 3.0f;
double d = 3.0;
System.out.println(a / c); // 3.3333333
System.out.println(a / d); // 3.3333333333333335
System.out.println(a % c); // 1.0
System.out.println(a % d); // 1.0
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“æµ®ç‚¹æ•°é™¤ä»¥ 0 çš„æ—¶å€™ï¼Œç»“æœä¸º Infinity æˆ–è€… NaNã€‚

```java
System.out.println(10.0 / 0.0); // Infinity
System.out.println(0.0 / 0.0); // NaN
```

Infinity çš„ä¸­æ–‡æ„æ€æ˜¯æ— ç©·å¤§ï¼ŒNaN çš„ä¸­æ–‡æ„æ€æ˜¯è¿™ä¸æ˜¯ä¸€ä¸ªæ•°å­—ï¼ˆNot a Numberï¼‰ã€‚

å½“æ•´æ•°é™¤ä»¥ 0 çš„æ—¶å€™ï¼ˆ`10 / 0`ï¼‰ï¼Œä¼šæŠ›å‡º[å¼‚å¸¸](https://tobebetterjavaer.com/exception/gailan.html)ï¼š

```
Exception in thread "main" java.lang.ArithmeticException: / by zero
	at com.itwanger.eleven.ArithmeticOperator.main(ArithmeticOperator.java:32)
```

æ‰€ä»¥æ•´æ•°åœ¨è¿›è¡Œé™¤æ³•è¿ç®—æ—¶ï¼Œéœ€è¦å…ˆåˆ¤æ–­é™¤æ•°æ˜¯å¦ä¸º 0ï¼Œä»¥å…ç¨‹åºæŠ›å‡ºå¼‚å¸¸ã€‚

ç®—æœ¯è¿ç®—ç¬¦ä¸­è¿˜æœ‰ä¸¤ç§ç‰¹æ®Šçš„è¿ç®—ç¬¦ï¼Œè‡ªå¢è¿ç®—ç¬¦ï¼ˆ++ï¼‰å’Œè‡ªå‡è¿ç®—ç¬¦ï¼ˆ--ï¼‰ï¼Œå®ƒä»¬ä¹Ÿå«åšä¸€å…ƒè¿ç®—ç¬¦ï¼Œåªæœ‰ä¸€ä¸ªæ“ä½œæ•°ã€‚

```java
int x = 10;
System.out.println(x++);//10 (11)  
System.out.println(++x);//12  
System.out.println(x--);//12 (11)  
System.out.println(--x);//10  
```

ä¸€å…ƒè¿ç®—ç¬¦å¯ä»¥æ”¾åœ¨æ•°å­—çš„å‰é¢æˆ–è€…åé¢ï¼Œæ”¾åœ¨å‰é¢å«å‰è‡ªå¢ï¼ˆå‰è‡ªå‡ï¼‰ï¼Œæ”¾åœ¨åé¢å«åè‡ªå¢ï¼ˆåè‡ªå‡ï¼‰ã€‚

å‰è‡ªå¢å’Œåè‡ªå¢æ˜¯æœ‰åŒºåˆ«çš„ï¼Œæ‹¿ `int y = ++x` è¿™ä¸ªè¡¨è¾¾å¼æ¥è¯´ï¼ˆx = 10ï¼‰ï¼Œå®ƒå¯ä»¥æ‹†åˆ†ä¸º `x = x+1 = 11; y = x = 11`ï¼Œæ‰€ä»¥è¡¨è¾¾å¼çš„ç»“æœä¸º `x = 11, y = 11`ã€‚æ‹¿ `int y = x++` è¿™ä¸ªè¡¨è¾¾å¼æ¥è¯´ï¼ˆx = 10ï¼‰ï¼Œå®ƒå¯ä»¥æ‹†åˆ†ä¸º `y = x = 10; x = x+1 = 11`ï¼Œæ‰€ä»¥è¡¨è¾¾å¼çš„ç»“æœä¸º `x = 11, y = 10`ã€‚

```java
int x = 10;
int y = ++x;
System.out.println(y + " " + x);// 11 11

x = 10;
y = x++;
System.out.println(y + " " + x);// 10 11
```

å¯¹äºå‰è‡ªå‡å’Œåè‡ªå‡æ¥è¯´ï¼Œä½ å¯ä»¥è‡ªå·±è¯•ä¸€æŠŠã€‚

### 02ã€å…³ç³»è¿ç®—ç¬¦

å…³ç³»è¿ç®—ç¬¦ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªæ“ä½œæ•°ï¼Œè¿”å›ç»“æœä¸º true æˆ–è€… falseã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-grammar/eleven-02.png)

æ¥çœ‹ç¤ºä¾‹ï¼š

```java
int a = 10, b = 20;
System.out.println(a == b); // false
System.out.println(a != b); // true
System.out.println(a > b); // false
System.out.println(a < b); // true
System.out.println(a >= b); // false
System.out.println(a <= b); // true
```

### 03ã€ä½è¿ç®—ç¬¦

åœ¨å­¦ä¹ ä½è¿ç®—ç¬¦ä¹‹å‰ï¼Œéœ€è¦å…ˆå­¦ä¹ ä¸€ä¸‹äºŒè¿›åˆ¶ï¼Œå› ä¸ºä½è¿ç®—ç¬¦æ“ä½œçš„ä¸æ˜¯æ•´å‹æ•°å€¼ï¼ˆintã€longã€shortã€charã€byteï¼‰æœ¬èº«ï¼Œè€Œæ˜¯æ•´å‹æ•°å€¼å¯¹åº”çš„äºŒè¿›åˆ¶ã€‚

```java
System.out.println(Integer.toBinaryString(60)); // 111100
System.out.println(Integer.toBinaryString(13)); // 1101
```

 ä»ç¨‹åºçš„è¾“å‡ºç»“æœå¯ä»¥çœ‹å¾—å‡ºæ¥ï¼Œ60 çš„äºŒè¿›åˆ¶æ˜¯ 0011 1100ï¼ˆç”¨ 0 è¡¥åˆ° 8 ä½ï¼‰ï¼Œ13 çš„äºŒè¿›åˆ¶æ˜¯ 0000 1101ã€‚

PSï¼šç°ä»£çš„äºŒè¿›åˆ¶è®°æ•°ç³»ç»Ÿç”±æˆˆç‰¹å¼—é‡Œå¾·Â·å¨å»‰Â·è±å¸ƒå°¼èŒ¨äº 1679 å¹´è®¾è®¡ã€‚è±å¸ƒå°¼èŒ¨æ˜¯å¾·æ„å¿—å“²å­¦å®¶ã€æ•°å­¦å®¶ï¼Œå†å²ä¸Šå°‘è§çš„é€šæ‰ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-grammar/eleven-03.png)

æ¥çœ‹ç¤ºä¾‹ï¼š

```java
int a = 60, b = 13;
System.out.println("a çš„äºŒè¿›åˆ¶ï¼š" + Integer.toBinaryString(a)); // 111100
System.out.println("b çš„äºŒè¿›åˆ¶ï¼š" + Integer.toBinaryString(b)); // 1101

int c = a & b;
System.out.println("a & bï¼š" + c + "ï¼ŒäºŒè¿›åˆ¶æ˜¯ï¼š" + Integer.toBinaryString(c));

c = a | b;
System.out.println("a | bï¼š" + c + "ï¼ŒäºŒè¿›åˆ¶æ˜¯ï¼š" + Integer.toBinaryString(c));

c = a ^ b;
System.out.println("a ^ bï¼š" + c + "ï¼ŒäºŒè¿›åˆ¶æ˜¯ï¼š" + Integer.toBinaryString(c));

c = ~a;
System.out.println("~aï¼š" + c + "ï¼ŒäºŒè¿›åˆ¶æ˜¯ï¼š" + Integer.toBinaryString(c));

c = a << 2;
System.out.println("a << 2ï¼š" + c + "ï¼ŒäºŒè¿›åˆ¶æ˜¯ï¼š" + Integer.toBinaryString(c));

c = a >> 2;
System.out.println("a >> 2ï¼š" + c + "ï¼ŒäºŒè¿›åˆ¶æ˜¯ï¼š" + Integer.toBinaryString(c));

c = a >>> 2;
System.out.println("a >>> 2ï¼š" + c + "ï¼ŒäºŒè¿›åˆ¶æ˜¯ï¼š" + Integer.toBinaryString(c));
```

å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œä½è¿ç®—ç¬¦æ— æ³•ä»ç›´è§‚ä¸Šå»è®¡ç®—å‡ºç»“æœï¼Œä¸åƒåŠ å‡ä¹˜é™¤é‚£æ ·ã€‚å› ä¸ºæˆ‘ä»¬æ—¥å¸¸æ¥è§¦çš„éƒ½æ˜¯åè¿›åˆ¶ï¼Œä½è¿ç®—çš„æ—¶å€™éœ€è¦å…ˆè½¬æˆäºŒè¿›åˆ¶ï¼Œç„¶åå†è®¡ç®—å‡ºç»“æœã€‚

é‰´äºæ­¤ï¼Œåˆå­¦è€…åœ¨å†™ä»£ç çš„æ—¶å€™å…¶å®å¾ˆå°‘ä¼šç”¨åˆ°ä½è¿ç®—ã€‚å¯¹äºç¼–ç¨‹é«˜æ‰‹æ¥è¯´ï¼Œä¸ºäº†æé«˜ç¨‹åºçš„æ€§èƒ½ï¼Œä¼šåœ¨ä¸€äº›åœ°æ–¹ä½¿ç”¨ä½è¿ç®—ã€‚æ¯”å¦‚è¯´ï¼ŒHashMap åœ¨è®¡ç®—å“ˆå¸Œå€¼çš„æ—¶å€™ï¼š

```java
static final int hash(Object key) {
    int h;
    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
}
```

å¦‚æœå¯¹ä½è¿ç®—ä¸€ç‚¹éƒ½ä¸æ‡‚çš„è¯ï¼Œé‡åˆ°è¿™æ ·çš„æºç å°±å¾ˆåƒåŠ›ã€‚æ‰€ä»¥è¯´ï¼Œè™½ç„¶ä½è¿ç®—ç”¨çš„å°‘ï¼Œä½†è¿˜æ˜¯è¦æ‡‚ã€‚

1ï¼‰æŒ‰ä½å·¦ç§»è¿ç®—ç¬¦ï¼š

```java
System.out.println(10<<2);//10*2^2=10*4=40  
System.out.println(10<<3);//10*2^3=10*8=80  
System.out.println(20<<2);//20*2^2=20*4=80  
System.out.println(15<<4);//15*2^4=15*16=240 
```

`10<<2` ç­‰äº 10 ä¹˜ä»¥ 2 çš„ 2 æ¬¡æ–¹ï¼›`10<<3` ç­‰äº 10 ä¹˜ä»¥ 2 çš„ 3 æ¬¡æ–¹ã€‚

2ï¼‰æŒ‰ä½å³ç§»è¿ç®—ç¬¦ï¼š

```java
System.out.println(10>>2);//10/2^2=10/4=2
System.out.println(20>>2);//20/2^2=20/4=5
System.out.println(20>>3);//20/2^3=20/8=2
```

`10>>2` ç­‰äº 10 é™¤ä»¥ 2 çš„ 2 æ¬¡æ–¹ï¼›`20>>2` ç­‰äº 20 é™¤ä»¥ 2 çš„ 2 æ¬¡æ–¹ã€‚

### 04ã€é€»è¾‘è¿ç®—ç¬¦

é€»è¾‘ä¸è¿ç®—ç¬¦ï¼ˆ&&ï¼‰ï¼šå¤šä¸ªæ¡ä»¶ä¸­åªè¦æœ‰ä¸€ä¸ªä¸º false ç»“æœå°±ä¸º falseã€‚

é€»è¾‘æˆ–è¿ç®—ç¬¦ï¼ˆ||ï¼‰ï¼šå¤šä¸ªæ¡ä»¶åªè¦æœ‰ä¸€ä¸ªä¸º true ç»“æœå°±ä¸º trueã€‚

```java
int a=10;
int b=5;
int c=20;
System.out.println(a<b&&a<c);//false && true = false

System.out.println(a>b||a<c);//true || true = true
```

é€»è¾‘éè¿ç®—ç¬¦ï¼ˆ!ï¼‰ï¼šç”¨æ¥åè½¬æ¡ä»¶çš„ç»“æœï¼Œå¦‚æœæ¡ä»¶ä¸º trueï¼Œåˆ™é€»è¾‘éè¿ç®—ç¬¦å°†å¾—åˆ° falseã€‚

å•é€»è¾‘ä¸è¿ç®—ç¬¦ï¼ˆ&ï¼‰ï¼šå¾ˆå°‘ç”¨ï¼Œå› ä¸ºä¸ç®¡ç¬¬ä¸€ä¸ªæ¡ä»¶ä¸º true è¿˜æ˜¯ falseï¼Œä¾ç„¶ä¼šæ£€æŸ¥ç¬¬äºŒä¸ªã€‚

å•é€»è¾‘æˆ–è¿ç®—ç¬¦ï¼ˆ|ï¼‰ï¼šä¹Ÿä¼šæ£€æŸ¥ç¬¬äºŒä¸ªæ¡ä»¶ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œ& å’Œ | æ€§èƒ½ä¸å¦‚ && å’Œ ||ï¼Œä½†ç”¨æ³•ä¸€æ ·ï¼š

```java
int a=10;
int b=5;
int c=20;
System.out.println(a<b&a<c);//false & true = false

System.out.println(a>b|a<c);//true | true = true  
```

### 05ã€èµ‹å€¼è¿ç®—ç¬¦

èµ‹å€¼æ“ä½œç¬¦ææ€•æ˜¯ Java ä¸­ä½¿ç”¨æœ€é¢‘ç¹çš„æ“ä½œç¬¦äº†ï¼Œå®ƒå°±æ˜¯æŠŠæ“ä½œç¬¦å³ä¾§çš„å€¼èµ‹å€¼ç»™å·¦ä¾§çš„å˜é‡ã€‚æ¥çœ‹ç¤ºä¾‹ï¼š

```java
int a=10;
int b=20;
a+=4;//a=a+4 (a=10+4)  
b-=4;//b=b-4 (b=20-4)  
System.out.println(a);
System.out.println(b);
```

ä¸è¿‡åœ¨è¿›è¡Œæ•°å€¼çš„èµ‹å€¼æ—¶ï¼Œéœ€è¦å°ç‚¹å¿ƒï¼Œæ¯”å¦‚è¯´ä¸‹é¢è¿™ç§æƒ…å†µï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-grammar/eleven-04.png)

ç¼–è¯‘å™¨ä¹‹æ‰€ä»¥æç¤ºé”™è¯¯ï¼Œæ˜¯å› ä¸º = å³ä¾§çš„ç®—æœ¯è¡¨è¾¾å¼é»˜è®¤ä¸º int ç±»å‹ï¼Œå·¦ä¾§æ˜¯ short ç±»å‹çš„æ—¶å€™éœ€è¦è¿›è¡Œå¼ºè½¬ã€‚

```java
short a = 10;
short b = 10;
//a+=b;//a=a+b internally so fine
a = (short)(a + b);
System.out.println(a);
```

é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜ä¼šæœ‰è¾¹ç•Œé—®é¢˜ï¼Œæ¯”å¦‚è¯´ï¼Œä¸¤ä¸ªéå¸¸å¤§çš„ int ç›¸ä¹˜ï¼Œç»“æœå¯èƒ½å°±è¶…å‡ºäº† int çš„èŒƒå›´ï¼š

```java
int a = Integer.MAX_VALUE;
int b = 10000;
int c = a * b;
System.out.println(c); // -10000
```

ç¨‹åºè¾“å‡ºçš„ç»“æœä¸º -10000ï¼Œè¿™ä¸ªç­”æ¡ˆå¾ˆæ˜æ˜¾ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œè™½ç„¶å¯ä»¥é€šè¿‡å³ä¾§è¡¨è¾¾å¼å¼ºè½¬ long çš„æ–¹æ³•è§£å†³ï¼š

```java
int a = Integer.MAX_VALUE;
int b = 10000;
long c = (long)a * b;
System.out.println(c); // 21474836470000
```

ä½†å°½é‡ä¸è¦è¿™æ ·åšï¼Œç»“æœéå¸¸å¤§çš„æ—¶å€™ï¼Œå°½é‡æå‰ä½¿ç”¨ç›¸åº”çš„ç±»å‹è¿›è¡Œèµ‹å€¼ã€‚

```java
long a = Integer.MAX_VALUE - 1;
long b = 10000;
long c = a * b;
System.out.println(c); // 21474836460000
```

### 06ã€ä¸‰å…ƒè¿ç®—ç¬¦

ä¸‰å…ƒè¿ç®—ç¬¦ç”¨äºæ›¿ä»£ if-elseï¼Œå¯ä»¥ä½¿ç”¨ä¸€è¡Œä»£ç å®Œæˆæ¡ä»¶åˆ¤æ–­çš„è¦æ±‚ã€‚æ¥çœ‹ç¤ºä¾‹ï¼š

```java
int a=2;
int b=5;
int min=(a<b)?a:b;
System.out.println(min);
```

å¦‚æœ ? å‰é¢çš„æ¡ä»¶ä¸º trueï¼Œåˆ™ç»“æœä¸º : å‰çš„å€¼ï¼Œå¦åˆ™ä¸º : åçš„å€¼ã€‚

â€œå¥½äº†ï¼Œä¸‰å¦¹ï¼Œå…³äº Java è¿ç®—ç¬¦å°±å…ˆè¯´è¿™ä¹ˆå¤šå§ï¼Œä½ æ˜¯ä¸æ˜¯å·²ç»æ¸…æ¥šäº†ï¼Ÿâ€è½¬åŠ¨äº†ä¸€ä¸‹åƒµç¡¬çš„è„–å­åï¼Œæˆ‘å¯¹ä¸‰å¦¹è¯´ã€‚

â€œå·®ä¸å¤šï¼ŒäºŒå“¥ï¼Œæˆ‘éœ€è¦å†™ç‚¹ demo ç»ƒä¹ ä¼šã€‚â€

### 07ã€å°ç»“

æœ¬æ–‡å…¨é¢ä»‹ç»äº†Javaè¿ç®—ç¬¦ï¼ŒåŒ…æ‹¬ç®—æœ¯è¿ç®—ç¬¦ã€å…³ç³»è¿ç®—ç¬¦ã€é€»è¾‘è¿ç®—ç¬¦ã€ä½è¿ç®—ç¬¦ã€èµ‹å€¼è¿ç®—ç¬¦ç­‰ã€‚é€šè¿‡é˜…è¯»æœ¬æ–‡ï¼Œæ‚¨å°†äº†è§£åˆ°Javaè¿ç®—ç¬¦çš„åˆ†ç±»ã€ç”¨æ³•å’Œä¼˜å…ˆçº§ï¼Œä»¥åŠå¦‚ä½•åœ¨å®é™…å¼€å‘ä¸­çµæ´»è¿ç”¨å„ç±»è¿ç®—ç¬¦æé«˜ç¼–ç¨‹æ•ˆç‡ã€‚

---

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 3.7 Javaæµç¨‹æ§åˆ¶è¯­å¥

â€œäºŒå“¥ï¼Œæµç¨‹æ§åˆ¶è¯­å¥éƒ½æœ‰å“ªäº›å‘¢ï¼Ÿâ€ä¸‰å¦¹çš„è„¸ä¸Šæ³›ç€ç”œç”œçš„ç¬‘å®¹ï¼Œå¥¹å¼€å§‹å¯¹æ¥ä¸‹æ¥è¦å­¦ä¹ çš„å†…å®¹å……æ»¡æœŸå¾…äº†ï¼Œè¿™æ­£æ˜¯æˆ‘æ„Ÿåˆ°æ¬£æ…°çš„åœ°æ–¹ã€‚

â€œæ¯”å¦‚è¯´ if-elseã€switchã€forã€whileã€do-whileã€returnã€breakã€continue ç­‰ç­‰ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸ªæ¥äº†è§£ä¸‹ã€‚â€

### 01ã€if-else ç›¸å…³

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/control/thirteen-01.png)

#### **1ï¼‰if è¯­å¥**

if è¯­å¥çš„æ ¼å¼å¦‚ä¸‹ï¼š

```java
if(å¸ƒå°”è¡¨è¾¾å¼){  
// å¦‚æœæ¡ä»¶ä¸º trueï¼Œåˆ™æ‰§è¡Œè¿™å—ä»£ç 
} 
```

ç”»ä¸ªæµç¨‹å›¾è¡¨ç¤ºä¸€ä¸‹ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/control/thirteen-02.png)


æ¥å†™ä¸ªç¤ºä¾‹ï¼š

```java
int age = 20;
if (age < 30) {
    System.out.println("é’æ˜¥å¹´å");
}
```

è¾“å‡ºï¼š

```
é’æ˜¥å¹´å
```

#### **2ï¼‰if-else è¯­å¥**

if-else è¯­å¥çš„æ ¼å¼å¦‚ä¸‹:

```java
if(å¸ƒå°”è¡¨è¾¾å¼){  
// æ¡ä»¶ä¸º true æ—¶æ‰§è¡Œçš„ä»£ç å—
}else{  
// æ¡ä»¶ä¸º false  æ—¶æ‰§è¡Œçš„ä»£ç å—
}  
```

ç”»ä¸ªæµç¨‹å›¾è¡¨ç¤ºä¸€ä¸‹ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/control/thirteen-03.png)

æ¥å†™ä¸ªç¤ºä¾‹ï¼š

```java
int age = 31;
if (age < 30) {
    System.out.println("é’æ˜¥å¹´å");
} else {
    System.out.println("è€Œç«‹ä¹‹å¹´");
}
```

è¾“å‡ºï¼š

```
è€Œç«‹ä¹‹å¹´
```

é™¤äº†è¿™ä¸ªä¾‹å­ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªåˆ¤æ–­é—°å¹´ï¼ˆè¢« 4 æ•´é™¤ä½†ä¸èƒ½è¢« 100 æ•´é™¤æˆ–è€…è¢« 400 æ•´é™¤ï¼‰çš„ä¾‹å­ï¼š

```java
int year = 2020;
if (((year % 4 == 0) && (year % 100 != 0)) || (year % 400 == 0)) {
    System.out.println("é—°å¹´");
} else {
    System.out.println("æ™®é€šå¹´ä»½");
}
```

è¾“å‡ºï¼š

```
é—°å¹´
```

å¦‚æœæ‰§è¡Œè¯­å¥æ¯”è¾ƒç®€å•çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦æ¥ä»£æ›¿ if-else è¯­å¥ï¼Œå¦‚æœæ¡ä»¶ä¸º trueï¼Œè¿”å› ? åé¢ : å‰é¢çš„å€¼ï¼›å¦‚æœæ¡ä»¶ä¸º falseï¼Œè¿”å› : åé¢çš„å€¼ã€‚

```java
int num = 13;
String result = (num % 2 == 0) ? "å¶æ•°" : "å¥‡æ•°";
System.out.println(result);
```

è¾“å‡ºï¼š

```
å¥‡æ•°
```

#### **3ï¼‰if-else-if è¯­å¥**

if-else-if è¯­å¥çš„æ ¼å¼å¦‚ä¸‹ï¼š

```java
if(æ¡ä»¶1){  
// æ¡ä»¶1 ä¸º true æ—¶æ‰§è¡Œçš„ä»£ç 
}else if(æ¡ä»¶2){  
// æ¡ä»¶2 ä¸º true æ—¶æ‰§è¡Œçš„ä»£ç 
}  
else if(æ¡ä»¶3){  
// æ¡ä»¶3 ä¸º true æ—¶æ‰§è¡Œçš„ä»£ç 
}  
...  
else{  
// ä»¥ä¸Šæ¡ä»¶å‡ä¸º false æ—¶æ‰§è¡Œçš„ä»£ç 
} 
```

ç”»ä¸ªæµç¨‹å›¾è¡¨ç¤ºä¸€ä¸‹ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/control/thirteen-04.png)

æ¥å†™ä¸ªç¤ºä¾‹ï¼š

```java
int age = 31;
if (age < 30) {
    System.out.println("é’æ˜¥å¹´å");
} else if (age >= 30 && age < 40 ) {
    System.out.println("è€Œç«‹ä¹‹å¹´");
} else if (age >= 40 && age < 50 ) {
    System.out.println("ä¸æƒ‘ä¹‹å¹´");
} else {
    System.out.println("çŸ¥å¤©å‘½");
}
```

è¾“å‡ºï¼š

```
è€Œç«‹ä¹‹å¹´
```

#### **4ï¼‰if åµŒå¥—è¯­å¥**

if åµŒå¥—è¯­å¥çš„æ ¼å¼å¦‚ä¸‹ï¼š

```java
if(å¤–ä¾§æ¡ä»¶){    
     // å¤–ä¾§æ¡ä»¶ä¸º true æ—¶æ‰§è¡Œçš„ä»£ç  
    if(å†…ä¾§æ¡ä»¶){  
        // å†…ä¾§æ¡ä»¶ä¸º true æ—¶æ‰§è¡Œçš„ä»£ç 
    }    
}  
```

ç”»ä¸ªæµç¨‹å›¾è¡¨ç¤ºä¸€ä¸‹ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/control/thirteen-05.png)


æ¥å†™ä¸ªç¤ºä¾‹ï¼š

```java
int age = 20;
boolean isGirl = true;
if (age >= 20) {
    if (isGirl) {
        System.out.println("å¥³ç”Ÿæ³•å®šç»“å©šå¹´é¾„");
    }
}
```

è¾“å‡ºï¼š

```
å¥³ç”Ÿæ³•å®šç»“å©šå¹´é¾„
```

### 02ã€switch è¯­å¥

switch è¯­å¥ç”¨æ¥åˆ¤æ–­å˜é‡ä¸å¤šä¸ªå€¼ä¹‹é—´çš„ç›¸ç­‰æ€§ã€‚å˜é‡çš„ç±»å‹å¯ä»¥æ˜¯ byteã€shortã€int æˆ–è€… charï¼Œæˆ–è€…å¯¹åº”çš„åŒ…è£…å™¨ç±»å‹ Byteã€Shortã€Integerã€Characterï¼Œä»¥åŠ[å­—ç¬¦ä¸²](https://tobebetterjavaer.com/string/immutable.html)å’Œ[æšä¸¾](https://tobebetterjavaer.com/basic-extra-meal/enum.html)ç±»å‹ã€‚

æ¥çœ‹ä¸€ä¸‹ switch è¯­å¥çš„æ ¼å¼ï¼š

```java
switch(å˜é‡) {    
case å¯é€‰å€¼1:    
 // å¯é€‰å€¼1åŒ¹é…åæ‰§è¡Œçš„ä»£ç ;    
 break;  // è¯¥å…³é”®å­—æ˜¯å¯é€‰é¡¹
case å¯é€‰å€¼2:    
 // å¯é€‰å€¼2åŒ¹é…åæ‰§è¡Œçš„ä»£ç ;    
 break;  // è¯¥å…³é”®å­—æ˜¯å¯é€‰é¡¹
......    
    
default: // è¯¥å…³é”®å­—æ˜¯å¯é€‰é¡¹     
 // æ‰€æœ‰å¯é€‰å€¼éƒ½ä¸åŒ¹é…åæ‰§è¡Œçš„ä»£ç  
}    
```

- å˜é‡å¯ä»¥æœ‰ 1 ä¸ªæˆ–è€… N ä¸ªå€¼ã€‚
- å€¼ç±»å‹å¿…é¡»å’Œå˜é‡ç±»å‹æ˜¯ä¸€è‡´çš„ï¼Œå¹¶ä¸”å€¼æ˜¯ç¡®å®šçš„ã€‚
- å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œä¸èƒ½é‡å¤ï¼Œå¦åˆ™ç¼–è¯‘ä¼šå‡ºé”™ã€‚
- break å…³é”®å­—æ˜¯å¯é€‰çš„ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ‰§è¡Œä¸‹ä¸€ä¸ª caseï¼Œå¦‚æœæœ‰ï¼Œåˆ™è·³å‡º switch è¯­å¥ã€‚
- default å…³é”®å­—ä¹Ÿæ˜¯å¯é€‰çš„ã€‚

ç”»ä¸ªæµç¨‹å›¾ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/control/thirteen-06.png)

æ¥ä¸ªç¤ºä¾‹ï¼š

```java
int age = 20;
switch (age) {
    case 20 :
        System.out.println("ä¸Šå­¦");
        break;
    case 24 :
        System.out.println("è‹å·å·¥ä½œ");
        break;
    case 30 :
        System.out.println("æ´›é˜³å·¥ä½œ");
        break;
    default:
        System.out.println("æœªçŸ¥");
        break; // å¯çœç•¥
}
```

è¾“å‡ºï¼š

```
ä¸Šå­¦
```

å½“ä¸¤ä¸ªå€¼è¦æ‰§è¡Œçš„ä»£ç ç›¸åŒæ—¶ï¼Œå¯ä»¥æŠŠè¦æ‰§è¡Œçš„ä»£ç å†™åœ¨ä¸‹ä¸€ä¸ª case è¯­å¥ä¸­ï¼Œè€Œä¸Šä¸€ä¸ª case è¯­å¥ä¸­ä»€ä¹ˆä¹Ÿæ²¡æœ‰ï¼Œæ¥çœ‹ä¸€ä¸‹ç¤ºä¾‹ï¼š

```java
String name = "æ²‰é»˜ç‹äºŒ";
switch (name) {
    case "è©¹å§†æ–¯":
        System.out.println("ç¯®çƒè¿åŠ¨å‘˜");
        break;
    case "ç©†é‡Œå°¼å¥¥":
        System.out.println("è¶³çƒæ•™ç»ƒ");
        break;
    case "æ²‰é»˜ç‹äºŒ":
    case "æ²‰é»˜ç‹ä¸‰":
        System.out.println("ä¹’ä¹“çƒçˆ±å¥½è€…");
        break;
    default:
        throw new IllegalArgumentException(
                "åå­—æ²¡æœ‰åŒ¹é…é¡¹");

}
```

è¾“å‡ºï¼š

```
ä¹’ä¹“çƒçˆ±å¥½è€…
```

æšä¸¾ä½œä¸º switch è¯­å¥çš„å˜é‡ä¹Ÿå¾ˆå¸¸è§ï¼Œæ¥çœ‹ä¾‹å­ï¼š

```java
public class SwitchEnumDemo {
    public enum PlayerTypes {
        TENNIS,
        FOOTBALL,
        BASKETBALL,
        UNKNOWN
    }

    public static void main(String[] args) {
        System.out.println(createPlayer(PlayerTypes.BASKETBALL));
    }

    private static String createPlayer(PlayerTypes playerType) {
        switch (playerType) {
            case TENNIS:
                return "ç½‘çƒè¿åŠ¨å‘˜è´¹å¾·å‹’";
            case FOOTBALL:
                return "è¶³çƒè¿åŠ¨å‘˜Cç½—";
            case BASKETBALL:
                return "ç¯®çƒè¿åŠ¨å‘˜è©¹å§†æ–¯";
            case UNKNOWN:
                throw new IllegalArgumentException("æœªçŸ¥");
            default:
                throw new IllegalArgumentException(
                        "è¿åŠ¨å‘˜ç±»å‹: " + playerType);

        }
    }
}
```

è¾“å‡ºï¼š

```
ç¯®çƒè¿åŠ¨å‘˜è©¹å§†æ–¯
```

### 03ã€for å¾ªç¯

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/control/thirteen-07.png)

#### **1ï¼‰æ™®é€š for å¾ªç¯**

æ™®é€šçš„ for å¾ªç¯å¯ä»¥åˆ†ä¸º 4 ä¸ªéƒ¨åˆ†ï¼š

1ï¼‰åˆå§‹å˜é‡ï¼šå¾ªç¯å¼€å§‹æ‰§è¡Œæ—¶çš„åˆå§‹æ¡ä»¶ã€‚

2ï¼‰æ¡ä»¶ï¼šå¾ªç¯æ¯æ¬¡æ‰§è¡Œæ—¶è¦åˆ¤æ–­çš„æ¡ä»¶ï¼Œå¦‚æœä¸º trueï¼Œå°±æ‰§è¡Œå¾ªç¯ä½“ï¼›å¦‚æœä¸º falseï¼Œå°±è·³å‡ºå¾ªç¯ã€‚å½“ç„¶äº†ï¼Œæ¡ä»¶æ˜¯å¯é€‰çš„ï¼Œå¦‚æœæ²¡æœ‰æ¡ä»¶ï¼Œåˆ™ä¼šä¸€ç›´å¾ªç¯ã€‚

3ï¼‰å¾ªç¯ä½“ï¼šå¾ªç¯æ¯æ¬¡è¦æ‰§è¡Œçš„ä»£ç å—ï¼Œç›´åˆ°æ¡ä»¶å˜ä¸º falseã€‚

4ï¼‰è‡ªå¢/è‡ªå‡ï¼šåˆå§‹å˜é‡å˜åŒ–çš„æ–¹å¼ã€‚

æ¥çœ‹ä¸€ä¸‹æ™®é€š for å¾ªç¯çš„æ ¼å¼ï¼š

```java
for(åˆå§‹å˜é‡;æ¡ä»¶;è‡ªå¢/è‡ªå‡){  
// å¾ªç¯ä½“
}  
```

ç”»ä¸ªæµç¨‹å›¾ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/control/thirteen-08.png)


æ¥ä¸ªç¤ºä¾‹ï¼š

```java
for (int i = 0; i < 5; i++) {
    System.out.println("æ²‰é»˜ç‹ä¸‰å¥½ç¾å•Š");
}
```

è¾“å‡ºï¼š

```
æ²‰é»˜ç‹ä¸‰å¥½ç¾å•Š
æ²‰é»˜ç‹ä¸‰å¥½ç¾å•Š
æ²‰é»˜ç‹ä¸‰å¥½ç¾å•Š
æ²‰é»˜ç‹ä¸‰å¥½ç¾å•Š
æ²‰é»˜ç‹ä¸‰å¥½ç¾å•Š
```

â€œå“å‘€ï¼ŒäºŒå“¥ï¼Œä½ çœŸçš„æ˜¯å˜ç€æ³•å¤¸æˆ‘å•Šã€‚â€

â€œéä¹Ÿéä¹Ÿï¼Œä¸‰å¦¹ï¼Œä½ çœ‹ä¸å‡ºæˆ‘å…¶å®åœ¨å¤¸æˆ‘è‡ªå·±å—ï¼Ÿå¾ªç¯è¯­å¥è¿˜å¯ä»¥åµŒå¥—å‘¢ï¼Œè¿™æ ·å°±å¯ä»¥æ‰“å°å‡ºæ›´å¥½ç©çš„å‘¢ï¼Œä½ è¦ä¸è¦çœ‹çœ‹ï¼Ÿâ€

â€œå¥½å‘€å¥½å‘€ï¼â€

â€œçœ‹å¥½äº†å•Šã€‚â€

```java
for (int i = 0; i < 5; i++) {
    for (int j = 0;j<= i;j++) {
        System.out.print("â¤");
    }
    System.out.println();
}
```

æ‰“å°å‡ºä»€ä¹ˆç©æ„å‘¢ï¼Ÿ

```
â¤
â¤â¤
â¤â¤â¤
â¤â¤â¤â¤
â¤â¤â¤â¤â¤
```

â€œå“‡ï¼Œå¤ªä¸å¯æ€è®®äº†ï¼ŒäºŒå“¥ã€‚â€

â€œå˜¿å˜¿ã€‚â€

#### **2ï¼‰for-each**

for-each å¾ªç¯é€šå¸¸ç”¨äºéå†æ•°ç»„å’Œé›†åˆï¼Œå®ƒçš„ä½¿ç”¨è§„åˆ™æ¯”æ™®é€šçš„ for å¾ªç¯è¿˜è¦ç®€å•ï¼Œä¸éœ€è¦åˆå§‹å˜é‡ï¼Œä¸éœ€è¦æ¡ä»¶ï¼Œä¸éœ€è¦ä¸‹æ ‡æ¥è‡ªå¢æˆ–è€…è‡ªå‡ã€‚æ¥çœ‹ä¸€ä¸‹è¯­æ³•ï¼š

```java
for(å…ƒç´ ç±»å‹ å…ƒç´  : æ•°ç»„æˆ–é›†åˆ){  
// è¦æ‰§è¡Œçš„ä»£ç 
}  
```

æ¥çœ‹ä¸€ä¸‹ç¤ºä¾‹ï¼š

```java
String[] strs = {"æ²‰é»˜ç‹äºŒ", "ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜"};

for (String str : strs) {
    System.out.println(str);
}
```

è¾“å‡ºï¼š

```
æ²‰é»˜ç‹äºŒ
ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜
```

â€œå‘€ï¼ŒäºŒå“¥ï¼Œä½ å¼€å§‹ç‹å“¥å–ç“œäº†å•Šã€‚â€

â€œå˜¿å˜¿ï¼Œä¸‰å¦¹ï¼Œä½ è¿™æ ·è¯´å“¥ä¼šè„¸çº¢çš„ã€‚â€

#### **3ï¼‰æ— é™ for å¾ªç¯**

â€œä¸‰å¦¹ï¼Œä½ æƒ³ä¸æƒ³ä½“éªŒä¸€ä¸‹æ— é™ for å¾ªç¯çš„å¨åŠ›ï¼Œä¹Ÿå°±æ˜¯æ­»å¾ªç¯ã€‚â€

â€œäºŒå“¥ï¼Œé‚£ä¼šæœ‰ä»€ä¹ˆæ ·çš„åæœå•Šï¼Ÿâ€

â€œæ¥ï¼Œçœ‹çœ‹å°±çŸ¥é“äº†ã€‚â€

```java
for(;;){
    System.out.println("åœä¸ä¸‹æ¥ã€‚ã€‚ã€‚ã€‚");
}
```

è¾“å‡ºï¼š

```
åœä¸ä¸‹æ¥ã€‚ã€‚ã€‚ã€‚
åœä¸ä¸‹æ¥ã€‚ã€‚ã€‚ã€‚
åœä¸ä¸‹æ¥ã€‚ã€‚ã€‚ã€‚
åœä¸ä¸‹æ¥ã€‚ã€‚ã€‚ã€‚
```

ä¸€æ—¦è¿è¡Œèµ·æ¥ï¼Œå°±åœä¸ä¸‹æ¥äº†ï¼Œé™¤éå¼ºåˆ¶åœæ­¢ã€‚

### 04ã€while å¾ªç¯

æ¥çœ‹ä¸€ä¸‹ while å¾ªç¯çš„æ ¼å¼ï¼š

```java
while(æ¡ä»¶){  
//å¾ªç¯ä½“  
}  
```

ç”»ä¸ªæµç¨‹å›¾ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/control/thirteen-09.png)

æ¥ä¸ªç¤ºä¾‹ï¼š

```java
int i = 0;
while (true) {
    System.out.println("æ²‰é»˜ç‹ä¸‰");
    i++;
    if (i == 5) {
        break;
    }
}
```

â€œä¸‰å¦¹ï¼Œä½ çŒœçŒœä¼šè¾“å‡ºå‡ æ¬¡ï¼Ÿâ€

â€œäº”æ¬¡å—ï¼Ÿâ€

â€œå¯¹äº†ï¼Œä½ å¯çœŸèªæ˜ã€‚â€

```
æ²‰é»˜ç‹ä¸‰
æ²‰é»˜ç‹ä¸‰
æ²‰é»˜ç‹ä¸‰
æ²‰é»˜ç‹ä¸‰
æ²‰é»˜ç‹ä¸‰
```

â€œä¸‰å¦¹ï¼Œä½ æƒ³ä¸æƒ³ä½“éªŒä¸€ä¸‹æ— é™ while å¾ªç¯çš„å¨åŠ›ï¼Œä¹Ÿå°±æ˜¯æ­»å¾ªç¯ã€‚â€

â€œäºŒå“¥ï¼Œé‚£ä¼šæœ‰ä»€ä¹ˆæ ·çš„åæœå•Šï¼Ÿâ€

â€œæ¥ï¼Œçœ‹çœ‹å°±çŸ¥é“äº†ã€‚â€

```java
while (true) {
    System.out.println("åœä¸ä¸‹æ¥ã€‚ã€‚ã€‚ã€‚");
}
```

è¾“å‡ºï¼š

```
åœä¸ä¸‹æ¥ã€‚ã€‚ã€‚ã€‚
åœä¸ä¸‹æ¥ã€‚ã€‚ã€‚ã€‚
åœä¸ä¸‹æ¥ã€‚ã€‚ã€‚ã€‚
åœä¸ä¸‹æ¥ã€‚ã€‚ã€‚ã€‚
```

æŠŠ while çš„æ¡ä»¶è®¾ç½®ä¸º trueï¼Œå¹¶ä¸”å¾ªç¯ä½“ä¸­æ²¡æœ‰ break å…³é”®å­—çš„è¯ï¼Œç¨‹åºä¸€æ—¦è¿è¡Œèµ·æ¥ï¼Œå°±æ ¹æœ¬åœä¸ä¸‹æ¥äº†ï¼Œé™¤éå¼ºåˆ¶åœæ­¢ã€‚

### 05ã€do-while å¾ªç¯

æ¥çœ‹ä¸€ä¸‹ do-while å¾ªç¯çš„æ ¼å¼ï¼š

```java
do{  
// å¾ªç¯ä½“
}while(æäº¤);  
```

ç”»ä¸ªæµç¨‹å›¾ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/control/thirteen-10.png)

æ¥ä¸ªç¤ºä¾‹ï¼š

```java
int i = 0;
do {
    System.out.println("æ²‰é»˜ç‹ä¸‰");
    i++;
    if (i == 5) {
        break;
    }
} while (true);
```

â€œä¸‰å¦¹ï¼Œä½ çŒœçŒœä¼šè¾“å‡ºå‡ æ¬¡ï¼Ÿâ€

â€œäº”æ¬¡å—ï¼Ÿâ€

â€œå¯¹äº†ï¼Œä½ å¯çœŸèªæ˜ã€‚â€

```
æ²‰é»˜ç‹ä¸‰
æ²‰é»˜ç‹ä¸‰
æ²‰é»˜ç‹ä¸‰
æ²‰é»˜ç‹ä¸‰
æ²‰é»˜ç‹ä¸‰
```

â€œä¸‰å¦¹ï¼Œä½ æƒ³ä¸æƒ³ä½“éªŒä¸€ä¸‹æ— é™ do-while å¾ªç¯çš„å¨åŠ›......â€

â€œäºŒå“¥ï¼Œåˆæ¥å•Šï¼Œæˆ‘éƒ½è…»äº†ã€‚â€

â€œæ¥å§ï¼Œä¾‹è¡Œå…¬äº‹ï¼Œå°±å‡è£…çœ‹çœ‹å˜›ã€‚â€

```java
do {
    System.out.println("åœä¸ä¸‹æ¥ã€‚ã€‚ã€‚ã€‚");
} while (true);
```

è¾“å‡ºï¼š

```
åœä¸ä¸‹æ¥ã€‚ã€‚ã€‚ã€‚
åœä¸ä¸‹æ¥ã€‚ã€‚ã€‚ã€‚
åœä¸ä¸‹æ¥ã€‚ã€‚ã€‚ã€‚
åœä¸ä¸‹æ¥ã€‚ã€‚ã€‚ã€‚
```

æŠŠ do-while çš„æ¡ä»¶è®¾ç½®ä¸º trueï¼Œå¹¶ä¸”å¾ªç¯ä½“ä¸­æ²¡æœ‰ break å…³é”®å­—çš„è¯ï¼Œç¨‹åºä¸€æ—¦è¿è¡Œèµ·æ¥ï¼Œå°±æ ¹æœ¬åœä¸ä¸‹æ¥äº†ï¼Œé™¤éå¼ºåˆ¶åœæ­¢ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/control/thirteen-11.png)

### 06ã€break

break å…³é”®å­—é€šå¸¸ç”¨äºä¸­æ–­å¾ªç¯æˆ– switch è¯­å¥ï¼Œå®ƒåœ¨æŒ‡å®šæ¡ä»¶ä¸‹ä¸­æ–­ç¨‹åºçš„å½“å‰æµç¨‹ã€‚å¦‚æœæ˜¯å†…éƒ¨å¾ªç¯ï¼Œåˆ™ä»…ä¸­æ–­å†…éƒ¨å¾ªç¯ã€‚

å¯ä»¥å°† break å…³é”®å­—ç”¨äºæ‰€æœ‰ç±»å‹å¾ªç¯è¯­å¥ä¸­ï¼Œæ¯”å¦‚è¯´ for å¾ªç¯ã€while å¾ªç¯ï¼Œä»¥åŠ do-while å¾ªç¯ã€‚

æ¥ç”»ä¸ªæµç¨‹å›¾æ„Ÿå—ä¸€ä¸‹ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/control/thirteen-12.png)

ç”¨åœ¨ for å¾ªç¯ä¸­çš„ç¤ºä¾‹ï¼š

```java
for (int i = 1; i <= 10; i++) {
    if (i == 5) {
        break;
    }
    System.out.println(i);
}
```

ç”¨åœ¨åµŒå¥— for å¾ªç¯ä¸­çš„ç¤ºä¾‹ï¼š

```java
for (int i = 1; i <= 3; i++) {
    for (int j = 1; j <= 3; j++) {
        if (i == 2 && j == 2) {
            break;
        }
        System.out.println(i + " " + j);
    }
}
```

ç”¨åœ¨ while å¾ªç¯ä¸­çš„ç¤ºä¾‹ï¼š

```java
int i = 1;
while (i <= 10) {
    if (i == 5) {
        i++;
        break;
    }
    System.out.println(i);
    i++;
}
```

ç”¨åœ¨ do-while å¾ªç¯ä¸­çš„ç¤ºä¾‹ï¼š

```java
int j = 1;
do {
    if (j == 5) { 
        j++;
        break;
    }
    System.out.println(j);
    j++;
} while (j <= 10);
```

ç”¨åœ¨ switch è¯­å¥ä¸­çš„ç¤ºä¾‹ï¼š

```java
switch (age) {
    case 20 :
        System.out.println("ä¸Šå­¦");
        break;
    case 24 :
        System.out.println("è‹å·å·¥ä½œ");
        break;
    case 30 :
        System.out.println("æ´›é˜³å·¥ä½œ");
        break;
    default:
        System.out.println("æœªçŸ¥");
        break; // å¯çœç•¥
}
```

### 07ã€continue

å½“æˆ‘ä»¬éœ€è¦åœ¨ for å¾ªç¯æˆ–è€… ï¼ˆdoï¼‰while å¾ªç¯ä¸­ç«‹å³è·³è½¬åˆ°ä¸‹ä¸€ä¸ªå¾ªç¯æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ continue å…³é”®å­—ï¼Œé€šå¸¸ç”¨äºè·³è¿‡æŒ‡å®šæ¡ä»¶ä¸‹çš„å¾ªç¯ä½“ï¼Œå¦‚æœå¾ªç¯æ˜¯åµŒå¥—çš„ï¼Œä»…è·³è¿‡å½“å‰å¾ªç¯ã€‚

æ¥ä¸ªç¤ºä¾‹ï¼š

```java
for (int i = 1; i <= 10; i++) {
    if (i == 5) {
        // ä½¿ç”¨ continue å…³é”®å­—
        continue;// 5 å°†ä¼šè¢«è·³è¿‡
    }
    System.out.println(i);
}
```

è¾“å‡ºï¼š

```
1
2
3
4
6
7
8
9
10
```

â€œäºŒå“¥ï¼Œ5 çœŸçš„è¢«è·³è¿‡äº†å‘€ã€‚â€

â€œé‚£å¿…é¡»æ»´ã€‚ä¸ç„¶å°±æ˜¯ bugã€‚â€

å†æ¥ä¸ªå¾ªç¯åµŒå¥—çš„ä¾‹å­ã€‚

```java
for (int i = 1; i <= 3; i++) {
    for (int j = 1; j <= 3; j++) {
        if (i == 2 && j == 2) {
            //  å½“i=2ï¼Œj=2æ—¶è·³è¿‡
            continue;
        }
        System.out.println(i + " " + j);
    }
}
```

æ‰“å°å‡ºä»€ä¹ˆç©æ„å‘¢ï¼Ÿ

```
1 1
1 2
1 3
2 1
2 3
3 1
3 2
3 3
```

â€œ2 2â€ æ²¡æœ‰è¾“å‡ºï¼Œè¢«è·³è¿‡äº†ã€‚

å†æ¥çœ‹ä¸€ä¸‹ while å¾ªç¯æ—¶ continue çš„ä½¿ç”¨ç¤ºä¾‹ï¼š

```java
int i = 1;
while (i <= 10) {
    if (i == 5) {
        i++;
        continue;
    }
    System.out.println(i);
    i++;
}
```

è¾“å‡ºï¼š

```
1
2
3
4
6
7
8
9
10
```

æ³¨æ„ï¼šå¦‚æœæŠŠ if æ¡ä»¶ä¸­çš„â€œi++â€çœç•¥æ‰çš„è¯ï¼Œç¨‹åºå°±ä¼šè¿›å…¥æ­»å¾ªç¯ï¼Œä¸€ç›´åœ¨ continueã€‚

æœ€åï¼Œå†æ¥çœ‹ä¸€ä¸‹ do-while å¾ªç¯æ—¶ continue çš„ä½¿ç”¨ç¤ºä¾‹ï¼š

```java
int i=1;
do{
    if(i==5){
        i++;
        continue;
    }
    System.out.println(i);
    i++;
}while(i<=10);
```

è¾“å‡ºï¼š

```
1
2
3
4
6
7
8
9
10
```

æ³¨æ„ï¼šåŒæ ·çš„ï¼Œå¦‚æœæŠŠ if æ¡ä»¶ä¸­çš„â€œi++â€çœç•¥æ‰çš„è¯ï¼Œç¨‹åºå°±ä¼šè¿›å…¥æ­»å¾ªç¯ï¼Œä¸€ç›´åœ¨ continueã€‚

### 08ã€å°ç»“

æœ¬æ–‡å…¨é¢è®²è§£äº†Javaæµç¨‹æ§åˆ¶è¯­å¥ï¼ŒåŒ…æ‹¬ifã€switchã€whileã€forç­‰ç»“æ„ã€‚é€šè¿‡å­¦ä¹ æœ¬æ–‡ï¼Œä½ å°†äº†è§£åˆ°Javaæµç¨‹æ§åˆ¶è¯­å¥çš„åŸºæœ¬æ¦‚å¿µã€è¯­æ³•ç»“æ„å’Œä½¿ç”¨åœºæ™¯ï¼Œå¸®åŠ©ä½ åœ¨å®é™…ç¼–ç¨‹è¿‡ç¨‹ä¸­æ›´åŠ çµæ´»åœ°è¿ç”¨å„ç±»æ§åˆ¶ç»“æ„ã€‚

---

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

# ç¬¬å››ç« ï¼šæ•°ç»„&å­—ç¬¦ä¸²

## 4.1 æŒæ¡Javaæ•°ç»„

â€œäºŒå“¥ï¼Œæˆ‘çœ‹ä½ å…¬ä¼—å·çš„ä¸€ç¯‡æ–‡ç« é‡Œæåˆ°ï¼Œ[ArrayList](https://tobebetterjavaer.com/collection/arraylist.html) çš„å†…éƒ¨æ˜¯ç”¨æ•°ç»„å®ç°çš„ï¼Œæˆ‘å°±å¯¹æ•°ç»„éå¸¸æ„Ÿå…´è¶£ï¼Œæƒ³æ·±å…¥åœ°äº†è§£ä¸€ä¸‹ï¼Œä»Šå¤©ç»ˆäºåˆ°è¿™ä¸ªç¯èŠ‚äº†ï¼Œå¥½æœŸå¾…å‘€ï¼â€ä¸‰å¦¹çš„è¯­æ°”é‡Œæ˜¾å¾—å¾ˆå…´å¥‹ã€‚

â€œçš„ç¡®æ˜¯çš„ï¼Œçœ‹ ArrayList çš„æºç å°±ä¸€æ¸…äºŒæ¥šäº†ã€‚â€æˆ‘ä¸€è¾¹è¯´ï¼Œä¸€è¾¹æ‰“å¼€ Intellij IDEAï¼Œå¹¶æ‰¾åˆ°äº† ArrayList çš„æºç ã€‚

```java
/**
 * The array buffer into which the elements of the ArrayList are stored.
 * The capacity of the ArrayList is the length of this array buffer. Any
 * empty ArrayList with elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA
 * will be expanded to DEFAULT_CAPACITY when the first element is added.
 */
transient Object[] elementData; // non-private to simplify nested class access

/**
 * The size of the ArrayList (the number of elements it contains).
 *
 * @serial
 */
private int size;
```

â€œç§è§æ²¡ï¼Ÿ`Object[] elementData` å°±æ˜¯æ•°ç»„ã€‚â€æˆ‘æŒ‡ç€æ˜¾ç¤ºå±ä¸Šè¿™ä¸²ä»£ç ç»§ç»­è¯´ã€‚

æ•°ç»„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒåŒ…å«äº†ä¸€ç»„å›ºå®šæ•°é‡çš„å…ƒç´ ï¼Œå¹¶ä¸”è¿™äº›å…ƒç´ çš„ç±»å‹æ˜¯ç›¸åŒçš„ã€‚æ•°ç»„ä¼šæŒ‰ç…§ç´¢å¼•çš„æ–¹å¼å°†å…ƒç´ æ”¾åœ¨æŒ‡å®šçš„ä½ç½®ä¸Šï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡ç´¢å¼•æ¥è®¿é—®è¿™äº›å…ƒç´ ã€‚åœ¨ Java ä¸­ï¼Œç´¢å¼•æ˜¯ä» 0 å¼€å§‹çš„ã€‚

â€œå“¥ï¼Œèƒ½è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆç´¢å¼•ä» 0 å¼€å§‹å—ï¼Ÿâ€ä¸‰å¦¹çªç„¶è¿™ä¸ªè¯é¢˜å¾ˆæ„Ÿå…´è¶£ã€‚

â€œå“¦ï¼ŒJava æ˜¯åŸºäº C/C++ è¯­è¨€å®ç°çš„ï¼Œè€Œ C è¯­è¨€çš„ä¸‹æ ‡æ˜¯ä» 0 å¼€å§‹çš„ï¼Œæ‰€ä»¥ Java å°±ç»§æ‰¿äº†è¿™ä¸ªè‰¯å¥½çš„ä¼ ç»Ÿä¹ æƒ¯ã€‚Cè¯­è¨€æœ‰ä¸€ä¸ªå¾ˆé‡è¦æ¦‚å¿µï¼Œå«åšæŒ‡é’ˆï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªåç§»é‡ï¼Œè·ç¦»å¼€å§‹ä½ç½®çš„åç§»é‡ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ å°±åœ¨å¼€å§‹çš„ä½ç½®ï¼Œå®ƒçš„åç§»é‡å°±ä¸º 0ï¼Œæ‰€ä»¥ç´¢å¼•å°±ä¸º 0ã€‚â€æ­¤åˆ»ï¼Œæˆ‘å¾ˆè‡ªä¿¡ã€‚

â€œæ­¤å¤–ï¼Œè¿˜æœ‰å¦å¤–ä¸€ç§è¯´æ³•ã€‚æ—©æœŸçš„è®¡ç®—æœºèµ„æºæ¯”è¾ƒåŒ®ä¹ï¼Œ0 ä½œä¸ºèµ·å§‹ä¸‹æ ‡ç›¸æ¯”è¾ƒäº 1 ä½œä¸ºèµ·å§‹ä¸‹æ ‡ï¼Œç¼–è¯‘çš„æ•ˆç‡æ›´é«˜ã€‚â€

â€œå“¦ã€‚â€ä¸‰å¦¹æ„å‘³æ·±é•¿åœ°ç‚¹äº†ç‚¹å¤´ã€‚ 

æˆ‘ä»¬å¯ä»¥å°†æ•°ç»„ç†è§£ä¸ºä¸€ä¸ªä¸ªæ•´é½æ’åˆ—çš„å•å…ƒæ ¼ï¼Œæ¯ä¸ªå•å…ƒæ ¼é‡Œé¢å­˜æ”¾ç€ä¸€ä¸ªå…ƒç´ ã€‚

æ•°ç»„å…ƒç´ çš„ç±»å‹å¯ä»¥æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆæ¯”å¦‚è¯´ intã€doubleï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼ˆæ¯”å¦‚è¯´ Stringï¼‰ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰ç±»å‹ã€‚

æ•°ç»„çš„å£°æ˜æ–¹å¼åˆ†ä¸¤ç§ã€‚

å…ˆæ¥çœ‹ç¬¬ä¸€ç§ï¼š

```java
int[] anArray;
```

å†æ¥çœ‹ç¬¬äºŒç§ï¼š

```java
int anOtherArray[];
```

ä¸åŒä¹‹å¤„å°±åœ¨äºä¸­æ‹¬å·çš„ä½ç½®ï¼Œæ˜¯è·Ÿåœ¨ç±»å‹å…³é”®å­—çš„åé¢ï¼Œè¿˜æ˜¯è·Ÿåœ¨å˜é‡çš„åç§°çš„åé¢ã€‚å‰ä¸€ç§çš„ä½¿ç”¨é¢‘ç‡æ›´é«˜ä¸€äº›ï¼Œåƒ ArrayList çš„æºç ä¸­å°±ç”¨äº†ç¬¬ä¸€ç§æ–¹å¼ã€‚

åŒæ ·çš„ï¼Œæ•°ç»„çš„åˆå§‹åŒ–æ–¹å¼ä¹Ÿæœ‰å¤šç§ï¼Œæœ€å¸¸è§çš„æ˜¯ï¼š

```java
int[] anArray = new int[10];
```

çœ‹åˆ°äº†æ²¡ï¼Ÿä¸Šé¢è¿™è¡Œä»£ç ä¸­ä½¿ç”¨äº† new å…³é”®å­—ï¼Œè¿™å°±æ„å‘³ç€æ•°ç»„çš„ç¡®æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåªæœ‰å¯¹è±¡çš„åˆ›å»ºæ‰ä¼šç”¨åˆ° new å…³é”®å­—ï¼Œ[åŸºæœ¬æ•°æ®ç±»å‹](https://tobebetterjavaer.com/basic-grammar/basic-data-type.html)æ˜¯ä¸ç”¨çš„ã€‚ç„¶åï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ–¹æ‹¬å·ä¸­æŒ‡å®šæ•°ç»„çš„é•¿åº¦ã€‚

è¿™æ—¶å€™ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½ä¼šè¢«åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ï¼Œint ç±»å‹çš„å°±ä¸º 0ï¼ŒObject ç±»å‹çš„å°±ä¸º nullã€‚ ä¸åŒæ•°æ®ç±»å‹çš„é»˜è®¤å€¼ä¸åŒï¼Œå¯ä»¥å‚ç…§[ä¹‹å‰çš„æ–‡ç« ](https://tobebetterjavaer.com/basic-grammar/basic-data-type.html)ã€‚

å¦å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å¤§æ‹¬å·çš„æ–¹å¼ï¼Œç›´æ¥åˆå§‹åŒ–æ•°ç»„ä¸­çš„å…ƒç´ ï¼š

```java
int anOtherArray[] = new int[] {1, 2, 3, 4, 5};
```

è¿™æ—¶å€™ï¼Œæ•°ç»„çš„å…ƒç´ åˆ†åˆ«æ˜¯ 1ã€2ã€3ã€4ã€5ï¼Œç´¢å¼•ä¾æ¬¡æ˜¯ 0ã€1ã€2ã€3ã€4ï¼Œé•¿åº¦æ˜¯ 5ã€‚

â€œå“¥ï¼Œæ€ä¹ˆè®¿é—®æ•°ç»„å‘¢ï¼Ÿâ€ä¸‰å¦¹åŠæ—¶åœ°æ’è¯åˆ°ã€‚

å‰é¢æåˆ°è¿‡ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•æ¥è®¿é—®æ•°ç»„çš„å…ƒç´ ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š

```java
anArray[0] = 10;
```

å˜é‡åï¼ŒåŠ ä¸Šä¸­æ‹¬å·ï¼ŒåŠ ä¸Šå…ƒç´ çš„ç´¢å¼•ï¼Œå°±å¯ä»¥è®¿é—®åˆ°æ•°ç»„ï¼Œé€šè¿‡â€œ=â€æ“ä½œç¬¦å¯ä»¥å¯¹å…ƒç´ è¿›è¡Œèµ‹å€¼ã€‚

å¦‚æœç´¢å¼•çš„å€¼è¶…å‡ºäº†æ•°ç»„çš„ç•Œé™ï¼Œå°±ä¼šæŠ›å‡º `ArrayIndexOutOfBoundException`ã€‚

æ—¢ç„¶æ•°ç»„çš„ç´¢å¼•æ˜¯ä» 0 å¼€å§‹ï¼Œé‚£å°±æ˜¯åˆ°æ•°ç»„çš„ `length - 1` ç»“æŸï¼Œä¸è¦ä½¿ç”¨è¶…å‡ºè¿™ä¸ªèŒƒå›´å†…çš„ç´¢å¼•è®¿é—®æ•°ç»„ï¼Œå°±ä¸ä¼šæŠ›å‡ºæ•°ç»„è¶Šç•Œçš„å¼‚å¸¸äº†ã€‚ 

å½“æ•°ç»„çš„å…ƒç´ éå¸¸å¤šçš„æ—¶å€™ï¼Œé€ä¸ªè®¿é—®æ•°ç»„å°±å¤ªè¾›è‹¦äº†ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡éå†çš„æ–¹å¼ã€‚

ç¬¬ä¸€ç§ï¼Œä½¿ç”¨ for å¾ªç¯ï¼š

```java
int anOtherArray[] = new int[] {1, 2, 3, 4, 5};
for (int i = 0; i < anOtherArray.length; i++) {
    System.out.println(anOtherArray[i]);
}
```

é€šè¿‡ length å±æ€§è·å–åˆ°æ•°ç»„çš„é•¿åº¦ï¼Œç„¶åä» 0 å¼€å§‹éå†ï¼Œå°±å¾—åˆ°äº†æ•°ç»„çš„æ‰€æœ‰å…ƒç´ ã€‚

ç¬¬äºŒç§ï¼Œä½¿ç”¨ for-each å¾ªç¯ï¼š

```java
for (int element : anOtherArray) {
    System.out.println(element);
}
```

å¦‚æœä¸éœ€è¦å…³å¿ƒç´¢å¼•çš„è¯ï¼ˆæ„å‘³ç€ä¸éœ€è¦ä¿®æ”¹æ•°ç»„çš„æŸä¸ªå…ƒç´ ï¼‰ï¼Œä½¿ç”¨ for-each éå†æ›´ç®€æ´ä¸€äº›ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ while å’Œ do-while å¾ªç¯ã€‚

åœ¨ Java ä¸­ï¼Œå¯å˜å‚æ•°ç”¨äºå°†ä»»æ„æ•°é‡çš„å‚æ•°ä¼ é€’ç»™æ–¹æ³•ï¼Œæ¥çœ‹ `varargsMethod()` æ–¹æ³•ï¼š

```java
void varargsMethod(String... varargs) {}
```

è¯¥æ–¹æ³•å¯ä»¥æ¥æ”¶ä»»æ„æ•°é‡çš„å­—ç¬¦ä¸²å‚æ•°ï¼Œå¯ä»¥æ˜¯ 0 ä¸ªæˆ–è€… N ä¸ªï¼Œæœ¬è´¨ä¸Šï¼Œå¯å˜å‚æ•°å°±æ˜¯é€šè¿‡æ•°ç»„å®ç°çš„ã€‚ä¸ºäº†è¯æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹åç¼–è¯‘ä¸€åçš„å­—èŠ‚ç ï¼š

```java
public class VarargsDemo
{

    public VarargsDemo()
    {
    }

    transient void varargsMethod(String as[])
    {
    }
}
```

æ‰€ä»¥ï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥ç›´æ¥å°†æ•°ç»„ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¯¥æ–¹æ³•ï¼š

```java
VarargsDemo demo = new VarargsDemo();
String[] anArray = new String[] {"æ²‰é»˜ç‹äºŒ", "ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜"};
demo.varargsMethod(anArray);
```

ä¹Ÿå¯ä»¥ç›´æ¥ä¼ é€’å¤šä¸ªå­—ç¬¦ä¸²ï¼Œé€šè¿‡é€—å·éš”å¼€çš„æ–¹å¼ï¼š

```java
demo.varargsMethod("æ²‰é»˜ç‹äºŒ", "ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜");
```

åœ¨ Java ä¸­ï¼Œæ•°ç»„ä¸ List å…³ç³»éå¸¸å¯†åˆ‡ã€‚List å°è£…äº†å¾ˆå¤šå¸¸ç”¨çš„æ–¹æ³•ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹é›†åˆè¿›è¡Œä¸€äº›æ“ä½œï¼Œè€Œå¦‚æœç›´æ¥æ“ä½œæ•°ç»„çš„è¯ï¼Œæœ‰å¾ˆå¤šä¸ä¾¿ï¼Œå› ä¸ºæ•°ç»„æœ¬èº«æ²¡æœ‰æä¾›è¿™äº›å°è£…å¥½çš„æ“ä½œï¼Œæ‰€ä»¥æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æŠŠæ•°ç»„è½¬æˆ Listã€‚

â€œæ€ä¹ˆè½¬å‘¢ï¼Ÿâ€ä¸‰å¦¹é—®åˆ°ã€‚

æœ€åŸå§‹çš„æ–¹å¼ï¼Œå°±æ˜¯é€šè¿‡éå†æ•°ç»„çš„æ–¹å¼ï¼Œä¸€ä¸ªä¸ªå°†æ•°ç»„æ·»åŠ åˆ° List ä¸­ã€‚

```java
int[] anArray = new int[] {1, 2, 3, 4, 5};

List<Integer> aList = new ArrayList<>();
for (int element : anArray) {
    aList.add(element);
}
```

æ›´ä¼˜é›…çš„æ–¹å¼æ˜¯é€šè¿‡ Arrays ç±»çš„ `asList()` æ–¹æ³•ï¼š

```java
List<Integer> aList = Arrays.asList(anArray);
```

ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒArrays.asList çš„å‚æ•°éœ€è¦æ˜¯ Integer æ•°ç»„ï¼Œè€Œ anArray ç›®å‰æ˜¯ int ç±»å‹ï¼Œæˆ‘ä»¬éœ€è¦æ¢å¦å¤–ä¸€ç§æ–¹å¼ã€‚

```java
List<Integer> aList = Arrays.stream(anArray).boxed().collect(Collectors.toList());
```

è¿™åˆæ¶‰åŠåˆ°äº† Java [æµ](https://tobebetterjavaer.com/java8/stream.html)çš„çŸ¥è¯†ï¼Œåé¢ä¼šè®²åˆ°ã€‚

è¿˜æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒArrays.asList æ–¹æ³•è¿”å›çš„ ArrayList å¹¶ä¸æ˜¯ `java.util.ArrayList`ï¼Œå®ƒå…¶å®æ˜¯  Arrays ç±»çš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼š

```java
private static class ArrayList<E> extends AbstractList<E>
        implements RandomAccess, java.io.Serializable{}
```

å¦‚æœéœ€è¦æ·»åŠ å…ƒç´ æˆ–è€…åˆ é™¤å…ƒç´ çš„è¯ï¼Œéœ€è¦æŠŠå®ƒè½¬æˆ `java.util.ArrayList`ã€‚

```java
new ArrayList<>(Arrays.asList(anArray));
```

Java 8 æ–°å¢äº† Stream æµçš„æ¦‚å¿µï¼Œè¿™å°±æ„å‘³ç€æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†æ•°ç»„è½¬æˆ Stream è¿›è¡Œæ“ä½œã€‚

```java
String[] anArray = new String[] {"æ²‰é»˜ç‹äºŒ", "ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜", "å¥½å¥½çé‡ä»–"};
Stream<String> aStream = Arrays.stream(anArray);
```

å¦‚æœæƒ³å¯¹æ•°ç»„è¿›è¡Œæ’åºçš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ Arrays ç±»æä¾›çš„ `sort()` æ–¹æ³•ã€‚

- åŸºæœ¬æ•°æ®ç±»å‹æŒ‰ç…§å‡åºæ’åˆ—
- å®ç°äº† Comparable æ¥å£çš„å¯¹è±¡æŒ‰ç…§ `compareTo()` çš„æ’åº

æ¥çœ‹ç¬¬ä¸€ä¸ªä¾‹å­ï¼š

```java
int[] anArray = new int[] {5, 2, 1, 4, 8};
Arrays.sort(anArray);
```

æ’åºåçš„ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```java
[1, 2, 4, 5, 8]
```

æ¥çœ‹ç¬¬äºŒä¸ªä¾‹å­ï¼š

```java
String[] yetAnotherArray = new String[] {"A", "E", "Z", "B", "C"};
Arrays.sort(yetAnotherArray, 1, 3,
                Comparator.comparing(String::toString).reversed());
```

åªå¯¹ 1-3 ä½ç½®ä¸Šçš„å…ƒç´ è¿›è¡Œååºï¼Œæ‰€ä»¥ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
[A, Z, E, B, C]
```

æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä»æ•°ç»„ä¸­æŸ¥æ‰¾æŸä¸ªå…·ä½“çš„å…ƒç´ ï¼Œæœ€ç›´æ¥çš„æ–¹å¼å°±æ˜¯é€šè¿‡éå†çš„æ–¹å¼ï¼š

```java
int[] anArray = new int[] {5, 2, 1, 4, 8};
for (int i = 0; i < anArray.length; i++) {
    if (anArray[i] == 4) {
        System.out.println("æ‰¾åˆ°äº† " + i);
        break;
    }
}
```

ä¸Šä¾‹ä¸­ä»æ•°ç»„ä¸­æŸ¥è¯¢å…ƒç´  4ï¼Œæ‰¾åˆ°åé€šè¿‡ break å…³é”®å­—é€€å‡ºå¾ªç¯ã€‚

å¦‚æœæ•°ç»„æå‰è¿›è¡Œäº†æ’åºï¼Œå°±å¯ä»¥ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•ï¼Œè¿™æ ·æ•ˆç‡å°±ä¼šæ›´é«˜ä¸€äº›ã€‚`Arrays.binarySearch()` æ–¹æ³•å¯ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œå®ƒéœ€è¦ä¼ é€’ä¸€ä¸ªæ•°ç»„ï¼Œå’Œè¦æŸ¥æ‰¾çš„å…ƒç´ ã€‚

```java
int[] anArray = new int[] {1, 2, 3, 4, 5};
int index = Arrays.binarySearch(anArray, 4);
```

â€œé™¤äº†ä¸€ç»´æ•°ç»„ï¼Œè¿˜æœ‰äºŒç»´æ•°ç»„ï¼Œä¸‰å¦¹ä½ å¯ä»¥å»ç ”ç©¶ä¸‹ï¼Œæ¯”å¦‚è¯´ç”¨äºŒç»´æ•°ç»„æ‰“å°ä¸€ä¸‹æ¨è¾‰ä¸‰è§’ã€‚â€è¯´å®Œï¼Œæˆ‘å°±å»é˜³å°ä¸Šä¼‘æ¯äº†ï¼Œç•™ä¸‰å¦¹åœ¨é‚£é‡Œå­¦ä¹ ï¼Œä¸èƒ½æ‰“æ‰°å¥¹ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 4.2 æŒæ¡JavaäºŒç»´æ•°ç»„

â€œäºŒå“¥ï¼Œä»Šå¤©æˆ‘ä»¬ç®€å•è¿‡ä¸€ä¸‹äºŒç»´æ•°ç»„å§ï¼ŒæŒºç®€å•çš„ã€‚â€ä¸‰å¦¹æ”¾ä¸‹æ‰‹æœºå¯¹æˆ‘è¯´ã€‚

â€œå¥½å•Šï¼Œæœ¬æ¥ä¸æ‰“ç®—è®²äº†ï¼Œå› ä¸ºå¼€å‘ä¸­ç”¨çš„å…¶å®ä¸å¤šï¼Œä¹Ÿå¾ˆç®€å•ï¼Œå°±ä»ä¸€ç»´åˆ°äºŒç»´ï¼Œä¹Ÿæ²¡å•¥å¯è®²çš„ï¼Œå°±ç®€å•èŠèŠå§ã€‚â€æˆ‘æç­äº†æ‰‹ä¸­çš„åå­ï¼Œé•¿å‘¼ä¸€å£çƒŸï¼Œé£˜è¿‡ä¸‰å¦¹çš„å¤´é¡¶ï¼Œå¼•èµ·ä¸€é˜µè½»å¾®çš„å’³å—½å£°ï¼ˆğŸ˜‚ï¼‰

### 01ã€ä»€ä¹ˆæ˜¯äºŒç»´æ•°ç»„

äºŒç»´æ•°ç»„æ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œå¯ä»¥å­˜å‚¨å¤šè¡Œå’Œå¤šåˆ—çš„æ•°æ®ã€‚å®ƒç”±ä¸€ç³»åˆ—çš„è¡Œå’Œåˆ—ç»„æˆï¼Œæ¯ä¸ªå…ƒç´ éƒ½å¯ä»¥é€šè¿‡ä¸€ä¸ªè¡Œç´¢å¼•å’Œåˆ—ç´¢å¼•æ¥è®¿é—®ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª3è¡Œ4åˆ—çš„äºŒç»´æ•°ç»„å¯ä»¥è¡¨ç¤ºä¸ºä»¥ä¸‹å½¢å¼ï¼š

```java
array = [
  [a, b, c, d],
  [e, f, g, h],
  [i, j, k, l]
]
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€è¡Œæœ‰4ä¸ªå…ƒç´ ï¼Œç¬¬äºŒè¡Œæœ‰4ä¸ªå…ƒç´ ï¼Œç¬¬ä¸‰è¡Œæœ‰4ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªè¡Œç´¢å¼•å’Œä¸€ä¸ªåˆ—ç´¢å¼•ã€‚ä¾‹å¦‚ï¼Œå…ƒç´  array[1][2] æ˜¯ç¬¬2è¡Œç¬¬3åˆ—çš„å…ƒç´ ï¼Œå®ƒçš„å€¼æ˜¯ gã€‚

ä½¿ç”¨äºŒç»´æ•°ç»„å¯ä»¥æœ‰æ•ˆåœ°å­˜å‚¨å’Œå¤„ç†è¡¨æ ¼æ•°æ®ï¼Œå¦‚çŸ©é˜µã€å›¾åƒã€åœ°å›¾ç­‰ç­‰ã€‚

### 02ã€åˆ›å»ºäºŒç»´æ•°ç»„

è¦åœ¨ Java ä¸­åˆ›å»ºäºŒç»´æ•°ç»„ï¼Œä½ å¿…é¡»æŒ‡å®šè¦å­˜å‚¨åœ¨æ•°ç»„ä¸­çš„æ•°æ®ç±»å‹ï¼Œåè·Ÿä¸¤ä¸ªæ–¹æ‹¬å·å’Œæ•°ç»„çš„åç§°ã€‚

è¯­æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š

```txt
data_type[][] array_name;
```

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä»£ç ç¤ºä¾‹ã€‚

```java
int[][] oddNumbers = { {1, 3, 5, 7}, {9, 11, 13, 15} };
```


###  03ã€è®¿é—®äºŒç»´æ•°ç»„ä¸­çš„å…ƒç´ 

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªæ–¹æ‹¬å·æ¥è®¿é—®äºŒç»´ä¸­çš„å…ƒç´ ã€‚

ç¬¬ä¸€ä¸ªè¡¨ç¤ºæˆ‘ä»¬è¦ä»ä¸­è®¿é—®å…ƒç´ çš„æ•°ç»„ï¼Œè€Œç¬¬äºŒä¸ªè¡¨ç¤ºæˆ‘ä»¬è¦è®¿é—®çš„å…ƒç´ ç´¢å¼•ã€‚

è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥ç®€åŒ–ä¸Šé¢çš„è§£é‡Šï¼š

```java
int[][] oddNumbers = { {1, 3, 5, 7}, {9, 11, 13, 15} };

System.out.println(oddNumbers[0][0]);
// 1
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ`oddNumbers` æ•°ç»„ä¸­æœ‰ä¸¤ä¸ªæ•°ç»„â€”â€”`{1, 3, 5, 7}` å’Œ `{9, 11, 13, 15}`ã€‚

ç¬¬ä¸€ä¸ªæ•°ç»„â€”â€”`{1, 3, 5, 7}`â€”â€”ç”¨ 0 è¡¨ç¤ºã€‚

ç¬¬äºŒä¸ªæ•°ç»„â€”â€”`{9, 11, 13, 15}`â€”â€”ç”¨ 1 è¡¨ç¤ºã€‚

ç¬¬ä¸€ä¸ªæ•°ç»„æ˜¯ 0ï¼Œç¬¬äºŒä¸ªæ˜¯ 1ï¼Œç¬¬ä¸‰ä¸ªæ˜¯ 2ï¼Œä¾æ­¤ç±»æ¨ã€‚

å› æ­¤ï¼Œè¦è®¿é—®ç¬¬ä¸€ä¸ªæ•°ç»„ä¸­çš„é¡¹ç›®ï¼Œæˆ‘ä»¬å°† 0 åˆ†é…ç»™ç¬¬ä¸€ä¸ªæ–¹æ‹¬å·ã€‚ç”±äºæˆ‘ä»¬è¯•å›¾è®¿é—®æ•°ç»„ä¸­çš„ç¬¬ä¸€é¡¹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒçš„ç´¢å¼•ï¼Œå³ 0ï¼š`oddNumbers[0][0]`ã€‚

è®©æˆ‘ä»¬è¿›ä¸€æ­¥åˆ†è§£å®ƒã€‚

è¿™æ˜¯è®¿é—®å…ƒç´ çš„ä»£ç ï¼š`oddNumbers[?][?]`ã€‚

æˆ‘åœ¨ä¸¤ä¸ªæ–¹æ‹¬å·ä¸­éƒ½åŠ ä¸Šäº†é—®å·â€”â€”éšç€è¿›å±•å¡«å†™å®ƒä»¬ã€‚

å‡è®¾æˆ‘ä»¬è¦è®¿é—®ç¬¬äºŒä¸ªæ•°ç»„ä¸­çš„å…ƒç´ ï¼Œæˆ‘ä»¬çš„ä»£ç å°†å¦‚ä¸‹æ‰€ç¤ºï¼š`oddNumbers[1][?]`ã€‚

ç°åœ¨æˆ‘ä»¬è¦åœ¨ç¬¬äºŒä¸ªæ•°ç»„ï¼ˆ`{9, 11, 13, 15}`ï¼‰ä¸­å°è¯•è®¿é—®å…¶ä¸­ä¸€ä¸ªå…ƒç´ ã€‚å°±åƒä¸€ç»´æ•°ç»„ä¸€æ ·ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªä»é›¶å¼€å§‹çš„ç´¢å¼•ã€‚

å› æ­¤ï¼Œè¦è®¿é—®ç¬¬ä¸‰ä¸ªå…ƒç´  `13`ï¼Œæˆ‘ä»¬å°†å…¶ç´¢å¼•å·ä¼ é€’ç»™ç¬¬äºŒä¸ªæ–¹æ‹¬å·ï¼š`oddNumbers[1][2]`ã€‚

æ¥çœ‹è¿™æ ·ä¸€ä¸ªä¾‹å­ï¼š

```java
int[][] oddNumbers = { {1, 3, 5, 7}, {9, 11, 13, 15}, {17, 19, 21, 23} };
```

æˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®¿é—®ç¬¬ä¸‰ä¸ªæ•°ç»„ä¸­çš„ 21ã€‚è®¿é—®æ–¹å¼ä»ç„¶é€šè¿‡é—®å·æ¥è¡¨ç¤ºï¼š`oddNumbers[?][?]`ã€‚

æˆ‘ä»¬é¦–å…ˆç»™ç¬¬ä¸€ä¸ªé—®å·ä¸€ä¸ªæŒ‡å‘è¦è®¿é—®çš„ç‰¹å®šæ•°ç»„çš„å€¼ã€‚

æ•°ç»„ 0 => `{1, 3, 5, 7}`

æ•°ç»„ 1 => `{9, 11, 13, 15}`

æ•°ç»„ 2 => `{17, 19, 21, 23}`

æˆ‘ä»¬è¦æŸ¥æ‰¾çš„æ•°å­—åœ¨ç¬¬ä¸‰ä¸ªæ•°ç»„ä¸­ï¼Œæ‰€ä»¥æ˜¯ï¼š`oddNumbers[2][?]`ã€‚

ç¬¬äºŒä¸ªæ–¹æ‹¬å·çš„å€¼å°†æŒ‡å‘è¦è®¿é—®çš„å…ƒç´ ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¿…é¡»æŒ‡å®šå…ƒç´ çš„ç´¢å¼•ã€‚ä»¥ä¸‹æ˜¯è¯¥æ•°ç»„ä¸­çš„ç´¢å¼•ï¼š

17 => ç´¢å¼• 0

19 => ç´¢å¼• 1

21 => ç´¢å¼• 2

23 => ç´¢å¼• 3

21 çš„ç´¢å¼•ä¸º 2ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†å…¶æ·»åŠ åˆ°ç¬¬äºŒä¸ªæ–¹æ‹¬å·ï¼š`oddNumbers[2][2]`ã€‚å½“ä½ å°†å…¶æ‰“å°åˆ°æ§åˆ¶å°æ—¶ï¼Œå°†ä¼šæ‰“å°å‡º 21ã€‚

ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
int[][] oddNumbers = { {1, 3, 5, 7}, {9, 11, 13, 15}, {17, 19, 21, 23} };

System.out.println(oddNumbers[2][2]);
// 21
```

ä½ å¯ä»¥ä½¿ç”¨åµŒå¥—å¾ªç¯ï¼Œéå†äºŒç»´æ•°ç»„ä¸­çš„æ‰€æœ‰é¡¹ç›®ã€‚è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼š

```java
int[][] oddNumbers = { {1, 3, 5, 7}, {9, 11, 13, 15}, {17, 19, 21, 23} };

for(int i = 0; i < oddNumbers.length; i++){
    for(int j = 0; j < oddNumbers[i].length; j++){
        System.out.println(oddNumbers[i][j]);
    }   
}

// 1
// 3
// 5
// 7
// 9
// 11
// 13
// 15
// 17
// 19
// 21
// 23
```

ä¸Šé¢çš„ä»£ç å°†ä¼šæ‰“å°å‡º `oddNumbers` æ•°ç»„ä¸­çš„æ‰€æœ‰é¡¹ç›®ã€‚

### 04ã€äºŒç»´æ•°ç»„æ‰“å°æ¨è¾‰ä¸‰è§’

â€œä¸‰å¦¹ï¼Œä¸Šæ¬¡å­¦ä¸€ç»´æ•°ç»„çš„æ—¶å€™ç•™äº†ä¸€é“é¢˜ï¼Œè¦ä½ å°è¯•ç”¨äºŒç»´æ•°ç»„æ‰“å°æ¨è¾‰ä¸‰è§’ï¼Œä½ è¯•è¿‡äº†å—ï¼Ÿâ€

â€œæè¿‡äº†ï¼Œä½ çœ‹æˆ‘çš„ä»£ç ã€‚â€

```java
import java.util.Scanner;

public class YangHuiTriangle {
    public static void main(String[] args) {
        Scanner input = new Scanner(System.in);
        System.out.print("è¯·è¾“å…¥è¦æ‰“å°çš„è¡Œæ•°ï¼š");
        int n = input.nextInt();
        printYangHuiTriangle(n);
    }

    public static void printYangHuiTriangle(int n) {
        int[][] triangle = new int[n][n];

        for (int i = 0; i < n; i++) {
            // æ¯è¡Œçš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªæ•°å­—éƒ½æ˜¯1
            triangle[i][0] = 1;
            triangle[i][i] = 1;

            for (int j = 1; j < i; j++) {
                // å…¶ä»–æ•°å­—æ˜¯ä¸Šä¸€è¡Œçš„ä¸¤ä¸ªæ•°å­—ä¹‹å’Œ
                triangle[i][j] = triangle[i - 1][j - 1] + triangle[i - 1][j];
            }
        }

        // æ‰“å°æ¨è¾‰ä¸‰è§’
        for (int i = 0; i < n; i++) {
            for (int j = 0; j <= i; j++) {
                System.out.print(triangle[i][j] + " ");
            }
            System.out.println();
        }
    }
}
```

â€œè¿™æ®µä»£ç ä½¿ç”¨äº†ä¸€ä¸ªäºŒç»´æ•°ç»„æ¥å­˜å‚¨æ¨è¾‰ä¸‰è§’ä¸­çš„æ•°å­—ã€‚é¦–å…ˆï¼Œç¨‹åºè¦æ±‚ç”¨æˆ·è¾“å…¥è¦æ‰“å°çš„è¡Œæ•°ï¼Œç„¶åè°ƒç”¨ printYangHuiTriangle æ–¹æ³•æ¥ç”Ÿæˆå’Œæ‰“å°æ¨è¾‰ä¸‰è§’ã€‚åœ¨ printYangHuiTriangle æ–¹æ³•ä¸­ï¼Œç¨‹åºä½¿ç”¨äº†ä¸€ä¸ªåµŒå¥—çš„ for å¾ªç¯æ¥è®¡ç®—æ¨è¾‰ä¸‰è§’ä¸­çš„æ¯ä¸ªæ•°å­—ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨äºŒç»´æ•°ç»„ triangle ä¸­ã€‚æœ€åï¼Œç¨‹åºå†æ¬¡ä½¿ç”¨å¾ªç¯æ¥éå†æ•°ç»„å¹¶æ‰“å°å‡ºæ¨è¾‰ä¸‰è§’ä¸­çš„æ•°å­—ã€‚â€ä¸‰å¦¹è®¤çœŸåœ°è§£é‡Šé“ã€‚

â€œå“å‘€ï¼Œä¸é”™å‘€ï¼Œä»£ç å†™çš„æŒºæ ‡å‡†ï¼Œéƒ½çŸ¥é“ç”¨ Scanner ç±»å’Œæ§åˆ¶å°äº¤äº’äº†å‘€ï¼â€è§ä¸‰å¦¹æœ‰è¿™æ ·çš„è¡¨ç°ï¼Œæˆ‘å¿ä¸ä½å¿ƒé‡Œä¹å¼€äº†èŠ±ï¼Œè¿™äº›å¤©çš„å­¦ä¹ ä¹Ÿç»ˆäºæœ‰äº†æˆæœå•Šï¼ŒçœŸä¸é”™ï¼

```
è¯·è¾“å…¥è¦æ‰“å°çš„è¡Œæ•°ï¼š6
1 
1 1 
1 2 1 
1 3 3 1 
1 4 6 4 1 
1 5 10 10 5 1 
```

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 4.3 æ‰“å°Javaæ•°ç»„

â€œå“¥ï¼Œ[ä¹‹å‰å¬ä½ è¯´ï¼Œæ•°ç»„ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡](https://tobebetterjavaer.com/array/array.html)ï¼Œä½† Java ä¸­å¹¶æœªæ˜ç¡®çš„å®šä¹‰è¿™æ ·ä¸€ä¸ªç±»ã€‚â€çœ‹æ¥ä¸‰å¦¹æœ‰åœ¨ç”¨å¿ƒåœ°å­¦ä¹ ã€‚

â€œæ˜¯çš„ï¼Œå› æ­¤æ•°ç»„ä¹Ÿå°±æ²¡æœ‰æœºä¼šè¦†ç›– `Object.toString()` æ–¹æ³•ã€‚å¦‚æœå°è¯•ç›´æ¥æ‰“å°æ•°ç»„çš„è¯ï¼Œè¾“å‡ºçš„ç»“æœå¹¶ä¸æ˜¯æˆ‘ä»¬é¢„æœŸçš„ç»“æœã€‚â€æˆ‘æ¥ç€ä¸‰å¦¹çš„è¯ç»§ç»­è¯´ã€‚

â€œé‚£æ€ä¹ˆæ‰“å°æ•°ç»„å‘¢ï¼Ÿâ€ä¸‰å¦¹å¿ƒæœ‰çµçŠ€åœ°æŠŠä»Šå¤©çš„æ ¸å¿ƒé—®é¢˜æäº†å‡ºæ¥ã€‚

### ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥æ‰“å°æ•°ç»„

â€œé¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥æ‰“å°æ•°ç»„ï¼Œç›´æ¥æ‰“å°çš„è¯ï¼Œä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ã€‚â€

æ¥çœ‹è¿™æ ·ä¸€ä¸ªä¾‹å­ã€‚

```
String [] cmowers = {"æ²‰é»˜","ç‹äºŒ","ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜"};
System.out.println(cmowers);
```

ç¨‹åºæ‰“å°çš„ç»“æœæ˜¯ï¼š

```
[Ljava.lang.String;@3d075dc0
```

`[Ljava.lang.String;` è¡¨ç¤ºå­—ç¬¦ä¸²æ•°ç»„çš„ Class åï¼Œ@ åé¢çš„æ˜¯åå…­è¿›åˆ¶çš„ hashCodeâ€”â€”è¿™æ ·çš„æ‰“å°ç»“æœå¤ªâ€œäººæ€§åŒ–â€äº†ï¼Œä¸€èˆ¬äººè¡¨ç¤ºçœ‹ä¸æ‡‚ï¼ä¸ºä»€ä¹ˆä¼šè¿™æ ·æ˜¾ç¤ºå‘¢ï¼ŸæŸ¥çœ‹ä¸€ä¸‹ `java.lang.Object` ç±»çš„ `toString()` æ–¹æ³•å°±æ˜ç™½äº†ã€‚

```java
public String toString() {
    return getClass().getName() + "@" + Integer.toHexString(hashCode());
}
```

å†æ¬¡è¯æ˜ï¼Œæ•°ç»„è™½ç„¶æ²¡æœ‰æ˜¾å¼å®šä¹‰æˆä¸€ä¸ªç±»ï¼Œä½†å®ƒçš„ç¡®æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç»§æ‰¿äº†ç¥–å…ˆç±» Object çš„æ‰€æœ‰æ–¹æ³•ã€‚

â€œå“¥ï¼Œé‚£ä¸ºä»€ä¹ˆæ•°ç»„ä¸å•ç‹¬å®šä¹‰ä¸€ä¸ªç±»æ¥è¡¨ç¤ºå‘¢ï¼Ÿå°±åƒå­—ç¬¦ä¸² String ç±»é‚£æ ·å‘¢ï¼Ÿâ€ä¸‰å¦¹è¿™ä¸ªé—®é¢˜è®©äººå¤´å¤§ï¼Œä½†ä¹Ÿå¥½è§£é‡Šã€‚

â€œä¸€ä¸ªåˆç†çš„è¯´æ³•æ˜¯ Java å°†å…¶éšè—äº†ã€‚å‡å¦‚çœŸçš„å­˜åœ¨è¿™ä¹ˆä¸€ä¸ªç±»ï¼Œå°±å« Array.java å§ï¼Œæˆ‘ä»¬å‡æƒ³ä¸€ä¸‹å®ƒçœŸå®çš„æ ·å­ï¼Œå¿…é¡»å¾—æœ‰ä¸€ä¸ªå®¹å™¨æ¥å­˜æ”¾æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œå°±åƒ String ç±»é‚£æ ·ã€‚â€ä¸€è¾¹å›ç­”ä¸‰å¦¹ï¼Œæˆ‘ä¸€è¾¹æ‰“å¼€äº† String ç±»çš„æºç ã€‚

```java
public final class String
    implements java.io.Serializable, Comparable<String>, CharSequence {
    /** The value is used for character storage. */
    private final char value[];
}
```

â€œæœ€ç»ˆè¿˜æ˜¯è¦ç”¨ç±»ä¼¼ä¸€ç§æ•°ç»„çš„å½¢å¼æ¥å­˜æ”¾æ•°ç»„çš„å…ƒç´ ï¼Œå¯¹å§ï¼Ÿè¿™å°±å˜å¾—å¾ˆæ²¡æœ‰å¿…è¦äº†ï¼Œä¸å¦¨å°±æŠŠæ•°ç»„å½“åšæ˜¯ä¸€ä¸ªæ²¡æœ‰å½¢ä½“çš„å¯¹è±¡å§ï¼â€

â€œå¥½äº†ï¼Œä¸è®¨è®ºè¿™ä¸ªäº†ã€‚â€æˆ‘æ€•è¯é¢˜æ‰¯è¿œäº†ï¼Œæ‰¯åˆ°æˆ‘è‡ªå·±ä¹Ÿç­”ä¸å‡ºæ¥å°±å°´å°¬äº†ï¼Œèµ¶ç´§æŠŠä¸‰å¦¹çš„æ€è·¯æ‹½äº†å›æ¥ã€‚

### stream æµæ‰“å° Java æ•°ç»„

â€œæˆ‘ä»¬æ¥çœ‹ç¬¬ä¸€ç§æ‰“å°æ•°ç»„çš„æ–¹æ³•ï¼Œä½¿ç”¨æ—¶é«¦ä¸€ç‚¹çš„[Stream æµ](https://tobebetterjavaer.com/java8/stream.html)ã€‚â€

ç¬¬ä¸€ç§å½¢å¼ï¼š

```java
Arrays.asList(cmowers).stream().forEach(s -> System.out.println(s));
```

ç¬¬äºŒç§å½¢å¼ï¼š

```java
Stream.of(cmowers).forEach(System.out::println);
```

ç¬¬ä¸‰ç§å½¢å¼ï¼š

```java
Arrays.stream(cmowers).forEach(System.out::println);
```

æ‰“å°çš„ç»“æœå¦‚ä¸‹æ‰€ç¤ºã€‚

```
æ²‰é»˜
ç‹äºŒ
ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜
```

æ²¡é”™ï¼Œè¿™ä¸‰ç§æ–¹å¼éƒ½å¯ä»¥è½»æ¾èƒœä»»æœ¬èŒå·¥ä½œï¼Œå¹¶ä¸”æ˜¾å¾—æœ‰ç‚¹é«˜å¤§ä¸Šï¼Œæ¯•ç«Ÿç”¨åˆ°äº† Streamï¼Œä»¥åŠ [lambda è¡¨è¾¾å¼](https://tobebetterjavaer.com/java8/Lambda.html)ã€‚

### for å¾ªç¯æ‰“å° Java æ•°ç»„

â€œå½“ç„¶äº†ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¼ ç»Ÿçš„æ–¹å¼ï¼Œfor å¾ªç¯ã€‚ç”šè‡³ for-each ä¹Ÿè¡Œã€‚â€

```java
for(int i = 0; i < cmowers.length; i++){
    System.out.println(cmowers[i]);
}

for (String s : cmowers) {
    System.out.println(s);
}
```

### Arrays å·¥å…·ç±»æ‰“å° Java æ•°ç»„

â€œå“¥ï¼Œä½ éš¾é“å¿˜äº†[ä¸Šä¸€ç¯‡](https://tobebetterjavaer.com/common-tool/arrays.html)åœ¨è®² Arrays å·¥å…·ç±»çš„æ—¶å€™ï¼Œæåˆ°è¿‡å¦å¤–ä¸€ç§æ–¹æ³• `Arrays.toString()` å—ï¼Ÿâ€ä¸‰å¦¹çœ‹æˆ‘ä¸€ç›´è¯´ä¸åˆ°ç‚¹å­ä¸Šï¼Œæœ‰ç‚¹ç€æ€¥äº†ã€‚

â€œå½“ç„¶æ²¡æœ‰äº†ï¼Œæˆ‘è®¤ä¸º `Arrays.toString()` æ˜¯æ‰“å°æ•°ç»„çš„æœ€ä½³æ–¹å¼ï¼Œæ²¡æœ‰ä¹‹ä¸€ã€‚â€æˆ‘çš„æƒ…ç»ªæœ‰ç‚¹æ¿€åŠ¨ã€‚

`Arrays.toString()` å¯ä»¥å°†ä»»æ„ç±»å‹çš„æ•°ç»„è½¬æˆå­—ç¬¦ä¸²ï¼ŒåŒ…æ‹¬åŸºæœ¬ç±»å‹æ•°ç»„å’Œå¼•ç”¨ç±»å‹æ•°ç»„ã€‚è¯¥æ–¹æ³•æœ‰å¤šç§é‡è½½å½¢å¼ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/array/print-01.png)

ä½¿ç”¨ `Arrays.toString()` æ–¹æ³•æ¥æ‰“å°æ•°ç»„å†ä¼˜é›…ä¸è¿‡äº†ï¼Œå°±åƒï¼Œå°±åƒï¼Œå°±åƒè’™å¨œä¸½èçš„å¾®ç¬‘ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/array/print-02.png)

ï¼ˆä¸‰å¦¹çœ‹åˆ°è¿™ä¹ˆä¸€å‰¯å›¾çš„æ—¶å€™å¿ä¸ä½åœ°ç¬‘äº†ï¼‰

â€œä¸‰å¦¹ï¼Œä½ ä¸è¦ç¬‘ï¼Œæ¥ï¼Œæ€€æ£ç€æ„‰å¿«çš„å¿ƒæƒ…çœ‹ä¸€ä¸‹ä»£ç ç¤ºä¾‹ã€‚â€

```java
String [] cmowers = {"æ²‰é»˜","ç‹äºŒ","ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜"};
System.out.println(Arrays.toString(cmowers));
```

ç¨‹åºæ‰“å°ç»“æœï¼š

```
[æ²‰é»˜, ç‹äºŒ, ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜]
```

å“‡ï¼Œæ‰“å°æ ¼å¼ä¸è¦å¤ªå®Œç¾ï¼Œä¸å¤šä¸å°‘ï¼å®Œå…¨æ˜¯æˆ‘ä»¬é¢„æœŸçš„ç»“æœï¼š`[]` è¡¨æ˜æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œ`,` ç‚¹å’Œç©ºæ ¼ç”¨æ¥åˆ†å‰²å…ƒç´ ã€‚

### Arrayså·¥å…·ç±»æ‰“å°äºŒç»´æ•°ç»„

â€œå“¥ï¼Œé‚£å¦‚æœæˆ‘æƒ³æ‰“å°äºŒç»´æ•°ç»„å‘¢ï¼Ÿâ€

â€œå¯ä»¥ä½¿ç”¨ `Arrays.deepToString()` æ–¹æ³•ã€‚â€

```java
String[][] deepArray = new String[][] {{"æ²‰é»˜", "ç‹äºŒ"}, {"ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜"}};
System.out.println(Arrays.deepToString(deepArray));
```

æ‰“å°ç»“æœå¦‚ä¸‹æ‰€ç¤ºã€‚

```
[[æ²‰é»˜, ç‹äºŒ], [ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜]]
```

### POJO çš„æ‰“å°è§„çº¦

â€œè¯´åˆ°æ‰“å°ï¼Œä¸‰å¦¹ï¼Œå“¥ç»™ä½ æé†’ä¸€ç‚¹ã€‚é˜¿é‡Œå·´å·´çš„ Java å¼€å‘æ‰‹å†Œä¸Šæœ‰è¿™æ ·ä¸€æ¡è§„çº¦ï¼Œä½ çœ‹ã€‚â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/array/print-03.png)

â€œä»€ä¹ˆæ˜¯ POJO å‘¢ï¼Œå°±æ˜¯ Plain Ordinary Java Object çš„ç¼©å†™ï¼Œä¸€èˆ¬åœ¨ Web åº”ç”¨ç¨‹åºä¸­å»ºç«‹ä¸€ä¸ªæ•°æ®åº“çš„æ˜ å°„å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬ç§°å®ƒä¸º POJOï¼Œè¿™ç±»å¯¹è±¡ä¸ç»§æ‰¿æˆ–ä¸å®ç°ä»»ä½•å…¶å®ƒ Java æ¡†æ¶çš„ç±»æˆ–æ¥å£ã€‚â€

â€œå¯¹äºè¿™æ ·çš„ç±»ï¼Œæœ€å¥½æ˜¯é‡å†™ä¸€ä¸‹å®ƒçš„ `toString()` æ–¹æ³•ï¼Œæ–¹ä¾¿æŸ¥çœ‹è¿™ä¸ªå¯¹è±¡åˆ°åº•åŒ…å«äº†ä»€ä¹ˆå­—æ®µï¼Œå¥½æ’æŸ¥é—®é¢˜ã€‚â€

â€œå¦‚æœä¸é‡å†™çš„è¯ï¼Œæ‰“å°å‡ºæ¥çš„ Java å¯¹è±¡å°±åƒç›´æ¥æ‰“å°æ•°ç»„çš„é‚£æ ·ï¼Œä¸€ä¸²è°ä¹Ÿçœ‹ä¸æ‡‚çš„å­—ç¬¦åºåˆ—ã€‚â€

â€œå¯ä»¥å€ŸåŠ© Intellij IDEA ç”Ÿæˆé‡å†™çš„  `toString()` æ–¹æ³•ï¼Œç‰¹åˆ«æ–¹ä¾¿ã€‚â€

â€œå¥½çš„ï¼Œå“¥ï¼Œæˆ‘è®°ä½äº†ã€‚ä»¥åé‡åˆ°çš„è¯ï¼Œæˆ‘æ³¨æ„ä¸‹ã€‚ä½ å»ä¼‘æ¯å§ï¼Œæˆ‘æ¥æ•²ä¸€ä¸‹ä½ æåˆ°çš„è¿™äº›ä»£ç ï¼Œç»ƒä¸€ç»ƒã€‚â€

â€œOKï¼Œæˆ‘èµ°ï¼Œæˆ‘èµ°ã€‚â€


----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 4.4 è§£è¯»Stringç±»æºç 

æˆ‘æ­£ååœ¨æ²™å‘ä¸Šæ´¥æ´¥æœ‰å‘³åœ°è¯»åˆ˜æ¬£å¤§ä½¬çš„ã€Šç å†œç¿»èº«ã€‹â€”â€”Java å¸å›½è¿™ä¸€ç« ï¼Œé—¨é“ƒå“äº†ã€‚èµ·èº«æ‰“å¼€é—¨ä¸€çœ‹ï¼Œæ˜¯ä¸‰å¦¹ï¼Œå¥¹ä»å­¦æ ¡å›æ¥äº†ã€‚

â€œä¸‰å¦¹ï¼Œä½ å›æ¥çš„çœŸåŠæ—¶ï¼Œä»Šå¤©æˆ‘ä»¬æ‰“ç®—è®² Java ä¸­çš„å­—ç¬¦ä¸²å‘¢ã€‚â€ç­‰ä¸‰å¦¹æ¢é‹çš„æ—¶å€™æˆ‘è¯´ã€‚

â€œå“¦ï¼Œå¯ä»¥å‘€ï¼Œå“¥ã€‚å¬è¯´å­—ç¬¦ä¸²çš„ç»†èŠ‚ç‰¹åˆ«å¤šï¼Œä»€ä¹ˆ[å­—ç¬¦ä¸²å¸¸é‡æ± ](https://tobebetterjavaer.com/string/constant-pool.html)äº†ã€å­—ç¬¦ä¸²ä¸å¯å˜æ€§äº†ã€[å­—ç¬¦ä¸²æ‹¼æ¥](https://tobebetterjavaer.com/string/join.html)äº†ã€å­—ç¬¦ä¸²é•¿åº¦é™åˆ¶äº†ç­‰ç­‰ï¼Œä½ æœ€å¥½æ…¢æ…¢è®²ï¼Œå¦åˆ™æˆ‘å¯èƒ½ä¸€æ—¶åŠä¼šæ¶ˆåŒ–ä¸äº†ã€‚â€ä¸‰å¦¹çš„æ€åº¦æ˜¾å¾—å¾ˆè¯šæ³ã€‚

â€œå—¯ï¼Œæˆ‘å·²ç»æƒ³å¥½äº†ï¼Œä»Šå¤©å°±åªå¸¦ä½ å¤§æ¦‚è®¤è¯†ä¸€ä¸‹å­—ç¬¦ä¸²ï¼Œä¸»è¦è¯»ä¸€è¯»å®ƒçš„æºç ï¼Œå…¶ä»–çš„ç»†èŠ‚å’±ä»¬åé¢å†æ…¢æ…¢è®²ï¼Œä¿è¯ä½ èƒ½åŠæ—¶æ¶ˆåŒ–ã€‚â€

â€œå¥½ï¼Œé‚£å°±å¼€å§‹å§ã€‚â€ä¸‰å¦¹å·²ç»å‡†å¤‡å¥½ååœ¨äº†ç”µè„‘æ¡Œçš„è¾¹ä¸Šã€‚

æˆ‘åº”äº†ä¸€å£°åèµ°åˆ°ç”µè„‘æ¡Œå‰åä¸‹æ¥ï¼Œé¡ºæ‰‹æ‰“å¼€ [Intellij IDEA](https://tobebetterjavaer.com/overview/IDEA-install-config.html)ï¼Œå¹¶æ‰¾åˆ°äº† String çš„æºç ï¼ˆJava 8ï¼‰ã€‚

### String ç±»çš„å£°æ˜

```java
public final class String
    implements java.io.Serializable, Comparable<String>, CharSequence {
}
```

â€œç¬¬ä¸€ï¼ŒString ç±»æ˜¯ [final](https://tobebetterjavaer.com/oo/final.html) çš„ï¼Œæ„å‘³ç€å®ƒä¸èƒ½è¢«å­ç±»ç»§æ‰¿ã€‚â€

â€œç¬¬äºŒï¼ŒString ç±»å®ç°äº† [Serializable æ¥å£](https://tobebetterjavaer.com/io/Serializbale.html)ï¼Œæ„å‘³ç€å®ƒå¯ä»¥[åºåˆ—åŒ–](https://tobebetterjavaer.com/io/serialize.html)ã€‚â€

â€œç¬¬ä¸‰ï¼ŒString ç±»å®ç°äº† [Comparable æ¥å£](https://tobebetterjavaer.com/basic-extra-meal/comparable-omparator.html)ï¼Œæ„å‘³ç€æœ€å¥½ä¸è¦ç”¨â€˜==â€™æ¥[æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰](https://tobebetterjavaer.com/string/equals.html)ï¼Œè€Œåº”è¯¥ç”¨ `compareTo()` æ–¹æ³•å»æ¯”è¾ƒã€‚â€

å› ä¸º == æ˜¯ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„åœ°å€ï¼Œè¿™ä¸ªåœ¨è®²å­—ç¬¦ä¸²æ¯”è¾ƒçš„æ—¶å€™ä¼šè¯¦ç»†è®²ã€‚å¦‚æœåªæ˜¯è¯´æ¯”è¾ƒå­—ç¬¦ä¸²å†…å®¹çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ String ç±»çš„ equals æ–¹æ³•ï¼š

```java
public boolean equals(Object anObject) {
    if (this == anObject) {
        return true;
    }
    if (anObject instanceof String) {
        String anotherString = (String) anObject;
        int n = value.length;
        if (n == anotherString.value.length) {
            char v1[] = value;
            char v2[] = anotherString.value;
            int i = 0;
            while (n-- != 0) {
                if (v1[i] != v2[i])
                    return false;
                i++;
            }
            return true;
        }
    }
    return false;
}
```

â€œç¬¬å››ï¼Œ[StringBufferã€StringBuilder å’Œ String](https://tobebetterjavaer.com/string/builder-buffer.html) ä¸€æ ·ï¼Œéƒ½å®ç°äº† CharSequence æ¥å£ï¼Œæ‰€ä»¥å®ƒä»¬ä»¨å±äºè¿‘äº²ã€‚ç”±äº String æ˜¯ä¸å¯å˜çš„ï¼Œæ‰€ä»¥é‡åˆ°å­—ç¬¦ä¸²æ‹¼æ¥çš„æ—¶å€™å°±å¯ä»¥è€ƒè™‘ä¸€ä¸‹ String çš„å¦å¤–ä¸¤ä¸ªå¥½å…„å¼Ÿï¼ŒStringBuffer å’Œ StringBuilderï¼Œå®ƒä¿©æ˜¯å¯å˜çš„ã€‚â€

### String ç±»çš„åº•å±‚å®ç°

```java
private final char value[];
```

â€œç¬¬äº”ï¼ŒJava 9 ä»¥å‰ï¼ŒString æ˜¯ç”¨ char å‹[æ•°ç»„](https://tobebetterjavaer.com/array/array.html)å®ç°çš„ï¼Œä¹‹åæ”¹æˆäº† byte å‹æ•°ç»„å®ç°ï¼Œå¹¶å¢åŠ äº† coder æ¥è¡¨ç¤ºç¼–ç ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯åœ¨ Latin1 å­—ç¬¦ä¸ºä¸»çš„ç¨‹åºé‡Œï¼Œå¯ä»¥æŠŠ String å ç”¨çš„å†…å­˜å‡å°‘ä¸€åŠã€‚å½“ç„¶ï¼Œå¤©ä¸‹æ²¡æœ‰å…è´¹çš„åˆé¤ï¼Œè¿™ä¸ªæ”¹è¿›åœ¨èŠ‚çœå†…å­˜çš„åŒæ—¶å¼•å…¥äº†ç¼–ç æ£€æµ‹çš„å¼€é”€ã€‚â€

>Latin1ï¼ˆLatin-1ï¼‰æ˜¯ä¸€ç§å•å­—èŠ‚å­—ç¬¦é›†ï¼ˆå³æ¯ä¸ªå­—ç¬¦åªä½¿ç”¨ä¸€ä¸ªå­—èŠ‚çš„ç¼–ç æ–¹å¼ï¼‰ï¼Œä¹Ÿç§°ä¸ºISO-8859-1ï¼ˆå›½é™…æ ‡å‡†åŒ–ç»„ç»‡8859-1ï¼‰ï¼Œå®ƒåŒ…å«äº†è¥¿æ¬§è¯­è¨€ä¸­ä½¿ç”¨çš„æ‰€æœ‰å­—ç¬¦ï¼ŒåŒ…æ‹¬è‹±è¯­ã€æ³•è¯­ã€å¾·è¯­ã€è¥¿ç­ç‰™è¯­ã€è‘¡è„ç‰™è¯­ã€æ„å¤§åˆ©è¯­ç­‰ç­‰ã€‚åœ¨Latin1ç¼–ç ä¸­ï¼Œæ¯ä¸ªå­—ç¬¦ä½¿ç”¨ä¸€ä¸ª8ä½ï¼ˆå³ä¸€ä¸ªå­—èŠ‚ï¼‰çš„ç¼–ç ï¼Œå¯ä»¥è¡¨ç¤º256ç§ä¸åŒçš„å­—ç¬¦ï¼Œå…¶ä¸­åŒ…æ‹¬ASCIIå­—ç¬¦é›†ä¸­çš„æ‰€æœ‰å­—ç¬¦ï¼Œå³0x00åˆ°0x7Fï¼Œä»¥åŠå…¶ä»–è¥¿æ¬§è¯­è¨€ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼Œä¾‹å¦‚Ã©ã€Ã¼ã€Ã±ç­‰ç­‰ã€‚ç”±äºLatin1åªä½¿ç”¨ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œå› æ­¤åœ¨å­˜å‚¨å’Œä¼ è¾“æ–‡æœ¬æ—¶å…·æœ‰è¾ƒå°çš„å­˜å‚¨ç©ºé—´å’Œè¾ƒå¿«çš„é€Ÿåº¦

```java
public final class String
    implements java.io.Serializable, Comparable<String>, CharSequence {
    @Stable
    private final byte[] value;
    private final byte coder;
    private int hash;
}
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†åœ°è¯´ä¸€ä¸‹ã€‚

ä» `char[]` åˆ° `byte[]`ï¼Œæœ€ä¸»è¦çš„ç›®çš„æ˜¯**èŠ‚çœå­—ç¬¦ä¸²å ç”¨çš„å†…å­˜ç©ºé—´**ã€‚å†…å­˜å ç”¨å‡å°‘å¸¦æ¥çš„å¦å¤–ä¸€ä¸ªå¥½å¤„ï¼Œå°±æ˜¯ GC æ¬¡æ•°ä¹Ÿä¼šå‡å°‘ã€‚

æˆ‘ä»¬ä½¿ç”¨ `jmap -histo:live pid | head -n 10` å‘½ä»¤å°±å¯ä»¥æŸ¥çœ‹åˆ°å †å†…å¯¹è±¡ç¤ºä¾‹çš„ç»Ÿè®¡ä¿¡æ¯ã€æŸ¥çœ‹ ClassLoader çš„ä¿¡æ¯ä»¥åŠ finalizer é˜Ÿåˆ—ã€‚

ä»¥æˆ‘æ­£åœ¨è¿è¡Œç€çš„[ç¼–ç¨‹å–µ](https://github.com/itwanger/coding-more)é¡¹ç›®å®ä¾‹ï¼ˆåŸºäº Java 8ï¼‰æ¥è¯´ï¼Œç»“æœæ˜¯è¿™æ ·çš„ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/basic-extra-meal/jdk9-char-byte-string-d826ce88-bbbe-47a3-a1a9-4dd86dd3632f.png)

å…¶ä¸­ String å¯¹è±¡æœ‰ 17638 ä¸ªï¼Œå ç”¨äº† 423312 ä¸ªå­—èŠ‚çš„å†…å­˜ï¼Œæ’åœ¨ç¬¬ä¸‰ä½ã€‚

ç”±äº Java 8 çš„ String å†…éƒ¨å®ç°ä»ç„¶æ˜¯ `char[]`ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å†…å­˜å ç”¨æ’åœ¨ç¬¬ 1 ä½çš„å°±æ˜¯ char æ•°ç»„ã€‚

`char[]` å¯¹è±¡æœ‰ 17673 ä¸ªï¼Œå ç”¨äº† 1621352 ä¸ªå­—èŠ‚çš„å†…å­˜ï¼Œæ’åœ¨ç¬¬ä¸€ä½ã€‚

é‚£ä¹Ÿå°±æ˜¯è¯´ä¼˜åŒ– String èŠ‚çœå†…å­˜ç©ºé—´æ˜¯éå¸¸æœ‰å¿…è¦çš„ï¼Œå¦‚æœæ˜¯å»ä¼˜åŒ–ä¸€ä¸ªä½¿ç”¨é¢‘ç‡æ²¡æœ‰ String è¿™ä¹ˆé«˜çš„ç±»ï¼Œå°±æ²¡ä»€ä¹ˆå¿…è¦ï¼Œå¯¹å§ï¼Ÿ

ä¼—æ‰€å‘¨çŸ¥ï¼Œchar ç±»å‹çš„æ•°æ®åœ¨ JVM ä¸­æ˜¯å ç”¨ä¸¤ä¸ªå­—èŠ‚çš„ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯ UTF-8 [ç¼–ç ](https://tobebetterjavaer.com/basic-extra-meal/java-unicode.html)ï¼Œå…¶å€¼èŒƒå›´åœ¨ '\u0000'ï¼ˆ0ï¼‰å’Œ '\uffff'ï¼ˆ65,535ï¼‰ï¼ˆåŒ…å«ï¼‰ä¹‹é—´ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨ `char[]` æ¥è¡¨ç¤º String å°±ä¼šå¯¼è‡´ï¼Œå³ä½¿ String ä¸­çš„å­—ç¬¦åªç”¨ä¸€ä¸ªå­—èŠ‚å°±èƒ½è¡¨ç¤ºï¼Œä¹Ÿå¾—å ç”¨ä¸¤ä¸ªå­—èŠ‚ã€‚

>PSï¼šåœ¨è®¡ç®—æœºä¸­ï¼Œå•å­—èŠ‚å­—ç¬¦é€šå¸¸æŒ‡çš„æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼ˆ8ä½ï¼‰å¯ä»¥è¡¨ç¤ºçš„å­—ç¬¦ï¼Œè€ŒåŒå­—èŠ‚å­—ç¬¦åˆ™æŒ‡éœ€è¦ä¸¤ä¸ªå­—èŠ‚ï¼ˆ16ä½ï¼‰æ‰èƒ½è¡¨ç¤ºçš„å­—ç¬¦ã€‚å•å­—èŠ‚å­—ç¬¦å’ŒåŒå­—èŠ‚å­—ç¬¦çš„å®šä¹‰æ˜¯ç›¸å¯¹çš„ï¼Œä¸åŒçš„ç¼–ç æ–¹å¼å¯¹åº”çš„å•å­—èŠ‚å’ŒåŒå­—èŠ‚å­—ç¬¦é›†ä¹Ÿä¸åŒã€‚å¸¸è§çš„å•å­—èŠ‚å­—ç¬¦é›†æœ‰ASCIIï¼ˆç¾å›½ä¿¡æ¯äº¤æ¢æ ‡å‡†ä»£ç ï¼‰ã€ISO-8859ï¼ˆå›½é™…æ ‡å‡†åŒ–ç»„ç»‡æ ‡å‡†ç¼–å·8859ï¼‰ã€GBKï¼ˆæ±‰å­—å†…ç æ‰©å±•è§„èŒƒï¼‰ã€GB2312ï¼ˆä¸­å›½å›½å®¶æ ‡å‡†ï¼Œç°åœ¨å·²ç»è¢«GBKå–ä»£ï¼‰ï¼Œåƒæ‹‰ä¸å­—æ¯ã€æ•°å­—ã€æ ‡ç‚¹ç¬¦å·ã€æ§åˆ¶å­—ç¬¦éƒ½æ˜¯å•å­—èŠ‚å­—ç¬¦ã€‚åŒå­—èŠ‚å­—ç¬¦é›†åŒ…æ‹¬ Unicodeã€UTF-8ã€GB18030ï¼ˆä¸­å›½å›½å®¶æ ‡å‡†ï¼‰ï¼Œä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡ã€æ‹‰ä¸æ–‡æ‰©å±•å­—ç¬¦å±äºåŒå­—èŠ‚å­—ç¬¦ã€‚

å½“ç„¶äº†ï¼Œä»…ä»…å°† `char[]` ä¼˜åŒ–ä¸º `byte[]` æ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜è¦é…åˆ Latin-1 çš„ç¼–ç æ–¹å¼ï¼Œè¯¥ç¼–ç æ–¹å¼æ˜¯ç”¨å•ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºå­—ç¬¦çš„ï¼Œè¿™æ ·å°±æ¯” UTF-8 ç¼–ç èŠ‚çœäº†æ›´å¤šçš„ç©ºé—´ã€‚

æ¢å¥è¯è¯´ï¼Œå¯¹äºï¼š

```java
String name = "jack";
```

è¿™æ ·çš„ï¼Œä½¿ç”¨ Latin-1 ç¼–ç ï¼Œå ç”¨ 4 ä¸ªå­—èŠ‚å°±å¤Ÿäº†ã€‚

ä½†å¯¹äºï¼š

```java
String name = "å°äºŒ";
```

è¿™ç§ï¼Œæœ¨çš„åŠæ³•ï¼Œåªèƒ½ä½¿ç”¨ UTF16 æ¥ç¼–ç ã€‚

é’ˆå¯¹ JDK 9 çš„ String æºç é‡Œï¼Œä¸ºäº†åŒºåˆ«ç¼–ç æ–¹å¼ï¼Œè¿½åŠ äº†ä¸€ä¸ª coder å­—æ®µæ¥åŒºåˆ†ã€‚

```java
/**
 * The identifier of the encoding used to encode the bytes in
 * {@code value}. The supported values in this implementation are
 *
 * LATIN1
 * UTF16
 *
 * @implNote This field is trusted by the VM, and is a subject to
 * constant folding if String instance is constant. Overwriting this
 * field after construction will cause problems.
 */
private final byte coder;
```

Java ä¼šæ ¹æ®å­—ç¬¦ä¸²çš„å†…å®¹è‡ªåŠ¨è®¾ç½®ä¸ºç›¸åº”çš„ç¼–ç ï¼Œè¦ä¹ˆ Latin-1 è¦ä¹ˆ UTF16ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œä» `char[]` åˆ° `byte[]`ï¼Œ**ä¸­æ–‡æ˜¯ä¸¤ä¸ªå­—èŠ‚ï¼Œçº¯è‹±æ–‡æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œåœ¨æ­¤ä¹‹å‰å‘¢ï¼Œä¸­æ–‡æ˜¯ä¸¤ä¸ªå­—èŠ‚ï¼Œè‹±æ–‡ä¹Ÿæ˜¯ä¸¤ä¸ªå­—èŠ‚**ã€‚

åœ¨ UTF-8 ä¸­ï¼Œ0-127 å·çš„å­—ç¬¦ç”¨ 1 ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºï¼Œä½¿ç”¨å’Œ ASCII ç›¸åŒçš„ç¼–ç ã€‚åªæœ‰ 128 å·åŠä»¥ä¸Šçš„å­—ç¬¦æ‰ç”¨ 2 ä¸ªã€3 ä¸ªæˆ–è€… 4 ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºã€‚

- å¦‚æœåªæœ‰ä¸€ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆæœ€é«˜çš„æ¯”ç‰¹ä½ä¸º 0ï¼›
- å¦‚æœæœ‰å¤šä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå­—èŠ‚ä»æœ€é«˜ä½å¼€å§‹ï¼Œè¿ç»­æœ‰å‡ ä¸ªæ¯”ç‰¹ä½çš„å€¼ä¸º 1ï¼Œå°±ä½¿ç”¨å‡ ä¸ªå­—èŠ‚ç¼–ç ï¼Œå‰©ä¸‹çš„å­—èŠ‚å‡ä»¥ 10 å¼€å¤´ã€‚

å…·ä½“çš„è¡¨ç°å½¢å¼ä¸ºï¼š

- 0xxxxxxxï¼šä¸€ä¸ªå­—èŠ‚ï¼›
- 110xxxxx 10xxxxxxï¼šä¸¤ä¸ªå­—èŠ‚ç¼–ç å½¢å¼ï¼ˆå¼€å§‹ä¸¤ä¸ª 1ï¼‰ï¼›
- 1110xxxx 10xxxxxx 10xxxxxxï¼šä¸‰å­—èŠ‚ç¼–ç å½¢å¼ï¼ˆå¼€å§‹ä¸‰ä¸ª 1ï¼‰ï¼›
- 11110xxx 10xxxxxx 10xxxxxx 10xxxxxxï¼šå››å­—èŠ‚ç¼–ç å½¢å¼ï¼ˆå¼€å§‹å››ä¸ª 1ï¼‰ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼ŒUTF-8 æ˜¯å˜é•¿çš„ï¼Œé‚£å¯¹äº String è¿™ç§æœ‰éšæœºè®¿é—®æ–¹æ³•çš„ç±»æ¥è¯´ï¼Œå°±å¾ˆä¸æ–¹ä¾¿ã€‚æ‰€è°“çš„éšæœºè®¿é—®ï¼Œå°±æ˜¯charAtã€subStringè¿™ç§æ–¹æ³•ï¼Œéšä¾¿æŒ‡å®šä¸€ä¸ªæ•°å­—ï¼ŒStringè¦èƒ½ç»™å‡ºç»“æœã€‚å¦‚æœå­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦å ç”¨çš„å†…å­˜æ˜¯ä¸å®šé•¿çš„ï¼Œé‚£ä¹ˆè¿›è¡Œéšæœºè®¿é—®çš„æ—¶å€™ï¼Œå°±éœ€è¦ä»å¤´å¼€å§‹æ•°æ¯ä¸ªå­—ç¬¦çš„é•¿åº¦ï¼Œæ‰èƒ½æ‰¾åˆ°ä½ æƒ³è¦çš„å­—ç¬¦ã€‚

é‚£ä½ å¯èƒ½ä¼šé—®ï¼ŒUTF-16ä¹Ÿæ˜¯å˜é•¿çš„å‘¢ï¼Ÿä¸€ä¸ªå­—ç¬¦è¿˜å¯èƒ½å ç”¨ 4 ä¸ªå­—èŠ‚å‘¢ï¼Ÿ

çš„ç¡®ï¼ŒUTF-16 ä½¿ç”¨ 2 ä¸ªæˆ–è€… 4 ä¸ªå­—èŠ‚æ¥å­˜å‚¨å­—ç¬¦ã€‚

- å¯¹äº Unicode ç¼–å·èŒƒå›´åœ¨ 0 ~ FFFF ä¹‹é—´çš„å­—ç¬¦ï¼ŒUTF-16 ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚å­˜å‚¨ã€‚
- å¯¹äº Unicode ç¼–å·èŒƒå›´åœ¨ 10000 ~ 10FFFF ä¹‹é—´çš„å­—ç¬¦ï¼ŒUTF-16 ä½¿ç”¨å››ä¸ªå­—èŠ‚å­˜å‚¨ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯ï¼šå°†å­—ç¬¦ç¼–å·çš„æ‰€æœ‰æ¯”ç‰¹ä½åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œè¾ƒé«˜çš„ä¸€äº›æ¯”ç‰¹ä½ç”¨ä¸€ä¸ªå€¼ä»‹äº D800~DBFF ä¹‹é—´çš„åŒå­—èŠ‚å­˜å‚¨ï¼Œè¾ƒä½çš„ä¸€äº›æ¯”ç‰¹ä½ï¼ˆå‰©ä¸‹çš„æ¯”ç‰¹ä½ï¼‰ç”¨ä¸€ä¸ªå€¼ä»‹äº DC00~DFFF ä¹‹é—´çš„åŒå­—èŠ‚å­˜å‚¨ã€‚

ä½†æ˜¯åœ¨ Java ä¸­ï¼Œä¸€ä¸ªå­—ç¬¦ï¼ˆcharï¼‰å°±æ˜¯ 2 ä¸ªå­—èŠ‚ï¼Œå  4 ä¸ªå­—èŠ‚çš„å­—ç¬¦ï¼Œåœ¨ Java é‡Œä¹Ÿæ˜¯ç”¨ä¸¤ä¸ª char æ¥å­˜å‚¨çš„ï¼Œè€ŒStringçš„å„ç§æ“ä½œï¼Œéƒ½æ˜¯ä»¥Javaçš„å­—ç¬¦ï¼ˆcharï¼‰ä¸ºå•ä½çš„ï¼ŒcharAtæ˜¯å–å¾—ç¬¬å‡ ä¸ªcharï¼ŒsubStringå–çš„ä¹Ÿæ˜¯ç¬¬å‡ ä¸ªåˆ°ç¬¬å‡ ä¸ªcharç»„æˆçš„å­ä¸²ï¼Œç”šè‡³lengthè¿”å›çš„éƒ½æ˜¯charçš„ä¸ªæ•°ã€‚

æ‰€ä»¥UTF-16åœ¨Javaçš„ä¸–ç•Œé‡Œï¼Œå°±å¯ä»¥è§†ä¸ºä¸€ä¸ªå®šé•¿çš„ç¼–ç ã€‚

>å‚è€ƒé“¾æ¥ï¼š[https://www.zhihu.com/question/447224628](https://www.zhihu.com/question/447224628)

### String ç±»çš„ hashCode æ–¹æ³•

â€œç¬¬å…­ï¼Œæ¯ä¸€ä¸ªå­—ç¬¦ä¸²éƒ½ä¼šæœ‰ä¸€ä¸ª hash å€¼ï¼Œè¿™ä¸ªå“ˆå¸Œå€¼åœ¨å¾ˆå¤§æ¦‚ç‡æ˜¯ä¸ä¼šé‡å¤çš„ï¼Œå› æ­¤ String å¾ˆé€‚åˆæ¥ä½œä¸º [HashMap](https://tobebetterjavaer.com/collection/hashmap.html) çš„é”®å€¼ã€‚â€

æ¥çœ‹ String ç±»çš„ hashCode æ–¹æ³•ã€‚

```java
private int hash; // Cache the hash code for the string

public int hashCode() {
    int h = hash;
    if (h == 0 && value.length > 0) {
        char val[] = value;

        for (int i = 0; i < value.length; i++) {
            h = 31 * h + val[i];
        }
        hash = h;
    }
    return h;
}
```

hashCode æ–¹æ³•é¦–å…ˆæ£€æŸ¥æ˜¯å¦å·²ç»è®¡ç®—è¿‡å“ˆå¸Œç ï¼Œå¦‚æœå·²ç»è®¡ç®—è¿‡ï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜çš„å“ˆå¸Œç ã€‚å¦åˆ™ï¼Œæ–¹æ³•å°†ä½¿ç”¨ä¸€ä¸ªå¾ªç¯éå†å­—ç¬¦ä¸²çš„æ‰€æœ‰å­—ç¬¦ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªä¹˜æ³•å’ŒåŠ æ³•çš„ç»„åˆè®¡ç®—å“ˆå¸Œç ã€‚è¿™ç§è®¡ç®—æ–¹æ³•è¢«ç§°ä¸ºâ€œ31 å€å“ˆå¸Œæ³•â€ã€‚è®¡ç®—å®Œæˆåï¼Œå°†å¾—åˆ°çš„å“ˆå¸Œå€¼å­˜å‚¨åœ¨ hash æˆå‘˜å˜é‡ä¸­ï¼Œä»¥ä¾¿ä¸‹æ¬¡è°ƒç”¨ hashCode æ–¹æ³•æ—¶ç›´æ¥è¿”å›è¯¥å€¼ï¼Œè€Œä¸éœ€è¦é‡æ–°è®¡ç®—ã€‚è¿™æ˜¯ä¸€ç§ç¼“å­˜ä¼˜åŒ–ï¼Œç§°ä¸ºâ€œæƒ°æ€§è®¡ç®—â€ã€‚

31å€å“ˆå¸Œæ³•ï¼ˆ31-Hashï¼‰æ˜¯ä¸€ç§ç®€å•æœ‰æ•ˆçš„å­—ç¬¦ä¸²å“ˆå¸Œç®—æ³•ï¼Œå¸¸ç”¨äºå¯¹å­—ç¬¦ä¸²è¿›è¡Œå“ˆå¸Œå¤„ç†ã€‚è¯¥ç®—æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯å°†å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦ä¹˜ä»¥ä¸€ä¸ªå›ºå®šçš„è´¨æ•°31çš„å¹‚æ¬¡æ–¹ï¼Œå¹¶å°†å®ƒä»¬ç›¸åŠ å¾—åˆ°å“ˆå¸Œå€¼ã€‚å…·ä½“åœ°ï¼Œå‡è®¾å­—ç¬¦ä¸²ä¸ºsï¼Œé•¿åº¦ä¸ºnï¼Œåˆ™31å€å“ˆå¸Œå€¼è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š

```
H(s) = (s[0] * 31^(n-1)) + (s[1] * 31^(n-2)) + ... + (s[n-1] * 31^0)
```

å…¶ä¸­ï¼Œs[i]è¡¨ç¤ºå­—ç¬¦ä¸²sä¸­ç¬¬iä¸ªå­—ç¬¦çš„ASCIIç å€¼ï¼Œ`^`è¡¨ç¤ºå¹‚è¿ç®—ã€‚

31å€å“ˆå¸Œæ³•çš„ä¼˜ç‚¹åœ¨äºç®€å•æ˜“å®ç°ï¼Œè®¡ç®—é€Ÿåº¦å¿«ï¼ŒåŒæ—¶ä¹Ÿæ¯”è¾ƒå‡åŒ€åœ°åˆ†å¸ƒåœ¨å“ˆå¸Œè¡¨ä¸­ã€‚

[hashCode æ–¹æ³•](https://tobebetterjavaer.com/basic-extra-meal/hashcode.html)ï¼Œæˆ‘ä»¬ä¼šåœ¨å¦å¤–ä¸€ä¸ªç« èŠ‚é‡Œè¯¦ç»†è®²ï¼Œæˆ³å‰é¢çš„é“¾æ¥äº†è§£ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ¨¡æ‹Ÿ String çš„ hashCode æ–¹æ³•ï¼š

```java
public class HashCodeExample {
    public static void main(String[] args) {
        String text = "æ²‰é»˜ç‹äºŒ";
        int hashCode = computeHashCode(text);
        System.out.println("å­—ç¬¦ä¸² \"" + text + "\" çš„å“ˆå¸Œç æ˜¯: " + hashCode);

        System.out.println("String çš„ hashCode " + text.hashCode());
    }

    public static int computeHashCode(String text) {
        int h = 0;
        for (int i = 0; i < text.length(); i++) {
            h = 31 * h + text.charAt(i);
        }
        return h;
    }
}
```

çœ‹ä¸€ä¸‹ç»“æœï¼š

```
å­—ç¬¦ä¸² "æ²‰é»˜ç‹äºŒ" çš„å“ˆå¸Œç æ˜¯: 867758096
String çš„ hashCode 867758096
```

ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œåˆå­¦åˆ°äº†å§ï¼Ÿ

### String ç±»çš„ substring æ–¹æ³•

String ç±»ä¸­è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•æ¯”è¾ƒå¸¸ç”¨ substringï¼Œç”¨æ¥æˆªå–å­—ç¬¦ä¸²çš„ï¼Œæ¥çœ‹æºç ã€‚

```java
public String substring(int beginIndex) {
    if (beginIndex < 0) {
        throw new StringIndexOutOfBoundsException(beginIndex);
    }
    int subLen = value.length - beginIndex;
    if (subLen < 0) {
        throw new StringIndexOutOfBoundsException(subLen);
    }
    return (beginIndex == 0) ? this : new String(value, beginIndex, subLen);
}
```

substring æ–¹æ³•é¦–å…ˆæ£€æŸ¥å‚æ•°çš„æœ‰æ•ˆæ€§ï¼Œå¦‚æœå‚æ•°æ— æ•ˆï¼Œåˆ™æŠ›å‡º StringIndexOutOfBoundsException [å¼‚å¸¸](https://tobebetterjavaer.com/exception/gailan.html)ã€‚æ¥ä¸‹æ¥ï¼Œæ–¹æ³•æ ¹æ®å‚æ•°è®¡ç®—å­å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚å¦‚æœå­å­—ç¬¦ä¸²é•¿åº¦å°äºé›¶ï¼ŒæŠ›å‡ºStringIndexOutOfBoundsExceptionå¼‚å¸¸ã€‚

å¦‚æœ beginIndex ä¸º 0ï¼Œä¸” endIndex ç­‰äºå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œè¯´æ˜å­ä¸²ä¸åŸå­—ç¬¦ä¸²ç›¸åŒï¼Œå› æ­¤ç›´æ¥è¿”å›åŸå­—ç¬¦ä¸²ã€‚å¦åˆ™ï¼Œä½¿ç”¨ value æ•°ç»„ï¼ˆåŸå­—ç¬¦ä¸²çš„å­—ç¬¦æ•°ç»„ï¼‰çš„ä¸€éƒ¨åˆ†åˆ›å»ºä¸€ä¸ªæ–°çš„ String å¯¹è±¡å¹¶è¿”å›ã€‚

ä¸‹é¢æ˜¯å‡ ä¸ªä½¿ç”¨ substring æ–¹æ³•çš„ç¤ºä¾‹ï¼š

â‘ ã€æå–å­—ç¬¦ä¸²ä¸­çš„ä¸€æ®µå­ä¸²ï¼š

```java
String str = "Hello, world!";
String subStr = str.substring(7, 12);  // ä»ç¬¬7ä¸ªå­—ç¬¦ï¼ˆåŒ…æ‹¬ï¼‰æå–åˆ°ç¬¬12ä¸ªå­—ç¬¦ï¼ˆä¸åŒ…æ‹¬ï¼‰
System.out.println(subStr);  // è¾“å‡º "world"
```

â‘¡ã€æå–å­—ç¬¦ä¸²ä¸­çš„å‰ç¼€æˆ–åç¼€ï¼š

```java
String str = "Hello, world!";
String prefix = str.substring(0, 5);  // æå–å‰5ä¸ªå­—ç¬¦ï¼Œå³ "Hello,"
String suffix = str.substring(7);     // æå–ä»ç¬¬7ä¸ªå­—ç¬¦å¼€å§‹çš„æ‰€æœ‰å­—ç¬¦ï¼Œå³ "world!"
```

â‘¢ã€å¤„ç†å­—ç¬¦ä¸²ä¸­çš„ç©ºæ ¼å’Œåˆ†éš”ç¬¦ï¼š

```java
String str = "   Hello,   world!  ";
String trimmed = str.trim();                  // å»é™¤å­—ç¬¦ä¸²å¼€å¤´å’Œç»“å°¾çš„ç©ºæ ¼
String[] words = trimmed.split("\\s+");       // å°†å­—ç¬¦ä¸²æŒ‰ç…§ç©ºæ ¼åˆ†éš”æˆå•è¯æ•°ç»„
String firstWord = words[0].substring(0, 1);  // æå–ç¬¬ä¸€ä¸ªå•è¯çš„é¦–å­—æ¯
System.out.println(firstWord);                // è¾“å‡º "H"
```

â‘£ã€å¤„ç†å­—ç¬¦ä¸²ä¸­çš„æ•°å­—å’Œç¬¦å·ï¼š

```java
String str = "1234-5678-9012-3456";
String[] parts = str.split("-");             // å°†å­—ç¬¦ä¸²æŒ‰ç…§è¿å­—ç¬¦åˆ†éš”æˆå››ä¸ªéƒ¨åˆ†
String last4Digits = parts[3].substring(1);  // æå–æœ€åä¸€ä¸ªéƒ¨åˆ†çš„åä¸‰ä½æ•°å­—
System.out.println(last4Digits);             // è¾“å‡º "456"
```

æ€»ä¹‹ï¼Œsubstring æ–¹æ³•å¯ä»¥æ ¹æ®éœ€æ±‚çµæ´»åœ°æå–å­—ç¬¦ä¸²ä¸­çš„å­ä¸²ï¼Œä¸ºå­—ç¬¦ä¸²å¤„ç†æä¾›äº†ä¾¿åˆ©ã€‚

### String ç±»çš„ indexOf æ–¹æ³•

indexOf æ–¹æ³•ç”¨äºæŸ¥æ‰¾ä¸€ä¸ªå­å­—ç¬¦ä¸²åœ¨åŸå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œå¹¶è¿”å›è¯¥ä½ç½®çš„ç´¢å¼•ã€‚æ¥çœ‹è¯¥æ–¹æ³•çš„æºç ï¼š

```java
/*
 * æŸ¥æ‰¾å­—ç¬¦æ•°ç»„ target åœ¨å­—ç¬¦æ•°ç»„ source ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ã€‚
 * sourceOffset å’Œ sourceCount å‚æ•°æŒ‡å®š source æ•°ç»„ä¸­è¦æœç´¢çš„èŒƒå›´ï¼Œ
 * targetOffset å’Œ targetCount å‚æ•°æŒ‡å®š target æ•°ç»„ä¸­è¦æœç´¢çš„èŒƒå›´ï¼Œ
 * fromIndex å‚æ•°æŒ‡å®šå¼€å§‹æœç´¢çš„ä½ç½®ã€‚
 * å¦‚æœæ‰¾åˆ°äº† target æ•°ç»„ï¼Œåˆ™è¿”å›å®ƒåœ¨ source æ•°ç»„ä¸­çš„ä½ç½®ç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰ï¼Œ
 * å¦åˆ™è¿”å›-1ã€‚
 */
static int indexOf(char[] source, int sourceOffset, int sourceCount,
        char[] target, int targetOffset, int targetCount,
        int fromIndex) {
    // å¦‚æœå¼€å§‹æœç´¢çš„ä½ç½®å·²ç»è¶…å‡º source æ•°ç»„çš„èŒƒå›´ï¼Œåˆ™ç›´æ¥è¿”å›-1ï¼ˆå¦‚æœ target æ•°ç»„ä¸ºç©ºï¼Œåˆ™è¿”å› sourceCountï¼‰
    if (fromIndex >= sourceCount) {
        return (targetCount == 0 ? sourceCount : -1);
    }
    // å¦‚æœå¼€å§‹æœç´¢çš„ä½ç½®å°äº0ï¼Œåˆ™ä»0å¼€å§‹æœç´¢
    if (fromIndex < 0) {
        fromIndex = 0;
    }
    // å¦‚æœ target æ•°ç»„ä¸ºç©ºï¼Œåˆ™ç›´æ¥è¿”å›å¼€å§‹æœç´¢çš„ä½ç½®
    if (targetCount == 0) {
        return fromIndex;
    }

    // æŸ¥æ‰¾ target æ•°ç»„çš„ç¬¬ä¸€ä¸ªå­—ç¬¦åœ¨ source æ•°ç»„ä¸­çš„ä½ç½®
    char first = target[targetOffset];
    int max = sourceOffset + (sourceCount - targetCount);

    // å¾ªç¯æŸ¥æ‰¾ target æ•°ç»„åœ¨ source æ•°ç»„ä¸­çš„ä½ç½®
    for (int i = sourceOffset + fromIndex; i <= max; i++) {
        /* Look for first character. */
        // å¦‚æœ source æ•°ç»„ä¸­å½“å‰ä½ç½®çš„å­—ç¬¦ä¸æ˜¯ target æ•°ç»„çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œåˆ™åœ¨ source æ•°ç»„ä¸­ç»§ç»­æŸ¥æ‰¾ target æ•°ç»„çš„ç¬¬ä¸€ä¸ªå­—ç¬¦
        if (source[i] != first) {
            while (++i <= max && source[i] != first);
        }

        /* Found first character, now look at the rest of v2 */
        // å¦‚æœåœ¨ source æ•°ç»„ä¸­æ‰¾åˆ°äº† target æ•°ç»„çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œåˆ™ç»§ç»­æŸ¥æ‰¾ target æ•°ç»„çš„å‰©ä½™éƒ¨åˆ†æ˜¯å¦åŒ¹é…
        if (i <= max) {
            int j = i + 1;
            int end = j + targetCount - 1;
            for (int k = targetOffset + 1; j < end && source[j]
                    == target[k]; j++, k++);

            // å¦‚æœ target æ•°ç»„å…¨éƒ¨åŒ¹é…ï¼Œåˆ™è¿”å›åœ¨ source æ•°ç»„ä¸­çš„ä½ç½®ç´¢å¼•
            if (j == end) {
                /* Found whole string. */
                return i - sourceOffset;
            }
        }
    }
    // æ²¡æœ‰æ‰¾åˆ° target æ•°ç»„ï¼Œåˆ™è¿”å›-1
    return -1;
}
```

æ¥çœ‹ç¤ºä¾‹ã€‚

â‘ ã€ç¤ºä¾‹1ï¼šæŸ¥æ‰¾å­å­—ç¬¦ä¸²çš„ä½ç½®

```java
String str = "Hello, world!";
int index = str.indexOf("world");  // æŸ¥æ‰¾ "world" å­å­—ç¬¦ä¸²åœ¨ str ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®
System.out.println(index);        // è¾“å‡º 7
```

â‘¡ã€ç¤ºä¾‹2ï¼šæŸ¥æ‰¾å­—ç¬¦ä¸²ä¸­æŸä¸ªå­—ç¬¦çš„ä½ç½®

```java
String str = "Hello, world!";
int index = str.indexOf(",");     // æŸ¥æ‰¾é€—å·åœ¨ str ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®
System.out.println(index);        // è¾“å‡º 5
```

â‘¢ã€ç¤ºä¾‹3ï¼šæŸ¥æ‰¾å­å­—ç¬¦ä¸²çš„ä½ç½®ï¼ˆä»æŒ‡å®šä½ç½®å¼€å§‹æŸ¥æ‰¾ï¼‰

```java
String str = "Hello, world!";
int index = str.indexOf("l", 3);  // ä»ç´¢å¼•ä¸º3çš„ä½ç½®å¼€å§‹æŸ¥æ‰¾ "l" å­å­—ç¬¦ä¸²åœ¨ str ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®
System.out.println(index);        // è¾“å‡º 3
```

â‘£ã€ç¤ºä¾‹4ï¼šæŸ¥æ‰¾å¤šä¸ªå­å­—ç¬¦ä¸²

```java
String str = "Hello, world!";
int index1 = str.indexOf("o");    // æŸ¥æ‰¾ "o" å­å­—ç¬¦ä¸²åœ¨ str ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®
int index2 = str.indexOf("o", 5); // ä»ç´¢å¼•ä¸º5çš„ä½ç½®å¼€å§‹æŸ¥æ‰¾ "o" å­å­—ç¬¦ä¸²åœ¨ str ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®
System.out.println(index1);       // è¾“å‡º 4
System.out.println(index2);       // è¾“å‡º 8
```

### String ç±»çš„å…¶ä»–æ–¹æ³•

æ¯”å¦‚è¯´ `length()` ç”¨äºè¿”å›å­—ç¬¦ä¸²é•¿åº¦ã€‚

æ¯”å¦‚è¯´ `isEmpty()` ç”¨äºåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºã€‚

æ¯”å¦‚è¯´ `charAt()` ç”¨äºè¿”å›æŒ‡å®šç´¢å¼•å¤„çš„å­—ç¬¦ã€‚

æ¯”å¦‚è¯´ `getBytes()` ç”¨äºè¿”å›å­—ç¬¦ä¸²çš„å­—èŠ‚æ•°ç»„ï¼Œå¯ä»¥æŒ‡å®šç¼–ç æ–¹å¼ï¼Œæ¯”å¦‚è¯´ï¼š

```java
String text = "æ²‰é»˜ç‹äºŒ";
System.out.println(Arrays.toString(text.getBytes(StandardCharsets.UTF_8)));
```

æ¯”å¦‚è¯´ `trim()` ç”¨äºå»é™¤å­—ç¬¦ä¸²ä¸¤ä¾§çš„ç©ºç™½å­—ç¬¦ï¼Œæ¥çœ‹æºç ï¼š

```java
public String trim() {
    int len = value.length;
    int st = 0;
    char[] val = value;    /* avoid getfield opcode */

    while ((st < len) && (val[st] <= ' ')) {
        st++;
    }
    while ((st < len) && (val[len - 1] <= ' ')) {
        len--;
    }
    return ((st > 0) || (len < value.length)) ? substring(st, len) : this;
}
```

ä¸¾ä¾‹ï¼š`"  æ²‰é»˜ç‹äºŒ   ".trim()` ä¼šè¿”å›"æ²‰é»˜ç‹äºŒ"

é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ [split](https://tobebetterjavaer.com/string/split.html)ã€[equals](https://tobebetterjavaer.com/string/equals.html)ã€[join](https://tobebetterjavaer.com/string/join.html) ç­‰è¿™äº›æ–¹æ³•ï¼Œæˆ‘ä»¬åé¢ä¼šä¸€ä¸€æ¥ç»†è®²ã€‚

---

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 4.5 Stringä¸ºä»€ä¹ˆä¸å¯å˜

String å¯èƒ½æ˜¯ Java ä¸­ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„å¼•ç”¨ç±»å‹äº†ï¼Œå› æ­¤ String ç±»çš„è®¾è®¡è€…å¯ä»¥è¯´æ˜¯ç”¨å¿ƒè‰¯è‹¦ã€‚

æ¯”å¦‚è¯´ String çš„ä¸å¯å˜æ€§ã€‚

- String ç±»è¢« [final å…³é”®å­—](https://tobebetterjavaer.com/oo/final.html)ä¿®é¥°ï¼Œæ‰€ä»¥å®ƒä¸ä¼šæœ‰å­ç±»ï¼Œè¿™å°±æ„å‘³ç€æ²¡æœ‰å­ç±»å¯ä»¥[é‡å†™](https://tobebetterjavaer.com/basic-extra-meal/override-overload.html)å®ƒçš„æ–¹æ³•ï¼Œæ”¹å˜å®ƒçš„è¡Œä¸ºã€‚
- String ç±»çš„æ•°æ®å­˜å‚¨åœ¨ `char[]` æ•°ç»„ä¸­ï¼Œè€Œè¿™ä¸ªæ•°ç»„ä¹Ÿè¢« final å…³é”®å­—ä¿®é¥°äº†ï¼Œè¿™å°±è¡¨ç¤º String å¯¹è±¡æ˜¯æ²¡æ³•è¢«ä¿®æ”¹çš„ï¼Œåªè¦åˆå§‹åŒ–ä¸€æ¬¡ï¼Œå€¼å°±ç¡®å®šäº†ã€‚

```java
public final class String
    implements java.io.Serializable, Comparable<String>, CharSequence {
    /** The value is used for character storage. */
    private final char value[];
}
```

â€œå“¥ï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡å‘¢ï¼Ÿâ€ä¸‰å¦¹æœ‰äº›ä¸è§£ã€‚

â€œæˆ‘å…ˆç®€å•æ¥è¯´ä¸‹ï¼Œä¸‰å¦¹ï¼Œèƒ½æ‡‚æœ€å¥½ï¼Œä¸èƒ½æ‡‚åé¢å†ç»†è¯´ã€‚â€

ç¬¬ä¸€ï¼Œå¯ä»¥ä¿è¯ String å¯¹è±¡çš„å®‰å…¨æ€§ï¼Œé¿å…è¢«ç¯¡æ”¹ï¼Œæ¯•ç«Ÿåƒå¯†ç è¿™ç§éšç§ä¿¡æ¯ä¸€èˆ¬å°±æ˜¯ç”¨å­—ç¬¦ä¸²å­˜å‚¨çš„ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ Java ç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†å­—ç¬¦ä¸²çš„ä¸å¯å˜æ€§å¦‚ä½•æœ‰åŠ©äºä¿è¯ String å¯¹è±¡çš„å®‰å…¨æ€§ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ User ç±»ï¼Œè¯¥ç±»ä½¿ç”¨ String ç±»å‹çš„å­—æ®µå­˜å‚¨ç”¨æˆ·åå’Œå¯†ç ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªé™æ€æ–¹æ³• getUserCredentials ä»å¤–éƒ¨è·å–ç”¨æˆ·å‡­æ®ã€‚

```java
class User {
    private String username;
    private String password;

    public User(String username, String password) {
        this.username = username;
        this.password = password;
    }

    public String getUsername() {
        return username;
    }

    public String getPassword() {
        return password;
    }
}

public class StringSecurityExample {
    public static void main(String[] args) {
        String username = "æ²‰é»˜ç‹äºŒ";
        String password = "123456";
        User user = new User(username, password);

        // è·å–ç”¨æˆ·å‡­æ®
        String[] credentials = getUserCredentials(user);

        // å°è¯•ä¿®æ”¹ä» getUserCredentials è¿”å›çš„ç”¨æˆ·åå’Œå¯†ç å­—ç¬¦ä¸²
        credentials[0] = "é™ˆæ¸…æ‰¬";
        credentials[1] = "612311";

        // è¾“å‡ºåŸå§‹ User å¯¹è±¡ä¸­çš„ç”¨æˆ·åå’Œå¯†ç 
        System.out.println("åŸå§‹ç”¨æˆ·å: " + user.getUsername());
        System.out.println("åŸå§‹å¯†ç : " + user.getPassword());
    }

    public static String[] getUserCredentials(User user) {
        String[] credentials = new String[2];
        credentials[0] = user.getUsername();
        credentials[1] = user.getPassword();
        return credentials;
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå°½ç®¡æˆ‘ä»¬å°è¯•ä¿®æ”¹ getUserCredentials è¿”å›çš„å­—ç¬¦ä¸²æ•°ç»„ï¼ˆå³ç”¨æˆ·åå’Œå¯†ç ï¼‰ï¼Œä½†åŸå§‹ User å¯¹è±¡ä¸­çš„ç”¨æˆ·åå’Œå¯†ç ä¿æŒä¸å˜ã€‚è¿™è¯æ˜äº†å­—ç¬¦ä¸²çš„ä¸å¯å˜æ€§æœ‰åŠ©äºä¿æŠ¤ String å¯¹è±¡çš„å®‰å…¨æ€§ã€‚

ç¬¬äºŒï¼Œä¿è¯å“ˆå¸Œå€¼ä¸ä¼šé¢‘ç¹å˜æ›´ã€‚æ¯•ç«Ÿè¦ç»å¸¸ä½œä¸º[å“ˆå¸Œè¡¨](https://tobebetterjavaer.com/collection/hashmap.html)çš„é”®å€¼ï¼Œç»å¸¸å˜æ›´çš„è¯ï¼Œå“ˆå¸Œè¡¨çš„æ€§èƒ½å°±ä¼šå¾ˆå·®åŠ²ã€‚

åœ¨ String ç±»ä¸­ï¼Œå“ˆå¸Œå€¼æ˜¯åœ¨ç¬¬ä¸€æ¬¡è®¡ç®—æ—¶ç¼“å­˜çš„ï¼Œåç»­å¯¹è¯¥å“ˆå¸Œå€¼çš„è¯·æ±‚å°†ç›´æ¥ä½¿ç”¨ç¼“å­˜å€¼ã€‚è¿™æœ‰åŠ©äºæé«˜å“ˆå¸Œè¡¨ç­‰æ•°æ®ç»“æ„çš„æ€§èƒ½ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†å­—ç¬¦ä¸²çš„å“ˆå¸Œå€¼ç¼“å­˜æœºåˆ¶ï¼š

```java
String text1 = "æ²‰é»˜ç‹äºŒ";
String text2 = "æ²‰é»˜ç‹äºŒ";

// è®¡ç®—å­—ç¬¦ä¸² text1 çš„å“ˆå¸Œå€¼ï¼Œæ­¤æ—¶ä¼šè¿›è¡Œè®¡ç®—å¹¶ç¼“å­˜å“ˆå¸Œå€¼
int hashCode1 = text1.hashCode();
System.out.println("ç¬¬ä¸€æ¬¡è®¡ç®— text1 çš„å“ˆå¸Œå€¼: " + hashCode1);

// å†æ¬¡è®¡ç®—å­—ç¬¦ä¸² text1 çš„å“ˆå¸Œå€¼ï¼Œæ­¤æ—¶ç›´æ¥è¿”å›ç¼“å­˜çš„å“ˆå¸Œå€¼
int hashCode1Cached = text1.hashCode();
System.out.println("ç¬¬äºŒæ¬¡è®¡ç®—: " + hashCode1Cached);

// è®¡ç®—å­—ç¬¦ä¸² text2 çš„å“ˆå¸Œå€¼ï¼Œç”±äºå­—ç¬¦ä¸²å¸¸é‡æ± çš„å­˜åœ¨ï¼Œå®é™…ä¸Š text1 å’Œ text2 æŒ‡å‘åŒä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡
// æ‰€ä»¥è¿™é‡Œç›´æ¥è¿”å›ç¼“å­˜çš„å“ˆå¸Œå€¼
int hashCode2 = text2.hashCode();
System.out.println("text2 ç›´æ¥ä½¿ç”¨ç¼“å­˜: " + hashCode2);
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªå…·æœ‰ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸² text1 å’Œ text2ã€‚é¦–æ¬¡è®¡ç®— text1 çš„å“ˆå¸Œå€¼æ—¶ï¼Œä¼šè¿›è¡Œå®é™…è®¡ç®—å¹¶ç¼“å­˜è¯¥å€¼ã€‚å½“æˆ‘ä»¬å†æ¬¡è®¡ç®— text1 çš„å“ˆå¸Œå€¼æˆ–è®¡ç®—å…·æœ‰ç›¸åŒå†…å®¹çš„ text2 çš„å“ˆå¸Œå€¼æ—¶ï¼Œå°†ç›´æ¥è¿”å›ç¼“å­˜çš„å“ˆå¸Œå€¼ï¼Œè€Œä¸è¿›è¡Œé‡æ–°è®¡ç®—ã€‚

ç”±äº String å¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œå…¶å“ˆå¸Œå€¼åœ¨åˆ›å»ºåä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚è¿™ä½¿å¾— String ç±»å¯ä»¥ç¼“å­˜å“ˆå¸Œå€¼ï¼Œæé«˜å“ˆå¸Œè¡¨ç­‰æ•°æ®ç»“æ„çš„æ€§èƒ½ã€‚å¦‚æœ String æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆåœ¨æ¯æ¬¡ä¿®æ”¹æ—¶éƒ½éœ€è¦é‡æ–°è®¡ç®—å“ˆå¸Œå€¼ï¼Œè¿™ä¼šé™ä½æ€§èƒ½ã€‚

ç¬¬ä¸‰ï¼Œå¯ä»¥å®ç°[å­—ç¬¦ä¸²å¸¸é‡æ± ](https://tobebetterjavaer.com/string/constant-pool.html)ï¼ŒJava ä¼šå°†ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²å­˜å‚¨åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ã€‚è¿™æ ·ï¼Œå…·æœ‰ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²å˜é‡å¯ä»¥æŒ‡å‘åŒä¸€ä¸ª String å¯¹è±¡ï¼ŒèŠ‚çœå†…å­˜ç©ºé—´ã€‚

â€œç”±äºå­—ç¬¦ä¸²çš„ä¸å¯å˜æ€§ï¼ŒString ç±»çš„ä¸€äº›æ–¹æ³•å®ç°æœ€ç»ˆéƒ½è¿”å›äº†æ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚â€ç­‰ä¸‰å¦¹ç¨å¾®ç¼“äº†ä¸€ä¼šåï¼Œæˆ‘ç»§ç»­è¯´åˆ°ã€‚

â€œå°±æ‹¿ `substring()` æ–¹æ³•æ¥è¯´ã€‚â€

```java
public String substring(int beginIndex) {
    if (beginIndex < 0) {
        throw new StringIndexOutOfBoundsException(beginIndex);
    }
    int subLen = value.length - beginIndex;
    if (subLen < 0) {
        throw new StringIndexOutOfBoundsException(subLen);
    }
    return (beginIndex == 0) ? this : new String(value, beginIndex, subLen);
}
```

`substring()` æ–¹æ³•ç”¨äºæˆªå–å­—ç¬¦ä¸²ï¼Œæœ€ç»ˆè¿”å›çš„éƒ½æ˜¯ new å‡ºæ¥çš„æ–°å­—ç¬¦ä¸²å¯¹è±¡ã€‚

â€œè¿˜æœ‰ `concat()` æ–¹æ³•ã€‚â€

```java
public String concat(String str) {
    int olen = str.length();
    if (olen == 0) {
        return this;
    }
    if (coder() == str.coder()) {
        byte[] val = this.value;
        byte[] oval = str.value;
        int len = val.length + oval.length;
        byte[] buf = Arrays.copyOf(val, len);
        System.arraycopy(oval, 0, buf, val.length, oval.length);
        return new String(buf, coder);
    }
    int len = length();
    byte[] buf = StringUTF16.newBytesFor(len + olen);
    getBytes(buf, 0, UTF16);
    str.getBytes(buf, len, UTF16);
    return new String(buf, UTF16);
}
```

`concat()` æ–¹æ³•ç”¨äºæ‹¼æ¥å­—ç¬¦ä¸²ï¼Œä¸ç®¡ç¼–ç æ˜¯å¦ä¸€è‡´ï¼Œæœ€ç»ˆä¹Ÿè¿”å›çš„æ˜¯æ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚

â€œ`replace()` æ›¿æ¢æ–¹æ³•å…¶å®ä¹Ÿä¸€æ ·ï¼Œä¸‰å¦¹ï¼Œä½ å¯ä»¥è‡ªå·±ä¸€ä¼šçœ‹ä¸€ä¸‹æºç ï¼Œä¹Ÿæ˜¯è¿”å›æ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚â€

â€œè¿™å°±æ„å‘³ç€ï¼Œä¸ç®¡æ˜¯æˆªå–ã€æ‹¼æ¥ï¼Œè¿˜æ˜¯æ›¿æ¢ï¼Œéƒ½ä¸æ˜¯åœ¨åŸæœ‰çš„å­—ç¬¦ä¸²ä¸Šè¿›è¡Œçš„ï¼Œè€Œæ˜¯é‡æ–°ç”Ÿæˆäº†æ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›æ“ä½œæ‰§è¡Œè¿‡åï¼Œ**åŸæ¥çš„å­—ç¬¦ä¸²å¯¹è±¡å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜**ã€‚â€

â€œä¸‰å¦¹ï¼Œä½ è®°ä½ï¼ŒString å¯¹è±¡ä¸€æ—¦è¢«åˆ›å»ºåå°±å›ºå®šä¸å˜äº†ï¼Œå¯¹ String å¯¹è±¡çš„ä»»ä½•ä¿®æ”¹éƒ½ä¸ä¼šå½±å“åˆ°åŸæ¥çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œéƒ½ä¼šç”Ÿæˆæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚â€

â€œå—¯å—¯ï¼Œè®°ä½äº†ï¼Œå“¥ã€‚â€ä¸‰å¦¹å¾ˆä¹–ã€‚

â€œé‚£ä»Šå¤©å°±å…ˆè®²åˆ°è¿™å§ï¼Œåé¢æˆ‘ä»¬å†å¯¹æ¯ä¸€ä¸ªç»†åˆ†é¢†åŸŸæ·±å…¥åœ°å±•å¼€ä¸€ä¸‹ã€‚ä½ å¯ä»¥æ‰¾ä¸€äº›èµ„æ–™å…ˆé¢„ä¹ ä¸‹ï¼Œæˆ‘å‡ºå»æ•£ä¼šå¿ƒã€‚ã€‚ã€‚ã€‚ã€‚â€


---

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 4.6 æ·±å…¥ç†è§£Javaå­—ç¬¦ä¸²å¸¸é‡æ± 

â€œä¸‰å¦¹ï¼Œä»Šå¤©æˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œè¿™æ˜¯å­—ç¬¦ä¸²ä¸­éå¸¸å…³é”®çš„ä¸€ä¸ªçŸ¥è¯†ç‚¹ã€‚â€æˆ‘è¯éŸ³æœªè½ï¼Œé’å²›è·¯å°å­¦é‚£è¾¹ä¼ æ¥äº†å˜¹äº®çš„æ­Œå£°å°±é’»è¿›äº†æˆ‘çš„è€³æœµï¼Œâ€œå”± ~ å±± ~ æ­Œ ~â€ï¼Œæˆ‘éƒ½æœ‰ç‚¹æƒ…ä¸è‡ªç¦åœ°å“¼å”±èµ·æ¥äº†ã€‚

ä¸‰å¦¹èµ¶ç´§æ‹¦ä½æˆ‘è¯´ï¼Œâ€œå¥½äº†ï¼Œå¼€å§‹å§ï¼Œå“¥ã€‚â€

### new String("äºŒå“¥")åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡

â€œå…ˆä»è¿™é“é¢è¯•é¢˜å¼€å§‹å§ï¼â€

```java
String s = new String("äºŒå“¥");
```

â€œè¿™è¡Œä»£ç åˆ›å»ºäº†å‡ ä¸ª[å¯¹è±¡](https://tobebetterjavaer.com/oo/object-class.html)ï¼Ÿâ€

â€œä¸å°±ä¸€ä¸ªå—ï¼Ÿâ€ä¸‰å¦¹ä¸å‡æ€ç´¢åœ°å›ç­”ã€‚

â€œä¸ï¼Œä¸¤ä¸ªï¼â€æˆ‘ç›´æ¥å¦å®šäº†ä¸‰å¦¹çš„ç­”æ¡ˆï¼Œâ€œä½¿ç”¨ new å…³é”®å­—åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡æ—¶ï¼ŒJava è™šæ‹Ÿæœºä¼šå…ˆåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æŸ¥æ‰¾æœ‰æ²¡æœ‰â€˜äºŒå“¥â€™è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¦‚æœæœ‰ï¼Œå°±ä¸ä¼šåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­åˆ›å»ºâ€˜äºŒå“¥â€™è¿™ä¸ªå¯¹è±¡äº†ï¼Œç›´æ¥åœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªâ€˜äºŒå“¥â€™çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œç„¶åå°†å †ä¸­è¿™ä¸ªâ€˜äºŒå“¥â€™çš„å¯¹è±¡åœ°å€è¿”å›èµ‹å€¼ç»™å˜é‡ sã€‚â€

â€œå¦‚æœæ²¡æœ‰ï¼Œå…ˆåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­åˆ›å»ºä¸€ä¸ªâ€˜äºŒå“¥â€™çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œç„¶åå†åœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªâ€˜äºŒå“¥â€™çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œç„¶åå°†å †ä¸­è¿™ä¸ªâ€˜äºŒå“¥â€™çš„å­—ç¬¦ä¸²å¯¹è±¡åœ°å€è¿”å›èµ‹å€¼ç»™å˜é‡ sã€‚â€

æˆ‘ç”»å›¾è¡¨ç¤ºä¸€ä¸‹ï¼Œä¼šæ›´åŠ æ¸…æ¥šã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/string//constant-pool-6dee151e-3a13-4f85-b870-3c9d1797557a.png)

åœ¨Javaä¸­ï¼Œæ ˆä¸Šå­˜å‚¨çš„æ˜¯åŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡å’Œå¯¹è±¡çš„å¼•ç”¨ï¼Œè€Œå¯¹è±¡æœ¬èº«åˆ™å­˜å‚¨åœ¨å †ä¸Šã€‚

å¯¹äºè¿™è¡Œä»£ç  `String s = new String("äºŒå“¥");`ï¼Œå®ƒåˆ›å»ºäº†ä¸¤ä¸ªå¯¹è±¡ï¼šä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²å¯¹è±¡ "äºŒå“¥"ï¼Œå®ƒè¢«æ·»åŠ åˆ°äº†å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œå¦ä¸€ä¸ªæ˜¯é€šè¿‡ new String() æ„é€ å‡½æ•°åˆ›å»ºçš„å­—ç¬¦ä¸²å¯¹è±¡ "äºŒå“¥"ï¼Œå®ƒè¢«åˆ†é…åœ¨å †å†…å­˜ä¸­ï¼ŒåŒæ—¶å¼•ç”¨å˜é‡ s å­˜å‚¨åœ¨æ ˆä¸Šï¼Œå®ƒæŒ‡å‘å †å†…å­˜ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡ "äºŒå“¥"ã€‚

â€œ**ä¸ºä»€ä¹ˆè¦å…ˆåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­åˆ›å»ºå¯¹è±¡ï¼Œç„¶åå†åœ¨å †ä¸Šåˆ›å»ºå‘¢**ï¼Ÿè¿™æ ·ä¸å°±å¤šæ­¤ä¸€ä¸¾äº†ï¼Ÿâ€ä¸‰å¦¹æ•é”åœ°å‘ç°äº†é—®é¢˜ã€‚

æˆ‘å›ç­”ï¼Œâ€œæ˜¯çš„ã€‚ç”±äºå­—ç¬¦ä¸²çš„ä½¿ç”¨é¢‘ç‡å®åœ¨æ˜¯å¤ªé«˜äº†ï¼Œæ‰€ä»¥ Java è™šæ‹Ÿæœºä¸ºäº†æé«˜æ€§èƒ½å’Œå‡å°‘å†…å­˜å¼€é”€ï¼Œåœ¨åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡çš„æ—¶å€™è¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–ï¼Œç‰¹æ„ä¸ºå­—ç¬¦ä¸²å¼€è¾Ÿäº†ä¸€å—ç©ºé—´â€”â€”ä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ã€‚â€

### å­—ç¬¦ä¸²å¸¸é‡æ± çš„ä½œç”¨

é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šé‡‡ç”¨åŒå¼•å·çš„æ–¹å¼æ¥åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡ï¼Œè€Œä¸æ˜¯é€šè¿‡ new å…³é”®å­—çš„æ–¹å¼ï¼Œå°±åƒä¸‹é¢ğŸ‘‡ğŸ»è¿™æ ·ï¼Œè¿™æ ·å°±ä¸ä¼šå¤šæ­¤ä¸€ä¸¾ï¼š

```java
String s = "ä¸‰å¦¹";
```

å½“æ‰§è¡Œ `String s = "ä¸‰å¦¹"` æ—¶ï¼ŒJava è™šæ‹Ÿæœºä¼šå…ˆåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æŸ¥æ‰¾æœ‰æ²¡æœ‰â€œä¸‰å¦¹â€è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¦‚æœæœ‰ï¼Œåˆ™ä¸åˆ›å»ºä»»ä½•å¯¹è±¡ï¼Œç›´æ¥å°†å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­è¿™ä¸ªâ€œä¸‰å¦¹â€çš„å¯¹è±¡åœ°å€è¿”å›ï¼Œèµ‹ç»™å˜é‡ sï¼›å¦‚æœæ²¡æœ‰ï¼Œåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­åˆ›å»ºâ€œä¸‰å¦¹â€è¿™ä¸ªå¯¹è±¡ï¼Œç„¶åå°†å…¶åœ°å€è¿”å›ï¼Œèµ‹ç»™å˜é‡ sã€‚


![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/string//constant-pool-80ca8b18-2446-431e-98e3-b194e1c608e3.png)

Java è™šæ‹Ÿæœºåˆ›å»ºäº†ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ "ä¸‰å¦¹"ï¼Œå®ƒè¢«æ·»åŠ åˆ°äº†å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼ŒåŒæ—¶å¼•ç”¨å˜é‡ s å­˜å‚¨åœ¨æ ˆä¸Šï¼Œå®ƒæŒ‡å‘å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡ "ä¸‰å¦¹"ã€‚ä½ çœ‹ï¼Œæ˜¯ä¸æ˜¯çœäº†ä¸€æ­¥ï¼Œæ¯”ä¹‹å‰é«˜æ•ˆäº†ã€‚


â€œå“¦ï¼Œæˆ‘æ˜ç™½äº†ï¼Œå“¥ã€‚â€ä¸‰å¦¹çªç„¶æ’è¯åˆ°ï¼Œâ€œæœ‰äº†å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œå°±å¯ä»¥é€šè¿‡åŒå¼•å·çš„æ–¹å¼ç›´æ¥åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡ï¼Œä¸ç”¨å†é€šè¿‡ new çš„æ–¹å¼åœ¨å †ä¸­åˆ›å»ºå¯¹è±¡äº†ï¼Œå¯¹å§ï¼Ÿâ€

â€œæ˜¯æ»´ã€‚new çš„æ–¹å¼å§‹ç»ˆä¼šåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œä¸ç®¡å­—ç¬¦ä¸²çš„å†…å®¹æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œè€ŒåŒå¼•å·çš„æ–¹å¼ä¼šé‡å¤åˆ©ç”¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å·²ç»å­˜åœ¨çš„å¯¹è±¡ã€‚â€æˆ‘è¯´ã€‚

æ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š

```java
String s = new String("äºŒå“¥");
String s1 = new String("äºŒå“¥");
```

æŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„åˆ†æï¼Œè¿™ä¸¤è¡Œä»£ç ä¼šåˆ›å»ºä¸‰ä¸ªå¯¹è±¡ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ä¸€ä¸ªï¼Œå †ä¸Šä¸¤ä¸ªã€‚

å†æ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š

```java
String s = "ä¸‰å¦¹";
String s1 = "ä¸‰å¦¹";
```

è¿™ä¸¤è¡Œä»£ç åªä¼šåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå°±æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„é‚£ä¸ªã€‚è¿™æ ·çš„è¯ï¼Œæ€§èƒ½è‚¯å®šå°±æé«˜äº†ï¼

### å­—ç¬¦ä¸²å¸¸é‡æ± åœ¨å†…å­˜ä¸­çš„ä»€ä¹ˆä½ç½®å‘¢ï¼Ÿ

â€œé‚£å“¥ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± åœ¨å†…å­˜ä¸­çš„ä»€ä¹ˆä½ç½®å‘¢ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

æˆ‘è¯´ï¼Œâ€œä¸‰å¦¹ï¼Œä½ è¿™ä¸ªé—®é¢˜é—®å¾—å¥½å‘€ï¼â€

åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µã€‚

#### Java 7 ä¹‹å‰

åœ¨ Java 7 ä¹‹å‰ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ä½äºæ°¸ä¹…ä»£ï¼ˆPermanent Generationï¼‰çš„å†…å­˜åŒºåŸŸä¸­ï¼Œä¸»è¦ç”¨æ¥å­˜å‚¨ä¸€äº›å­—ç¬¦ä¸²å¸¸é‡ï¼ˆé™æ€æ•°æ®çš„ä¸€ç§ï¼‰ã€‚æ°¸ä¹…ä»£æ˜¯ Java å †ï¼ˆJava Heapï¼‰çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜å‚¨ç±»ä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€å¸¸é‡æ± ä¿¡æ¯ç­‰é™æ€æ•°æ®ã€‚

è€Œ Java å †æ˜¯ JVM ä¸­å­˜å‚¨å¯¹è±¡å®ä¾‹å’Œæ•°ç»„çš„å†…å­˜åŒºåŸŸï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ°¸ä¹…ä»£æ˜¯ Java å †çš„ä¸€ä¸ªå­åŒºåŸŸã€‚

æ¢å¥è¯è¯´ï¼Œæ°¸ä¹…ä»£ä¸­å­˜å‚¨çš„é™æ€æ•°æ®ä¸å †ä¸­å­˜å‚¨çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„æ˜¯åˆ†å¼€çš„ï¼Œå®ƒä»¬æœ‰ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸå’Œåˆ†é…æ–¹å¼ã€‚

ä½†æ˜¯ï¼Œæ°¸ä¹…ä»£å’Œå †çš„å¤§å°æ˜¯ç›¸äº’å½±å“çš„ï¼Œå› ä¸ºå®ƒä»¬éƒ½ä½¿ç”¨äº† JVM å †å†…å­˜ï¼Œå› æ­¤å®ƒä»¬çš„å¤§å°éƒ½å—åˆ° JVM å †å¤§å°çš„é™åˆ¶ã€‚

äºæ˜¯ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡æ—¶ï¼Œå®ƒä¼šè¢«å‚¨å­˜åœ¨æ°¸ä¹…ä»£çš„å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ã€‚å¦‚æœæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ™®é€šå­—ç¬¦ä¸²å¯¹è±¡ï¼Œåˆ™å®ƒå°†è¢«å‚¨å­˜åœ¨å †ä¸­ã€‚å¦‚æœå­—ç¬¦ä¸²å¯¹è±¡çš„å†…å®¹æ˜¯ä¸€ä¸ªå·²ç»å­˜åœ¨äºå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²å¸¸é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡ä¼šæŒ‡å‘å·²ç»å­˜åœ¨çš„å­—ç¬¦ä¸²å¸¸é‡ï¼Œè€Œä¸æ˜¯é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚

ç”»å¹…å›¾ï¼Œå¤§æ¦‚å°±æ˜¯è¿™ä¸ªæ ·å­ã€‚


![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/string//constant-pool-ed6518ec-1d51-4718-ab8a-e1e2cda774bd.png)


#### Java 7

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ°¸ä¹…ä»£çš„å¤§å°æ˜¯æœ‰é™çš„ï¼Œå¹¶ä¸”å¾ˆéš¾å‡†ç¡®åœ°ç¡®å®šä¸€ä¸ªåº”ç”¨ç¨‹åºéœ€è¦å¤šå°‘æ°¸ä¹…ä»£ç©ºé—´ã€‚å¦‚æœæˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨äº†å¤§é‡çš„ç±»ã€æ–¹æ³•ã€å¸¸é‡ç­‰é™æ€æ•°æ®ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³ã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒJVM å°±ä¼šæŠ›å‡º OutOfMemoryError é”™è¯¯ã€‚

å› æ­¤ï¼Œä» Java 7 å¼€å§‹ï¼Œä¸ºäº†è§£å†³æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³çš„é—®é¢˜ï¼Œå°†å­—ç¬¦ä¸²å¸¸é‡æ± ä»æ°¸ä¹…ä»£ä¸­ç§»åŠ¨åˆ°å †ä¸­ã€‚è¿™ä¸ªæ”¹å˜ä¹Ÿæ˜¯ä¸ºäº†æ›´å¥½åœ°æ”¯æŒåŠ¨æ€è¯­è¨€çš„è¿è¡Œæ—¶ç‰¹æ€§ã€‚

å†ç”»å¹…å›¾ï¼Œå¤§æ¦‚å°±æ˜¯è¿™æ ·å­ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/string//constant-pool-f5231378-a442-421e-a470-8256da1715e8.png)

#### Java 8

åˆ°äº† Java 8ï¼Œæ°¸ä¹…ä»£ï¼ˆPermGenï¼‰è¢«å–æ¶ˆï¼Œå¹¶ç”±å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰å–ä»£ã€‚å…ƒç©ºé—´æ˜¯ä¸€å—æœ¬æœºå†…å­˜åŒºåŸŸï¼Œå’Œ JVM å†…å­˜åŒºåŸŸæ˜¯åˆ†å¼€çš„ã€‚ä¸è¿‡ï¼Œå…ƒç©ºé—´çš„ä½œç”¨ä¾ç„¶å’Œä¹‹å‰çš„æ°¸ä¹…ä»£ä¸€æ ·ï¼Œç”¨äºå­˜å‚¨ç±»ä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€å¸¸é‡æ± ä¿¡æ¯ç­‰é™æ€æ•°æ®ã€‚

ä¸æ°¸ä¹…ä»£ä¸åŒï¼Œå…ƒç©ºé—´å…·æœ‰ä¸€äº›ä¼˜ç‚¹ï¼Œä¾‹å¦‚ï¼š

- å®ƒä¸ä¼šå¯¼è‡´ OutOfMemoryError é”™è¯¯ï¼Œå› ä¸ºå…ƒç©ºé—´çš„å¤§å°å¯ä»¥åŠ¨æ€è°ƒæ•´ã€‚
- å…ƒç©ºé—´ä½¿ç”¨æœ¬æœºå†…å­˜ï¼Œè€Œä¸æ˜¯ JVM å †å†…å­˜ï¼Œè¿™å¯ä»¥é¿å…å †å†…å­˜çš„ç¢ç‰‡åŒ–é—®é¢˜ã€‚
- å…ƒç©ºé—´ä¸­çš„åƒåœ¾æ”¶é›†ä¸å †ä¸­çš„åƒåœ¾æ”¶é›†æ˜¯åˆ†ç¦»çš„ï¼Œè¿™å¯ä»¥é¿å…åº”ç”¨ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å› ä¸ºè¿›è¡Œç±»åŠ è½½å’Œå¸è½½è€Œé¢‘ç¹åœ°è§¦å‘ Full GCã€‚

å†ç”»å¹…å›¾ï¼Œå¯¹æ¯”æ¥çœ‹ä¸€ä¸‹ï¼Œå°±ä¼šä¸€ç›®äº†ç„¶ã€‚


![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/string//constant-pool-422e3214-97df-41ec-bcb5-132cfc76b669.png)

### æ°¸ä¹…ä»£ã€æ–¹æ³•åŒºã€å…ƒç©ºé—´


â€œå“¥ï¼Œèƒ½å†ç®€å•ç»™æˆ‘è§£é‡Šä¸€ä¸‹æ–¹æ³•åŒºï¼Œæ°¸ä¹…ä»£å’Œå…ƒç©ºé—´çš„æ¦‚å¿µå—ï¼Ÿæœ‰ç‚¹æ¨¡ç³Šã€‚â€ä¸‰å¦¹è¯´ã€‚

â€œå¯ä»¥å‘€ã€‚â€

- æ–¹æ³•åŒºæ˜¯ Java è™šæ‹Ÿæœºè§„èŒƒä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå°±åƒæ˜¯ä¸€ä¸ª[æ¥å£](https://tobebetterjavaer.com/oo/interface.html)å§ï¼›
- æ°¸ä¹…ä»£æ˜¯ HotSpot è™šæ‹Ÿæœºä¸­å¯¹æ–¹æ³•åŒºçš„ä¸€ä¸ªå®ç°ï¼Œå°±åƒæ˜¯æ¥å£çš„å®ç°ç±»ï¼›
- Java 8 çš„æ—¶å€™ï¼Œç§»é™¤äº†æ°¸ä¹…ä»£ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å…ƒç©ºé—´ï¼Œæ˜¯æ–¹æ³•åŒºçš„å¦å¤–ä¸€ç§å®ç°ï¼Œæ›´çµæ´»äº†ã€‚

æ°¸ä¹…ä»£æ˜¯æ”¾åœ¨è¿è¡Œæ—¶æ•°æ®åŒºä¸­çš„ï¼Œæ‰€ä»¥å®ƒçš„å¤§å°å—åˆ° Java è™šæ‹Ÿæœºæœ¬èº«å¤§å°çš„é™åˆ¶ï¼Œæ‰€ä»¥ Java 8 ä¹‹å‰ï¼Œä¼šç»å¸¸é‡åˆ° `java.lang.OutOfMemoryError: PremGen Space` çš„å¼‚å¸¸ï¼ŒPremGen Space å°±æ˜¯æ–¹æ³•åŒºçš„æ„æ€ï¼›è€Œå…ƒç©ºé—´æ˜¯ç›´æ¥æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œæ‰€ä»¥åªå—æœ¬æœºå¯ç”¨å†…å­˜çš„é™åˆ¶ã€‚

â€œæ˜ç™½äº†å§ï¼Œä¸‰å¦¹ï¼Ÿâ€æˆ‘é—®ã€‚

â€œå—¯å—¯ã€‚â€ä¸‰å¦¹å›ç­”ã€‚

â€œé‚£å…³äºå­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œå°±å…ˆè¯´è¿™ä¹ˆå¤šå§ï¼Œæ˜¯ä¸æ˜¯è¿˜æŒºæœ‰æ„æ€çš„ã€‚â€æˆ‘è¯´ã€‚

â€œæ˜¯çš„ï¼Œæˆ‘ç°åœ¨æ˜¯å½»åº•ææ‡‚äº†å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œå“¥ï¼Œä½ çœŸæ£’ï¼â€ä¸‰å¦¹è¯´ã€‚

---

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 4.7 è¯¦è§£ String.intern() æ–¹æ³•

â€œå“¥ï¼Œä½ å‘ç»™æˆ‘çš„é‚£ç¯‡æ–‡ç« æˆ‘çœ‹äº†ï¼Œç»“æœç›´æ¥æŠŠæˆ‘ç»™çœ‹å¾—ä¸æƒ³å­¦ Java äº†ï¼â€ä¸‰å¦¹æ°”å†²å†²åœ°è¯´ã€‚

â€œå“ªä¸€ç¯‡å•Šï¼Ÿâ€çœ‹ç€ä¸‰å¦¹é¢è‰²æ²‰é‡ï¼Œæˆ‘å…³å¿ƒåœ°é—®åˆ°ã€‚

â€œå°±æ˜¯[ç¾å›¢æŠ€æœ¯å›¢é˜Ÿæ·±å…¥è§£æ `String.intern()` é‚£ç¯‡](https://tech.meituan.com/2014/03/06/in-depth-understanding-string-intern.html)å•Šï¼â€ä¸‰å¦¹å›ç­”ã€‚

â€œå“¦ï¼Œæˆ‘æƒ³èµ·æ¥äº†ï¼Œä¸æŒºå¥½ä¸€ç¯‡æ–‡ç« å˜›ï¼Œæ·±å…¥æµ…å‡ºï¼Œç²¾å“ä¸­çš„ç²¾å“ï¼Œçœ‹å®Œåä½ åº”è¯¥å¯¹ String çš„ intern æ–¹æ³•å½»åº•ç†è§£äº†æ‰å¯¹å‘€ã€‚â€

â€œå¥½æ˜¯å¥½ï¼Œä½†æˆ‘å°±æ˜¯çœ‹ä¸æ‡‚ï¼â€ä¸‰å¦¹å§”å±ˆåœ°è¯´ï¼Œâ€œå“¥ï¼Œè¿˜æ˜¯ä½ äº²è‡ªç»™æˆ‘è®²è®²å§ï¼Ÿâ€

â€œå¥½å§ï¼Œä¸Šæ¬¡å­¦çš„[å­—ç¬¦ä¸²å¸¸é‡æ± ](https://tobebetterjavaer.com/string/constant-pool.html)ä½ éƒ½ææ¸…æ¥šäº†å§ï¼Ÿâ€

â€œå—¯ã€‚â€ä¸‰å¦¹å¾®å¾®çš„ç‚¹äº†ç‚¹å¤´ã€‚

è¦ç†è§£ç¾å›¢æŠ€æœ¯å›¢é˜Ÿçš„è¿™ç¯‡æ–‡ç« ï¼Œä½ åªéœ€è¦è®°ä½è¿™å‡ ç‚¹å†…å®¹ï¼š

ç¬¬ä¸€ï¼Œä½¿ç”¨åŒå¼•å·å£°æ˜çš„å­—ç¬¦ä¸²å¯¹è±¡ä¼šä¿å­˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ã€‚

ç¬¬äºŒï¼Œä½¿ç”¨ new å…³é”®å­—åˆ›å»ºçš„å­—ç¬¦ä¸²å¯¹è±¡ä¼šå…ˆä»å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ‰¾ï¼Œå¦‚æœæ²¡æ‰¾åˆ°å°±åˆ›å»ºä¸€ä¸ªï¼Œç„¶åå†åœ¨å †ä¸­åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡ï¼›å¦‚æœæ‰¾åˆ°äº†ï¼Œå°±ç›´æ¥åœ¨å †ä¸­åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡ã€‚

ç¬¬ä¸‰ï¼Œé’ˆå¯¹æ²¡æœ‰ä½¿ç”¨åŒå¼•å·å£°æ˜çš„å­—ç¬¦ä¸²å¯¹è±¡æ¥è¯´ï¼Œå°±åƒä¸‹é¢ä»£ç ä¸­çš„ s1 é‚£æ ·ï¼š

```java
String s1 = new String("äºŒå“¥") + new String("ä¸‰å¦¹");
```

å¦‚æœæƒ³æŠŠ s1 çš„å†…å®¹ä¹Ÿæ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± çš„è¯ï¼Œå¯ä»¥è°ƒç”¨ `intern()` æ–¹æ³•æ¥å®Œæˆã€‚

ä¸è¿‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒJava 7 çš„æ—¶å€™ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ä»æ°¸ä¹…ä»£ä¸­ç§»åŠ¨åˆ°äº†å †ä¸­ï¼Œè™½ç„¶æ­¤æ—¶æ°¸ä¹…ä»£è¿˜æ²¡æœ‰å®Œå…¨è¢«ç§»é™¤ã€‚Java 8 çš„æ—¶å€™ï¼Œæ°¸ä¹…ä»£è¢«å½»åº•ç§»é™¤ã€‚

è¿™ä¸ªå˜åŒ–ä¹Ÿç›´æ¥å½±å“äº†  `String.intern()` æ–¹æ³•åœ¨æ‰§è¡Œæ—¶çš„ç­–ç•¥ï¼ŒJava 7 ä¹‹å‰ï¼Œæ‰§è¡Œ `String.intern()` æ–¹æ³•çš„æ—¶å€™ï¼Œä¸ç®¡å¯¹è±¡åœ¨å †ä¸­æ˜¯å¦å·²ç»åˆ›å»ºï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ä»ç„¶ä¼šåˆ›å»ºä¸€ä¸ªå†…å®¹å®Œå…¨ç›¸åŒçš„æ–°å¯¹è±¡ï¼› Java 7 ä¹‹åå‘¢ï¼Œç”±äºå­—ç¬¦ä¸²å¸¸é‡æ± æ”¾åœ¨äº†å †ä¸­ï¼Œæ‰§è¡Œ `String.intern()` æ–¹æ³•çš„æ—¶å€™ï¼Œå¦‚æœå¯¹è±¡åœ¨å †ä¸­å·²ç»åˆ›å»ºäº†ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å°±ä¸éœ€è¦å†åˆ›å»ºæ–°çš„å¯¹è±¡äº†ï¼Œè€Œæ˜¯ç›´æ¥ä¿å­˜å †ä¸­å¯¹è±¡çš„å¼•ç”¨ï¼Œä¹Ÿå°±èŠ‚çœäº†ä¸€éƒ¨åˆ†çš„å†…å­˜ç©ºé—´ã€‚

â€œè¿˜æ²¡æœ‰ç†è§£æ¸…æ¥šï¼ŒäºŒå“¥â€ï¼Œä¸‰å¦¹å¾ˆè‹¦æ¼ã€‚

â€œå—¯ã€‚ã€‚ã€‚åˆ«æ€•ï¼Œä¸‰å¦¹ï¼Œå…ˆæ¥çŒœçŒœè¿™æ®µä»£ç è¾“å‡ºçš„ç»“æœå§ã€‚â€æˆ‘è¯´ã€‚

```java
String s1 = new String("äºŒå“¥ä¸‰å¦¹");
String s2 = s1.intern();
System.out.println(s1 == s2);
```

â€œå“¥ï¼Œè¿™æˆ‘å®Œå…¨çŒœä¸å‡ºå•Šï¼Œè¿˜æ˜¯ä½ ç›´æ¥è§£é‡Šå§ã€‚â€ä¸‰å¦¹è¯´ã€‚

â€œå¥½å§ã€‚â€

ç¬¬ä¸€è¡Œä»£ç ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ä¼šå…ˆåˆ›å»ºä¸€ä¸ªâ€œäºŒå“¥ä¸‰å¦¹â€çš„å¯¹è±¡ï¼Œç„¶åå †ä¸­ä¼šå†åˆ›å»ºä¸€ä¸ªâ€œäºŒå“¥ä¸‰å¦¹â€çš„å¯¹è±¡ï¼Œs1 å¼•ç”¨çš„æ˜¯å †ä¸­çš„å¯¹è±¡ã€‚

ç¬¬äºŒè¡Œä»£ç ï¼Œå¯¹ s1 æ‰§è¡Œ `intern()` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šä»å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æŸ¥æ‰¾â€œäºŒå“¥ä¸‰å¦¹â€è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯å¦å­˜åœ¨ï¼Œæ­¤æ—¶æ˜¯å­˜åœ¨çš„ï¼Œæ‰€ä»¥ s2 å¼•ç”¨çš„æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å¯¹è±¡ã€‚

ä¹Ÿå°±æ„å‘³ç€ s1 å’Œ s2 çš„å¼•ç”¨åœ°å€æ˜¯ä¸åŒçš„ï¼Œä¸€ä¸ªæ¥è‡ªå †ï¼Œä¸€ä¸ªæ¥è‡ªå­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œæ‰€ä»¥è¾“å‡ºçš„ç»“æœä¸º falseã€‚

â€œæ¥çœ‹ä¸€ä¸‹è¿è¡Œç»“æœã€‚â€æˆ‘è¯´ã€‚

```
false
```

â€œæˆ‘æ¥ç”»å¹…å›¾ï¼Œå¸®åŠ©ä½ ç†è§£ä¸‹ã€‚â€çœ‹åˆ°ä¸‰å¦¹æƒŠè®¶çš„è¡¨æƒ…ï¼Œæˆ‘è€å¿ƒåœ°è¯´ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/string/intern-01.png)

â€œè¿™ä¸‹ç†è§£äº†å§ï¼Ÿâ€æˆ‘é—®ä¸‰å¦¹ã€‚

â€œå—¯å—¯ï¼Œä¸€ä¸‹å­å°±è±ç„¶å¼€æœ—äº†ï¼â€ä¸‰å¦¹è¯´ã€‚

â€œå¥½ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ã€‚â€

```java
String s1 = new String("äºŒå“¥") + new String("ä¸‰å¦¹");
String s2 = s1.intern();
System.out.println(s1 == s2);
```

â€œéš¾é“ä¹Ÿè¾“å‡º false ï¼Ÿâ€ä¸‰å¦¹æœ‰ç‚¹ä¸ç¡®å®šã€‚

â€œä¸ï¼Œè¿™æ®µä»£ç ä¼šè¾“å‡º trueã€‚â€æˆ‘å¦å®šäº†ä¸‰å¦¹çš„çŒœæµ‹ã€‚

â€œä¸ºå•¥å‘€ï¼Ÿâ€ä¸‰å¦¹è¿«åˆ‡åœ°æƒ³è¦çŸ¥é“ç­”æ¡ˆã€‚

ç¬¬ä¸€è¡Œä»£ç ï¼Œä¼šåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­åˆ›å»ºä¸¤ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯â€œäºŒå“¥â€ï¼Œä¸€ä¸ªæ˜¯â€œä¸‰å¦¹â€ï¼Œç„¶ååœ¨å †ä¸­ä¼šåˆ›å»ºä¸¤ä¸ªåŒ¿åå¯¹è±¡â€œäºŒå“¥â€å’Œâ€œä¸‰å¦¹â€ï¼Œæœ€åè¿˜æœ‰ä¸€ä¸ªâ€œäºŒå“¥ä¸‰å¦¹â€çš„å¯¹è±¡ï¼ˆç¨åä¼šè§£é‡Šï¼‰ï¼Œs1 å¼•ç”¨çš„æ˜¯å †ä¸­â€œäºŒå“¥ä¸‰å¦¹â€è¿™ä¸ªå¯¹è±¡ã€‚

ç¬¬äºŒè¡Œä»£ç ï¼Œå¯¹ s1 æ‰§è¡Œ `intern()` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šä»å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æŸ¥æ‰¾â€œäºŒå“¥ä¸‰å¦¹â€è¿™ä¸ªå¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œæ­¤æ—¶ä¸å­˜åœ¨çš„ï¼Œä½†å †ä¸­å·²ç»å­˜åœ¨äº†ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ä¿å­˜çš„æ˜¯å †ä¸­è¿™ä¸ªâ€œäºŒå“¥ä¸‰å¦¹â€å¯¹è±¡çš„å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œs2 å’Œ s1 çš„å¼•ç”¨åœ°å€æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥è¾“å‡ºçš„ç»“æœä¸º trueã€‚

â€œæ¥çœ‹ä¸€ä¸‹è¿è¡Œç»“æœã€‚â€æˆ‘èƒ¸æœ‰æˆç«¹åœ°è¯´ã€‚

```
true
```

â€œæˆ‘å†æ¥ç”»å¹…å›¾ï¼Œå¸®åŠ©ä½ ç†è§£ä¸‹ã€‚â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/string/intern-02.png)

â€œå“‡ï¼Œæˆ‘æ˜ç™½äº†ï¼â€ä¸‰å¦¹é•¿èˆ’ä¸€å£æ°”ï¼Œå¤§æœ‰æ„Ÿæ…¨ intern ä¹Ÿæ²¡ä»€ä¹ˆéš¾ç†è§£çš„æ„å‘³ï¼Œâ€œä¸è¿‡ï¼Œæˆ‘æœ‰ä¸€ä¸ªç–‘æƒ‘ï¼Œâ€œäºŒå“¥ä¸‰å¦¹â€è¿™ä¸ªå¯¹è±¡æ˜¯ä»€ä¹ˆæ—¶å€™åˆ›å»ºçš„å‘¢ï¼Ÿâ€

â€œä¸‰å¦¹ï¼Œä¸é”™å˜›ï¼Œèƒ½æŠ“ä½é—®é¢˜çš„å…³é”®ã€‚å†æ¥è§£é‡Šä¸€ä¸‹ `String s1 = new String("äºŒå“¥") + new String("ä¸‰å¦¹")` è¿™è¡Œä»£ç ã€‚â€æˆ‘å¯¹ä¸‰å¦¹çš„è¡¨ç°éå¸¸å¼€å¿ƒã€‚

1. åˆ›å»º "äºŒå“¥" å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå­˜å‚¨åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ã€‚
2. åˆ›å»º "ä¸‰å¦¹" å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå­˜å‚¨åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ã€‚
3. æ‰§è¡Œ `new String("äºŒå“¥")`ï¼Œåœ¨å †ä¸Šåˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œå†…å®¹ä¸º "äºŒå“¥"ã€‚
4. æ‰§è¡Œ `new String("ä¸‰å¦¹")`ï¼Œåœ¨å †ä¸Šåˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œå†…å®¹ä¸º "ä¸‰å¦¹"ã€‚
5. æ‰§è¡Œ `new String("äºŒå“¥") + new String("ä¸‰å¦¹")`ï¼Œä¼šåˆ›å»ºä¸€ä¸ª StringBuilder å¯¹è±¡ï¼Œå¹¶å°† "äºŒå“¥" å’Œ "ä¸‰å¦¹" è¿½åŠ åˆ°å…¶ä¸­ï¼Œç„¶åè°ƒç”¨ StringBuilder å¯¹è±¡çš„ toString() æ–¹æ³•ï¼Œå°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå†…å®¹ä¸º "äºŒå“¥ä¸‰å¦¹"ã€‚è¿™ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡å­˜å‚¨åœ¨å †ä¸Šã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ç¼–è¯‘å™¨é‡åˆ° `+` å·è¿™ä¸ªæ“ä½œç¬¦çš„æ—¶å€™ï¼Œä¼šå°† `new String("äºŒå“¥") + new String("ä¸‰å¦¹")` è¿™è¡Œä»£ç ç¼–è¯‘ä¸ºä»¥ä¸‹ä»£ç ï¼š

```
new StringBuilder().append("äºŒå“¥").append("ä¸‰å¦¹").toString();
```

å®é™…æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š

- åˆ›å»ºä¸€ä¸ª StringBuilder å¯¹è±¡ã€‚
- åœ¨ StringBuilder å¯¹è±¡ä¸Šè°ƒç”¨ append("äºŒå“¥")ï¼Œå°† "äºŒå“¥" è¿½åŠ åˆ° StringBuilder ä¸­ã€‚
- åœ¨ StringBuilder å¯¹è±¡ä¸Šè°ƒç”¨ append("ä¸‰å¦¹")ï¼Œå°† "ä¸‰å¦¹" è¿½åŠ åˆ° StringBuilder ä¸­ã€‚
- åœ¨ StringBuilder å¯¹è±¡ä¸Šè°ƒç”¨ toString() æ–¹æ³•ï¼Œå°† StringBuilder è½¬æ¢ä¸ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå†…å®¹ä¸º "äºŒå“¥ä¸‰å¦¹"ã€‚

å…³äº [StringBuilder](https://tobebetterjavaer.com/string/builder-buffer.html)ï¼Œæˆ‘ä»¬éšåä¼šè¯¦ç»†åœ°è®²åˆ°ã€‚ä»Šå¤©å…ˆäº†è§£åˆ°è¿™ã€‚

ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡ intern å¯ä»¥ç¡®ä¿æ‰€æœ‰å…·æœ‰ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²å…±äº«ç›¸åŒçš„å†…å­˜ç©ºé—´ï¼Œä½†ä¹Ÿä¸è¦çƒ‚ç”¨ internï¼Œå› ä¸ºä»»ä½•çš„ç¼“å­˜æ± éƒ½æ˜¯æœ‰å¤§å°é™åˆ¶çš„ï¼Œä¸èƒ½æ— ç¼˜æ— æ•…å°±å ç”¨äº†ç›¸å¯¹ç¨€ç¼ºçš„ç¼“å­˜ç©ºé—´ï¼Œå¯¼è‡´å…¶ä»–å­—ç¬¦ä¸²æ²¡æœ‰å‘ä½å¯å ã€‚

å¦å¤–ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„ StringTableï¼Œå¦‚æœæ”¾è¿›å»çš„å­—ç¬¦ä¸²è¿‡å¤šï¼Œå°±ä¼šé€ æˆä¸¥é‡çš„å“ˆå¸Œå†²çªï¼Œä»è€Œå¯¼è‡´é“¾è¡¨å˜é•¿ï¼Œé“¾è¡¨å˜é•¿ä¹Ÿå°±æ„å‘³ç€å­—ç¬¦ä¸²å¸¸é‡æ± çš„æ€§èƒ½ä¼šå¤§å¹…ä¸‹é™ï¼Œå› ä¸ºè¦ä¸€ä¸ªä¸€ä¸ªæ‰¾æ˜¯éœ€è¦èŠ±è´¹æ—¶é—´çš„ã€‚

â€œå¥½äº†ï¼Œä¸‰å¦¹ï¼Œå…³äº String çš„ intern å°±è®²åˆ°è¿™å§ï¼Œè¿™æ¬¡ç†è§£äº†å§ï¼Ÿâ€æˆ‘é—®ã€‚

â€œå“¥ï¼Œä½ çœŸæ£’ï¼â€

çœ‹åˆ°ä¸‰å¦¹ä¸€ç‚¹ä¸€æ»´çš„è¿›æ­¥ï¼Œæˆ‘ä¹Ÿæ„Ÿåˆ°ç”±è¡·çš„å¼€å¿ƒã€‚

---

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 4.8 Stringã€StringBuilderã€StringBuffer

â€œå“¥ï¼Œ[ä¸Šä¸€ç¯‡æ·±å…¥ç†è§£ String.intern()](https://tobebetterjavaer.com/string/intern.html) è®²åˆ°äº† StringBuilderï¼Œè¿™ä¸€èŠ‚æˆ‘ä»¬å°±æ¥èŠèŠå§ï¼â€ä¸‰å¦¹å¾ˆæœŸå¾…ã€‚

â€œå¥½å•Šï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»è¿˜çœŸçš„æ˜¯æŒºå’Œè°çš„ã€‚â€çœ‹ç€ä¸‰å¦¹å¥½å¥‡çš„æ ·å­ï¼Œæˆ‘æ„Ÿåˆ°å­¦æŠ€æœ¯å°±åº”è¯¥æ˜¯è¿™ä¸ªæ ·å­æ‰å¯¹ã€‚

ç”±äºå­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œæ‰€ä»¥å½“é‡åˆ°[å­—ç¬¦ä¸²æ‹¼æ¥](https://tobebetterjavaer.com/string/join.html)ï¼ˆå°¤å…¶æ˜¯ä½¿ç”¨`+`å·æ“ä½œç¬¦ï¼‰çš„æ—¶å€™ï¼Œå°±éœ€è¦è€ƒé‡æ€§èƒ½çš„é—®é¢˜ï¼Œä½ ä¸èƒ½æ¯«æ— é¡¾è™‘åœ°ç”Ÿäº§å¤ªå¤š String å¯¹è±¡ï¼Œå¯¹çè´µçš„å†…å­˜é€ æˆä¸å¿…è¦çš„å‹åŠ›ã€‚

äºæ˜¯ Java å°±è®¾è®¡äº†ä¸€ä¸ªä¸“é—¨ç”¨æ¥è§£å†³æ­¤é—®é¢˜çš„ StringBuffer ç±»ã€‚

```java
public final class StringBuffer extends AbstractStringBuilder implements Serializable, CharSequence {

    public StringBuffer() {
        super(16);
    }
    
    public synchronized StringBuffer append(String str) {
        super.append(str);
        return this;
    }

    public synchronized String toString() {
        return new String(value, 0, count);
    }

    // å…¶ä»–æ–¹æ³•
}
```

ä¸è¿‡ï¼Œç”±äº StringBuffer æ“ä½œå­—ç¬¦ä¸²çš„æ–¹æ³•åŠ äº† [`synchronized` å…³é”®å­—](https://tobebetterjavaer.com/thread/synchronized-1.html)è¿›è¡Œäº†åŒæ­¥ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å®‰å…¨é—®é¢˜ï¼Œæ‰€ä»¥æ‰§è¡Œæ•ˆç‡ä¼šæ¯”è¾ƒä½ã€‚

äºæ˜¯ Java å°±ç»™ StringBuffer â€œç”Ÿäº†ä¸ªå…„å¼Ÿâ€ï¼Œåå« StringBuilderï¼Œè¯´ï¼Œâ€œå­©å­ï¼Œä½ åˆ«ç®¡çº¿ç¨‹å®‰å…¨äº†ï¼Œä½ å°±åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œè¿™æ ·æ•ˆç‡ä¼šé«˜å¾—å¤šï¼Œå¦‚æœè¦åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¿®æ”¹å­—ç¬¦ä¸²ï¼Œä½ åˆ°æ—¶å€™å¯ä»¥ä½¿ç”¨ [`ThreadLocal`](https://tobebetterjavaer.com/thread/ThreadLocal.html) æ¥é¿å…å¤šçº¿ç¨‹å†²çªã€‚â€

```java
public final class StringBuilder extends AbstractStringBuilder
    implements java.io.Serializable, CharSequence
{
    // ...

    public StringBuilder append(String str) {
        super.append(str);
        return this;
    }

    public String toString() {
        // Create a copy, don't share the array
        return new String(value, 0, count);
    }

    // ...
}
```

é™¤äº†ç±»åä¸åŒï¼Œæ–¹æ³•æ²¡æœ‰åŠ  synchronizedï¼ŒåŸºæœ¬ä¸Šå®Œå…¨ä¸€æ ·ã€‚

å®é™…å¼€å‘ä¸­ï¼ŒStringBuilder çš„ä½¿ç”¨é¢‘ç‡ä¹Ÿæ˜¯è¿œé«˜äº StringBufferï¼Œç”šè‡³å¯ä»¥è¿™ä¹ˆè¯´ï¼ŒStringBuilder å®Œå…¨å–ä»£äº† StringBufferã€‚

[ä¹‹å‰æˆ‘ä»¬ä¹Ÿæ›¾èŠè¿‡](https://tobebetterjavaer.com/overview/what-is-java.html)ï¼ŒJava æ˜¯ä¸€é—¨è§£é‡Šå‹çš„ç¼–ç¨‹è¯­è¨€ï¼Œæ‰€ä»¥å½“ç¼–è¯‘å™¨é‡åˆ° `+` å·è¿™ä¸ªæ“ä½œç¬¦çš„æ—¶å€™ï¼Œä¼šå°† `new String("äºŒå“¥") + new String("ä¸‰å¦¹")` è¿™è¡Œä»£ç ç¼–è¯‘ä¸ºä»¥ä¸‹ä»£ç ï¼š

```java
new StringBuilder().append("äºŒå“¥").append("ä¸‰å¦¹").toString();
```

è¿™ä¸ªè¿‡ç¨‹æ˜¯æˆ‘ä»¬çœ‹ä¸è§çš„ï¼Œä½†è¿™æ­£æ˜¯ Java çš„â€œæ™ºèƒ½â€ä¹‹å¤„ï¼Œå®ƒå¯ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™å·å·åœ°å¸®æˆ‘ä»¬åšå¾ˆå¤šä¼˜åŒ–ï¼Œè¿™æ ·æ—¢å¯ä»¥æé«˜æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ï¼ˆ`+` å·å†™èµ·æ¥æ¯”åˆ›å»º StringBuilder å¯¹è±¡ä¾¿æ·å¾—å¤šï¼‰ï¼Œä¹Ÿä¸ä¼šå½±å“ JVM çš„æ‰§è¡Œæ•ˆç‡ã€‚

å½“ç„¶äº†ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ [javap](https://tobebetterjavaer.com/jvm/bytecode.html) åç¼–è¯‘ `new String("äºŒå“¥") + new String("ä¸‰å¦¹")` çš„å­—èŠ‚ç çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯èƒ½çœ‹å‡º StringBuilder çš„å½±å­çš„ã€‚

```
0: new           #2                  // class java/lang/StringBuilder
3: dup
4: invokespecial #3                  // Method java/lang/StringBuilder."<init>":()V
7: new           #4                  // class java/lang/String
10: dup
11: ldc           #5                  // String äºŒå“¥
13: invokespecial #6                  // Method java/lang/String."<init>":(Ljava/lang/String;)V
16: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
19: new           #4                  // class java/lang/String
22: dup
23: ldc           #8                  // String ä¸‰å¦¹
25: invokespecial #6                  // Method java/lang/String."<init>":(Ljava/lang/String;)V
28: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
31: invokevirtual #9                  // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
34: areturn
```

å¯ä»¥çœ‹åˆ° Java ç¼–è¯‘å™¨å°†å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œï¼ˆ`+`ï¼‰è½¬æ¢ä¸ºäº† StringBuilder å¯¹è±¡çš„ append æ–¹æ³•ï¼Œç„¶åå†è°ƒç”¨ StringBuilder å¯¹è±¡çš„ toString æ–¹æ³•è¿”å›æ‹¼æ¥åçš„å­—ç¬¦ä¸²ã€‚

æ¥çœ‹ä¸€ä¸‹ StringBuilder çš„ toString æ–¹æ³•ï¼š

```java
public String toString() {
    return new String(value, 0, count);
}
```

value æ˜¯ä¸€ä¸ª char ç±»å‹çš„æ•°ç»„ï¼š

```java
/**
 * The value is used for character storage.
 */
char[] value;
```

åœ¨ StringBuilder å¯¹è±¡åˆ›å»ºæ—¶ï¼Œä¼šä¸º value åˆ†é…ä¸€å®šçš„å†…å­˜ç©ºé—´ï¼ˆåˆå§‹å®¹é‡ 16ï¼‰ï¼Œç”¨äºå­˜å‚¨å­—ç¬¦ä¸²ã€‚

```java
/**
 * Constructs a string builder with no characters in it and an
 * initial capacity of 16 characters.
 */
public StringBuilder() {
    super(16);
}
```

éšç€å­—ç¬¦ä¸²çš„æ‹¼æ¥ï¼Œvalue æ•°ç»„çš„é•¿åº¦ä¼šä¸æ–­å¢åŠ ï¼Œå› æ­¤åœ¨ StringBuilder å¯¹è±¡çš„å®ç°ä¸­ï¼Œvalue æ•°ç»„çš„é•¿åº¦æ˜¯å¯ä»¥[åŠ¨æ€æ‰©å±•çš„ï¼Œå°±åƒArrayListé‚£æ ·](https://tobebetterjavaer.com/collection/arraylist.html)ã€‚

ç»§ç»­æ¥çœ‹ StringBuilder çš„ toString æ–¹æ³•ï¼š

```java
public String toString() {
    return new String(value, 0, count);
}
```

value ç”¨äºå­˜å‚¨ StringBuilder å¯¹è±¡ä¸­åŒ…å«çš„å­—ç¬¦åºåˆ—ã€‚count æ˜¯ä¸€ä¸ª int ç±»å‹çš„å˜é‡ï¼Œè¡¨ç¤ºå­—ç¬¦åºåˆ—çš„é•¿åº¦ã€‚toString() æ–¹æ³•ä¼šè°ƒç”¨ `new String(value, 0, count)`ï¼Œä½¿ç”¨ value æ•°ç»„ä¸­ä» 0 å¼€å§‹çš„å‰ count ä¸ªå…ƒç´ åˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¹¶å°†å…¶è¿”å›ã€‚

å†æ¥çœ‹ä¸€ä¸‹ append æ–¹æ³•ï¼š

```java
public StringBuilder append(String str) {
    super.append(str);
    return this;
}
```

å®é™…ä¸Šæ˜¯è°ƒç”¨äº† AbstractStringBuilder ä¸­çš„ append(String str) æ–¹æ³•ã€‚åœ¨ AbstractStringBuilder ä¸­ï¼Œappend(String str) æ–¹æ³•ä¼šæ£€æŸ¥å½“å‰å­—ç¬¦åºåˆ—ä¸­çš„å­—ç¬¦æ˜¯å¦å¤Ÿç”¨ï¼Œå¦‚æœä¸å¤Ÿç”¨åˆ™ä¼šè¿›è¡Œæ‰©å®¹ï¼Œå¹¶å°†æŒ‡å®šå­—ç¬¦ä¸²è¿½åŠ åˆ°å­—ç¬¦åºåˆ—çš„æœ«å°¾ã€‚

```java
/**
 * Appends the specified string to this character sequence.
 * <p>
 * The characters of the {@code String} argument are appended, in order,
 * increasing the length of this sequence by the length of the argument.
 * If {@code str} is {@code null}, then the four characters {@code "null"}
 * are appended.
 * <p>
 * Let <i>n</i> be the length of this character sequence just prior to
 * execution of the {@code append} method. Then the character at index
 * <i>k</i> in this character sequence is equal to the character at index
 * <i>k</i> in the argument {@code str}, if <i>k</i> is less than
 * <i>n</i>; otherwise, it is equal to the character at index
 * <i>k-n</i> in the argument {@code str}.
 *
 * @param   str   a string.
 * @return  a reference to this object.
 */
public AbstractStringBuilder append(String str) {
    if (str == null)
        return appendNull();
    int len = str.length();
    ensureCapacityInternal(count + len);
    str.getChars(0, len, value, count);
    count += len;
    return this;
}
```

`append(String str)` æ–¹æ³•å°†æŒ‡å®šå­—ç¬¦ä¸²è¿½åŠ åˆ°å½“å‰å­—ç¬¦åºåˆ—ä¸­ã€‚å¦‚æœæŒ‡å®šå­—ç¬¦ä¸²ä¸º nullï¼Œåˆ™è¿½åŠ å­—ç¬¦ä¸² "null"ï¼›å¦åˆ™ä¼šæ£€æŸ¥æŒ‡å®šå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œç„¶åæ ¹æ®å½“å‰å­—ç¬¦åºåˆ—ä¸­çš„å­—ç¬¦æ•°å’ŒæŒ‡å®šå­—ç¬¦ä¸²çš„é•¿åº¦æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ã€‚

å¦‚æœéœ€è¦æ‰©å®¹ï¼Œåˆ™ä¼šè°ƒç”¨ `ensureCapacityInternal(int minimumCapacity) `æ–¹æ³•è¿›è¡Œæ‰©å®¹ã€‚æ‰©å®¹ä¹‹åï¼Œå°†æŒ‡å®šå­—ç¬¦ä¸²çš„å­—ç¬¦æ‹·è´åˆ°å­—ç¬¦åºåˆ—ä¸­ã€‚

æ¥çœ‹ä¸€ä¸‹ ensureCapacityInternal æ–¹æ³•ï¼š

```java
private void ensureCapacityInternal(int minimumCapacity) {
    // overflow-conscious code
    if (minimumCapacity - value.length > 0)
        expandCapacity(minimumCapacity);
}

void expandCapacity(int minimumCapacity) {
    int newCapacity = value.length * 2 + 2;
    if (newCapacity - minimumCapacity < 0)
        newCapacity = minimumCapacity;
    if (newCapacity < 0) {
        if (minimumCapacity < 0) // overflow
            throw new OutOfMemoryError();
        newCapacity = Integer.MAX_VALUE;
    }
    value = Arrays.copyOf(value, newCapacity);
}
```

`ensureCapacityInternal(int minimumCapacity)` æ–¹æ³•ç”¨äºç¡®ä¿å½“å‰å­—ç¬¦åºåˆ—çš„å®¹é‡è‡³å°‘ç­‰äºæŒ‡å®šçš„æœ€å°å®¹é‡ minimumCapacityã€‚å¦‚æœå½“å‰å®¹é‡å°äºæŒ‡å®šçš„å®¹é‡ï¼Œå°±ä¼šä¸ºå­—ç¬¦åºåˆ—åˆ†é…ä¸€ä¸ªæ–°çš„å†…éƒ¨æ•°ç»„ã€‚æ–°å®¹é‡çš„è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š

- å¦‚æœæŒ‡å®šçš„æœ€å°å®¹é‡å¤§äºå½“å‰å®¹é‡ï¼Œåˆ™æ–°å®¹é‡ä¸ºä¸¤å€çš„æ—§å®¹é‡åŠ ä¸Š 2ï¼›
- å¦‚æœæŒ‡å®šçš„æœ€å°å®¹é‡å°äºç­‰äºå½“å‰å®¹é‡ï¼Œåˆ™ä¸ä¼šè¿›è¡Œæ‰©å®¹ï¼Œç›´æ¥è¿”å›å½“å‰å¯¹è±¡ã€‚

åœ¨è¿›è¡Œæ‰©å®¹ä¹‹å‰ï¼Œ`ensureCapacityInternal(int minimumCapacity)` æ–¹æ³•ä¼šå…ˆæ£€æŸ¥å½“å‰å­—ç¬¦åºåˆ—çš„å®¹é‡æ˜¯å¦è¶³å¤Ÿï¼Œå¦‚æœä¸è¶³å°±ä¼šè°ƒç”¨ `expandCapacity(int minimumCapacity)` æ–¹æ³•è¿›è¡Œæ‰©å®¹ã€‚`expandCapacity(int minimumCapacity)` æ–¹æ³•é¦–å…ˆè®¡ç®—å‡ºæ–°å®¹é‡ï¼Œç„¶åä½¿ç”¨ `Arrays.copyOf(char[] original, int newLength)` æ–¹æ³•å°†åŸå­—ç¬¦æ•°ç»„æ‰©å®¹åˆ°æ–°å®¹é‡çš„å¤§å°ã€‚

å…³äºæ‰©å®¹ï¼Œåé¢åœ¨è®²[ArrayList](https://tobebetterjavaer.com/collection/arraylist.html)çš„æ—¶å€™ä¼šå†æ¬¡è¯´æ˜ï¼Œä»Šå¤©å°±å…ˆèŠåˆ°è¿™å§ã€‚

â€œæˆ‘æƒ³ï¼Œå…³äº Stringã€StringBuilderã€StringBuilder ä¹‹é—´çš„å·®åˆ«ï¼Œä½ éƒ½ææ¸…æ¥šäº†å§ï¼Ÿâ€æˆ‘é—®ã€‚

â€œå“¥ï¼Œä½ çœŸæ£’ï¼åŒºåˆ«æˆ‘æ˜¯ææ¸…æ¥šäº†ï¼Œä½ åé¢è®²çš„æºç æ‰©å®¹è¿˜æ²¡æ¶ˆåŒ–ï¼Œæˆ‘ä¸€ä¼šå»åŠ ä¸ªé¤ï¼Œå†ç»†çœ‹ä¸€ä¸‹ã€‚â€ä¸‰å¦¹è¯´ã€‚

â€œå¯ä»¥çš„ï¼Œå®é™…ä¸Šï¼Œä½ ç°åœ¨åªéœ€è¦çŸ¥é“ StringBuilder çš„ç”¨æ³•å°±å¯ä»¥äº†ã€‚â€å–äº†ä¸€å£å³æ‰‹è¾¹çš„å¯å£å¯ä¹ï¼ˆæ— ç³–ï¼‰åï¼Œæˆ‘æ„Ÿè§‰å¥½çˆ½å¿«å•Šã€‚

---

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)


## 4.9 Stringç›¸ç­‰åˆ¤æ–­

â€œäºŒå“¥ï¼Œå¦‚ä½•æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸ç­‰å•Šï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œè¿™ä¸ªé—®é¢˜çœ‹ä¼¼ç®€å•ï¼Œå´åœ¨ Stack Overflow ä¸Šæœ‰è¶…è¿‡ 370 ä¸‡+çš„è®¿é—®é‡ã€‚â€æˆ‘è¯´ï¼Œâ€œè¿™ä¸ªé—®é¢˜ä¹Ÿå¯ä»¥å¼•ç”³ä¸º `.equals()` å’Œ â€˜==â€™ æ“ä½œç¬¦æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚â€

- â€œ==â€æ“ä½œç¬¦ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„åœ°å€æ˜¯å¦ç›¸ç­‰ã€‚
- `.equals()` æ–¹æ³•ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å†…å®¹æ˜¯å¦ç›¸ç­‰ã€‚

â€œä¸æ˜¯å¾ˆç†è§£ã€‚â€ä¸‰å¦¹æ„Ÿåˆ°å¾ˆå›°æƒ‘ã€‚

â€œæˆ‘æ¥ä¸¾ä¸ªä¸æ°å½“åˆå¾ˆæ°å½“çš„ä¾‹å­ï¼Œä¸€çœ‹ä½ å°±æ˜ç™½äº†ï¼Œä¸‰å¦¹ã€‚â€

æœ‰ä¸€å¯¹åŒèƒèƒï¼Œå§å§å«é˜¿ä¸½å¡”ï¼Œå¦¹å¦¹å«æ´›ä¸½å¡”ã€‚æˆ‘ä»¬æ™®é€šäººå¯èƒ½å®Œå…¨æ— æ³•åˆ†è¾¨è°æ˜¯å§å§è°æ˜¯å¦¹å¦¹ï¼Œå¯å¥¹ä»¬çš„å¦ˆå¦ˆå´å¯ä»¥è½»è€Œæ˜“ä¸¾åœ°è¾¨è®¤å‡ºã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/string/equals-01.png)


`.equals()` å°±å¥½åƒæˆ‘ä»¬æ™®é€šäººï¼Œçœ‹è§é˜¿ä¸½å¡”ä»¥ä¸ºæ˜¯æ´›ä¸½å¡”ï¼Œçœ‹è§æ´›ä¸½å¡”ä»¥ä¸ºæ˜¯é˜¿ä¸½å¡”ï¼Œçœ‹èµ·æ¥ä¸€æ ·å°±è§‰å¾—å¥¹ä»¬æ˜¯åŒä¸€ä¸ªäººï¼›â€œ==â€æ“ä½œç¬¦å°±å¥½åƒå¥¹ä»¬çš„å¦ˆå¦ˆï¼Œè¦æ±‚æ›´ä¸¥æ ¼ï¼Œè§‚å¯Ÿæ›´ç»†è‡´ï¼Œä¸€çœ¼å°±èƒ½åˆ†è¾¨å‡ºè°æ˜¯å§å§è°æ˜¯å¦¹å¦¹ã€‚

```java
String alita = new String("å°èè‰");
String luolita = new String("å°èè‰");

System.out.println(alita.equals(luolita)); // true
System.out.println(alita == luolita); // false
```

å°±ä¸Šé¢è¿™æ®µä»£ç æ¥è¯´ï¼Œ`.equals()` è¾“å‡ºçš„ç»“æœä¸º trueï¼Œè€Œâ€œ==â€æ“ä½œç¬¦è¾“å‡ºçš„ç»“æœä¸º falseâ€”â€”å‰è€…è¦æ±‚å†…å®¹ç›¸ç­‰å°±å¯ä»¥ï¼Œåè€…è¦æ±‚å¿…é¡»æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚

â€œä¸‰å¦¹ï¼Œä¹‹å‰å·²ç»å­¦è¿‡äº†ï¼ŒJava çš„æ‰€æœ‰ç±»éƒ½é»˜è®¤åœ°ç»§æ‰¿ Object è¿™ä¸ªè¶…ç±»ï¼Œè¯¥ç±»æœ‰ä¸€ä¸ªåä¸º `.equals()` çš„æ–¹æ³•ã€‚â€ä¸€è¾¹è¯´ï¼Œæˆ‘ä¸€è¾¹æ‰“å¼€äº† Object ç±»çš„æºç ã€‚

```java
public boolean equals(Object obj) {
    return (this == obj);
}
```

ä½ çœ‹ï¼ŒObject ç±»çš„ `.equals()` æ–¹æ³•é»˜è®¤é‡‡ç”¨çš„æ˜¯â€œ==â€æ“ä½œç¬¦è¿›è¡Œæ¯”è¾ƒã€‚å‡å¦‚å­ç±»æ²¡æœ‰é‡å†™è¯¥æ–¹æ³•çš„è¯ï¼Œé‚£ä¹ˆâ€œ==â€æ“ä½œç¬¦å’Œ `.equals()` æ–¹æ³•çš„åŠŸæ•ˆå°±å®Œå…¨ä¸€æ ·â€”â€”æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€æ˜¯å¦ç›¸ç­‰ã€‚

ä½†å®é™…æƒ…å†µä¸­ï¼Œæœ‰ä¸å°‘ç±»é‡å†™äº† `.equals()` æ–¹æ³•ï¼Œå› ä¸ºæ¯”è¾ƒå†…å­˜åœ°å€çš„è¦æ±‚æ¯”è¾ƒä¸¥æ ¼ï¼Œä¸å¤ªç¬¦åˆç°å®ä¸­æ‰€æœ‰çš„åœºæ™¯éœ€æ±‚ã€‚æ‹¿ String ç±»æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨æ¯”è¾ƒå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œçš„ç¡®åªæƒ³åˆ¤æ–­å®ƒä»¬ä¿©çš„å†…å®¹æ˜¯ç›¸ç­‰çš„å°±å¯ä»¥äº†ï¼Œå¹¶ä¸æƒ³æ¯”è¾ƒå®ƒä»¬ä¿©æ˜¯ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚

å†µä¸”ï¼Œå­—ç¬¦ä¸²æœ‰[å­—ç¬¦ä¸²å¸¸é‡æ± ](https://tobebetterjavaer.com/string/constant-pool.html)çš„æ¦‚å¿µï¼Œæœ¬èº«å°±æ¨èä½¿ç”¨ `String s = "å­—ç¬¦ä¸²"` è¿™ç§å½¢å¼æ¥åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡ï¼Œè€Œä¸æ˜¯é€šè¿‡ new å…³é”®å­—çš„æ–¹å¼ï¼Œå› ä¸ºå¯ä»¥æŠŠå­—ç¬¦ä¸²ç¼“å­˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œæ–¹ä¾¿ä¸‹æ¬¡ä½¿ç”¨ï¼Œä¸ç”¨é‡åˆ° new å°±åœ¨å †ä¸Šå¼€è¾Ÿä¸€å—æ–°çš„ç©ºé—´ã€‚

â€œå“¦ï¼Œæˆ‘æ˜ç™½äº†ã€‚â€ä¸‰å¦¹è¯´ã€‚

â€œé‚£å°±æ¥çœ‹ä¸€ä¸‹ String ç±»çš„ `.equals()` æ–¹æ³•çš„æºç å§ã€‚â€æˆ‘è¯´ã€‚

```java
public boolean equals(Object anObject) {
    if (this == anObject) {
        return true;
    }
    if (anObject instanceof String) {
        String aString = (String)anObject;
        if (coder() == aString.coder()) {
            return isLatin1() ? StringLatin1.equals(value, aString.value)
                    : StringUTF16.equals(value, aString.value);
        }
    }
    return false;
}
```

é¦–å…ˆï¼Œå¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„å¯ä»¥â€œ==â€ï¼Œé‚£å°±ç›´æ¥è¿”å› true äº†ï¼Œå› ä¸ºè¿™ç§æƒ…å†µä¸‹ï¼Œå­—ç¬¦ä¸²å†…å®¹æ˜¯å¿…ç„¶ç›¸ç­‰çš„ã€‚å¦åˆ™å°±æŒ‰ç…§å­—ç¬¦ç¼–ç è¿›è¡Œæ¯”è¾ƒï¼Œåˆ†ä¸º UTF16 å’Œ Latin1ï¼Œå·®åˆ«ä¸æ˜¯å¾ˆå¤§ï¼Œå°±æ‹¿ Latin1 çš„æ¥è¯´å§ã€‚

```java
@HotSpotIntrinsicCandidate
public static boolean equals(byte[] value, byte[] other) {
    if (value.length == other.length) {
        for (int i = 0; i < value.length; i++) {
            if (value[i] != other[i]) {
                return false;
            }
        }
        return true;
    }
    return false;
}
```

è¿™ä¸ª JDK ç‰ˆæœ¬æ˜¯ Java 17ï¼Œä¹Ÿå°±æ˜¯æœ€æ–°çš„ LTSï¼ˆé•¿æœŸæ”¯æŒï¼‰ç‰ˆæœ¬ã€‚è¯¥ç‰ˆæœ¬ä¸­ï¼ŒString ç±»ä½¿ç”¨å­—èŠ‚æ•°ç»„å®ç°çš„ï¼Œæ‰€ä»¥æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²çš„å†…å®¹æ˜¯å¦ç›¸ç­‰æ—¶ï¼Œå¯ä»¥å…ˆæ¯”è¾ƒå­—èŠ‚æ•°ç»„çš„é•¿åº¦æ˜¯å¦ç›¸ç­‰ï¼Œä¸ç›¸ç­‰å°±ç›´æ¥è¿”å› falseï¼›å¦åˆ™å°±éå†ä¸¤ä¸ªå­—ç¬¦ä¸²çš„å­—èŠ‚æ•°ç»„ï¼Œåªæœ‰æœ‰ä¸€ä¸ªå­—èŠ‚ä¸ç›¸ç­‰ï¼Œå°±è¿”å› falseã€‚

è¿™æ˜¯ Java 8 ä¸­çš„ equals æ–¹æ³•æºç ï¼š

```java
public boolean equals(Object anObject) {
    // åˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€å¯¹è±¡
    if (this == anObject) {
        return true;
    }
    // åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸º String ç±»å‹
    if (anObject instanceof String) {
        String anotherString = (String)anObject;
        int n = value.length;
        // åˆ¤æ–­å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ç›¸ç­‰
        if (n == anotherString.value.length) {
            char v1[] = value;
            char v2[] = anotherString.value;
            int i = 0;
            // åˆ¤æ–­æ¯ä¸ªå­—ç¬¦æ˜¯å¦ç›¸ç­‰
            while (n-- != 0) {
                if (v1[i] != v2[i])
                    return false;
                i++;
            }
            return true;
        }
    }
    return false;
}
```

JDK 8 æ¯” JDK 17 æ›´å®¹æ˜“æ‡‚ä¸€äº›ï¼šé¦–å…ˆåˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å› trueã€‚æ¥ç€ï¼Œåˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸º String ç±»å‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™è¿”å› falseã€‚å¦‚æœå¯¹è±¡ä¸º String ç±»å‹ï¼Œåˆ™æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœé•¿åº¦ä¸ç›¸ç­‰ï¼Œåˆ™è¿”å› falseã€‚å¦‚æœé•¿åº¦ç›¸ç­‰ï¼Œåˆ™é€ä¸ªæ¯”è¾ƒæ¯ä¸ªå­—ç¬¦æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœéƒ½ç›¸ç­‰ï¼Œåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚

â€œå—¯ï¼ŒäºŒå“¥ï¼Œè¿™æ®µæºç ä¸éš¾ç†è§£ã€‚â€ä¸‰å¦¹è‡ªä¿¡åœ°è¯´ã€‚

â€œé‚£å‡ºå‡ é“é¢˜è€ƒè€ƒä½ å§ï¼â€æˆ‘è¯´ã€‚

ç¬¬ä¸€é¢˜ï¼š

```java
new String("å°èè‰").equals("å°èè‰")
```

â€œè¾“å‡ºä»€ä¹ˆå‘¢ï¼Ÿâ€æˆ‘é—®ã€‚

â€œ`.equals()` æ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„å†…å®¹æ˜¯å¦ç›¸ç­‰ï¼Œæ‰€ä»¥ç»“æœä¸º trueã€‚â€ä¸‰å¦¹ä¸å‡æ€ç´¢åœ°ç­”åˆ°ã€‚


ç¬¬äºŒé¢˜ï¼š

```java
new String("å°èè‰") == "å°èè‰"
```

â€œ==æ“ä½œç¬¦å·¦ä¾§çš„æ˜¯åœ¨å †ä¸­åˆ›å»ºçš„å¯¹è±¡ï¼Œå³ä¾§æ˜¯åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å¯¹è±¡ï¼Œå°½ç®¡å†…å®¹ç›¸åŒï¼Œä½†å†…å­˜åœ°å€ä¸åŒï¼Œæ‰€ä»¥è¿”å› falseã€‚â€ä¸‰å¦¹ç­”ã€‚

ç¬¬ä¸‰é¢˜ï¼š

```java
new String("å°èè‰") == new String("å°èè‰")
```

â€œnew å‡ºæ¥çš„å¯¹è±¡è‚¯å®šæ˜¯å®Œå…¨ä¸åŒçš„å†…å­˜åœ°å€ï¼Œæ‰€ä»¥è¿”å› falseã€‚â€ä¸‰å¦¹ç­”ã€‚

ç¬¬å››é¢˜ï¼š

```java
"å°èè‰" == "å°èè‰"
```

â€œå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­åªä¼šæœ‰ä¸€ä¸ªç›¸åŒå†…å®¹çš„å¯¹è±¡ï¼Œæ‰€ä»¥è¿”å› trueã€‚â€ä¸‰å¦¹ç­”ã€‚

ç¬¬äº”é¢˜ï¼š

```java
"å°èè‰" == "å°" + "èè‰"
```

â€œç”±äºâ€˜å°â€™å’Œâ€˜èè‰â€™éƒ½åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨åœ¨é‡åˆ°â€˜+â€™æ“ä½œç¬¦çš„æ—¶å€™å°†å…¶è‡ªåŠ¨ä¼˜åŒ–ä¸ºâ€œå°èè‰â€ï¼Œæ‰€ä»¥è¿”å› trueã€‚â€

PSï¼šè‡³äºä¸ºä»€ä¹ˆï¼ŒæŸ¥çœ‹è¿™ç¯‡[Stringã€StringBuilderã€StringBuffer](https://tobebetterjavaer.com/string/builder-buffer.html)

ç¬¬å…­é¢˜ï¼š

```java
new String("å°èè‰").intern() == "å°èè‰"
```

â€œ`new String("å°èè‰")` åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šå…ˆåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­åˆ›å»ºå¯¹è±¡ï¼Œç„¶åå†åœ¨å †ä¸­åˆ›å»ºå¯¹è±¡ï¼›æ‰§è¡Œ `intern()` æ–¹æ³•çš„æ—¶å€™å‘ç°å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å·²ç»æœ‰äº†â€˜å°èè‰â€™è¿™ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥å°±ç›´æ¥è¿”å›å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å¯¹è±¡å¼•ç”¨äº†ï¼Œé‚£å†ä¸å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„â€˜å°èè‰â€™æ¯”è¾ƒï¼Œå½“ç„¶ä¼šè¿”å› true äº†ã€‚â€ä¸‰å¦¹è¯´ã€‚

PSï¼š[intern](https://tobebetterjavaer.com/string/intern.html) æ–¹æ³•æˆ‘ä»¬ä¹‹å‰å·²ç»æ·±ç©¶è¿‡äº†ã€‚

å“‡ï¼Œä¸å¾—ä¸è¯´ï¼Œä¸‰å¦¹å‰å‡ èŠ‚çš„å­—ç¬¦ä¸²ç›¸å…³å†…å®¹éƒ½å®Œå…¨å­¦ä¼šäº†å‘€ï¼

â€œä¸‰å¦¹ï¼Œå“¥å†ç»™ä½ è¡¥å……ä¸€ç‚¹ã€‚â€æˆ‘è¯´ã€‚

â€œå¦‚æœè¦è¿›è¡Œä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„å†…å®¹æ¯”è¾ƒï¼Œé™¤äº† `.equals()` æ–¹æ³•ï¼Œè¿˜æœ‰å…¶ä»–ä¸¤ä¸ªå¯é€‰çš„æ–¹æ¡ˆã€‚â€

1ï¼‰`Objects.equals()`

`Objects.equals()` è¿™ä¸ªé™æ€æ–¹æ³•çš„ä¼˜åŠ¿åœ¨äºä¸éœ€è¦åœ¨è°ƒç”¨ä¹‹å‰åˆ¤ç©ºã€‚

```java
public static boolean equals(Object a, Object b) {
    return (a == b) || (a != null && a.equals(b));
}
```

å¦‚æœç›´æ¥ä½¿ç”¨ `a.equals(b)`ï¼Œåˆ™éœ€è¦åœ¨è°ƒç”¨ä¹‹å‰å¯¹ a è¿›è¡Œåˆ¤ç©ºï¼Œå¦åˆ™å¯èƒ½ä¼šæŠ›å‡ºç©ºæŒ‡é’ˆ `java.lang.NullPointerException`ã€‚`Objects.equals()` ç”¨èµ·æ¥å°±å®Œå…¨æ²¡æœ‰è¿™ä¸ªæ‹…å¿ƒã€‚

```java
Objects.equals("å°èè‰", new String("å°" + "èè‰")) // --> true
Objects.equals(null, new String("å°" + "èè‰")); // --> false
Objects.equals(null, null) // --> true

String a = null;
a.equals(new String("å°" + "èè‰")); // throw exception
```

2ï¼‰String ç±»çš„ `.contentEquals()`

`.contentEquals()` çš„ä¼˜åŠ¿åœ¨äºå¯ä»¥å°†å­—ç¬¦ä¸²ä¸ä»»ä½•çš„å­—ç¬¦åºåˆ—ï¼ˆStringBufferã€StringBuilderã€Stringã€CharSequenceï¼‰è¿›è¡Œæ¯”è¾ƒã€‚

```java
public boolean contentEquals(CharSequence cs) {
    // Argument is a StringBuffer, StringBuilder
    if (cs instanceof AbstractStringBuilder) {
        if (cs instanceof StringBuffer) {
            synchronized(cs) {
                return nonSyncContentEquals((AbstractStringBuilder)cs);
            }
        } else {
            return nonSyncContentEquals((AbstractStringBuilder)cs);
        }
    }
    // Argument is a String
    if (cs instanceof String) {
        return equals(cs);
    }
    // Argument is a generic CharSequence
    int n = cs.length();
    if (n != length()) {
        return false;
    }
    byte[] val = this.value;
    if (isLatin1()) {
        for (int i = 0; i < n; i++) {
            if ((val[i] & 0xff) != cs.charAt(i)) {
                return false;
            }
        }
    } else {
        if (!StringUTF16.contentEquals(val, cs, n)) {
            return false;
        }
    }
    return true;
}
```

ä»æºç ä¸Šå¯ä»¥çœ‹å¾—å‡ºï¼Œå¦‚æœ cs æ˜¯ StringBufferï¼Œè¯¥æ–¹æ³•è¿˜ä¼šè¿›è¡ŒåŒæ­¥ï¼Œéå¸¸çš„æ™ºèƒ½åŒ–ï¼›å¦‚æœæ˜¯ String çš„è¯ï¼Œå…¶å®è°ƒç”¨çš„è¿˜æ˜¯ `equals()` æ–¹æ³•ã€‚å½“ç„¶äº†ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ä½¿ç”¨è¯¥æ–¹æ³•è¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™ï¼Œå¤šå‡ºæ¥äº†å¾ˆå¤šæ­¥éª¤ï¼Œæ€§èƒ½ä¸Šæœ‰äº›æŸå¤±ã€‚

åŒæ ·æ¥çœ‹ä¸€ä¸‹ JDK 8 çš„æºç ï¼š

```java
public boolean contentEquals(CharSequence cs) {
    // argument can be any CharSequence implementation
    if (cs.length() != value.length) {
        return false;
    }
    // Argument is a StringBuffer, StringBuilder or String
    if (cs instanceof AbstractStringBuilder) {
        char v1[] = value;
        char v2[] = ((AbstractStringBuilder)cs).getValue();
        int i = 0;
        int n = value.length;
        while (n-- != 0) {
            if (v1[i] != v2[i])
                return false;
            i++;
        }
        return true;
    }
    // Argument is a String
    if (cs.equals(this))
        return true;
    // Argument is a non-String, non-AbstractStringBuilder CharSequence
    char v1[] = value;
    int i = 0;
    int n = value.length;
    while (n-- != 0) {
        if (v1[i] != cs.charAt(i))
            return false;
        i++;
    }
    return true;
}
```

åŒæ ·æ›´å®¹æ˜“ç†è§£ä¸€äº›ï¼šé¦–å…ˆåˆ¤æ–­å‚æ•°é•¿åº¦æ˜¯å¦ç›¸ç­‰ï¼Œä¸ç›¸ç­‰åˆ™è¿”å› falseã€‚å¦‚æœå‚æ•°æ˜¯ AbstractStringBuilder çš„å®ä¾‹ï¼Œåˆ™å–å‡ºå…¶ char æ•°ç»„ï¼Œéå†æ¯”è¾ƒä¸¤ä¸ª char æ•°ç»„çš„æ¯ä¸ªå…ƒç´ æ˜¯å¦ç›¸ç­‰ã€‚å¦‚æœå‚æ•°æ˜¯ String çš„å®ä¾‹ï¼Œåˆ™ç›´æ¥è°ƒç”¨ equals æ–¹æ³•æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ã€‚å¦‚æœå‚æ•°æ˜¯å…¶ä»–å®ç°äº† CharSequence æ¥å£çš„å¯¹è±¡ï¼Œåˆ™éå†æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„æ¯ä¸ªå­—ç¬¦æ˜¯å¦ç›¸ç­‰ã€‚

â€œæ˜¯çš„ï¼Œæ€»ä½“ä¸Šæ„Ÿè§‰è¿˜æ˜¯ `Objects.equals()` æ¯”è¾ƒèˆ’æœã€‚â€ä¸‰å¦¹çš„çœ¼ç›æ˜¯é›ªäº®çš„ï¼Œå‘ç°äº†è¿™ä¸ªæ–¹æ³•çš„ä¼˜ç‚¹ã€‚

---

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 4.10 Stringæ‹¼æ¥

â€œå“¥ï¼Œä½ è®©æˆ‘çœ‹çš„ã€Š[Java å¼€å‘æ‰‹å†Œ](https://tobebetterjavaer.com/pdf/ali-java-shouce.html)ã€‹ä¸Šæœ‰è¿™ä¹ˆä¸€æ®µå†…å®¹ï¼šå¾ªç¯ä½“å†…ï¼Œæ‹¼æ¥å­—ç¬¦ä¸²æœ€å¥½ä½¿ç”¨ StringBuilder çš„ `append()` æ–¹æ³•ï¼Œè€Œä¸æ˜¯ + å·æ“ä½œç¬¦ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘€ï¼Ÿâ€ä¸‰å¦¹ç–‘æƒ‘åœ°é—®ã€‚

â€œå…¶å®è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¹‹å‰å·²ç»[èŠè¿‡](https://tobebetterjavaer.com/string/builder-buffer.html)ã€‚â€æˆ‘æ…¢åååœ°å›ç­”é“ï¼Œâ€œä¸è¿‡ï¼Œä¸‰å¦¹ï¼Œå“¥ä»Šå¤©æ¥ç»™ä½ æ·±å…¥åœ°è®²è®²ã€‚â€

PSï¼šä¸‰å¦¹èƒ½åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ä¸æ–­åœ°å‘ç°é—®é¢˜ï¼Œè®©æˆ‘æ„Ÿåˆ°éå¸¸çš„å¼€å¿ƒã€‚å…¶å®å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä¸åº”è¯¥åªæ˜¯æŠŠçŸ¥è¯†ç‚¹è®°åœ¨å¿ƒé‡Œï¼Œè¿˜åº”è¯¥é—®ä¸€é—®è‡ªå·±ï¼Œåˆ°åº•æ˜¯ä¸ºä»€ä¹ˆï¼Œåªæœ‰è¿ˆå‡ºå»è¿™ä¸€æ­¥ï¼Œæ‰èƒ½çœŸæ­£çš„æˆé•¿èµ·æ¥ã€‚

### javap æ¢ç©¶+å·æ“ä½œç¬¦æ‹¼æ¥å­—ç¬¦ä¸²çš„æœ¬è´¨

â€œ+ å·æ“ä½œç¬¦å…¶å®è¢« Java åœ¨ç¼–è¯‘çš„æ—¶å€™é‡æ–°è§£é‡Šäº†ï¼Œæ¢ä¸€ç§è¯´æ³•å°±æ˜¯ï¼Œ+ å·æ“ä½œç¬¦æ˜¯ä¸€ç§è¯­æ³•ç³–ï¼Œè®©å­—ç¬¦ä¸²çš„æ‹¼æ¥å˜å¾—æ›´ç®€ä¾¿äº†ã€‚â€ä¸€è¾¹ç»™ä¸‰å¦¹è§£é‡Šï¼Œæˆ‘ä¸€è¾¹åœ¨ Intellij IDEA ä¸­æ•²å‡ºäº†ä¸‹é¢è¿™æ®µä»£ç ã€‚

```java
class Demo {
    public static void main(String[] args) {
        String chenmo = "æ²‰é»˜";
        String wanger = "ç‹äºŒ";
        System.out.println(chenmo + wanger);
    }
}
```

åœ¨ Java 8 çš„ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨ `javap -c Demo.class` åç¼–è¯‘å­—èŠ‚ç åï¼Œå¯ä»¥çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼š

```
Compiled from "Demo.java"
class Demo {
  Demo();
    Code:
       0: aload_0
       1: invokespecial #1                  // Method java/lang/Object."<init>":()V
       4: return

  public static void main(java.lang.String[]);
    Code:
       0: ldc           #2                  // String æ²‰é»˜
       2: astore_1
       3: ldc           #3                  // String ç‹äºŒ
       5: astore_2
       6: getstatic     #4                  // Field java/lang/System.out:Ljava/io/PrintStream;
       9: new           #5                  // class java/lang/StringBuilder
      12: dup
      13: invokespecial #6                  // Method java/lang/StringBuilder."<init>":()V
      16: aload_1
      17: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
      20: aload_2
      21: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
      24: invokevirtual #8                  // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
      27: invokevirtual #9                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V
      30: return
}
```

â€œä½ çœ‹ï¼Œä¸‰å¦¹ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª new å…³é”®å­—ï¼Œå¹¶ä¸” class ç±»å‹ä¸º `java/lang/StringBuilder`ã€‚â€æˆ‘æŒ‡ç€æ ‡å·ä¸º 9 çš„é‚£è¡Œå¯¹ä¸‰å¦¹è¯´ï¼Œâ€œè¿™æ„å‘³ç€æ–°å»ºäº†ä¸€ä¸ª StringBuilder çš„å¯¹è±¡ã€‚â€

â€œç„¶åçœ‹æ ‡å·ä¸º 17 çš„è¿™è¡Œï¼Œæ˜¯ä¸€ä¸ª invokevirtual æŒ‡ä»¤ï¼Œç”¨äºè°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ StringBuilder å¯¹è±¡çš„ `append()` æ–¹æ³•ã€‚â€

â€œä¹Ÿå°±æ„å‘³ç€æŠŠ chenmoï¼ˆ"æ²‰é»˜"ï¼‰è¿™ä¸ªå­—ç¬¦ä¸²æ·»åŠ åˆ° StringBuilder å¯¹è±¡ä¸­äº†ã€‚â€

â€œå†å¾€ä¸‹çœ‹ï¼Œæ ‡å·ä¸º 21 çš„è¿™è¡Œï¼Œåˆè°ƒç”¨äº†ä¸€æ¬¡ `append()` æ–¹æ³•ï¼Œæ„å‘³ç€æŠŠ wangerï¼ˆ"ç‹äºŒ"ï¼‰è¿™ä¸ªå­—ç¬¦ä¸²æ·»åŠ åˆ° StringBuilder å¯¹è±¡ä¸­äº†ã€‚â€

æ¢æˆ Java ä»£ç æ¥è¡¨ç¤ºçš„è¯ï¼Œå¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­ï¼š

```java
class Demo {
    public static void main(String[] args) {
        String chenmo = "æ²‰é»˜";
        String wanger = "ç‹äºŒ";
        System.out.println((new StringBuilder(chenmo)).append(wanger).toString());
    }
}
```

â€œå“¦ï¼ŒåŸæ¥ç¼–è¯‘çš„æ—¶å€™æŠŠâ€œ+â€å·æ“ä½œç¬¦æ›¿æ¢æˆäº† StringBuilder çš„ `append()` æ–¹æ³•å•Šã€‚â€ä¸‰å¦¹æç„¶å¤§æ‚Ÿã€‚

â€œæ˜¯çš„ï¼Œä¸è¿‡åˆ°äº† Java 9ï¼ˆä¸æ˜¯é•¿æœŸæ”¯æŒç‰ˆæœ¬ï¼Œæ‰€ä»¥æˆ‘ä¼šæ‹¿ Java 11 æ¥æ¼”ç¤ºï¼‰ï¼Œæƒ…å†µå‘ç”Ÿäº†ä¸€äº›æ”¹å˜ï¼ŒåŒæ ·çš„ä»£ç ï¼Œå­—èŠ‚ç æŒ‡ä»¤å®Œå…¨ä¸åŒäº†ã€‚â€æˆ‘è¯´ã€‚

åŒæ ·çš„ä»£ç ï¼Œåœ¨ Java 11 çš„ç¯å¢ƒä¸‹ï¼Œå­—èŠ‚ç æŒ‡ä»¤æ˜¯è¿™æ ·çš„ï¼š

```
Compiled from "Demo.java"
public class com.itwanger.thirtyseven.Demo {
  public com.itwanger.thirtyseven.Demo();
    Code:
       0: aload_0
       1: invokespecial #1                  // Method java/lang/Object."<init>":()V
       4: return

  public static void main(java.lang.String[]);
    Code:
       0: ldc           #2                  // String
       2: astore_1
       3: iconst_0
       4: istore_2
       5: iload_2
       6: bipush        10
       8: if_icmpge     41
      11: new           #3                  // class java/lang/String
      14: dup
      15: ldc           #4                  // String æ²‰é»˜
      17: invokespecial #5                  // Method java/lang/String."<init>":(Ljava/lang/String;)V
      20: astore_3
      21: ldc           #6                  // String ç‹äºŒ
      23: astore        4
      25: aload_1
      26: aload_3
      27: aload         4
      29: invokedynamic #7,  0              // InvokeDynamic #0:makeConcatWithConstants:(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
      34: astore_1
      35: iinc          2, 1
      38: goto          5
      41: return
}
```

çœ‹æ ‡å·ä¸º 29 çš„è¿™è¡Œï¼Œå­—èŠ‚ç æŒ‡ä»¤ä¸º `invokedynamic`ï¼Œè¯¥æŒ‡ä»¤å…è®¸ç”±åº”ç”¨çº§çš„ä»£ç æ¥å†³å®šæ–¹æ³•è§£æï¼Œæ‰€è°“çš„åº”ç”¨çº§çš„ä»£ç å…¶å®æ˜¯ä¸€ä¸ªæ–¹æ³•â€”â€”è¢«ç§°ä¸ºå¼•å¯¼æ–¹æ³•ï¼ˆBootstrap Methodï¼‰ï¼Œç®€ç§° BSMï¼ŒBSM ä¼šè¿”å›ä¸€ä¸ª CallSiteï¼ˆè°ƒç”¨ç‚¹ï¼‰ å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±å’Œ `invokedynamic` æŒ‡ä»¤é“¾æ¥åœ¨ä¸€èµ·ã€‚ä»¥åå†æ‰§è¡Œè¿™æ¡ `invokedynamic` æŒ‡ä»¤æ—¶å°±ä¸ä¼šåˆ›å»ºæ–°çš„ CallSite å¯¹è±¡ã€‚CallSite å…¶å®å°±æ˜¯ä¸€ä¸ª MethodHandleï¼ˆæ–¹æ³•å¥æŸ„ï¼‰çš„ holderï¼ŒæŒ‡å‘ä¸€ä¸ªè°ƒç”¨ç‚¹çœŸæ­£æ‰§è¡Œçš„æ–¹æ³•â€”â€”æ­¤æ—¶å°±æ˜¯ `StringConcatFactory.makeConcatWithConstants()` æ–¹æ³•ã€‚

â€œå“¥ï¼Œä½ åˆ«å†è¯´äº†ï¼Œå†è¯´æˆ‘å°±å¬ä¸æ‡‚äº†ã€‚â€ä¸‰å¦¹æ‰“æ–­äº†æˆ‘çš„è¯ã€‚

â€œå¥½å§ï¼Œæ€»ä¹‹å°±æ˜¯ Java 9 ä»¥åï¼ŒJDK ç”¨äº†å¦å¤–ä¸€ç§æ–¹æ³•æ¥åŠ¨æ€è§£é‡Š + å·æ“ä½œç¬¦ï¼Œå…·ä½“çš„å®ç°æ–¹å¼åœ¨å­—èŠ‚ç æŒ‡ä»¤å±‚é¢å·²ç»çœ‹ä¸åˆ°äº†ï¼Œæ‰€ä»¥æˆ‘å°±ä»¥ Java 8 æ¥ç»§ç»­è®²è§£å§ã€‚â€

### ä¸ºä»€ä¹ˆè¦ç¼–è¯‘ä¸º StringBuilder.append

â€œå†å›åˆ°ã€ŠJava å¼€å‘æ‰‹å†Œã€‹ä¸Šçš„é‚£æ®µå†…å®¹ï¼šå¾ªç¯ä½“å†…ï¼Œæ‹¼æ¥å­—ç¬¦ä¸²æœ€å¥½ä½¿ç”¨ StringBuilder çš„ `append()` æ–¹æ³•ï¼Œè€Œä¸æ˜¯ + å·æ“ä½œç¬¦ã€‚åŸå› å°±åœ¨äºå¾ªç¯ä½“å†…å¦‚æœç”¨ + å·æ“ä½œç¬¦çš„è¯ï¼Œå°±ä¼šäº§ç”Ÿå¤§é‡çš„ StringBuilder å¯¹è±¡ï¼Œä¸ä»…å ç”¨äº†æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼Œè¿˜ä¼šè®© Java è™šæ‹Ÿæœºä¸åœçš„è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œä»è€Œé™ä½äº†ç¨‹åºçš„æ€§èƒ½ã€‚â€

æ›´å¥½çš„å†™æ³•å°±æ˜¯åœ¨å¾ªç¯çš„å¤–éƒ¨æ–°å»ºä¸€ä¸ª StringBuilder å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ `append()` æ–¹æ³•å°†å¾ªç¯ä½“å†…çš„å­—ç¬¦ä¸²æ·»åŠ è¿›æ¥ï¼š

```java
class Demo {
    public static void main(String[] args) {
        StringBuilder sb = new StringBuilder();
        for (int i = 1; i < 10; i++) {
            String chenmo = "æ²‰é»˜";
            String wanger = "ç‹äºŒ";
            sb.append(chenmo);
            sb.append(wanger);
        }
        System.out.println(sb);
    }
}
```

æ¥åšä¸ªå°æµ‹è¯•ã€‚

ç¬¬ä¸€ä¸ªï¼Œfor å¾ªç¯ä¸­ä½¿ç”¨â€+â€å·æ“ä½œç¬¦ã€‚

```java
String result = "";
for (int i = 0; i < 100000; i++) {
    result += "å…­å…­å…­";
}
```

ç¬¬äºŒä¸ªï¼Œfor å¾ªç¯å¤–éƒ¨æ–°å»º StringBuilderï¼Œå¾ªç¯ä½“å†…ä½¿ç”¨ `append()` æ–¹æ³•ã€‚

```java
StringBuilder sb = new StringBuilder();
for (int i = 0; i < 100000; i++) {
    sb.append("å…­å…­å…­");
}
```

â€œè¿™ä¸¤ä¸ªå°æµ‹è¯•åˆ†åˆ«ä¼šè€—æ—¶å¤šé•¿æ—¶é—´å‘¢ï¼Ÿä¸‰å¦¹ä½ æ¥è¿è¡Œä¸‹ã€‚â€

â€œå“‡ï¼Œç¬¬ä¸€ä¸ªå°æµ‹è¯•çš„æ‰§è¡Œæ—¶é—´æ˜¯ 6212 æ¯«ç§’ï¼Œç¬¬äºŒä¸ªåªç”¨äº†ä¸åˆ° 1 æ¯«ç§’ï¼Œå·®è·ä¹Ÿå¤ªå¤§äº†å§ï¼â€ä¸‰å¦¹è¯´ã€‚

â€œæ˜¯çš„ï¼Œè¿™ä¸‹æ˜ç™½äº†åŸå› å§ï¼Ÿâ€æˆ‘è¯´ã€‚

â€œæ˜¯çš„ï¼Œå“¥ï¼ŒåŸæ¥å¦‚æ­¤ã€‚â€

### appendæ–¹æ³•æºç è§£æ

â€œå¥½äº†ï¼Œä¸‰å¦¹ï¼Œæ¥çœ‹ä¸€ä¸‹ StringBuilder ç±»çš„ `append()` æ–¹æ³•çš„æºç å§ï¼â€

```java
public StringBuilder append(String str) {
    super.append(str);
    return this;
}
```

è¿™ 3 è¡Œä»£ç å…¶å®æ²¡å•¥çœ‹çš„ã€‚æˆ‘ä»¬æ¥çœ‹çˆ¶ç±» AbstractStringBuilder çš„ `append()` æ–¹æ³•ï¼š

```java
public AbstractStringBuilder append(String str) {
    if (str == null)
        return appendNull();
    int len = str.length();
    ensureCapacityInternal(count + len);
    str.getChars(0, len, value, count);
    count += len;
    return this;
}
```

1ï¼‰åˆ¤æ–­æ‹¼æ¥çš„å­—ç¬¦ä¸²æ˜¯ä¸æ˜¯ nullï¼Œå¦‚æœæ˜¯ï¼Œå½“åšå­—ç¬¦ä¸²â€œnullâ€æ¥å¤„ç†ã€‚`appendNull()` æ–¹æ³•çš„æºç å¦‚ä¸‹ï¼š

```java
private AbstractStringBuilder appendNull() {
    int c = count;
    ensureCapacityInternal(c + 4);
    final char[] value = this.value;
    value[c++] = 'n';
    value[c++] = 'u';
    value[c++] = 'l';
    value[c++] = 'l';
    count = c;
    return this;
}
```

2ï¼‰è·å–å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚

3ï¼‰`ensureCapacityInternal()` æ–¹æ³•çš„æºç å¦‚ä¸‹ï¼š

```java
private void ensureCapacityInternal(int minimumCapacity) {
    // overflow-conscious code
    if (minimumCapacity - value.length > 0) {
        value = Arrays.copyOf(value,
                newCapacity(minimumCapacity));
    }
}
```

ç”±äºå­—ç¬¦ä¸²å†…éƒ¨æ˜¯ç”¨æ•°ç»„å®ç°çš„ï¼Œæ‰€ä»¥éœ€è¦å…ˆåˆ¤æ–­æ‹¼æ¥åçš„å­—ç¬¦æ•°ç»„é•¿åº¦æ˜¯å¦è¶…è¿‡å½“å‰æ•°ç»„çš„é•¿åº¦ï¼Œå¦‚æœè¶…è¿‡ï¼Œå…ˆå¯¹æ•°ç»„è¿›è¡Œæ‰©å®¹ï¼Œç„¶åæŠŠåŸæœ‰çš„å€¼å¤åˆ¶åˆ°æ–°çš„æ•°ç»„ä¸­ã€‚

 4ï¼‰å°†æ‹¼æ¥çš„å­—ç¬¦ä¸² str å¤åˆ¶åˆ°ç›®æ ‡æ•°ç»„ value ä¸­ã€‚

```java
str.getChars(0, len, value, count)
```

5ï¼‰æ›´æ–°æ•°ç»„çš„é•¿åº¦ countã€‚

### String.concat æ‹¼æ¥å­—ç¬¦ä¸²

â€œé™¤äº†å¯ä»¥ä½¿ç”¨ + å·æ“ä½œç¬¦ï¼ŒStringBuilder çš„ `append()` æ–¹æ³•ï¼Œè¿˜æœ‰å…¶ä»–çš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹æ³•å—ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œæœ‰å•Šï¼Œæ¯”å¦‚è¯´ String ç±»çš„ `concat()` æ–¹æ³•ï¼Œæœ‰ç‚¹åƒ StringBuilder ç±»çš„ `append()` æ–¹æ³•ã€‚â€

```java
String chenmo = "æ²‰é»˜";
String wanger = "ç‹äºŒ";
System.out.println(chenmo.concat(wanger));
```

å¯ä»¥æ¥çœ‹ä¸€ä¸‹ `concat()` æ–¹æ³•çš„æºç ã€‚

```java
public String concat(String str) {
    int otherLen = str.length();
    if (otherLen == 0) {
        return this;
    }
    int len = value.length;
    char buf[] = Arrays.copyOf(value, len + otherLen);
    str.getChars(buf, len);
    return new String(buf, true);
}
```

1ï¼‰å¦‚æœæ‹¼æ¥çš„å­—ç¬¦ä¸²çš„é•¿åº¦ä¸º 0ï¼Œé‚£ä¹ˆè¿”å›æ‹¼æ¥å‰çš„å­—ç¬¦ä¸²ã€‚

2ï¼‰å°†åŸå­—ç¬¦ä¸²çš„å­—ç¬¦æ•°ç»„ value å¤åˆ¶åˆ°å˜é‡ buf æ•°ç»„ä¸­ã€‚

3ï¼‰æŠŠæ‹¼æ¥çš„å­—ç¬¦ä¸² str å¤åˆ¶åˆ°å­—ç¬¦æ•°ç»„ buf ä¸­ï¼Œå¹¶è¿”å›æ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚

æˆ‘ä¸€è¡Œä¸€è¡Œåœ°ç»™ä¸‰å¦¹è§£é‡Šç€ã€‚

â€œå’Œ `+` å·æ“ä½œç¬¦ç›¸æ¯”ï¼Œ`concat()` æ–¹æ³•åœ¨é‡åˆ°å­—ç¬¦ä¸²ä¸º null çš„æ—¶å€™ï¼Œä¼šæŠ›å‡º NullPointerExceptionï¼Œè€Œâ€œ+â€å·æ“ä½œç¬¦ä¼šæŠŠ null å½“åšæ˜¯â€œnullâ€å­—ç¬¦ä¸²æ¥å¤„ç†ã€‚â€

å¦‚æœæ‹¼æ¥çš„å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼ˆ""ï¼‰ï¼Œé‚£ä¹ˆ concat çš„æ•ˆç‡è¦æ›´é«˜ä¸€ç‚¹,æ¯•ç«Ÿä¸éœ€è¦ `new StringBuilder` å¯¹è±¡ã€‚

å¦‚æœæ‹¼æ¥çš„å­—ç¬¦ä¸²éå¸¸å¤šï¼Œ`concat()` çš„æ•ˆç‡å°±ä¼šä¸‹é™ï¼Œå› ä¸ºåˆ›å»ºçš„å­—ç¬¦ä¸²å¯¹è±¡è¶Šæ¥è¶Šå¤šã€‚

â€œè¿˜æœ‰å—ï¼Ÿâ€ä¸‰å¦¹ä¼¼ä¹å¯¹å­—ç¬¦ä¸²æ‹¼æ¥å¾ˆæ„Ÿå…´è¶£ã€‚

â€œæœ‰ï¼Œå½“ç„¶æœ‰ã€‚â€

### String.join æ‹¼æ¥å­—ç¬¦ä¸²

String ç±»æœ‰ä¸€ä¸ªé™æ€æ–¹æ³• `join()`ï¼Œå¯ä»¥è¿™æ ·æ¥ä½¿ç”¨ã€‚

```java
String chenmo = "æ²‰é»˜";
String wanger = "ç‹äºŒ";
String cmower = String.join("", chenmo, wanger);
System.out.println(cmower);
```

ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå­—ç¬¦ä¸²è¿æ¥ç¬¦ï¼Œæ¯”å¦‚è¯´ï¼š

```java
String message = String.join("-", "ç‹äºŒ", "å¤ªç‰¹ä¹ˆ", "æœ‰è¶£äº†");
```

è¾“å‡ºç»“æœä¸ºï¼š`ç‹äºŒ-å¤ªç‰¹ä¹ˆ-æœ‰è¶£äº†`ã€‚

æ¥çœ‹ä¸€ä¸‹ join æ–¹æ³•çš„æºç ï¼š

```java
public static String join(CharSequence delimiter, CharSequence... elements) {
    Objects.requireNonNull(delimiter);
    Objects.requireNonNull(elements);
    // Number of elements not likely worth Arrays.stream overhead.
    StringJoiner joiner = new StringJoiner(delimiter);
    for (CharSequence cs: elements) {
        joiner.add(cs);
    }
    return joiner.toString();
}
```

é‡Œé¢æ–°å»ºäº†ä¸€ä¸ªå« StringJoiner çš„å¯¹è±¡ï¼Œç„¶åé€šè¿‡ for-each å¾ªç¯æŠŠå¯å˜å‚æ•°æ·»åŠ äº†è¿›æ¥ï¼Œæœ€åè°ƒç”¨ `toString()` æ–¹æ³•è¿”å› Stringã€‚

### StringUtils.join æ‹¼æ¥å­—ç¬¦ä¸²

â€œå®é™…çš„å·¥ä½œä¸­ï¼Œ`org.apache.commons.lang3.StringUtils` çš„ `join()` æ–¹æ³•ä¹Ÿç»å¸¸ç”¨æ¥è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ã€‚â€

```java
String chenmo = "æ²‰é»˜";
String wanger = "ç‹äºŒ";
StringUtils.join(chenmo, wanger);
```

è¯¥æ–¹æ³•ä¸ç”¨æ‹…å¿ƒ NullPointerExceptionã€‚

```java
StringUtils.join(null)            = null
StringUtils.join([])              = ""
StringUtils.join([null])          = ""
StringUtils.join(["a", "b", "c"]) = "abc"
StringUtils.join([null, "", "a"]) = "a"
```

æ¥çœ‹ä¸€ä¸‹æºç ï¼š

```java
public static String join(final Object[] array, String separator, final int startIndex, final int endIndex) {
    if (array == null) {
        return null;
    }
    if (separator == null) {
        separator = EMPTY;
    }

    final StringBuilder buf = new StringBuilder(noOfItems * 16);

    for (int i = startIndex; i < endIndex; i++) {
        if (i > startIndex) {
            buf.append(separator);
        }
        if (array[i] != null) {
            buf.append(array[i]);
        }
    }
    return buf.toString();
}
```

å†…éƒ¨ä½¿ç”¨çš„ä»ç„¶æ˜¯ StringBuilderã€‚

â€œå¥½äº†ï¼Œä¸‰å¦¹ï¼Œå…³äºå­—ç¬¦ä¸²æ‹¼æ¥çš„çŸ¥è¯†ç‚¹æˆ‘ä»¬å°±è®²åˆ°è¿™å§ã€‚æ³¨æ„ Java 9 ä»¥åï¼Œå¯¹ + å·æ“ä½œç¬¦çš„è§£é‡Šå’Œä¹‹å‰å‘ç”Ÿäº†å˜åŒ–ï¼Œå­—èŠ‚ç æŒ‡ä»¤å·²ç»ä¸åŒäº†ï¼Œç­‰åé¢ä½ å­¦äº†[å­—èŠ‚ç æŒ‡ä»¤](https://tobebetterjavaer.com/jvm/zijiema-zhiling.html)åæˆ‘ä»¬å†è¯¦ç»†åœ°è®²ä¸€æ¬¡ã€‚â€æˆ‘è¯´ã€‚

â€œå—¯ï¼Œå“¥ï¼Œä½ ä¼‘æ¯å§ï¼Œæˆ‘æŠŠè¿™äº›ä¾‹å­å†é‡æ–°è·‘ä¸€éã€‚â€ä¸‰å¦¹è¯´ã€‚

---

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 4.11 Stringæ‹†åˆ†

â€œå“¥ï¼Œæˆ‘æ„Ÿè§‰å­—ç¬¦ä¸²æ‹†åˆ†æ²¡ä»€ä¹ˆå¯è®²çš„å‘€ï¼Œç›´æ¥ä¸Š String ç±»çš„ `split()` æ–¹æ³•ä¸å°±å¯ä»¥äº†ï¼â€ä¸‰å¦¹æ¯«ä¸å®¢æ°”åœ°è¯´ã€‚

â€œå‡å¦‚ä½ çœŸçš„è¿™ä¹ˆè§‰å¾—ï¼Œé‚£å¯è¦æ³¨æ„äº†ï¼Œäº‹æƒ…è¿œæ²¡è¿™ä¹ˆç®€å•ã€‚â€æˆ‘å¾®ç¬‘ç€è¯´ã€‚

å‡å¦‚ç°åœ¨æœ‰è¿™æ ·ä¸€ä¸²å­—ç¬¦åºåˆ—â€œæ²‰é»˜ç‹äºŒï¼Œä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜â€ï¼Œéœ€è¦æŒ‰ç…§ä¸­æ–‡é€—å·â€œï¼Œâ€è¿›è¡Œæ‹†åˆ†ï¼Œè¿™æ„å‘³ç€ç¬¬ä¸€ä¸²å­—ç¬¦åºåˆ—ä¸ºé€—å·å‰é¢çš„â€œæ²‰é»˜ç‹äºŒâ€ï¼Œç¬¬äºŒä¸²å­—ç¬¦åºåˆ—ä¸ºé€—å·åé¢çš„â€œä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜â€ã€‚

â€œè¿™ä¸ç­‰äºæ²¡è¯´å—ï¼Ÿå“¥ï¼â€è¿˜æ²¡ç­‰æˆ‘è¯´ï¼Œä¸‰å¦¹å°±æ‰“æ–­äº†æˆ‘ã€‚

â€œåˆ«ç€æ€¥å˜›ï¼Œç­‰å“¥è¯´å®Œã€‚â€æˆ‘ä¾ç„¶ä¿æŒç€å¾®ç¬‘ç»§ç»­è¯´ï¼Œâ€œåœ¨æ‹†åˆ†ä¹‹å‰ï¼Œè¦å…ˆè¿›è¡Œæ£€æŸ¥ï¼Œåˆ¤æ–­ä¸€ä¸‹è¿™ä¸²å­—ç¬¦æ˜¯å¦åŒ…å«é€—å·ï¼Œå¦åˆ™åº”è¯¥æŠ›å‡ºå¼‚å¸¸ã€‚â€

```java
public class Test {
    public static void main(String[] args) {
        String cmower = "æ²‰é»˜ç‹äºŒï¼Œä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜";
        if (cmower.contains("ï¼Œ")) {
            String [] parts = cmower.split("ï¼Œ");
            System.out.println("ç¬¬ä¸€éƒ¨åˆ†ï¼š" + parts[0] +" ç¬¬äºŒéƒ¨åˆ†ï¼š" + parts[1]);
        } else {
            throw new IllegalArgumentException("å½“å‰å­—ç¬¦ä¸²æ²¡æœ‰åŒ…å«é€—å·");
        }
    }
}
```

â€œä¸‰å¦¹ä½ çœ‹ï¼Œè¿™æ®µä»£ç æŒºä¸¥è°¨çš„å§ï¼Ÿâ€æˆ‘è¯´ï¼Œâ€œæ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„è¾“å‡ºç»“æœã€‚â€

```
ç¬¬ä¸€éƒ¨åˆ†ï¼šæ²‰é»˜ç‹äºŒ ç¬¬äºŒéƒ¨åˆ†ï¼šä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜
```

â€œçš„ç¡®å’Œé¢„æœŸå®Œå…¨ä¸€è‡´ã€‚â€ä¸‰å¦¹è¯´ã€‚

â€œè¿™æ˜¯å»ºç«‹åœ¨å­—ç¬¦ä¸²æ˜¯ç¡®å®šçš„æƒ…å†µä¸‹ï¼Œæœ€é‡è¦çš„æ˜¯åˆ†éš”ç¬¦æ˜¯ç¡®å®šçš„ã€‚å¦åˆ™ï¼Œéº»çƒ¦å°±æ¥äº†ã€‚â€æˆ‘è¯´ï¼Œâ€œå¤§çº¦æœ‰ 12 ç§è‹±æ–‡ç‰¹æ®Šç¬¦å·ï¼Œå¦‚æœç›´æ¥æ‹¿è¿™äº›ç‰¹æ®Šç¬¦å·æ›¿æ¢ä¸Šé¢ä»£ç ä¸­çš„åˆ†éš”ç¬¦ï¼ˆä¸­æ–‡é€—å·ï¼‰ï¼Œè¿™æ®µç¨‹åºåœ¨è¿è¡Œçš„æ—¶å€™å°±ä¼šå‡ºç°ä»¥ä¸‹æåˆ°çš„é”™è¯¯ã€‚â€


- åæ–œæ  `\`ï¼ˆArrayIndexOutOfBoundsExceptionï¼‰
- æ’å…¥ç¬¦å· `^`ï¼ˆåŒä¸Šï¼‰
- ç¾å…ƒç¬¦å· `$`ï¼ˆåŒä¸Šï¼‰
- é€—ç‚¹ `.`ï¼ˆåŒä¸Šï¼‰
- ç«–çº¿ `|`ï¼ˆæ­£å¸¸ï¼Œæ²¡æœ‰å‡ºé”™ï¼‰
- é—®å· `?`ï¼ˆPatternSyntaxExceptionï¼‰
- æ˜Ÿå· `*`ï¼ˆåŒä¸Šï¼‰
- åŠ å· `+`ï¼ˆåŒä¸Šï¼‰
- å·¦å°æ‹¬å·æˆ–è€…å³å°æ‹¬å· `()`ï¼ˆåŒä¸Šï¼‰
- å·¦æ–¹æ‹¬å·æˆ–è€…å³æ–¹æ‹¬å· `[]`ï¼ˆåŒä¸Šï¼‰
- å·¦å¤§æ‹¬å·æˆ–è€…å³å¤§æ‹¬å· `{}`ï¼ˆåŒä¸Šï¼‰

â€œé‚£é‡åˆ°è¿™äº›ç‰¹æ®Šç¬¦å·è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚â€æˆ‘è¯´ï¼Œâ€œæ­£åˆ™è¡¨è¾¾å¼æ˜¯ä¸€ç»„ç”±å­—æ¯å’Œç¬¦å·ç»„æˆçš„ç‰¹æ®Šæ–‡æœ¬ï¼Œå®ƒå¯ä»¥ç”¨æ¥ä»æ–‡æœ¬ä¸­æ‰¾å‡ºæ»¡è¶³ä½ æƒ³è¦çš„æ ¼å¼çš„å¥å­ã€‚â€

æˆ‘åœ¨ GitHub ä¸Šæ‰¾æ‰“äº†ä¸€ä¸ªå¼€æºçš„æ­£åˆ™è¡¨è¾¾å¼å­¦ä¹ æ–‡æ¡£ï¼Œéå¸¸è¯¦ç»†ã€‚ä¸€å¼€å§‹å†™æ­£åˆ™è¡¨è¾¾å¼çš„æ—¶å€™éš¾å…ä¼šæ„Ÿè§‰åˆ°éå¸¸ç”Ÿç–ï¼Œä½ å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹è¿™ä»½æ–‡æ¡£ã€‚è®°ä¸ä½æ²¡å…³ç³»ï¼Œé‡åˆ°å°±æŸ¥ã€‚

>[https://github.com/cdoco/learn-regex-zh](https://github.com/cdoco/learn-regex-zh)

é™¤äº†è¿™ä»½æ–‡æ¡£ï¼Œè¿˜æœ‰ä¸€ä»½ï¼š

>[https://github.com/cdoco/common-regex](https://github.com/cdoco/common-regex)

ä½œè€…æ”¶é›†äº†ä¸€äº›åœ¨å¹³æ—¶é¡¹ç›®å¼€å‘ä¸­ç»å¸¸ç”¨åˆ°çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨ã€‚

â€œå“¥ï¼Œä½ çœŸå‘¨åˆ°ã€‚â€ä¸‰å¦¹ç¬‘ç€è¯´ã€‚

â€œå¥½äº†ï¼Œæ¥ç”¨è‹±æ–‡é€—ç‚¹ `.` æ›¿æ¢ä¸€ä¸‹åˆ†éš”ç¬¦ã€‚â€æˆ‘è¯´ã€‚

```java
String cmower = "æ²‰é»˜ç‹äºŒ.ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜";
if (cmower.contains(".")) {
    String [] parts = cmower.split("\\.");
    System.out.println("ç¬¬ä¸€éƒ¨åˆ†ï¼š" + parts[0] +" ç¬¬äºŒéƒ¨åˆ†ï¼š" + parts[1]);
}
```

ç”±äºè‹±æ–‡é€—ç‚¹å±äºç‰¹æ®Šç¬¦å·ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ `split()` æ–¹æ³•çš„æ—¶å€™ï¼Œå°±éœ€è¦ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ `\\.` è€Œä¸èƒ½ç›´æ¥ä½¿ç”¨ `.`ã€‚

â€œä¸ºä»€ä¹ˆç”¨ä¸¤ä¸ªåæ–œæ å‘¢ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œå› ä¸ºåæ–œæ æœ¬èº«å°±æ˜¯ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œéœ€è¦ç”¨åæ–œæ æ¥è½¬ä¹‰ã€‚â€æˆ‘è¯´ã€‚

å½“ç„¶äº†ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ `[]` æ¥åŒ…è£¹ä½è‹±æ–‡é€—ç‚¹â€œ.â€ï¼Œ`[]` ä¹Ÿæ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨æ¥åŒ¹é…æ–¹æ‹¬å·ä¸­åŒ…å«çš„ä»»æ„å­—ç¬¦ã€‚

```java
cmower.split("[.]");
```

é™¤æ­¤ä¹‹å¤–ï¼Œ è¿˜å¯ä»¥ä½¿ç”¨ Pattern ç±»çš„ `quote()` æ–¹æ³•æ¥åŒ…è£¹è‹±æ–‡é€—ç‚¹â€œ.â€ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªä½¿ç”¨ `\Q\E` åŒ…è£¹çš„å­—ç¬¦ä¸²ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/string/split-01.png)

æ¥çœ‹ç¤ºä¾‹ï¼š

```java
String [] parts = cmower.split(Pattern.quote("."));
```

å½“ `split()` æ–¹æ³•çš„å‚æ•°æ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„æ—¶å€™ï¼Œæ–¹æ³•æœ€ç»ˆä¼šæ‰§è¡Œä¸‹é¢è¿™è¡Œä»£ç ï¼š

```java
return Pattern.compile(regex).split(this, limit);
```

ä¹Ÿå°±æ„å‘³ç€ï¼Œæ‹†åˆ†å­—ç¬¦ä¸²æœ‰äº†æ–°çš„é€‰æ‹©ï¼Œå¯ä»¥ä¸ä½¿ç”¨ String ç±»çš„ `split()` æ–¹æ³•ï¼Œç›´æ¥ç”¨ä¸‹é¢çš„æ–¹å¼ã€‚

```java
public class TestPatternSplit {
    private static Pattern twopart = Pattern.compile("\\.");

    public static void main(String[] args) {
        String [] parts = twopart.split("æ²‰é»˜ç‹äºŒ.ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜");
        System.out.println("ç¬¬ä¸€éƒ¨åˆ†ï¼š" + parts[0] +" ç¬¬äºŒéƒ¨åˆ†ï¼š" + parts[1]);
    }
}
```

â€œä¸ºä»€ä¹ˆè¦æŠŠ Pattern è¡¨è¾¾å¼å£°æ˜ç§° static çš„å‘¢ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œç”±äºæ¨¡å¼æ˜¯ç¡®å®šçš„ï¼Œé€šè¿‡ static çš„é¢„ç¼–è¯‘åŠŸèƒ½å¯ä»¥æé«˜ç¨‹åºçš„æ•ˆç‡ã€‚â€æˆ‘è¯´ï¼Œâ€œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ Pattern é…åˆ Matcher ç±»è¿›è¡Œå­—ç¬¦ä¸²æ‹†åˆ†ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥å¯¹è¦æ‹†åˆ†çš„å­—ç¬¦ä¸²è¿›è¡Œä¸€äº›ä¸¥æ ¼çš„é™åˆ¶ï¼Œæ¥çœ‹è¿™æ®µç¤ºä¾‹ä»£ç ã€‚â€

```java
public class TestPatternMatch {
    /**
     * ä½¿ç”¨é¢„ç¼–è¯‘åŠŸèƒ½ï¼Œæé«˜æ•ˆç‡
     */
    private static Pattern twopart = Pattern.compile("(.+)\\.(.+)");

    public static void main(String[] args) {
        checkString("æ²‰é»˜ç‹äºŒ.ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜");
        checkString("æ²‰é»˜ç‹äºŒ.");
        checkString(".ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜");
    }

    private static void checkString(String str) {
        Matcher m = twopart.matcher(str);
        if (m.matches()) {
            System.out.println("ç¬¬ä¸€éƒ¨åˆ†ï¼š" + m.group(1) + " ç¬¬äºŒéƒ¨åˆ†ï¼š" + m.group(2));
        } else {
            System.out.println("ä¸åŒ¹é…");
        }
    }
}
```

æ­£åˆ™è¡¨è¾¾å¼ `(.+)\\.(.+)` çš„æ„æ€æ˜¯ï¼Œä¸ä»…è¦æŠŠå­—ç¬¦ä¸²æŒ‰ç…§è‹±æ–‡æ ‡ç‚¹çš„æ–¹å¼æ‹†æˆä¸¤éƒ¨åˆ†ï¼Œå¹¶ä¸”è‹±æ–‡é€—ç‚¹çš„å‰åè¦æœ‰å†…å®¹ã€‚

æ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„è¾“å‡ºç»“æœï¼š

```java
ç¬¬ä¸€éƒ¨åˆ†ï¼šæ²‰é»˜ç‹äºŒ ç¬¬äºŒéƒ¨åˆ†ï¼šä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜
ä¸åŒ¹é…
ä¸åŒ¹é…
```

ä¸è¿‡ï¼Œä½¿ç”¨ Matcher æ¥åŒ¹é…ä¸€äº›ç®€å•çš„å­—ç¬¦ä¸²æ—¶ç›¸å¯¹æ¯”è¾ƒæ²‰é‡ä¸€äº›ï¼Œä½¿ç”¨ String ç±»çš„ `split()` ä»ç„¶æ˜¯é¦–é€‰ï¼Œå› ä¸ºè¯¥æ–¹æ³•è¿˜æœ‰å…¶ä»–ä¸€äº›ç‰›é€¼çš„åŠŸèƒ½ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœä½ æƒ³æŠŠåˆ†éš”ç¬¦åŒ…è£¹åœ¨æ‹†åˆ†åçš„å­—ç¬¦ä¸²çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥è¿™æ ·åšï¼š

```java
String cmower = "æ²‰é»˜ç‹äºŒï¼Œä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜";
if (cmower.contains("ï¼Œ")) {
    String [] parts = cmower.split("(?<=ï¼Œ)");
    System.out.println("ç¬¬ä¸€éƒ¨åˆ†ï¼š" + parts[0] +" ç¬¬äºŒéƒ¨åˆ†ï¼š" + parts[1]);
}
```

ç¨‹åºè¾“å‡ºçš„ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
ç¬¬ä¸€éƒ¨åˆ†ï¼šæ²‰é»˜ç‹äºŒï¼Œ ç¬¬äºŒéƒ¨åˆ†ï¼šä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜
```

å¯ä»¥çœ‹åˆ°åˆ†éš”ç¬¦â€œï¼Œâ€åŒ…è£¹åœ¨äº†ç¬¬ä¸€éƒ¨åˆ†ï¼Œå¦‚æœå¸Œæœ›åŒ…è£¹åœ¨ç¬¬äºŒéƒ¨åˆ†ï¼Œå¯ä»¥è¿™æ ·åšï¼š

```java
String [] parts = cmower.split("(?=ï¼Œ)");
```

â€œ`?<=` å’Œ `?=` æ˜¯ä»€ä¹ˆä¸œä¸œå•Šï¼Ÿâ€ä¸‰å¦¹å¥½å¥‡åœ°é—®ã€‚

â€œå®ƒå…¶å®æ˜¯æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„æ–­è¨€æ¨¡å¼ã€‚â€æˆ‘è¯´ï¼Œâ€œä½ æœ‰æ—¶é—´çš„è¯ï¼Œå¯ä»¥çœ‹çœ‹å‰é¢æˆ‘æ¨èçš„ä¸¤ä»½å¼€æºæ–‡æ¡£ã€‚â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/string/split-02.png)

â€œ`split()` æ–¹æ³•å¯ä»¥ä¼ é€’ 2 ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºåˆ†éš”ç¬¦ï¼Œç¬¬äºŒä¸ªä¸ºæ‹†åˆ†çš„å­—ç¬¦ä¸²ä¸ªæ•°ã€‚â€æˆ‘è¯´ã€‚

```java
String cmower = "æ²‰é»˜ç‹äºŒï¼Œä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜ï¼Œå® çˆ±ä»–";
if (cmower.contains("ï¼Œ")) {
    String [] parts = cmower.split("ï¼Œ", 2);
    System.out.println("ç¬¬ä¸€éƒ¨åˆ†ï¼š" + parts[0] +" ç¬¬äºŒéƒ¨åˆ†ï¼š" + parts[1]);
}
```

è¿›å…¥ debug æ¨¡å¼çš„è¯ï¼Œå¯ä»¥çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/string/split-03.png)

ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼ é€’ 2 ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œä¼šç›´æ¥è°ƒç”¨ `substring()` è¿›è¡Œæˆªå–ï¼Œç¬¬äºŒä¸ªåˆ†éš”ç¬¦åçš„å°±ä¸å†æ‹†åˆ†äº†ã€‚

æ¥çœ‹ä¸€ä¸‹ç¨‹åºè¾“å‡ºçš„ç»“æœï¼š

```
ç¬¬ä¸€éƒ¨åˆ†ï¼šæ²‰é»˜ç‹äºŒ ç¬¬äºŒéƒ¨åˆ†ï¼šä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜ï¼Œå® çˆ±ä»–
```

â€œæ²¡æƒ³åˆ°å•Šï¼Œè¿™ä¸ªå­—ç¬¦ä¸²æ‹†åˆ†è¿˜æŒºè®²ç©¶çš„å‘€ï¼â€ä¸‰å¦¹æ„Ÿæ…¨åœ°è¯´ã€‚

â€œæ˜¯çš„ï¼Œå…¶å®å­—ç¬¦ä¸²æ‹†åˆ†åœ¨å®é™…çš„å·¥ä½œå½“ä¸­è¿˜æ˜¯æŒºç»å¸¸ç”¨çš„ã€‚å‰ç«¯ç»å¸¸ä¼šæŒ‰ç…§è§„åˆ™ä¼ é€’ä¸€é•¿ä¸²å­—ç¬¦åºåˆ—åˆ°åç«¯ï¼Œåç«¯å°±éœ€è¦æŒ‰ç…§è§„åˆ™æŠŠå­—ç¬¦ä¸²æ‹†åˆ†å†åšå¤„ç†ã€‚â€æˆ‘è¯´ã€‚

â€œå—¯ï¼Œæˆ‘æŠŠä»Šå¤©çš„å†…å®¹æ¸©ä¹ ä¸‹ï¼ŒäºŒå“¥ï¼Œä½ ä¼‘æ¯ä¼šã€‚â€ä¸‰å¦¹è¯´ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

# ç¬¬äº”ç« ï¼šé¢å‘å¯¹è±¡ç¼–ç¨‹

## 5.1 Javaä¸­çš„ç±»å’Œå¯¹è±¡

#â€œäºŒå“¥ï¼Œé‚£å¤©æˆ‘åœ¨å›¾ä¹¦é¦†å¤ä¹ ã€ŠJavaè¿›é˜¶ä¹‹è·¯ã€‹çš„æ—¶å€™ï¼Œåˆšå¥½ç¢°è§ä¸€ä¸ªå­¦é•¿ï¼Œä»–é—®æˆ‘æœ‰æ²¡æœ‰â€˜å¯¹è±¡â€™ï¼Œæˆ‘è¯´è¿˜æ²¡æœ‰å•Šã€‚ç»“æœä½ çŒœä»–è¯´ä»€ä¹ˆï¼Œâ€˜è¦ä¸è¦æˆ‘ç»™ä½  new ä¸€ä¸ªå•Šï¼Ÿâ€™æˆ‘å½“æ—¶å°±æ‡µäº†ï¼Œnew æ˜¯å•¥æ„æ€å•Šï¼ŒäºŒå“¥ï¼Ÿâ€ä¸‰å¦¹æ»¡æ˜¯ç–‘æƒ‘çš„é—®æˆ‘ã€‚

â€œå“ˆå“ˆï¼Œä¸‰å¦¹ï¼Œä½ å­¦é•¿è¿˜æŒºå¹½é»˜å•Šã€‚new æ˜¯ Java ä¸­çš„ä¸€ä¸ªå…³é”®å­—ï¼Œç”¨æ¥æŠŠç±»å˜æˆå¯¹è±¡ã€‚â€æˆ‘ç¬‘ç€å¯¹ä¸‰å¦¹è¯´ï¼Œâ€œå¯¹è±¡å’Œç±»æ˜¯ Java ä¸­æœ€åŸºæœ¬çš„ä¸¤ä¸ªæ¦‚å¿µï¼Œå¯ä»¥è¯´æ’‘èµ·äº†é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰çš„ä¸€ç‰‡å¤©ã€‚â€

### 01ã€é¢å‘è¿‡ç¨‹å’Œé¢å‘å¯¹è±¡

ä¸‰å¦¹æ˜¯ä¸æ˜¯è¦é—®ï¼Œä»€ä¹ˆæ˜¯ OOPï¼Ÿ

OOP çš„è‹±æ–‡å…¨ç§°æ˜¯ Object Oriented Programmingï¼Œè¦ç†è§£å®ƒçš„è¯ï¼Œå°±è¦å…ˆç†è§£é¢å‘å¯¹è±¡ï¼Œè¦æƒ³ç†è§£é¢å‘å¯¹è±¡çš„è¯ï¼Œå°±è¦å…ˆç†è§£é¢å‘è¿‡ç¨‹ï¼Œå› ä¸ºä¸€å¼€å§‹æ²¡æœ‰é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ï¼Œéƒ½æ˜¯é¢å‘è¿‡ç¨‹ã€‚

ä¸¾ä¸ªç®€å•ç‚¹çš„ä¾‹å­æ¥åŒºåˆ†ä¸€ä¸‹é¢å‘è¿‡ç¨‹å’Œé¢å‘å¯¹è±¡ã€‚

æœ‰ä¸€å¤©ï¼Œä½ æƒ³åƒå°ç¢—æ±¤äº†ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š

1ï¼‰è‡ªå·±ä¹°é£Ÿæï¼Œè±†è…çš®å•Šã€è‚‰å•Šã€è’œè‹”å•Šç­‰ç­‰ï¼Œè‡ªå·±åŠ¨æ‰‹åšã€‚

2ï¼‰åˆ°é¥­åº—å»ï¼Œåªéœ€è¦å¯¹è€æ¿å–Šä¸€å£°ï¼Œâ€œæ¥ä»½å°ç¢—æ±¤ã€‚â€

ç¬¬ä¸€ç§å°±æ˜¯é¢å‘è¿‡ç¨‹ï¼Œç¬¬äºŒç§å°±æ˜¯é¢å‘å¯¹è±¡ã€‚

é¢å‘è¿‡ç¨‹æœ‰ä»€ä¹ˆåŠ£åŠ¿å‘¢ï¼Ÿå‡å¦‚ä½ ä¹°äº†å°ç¢—æ±¤çš„é£Ÿæï¼Œä¸´äº†åˆæƒ³åƒå®«ä¿é¸¡ä¸äº†ï¼Œä½ æ˜¯ä¸æ˜¯è¿˜å¾—é‡æ–°ä¹°é£Ÿæï¼Ÿ

é¢å‘å¯¹è±¡æœ‰ä»€ä¹ˆä¼˜åŠ¿å‘¢ï¼Ÿå‡å¦‚ä½ ä¸æƒ³åƒå°ç¢—æ±¤äº†ï¼Œä½ åªéœ€è¦å¯¹è€æ¿è¯´ï¼Œâ€œæˆ‘é‚£ä¸ªå°ç¢—æ±¤å¦‚æœæ²¡åšçš„è¯ï¼Œæ¢æˆå®«ä¿é¸¡ä¸å§ï¼â€

é¢å‘è¿‡ç¨‹æ˜¯æµç¨‹åŒ–çš„ï¼Œä¸€æ­¥ä¸€æ­¥ï¼Œä¸Šä¸€æ­¥åšå®Œäº†ï¼Œå†åšä¸‹ä¸€æ­¥ã€‚

é¢å‘å¯¹è±¡æ˜¯æ¨¡å—åŒ–çš„ï¼Œæˆ‘åšæˆ‘çš„ï¼Œä½ åšä½ çš„ï¼Œæˆ‘éœ€è¦ä½ åšçš„è¯ï¼Œæˆ‘å°±å‘Šè¯‰ä½ ä¸€å£°ã€‚æˆ‘ä¸éœ€è¦çŸ¥é“ä½ åˆ°åº•æ€ä¹ˆåšï¼Œåªçœ‹åŠŸåŠ³ä¸çœ‹è‹¦åŠ³ã€‚

ä¸è¿‡ï¼Œå¦‚æœè¿½åˆ°åº•çš„è¯ï¼Œé¢å‘å¯¹è±¡çš„åº•å±‚å…¶å®è¿˜æ˜¯é¢å‘è¿‡ç¨‹ï¼Œåªä¸è¿‡æŠŠé¢å‘è¿‡ç¨‹è¿›è¡Œäº†æŠ½è±¡åŒ–ï¼Œå°è£…æˆäº†ç±»ï¼Œæ–¹ä¾¿æˆ‘ä»¬çš„è°ƒç”¨ã€‚

### 02ã€ç±»

å¯¹è±¡å¯ä»¥æ˜¯ç°å®ä¸­çœ‹å¾—è§çš„ä»»ä½•ç‰©ä½“ï¼Œæ¯”å¦‚è¯´ï¼Œä¸€åªç‰¹ç«‹ç‹¬è¡Œçš„çŒªï¼›ä¹Ÿå¯ä»¥æ˜¯æƒ³è±¡ä¸­çš„ä»»ä½•è™šæ‹Ÿç‰©ä½“ï¼Œæ¯”å¦‚è¯´èƒ½ä¸ƒåäºŒå˜çš„å­™æ‚Ÿç©ºã€‚

Java é€šè¿‡ç±»ï¼ˆclassï¼‰æ¥å®šä¹‰è¿™äº›ç‰©ä½“ï¼Œè¿™äº›ç‰©ä½“æœ‰ä»€ä¹ˆçŠ¶æ€ï¼Œé€šè¿‡å­—æ®µæ¥å®šä¹‰ï¼Œæ¯”å¦‚è¯´æ¯”å¦‚è¯´çŒªçš„é¢œè‰²æ˜¯çº¯è‰²è¿˜æ˜¯èŠ±è‰²ï¼›è¿™äº›ç‰©ä½“æœ‰ä»€ä¹ˆè¡Œä¸ºï¼Œé€šè¿‡æ–¹æ³•æ¥å®šä¹‰ï¼Œæ¯”å¦‚è¯´çŒªä¼šåƒï¼Œä¼šç¡è§‰ã€‚

æ¥ï¼Œå®šä¹‰ä¸€ä¸ªç®€å•çš„ç±»ç»™ä½ çœ‹çœ‹ã€‚

```java
/**
 * å¾®ä¿¡æœç´¢ã€Œæ²‰é»˜ç‹äºŒã€ï¼Œå›å¤ Java
 *
 * @author æ²‰é»˜ç‹äºŒ
 * @date 2020/11/19
 */
public class Person {
    private String name;
    private int age;
    private int sex;

    private void eat() {
    }

    private void sleep() {
    }

    private void dadoudou() {
    }
}
```

ä¸€ä¸ªç±»å¯ä»¥åŒ…å«ï¼š

- å­—æ®µï¼ˆFiledï¼‰
- æ–¹æ³•ï¼ˆMethodï¼‰
- æ„é€ æ–¹æ³•ï¼ˆConstructorï¼‰

åœ¨ Person ç±»ä¸­ï¼Œå­—æ®µæœ‰ 3 ä¸ªï¼Œåˆ†åˆ«æ˜¯ nameã€age å’Œ sexï¼Œå®ƒä»¬ä¹Ÿç§°ä¸ºæˆå‘˜[å˜é‡](https://tobebetterjavaer.com/oo/var.html)â€”â€”åœ¨ç±»å†…éƒ¨ä½†åœ¨æ–¹æ³•å¤–éƒ¨ï¼Œæ–¹æ³•å†…éƒ¨çš„å«ä¸´æ—¶å˜é‡ã€‚

æˆå‘˜å˜é‡æœ‰æ—¶å€™ä¹Ÿå«åšå®ä¾‹å˜é‡ï¼Œåœ¨ç¼–è¯‘æ—¶ä¸å ç”¨å†…å­˜ç©ºé—´ï¼Œåœ¨è¿è¡Œæ—¶è·å–å†…å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰åœ¨å¯¹è±¡å®ä¾‹åŒ–ï¼ˆ`new Person()`ï¼‰åï¼Œå­—æ®µæ‰ä¼šè·å–åˆ°å†…å­˜ï¼Œè¿™ä¹Ÿæ­£æ˜¯å®ƒè¢«ç§°ä½œâ€œå®ä¾‹â€å˜é‡çš„åŸå› ã€‚

[æ–¹æ³•](https://tobebetterjavaer.com/oo/method.html)æœ‰ 3 ä¸ªï¼Œåˆ†åˆ«æ˜¯ `eat()`ã€`sleep()` å’Œ `dadoudou()`ï¼Œè¡¨ç¤º Person è¿™ä¸ªå¯¹è±¡å¯ä»¥åšä»€ä¹ˆï¼Œä¹Ÿå°±æ˜¯åƒé¥­ç¡è§‰æ‰“è±†è±†ã€‚

é‚£ä¸‰å¦¹æ˜¯ä¸æ˜¯è¦é—®ï¼Œâ€œæ€ä¹ˆæ²¡æœ‰[æ„é€ æ–¹æ³•](https://tobebetterjavaer.com/oo/construct.html)å‘¢ï¼Ÿâ€

çš„ç¡®åœ¨ Person ç±»çš„æºç æ–‡ä»¶ï¼ˆ.javaï¼‰ä¸­æ²¡çœ‹åˆ°ï¼Œä½†åœ¨åç¼–è¯‘åçš„å­—èŠ‚ç æ–‡ä»¶ï¼ˆ.classï¼‰ä¸­æ˜¯å¯ä»¥çœ‹å¾—åˆ°çš„ã€‚

```java
//
// Source code recreated from a .class file by IntelliJ IDEA
// (powered by Fernflower decompiler)
//

package com.itwanger.twentythree;

public class Person {
    private String name;
    private int age;
    private int sex;

    public Person() {
    }

    private void eat() {
    }

    private void sleep() {
    }

    private void dadoudou() {
    }
}
```

`public Person(){}` å°±æ˜¯é»˜è®¤çš„æ„é€ æ–¹æ³•ï¼Œå› ä¸ºæ˜¯ç©ºçš„æ„é€ æ–¹æ³•ï¼ˆæ–¹æ³•ä½“ä¸­æ²¡æœ‰å†…å®¹ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥ç¼ºçœã€‚Java èªæ˜å°±èªæ˜åœ¨è¿™ï¼Œæœ‰äº›å¾ˆæ­»æ¿çš„ä»£ç ä¸éœ€è¦å¼€å‘äººå‘˜æ·»åŠ ï¼Œå®ƒä¼šå·å·åœ°åšäº†ã€‚

### 03ã€new ä¸€ä¸ªå¯¹è±¡

åˆ›å»º Java å¯¹è±¡æ—¶ï¼Œéœ€è¦ç”¨åˆ° `new` å…³é”®å­—ã€‚

```java
Person person = new Person();
```

è¿™è¡Œä»£ç å°±é€šè¿‡ Person ç±»åˆ›å»ºäº†ä¸€ä¸ª Person å¯¹è±¡ã€‚æ‰€æœ‰**å¯¹è±¡**åœ¨åˆ›å»ºçš„æ—¶å€™éƒ½ä¼šåœ¨**å †å†…å­˜ä¸­åˆ†é…ç©ºé—´**ã€‚

åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ï¼Œéœ€è¦ä¸€ä¸ª `main()` æ–¹æ³•ä½œä¸ºå…¥å£ï¼Œ `main()` æ–¹æ³•å¯ä»¥åœ¨å½“å‰ç±»ä¸­ï¼Œä¹Ÿå¯ä»¥åœ¨å¦å¤–ä¸€ä¸ªç±»ä¸­ã€‚

ç¬¬ä¸€ç§ï¼š`main()` æ–¹æ³•ç›´æ¥æ”¾åœ¨ Person ç±»ä¸­ã€‚

```java
public class Person {
    private String name;
    private int age;
    private int sex;

    private void eat() {}
    private void sleep() {}
    private void dadoudou() {}

    public static void main(String[] args) {
        Person person = new Person();
        System.out.println(person.name);
        System.out.println(person.age);
        System.out.println(person.sex);
    }
}
```

è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
null
0
0
```

ç¬¬äºŒç§ï¼š`main()` æ–¹æ³•ä¸åœ¨ Person ç±»ä¸­ï¼Œè€Œåœ¨å¦å¤–ä¸€ä¸ªç±»ä¸­ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/object-class/16-01.png)

å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¸åœ¨å½“å‰ç±»ä¸­ç›´æ¥åˆ›å»ºå¯¹è±¡å¹¶ä½¿ç”¨å®ƒï¼Œè€Œæ˜¯æ”¾åœ¨ä½¿ç”¨å¯¹è±¡çš„ç±»ä¸­ï¼Œæ¯”å¦‚è¯´ä¸Šå›¾ä¸­çš„ PersonTest ç±»ã€‚

å¯ä»¥æŠŠ PersonTest ç±»å’Œ Person ç±»æ”¾åœ¨ä¸¤ä¸ªæ–‡ä»¶ä¸­ï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ï¼ˆå‘½åä¸º PersonTest.javaï¼‰ä¸­ï¼Œå°±åƒä¸‹é¢è¿™æ ·ã€‚

```java
/**
 * @author å¾®ä¿¡æœã€Œæ²‰é»˜ç‹äºŒã€ï¼Œå›å¤å…³é”®å­— PDF
 */
public class PersonTest {
    public static void main(String[] args) {
        Person person = new Person();
    }
}

class Person {
    private String name;
    private int age;
    private int sex;

    private void eat() {}
    private void sleep() {}
    private void dadoudou() {}
}
```

### 04ã€åˆå§‹åŒ–å¯¹è±¡

åœ¨ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œç¨‹åºè¾“å‡ºç»“æœä¸ºï¼š

```
null
0
0
```

ä¸ºä»€ä¹ˆä¼šæœ‰è¿™æ ·çš„è¾“å‡ºç»“æœå‘¢ï¼Ÿå› ä¸º Person å¯¹è±¡æ²¡æœ‰åˆå§‹åŒ–ï¼Œå› æ­¤è¾“å‡ºäº† String çš„é»˜è®¤å€¼ nullï¼Œint çš„é»˜è®¤å€¼ 0ã€‚

é‚£æ€ä¹ˆåˆå§‹åŒ– Person å¯¹è±¡ï¼ˆå¯¹å­—æ®µèµ‹å€¼ï¼‰å‘¢ï¼Ÿ

#### ç¬¬ä¸€ç§ï¼šé€šè¿‡å¯¹è±¡çš„å¼•ç”¨å˜é‡ã€‚

```java
public class Person {
    private String name;
    private int age;
    private int sex;

    public static void main(String[] args) {
        Person person = new Person();
        person.name = "æ²‰é»˜ç‹äºŒ";
        person.age = 18;
        person.sex = 1;
        
        System.out.println(person.name);
        System.out.println(person.age);
        System.out.println(person.sex);
    }
}
```

person è¢«ç§°ä¸ºå¯¹è±¡ Person çš„å¼•ç”¨å˜é‡ï¼Œè§ä¸‹å›¾ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/object-class/16-02.png)

é€šè¿‡å¯¹è±¡çš„å¼•ç”¨å˜é‡ï¼Œå¯ä»¥ç›´æ¥å¯¹å­—æ®µè¿›è¡Œåˆå§‹åŒ–ï¼ˆ`person.name = "æ²‰é»˜ç‹äºŒ"`ï¼‰ï¼Œæ‰€ä»¥ä»¥ä¸Šä»£ç è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
æ²‰é»˜ç‹äºŒ
18
1
```

#### ç¬¬äºŒç§ï¼šé€šè¿‡æ–¹æ³•åˆå§‹åŒ–ã€‚

```java
/**
 * @author æ²‰é»˜ç‹äºŒï¼Œä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜
 */
public class Person {
    private String name;
    private int age;
    private int sex;

    public void initialize(String n, int a, int s) {
        name = n;
        age = a;
        sex = s;
    }

    public static void main(String[] args) {
        Person person = new Person();
        person.initialize("æ²‰é»˜ç‹äºŒ",18,1);

        System.out.println(person.name);
        System.out.println(person.age);
        System.out.println(person.sex);
    }
}
```

åœ¨ Person ç±»ä¸­æ–°å¢æ–¹æ³• `initialize()`ï¼Œç„¶ååœ¨æ–°å»ºå¯¹è±¡åä¼ å‚è¿›è¡Œåˆå§‹åŒ–ï¼ˆ`person.initialize("æ²‰é»˜ç‹äºŒ", 18, 1)`ï¼‰ã€‚

#### ç¬¬ä¸‰ç§ï¼šé€šè¿‡æ„é€ æ–¹æ³•åˆå§‹åŒ–ã€‚

```java
/**
 * @author æ²‰é»˜ç‹äºŒï¼Œä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜
 */
public class Person {
    private String name;
    private int age;
    private int sex;

    public Person(String name, int age, int sex) {
        this.name = name;
        this.age = age;
        this.sex = sex;
    }

    public static void main(String[] args) {
        Person person = new Person("æ²‰é»˜ç‹äºŒ", 18, 1);

        System.out.println(person.name);
        System.out.println(person.age);
        System.out.println(person.sex);
    }
}
```

è¿™ä¹Ÿæ˜¯æœ€æ ‡å‡†çš„ä¸€ç§åšæ³•ï¼Œç›´æ¥åœ¨ new çš„æ—¶å€™æŠŠå‚æ•°ä¼ é€’è¿‡å»ã€‚

è¡¥å……ä¸€ç‚¹çŸ¥è¯†ï¼ŒåŒ¿åå¯¹è±¡ã€‚åŒ¿åå¯¹è±¡æ„å‘³ç€æ²¡æœ‰å¼•ç”¨å˜é‡ï¼Œå®ƒåªèƒ½åœ¨åˆ›å»ºçš„æ—¶å€™è¢«ä½¿ç”¨ä¸€æ¬¡ã€‚

```java
new Person();
```

å¯ä»¥ç›´æ¥é€šè¿‡åŒ¿åå¯¹è±¡è°ƒç”¨æ–¹æ³•ï¼š

```java
new Person().initialize("æ²‰é»˜ç‹äºŒ", 18, 1);
```

### 05ã€å…³äºå¯¹è±¡

#### **1ï¼‰æŠ½è±¡çš„å†ç¨‹**

æ‰€æœ‰ç¼–ç¨‹è¯­è¨€éƒ½æ˜¯ä¸€ç§æŠ½è±¡ï¼Œç”šè‡³å¯ä»¥è¯´ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè§£å†³çš„é—®é¢˜çš„å¤æ‚ç¨‹åº¦å–å†³äºæŠ½è±¡çš„ç±»å‹å’Œè´¨é‡ã€‚

Smalltalk æ˜¯å†å²ä¸Šç¬¬ä¸€é—¨è·å¾—æˆåŠŸçš„é¢å‘å¯¹è±¡è¯­è¨€ï¼Œä¹Ÿä¸º Java æä¾›äº†çµæ„Ÿã€‚å®ƒæœ‰ 5 ä¸ªåŸºæœ¬ç‰¹å¾ï¼š

- ä¸‡ç‰©çš†å¯¹è±¡ã€‚
- ä¸€æ®µç¨‹åºå®é™…ä¸Šå°±æ˜¯å¤šä¸ªå¯¹è±¡é€šè¿‡å‘é€æ¶ˆæ¯çš„æ–¹å¼æ¥å‘Šè¯‰å½¼æ­¤è¯¥åšä»€ä¹ˆã€‚
- é€šè¿‡ç»„åˆçš„æ–¹å¼ï¼Œå¯ä»¥å°†å¤šä¸ªå¯¹è±¡å°è£…æˆå…¶ä»–æ›´ä¸ºåŸºç¡€çš„å¯¹è±¡ã€‚
- å¯¹è±¡æ˜¯é€šè¿‡ç±»å®ä¾‹åŒ–çš„ã€‚
- åŒä¸€ç±»å‹çš„å¯¹è±¡å¯ä»¥æ¥æ”¶ç›¸åŒçš„æ¶ˆæ¯ã€‚

æ€»ç»“ä¸€å¥è¯å°±æ˜¯ï¼š

>çŠ¶æ€+è¡Œä¸º+æ ‡è¯†=å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡åœ¨å†…å­˜ä¸­éƒ½ä¼šæœ‰ä¸€ä¸ªå”¯ä¸€çš„åœ°å€ã€‚

#### **2ï¼‰å¯¹è±¡å…·æœ‰æ¥å£**

æ‰€æœ‰çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥è¢«å½’ä¸ºä¸€ç±»ï¼Œå¹¶ä¸”åŒä¸€ç±»å¯¹è±¡æ‹¥æœ‰ä¸€äº›å…±åŒçš„è¡Œä¸ºå’Œç‰¹å¾ã€‚åœ¨ Java ä¸­ï¼Œclass å…³é”®å­—ç”¨æ¥å®šä¹‰ä¸€ä¸ªç±»å‹ã€‚

åˆ›å»ºæŠ½è±¡æ•°æ®ç±»å‹æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€ä¸ªåŸºæœ¬æ¦‚å¿µã€‚ä½ å¯ä»¥åˆ›å»ºæŸç§ç±»å‹çš„å˜é‡ï¼ŒJava ä¸­ç§°ä¹‹ä¸ºå¯¹è±¡æˆ–è€…å®ä¾‹ï¼Œç„¶åä½ å°±å¯ä»¥æ“ä½œè¿™äº›å˜é‡ï¼ŒJava ä¸­ç§°ä¹‹ä¸ºå‘é€æ¶ˆæ¯æˆ–è€…å‘é€è¯·æ±‚ï¼Œæœ€åå¯¹è±¡å†³å®šè‡ªå·±è¯¥æ€ä¹ˆåšã€‚

ç±»æè¿°äº†ä¸€ç³»åˆ—å…·æœ‰ç›¸åŒç‰¹å¾å’Œè¡Œä¸ºçš„å¯¹è±¡ï¼Œä»å®½æ³›çš„æ¦‚å¿µä¸Šæ¥è¯´ï¼Œç±»å…¶å®å°±æ˜¯ä¸€ç§è‡ªå®šä¹‰çš„æ•°æ®ç±»å‹ã€‚

ä¸€æ—¦åˆ›å»ºäº†ä¸€ä¸ªç±»ï¼Œå°±å¯ä»¥ç”¨å®ƒåˆ›å»ºä»»æ„å¤šä¸ªå¯¹è±¡ã€‚é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€é‡åˆ°çš„æœ€å¤§ä¸€ä¸ªæŒ‘æˆ˜å°±æ˜¯ï¼Œå¦‚ä½•æŠŠç°å®/è™šæ‹Ÿçš„å…ƒç´ æŠ½è±¡ä¸º Java ä¸­çš„å¯¹è±¡ã€‚

å¯¹è±¡èƒ½å¤Ÿæ¥æ”¶ä»€ä¹ˆæ ·çš„è¯·æ±‚æ˜¯ç”±å®ƒçš„[æ¥å£](https://tobebetterjavaer.com/oo/interface.html)å®šä¹‰çš„ã€‚å…·ä½“æ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Œå°±ç”±å®ƒçš„å®ç°æ–¹æ³•æ¥å®ç°ã€‚

#### **3ï¼‰è®¿é—®æƒé™ä¿®é¥°ç¬¦**

ç±»çš„åˆ›å»ºè€…æœ‰æ—¶å€™ä¹Ÿè¢«ç§°ä¸º API æä¾›è€…ï¼Œå¯¹åº”çš„ï¼Œç±»çš„ä½¿ç”¨è€…å°±è¢«ç§°ä¸º API è°ƒç”¨è€…ã€‚

JDK å°±ç»™æˆ‘ä»¬æä¾›äº† Java çš„åŸºç¡€å®ç°ï¼ŒJDK çš„ä½œè€…ä¹Ÿå°±æ˜¯åŸºç¡€ API çš„æä¾›è€…ï¼ˆJava å¤šçº¿ç¨‹éƒ¨åˆ†çš„ä½œè€… Doug Lea æ˜¯è¢« Java ç¨‹åºå‘˜æ•¬ä½©çš„ä¸€ä¸ªå¤§ä½¬ï¼‰ï¼Œæˆ‘ä»¬è¿™äº› Java è¯­è¨€çš„ä½¿ç”¨è€…ï¼Œè¯´ç™½äº†å°±æ˜¯ JDK çš„è°ƒç”¨è€…ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/object-class-20230410094307.png)

å½“ç„¶äº†ï¼Œå‡å¦‚æˆ‘ä»¬ä¹Ÿæä¾›äº†æ–°çš„ç±»ç»™å…¶ä»–è°ƒç”¨è€…ï¼Œæˆ‘ä»¬ä¹Ÿå°±æˆä¸ºäº†æ–°çš„åˆ›å»ºè€…ã€‚

API åˆ›å»ºè€…åœ¨åˆ›å»ºæ–°çš„ç±»çš„æ—¶å€™ï¼Œåªæš´éœ²å¿…è¦çš„æ¥å£ï¼Œè€Œéšè—å…¶ä»–æ‰€æœ‰ä¸å¿…è¦çš„ä¿¡æ¯ï¼Œä¹‹æ‰€ä»¥è¦è¿™ä¹ˆåšï¼Œæ˜¯å› ä¸ºå¦‚æœè¿™äº›ä¿¡æ¯å¯¹è°ƒç”¨è€…æ˜¯ä¸å¯è§çš„ï¼Œé‚£ä¹ˆåˆ›å»ºè€…å°±å¯ä»¥éšæ„ä¿®æ”¹éšè—çš„ä¿¡æ¯ï¼Œè€Œä¸ç”¨æ‹…å¿ƒå¯¹è°ƒç”¨è€…çš„å½±å“ã€‚

è¿™é‡Œå°±å¿…é¡»è¦è®²åˆ° [Java çš„æƒé™ä¿®é¥°ç¬¦](https://tobebetterjavaer.com/oo/access-control.html)ã€‚

è®¿é—®æƒé™ä¿®é¥°ç¬¦çš„ç¬¬ä¸€ä¸ªä½œç”¨æ˜¯ï¼Œé˜²æ­¢ç±»çš„è°ƒç”¨è€…æ¥è§¦åˆ°ä»–ä»¬ä¸è¯¥æ¥è§¦çš„å†…éƒ¨å®ç°ï¼›ç¬¬äºŒä¸ªä½œç”¨æ˜¯ï¼Œè®©ç±»çš„åˆ›å»ºè€…å¯ä»¥è½»æ¾ä¿®æ”¹å†…éƒ¨æœºåˆ¶è€Œä¸ç”¨æ‹…å¿ƒå½±å“åˆ°è°ƒç”¨è€…çš„ä½¿ç”¨ã€‚

- public
- private
- protected

è¿˜æœ‰ä¸€ç§â€œé»˜è®¤â€çš„æƒé™ä¿®é¥°ç¬¦ï¼Œæ˜¯ç¼ºçœçš„ï¼Œå®ƒä¿®é¥°çš„ç±»å¯ä»¥è®¿é—®åŒä¸€ä¸ªåŒ…ä¸‹é¢çš„å…¶ä»–ç±»ã€‚

#### **4ï¼‰ç»„åˆ**

æˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ªåˆ›å»ºå¥½çš„ç±»ä½œä¸ºå¦å¤–ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡æ¥ä½¿ç”¨ï¼Œåˆ©ç”¨å·²æœ‰çš„ç±»ç»„æˆæˆä¸€ä¸ªæ–°çš„ç±»ï¼Œè¢«ç§°ä¸ºâ€œå¤ç”¨â€ï¼Œç»„åˆä»£è¡¨çš„å…³ç³»æ˜¯ has-a çš„å…³ç³»ã€‚

#### **5ï¼‰ç»§æ‰¿**

[ç»§æ‰¿](https://tobebetterjavaer.com/oo/extends-bigsai.html)æ˜¯ Java ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå­ç±»ç»§æ‰¿çˆ¶ç±»ï¼Œä¹Ÿå°±æ‹¥æœ‰äº†çˆ¶ç±»ä¸­ protected å’Œ public ä¿®é¥°çš„æ–¹æ³•å’Œå­—æ®µï¼ŒåŒæ—¶ï¼Œå­ç±»è¿˜å¯ä»¥æ‰©å±•ä¸€äº›è‡ªå·±çš„æ–¹æ³•å’Œå­—æ®µï¼Œä¹Ÿå¯ä»¥é‡å†™ç»§æ‰¿è¿‡æ¥æ–¹æ³•ã€‚

å¸¸è§çš„ä¾‹å­ï¼Œå°±æ˜¯å½¢çŠ¶å¯ä»¥æœ‰å­ç±»åœ†å½¢ã€æ–¹å½¢ã€ä¸‰è§’å½¢ï¼Œå®ƒä»¬çš„åŸºç¡€æ¥å£æ˜¯ç›¸åŒçš„ï¼Œæ¯”å¦‚è¯´éƒ½æœ‰ä¸€ä¸ª `draw()` çš„æ–¹æ³•ï¼Œå­ç±»å¯ä»¥ç»§æ‰¿è¿™ä¸ªæ–¹æ³•å®ç°è‡ªå·±çš„ç»˜åˆ¶æ–¹æ³•ã€‚

å¦‚æœå­ç±»åªæ˜¯é‡å†™äº†çˆ¶ç±»çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒä»¬ä¹‹é—´çš„å…³ç³»å°±æ˜¯ is-a çš„å…³ç³»ï¼Œä½†å¦‚æœå­ç±»å¢åŠ äº†æ–°çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒä»¬ä¹‹é—´çš„å…³ç³»å°±å˜æˆäº† is-like-a çš„å…³ç³»ã€‚

#### **6ï¼‰å¤šæ€**

æ¯”å¦‚è¯´æœ‰ä¸€ä¸ªçˆ¶ç±»Shape

```java
public class Shape {
    public void draw() {
        System.out.println("å½¢çŠ¶");
    }
}
```

å­ç±»Circle

```java
public class Circle extends Shape{
    @Override
    public void draw() {
        System.out.println("åœ†å½¢");
    }
}
```

å­ç±»Line

```java
public class Line extends Shape {
    @Override
    public void draw() {
        System.out.println("çº¿");
    }
}
```

æµ‹è¯•ç±»

```java
public class Test {
    public static void main(String[] args) {
        Shape shape1 = new Line();
        shape1.draw();
        Shape shape2 = new Circle();
        shape2.draw();
    }
}
```

è¿è¡Œç»“æœï¼š

```
çº¿
åœ†å½¢
```

åœ¨æµ‹è¯•ç±»ä¸­ï¼Œshape1 çš„ç±»å‹ä¸º Shapeï¼Œshape2 çš„ç±»å‹ä¹Ÿä¸º Shapeï¼Œä½†è°ƒç”¨ `draw()` æ–¹æ³•åï¼Œå´èƒ½è‡ªåŠ¨è°ƒç”¨å­ç±» Line å’Œ Circle çš„ `draw()` æ–¹æ³•ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

å…¶å®å°±æ˜¯ Java ä¸­çš„[å¤šæ€](https://tobebetterjavaer.com/oo/polymorphism.html)ã€‚

### 06ã€å°ç»“

â€œæ€ä¹ˆæ ·ï¼Œä¸‰å¦¹ï¼Œæ˜¯ä¸æ˜¯å¯¹ Java æœ‰äº†æ›´æ·±å…¥æ›´æ¸…æ™°çš„ç†è§£ï¼Ÿâ€ç»ˆäºè®²å®Œäº†ï¼Œæˆ‘æ·±å‘¼äº†ä¸€å£æ°”ï¼Œå¥½èˆ’ç•…å•Šï¼

â€œæ˜¯çš„ï¼Œå“¥ï¼Œæ„Ÿè§‰ Java ä¹Ÿå°±é‚£ä¹ˆå›äº‹å˜›ã€‚â€å“å‘€ï¼Œä¸‰å¦¹æœ‰ç‚¹ç‹‚äº†èµ·æ¥ï¼Œâ€œä¸‡ç‰©çš†å¯¹è±¡ï¼Œé™¤äº†åŸºæœ¬æ•°æ®ç±»å‹ã€‚â€

â€œå“‡ï¼Œä¸‰å¦¹ï¼Œä½ å¯ä»¥å•Šï¼Œéƒ½ä¼šè‡ªå·±æ¢³ç†æ€»ç»“äº†ã€‚â€æˆ‘å€æ„Ÿæ¬£æ…°ï¼Œè§‰å¾—æœç„¶æ˜¯åŠ³æœ‰æ‰€è·ï¼Œä½ è®²çš„è®¤çœŸï¼Œå¬ä¼—å°±èƒ½ç†è§£å’Œ getï¼Œæ»¡è¶³äº†ã€‚

## 5.2 Javaä¸­çš„åŒ…

â€œä¸‰å¦¹ï¼Œè¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ç®€å•è¿‡ä¸€ä¸‹ Java ä¸­çš„åŒ…ï¼Œä¹Ÿå°±æ˜¯ packageï¼Œè¿™ä¸ªä¸€ç‚¹å°±é€ï¼Œå¾ˆå¥½æŒæ¡ã€‚â€æˆ‘æ”¾ä¸‹æ‰‹ä¸­çš„é›ªç¢§ï¼Œç¿»å¼€ç¬”è®°æœ¬ï¼Œç™»ä¸Š GitHubï¼Œç‚¹å¼€ã€ŠäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ã€‹ï¼Œæ‰¾åˆ°è¿™ç¯‡ã€ŒJava ä¸­çš„åŒ…ã€ï¼Œå¼€å§‹æ»”æ»”ä¸ç»èµ·æ¥ã€‚

â€œäºŒå“¥ï¼Œä½ ç­‰ä¸€ä¸‹ã€‚â€è®©æˆ‘æ‰“å¼€æ€ç»´å¯¼å›¾åšä¸€ä¸‹ç¬”è®°ğŸ“’ã€‚

### å…³äºåŒ…

åœ¨å‰é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æŠŠç±»å’Œæ¥å£å‘½åä¸º`Person`ã€`Student`ã€`Hello`ç­‰ç®€å•çš„åå­—ã€‚

åœ¨å›¢é˜Ÿå¼€å‘ä¸­ï¼Œå¦‚æœå°æ˜å†™äº†ä¸€ä¸ª`Person`ç±»ï¼Œå°çº¢ä¹Ÿå†™äº†ä¸€ä¸ª`Person`ç±»ï¼Œç°åœ¨ï¼Œå°ç™½æ—¢æƒ³ç”¨å°æ˜çš„`Person`ï¼Œä¹Ÿæƒ³ç”¨å°çº¢çš„`Person`ï¼Œæ€ä¹ˆåŠï¼Ÿ

å¦‚æœå°å†›å†™äº†ä¸€ä¸ª`Arrays`ç±»ï¼Œæ°å¥½ JDK ä¹Ÿè‡ªå¸¦äº†ä¸€ä¸ª`Arrays`ç±»ï¼Œå¦‚ä½•è§£å†³ç±»åå†²çªï¼Ÿ

åœ¨ Java ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`package`æ¥è§£å†³åå­—å†²çªã€‚

Java å®šä¹‰äº†ä¸€ç§åå­—ç©ºé—´ï¼Œç§°ä¹‹ä¸ºåŒ…ï¼š`package`ã€‚ä¸€ä¸ªç±»æ€»æ˜¯å±äºæŸä¸ªåŒ…ï¼Œç±»åï¼ˆæ¯”å¦‚`Person`ï¼‰åªæ˜¯ä¸€ä¸ªç®€å†™ï¼ŒçœŸæ­£çš„å®Œæ•´ç±»åæ˜¯`åŒ…å.ç±»å`ã€‚

ä¾‹å¦‚ï¼š

å°æ˜çš„`Person`ç±»å­˜æ”¾åœ¨åŒ…`ming`ä¸‹é¢ï¼Œå› æ­¤ï¼Œå®Œæ•´ç±»åæ˜¯`ming.Person`ï¼›

å°çº¢çš„`Person`ç±»å­˜æ”¾åœ¨åŒ…`hong`ä¸‹é¢ï¼Œå› æ­¤ï¼Œå®Œæ•´ç±»åæ˜¯`hong.Person`ï¼›

å°å†›çš„`Arrays`ç±»å­˜æ”¾åœ¨åŒ…`mr.jun`ä¸‹é¢ï¼Œå› æ­¤ï¼Œå®Œæ•´ç±»åæ˜¯`mr.jun.Arrays`ï¼›

JDK çš„`Arrays`ç±»å­˜æ”¾åœ¨åŒ…`java.util`ä¸‹é¢ï¼Œå› æ­¤ï¼Œå®Œæ•´ç±»åæ˜¯`java.util.Arrays`ã€‚

åœ¨å®šä¹‰`class`çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç¬¬ä¸€è¡Œå£°æ˜è¿™ä¸ª`class`å±äºå“ªä¸ªåŒ…ã€‚

å°æ˜çš„`Person.java`æ–‡ä»¶ï¼š

```java
package ming; // ç”³æ˜åŒ…åming

public class Person {
}
```

å°å†›çš„`Arrays.java`æ–‡ä»¶ï¼š

```java
package mr.jun; // ç”³æ˜åŒ…åmr.jun

public class Arrays {
}
```

åœ¨ Java è™šæ‹Ÿæœºæ‰§è¡Œçš„æ—¶å€™ï¼ŒJVM åªçœ‹å®Œæ•´ç±»åï¼Œå› æ­¤ï¼Œåªè¦åŒ…åä¸åŒï¼Œç±»å°±ä¸åŒã€‚

åŒ…å¯ä»¥æ˜¯å¤šå±‚ç»“æ„ï¼Œç”¨`.`éš”å¼€ã€‚ä¾‹å¦‚ï¼š`java.util`ã€‚


>è¦ç‰¹åˆ«æ³¨æ„ï¼šåŒ…æ²¡æœ‰çˆ¶å­å…³ç³»ã€‚java.utilå’Œjava.util.zipæ˜¯ä¸åŒçš„åŒ…ï¼Œä¸¤è€…æ²¡æœ‰ä»»ä½•ç»§æ‰¿å…³ç³»ã€‚


æ²¡æœ‰å®šä¹‰åŒ…åçš„`class`ï¼Œå®ƒä½¿ç”¨çš„æ˜¯é»˜è®¤åŒ…ï¼Œéå¸¸å®¹æ˜“å¼•èµ·åå­—å†²çªï¼Œå› æ­¤ï¼Œä¸æ¨èä¸å†™åŒ…åçš„åšæ³•ã€‚

æˆ‘ä»¬è¿˜éœ€è¦æŒ‰ç…§åŒ…ç»“æ„æŠŠä¸Šé¢çš„ Java æ–‡ä»¶ç»„ç»‡èµ·æ¥ã€‚å‡è®¾ä»¥`package_sample`ä½œä¸ºæ ¹ç›®å½•ï¼Œ`src`ä½œä¸ºæºç ç›®å½•ï¼Œé‚£ä¹ˆæ‰€æœ‰æ–‡ä»¶ç»“æ„å°±æ˜¯ï¼š

```ascii
package_sample
â””â”€ src
    â”œâ”€ hong
    â”‚  â””â”€ Person.java
    â”‚  ming
    â”‚  â””â”€ Person.java
    â””â”€ mr
       â””â”€ jun
          â””â”€ Arrays.java
```

å³æ‰€æœ‰ Java æ–‡ä»¶å¯¹åº”çš„ç›®å½•å±‚æ¬¡è¦å’ŒåŒ…çš„å±‚æ¬¡ä¸€è‡´ã€‚

ç¼–è¯‘åçš„`.class`æ–‡ä»¶ä¹Ÿéœ€è¦æŒ‰ç…§åŒ…ç»“æ„å­˜æ”¾ã€‚å¦‚æœä½¿ç”¨ IDEï¼ŒæŠŠç¼–è¯‘åçš„`.class`æ–‡ä»¶æ”¾åˆ°`bin`ç›®å½•ä¸‹ï¼Œé‚£ä¹ˆï¼Œç¼–è¯‘çš„æ–‡ä»¶ç»“æ„å°±æ˜¯ï¼š

```ascii
package_sample
â””â”€ bin
   â”œâ”€ hong
   â”‚  â””â”€ Person.class
   â”‚  ming
   â”‚  â””â”€ Person.class
   â””â”€ mr
      â””â”€ jun
         â””â”€ Arrays.class
```

ç¼–è¯‘çš„å‘½ä»¤ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬éœ€è¦åœ¨`src`ç›®å½•ä¸‹æ‰§è¡Œ`javac`å‘½ä»¤ï¼š

```
javac -d ../bin ming/Person.java hong/Person.java mr/jun/Arrays.java
```

åœ¨ IDE ä¸­ï¼Œä¼šè‡ªåŠ¨æ ¹æ®åŒ…ç»“æ„ç¼–è¯‘æ‰€æœ‰ Java æºç ï¼Œæ‰€ä»¥ä¸å¿…æ‹…å¿ƒä½¿ç”¨å‘½ä»¤è¡Œç¼–è¯‘çš„å¤æ‚å‘½ä»¤ã€‚

### åŒ…çš„ä½œç”¨åŸŸ

ä½äºåŒä¸€ä¸ªåŒ…çš„ç±»ï¼Œå¯ä»¥è®¿é—®åŒ…ä½œç”¨åŸŸçš„å­—æ®µå’Œæ–¹æ³•ã€‚

ä¸ç”¨`public`ã€`protected`ã€`private`ä¿®é¥°çš„å­—æ®µå’Œæ–¹æ³•å°±æ˜¯åŒ…ä½œç”¨åŸŸã€‚ä¾‹å¦‚ï¼Œ`Person`ç±»å®šä¹‰åœ¨`hello`åŒ…ä¸‹é¢ï¼š

```java
package hello;

public class Person {
    // åŒ…ä½œç”¨åŸŸ:
    void hello() {
        System.out.println("Hello!");
    }
}
```

`Main`ç±»ä¹Ÿå®šä¹‰åœ¨`hello`åŒ…ä¸‹é¢ï¼Œå°±å¯ä»¥ç›´æ¥è®¿é—® Person ç±»ï¼š

```java
package hello;

public class Main {
    public static void main(String[] args) {
        Person p = new Person();
        p.hello(); // å¯ä»¥è°ƒç”¨ï¼Œå› ä¸ºMainå’ŒPersonåœ¨åŒä¸€ä¸ªåŒ…
    }
}
```

### å¯¼å…¥åŒ…

åœ¨ä¸€ä¸ª`class`ä¸­ï¼Œæˆ‘ä»¬æ€»ä¼šå¼•ç”¨å…¶ä»–çš„`class`ã€‚ä¾‹å¦‚ï¼Œå°æ˜çš„`ming.Person`ç±»ï¼Œå¦‚æœè¦å¼•ç”¨å°å†›çš„`mr.jun.Arrays`ç±»ï¼Œä»–æœ‰ä¸‰ç§å†™æ³•ï¼š

ç¬¬ä¸€ç§ï¼Œç›´æ¥å†™å‡ºå®Œæ•´ç±»åï¼Œä¾‹å¦‚ï¼š

```java
// Person.java
package ming;

public class Person {
    public void run() {
        mr.jun.Arrays arrays = new mr.jun.Arrays();
    }
}
```

å¾ˆæ˜¾ç„¶ï¼Œæ¯æ¬¡éƒ½è¦å†™å®Œæ•´çš„ç±»åæ¯”è¾ƒç—›è‹¦ã€‚

å› æ­¤ï¼Œç¬¬äºŒç§å†™æ³•æ˜¯ç”¨`import`è¯­å¥ï¼Œå¯¼å…¥å°å†›çš„`Arrays`ï¼Œç„¶åå†™ç®€å•ç±»åï¼š

```java
// Person.java
package ming;

// å¯¼å…¥å®Œæ•´ç±»å:
import mr.jun.Arrays;

public class Person {
    public void run() {
        Arrays arrays = new Arrays();
    }
}
```

åœ¨å†™`import`çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨`*`ï¼Œè¡¨ç¤ºæŠŠè¿™ä¸ªåŒ…ä¸‹é¢çš„æ‰€æœ‰`class`éƒ½å¯¼å…¥è¿›æ¥ï¼ˆä½†ä¸åŒ…æ‹¬å­åŒ…çš„`class`ï¼‰ï¼š

```java
// Person.java
package ming;

// å¯¼å…¥mr.junåŒ…çš„æ‰€æœ‰class:
import mr.jun.*;

public class Person {
    public void run() {
        Arrays arrays = new Arrays();
    }
}
```

æˆ‘ä»¬ä¸€èˆ¬ä¸æ¨èè¿™ç§å†™æ³•ï¼Œå› ä¸ºåœ¨å¯¼å…¥äº†å¤šä¸ªåŒ…åï¼Œå¾ˆéš¾çœ‹å‡º`Arrays`ç±»å±äºå“ªä¸ªåŒ…ã€‚

è¿˜æœ‰ä¸€ç§`import static`çš„è¯­æ³•ï¼Œå®ƒå¯ä»¥å¯¼å…¥ä¸€ä¸ªç±»çš„é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•ï¼š

```java
package main;

// å¯¼å…¥Systemç±»çš„æ‰€æœ‰é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•:
import static java.lang.System.*;

public class Main {
    public static void main(String[] args) {
        // ç›¸å½“äºè°ƒç”¨System.out.println(â€¦)
        out.println("Hello, world!");
    }
}
```

`import static`å¾ˆå°‘ä½¿ç”¨ã€‚

Java ç¼–è¯‘å™¨æœ€ç»ˆç¼–è¯‘å‡ºçš„`.class`æ–‡ä»¶åªä½¿ç”¨ *å®Œæ•´ç±»å*ï¼Œå› æ­¤ï¼Œåœ¨ä»£ç ä¸­ï¼Œå½“ç¼–è¯‘å™¨é‡åˆ°ä¸€ä¸ª`class`åç§°æ—¶ï¼š

- å¦‚æœæ˜¯å®Œæ•´ç±»åï¼Œå°±ç›´æ¥æ ¹æ®å®Œæ•´ç±»åæŸ¥æ‰¾è¿™ä¸ª`class`ï¼›
- å¦‚æœæ˜¯ç®€å•ç±»åï¼ŒæŒ‰ä¸‹é¢çš„é¡ºåºä¾æ¬¡æŸ¥æ‰¾ï¼š
    - æŸ¥æ‰¾å½“å‰`package`æ˜¯å¦å­˜åœ¨è¿™ä¸ª`class`ï¼›
    - æŸ¥æ‰¾`import`çš„åŒ…æ˜¯å¦åŒ…å«è¿™ä¸ª`class`ï¼›
    - æŸ¥æ‰¾`java.lang`åŒ…æ˜¯å¦åŒ…å«è¿™ä¸ª`class`ã€‚

å¦‚æœæŒ‰ç…§ä¸Šé¢çš„è§„åˆ™è¿˜æ— æ³•ç¡®å®šç±»åï¼Œåˆ™ç¼–è¯‘æŠ¥é”™ã€‚

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š

```java
// Main.java
package test;

import java.text.Format;

public class Main {
    public static void main(String[] args) {
        java.util.List list; // okï¼Œä½¿ç”¨å®Œæ•´ç±»å -> java.util.List
        Format format = null; // okï¼Œä½¿ç”¨importçš„ç±» -> java.text.Format
        String s = "hi"; // okï¼Œä½¿ç”¨java.langåŒ…çš„String -> java.lang.String
        System.out.println(s); // okï¼Œä½¿ç”¨java.langåŒ…çš„System -> java.lang.System
        MessageFormat mf = null; // ç¼–è¯‘é”™è¯¯ï¼šæ— æ³•æ‰¾åˆ°MessageFormat: MessageFormat cannot be resolved to a type
    }
}
```

å› æ­¤ï¼Œç¼–å†™ class çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åšä¸¤ä¸ª import åŠ¨ä½œï¼š

- é»˜è®¤è‡ªåŠ¨`import`å½“å‰`package`çš„å…¶ä»–`class`ï¼›
- é»˜è®¤è‡ªåŠ¨`import java.lang.*`ã€‚


>æ³¨æ„ï¼šè‡ªåŠ¨å¯¼å…¥çš„æ˜¯java.langåŒ…ï¼Œä½†ç±»ä¼¼java.lang.reflectè¿™äº›åŒ…ä»éœ€è¦æ‰‹åŠ¨å¯¼å…¥ã€‚


å¦‚æœæœ‰ä¸¤ä¸ª`class`åç§°ç›¸åŒï¼Œä¾‹å¦‚ï¼Œ`mr.jun.Arrays`å’Œ`java.util.Arrays`ï¼Œé‚£ä¹ˆåªèƒ½`import`å…¶ä¸­ä¸€ä¸ªï¼Œå¦ä¸€ä¸ªå¿…é¡»å†™å®Œæ•´ç±»åã€‚

### åŒ…çš„æœ€ä½³å®è·µ

ä¸ºäº†é¿å…åå­—å†²çªï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šå”¯ä¸€çš„åŒ…åã€‚æ¨èçš„åšæ³•æ˜¯ä½¿ç”¨å€’ç½®çš„åŸŸåæ¥ç¡®ä¿å”¯ä¸€æ€§ã€‚ä¾‹å¦‚ï¼š

- org.apache
- org.apache.commons.log
- com.tobebetterjavaer.sample

å­åŒ…å°±å¯ä»¥æ ¹æ®åŠŸèƒ½è‡ªè¡Œå‘½åã€‚

è¦æ³¨æ„ä¸è¦å’Œ`java.lang`åŒ…çš„ç±»é‡åï¼Œå³è‡ªå·±çš„ç±»ä¸è¦ä½¿ç”¨è¿™äº›åå­—ï¼š

- String
- System
- Runtime
- ...

è¦æ³¨æ„ä¹Ÿä¸è¦å’Œ JDK å¸¸ç”¨ç±»é‡åï¼š

- java.util.List
- java.text.Format
- java.math.BigInteger
- ...


### å°ç»“

Java å†…å»ºçš„`package`æœºåˆ¶æ˜¯ä¸ºäº†é¿å…`class`å‘½åå†²çªï¼›

JDK çš„æ ¸å¿ƒç±»ä½¿ç”¨`java.lang`åŒ…ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¯¼å…¥ï¼›

JDK çš„å…¶å®ƒå¸¸ç”¨ç±»å®šä¹‰åœ¨`java.util.*`ï¼Œ`java.math.*`ï¼Œ`java.text.*`ï¼Œâ€¦â€¦ï¼›

åŒ…åæ¨èä½¿ç”¨å€’ç½®çš„åŸŸåï¼Œä¾‹å¦‚`org.apache`ã€‚

---

> å‚è€ƒé“¾æ¥ï¼š[https://www.liaoxuefeng.com/wiki/1252599548343744/1260467032946976](https://www.liaoxuefeng.com/wiki/1252599548343744/1260467032946976)ï¼Œæ•´ç†ï¼šæ²‰é»˜ç‹äºŒ


----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)




## 5.3 Javaä¸­çš„å˜é‡

â€œäºŒå“¥ï¼Œå¬è¯´ Java å˜é‡åœ¨ä»¥åçš„æ—¥å­é‡Œç»å¸¸ç”¨ï¼Œèƒ½ä¸èƒ½æå‰ç»™æˆ‘é€éœ²é€éœ²ï¼Ÿâ€ä¸‰å¦¹å’ªäº†ä¸€å£éº¦é¦™å¯å¯å¥¶èŒ¶åå¯¹æˆ‘è¯´ã€‚

â€œä¸‰å¦¹å•Šï¼Œæ¬ä¸ªå‡³å­åæˆ‘æ—è¾¹ï¼Œå¬äºŒå“¥æ¥ç»™ä½ æ…¢æ…¢è¯´å•Šã€‚â€

Java å˜é‡å°±å¥½åƒä¸€ä¸ªå®¹å™¨ï¼Œå¯ä»¥ä¿å­˜ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­çš„å€¼ï¼Œå®ƒåœ¨å£°æ˜çš„æ—¶å€™ä¼šå®šä¹‰å¯¹åº”çš„[æ•°æ®ç±»å‹](https://tobebetterjavaer.com/basic-grammar/basic-data-type.html)ï¼ˆJava åˆ†ä¸ºä¸¤ç§æ•°æ®ç±»å‹ï¼šåŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹ï¼‰ã€‚å˜é‡æŒ‰ç…§ä½œç”¨åŸŸçš„èŒƒå›´åˆå¯åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼šå±€éƒ¨å˜é‡ï¼Œæˆå‘˜å˜é‡å’Œé™æ€å˜é‡ã€‚

æ¯”å¦‚è¯´ï¼Œ`int data = 88;`ï¼Œå…¶ä¸­ data å°±æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå®ƒçš„å€¼ä¸º 88ï¼Œç±»å‹ä¸ºæ•´å‹ï¼ˆintï¼‰ã€‚


### 01ã€å±€éƒ¨å˜é‡

åœ¨æ–¹æ³•ä½“å†…å£°æ˜çš„å˜é‡è¢«ç§°ä¸ºå±€éƒ¨å˜é‡ï¼Œè¯¥å˜é‡åªèƒ½åœ¨è¯¥æ–¹æ³•å†…ä½¿ç”¨ï¼Œç±»ä¸­çš„å…¶ä»–æ–¹æ³•å¹¶ä¸çŸ¥é“è¯¥å˜é‡ã€‚æ¥çœ‹ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ï¼š

```java
/**
 * @author å¾®ä¿¡æœã€Œæ²‰é»˜ç‹äºŒã€ï¼Œå›å¤å…³é”®å­— PDF
 */
public class LocalVariable {
    public static void main(String[] args) {
        int a = 10;
        int b = 10;
        int c = a + b;
        System.out.println(c);
    }
}
```

å…¶ä¸­ aã€bã€c å°±æ˜¯å±€éƒ¨å˜é‡ï¼Œå®ƒä»¬åªèƒ½åœ¨å½“å‰è¿™ä¸ª main æ–¹æ³•ä¸­ä½¿ç”¨ã€‚

å£°æ˜å±€éƒ¨å˜é‡æ—¶çš„æ³¨æ„äº‹é¡¹ï¼š

- å±€éƒ¨å˜é‡å£°æ˜åœ¨æ–¹æ³•ã€æ„é€ æ–¹æ³•æˆ–è€…è¯­å¥å—ä¸­ã€‚
- å±€éƒ¨å˜é‡åœ¨æ–¹æ³•ã€æ„é€ æ–¹æ³•ã€æˆ–è€…è¯­å¥å—è¢«æ‰§è¡Œçš„æ—¶å€™åˆ›å»ºï¼Œå½“å®ƒä»¬æ‰§è¡Œå®Œæˆåï¼Œå°†ä¼šè¢«é”€æ¯ã€‚
- è®¿é—®ä¿®é¥°ç¬¦ä¸èƒ½ç”¨äºå±€éƒ¨å˜é‡ã€‚
- å±€éƒ¨å˜é‡åªåœ¨å£°æ˜å®ƒçš„æ–¹æ³•ã€æ„é€ æ–¹æ³•æˆ–è€…è¯­å¥å—ä¸­å¯è§ã€‚
- å±€éƒ¨å˜é‡æ˜¯åœ¨æ ˆä¸Šåˆ†é…çš„ã€‚
- å±€éƒ¨å˜é‡æ²¡æœ‰é»˜è®¤å€¼ï¼Œæ‰€ä»¥å±€éƒ¨å˜é‡è¢«å£°æ˜åï¼Œå¿…é¡»ç»è¿‡åˆå§‹åŒ–ï¼Œæ‰å¯ä»¥ä½¿ç”¨ã€‚

### 02ã€æˆå‘˜å˜é‡

åœ¨ç±»å†…éƒ¨ä½†åœ¨æ–¹æ³•ä½“å¤–å£°æ˜çš„å˜é‡ç§°ä¸ºæˆå‘˜å˜é‡ï¼Œæˆ–è€…å®ä¾‹å˜é‡ï¼Œæˆ–è€…å­—æ®µã€‚ä¹‹æ‰€ä»¥ç§°ä¸ºå®ä¾‹å˜é‡ï¼Œæ˜¯å› ä¸ºè¯¥å˜é‡åªèƒ½é€šè¿‡ç±»çš„å®ä¾‹ï¼ˆå¯¹è±¡ï¼‰æ¥è®¿é—®ã€‚æ¥çœ‹ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ï¼š

```java
/**
 * @author å¾®ä¿¡æœã€Œæ²‰é»˜ç‹äºŒã€ï¼Œå›å¤å…³é”®å­— PDF
 */
public class InstanceVariable {
    int data = 88;
    public static void main(String[] args) {
        InstanceVariable iv = new InstanceVariable();
        System.out.println(iv.data); // 88
    }
}
```

å…¶ä¸­ iv æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å˜é‡ã€‚`new` å…³é”®å­—å¯ä»¥åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹ï¼ˆä¹Ÿç§°ä¸ºå¯¹è±¡ï¼‰ï¼Œé€šè¿‡â€œ=â€æ“ä½œç¬¦èµ‹å€¼ç»™ iv è¿™ä¸ªå˜é‡ï¼Œiv å°±æˆäº†è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œé€šè¿‡ `iv.data` å°±å¯ä»¥è®¿é—®æˆå‘˜å˜é‡äº†ã€‚

å£°æ˜æˆå‘˜å˜é‡æ—¶çš„æ³¨æ„äº‹é¡¹ï¼š

- æˆå‘˜å˜é‡å£°æ˜åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œä½†åœ¨æ–¹æ³•ã€æ„é€ æ–¹æ³•å’Œè¯­å¥å—ä¹‹å¤–ã€‚
- å½“ä¸€ä¸ªå¯¹è±¡è¢«å®ä¾‹åŒ–ä¹‹åï¼Œæ¯ä¸ªæˆå‘˜å˜é‡çš„å€¼å°±è·Ÿç€ç¡®å®šã€‚
- æˆå‘˜å˜é‡åœ¨å¯¹è±¡åˆ›å»ºçš„æ—¶å€™åˆ›å»ºï¼Œåœ¨å¯¹è±¡è¢«é”€æ¯çš„æ—¶å€™é”€æ¯ã€‚
- æˆå‘˜å˜é‡çš„å€¼åº”è¯¥è‡³å°‘è¢«ä¸€ä¸ªæ–¹æ³•ã€æ„é€ æ–¹æ³•æˆ–è€…è¯­å¥å—å¼•ç”¨ï¼Œä½¿å¾—å¤–éƒ¨èƒ½å¤Ÿé€šè¿‡è¿™äº›æ–¹å¼è·å–å®ä¾‹å˜é‡ä¿¡æ¯ã€‚
- æˆå‘˜å˜é‡å¯ä»¥å£°æ˜åœ¨ä½¿ç”¨å‰æˆ–è€…ä½¿ç”¨åã€‚
- è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥ä¿®é¥°æˆå‘˜å˜é‡ã€‚
- æˆå‘˜å˜é‡å¯¹äºç±»ä¸­çš„æ–¹æ³•ã€æ„é€ æ–¹æ³•æˆ–è€…è¯­å¥å—æ˜¯å¯è§çš„ã€‚ä¸€èˆ¬æƒ…å†µä¸‹åº”è¯¥æŠŠæˆå‘˜å˜é‡è®¾ä¸ºç§æœ‰ã€‚é€šè¿‡ä½¿ç”¨è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥ä½¿æˆå‘˜å˜é‡å¯¹å­ç±»å¯è§ï¼›æˆå‘˜å˜é‡å…·æœ‰é»˜è®¤å€¼ã€‚æ•°å€¼å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯ 0ï¼Œå¸ƒå°”å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯ falseï¼Œå¼•ç”¨ç±»å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯ nullã€‚å˜é‡çš„å€¼å¯ä»¥åœ¨å£°æ˜æ—¶æŒ‡å®šï¼Œä¹Ÿå¯ä»¥åœ¨æ„é€ æ–¹æ³•ä¸­æŒ‡å®šã€‚

### 03ã€é™æ€å˜é‡

é€šè¿‡ [static å…³é”®å­—](https://tobebetterjavaer.com/oo/static.html)å£°æ˜çš„å˜é‡è¢«ç§°ä¸ºé™æ€å˜é‡ï¼ˆç±»å˜é‡ï¼‰ï¼Œå®ƒå¯ä»¥ç›´æ¥è¢«ç±»è®¿é—®ï¼Œæ¥çœ‹ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ï¼š

```java
/**
 * @author å¾®ä¿¡æœã€Œæ²‰é»˜ç‹äºŒã€ï¼Œå›å¤å…³é”®å­— PDF
 */
public class StaticVariable {
    static int data = 99;
    public static void main(String[] args) {
        System.out.println(StaticVariable.data); // 99
    }
}
```

å…¶ä¸­ data å°±æ˜¯é™æ€å˜é‡ï¼Œé€šè¿‡`ç±»å.é™æ€å˜é‡`å°±å¯ä»¥è®¿é—®äº†ï¼Œä¸éœ€è¦åˆ›å»ºç±»çš„å®ä¾‹ã€‚

å£°æ˜é™æ€å˜é‡æ—¶çš„æ³¨æ„äº‹é¡¹ï¼š

- é™æ€å˜é‡åœ¨ç±»ä¸­ä»¥ static å…³é”®å­—å£°æ˜ï¼Œä½†å¿…é¡»åœ¨æ–¹æ³•æ„é€ æ–¹æ³•å’Œè¯­å¥å—ä¹‹å¤–ã€‚
- æ— è®ºä¸€ä¸ªç±»åˆ›å»ºäº†å¤šå°‘ä¸ªå¯¹è±¡ï¼Œç±»åªæ‹¥æœ‰é™æ€å˜é‡çš„ä¸€ä»½æ‹·è´ã€‚
- é™æ€å˜é‡é™¤äº†è¢«å£°æ˜ä¸ºå¸¸é‡å¤–å¾ˆå°‘ä½¿ç”¨ã€‚
- é™æ€å˜é‡å‚¨å­˜åœ¨é™æ€å­˜å‚¨åŒºã€‚
- é™æ€å˜é‡åœ¨ç¨‹åºå¼€å§‹æ—¶åˆ›å»ºï¼Œåœ¨ç¨‹åºç»“æŸæ—¶é”€æ¯ã€‚
- ä¸æˆå‘˜å˜é‡å…·æœ‰ç›¸ä¼¼çš„å¯è§æ€§ã€‚ä½†ä¸ºäº†å¯¹ç±»çš„ä½¿ç”¨è€…å¯è§ï¼Œå¤§å¤šæ•°é™æ€å˜é‡å£°æ˜ä¸º public ç±»å‹ã€‚
- é™æ€å˜é‡çš„é»˜è®¤å€¼å’Œå®ä¾‹å˜é‡ç›¸ä¼¼ã€‚
- é™æ€å˜é‡è¿˜å¯ä»¥åœ¨é™æ€è¯­å¥å—ä¸­åˆå§‹åŒ–ã€‚

### 04ã€å¸¸é‡

åœ¨ Java ä¸­ï¼Œæœ‰äº›æ•°æ®çš„å€¼æ˜¯ä¸ä¼šå‘ç”Ÿæ”¹å˜çš„ï¼Œè¿™äº›æ•°æ®è¢«å«åšå¸¸é‡â€”â€”ä½¿ç”¨ [final å…³é”®å­—](https://tobebetterjavaer.com/oo/final.html)ä¿®é¥°çš„æˆå‘˜å˜é‡ã€‚å¸¸é‡çš„å€¼ä¸€æ—¦ç»™å®šå°±æ— æ³•æ”¹å˜ï¼

å¸¸é‡åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ä¸»è¦æœ‰ 2 ä¸ªä½œç”¨ï¼š

- ä»£è¡¨å¸¸æ•°ï¼Œä¾¿äºä¿®æ”¹ï¼ˆä¾‹å¦‚ï¼šåœ†å‘¨ç‡çš„å€¼ï¼Œ`final double PI = 3.14`ï¼‰
- å¢å¼ºç¨‹åºçš„å¯è¯»æ€§ï¼ˆä¾‹å¦‚ï¼šå¸¸é‡ UPã€DOWN ç”¨æ¥ä»£è¡¨ä¸Šå’Œä¸‹ï¼Œ`final int UP = 0`ï¼‰

Java è¦æ±‚å¸¸é‡åå¿…é¡»å¤§å†™ã€‚æ¥çœ‹ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ï¼š

```java
/**
 * @author å¾®ä¿¡æœã€Œæ²‰é»˜ç‹äºŒã€ï¼Œå›å¤å…³é”®å­— PDF
 */
public class FinalVariable {
    final String CHEN = "æ²‰";
    static final String MO = "é»˜";
    public static void main(String[] args) {
        FinalVariable fv = new FinalVariable();
        System.out.println(fv.CHEN);
        System.out.println(MO);
    }
}
```

â€œå¥½äº†ï¼Œä¸‰å¦¹ï¼Œå…³äº Java å˜é‡å°±å…ˆè¯´è¿™ä¹ˆå¤šå§ï¼Œä½ æ˜¯ä¸æ˜¯å·²ç»æ¸…æ¥šäº†ï¼Ÿâ€è½¬åŠ¨äº†ä¸€ä¸‹åƒµç¡¬çš„è„–å­åï¼Œæˆ‘å¯¹ä¸‰å¦¹è¯´ã€‚

â€œæ˜¯å•Šï¼ŒäºŒå“¥ï¼Œæˆ‘æƒ³ä»¥åè¿˜ä¼šå†è§åˆ°å®ƒä»¬å§ï¼Ÿâ€

â€œé‚£è§çš„æ¬¡æ•°å¯å°±å¤šäº†ï¼Œå°±å¥½åƒä½ æ¯å¤©çœ¨çœ¼çš„æ¬¡æ•°ä¸€æ ·å¤šã€‚â€


----


GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 5.4 Javaä¸­çš„æ–¹æ³•

â€œäºŒå“¥ï¼Œè¿™ä¸€èŠ‚æˆ‘ä»¬å­¦ä»€ä¹ˆå‘¢ï¼Ÿâ€ä¸‰å¦¹æ»¡æ˜¯æœŸå¾…çš„é—®æˆ‘ã€‚

â€œè¿™ä¸€èŠ‚æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ Java ä¸­çš„æ–¹æ³•â€”â€”ä»€ä¹ˆæ˜¯æ–¹æ³•ï¼Ÿå¦‚ä½•å£°æ˜æ–¹æ³•ï¼Ÿæ–¹æ³•æœ‰å“ªå‡ ç§ï¼Ÿä»€ä¹ˆæ˜¯å®ä¾‹æ–¹æ³•ï¼Ÿä»€ä¹ˆæ˜¯é™æ€æ–¹æ³•ï¼Ÿä»€ä¹ˆæ˜¯æŠ½è±¡æ–¹æ³•ï¼Ÿä»€ä¹ˆæ˜¯æœ¬åœ°æ–¹æ³•ï¼Ÿâ€æˆ‘ç¬‘ç€å¯¹ä¸‰å¦¹è¯´ï¼Œâ€œæˆ‘å¼€å§‹äº†å•Šï¼Œä½ è¦æ³¨æ„åŠ›é›†ä¸­å•Šã€‚â€

### 01ã€Javaä¸­çš„æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Ÿ

æ–¹æ³•ç”¨æ¥å®ç°ä»£ç çš„å¯é‡ç”¨æ€§ï¼Œæˆ‘ä»¬ç¼–å†™ä¸€æ¬¡æ–¹æ³•ï¼Œå¹¶å¤šæ¬¡ä½¿ç”¨å®ƒã€‚é€šè¿‡å¢åŠ æˆ–è€…åˆ é™¤æ–¹æ³•ä¸­çš„ä¸€éƒ¨åˆ†ä»£ç ï¼Œå°±å¯ä»¥æé«˜æ•´ä½“ä»£ç çš„å¯è¯»æ€§ã€‚

åªæœ‰æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå®ƒæ‰ä¼šæ‰§è¡Œã€‚Java ä¸­æœ€æœ‰åçš„æ–¹æ³•å½“å± `main()` æ–¹æ³•ï¼Œè¿™æ˜¯ç¨‹åºçš„å…¥å£ã€‚

### 02ã€å¦‚ä½•å£°æ˜æ–¹æ³•ï¼Ÿ

æ–¹æ³•çš„å£°æ˜åæ˜ äº†æ–¹æ³•çš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚è¯´å¯è§æ€§ã€è¿”å›ç±»å‹ã€æ–¹æ³•åå’Œå‚æ•°ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/object-class/17-01.png)

**è®¿é—®æƒé™**ï¼šå®ƒæŒ‡å®šäº†æ–¹æ³•çš„å¯è§æ€§ã€‚Java æä¾›äº†å››ç§[è®¿é—®æƒé™ä¿®é¥°ç¬¦](https://tobebetterjavaer.com/oo/access-control.html)ï¼š

- publicï¼šè¯¥æ–¹æ³•å¯ä»¥è¢«æ‰€æœ‰ç±»è®¿é—®ã€‚
- privateï¼šè¯¥æ–¹æ³•åªèƒ½åœ¨å®šä¹‰å®ƒçš„ç±»ä¸­è®¿é—®ã€‚
- protectedï¼šè¯¥æ–¹æ³•å¯ä»¥è¢«åŒä¸€ä¸ªåŒ…ä¸­çš„ç±»ï¼Œæˆ–è€…ä¸åŒåŒ…ä¸­çš„å­ç±»è®¿é—®ã€‚
- defaultï¼šå¦‚æœä¸€ä¸ªæ–¹æ³•æ²¡æœ‰ä½¿ç”¨ä»»ä½•è®¿é—®æƒé™ä¿®é¥°ç¬¦ï¼Œé‚£ä¹ˆå®ƒæ˜¯ package-private çš„ï¼Œæ„å‘³ç€è¯¥æ–¹æ³•åªèƒ½è¢«åŒä¸€ä¸ªåŒ…ä¸­çš„ç±»å¯è§ã€‚

**è¿”å›ç±»å‹**ï¼šæ–¹æ³•è¿”å›çš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡å’Œé›†åˆï¼Œå¦‚æœä¸éœ€è¦è¿”å›æ•°æ®ï¼Œåˆ™ä½¿ç”¨ void å…³é”®å­—ã€‚

**æ–¹æ³•å**ï¼šæ–¹æ³•åæœ€å¥½ååº”å‡ºæ–¹æ³•çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªå°†ä¸¤ä¸ªæ•°å­—ç›¸å‡çš„æ–¹æ³•ï¼Œé‚£ä¹ˆæ–¹æ³•åæœ€å¥½æ˜¯ subtractã€‚

æ–¹æ³•åæœ€å¥½æ˜¯ä¸€ä¸ªåŠ¨è¯ï¼Œå¹¶ä¸”ä»¥å°å†™å­—æ¯å¼€å¤´ã€‚å¦‚æœæ–¹æ³•ååŒ…å«ä¸¤ä¸ªä»¥ä¸Šå•è¯ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå•è¯æœ€å¥½æ˜¯åŠ¨è¯ï¼Œç„¶åæ˜¯å½¢å®¹è¯æˆ–è€…åè¯ï¼Œå¹¶ä¸”è¦ä»¥é©¼å³°å¼çš„å‘½åæ–¹å¼å‘½åã€‚æ¯”å¦‚ï¼š

- ä¸€ä¸ªå•è¯çš„æ–¹æ³•åï¼š`sum()`
- å¤šä¸ªå•è¯çš„æ–¹æ³•åï¼š`stringComparision()`

ä¸€ä¸ªæ–¹æ³•å¯èƒ½ä¸åŒä¸€ä¸ªç±»ä¸­çš„å¦å¤–ä¸€ä¸ªæ–¹æ³•åŒåï¼Œè¿™è¢«ç§°ä¸ºæ–¹æ³•é‡è½½ã€‚

**å‚æ•°**ï¼šå‚æ•°è¢«æ”¾åœ¨ä¸€ä¸ªåœ†æ‹¬å·å†…ï¼Œå¦‚æœæœ‰å¤šä¸ªå‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨é€—å·éš”å¼€ã€‚å‚æ•°åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå‚æ•°ç±»å‹å’Œå‚æ•°åã€‚å¦‚æœæ–¹æ³•æ²¡æœ‰å‚æ•°ï¼Œåœ†æ‹¬å·æ˜¯ç©ºçš„ã€‚

**æ–¹æ³•ç­¾å**ï¼šæ¯ä¸€ä¸ªæ–¹æ³•éƒ½æœ‰ä¸€ä¸ªç­¾åï¼ŒåŒ…æ‹¬æ–¹æ³•åå’Œå‚æ•°ã€‚

**æ–¹æ³•ä½“**ï¼šæ–¹æ³•ä½“æ”¾åœ¨ä¸€å¯¹èŠ±æ‹¬å·å†…ï¼ŒæŠŠä¸€äº›ä»£ç æ”¾åœ¨ä¸€èµ·ï¼Œç”¨æ¥æ‰§è¡Œç‰¹å®šçš„ä»»åŠ¡ã€‚

### 03ã€æ–¹æ³•æœ‰å“ªå‡ ç§ï¼Ÿ

æ–¹æ³•å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§å«æ ‡å‡†ç±»åº“æ–¹æ³•ï¼Œä¸€ç§å«ç”¨æˆ·è‡ªå®šä¹‰æ–¹æ³•ã€‚

#### **1ï¼‰é¢„å…ˆå®šä¹‰æ–¹æ³•**

Java æä¾›äº†å¤§é‡é¢„å…ˆå®šä¹‰å¥½çš„æ–¹æ³•ä¾›æˆ‘ä»¬è°ƒç”¨ï¼Œä¹Ÿç§°ä¸ºæ ‡å‡†ç±»åº“æ–¹æ³•ï¼Œæˆ–è€…å†…ç½®æ–¹æ³•ã€‚æ¯”å¦‚è¯´ String ç±»çš„ `length()`ã€`equals()`ã€`compare()` æ–¹æ³•ï¼Œä»¥åŠæˆ‘ä»¬åœ¨åˆå­¦ Java é˜¶æ®µæœ€å¸¸ç”¨çš„ `println()` æ–¹æ³•ï¼Œç”¨æ¥åœ¨æ§åˆ¶å°æ‰“å°ä¿¡æ¯ã€‚

```java
/**
 * @author å¾®ä¿¡æœã€Œæ²‰é»˜ç‹äºŒã€ï¼Œå›å¤å…³é”®å­— PDF
 */
public class PredefinedMethodDemo {
    public static void main(String[] args) {
        System.out.println("æ²‰é»˜ç‹äºŒï¼Œä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜");
    }
}
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸¤ä¸ªé¢„å…ˆå®šä¹‰çš„æ–¹æ³•ï¼Œ`main()` æ–¹æ³•æ˜¯ç¨‹åºè¿è¡Œçš„å…¥å£ï¼Œ`println()` æ–¹æ³•æ˜¯ `PrintStream` ç±»çš„ä¸€ä¸ªæ–¹æ³•ã€‚è¿™äº›æ–¹æ³•å·²ç»æå‰å®šä¹‰å¥½äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒä»¬ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡é›†æˆå¼€å‘å·¥å…·æŸ¥çœ‹é¢„å…ˆå®šä¹‰æ–¹æ³•çš„æ–¹æ³•ç­¾åï¼Œå½“æˆ‘ä»¬æŠŠé¼ æ ‡åœç•™åœ¨ `println()` æ–¹æ³•ä¸Šé¢æ—¶ï¼Œå°±ä¼šæ˜¾ç¤ºä¸‹å›¾ä¸­çš„å†…å®¹ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/object-class/17-02.png)

`println()` æ–¹æ³•çš„è®¿é—®æƒé™ä¿®é¥°ç¬¦æ˜¯ publicï¼Œè¿”å›ç±»å‹ä¸º voidï¼Œæ–¹æ³•åä¸º printlnï¼Œå‚æ•°ä¸º `String x`ï¼Œä»¥åŠ Javadocï¼ˆæ–¹æ³•æ˜¯å¹²å˜›çš„ï¼‰ã€‚

é¢„å…ˆå®šä¹‰æ–¹æ³•è®©ç¼–ç¨‹å˜å¾—ç®€å•äº†èµ·æ¥ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å®ç°æŸäº›åŠŸèƒ½çš„æ—¶å€™ç›´æ¥è°ƒç”¨è¿™äº›æ–¹æ³•å³å¯ï¼Œä¸éœ€è¦é‡æ–°ç¼–å†™ã€‚

Java çš„ä¸€ä¸ªéå¸¸å¤§çš„ä¼˜åŠ¿ï¼Œå°±æ˜¯ï¼ŒJDK çš„è®¾è®¡è€…ï¼ˆå¼€å‘è€…ï¼‰ä¸ºæˆ‘ä»¬æä¾›äº†å¤§é‡çš„æ ‡å‡†ç±»åº“æ–¹æ³•ï¼Œè¿™å¯¹äºåˆå­¦ç¼–ç¨‹çš„æ–°æ‰‹æ¥è¯´æå…¶å‹å¥½ï¼›ä¸ä»…å¦‚æ­¤ï¼ŒGitHub/ç äº‘ä¸Šä¹Ÿæœ‰å¤§é‡å¯ä»¥ç›´æ¥æ‹¿åˆ°ç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹ç±»åº“ï¼Œæ¯”å¦‚è¯´ hutool å•Šã€Apache åŒ…å•Šã€ä¸€çº¿å¤§å‚æˆ–è€…é¡¶çº§å¼€å‘å¤§ä½¬è´¡çŒ®çš„ç±»åº“ï¼Œæ¯”å¦‚è¯´ Druidã€Gson ç­‰ç­‰ã€‚

ä½†å¦‚æœä½ æƒ³ä»ä¸€ä¸ªåˆçº§å¼€å‘è€…ï¼ˆä¿—ç§°è°ƒåŒ…ä¾ ï¼‰æ™‹å‡ä¸ºä¸€åä¼˜ç§€çš„ Java å·¥ç¨‹å¸ˆï¼Œé‚£å°±éœ€è¦æ·±å…¥ç ”ç©¶è¿™äº›æºç ï¼Œå¹¶æŒæ¡ï¼Œæœ€å¥½æ˜¯èƒ½è‡ªå·±å†™å‡ºæ¥è¿™äº›æºç ï¼Œæœ€èµ·ç èƒ½è‡ªå®šä¹‰ä¸€äº›æºç ï¼Œä»¥ä¾¿ä¸ºæˆ‘ä»¬æ‰€ç”¨ã€‚

#### **2ï¼‰ç”¨æˆ·è‡ªå®šä¹‰æ–¹æ³•**

å½“é¢„å…ˆå®šä¹‰æ–¹æ³•æ— æ³•æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚æ—¶ï¼Œå°±éœ€è¦è‡ªå®šä¹‰ä¸€äº›æ–¹æ³•ï¼Œæ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬æ¥å®šä¹‰è¿™æ ·ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥æ£€æŸ¥æ•°å­—æ˜¯å¶æ•°è¿˜æ˜¯å¥‡æ•°ã€‚

```java
public static void findEvenOdd(int num) {
    if (num % 2 == 0) {
        System.out.println(num + " æ˜¯å¶æ•°");
    } else {
        System.out.println(num + " æ˜¯å¥‡æ•°");
    }
}
```

æ–¹æ³•åå«åš `findEvenOdd`ï¼Œè®¿é—®æƒé™ä¿®é¥°ç¬¦æ˜¯ publicï¼Œå¹¶ä¸”æ˜¯é™æ€çš„ï¼ˆstaticï¼‰ï¼Œè¿”å›ç±»å‹æ˜¯ voidï¼Œå‚æ•°æœ‰ä¸€ä¸ªæ•´å‹ï¼ˆintï¼‰çš„ numã€‚æ–¹æ³•ä½“ä¸­æœ‰ä¸€ä¸ª if else è¯­å¥ï¼Œå¦‚æœ num å¯ä»¥è¢« 2 æ•´é™¤ï¼Œé‚£ä¹ˆå°±æ‰“å°è¿™ä¸ªæ•°å­—æ˜¯å¶æ•°ï¼Œå¦åˆ™å°±æ‰“å°è¿™ä¸ªæ•°å­—æ˜¯å¥‡æ•°ã€‚

æ–¹æ³•è¢«å®šä¹‰å¥½åï¼Œå¦‚ä½•è¢«è°ƒç”¨å‘¢ï¼Ÿ

```java
/**
 * @author å¾®ä¿¡æœã€Œæ²‰é»˜ç‹äºŒã€ï¼Œå›å¤å…³é”®å­— PDF
 */
public class EvenOddDemo {
    public static void main(String[] args) {
        findEvenOdd(10);
        findEvenOdd(11);
    }

    public static void findEvenOdd(int num) {
        if (num % 2 == 0) {
            System.out.println(num + " æ˜¯å¶æ•°");
        } else {
            System.out.println(num + " æ˜¯å¥‡æ•°");
        }
    }
}
```

`main()` æ–¹æ³•æ˜¯ç¨‹åºçš„å…¥å£ï¼Œå¹¶ä¸”æ˜¯é™æ€çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥è°ƒç”¨åŒæ ·æ˜¯é™æ€æ–¹æ³•çš„ `findEvenOdd()`ã€‚

å½“ä¸€ä¸ªæ–¹æ³•è¢« static å…³é”®å­—ä¿®é¥°æ—¶ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ã€‚æ¢å¥è¯è¯´ï¼Œé™æ€æ–¹æ³•æ˜¯å±äºç±»çš„ï¼Œä¸å±äºç±»å®ä¾‹çš„ï¼ˆä¸éœ€è¦é€šè¿‡ new å…³é”®å­—åˆ›å»ºå¯¹è±¡æ¥è°ƒç”¨ï¼Œç›´æ¥é€šè¿‡ç±»åå°±å¯ä»¥è°ƒç”¨ï¼‰ã€‚

### 04ã€ä»€ä¹ˆæ˜¯å®ä¾‹æ–¹æ³•ï¼Ÿ

æ²¡æœ‰ä½¿ç”¨ [static å…³é”®å­—](https://tobebetterjavaer.com/oo/static.html)ä¿®é¥°ï¼Œä½†åœ¨ç±»ä¸­å£°æ˜çš„æ–¹æ³•è¢«ç§°ä¸ºå®ä¾‹æ–¹æ³•ï¼Œåœ¨è°ƒç”¨å®ä¾‹æ–¹æ³•ä¹‹å‰ï¼Œå¿…é¡»åˆ›å»ºç±»çš„å¯¹è±¡ã€‚

```java
/**
 * @author å¾®ä¿¡æœã€Œæ²‰é»˜ç‹äºŒã€ï¼Œå›å¤å…³é”®å­— PDF
 */
public class InstanceMethodExample {
    public static void main(String[] args) {
        InstanceMethodExample instanceMethodExample = new InstanceMethodExample();
        System.out.println(instanceMethodExample.add(1, 2));
    }

    public int add(int a, int b) {
        return a + b;
    }
}
```

`add()` æ–¹æ³•æ˜¯ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œéœ€è¦åˆ›å»º InstanceMethodExample å¯¹è±¡æ¥è®¿é—®ã€‚

å®ä¾‹æ–¹æ³•æœ‰ä¸¤ç§ç‰¹æ®Šç±»å‹ï¼š

- getter æ–¹æ³•
- setter æ–¹æ³•

getter æ–¹æ³•ç”¨æ¥è·å–ç§æœ‰å˜é‡ï¼ˆprivate ä¿®é¥°çš„å­—æ®µï¼‰çš„å€¼ï¼Œsetter æ–¹æ³•ç”¨æ¥è®¾ç½®ç§æœ‰å˜é‡çš„å€¼ã€‚

```java
/**
 * @author æ²‰é»˜ç‹äºŒï¼Œä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜
 */
public class Person {
    private String name;
    private int age;
    private int sex;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }

    public int getSex() {
        return sex;
    }

    public void setSex(int sex) {
        this.sex = sex;
    }
}
```

getter æ–¹æ³•ä»¥ get å¼€å¤´ï¼Œsetter æ–¹æ³•ä»¥ set å¼€å¤´ã€‚

### 05ã€ä»€ä¹ˆæ˜¯é™æ€æ–¹æ³•ï¼Ÿ

ç›¸åº”çš„ï¼Œæœ‰ [static å…³é”®å­—](https://tobebetterjavaer.com/oo/static.html)ä¿®é¥°çš„æ–¹æ³•å°±å«åšé™æ€æ–¹æ³•ã€‚

```java
/**
 * å¾®ä¿¡æœç´¢ã€Œæ²‰é»˜ç‹äºŒã€ï¼Œå›å¤ Java
 *
 * @author æ²‰é»˜ç‹äºŒ
 * @date 8/9/22
 */
public class StaticMethodExample {
    public static void main(String[] args) {
        System.out.println(add(1,2));
    }

    public static int add(int a, int b) {
        return a + b;
    }
}
```

StaticMethodExample ç±»ä¸­ï¼Œmian å’Œ add æ–¹æ³•éƒ½æ˜¯é™æ€æ–¹æ³•ï¼Œä¸åŒçš„æ˜¯ï¼Œmain æ–¹æ³•æ˜¯ç¨‹åºçš„å…¥å£ã€‚å½“æˆ‘ä»¬è°ƒç”¨é™æ€æ–¹æ³•çš„æ—¶å€™ï¼Œå°±ä¸éœ€è¦ new å‡ºæ¥ç±»çš„å¯¹è±¡ï¼Œå°±å¯ä»¥ç›´æ¥è°ƒç”¨é™æ€æ–¹æ³•äº†ï¼Œä¸€äº›å·¥å…·ç±»çš„æ–¹æ³•éƒ½æ˜¯é™æ€æ–¹æ³•ï¼Œæ¯”å¦‚è¯´ hutool å·¥å…·ç±»åº“ï¼Œé‡Œé¢æœ‰å¤§é‡çš„é™æ€æ–¹æ³•å¯ä»¥ç›´æ¥è°ƒç”¨ã€‚

> Hutool çš„ç›®æ ‡æ˜¯ä½¿ç”¨ä¸€ä¸ªå·¥å…·æ–¹æ³•ä»£æ›¿ä¸€æ®µå¤æ‚ä»£ç ï¼Œä»è€Œæœ€å¤§é™åº¦çš„é¿å…â€œå¤åˆ¶ç²˜è´´â€ä»£ç çš„é—®é¢˜ï¼Œå½»åº•æ”¹å˜æˆ‘ä»¬å†™ä»£ç çš„æ–¹å¼ã€‚

ä»¥è®¡ç®— MD5 ä¸ºä¾‹ï¼š

- ğŸ‘´ã€ä»¥å‰ã€‘æ‰“å¼€æœç´¢å¼•æ“ -> æœâ€œJava MD5 åŠ å¯†â€ -> æ‰“å¼€æŸç¯‡åšå®¢-> å¤åˆ¶ç²˜è´´ -> æ”¹æ”¹å¥½ç”¨
- ğŸ‘¦ã€ç°åœ¨ã€‘å¼•å…¥ Hutool -> SecureUtil.md5()

Hutool çš„å­˜åœ¨å°±æ˜¯ä¸ºäº†å‡å°‘ä»£ç æœç´¢æˆæœ¬ï¼Œé¿å…ç½‘ç»œä¸Šå‚å·®ä¸é½çš„ä»£ç å‡ºç°å¯¼è‡´çš„ bugã€‚

### 06ã€ä»€ä¹ˆæ˜¯æŠ½è±¡æ–¹æ³•ï¼Ÿ

æ²¡æœ‰æ–¹æ³•ä½“çš„æ–¹æ³•è¢«ç§°ä¸ºæŠ½è±¡æ–¹æ³•ï¼Œå®ƒæ€»æ˜¯åœ¨[æŠ½è±¡ç±»](https://tobebetterjavaer.com/oo/abstract.html)ä¸­å£°æ˜ã€‚è¿™æ„å‘³ç€å¦‚æœç±»æœ‰æŠ½è±¡æ–¹æ³•çš„è¯ï¼Œè¿™ä¸ªç±»å°±å¿…é¡»æ˜¯æŠ½è±¡çš„ã€‚å¯ä»¥ä½¿ç”¨ atstract å…³é”®å­—åˆ›å»ºæŠ½è±¡æ–¹æ³•å’ŒæŠ½è±¡ç±»ã€‚

```java
/**
 * @author å¾®ä¿¡æœã€Œæ²‰é»˜ç‹äºŒã€ï¼Œå›å¤å…³é”®å­— PDF
 */
abstract class AbstractDemo {
    abstract void display();
}
```

å½“ä¸€ä¸ªç±»ç»§æ‰¿äº†æŠ½è±¡ç±»åï¼Œå°±å¿…é¡»é‡å†™æŠ½è±¡æ–¹æ³•ï¼š

```java
/**
 * @author å¾®ä¿¡æœã€Œæ²‰é»˜ç‹äºŒã€ï¼Œå›å¤å…³é”®å­— PDF
 */
public class MyAbstractDemo extends AbstractDemo {
    @Override
    void display() {
        System.out.println("é‡å†™äº†æŠ½è±¡æ–¹æ³•");
    }

    public static void main(String[] args) {
        MyAbstractDemo myAbstractDemo = new MyAbstractDemo();
        myAbstractDemo.display();
    }
}
```

è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
é‡å†™äº†æŠ½è±¡æ–¹æ³•
```

â€œå…³äºæ–¹æ³•ï¼Œæˆ‘ä»¬å°±è®²åˆ°è¿™é‡Œå§ï¼Œå­¦ä¼šäº†ç±»/å˜é‡/æ–¹æ³•ï¼ŒåŸºæœ¬ä¸Šå°±å¯ä»¥åšä¸€ä¸ªå…¥é—¨çº§çš„ Java ç¨‹åºå‘˜äº†ã€‚â€æˆ‘é¢éœ²å¾®ç¬‘ï¼Œç»§ç»­å¯¹ä¸‰å¦¹è¯´ï¼Œâ€œç»§ç»­åŠ æ²¹å§ï¼â€

â€œå¥½çš„ï¼Œè°¢è°¢äºŒå“¥ä½ çš„ç»†å¿ƒå¸®åŠ©ã€‚â€

---

æœ€è¿‘æ•´ç†äº†ä¸€ä»½ç‰›é€¼çš„å­¦ä¹ èµ„æ–™ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº Java åŸºç¡€éƒ¨åˆ†ï¼ˆJVMã€Java é›†åˆæ¡†æ¶ã€å¤šçº¿ç¨‹ï¼‰ï¼Œè¿˜å›Šæ‹¬äº† **æ•°æ®åº“ã€è®¡ç®—æœºç½‘ç»œã€ç®—æ³•ä¸æ•°æ®ç»“æ„ã€è®¾è®¡æ¨¡å¼ã€æ¡†æ¶ç±» Springã€Nettyã€å¾®æœåŠ¡ï¼ˆDubboï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ ç½‘å…³** ç­‰ç­‰ç­‰ç­‰â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¯ä»¥è¯´æ˜¯ 2022 å¹´å…¨ç½‘æœ€å…¨çš„å­¦ä¹ å’Œæ‰¾å·¥ä½œçš„ PDF èµ„æºäº†](https://tobebetterjavaer.com/pdf/programmer-111.html)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 5.5 Javaå¯å˜å‚æ•°

ä¸ºäº†è®©é“ç²‰ä»¬èƒ½ç™½ç¥¨åˆ°é˜¿é‡Œäº‘çš„æœåŠ¡å™¨ï¼Œæˆ‘å½“äº†æ•´æ•´ä¸¤å¤©çš„å®¢æœï¼ŒçœŸæ­£ä½“éªŒåˆ°äº†ä»€ä¹ˆå«åšâ€œä¸ºäººæ°‘ç¾¤ä¼—è°‹ç¦åˆ©â€çš„ä¸æ˜“å’Œè¾›é…¸ã€‚æ­£åœ¨æˆ‘çœ¼ç›çº¢è‚¿æ‰“ç®—è¦ä¼‘æ¯ä¹‹é™…ï¼Œä¸‰å¦¹è·‘è¿‡æ¥é—®ï¼šâ€œJava çš„å¯å˜å‚æ•°ç©¶ç«Ÿæ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Ÿâ€æˆ‘ä¸€ä¸‹å­åˆæ¸…é†’äº†ï¼Œæˆ‘çˆ± Javaï¼Œæˆ‘çˆ±ä¼ é“è§£æƒ‘ï¼Œä¹Ÿäº«å—ä¸‰å¦¹çš„èµè®¸ï¼ˆğŸ˜‚ï¼‰ã€‚

å¯å˜å‚æ•°æ˜¯ Java 1.5 çš„æ—¶å€™å¼•å…¥çš„åŠŸèƒ½ï¼Œå®ƒå…è®¸æ–¹æ³•ä½¿ç”¨ä»»æ„å¤šä¸ªã€ç±»å‹ç›¸åŒï¼ˆ`is-a`ï¼‰çš„å€¼ä½œä¸ºå‚æ•°ã€‚å°±åƒä¸‹é¢è¿™æ ·ã€‚

```java
public static void main(String[] args) {
    print("æ²‰");
    print("æ²‰", "é»˜");
    print("æ²‰", "é»˜", "ç‹");
    print("æ²‰", "é»˜", "ç‹", "äºŒ");
}

public static void print(String... strs) {
    for (String s : strs)
        System.out.print(s);
    System.out.println();
}
```

é™æ€æ–¹æ³• `print()` å°±ä½¿ç”¨äº†å¯å˜å‚æ•°ï¼Œæ‰€ä»¥ `print("æ²‰")` å¯ä»¥ï¼Œ`print("æ²‰", "é»˜")` ä¹Ÿå¯ä»¥ï¼Œç”šè‡³ 3 ä¸ªã€ 4 ä¸ªæˆ–è€…æ›´å¤šä¸ªå­—ç¬¦ä¸²éƒ½å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™ `print()` æ–¹æ³•ã€‚

è¯´åˆ°å¯å˜å‚æ•°ï¼Œæˆ‘æƒ³èµ·æ¥[é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œ](https://tobebetterjavaer.com/pdf/ali-java-shouce.html)ä¸Šæœ‰è¿™æ ·ä¸€æ¡è§„çº¦ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/basic-extra-meal/varables-01.png)

æ„æ€å°±æ˜¯å°½é‡ä¸è¦ä½¿ç”¨å¯å˜å‚æ•°ï¼Œå¦‚æœè¦ç”¨çš„è¯ï¼Œå¯å˜å‚æ•°å¿…é¡»è¦åœ¨å‚æ•°åˆ—è¡¨çš„æœ€åä¸€ä½ã€‚æ—¢ç„¶å‘ä½æœ‰é™ï¼Œåªèƒ½åœ¨æœ€åï¼Œé‚£ä¹ˆå¯å˜å‚æ•°å°±åªèƒ½æœ‰ä¸€ä¸ªï¼ˆæ‚ ç€ç‚¹ï¼Œæ‚ ç€ç‚¹ï¼‰ã€‚å¦‚æœå¯å˜å‚æ•°ä¸åœ¨æœ€åä¸€ä½ï¼ŒIDE å°±ä¼šæç¤ºå¯¹åº”çš„é”™è¯¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/basic-extra-meal/varables-02.png)

å¯å˜å‚æ•°çœ‹èµ·æ¥å°±åƒæ˜¯ä¸ªè¯­æ³•ç³–ï¼Œå®ƒèƒŒåç©¶ç«Ÿéšè—äº†ä»€ä¹ˆå‘¢ï¼Ÿè®©æˆ‘ä»¬æ¥ä¸€æ¢ç©¶ç«Ÿï¼Œåœ¨è¿½æ±‚çœŸç†è¿™æ¡è·¯ä¸Šæˆ‘ä»¬è¦æ‰§ç€ã€‚

å…¶å®ä¹Ÿå¾ˆç®€å•ã€‚**å½“ä½¿ç”¨å¯å˜å‚æ•°çš„æ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯å…ˆåˆ›å»ºäº†ä¸€ä¸ªæ•°ç»„ï¼Œè¯¥æ•°ç»„çš„å¤§å°å°±æ˜¯å¯å˜å‚æ•°çš„ä¸ªæ•°ï¼Œç„¶åå°†å‚æ•°æ”¾å…¥æ•°ç»„å½“ä¸­ï¼Œå†å°†æ•°ç»„ä¼ é€’ç»™è¢«è°ƒç”¨çš„æ–¹æ³•**ã€‚

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¯ä»¥ä½¿ç”¨æ•°ç»„ä½œä¸ºå‚æ•°æ¥è°ƒç”¨å¸¦æœ‰å¯å˜å‚æ•°çš„æ–¹æ³•çš„æ ¹æœ¬åŸå› ã€‚ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚

```java
public static void main(String[] args) {
    print(new String[]{"æ²‰"});
    print(new String[]{"æ²‰", "é»˜"});
    print(new String[]{"æ²‰", "é»˜", "ç‹"});
    print(new String[]{"æ²‰", "é»˜", "ç‹", "äºŒ"});
}

public static void print(String... strs) {
    for (String s : strs)
        System.out.print(s);
    System.out.println();
}
```

é‚£å¦‚æœæ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç„¶ååƒä½¿ç”¨å¯å˜å‚æ•°é‚£æ ·å»è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œèƒ½è¡Œå¾—é€šå—ï¼Ÿ

â€œä¸‰å¦¹ï¼Œç»™ä½ ç•™ä¸ªæ€è€ƒé¢˜ï¼šä¸€èˆ¬ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å¯å˜å‚æ•°å‘¢ï¼Ÿâ€

å¯å˜å‚æ•°ï¼Œå¯å˜å‚æ•°ï¼Œé¡¾åæ€ä¹‰ï¼Œå½“ä¸€ä¸ªæ–¹æ³•éœ€è¦å¤„ç†ä»»æ„å¤šä¸ªç›¸åŒç±»å‹çš„å¯¹è±¡æ—¶ï¼Œå°±å¯ä»¥å®šä¹‰å¯å˜å‚æ•°ã€‚Java ä¸­æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œå°±æ˜¯ String ç±»çš„ `format()` æ–¹æ³•ï¼Œå°±åƒä¸‹é¢è¿™æ ·ã€‚

```java
System.out.println(String.format("å¹´çºªæ˜¯: %d", 18));
System.out.println(String.format("å¹´çºªæ˜¯: %d åå­—æ˜¯: %s", 18, "æ²‰é»˜ç‹äºŒ"));
```

`%d` è¡¨ç¤ºå°†æ•´æ•°æ ¼å¼åŒ–ä¸º 10 è¿›åˆ¶æ•´æ•°ï¼Œ`%s` è¡¨ç¤ºè¾“å‡ºå­—ç¬¦ä¸²ã€‚

å¦‚æœä¸ä½¿ç”¨å¯å˜å‚æ•°ï¼Œé‚£éœ€è¦æ ¼å¼åŒ–çš„å‚æ•°å°±å¿…é¡»ä½¿ç”¨â€œ+â€å·æ“ä½œç¬¦æ‹¼æ¥èµ·æ¥äº†ã€‚éº»çƒ¦ä¹Ÿå°±æƒ¹ä¸Šèº«äº†ã€‚

åœ¨å®é™…çš„é¡¹ç›®ä»£ç ä¸­ï¼Œ[slf4j](https://tobebetterjavaer.com/gongju/slf4j.html) çš„æ—¥å¿—è¾“å‡ºå°±ç»å¸¸è¦ç”¨åˆ°å¯å˜å‚æ•°ï¼ˆ[log4j](https://tobebetterjavaer.com/gongju/log4j.html) å°±æ²¡æ³•ä½¿ç”¨å¯å˜å‚æ•°ï¼Œæ—¥å¿—ä¸­éœ€è¦è®°å½•å¤šä¸ªå‚æ•°æ—¶å°±ç—›è‹¦ä¸å ªäº†ï¼‰ã€‚å°±åƒä¸‹é¢è¿™æ ·ã€‚

```java
protected Logger logger = LoggerFactory.getLogger(getClass());
logger.debug("åå­—æ˜¯{}", mem.getName());
logger.debug("åå­—æ˜¯{}ï¼Œå¹´çºªæ˜¯{}", mem.getName(), mem.getAge());
```

æŸ¥çœ‹æºç å°±å¯ä»¥å‘ç°ï¼Œ`debug()` æ–¹æ³•ä½¿ç”¨äº†å¯å˜å‚æ•°ã€‚

```java
public void debug(String format, Object... arguments);
```

â€œé‚£åœ¨ä½¿ç”¨å¯å˜å‚æ•°çš„æ—¶å€™æœ‰ä»€ä¹ˆæ³¨æ„äº‹é¡¹å—ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

æœ‰çš„ã€‚æˆ‘ä»¬è¦é¿å…é‡è½½å¸¦æœ‰å¯å˜å‚æ•°çš„æ–¹æ³•â€”â€”è¿™æ ·å¾ˆå®¹æ˜“è®©ç¼–è¯‘å™¨é™·å…¥è‡ªæˆ‘æ€€ç–‘ä¸­ã€‚

```java
public static void main(String[] args) {
    print(null);
}

public static void print(String... strs) {
    for (String a : strs)
        System.out.print(a);
    System.out.println();
}

public static void print(Integer... ints) {
    for (Integer i : ints)
        System.out.print(i);
    System.out.println();
}
```

è¿™æ—¶å€™ï¼Œç¼–è¯‘å™¨å®Œå…¨ä¸çŸ¥é“è¯¥è°ƒç”¨å“ªä¸ª `print()` æ–¹æ³•ï¼Œ`print(String... strs)` è¿˜æ˜¯ `print(Integer... ints)`ï¼Œå‚»å‚»åˆ†ä¸æ¸…ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/basic-extra-meal/varables-03.png)

å‡å¦‚çœŸçš„éœ€è¦é‡è½½å¸¦æœ‰å¯å˜å‚æ•°çš„æ–¹æ³•ï¼Œå°±å¿…é¡»åœ¨è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ç»™å‡ºæ˜ç¡®çš„æŒ‡ç¤ºï¼Œä¸è¦è®©ç¼–è¯‘å™¨å»çŒœã€‚

```java
public static void main(String[] args) {
    String [] strs = null;
    print(strs);

    Integer [] ints = null;
    print(ints);
}

public static void print(String... strs) {
}

public static void print(Integer... ints) {
}
```

ä¸Šé¢è¿™æ®µä»£ç æ˜¯å¯ä»¥ç¼–è¯‘é€šè¿‡çš„ã€‚å› ä¸ºç¼–è¯‘å™¨çŸ¥é“å‚æ•°æ˜¯ String ç±»å‹è¿˜æ˜¯ Integer ç±»å‹ï¼Œåªä¸è¿‡ä¸ºäº†è¿è¡Œæ—¶ä¸æŠ›å‡º `NullPointerException`ï¼Œä¸¤ä¸ª `print()` æ–¹æ³•çš„å†…éƒ¨è¦åšå¥½åˆ¤ç©ºæ“ä½œã€‚

â€œå¥½äº†ï¼Œå…³äºå¯å˜å‚æ•°ï¼Œæˆ‘ä»¬å°±å…ˆè®²åˆ°è¿™é‡Œå§ã€‚ä¸‰å¦¹ï¼Œä½ éƒ½ç†è§£äº†å§ï¼Ÿâ€

â€œå—¯å—¯ï¼Œä¸éš¾ï¼Œæˆ‘ç†è§£äº†ï¼Œå“¥ã€‚â€ä¸‰å¦¹æœ€è¿‘çš„å­¦ä¹ çŠ¶æ€çœŸä¸é”™ï¼Œèƒ½çœ‹å¾—å‡ºæ¥ï¼Œå¥¹æœ‰åœ¨è®¤çœŸåœ°åšç¬”è®°ğŸ“’ã€‚

---


GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 5.6 Java nativeæ–¹æ³•

â€œä¸‰å¦¹ï¼Œä¹‹å‰æˆ‘ä»¬å­¦ä¹ äº† Java ä¸­çš„[åŸºæœ¬æ–¹æ³•](https://tobebetterjavaer.com/oo/method.html)ï¼Œå…¶å® Java è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œæœ¬åœ°æ–¹æ³•ï¼Œæˆ–è€…å« native æ–¹æ³•ï¼Œå®ƒä¸ä¹‹å‰çš„æ–¹æ³•æœ‰å¾ˆå¤§çš„ä¸åŒã€‚â€æˆ‘æ”¾ä¸‹æ‰‹ä¸­çš„æ‰‹æœºï¼Œæ‰­è¿‡è„¸æ¥å¯¹ä¸‰å¦¹è¯´ã€‚

â€œå¬èµ·æ¥æŒºæœ‰æ„æ€çš„ã€‚â€ä¸‰å¦¹å¾ˆæœŸå¾…ã€‚

â€œæˆ‘ä¼šæ•™ä½ ç”¨ Cè¯­è¨€å®ç°ä¸€ä¸ª native æ–¹æ³•ã€‚â€æˆ‘ç»§ç»­è¯´åˆ°ï¼Œâ€œCè¯­è¨€æ˜¯å¦å¤–ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œä½ å¯ä»¥ç‚¹è¿™ä¸ª[é“¾æ¥](https://tobebetterjavaer.com/xuexiluxian/c.html)å»äº†è§£å’Œå­¦ä¹ ã€‚è®©æˆ‘ä»¬å¼€å§‹å§â€

ç±»ä¼¼ Thread ç±»ä¸­çš„ `private native start0()` æ–¹æ³•ï¼›

åˆæˆ–è€… Object.class ç±»ä¸­çš„ getClass() æ–¹æ³•ã€hashCode()æ–¹æ³•ã€clone() æ–¹æ³•ï¼Œå…¶ä¸­æ–¹æ³•ç­¾åå¦‚ä¸‹ï¼š

```java
public final native Class<?> getClass();
public native int hashCode();
protected native Object clone() throws CloneNotSupportedException;
```

ä¹Ÿå°±æ˜¯ç”¨ã€nativeã€‘å…³é”®è¯ä¿®é¥°çš„æ–¹æ³•ï¼Œå¤šæ•°æƒ…å†µä¸‹ä¸éœ€è¦ç”¨ Java è¯­è¨€å®ç°ã€‚

â€œäºŒå“¥ï¼Œä¸ºä»€ä¹ˆè¦ç”¨ native æ¥ä¿®é¥°æ–¹æ³•å‘¢ï¼Œè¿™æ ·åšæœ‰ä»€ä¹ˆç”¨ï¼Ÿâ€ä¸‰å¦¹å¾ˆä¹–ï¼Œä½†è¿™ä¸ªé—®é¢˜ä¹Ÿé—®çš„å¾ˆæ·åœ°æœ‰å£°ã€‚

â€œå¥½çš„ï¼Œä¸‰å¦¹ï¼Œæˆ‘ä»¬ä¸€æ­¥æ­¥æ¥æ‰’æ‹‰â€ã€‚

### **1ã€JNIï¼šJava Native Interface**

åœ¨ä»‹ç» native ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä»€ä¹ˆæ˜¯ JNIã€‚

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ä½¿ç”¨ Java è¯­è¨€ç¼–å†™ç¨‹åºï¼Œä½†æŸäº›æƒ…å†µä¸‹ï¼ŒJava å¯èƒ½æ»¡è¶³ä¸äº†éœ€æ±‚ï¼Œæˆ–è€…ä¸èƒ½æ›´å¥½çš„æ»¡è¶³éœ€æ±‚ï¼Œæ¯”å¦‚ï¼š

- â‘ ã€æ ‡å‡†çš„ Java ç±»åº“ä¸æ”¯æŒã€‚
- â‘¡ã€æˆ‘ä»¬å·²ç»ç”¨å¦ä¸€ç§è¯­è¨€ï¼Œæ¯”å¦‚è¯´ C/C++ ç¼–å†™äº†ä¸€ä¸ªç±»åº“ï¼Œå¦‚ä½•ç”¨ Java ä»£ç è°ƒç”¨å‘¢ï¼Ÿ
- â‘¢ã€æŸäº›è¿è¡Œæ¬¡æ•°ç‰¹åˆ«å¤šçš„æ–¹æ³•ï¼Œä¸ºäº†åŠ å¿«æ€§èƒ½ï¼Œéœ€è¦ç”¨æ›´æ¥è¿‘ç¡¬ä»¶çš„è¯­è¨€ï¼ˆæ¯”å¦‚æ±‡ç¼–ï¼‰ç¼–å†™ã€‚

ä¸Šé¢è¿™ä¸‰ç§éœ€æ±‚ï¼Œè¯´åˆ°åº•å°±æ˜¯å¦‚ä½•ç”¨ Java ä»£ç è°ƒç”¨ä¸åŒè¯­è¨€ç¼–å†™çš„ä»£ç ã€‚é‚£ä¹ˆ JNI åº”è¿è€Œç”Ÿäº†ã€‚

ä» Java 1.1 å¼€å§‹ï¼ŒJava Native Interface (JNI)æ ‡å‡†å°±æˆä¸º Java å¹³å°çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå…è®¸ Java ä»£ç å’Œå…¶ä»–è¯­è¨€ç¼–å†™çš„ä»£ç è¿›è¡Œäº¤äº’ã€‚

JNI ä¸€å¼€å§‹æ˜¯ä¸ºäº†æœ¬åœ°å·²ç¼–è¯‘è¯­è¨€ï¼Œå°¤å…¶æ˜¯ C å’Œ C++è€Œè®¾è®¡çš„ï¼Œä½†æ˜¯å®ƒå¹¶ä¸å¦¨ç¢ä½ ä½¿ç”¨å…¶ä»–è¯­è¨€ï¼Œåªè¦è°ƒç”¨çº¦å®šå—æ”¯æŒå°±å¯ä»¥äº†ã€‚ä½¿ç”¨ Java ä¸æœ¬åœ°å·²ç¼–è¯‘çš„ä»£ç äº¤äº’ï¼Œé€šå¸¸ä¼šä¸§å¤±å¹³å°å¯ç§»æ¤æ€§ï¼Œä½†æ˜¯ï¼Œæœ‰äº›æƒ…å†µä¸‹è¿™æ ·åšæ˜¯å¯ä»¥æ¥å—çš„ï¼Œç”šè‡³æ˜¯å¿…é¡»çš„ï¼Œæ¯”å¦‚ï¼Œä½¿ç”¨ä¸€äº›æ—§çš„åº“ï¼Œä¸ç¡¬ä»¶ã€æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œæˆ–è€…ä¸ºäº†æé«˜ç¨‹åºçš„æ€§èƒ½ã€‚JNI æ ‡å‡†è‡³å°‘ä¿è¯æœ¬åœ°ä»£ç èƒ½å·¥ä½œèƒ½åœ¨ä»»ä½• Java è™šæ‹Ÿæœºå®ç°ä¸‹ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/native-method-2a6fd1da-8b64-4fe1-bf3b-fbb117774549.png)

é€šè¿‡ JNIï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ Java ç¨‹åºï¼ˆä»£ç ï¼‰è°ƒç”¨åˆ°æ“ä½œç³»ç»Ÿç›¸å…³çš„æŠ€æœ¯å®ç°çš„åº“å‡½æ•°ï¼Œä»è€Œä¸å…¶ä»–æŠ€æœ¯å’Œç³»ç»Ÿäº¤äº’ï¼›åŒæ—¶å…¶ä»–æŠ€æœ¯å’Œç³»ç»Ÿä¹Ÿå¯ä»¥é€šè¿‡ JNI æä¾›çš„ç›¸åº”åŸç”Ÿæ¥å£è°ƒç”¨ Java åº”ç”¨ç³»ç»Ÿå†…éƒ¨å®ç°çš„åŠŸèƒ½ã€‚

â€œäºŒå“¥ï¼Œç­‰ä¸€ä¸‹ï¼ŒJava ä¸æ˜¯è·¨å¹³å°çš„å—ï¼Ÿå¦‚æœç”¨ JNIï¼Œé‚£ä¹ˆç¨‹åºä¸å°±å¤±å»äº†è·¨å¹³å°çš„ä¼˜ç‚¹ï¼Ÿâ€ä¸å¾—ä¸è¯´ï¼Œä¸‰å¦¹è¿™ä¸ªé—®é¢˜èµ·åˆ°å¥½å¤„ã€‚

â€œç¡®å®æ˜¯è¿™æ ·çš„ã€‚â€æˆ‘æç­äº†ä¸­æŒ‡å’Œæ— åæŒ‡ä¹‹é—´çš„çƒŸå¤´ï¼Œç»§ç»­å¨“å¨“é“æ¥ã€‚

JNI çš„ç¼ºç‚¹ï¼š

- â‘ ã€ç¨‹åºä¸å†è·¨å¹³å°ã€‚è¦æƒ³è·¨å¹³å°ï¼Œå¿…é¡»åœ¨ä¸åŒçš„ç³»ç»Ÿç¯å¢ƒä¸‹é‡æ–°ç¼–è¯‘æœ¬åœ°è¯­è¨€éƒ¨åˆ†ã€‚
- â‘¡ã€ç¨‹åºä¸å†æ˜¯ç»å¯¹å®‰å…¨çš„ï¼Œæœ¬åœ°ä»£ç çš„ä¸å½“ä½¿ç”¨å¯èƒ½å¯¼è‡´æ•´ä¸ªç¨‹åºå´©æºƒã€‚ä¸€ä¸ªé€šç”¨è§„åˆ™æ˜¯ï¼Œä½ åº”è¯¥è®©æœ¬åœ°æ–¹æ³•é›†ä¸­åœ¨å°‘æ•°å‡ ä¸ªç±»å½“ä¸­ã€‚è¿™æ ·å°±é™ä½äº† Java å’Œ C/C++ ä¹‹é—´çš„è€¦åˆæ€§ã€‚

ç›®å‰æ¥è®²ä½¿ç”¨ JNI çš„ç¼ºç‚¹ç›¸å¯¹äºä¼˜ç‚¹è¿˜æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå¯èƒ½åé¢éšç€ Java çš„æŠ€æœ¯å‘å±•ï¼Œæˆ‘ä»¬ä¸åœ¨éœ€è¦ JNIï¼Œä½†æ˜¯ç›®å‰ JDK è¿˜æ˜¯ä¸€ç›´æä¾›äº†å¯¹ JNI æ ‡å‡†çš„æ”¯æŒã€‚

### **2ã€ç”¨ C è¯­è¨€ç¼–å†™ç¨‹åºæœ¬åœ°æ–¹æ³•**

â€œä¸Šé¢è®²è§£äº†ä»€ä¹ˆæ˜¯ JNIï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å†™ä¸ªä¾‹å­ï¼šå¦‚ä½•ç”¨ Java ä»£ç è°ƒç”¨æœ¬åœ°çš„ C ç¨‹åºã€‚â€æˆ‘æ‰­å¤´å¯¹ä¸‰å¦¹è¯´ï¼Œâ€œä½ æ³¨æ„ğŸ“¢çœ‹ã€‚â€

>å®˜æ–¹æ–‡æ¡£å¦‚ä¸‹ï¼š[https://docs.oracle.com/javase/8/docs/technotes/guides/jni/spec/jniTOC.html](https://docs.oracle.com/javase/8/docs/technotes/guides/jni/spec/jniTOC.html)

æ­¥éª¤å¦‚ä¸‹ï¼š ã€€ã€€ 

â‘ ã€ç¼–å†™å¸¦æœ‰ native æ–¹æ³•çš„ Java ç±»ï¼Œç”Ÿæˆ.java æ–‡ä»¶ï¼›

â‘¡ã€ä½¿ç”¨ javac å‘½ä»¤ç¼–è¯‘æ‰€ç¼–å†™çš„ Java ç±»ï¼Œç”Ÿæˆ.class æ–‡ä»¶ï¼›

â‘¢ã€ä½¿ç”¨ javah -jni java ç±»å ç”Ÿæˆæ‰©å±•åä¸º h çš„å¤´æ–‡ä»¶ï¼Œä¹Ÿå³ç”Ÿæˆ .h æ–‡ä»¶ï¼›

â‘£ã€ä½¿ç”¨ C/C++ï¼ˆæˆ–è€…å…¶ä»–ç¼–ç¨‹æƒ³è¯­è¨€ï¼‰å®ç°æœ¬åœ°æ–¹æ³•ï¼Œåˆ›å»º .h æ–‡ä»¶çš„å®ç°ï¼Œä¹Ÿå°±æ˜¯åˆ›å»º .cpp æ–‡ä»¶å®ç°.h æ–‡ä»¶ä¸­çš„æ–¹æ³•ï¼›

â‘¤ã€å°† C/C++ ç¼–å†™çš„æ–‡ä»¶ç”ŸæˆåŠ¨æ€è¿æ¥åº“ï¼Œç”Ÿæˆ dll æ–‡ä»¶ï¼›

ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ª HelloWorld ç¨‹åºçš„è°ƒç”¨æ¥å®Œæˆè¿™å‡ ä¸ªæ­¥éª¤ã€‚

#### 01ï¼‰ç¼–å†™å¸¦æœ‰ native æ–¹æ³•çš„ Java ç±» HelloJNI.java

åœ¨ `/Users/itwanger/Documents/Github/javabetter/testjni` ç›®å½•ä¸‹åˆ›å»º HelloJNI.java æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹æ‰€ç¤ºã€‚

```java
public class HelloJNI {
    static {
        System.loadLibrary("hello"); // åŠ è½½åä¸º libhello.dylib çš„åŠ¨æ€é“¾æ¥åº“
    }

    // å®šä¹‰æœ¬åœ°æ–¹æ³•
    private native void helloJNI();

    public static void main(String[] args) {
        new HelloJNI().helloJNI(); // è°ƒç”¨æœ¬åœ°æ–¹æ³•
    }
}
```

**PSï¼šåé¢æ‰§è¡Œçš„å‘½ä»¤éƒ½å°†åœ¨ testjni çš„ç›®å½•ä¸‹**ã€‚

è§£é‡Šä¸€ä¸‹è¿™æ®µä»£ç ï¼š

`private native void helloJNI()`ï¼šç”¨ native å£°æ˜çš„æ–¹æ³•å‘ŠçŸ¥ JVM è°ƒç”¨è¯¥æ–¹æ³•åœ¨å¤–éƒ¨å®šä¹‰ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¼šç”¨ C è¯­è¨€å»å®ç°ã€‚

`System.loadLibrary("hello")`ï¼šåŠ è½½åŠ¨æ€åº“ï¼Œå‚æ•° hello æ˜¯åŠ¨æ€åº“çš„åå­—ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·ç†è§£ï¼šç¨‹åºä¸­çš„æ–¹æ³• helloJNI() åœ¨ç¨‹åºä¸­æ²¡æœ‰å®ç°ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸‹é¢è¦è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ

æˆ‘ä»¬å°±éœ€è¦å¯¹è¿™ä¸ªæ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ï¼Œæ‰€ä»¥ç”¨äº† [static ä»£ç å—è¿›è¡Œåˆå§‹åŒ–](https://tobebetterjavaer.com/oo/static.html)ï¼Œåé¢ä¼šè®²åˆ°ã€‚

#### 02ï¼‰ç¼–è¯‘ HelloJNI.java

åœ¨å‘½ä»¤è¡Œé€šè¿‡ `javac HelloJNI.java` æ¥ç¼–è¯‘æºä»£ç ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/native-method-41e11e7f-31c1-4611-9b85-63ec211ff31b.png)

#### 03ï¼‰ä½¿ç”¨ `javah -jni HelloJNI` ç”Ÿæˆæ‰©å±•åä¸º h çš„å¤´æ–‡ä»¶

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/native-method-0b08bf51-7bd9-4d06-a0dc-4262c1a71fd5.png)

>PSï¼šJava 9 ä»¥åï¼Œjavah è¢«å¼ƒç”¨ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä½¿ç”¨ -h é€‰é¡¹æ¥ç”Ÿæˆå¤´æ–‡ä»¶ï¼Œä¾‹å¦‚ `javac -h . ClassName.java`ã€‚

æ‰§è¡Œå®Œæ¯•åï¼Œä¼šåœ¨ HelloJNI.java æ‰€åœ¨ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªåä¸º HelloJNI.h çš„å¤´æ–‡ä»¶ã€‚æ‰“å¼€ HelloJNI.h æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä»£ç ã€‚ã€€ã€€

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/native-method-e5c34f63-84df-4a99-96e1-b45ea04929df.png)

çœ‹ä¸æ‡‚æ²¡å…³ç³»ï¼Œæ— æ‰€è°“ï¼Œç›´åˆ°å®ƒæ˜¯è‡ªåŠ¨ç”Ÿæˆçš„å°±å¥½ã€‚

#### 04ï¼‰ä½¿ç”¨ C è¯­è¨€å®ç°æœ¬åœ°æ–¹æ³• 

åˆ›å»ºä¸€ä¸ª C æ–‡ä»¶ HelloJNI.cï¼Œå®ç°æœ¬åœ°æ–¹æ³• sayHelloã€‚

```c
#include <stdio.h>
#include <jni.h>
#include "HelloJNI.h"

JNIEXPORT void JNICALL Java_HelloJNI_helloJNI(JNIEnv *env, jobject obj) {
    printf("Hello, JNI!\n");
    return;
}
```

æ³¨æ„ï¼Œè¿™é‡Œéœ€è¦å¼•å…¥ JNI å¤´æ–‡ä»¶ï¼Œå¹¶ä¸”å®ç°çš„æ–¹æ³•åç§°éœ€è¦ä¸åœ¨ Java ä¸­å£°æ˜çš„åç§°ä¸€è‡´ï¼ˆ`HelloJNI_helloJNI` HelloJNI ç±»çš„ helloJNI æ–¹æ³•ï¼‰ã€‚

#### 05ï¼‰ç¼–å†™ç¼–è¯‘è„šæœ¬ compile.sh

```sh
#!/bin/bash

# ç¼–è¯‘ HelloJNI.c æ–‡ä»¶
gcc -I"$JAVA_HOME/include" -I"$JAVA_HOME/include/darwin" -shared -o libhello.dylib HelloJNI.c

# æŠŠç”Ÿæˆçš„ libhello.dylib æ–‡ä»¶æ‹·è´åˆ°å½“å‰ç›®å½•
cp libhello.dylib .
```

æ³¨æ„äº‹é¡¹ï¼š

- `$JAVA_HOME` æ˜¯ JDK çš„å®‰è£…è·¯å¾„ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ã€‚
- åœ¨ macOS ä¸Šï¼ŒåŠ¨æ€é“¾æ¥åº“ï¼ˆhelloï¼‰çš„åç¼€æ˜¯ .dylibï¼Œè€Œä¸æ˜¯ Linux ä¸Šçš„ .soã€‚


è¿™é‡Œçš„ -I é€‰é¡¹æ˜¯ä¸ºäº†å‘Šè¯‰ç¼–è¯‘å™¨å¤´æ–‡ä»¶çš„ä½ç½®ï¼Œ`$JAVA_HOME` æ˜¯ Java å®‰è£…ç›®å½•çš„è·¯å¾„ã€‚


#### 06ï¼‰æ‰§è¡Œç¼–è¯‘è„šæœ¬

```
sh compile.sh
```

æ‰§è¡Œå®Œæ¯•åï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªåä¸º libhello.dylib çš„åŠ¨æ€é“¾æ¥åº“ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/native-method-e93c8fa8-6e33-4374-81da-8bd9360d1bb4.png)

#### 07ï¼‰è¿è¡Œ HelloJNI

æ‰§è¡Œ`java HelloJNI`å‘½ä»¤è¿è¡Œ HelloJNIï¼Œå¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œå°±ä¼šåœ¨ç»ˆç«¯ä¸Šè¾“å‡º Hello, JNI!ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/native-method-34beba0f-8fe8-48d0-aa48-b25c1b504b59.png)

### **3ã€JNI è°ƒç”¨ C çš„æµç¨‹å›¾**

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/native-method-6673cf73-c4dd-4434-b821-0d705f756a73.png)


### **4ã€native å…³é”®å­—**

â€œä¸‰å¦¹ï¼Œç°åœ¨åº”è¯¥çŸ¥é“ä»€ä¹ˆæ˜¯ native äº†å§ï¼Ÿâ€æˆ‘é—®ä¸‰å¦¹ã€‚

â€œå—¯å—¯ï¼Œæˆ‘æ¥ç®€è¿°ä¸€ä¸‹ï¼ŒäºŒå“¥ä½ çœ‹çœ‹æˆ‘è¯´çš„æ˜¯å¦æ­£ç¡®ã€‚â€

native ç”¨æ¥ä¿®é¥°æ–¹æ³•ï¼Œç”¨ native å£°æ˜çš„æ–¹æ³•è¡¨ç¤ºè¯¥æ–¹æ³•çš„å®ç°åœ¨å¤–éƒ¨å®šä¹‰ï¼Œå¯ä»¥ç”¨ä»»ä½•è¯­è¨€å»å®ç°å®ƒï¼Œæ¯”å¦‚è¯´ C/C++ã€‚ ç®€å•åœ°è®²ï¼Œä¸€ä¸ª native Method å°±æ˜¯ä¸€ä¸ª Java è°ƒç”¨é Java ä»£ç çš„æ¥å£ã€‚

native è¯­æ³•ï¼š

- â‘ ã€ä¿®é¥°æ–¹æ³•çš„ä½ç½®å¿…é¡»åœ¨è¿”å›ç±»å‹ä¹‹å‰ï¼Œå’Œå…¶ä½™çš„æ–¹æ³•æ§åˆ¶ç¬¦å‰åå…³ç³»ä¸å—é™åˆ¶ã€‚
- â‘¡ã€ä¸èƒ½ç”¨ abstract ä¿®é¥°ï¼Œä¹Ÿæ²¡æœ‰æ–¹æ³•ä½“ï¼Œä¹Ÿæ²¡æœ‰å·¦å³å¤§æ‹¬å·ã€‚
- â‘¢ã€è¿”å›å€¼å¯ä»¥æ˜¯ä»»æ„ç±»å‹

â€œä¸‰å¦¹ï¼Œä½ å­¦çš„ä¸é”™å˜›ã€‚â€æˆ‘å¯¹ä¸‰å¦¹çš„å­¦ä¹ èƒ½åŠ›æ„Ÿåˆ°éå¸¸çš„æ¬£æ…°ï¼Œâ€œ**æˆ‘ä»¬åœ¨æ—¥å¸¸ç¼–ç¨‹ä¸­çœ‹åˆ° native ä¿®é¥°çš„æ–¹æ³•ï¼Œåªéœ€è¦çŸ¥é“è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Œè‡³äºåˆ«çš„å°±ä¸ç”¨ç®¡äº†ï¼Œæ“ä½œç³»ç»Ÿä¼šç»™æˆ‘ä»¬å®ç°ï¼Œåˆå­¦çš„æ—¶å€™ä¹Ÿä¸éœ€è¦å¤ªè¿‡æ·±å…¥**ã€‚â€

>- Windows ä¸‹å®‰è£… gcc æ•™ç¨‹ï¼š[http://blog.csdn.net/altland/article/details/63252757](https://blog.csdn.net/altland/article/details/63252757)
>- native å‚è€ƒé“¾æ¥ï¼š[https://www.zhihu.com/question/28001771/answer/2049534464](https://www.zhihu.com/question/28001771/answer/2049534464)

---

æœ€è¿‘æ•´ç†äº†ä¸€ä»½ç‰›é€¼çš„å­¦ä¹ èµ„æ–™ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº Java åŸºç¡€éƒ¨åˆ†ï¼ˆJVMã€Java é›†åˆæ¡†æ¶ã€å¤šçº¿ç¨‹ï¼‰ï¼Œè¿˜å›Šæ‹¬äº† **æ•°æ®åº“ã€è®¡ç®—æœºç½‘ç»œã€ç®—æ³•ä¸æ•°æ®ç»“æ„ã€è®¾è®¡æ¨¡å¼ã€æ¡†æ¶ç±» Springã€Nettyã€å¾®æœåŠ¡ï¼ˆDubboï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ ç½‘å…³** ç­‰ç­‰ç­‰ç­‰â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¯ä»¥è¯´æ˜¯ 2022 å¹´å…¨ç½‘æœ€å…¨çš„å­¦ä¹ å’Œæ‰¾å·¥ä½œçš„ PDF èµ„æºäº†](https://tobebetterjavaer.com/pdf/programmer-111.html)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 5.7 Javaæ„é€ æ–¹æ³•

â€œä¸‰å¦¹ï¼Œ[ä¸Šä¸€èŠ‚](https://tobebetterjavaer.com/oo/method.html)å­¦äº† Java ä¸­çš„æ–¹æ³•ï¼Œæ¥ç€å­¦æ„é€ æ–¹æ³•çš„è¯ï¼Œéš¾åº¦å°±å°å¾ˆå¤šäº†ã€‚â€åˆšåƒå®Œä¸­åˆé¥­ï¼Œè™½ç„¶æœ‰äº›å›°æ„ï¼Œä½†è¶æœºå­¦ä¸ª 10 åˆ†é’Ÿä¹Ÿæ˜¯ä¸é”™çš„ï¼Œç¡çœ ä¼šæ›´å¿ƒæ»¡æ„è¶³ä¸€äº›ï¼Œäºæ˜¯æˆ‘é¢éœ²å¾®ç¬‘åœ°å¯¹ä¸‰å¦¹è¯´ã€‚

â€œåœ¨ Java ä¸­ï¼Œæ„é€ æ–¹æ³•æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–¹æ³•ï¼Œå½“ä¸€ä¸ªç±»è¢«å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨æ„é€ æ–¹æ³•ã€‚åªæœ‰åœ¨æ„é€ æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œå¯¹è±¡æ‰ä¼šè¢«åˆ†é…å†…å­˜ç©ºé—´ã€‚æ¯æ¬¡ä½¿ç”¨ `new` å…³é”®å­—åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ï¼Œæ„é€ æ–¹æ³•è‡³å°‘ä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚â€

â€œå¦‚æœä½ åœ¨ä¸€ä¸ªç±»ä¸­æ²¡æœ‰çœ‹è§æ„é€ æ–¹æ³•ï¼Œå¹¶ä¸æ˜¯å› ä¸ºæ„é€ æ–¹æ³•ä¸å­˜åœ¨ï¼Œè€Œæ˜¯è¢«ç¼ºçœäº†ï¼Œç¼–è¯‘å™¨ä¼šç»™è¿™ä¸ªç±»æä¾›ä¸€ä¸ªé»˜è®¤çš„æ„é€ æ–¹æ³•ã€‚å°±æ˜¯è¯´ï¼ŒJava æœ‰ä¸¤ç§ç±»å‹çš„æ„é€ æ–¹æ³•ï¼š**æ— å‚æ„é€ æ–¹æ³•å’Œæœ‰å‚æ„é€ æ–¹æ³•**ã€‚â€

â€œæ³¨æ„ï¼Œä¹‹æ‰€ä»¥å«å®ƒæ„é€ æ–¹æ³•ï¼Œæ˜¯å› ä¸ºå¯¹è±¡åœ¨åˆ›å»ºçš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡æ„é€ æ–¹æ³•åˆå§‹åŒ–å€¼â€”â€”æå†™å¯¹è±¡æœ‰å“ªäº›åˆå§‹åŒ–çŠ¶æ€ã€‚â€

â€œå“¥ï¼Œä½ ç¼“ç¼“ï¼Œä¸€å£æ°”è¯´è¿™ä¹ˆå¤šï¼Œä¹ŸçœŸæœ‰ä½ çš„ã€‚â€ä¸‰å¦¹å¬å¾—èšç²¾ä¼šç¥ï¼Œä½†ä¹ŸçŸ¥é“å…³å¿ƒå¥¹è¿™ä¸ªæ—¢å½“å“¥åˆå½“è€å¸ˆçš„äºŒå“¥äº†ã€‚

### 01ã€åˆ›å»ºæ„é€ æ–¹æ³•çš„è§„åˆ™

æ„é€ æ–¹æ³•å¿…é¡»ç¬¦åˆä»¥ä¸‹è§„åˆ™ï¼š

- æ„é€ æ–¹æ³•çš„åå­—å¿…é¡»å’Œç±»åä¸€æ ·ï¼›
- æ„é€ æ–¹æ³•æ²¡æœ‰è¿”å›ç±»å‹ï¼ŒåŒ…æ‹¬ voidï¼›
- æ„é€ æ–¹æ³•ä¸èƒ½æ˜¯æŠ½è±¡çš„ï¼ˆabstractï¼‰ã€é™æ€çš„ï¼ˆstaticï¼‰ã€æœ€ç»ˆçš„ï¼ˆfinalï¼‰ã€åŒæ­¥çš„ï¼ˆsynchronizedï¼‰ã€‚

ç®€å•è§£æä¸€ä¸‹æœ€åä¸€æ¡è§„åˆ™ã€‚

- ç”±äºæ„é€ æ–¹æ³•ä¸èƒ½è¢«å­ç±»ç»§æ‰¿ï¼Œæ‰€ä»¥ç”¨ final å’Œ abstract å…³é”®å­—ä¿®é¥°æ²¡æœ‰æ„ä¹‰ï¼›
- æ„é€ æ–¹æ³•ç”¨äºåˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ç”¨ static å…³é”®å­—ä¿®é¥°æ²¡æœ‰æ„ä¹‰ï¼›
- å¤šä¸ªçº¿ç¨‹ä¸ä¼šåŒæ—¶åˆ›å»ºå†…å­˜åœ°å€ç›¸åŒçš„åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ç”¨ synchronized å…³é”®å­—ä¿®é¥°æ²¡æœ‰å¿…è¦ã€‚

æ„é€ æ–¹æ³•çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š

```java
class class_name {
    public class_name(){}    // é»˜è®¤æ— å‚æ„é€ æ–¹æ³•
    public ciass_name([paramList]){}    // å®šä¹‰æœ‰å‚æ•°åˆ—è¡¨çš„æ„é€ æ–¹æ³•
    â€¦
    // ç±»ä¸»ä½“
}
```

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœç”¨ void å£°æ˜æ„é€ æ–¹æ³•çš„è¯ï¼Œç¼–è¯‘æ—¶ä¸ä¼šæŠ¥é”™ï¼Œä½† Java ä¼šæŠŠè¿™ä¸ªæ‰€è°“çš„â€œæ„é€ æ–¹æ³•â€å½“æˆæ™®é€šæ–¹æ³•æ¥å¤„ç†ã€‚

```java
/**
 * å¾®ä¿¡æœç´¢ã€Œæ²‰é»˜ç‹äºŒã€ï¼Œå›å¤ Java
 *
 * @author æ²‰é»˜ç‹äºŒ
 * @date 2020/11/26
 */
public class Demo {
    void Demo(){ }
}
```

`void Demo(){}` çœ‹èµ·æ¥å¾ˆç¬¦åˆæ„é€ æ–¹æ³•çš„å†™æ³•ï¼ˆä¸ç±»åç›¸åŒï¼‰ï¼Œä½†å…¶å®åªæ˜¯ä¸€ä¸ªä¸ç¬¦åˆè§„èŒƒçš„æ™®é€šæ–¹æ³•ï¼Œæ–¹æ³•åçš„é¦–å­—æ¯ä½¿ç”¨äº†å¤§å†™ï¼Œæ–¹æ³•ä½“ä¸ºç©ºï¼Œå®ƒå¹¶ä¸æ˜¯é»˜è®¤çš„æ— å‚æ„é€ æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡åç¼–è¯‘åçš„å­—èŠ‚ç éªŒè¯ã€‚

```java
public class Demo {
    public Demo() {
    }

    void Demo() {
    }
}
```

`public Demo() {}` æ‰æ˜¯çœŸæ­£çš„æ— å‚æ„é€ æ–¹æ³•ã€‚

ä¸è¿‡ï¼Œå¯ä»¥ä½¿ç”¨[è®¿é—®æƒé™ä¿®é¥°ç¬¦](https://tobebetterjavaer.com/oo/access-control.html)ï¼ˆprivateã€protectedã€publicã€defaultï¼‰æ¥ä¿®é¥°æ„é€ æ–¹æ³•ï¼Œè®¿é—®æƒé™ä¿®é¥°ç¬¦å†³å®šäº†æ„é€ æ–¹æ³•çš„åˆ›å»ºæ–¹å¼ã€‚


### 02ã€é»˜è®¤æ„é€ æ–¹æ³•

å¦‚æœä¸€ä¸ªæ„é€ æ–¹æ³•ä¸­æ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªé»˜è®¤æ„é€ æ–¹æ³•ï¼Œä¹Ÿç§°ä¸ºæ— å‚æ„é€ æ–¹æ³•ã€‚

```java
/**
 * @author å¾®ä¿¡æœã€Œæ²‰é»˜ç‹äºŒã€ï¼Œå›å¤å…³é”®å­— PDF
 */
public class Bike {
    Bike(){
        System.out.println("ä¸€è¾†è‡ªè¡Œè½¦è¢«åˆ›å»º");
    }

    public static void main(String[] args) {
        Bike bike = new Bike();
    }
}
```

åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¸º Bike ç±»ä¸­åˆ›å»ºäº†ä¸€ä¸ªæ— å‚çš„æ„é€ æ–¹æ³•ï¼Œå®ƒåœ¨æˆ‘ä»¬åˆ›å»ºå¯¹è±¡çš„æ—¶å€™è¢«è°ƒç”¨ã€‚

ç¨‹åºè¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
ä¸€è¾†è‡ªè¡Œè½¦è¢«åˆ›å»º
```

é€šå¸¸æƒ…å†µä¸‹ï¼Œæ— å‚æ„é€ æ–¹æ³•æ˜¯å¯ä»¥ç¼ºçœçš„ï¼Œæˆ‘ä»¬å¼€å‘è€…å¹¶ä¸éœ€è¦æ˜¾å¼çš„å£°æ˜æ— å‚æ„é€ æ–¹æ³•ï¼ŒæŠŠè¿™é¡¹å·¥ä½œäº¤ç»™ç¼–è¯‘å™¨å°±å¯ä»¥äº†ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/object-class/18-01.png)

â€œäºŒå“¥ï¼Œé»˜è®¤æ„é€ æ–¹æ³•çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿå®ƒä¸ºä»€ä¹ˆæ˜¯ä¸€ä¸ªç©ºçš„å•Šï¼Ÿâ€ä¸‰å¦¹ç–‘æƒ‘åœ°çœ‹ç€æˆ‘ï¼Œæå‡ºäº†è¿™ä¸ªå°–é”çš„é—®é¢˜ã€‚

â€œä¸‰å¦¹å•Šï¼Œé»˜è®¤æ„é€ æ–¹æ³•çš„ç›®çš„ä¸»è¦æ˜¯ä¸ºå¯¹è±¡çš„å­—æ®µæä¾›é»˜è®¤å€¼ï¼Œçœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ä½ å°±æ˜ç™½äº†ã€‚â€æˆ‘èƒ¸æœ‰æˆç«¹åœ°å›ç­”é“ã€‚

```java
/**
 * @author æ²‰é»˜ç‹äºŒï¼Œä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜
 */
public class Person {
    private String name;
    private int age;

    public static void main(String[] args) {
        Person p = new Person();
        System.out.println("å§“å " + p.name + " å¹´é¾„ " + p.age);
    }
}
```

è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
å§“å null å¹´é¾„ 0
```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œé»˜è®¤æ„é€ æ–¹æ³•åˆå§‹åŒ–äº† name å’Œ age çš„å€¼ï¼Œname æ˜¯ String ç±»å‹ï¼Œæ‰€ä»¥é»˜è®¤å€¼ä¸º nullï¼Œage æ˜¯ int ç±»å‹ï¼Œæ‰€ä»¥é»˜è®¤å€¼ä¸º 0ã€‚å¦‚æœæ²¡æœ‰é»˜è®¤æ„é€ æ–¹æ³•çš„è¯ï¼Œè¿™é¡¹å·¥ä½œå°±æ— æ³•å®Œæˆäº†ã€‚


### 03ã€æœ‰å‚æ„é€ æ–¹æ³•

æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•è¢«ç§°ä¸ºæœ‰å‚æ„é€ æ–¹æ³•ï¼Œå‚æ•°å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªã€‚æœ‰å‚æ„é€ æ–¹æ³•å¯ä»¥ä¸ºä¸åŒçš„å¯¹è±¡æä¾›ä¸åŒçš„å€¼ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥æä¾›ç›¸åŒçš„å€¼ã€‚

```java
/**
 * @author æ²‰é»˜ç‹äºŒï¼Œä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜
 */
public class ParamConstructorPerson {
    private String name;
    private int age;

    public ParamConstructorPerson(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public void out() {
        System.out.println("å§“å " + name + " å¹´é¾„ " + age);
    }

    public static void main(String[] args) {
        ParamConstructorPerson p1 = new ParamConstructorPerson("æ²‰é»˜ç‹äºŒ",18);
        p1.out();

        ParamConstructorPerson p2 = new ParamConstructorPerson("æ²‰é»˜ç‹ä¸‰",16);
        p2.out();
    }
}
```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ„é€ æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼ˆname å’Œ ageï¼‰ï¼Œè¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥ä¸º name å’Œ age èµ‹å€¼äº†ã€‚

```java
new ParamConstructorPerson("æ²‰é»˜ç‹äºŒ",18);
new ParamConstructorPerson("æ²‰é»˜ç‹ä¸‰",16);
```

å¦‚æœæ²¡æœ‰æœ‰å‚æ„é€ æ–¹æ³•çš„è¯ï¼Œå°±éœ€è¦é€šè¿‡ setter æ–¹æ³•ç»™å­—æ®µèµ‹å€¼äº†ã€‚


### 04ã€é‡è½½æ„é€ æ–¹æ³•

åœ¨ Java ä¸­ï¼Œæ„é€ æ–¹æ³•å’Œæ–¹æ³•ç±»ä¼¼ï¼Œåªä¸è¿‡æ²¡æœ‰è¿”å›ç±»å‹ã€‚å®ƒä¹Ÿå¯ä»¥åƒæ–¹æ³•ä¸€æ ·è¢«[é‡è½½](https://tobebetterjavaer.com/basic-extra-meal/override-overload.html)ã€‚æ„é€ æ–¹æ³•çš„é‡è½½ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦æä¾›ä¸åŒçš„å‚æ•°åˆ—è¡¨å³å¯ã€‚ç¼–è¯‘å™¨ä¼šé€šè¿‡å‚æ•°çš„æ•°é‡æ¥å†³å®šåº”è¯¥è°ƒç”¨å“ªä¸€ä¸ªæ„é€ æ–¹æ³•ã€‚

```java
/**
 * @author æ²‰é»˜ç‹äºŒï¼Œä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜
 */
public class OverloadingConstrutorPerson {
    private String name;
    private int age;
    private int sex;

    public OverloadingConstrutorPerson(String name, int age, int sex) {
        this.name = name;
        this.age = age;
        this.sex = sex;
    }

    public OverloadingConstrutorPerson(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public void out() {
        System.out.println("å§“å " + name + " å¹´é¾„ " + age + " æ€§åˆ« " + sex);
    }

    public static void main(String[] args) {
        OverloadingConstrutorPerson p1 = new OverloadingConstrutorPerson("æ²‰é»˜ç‹äºŒ",18, 1);
        p1.out();

        OverloadingConstrutorPerson p2 = new OverloadingConstrutorPerson("æ²‰é»˜ç‹ä¸‰",16);
        p2.out();
    }
}
```

åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ï¼Œå¦‚æœä¼ é€’çš„æ˜¯ä¸‰ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨ `OverloadingConstrutorPerson(String name, int age, int sex)` è¿™ä¸ªæ„é€ æ–¹æ³•ï¼›å¦‚æœä¼ é€’çš„æ˜¯ä¸¤ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨ `OverloadingConstrutorPerson(String name, int age)` è¿™ä¸ªæ„é€ æ–¹æ³•ã€‚


### 05ã€æ„é€ æ–¹æ³•å’Œæ–¹æ³•çš„åŒºåˆ«

æ„é€ æ–¹æ³•å’Œæ–¹æ³•ä¹‹é—´çš„åŒºåˆ«è¿˜æ˜¯è›®å¤šçš„ï¼Œæ¯”å¦‚è¯´ä¸‹é¢è¿™äº›ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/object-class/18-02.png)



### 06ã€å¤åˆ¶å¯¹è±¡

å¤åˆ¶ä¸€ä¸ªå¯¹è±¡å¯ä»¥é€šè¿‡ä¸‹é¢ä¸‰ç§æ–¹å¼å®Œæˆï¼š

- é€šè¿‡æ„é€ æ–¹æ³•
- é€šè¿‡å¯¹è±¡çš„å€¼
- é€šè¿‡ Object ç±»çš„ `clone()` æ–¹æ³•

#### 1ï¼‰é€šè¿‡æ„é€ æ–¹æ³•

```java
/**
 * @author æ²‰é»˜ç‹äºŒï¼Œä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜
 */
public class CopyConstrutorPerson {
    private String name;
    private int age;

    public CopyConstrutorPerson(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public CopyConstrutorPerson(CopyConstrutorPerson person) {
        this.name = person.name;
        this.age = person.age;
    }

    public void out() {
        System.out.println("å§“å " + name + " å¹´é¾„ " + age);
    }

    public static void main(String[] args) {
        CopyConstrutorPerson p1 = new CopyConstrutorPerson("æ²‰é»˜ç‹äºŒ",18);
        p1.out();

        CopyConstrutorPerson p2 = new CopyConstrutorPerson(p1);
        p2.out();
    }
}
```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæœ‰ä¸€ä¸ªå‚æ•°ä¸º CopyConstrutorPerson çš„æ„é€ æ–¹æ³•ï¼Œå¯ä»¥æŠŠè¯¥å‚æ•°çš„å­—æ®µç›´æ¥å¤åˆ¶åˆ°æ–°çš„å¯¹è±¡ä¸­ï¼Œè¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥åœ¨ new å…³é”®å­—åˆ›å»ºæ–°å¯¹è±¡çš„æ—¶å€™æŠŠä¹‹å‰çš„ p1 å¯¹è±¡ä¼ é€’è¿‡å»ã€‚

#### 2ï¼‰é€šè¿‡å¯¹è±¡çš„å€¼

```java
/**
 * @author æ²‰é»˜ç‹äºŒï¼Œä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜
 */
public class CopyValuePerson {
    private String name;
    private int age;

    public CopyValuePerson(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public CopyValuePerson() {
    }

    public void out() {
        System.out.println("å§“å " + name + " å¹´é¾„ " + age);
    }

    public static void main(String[] args) {
        CopyValuePerson p1 = new CopyValuePerson("æ²‰é»˜ç‹äºŒ",18);
        p1.out();

        CopyValuePerson p2 = new CopyValuePerson();
        p2.name = p1.name;
        p2.age = p1.age;
        
        p2.out();
    }
}
```

è¿™ç§æ–¹å¼æ¯”è¾ƒç²—æš´ï¼Œç›´æ¥æ‹¿ p1 çš„å­—æ®µå€¼å¤åˆ¶ç»™ p2 å¯¹è±¡ï¼ˆ`p2.name = p1.name`ï¼‰ã€‚

#### 3ï¼‰é€šè¿‡ Object ç±»çš„ `clone()` æ–¹æ³•

```java
/**
 * @author æ²‰é»˜ç‹äºŒï¼Œä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜
 */
public class ClonePerson implements Cloneable {
    private String name;
    private int age;

    public ClonePerson(String name, int age) {
        this.name = name;
        this.age = age;
    }

    @Override
    protected Object clone() throws CloneNotSupportedException {
        return super.clone();
    }

    public void out() {
        System.out.println("å§“å " + name + " å¹´é¾„ " + age);
    }

    public static void main(String[] args) throws CloneNotSupportedException {
        ClonePerson p1 = new ClonePerson("æ²‰é»˜ç‹äºŒ",18);
        p1.out();

        ClonePerson p2 = (ClonePerson) p1.clone();
        p2.out();
    }
}
```

é€šè¿‡ `clone()` æ–¹æ³•å¤åˆ¶å¯¹è±¡çš„æ—¶å€™ï¼ŒClonePerson å¿…é¡»å…ˆå®ç° Cloneable æ¥å£çš„ `clone()` æ–¹æ³•ï¼Œç„¶åå†è°ƒç”¨ `clone()` æ–¹æ³•ï¼ˆ`ClonePerson p2 = (ClonePerson) p1.clone()`ï¼‰ã€‚

>æ‹“å±•é˜…è¯»ï¼š[æµ…æ‹·è´ä¸æ·±æ‹·è´](https://tobebetterjavaer.com/basic-extra-meal/deep-copy.html)

### 07ã€ending

â€œäºŒå“¥ï¼Œæˆ‘èƒ½é—®ä¸€äº›é—®é¢˜å—ï¼Ÿâ€ä¸‰å¦¹ç²¾ç¥ç„•å‘ï¼Œæ²¡æœ‰ä¸æ¯«çš„ç–²æƒ«ã€‚

â€œå½“ç„¶å¯ä»¥å•Šï¼Œä½ é—®ã€‚â€æˆ‘å¾ˆæ¬£èµä¸‰å¦¹å­œå­œä¸å€¦çš„æ€åº¦ã€‚

â€œæ„é€ æ–¹æ³•çœŸçš„ä¸è¿”å›ä»»ä½•å€¼å—ï¼Ÿâ€

â€œæ„é€ æ–¹æ³•è™½ç„¶æ²¡æœ‰è¿”å›å€¼ï¼Œä½†è¿”å›çš„æ˜¯ç±»çš„å¯¹è±¡ã€‚â€

â€œæ„é€ æ–¹æ³•åªèƒ½å®Œæˆå­—æ®µåˆå§‹åŒ–çš„å·¥ä½œå—ï¼Ÿâ€

â€œåˆå§‹åŒ–å­—æ®µåªæ˜¯æ„é€ æ–¹æ³•çš„ä¸€ç§å·¥ä½œï¼Œå®ƒè¿˜å¯ä»¥åšæ›´å¤šï¼Œæ¯”å¦‚å¯åŠ¨çº¿ç¨‹ï¼Œè°ƒç”¨å…¶ä»–æ–¹æ³•ç­‰ã€‚â€

â€œå¥½çš„ï¼ŒäºŒå“¥ï¼Œæˆ‘çš„é—®é¢˜é—®å®Œäº†ï¼Œä»Šå¤©çš„å­¦ä¹ å¯ä»¥ç»“æŸäº†ï¼â€ä¸‰å¦¹ä¸€è„¸å¾—æ„çš„æ ·å­ã€‚

â€œé‚£ä½ è®°å¾—å¤ä¹ ä¸‹ä¸€èŠ‚çš„å†…å®¹å“¦ã€‚â€æ„Ÿå—åˆ°ä¸‰å¦¹å·²ç»å­¦åˆ°äº†çŸ¥è¯†ï¼Œæˆ‘ä¹Ÿå¾ˆæ¬£æ…°ã€‚

----


GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 5.8 Javaè®¿é—®æƒé™ä¿®é¥°ç¬¦

â€œæˆ‘ä»¬å…ˆæ¥è®¨è®ºä¸€ä¸‹ä¸ºä»€ä¹ˆéœ€è¦è®¿é—®æƒé™æ§åˆ¶ã€‚å…¶å®ä¹‹å‰æˆ‘ä»¬åœ¨è®²[ç±»å’Œå¯¹è±¡](https://tobebetterjavaer.com/oo/object-class.html)çš„æ—¶å€™æœ‰æåˆ°ï¼Œä»Šå¤©æˆ‘ä»¬æ¥è¯¦ç»†åœ°èŠä¸€èŠï¼Œä¸‰å¦¹ã€‚â€æˆ‘å¼€é—¨è§å±±åœ°è¯´ï¼Œâ€œä¸‰å¦¹ï¼Œä½ æ‰“å¼€æ€ç»´å¯¼å›¾ï¼Œè®°å¾—åšç¬”è®°å“¦ã€‚â€

â€œå¥½çš„ã€‚â€ä¸‰å¦¹åº”å£°å›ç­”ã€‚

è€ƒè™‘ä¸¤ä¸ªåœºæ™¯ï¼š

åœºæ™¯ 1ï¼šå·¥ç¨‹å¸ˆ A ç¼–å†™äº†ä¸€ä¸ªç±» ClassAï¼Œä½†æ˜¯å·¥ç¨‹å¸ˆ A å¹¶ä¸å¸Œæœ› ClassA è¢«å…¶ä»–ç±»éƒ½è®¿é—®åˆ°ï¼Œè¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ

åœºæ™¯ 2ï¼šå·¥ç¨‹å¸ˆ A ç¼–å†™äº†ä¸€ä¸ªç±» ClassAï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªæ–¹æ³• fun1ã€fun2ï¼Œå·¥ç¨‹å¸ˆåªæƒ³è®© fun1 å¯¹å¤–å¯è§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåˆ«çš„å·¥ç¨‹å¸ˆæ¥è°ƒç”¨ ClassAï¼Œåªå¯ä»¥è°ƒç”¨æ–¹æ³• fun1ï¼Œè¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ

æ­¤æ—¶ï¼Œè®¿é—®æƒé™æ§åˆ¶ä¾¿å¯ä»¥èµ·åˆ°ä½œç”¨äº†ã€‚

åœ¨ Java ä¸­ï¼Œæä¾›äº†å››ç§è®¿é—®æƒé™æ§åˆ¶ï¼š

- é»˜è®¤è®¿é—®æƒé™ï¼ˆåŒ…è®¿é—®æƒé™ï¼‰
- public
- private
- protected

ç±»åªå¯ä»¥ç”¨é»˜è®¤è®¿é—®æƒé™å’Œ public ä¿®é¥°ã€‚æ¯”å¦‚è¯´ï¼š

```java
public class Wanger{}
```

æˆ–è€…

```java
class Wanger{}
```

ä½†å˜é‡å’Œæ–¹æ³•åˆ™éƒ½å¯ä»¥ä¿®é¥°ã€‚

### 1. ä¿®é¥°ç±»

- é»˜è®¤è®¿é—®æƒé™ï¼ˆåŒ…è®¿é—®æƒé™ï¼‰ï¼šç”¨æ¥ä¿®é¥°ç±»çš„è¯ï¼Œè¡¨ç¤ºè¯¥ç±»åªå¯¹åŒä¸€ä¸ªåŒ…ä¸­çš„å…¶ä»–ç±»å¯è§ã€‚
- publicï¼šç”¨æ¥ä¿®é¥°ç±»çš„è¯ï¼Œè¡¨ç¤ºè¯¥ç±»å¯¹å…¶ä»–æ‰€æœ‰çš„ç±»éƒ½å¯è§ã€‚


ä¾‹ 1ï¼š

Main.java:

```java
package com.tobetterjavaer.test1;

public class Main {
	public static void main(String\[\] args) {

		People people = new People("Tom");
		System.out.println(people.getName());
	}

}
```

People.java

```java
package com.tobetterjavaer.test1;

class People {//é»˜è®¤è®¿é—®æƒé™ï¼ˆåŒ…è®¿é—®æƒé™ï¼‰

	private String name = null;

	public People(String name) {
		this.name = name;
	}

	public String getName() {
		return name;
	}

	public void setName(String name) {
		this.name = name;
	}
}
```

ä»ä»£ç å¯ä»¥çœ‹å‡ºï¼Œä¿®é¥° People ç±»é‡‡ç”¨çš„æ˜¯é»˜è®¤è®¿é—®æƒé™ï¼Œè€Œç”±äº People ç±»å’Œ Main ç±»åœ¨åŒä¸€ä¸ªåŒ…ä¸­ï¼Œå› æ­¤ People ç±»å¯¹äº Main ç±»æ˜¯å¯è§çš„ã€‚

ä¾‹å­ 2ï¼š

People.java

```java
package com.tobetterjavaer.test2;

class People {//é»˜è®¤è®¿é—®æƒé™ï¼ˆåŒ…è®¿é—®æƒé™ï¼‰

	private String name = null;

	public People(String name) {
		this.name = name;
	}

	public String getName() {
		return name;
	}

	public void setName(String name) {
		this.name = name;
	}
}
```

æ­¤æ—¶ People ç±»å’Œ Main ç±»ä¸åœ¨åŒä¸€ä¸ªåŒ…ä¸­ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ

ä¸‹é¢æ˜¯ Main ç±»ä¸­çš„æç¤ºçš„é”™è¯¯ï¼š


![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/bokeyuan-jianxijavazhongdifangwenquanxiankongzhi-154ae82f-72a5-45fc-ad3c-e1eb575d8572.png)


æç¤º Peolple ç±»åœ¨ Main ç±»ä¸­ä¸å¯è§ã€‚ä»è¿™é‡Œå°±å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœç”¨é»˜è®¤è®¿é—®æƒé™å»ä¿®é¥°ä¸€ä¸ªç±»ï¼Œè¯¥ç±»åªå¯¹åŒä¸€ä¸ªåŒ…ä¸­çš„å…¶ä»–ç±»å¯è§ï¼Œå¯¹äºä¸åŒåŒ…ä¸­çš„ç±»æ˜¯ä¸å¯è§çš„ã€‚

æ­£å¦‚ä¸Šå›¾çš„å¿«é€Ÿä¿®æ­£æç¤ºæ‰€ç¤ºï¼Œå°† People ç±»çš„é»˜è®¤è®¿é—®æƒé™æ›´æ”¹ä¸º public çš„è¯ï¼ŒPeople ç±»å¯¹äº Main ç±»ä¾¿å¯è§äº†ã€‚

### 2. ä¿®é¥°æ–¹æ³•å’Œå˜é‡

- é»˜è®¤è®¿é—®æƒé™ï¼ˆåŒ…è®¿é—®æƒé™ï¼‰ï¼šå¦‚æœä¸€ä¸ªç±»çš„æ–¹æ³•æˆ–å˜é‡è¢«åŒ…è®¿é—®æƒé™ä¿®é¥°ï¼Œä¹Ÿå°±æ„å‘³ç€åªèƒ½åœ¨åŒä¸€ä¸ªåŒ…ä¸­çš„å…¶ä»–ç±»ä¸­æ˜¾ç¤ºåœ°è°ƒç”¨è¯¥ç±»çš„æ–¹æ³•æˆ–è€…å˜é‡ï¼Œåœ¨ä¸åŒåŒ…ä¸­çš„ç±»ä¸­ä¸èƒ½æ˜¾å¼åœ°è°ƒç”¨è¯¥ç±»çš„æ–¹æ³•æˆ–å˜é‡ã€‚
- privateï¼šå¦‚æœä¸€ä¸ªç±»çš„æ–¹æ³•æˆ–è€…å˜é‡è¢« private ä¿®é¥°ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»çš„æ–¹æ³•æˆ–è€…å˜é‡åªèƒ½åœ¨è¯¥ç±»æœ¬èº«ä¸­è¢«è®¿é—®ï¼Œåœ¨ç±»å¤–ä»¥åŠå…¶ä»–ç±»ä¸­éƒ½ä¸èƒ½æ˜¾å¼çš„è¿›è¡Œè®¿é—®ã€‚
- protectedï¼šå¦‚æœä¸€ä¸ªç±»çš„æ–¹æ³•æˆ–è€…å˜é‡è¢« protected ä¿®é¥°ï¼Œå¯¹äºåŒä¸€ä¸ªåŒ…çš„ç±»ï¼Œè¿™ä¸ªç±»çš„æ–¹æ³•æˆ–å˜é‡æ˜¯å¯ä»¥è¢«è®¿é—®çš„ã€‚å¯¹äºä¸åŒåŒ…çš„ç±»ï¼Œåªæœ‰ç»§æ‰¿äºè¯¥ç±»çš„ç±»æ‰å¯ä»¥è®¿é—®åˆ°è¯¥ç±»çš„æ–¹æ³•æˆ–è€…å˜é‡ã€‚
- publicï¼šè¢« public ä¿®é¥°çš„æ–¹æ³•æˆ–è€…å˜é‡ï¼Œåœ¨ä»»ä½•åœ°æ–¹éƒ½æ˜¯å¯è§çš„ã€‚


ä¾‹ 3ï¼š

Main.java æ²¡æœ‰å˜åŒ–

People.java

```java
package com.tobebetterjavaer.test1;

public class People {

	private String name = null;

	public People(String name) {
		this.name = name;
	}

	String getName() {    //é»˜è®¤è®¿é—®æƒé™ï¼ˆåŒ…è®¿é—®æƒé™ï¼‰
		return name;
	}

	void setName(String name) {   //é»˜è®¤è®¿é—®æƒé™ï¼ˆåŒ…è®¿é—®æƒé™ï¼‰
		this.name = name;
	}
}
```

æ­¤æ—¶åœ¨ Main ç±»æ˜¯å¯ä»¥æ˜¾ç¤ºè°ƒç”¨æ–¹æ³• getName å’Œ setName çš„ã€‚

ä½†æ˜¯å¦‚æœ People ç±»å’Œ Main ç±»ä¸åœ¨åŒä¸€ä¸ªåŒ…ä¸­ï¼š

```java
package com.tobebetterjavaer.test2;    //ä¸Mainç±»å¤„äºä¸åŒåŒ…ä¸­

public class People {

	private String name = null;

	public People(String name) {
		this.name = name;
	}

	String getName() {    //é»˜è®¤è®¿é—®æƒé™ï¼ˆåŒ…è®¿é—®æƒé™ï¼‰
		return name;
	}

	void setName(String name) {   //é»˜è®¤è®¿é—®æƒé™ï¼ˆåŒ…è®¿é—®æƒé™ï¼‰
		this.name = name;
	}
}
```

æ­¤æ—¶åœ¨ Main ç±»ä¸­ä¼šæç¤ºé”™è¯¯ï¼š


![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/bokeyuan-jianxijavazhongdifangwenquanxiankongzhi-b3e9dc56-53e8-42f1-b8ee-35115edfe7e7.png)


ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœç”¨é»˜è®¤è®¿é—®æƒé™æ¥ä¿®é¥°ç±»çš„æ–¹æ³•æˆ–è€…å˜é‡ï¼Œåˆ™åªèƒ½åœ¨åŒä¸€ä¸ªåŒ…çš„å…¶ä»–ç±»ä¸­è¿›è¡Œè®¿é—®ã€‚

ä¾‹ 4:

People.java

```java
package com.tobebetterjavaer.test1;

public class People {

	private String name = null;

	public People(String name) {
		this.name = name;
	}

	protected String getName() {
		return name;
	}

	protected void setName(String name) {
		this.name = name;
	}
}
```

æ­¤æ—¶æ˜¯å¯ä»¥åœ¨ Main ä¸­æ˜¾ç¤ºè°ƒç”¨æ–¹æ³• getName å’Œ setName çš„ã€‚

å¦‚æœ People ç±»å’Œ Main ç±»å¤„äºä¸åŒåŒ…ä¸­ï¼š

```java
package com.tobebetterjavaer.test2;

public class People {

	private String name = null;

	public People(String name) {
		this.name = name;
	}

	protected String getName() {
		return name;
	}

	protected void setName(String name) {
		this.name = name;
	}
}
```

åˆ™ä¼šåœ¨ Main ä¸­æŠ¥é”™ï¼š


![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nice-article/bokeyuan-jianxijavazhongdifangwenquanxiankongzhi-b1d4b7ed-fc87-47d4-bdd9-3f6a8ea96100.png)


å¦‚æœåœ¨ com.cxh.test1 ä¸­å®šä¸€ä¸ªç±» Man ç»§æ‰¿ Peopleï¼Œåˆ™å¯ä»¥åœ¨ç±» Man ä¸­æ˜¾ç¤ºè°ƒç”¨æ–¹æ³• getName å’Œ setNameï¼š

```java
package com.tobebetterjavaer.test1;

import com.tobebetterjavaer.test2.People;

public class Man extends People {

    public Man(String name){
        super(name);
    }

    public String toString() {
        return getName();
    }
}
```

è¡¥å……ä¸€äº›å…³äº Java åŒ…å’Œç±»æ–‡ä»¶çš„çŸ¥è¯†ï¼š

1ï¼‰Java ä¸­çš„åŒ…ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢ç±»æ–‡ä»¶å‘½åå†²çªä»¥åŠæ–¹ä¾¿è¿›è¡Œä»£ç ç»„ç»‡å’Œç®¡ç†ï¼›

2ï¼‰å¯¹äºä¸€ä¸ª Java æºä»£ç æ–‡ä»¶ï¼Œå¦‚æœå­˜åœ¨ public ç±»çš„è¯ï¼Œåªèƒ½æœ‰ä¸€ä¸ª public ç±»ï¼Œä¸”æ­¤æ—¶æºä»£ç æ–‡ä»¶çš„åç§°å¿…é¡»å’Œ public ç±»çš„åç§°å®Œå…¨ç›¸åŒã€‚

å¦å¤–ï¼Œå¦‚æœè¿˜å­˜åœ¨å…¶ä»–ç±»ï¼Œè¿™äº›ç±»åœ¨åŒ…å¤–æ˜¯ä¸å¯è§çš„ã€‚å¦‚æœæºä»£ç æ–‡ä»¶æ²¡æœ‰ public ç±»ï¼Œåˆ™æºä»£ç æ–‡ä»¶çš„åç§°å¯ä»¥éšæ„å‘½åã€‚

â€œä¸‰å¦¹ï¼Œç†è§£äº†å§ï¼Ÿâ€æˆ‘é—®ä¸‰å¦¹ã€‚

â€œæ˜¯çš„ï¼Œå¾ˆç®€å•ï¼Œæ¢å¥è¯è¯´ï¼Œä¸æƒ³è®©åˆ«äººçœ‹çš„å°± privateï¼Œæƒ³è®©äººçœ‹çš„å°± publicï¼Œæƒ³åŒä¸€ä¸ªç­çº§/éƒ¨é—¨çœ‹çš„å°±é»˜è®¤ï¼Œæƒ³è®©ä¸‹ä¸€çº§çœ‹çš„å°± protectedï¼Œå¯¹å§ï¼Ÿå“¥â€ä¸‰å¦¹å¾ˆè‡ªä¿¡åœ°å›ç­”ã€‚

â€œä¸é”™ä¸é”™ï¼Œæ€»ç»“å¾—æœ‰é‚£å‘³äº†ã€‚â€

>åŸæ–‡é“¾æ¥ï¼š[https://www.cnblogs.com/dolphin0520/p/3734915.html](https://www.cnblogs.com/dolphin0520/p/3734915.html) ä½œè€…: Matrixæµ·å­ï¼Œç¼–è¾‘ï¼šæ²‰é»˜ç‹äºŒ

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 5.9 Javaä»£ç åˆå§‹åŒ–å—

â€œå“¥ï¼Œä»Šå¤©æˆ‘ä»¬è¦å­¦ä¹ çš„å†…å®¹æ˜¯â€˜ä»£ç åˆå§‹åŒ–å—â€™ï¼Œå¯¹å§ï¼Ÿâ€çœ‹æ¥ä¸‰å¦¹å·²ç»æå‰é¢„ä¹ äº†æˆ‘ä¸Šæ¬¡ç•™ç»™å¥¹çš„ä½œä¸šã€‚

â€œæ˜¯çš„ï¼Œä¸‰å¦¹ã€‚ä»£ç åˆå§‹åŒ–å—ç”¨äºåˆå§‹åŒ–ä¸€äº›[æˆå‘˜å˜é‡](https://tobebetterjavaer.com/oo/var.html)ã€‚ â€æˆ‘é¢å¸¦ç€æœ´å®æ— åçš„å¾®ç¬‘å›ç­”ç€å¥¹ï¼Œâ€œå¯¹è±¡åœ¨åˆ›å»ºçš„æ—¶å€™ä¼šæ‰§è¡Œä»£ç åˆå§‹åŒ–å—ï¼Œåˆç§°å®ä¾‹åˆå§‹åŒ–å—ï¼Œä¸»è¦å’Œé™æ€åˆå§‹åŒ–å—åšåŒºåˆ†ã€‚â€

â€œå¯ä»¥ç›´æ¥é€šè¿‡â€˜=â€™æ“ä½œç¬¦å¯¹æˆå‘˜å˜é‡è¿›è¡Œåˆå§‹åŒ–ï¼Œä½†é€šè¿‡ä»£ç åˆå§‹åŒ–å—å¯ä»¥åšæ›´å¤šçš„äº‹æƒ…ï¼Œæ¯”å¦‚è¯´æ‰“å°å‡ºæˆå‘˜å˜é‡åˆå§‹åŒ–åçš„å€¼ã€‚â€

â€œä¸‰å¦¹ï¼Œæ¥çœ‹ä¸‹é¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ `=` æ“ä½œç¬¦å¯¹æˆå‘˜å˜é‡è¿›è¡Œåˆå§‹åŒ–ã€‚â€

```java
class Bike{  
    int speed=100;  
}  
```

â€œå“¥ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜éœ€è¦ä»£ç åˆå§‹åŒ–å—å‘¢ï¼Ÿâ€ä¸‰å¦¹çœ¨äº†çœ¨çœ¼ç›ï¼Œä¸è§£åœ°é—®ã€‚

â€œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»£ç åˆå§‹åŒ–å—æ‰§è¡Œä¸€ä¸ªæ›´å¤æ‚çš„æ“ä½œï¼Œæ¯”å¦‚ä¸ºé›†åˆå¡«å……å€¼ã€‚æ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ã€‚â€

```java
public class Bike {
    List<String> list;

    {
        list = new ArrayList<>();
        list.add("æ²‰é»˜ç‹äºŒ");
        list.add("æ²‰é»˜ç‹ä¸‰");
    }

    public static void main(String[] args) {
        System.out.println(new Bike().list);
    }
}
```

â€œå¦‚æœåªä½¿ç”¨â€˜=â€™æ“ä½œç¬¦çš„è¯ï¼Œæ˜¯æ²¡åŠæ³•å®Œæˆé›†åˆåˆå§‹åŒ–çš„ï¼Œå¯¹å§ï¼Ÿâ€˜=â€™ åé¢åªèƒ½ new å‡ºé›†åˆï¼Œå´æ²¡åŠæ³•å¡«å……å€¼ï¼Œä»£ç åˆå§‹åŒ–å°±å¯ä»¥å®Œæˆè¿™é¡¹å·¥ä½œã€‚â€

â€œ[æ„é€ æ–¹æ³•](https://tobebetterjavaer.com/oo/construct.html)æ‰§è¡Œå¾—æ—©è¿˜æ˜¯ä»£ç åˆå§‹åŒ–å—å•Šï¼Œå“¥ï¼Ÿâ€ä¸‰å¦¹è¿™ä¸ªé—®é¢˜é—®çš„è¿˜æ˜¯æŒºæœ‰æ°´å¹³çš„ã€‚

â€œä¸è¦ç€æ€¥ï¼Œä¸‰å¦¹ï¼Œå…ˆæ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ã€‚â€

```java
public class Car {
    Car() {
        System.out.println("æ„é€ æ–¹æ³•");
    }

    {
        System.out.println("ä»£ç åˆå§‹åŒ–å—");
    }

    public static void main(String[] args) {
        new Car();
    }
}
```

â€œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„è¾“å‡ºç»“æœå°±ä¸€ä¸‹å­æ˜ç™½äº†ã€‚â€

```
ä»£ç åˆå§‹åŒ–å—
æ„é€ æ–¹æ³•
```

â€œä»è¾“å‡ºç»“æœçœ‹ä¸Šå»ï¼Œä»¿ä½›ä»£ç åˆå§‹åŒ–å—æ‰§è¡Œå¾—æ›´æ—©ï¼Œå¯¹å§ï¼Ÿäº‹å®ä¸Šæ˜¯è¿™æ ·å­å—ï¼Ÿâ€æˆ‘éœ²å‡ºç¥ç§˜çš„å¾®ç¬‘ï¼Œé—®ä¸‰å¦¹ã€‚

â€œéš¾é“æˆ‘çœ‹åˆ°çš„æ˜¯å‡è±¡å—ï¼Ÿâ€ä¸‰å¦¹çå¤§äº†çœ¼ç›ã€‚

â€œä¸æ˜¯çš„ï¼Œå¯¹è±¡åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šå…ˆè°ƒç”¨æ„é€ æ–¹æ³•ï¼Œè¿™æ˜¯æ¯«æ— ç–‘é—®çš„ï¼Œåªä¸è¿‡ï¼Œæ„é€ æ–¹æ³•åœ¨æ‰§è¡Œçš„æ—¶å€™ä¼šæŠŠä»£ç åˆå§‹åŒ–å—æ”¾åœ¨æ„é€ æ–¹æ³•ä¸­å…¶ä»–ä»£ç ä¹‹å‰ï¼Œæ‰€ä»¥ï¼Œå…ˆçœ‹åˆ°äº†â€˜ä»£ç åˆå§‹åŒ–å—â€™ï¼Œåçœ‹åˆ°äº†â€˜â€™æ„é€ æ–¹æ³•â€™ã€‚â€

è¯´å®Œè¿™å¥è¯ï¼Œæˆ‘æ‰“å¼€ draw.ioï¼Œä½¿ä¸Šäº†åƒå¥¶çš„åŠ²ï¼Œç”»å‡ºäº†ä¸‹é¢è¿™å¹…å›¾ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/object-class/22-01.png)

â€œå“¦ï¼ŒåŸæ¥å¦‚æ­¤å•Šï¼â€ä¸‰å¦¹ä»¿ä½›å‘ç°äº†æ–°å¤§é™†ï¼Œæ„å‘³æ·±é•¿åœ°è¯´ï¼Œâ€œç¼–è¯‘å™¨æŠŠä»£ç åˆå§‹åŒ–å—æ”¾åˆ°äº†æ„é€ æ–¹æ³•ä¸­ï¼Œæ€ªä¸å¾—ã€‚â€

ç­‰ä¸‰å¦¹æ˜ç™½å½»åº•ææ˜ç™½åï¼Œæˆ‘å¯¹å¥¹ç»§ç»­è¯´é“ï¼šâ€œå¯¹äºä»£ç åˆå§‹åŒ–æ¥è¯´ï¼Œå®ƒæœ‰ä¸‰ä¸ªè§„åˆ™ã€‚â€

- ç±»å®ä¾‹åŒ–çš„æ—¶å€™æ‰§è¡Œä»£ç åˆå§‹åŒ–å—ï¼›
- å®é™…ä¸Šï¼Œä»£ç åˆå§‹åŒ–å—æ˜¯æ”¾åœ¨æ„é€ æ–¹æ³•ä¸­æ‰§è¡Œçš„ï¼Œåªä¸è¿‡æ¯”è¾ƒé å‰ï¼›
- ä»£ç åˆå§‹åŒ–å—é‡Œçš„æ‰§è¡Œé¡ºåºæ˜¯ä»å‰åˆ°åçš„ã€‚

â€œè¿™äº›è§„åˆ™ä¸ç”¨æ­»è®°ç¡¬èƒŒï¼Œå¤§è‡´äº†è§£ä¸€ä¸‹å°±è¡Œäº†ã€‚æˆ‘ä»¬ç»§ç»­æ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ã€‚â€è¯éŸ³åˆšè½ï¼Œæˆ‘å°±åœ¨æ–°ç‰ˆçš„ IDEA ä¸­å™¼é‡Œå•ªå•¦åœ°æ•²äº†èµ·æ¥ï¼Œæ–°ç‰ˆçœŸé¦™ã€‚

```java
class A {
    A () {
        System.out.println("çˆ¶ç±»æ„é€ æ–¹æ³•");
    }
}
public class B extends A{
    B() {
        System.out.println("å­ç±»æ„é€ æ–¹æ³•");
    }

    {
        System.out.println("ä»£ç åˆå§‹åŒ–å—");
    }

    public static void main(String[] args) {
        new B();
    }
}
```

â€œæ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœã€‚â€

```
çˆ¶ç±»æ„é€ æ–¹æ³•
ä»£ç åˆå§‹åŒ–å—
å­ç±»æ„é€ æ–¹æ³•
```

â€œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå­ç±»çš„æ„é€ æ–¹æ³•åœ¨æ‰§è¡Œçš„æ—¶å€™ä¼šä¸»åŠ¨å»è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…¶å®æ˜¯æ„é€ æ–¹æ³•å…ˆæ‰§è¡Œçš„ï¼Œå†æ‰§è¡Œçš„ä»£ç åˆå§‹åŒ–å—ã€‚â€

â€œè¿™ä¸ªä¾‹å­å†æ¬¡å°è¯äº†ä¹‹å‰çš„ç¬¬äºŒæ¡è§„åˆ™ï¼šä»£ç åˆå§‹åŒ–å—æ˜¯æ”¾åœ¨æ„é€ æ–¹æ³•ä¸­æ‰§è¡Œçš„ï¼Œåªä¸è¿‡æ¯”è¾ƒé å‰ã€‚â€

é™¤äº†è¿™ç§å®ä¾‹åŒ–ä»£ç åˆå§‹åŒ–å—ï¼Œè¿˜æœ‰é™æ€åˆå§‹åŒ–ï¼Œä¸è¿‡æˆ‘ä»¬ä¼šæ”¾åˆ° [static å…³é”®å­—](https://tobebetterjavaer.com/oo/static.html)ä¸­å»è®²ï¼Œè¿™é‡Œå…ˆå¤§è‡´äº†è§£ä¸€ä¸‹ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ª Java ç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå®ä¾‹åˆå§‹åŒ–å—å’Œé™æ€åˆå§‹åŒ–å—çš„ç”¨æ³•ï¼š

```java
public class Example {
    // é™æ€å˜é‡
    public static int staticVar = 1;
    // å®ä¾‹å˜é‡
    public int instanceVar = 2;

    // é™æ€åˆå§‹åŒ–å—
    static {
        System.out.println("æ‰§è¡Œé™æ€åˆå§‹åŒ–å—");
        staticVar = 3;
    }

    // å®ä¾‹åˆå§‹åŒ–å—
    {
        System.out.println("æ‰§è¡Œå®ä¾‹åˆå§‹åŒ–å—");
        instanceVar = 4;
    }

    // æ„é€ æ–¹æ³•
    public Example() {
        System.out.println("æ‰§è¡Œæ„é€ æ–¹æ³•");
    }

    public static void main(String[] args) {
        System.out.println("æ‰§è¡Œmainæ–¹æ³•");

        Example e1 = new Example();
        Example e2 = new Example();

        System.out.println("e1çš„é™æ€å˜é‡ï¼š" + e1.staticVar);
        System.out.println("e1çš„å®ä¾‹å˜é‡ï¼š" + e1.instanceVar);
        System.out.println("e2çš„é™æ€å˜é‡ï¼š" + e2.staticVar);
        System.out.println("e2çš„å®ä¾‹å˜é‡ï¼š" + e2.instanceVar);
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä»£ç ä¸­ï¼Œæœ‰ä¸€ä¸ªé™æ€å˜é‡ staticVar å’Œä¸€ä¸ªå®ä¾‹å˜é‡ instanceVarï¼Œä»¥åŠä¸€ä¸ªé™æ€åˆå§‹åŒ–å—å’Œä¸€ä¸ªå®ä¾‹åˆå§‹åŒ–å—ã€‚åœ¨é™æ€åˆå§‹åŒ–å—ä¸­ï¼Œæˆ‘ä»¬æ‰“å°äº†ä¸€æ¡æ¶ˆæ¯å¹¶ä¿®æ”¹äº†é™æ€å˜é‡çš„å€¼ï¼›åœ¨å®ä¾‹åˆå§‹åŒ–å—ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿæ‰“å°äº†ä¸€æ¡æ¶ˆæ¯å¹¶ä¿®æ”¹äº†å®ä¾‹å˜é‡çš„å€¼ã€‚

æ¥çœ‹ä¸€ä¸‹æ‰§è¡Œç»“æœï¼š

```
æ‰§è¡Œé™æ€åˆå§‹åŒ–å—
æ‰§è¡Œmainæ–¹æ³•
æ‰§è¡Œå®ä¾‹åˆå§‹åŒ–å—
æ‰§è¡Œæ„é€ æ–¹æ³•
æ‰§è¡Œå®ä¾‹åˆå§‹åŒ–å—
æ‰§è¡Œæ„é€ æ–¹æ³•
e1çš„é™æ€å˜é‡ï¼š3
e1çš„å®ä¾‹å˜é‡ï¼š4
e2çš„é™æ€å˜é‡ï¼š3
e2çš„å®ä¾‹å˜é‡ï¼š4
```

ä»è¾“å‡ºç»“æœå¯ä»¥çœ‹å‡ºï¼Œé™æ€åˆå§‹åŒ–å—åœ¨ç±»åŠ è½½æ—¶æ‰§è¡Œï¼Œåªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”ä¼˜å…ˆäºå®ä¾‹åˆå§‹åŒ–å—å’Œæ„é€ æ–¹æ³•çš„æ‰§è¡Œï¼›å®ä¾‹åˆå§‹åŒ–å—åœ¨æ¯æ¬¡åˆ›å»ºå¯¹è±¡æ—¶æ‰§è¡Œï¼Œåœ¨æ„é€ æ–¹æ³•ä¹‹å‰æ‰§è¡Œã€‚

â€œå¥½äº†ï¼Œä»Šå¤©å°±å…ˆè®²åˆ°è¿™å§ï¼Œä¸­åˆä¼‘æ¯ä¸€ä¸‹ï¼Œä¸‹åˆçš„ç²¾ç¥ä¼šæ›´è¶³ã€‚â€åˆšå¯¹ä¸‰å¦¹è¯´å®Œè¿™å¥è¯ï¼Œæˆ‘çš„å“ˆæ¬ å°±ä¸Šæ¥äº†ï¼Œå¥½å›°ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 5.10 JavaæŠ½è±¡ç±»

â€œäºŒå“¥ï¼Œä½ è¿™æ˜æ˜¾åŠ å¿«äº†æ›´æ–°çš„é¢‘ç‡å‘€ï¼â€ä¸‰å¦¹å¯¹äºæˆ‘æœ€è¿‘çš„è‚åŠ²ç”±è¡·çš„ä½©æœäº†èµ·æ¥ã€‚

â€œå“ˆå“ˆï¼Œæ˜¯å‘€ï¼Œæˆ‘è¦ç»™å¹¿å¤§çš„å­¦å¼Ÿå­¦å¦¹ä»¬ä¸€ä¸ªå®Œæ•´çš„ Java å­¦ä¹ ä½“ç³»ï¼Œè®°ä½æˆ‘ä»¬çš„å£å·ï¼Œ**å­¦ Java å°±ä¸ŠäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯**ã€‚â€æˆ‘å¯¹æœªæ¥å……æ»¡äº†ä¿¡å¿ƒã€‚

â€œé‚£å°±å¼€å§‹å§ã€‚â€ä¸‰å¦¹è¯´ã€‚

### 01ã€å®šä¹‰æŠ½è±¡ç±»

å®šä¹‰æŠ½è±¡ç±»çš„æ—¶å€™éœ€è¦ç”¨åˆ°å…³é”®å­— `abstract`ï¼Œæ”¾åœ¨ `class` å…³é”®å­—å‰ï¼Œå°±åƒä¸‹é¢è¿™æ ·ã€‚

```java
abstract class AbstractPlayer {
}
```

å…³äºæŠ½è±¡ç±»çš„å‘½åï¼Œã€Š[é˜¿é‡Œçš„ Java å¼€å‘æ‰‹å†Œ](https://tobebetterjavaer.com/pdf/ali-java-shouce.html)ã€‹ä¸Šæœ‰å¼ºè°ƒï¼Œâ€œæŠ½è±¡ç±»å‘½åè¦ä½¿ç”¨ Abstract æˆ– Base å¼€å¤´â€ï¼Œè¿™æ¡è§„çº¦è¿˜æ˜¯å€¼å¾—éµå®ˆçš„ï¼ŒçœŸæ­£åšåˆ°åå¦‚å…¶æ„ã€‚

### 02ã€æŠ½è±¡ç±»çš„ç‰¹å¾

æŠ½è±¡ç±»æ˜¯ä¸èƒ½å®ä¾‹åŒ–çš„ï¼Œå°è¯•é€šè¿‡ `new` å…³é”®å­—å®ä¾‹åŒ–çš„è¯ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œæç¤ºâ€œç±»æ˜¯æŠ½è±¡çš„ï¼Œä¸èƒ½å®ä¾‹åŒ–â€ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/object-class/abstract-01.png)

è™½ç„¶æŠ½è±¡ç±»ä¸èƒ½å®ä¾‹åŒ–ï¼Œä½†å¯ä»¥æœ‰å­ç±»ã€‚å­ç±»é€šè¿‡ `extends` å…³é”®å­—æ¥ç»§æ‰¿æŠ½è±¡ç±»ã€‚å°±åƒä¸‹é¢è¿™æ ·ã€‚

```java
public class BasketballPlayer extends AbstractPlayer {
}
```

å¦‚æœä¸€ä¸ªç±»å®šä¹‰äº†ä¸€ä¸ªæˆ–å¤šä¸ªæŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å¿…é¡»æ˜¯æŠ½è±¡ç±»ã€‚

å½“æˆ‘ä»¬å°è¯•åœ¨ä¸€ä¸ªæ™®é€šç±»ä¸­å®šä¹‰æŠ½è±¡æ–¹æ³•çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¼šæœ‰ä¸¤å¤„é”™è¯¯æç¤ºã€‚ç¬¬ä¸€å¤„åœ¨ç±»çº§åˆ«ä¸Šï¼Œæç¤ºâ€œè¿™ä¸ªç±»å¿…é¡»é€šè¿‡ `abstract` å…³é”®å­—å®šä¹‰â€ï¼Œè§ä¸‹å›¾ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/object-class/abstract-02.png)

ç¬¬äºŒå¤„åœ¨å°è¯•å®šä¹‰ abstract çš„æ–¹æ³•ä¸Šï¼Œæç¤ºâ€œæŠ½è±¡æ–¹æ³•æ‰€åœ¨çš„ç±»ä¸æ˜¯æŠ½è±¡çš„â€ï¼Œè§ä¸‹å›¾ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/object-class/abstract-03.png)

æŠ½è±¡ç±»ä¸­æ—¢å¯ä»¥å®šä¹‰æŠ½è±¡æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥å®šä¹‰æ™®é€šæ–¹æ³•ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š

```java
public abstract class AbstractPlayer {
    abstract void play();
    
    public void sleep() {
        System.out.println("è¿åŠ¨å‘˜ä¹Ÿè¦ä¼‘æ¯è€Œä¸æ˜¯æŒ‘æˆ˜æé™");
    }
}
```

æŠ½è±¡ç±»æ´¾ç”Ÿçš„å­ç±»å¿…é¡»å®ç°çˆ¶ç±»ä¸­å®šä¹‰çš„æŠ½è±¡æ–¹æ³•ã€‚æ¯”å¦‚è¯´ï¼ŒæŠ½è±¡ç±» AbstractPlayer ä¸­å®šä¹‰äº† `play()` æ–¹æ³•ï¼Œå­ç±» BasketballPlayer ä¸­å°±å¿…é¡»å®ç°ã€‚

```java
public class BasketballPlayer extends AbstractPlayer {
    @Override
    void play() {
        System.out.println("æˆ‘æ˜¯å¼ ä¼¯ä¼¦ï¼Œç¯®çƒåœºä¸Šå¾—è¿‡ 100 åˆ†");
    }
}
```

å¦‚æœæ²¡æœ‰å®ç°çš„è¯ï¼Œç¼–è¯‘å™¨ä¼šæç¤ºâ€œå­ç±»å¿…é¡»å®ç°æŠ½è±¡æ–¹æ³•â€ï¼Œè§ä¸‹å›¾ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/object-class/abstract-04.png)

### 03ã€æŠ½è±¡ç±»çš„åº”ç”¨åœºæ™¯

â€œäºŒå“¥ï¼ŒæŠ½è±¡æ–¹æ³•æˆ‘æ˜ç™½äº†ï¼Œé‚£ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æŠ½è±¡æ–¹æ³•å‘¢ï¼Ÿèƒ½ç»™æˆ‘è®²è®²å®ƒçš„åº”ç”¨åœºæ™¯å—ï¼Ÿâ€ä¸‰å¦¹åŠæ—¶çš„æ’è¯é“ã€‚

â€œè¿™é—®é¢˜é—®çš„æ°åˆ°å¥½å¤„å‘€ï¼â€æˆ‘æ‰¶äº†æ‰¶çœ¼é•œç»§ç»­è¯´ã€‚

#### **01ï¼‰ç¬¬ä¸€ç§åœºæ™¯**

å½“æˆ‘ä»¬å¸Œæœ›ä¸€äº›é€šç”¨çš„åŠŸèƒ½è¢«å¤šä¸ªå­ç±»å¤ç”¨çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨æŠ½è±¡ç±»ã€‚æ¯”å¦‚è¯´ï¼ŒAbstractPlayer æŠ½è±¡ç±»ä¸­æœ‰ä¸€ä¸ªæ™®é€šçš„æ–¹æ³• `sleep()`ï¼Œè¡¨æ˜æ‰€æœ‰è¿åŠ¨å‘˜éƒ½éœ€è¦ä¼‘æ¯ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å°±å¯ä»¥è¢«å­ç±»å¤ç”¨ã€‚

```java
abstract class AbstractPlayer {
    public void sleep() {
        System.out.println("è¿åŠ¨å‘˜ä¹Ÿè¦ä¼‘æ¯è€Œä¸æ˜¯æŒ‘æˆ˜æé™");
    }
}
```

å­ç±» BasketballPlayer ç»§æ‰¿äº† AbstractPlayer ç±»ï¼š

```java
class BasketballPlayer extends AbstractPlayer {
}
```

ä¹Ÿå°±æ‹¥æœ‰äº† `sleep()` æ–¹æ³•ã€‚BasketballPlayer çš„å¯¹è±¡å¯ä»¥ç›´æ¥è°ƒç”¨çˆ¶ç±»çš„ `sleep()` æ–¹æ³•ï¼š

```java
BasketballPlayer basketballPlayer = new BasketballPlayer();
basketballPlayer.sleep();
```

å­ç±» FootballPlayer ç»§æ‰¿äº† AbstractPlayer ç±»ï¼š

```java
class FootballPlayer extends AbstractPlayer {
}
```

ä¹Ÿæ‹¥æœ‰äº† `sleep()` æ–¹æ³•ï¼ŒFootballPlayer çš„å¯¹è±¡ä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨çˆ¶ç±»çš„ `sleep()` æ–¹æ³•ï¼š

```java
FootballPlayer footballPlayer = new FootballPlayer();
footballPlayer.sleep();
```

è¿™æ ·æ˜¯ä¸æ˜¯å°±å®ç°äº†ä»£ç çš„å¤ç”¨å‘¢ï¼Ÿ

#### **02ï¼‰ç¬¬äºŒç§åœºæ™¯**

å½“æˆ‘ä»¬éœ€è¦åœ¨æŠ½è±¡ç±»ä¸­å®šä¹‰å¥½ APIï¼Œç„¶ååœ¨å­ç±»ä¸­æ‰©å±•å®ç°çš„æ—¶å€™å°±å¯ä»¥ä½¿ç”¨æŠ½è±¡ç±»ã€‚æ¯”å¦‚è¯´ï¼ŒAbstractPlayer  æŠ½è±¡ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡æ–¹æ³• `play()`ï¼Œè¡¨æ˜æ‰€æœ‰è¿åŠ¨å‘˜éƒ½å¯ä»¥ä»äº‹æŸé¡¹è¿åŠ¨ï¼Œä½†éœ€è¦å¯¹åº”å­ç±»å»æ‰©å±•å®ç°ï¼Œè¡¨æ˜ç¯®çƒè¿åŠ¨å‘˜æ‰“ç¯®çƒï¼Œè¶³çƒè¿åŠ¨å‘˜è¸¢è¶³çƒã€‚

```java
abstract class AbstractPlayer {
    abstract void play();
}
```

BasketballPlayer ç»§æ‰¿äº† AbstractPlayer ç±»ï¼Œæ‰©å±•å®ç°äº†è‡ªå·±çš„ `play()` æ–¹æ³•ã€‚

```java
public class BasketballPlayer extends AbstractPlayer {
    @Override
    void play() {
        System.out.println("æˆ‘æ˜¯å¼ ä¼¯ä¼¦ï¼Œæˆ‘ç¯®çƒåœºä¸Šå¾—è¿‡ 100 åˆ†ï¼Œ");
    }
}
```

FootballPlayer ç»§æ‰¿äº† AbstractPlayer ç±»ï¼Œæ‰©å±•å®ç°äº†è‡ªå·±çš„ `play()` æ–¹æ³•ã€‚

```java
public class FootballPlayer extends AbstractPlayer {
    @Override
    void play() {
        System.out.println("æˆ‘æ˜¯Cç½—ï¼Œæˆ‘èƒ½æ¥ä½ä»»æ„é«˜åº¦çš„å¤´çƒ");
    }
}
```

ä¸ºäº†è¿›ä¸€æ­¥å±•ç¤ºæŠ½è±¡ç±»çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªå…·ä½“çš„ç¤ºä¾‹ã€‚

>PSï¼š[ç½‘ç«™](https://tobebetterjavaer.com/oo/abstract.html)è¯„è®ºåŒºè¯´æ¶‰åŠåˆ°äº†æ–‡ä»¶çš„è¯»å†™ä»¥åŠ Java 8 çš„æ–°ç‰¹æ€§ï¼Œä¸é€‚åˆæ–°äººï¼Œå¦‚æœè§‰å¾—è‡ªå·±å®åœ¨æ˜¯çœ‹ä¸æ‡‚ï¼Œè·³è¿‡ï¼Œç­‰å­¦äº† IO æµå†æ¥çœ‹ä¹Ÿè¡Œã€‚å¦‚æœè¯´æ˜¯ä¸ºäº†å¤ä¹  Java åŸºç¡€çŸ¥è¯†ï¼Œå°±ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜äº†ã€‚

å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œé‡Œé¢çš„å†…å®¹éå¸¸ç®€å•ï¼Œåªæœ‰ä¸€ä¸ªâ€œHello Worldâ€ï¼Œç°åœ¨éœ€è¦æœ‰ä¸€ä¸ªè¯»å–å™¨å°†å†…å®¹ä»æ–‡ä»¶ä¸­è¯»å–å‡ºæ¥ï¼Œæœ€å¥½èƒ½æŒ‰ç…§å¤§å†™çš„æ–¹å¼ï¼Œæˆ–è€…å°å†™çš„æ–¹å¼æ¥è¯»ã€‚

è¿™æ—¶å€™ï¼Œæœ€å¥½å®šä¹‰ä¸€ä¸ªæŠ½è±¡ç±» BaseFileReaderï¼š

```java
/**
 * æŠ½è±¡ç±»ï¼Œå®šä¹‰äº†ä¸€ä¸ªè¯»å–æ–‡ä»¶çš„åŸºç¡€æ¡†æ¶ï¼Œå…¶ä¸­ mapFileLine æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå…·ä½“å®ç°éœ€è¦ç”±å­ç±»æ¥å®Œæˆ
 */
abstract class BaseFileReader {
    protected Path filePath; // å®šä¹‰ä¸€ä¸ª protected çš„ Path å¯¹è±¡ï¼Œè¡¨ç¤ºè¯»å–çš„æ–‡ä»¶è·¯å¾„

    /**
     * æ„é€ æ–¹æ³•ï¼Œä¼ å…¥è¯»å–çš„æ–‡ä»¶è·¯å¾„
     * @param filePath è¯»å–çš„æ–‡ä»¶è·¯å¾„
     */
    protected BaseFileReader(Path filePath) {
        this.filePath = filePath;
    }

    /**
     * è¯»å–æ–‡ä»¶çš„æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨
     * @return å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œè¡¨ç¤ºæ–‡ä»¶çš„å†…å®¹
     * @throws IOException å¦‚æœæ–‡ä»¶è¯»å–å‡ºé”™ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸
     */
    public List<String> readFile() throws IOException {
        return Files.lines(filePath) // ä½¿ç”¨ Files ç±»çš„ lines æ–¹æ³•ï¼Œè¯»å–æ–‡ä»¶çš„æ¯ä¸€è¡Œ
                .map(this::mapFileLine) // å¯¹æ¯ä¸€è¡Œåº”ç”¨ mapFileLine æ–¹æ³•ï¼Œå°†å…¶è½¬åŒ–ä¸ºæŒ‡å®šçš„æ ¼å¼
                .collect(Collectors.toList()); // å°†å¤„ç†åçš„æ¯ä¸€è¡Œæ”¶é›†åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ä¸­ï¼Œè¿”å›
    }

    /**
     * æŠ½è±¡æ–¹æ³•ï¼Œå­ç±»éœ€è¦å®ç°è¯¥æ–¹æ³•ï¼Œå°†æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œè½¬åŒ–ä¸ºæŒ‡å®šçš„æ ¼å¼
     * @param line æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œ
     * @return è½¬åŒ–åçš„å­—ç¬¦ä¸²
     */
    protected abstract String mapFileLine(String line);
}
```

- filePath ä¸ºæ–‡ä»¶è·¯å¾„ï¼Œä½¿ç”¨ protected ä¿®é¥°ï¼Œè¡¨æ˜è¯¥æˆå‘˜å˜é‡å¯ä»¥åœ¨éœ€è¦æ—¶è¢«å­ç±»è®¿é—®åˆ°ã€‚

- `readFile()` æ–¹æ³•ç”¨æ¥è¯»å–æ–‡ä»¶ï¼Œæ–¹æ³•ä½“é‡Œé¢è°ƒç”¨äº†æŠ½è±¡æ–¹æ³• `mapFileLine()`â€”â€”éœ€è¦å­ç±»æ¥æ‰©å±•å®ç°å¤§å°å†™çš„ä¸åŒè¯»å–æ–¹å¼ã€‚

åœ¨æˆ‘çœ‹æ¥ï¼ŒBaseFileReader ç±»è®¾è®¡çš„å°±éå¸¸åˆç†ï¼Œå¹¶ä¸”æ˜“äºæ‰©å±•ï¼Œå­ç±»åªéœ€è¦ä¸“æ³¨äºå…·ä½“çš„å¤§å°å†™å®ç°æ–¹å¼å°±å¯ä»¥äº†ã€‚

å°å†™çš„æ–¹å¼ï¼š

```java
class LowercaseFileReader extends BaseFileReader {
    protected LowercaseFileReader(Path filePath) {
        super(filePath);
    }

    @Override
    protected String mapFileLine(String line) {
        return line.toLowerCase();
    }
}
```

å¤§å†™çš„æ–¹å¼ï¼š

```java
class UppercaseFileReader extends BaseFileReader {
    protected UppercaseFileReader(Path filePath) {
        super(filePath);
    }

    @Override
    protected String mapFileLine(String line) {
        return line.toUpperCase();
    }
}
```

ä»æ–‡ä»¶é‡Œé¢ä¸€è¡Œä¸€è¡Œè¯»å–å†…å®¹çš„ä»£ç è¢«å­ç±»å¤ç”¨äº†ã€‚ä¸æ­¤åŒæ—¶ï¼Œå­ç±»åªéœ€è¦ä¸“æ³¨äºè‡ªå·±è¯¥åšçš„å·¥ä½œï¼ŒLowercaseFileReader ä»¥å°å†™çš„æ–¹å¼è¯»å–æ–‡ä»¶å†…å®¹ï¼ŒUppercaseFileReader ä»¥å¤§å†™çš„æ–¹å¼è¯»å–æ–‡ä»¶å†…å®¹ã€‚

æ¥çœ‹ä¸€ä¸‹æµ‹è¯•ç±» FileReaderTestï¼š

```java
public class FileReaderTest {
    public static void main(String[] args) throws URISyntaxException, IOException {
        URL location = FileReaderTest.class.getClassLoader().getResource("helloworld.txt");
        Path path = Paths.get(location.toURI());
        BaseFileReader lowercaseFileReader = new LowercaseFileReader(path);
        BaseFileReader uppercaseFileReader = new UppercaseFileReader(path);
        System.out.println(lowercaseFileReader.readFile());
        System.out.println(uppercaseFileReader.readFile());
    }
}
```

åœ¨é¡¹ç›®çš„ resource ç›®å½•ä¸‹å»ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œåå­—å« helloworld.txtï¼Œé‡Œé¢çš„å†…å®¹å°±æ˜¯â€œHello Worldâ€ã€‚æ–‡ä»¶çš„å…·ä½“ä½ç½®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ç”¨çš„é›†æˆå¼€å‘ç¯å¢ƒæ˜¯ Intellij IDEAã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/object-class/abstract-05.png)


åœ¨ resource ç›®å½•ä¸‹çš„æ–‡ä»¶å¯ä»¥é€šè¿‡ `ClassLoader.getResource()` çš„æ–¹å¼è·å–åˆ° URI è·¯å¾„ï¼Œç„¶åå°±å¯ä»¥å–åˆ°æ–‡æœ¬å†…å®¹äº†ã€‚

è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
[hello world]
[HELLO WORLD]
```

### 04ã€æŠ½è±¡ç±»æ€»ç»“

å¥½äº†ï¼Œå¯¹äºæŠ½è±¡ç±»æˆ‘ä»¬ç®€å•æ€»ç»“ä¸€ä¸‹ï¼š

- 1ã€æŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ã€‚
- 2ã€æŠ½è±¡ç±»åº”è¯¥è‡³å°‘æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå¦åˆ™å®ƒæ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚
- 3ã€æŠ½è±¡ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•æ²¡æœ‰æ–¹æ³•ä½“ã€‚
- 4ã€æŠ½è±¡ç±»çš„å­ç±»å¿…é¡»ç»™å‡ºçˆ¶ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•çš„å…·ä½“å®ç°ï¼Œé™¤éè¯¥å­ç±»ä¹Ÿæ˜¯æŠ½è±¡ç±»ã€‚

â€œå®Œäº†å—ï¼ŸäºŒå“¥â€ä¸‰å¦¹ä¼¼ä¹è¿˜æ²‰æµ¸åœ¨è†å¬æ•™è¯²çš„å¿«ä¹ä¸­ã€‚

â€œæ˜¯æ»´ï¼Œè¿™æ¬¡æˆ‘ä»¬ç³»ç»ŸåŒ–çš„å­¦ä¹ äº†æŠ½è±¡ç±»ï¼Œå¯ä»¥è¯´é¢é¢ä¿±åˆ°äº†ã€‚ä¸‰å¦¹ä½ å¯ä»¥æŠŠä»£ç æ•²ä¸€éï¼ŒåŠ å¼ºäº†ä¸€äº›å°è±¡ï¼Œç”µè„‘äº¤ç»™ä½ äº†ã€‚â€è¯´å®Œï¼Œæˆ‘å°±è·‘åˆ°é˜³å°å»æŠ½çƒŸäº†ã€‚

â€œå‘¼ã€‚ã€‚ã€‚ã€‚ã€‚â€ä¸€ä¸ªå¤§å¤§çš„çœ¼åœˆé£˜æ•£å¼€æ¥ï¼Œåˆæ˜¯æ„‰å¿«çš„ä¸€å¤©~


----


GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 5.11 Javaæ¥å£

â€œä»Šå¤©å¼€å§‹è®² Java çš„æ¥å£ã€‚â€æˆ‘å¯¹ä¸‰å¦¹è¯´ï¼Œâ€œå¯¹äºé¢å‘å¯¹è±¡ç¼–ç¨‹æ¥è¯´ï¼ŒæŠ½è±¡æ˜¯ä¸€ä¸ªæå…·é­…åŠ›çš„ç‰¹å¾ã€‚å¦‚æœä¸€ä¸ªç¨‹åºå‘˜çš„æŠ½è±¡æ€ç»´å¾ˆå·®ï¼Œé‚£ä»–åœ¨ç¼–ç¨‹ä¸­å°±ä¼šé‡åˆ°å¾ˆå¤šå›°éš¾ï¼Œæ— æ³•æŠŠä¸šåŠ¡å˜æˆå…·ä½“çš„ä»£ç ã€‚åœ¨ Java ä¸­ï¼Œå¯ä»¥é€šè¿‡ä¸¤ç§å½¢å¼æ¥è¾¾åˆ°æŠ½è±¡çš„ç›®çš„ï¼Œä¸€ç§ä¸Šä¸€ç¯‡çš„ä¸»è§’â€”â€”[æŠ½è±¡ç±»](https://tobebetterjavaer.com/oo/abstract.html)ï¼Œå¦å¤–ä¸€ç§å°±æ˜¯ä»Šå¤©çš„ä¸»è§’â€”â€”[æ¥å£](https://tobebetterjavaer.com/oo/interface.html)ã€‚â€

â€œäºŒå“¥ï¼Œå¼€è®²ä¹‹å‰ï¼Œå…ˆæ­å–œä½ å‘€ã€‚æˆ‘çœ‹ä½ æœ‹å‹åœˆè¯´ã€Š[Javaè¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹å¼€æºçŸ¥è¯†åº“åœ¨ GitHub ä¸Šæ”¶åˆ°äº†ç¬¬ä¸€ç¬”èµèµå‘€ï¼Œè™½ç„¶åªæœ‰ä¸€å—é’±ï¼Œä½†æˆ‘ä¹Ÿæ›¿ä½ æ„Ÿåˆ°å¼€å¿ƒã€‚â€ä¸‰å¦¹çš„è„¸ä¸Šæ´‹æº¢ç€è‡ªä¿¡çš„å¾®ç¬‘ï¼Œä»¿ä½›è¿™é’±æ˜¯æ‰“ç»™å¥¹çš„ä¸€æ ·ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/object-class/interface-01.png)

>PSï¼š2021-04-29åˆ°2023-02-11æœŸé—´ï¼Œã€ŠäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ã€‹æ”¶åˆ°äº† 58 ç¬”èµèµï¼ŒçœŸçš„éå¸¸æ„Ÿè°¢å¤§å®¶çš„è®¤å¯å’Œæ”¯æŒğŸ˜ï¼Œæˆ‘ä¼šç»§ç»­è‚ä¸‹å»çš„ã€‚

â€œæ˜¯å•Šï¼Œæ—©ä¸Šèµ·æ¥çš„æ—¶å€™çœ‹åˆ°è¿™æ¡ä¿¡æ¯ï¼Œè¿˜çœŸçš„æ˜¯æŒºå¼€å¿ƒçš„ï¼Œè™½ç„¶åªæœ‰ä¸€å—é’±ï¼Œä½†æ˜¯å¼€æºçš„ç¬¬ä¸€ç¬”ï¼Œä¹Ÿæ˜¯æˆ‘äººç”Ÿå½“ä¸­çš„ç¬¬ä¸€ç¬”ï¼ŒçœŸçš„éå¸¸æ„Ÿè°¢è¿™ä¸ªè¯»è€…ï¼Œå€¼å¾—çºªå¿µçš„ä¸€å¤©ã€‚â€æˆ‘è‡ªå·±ä¹Ÿæ©é¥°ä¸ä½å†…å¿ƒçš„æ¿€åŠ¨ã€‚

â€œæœ‰äº†è¿™ä»½é¼“åŠ±ï¼Œæˆ‘ç›¸ä¿¡ä½ æ›´æ–°ä¸‹å»çš„åŠ¨åŠ›æ›´è¶³äº†ï¼â€ä¸‰å¦¹ä»Šå¤©è¯´çš„è¯çœŸçš„æ˜¯ç‰¹åˆ«ä»¤äººå–œæ¬¢ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/object-class/interface-02.png)

â€œæ˜¯å‘€æ˜¯å‘€ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ï¼â€

### 01ã€å®šä¹‰æ¥å£

â€œæ¥å£æ˜¯ä»€ä¹ˆå‘€ï¼Ÿâ€ä¸‰å¦¹é¡ºç€æˆ‘çš„è¯é¢˜åŠæ—¶çš„æ’è¯åˆ°ã€‚

æ¥å£é€šè¿‡ interface å…³é”®å­—æ¥å®šä¹‰ï¼Œå®ƒå¯ä»¥åŒ…å«ä¸€äº›å¸¸é‡å’Œæ–¹æ³•ï¼Œæ¥çœ‹ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ã€‚

```java
public interface Electronic {
    // å¸¸é‡
    String LED = "LED";

    // æŠ½è±¡æ–¹æ³•
    int getElectricityUse();

    // é™æ€æ–¹æ³•
    static boolean isEnergyEfficient(String electtronicType) {
        return electtronicType.equals(LED);
    }

    // é»˜è®¤æ–¹æ³•
    default void printDescription() {
        System.out.println("ç”µå­");
    }
}
```

æ¥çœ‹ä¸€ä¸‹è¿™æ®µä»£ç åç¼–è¯‘åçš„å­—èŠ‚ç ã€‚

```java
public interface Electronic
{

    public abstract int getElectricityUse();

    public static boolean isEnergyEfficient(String electtronicType)
    {
        return electtronicType.equals("LED");
    }

    public void printDescription()
    {
        System.out.println("\u7535\u5B50");
    }

    public static final String LED = "LED";
}
```

å‘ç°æ²¡ï¼Ÿæ¥å£ä¸­å®šä¹‰çš„æ‰€æœ‰å˜é‡æˆ–è€…æ–¹æ³•ï¼Œéƒ½ä¼šè‡ªåŠ¨æ·»åŠ ä¸Š `public` å…³é”®å­—ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘æ¥ä¸€ä¸€è§£é‡Šä¸‹ Electronic æ¥å£ä¸­çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹ã€‚

**1ï¼‰æ¥å£ä¸­å®šä¹‰çš„å˜é‡ä¼šåœ¨ç¼–è¯‘çš„æ—¶å€™è‡ªåŠ¨åŠ ä¸Š `public static final` ä¿®é¥°ç¬¦**ï¼ˆæ³¨æ„çœ‹ä¸€ä¸‹åç¼–è¯‘åçš„å­—èŠ‚ç ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸Šä¾‹ä¸­çš„ LED å˜é‡å…¶å®å°±æ˜¯ä¸€ä¸ªå¸¸é‡ã€‚

Java å®˜æ–¹æ–‡æ¡£ä¸Šæœ‰è¿™æ ·çš„å£°æ˜ï¼š

>Every field declaration in the body of an interface is implicitly public, static, and final.

æ¢å¥è¯è¯´ï¼Œæ¥å£å¯ä»¥ç”¨æ¥ä½œä¸ºå¸¸é‡ç±»ä½¿ç”¨ï¼Œè¿˜èƒ½çœç•¥æ‰ `public static final`ï¼Œçœ‹ä¼¼ä¸é”™çš„ä¸€ç§é€‰æ‹©ï¼Œå¯¹å§ï¼Ÿ

ä¸è¿‡ï¼Œè¿™ç§é€‰æ‹©å¹¶ä¸å¯å–ã€‚å› ä¸ºæ¥å£çš„æœ¬æ„æ˜¯å¯¹æ–¹æ³•è¿›è¡ŒæŠ½è±¡ï¼Œè€Œå¸¸é‡æ¥å£ä¼šå¯¹å­ç±»ä¸­çš„å˜é‡é€ æˆå‘½åç©ºé—´ä¸Šçš„â€œæ±¡æŸ“â€ã€‚

**2ï¼‰æ²¡æœ‰ä½¿ç”¨ `private`ã€`default` æˆ–è€… `static` å…³é”®å­—ä¿®é¥°çš„æ–¹æ³•æ˜¯éšå¼æŠ½è±¡çš„**ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šè‡ªåŠ¨åŠ ä¸Š `public abstract` ä¿®é¥°ç¬¦ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸Šä¾‹ä¸­çš„ `getElectricityUse()` å…¶å®æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œæ²¡æœ‰æ–¹æ³•ä½“â€”â€”è¿™æ˜¯å®šä¹‰æ¥å£çš„æœ¬æ„ã€‚

**3ï¼‰ä» Java 8 å¼€å§‹ï¼Œæ¥å£ä¸­å…è®¸æœ‰é™æ€æ–¹æ³•**ï¼Œæ¯”å¦‚è¯´ä¸Šä¾‹ä¸­çš„ `isEnergyEfficient()` æ–¹æ³•ã€‚

é™æ€æ–¹æ³•æ— æ³•ç”±ï¼ˆå®ç°äº†è¯¥æ¥å£çš„ï¼‰ç±»çš„å¯¹è±¡è°ƒç”¨ï¼Œå®ƒåªèƒ½é€šè¿‡æ¥å£åæ¥è°ƒç”¨ï¼Œæ¯”å¦‚è¯´ `Electronic.isEnergyEfficient("LED")`ã€‚

æ¥å£ä¸­å®šä¹‰é™æ€æ–¹æ³•çš„ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§ç®€å•çš„æœºåˆ¶ï¼Œä½¿æˆ‘ä»¬ä¸å¿…åˆ›å»ºå¯¹è±¡å°±èƒ½è°ƒç”¨æ–¹æ³•ï¼Œä»è€Œæé«˜æ¥å£çš„ç«äº‰åŠ›ã€‚

**4ï¼‰æ¥å£ä¸­å…è®¸å®šä¹‰ `default` æ–¹æ³•**ä¹Ÿæ˜¯ä» Java 8 å¼€å§‹çš„ï¼Œæ¯”å¦‚è¯´ä¸Šä¾‹ä¸­çš„ `printDescription()` æ–¹æ³•ï¼Œå®ƒå§‹ç»ˆç”±ä¸€ä¸ªä»£ç å—ç»„æˆï¼Œä¸ºå®ç°è¯¥æ¥å£è€Œä¸è¦†ç›–è¯¥æ–¹æ³•çš„ç±»æä¾›é»˜è®¤å®ç°ã€‚æ—¢ç„¶è¦æä¾›é»˜è®¤å®ç°ï¼Œå°±è¦æœ‰æ–¹æ³•ä½“ï¼Œæ¢å¥è¯è¯´ï¼Œé»˜è®¤æ–¹æ³•åé¢ä¸èƒ½ç›´æ¥ä½¿ç”¨â€œ;â€å·æ¥ç»“æŸâ€”â€”ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/object-class/interface-03.png)

â€œä¸ºä»€ä¹ˆè¦åœ¨æ¥å£ä¸­å®šä¹‰é»˜è®¤æ–¹æ³•å‘¢ï¼Ÿâ€ä¸‰å¦¹å¥½å¥‡åœ°é—®åˆ°ã€‚

å…è®¸åœ¨æ¥å£ä¸­å®šä¹‰é»˜è®¤æ–¹æ³•çš„ç†ç”±å¾ˆå……åˆ†ï¼Œå› ä¸ºä¸€ä¸ªæ¥å£å¯èƒ½æœ‰å¤šä¸ªå®ç°ç±»ï¼Œè¿™äº›ç±»å°±å¿…é¡»å®ç°æ¥å£ä¸­å®šä¹‰çš„æŠ½è±¡ç±»ï¼Œå¦åˆ™ç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ã€‚å‡å¦‚æˆ‘ä»¬éœ€è¦åœ¨æ‰€æœ‰çš„å®ç°ç±»ä¸­è¿½åŠ æŸä¸ªå…·ä½“çš„æ–¹æ³•ï¼Œåœ¨æ²¡æœ‰ `default` æ–¹æ³•çš„å¸®åŠ©ä¸‹ï¼Œæˆ‘ä»¬å°±å¿…é¡»æŒ¨ä¸ªå¯¹å®ç°ç±»è¿›è¡Œä¿®æ”¹ã€‚

ç”±ä¹‹å‰çš„ä¾‹å­æˆ‘ä»¬å°±å¯ä»¥å¾—å‡ºä¸‹é¢è¿™äº›ç»“è®ºï¼š

- æ¥å£ä¸­å…è®¸å®šä¹‰å˜é‡
- æ¥å£ä¸­å…è®¸å®šä¹‰æŠ½è±¡æ–¹æ³•
- æ¥å£ä¸­å…è®¸å®šä¹‰é™æ€æ–¹æ³•ï¼ˆJava 8 ä¹‹åï¼‰
- æ¥å£ä¸­å…è®¸å®šä¹‰é»˜è®¤æ–¹æ³•ï¼ˆJava 8 ä¹‹åï¼‰

é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜åº”è¯¥çŸ¥é“ï¼š

**1ï¼‰æ¥å£ä¸å…è®¸ç›´æ¥å®ä¾‹åŒ–**ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/object-class/interface-04.png)

éœ€è¦å®šä¹‰ä¸€ä¸ªç±»å»å®ç°æ¥å£ï¼Œè§ä¸‹ä¾‹ã€‚

```java
public class Computer implements Electronic {

    public static void main(String[] args) {
        new Computer();
    }

    @Override
    public int getElectricityUse() {
        return 0;
    }
}
```

ç„¶åå†å®ä¾‹åŒ–ã€‚

```
Electronic e = new Computer();
```

**2ï¼‰æ¥å£å¯ä»¥æ˜¯ç©ºçš„**ï¼Œæ—¢å¯ä»¥ä¸å®šä¹‰å˜é‡ï¼Œä¹Ÿå¯ä»¥ä¸å®šä¹‰æ–¹æ³•ã€‚æœ€å…¸å‹çš„ä¾‹å­å°±æ˜¯ Serializable æ¥å£ï¼Œåœ¨ `java.io` åŒ…ä¸‹ã€‚

```java
public interface Serializable {
}
```

Serializable æ¥å£ç”¨æ¥ä¸ºåºåˆ—åŒ–çš„å…·ä½“å®ç°æä¾›ä¸€ä¸ªæ ‡è®°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦æŸä¸ªç±»å®ç°äº† Serializable æ¥å£ï¼Œé‚£ä¹ˆå®ƒå°±å¯ä»¥ç”¨æ¥åºåˆ—åŒ–äº†ã€‚

**3ï¼‰ä¸è¦åœ¨å®šä¹‰æ¥å£çš„æ—¶å€™ä½¿ç”¨ final å…³é”®å­—**ï¼Œå¦åˆ™ä¼šæŠ¥ç¼–è¯‘é”™è¯¯ï¼Œå› ä¸ºæ¥å£å°±æ˜¯ä¸ºäº†è®©å­ç±»å®ç°çš„ï¼Œè€Œ final é˜»æ­¢äº†è¿™ç§è¡Œä¸ºã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/object-class/interface-05.png)

**4ï¼‰æ¥å£çš„æŠ½è±¡æ–¹æ³•ä¸èƒ½æ˜¯ privateã€protected æˆ–è€… final**ï¼Œå¦åˆ™ç¼–è¯‘å™¨éƒ½ä¼šæŠ¥é”™ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/object-class/interface-06.png)

**5ï¼‰æ¥å£çš„å˜é‡æ˜¯éšå¼ `public static final`ï¼ˆå¸¸é‡ï¼‰**ï¼Œæ‰€ä»¥å…¶å€¼æ— æ³•æ”¹å˜ã€‚

### 02ã€æ¥å£çš„ä½œç”¨

â€œæ¥å£å¯ä»¥åšä»€ä¹ˆå‘¢ï¼Ÿâ€ä¸‰å¦¹è§ç¼æ’é’ˆï¼Œé—®çš„å¾ˆåŠæ—¶ã€‚

**ç¬¬ä¸€ï¼Œä½¿æŸäº›å®ç°ç±»å…·æœ‰æˆ‘ä»¬æƒ³è¦çš„åŠŸèƒ½**ï¼Œæ¯”å¦‚è¯´ï¼Œå®ç°äº† Cloneable æ¥å£çš„ç±»å…·æœ‰æ‹·è´çš„åŠŸèƒ½ï¼Œå®ç°äº† Comparable æˆ–è€… Comparator çš„ç±»å…·æœ‰æ¯”è¾ƒåŠŸèƒ½ã€‚

Cloneable å’Œ Serializable ä¸€æ ·ï¼Œéƒ½å±äºæ ‡è®°å‹æ¥å£ï¼Œå®ƒä»¬å†…éƒ¨éƒ½æ˜¯ç©ºçš„ã€‚å®ç°äº† Cloneable æ¥å£çš„ç±»å¯ä»¥ä½¿ç”¨ `Object.clone()` æ–¹æ³•ï¼Œå¦åˆ™ä¼šæŠ›å‡º CloneNotSupportedExceptionã€‚

```java
public class CloneableTest implements Cloneable {
    @Override
    protected Object clone() throws CloneNotSupportedException {
        return super.clone();
    }

    public static void main(String[] args) throws CloneNotSupportedException {
        CloneableTest c1 = new CloneableTest();
        CloneableTest c2 = (CloneableTest) c1.clone();
    }
}
```

è¿è¡Œåæ²¡æœ‰æŠ¥é”™ã€‚ç°åœ¨æŠŠ `implements Cloneable` å»æ‰ã€‚

```java
public class CloneableTest {
    @Override
    protected Object clone() throws CloneNotSupportedException {
        return super.clone();
    }

    public static void main(String[] args) throws CloneNotSupportedException {
        CloneableTest c1 = new CloneableTest();
        CloneableTest c2 = (CloneableTest) c1.clone();

    }
}
```

è¿è¡ŒåæŠ›å‡º CloneNotSupportedExceptionï¼š

```
Exception in thread "main" java.lang.CloneNotSupportedException: com.cmower.baeldung.interface1.CloneableTest
	at java.base/java.lang.Object.clone(Native Method)
	at com.cmower.baeldung.interface1.CloneableTest.clone(CloneableTest.java:6)
	at com.cmower.baeldung.interface1.CloneableTest.main(CloneableTest.java:11)
```


**ç¬¬äºŒï¼ŒJava åŸåˆ™ä¸Šåªæ”¯æŒå•ä¸€ç»§æ‰¿ï¼Œä½†é€šè¿‡æ¥å£å¯ä»¥å®ç°å¤šé‡ç»§æ‰¿çš„ç›®çš„**ã€‚

å¦‚æœæœ‰ä¸¤ä¸ªç±»å…±åŒç»§æ‰¿ï¼ˆextendsï¼‰ä¸€ä¸ªçˆ¶ç±»ï¼Œé‚£ä¹ˆçˆ¶ç±»çš„æ–¹æ³•å°±ä¼šè¢«ä¸¤ä¸ªå­ç±»é‡å†™ã€‚ç„¶åï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ–°ç±»åŒæ—¶ç»§æ‰¿äº†è¿™ä¸¤ä¸ªå­ç±»ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨é‡å†™æ–¹æ³•çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨å°±ä¸èƒ½è¯†åˆ«è¦è°ƒç”¨å“ªä¸ªç±»çš„æ–¹æ³•äº†ã€‚è¿™ä¹Ÿæ­£æ˜¯è‘—åçš„è±å½¢é—®é¢˜ï¼Œè§ä¸‹å›¾ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/object-class/interface-07.png)


ç®€å•è§£é‡Šä¸‹ï¼ŒClassC åŒæ—¶ç»§æ‰¿äº† ClassA å’Œ ClassBï¼ŒClassC çš„å¯¹è±¡åœ¨è°ƒç”¨ ClassA å’Œ ClassB ä¸­é‡å†™çš„æ–¹æ³•æ—¶ï¼Œå°±ä¸çŸ¥é“è¯¥è°ƒç”¨ ClassA çš„æ–¹æ³•ï¼Œè¿˜æ˜¯ ClassB çš„æ–¹æ³•ã€‚

æ¥å£æ²¡æœ‰è¿™æ–¹é¢çš„å›°æ‰°ã€‚æ¥å®šä¹‰ä¸¤ä¸ªæ¥å£ï¼ŒFly æ¥å£ä¼šé£ï¼ŒRun æ¥å£ä¼šè·‘ã€‚

```java
public interface Fly {
    void fly();
}
public interface Run {
    void run();
}
```

ç„¶åè®© Pig ç±»åŒæ—¶å®ç°è¿™ä¸¤ä¸ªæ¥å£ã€‚

```java
public class Pig implements Fly,Run{
    @Override
    public void fly() {
        System.out.println("ä¼šé£çš„çŒª");
    }

    @Override
    public void run() {
        System.out.println("ä¼šè·‘çš„çŒª");
    }
}
```

åœ¨æŸç§å½¢å¼ä¸Šï¼Œæ¥å£å®ç°äº†å¤šé‡ç»§æ‰¿çš„ç›®çš„ï¼šç°å®ä¸–ç•Œé‡Œï¼ŒçŒªçš„ç¡®åªä¼šè·‘ï¼Œä½†åœ¨é›·å†›çš„çœ¼é‡Œï¼Œç«™åœ¨é£å£çš„çŒªå°±ä¼šé£ï¼Œè¿™å°±éœ€è¦èµ‹äºˆè¿™åªçŒªæ›´å¤šçš„èƒ½åŠ›ï¼Œé€šè¿‡æŠ½è±¡ç±»æ˜¯æ— æ³•å®ç°çš„ï¼Œåªèƒ½é€šè¿‡æ¥å£ã€‚

**ç¬¬ä¸‰ï¼Œå®ç°å¤šæ€**ã€‚

ä»€ä¹ˆæ˜¯å¤šæ€å‘¢ï¼Ÿé€šä¿—çš„ç†è§£ï¼Œå°±æ˜¯åŒä¸€ä¸ªäº‹ä»¶å‘ç”Ÿåœ¨ä¸åŒçš„å¯¹è±¡ä¸Šä¼šäº§ç”Ÿä¸åŒçš„ç»“æœï¼Œé¼ æ ‡å·¦é”®ç‚¹å‡»çª—å£ä¸Šçš„ X å·å¯ä»¥å…³é—­çª—å£ï¼Œç‚¹å‡»è¶…é“¾æ¥å´å¯ä»¥æ‰“å¼€æ–°çš„ç½‘é¡µã€‚

å¤šæ€å¯ä»¥é€šè¿‡ç»§æ‰¿ï¼ˆ`extends`ï¼‰çš„å…³ç³»å®ç°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ¥å£çš„å½¢å¼å®ç°ã€‚

Shape æ¥å£è¡¨ç¤ºä¸€ä¸ªå½¢çŠ¶ã€‚

```java
public interface Shape {
    String name();
}
```

Circle ç±»å®ç°äº† Shape æ¥å£ï¼Œå¹¶é‡å†™äº† `name()` æ–¹æ³•ã€‚

```java
public class Circle implements Shape {
    @Override
    public String name() {
        return "åœ†";
    }
}
```

Square ç±»ä¹Ÿå®ç°äº† Shape æ¥å£ï¼Œå¹¶é‡å†™äº† `name()` æ–¹æ³•ã€‚

```java
public class Square implements Shape {
    @Override
    public String name() {
        return "æ­£æ–¹å½¢";
    }
}
```

ç„¶åæ¥çœ‹æµ‹è¯•ç±»ã€‚

```java
List<Shape> shapes = new ArrayList<>();
Shape circleShape = new Circle();
Shape squareShape = new Square();

shapes.add(circleShape);
shapes.add(squareShape);

for (Shape shape : shapes) {
    System.out.println(shape.name());
}
```

è¿™å°±å®ç°äº†å¤šæ€ï¼Œå˜é‡ circleShapeã€squareShape çš„å¼•ç”¨ç±»å‹éƒ½æ˜¯ Shapeï¼Œä½†æ‰§è¡Œ `shape.name()` æ–¹æ³•çš„æ—¶å€™ï¼ŒJava è™šæ‹ŸæœºçŸ¥é“è¯¥å»è°ƒç”¨ Circle çš„ `name()` æ–¹æ³•è¿˜æ˜¯ Square çš„ `name()` æ–¹æ³•ã€‚

è¯´ä¸€ä¸‹å¤šæ€å­˜åœ¨çš„ 3 ä¸ªå‰æï¼š

- 1ã€è¦æœ‰ç»§æ‰¿å…³ç³»ï¼Œæ¯”å¦‚è¯´ Circle å’Œ Square éƒ½å®ç°äº† Shape æ¥å£ã€‚
- 2ã€å­ç±»è¦é‡å†™çˆ¶ç±»çš„æ–¹æ³•ï¼ŒCircle å’Œ Square éƒ½é‡å†™äº† `name()` æ–¹æ³•ã€‚
- 3ã€çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡ï¼ŒcircleShape å’Œ squareShape çš„ç±»å‹éƒ½ä¸º Shapeï¼Œä½†å‰è€…æŒ‡å‘çš„æ˜¯ Circle å¯¹è±¡ï¼Œåè€…æŒ‡å‘çš„æ˜¯ Square å¯¹è±¡ã€‚

ç„¶åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æµ‹è¯•ç»“æœï¼š

```
åœ†
æ­£æ–¹å½¢
```

ä¹Ÿå°±æ„å‘³ç€ï¼Œå°½ç®¡åœ¨ for å¾ªç¯ä¸­ï¼Œshape çš„ç±»å‹éƒ½ä¸º Shapeï¼Œä½†åœ¨è°ƒç”¨ `name()` æ–¹æ³•çš„æ—¶å€™ï¼Œå®ƒçŸ¥é“ Circle å¯¹è±¡åº”è¯¥è°ƒç”¨ Circle ç±»çš„ `name()` æ–¹æ³•ï¼ŒSquare å¯¹è±¡åº”è¯¥è°ƒç”¨ Square ç±»çš„ `name()` æ–¹æ³•ã€‚

### 03ã€æ¥å£çš„ä¸‰ç§æ¨¡å¼

**åœ¨ç¼–ç¨‹é¢†åŸŸï¼Œå¥½çš„è®¾è®¡æ¨¡å¼èƒ½å¤Ÿè®©æˆ‘ä»¬çš„ä»£ç äº‹åŠåŠŸå€**ã€‚åœ¨ä½¿ç”¨æ¥å£çš„æ—¶å€™ï¼Œç»å¸¸ä¼šç”¨åˆ°ä¸‰ç§æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯ç­–ç•¥æ¨¡å¼ã€é€‚é…å™¨æ¨¡å¼å’Œå·¥å‚æ¨¡å¼ã€‚

#### 1ï¼‰ç­–ç•¥æ¨¡å¼

ç­–ç•¥æ¨¡å¼çš„æ€æƒ³æ˜¯ï¼Œé’ˆå¯¹ä¸€ç»„ç®—æ³•ï¼Œå°†æ¯ä¸€ç§ç®—æ³•å°è£…åˆ°å…·æœ‰å…±åŒæ¥å£çš„å®ç°ç±»ä¸­ï¼Œæ¥å£çš„è®¾è®¡è€…å¯ä»¥åœ¨ä¸å½±å“è°ƒç”¨è€…çš„æƒ…å†µä¸‹å¯¹ç®—æ³•åšå‡ºæ”¹å˜ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
// æ¥å£ï¼šæ•™ç»ƒ
interface Coach {
    // æ–¹æ³•ï¼šé˜²å®ˆ
    void defend();
}

// ä½•å¡Â·ç©†é‡Œå°¼å¥¥
class Hesai implements Coach {

    @Override
    public void defend() {
        System.out.println("é˜²å®ˆèµ¢å¾—å† å†›");
    }
}

// å¾·æ™®Â·ç“œè¿ªå¥¥æ‹‰
class Guatu implements Coach {

    @Override
    public void defend() {
        System.out.println("è¿›æ”»å°±æ˜¯æœ€å¥½çš„é˜²å®ˆ");
    }
}

public class Demo {
    // å‚æ•°ä¸ºæ¥å£
    public static void defend(Coach coach) {
        coach.defend();
    }
    
    public static void main(String[] args) {
        // ä¸ºåŒä¸€ä¸ªæ–¹æ³•ä¼ é€’ä¸åŒçš„å¯¹è±¡
        defend(new Hesai());
        defend(new Guatu());
    }
}
```

`Demo.defend()` æ–¹æ³•å¯ä»¥æ¥å—ä¸åŒé£æ ¼çš„ Coachï¼Œå¹¶æ ¹æ®æ‰€ä¼ é€’çš„å‚æ•°å¯¹è±¡çš„ä¸åŒè€Œäº§ç”Ÿä¸åŒçš„è¡Œä¸ºï¼Œè¿™è¢«ç§°ä¸ºâ€œç­–ç•¥æ¨¡å¼â€ã€‚

#### 2ï¼‰é€‚é…å™¨æ¨¡å¼

é€‚é…å™¨æ¨¡å¼çš„æ€æƒ³æ˜¯ï¼Œé’ˆå¯¹è°ƒç”¨è€…çš„éœ€æ±‚å¯¹åŸæœ‰çš„æ¥å£è¿›è¡Œè½¬æ¥ã€‚ç”Ÿæ´»å½“ä¸­æœ€å¸¸è§çš„é€‚é…å™¨å°±æ˜¯HDMIï¼ˆè‹±è¯­ï¼š`High Definition Multimedia Interface`ï¼Œä¸­æ–‡ï¼šé«˜æ¸…å¤šåª’ä½“æ¥å£ï¼‰çº¿ï¼Œå¯ä»¥åŒæ—¶å‘é€éŸ³é¢‘å’Œè§†é¢‘ä¿¡å·ã€‚é€‚é…å™¨æ¨¡å¼çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
interface Coach {
    void defend();
    void attack();
}

// æŠ½è±¡ç±»å®ç°æ¥å£ï¼Œå¹¶ç½®ç©ºæ–¹æ³•
abstract class AdapterCoach implements Coach {
    public void defend() {};
    public void attack() {};
}

// æ–°ç±»ç»§æ‰¿é€‚é…å™¨
class Hesai extends AdapterCoach {
    public void defend() {
        System.out.println("é˜²å®ˆèµ¢å¾—å† å†›");
    }
}

public class Demo {
    public static void main(String[] args) {
        Coach coach = new Hesai();
        coach.defend();
    }
}
```
Coach æ¥å£ä¸­å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼ˆ`defend()` å’Œ `attack()`ï¼‰ï¼Œå¦‚æœç±»ç›´æ¥å®ç°è¯¥æ¥å£çš„è¯ï¼Œå°±éœ€è¦å¯¹ä¸¤ä¸ªæ–¹æ³•è¿›è¡Œå®ç°ã€‚

å¦‚æœæˆ‘ä»¬åªéœ€è¦å¯¹å…¶ä¸­ä¸€ä¸ªæ–¹æ³•è¿›è¡Œå®ç°çš„è¯ï¼Œå°±å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæŠ½è±¡ç±»ä½œä¸ºä¸­é—´ä»¶ï¼Œå³é€‚é…å™¨ï¼ˆAdapterCoachï¼‰ï¼Œç”¨è¿™ä¸ªæŠ½è±¡ç±»å®ç°æ¥å£ï¼Œå¹¶å¯¹æŠ½è±¡ç±»ä¸­çš„æ–¹æ³•ç½®ç©ºï¼ˆæ–¹æ³•ä½“åªæœ‰ä¸€å¯¹èŠ±æ‹¬å·ï¼‰ï¼Œè¿™æ—¶å€™ï¼Œæ–°ç±»å°±å¯ä»¥ç»•è¿‡æ¥å£ï¼Œç»§æ‰¿æŠ½è±¡ç±»ï¼Œæˆ‘ä»¬å°±å¯ä»¥åªå¯¹éœ€è¦çš„æ–¹æ³•è¿›è¡Œè¦†ç›–ï¼Œè€Œä¸æ˜¯æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•ã€‚

#### 3ï¼‰å·¥å‚æ¨¡å¼

æ‰€è°“çš„å·¥å‚æ¨¡å¼ç†è§£èµ·æ¥ä¹Ÿä¸éš¾ï¼Œå°±æ˜¯ä»€ä¹ˆå·¥å‚ç”Ÿäº§ä»€ä¹ˆï¼Œæ¯”å¦‚è¯´å®é©¬å·¥å‚ç”Ÿäº§å®é©¬ï¼Œå¥”é©°å·¥å‚ç”Ÿäº§å¥”é©°ï¼ŒA çº§å­¦é™¢æ¯•ä¸š A çº§æ•™ç»ƒï¼ŒC çº§å­¦é™¢æ¯•ä¸š C çº§æ•™ç»ƒã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
// æ•™ç»ƒ
interface Coach {
    void command();
}

// æ•™ç»ƒå­¦é™¢
interface CoachFactory {
    Coach createCoach();
}

// Açº§æ•™ç»ƒ
class ACoach implements Coach {

    @Override
    public void command() {
        System.out.println("æˆ‘æ˜¯Açº§è¯ä¹¦æ•™ç»ƒ");
    }
    
}

// Açº§æ•™ç»ƒå­¦é™¢
class ACoachFactory implements CoachFactory {

    @Override
    public Coach createCoach() {
        return new ACoach();
    }
    
}

// Cçº§æ•™ç»ƒ
class CCoach implements Coach {

    @Override
    public void command() {
        System.out.println("æˆ‘æ˜¯Cçº§è¯ä¹¦æ•™ç»ƒ");
    }
    
}

// Cçº§æ•™ç»ƒå­¦é™¢
class CCoachFactory implements CoachFactory {

    @Override
    public Coach createCoach() {
        return new CCoach();
    }
    
}

public class Demo {
    public static void create(CoachFactory factory) {
        factory.createCoach().command();
    }
    
    public static void main(String[] args) {
        // å¯¹äºä¸€æ”¯çƒé˜Ÿæ¥è¯´ï¼Œéœ€è¦ä»€ä¹ˆæ ·çš„æ•™ç»ƒå°±å»æ‰¾ä»€ä¹ˆæ ·çš„å­¦é™¢
        // å­¦é™¢ä¼šä»‹ç»çƒé˜Ÿå¯¹åº”æ°´å¹³çš„æ•™ç»ƒã€‚
        create(new ACoachFactory());
        create(new CCoachFactory());
    }
}
```

æœ‰ä¸¤ä¸ªæ¥å£ï¼Œä¸€ä¸ªæ˜¯ Coachï¼ˆæ•™ç»ƒï¼‰ï¼Œå¯ä»¥ `command()`ï¼ˆæŒ‡æŒ¥çƒé˜Ÿï¼‰ï¼›å¦å¤–ä¸€ä¸ªæ˜¯ CoachFactoryï¼ˆæ•™ç»ƒå­¦é™¢ï¼‰ï¼Œèƒ½ `createCoach()`ï¼ˆæ•™å‡ºä¸€åä¼˜ç§€çš„æ•™ç»ƒï¼‰ã€‚ç„¶å ACoach ç±»å®ç° Coach æ¥å£ï¼ŒACoachFactory ç±»å®ç° CoachFactory æ¥å£ï¼›CCoach ç±»å®ç° Coach æ¥å£ï¼ŒCCoachFactory ç±»å®ç° CoachFactory æ¥å£ã€‚å½“éœ€è¦ A çº§æ•™ç»ƒæ—¶ï¼Œå°±å»æ‰¾ A çº§æ•™ç»ƒå­¦é™¢ï¼›å½“éœ€è¦ C çº§æ•™ç»ƒæ—¶ï¼Œå°±å»æ‰¾ C çº§æ•™ç»ƒå­¦é™¢ã€‚

ä¾æ¬¡ç±»æ¨ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨ BCoach ç±»å®ç° Coach æ¥å£ï¼ŒBCoachFactory ç±»å®ç° CoachFactory æ¥å£ï¼Œä»è€Œä¸æ–­åœ°ä¸°å¯Œæ•™ç»ƒçš„æ¢¯é˜Ÿã€‚

â€œæ€ä¹ˆæ ·ä¸‰å¦¹ï¼Œä¸€ä¸‹å­æ¥æ”¶è¿™ä¹ˆå¤šçŸ¥è¯†ç‚¹ä¸å®¹æ˜“å§ï¼Ÿâ€

â€œå…¶å®è¿˜å¥½å•Šï¼ŒäºŒå“¥ä½ è®²çš„è¿™ä¹ˆç»†è‡´ï¼Œæˆ‘éƒ½åšå¥½ç¬”è®°ğŸ“’äº†ï¼Œå­¦ä¹ å˜›ï¼Œè®¤çœŸä¸€ç‚¹ï¼Œæ•ˆæœå°±ä¼šå¥½å¾ˆå¤šäº†ã€‚â€

ä¸‰å¦¹è¿™ç§ç§¯æä¹è§‚çš„æ€åº¦çœŸçš„è®©æˆ‘æ„Ÿè§‰åˆ°â€œä»˜å‡ºå°±ä¼šæœ‰æ”¶è·â€ï¼ŒğŸ’ªğŸ»ã€‚

### 04ã€æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«

ç®€å•æ€»ç»“ä¸€ä¸‹æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«ã€‚

åœ¨ Java ä¸­ï¼Œé€šè¿‡å…³é”®å­— `abstract` å®šä¹‰çš„ç±»å«åšæŠ½è±¡ç±»ã€‚Java æ˜¯ä¸€é—¨é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œå› æ­¤æ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯é€šè¿‡ç±»æ¥æè¿°çš„ï¼›ä½†åè¿‡æ¥ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç±»éƒ½æ˜¯ç”¨æ¥æè¿°å¯¹è±¡çš„ï¼ŒæŠ½è±¡ç±»å°±æ˜¯å…¶ä¸­çš„ä¸€ç§ã€‚

ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†ä¸€ä¸ªç®€å•çš„æŠ½è±¡ç±»ï¼š

```java
// ä¸ªäººè®¤ä¸ºï¼Œä¸€åæ•™ç»ƒå¿…é¡»æ”»å®ˆå…¼å¤‡
abstract class Coach {
	public abstract void defend();

	public abstract void attack();
}
```

æˆ‘ä»¬çŸ¥é“ï¼Œæœ‰æŠ½è±¡æ–¹æ³•çš„ç±»è¢«ç§°ä¸ºæŠ½è±¡ç±»ï¼Œä¹Ÿå°±æ„å‘³ç€æŠ½è±¡ç±»ä¸­è¿˜èƒ½æœ‰ä¸æ˜¯æŠ½è±¡æ–¹æ³•çš„æ–¹æ³•ã€‚è¿™æ ·çš„ç±»å°±ä¸èƒ½ç®—ä½œçº¯ç²¹çš„æ¥å£ï¼Œå°½ç®¡å®ƒä¹Ÿå¯ä»¥æä¾›æ¥å£çš„åŠŸèƒ½â€”â€”åªèƒ½è¯´æŠ½è±¡ç±»æ˜¯æ™®é€šç±»ä¸æ¥å£ä¹‹é—´çš„ä¸€ç§ä¸­åº¸ä¹‹é“ã€‚

**æ¥å£ï¼ˆè‹±æ–‡ï¼šInterfaceï¼‰ï¼Œåœ¨ Java ä¸­æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»å‹ï¼Œæ˜¯æŠ½è±¡æ–¹æ³•çš„é›†åˆ**ï¼›æ¥å£é€šè¿‡å…³é”®å­— `interface` æ¥å®šä¹‰ã€‚æ¥å£ä¸æŠ½è±¡ç±»çš„ä¸åŒä¹‹å¤„åœ¨äºï¼š

- 1ã€æŠ½è±¡ç±»å¯ä»¥æœ‰æ–¹æ³•ä½“çš„æ–¹æ³•ï¼Œä½†æ¥å£æ²¡æœ‰ï¼ˆJava 8 ä»¥å‰ï¼‰ã€‚
- 2ã€æ¥å£ä¸­çš„æˆå‘˜å˜é‡éšå¼ä¸º `static final`ï¼Œä½†æŠ½è±¡ç±»ä¸æ˜¯çš„ã€‚
- 3ã€ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œä½†åªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»ã€‚

ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†ä¸€ä¸ªç®€å•çš„æ¥å£ï¼š

```java
// éšå¼çš„abstract
interface Coach {
	// éšå¼çš„public
	void defend();
	void attack();
}
```

- æ¥å£æ˜¯éšå¼æŠ½è±¡çš„ï¼Œæ‰€ä»¥å£°æ˜æ—¶æ²¡æœ‰å¿…è¦ä½¿ç”¨ `abstract` å…³é”®å­—ï¼›
- æ¥å£çš„æ¯ä¸ªæ–¹æ³•éƒ½æ˜¯éšå¼æŠ½è±¡çš„ï¼Œæ‰€ä»¥åŒæ ·ä¸éœ€è¦ä½¿ç”¨ `abstract` å…³é”®å­—ï¼›
- æ¥å£ä¸­çš„æ–¹æ³•éƒ½æ˜¯éšå¼ `public` çš„ã€‚

â€œå“¦ï¼Œæˆ‘ç†è§£äº†å“¥ã€‚é‚£æˆ‘å†é—®ä¸€ä¸‹ï¼ŒæŠ½è±¡ç±»å’Œæ¥å£æœ‰ä»€ä¹ˆå·®åˆ«å‘¢ï¼Ÿâ€

â€œå“‡ï¼Œä¸‰å¦¹å‘€ï¼Œä½ è¿™ä¸ªé—®é¢˜æ°åˆ°å¥½å¤„ï¼Œé—®åˆ°äº†ç‚¹å­ä¸Šã€‚â€æˆ‘ä¸ç”±å¾—ä¸ºä¸‰å¦¹ç«–èµ·äº†å¤§æ‹‡æŒ‡ã€‚

#### 1ï¼‰è¯­æ³•å±‚é¢ä¸Š

- æŠ½è±¡ç±»å¯ä»¥æä¾›æˆå‘˜æ–¹æ³•çš„å®ç°ç»†èŠ‚ï¼Œè€Œæ¥å£ä¸­åªèƒ½å­˜åœ¨ public abstract æ–¹æ³•ï¼›
- æŠ½è±¡ç±»ä¸­çš„æˆå‘˜å˜é‡å¯ä»¥æ˜¯å„ç§ç±»å‹çš„ï¼Œè€Œæ¥å£ä¸­çš„æˆå‘˜å˜é‡åªèƒ½æ˜¯ public static final ç±»å‹çš„ï¼›
- æ¥å£ä¸­ä¸èƒ½å«æœ‰é™æ€ä»£ç å—ï¼Œè€ŒæŠ½è±¡ç±»å¯ä»¥æœ‰é™æ€ä»£ç å—ï¼›
- ä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè€Œä¸€ä¸ªç±»å´å¯ä»¥å®ç°å¤šä¸ªæ¥å£ã€‚

#### 2ï¼‰è®¾è®¡å±‚é¢ä¸Š

æŠ½è±¡ç±»æ˜¯å¯¹ä¸€ç§äº‹ç‰©çš„æŠ½è±¡ï¼Œå³å¯¹ç±»æŠ½è±¡ï¼Œç»§æ‰¿æŠ½è±¡ç±»çš„å­ç±»å’ŒæŠ½è±¡ç±»æœ¬èº«æ˜¯ä¸€ç§ `is-a` çš„å…³ç³»ã€‚è€Œæ¥å£æ˜¯å¯¹è¡Œä¸ºçš„æŠ½è±¡ã€‚æŠ½è±¡ç±»æ˜¯å¯¹æ•´ä¸ªç±»æ•´ä½“è¿›è¡ŒæŠ½è±¡ï¼ŒåŒ…æ‹¬å±æ€§ã€è¡Œä¸ºï¼Œä½†æ˜¯æ¥å£å´æ˜¯å¯¹ç±»å±€éƒ¨ï¼ˆè¡Œä¸ºï¼‰è¿›è¡ŒæŠ½è±¡ã€‚

ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œé£æœºå’Œé¸Ÿæ˜¯ä¸åŒç±»çš„äº‹ç‰©ï¼Œä½†æ˜¯å®ƒä»¬éƒ½æœ‰ä¸€ä¸ªå…±æ€§ï¼Œå°±æ˜¯éƒ½ä¼šé£ã€‚é‚£ä¹ˆåœ¨è®¾è®¡çš„æ—¶å€™ï¼Œå¯ä»¥å°†é£æœºè®¾è®¡ä¸ºä¸€ä¸ªç±» Airplaneï¼Œå°†é¸Ÿè®¾è®¡ä¸ºä¸€ä¸ªç±» Birdï¼Œä½†æ˜¯ä¸èƒ½å°† é£è¡Œ è¿™ä¸ªç‰¹æ€§ä¹Ÿè®¾è®¡ä¸ºç±»ï¼Œå› æ­¤å®ƒåªæ˜¯ä¸€ä¸ªè¡Œä¸ºç‰¹æ€§ï¼Œå¹¶ä¸æ˜¯å¯¹ä¸€ç±»äº‹ç‰©çš„æŠ½è±¡æè¿°ã€‚

æ­¤æ—¶å¯ä»¥å°† é£è¡Œ è®¾è®¡ä¸ºä¸€ä¸ªæ¥å£ Flyï¼ŒåŒ…å«æ–¹æ³• fly()ï¼Œç„¶å Airplane å’Œ Bird åˆ†åˆ«æ ¹æ®è‡ªå·±çš„éœ€è¦å®ç° Fly è¿™ä¸ªæ¥å£ã€‚ç„¶åè‡³äºæœ‰ä¸åŒç§ç±»çš„é£æœºï¼Œæ¯”å¦‚æˆ˜æ–—æœºã€æ°‘ç”¨é£æœºç­‰ç›´æ¥ç»§æ‰¿ Airplane å³å¯ï¼Œå¯¹äºé¸Ÿä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä¸åŒç§ç±»çš„é¸Ÿç›´æ¥ç»§æ‰¿ Bird ç±»å³å¯ã€‚ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œç»§æ‰¿æ˜¯ä¸€ä¸ª "æ˜¯ä¸æ˜¯"çš„å…³ç³»ï¼Œè€Œ æ¥å£ å®ç°åˆ™æ˜¯ "æœ‰æ²¡æœ‰"çš„å…³ç³»ã€‚å¦‚æœä¸€ä¸ªç±»ç»§æ‰¿äº†æŸä¸ªæŠ½è±¡ç±»ï¼Œåˆ™å­ç±»å¿…å®šæ˜¯æŠ½è±¡ç±»çš„ç§ç±»ï¼Œè€Œæ¥å£å®ç°åˆ™æ˜¯æœ‰æ²¡æœ‰ã€å…·å¤‡ä¸å…·å¤‡çš„å…³ç³»ï¼Œæ¯”å¦‚é¸Ÿæ˜¯å¦èƒ½é£ï¼ˆæˆ–è€…æ˜¯å¦å…·å¤‡é£è¡Œè¿™ä¸ªç‰¹ç‚¹ï¼‰ï¼Œèƒ½é£è¡Œåˆ™å¯ä»¥å®ç°è¿™ä¸ªæ¥å£ï¼Œä¸èƒ½é£è¡Œå°±ä¸å®ç°è¿™ä¸ªæ¥å£ã€‚

æ¥å£æ˜¯å¯¹ç±»çš„æŸç§è¡Œä¸ºçš„ä¸€ç§æŠ½è±¡ï¼Œæ¥å£å’Œç±»ä¹‹é—´å¹¶æ²¡æœ‰å¾ˆå¼ºçš„å…³è”å…³ç³»ï¼Œä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼Œæ‰€æœ‰çš„ç±»éƒ½å¯ä»¥å®ç° [`Serializable` æ¥å£](https://tobebetterjavaer.com/io/Serializbale.html)ï¼Œä»è€Œå…·æœ‰åºåˆ—åŒ–çš„åŠŸèƒ½ï¼Œä½†ä¸èƒ½è¯´æ‰€æœ‰çš„ç±»å’Œ Serializable ä¹‹é—´æ˜¯ `is-a` çš„å…³ç³»ã€‚

æŠ½è±¡ç±»ä½œä¸ºå¾ˆå¤šå­ç±»çš„çˆ¶ç±»ï¼Œå®ƒæ˜¯ä¸€ç§æ¨¡æ¿å¼è®¾è®¡ã€‚è€Œæ¥å£æ˜¯ä¸€ç§è¡Œä¸ºè§„èŒƒï¼Œå®ƒæ˜¯ä¸€ç§è¾å°„å¼è®¾è®¡ã€‚ä»€ä¹ˆæ˜¯æ¨¡æ¿å¼è®¾è®¡ï¼Ÿæœ€ç®€å•ä¾‹å­ï¼Œå¤§å®¶éƒ½ç”¨è¿‡ ppt é‡Œé¢çš„æ¨¡æ¿ï¼Œå¦‚æœç”¨æ¨¡æ¿ A è®¾è®¡äº† ppt B å’Œ ppt Cï¼Œppt B å’Œ ppt C å…¬å…±çš„éƒ¨åˆ†å°±æ˜¯æ¨¡æ¿ A äº†ï¼Œå¦‚æœå®ƒä»¬çš„å…¬å…±éƒ¨åˆ†éœ€è¦æ”¹åŠ¨ï¼Œåˆ™åªéœ€è¦æ”¹åŠ¨æ¨¡æ¿ A å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦é‡æ–°å¯¹ ppt B å’Œ ppt C è¿›è¡Œæ”¹åŠ¨ã€‚è€Œè¾å°„å¼è®¾è®¡ï¼Œæ¯”å¦‚æŸä¸ªç”µæ¢¯éƒ½è£…äº†æŸç§æŠ¥è­¦å™¨ï¼Œä¸€æ—¦è¦æ›´æ–°æŠ¥è­¦å™¨ï¼Œå°±å¿…é¡»å…¨éƒ¨æ›´æ–°ã€‚ä¹Ÿå°±æ˜¯è¯´å¯¹äºæŠ½è±¡ç±»ï¼Œå¦‚æœéœ€è¦æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥åœ¨æŠ½è±¡ç±»ä¸­æ·»åŠ å…·ä½“çš„å®ç°ï¼Œå­ç±»å¯ä»¥ä¸è¿›è¡Œå˜æ›´ï¼›è€Œå¯¹äºæ¥å£åˆ™ä¸è¡Œï¼Œå¦‚æœæ¥å£è¿›è¡Œäº†å˜æ›´ï¼Œåˆ™æ‰€æœ‰å®ç°è¿™ä¸ªæ¥å£çš„ç±»éƒ½å¿…é¡»è¿›è¡Œç›¸åº”çš„æ”¹åŠ¨ã€‚

----


GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 5.12 Javaå†…éƒ¨ç±»

â€œåœ¨ Java ä¸­ï¼Œå¯ä»¥å°†ä¸€ä¸ªç±»å®šä¹‰åœ¨å¦å¤–ä¸€ä¸ªç±»é‡Œé¢æˆ–è€…ä¸€ä¸ªæ–¹æ³•é‡Œé¢ï¼Œè¿™æ ·çš„ç±»å«åšå†…éƒ¨ç±»ã€‚â€æˆ‘æ”¾ä¸‹æ‰‹ä¸­çš„æ¸ææ¯ï¼Œå¯¹ä¸‰å¦¹è¯´ï¼Œâ€œä¸€èˆ¬æ¥è¯´ï¼Œå†…éƒ¨ç±»åˆ†ä¸ºæˆå‘˜å†…éƒ¨ç±»ã€å±€éƒ¨å†…éƒ¨ç±»ã€åŒ¿åå†…éƒ¨ç±»å’Œé™æ€å†…éƒ¨ç±»ã€‚â€

### **1ï¼‰æˆå‘˜å†…éƒ¨ç±»**

æˆå‘˜å†…éƒ¨ç±»æ˜¯æœ€å¸¸è§çš„å†…éƒ¨ç±»ï¼Œçœ‹ä¸‹é¢çš„ä»£ç ï¼š

```java
class Wanger {
    int age = 18;
    
    class Wangxiaoer {
        int age = 81;
    }
}
```

çœ‹èµ·æ¥å†…éƒ¨ç±» Wangxiaoer å°±å¥½åƒ Wanger çš„ä¸€ä¸ªæˆå‘˜ï¼Œæˆå‘˜å†…éƒ¨ç±»å¯ä»¥æ— é™åˆ¶è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜å±æ€§ã€‚

```java
public class Wanger {
    int age = 18;
    private String name = "æ²‰é»˜ç‹äºŒ";
    static double money = 1;

    class Wangxiaoer {
        int age = 81;
        
        public void print() {
            System.out.println(name);
            System.out.println(money);
        }
    }
}
```

å†…éƒ¨ç±»å¯ä»¥éšå¿ƒæ‰€æ¬²åœ°è®¿é—®å¤–éƒ¨ç±»çš„æˆå‘˜ï¼Œä½†å¤–éƒ¨ç±»æƒ³è¦è®¿é—®å†…éƒ¨ç±»çš„æˆå‘˜ï¼Œå°±ä¸é‚£ä¹ˆå®¹æ˜“äº†ï¼Œå¿…é¡»å…ˆåˆ›å»ºä¸€ä¸ªæˆå‘˜å†…éƒ¨ç±»çš„å¯¹è±¡ï¼Œå†é€šè¿‡è¿™ä¸ªå¯¹è±¡æ¥è®¿é—®ï¼š

```java
public class Wanger {
    int age = 18;
    private String name = "æ²‰é»˜ç‹äºŒ";
    static double money = 1;

    public Wanger () {
        new Wangxiaoer().print();
    }

    class Wangxiaoer {
        int age = 81;

        public void print() {
            System.out.println(name);
            System.out.println(money);
        }
    }
}
```

è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œå¦‚æœæƒ³è¦åœ¨é™æ€æ–¹æ³•ä¸­è®¿é—®æˆå‘˜å†…éƒ¨ç±»çš„æ—¶å€™ï¼Œå°±å¿…é¡»å…ˆå¾—åˆ›å»ºä¸€ä¸ªå¤–éƒ¨ç±»çš„å¯¹è±¡ï¼Œå› ä¸ºå†…éƒ¨ç±»æ˜¯ä¾é™„äºå¤–éƒ¨ç±»çš„ã€‚

```java
public class Wanger {
    int age = 18;
    private String name = "æ²‰é»˜ç‹äºŒ";
    static double money = 1;

    public Wanger () {
        new Wangxiaoer().print();
    }

    public static void main(String[] args) {
        Wanger wanger = new Wanger();
        Wangxiaoer xiaoer = wanger.new Wangxiaoer();
        xiaoer.print();
    }

    class Wangxiaoer {
        int age = 81;

        public void print() {
            System.out.println(name);
            System.out.println(money);
        }
    }
}
```

è¿™ç§åˆ›å»ºå†…éƒ¨ç±»çš„æ–¹å¼åœ¨å®é™…å¼€å‘ä¸­å¹¶ä¸å¸¸ç”¨ï¼Œå› ä¸ºå†…éƒ¨ç±»å’Œå¤–éƒ¨ç±»ç´§ç´§åœ°ç»‘å®šåœ¨ä¸€èµ·ï¼Œä½¿ç”¨èµ·æ¥éå¸¸ä¸ä¾¿ã€‚

### **2ï¼‰å±€éƒ¨å†…éƒ¨ç±»**

å±€éƒ¨å†…éƒ¨ç±»æ˜¯å®šä¹‰åœ¨ä¸€ä¸ªæ–¹æ³•æˆ–è€…ä¸€ä¸ªä½œç”¨åŸŸé‡Œé¢çš„ç±»ï¼Œæ‰€ä»¥å±€éƒ¨å†…éƒ¨ç±»çš„ç”Ÿå‘½å‘¨æœŸä»…é™äºä½œç”¨åŸŸå†…ã€‚

```java
public class Wangsan {
    public Wangsan print() {
        class Wangxiaosan extends Wangsan{
            private int age = 18;
        }
        return new Wangxiaosan();
    }
}
```

å±€éƒ¨å†…éƒ¨ç±»å°±å¥½åƒä¸€ä¸ªå±€éƒ¨å˜é‡ä¸€æ ·ï¼Œå®ƒæ˜¯ä¸èƒ½è¢«æƒé™ä¿®é¥°ç¬¦ä¿®é¥°çš„ï¼Œæ¯”å¦‚è¯´ publicã€protectedã€private å’Œ static ç­‰ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/inner-class-26fc0242-134a-4588-a52d-7da962fc3fb9.png)

### **3ï¼‰åŒ¿åå†…éƒ¨ç±»**

åŒ¿åå†…éƒ¨ç±»æ˜¯æˆ‘ä»¬å¹³å¸¸ç”¨å¾—æœ€å¤šçš„ï¼Œå°¤å…¶æ˜¯å¯åŠ¨å¤šçº¿ç¨‹çš„æ—¶å€™ï¼Œä¼šç»å¸¸ç”¨åˆ°ï¼Œå¹¶ä¸” IDE ä¹Ÿä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆã€‚

```java
public class ThreadDemo {
    public static void main(String[] args) {
        Thread t = new Thread(new Runnable() {
            @Override
            public void run() {
                System.out.println(Thread.currentThread().getName());
            }
        });
        t.start();
    }
}
```

åŒ¿åå†…éƒ¨ç±»å°±å¥½åƒä¸€ä¸ªæ–¹æ³•çš„å‚æ•°ä¸€æ ·ï¼Œç”¨å®Œå°±æ²¡äº†ï¼Œä»¥è‡³äºæˆ‘ä»¬éƒ½ä¸éœ€è¦ä¸ºå®ƒä¸“é—¨å†™ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œå®ƒçš„åå­—ä¹Ÿæ˜¯ç”±ç³»ç»Ÿè‡ªåŠ¨å‘½åçš„ã€‚ä»”ç»†è§‚å¯Ÿç¼–è¯‘åçš„å­—èŠ‚ç æ–‡ä»¶ä¹Ÿå¯ä»¥å‘ç°ï¼ŒåŒ¿åå†…éƒ¨ç±»è¿åå­—éƒ½ä¸é…æ‹¥æœ‰ï¼Œå“ˆå“ˆï¼Œç›´æ¥å€Ÿç”¨çš„å¤–éƒ¨ç±»ï¼Œç„¶å `$1` å°±æå®šäº†ã€‚


![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/inner-class-c0b9bdf5-cb12-45fc-b362-cb14d5d44fdc.png)


åŒ¿åå†…éƒ¨ç±»æ˜¯å”¯ä¸€ä¸€ç§æ²¡æœ‰æ„é€ æ–¹æ³•çš„ç±»ã€‚å°±ä¸Šé¢çš„å†™æ³•æ¥è¯´ï¼ŒåŒ¿åå†…éƒ¨ç±»ä¹Ÿä¸å…è®¸æˆ‘ä»¬ä¸ºå…¶ç¼–å†™æ„é€ æ–¹æ³•ï¼Œå› ä¸ºå®ƒå°±åƒæ˜¯ç›´æ¥é€šè¿‡ new å…³é”®å­—åˆ›å»ºå‡ºæ¥çš„ä¸€ä¸ªå¯¹è±¡ã€‚

åŒ¿åå†…éƒ¨ç±»çš„ä½œç”¨ä¸»è¦æ˜¯ç”¨æ¥ç»§æ‰¿å…¶ä»–ç±»æˆ–è€…å®ç°æ¥å£ï¼Œå¹¶ä¸éœ€è¦å¢åŠ é¢å¤–çš„æ–¹æ³•ï¼Œæ–¹ä¾¿å¯¹ç»§æ‰¿çš„æ–¹æ³•è¿›è¡Œå®ç°æˆ–è€…é‡å†™ã€‚

### **4ï¼‰é™æ€å†…éƒ¨ç±»**

é™æ€å†…éƒ¨ç±»å’Œæˆå‘˜å†…éƒ¨ç±»ç±»ä¼¼ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ª [static å…³é”®å­—](https://tobebetterjavaer.com/oo/static.html)ã€‚

```java
public class Wangsi {
    static int age;
    double money;
    
    static class Wangxxiaosi {
        public Wangxxiaosi (){
            System.out.println(age);
        }
    }
}
```

ç”±äº static å…³é”®å­—çš„å­˜åœ¨ï¼Œé™æ€å†…éƒ¨ç±»æ˜¯ä¸å…è®¸è®¿é—®å¤–éƒ¨ç±»ä¸­é static çš„å˜é‡å’Œæ–¹æ³•çš„ï¼Œè¿™ä¸€ç‚¹ä¹Ÿéå¸¸å¥½ç†è§£ï¼šä½ ä¸€ä¸ªé™æ€çš„å†…éƒ¨ç±»è®¿é—®æˆ‘éé™æ€çš„æˆå‘˜å˜é‡å¹²å˜›ï¼Ÿ


![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/inner-class-69523196-37fe-43c6-a52e-5a8c94fdd2d8.png)

â€œä¸ºä»€ä¹ˆè¦ä½¿ç”¨å†…éƒ¨ç±»å‘¢ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

ä¸‰å¦¹è¿™ä¸ªé—®é¢˜é—®çš„éå¸¸å¦™ï¼Œæ˜¯æ—¶å€™å¼•ç»æ®å…¸äº†ã€‚

åœ¨ã€ŠThink in javaã€‹ä¸­æœ‰è¿™æ ·ä¸€å¥è¯ï¼š

>ä½¿ç”¨å†…éƒ¨ç±»æœ€å¸å¼•äººçš„åŸå› æ˜¯ï¼šæ¯ä¸ªå†…éƒ¨ç±»éƒ½èƒ½ç‹¬ç«‹åœ°ç»§æ‰¿ä¸€ä¸ªï¼ˆæ¥å£çš„ï¼‰å®ç°ï¼Œæ‰€ä»¥æ— è®ºå¤–å›´ç±»æ˜¯å¦å·²ç»ç»§æ‰¿äº†æŸä¸ªï¼ˆæ¥å£çš„ï¼‰å®ç°ï¼Œå¯¹äºå†…éƒ¨ç±»éƒ½æ²¡æœ‰å½±å“ã€‚

åœ¨æˆ‘ä»¬ç¨‹åºè®¾è®¡ä¸­æœ‰æ—¶å€™ä¼šå­˜åœ¨ä¸€äº›ä½¿ç”¨æ¥å£å¾ˆéš¾è§£å†³çš„é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å†…éƒ¨ç±»æä¾›çš„ã€å¯ä»¥ç»§æ‰¿å¤šä¸ªå…·ä½“çš„æˆ–è€…æŠ½è±¡çš„ç±»çš„èƒ½åŠ›æ¥è§£å†³è¿™äº›ç¨‹åºè®¾è®¡é—®é¢˜ã€‚å¯ä»¥è¿™æ ·è¯´ï¼Œæ¥å£åªæ˜¯è§£å†³äº†éƒ¨åˆ†é—®é¢˜ï¼Œè€Œå†…éƒ¨ç±»ä½¿å¾—å¤šé‡ç»§æ‰¿çš„è§£å†³æ–¹æ¡ˆå˜å¾—æ›´åŠ å®Œæ•´ã€‚

ä½¿ç”¨å†…éƒ¨ç±»è¿˜èƒ½å¤Ÿä¸ºæˆ‘ä»¬å¸¦æ¥å¦‚ä¸‹ç‰¹æ€§ï¼š

- 1ã€å†…éƒ¨ç±»å¯ä»¥ä½¿ç”¨å¤šä¸ªå®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹éƒ½æœ‰è‡ªå·±çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶ä¸”ä¸å…¶ä»–å¤–å›´å¯¹è±¡çš„ä¿¡æ¯ç›¸äº’ç‹¬ç«‹ã€‚
- 2ã€åœ¨å•ä¸ªå¤–éƒ¨ç±»ä¸­ï¼Œå¯ä»¥è®©å¤šä¸ªå†…éƒ¨ç±»ä»¥ä¸åŒçš„æ–¹å¼å®ç°åŒä¸€ä¸ªæ¥å£ï¼Œæˆ–è€…ç»§æ‰¿åŒä¸€ä¸ªç±»ã€‚
- 3ã€åˆ›å»ºå†…éƒ¨ç±»å¯¹è±¡çš„æ—¶åˆ»å¹¶ä¸ä¾èµ–äºå¤–éƒ¨ç±»å¯¹è±¡çš„åˆ›å»ºã€‚
- 4ã€å†…éƒ¨ç±»å¹¶æ²¡æœ‰ä»¤äººè¿·æƒ‘çš„â€œis-aâ€å…³ç³»ï¼Œä»–å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å®ä½“ã€‚
- 5ã€å†…éƒ¨ç±»æä¾›äº†æ›´å¥½çš„å°è£…ï¼Œé™¤äº†è¯¥å¤–å›´ç±»ï¼Œå…¶ä»–ç±»éƒ½ä¸èƒ½è®¿é—®ã€‚

>å‚è€ƒé“¾æ¥ï¼š[https://www.cnblogs.com/dolphin0520/p/3811445.html](https://www.cnblogs.com/dolphin0520/p/3811445.html)ï¼Œä½œè€…ï¼šMatrixæµ· å­ï¼Œç¼–è¾‘ï¼šæ²‰é»˜ç‹äºŒ


----


GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 5.13 Javaå°è£…ç»§æ‰¿å¤šæ€

åœ¨è°ˆ Java é¢å‘å¯¹è±¡çš„æ—¶å€™ï¼Œä¸å¾—ä¸æåˆ°é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹å¾ï¼š[å°è£…](https://tobebetterjavaer.com/oo/encapsulation.html)ã€[ç»§æ‰¿](https://tobebetterjavaer.com/oo/extends-bigsai.html)ã€[å¤šæ€](https://tobebetterjavaer.com/oo/polymorphism.html)ã€‚ä¸‰å¤§ç‰¹å¾ç´§å¯†è”ç³»è€Œåˆæœ‰åŒºåˆ«ï¼Œåˆç†ä½¿ç”¨ç»§æ‰¿èƒ½å¤§å¤§å‡å°‘é‡å¤ä»£ç ï¼Œ**æé«˜ä»£ç å¤ç”¨æ€§ã€‚**

### 1ï¼‰å°è£…

â€œä¸‰å¦¹ï¼Œå‡†å¤‡å¥½äº†æ²¡ï¼Œæˆ‘ä»¬æ¥è®² Java å°è£…ï¼Œç®—æ˜¯ Java çš„ä¸‰å¤§ç‰¹å¾ä¹‹ä¸€ï¼Œç†æ¸…æ¥šäº†ï¼Œå¯¹ä»¥åçš„ç¼–ç¨‹æœ‰è¾ƒå¤§çš„å¸®åŠ©ã€‚â€æˆ‘å¯¹ä¸‰å¦¹è¯´ã€‚

â€œå¥½çš„ï¼Œå“¥ï¼Œå‡†å¤‡å¥½äº†ã€‚â€ä¸‰å¦¹ä¸€è¾¹å¬æˆ‘è¯´ï¼Œä¸€è¾¹è¿…é€Ÿåœ°æ‰“å¼€äº† XMindï¼Œçœ‹æ¥ä¸€è¾¹å­¦ä¹ ä¸€è¾¹æ€»ç»“æ€ç»´å¯¼å›¾è¿™ä¸ªé«˜æ•ˆçš„å­¦ä¹ æ–¹å¼ä¸‰å¦¹å·²ç»ç‰¢è®°åœ¨å¿ƒäº†ã€‚

å°è£…ä»å­—é¢ä¸Šæ¥ç†è§£å°±æ˜¯åŒ…è£…çš„æ„æ€ï¼Œä¸“ä¸šç‚¹å°±æ˜¯ä¿¡æ¯éšè—ï¼Œ**æ˜¯æŒ‡åˆ©ç”¨æŠ½è±¡å°†æ•°æ®å’ŒåŸºäºæ•°æ®çš„æ“ä½œå°è£…åœ¨ä¸€èµ·ï¼Œä½¿å…¶æ„æˆä¸€ä¸ªä¸å¯åˆ†å‰²çš„ç‹¬ç«‹å®ä½“**ã€‚

æ•°æ®è¢«ä¿æŠ¤åœ¨ç±»çš„å†…éƒ¨ï¼Œå°½å¯èƒ½åœ°éšè—å†…éƒ¨çš„å®ç°ç»†èŠ‚ï¼Œåªä¿ç•™ä¸€äº›å¯¹å¤–æ¥å£ä½¿ä¹‹ä¸å¤–éƒ¨å‘ç”Ÿè”ç³»ã€‚

å…¶ä»–å¯¹è±¡åªèƒ½é€šè¿‡å·²ç»æˆæƒçš„æ“ä½œæ¥ä¸è¿™ä¸ªå°è£…çš„å¯¹è±¡è¿›è¡Œäº¤äº’ã€‚ä¹Ÿå°±æ˜¯è¯´ç”¨æˆ·æ˜¯æ— éœ€çŸ¥é“å¯¹è±¡å†…éƒ¨çš„ç»†èŠ‚ï¼ˆå½“ç„¶ä¹Ÿæ— ä»çŸ¥é“ï¼‰ï¼Œä½†å¯ä»¥é€šè¿‡è¯¥å¯¹è±¡å¯¹å¤–çš„æä¾›çš„æ¥å£æ¥è®¿é—®è¯¥å¯¹è±¡ã€‚

ä½¿ç”¨å°è£…æœ‰ 4 å¤§å¥½å¤„ï¼š

- 1ã€è‰¯å¥½çš„å°è£…èƒ½å¤Ÿå‡å°‘è€¦åˆã€‚
- 2ã€ç±»å†…éƒ¨çš„ç»“æ„å¯ä»¥è‡ªç”±ä¿®æ”¹ã€‚
- 3ã€å¯ä»¥å¯¹æˆå‘˜è¿›è¡Œæ›´ç²¾ç¡®çš„æ§åˆ¶ã€‚
- 4ã€éšè—ä¿¡æ¯ï¼Œå®ç°ç»†èŠ‚ã€‚

é¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹ä¸¤ä¸ªç±»ã€‚

Husband.java

```java
public class Husband {
    
    /*
     * å¯¹å±æ€§çš„å°è£…
     * ä¸€ä¸ªäººçš„å§“åã€æ€§åˆ«ã€å¹´é¾„ã€å¦»å­éƒ½æ˜¯è¿™ä¸ªäººçš„ç§æœ‰å±æ€§
     */
    private String name ;
    private String sex ;
    private int age ;
    private Wife wife;
    
    /*
     * setter()ã€getter()æ˜¯è¯¥å¯¹è±¡å¯¹å¤–å¼€å‘çš„æ¥å£
     */
    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getSex() {
        return sex;
    }

    public void setSex(String sex) {
        this.sex = sex;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }

    public void setWife(Wife wife) {
        this.wife = wife;
    }
}
```

Wife.java

```java
public class Wife {
    private String name;
    private int age;
    private String sex;
    private Husband husband;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getSex() {
        return sex;
    }

    public void setSex(String sex) {
        this.sex = sex;
    }

    public void setAge(int age) {
        this.age = age;
    }

    public void setHusband(Husband husband) {
        this.husband = husband;
    }

    public Husband getHusband() {
        return husband;
    }
    
}
```

å¯ä»¥çœ‹å¾—å‡ºï¼Œ Husband ç±»é‡Œé¢çš„ wife å±æ€§æ˜¯æ²¡æœ‰ `getter()`çš„ï¼ŒåŒæ—¶ Wife  ç±»çš„ age å±æ€§ä¹Ÿæ˜¯æ²¡æœ‰ `getter()`æ–¹æ³•çš„ã€‚è‡³äºç†ç”±æˆ‘æƒ³ä¸‰å¦¹ä½ æ˜¯æ‡‚çš„ã€‚

æ²¡æœ‰å“ªä¸ªå¥³äººæ„¿æ„åˆ«äººçŸ¥é“å¥¹çš„å¹´é¾„ã€‚

æ‰€ä»¥å°è£…æŠŠä¸€ä¸ªå¯¹è±¡çš„å±æ€§ç§æœ‰åŒ–ï¼ŒåŒæ—¶æä¾›ä¸€äº›å¯ä»¥è¢«å¤–ç•Œè®¿é—®çš„å±æ€§çš„æ–¹æ³•ï¼Œå¦‚æœä¸æƒ³è¢«å¤–ç•Œæ–¹æ³•ï¼Œæˆ‘ä»¬å¤§å¯ä¸å¿…æä¾›æ–¹æ³•ç»™å¤–ç•Œè®¿é—®ã€‚

ä½†æ˜¯å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰æä¾›ç»™å¤–ç•Œä»»ä½•å¯ä»¥è®¿é—®çš„æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ„ä¹‰äº†ã€‚

æ¯”å¦‚æˆ‘ä»¬å°†ä¸€ä¸ªæˆ¿å­çœ‹åšæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‡Œé¢æœ‰æ¼‚äº®çš„è£…é¥°ï¼Œå¦‚æ²™å‘ã€ç”µè§†å‰§ã€ç©ºè°ƒã€èŒ¶æ¡Œç­‰ç­‰éƒ½æ˜¯è¯¥æˆ¿å­çš„ç§æœ‰å±æ€§ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æ²¡æœ‰é‚£äº›å¢™é®æŒ¡ï¼Œæ˜¯ä¸æ˜¯åˆ«äººå°±ä¼šä¸€è§ˆæ— ä½™å‘¢ï¼Ÿæ²¡æœ‰ä¸€ç‚¹å„¿éšç§ï¼

å› ä¸ºå­˜åœ¨é‚£ä¸ªé®æŒ¡çš„å¢™ï¼Œæˆ‘ä»¬æ—¢èƒ½å¤Ÿæœ‰è‡ªå·±çš„éšç§è€Œä¸”æˆ‘ä»¬å¯ä»¥éšæ„çš„æ›´æ”¹é‡Œé¢çš„æ‘†è®¾è€Œä¸ä¼šå½±å“åˆ°å¤–é¢çš„äººã€‚

ä½†æ˜¯å¦‚æœæ²¡æœ‰é—¨çª—ï¼Œä¸€ä¸ªåŒ…è£¹çš„ä¸¥ä¸¥å®å®çš„é»‘ç›’å­ï¼Œåˆæœ‰ä»€ä¹ˆå­˜åœ¨çš„æ„ä¹‰å‘¢ï¼Ÿæ‰€ä»¥é€šè¿‡é—¨çª—åˆ«äººä¹Ÿèƒ½å¤Ÿçœ‹åˆ°é‡Œé¢çš„é£æ™¯ã€‚æ‰€ä»¥è¯´é—¨çª—å°±æ˜¯æˆ¿å­å¯¹è±¡ç•™ç»™å¤–ç•Œè®¿é—®çš„æ¥å£ã€‚

é€šè¿‡è¿™ä¸ªæˆ‘ä»¬è¿˜ä¸èƒ½çœŸæ­£ä½“ä¼šå°è£…çš„å¥½å¤„ã€‚ç°åœ¨æˆ‘ä»¬ä»ç¨‹åºçš„è§’åº¦æ¥åˆ†æå°è£…å¸¦æ¥çš„å¥½å¤„ã€‚å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨å°è£…ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å°±æ²¡æœ‰ `setter()`å’Œ `getter()`ï¼Œé‚£ä¹ˆ Husband ç±»åº”è¯¥è¿™æ ·å†™ï¼š

```java
public class Husband {
    public String name ;
    public String sex ;
    public int age ;
    public Wife wife;
}
```

æˆ‘ä»¬åº”è¯¥è¿™æ ·æ¥ä½¿ç”¨å®ƒï¼š

```java
Husband husband = new Husband();
husband.age = 30;
husband.name = "å¼ ä¸‰";
husband.sex = "ç”·";    //è²Œä¼¼æœ‰ç‚¹å„¿å¤šä½™
```

ä½†æ˜¯å“ªå¤©å¦‚æœæˆ‘ä»¬éœ€è¦ä¿®æ”¹ Husbandï¼Œä¾‹å¦‚å°† age ä¿®æ”¹ä¸º String ç±»å‹çš„å‘¢ï¼Ÿä½ åªæœ‰ä¸€å¤„ä½¿ç”¨äº†è¿™ä¸ªç±»è¿˜å¥½ï¼Œå¦‚æœä½ æœ‰å‡ åä¸ªç”šè‡³ä¸Šç™¾ä¸ªè¿™æ ·åœ°æ–¹ï¼Œä½ æ˜¯ä¸æ˜¯è¦æ”¹åˆ°å´©æºƒã€‚å¦‚æœä½¿ç”¨äº†å°è£…ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ä¸éœ€è¦åšä»»ä½•ä¿®æ”¹ï¼Œåªéœ€è¦ç¨å¾®æ”¹å˜ä¸‹ Husband ç±»çš„ `setAge()`æ–¹æ³•å³å¯ã€‚

```java
public class Husband {
    
    /*
     * å¯¹å±æ€§çš„å°è£…
     * ä¸€ä¸ªäººçš„å§“åã€æ€§åˆ«ã€å¹´é¾„ã€å¦»å­éƒ½æ˜¯è¿™ä¸ªäººçš„ç§æœ‰å±æ€§
     */
    private String name ;
    private String sex ;
    private String age ;    /* æ”¹æˆ Stringç±»å‹çš„*/
    private Wife wife;
    
    public String getAge() {
        return age;
    }
    
    public void setAge(int age) {
        //è½¬æ¢å³å¯
        this.age = String.valueOf(age);
    }
    
    /** çœç•¥å…¶ä»–å±æ€§çš„setterã€getter **/
    
}
```

å…¶ä»–çš„åœ°æ–¹ä¾ç„¶è¿™æ ·å¼•ç”¨( `husband.setAge(22)` )ä¿æŒä¸å˜ã€‚

åˆ°äº†è¿™é‡Œæˆ‘ä»¬ç¡®å®å¯ä»¥çœ‹å‡ºï¼Œ**å°è£…ç¡®å®å¯ä»¥ä½¿æˆ‘ä»¬æ›´å®¹æ˜“åœ°ä¿®æ”¹ç±»çš„å†…éƒ¨å®ç°ï¼Œè€Œæ— éœ€ä¿®æ”¹ä½¿ç”¨äº†è¯¥ç±»çš„ä»£ç **ã€‚

æˆ‘ä»¬å†çœ‹è¿™ä¸ªå¥½å¤„ï¼š**å°è£…å¯ä»¥å¯¹æˆå‘˜å˜é‡è¿›è¡Œæ›´ç²¾ç¡®çš„æ§åˆ¶**ã€‚

è¿˜æ˜¯é‚£ä¸ª Husbandï¼Œä¸€èˆ¬æ¥è¯´æˆ‘ä»¬åœ¨å¼•ç”¨è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™æ˜¯ä¸å®¹æ˜“å‡ºé”™çš„ï¼Œä½†æ˜¯æœ‰æ—¶ä½ è¿·ç³Šäº†ï¼Œå†™æˆäº†è¿™æ ·ï¼š

```java
Husband husband = new Husband();
husband.age = 300;
```

ä¹Ÿè®¸ä½ æ˜¯å› ä¸ºç²—å¿ƒå†™æˆäº†è¿™æ ·ï¼Œä½ å‘ç°äº†è¿˜å¥½ï¼Œå¦‚æœæ²¡æœ‰å‘ç°é‚£å°±éº»çƒ¦å¤§äº†ï¼Œè°è§è¿‡ 300 å²çš„è€å¦–æ€ªå•Šï¼

ä½†æ˜¯ä½¿ç”¨å°è£…æˆ‘ä»¬å°±å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯¹ age çš„è®¿é—®å…¥å£åšä¸€äº›æ§åˆ¶(setter)å¦‚ï¼š

```java
public class Husband {
    
    /*
     * å¯¹å±æ€§çš„å°è£…
     * ä¸€ä¸ªäººçš„å§“åã€æ€§åˆ«ã€å¹´é¾„ã€å¦»å­éƒ½æ˜¯è¿™ä¸ªäººçš„ç§æœ‰å±æ€§
     */
    private String name ;
    private String sex ;
    private int age ;    /* æ”¹æˆ Stringç±»å‹çš„*/
    private Wife wife;

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        if(age > 120){
            System.out.println("ERRORï¼šerror age input....");    //æç¤ºéŒ¯èª¤ä¿¡æ¯
        }else{
            this.age = age;
        }
        
    }
    
    /** çœç•¥å…¶ä»–å±æ€§çš„setterã€getter **/
    
}
```

ä¸Šé¢éƒ½æ˜¯å¯¹ setter æ–¹æ³•çš„æ§åˆ¶ï¼Œå…¶å®é€šè¿‡å°è£…æˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿå¯¹å¯¹è±¡çš„å‡ºå£åšå‡ºå¾ˆå¥½çš„æ§åˆ¶ã€‚ä¾‹å¦‚æ€§åˆ«åœ¨æ•°æ®åº“ä¸­ä¸€èˆ¬éƒ½æ˜¯ä»¥ 1ã€0 çš„æ–¹å¼æ¥å­˜å‚¨çš„ï¼Œä½†æ˜¯åœ¨å‰å°æˆ‘ä»¬åˆä¸èƒ½å±•ç¤º 1ã€0ï¼Œè¿™é‡Œæˆ‘ä»¬åªéœ€è¦åœ¨ `getter()`æ–¹æ³•é‡Œé¢åšä¸€äº›è½¬æ¢å³å¯ã€‚

```java
public String getSexName() {
    if("0".equals(sex)){
        sexName = "å¥³";
    }
    else if("1".equals(sex)){
        sexName = "ç”·";
    }
    return sexName;
}
```

åœ¨ä½¿ç”¨çš„æ—¶å€™æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ sexName å³å¯å®ç°æ­£ç¡®çš„æ€§åˆ«æ˜¾ç¤ºã€‚åŒç†ä¹Ÿå¯ä»¥ç”¨äºé’ˆå¯¹ä¸åŒçš„çŠ¶æ€åšå‡ºä¸åŒçš„æ“ä½œã€‚

```java
public String getCzHTML(){
    if("1".equals(zt)){
        czHTML = "<a href='javascript:void(0)' onclick='qy("+id+")'>å¯ç”¨</a>";
    }
    else{
        czHTML = "<a href='javascript:void(0)' onclick='jy("+id+")'>ç¦ç”¨</a>";
    }
    return czHTML;
}
```

â€œå¥½äº†ï¼Œå…³äºå°è£…æˆ‘ä»¬å°±æš‚æ—¶å°±èŠè¿™ä¹ˆå¤šå§ã€‚â€æˆ‘å–äº†ä¸€å£æ™®æ´±èŒ¶åï¼Œå¯¹ä¸‰å¦¹è¯´ã€‚

â€œå¥½çš„ï¼Œå“¥ï¼Œæˆ‘æ‡‚äº†ã€‚â€

> å‚è€ƒé“¾æ¥ï¼š[https://www.cnblogs.com/chenssy/p/3351835.html](https://www.cnblogs.com/chenssy/p/3351835.html)ï¼Œæ•´ç†ï¼šæ²‰é»˜ç‹äºŒ

### 2ï¼‰ç»§æ‰¿

#### 01ã€ä»€ä¹ˆæ˜¯ç»§æ‰¿

**ç»§æ‰¿**ï¼ˆè‹±è¯­ï¼šinheritanceï¼‰æ˜¯é¢å‘å¯¹è±¡è½¯ä»¶æŠ€æœ¯ä¸­çš„ä¸€ä¸ªæ¦‚å¿µã€‚å®ƒä½¿å¾—**å¤ç”¨ä»¥å‰çš„ä»£ç éå¸¸å®¹æ˜“ã€‚**

Java è¯­è¨€æ˜¯éå¸¸å…¸å‹çš„é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œåœ¨ Java è¯­è¨€ä¸­**ç»§æ‰¿å°±æ˜¯å­ç±»ç»§æ‰¿çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œä½¿å¾—å­ç±»å¯¹è±¡ï¼ˆå®ä¾‹ï¼‰å…·æœ‰çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œæˆ–å­ç±»ä»çˆ¶ç±»ç»§æ‰¿æ–¹æ³•ï¼Œä½¿å¾—å­ç±»å…·æœ‰çˆ¶ç±»ç›¸åŒçš„æ–¹æ³•**ã€‚

æˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­ï¼šåŠ¨ç‰©æœ‰å¾ˆå¤šç§ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ¦‚å¿µã€‚åœ¨åŠ¨ç‰©çš„ç§ç±»ä¸­ï¼Œæˆ‘ä»¬ç†Ÿæ‚‰çš„æœ‰çŒ«(Cat)ã€ç‹—(Dog)ç­‰åŠ¨ç‰©ï¼Œå®ƒä»¬éƒ½æœ‰åŠ¨ç‰©çš„ä¸€èˆ¬ç‰¹å¾ï¼ˆæ¯”å¦‚èƒ½å¤Ÿåƒä¸œè¥¿ï¼Œèƒ½å¤Ÿå‘å‡ºå£°éŸ³ï¼‰ï¼Œä¸è¿‡åˆåœ¨ç»†èŠ‚ä¸Šæœ‰åŒºåˆ«ï¼ˆä¸åŒåŠ¨ç‰©çš„åƒçš„ä¸åŒï¼Œå«å£°ä¸ä¸€æ ·ï¼‰ã€‚

åœ¨ Java è¯­è¨€ä¸­å®ç° Cat å’Œ Dog ç­‰ç±»çš„æ—¶å€™ï¼Œå°±éœ€è¦ç»§æ‰¿ Animal è¿™ä¸ªç±»ã€‚ç»§æ‰¿ä¹‹å Catã€Dog ç­‰å…·ä½“åŠ¨ç‰©ç±»å°±æ˜¯å­ç±»ï¼ŒAnimal ç±»å°±æ˜¯çˆ¶ç±»ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/extends-bigsai-bf43b473-4a05-4727-a543-c4edd44e5437.png)

#### 02ã€ä¸ºä»€ä¹ˆéœ€è¦ç»§æ‰¿

ä¸‰å¦¹ï¼Œä½ å¯èƒ½ä¼šé—®**ä¸ºä»€ä¹ˆéœ€è¦ç»§æ‰¿**ï¼Ÿ

å¦‚æœä»…ä»…åªæœ‰ä¸¤ä¸‰ä¸ªç±»ï¼Œæ¯ä¸ªç±»çš„å±æ€§å’Œæ–¹æ³•å¾ˆæœ‰é™çš„æƒ…å†µä¸‹ç¡®å®æ²¡å¿…è¦å®ç°ç»§æ‰¿ï¼Œä½†äº‹æƒ…å¹¶éå¦‚æ­¤ï¼Œäº‹å®ä¸Šä¸€ä¸ªç³»ç»Ÿä¸­å¾€å¾€æœ‰å¾ˆå¤šä¸ªç±»å¹¶ä¸”æœ‰ç€å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ï¼Œæ¯”å¦‚çŒ«å’Œç‹—åŒå±åŠ¨ç‰©ï¼Œæˆ–è€…å­¦ç”Ÿå’Œè€å¸ˆåŒå±äººã€‚å„ä¸ªç±»å¯èƒ½åˆæœ‰å¾ˆå¤šä¸ªç›¸åŒçš„å±æ€§å’Œæ–¹æ³•ï¼Œè¿™æ ·çš„è¯å¦‚æœæ¯ä¸ªç±»éƒ½é‡æ–°å†™ä¸ä»…ä»£ç æ˜¾å¾—å¾ˆä¹±ï¼Œä»£ç å·¥ä½œé‡ä¹Ÿå¾ˆå¤§ã€‚

è¿™æ—¶ç»§æ‰¿çš„ä¼˜åŠ¿å°±å‡ºæ¥äº†ï¼šå¯ä»¥ç›´æ¥ä½¿ç”¨çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œè‡ªå·±ä¹Ÿå¯ä»¥æœ‰è‡ªå·±æ–°çš„å±æ€§å’Œæ–¹æ³•æ»¡è¶³æ‹“å±•ï¼Œçˆ¶ç±»çš„æ–¹æ³•å¦‚æœè‡ªå·±æœ‰éœ€æ±‚æ›´æ”¹ä¹Ÿå¯ä»¥é‡å†™ã€‚è¿™æ ·**ä½¿ç”¨ç»§æ‰¿ä¸ä»…å¤§å¤§çš„å‡å°‘äº†ä»£ç é‡ï¼Œä¹Ÿä½¿å¾—ä»£ç ç»“æ„æ›´åŠ æ¸…æ™°å¯è§**ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/extends-bigsai-eeee7ea3-30d5-4bb1-9c9d-5e3bf427e805.png)

æ‰€ä»¥è¿™æ ·ä»ä»£ç çš„å±‚é¢ä¸Šæ¥çœ‹æˆ‘ä»¬è®¾è®¡è¿™ä¸ªå®Œæ•´çš„ Animal ç±»æ˜¯è¿™æ ·çš„ï¼š

```java
class Animal
{
    public int id;
    public String name;
    public int age;
    public int weight;

    public Animal(int id, String name, int age, int weight) {
        this.id = id;
        this.name = name;
        this.age = age;
        this.weight = weight;
    }
    //è¿™é‡Œçœç•¥get setæ–¹æ³•
    public void sayHello()
    {
        System.out.println("hello");
    }
    public void eat()
    {
        System.out.println("I'm eating");
    }
    public void sing()
    {
        System.out.println("sing");
    }
}
```

è€Œ Dogï¼ŒCatï¼ŒChicken ç±»å¯ä»¥è¿™æ ·è®¾è®¡ï¼š

```java
class Dog extends Animal//ç»§æ‰¿animal
{
    public Dog(int id, String name, int age, int weight) {
        super(id, name, age, weight);//è°ƒç”¨çˆ¶ç±»æ„é€ æ–¹æ³•
    }
}
class Cat extends Animal{

    public Cat(int id, String name, int age, int weight) {
        super(id, name, age, weight);//è°ƒç”¨çˆ¶ç±»æ„é€ æ–¹æ³•
    }
}
class Chicken extends Animal{

    public Chicken(int id, String name, int age, int weight) {
        super(id, name, age, weight);//è°ƒç”¨çˆ¶ç±»æ„é€ æ–¹æ³•
    }
    //é¸¡ä¸‹è›‹
    public void layEggs()
    {
        System.out.println("æˆ‘æ˜¯è€æ¯é¸¡ä¸‹è›‹å•¦ï¼Œå’¯å“’å’¯ï¼å’¯å“’å’¯ï¼");
    }
}
```

å„è‡ªçš„ç±»ç»§æ‰¿ Animal åå¯ä»¥ç›´æ¥ä½¿ç”¨ Animal ç±»çš„å±æ€§å’Œæ–¹æ³•è€Œä¸éœ€è¦é‡å¤ç¼–å†™ï¼Œå„ä¸ªç±»å¦‚æœæœ‰è‡ªå·±çš„æ–¹æ³•ä¹Ÿå¯å¾ˆå®¹æ˜“åœ°æ‹“å±•ã€‚

#### 03ã€ç»§æ‰¿çš„åˆ†ç±»

ç»§æ‰¿åˆ†ä¸ºå•ç»§æ‰¿å’Œå¤šç»§æ‰¿ï¼ŒJava è¯­è¨€åªæ”¯æŒç±»çš„å•ç»§æ‰¿ï¼Œä½†å¯ä»¥é€šè¿‡å®ç°æ¥å£çš„æ–¹å¼è¾¾åˆ°å¤šç»§æ‰¿çš„ç›®çš„ã€‚**è¿™ä¸ªæˆ‘ä»¬ä¹‹å‰åœ¨è®²æ¥å£çš„æ—¶å€™å°±æåˆ°è¿‡ï¼Œè¿™é‡Œæˆ‘ä»¬å†èŠä¸€ä¸‹ã€‚**

ç»§æ‰¿ | å®šä¹‰ | ä¼˜ç¼ºç‚¹ |
---| ---- | ------ |
å•ç»§æ‰¿![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/extends-bigsai-62bbc6a2-4e0e-4150-9f83-fceb65c56667.png)|ä¸€ä¸ªå­ç±»åªæ‹¥æœ‰ä¸€ä¸ªçˆ¶ç±»|ä¼˜ç‚¹ï¼šåœ¨ç±»å±‚æ¬¡ç»“æ„ä¸Šæ¯”è¾ƒæ¸…æ™°<br>ç¼ºç‚¹ï¼šç»“æ„çš„ä¸°å¯Œåº¦æœ‰æ—¶ä¸èƒ½æ»¡è¶³ä½¿ç”¨éœ€æ±‚|
å¤šç»§æ‰¿ï¼ˆJava ä¸æ”¯æŒï¼Œä½†å¯ä»¥ç”¨å…¶å®ƒæ–¹å¼æ»¡è¶³å¤šç»§æ‰¿ä½¿ç”¨éœ€æ±‚ï¼‰![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/extends-bigsai-e2ebc65a-5385-44a0-8ef3-a1b17e0252f1.png)|ä¸€ä¸ªå­ç±»æ‹¥æœ‰å¤šä¸ªç›´æ¥çš„çˆ¶ç±»|ä¼˜ç‚¹ï¼šå­ç±»çš„ä¸°å¯Œåº¦å¾ˆé«˜<br>ç¼ºç‚¹ï¼šå®¹æ˜“é€ æˆæ··ä¹±|

##### **å•ç»§æ‰¿**

å•ç»§æ‰¿ï¼Œä¸€ä¸ªå­ç±»åªæœ‰ä¸€ä¸ªçˆ¶ç±»ï¼Œå¦‚æˆ‘ä»¬ä¸Šé¢è®²è¿‡çš„ Animal ç±»å’Œå®ƒçš„å­ç±»ã€‚**å•ç»§æ‰¿åœ¨ç±»å±‚æ¬¡ç»“æ„ä¸Šæ¯”è¾ƒæ¸…æ™°ï¼Œä½†ç¼ºç‚¹æ˜¯ç»“æ„çš„ä¸°å¯Œåº¦æœ‰æ—¶ä¸èƒ½æ»¡è¶³ä½¿ç”¨éœ€æ±‚**ã€‚

##### **å¤šç»§æ‰¿**

å¤šç»§æ‰¿ï¼Œä¸€ä¸ªå­ç±»æœ‰å¤šä¸ªç›´æ¥çš„çˆ¶ç±»ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å­ç±»æ‹¥æœ‰æ‰€æœ‰çˆ¶ç±»çš„ç‰¹å¾ï¼Œ**å­ç±»çš„ä¸°å¯Œåº¦å¾ˆé«˜ï¼Œä½†æ˜¯ç¼ºç‚¹å°±æ˜¯å®¹æ˜“é€ æˆæ··ä¹±**ã€‚ä¸‹å›¾ä¸ºä¸€ä¸ªæ··ä¹±çš„ä¾‹å­ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/extends-bigsai-ab4c9fef-63be-4bba-a871-7e5fb9bf711a.png)

Java è™½ç„¶ä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œä½†æ˜¯ Java æœ‰ä¸‰ç§å®ç°å¤šç»§æ‰¿æ•ˆæœçš„æ–¹å¼ï¼Œ**åˆ†åˆ«æ˜¯**å†…éƒ¨ç±»ã€å¤šå±‚ç»§æ‰¿å’Œå®ç°æ¥å£ã€‚

[å†…éƒ¨ç±»](https://tobebetterjavaer.com/oo/inner-class.html)å¯ä»¥ç»§æ‰¿ä¸€ä¸ªä¸å¤–éƒ¨ç±»æ— å…³çš„ç±»ï¼Œä¿è¯äº†å†…éƒ¨ç±»çš„ç‹¬ç«‹æ€§ï¼Œæ­£æ˜¯åŸºäºè¿™ä¸€ç‚¹ï¼Œå¯ä»¥è¾¾åˆ°å¤šç»§æ‰¿çš„æ•ˆæœã€‚

**å¤šå±‚ç»§æ‰¿ï¼š**å­ç±»ç»§æ‰¿çˆ¶ç±»ï¼Œçˆ¶ç±»å¦‚æœè¿˜ç»§æ‰¿å…¶ä»–çš„ç±»ï¼Œé‚£ä¹ˆè¿™å°±å«**å¤šå±‚ç»§æ‰¿**ã€‚è¿™æ ·å­ç±»å°±ä¼šæ‹¥æœ‰æ‰€æœ‰è¢«ç»§æ‰¿ç±»çš„å±æ€§å’Œæ–¹æ³•ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/extends-bigsai-d3789496-09f8-4a62-8424-e5c45e224320.png)

[å®ç°æ¥å£](https://tobebetterjavaer.com/oo/interface.html)æ— ç–‘æ˜¯æ»¡è¶³å¤šç»§æ‰¿ä½¿ç”¨éœ€æ±‚çš„æœ€å¥½æ–¹å¼ï¼Œä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£æ»¡è¶³è‡ªå·±åœ¨ä¸°å¯Œæ€§å’Œå¤æ‚ç¯å¢ƒçš„ä½¿ç”¨éœ€æ±‚ã€‚

ç±»å’Œæ¥å£ç›¸æ¯”ï¼Œ**ç±»å°±æ˜¯ä¸€ä¸ªå®ä½“ï¼Œæœ‰å±æ€§å’Œæ–¹æ³•ï¼Œè€Œæ¥å£æ›´å€¾å‘äºä¸€ç»„æ–¹æ³•**ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå°±æ‹¿æ–—ç½—å¤§é™†çš„å”ä¸‰æ¥çœ‹ï¼Œä»–å­˜åœ¨çš„ç»§æ‰¿å…³ç³»å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/extends-bigsai-c06ece50-32e5-4b03-a31b-05ef03592d0c.png)

#### 04ã€å¦‚ä½•å®ç°ç»§æ‰¿

##### **extends å…³é”®å­—**

åœ¨ Java ä¸­ï¼Œç±»çš„ç»§æ‰¿æ˜¯å•ä¸€ç»§æ‰¿ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªå­ç±»åªèƒ½æ‹¥æœ‰ä¸€ä¸ªçˆ¶ç±»ï¼Œæ‰€ä»¥**extends**åªèƒ½ç»§æ‰¿ä¸€ä¸ªç±»ã€‚å…¶ä½¿ç”¨è¯­æ³•ä¸ºï¼š

```java
class å­ç±»å extends çˆ¶ç±»å{}
```

ä¾‹å¦‚ Dog ç±»ç»§æ‰¿ Animal ç±»ï¼Œå®ƒæ˜¯è¿™æ ·çš„ï¼š

```java
class Animal{} //å®šä¹‰Animalç±»
class Dog extends Animal{} //Dogç±»ç»§æ‰¿Animalç±»
```

å­ç±»ç»§æ‰¿çˆ¶ç±»åï¼Œå°±æ‹¥æœ‰çˆ¶ç±»çš„éç§æœ‰çš„**å±æ€§å’Œæ–¹æ³•**ã€‚å¦‚æœä¸æ˜ç™½ï¼Œè¯·çœ‹è¿™ä¸ªæ¡ˆä¾‹ï¼Œåœ¨ IDEA ä¸‹åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œåˆ›å»ºä¸€ä¸ª test ç±»åšæµ‹è¯•ï¼Œåˆ†åˆ«åˆ›å»º Animal ç±»å’Œ Dog ç±»ï¼ŒAnimal ä½œä¸ºçˆ¶ç±»å†™ä¸€ä¸ª sayHello()æ–¹æ³•ï¼ŒDog ç±»ç»§æ‰¿ Animal ç±»ä¹‹åå°±å¯ä»¥è°ƒç”¨ sayHello()æ–¹æ³•ã€‚å…·ä½“ä»£ç ä¸ºï¼š

```java
class Animal {
    public void  sayHello()//çˆ¶ç±»çš„æ–¹æ³•
    {
        System.out.println("hello,everybody");
    }
}
class Dog extends Animal//ç»§æ‰¿animal
{ }
public class test {
    public static void main(String[] args) {
       Dog dog=new Dog();
       dog.sayHello();
    }
}
```

ç‚¹å‡»è¿è¡Œçš„æ—¶å€™ Dog å­ç±»å¯ä»¥ç›´æ¥ä½¿ç”¨ Animal çˆ¶ç±»çš„æ–¹æ³•ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/extends-bigsai-2ba4864f-af39-4bd7-b59c-db53ec1c38f6.png)

##### **implements å…³é”®å­—**

ä½¿ç”¨ implements å…³é”®å­—å¯ä»¥å˜ç›¸ä½¿ Java æ‹¥æœ‰å¤šç»§æ‰¿çš„ç‰¹æ€§ï¼Œä½¿ç”¨èŒƒå›´ä¸ºç±»å®ç°æ¥å£çš„æƒ…å†µï¼Œä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£(æ¥å£ä¸æ¥å£ä¹‹é—´ç”¨é€—å·åˆ†å¼€)ã€‚

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ¡ˆä¾‹ï¼Œåˆ›å»ºä¸€ä¸ª test2 ç±»åšæµ‹è¯•ï¼Œåˆ†åˆ«åˆ›å»º doA æ¥å£å’Œ doB æ¥å£ï¼ŒdoA æ¥å£å£°æ˜ sayHello()æ–¹æ³•ï¼ŒdoB æ¥å£å£°æ˜ eat()æ–¹æ³•ï¼Œåˆ›å»º Cat2 ç±»å®ç° doA å’Œ doB æ¥å£ï¼Œå¹¶ä¸”åœ¨ç±»ä¸­éœ€è¦é‡å†™ sayHello()æ–¹æ³•å’Œ eat()æ–¹æ³•ã€‚å…·ä½“ä»£ç ä¸ºï¼š

```java
interface doA{
     void sayHello();
}
interface doB{
     void eat();
    //ä»¥ä¸‹ä¼šæŠ¥é”™ æ¥å£ä¸­çš„æ–¹æ³•ä¸èƒ½å…·ä½“å®šä¹‰åªèƒ½å£°æ˜
    //public void eat(){System.out.println("eating");}
}
class Cat2 implements  doA,doB{
    @Override//å¿…é¡»é‡å†™æ¥å£å†…çš„æ–¹æ³•
    public void sayHello() {
        System.out.println("hello!");
    }
    @Override
    public void eat() {
        System.out.println("I'm eating");
    }
}
public class test2 {
    public static void main(String[] args) {
        Cat2 cat=new Cat2();
        cat.sayHello();
        cat.eat();
    }
}
```

Cat ç±»å®ç° doA å’Œ doB æ¥å£çš„æ—¶å€™ï¼Œéœ€è¦å®ç°å…¶å£°æ˜çš„æ–¹æ³•ï¼Œç‚¹å‡»è¿è¡Œç»“æœå¦‚ä¸‹ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªç±»å®ç°æ¥å£çš„ç®€å•æ¡ˆä¾‹ï¼š

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/extends-bigsai-32bdceb5-e838-47cb-ad96-b7453abae6a5.png)

#### 05ã€ç»§æ‰¿çš„ç‰¹ç‚¹

ç»§æ‰¿çš„ä¸»è¦å†…å®¹å°±æ˜¯å­ç±»ç»§æ‰¿çˆ¶ç±»ï¼Œå¹¶é‡å†™çˆ¶ç±»çš„æ–¹æ³•ã€‚ä½¿ç”¨å­ç±»çš„å±æ€§æˆ–æ–¹æ³•æ—¶å€™ï¼Œé¦–å…ˆè¦åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè€Œå¯¹è±¡é€šè¿‡[æ„é€ æ–¹æ³•](https://tobebetterjavaer.com/oo/construct.html)å»åˆ›å»ºï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­æˆ‘ä»¬å¯èƒ½ä¼šè°ƒç”¨å­çˆ¶ç±»çš„ä¸€äº›å±æ€§å’Œæ–¹æ³•ï¼Œæ‰€ä»¥å°±éœ€è¦æå‰æŒæ¡ [this å’Œ superå…³é”®å­—](https://tobebetterjavaer.com/oo/this-super.html)ã€‚

åˆ›å»ºå®Œè¿™ä¸ªå¯¹è±¡ä¹‹åï¼Œå†è°ƒç”¨**é‡å†™**çˆ¶ç±»åçš„æ–¹æ³•ï¼Œæ³¨æ„[é‡å†™å’Œé‡è½½çš„åŒºåˆ«](https://tobebetterjavaer.com/basic-extra-meal/override-overload.html)ã€‚

##### this å’Œ super å…³é”®å­—

>[åé¢](https://tobebetterjavaer.com/oo/this-super.html)ä¼šè¯¦ç»†è®²ï¼Œè¿™é‡Œå…ˆæ¥ç®€å•äº†è§£ä¸€ä¸‹ã€‚

this å’Œ super å…³é”®å­—æ˜¯ç»§æ‰¿ä¸­**éå¸¸é‡è¦çš„çŸ¥è¯†ç‚¹**ï¼Œåˆ†åˆ«è¡¨ç¤ºå½“å‰å¯¹è±¡çš„å¼•ç”¨å’Œçˆ¶ç±»å¯¹è±¡çš„å¼•ç”¨ï¼Œä¸¤è€…æœ‰å¾ˆå¤§ç›¸ä¼¼åˆæœ‰ä¸€äº›åŒºåˆ«ã€‚

**this è¡¨ç¤ºå½“å‰å¯¹è±¡ï¼Œæ˜¯æŒ‡å‘è‡ªå·±çš„å¼•ç”¨ã€‚**

```java
this.å±æ€§ // è°ƒç”¨æˆå‘˜å˜é‡ï¼Œè¦åŒºåˆ«æˆå‘˜å˜é‡å’Œå±€éƒ¨å˜é‡
this.() // è°ƒç”¨æœ¬ç±»çš„æŸä¸ªæ–¹æ³•
this() // è¡¨ç¤ºè°ƒç”¨æœ¬ç±»æ„é€ æ–¹æ³•
```

**super è¡¨ç¤ºçˆ¶ç±»å¯¹è±¡ï¼Œæ˜¯æŒ‡å‘çˆ¶ç±»çš„å¼•ç”¨ã€‚**

```java
super.å±æ€§ // è¡¨ç¤ºçˆ¶ç±»å¯¹è±¡ä¸­çš„æˆå‘˜å˜é‡
super.æ–¹æ³•() // è¡¨ç¤ºçˆ¶ç±»å¯¹è±¡ä¸­å®šä¹‰çš„æ–¹æ³•
super() // è¡¨ç¤ºè°ƒç”¨çˆ¶ç±»æ„é€ æ–¹æ³•
```

##### æ„é€ æ–¹æ³•

[æ„é€ æ–¹æ³•](https://tobebetterjavaer.com/oo/construct.html)æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–¹æ³•ï¼Œ**å®ƒæ˜¯ä¸€ä¸ªä¸ç±»åŒåçš„æ–¹æ³•**ã€‚åœ¨ç»§æ‰¿ä¸­**æ„é€ æ–¹æ³•æ˜¯ä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„æ–¹æ³•**ï¼ˆæ¯”å¦‚ä¸èƒ½ç»§æ‰¿ï¼‰ï¼Œæ‰€ä»¥è¦äº†è§£å’Œå­¦ä¹ åœ¨ç»§æ‰¿ä¸­æ„é€ æ–¹æ³•çš„è§„åˆ™å’Œè¦æ±‚ã€‚

ç»§æ‰¿ä¸­çš„æ„é€ æ–¹æ³•æœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š

**çˆ¶ç±»çš„æ„é€ æ–¹æ³•ä¸èƒ½è¢«ç»§æ‰¿ï¼š**

å› ä¸ºæ„é€ æ–¹æ³•è¯­æ³•æ˜¯**ä¸ç±»åŒå**ï¼Œè€Œç»§æ‰¿åˆ™ä¸æ›´æ”¹æ–¹æ³•åï¼Œå¦‚æœå­ç±»ç»§æ‰¿çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œé‚£æ˜æ˜¾ä¸æ„é€ æ–¹æ³•çš„è¯­æ³•å†²çªäº†ã€‚æ¯”å¦‚ Father ç±»çš„æ„é€ æ–¹æ³•åä¸º Father()ï¼ŒSon ç±»å¦‚æœç»§æ‰¿ Father ç±»çš„æ„é€ æ–¹æ³• Father()ï¼Œé‚£å°±å’Œæ„é€ æ–¹æ³•å®šä¹‰ï¼š**æ„é€ æ–¹æ³•ä¸ç±»åŒå**å†²çªäº†ï¼Œæ‰€ä»¥åœ¨å­ç±»ä¸­ä¸èƒ½ç»§æ‰¿çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œä½†å­ç±»ä¼šè°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ã€‚

**å­ç±»çš„æ„é€ è¿‡ç¨‹å¿…é¡»è°ƒç”¨å…¶çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼š**

Java è™šæ‹Ÿæœº**æ„é€ å­ç±»å¯¹è±¡å‰ä¼šå…ˆæ„é€ çˆ¶ç±»å¯¹è±¡ï¼Œçˆ¶ç±»å¯¹è±¡æ„é€ å®Œæˆä¹‹åå†æ¥æ„é€ å­ç±»ç‰¹æœ‰çš„å±æ€§ï¼Œ**è¿™è¢«ç§°ä¸º**å†…å­˜å åŠ **ã€‚è€Œ Java è™šæ‹Ÿæœºæ„é€ çˆ¶ç±»å¯¹è±¡ä¼šæ‰§è¡Œçˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œæ‰€ä»¥å­ç±»æ„é€ æ–¹æ³•å¿…é¡»è°ƒç”¨ super()å³çˆ¶ç±»çš„æ„é€ æ–¹æ³•ã€‚å°±æ¯”å¦‚ä¸€ä¸ªç®€å•çš„ç»§æ‰¿æ¡ˆä¾‹åº”è¯¥è¿™ä¹ˆå†™ï¼š

```java
class A{
    public String name;
    public A() {//æ— å‚æ„é€ 
    }
    public A (String name){//æœ‰å‚æ„é€ 
    }
}
class B extends A{
    public B() {//æ— å‚æ„é€ 
       super();
    }
    public B(String name) {//æœ‰å‚æ„é€ 
      //super();
       super(name);
    }
}
```

**å¦‚æœå­ç±»çš„æ„é€ æ–¹æ³•ä¸­æ²¡æœ‰æ˜¾ç¤ºåœ°è°ƒç”¨çˆ¶ç±»æ„é€ æ–¹æ³•ï¼Œåˆ™ç³»ç»Ÿé»˜è®¤è°ƒç”¨çˆ¶ç±»æ— å‚æ•°çš„æ„é€ æ–¹æ³•ã€‚**

ä½ å¯èƒ½æœ‰æ—¶å€™åœ¨å†™ç»§æ‰¿çš„æ—¶å€™å­ç±»å¹¶æ²¡æœ‰ä½¿ç”¨ super()è°ƒç”¨ï¼Œç¨‹åºä¾ç„¶æ²¡é—®é¢˜ï¼Œå…¶å®è¿™æ ·æ˜¯ä¸ºäº†èŠ‚çœä»£ç ï¼Œç³»ç»Ÿæ‰§è¡Œæ—¶ä¼šè‡ªåŠ¨æ·»åŠ çˆ¶ç±»çš„æ— å‚æ„é€ æ–¹å¼ï¼Œå¦‚æœä¸ä¿¡çš„è¯æˆ‘ä»¬å¯¹ä¸Šé¢çš„ç±»ç¨ä½œä¿®æ”¹æ‰§è¡Œï¼š

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/extends-bigsai-33980b57-857b-4428-8b27-47d6d5060f29.png)

##### æ–¹æ³•é‡å†™(Override)

[æ–¹æ³•é‡å†™](https://tobebetterjavaer.com/basic-extra-meal/Overriding.html)ä¹Ÿå°±æ˜¯å­ç±»ä¸­å‡ºç°å’Œçˆ¶ç±»ä¸­ä¸€æ¨¡ä¸€æ ·çš„æ–¹æ³•(åŒ…æ‹¬è¿”å›å€¼ç±»å‹ï¼Œæ–¹æ³•åï¼Œå‚æ•°åˆ—è¡¨)ï¼Œå®ƒå»ºç«‹åœ¨ç»§æ‰¿çš„åŸºç¡€ä¸Šã€‚ä½ å¯ä»¥ç†è§£ä¸ºæ–¹æ³•çš„**å¤–å£³ä¸å˜ï¼Œä½†æ˜¯æ ¸å¿ƒå†…å®¹é‡å†™**ã€‚

åœ¨è¿™é‡Œæä¾›ä¸€ä¸ªç®€å•æ˜“æ‡‚çš„æ–¹æ³•é‡å†™æ¡ˆä¾‹ï¼š

```java
class E1{
    public void doA(int a){
        System.out.println("è¿™æ˜¯çˆ¶ç±»çš„æ–¹æ³•");
    }
}
class E2 extends E1{
    @Override
    public void doA(int a) {
        System.out.println("æˆ‘é‡å†™çˆ¶ç±»æ–¹æ³•ï¼Œè¿™æ˜¯å­ç±»çš„æ–¹æ³•");
    }
}
```

å…¶ä¸­`@Override` æ³¨è§£æ˜¾ç¤ºå£°æ˜è¯¥æ–¹æ³•ä¸ºæ³¨è§£æ–¹æ³•ï¼Œå¯ä»¥å¸®ä½ æ£€æŸ¥é‡å†™æ–¹æ³•çš„è¯­æ³•æ­£ç¡®æ€§ï¼Œå½“ç„¶å¦‚æœä¸åŠ ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†å»ºè®®åŠ ä¸Šã€‚

##### æ–¹æ³•é‡è½½(Overload)

å¦‚æœæœ‰ä¸¤ä¸ªæ–¹æ³•çš„**æ–¹æ³•åç›¸åŒ**ï¼Œä½†å‚æ•°ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆå¯ä»¥è¯´ä¸€ä¸ªæ–¹æ³•æ˜¯å¦ä¸€ä¸ªæ–¹æ³•çš„[é‡è½½](https://tobebetterjavaer.com/basic-extra-meal/override-overload.html)ã€‚

é‡è½½å¯ä»¥é€šå¸¸ç†è§£ä¸ºå®ŒæˆåŒä¸€ä¸ªäº‹æƒ…çš„æ–¹æ³•åç›¸åŒï¼Œä½†æ˜¯å‚æ•°åˆ—è¡¨ä¸åŒå…¶ä»–æ¡ä»¶ä¹Ÿå¯èƒ½ä¸åŒã€‚ä¸€ä¸ªç®€å•çš„æ–¹æ³•é‡è½½çš„ä¾‹å­ï¼Œç±» E3 ä¸­çš„ add()æ–¹æ³•å°±æ˜¯ä¸€ä¸ªé‡è½½æ–¹æ³•ã€‚

```java
class E3{
    public int add(int a,int b){
        return a+b;
    }
    public double add(double a,double b) {
        return a+b;
    }
    public int add(int a,int b,int c) {
        return a+b+c;
    }
}
```

#### 06ã€ç»§æ‰¿ä¸ä¿®é¥°ç¬¦

Java ä¿®é¥°ç¬¦çš„ä½œç”¨å°±æ˜¯å¯¹ç±»æˆ–ç±»æˆå‘˜è¿›è¡Œä¿®é¥°æˆ–é™åˆ¶ï¼Œæ¯ä¸ªä¿®é¥°ç¬¦éƒ½æœ‰è‡ªå·±çš„ä½œç”¨ï¼Œè€Œåœ¨ç»§æ‰¿ä¸­å¯èƒ½æœ‰äº›ç‰¹æ®Šä¿®é¥°ç¬¦ä½¿å¾—è¢«ä¿®é¥°çš„å±æ€§æˆ–æ–¹æ³•ä¸èƒ½è¢«ç»§æ‰¿ï¼Œæˆ–è€…ç»§æ‰¿éœ€è¦ä¸€äº›å…¶ä»–çš„æ¡ä»¶ã€‚

Java è¯­è¨€æä¾›äº†å¾ˆå¤šä¿®é¥°ç¬¦ï¼Œä¿®é¥°ç¬¦ç”¨æ¥å®šä¹‰ç±»ã€æ–¹æ³•æˆ–è€…å˜é‡ï¼Œé€šå¸¸æ”¾åœ¨è¯­å¥çš„æœ€å‰ç«¯ã€‚ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸¤ç±»ï¼š

- [è®¿é—®æƒé™ä¿®é¥°ç¬¦](https://tobebetterjavaer.com/oo/access-control.html)ï¼Œä¹Ÿå°±æ˜¯ publicã€privateã€protected ç­‰
- éè®¿é—®ä¿®é¥°ç¬¦ï¼Œä¹Ÿå°±æ˜¯ staticã€finalã€abstract ç­‰

##### è®¿é—®ä¿®é¥°ç¬¦

Java å­ç±»é‡å†™ç»§æ‰¿çš„æ–¹æ³•æ—¶ï¼Œ**ä¸å¯ä»¥é™ä½æ–¹æ³•çš„è®¿é—®æƒé™**ï¼Œ**å­ç±»ç»§æ‰¿çˆ¶ç±»çš„è®¿é—®ä¿®é¥°ç¬¦ä½œç”¨åŸŸä¸èƒ½æ¯”çˆ¶ç±»å°**ï¼Œä¹Ÿå°±æ˜¯æ›´åŠ å¼€æ”¾ï¼Œå‡å¦‚çˆ¶ç±»æ˜¯ protected ä¿®é¥°çš„ï¼Œå…¶å­ç±»åªèƒ½æ˜¯ protected æˆ–è€… publicï¼Œç»å¯¹ä¸èƒ½æ˜¯ default(é»˜è®¤çš„è®¿é—®èŒƒå›´)æˆ–è€… privateã€‚æ‰€ä»¥åœ¨ç»§æ‰¿ä¸­éœ€è¦é‡å†™çš„æ–¹æ³•ä¸èƒ½ä½¿ç”¨ private ä¿®é¥°è¯ä¿®é¥°ã€‚

å¦‚æœè¿˜æ˜¯ä¸å¤ªæ¸…æ¥šå¯ä»¥çœ‹å‡ ä¸ªå°æ¡ˆä¾‹å°±å¾ˆå®¹æ˜“ææ‡‚ï¼Œå†™ä¸€ä¸ª A1 ç±»ä¸­ç”¨å››ç§ä¿®é¥°è¯å®ç°å››ä¸ªæ–¹æ³•ï¼Œç”¨å­ç±» A2 ç»§æ‰¿ A1ï¼Œé‡å†™ A1 æ–¹æ³•æ—¶å€™ä½ å°±ä¼šå‘ç°çˆ¶ç±»ç§æœ‰æ–¹æ³•ä¸èƒ½é‡å†™ï¼Œéç§æœ‰æ–¹æ³•é‡å†™ä½¿ç”¨çš„ä¿®é¥°ç¬¦ä½œç”¨åŸŸä¸èƒ½å˜å°(å¤§äºç­‰äº)ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/extends-bigsai-ec684196-f877-46af-9f1e-087a5d313beb.png)

æ­£ç¡®çš„æ¡ˆä¾‹åº”è¯¥ä¸ºï¼š

```java
class A1 {
    private void doA(){ }
    void doB(){}//default
    protected void doC(){}
    public void doD(){}
}
class A2 extends A1{

    @Override
    public void doB() { }//ç»§æ‰¿å­ç±»é‡å†™çš„æ–¹æ³•è®¿é—®ä¿®é¥°ç¬¦æƒé™å¯æ‰©å¤§

    @Override
    protected void doC() { }//ç»§æ‰¿å­ç±»é‡å†™çš„æ–¹æ³•è®¿é—®ä¿®é¥°ç¬¦æƒé™å¯å’Œçˆ¶ç±»ä¸€è‡´

    @Override
    public void doD() { }//ä¸å¯ç”¨protectedæˆ–è€…defaultä¿®é¥°
}
```

è¿˜è¦æ³¨æ„çš„æ˜¯ï¼Œ**ç»§æ‰¿å½“ä¸­å­ç±»æŠ›å‡ºçš„å¼‚å¸¸å¿…é¡»æ˜¯çˆ¶ç±»æŠ›å‡ºçš„å¼‚å¸¸æˆ–çˆ¶ç±»æŠ›å‡ºå¼‚å¸¸çš„å­å¼‚å¸¸**ã€‚ä¸‹é¢çš„ä¸€ä¸ªæ¡ˆä¾‹å››ç§æ–¹æ³•æµ‹è¯•å¯ä»¥å‘ç°å­ç±»æ–¹æ³•çš„å¼‚å¸¸ä¸å¯å¤§äºçˆ¶ç±»å¯¹åº”æ–¹æ³•æŠ›å‡ºå¼‚å¸¸çš„èŒƒå›´ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/extends-bigsai-6d5118fb-0807-4d78-a767-d6c4282e4b2b.png)

æ­£ç¡®çš„æ¡ˆä¾‹åº”è¯¥ä¸ºï¼š

```java
class B1{
    public void doA() throws Exception{}
    public void doB() throws Exception{}
    public void doC() throws IOException{}
    public void doD() throws IOException{}
}
class B2 extends B1{
    //å¼‚å¸¸èŒƒå›´å’Œçˆ¶ç±»å¯ä»¥ä¸€è‡´
    @Override
    public void doA() throws Exception { }
    //å¼‚å¸¸èŒƒå›´å¯ä»¥æ¯”çˆ¶ç±»æ›´å°
    @Override
    public void doB() throws IOException { }
    //å¼‚å¸¸èŒƒå›´ ä¸å¯ä»¥æ¯”çˆ¶ç±»èŒƒå›´æ›´å¤§
    @Override
    public void doC() throws IOException { }//ä¸å¯æŠ›å‡ºExceptionç­‰æ¯”IOExceptionæ›´å¤§çš„å¼‚å¸¸
    @Override
    public void doD() throws IOException { }
}
```

##### éè®¿é—®ä¿®é¥°ç¬¦

è®¿é—®ä¿®é¥°ç¬¦ç”¨æ¥æ§åˆ¶è®¿é—®æƒé™ï¼Œè€Œéè®¿é—®ä¿®é¥°ç¬¦æ¯ä¸ªéƒ½æœ‰å„è‡ªçš„ä½œç”¨ï¼Œä¸‹é¢é’ˆå¯¹ staticã€finalã€abstract ä¿®é¥°ç¬¦è¿›è¡Œä»‹ç»ã€‚

[static ä¿®é¥°ç¬¦](https://tobebetterjavaer.com/oo/static.html)

static ç¿»è¯‘ä¸ºâ€œé™æ€çš„â€ï¼Œèƒ½å¤Ÿä¸å˜é‡ï¼Œæ–¹æ³•å’Œç±»ä¸€èµ·ä½¿ç”¨ï¼Œ**ç§°ä¸ºé™æ€å˜é‡ï¼Œé™æ€æ–¹æ³•(ä¹Ÿç§°ä¸ºç±»å˜é‡ã€ç±»æ–¹æ³•)**ã€‚å¦‚æœåœ¨ä¸€ä¸ªç±»ä¸­ä½¿ç”¨ static ä¿®é¥°å˜é‡æˆ–è€…æ–¹æ³•çš„è¯ï¼Œå®ƒä»¬**å¯ä»¥ç›´æ¥é€šè¿‡ç±»è®¿é—®ï¼Œä¸éœ€è¦åˆ›å»ºä¸€ä¸ªç±»çš„å¯¹è±¡æ¥è®¿é—®æˆå‘˜ã€‚**

æˆ‘ä»¬åœ¨è®¾è®¡ç±»çš„æ—¶å€™å¯èƒ½ä¼šä½¿ç”¨é™æ€æ–¹æ³•ï¼Œæœ‰å¾ˆå¤šå·¥å…·ç±»æ¯”å¦‚`Math`ï¼Œ`Arrays`ç­‰ç±»é‡Œé¢å°±å†™äº†å¾ˆå¤šé™æ€æ–¹æ³•ã€‚

å¯ä»¥çœ‹ä»¥ä¸‹çš„æ¡ˆä¾‹è¯æ˜ä¸Šè¿°è§„åˆ™ï¼š

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/extends-bigsai-6a6ab068-2ef1-401a-ab2f-86a84b29dbbb.png)

æºä»£ç ä¸ºï¼š

```java
class C1{
    public  int a;
    public C1(){}
   // public static C1(){}// æ„é€ æ–¹æ³•ä¸å…è®¸è¢«å£°æ˜ä¸ºstatic
    public static void doA() {}
    public static void doB() {}
}
class C2 extends C1{
    public static  void doC()//é™æ€æ–¹æ³•ä¸­ä¸å­˜åœ¨å½“å‰å¯¹è±¡ï¼Œå› è€Œä¸èƒ½ä½¿ç”¨thiså’Œsuperã€‚
    {
        //System.out.println(super.a);
    }
    public static void doA(){}//é™æ€æ–¹æ³•èƒ½è¢«é™æ€æ–¹æ³•é‡å†™
   // public void doB(){}//é™æ€æ–¹æ³•ä¸èƒ½è¢«éé™æ€æ–¹æ³•é‡å†™
}
```

[final ä¿®é¥°ç¬¦](https://tobebetterjavaer.com/oo/final.html)

final å˜é‡ï¼š

- final è¡¨ç¤º"æœ€åçš„ã€æœ€ç»ˆçš„"å«ä¹‰ï¼Œ**å˜é‡ä¸€æ—¦èµ‹å€¼åï¼Œä¸èƒ½è¢«é‡æ–°èµ‹å€¼**ã€‚è¢« final ä¿®é¥°çš„å®ä¾‹å˜é‡å¿…é¡»æ˜¾å¼æŒ‡å®šåˆå§‹å€¼(å³ä¸èƒ½åªå£°æ˜)ã€‚final ä¿®é¥°ç¬¦é€šå¸¸å’Œ static ä¿®é¥°ç¬¦ä¸€èµ·ä½¿ç”¨æ¥åˆ›å»ºç±»å¸¸é‡ã€‚

final æ–¹æ³•ï¼š

- **çˆ¶ç±»ä¸­çš„ final æ–¹æ³•å¯ä»¥è¢«å­ç±»ç»§æ‰¿ï¼Œä½†æ˜¯ä¸èƒ½è¢«å­ç±»é‡å†™**ã€‚å£°æ˜ final æ–¹æ³•çš„ä¸»è¦ç›®çš„æ˜¯é˜²æ­¢è¯¥æ–¹æ³•çš„å†…å®¹è¢«ä¿®æ”¹ã€‚

final ç±»ï¼š

- **final ç±»ä¸èƒ½è¢«ç»§æ‰¿**ï¼Œæ²¡æœ‰ç±»èƒ½å¤Ÿç»§æ‰¿ final ç±»çš„ä»»ä½•ç‰¹æ€§ã€‚

æ‰€ä»¥æ— è®ºæ˜¯å˜é‡ã€æ–¹æ³•è¿˜æ˜¯ç±»è¢« final ä¿®é¥°ä¹‹åï¼Œéƒ½æœ‰ä»£è¡¨æœ€ç»ˆã€æœ€åçš„æ„æ€ã€‚å†…å®¹æ— æ³•è¢«ä¿®æ”¹ã€‚

[abstract ä¿®é¥°ç¬¦](https://tobebetterjavaer.com/oo/abstract.html)

abstract è‹±æ–‡åä¸ºâ€œæŠ½è±¡çš„â€ï¼Œä¸»è¦ç”¨æ¥ä¿®é¥°ç±»å’Œæ–¹æ³•ï¼Œç§°ä¸ºæŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•ã€‚

**æŠ½è±¡æ–¹æ³•**ï¼šæœ‰å¾ˆå¤šä¸åŒç±»çš„æ–¹æ³•æ˜¯ç›¸ä¼¼çš„ï¼Œä½†æ˜¯å…·ä½“å†…å®¹åˆä¸å¤ªä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½æŠ½å–ä»–çš„å£°æ˜ï¼Œæ²¡æœ‰å…·ä½“çš„æ–¹æ³•ä½“ï¼Œå³æŠ½è±¡æ–¹æ³•å¯ä»¥è¡¨è¾¾æ¦‚å¿µä½†æ— æ³•å…·ä½“å®ç°ã€‚

**æŠ½è±¡ç±»**ï¼š**æœ‰æŠ½è±¡æ–¹æ³•çš„ç±»å¿…é¡»æ˜¯æŠ½è±¡ç±»**ï¼ŒæŠ½è±¡ç±»å¯ä»¥è¡¨è¾¾æ¦‚å¿µä½†æ˜¯æ— æ³•æ„é€ å®ä½“çš„ç±»ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/extends-bigsai-c9cd573a-39e9-40a0-b6f5-6a0fe925487d.png)

æ¯”å¦‚æˆ‘ä»¬å¯ä»¥è¿™æ ·è®¾è®¡ä¸€ä¸ª People æŠ½è±¡ç±»ä»¥åŠä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œåœ¨å­ç±»ä¸­å…·ä½“å®Œæˆï¼š

```java
abstract class People{
    public abstract void sayHello();//æŠ½è±¡æ–¹æ³•
}
class Chinese extends People{
    @Override
    public void sayHello() {//å®ç°æŠ½è±¡æ–¹æ³•
        System.out.println("ä½ å¥½");
    }
}
class Japanese extends People{
    @Override
    public void sayHello() {//å®ç°æŠ½è±¡æ–¹æ³•
        System.out.println("å£ä½ ä¸ƒå“‡");
    }
}
class American extends People{
    @Override
    public void sayHello() {//å®ç°æŠ½è±¡æ–¹æ³•
        System.out.println("hello");
    }
}
```

#### 07ã€Object ç±»å’Œè½¬å‹

æåˆ° Java ç»§æ‰¿ï¼Œä¸å¾—ä¸æåŠæ‰€æœ‰ç±»çš„æ ¹ç±»ï¼šObject(java.lang.Object)ç±»ï¼Œå¦‚æœä¸€ä¸ªç±»æ²¡æœ‰æ˜¾å¼å£°æ˜å®ƒçš„çˆ¶ç±»ï¼ˆå³æ²¡æœ‰å†™ extends xxï¼‰ï¼Œé‚£ä¹ˆé»˜è®¤è¿™ä¸ªç±»çš„çˆ¶ç±»å°±æ˜¯ Object ç±»ï¼Œä»»ä½•ç±»éƒ½å¯ä»¥ä½¿ç”¨ Object ç±»çš„æ–¹æ³•ï¼Œåˆ›å»ºçš„ç±»ä¹Ÿå¯å’Œ Object è¿›è¡Œå‘ä¸Šã€å‘ä¸‹è½¬å‹ï¼Œæ‰€ä»¥ Object ç±»æ˜¯æŒæ¡å’Œç†è§£ç»§æ‰¿æ‰€å¿…é¡»çš„çŸ¥è¯†ç‚¹ã€‚

Java å‘ä¸Šå’Œå‘ä¸‹è½¬å‹åœ¨ Java ä¸­è¿ç”¨å¾ˆå¤šï¼Œä¹Ÿæ˜¯å»ºç«‹åœ¨ç»§æ‰¿çš„åŸºç¡€ä¸Šï¼Œæ‰€ä»¥ Java è½¬å‹ä¹Ÿæ˜¯æŒæ¡å’Œç†è§£ç»§æ‰¿æ‰€å¿…é¡»çš„çŸ¥è¯†ç‚¹ã€‚

##### Object ç±»æ¦‚è¿°

1.  Object æ˜¯ç±»å±‚æ¬¡ç»“æ„çš„**æ ¹ç±»**ï¼Œæ‰€æœ‰çš„ç±»éƒ½éšå¼çš„ç»§æ‰¿è‡ª Object ç±»ã€‚
2.  Java ä¸­ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½æ‹¥æœ‰ Object çš„é»˜è®¤æ–¹æ³•ã€‚
3.  Object ç±»æœ‰ä¸€ä¸ª[æ„é€ æ–¹æ³•](https://tobebetterjavaer.com/oo/construct.html)ï¼Œå¹¶ä¸”æ˜¯**æ— å‚æ„é€ æ–¹æ³•**ã€‚

Object æ˜¯ Java æ‰€æœ‰ç±»çš„çˆ¶ç±»ï¼Œæ˜¯æ•´ä¸ªç±»ç»§æ‰¿ç»“æ„çš„é¡¶ç«¯ï¼Œä¹Ÿæ˜¯æœ€æŠ½è±¡çš„ä¸€ä¸ªç±»ã€‚

åƒ toString()ã€equals()ã€hashCode()ã€wait()ã€notify()ã€getClass()ç­‰éƒ½æ˜¯ Object çš„æ–¹æ³•ã€‚ä½ ä»¥åå¯èƒ½ä¼šç»å¸¸ç¢°åˆ°ï¼Œä½†å…¶ä¸­é‡åˆ°æ›´å¤šçš„å°±æ˜¯ toString()æ–¹æ³•å’Œ equals()æ–¹æ³•ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦é‡å†™è¿™ä¸¤ç§æ–¹æ³•æ»¡è¶³æˆ‘ä»¬çš„ä½¿ç”¨éœ€æ±‚ã€‚

toString()æ–¹æ³•è¡¨ç¤ºè¿”å›è¯¥å¯¹è±¡çš„å­—ç¬¦ä¸²ï¼Œç”±äºå„ä¸ªå¯¹è±¡æ„é€ ä¸åŒæ‰€ä»¥éœ€è¦é‡å†™ï¼Œå¦‚æœä¸é‡å†™çš„è¯é»˜è®¤è¿”å›`ç±»å@hashCode`æ ¼å¼ã€‚

**å¦‚æœé‡å†™ toString()æ–¹æ³•å**ç›´æ¥è°ƒç”¨ toString()æ–¹æ³•å°±å¯ä»¥è¿”å›æˆ‘ä»¬è‡ªå®šä¹‰çš„è¯¥ç±»è½¬æˆå­—ç¬¦ä¸²ç±»å‹çš„å†…å®¹è¾“å‡ºï¼Œè€Œä¸éœ€è¦æ¯æ¬¡éƒ½æ‰‹åŠ¨çš„æ‹¼å‡‘æˆå­—ç¬¦ä¸²å†…å®¹è¾“å‡ºï¼Œå¤§å¤§ç®€åŒ–è¾“å‡ºæ“ä½œã€‚

equals()æ–¹æ³•ä¸»è¦æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œå› ä¸ºå¯¹è±¡çš„ç›¸ç­‰ä¸ä¸€å®šéè¦ä¸¥æ ¼è¦æ±‚ä¸¤ä¸ªå¯¹è±¡åœ°å€ä¸Šçš„ç›¸åŒï¼Œæœ‰æ—¶å†…å®¹ä¸Šçš„ç›¸åŒæˆ‘ä»¬å°±ä¼šè®¤ä¸ºå®ƒç›¸ç­‰ï¼Œæ¯”å¦‚ String ç±»å°±é‡å†™äº†euqals()æ–¹æ³•ï¼Œé€šè¿‡[å­—ç¬¦ä¸²çš„å†…å®¹æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰](https://tobebetterjavaer.com/string/equals.html)ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/extends-bigsai-1caee9d0-ccbc-41cd-82e2-115b86c57a5a.png)

##### å‘ä¸Šè½¬å‹

**å‘ä¸Šè½¬å‹** : é€šè¿‡å­ç±»å¯¹è±¡(å°èŒƒå›´)å®ä¾‹åŒ–çˆ¶ç±»å¯¹è±¡(å¤§èŒƒå›´)ï¼Œè¿™ç§å±äºè‡ªåŠ¨è½¬æ¢ã€‚ç”¨ä¸€å¼ å›¾å°±èƒ½å¾ˆå¥½åœ°è¡¨ç¤ºå‘ä¸Šè½¬å‹çš„é€»è¾‘ï¼š

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/extends-bigsai-0cd258c9-b897-4be3-bdb2-2ddd9c073609.png)

çˆ¶ç±»å¼•ç”¨å˜é‡æŒ‡å‘å­ç±»å¯¹è±¡åï¼Œåªèƒ½ä½¿ç”¨çˆ¶ç±»å·²å£°æ˜çš„æ–¹æ³•ï¼Œä½†æ–¹æ³•å¦‚æœè¢«é‡å†™ä¼šæ‰§è¡Œå­ç±»çš„æ–¹æ³•ï¼Œå¦‚æœæ–¹æ³•æœªè¢«é‡å†™é‚£ä¹ˆå°†æ‰§è¡Œçˆ¶ç±»çš„æ–¹æ³•ã€‚

##### å‘ä¸‹è½¬å‹

**å‘ä¸‹è½¬å‹** : é€šè¿‡çˆ¶ç±»å¯¹è±¡(å¤§èŒƒå›´)å®ä¾‹åŒ–å­ç±»å¯¹è±¡(å°èŒƒå›´)ï¼Œåœ¨ä¹¦å†™ä¸Šçˆ¶ç±»å¯¹è±¡éœ€è¦åŠ æ‹¬å·`()`å¼ºåˆ¶è½¬æ¢ä¸ºå­ç±»ç±»å‹ã€‚ä½†çˆ¶ç±»å¼•ç”¨å˜é‡å®é™…å¼•ç”¨å¿…é¡»æ˜¯å­ç±»å¯¹è±¡æ‰èƒ½æˆåŠŸè½¬å‹ï¼Œè¿™é‡Œä¹Ÿç”¨ä¸€å¼ å›¾å°±èƒ½å¾ˆå¥½è¡¨ç¤ºå‘ä¸‹è½¬å‹çš„é€»è¾‘ï¼š

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/extends-bigsai-ef0d4716-8b4f-4adf-845e-dd293871b7a7.png)

å­ç±»å¼•ç”¨å˜é‡æŒ‡å‘çˆ¶ç±»å¼•ç”¨å˜é‡æŒ‡å‘çš„å¯¹è±¡å(ä¸€ä¸ª Son()å¯¹è±¡)ï¼Œå°±å®Œæˆå‘ä¸‹è½¬å‹ï¼Œå°±å¯ä»¥è°ƒç”¨ä¸€äº›å­ç±»ç‰¹æœ‰è€Œçˆ¶ç±»æ²¡æœ‰çš„æ–¹æ³• ã€‚

åœ¨è¿™é‡Œå†™ä¸€ä¸ªå‘ä¸Šè½¬å‹å’Œå‘ä¸‹è½¬å‹çš„æ¡ˆä¾‹ï¼š

```java
Object object=new Integer(666);//å‘ä¸Šè½¬å‹

Integer i=(Integer)object;//å‘ä¸‹è½¬å‹Object->Integerï¼Œobjectçš„å®è´¨è¿˜æ˜¯æŒ‡å‘Integer

String str=(String)object;//é”™è¯¯çš„å‘ä¸‹è½¬å‹ï¼Œè™½ç„¶ç¼–è¯‘å™¨ä¸ä¼šæŠ¥é”™ä½†æ˜¯è¿è¡Œä¼šæŠ¥é”™
```

#### 08ã€å­çˆ¶ç±»åˆå§‹åŒ–é¡ºåº

åœ¨ Java ç»§æ‰¿ä¸­ï¼Œçˆ¶å­ç±»åˆå§‹åŒ–å…ˆåé¡ºåºä¸ºï¼š

1.  çˆ¶ç±»ä¸­é™æ€æˆå‘˜å˜é‡å’Œé™æ€ä»£ç å—
2.  å­ç±»ä¸­é™æ€æˆå‘˜å˜é‡å’Œé™æ€ä»£ç å—
3.  çˆ¶ç±»ä¸­æ™®é€šæˆå‘˜å˜é‡å’Œä»£ç å—ï¼Œçˆ¶ç±»çš„æ„é€ æ–¹æ³•
4.  å­ç±»ä¸­æ™®é€šæˆå‘˜å˜é‡å’Œä»£ç å—ï¼Œå­ç±»çš„æ„é€ æ–¹æ³•

æ€»çš„æ¥è¯´ï¼Œå°±æ˜¯**é™æ€>éé™æ€ï¼Œçˆ¶ç±»>å­ç±»ï¼Œéæ„é€ æ–¹æ³•>æ„é€ æ–¹æ³•**ã€‚åŒä¸€ç±»åˆ«ï¼ˆä¾‹å¦‚æ™®é€šå˜é‡å’Œæ™®é€šä»£ç å—ï¼‰æˆå‘˜å˜é‡å’Œä»£ç å—æ‰§è¡Œä»å‰åˆ°åï¼Œéœ€è¦æ³¨æ„é€»è¾‘ã€‚

è¿™ä¸ªä¹Ÿä¸éš¾ç†è§£ï¼Œé™æ€å˜é‡ä¹Ÿç§°ç±»å˜é‡ï¼Œå¯ä»¥çœ‹æˆä¸€ä¸ªå…¨å±€å˜é‡ï¼Œé™æ€æˆå‘˜å˜é‡å’Œé™æ€ä»£ç å—åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±åˆå§‹åŒ–ï¼Œè€Œéé™æ€å˜é‡å’Œä»£ç å—åœ¨å¯¹è±¡åˆ›å»ºçš„æ—¶å€™åˆå§‹åŒ–ã€‚æ‰€ä»¥é™æ€å¿«äºéé™æ€åˆå§‹åŒ–ã€‚

è€Œåœ¨åˆ›å»ºå­ç±»å¯¹è±¡çš„æ—¶å€™éœ€è¦å…ˆåˆ›å»ºçˆ¶ç±»å¯¹è±¡ï¼Œæ‰€ä»¥çˆ¶ç±»ä¼˜å…ˆäºå­ç±»ã€‚

è€Œåœ¨è°ƒç”¨æ„é€ æ–¹æ³•çš„æ—¶å€™ï¼Œæ˜¯å¯¹æˆå‘˜å˜é‡è¿›è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œæ‰€ä»¥æ™®é€šæˆå‘˜å˜é‡å’Œä»£ç å—ä¼˜äºæ„é€ æ–¹æ³•æ‰§è¡Œã€‚

è‡³äºæ›´æ·±å±‚æ¬¡ä¸ºä»€ä¹ˆè¿™ä¸ªé¡ºåºï¼Œå°±è¦æ›´æ·±å…¥äº†è§£ JVM æ‰§è¡Œæµç¨‹å•¦ã€‚ä¸‹é¢ä¸€ä¸ªæµ‹è¯•ä»£ç ä¸ºï¼š

```java
class Father{
    public Father() {
        System.out.println(++b1+"çˆ¶ç±»æ„é€ æ–¹æ³•");
    }//çˆ¶ç±»æ„é€ æ–¹æ³• ç¬¬å››
    static int a1=0;//çˆ¶ç±»static ç¬¬ä¸€ æ³¨æ„é¡ºåº
    static {
        System.out.println(++a1+"çˆ¶ç±»static");
    }
    int b1=a1;//çˆ¶ç±»æˆå‘˜å˜é‡å’Œä»£ç å— ç¬¬ä¸‰
    {
        System.out.println(++b1+"çˆ¶ç±»ä»£ç å—");
    }
}
class Son extends Father{
    public Son() {
        System.out.println(++b2+"å­ç±»æ„é€ æ–¹æ³•");
    }//å­ç±»æ„é€ æ–¹æ³• ç¬¬å…­
    static {//å­ç±»staticç¬¬äºŒæ­¥
        System.out.println(++a1+"å­ç±»static");
    }
    int b2=b1;//å­ç±»æˆå‘˜å˜é‡å’Œä»£ç å— ç¬¬äº”
    {
        System.out.println(++b2 + "å­ç±»ä»£ç å—");
    }
}
public class test9 {
    public static void main(String[] args) {
        Son son=new Son();
    }
}
```

æ‰§è¡Œç»“æœï¼š

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/extends-bigsai-d23e0bbf-a4a4-4d20-ad21-f437fcee1c82.png)


### 3ï¼‰å¤šæ€

Java å¤šæ€æ˜¯æŒ‡åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼ŒåŒä¸€ä¸ªç±»çš„å¯¹è±¡åœ¨ä¸åŒæƒ…å†µä¸‹è¡¨ç°å‡ºä¸åŒçš„è¡Œä¸ºå’ŒçŠ¶æ€ã€‚

- å­ç±»å¯ä»¥ç»§æ‰¿çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œå­ç±»å¯¹è±¡å¯ä»¥ç›´æ¥ä½¿ç”¨çˆ¶ç±»ä¸­çš„æ–¹æ³•å’Œå˜é‡ã€‚
- å­ç±»å¯ä»¥å¯¹ä»çˆ¶ç±»ç»§æ‰¿çš„æ–¹æ³•è¿›è¡Œé‡æ–°å®ç°ï¼Œä½¿å¾—å­ç±»å¯¹è±¡è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶è¡¨ç°å‡ºä¸åŒçš„è¡Œä¸ºã€‚
- å¯ä»¥å°†å­ç±»å¯¹è±¡èµ‹ç»™çˆ¶ç±»ç±»å‹çš„å˜é‡ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡çˆ¶ç±»ç±»å‹çš„å˜é‡è°ƒç”¨å­ç±»ä¸­é‡å†™çš„æ–¹æ³•ï¼Œå®ç°å¤šæ€ã€‚

â€œå¾ˆæ¯ç‡¥ï¼Œæœ‰æ²¡æœ‰ï¼Ÿå†å…·ä½“çš„åˆ†æä¸€ä¸‹ã€‚â€

#### 01ã€å¤šæ€æ˜¯ä»€ä¹ˆ

åœ¨æˆ‘åˆ»æ¿çš„å°è±¡é‡Œï¼Œè¥¿æ¸¸è®°é‡Œçš„é‚£æ®µå­™æ‚Ÿç©ºå’ŒäºŒéƒç¥çš„ç²¾å½©å¯¹æˆ˜å°±èƒ½å¾ˆå¥½çš„è§£é‡Šâ€œå¤šæ€â€è¿™ä¸ªè¯ï¼šä¸€ä¸ªå­™æ‚Ÿç©ºï¼Œèƒ½ä¸ƒåäºŒå˜ï¼›ä¸€ä¸ªäºŒéƒç¥ï¼Œä¹Ÿèƒ½ä¸ƒåäºŒå˜ï¼›ä»–ä»¬éƒ½å¯ä»¥å˜æˆä¸åŒçš„å½¢æ€ï¼Œä½†åªéœ€è¦æ‚„æ‚„åœ°å–Šä¸€å£°â€œå˜â€ã€‚

Javaçš„å¤šæ€æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå…¶å®å°±æ˜¯ä¸€ç§èƒ½åŠ›â€”â€”åŒä¸€ä¸ªè¡Œä¸ºå…·æœ‰ä¸åŒçš„è¡¨ç°å½¢å¼ï¼›æ¢å¥è¯è¯´å°±æ˜¯ï¼Œæ‰§è¡Œä¸€æ®µä»£ç ï¼ŒJava åœ¨è¿è¡Œæ—¶èƒ½æ ¹æ®å¯¹è±¡çš„ä¸åŒäº§ç”Ÿä¸åŒçš„ç»“æœã€‚å’Œå­™æ‚Ÿç©ºå’ŒäºŒéƒç¥éƒ½åªéœ€è¦å–Šä¸€å£°â€œå˜â€ï¼Œç„¶åå°±å˜äº†ï¼Œå¹¶ä¸”æ¯æ¬¡å˜å¾—è¿˜ä¸ä¸€æ ·ï¼›ä¸€ä¸ªé“ç†ã€‚

å¤šæ€çš„å‰ææ¡ä»¶æœ‰ä¸‰ä¸ªï¼š

*   å­ç±»ç»§æ‰¿çˆ¶ç±»
*   å­ç±»è¦†ç›–çˆ¶ç±»çš„æ–¹æ³•
*   çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡

å¤šæ€çš„ä¸€ä¸ªç®€å•åº”ç”¨ï¼Œæ¥çœ‹ç¨‹åºæ¸…å•1-1ï¼š

```java
//å­ç±»ç»§æ‰¿çˆ¶ç±»
public class Wangxiaoer extends Wanger {
    public void write() { // å­ç±»è¦†ç›–çˆ¶ç±»æ–¹æ³•
        System.out.println("è®°ä½ä»‡æ¨ï¼Œè¡¨æ˜æˆ‘ä»¬è¦å¥‹å‘å›¾å¼ºçš„å¿ƒæ™º");
    }

    public static void main(String[] args) {
        // çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡
        Wanger[] wangers = { new Wanger(), new Wangxiaoer() };

        for (Wanger wanger : wangers) {
            // å¯¹è±¡æ˜¯ç‹äºŒçš„æ—¶å€™è¾“å‡ºï¼šå‹¿å¿˜å›½è€»
            // å¯¹è±¡æ˜¯ç‹å°äºŒçš„æ—¶å€™è¾“å‡ºï¼šè®°ä½ä»‡æ¨ï¼Œè¡¨æ˜æˆ‘ä»¬è¦å¥‹å‘å›¾å¼ºçš„å¿ƒæ™º
            wanger.write();
        }
    }
}

class Wanger {
    public void write() {
        System.out.println("å‹¿å¿˜å›½è€»");
    }
}
```

#### 02ã€å¤šæ€ä¸åæœŸç»‘å®š

ç°åœ¨ï¼Œæˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šç¨‹åºæ¸…å•1-1åœ¨æ‰§è¡Œ `wanger.write()` æ—¶ï¼Œç”±äºç¼–è¯‘å™¨åªæœ‰ä¸€ä¸ª Wanger å¼•ç”¨ï¼Œå®ƒæ€ä¹ˆçŸ¥é“ç©¶ç«Ÿè¯¥è°ƒç”¨çˆ¶ç±» Wanger çš„ `write()` æ–¹æ³•ï¼Œè¿˜æ˜¯å­ç±» Wangxiaoer çš„ `write()` æ–¹æ³•å‘¢ï¼Ÿ

ç­”æ¡ˆæ˜¯åœ¨è¿è¡Œæ—¶æ ¹æ®å¯¹è±¡çš„ç±»å‹è¿›è¡ŒåæœŸç»‘å®šï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘é˜¶æ®µå¹¶ä¸çŸ¥é“å¯¹è±¡çš„ç±»å‹ï¼Œä½†æ˜¯Javaçš„æ–¹æ³•è°ƒç”¨æœºåˆ¶èƒ½æ‰¾åˆ°æ­£ç¡®çš„æ–¹æ³•ä½“ï¼Œç„¶åæ‰§è¡Œå‡ºæ­£ç¡®çš„ç»“æœã€‚

å¤šæ€æœºåˆ¶æä¾›çš„ä¸€ä¸ªé‡è¦çš„å¥½å¤„ç¨‹åºå…·æœ‰è‰¯å¥½çš„æ‰©å±•æ€§ã€‚æ¥çœ‹ç¨‹åºæ¸…å•2-1ï¼š

```java
//å­ç±»ç»§æ‰¿çˆ¶ç±»
public class Wangxiaoer extends Wanger {
    public void write() { // å­ç±»è¦†ç›–çˆ¶ç±»æ–¹æ³•
        System.out.println("è®°ä½ä»‡æ¨ï¼Œè¡¨æ˜æˆ‘ä»¬è¦å¥‹å‘å›¾å¼ºçš„å¿ƒæ™º");
    }
    
    public void eat() {
        System.out.println("æˆ‘ä¸å–œæ¬¢è¯»ä¹¦ï¼Œæˆ‘å°±å–œæ¬¢åƒ");
    }

    public static void main(String[] args) {
        // çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡
        Wanger[] wangers = { new Wanger(), new Wangxiaoer() };

        for (Wanger wanger : wangers) {
            // å¯¹è±¡æ˜¯ç‹äºŒçš„æ—¶å€™è¾“å‡ºï¼šå‹¿å¿˜å›½è€»
            // å¯¹è±¡æ˜¯ç‹å°äºŒçš„æ—¶å€™è¾“å‡ºï¼šè®°ä½ä»‡æ¨ï¼Œè¡¨æ˜æˆ‘ä»¬è¦å¥‹å‘å›¾å¼ºçš„å¿ƒæ™º
            wanger.write();
        }
    }
}

class Wanger {
    public void write() {
        System.out.println("å‹¿å¿˜å›½è€»");
    }
    
    public void read() {
        System.out.println("æ¯å‘¨è¯»ä¸€æœ¬å¥½ä¹¦");
    }
}
```

åœ¨ç¨‹åºæ¸…å• 2-1 ä¸­ï¼Œæˆ‘ä»¬åœ¨ Wanger ç±»ä¸­å¢åŠ äº† read() æ–¹æ³•ï¼Œåœ¨ Wangxiaoer ç±»ä¸­å¢åŠ äº†eat()æ–¹æ³•ï¼Œä½†è¿™ä¸æ¯«ä¸ä¼šå½±å“åˆ° write() æ–¹æ³•çš„è°ƒç”¨ã€‚write() æ–¹æ³•å¿½ç•¥äº†å‘¨å›´ä»£ç å‘ç”Ÿçš„å˜åŒ–ï¼Œä¾ç„¶æ­£å¸¸è¿è¡Œã€‚è¿™è®©æˆ‘æƒ³èµ·äº†é‡‘åº¸ã€Šå€šå¤©å± é¾™è®°ã€‹é‡Œä¹é˜³çœŸç»çš„å£è¯€ï¼šâ€œä»–å¼ºç”±ä»–å¼ºï¼Œæ¸…é£æ‹‚å±±å²—ï¼›ä»–æ¨ªç”±ä»–æ¨ªï¼Œæ˜æœˆç…§å¤§æ±Ÿã€‚â€

å¤šæ€çš„è¿™ä¸ªä¼˜ç§€çš„ç‰¹æ€§ï¼Œè®©æˆ‘ä»¬åœ¨ä¿®æ”¹ä»£ç çš„æ—¶å€™ä¸å¿…è¿‡äºç´§å¼ ï¼Œå› ä¸ºå¤šæ€æ˜¯ä¸€é¡¹è®©ç¨‹åºå‘˜â€œå°†æ”¹å˜çš„ä¸æœªæ”¹å˜çš„åˆ†ç¦»å¼€æ¥â€çš„é‡è¦ç‰¹æ€§ã€‚

#### 03ã€å¤šæ€ä¸æ„é€ æ–¹æ³•

åœ¨æ„é€ æ–¹æ³•ä¸­è°ƒç”¨å¤šæ€æ–¹æ³•ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªå¥‡å¦™çš„ç»“æœï¼Œæˆ‘ä»¬æ¥çœ‹ç¨‹åºæ¸…å•3-1ï¼š

```java
public class Wangxiaosan extends Wangsan {
    private int age = 3;
    public Wangxiaosan(int age) {
        this.age = age;
        System.out.println("ç‹å°ä¸‰çš„å¹´é¾„ï¼š" + this.age);
    }
    
    public void write() { // å­ç±»è¦†ç›–çˆ¶ç±»æ–¹æ³•
        System.out.println("æˆ‘å°ä¸‰ä¸Šå¹¼å„¿å›­çš„å¹´é¾„æ˜¯ï¼š" + this.age);
    }
    
    public static void main(String[] args) {
        new Wangxiaosan(4);
//      ä¸Šå¹¼å„¿å›­ä¹‹å‰
//      æˆ‘å°ä¸‰ä¸Šå¹¼å„¿å›­çš„å¹´é¾„æ˜¯ï¼š0
//      ä¸Šå¹¼å„¿å›­ä¹‹å
//      ç‹å°ä¸‰çš„å¹´é¾„ï¼š4
    }
}

class Wangsan {
    Wangsan () {
        System.out.println("ä¸Šå¹¼å„¿å›­ä¹‹å‰");
        write();
        System.out.println("ä¸Šå¹¼å„¿å›­ä¹‹å");
    }
    public void write() {
        System.out.println("è€å­ä¸Šå¹¼å„¿å›­çš„å¹´é¾„æ˜¯3å²åŠ");
    }
}
```

ä»è¾“å‡ºç»“æœä¸Šçœ‹ï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹è¯§å¼‚ï¼Ÿæ˜æ˜åœ¨åˆ›å»º Wangxiaosan å¯¹è±¡çš„æ—¶å€™ï¼Œå¹´é¾„ä¼ é€’çš„æ˜¯ 4ï¼Œä½†è¾“å‡ºç»“æœæ—¢ä¸æ˜¯â€œè€å­ä¸Šå¹¼å„¿å›­çš„å¹´é¾„æ˜¯ 3 å²åŠâ€ï¼Œä¹Ÿä¸æ˜¯â€œæˆ‘å°ä¸‰ä¸Šå¹¼å„¿å›­çš„å¹´é¾„æ˜¯ï¼š4â€ã€‚

ä¸ºä»€ä¹ˆï¼Ÿ

å› ä¸ºåœ¨åˆ›å»ºå­ç±»å¯¹è±¡æ—¶ï¼Œä¼šå…ˆå»è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œè€Œçˆ¶ç±»æ„é€ æ–¹æ³•ä¸­åˆè°ƒç”¨äº†è¢«å­ç±»è¦†ç›–çš„å¤šæ€æ–¹æ³•ï¼Œç”±äºçˆ¶ç±»å¹¶ä¸æ¸…æ¥šå­ç±»å¯¹è±¡ä¸­çš„å±æ€§å€¼æ˜¯ä»€ä¹ˆï¼Œäºæ˜¯æŠŠintç±»å‹çš„å±æ€§æš‚æ—¶åˆå§‹åŒ–ä¸º 0ï¼Œç„¶åå†è°ƒç”¨å­ç±»çš„æ„é€ æ–¹æ³•ï¼ˆå­ç±»æ„é€ æ–¹æ³•çŸ¥é“ç‹å°äºŒçš„å¹´é¾„æ˜¯ 4ï¼‰ã€‚

#### 04ã€å¤šæ€ä¸å‘ä¸‹è½¬å‹

å‘ä¸‹è½¬å‹æ˜¯æŒ‡å°†çˆ¶ç±»å¼•ç”¨å¼ºè½¬ä¸ºå­ç±»ç±»å‹ï¼›è¿™æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºæœ‰çš„æ—¶å€™ï¼Œçˆ¶ç±»å¼•ç”¨æŒ‡å‘çš„æ˜¯çˆ¶ç±»å¯¹è±¡ï¼Œå‘ä¸‹è½¬å‹å°±ä¼šæŠ›å‡º ClassCastExceptionï¼Œè¡¨ç¤ºç±»å‹è½¬æ¢å¤±è´¥ï¼›ä½†å¦‚æœçˆ¶ç±»å¼•ç”¨æŒ‡å‘çš„æ˜¯å­ç±»å¯¹è±¡ï¼Œé‚£ä¹ˆå‘ä¸‹è½¬å‹å°±æ˜¯æˆåŠŸçš„ã€‚

æ¥çœ‹ç¨‹åºæ¸…å•4-1ï¼š

```java
public class Wangxiaosi extends Wangsi {
    public void write() {
        System.out.println("è®°ä½ä»‡æ¨ï¼Œè¡¨æ˜æˆ‘ä»¬è¦å¥‹å‘å›¾å¼ºçš„å¿ƒæ™º");
    }

    public void eat() {
        System.out.println("æˆ‘ä¸å–œæ¬¢è¯»ä¹¦ï¼Œæˆ‘å°±å–œæ¬¢åƒ");
    }

    public static void main(String[] args) {
        Wangsi[] wangsis = { new Wangsi(), new Wangxiaosi() };

        // wangsis[1]èƒ½å¤Ÿå‘ä¸‹è½¬å‹
        ((Wangxiaosi) wangsis[1]).write();
        // wangsis[0]ä¸èƒ½å‘ä¸‹è½¬å‹
        ((Wangxiaosi)wangsis[0]).write();
    }
}

class Wangsi {
    public void write() {
        System.out.println("å‹¿å¿˜å›½è€»");
    }

    public void read() {
        System.out.println("æ¯å‘¨è¯»ä¸€æœ¬å¥½ä¹¦");
    }
}
```

â€œå¥½äº†ï¼Œä¸‰å¦¹ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å°±å°† Java çš„ä¸‰å¤§ç‰¹æ€§ï¼Œå°è£…ç»§æ‰¿å¤šæ€å…¨éƒ¨è®²å®Œäº†ï¼Œå¸Œæœ›ä½ èƒ½é‡æ–°æŠŠä»–ä»¬æ¢³ç†ä¸€ä¸‹ã€‚â€

â€œå¥½çš„ï¼ŒäºŒå“¥ï¼Œéµå‘½ã€‚â€ä¸‰å¦¹é¡½çš®åœ°ç¬‘äº†ã€‚

### 4ï¼‰å°ç»“

å¥½å•¦ï¼Œä¸‰å¦¹ï¼Œæœ¬æ¬¡ç»§æ‰¿å°±ä»‹ç»åˆ°è¿™é‡Œå•¦ï¼ŒJava é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹å¾ä¹‹ä¸€ç»§æ‰¿â€”â€”ä¼˜ç§€çš„ä½ å·²ç»æŒæ¡ã€‚

å°è£…ï¼šæ˜¯å¯¹ç±»çš„å°è£…ï¼Œå°è£…æ˜¯å¯¹ç±»çš„å±æ€§å’Œæ–¹æ³•è¿›è¡Œå°è£…ï¼Œåªå¯¹å¤–æš´éœ²æ–¹æ³•è€Œä¸æš´éœ²å…·ä½“ä½¿ç”¨ç»†èŠ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬è®¾è®¡ç±»æˆå‘˜å˜é‡æ—¶å€™å¤§å¤šè®¾ä¸ºç§æœ‰è€Œé€šè¿‡ä¸€äº› getã€set æ–¹æ³•å»è¯»å†™ã€‚

ç»§æ‰¿ï¼šå­ç±»ç»§æ‰¿çˆ¶ç±»ï¼Œå³â€œå­æ‰¿çˆ¶ä¸šâ€ï¼Œå­ç±»æ‹¥æœ‰çˆ¶ç±»é™¤ç§æœ‰çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œè‡ªå·±è¿˜èƒ½åœ¨æ­¤åŸºç¡€ä¸Šæ‹“å±•è‡ªå·±æ–°çš„å±æ€§å’Œæ–¹æ³•ã€‚ä¸»è¦ç›®çš„æ˜¯**å¤ç”¨ä»£ç **ã€‚

**å¤šæ€**ï¼šå¤šæ€æ˜¯åŒä¸€ä¸ªè¡Œä¸ºå…·æœ‰å¤šä¸ªä¸åŒè¡¨ç°å½¢å¼æˆ–å½¢æ€çš„èƒ½åŠ›ã€‚å³ä¸€ä¸ªçˆ¶ç±»å¯èƒ½æœ‰è‹¥å¹²å­ç±»ï¼Œå„å­ç±»å®ç°çˆ¶ç±»æ–¹æ³•æœ‰å¤šç§å¤šæ ·ï¼Œè°ƒç”¨çˆ¶ç±»æ–¹æ³•æ—¶ï¼Œçˆ¶ç±»å¼•ç”¨å˜é‡æŒ‡å‘ä¸åŒå­ç±»å®ä¾‹è€Œæ‰§è¡Œä¸åŒæ–¹æ³•ï¼Œè¿™å°±æ˜¯æ‰€è°“çˆ¶ç±»æ–¹æ³•æ˜¯å¤šæ€çš„ã€‚

æœ€åé€ä½ ä¸€å¼ å›¾æ‹ä¸€æ‹å…¶ä¸­çš„å…³ç³»å§ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/oo/extends-bigsai-2bf1876f-0c1c-4e83-8721-e6f48d6451c0.png)

â€œå¥½çš„ï¼ŒäºŒå“¥ï¼Œæˆ‘æ¥æ¶ˆåŒ–ä¸€ä¸‹ï¼Œä»Šå¤©å†…å®¹çœŸä¸å°‘ã€‚ä½ å…ˆå»ä¼‘æ¯ä¸€ä¸‹ã€‚â€ä¸‰å¦¹å›åº”åˆ°ã€‚

> å‚è€ƒé“¾æ¥ï¼š[https://bbs.huaweicloud.com/blogs/271358](https://bbs.huaweicloud.com/blogs/271358)ï¼Œä½œè€…ï¼šbigsaiï¼Œæ•´ç†ï¼šæ²‰é»˜ç‹äºŒ


----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 5.14 Java thiså’Œsuperå…³é”®å­—

â€œå“¥ï¼Œè¢«å–Šå¤§èˆ…å­çš„æ„Ÿè§‰æ€ä¹ˆæ ·å•Šï¼Ÿâ€ä¸‰å¦¹ä¸æ€€å¥½æ„åœ°å¯¹æˆ‘è¯´ï¼Œå¥¹çœ¼ç›é‡Œå……æ»¡ç€ä¸å±‘ã€‚

â€œè¯´å®è¯ï¼Œè¿™ç§æ„Ÿè§‰è¿˜ä¸é”™ã€‚â€æˆ‘æœ‰ç‚¹éš¾ä¸ºæƒ…çš„å›ç­”å¥¹ï¼Œâ€œä¸è¿‡ï¼Œæœ‰ä¸€ç‚¹ä»¤æˆ‘æ„Ÿåˆ°äº›è®¸å¤±è½ã€‚å¤§å®¶çš„ç„¦ç‚¹ä¼¼ä¹éƒ½æ˜¯ä½ çš„é¢œå€¼ï¼Œå®Œå…¨å¿½ç•¥äº†æˆ‘çš„ç››ä¸–ç¾é¢œå•Šï¼â€

â€œå“¥ï¼Œä½ æƒ³å•¥å‘¢ï¼Œé‚£æ˜¯å› ä¸ºä½ æ–‡ç« å†™å¾—å¥½ï¼Œä¸ç„¶è°è®¤è¯†æˆ‘æ˜¯è°å•Šï¼æœ‰ä½ è¿™æ ·çš„å“¥å“¥ï¼Œæˆ‘è¿˜æ˜¯æŒºè‡ªè±ªçš„ã€‚â€ä¸‰å¦¹éƒ‘é‡å…¶äº‹åœ°è¯´ï¼Œâ€œè¯è¯´ä»Šå¤©å’±å­¦å•¥å‘¢ï¼Ÿâ€

â€œä¸‰å¦¹å•Šï¼Œä½ è¿™å¥è¯è¯´å¾—æˆ‘å–œæ¬¢ã€‚ä»Šå¤©æ¥å­¦ä¹ ä¸€ä¸‹ Java ä¸­çš„ this å…³é”®å­—å§ã€‚â€å–äº†ä¸€å£å†œå¤«å±±æ³‰åï¼Œæˆ‘å¯¹ä¸‰å¦¹è¯´ã€‚

â€œthis å…³é”®å­—æœ‰å¾ˆå¤šç§ç”¨æ³•ï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„ä¸€ä¸ªæ˜¯ï¼Œå®ƒå¯ä»¥ä½œä¸ºå¼•ç”¨å˜é‡ï¼ŒæŒ‡å‘å½“å‰å¯¹è±¡ã€‚â€æˆ‘é¢å¸¦ç€æœ´å®æ— åçš„å¾®ç¬‘ç»§ç»­è¯´ï¼Œâ€œé™¤æ­¤ä¹‹å¤–ï¼Œ this å…³é”®å­—è¿˜å¯ä»¥å®Œæˆä»¥ä¸‹å·¥ä½œã€‚â€

- è°ƒç”¨å½“å‰ç±»çš„æ–¹æ³•ï¼›
- `this()` å¯ä»¥è°ƒç”¨å½“å‰ç±»çš„æ„é€ æ–¹æ³•ï¼›
- this å¯ä»¥ä½œä¸ºå‚æ•°åœ¨æ–¹æ³•ä¸­ä¼ é€’ï¼›
- this å¯ä»¥ä½œä¸ºå‚æ•°åœ¨æ„é€ æ–¹æ³•ä¸­ä¼ é€’ï¼›
- this å¯ä»¥ä½œä¸ºæ–¹æ³•çš„è¿”å›å€¼ï¼Œè¿”å›å½“å‰ç±»çš„å¯¹è±¡ã€‚

### 01ã€ æŒ‡å‘å½“å‰å¯¹è±¡

â€œä¸‰å¦¹ï¼Œæ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ã€‚â€è¯éŸ³åˆšè½ï¼Œæˆ‘å°±åœ¨é”®ç›˜ä¸Šå™¼é‡Œå•ªå•¦ä¸€é˜µæ•²ã€‚

```java
public class WithoutThisStudent {
    String name;
    int age;

    WithoutThisStudent(String name, int age) {
        name = name;
        age = age;
    }

    void out() {
        System.out.println(name+" " + age);
    }

    public static void main(String[] args) {
        WithoutThisStudent s1 = new WithoutThisStudent("æ²‰é»˜ç‹äºŒ", 18);
        WithoutThisStudent s2 = new WithoutThisStudent("æ²‰é»˜ç‹ä¸‰", 16);

        s1.out();
        s2.out();
    }
}
```

â€œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ„é€ æ–¹æ³•çš„å‚æ•°åå’Œå®ä¾‹å˜é‡åç›¸åŒï¼Œç”±äºæ²¡æœ‰ä½¿ç”¨ this å…³é”®å­—ï¼Œæ‰€ä»¥æ— æ³•ä¸ºå®ä¾‹å˜é‡èµ‹å€¼ã€‚â€æˆ‘æŠ¬èµ·å³æ‰‹çš„é£ŸæŒ‡ï¼ŒæŒ‡ç€å±å¹•ä¸Šçš„ name å’Œ age å¯¹ç€ä¸‰å¦¹è¯´ã€‚

â€œæ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„è¾“å‡ºç»“æœã€‚â€

```
null 0
null 0
```

â€œä»ç»“æœä¸­å¯ä»¥çœ‹å¾—å‡ºæ¥ï¼Œå°½ç®¡åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ä¼ é€’äº†å‚æ•°ï¼Œä½†å®ä¾‹å˜é‡å¹¶æ²¡æœ‰èµ‹å€¼ã€‚è¿™æ˜¯å› ä¸ºå¦‚æœæ„é€ æ–¹æ³•ä¸­æ²¡æœ‰ä½¿ç”¨ this å…³é”®å­—çš„è¯ï¼Œname å’Œ age æŒ‡å‘çš„å¹¶ä¸æ˜¯å®ä¾‹å˜é‡è€Œæ˜¯å‚æ•°æœ¬èº«ã€‚â€æˆ‘æŠŠè„–å­æ‰­å‘å³ä¾§ï¼Œçœ‹ç€ä¸‰å¦¹è¯´ã€‚

â€œé‚£æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå“¥ã€‚â€ä¸‰å¦¹ç€æ€¥åœ°é—®ã€‚

â€œå¦‚æœå‚æ•°åå’Œå®ä¾‹å˜é‡åäº§ç”Ÿäº†å†²çª.....â€æˆ‘æ­£å‡†å¤‡ç»™å‡ºç­”æ¡ˆï¼Œä¸‰å¦¹æ‰“æ–­äº†æˆ‘ã€‚

â€œéš¾é“ç”¨ this å—ï¼Ÿâ€ä¸‰å¦¹è„±å£è€Œå‡ºã€‚

â€œå“‡ï¼Œè¶Šæ¥è¶Šæ£’äº†å‘€ï¼Œä½ ã€‚â€æˆ‘æ„Ÿè§‰ä¸‰å¦¹åœ¨å­¦ä¹  Java è¿™æ¡é“è·¯ä¸Šé€æ¸æœ‰äº†è‡ªå·±ä¸»åŠ¨æ€è€ƒçš„æ„æ„¿ã€‚

â€œæ˜¯çš„ï¼Œæ¥çœ‹åŠ ä¸Š this å…³é”®å­—åçš„ä»£ç ã€‚â€

å®‰é™çš„å±‹å­é‡Œåˆå“èµ·äº†ä¸€é˜µå™¼é‡Œå•ªå•¦çš„é”®ç›˜å£°ã€‚

```java
public class WithThisStudent {
    String name;
    int age;

    WithThisStudent(String name, int age) {
        this.name = name;
        this.age = age;
    }

    void out() {
        System.out.println(name+" " + age);
    }

    public static void main(String[] args) {
        WithThisStudent s1 = new WithThisStudent("æ²‰é»˜ç‹äºŒ", 18);
        WithThisStudent s2 = new WithThisStudent("æ²‰é»˜ç‹ä¸‰", 16);

        s1.out();
        s2.out();
    }
}
```

â€œå†æ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„è¾“å‡ºç»“æœã€‚â€

```
æ²‰é»˜ç‹äºŒ 18
æ²‰é»˜ç‹ä¸‰ 16
```

â€œè¿™æ¬¡ï¼Œå®ä¾‹å˜é‡æœ‰å€¼äº†ï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­ï¼Œ`this.xxx` æŒ‡å‘çš„å°±æ˜¯å®ä¾‹å˜é‡ï¼Œè€Œä¸å†æ˜¯å‚æ•°æœ¬èº«äº†ã€‚â€æˆ‘æ…¢åååœ°è¯´ç€ï¼Œâ€œå½“ç„¶äº†ï¼Œå¦‚æœå‚æ•°åå’Œå®ä¾‹å˜é‡åä¸åŒçš„è¯ï¼Œå°±ä¸å¿…ä½¿ç”¨ this å…³é”®å­—ï¼Œä½†æˆ‘å»ºè®®ä½¿ç”¨ this å…³é”®å­—ï¼Œè¿™æ ·çš„ä»£ç æ›´æœ‰æ„ä¹‰ã€‚â€

### 02ã€è°ƒç”¨å½“å‰ç±»çš„æ–¹æ³•

â€œä»”ç»†å¬ï¼Œä¸‰å¦¹ï¼Œçœ‹æˆ‘æ•²é”®ç›˜çš„é€Ÿåº¦æ˜¯ä¸æ˜¯å¤Ÿå¿«ã€‚â€

```java
public class InvokeCurrentClassMethod {
    void method1() {}
    void method2() {
        method1();
    }

    public static void main(String[] args) {
        new InvokeCurrentClassMethod().method1();
    }
}
```

â€œä»”ç»†ç§ï¼Œä¸‰å¦¹ï¼Œä¸Šé¢è¿™æ®µä»£ç ä¸­æ²¡æœ‰è§åˆ° this å…³é”®å­—å§ï¼Ÿâ€æˆ‘é¢å¸¦ç€ç¥ç§˜çš„å¾®ç¬‘ï¼Œå‡†å¤‡ç»™ä¸‰å¦¹å˜ä¸ªé­”æœ¯ã€‚

â€œç¡®å®æ²¡æœ‰ï¼Œå“¥ï¼Œæˆ‘ç¡®è®¤è¿‡äº†ã€‚â€

â€œé‚£æ¥ä¸‹æ¥ï¼Œç¥å¥‡çš„äº‹æƒ…å°±è¦å‘ç”Ÿäº†ã€‚â€æˆ‘çªç„¶æ„Ÿè§‰åˆ˜è°¦é™„èº«äº†ã€‚

æˆ‘å¿«é€Ÿçš„åœ¨ classes ç›®å½•ä¸‹æ‰¾åˆ° InvokeCurrentClassMethod.class æ–‡ä»¶ï¼Œç„¶ååŒå‡»æ‰“å¼€ï¼ˆIDEA é»˜è®¤ä¼šä½¿ç”¨ FernFlower æ‰“å¼€å­—èŠ‚ç æ–‡ä»¶ï¼‰ã€‚

```java
public class InvokeCurrentClassMethod {
    public InvokeCurrentClassMethod() {
    }

    void method1() {
    }

    void method2() {
        this.method1();
    }

    public static void main(String[] args) {
        (new InvokeCurrentClassMethod()).method1();
    }
}
```

â€œçªå¤§çœ¼ç›ä»”ç»†ç§ï¼Œä¸‰å¦¹ï¼Œ`this` å…³é”®å­—æ˜¯ä¸æ˜¯å‡ºç°äº†ï¼Ÿâ€

â€œå“‡ï¼ŒçœŸçš„å‘¢ï¼Œå¥½ç¥å¥‡å•Šï¼â€ä¸‰å¦¹ä¸ºäº†é…åˆæˆ‘çš„æ¼”å‡ºï¼Œä¹Ÿæ˜¯åäºŒåˆ†çš„å–åŠ›ã€‚

â€œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªç±»ä¸­ä½¿ç”¨ this å…³é”®å­—æ¥è°ƒç”¨å¦å¤–ä¸€ä¸ªæ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨çš„è¯ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åŠ ä¸Šã€‚â€æˆ‘å¯¹è‡ªå·±æ·±åšçš„ç¼–ç¨‹åŠŸåº•å……æ»¡è‡ªä¿¡ï¼Œâ€œåœ¨æºä»£ç ä¸­ï¼Œ`method2()` åœ¨è°ƒç”¨ `method1()` çš„æ—¶å€™å¹¶æ²¡æœ‰ä½¿ç”¨ this å…³é”®å­—ï¼Œä½†é€šè¿‡åç¼–è¯‘åçš„å­—èŠ‚ç å¯ä»¥çœ‹å¾—åˆ°ã€‚â€

### 03ã€è°ƒç”¨å½“å‰ç±»çš„æ„é€ æ–¹æ³•

â€œå†æ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ã€‚â€

```java
public class InvokeConstrutor {
    InvokeConstrutor() {
        System.out.println("hello");
    }

    InvokeConstrutor(int count) {
        this();
        System.out.println(count);
    }

    public static void main(String[] args) {
        InvokeConstrutor invokeConstrutor = new InvokeConstrutor(10);
    }
}
```

â€œåœ¨æœ‰å‚æ„é€ æ–¹æ³• `InvokeConstrutor(int count)` ä¸­ï¼Œä½¿ç”¨äº† `this()` æ¥è°ƒç”¨æ— å‚æ„é€ æ–¹æ³• `InvokeConstrutor()`ã€‚â€è¿™æ¬¡ï¼Œæˆ‘æ¢æˆäº†å·¦æ‰‹çš„é£ŸæŒ‡ï¼ŒæŒ‡ç€å±å¹•å¯¹ä¸‰å¦¹è¯´ï¼Œâ€œ`this()` å¯ç”¨äºè°ƒç”¨å½“å‰ç±»çš„æ„é€ æ–¹æ³•â€”â€”æ„é€ æ–¹æ³•å¯ä»¥é‡ç”¨äº†ã€‚â€

â€œæ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœã€‚â€

```
hello
10
```

â€œçœŸçš„å•Šï¼Œæ— å‚æ„é€ æ–¹æ³•ä¹Ÿè¢«è°ƒç”¨äº†ï¼Œæ‰€ä»¥ç¨‹åºè¾“å‡ºäº† helloã€‚â€ä¸‰å¦¹çœ‹åˆ°è¾“å‡ºç»“æœåä¸å‡æ€ç´¢åœ°è¯´ã€‚

â€œä¹Ÿå¯ä»¥åœ¨æ— å‚æ„é€ æ–¹æ³•ä¸­ä½¿ç”¨ `this()` å¹¶ä¼ é€’å‚æ•°æ¥è°ƒç”¨æœ‰å‚æ„é€ æ–¹æ³•ã€‚â€è¯éŸ³æ²¡è½ï¼Œæˆ‘å°±åœ¨é”®ç›˜ä¸Šæ•²äº†èµ·æ¥ï¼Œâ€œæ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ã€‚â€

```java
public class InvokeParamConstrutor {
    InvokeParamConstrutor() {
        this(10);
        System.out.println("hello");
    }

    InvokeParamConstrutor(int count) {
        System.out.println(count);
    }

    public static void main(String[] args) {
        InvokeParamConstrutor invokeConstrutor = new InvokeParamConstrutor();
    }
}
```

â€œå†æ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„è¾“å‡ºç»“æœã€‚â€

```
10
hello
```

â€œä¸è¿‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`this()` å¿…é¡»æ”¾åœ¨æ„é€ æ–¹æ³•çš„ç¬¬ä¸€è¡Œï¼Œå¦åˆ™å°±æŠ¥é”™äº†ã€‚â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/keywords/20-01.png)

### 04ã€ä½œä¸ºå‚æ•°åœ¨æ–¹æ³•ä¸­ä¼ é€’

â€œæ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ã€‚â€

```java
public class ThisAsParam {
    void method1(ThisAsParam p) {
        System.out.println(p);
    }

    void method2() {
        method1(this);
    }

    public static void main(String[] args) {
        ThisAsParam thisAsParam = new ThisAsParam();
        System.out.println(thisAsParam);
        thisAsParam.method2();
    }
}
```

â€œ`this` å…³é”®å­—å¯ä»¥ä½œä¸ºå‚æ•°åœ¨æ–¹æ³•ä¸­ä¼ é€’ï¼Œæ­¤æ—¶ï¼Œå®ƒæŒ‡å‘çš„æ˜¯å½“å‰ç±»çš„å¯¹è±¡ã€‚â€ä¸€ä¸å°å¿ƒï¼ŒåŠä¸ªå°æ—¶è¿‡å»äº†ï¼Œæˆ‘æ„Ÿåˆ°å—“å­å†’çƒŸï¼Œäºæ˜¯èµ¶ç´§åˆå–äº†ä¸€å£æ°´ï¼Œæ¶¦æ¶¦å—“å­åç»§ç»­è¯´é“ã€‚

â€œæ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœï¼Œä½ å°±æ˜ç™½äº†ï¼Œä¸‰å¦¹ã€‚â€

```
com.itwanger.twentyseven.ThisAsParam@77459877
com.itwanger.twentyseven.ThisAsParam@77459877
```

â€œ`method2()` è°ƒç”¨äº† `method1()`ï¼Œå¹¶ä¼ é€’äº†å‚æ•° thisï¼Œ`method1()` ä¸­æ‰“å°äº†å½“å‰å¯¹è±¡çš„å­—ç¬¦ä¸²ã€‚ `main()` æ–¹æ³•ä¸­æ‰“å°äº† thisAsParam å¯¹è±¡çš„å­—ç¬¦ä¸²ã€‚ä»è¾“å‡ºç»“æœä¸­å¯ä»¥çœ‹å¾—å‡ºæ¥ï¼Œä¸¤è€…æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚â€

### 05ã€ä½œä¸ºå‚æ•°åœ¨æ„é€ æ–¹æ³•ä¸­ä¼ é€’

â€œç»§ç»­æ¥çœ‹ä»£ç ã€‚â€

```java
public class ThisAsConstrutorParam {
    int count = 10;

    ThisAsConstrutorParam() {
        Data data = new Data(this);
        data.out();
    }

    public static void main(String[] args) {
        new ThisAsConstrutorParam();
    }
}

class Data {
    ThisAsConstrutorParam param;
    Data(ThisAsConstrutorParam param) {
        this.param = param;
    }

    void out() {
        System.out.println(param.count);
    }
}
```

â€œåœ¨æ„é€ æ–¹æ³• `ThisAsConstrutorParam()` ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ this å…³é”®å­—ä½œä¸ºå‚æ•°ä¼ é€’ç»™äº† Data å¯¹è±¡ï¼Œå®ƒå…¶å®æŒ‡å‘çš„å°±æ˜¯ `new ThisAsConstrutorParam()` è¿™ä¸ªå¯¹è±¡ã€‚â€

â€œ`this` å…³é”®å­—ä¹Ÿå¯ä»¥ä½œä¸ºå‚æ•°åœ¨æ„é€ æ–¹æ³•ä¸­ä¼ é€’ï¼Œå®ƒæŒ‡å‘çš„æ˜¯å½“å‰ç±»çš„å¯¹è±¡ã€‚å½“æˆ‘ä»¬éœ€è¦åœ¨å¤šä¸ªç±»ä¸­ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œè¿™éå¸¸æœ‰ç”¨ã€‚â€

â€œæ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœã€‚â€

```
10
```

### 06ã€ä½œä¸ºæ–¹æ³•çš„è¿”å›å€¼

â€œéœ€è¦ä¼‘æ¯ä¼šå—ï¼Ÿä¸‰å¦¹â€

â€œæ²¡äº‹çš„ï¼Œå“¥ï¼Œæˆ‘çš„æ³¨æ„åŠ›è¿˜æ˜¯å¾ˆé›†ä¸­çš„ï¼Œä½ ç»§ç»­è®²å§ã€‚â€

â€œå¥½çš„ï¼Œé‚£æ¥ç»§ç»­çœ‹ä»£ç ã€‚â€

```java
public class ThisAsMethodResult {
    ThisAsMethodResult getThisAsMethodResult() {
        return this;
    }
    
    void out() {
        System.out.println("hello");
    }

    public static void main(String[] args) {
        new ThisAsMethodResult().getThisAsMethodResult().out();
    }
}
```

â€œ`getThisAsMethodResult()` æ–¹æ³•è¿”å›äº† this å…³é”®å­—ï¼ŒæŒ‡å‘çš„å°±æ˜¯ `new ThisAsMethodResult()` è¿™ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥ç´§æ¥ç€è°ƒç”¨ `out()` æ–¹æ³•â€”â€”è¾¾åˆ°äº†é“¾å¼è°ƒç”¨çš„ç›®çš„ï¼Œè¿™ä¹Ÿæ˜¯ this å…³é”®å­—éå¸¸ç»å…¸çš„ä¸€ç§ç”¨æ³•ã€‚â€

â€œé“¾å¼è°ƒç”¨çš„å½¢å¼åœ¨ JavaScript ä»£ç æ›´åŠ å¸¸è§ã€‚â€ä¸ºäº†å‘ä¸‰å¦¹è¯å®è¿™ä¸€ç‚¹ï¼Œæˆ‘æ‰“å¼€äº† jQuery çš„æºç ã€‚

â€œåŸæ¥è¿™ä¹ˆå¤šé“¾å¼è°ƒç”¨å•Šï¼â€ä¸‰å¦¹æ„Ÿå¹åˆ°ã€‚

â€œæ˜¯çš„ã€‚â€æˆ‘ç‚¹ç‚¹å¤´ï¼Œç„¶åæŒ‡ç€ `getThisAsMethodResult()` æ–¹æ³•çš„è¿”å›å€¼å¯¹ä¸‰å¦¹è¯´ï¼Œâ€œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`this` å…³é”®å­—ä½œä¸ºæ–¹æ³•çš„è¿”å›å€¼çš„æ—¶å€™ï¼Œæ–¹æ³•çš„è¿”å›ç±»å‹ä¸ºç±»çš„ç±»å‹ã€‚â€

â€œæ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœã€‚â€

```
hello
```

â€œé‚£ä¹ˆï¼Œå…³äº this å…³é”®å­—çš„ä»‹ç»ï¼Œå°±åˆ°æ­¤ä¸ºæ­¢äº†ã€‚â€æˆ‘æ´»åŠ¨äº†ä¸€ä¸‹åƒµç¡¬çš„è„–å­åï¼Œå¯¹ä¸‰å¦¹è¯´ï¼Œâ€œå¦‚æœä½ å­¦ä¹ åŠ²å¤´è¿˜å¯ä»¥çš„è¯ï¼Œæˆ‘ä»¬é¡ºå¸¦æŠŠ super å…³é”®å­—æå¸¦ç€è¿‡ä¸€ä¸‹ï¼Œæ€ä¹ˆæ ·ï¼Ÿâ€

â€œä¸ç”¨äº†å§ï¼Œå¬è¯´ super å…³é”®å­—æ›´ç®€å•ï¼Œæˆ‘è‡ªå·±çœ‹çœ‹å°±è¡Œäº†ï¼Œä¸ç”¨ä½ è®²äº†ï¼â€

â€œä¸ä¸ä¸ï¼Œä¸‰å¦¹å•Šï¼Œä½ å¾—å‡è£…å¬ä¸€ä¸‹ï¼Œä¸ç„¶æˆ‘æ€ä¹ˆå‘è¯»è€…ä»¬äº¤å·®ã€‚â€

â€œå™¢å™¢å™¢å™¢ã€‚â€ä¸‰å¦¹æ„å‘³æ·±é•¿åœ°ç¬‘äº†ã€‚

### 07ã€super å…³é”®å­—

â€œsuper å…³é”®å­—çš„ç”¨æ³•ä¸»è¦æœ‰ä¸‰ç§ã€‚â€

- æŒ‡å‘çˆ¶ç±»å¯¹è±¡ï¼›
- è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼›
- `super()` å¯ä»¥è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ã€‚

â€œå…¶å®å’Œ this æœ‰äº›ç›¸ä¼¼ï¼Œåªä¸è¿‡ç”¨æ„ä¸å¤§ç›¸åŒã€‚â€æˆ‘ç«¯èµ·æ°´ç“¶ï¼Œå’•å’šå’•å’šåˆå–äº†å‡ å¤§å£ï¼Œå¥½æ¸´ã€‚â€œæ¯å½“åˆ›å»ºä¸€ä¸ªå­ç±»å¯¹è±¡çš„æ—¶å€™ï¼Œä¹Ÿä¼šéšå¼çš„åˆ›å»ºçˆ¶ç±»å¯¹è±¡ï¼Œç”± super å…³é”®å­—å¼•ç”¨ã€‚â€

â€œå¦‚æœçˆ¶ç±»å’Œå­ç±»æ‹¥æœ‰åŒæ ·åç§°çš„å­—æ®µï¼Œsuper å…³é”®å­—å¯ä»¥ç”¨æ¥è®¿é—®çˆ¶ç±»çš„åŒåå­—æ®µã€‚â€

â€œæ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ã€‚â€

```java
public class ReferParentField {
    public static void main(String[] args) {
        new Dog().printColor();
    }
}

class Animal {
    String color = "ç™½è‰²";
}

class Dog extends Animal {
    String color = "é»‘è‰²";

    void printColor() {
        System.out.println(color);
        System.out.println(super.color);
    }
}
```

â€œçˆ¶ç±» Animal ä¸­æœ‰ä¸€ä¸ªåä¸º color çš„å­—æ®µï¼Œå­ç±» Dog ä¸­ä¹Ÿæœ‰ä¸€ä¸ªåä¸º color çš„å­—æ®µï¼Œå­ç±»çš„ `printColor()` æ–¹æ³•ä¸­ï¼Œé€šè¿‡ super å…³é”®å­—å¯ä»¥è®¿é—®çˆ¶ç±»çš„ colorã€‚â€

â€œæ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœã€‚â€

```
é»‘è‰²
ç™½è‰²
```

â€œå½“å­ç±»å’Œçˆ¶ç±»çš„æ–¹æ³•åç›¸åŒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ super å…³é”®å­—æ¥è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ã€‚æ¢å¥è¯è¯´ï¼Œsuper å…³é”®å­—å¯ä»¥ç”¨äºæ–¹æ³•é‡å†™æ—¶è®¿é—®åˆ°çˆ¶ç±»çš„æ–¹æ³•ã€‚â€


```java
public class ReferParentMethod {
    public static void main(String[] args) {
        new Dog().work();
    }
}

class Animal {
    void eat() {
        System.out.println("åƒ...");
    }
}

class Dog extends Animal {
    @Override
    void eat() {
        System.out.println("åƒ...");
    }

    void bark() {
        System.out.println("æ±ªæ±ªæ±ª...");
    }

    void work() {
        super.eat();
        bark();
    }
}  
```

â€œç§ï¼Œä¸‰å¦¹ã€‚çˆ¶ç±» Animal å’Œå­ç±» Dog ä¸­éƒ½æœ‰ä¸€ä¸ªåä¸º `eat()` çš„æ–¹æ³•ï¼Œé€šè¿‡ `super.eat()` å¯ä»¥è®¿é—®åˆ°çˆ¶ç±»çš„ `eat()` æ–¹æ³•ã€‚â€

ç­‰ä¸‰å¦¹åœ¨è‡ªæˆ‘æ¶ˆåŒ–çš„æ—¶å€™ï¼Œæˆ‘åœ¨é”®ç›˜ä¸Šåˆæ•²å®Œäº†ä¸€ä¸²ä»£ç ã€‚

```java
public class ReferParentConstructor {
    public static void main(String[] args) {
        new Dog();
    }
}

class Animal {
    Animal(){
        System.out.println("åŠ¨ç‰©æ¥äº†");
    }
}

class Dog extends Animal {
    Dog() {
        super();
        System.out.println("ç‹—ç‹—æ¥äº†");
    }
}
```

â€œå­ç±» Dog çš„æ„é€ æ–¹æ³•ä¸­ï¼Œç¬¬ä¸€è¡Œä»£ç ä¸º `super()`ï¼Œå®ƒå°±æ˜¯ç”¨æ¥è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•çš„ã€‚â€

â€œæ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœã€‚â€

```
åŠ¨ç‰©æ¥äº†
ç‹—ç‹—æ¥äº†
```

â€œå½“ç„¶äº†ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ`super()` æ˜¯å¯ä»¥çœç•¥çš„ï¼Œç¼–è¯‘å™¨ä¼šä¸»åŠ¨å»è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå­ç±»å³ä½¿ä¸ä½¿ç”¨ `super()` ä¸»åŠ¨è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œçˆ¶ç±»çš„æ„é€ æ–¹æ³•ä»ç„¶ä¼šå…ˆæ‰§è¡Œã€‚â€

```java
public class ReferParentConstructor {
    public static void main(String[] args) {
        new Dog();
    }
}

class Animal {
    Animal(){
        System.out.println("åŠ¨ç‰©æ¥äº†");
    }
}

class Dog extends Animal {
    Dog() {
        System.out.println("ç‹—ç‹—æ¥äº†");
    }
}
```

â€œè¾“å‡ºç»“æœå’Œä¹‹å‰ä¸€æ ·ã€‚â€

```
åŠ¨ç‰©æ¥äº†
ç‹—ç‹—æ¥äº†
```

â€œ`super()` ä¹Ÿå¯ä»¥ç”¨æ¥è°ƒç”¨çˆ¶ç±»çš„æœ‰å‚æ„é€ æ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥æé«˜ä»£ç çš„å¯é‡ç”¨æ€§ã€‚â€

```java
class Person {
    int id;
    String name;

    Person(int id, String name) {
        this.id = id;
        this.name = name;
    }
}

class Emp extends Person {
    float salary;

    Emp(int id, String name, float salary) {
        super(id, name);
        this.salary = salary;
    }

    void display() {
        System.out.println(id + " " + name + " " + salary);
    }
}

public class CallParentParamConstrutor {
    public static void main(String[] args) {
        new Emp(1, "æ²‰é»˜ç‹äºŒ", 20000f).display();
    }
}
```

â€œEmp ç±»ç»§æ‰¿äº† Person ç±»ï¼Œä¹Ÿå°±ç»§æ‰¿äº† id å’Œ name å­—æ®µï¼Œå½“åœ¨ Emp ä¸­æ–°å¢äº† salary å­—æ®µåï¼Œæ„é€ æ–¹æ³•ä¸­å°±å¯ä»¥ä½¿ç”¨ `super(id, name)` æ¥è°ƒç”¨çˆ¶ç±»çš„æœ‰å‚æ„é€ æ–¹æ³•ã€‚â€

â€œæ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœã€‚â€

```
1 æ²‰é»˜ç‹äºŒ 20000.0
```

ä¸‰å¦¹ç‚¹äº†ç‚¹å¤´ï¼Œæ‰€æœ‰æ‰€æ€ã€‚

----


GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 5.15 Java staticå…³é”®å­—

â€œå“¥ï¼Œä½ ç‰™é¾ˆè‚¿ç—›è½»ç‚¹æ²¡ï¼Ÿå‘¨ä¸€çš„ã€Šæ•™å¦¹å­¦ Javaã€‹ï¼ˆäºŒå“¥çš„Javaè¿›é˜¶ä¹‹è·¯å‰èº«ï¼‰ä½ éƒ½æ²¡æœ‰æ›´æ–°ï¼Œå·æ‡’äº†å‘€ï¼â€ä¸‰å¦¹å…³å¿ƒåœ°é—®æˆ‘ã€‚

â€œä»Šå¤©å‘¨å››äº†ï¼Œåƒäº†ä¸‰å¤©çš„è¯ï¼Œç–¼ç—›å·²ç»å‡è½»ä¸å°‘ï¼Œå’±å¦ˆè¿˜ç»™æˆ‘æ‰“äº†ç”µè¯ï¼Œè®©æˆ‘ä¹°ç‚¹ç‰›é»„è§£æ¯’ç‰‡ä¸‹ä¸‹ç«ã€‚â€æˆ‘é¢å¸¦ç€å¾®ç¬‘å¯¹ä¸‰å¦¹è¯´ï¼Œâ€œå­¦ä¹ å¯ä¸èƒ½è½ä¸‹ï¼Œä»Šå¤©æˆ‘ä»¬æ¥å­¦ Java ä¸­ `static` å…³é”®å­—å§ã€‚â€

â€œstatic æ˜¯ Java ä¸­æ¯”è¾ƒéš¾ä»¥ç†è§£çš„ä¸€ä¸ªå…³é”®å­—ï¼Œä¹Ÿæ˜¯å„å¤§å…¬å¸çš„é¢è¯•å®˜æœ€å–œæ¬¢é—®åˆ°çš„ä¸€ä¸ªçŸ¥è¯†ç‚¹ä¹‹ä¸€ã€‚â€æˆ‘å–äº†ä¸€å£å’–å•¡ç»§ç»­è¯´é“ã€‚

â€œæ—¢ç„¶æ˜¯é¢è¯•é‡ç‚¹ï¼Œé‚£æˆ‘å¯å¾—å¥½å¥½å­¦ä¹ ä¸‹ã€‚â€ä¸‰å¦¹è¿å¿™è¯´ã€‚

â€œstatic å…³é”®å­—çš„ä½œç”¨å¯ä»¥ç”¨ä¸€å¥è¯æ¥æè¿°ï¼šâ€˜**æ–¹ä¾¿åœ¨æ²¡æœ‰åˆ›å»ºå¯¹è±¡çš„æƒ…å†µä¸‹è¿›è¡Œè°ƒç”¨**ï¼ŒåŒ…æ‹¬å˜é‡å’Œæ–¹æ³•â€™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦ç±»è¢«åŠ è½½äº†ï¼Œå°±å¯ä»¥é€šè¿‡ç±»åè¿›è¡Œè®¿é—®ã€‚â€æˆ‘æ‰¶äº†æ‰¶æ²‰é‡çœ¼é•œï¼Œç»§ç»­è¯´åˆ°ï¼Œâ€œstatic å¯ä»¥ç”¨æ¥ä¿®é¥°ç±»çš„æˆå‘˜å˜é‡ï¼Œä»¥åŠæˆå‘˜æ–¹æ³•ã€‚æˆ‘ä»¬ä¸€ä¸ªä¸ªæ¥çœ‹ã€‚â€

### 01ã€é™æ€å˜é‡

â€œå¦‚æœåœ¨å£°æ˜å˜é‡çš„æ—¶å€™ä½¿ç”¨äº† static å…³é”®å­—ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡å°±è¢«ç§°ä¸ºé™æ€å˜é‡ã€‚é™æ€å˜é‡åªåœ¨ç±»åŠ è½½çš„æ—¶å€™è·å–ä¸€æ¬¡å†…å­˜ç©ºé—´ï¼Œè¿™ä½¿å¾—é™æ€å˜é‡å¾ˆèŠ‚çœå†…å­˜ç©ºé—´ã€‚â€å®¶é‡Œçš„æš–æ°”æœ‰ç‚¹è¶³ï¼Œæˆ‘è·‘å»å¼€äº†ä¸€ç‚¹çª—æˆ·åç»§ç»­è¯´é“ã€‚

â€œæ¥è€ƒè™‘è¿™æ ·ä¸€ä¸ª Student ç±»ã€‚â€è¯éŸ³åˆšè½ï¼Œæˆ‘å°±åœ¨é”®ç›˜ä¸Šå™¼é‡Œå•ªå•¦ä¸€é˜µæ•²ã€‚

```java
public class Student {
    String name;
    int age;
    String school = "éƒ‘å·å¤§å­¦";
}
```

è¿™æ®µä»£ç æ•²å®Œåï¼Œæˆ‘å¯¹ä¸‰å¦¹è¯´ï¼šâ€œå‡è®¾éƒ‘å·å¤§å­¦å½•å–äº†ä¸€ä¸‡åæ–°ç”Ÿï¼Œé‚£ä¹ˆåœ¨åˆ›å»ºä¸€ä¸‡ä¸ª Student å¯¹è±¡çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„å­—æ®µï¼ˆnameã€age å’Œ schoolï¼‰éƒ½ä¼šè·å–åˆ°ä¸€å—å†…å­˜ã€‚å­¦ç”Ÿçš„å§“åå’Œå¹´çºªä¸å°½ç›¸åŒï¼Œä½†éƒ½å±äºéƒ‘å·å¤§å­¦ï¼Œå¦‚æœæ¯åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œschool è¿™ä¸ªå­—æ®µéƒ½è¦å ç”¨ä¸€å—å†…å­˜çš„è¯ï¼Œå°±å¾ˆæµªè´¹ï¼Œå¯¹å§ï¼Ÿä¸‰å¦¹ã€‚â€

â€œå› æ­¤ï¼Œæœ€å¥½å°† school è¿™ä¸ªå­—æ®µè®¾ç½®ä¸º staticï¼Œè¿™æ ·å°±åªä¼šå ç”¨ä¸€å—å†…å­˜ï¼Œè€Œä¸æ˜¯ä¸€ä¸‡å—ã€‚â€

å®‰é™çš„æˆ¿å­é‡Œåˆå“èµ·äº†ä¸€é˜µå™¼é‡Œå•ªå•¦çš„é”®ç›˜å£°ã€‚

```java
public class Student {
    String name;
    int age;
    static String school = "éƒ‘å·å¤§å­¦";

    public Student(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public static void main(String[] args) {
        Student s1 = new Student("æ²‰é»˜ç‹äºŒ", 18);
        Student s2 = new Student("æ²‰é»˜ç‹ä¸‰", 16);
    }
}
```

â€œç§ï¼Œä¸‰å¦¹ã€‚s1 å’Œ s2 è¿™ä¸¤ä¸ªå¼•ç”¨å˜é‡å­˜æ”¾åœ¨æ ˆåŒºï¼ˆstackï¼‰ï¼Œæ²‰é»˜ç‹äºŒ+18 è¿™ä¸ªå¯¹è±¡å’Œæ²‰é»˜ç‹ä¸‰+16 è¿™ä¸ªå¯¹è±¡å­˜æ”¾åœ¨å †åŒºï¼ˆheapï¼‰ï¼Œschool è¿™ä¸ªé™æ€å˜é‡å­˜æ”¾åœ¨é™æ€åŒºã€‚â€

â€œç­‰ç­‰ï¼Œå“¥ï¼Œæ ˆã€å †ã€é™æ€åŒºï¼Ÿâ€ä¸‰å¦¹çš„è„¸ä¸Šå¡æ»¡äº†ç–‘æƒ‘ã€‚

â€œå“¦å“¦ï¼Œåˆ«æ‹…å¿ƒï¼Œä¸‰å¦¹ï¼Œç”»å¹…å›¾ä½ å°±å…¨æ˜ç™½äº†ã€‚â€è¯´å®Œæˆ‘å°±æ‰“å¼€ draw.io è¿™ä¸ªç½‘å€ï¼Œè®¤çœŸåœ°ç”»èµ·äº†å›¾ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/keywords/19-01.png)

â€œç°åœ¨ï¼Œæ˜¯ä¸æ˜¯ä¸€ä¸‹å­å°±æ˜ç™½äº†ï¼Ÿâ€çœ‹ç€è¿™å¹…æ¼‚äº®çš„æ‰‹ç»˜å›¾ï¼Œæˆ‘å¿ƒé‡Œæœ‰ç‚¹å°å¼€å¿ƒã€‚

â€œå“‡ï¼Œå“¥ï¼ŒæƒŠè‰³äº†å‘€ï¼â€ä¸‰å¦¹ä¹Ÿä¸å¿˜æ‹é©¬å±ï¼Œç»™æˆ‘äº†ä¸€ä¸ªå¤§å¤§çš„èµã€‚

â€œå¥½äº†ï¼Œä¸‰å¦¹ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹é¢è¿™ä¸²ä»£ç ã€‚â€

```java
public class Counter {
    int count = 0;

    Counter() {
        count++;
        System.out.println(count);
    }

    public static void main(String args[]) {
        Counter c1 = new Counter();
        Counter c2 = new Counter();
        Counter c3 = new Counter();
    }
}
```

â€œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæˆå‘˜å˜é‡ countï¼Œå¹¶ä¸”åœ¨æ„é€ å‡½æ•°ä¸­è®©å®ƒè‡ªå¢ã€‚å› ä¸ºæˆå‘˜å˜é‡ä¼šåœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™è·å–å†…å­˜ï¼Œå› æ­¤æ¯ä¸€ä¸ªå¯¹è±¡éƒ½ä¼šæœ‰ä¸€ä¸ª count çš„å‰¯æœ¬ï¼Œ count çš„å€¼å¹¶ä¸ä¼šéšç€å¯¹è±¡çš„å¢å¤šè€Œé€’å¢ã€‚â€

æˆ‘åœ¨ä¾ƒä¾ƒè€Œè°ˆï¼Œè€Œä¸‰å¦¹ä¼¼ä¹æœ‰äº›ä¸å¤ªæ˜ç™½ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/keywords/19-02.png)


â€œæ²¡å…³ç³»ï¼Œä¸‰å¦¹ï¼Œä½ å…ˆç›²çŒœä¸€ä¸‹ï¼Œè¿™æ®µä»£ç è¾“å‡ºçš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿâ€

â€œæŒ‰ç…§ä½ çš„é€»è¾‘ï¼Œåº”è¯¥è¾“å‡ºä¸‰ä¸ª 1ï¼Ÿæ˜¯è¿™æ ·å—ï¼Ÿâ€ä¸‰å¦¹çœ¨çœ¨çœ¼ï¼Œæœ‰ç‚¹ä¸å¤ªè‡ªä¿¡åœ°å›ç­”ã€‚

â€œå“å‘€ï¼Œä¸é”™å“Ÿã€‚â€

æˆ‘åœ¨ IDEA ä¸­ç‚¹äº†ä¸€ä¸‹è¿è¡ŒæŒ‰é’®ï¼Œç¨‹åºè·‘äº†èµ·æ¥ã€‚

```
1
1
1
```

â€œæ¯åˆ›å»ºä¸€ä¸ª Counter å¯¹è±¡ï¼Œcount çš„å€¼å°±ä» 0 è‡ªå¢åˆ° 1ã€‚ä¸‰å¦¹ï¼Œæƒ³ä¸€ä¸‹ï¼Œå¦‚æœ count æ˜¯é™æ€çš„å‘¢ï¼Ÿâ€

â€œæˆ‘ä¸çŸ¥é“å•Šã€‚â€

â€œå—¯ï¼Œæ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ã€‚â€

```java
public class StaticCounter {
    static int count = 0;

    StaticCounter() {
        count++;
        System.out.println(count);
    }

    public static void main(String args[]) {
        StaticCounter c1 = new StaticCounter();
        StaticCounter c2 = new StaticCounter();
        StaticCounter c3 = new StaticCounter();
    }
}
```

â€œæ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœã€‚â€

```
1
2
3
```

â€œç®€å•è§£é‡Šä¸€ä¸‹å“ˆï¼Œç”±äºé™æ€å˜é‡åªä¼šè·å–ä¸€æ¬¡å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥ä»»ä½•å¯¹è±¡å¯¹å®ƒçš„ä¿®æ”¹éƒ½ä¼šå¾—åˆ°ä¿ç•™ï¼Œæ‰€ä»¥æ¯åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œcount çš„å€¼å°±ä¼šåŠ  1ï¼Œæ‰€ä»¥æœ€ç»ˆçš„ç»“æœæ˜¯ 3ï¼Œæ˜ç™½äº†å§ï¼Ÿä¸‰å¦¹ã€‚è¿™å°±æ˜¯é™æ€å˜é‡å’Œæˆå‘˜å˜é‡ä¹‹é—´çš„å·®åˆ«ã€‚â€

â€œå¦å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºé™æ€å˜é‡å±äºä¸€ä¸ªç±»ï¼Œæ‰€ä»¥ä¸è¦é€šè¿‡å¯¹è±¡å¼•ç”¨æ¥è®¿é—®ï¼Œè€Œåº”è¯¥ç›´æ¥é€šè¿‡ç±»åæ¥è®¿é—®ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šå‘å‡ºè­¦å‘Šã€‚â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/keywords/19-03.png)


### 02ã€é™æ€æ–¹æ³•

â€œè¯´å®Œé™æ€å˜é‡ï¼Œæˆ‘ä»¬æ¥è¯´é™æ€æ–¹æ³•ã€‚â€è¯´å®Œï¼Œæˆ‘å‡†å¤‡ç‚¹ä¸€æ”¯åå­æ¥æŠ½ï¼Œä¸‰å¦¹é˜»æ­¢äº†æˆ‘ï¼Œå¥¹æŒ‡ä¸€æŒ‡çƒŸç›’ä¸Šçš„ã€Œå¸çƒŸæœ‰å®³èº«ä½“å¥åº·ã€ï¼Œæˆ‘ç¬‘äº†ã€‚

â€œå¥½å§ã€‚â€æˆ‘åªå¥½å–äº†ä¸€å£å’–å•¡ç»§ç»­è¯´ï¼Œâ€œå¦‚æœæ–¹æ³•ä¸ŠåŠ äº† static å…³é”®å­—ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ã€‚â€

â€œé™æ€æ–¹æ³•æœ‰ä»¥ä¸‹è¿™äº›ç‰¹å¾ã€‚â€

- é™æ€æ–¹æ³•å±äºè¿™ä¸ªç±»è€Œä¸æ˜¯è¿™ä¸ªç±»çš„å¯¹è±¡ï¼›
- è°ƒç”¨é™æ€æ–¹æ³•çš„æ—¶å€™ä¸éœ€è¦åˆ›å»ºè¿™ä¸ªç±»çš„å¯¹è±¡ï¼›
- é™æ€æ–¹æ³•å¯ä»¥è®¿é—®é™æ€å˜é‡ã€‚

â€œæ¥ï¼Œç»§ç»­ä¸Šä»£ç â€

```java
public class StaticMethodStudent {
    String name;
    int age;
    static String school = "éƒ‘å·å¤§å­¦";

    public StaticMethodStudent(String name, int age) {
        this.name = name;
        this.age = age;
    }
    
    static void change() {
        school = "æ²³å—å¤§å­¦";
    }
    
    void out() {
        System.out.println(name + " " + age + " " + school);
    }

    public static void main(String[] args) {
        StaticMethodStudent.change();
        
        StaticMethodStudent s1 = new StaticMethodStudent("æ²‰é»˜ç‹äºŒ", 18);
        StaticMethodStudent s2 = new StaticMethodStudent("æ²‰é»˜ç‹ä¸‰", 16);
        
        s1.out();
        s2.out();
    }
}
```

â€œä»”ç»†å¬ï¼Œä¸‰å¦¹ã€‚`change()` æ–¹æ³•å°±æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç›´æ¥è®¿é—®é™æ€å˜é‡ schoolï¼ŒæŠŠå®ƒçš„å€¼æ›´æ”¹ä¸ºæ²³å—å¤§å­¦ï¼›å¹¶ä¸”ï¼Œå¯ä»¥é€šè¿‡ç±»åç›´æ¥è°ƒç”¨ `change()` æ–¹æ³•ï¼Œå°±åƒ ` StaticMethodStudent.change()` è¿™æ ·ã€‚â€

â€œæ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„è¾“å‡ºç»“æœå§ã€‚â€

```
æ²‰é»˜ç‹äºŒ 18 æ²³å—å¤§å­¦
æ²‰é»˜ç‹ä¸‰ 16 æ²³å—å¤§å­¦
```

â€œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé™æ€æ–¹æ³•ä¸èƒ½è®¿é—®éé™æ€å˜é‡å’Œè°ƒç”¨éé™æ€æ–¹æ³•ã€‚ä½ çœ‹ï¼Œä¸‰å¦¹ï¼Œæˆ‘ç¨å¾®æ”¹åŠ¨ä¸€ä¸‹ä»£ç ï¼Œç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ã€‚â€

â€œå…ˆæ˜¯åœ¨é™æ€æ–¹æ³•ä¸­è®¿é—®éé™æ€å˜é‡ï¼Œç¼–è¯‘å™¨ä¸å…è®¸ã€‚â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/keywords/19-04.png)

â€œç„¶ååœ¨é™æ€æ–¹æ³•ä¸­è®¿é—®éé™æ€æ–¹æ³•ï¼Œç¼–è¯‘å™¨åŒæ ·ä¸å…è®¸ã€‚â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/keywords/19-05.png)

â€œå…³äºé™æ€æ–¹æ³•çš„ä½¿ç”¨ï¼Œè¿™ä¸‹æ¸…æ¥šäº†å§ï¼Œä¸‰å¦¹ï¼Ÿâ€

çœ‹ç€ä¸‰å¦¹ç‚¹ç‚¹å¤´ï¼Œæˆ‘æ¬£æ…°åœ°ç¬‘äº†ã€‚

â€œå“¥ï¼Œæˆ‘æƒ³åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆ main æ–¹æ³•æ˜¯é™æ€çš„å•Šï¼Ÿâ€æ²¡æƒ³åˆ°ï¼Œä¸‰å¦¹ä¸²è”çŸ¥è¯†ç‚¹çš„åŠŸåŠ›è¿˜æ˜¯ä¸é”™çš„ã€‚

â€œå¦‚æœ main æ–¹æ³•ä¸æ˜¯é™æ€çš„ï¼Œå°±æ„å‘³ç€ Java è™šæ‹Ÿæœºåœ¨æ‰§è¡Œçš„æ—¶å€™éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªå¯¹è±¡æ‰èƒ½è°ƒç”¨ main æ–¹æ³•ï¼Œè€Œ main æ–¹æ³•ä½œä¸ºç¨‹åºçš„å…¥å£ï¼Œåˆ›å»ºä¸€ä¸ªé¢å¤–çš„å¯¹è±¡æ˜¾å¾—éå¸¸å¤šä½™ã€‚â€æˆ‘ä¸å‡æ€ç´¢çš„å›ç­”ä»¤ä¸‰å¦¹æ„Ÿåˆ°éå¸¸çš„é’¦ä½©ã€‚

â€œjava.lang.Math ç±»çš„å‡ ä¹æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯é™æ€çš„ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ç±»åæ¥è°ƒç”¨ï¼Œä¸éœ€è¦åˆ›å»ºç±»çš„å¯¹è±¡ã€‚â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/keywords/19-06.png)

### 03ã€é™æ€ä»£ç å—

â€œä¸‰å¦¹ï¼Œç«™èµ·æ¥æ´»åŠ¨ä¸€ä¸‹ï¼Œæˆ‘çš„è„–å­éƒ½æœ‰ç‚¹åƒµç¡¬äº†ã€‚â€

æˆ‘ä»¬ä¸€èµ·èµ°åˆ°çª—æˆ·è¾¹ï¼Œæ˜ å…¥çœ¼å¸˜çš„æ˜¯ä»å¤©è€Œé™çš„é›ªèŠ±ã€‚ä¸‰å¦¹å’Œæˆ‘éƒ½é«˜å…´åäº†ï¼Œè¿«ä¸åŠå¾…åœ°æ‰“å¼€çª—å£ï¼Œä¼¸å‡ºæ‰‹å»è§¦æ‘¸é›ªèŠ±çš„æ¸©åº¦ï¼Œé‚£ç§ç¨çºµå³é€çš„å†°å‡‰ï¼ŒçœŸçš„èˆ’æœæäº†ã€‚

â€œåŒ—å›½é£å…‰ï¼Œåƒé‡Œå†°å°ï¼Œä¸‡é‡Œé›ªé£˜ã€‚æœ›é•¿åŸå†…å¤–ï¼ŒæƒŸä½™è½è½ï¼›å¤§æ²³ä¸Šä¸‹ï¼Œé¡¿å¤±æ»”æ»”ã€‚å±±èˆé“¶è›‡ï¼ŒåŸé©°èœ¡è±¡ï¼Œæ¬²ä¸å¤©å…¬è¯•æ¯”é«˜ã€‚é¡»æ™´æ—¥ï¼Œçœ‹çº¢è£…ç´ è£¹ï¼Œåˆ†å¤–å¦–å¨†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚â€ä¸‰å¦¹ç«Ÿç„¶æƒ…ä¸è‡ªç¦åœ°æœ—è¯µèµ·äº†ã€Šæ²å›­æ˜¥Â·é›ªã€‹ã€‚

ç¡®å®ä»¤äººæ¬£å–œï¼Œè¿™æ˜¯ 2020 å¹´æ´›é˜³çš„ç¬¬ä¸€åœºé›ªï¼Œçš„ç¡®ä»¤äººæ„Ÿåˆ°å¼€å¿ƒã€‚

ç‰‡åˆ»ä¹‹åã€‚

â€œé™¤äº†é™æ€å˜é‡å’Œé™æ€æ–¹æ³•ï¼Œstatic å…³é”®å­—è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ä½œç”¨ã€‚â€æˆ‘å¿ƒæƒ…æ„‰æ‚¦åœ°å¯¹ä¸‰å¦¹è¯´ï¼Œâ€œç”¨ä¸€ä¸ª static å…³é”®å­—ï¼Œå¤–åŠ ä¸€ä¸ªå¤§æ‹¬å·æ‹¬èµ·æ¥çš„ä»£ç è¢«ç§°ä¸ºé™æ€ä»£ç å—ã€‚â€

â€œå°±åƒä¸‹é¢è¿™ä¸²ä»£ç ã€‚â€

```java
public class StaticBlock {
    static {
        System.out.println("é™æ€ä»£ç å—");
    }

    public static void main(String[] args) {
        System.out.println("main æ–¹æ³•");
    }
}
```

â€œé™æ€ä»£ç å—é€šå¸¸ç”¨æ¥åˆå§‹åŒ–ä¸€äº›é™æ€å˜é‡ï¼Œå®ƒä¼šä¼˜å…ˆäº `main()` æ–¹æ³•æ‰§è¡Œã€‚â€


â€œæ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„è¾“å‡ºç»“æœå§ã€‚â€

```
é™æ€ä»£ç å—
main æ–¹æ³•
```

â€œäºŒå“¥ï¼Œæ—¢ç„¶é™æ€ä»£ç å—å…ˆäº `main()` æ–¹æ³•æ‰§è¡Œï¼Œé‚£æ²¡æœ‰ `main()` æ–¹æ³•çš„ Java ç±»èƒ½æ‰§è¡ŒæˆåŠŸå—ï¼Ÿâ€ä¸‰å¦¹çš„è„‘å›è·¯è¶Šæ¥è¶Šä»¤æˆ‘æ•¬ä½©äº†ã€‚

â€œJava 1.6 æ˜¯å¯ä»¥çš„ï¼Œä½† Java 7 å¼€å§‹å°±æ— æ³•æ‰§è¡Œäº†ã€‚â€æˆ‘èƒ¸æœ‰æˆç«¹åœ°å›ç­”åˆ°ã€‚

```java
public class StaticBlockNoMain {
    static {
        System.out.println("é™æ€ä»£ç å—ï¼Œæ²¡æœ‰ main");
    }
}
```

â€œåœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ `java StaticBlockNoMain` çš„æ—¶å€™ï¼Œä¼šæŠ›å‡º NoClassDefFoundError çš„é”™è¯¯ã€‚â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/keywords/19-07.png)

â€œä¸‰å¦¹ï¼Œæ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ã€‚â€

```java
public class StaticBlockDemo {
    public static List<String> writes = new ArrayList<>();

    static {
        writes.add("æ²‰é»˜ç‹äºŒ");
        writes.add("æ²‰é»˜ç‹ä¸‰");
        writes.add("æ²‰é»˜ç‹å››");

        System.out.println("ç¬¬ä¸€å—");
    }

    static {
        writes.add("æ²‰é»˜ç‹äº”");
        writes.add("æ²‰é»˜ç‹å…­");

        System.out.println("ç¬¬äºŒå—");
    }
}
```

â€œwrites æ˜¯ä¸€ä¸ªé™æ€çš„ ArrayListï¼Œæ‰€ä»¥ä¸å¤ªå¯èƒ½åœ¨å£°æ˜çš„æ—¶å€™å®Œæˆåˆå§‹åŒ–ï¼Œå› æ­¤éœ€è¦åœ¨é™æ€ä»£ç å—ä¸­å®Œæˆåˆå§‹åŒ–ã€‚â€

â€œé™æ€ä»£ç å—åœ¨åˆå§‹é›†åˆçš„æ—¶å€™ï¼ŒçœŸçš„éå¸¸æœ‰ç”¨ã€‚åœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œé€šå¸¸ä½¿ç”¨é™æ€ä»£ç å—æ¥åŠ è½½é…ç½®æ–‡ä»¶åˆ°å†…å­˜å½“ä¸­ã€‚â€

### 04ã€é™æ€å†…éƒ¨ç±»

â€œä¸‰å¦¹å•Šï¼Œé™¤äº†ä»¥ä¸Šåªå†™ï¼Œstatic è¿˜æœ‰ä¸€ä¸ªä¸å¤ªå¸¸ç”¨çš„åŠŸèƒ½â€”â€”é™æ€å†…éƒ¨ç±»ã€‚â€

â€œJava å…è®¸æˆ‘ä»¬åœ¨ä¸€ä¸ªç±»ä¸­å£°æ˜ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œå®ƒæä¾›äº†ä¸€ç§ä»¤äººä¿¡æœçš„æ–¹å¼ï¼Œå…è®¸æˆ‘ä»¬åªåœ¨ä¸€ä¸ªåœ°æ–¹ä½¿ç”¨ä¸€äº›å˜é‡ï¼Œä½¿ä»£ç æ›´å…·æœ‰æ¡ç†æ€§å’Œå¯è¯»æ€§ã€‚â€

â€œå¸¸è§çš„å†…éƒ¨ç±»æœ‰å››ç§ï¼Œæˆå‘˜å†…éƒ¨ç±»ã€å±€éƒ¨å†…éƒ¨ç±»ã€åŒ¿åå†…éƒ¨ç±»å’Œé™æ€å†…éƒ¨ç±»ï¼Œé™äºç¯‡å¹…åŸå› ï¼Œå‰ä¸‰ç§ä¸åœ¨æˆ‘ä»¬æœ¬æ¬¡çš„è®¨è®ºèŒƒå›´ä¹‹å†…ï¼Œä»¥åæœ‰æœºä¼šå†ç»†è¯´ã€‚â€

â€œæ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ã€‚â€ä¸‰å¦¹æœ‰ç‚¹èµ°ç¥ï¼Œæˆ‘æ•²äº†æ•²å¥¹çš„è„‘è¢‹åç»§ç»­è¯´ã€‚

```java
public class Singleton {
    private Singleton() {}

    private static class SingletonHolder {
        public static final Singleton instance = new Singleton();
    }

    public static Singleton getInstance() {
        return SingletonHolder.instance;
    }
}
```

â€œä¸‰å¦¹ï¼Œæ‰“èµ·ç²¾ç¥ï¼Œé©¬ä¸Šå°±ç»“æŸäº†ã€‚â€

â€œå“¦å“¦ï¼Œè¿™æ®µä»£ç çœ‹èµ·æ¥å¾ˆåˆ«è‡´å•Šï¼Œå“¥ã€‚â€

â€œæ˜¯çš„ï¼Œä¸‰å¦¹ï¼Œè¿™æ®µä»£ç åœ¨ä»¥ååˆ›å»ºå•ä¾‹çš„æ—¶å€™è¿˜ä¼šè§åˆ°ã€‚â€

â€œç¬¬ä¸€æ¬¡åŠ è½½ Singleton ç±»æ—¶å¹¶ä¸ä¼šåˆå§‹åŒ– instanceï¼Œåªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨ `getInstance()` æ–¹æ³•æ—¶ Java è™šæ‹Ÿæœºæ‰å¼€å§‹åŠ è½½ SingletonHolder å¹¶åˆå§‹åŒ– instanceï¼Œè¿™æ ·ä¸ä»…èƒ½ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œä¹Ÿèƒ½ä¿è¯ Singleton ç±»çš„å”¯ä¸€æ€§ã€‚ä¸è¿‡ï¼Œåˆ›å»ºå•ä¾‹æ›´ä¼˜é›…çš„ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨æšä¸¾ï¼Œä»¥åå†è®²ç»™ä½ å¬ã€‚â€

â€œéœ€è¦æ³¨æ„çš„æ˜¯ã€‚ç¬¬ä¸€ï¼Œé™æ€å†…éƒ¨ç±»ä¸èƒ½è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼›ç¬¬äºŒï¼Œé™æ€å†…éƒ¨ç±»å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰é™æ€å˜é‡ï¼ŒåŒ…æ‹¬ç§æœ‰é™æ€å˜é‡ã€‚ç¬¬ä¸‰ï¼Œå¤–éƒ¨ç±»ä¸èƒ½å£°æ˜ä¸º staticã€‚â€

â€œä¸‰å¦¹ï¼Œä½ çœ‹ï¼Œåœ¨ Singleton ç±»ä¸ŠåŠ  static åï¼Œç¼–è¯‘å™¨å°±æç¤ºé”™è¯¯äº†ã€‚â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/keywords/19-08.png)

ä¸‰å¦¹ç‚¹äº†ç‚¹å¤´ï¼Œæ‰€æœ‰æ‰€æ€ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 5.16 Java finalå…³é”®å­—

â€œå“¥ï¼Œä»Šå¤©å­¦ä»€ä¹ˆå‘¢ï¼Ÿâ€

â€œä»Šå¤©å­¦ä¸€ä¸ªé‡è¦çš„å…³é”®å­—â€”â€”finalã€‚ â€æˆ‘é¢å¸¦ç€æœ´å®æ— åçš„å¾®ç¬‘å›ç­”ç€å¥¹ï¼Œâ€œå¯¹äº†ï¼Œä¸‰å¦¹ï¼Œä½ æ‰“ç®—è€ƒç ”å—ï¼Ÿâ€

â€œè¿˜æ²¡æƒ³è¿‡ï¼Œæˆ‘ä»Šå¹´æ‰å¤§ä¸€å‘¢ï¼Œåˆ°æ—¶å€™å†è¯´å§ï¼Œä½ å†³å®šã€‚â€

â€œå¥½å§ã€‚â€æˆ‘æ‘Šæ‘Šæ‰‹ï¼Œè¡¨ç¤ºå¾ˆæ— è¾œï¼ŒçœŸçš„æ˜¯æ‰€æœ‰çš„å†³å®šéƒ½äº¤ç»™æˆ‘è¿™ä¸ªå“¥å“¥äº†ï¼Œå¦‚æœå†³å®šé”™äº†ï¼Œé”…å¾—èƒŒä¸Šã€‚

### 01ã€final å˜é‡

â€œå¥½äº†ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ final ä¿®é¥°çš„å˜é‡å§ï¼â€

â€œè¢« final ä¿®é¥°çš„å˜é‡æ— æ³•é‡æ–°èµ‹å€¼ã€‚æ¢å¥è¯è¯´ï¼Œfinal å˜é‡ä¸€æ—¦åˆå§‹åŒ–ï¼Œå°±æ— æ³•æ›´æ”¹ã€‚â€

â€œæ¥çœ‹è¿™è¡Œä»£ç ã€‚â€

```java
final int age = 18;
```

â€œå½“å°è¯•å°† age çš„å€¼ä¿®æ”¹ä¸º 30 çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨å°±ç”Ÿæ°”äº†ã€‚â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/keywords/23-01.png)

â€œå†æ¥çœ‹è¿™æ®µä»£ç ã€‚â€

```java
public class Pig {
   private String name;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}
```

â€œè¿™æ˜¯ä¸€ä¸ªå¾ˆæ™®é€šçš„ Java ç±»ï¼Œå®ƒæœ‰ä¸€ä¸ªå­—æ®µ nameã€‚â€

â€œç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±»ï¼Œå¹¶å£°æ˜ä¸€ä¸ª final ä¿®é¥°çš„ Pig å¯¹è±¡ã€‚â€

```java
final Pig pig = new Pig();
```

â€œå¦‚æœå°è¯•å°† pig é‡æ–°èµ‹å€¼çš„è¯ï¼Œç¼–è¯‘å™¨åŒæ ·ä¼šç”Ÿæ°”ã€‚â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/keywords/23-02.png)

â€œä½†æˆ‘ä»¬ä»ç„¶å¯ä»¥å»ä¿®æ”¹ pig å¯¹è±¡çš„ nameã€‚â€

```java
final Pig pig = new Pig();
pig.setName("ç‰¹ç«‹ç‹¬è¡Œ");
System.out.println(pig.getName()); // ç‰¹ç«‹ç‹¬è¡Œ
```

â€œå¦å¤–ï¼Œfinal ä¿®é¥°çš„æˆå‘˜å˜é‡å¿…é¡»æœ‰ä¸€ä¸ªé»˜è®¤å€¼ï¼Œå¦åˆ™ç¼–è¯‘å™¨å°†ä¼šæé†’æ²¡æœ‰åˆå§‹åŒ–ã€‚â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/keywords/23-03.png)

â€œfinal å’Œ static ä¸€èµ·ä¿®é¥°çš„æˆå‘˜å˜é‡å«åšå¸¸é‡ï¼Œå¸¸é‡åå¿…é¡»å…¨éƒ¨å¤§å†™ã€‚â€

```java
public class Pig {
   private final int age = 1;
   public static final double PRICE = 36.5;
}
```

â€œæœ‰æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜ä¼šç”¨ final å…³é”®å­—æ¥ä¿®é¥°å‚æ•°ï¼Œå®ƒæ„å‘³ç€å‚æ•°åœ¨æ–¹æ³•ä½“å†…ä¸èƒ½è¢«å†ä¿®æ”¹ã€‚â€

â€œæ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ã€‚â€

```java
public class ArgFinalTest {
    public void arg(final int age) {
    }

    public void arg1(final String name) {
    }
}
```

â€œå¦‚æœå°è¯•å»ä¿®æ”¹å®ƒçš„è¯ï¼Œç¼–è¯‘å™¨ä¼šæç¤ºä»¥ä¸‹é”™è¯¯ã€‚â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/keywords/23-04.png)

### 02ã€final æ–¹æ³•

â€œè¢« final ä¿®é¥°çš„æ–¹æ³•ä¸èƒ½è¢«é‡å†™ã€‚å¦‚æœæˆ‘ä»¬åœ¨è®¾è®¡ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œè®¤ä¸ºæŸäº›æ–¹æ³•ä¸åº”è¯¥è¢«é‡å†™ï¼Œå°±åº”è¯¥æŠŠå®ƒè®¾è®¡æˆ final çš„ã€‚â€

â€œThread ç±»å°±æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå®ƒæœ¬èº«ä¸æ˜¯ final çš„ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æ‰©å±•å®ƒï¼Œä½†å®ƒçš„ `isAlive()` æ–¹æ³•æ˜¯ final çš„ã€‚â€

```java
public class Thread implements Runnable {
    public final native boolean isAlive();
}
```
â€œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªæœ¬åœ°ï¼ˆnativeï¼‰æ–¹æ³•ï¼Œç”¨äºç¡®è®¤çº¿ç¨‹æ˜¯å¦å¤„äºæ´»è·ƒçŠ¶æ€ã€‚è€Œæœ¬åœ°æ–¹æ³•æ˜¯ç”±æ“ä½œç³»ç»Ÿå†³å®šçš„ï¼Œå› æ­¤é‡å†™è¯¥æ–¹æ³•å¹¶ä¸å®¹æ˜“å®ç°ã€‚â€

â€œæ¥çœ‹è¿™æ®µä»£ç ã€‚â€

```java
public class Actor {
    public final void show() {

    }
}
```

â€œå½“æˆ‘ä»¬æƒ³è¦é‡å†™è¯¥æ–¹æ³•çš„è¯ï¼Œå°±ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ã€‚â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/keywords/23-05.png)


â€œä¸‰å¦¹ï¼Œæ¥é—®ä½ ä¸€ä¸ªé—®é¢˜å§ã€‚â€æ­£æƒ³è¶ä¸‰å¦¹å›ç­”é—®é¢˜çš„æ—¶å€™å–å£æ°´ã€‚

â€œä½ è¯´å§ï¼Œå“¥ã€‚â€

â€œä¸€ä¸ªç±»æ˜¯ final çš„ï¼Œå’Œä¸€ä¸ªç±»ä¸æ˜¯ finalï¼Œä½†å®ƒæ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯ final çš„ï¼Œè€ƒè™‘ä¸€ä¸‹ï¼Œå®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿâ€

â€œæˆ‘èƒ½æƒ³åˆ°çš„ä¸€ç‚¹ï¼Œå°±æ˜¯å‰è€…ä¸èƒ½è¢«[ç»§æ‰¿](https://tobebetterjavaer.com/oo/extends-bigsai.html)ï¼Œä¹Ÿå°±æ˜¯è¯´æ–¹æ³•æ— æ³•è¢«é‡å†™ï¼›åè€…å‘¢ï¼Œå¯ä»¥è¢«ç»§æ‰¿ï¼Œç„¶åè¿½åŠ ä¸€äº›é final çš„æ–¹æ³•ã€‚â€è¿˜æ²¡ç­‰æˆ‘æŠŠæ°´å’½ä¸‹å»ï¼Œä¸‰å¦¹å°±å›ç­”å¥½äº†ï¼Œç€å®æƒŠå‘†äº†æˆ‘ã€‚

â€œå—¯å—¯å—¯ï¼Œæ²¡æ¯›ç—…æ²¡æ¯›ç—…ï¼Œè¿›æ­¥å¾ˆå¤§å•Šï¼â€

â€œé‚£å¿…é¡»å•Šï¼Œè°å«æˆ‘æ˜¯ä½ å¦¹å‘¢ã€‚â€

### 03ã€final ç±»

â€œå¦‚æœä¸€ä¸ªç±»ä½¿ç”¨äº† final å…³é”®å­—ä¿®é¥°ï¼Œé‚£ä¹ˆå®ƒå°±æ— æ³•è¢«ç»§æ‰¿.....â€

â€œç­‰ç­‰ï¼Œå“¥ï¼Œæˆ‘çŸ¥é“ï¼ŒString ç±»å°±æ˜¯ä¸€ä¸ª final ç±»ã€‚â€è¿˜æ²¡ç­‰æˆ‘è¯´å®Œï¼Œä¸‰å¦¹å°±æŠ¢ç€è¯´åˆ°ã€‚

â€œè¯´å¾—æ²¡æ¯›ç—…ã€‚â€

```java
public final class String
    implements java.io.Serializable, Comparable<String>, CharSequence,
               Constable, ConstantDesc {}
```

â€œé‚£ä¸‰å¦¹ä½ çŸ¥é“ä¸ºä»€ä¹ˆ String ç±»è¦è®¾è®¡æˆ final å—ï¼Ÿâ€

â€œè¿™ä¸ªè¿˜çœŸä¸çŸ¥é“ã€‚â€ä¸‰å¦¹çš„è¡¨æƒ…é€éœ²å‡ºè¿™ç§æ— å¥ˆã€‚

â€œåŸå› å¤§è‡´æœ‰ 3 ä¸ªã€‚â€

- ä¸ºäº†å®ç°å­—ç¬¦ä¸²å¸¸é‡æ± 
- ä¸ºäº†çº¿ç¨‹å®‰å…¨
- ä¸ºäº† HashCode çš„ä¸å¯å˜æ€§

â€œæƒ³äº†è§£æ›´è¯¦ç»†çš„åŸå› ï¼Œå¯ä»¥ä¸€ä¼šçœ‹çœ‹æˆ‘ä¹‹å‰å†™çš„è¿™ç¯‡æ–‡ç« ã€‚â€

[ä¸ºä»€ä¹ˆ Java å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Ÿ](https://tobebetterjavaer.com/string/immutable.html)

â€œä»»ä½•å°è¯•ä» final ç±»ç»§æ‰¿çš„è¡Œä¸ºå°†ä¼šå¼•å‘ç¼–è¯‘é”™è¯¯ã€‚æ¥çœ‹è¿™æ®µä»£ç ã€‚â€

```java
public final class Writer {
    private String name;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}
```

â€œå°è¯•å»ç»§æ‰¿å®ƒï¼Œç¼–è¯‘å™¨ä¼šæç¤ºä»¥ä¸‹é”™è¯¯ï¼ŒWriter ç±»æ˜¯ final çš„ï¼Œæ— æ³•ç»§æ‰¿ã€‚â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/keywords/23-06.png)

â€œä¸è¿‡ï¼Œç±»æ˜¯ final çš„ï¼Œå¹¶ä¸æ„å‘³ç€è¯¥ç±»çš„å¯¹è±¡æ˜¯ä¸å¯å˜çš„ã€‚â€

â€œæ¥çœ‹è¿™æ®µä»£ç ã€‚â€

```java
Writer writer = new Writer();
writer.setName("æ²‰é»˜ç‹äºŒ");
System.out.println(writer.getName()); // æ²‰é»˜ç‹äºŒ
```

â€œWriter çš„ name å­—æ®µçš„é»˜è®¤å€¼æ˜¯ nullï¼Œä½†å¯ä»¥é€šè¿‡ settter æ–¹æ³•å°†å…¶æ›´æ”¹ä¸ºæ²‰é»˜ç‹äºŒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªç±»åªæ˜¯ final çš„ï¼Œé‚£ä¹ˆå®ƒå¹¶ä¸æ˜¯ä¸å¯å˜çš„å…¨éƒ¨æ¡ä»¶ã€‚â€

â€œå…³äºä¸å¯å˜ç±»ï¼Œæˆ‘ä»¬ç•™åˆ°åé¢æ¥ç»†è®²ã€‚â€

[ä¸å¯å˜ç±»](https://tobebetterjavaer.com/basic-extra-meal/immutable.html)

â€œæŠŠä¸€ä¸ªç±»è®¾è®¡æˆ final çš„ï¼Œæœ‰å…¶å®‰å…¨æ–¹é¢çš„è€ƒè™‘ï¼Œä½†ä¸åº”è¯¥æ•…æ„ä¸ºä¹‹ï¼Œå› ä¸ºæŠŠä¸€ä¸ªç±»å®šä¹‰æˆ final çš„ï¼Œæ„å‘³ç€å®ƒæ²¡åŠæ³•ç»§æ‰¿ï¼Œå‡å¦‚è¿™ä¸ªç±»çš„ä¸€äº›æ–¹æ³•å­˜åœ¨ä¸€äº›é—®é¢˜çš„è¯ï¼Œæˆ‘ä»¬å°±æ— æ³•é€šè¿‡é‡å†™çš„æ–¹å¼å»ä¿®å¤å®ƒã€‚â€

â€œä¸‰å¦¹ï¼Œfinal å…³é”®å­—æˆ‘ä»¬å°±å­¦åˆ°è¿™é‡Œå§ï¼Œä½ ä¸€ä¼šå†å­¦ä¹ ä¸€ä¸‹ Java å­—ç¬¦ä¸²ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„å’Œä¸å¯å˜ç±»ã€‚â€æˆ‘æ‰ä¸€æ‰çŠ¯å›°çš„åŒçœ¼ï¼Œç–²æƒ«åœ°ç»™ä¸‰å¦¹è¯´ï¼Œâ€œå­¦å®Œè¿™ä¸¤ä¸ªçŸ¥è¯†ç‚¹ï¼Œä½ ä¼šå¯¹ final çš„è®¤çŸ¥æ›´æ¸…æ™°ä¸€äº›ã€‚â€

â€œå¥½çš„ï¼ŒäºŒå“¥ï¼Œæˆ‘è¿™å°±å»å­¦ä¹ å»ã€‚ä½ å»ä¼‘æ¯ä¼šã€‚â€

æˆ‘èµ·èº«ç«™åˆ°é˜³å°ä¸Šï¼Œçœ‹ç€çª—å¤–çš„è½¦æ°´é©¬é¾™ï¼Œä¸ä¸€ä¼šå„¿ï¼Œå°±å‘èµ·æ¥å‘†ã€‚

â€œå¥½æƒ³å»å†çœ‹ä¸€åœºå‘¨æ°ä¼¦çš„æ¼”å”±ä¼šï¼Œä¸çŸ¥é“ 2021 æœ‰æ²¡æœ‰è¿™ä¸ªæœºä¼šã€‚â€

æˆ‘å¿ƒé‡Œè¿™æ ·æƒ³ç€ï¼Œå¤©æ¸æ¸åœ°æš—äº†ä¸‹æ¥ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 5.17 Java instanceofå…³é”®å­—

â€œä¸‰å¦¹ï¼Œä»Šå¤©æˆ‘ä»¬æ¥è¿‡ä¸€ä¸ªéå¸¸ç®€å•çš„çŸ¥è¯†ç‚¹ï¼Œinstanceofå…³é”®å­—ã€‚â€

â€œç”¨ä¸ç€å“¥ä½ æ¥è®²äº†ï¼Œä»Šå¤©å°±æ¢ä¸ªå½¢å¼ï¼Œæˆ‘æ¥è®²ç»™ä½ å¬ã€‚â€ä¸‰å¦¹é›„èµ³èµ³æ°”æ˜‚æ˜‚åœ°è¯´ã€‚

instanceof å…³é”®å­—çš„ç”¨æ³•å…¶å®å¾ˆç®€å•ï¼š

```java
(object) instanceof (type)
```

ç”¨æ„ä¹Ÿéå¸¸ç®€å•ï¼Œåˆ¤æ–­å¯¹è±¡æ˜¯å¦ç¬¦åˆæŒ‡å®šçš„ç±»å‹ï¼Œç»“æœè¦ä¹ˆæ˜¯ trueï¼Œè¦ä¹ˆæ˜¯ falseã€‚åœ¨[ååºåˆ—åŒ–](https://tobebetterjavaer.com/io/serialize.html)çš„æ—¶å€™ï¼Œinstanceof æ“ä½œç¬¦è¿˜æ˜¯è›®å¸¸ç”¨çš„ï¼Œå› ä¸ºè¿™æ—¶å€™æˆ‘ä»¬ä¸å¤ªç¡®å®šå¯¹è±¡å±ä¸å±äºæŒ‡å®šçš„ç±»å‹ï¼Œå¦‚æœä¸è¿›è¡Œåˆ¤æ–­çš„è¯ï¼Œå°±å®¹æ˜“æŠ›å‡º ClassCastException å¼‚å¸¸ã€‚

æˆ‘ä»¬æ¥å»ºè¿™æ ·ä¸€ä¸ªç®€å•çš„ç±» Roundï¼š

```java
class Round {
}
```

ç„¶åæ–°å¢ä¸€ä¸ªæ‰©å±•ç±» Ringï¼š

```java
class Ring extends Round {
}
```

è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ instanceof æ¥æ£€æŸ¥ Ring å¯¹è±¡æ˜¯å¦å±äº Round ç±»å‹ã€‚

```java
Ring ring = new Ring();
System.out.println(ring instanceof Round);
```

ç»“æœä¼šè¾“å‡º trueï¼Œå› ä¸º Ring ç»§æ‰¿äº† Roundï¼Œä¹Ÿå°±æ„å‘³ç€ Ring å’Œ Round ç¬¦åˆ ` is-a` çš„å…³ç³»ï¼Œè€Œ instanceof æ“ä½œç¬¦æ­£æ˜¯åŸºäºç±»ä¸ç±»ä¹‹é—´çš„ç»§æ‰¿å…³ç³»ï¼Œä»¥åŠç±»ä¸æ¥å£ä¹‹é—´çš„å®ç°å…³ç³»çš„ã€‚

æˆ‘ä»¬å†æ¥æ–°å»ºä¸€ä¸ªæ¥å£ Shapeï¼š

```java
interface Shape {
}
```

ç„¶åæ–°å»º Circle ç±»å®ç° Shape æ¥å£å¹¶ç»§æ‰¿ Round ç±»ï¼š

```java
class Circle extends Round implements Shape {
}
```

å¦‚æœå¯¹è±¡æ˜¯ç”±è¯¥ç±»åˆ›å»ºçš„ï¼Œé‚£ä¹ˆ instanceof çš„ç»“æœè‚¯å®šä¸º trueã€‚

```java
Circle circle = new Circle();
System.out.println(circle instanceof Circle);
```

è¿™ä¸ªè‚¯å®šæ²¡æ¯›ç—…ï¼Œinstanceof å°±æ˜¯å¹²è¿™ä¸ªæ´»çš„ï¼Œå¤§å®¶ä¹Ÿå¾ˆå¥½ç†è§£ã€‚é‚£å¦‚æœç±»å‹æ˜¯çˆ¶ç±»å‘¢ï¼Ÿ

```java
System.out.println(circle instanceof Round);
```

ç»“æœè‚¯å®šè¿˜æ˜¯ trueï¼Œå› ä¸ºä¾ç„¶ç¬¦åˆ `is-a` çš„å…³ç³»ã€‚é‚£å¦‚æœç±»å‹ä¸ºæ¥å£å‘¢ï¼Ÿ

```java
System.out.println(circle instanceof Shape);
```

ç»“æœä»ç„¶ä¸º trueï¼Œ å› ä¸ºä¹Ÿç¬¦åˆ `is-a` çš„å…³ç³»ã€‚å¦‚æœè¦æ¯”è¾ƒçš„å¯¹è±¡å’Œè¦æ¯”è¾ƒçš„ç±»å‹ä¹‹é—´æ²¡æœ‰å…³ç³»ï¼Œå½“ç„¶æ˜¯ä¸èƒ½ä½¿ç”¨ instanceof è¿›è¡Œæ¯”è¾ƒçš„ã€‚

ä¸ºäº†éªŒè¯è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªå®ç°äº† Shape ä½†ä¸ Circle æ— å…³çš„ Triangle ç±»ï¼š

``` java
class Triangle implements Shape {
}
```

è¿™æ—¶å€™ï¼Œå†ä½¿ç”¨ instanceof è¿›è¡Œæ¯”è¾ƒçš„è¯ï¼Œç¼–è¯‘å™¨å°±æŠ¥é”™äº†ã€‚

```java
 System.out.println(circle instanceof Triangle);
```

é”™è¯¯ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºï¼š

```
Inconvertible types; cannot cast 'com.itwanger.twentyfour.instanceof1.Circle' to 'com.itwanger.twentyfour.instanceof1.Triangle'
```

æ„æ€å°±æ˜¯ç±»å‹ä¸åŒ¹é…ï¼Œä¸èƒ½è½¬æ¢ï¼Œæˆ‘ä»¬ä½¿ç”¨ instanceof æ¯”è¾ƒçš„ç›®çš„ï¼Œä¹Ÿå°±æ˜¯å¸Œæœ›å¦‚æœç»“æœä¸º true çš„æ—¶å€™èƒ½è¿›è¡Œç±»å‹è½¬æ¢ã€‚ä½†æ˜¾ç„¶ Circle ä¸èƒ½è½¬ä¸º Triangleã€‚

ç¼–è¯‘å™¨å·²ç»æå‰å¸®æˆ‘ä»¬é¢„çŸ¥äº†ï¼Œå¾ˆèªæ˜ã€‚

Java æ˜¯ä¸€é—¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ï¼Œä¹Ÿå°±æ„å‘³ç€é™¤äº†åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ‰€æœ‰çš„ç±»éƒ½ä¼šéšå¼ç»§æ‰¿ Object ç±»ã€‚æ‰€ä»¥ä¸‹é¢çš„ç»“æœè‚¯å®šä¹Ÿä¼šè¾“å‡º trueã€‚

```java
Thread thread = new Thread();
System.out.println(thread instanceof Object);
```

â€œé‚£å¦‚æœå¯¹è±¡ä¸º null å‘¢ï¼Ÿâ€æˆ‘è¿™æ—¶å€™æ’è¯äº†ã€‚

â€œè¿™ä¸ªè¿˜çœŸçš„æ˜¯ä¸€ä¸ªå¥½é—®é¢˜å•Šã€‚â€ä¸‰å¦¹å¿ä¸ä½å¯¹æˆ‘ç«–äº†ä¸€ä¸ªå¤§æ‹‡æŒ‡ã€‚

```java
System.out.println(null instanceof Object);
```

åªæœ‰å¯¹è±¡æ‰ä¼šæœ‰ null å€¼ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨æ˜¯ä¸ä¼šæŠ¥é”™çš„ï¼Œåªä¸è¿‡ï¼Œå¯¹äº null æ¥è¯´ï¼Œinstanceof çš„ç»“æœä¸º falseã€‚å› ä¸ºæ‰€æœ‰çš„å¯¹è±¡éƒ½å¯ä»¥ä¸º nullï¼Œæ‰€ä»¥ä¹Ÿä¸å¥½ç¡®å®š null åˆ°åº•å±äºå“ªä¸€ä¸ªç±»ã€‚

é€šå¸¸ï¼Œæˆ‘ä»¬æ˜¯è¿™æ ·ä½¿ç”¨ instanceof æ“ä½œç¬¦çš„ã€‚

```java
// å…ˆåˆ¤æ–­ç±»å‹
if (obj instanceof String) {
    // ç„¶åå¼ºåˆ¶è½¬æ¢
    String s = (String) obj;
    // ç„¶åæ‰èƒ½ä½¿ç”¨
}
```

å…ˆç”¨ instanceof è¿›è¡Œç±»å‹åˆ¤æ–­ï¼Œç„¶åå†æŠŠ obj å¼ºåˆ¶è½¬æ¢æˆæˆ‘ä»¬æœŸæœ›çš„ç±»å‹å†è¿›è¡Œä½¿ç”¨ã€‚

JDK 16 çš„æ—¶å€™ï¼Œinstanceof æ¨¡å¼åŒ¹é…è½¬äº†æ­£ï¼Œæ„å‘³ç€ä½¿ç”¨ instanceof çš„æ—¶å€™æ›´ä¾¿æ·äº†ã€‚

```java
if (obj instanceof String s) {
    // å¦‚æœç±»å‹åŒ¹é… ç›´æ¥ä½¿ç”¨ s
}
```

å¯ä»¥ç›´æ¥åœ¨ if æ¡ä»¶åˆ¤æ–­ç±»å‹çš„æ—¶å€™æ·»åŠ ä¸€ä¸ªå˜é‡ï¼Œå°±ä¸éœ€è¦å†å¼ºè½¬å’Œå£°æ˜æ–°çš„å˜é‡äº†ã€‚

â€œå“‡ï¼Œè¿™æ ·å°±ç®€æ´äº†å‘€ï¼â€ä¸ºäº†é…åˆä¸‰å¦¹ï¼Œæˆ‘ä¸ä»…æƒŠå¹åˆ°ï¼

â€œå¥½äº†ï¼Œå…³äº instanceof æ“ä½œç¬¦æˆ‘ä»¬å°±å…ˆè®²åˆ°è¿™å§ï¼Œéš¾æ˜¯ä¸€ç‚¹éƒ½ä¸éš¾ï¼Œå¸Œæœ›å“¥ä¹Ÿèƒ½å¤Ÿå¾ˆå¥½çš„æŒæ¡ã€‚â€ä¸‰å¦¹ç¬‘å˜»å˜»åœ°è¯´ï¼Œçœ‹æ¥å¥¹å¾ˆäº«å—è¿™ä¸ªè®²çš„è¿‡ç¨‹å˜›ã€‚


----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 5.18 Javaä¸å¯å˜å¯¹è±¡

â€œäºŒå“¥ï¼Œä½ èƒ½ç»™æˆ‘è¯´è¯´ä¸ºä»€ä¹ˆ String æ˜¯ immutable ç±»ï¼ˆä¸å¯å˜å¯¹è±¡ï¼‰å—ï¼Ÿæˆ‘æƒ³ç ”ç©¶å®ƒï¼Œæƒ³çŸ¥é“ä¸ºä»€ä¹ˆå®ƒå°±ä¸å¯å˜äº†ï¼Œè¿™ç§å¼ºçƒˆçš„æ„¿æœ›å°±åƒæƒ³ç ”ç©¶æµ©ç€šçš„æ˜Ÿç©ºä¸€æ ·ã€‚ä½†æ— å¥ˆè‡ªèº«åŠŸåŠ›æœ‰é™ï¼Œå§‹ç»ˆè§‰å¾—é›¾é‡Œçœ‹èŠ±ç»ˆéš”ä¸€å±‚ã€‚â€ä¸‰å¦¹çš„è¿™å¥è¯é‡Œæ»¡æ˜¯å½©è™¹å±çš„å‘³é“ã€‚

â€œæ—¢ç„¶ä¸‰å¦¹ä½ è¯´è¯è¿™ä¹ˆå¥½å¬ï¼Œé‚£æˆ‘ä»¬å°±å¼€å§‹å§ï¼â€æˆ‘æ„‰å¿«çš„å¿ƒæƒ…å°±å¥½åƒåƒäº†ä¸¤ç½èœ‚èœœä¸€æ ·ï¼ˆğŸ˜‚ï¼‰ã€‚

### 01ã€ä»€ä¹ˆæ˜¯ä¸å¯å˜ç±»

ä¸€ä¸ªç±»çš„å¯¹è±¡åœ¨é€šè¿‡æ„é€ æ–¹æ³•åˆ›å»ºåå¦‚æœçŠ¶æ€ä¸ä¼šå†è¢«æ”¹å˜ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªä¸å¯å˜ï¼ˆimmutableï¼‰ç±»ã€‚å®ƒçš„æ‰€æœ‰æˆå‘˜å˜é‡çš„èµ‹å€¼ä»…åœ¨æ„é€ æ–¹æ³•ä¸­å®Œæˆï¼Œä¸ä¼šæä¾›ä»»ä½• setter æ–¹æ³•ä¾›å¤–éƒ¨ç±»å»ä¿®æ”¹ã€‚

è¿˜è®°å¾—ã€Šç¥é›•ä¾ ä¾£ã€‹ä¸­å°é¾™å¥³çš„å¤å¢“å—ï¼Ÿéšç€é‚£ä¸€å£°å·¨å“ï¼Œä»…æœ‰çš„é€šé“å°±è¢«æ— æƒ…åœ°å…³é—­äº†ã€‚åˆ«è¾ƒçœŸé‚£ä¸ªå¯†é“ï¼Œæˆ‘è¿™ä¹ˆè¯´åªæ˜¯ä¸ºäº†æ‰“å¼€ä½ çš„æƒ³è±¡åŠ›ï¼Œè®©ä½ å¯¹ä¸å¯å˜ç±»æœ‰ä¸€ä¸ªæ›´ç›´è§‚çš„å°è±¡ã€‚

è‡ªä»æœ‰äº†å¤šçº¿ç¨‹ï¼Œç”Ÿäº§åŠ›å°±è¢«æ— é™åœ°æ”¾å¤§äº†ï¼Œæ‰€æœ‰çš„ç¨‹åºå‘˜éƒ½çˆ±å®ƒï¼Œå› ä¸ºå¼ºå¤§çš„ç¡¬ä»¶èƒ½åŠ›è¢«å……åˆ†åœ°åˆ©ç”¨äº†ã€‚ä½†ä¸æ­¤åŒæ—¶ï¼Œæ‰€æœ‰çš„ç¨‹åºå‘˜éƒ½å¯¹å®ƒå¿ƒç”Ÿå¿Œæƒ®ï¼Œå› ä¸ºä¸€ä¸å°å¿ƒï¼Œå¤šçº¿ç¨‹å°±ä¼šæŠŠå¯¹è±¡çš„çŠ¶æ€å˜å¾—æ··ä¹±ä¸å ªã€‚

ä¸ºäº†ä¿æŠ¤çŠ¶æ€çš„åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§ï¼Œæˆ‘ä»¬ç¨‹åºå‘˜å¯ä»¥è¯´æ˜¯ç«­å°½æ‰€èƒ½ã€‚å…¶ä¸­ï¼Œsynchronizedï¼ˆåŒæ­¥ï¼‰å…³é”®å­—æ˜¯æœ€ç®€å•æœ€å…¥é—¨çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚

å‡å¦‚è¯´ç±»æ˜¯ä¸å¯å˜çš„ï¼Œé‚£ä¹ˆå¯¹è±¡çš„çŠ¶æ€å°±ä¹Ÿæ˜¯ä¸å¯å˜çš„ã€‚è¿™æ ·çš„è¯ï¼Œæ¯æ¬¡ä¿®æ”¹å¯¹è±¡çš„çŠ¶æ€ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å¯¹è±¡ä¾›ä¸åŒçš„çº¿ç¨‹ä½¿ç”¨ï¼Œæˆ‘ä»¬ç¨‹åºå‘˜å°±ä¸å¿…å†æ‹…å¿ƒå¹¶å‘é—®é¢˜äº†ã€‚

### 02ã€å¸¸è§çš„ä¸å¯å˜ç±»

æåˆ°ä¸å¯å˜ç±»ï¼Œå‡ ä¹æ‰€æœ‰çš„ç¨‹åºå‘˜ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„ï¼Œå°±æ˜¯ String ç±»ã€‚é‚£ä¸ºä»€ä¹ˆ String ç±»è¦è¢«è®¾è®¡æˆä¸å¯å˜çš„å‘¢ï¼Ÿ

#### 1ï¼‰å¸¸é‡æ± çš„éœ€è¦

[å­—ç¬¦ä¸²å¸¸é‡æ± ](https://tobebetterjavaer.com/string/constant-pool.html)æ˜¯ Java å †å†…å­˜ä¸­ä¸€ä¸ªç‰¹æ®Šçš„å­˜å‚¨åŒºåŸŸï¼Œå½“åˆ›å»ºä¸€ä¸ª String å¯¹è±¡æ—¶ï¼Œå‡å¦‚æ­¤å­—ç¬¦ä¸²åœ¨å¸¸é‡æ± ä¸­ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ªï¼›å‡å¦‚å·²ç»å­˜ï¼Œå°±ä¸ä¼šå†åˆ›å»ºäº†ï¼Œè€Œæ˜¯ç›´æ¥å¼•ç”¨å·²ç»å­˜åœ¨çš„å¯¹è±¡ã€‚è¿™æ ·åšèƒ½å¤Ÿå‡å°‘ JVM çš„å†…å­˜å¼€é”€ï¼Œæé«˜æ•ˆç‡ã€‚

#### 2ï¼‰hashCode éœ€è¦

å› ä¸ºå­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œæ‰€ä»¥åœ¨å®ƒåˆ›å»ºçš„æ—¶å€™ï¼Œå…¶ hashCode å°±è¢«ç¼“å­˜äº†ï¼Œå› æ­¤éå¸¸é€‚åˆä½œä¸ºå“ˆå¸Œå€¼ï¼ˆæ¯”å¦‚è¯´ä½œä¸º [HashMap](https://tobebetterjavaer.com/collection/hashmap.html) çš„é”®ï¼‰ï¼Œå¤šæ¬¡è°ƒç”¨åªè¿”å›åŒä¸€ä¸ªå€¼ï¼Œæ¥æé«˜æ•ˆç‡ã€‚

#### 3ï¼‰çº¿ç¨‹å®‰å…¨

å°±åƒä¹‹å‰è¯´çš„é‚£æ ·ï¼Œå¦‚æœå¯¹è±¡çš„çŠ¶æ€æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå°±å¾ˆå®¹æ˜“é€ æˆä¸å¯é¢„æœŸçš„ç»“æœã€‚è€Œ String æ˜¯ä¸å¯å˜çš„ï¼Œå°±å¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«ï¼Œä¸éœ€è¦åŒæ­¥å¤„ç†ã€‚

å› æ­¤ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ String ç±»çš„ä»»ä½•æ–¹æ³•ï¼ˆæ¯”å¦‚è¯´ `trim()`ã€`substring()`ã€`toLowerCase()`ï¼‰æ—¶ï¼Œæ€»ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè€Œä¸å½±å“ä¹‹å‰çš„å€¼ã€‚

```java
String cmower = "æ²‰é»˜ç‹äºŒï¼Œä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜";
cmower.substring(0,4);
System.out.println(cmower);// æ²‰é»˜ç‹äºŒï¼Œä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜
```

è™½ç„¶è°ƒç”¨ `substring()` æ–¹æ³•å¯¹ cmower è¿›è¡Œäº†æˆªå–ï¼Œä½† cmower çš„å€¼æ²¡æœ‰æ”¹å˜ã€‚

é™¤äº† String ç±»ï¼ŒåŒ…è£…å™¨ç±» Integerã€Long ç­‰ä¹Ÿæ˜¯ä¸å¯å˜ç±»ã€‚

### 03ã€æ‰‹æ’¸ä¸€ä¸ªä¸å¯å˜ç±»

çœ‹æ‡‚ä¸€ä¸ªä¸å¯å˜ç±»ä¹Ÿè®¸å®¹æ˜“ï¼Œä½†è¦åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ä¸å¯å˜ç±»ææ€•å°±æœ‰ç‚¹éš¾äº†ã€‚ä½†çŸ¥éš¾è€Œè¿›æ˜¯æˆ‘ä»¬ä½œä¸ºä¸€åä¼˜ç§€çš„ç¨‹åºå‘˜ä¸å¯æˆ–ç¼ºçš„å“è´¨ï¼Œæ­£å› ä¸ºä¸å®¹æ˜“ï¼Œæˆ‘ä»¬æ‰èƒ½çœŸæ­£åœ°æŒæ¡å®ƒã€‚

æ¥ä¸‹æ¥ï¼Œå°±è¯·å’Œæˆ‘ä¸€èµ·ï¼Œæ¥è‡ªå®šä¹‰ä¸€ä¸ªä¸å¯å˜ç±»å§ã€‚ä¸€ä¸ªä¸å¯å˜ç±»ï¼Œå¿…é¡»è¦æ»¡è¶³ä»¥ä¸‹ 4 ä¸ªæ¡ä»¶ï¼š

**1ï¼‰ç¡®ä¿ç±»æ˜¯ final çš„**ï¼Œä¸å…è®¸è¢«å…¶ä»–ç±»ç»§æ‰¿*ã€‚

**2ï¼‰ç¡®ä¿æ‰€æœ‰çš„æˆå‘˜å˜é‡ï¼ˆå­—æ®µï¼‰æ˜¯ final çš„**ï¼Œè¿™æ ·çš„è¯ï¼Œå®ƒä»¬å°±åªèƒ½åœ¨æ„é€ æ–¹æ³•ä¸­åˆå§‹åŒ–å€¼ï¼Œå¹¶ä¸”ä¸ä¼šåœ¨éšåè¢«ä¿®æ”¹ã€‚

**3ï¼‰ä¸è¦æä¾›ä»»ä½• setter æ–¹æ³•**ã€‚

**4ï¼‰å¦‚æœè¦ä¿®æ”¹ç±»çš„çŠ¶æ€ï¼Œå¿…é¡»è¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡**ã€‚

æŒ‰ç…§ä»¥ä¸Šæ¡ä»¶ï¼Œæˆ‘ä»¬æ¥è‡ªå®šä¹‰ä¸€ä¸ªç®€å•çš„ä¸å¯å˜ç±» Writerã€‚

```java
public final class Writer {
    private final String name;
    private final int age;

    public Writer(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public int getAge() {
        return age;
    }

    public String getName() {
        return name;
    }
}
```

Writer ç±»æ˜¯ final çš„ï¼Œname å’Œ age ä¹Ÿæ˜¯ final çš„ï¼Œæ²¡æœ‰ setter æ–¹æ³•ã€‚

OKï¼Œæ®è¯´è¿™ä¸ªä½œè€…åˆ†äº«äº†å¾ˆå¤šåšå®¢ï¼Œå¹¿å—è¯»è€…çš„å–œçˆ±ï¼Œå› æ­¤æŸæŸå‡ºç‰ˆç¤¾æ‰¾ä»–å†™äº†ä¸€æœ¬ä¹¦ï¼ˆBookï¼‰ã€‚Book ç±»æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š

```java
public class Book {
    private String name;
    private int price;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getPrice() {
        return price;
    }

    public void setPrice(int price) {
        this.price = price;
    }

    @Override
    public String toString() {
        return "Book{" +
                "name='" + name + '\'' +
                ", price=" + price +
                '}';
    }
}
```

2 ä¸ªå­—æ®µï¼Œåˆ†åˆ«æ˜¯ name å’Œ priceï¼Œä»¥åŠ getter å’Œ setterï¼Œé‡å†™åçš„ `toString()` æ–¹æ³•ã€‚ç„¶åï¼Œåœ¨ Writer ç±»ä¸­è¿½åŠ ä¸€ä¸ªå¯å˜å¯¹è±¡å­—æ®µ bookã€‚

```java
public final class Writer {
    private final String name;
    private final int age;
    private final Book book;

    public Writer(String name, int age, Book book) {
        this.name = name;
        this.age = age;
        this.book = book;
    }

    public int getAge() {
        return age;
    }

    public String getName() {
        return name;
    }

    public Book getBook() {
        return book;
    }
}
```

å¹¶åœ¨æ„é€ æ–¹æ³•ä¸­è¿½åŠ äº† Book å‚æ•°ï¼Œä»¥åŠ Book çš„ getter æ–¹æ³•ã€‚

å®Œæˆä»¥ä¸Šå·¥ä½œåï¼Œæˆ‘ä»¬æ¥æ–°å»ºä¸€ä¸ªæµ‹è¯•ç±»ï¼Œçœ‹çœ‹ Writer ç±»çš„çŠ¶æ€æ˜¯å¦çœŸçš„ä¸å¯å˜ã€‚

```java
public class WriterDemo {
    public static void main(String[] args) {
        Book book = new Book();
        book.setName("äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯");
        book.setPrice(79);

        Writer writer = new Writer("æ²‰é»˜ç‹äºŒ",18, book);
        System.out.println("å®šä»·ï¼š" + writer.getBook());
        writer.getBook().setPrice(59);
        System.out.println("ä¿ƒé”€ä»·ï¼š" + writer.getBook());
    }
}
```

ç¨‹åºè¾“å‡ºçš„ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```java
å®šä»·ï¼šBook{name='äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯', price=79}
ä¿ƒé”€ä»·ï¼šBook{name='äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯', price=59}
```

ç³Ÿç³•ï¼ŒWriter ç±»çš„ä¸å¯å˜æ€§è¢«ç ´åäº†ï¼Œä»·æ ¼å‘ç”Ÿäº†å˜åŒ–ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºä¸å¯å˜ç±»çš„å®šä¹‰è§„åˆ™è¿½åŠ ä¸€æ¡å†…å®¹ï¼š

å¦‚æœä¸€ä¸ªä¸å¯å˜ç±»ä¸­åŒ…å«äº†å¯å˜ç±»çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå°±éœ€è¦ç¡®ä¿è¿”å›çš„æ˜¯å¯å˜å¯¹è±¡çš„å‰¯æœ¬ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒWriter ç±»ä¸­çš„ `getBook()` æ–¹æ³•åº”è¯¥ä¿®æ”¹ä¸ºï¼š

```java
public Book getBook() {
    Book clone = new Book();
    clone.setPrice(this.book.getPrice());
    clone.setName(this.book.getName());
    return clone;
}
```

è¿™æ ·çš„è¯ï¼Œæ„é€ æ–¹æ³•åˆå§‹åŒ–åçš„ Book å¯¹è±¡å°±ä¸ä¼šå†è¢«ä¿®æ”¹äº†ã€‚æ­¤æ—¶ï¼Œè¿è¡Œ WriterDemoï¼Œå°±ä¼šå‘ç°ä»·æ ¼ä¸å†å‘ç”Ÿå˜åŒ–äº†ã€‚

```
å®šä»·ï¼šBook{name='äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯', price=79}
ä¿ƒé”€ä»·ï¼šBook{name='äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯', price=79}
```

### 04ã€æ€»ç»“

ä¸å¯å˜ç±»æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œå°±åƒä¹‹å‰æåˆ°çš„ String ç±»é‚£æ ·ï¼Œå°¤å…¶æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå®ƒéå¸¸çš„å®‰å…¨ã€‚å°½ç®¡æ¯æ¬¡ä¿®æ”¹éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¢åŠ äº†å†…å­˜çš„æ¶ˆè€—ï¼Œä½†è¿™ä¸ªç¼ºç‚¹ç›¸æ¯”å®ƒå¸¦æ¥çš„ä¼˜ç‚¹ï¼Œæ˜¾ç„¶æ˜¯å¾®ä¸è¶³é“çš„â€”â€”æ— éå°±æ˜¯æ¡äº†è¥¿ç“œï¼Œä¸¢äº†èŠéº»ã€‚

â€œå¥½äº†ï¼Œä¸‰å¦¹ï¼Œä½ åº”è¯¥ç†è§£äº†å§ï¼Ÿâ€

â€œå—¯ï¼Œå“¥ï¼Œä½ è¿™æœ¬ã€ŠJava è¿›é˜¶ä¹‹è·¯ã€‹è¿˜æ²¡æœ‰å‡ºä¹¦å§ï¼Ÿâ€ä¸‰å¦¹è´¨ç–‘é“ã€‚

â€œå®³ï¼Œå‡ºç‰ˆç¤¾éƒ½æ‰¾è¿‡æ¥è¦ç­¾åˆåŒäº†ï¼Œæˆ‘åªå¥½æ¨è„±è¯´ GitHub ç ´ 1 ä¸‡ star å†è€ƒè™‘ï¼Œå…ˆä¼˜åŒ–å§ï¼Œåé¢çœ‹æœºä¼šã€‚â€

â€œå“¦å“¦ï¼ŒåŸæ¥å¦‚æ­¤å•Šã€‚â€ä¸‰å¦¹é‡Šç„¶é“ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 5.19 Javaæ–¹æ³•é‡å†™å’Œæ–¹æ³•é‡è½½

å…¥å†¬çš„å¤œï¼Œæ€»æ˜¯æ¥å¾—ç‰¹åˆ«çš„æ—©ã€‚æˆ‘é™é™åœ°ç«™åœ¨é˜³å°ï¼Œç›®å…‰æ‰€åŠä¹‹å¤„ï¼Œä¸è¿‡æ˜¯è‹¥éšè‹¥ç°çš„é’¢ç­‹æ··å‡åœŸï¼Œè¿˜æœ‰é‚£æ¯«æ— æƒ…è°ƒçš„ç¯å…‰ã€‚

â€œå“¥ï¼Œåˆ«ç«™åœ¨é‚£å‘å‘†äº†ã€‚ä»Šå¤©å­¦å•¥å•Šï¼Œä¸ƒç‚¹åŠæˆ‘å°±è¦å›å­¦æ ¡äº†ï¼Œç•™ç»™ä½ çš„æ—¶é—´ä¸å¤šäº†ï¼Œä½ è¦æŠ“ç´§å“¦ã€‚â€ä¸‰å¦¹å‚²å¨‡çš„å£°éŸ³ä¸€ä¸‹å­æŠŠæˆ‘ä»æ¸¸ç¦»çš„çŠ¶æ€æ‹‰å›åˆ°äº†ç°å®ã€‚

â€œä»Šå¤©è¦å­¦ä¹  Java ä¸­çš„æ–¹æ³•é‡è½½ä¸æ–¹æ³•é‡å†™ã€‚â€æˆ‘è¿…é€Ÿåœ°èµ°åˆ°ç”µè„‘å‰é¢ï¼Œæ‰“å¼€ä¸€ä»½ Excel æ–‡æ¡£ï¼Œçœ‹äº†ä¸€ä¸‹ã€Šæ•™å¦¹å­¦ Javaï¼ˆäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯å‰èº«ï¼‰ã€‹çš„è¿›åº¦ï¼Œç„¶åå¯¹ä¸‰å¦¹è¯´ã€‚

â€œå¦‚æœä¸€ä¸ªç±»æœ‰å¤šä¸ªåå­—ç›¸åŒä½†å‚æ•°ä¸ªæ•°ä¸åŒçš„æ–¹æ³•ï¼Œæˆ‘ä»¬é€šå¸¸ç§°è¿™äº›æ–¹æ³•ä¸ºæ–¹æ³•é‡è½½ã€‚ â€æˆ‘é¢å¸¦ç€æœ´å®æ— åçš„å¾®ç¬‘ç»§ç»­è¯´ï¼Œâ€œå¦‚æœæ–¹æ³•çš„åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†å‚æ•°ä¸åŒï¼Œä½¿ç”¨ç›¸åŒçš„åå­—å¯ä»¥æé«˜ç¨‹åºçš„å¯è¯»æ€§ã€‚â€

â€œå¦‚æœå­ç±»å…·æœ‰å’Œçˆ¶ç±»ä¸€æ ·çš„æ–¹æ³•ï¼ˆå‚æ•°ç›¸åŒã€è¿”å›ç±»å‹ç›¸åŒã€æ–¹æ³•åç›¸åŒï¼Œä½†æ–¹æ³•ä½“å¯èƒ½ä¸åŒï¼‰ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ–¹æ³•é‡å†™ã€‚ æ–¹æ³•é‡å†™ç”¨äºæä¾›çˆ¶ç±»å·²ç»å£°æ˜çš„æ–¹æ³•çš„ç‰¹æ®Šå®ç°ï¼Œæ˜¯å®ç°å¤šæ€çš„åŸºç¡€æ¡ä»¶ã€‚â€

â€œåªä¸è¿‡ï¼Œæ–¹æ³•é‡è½½ä¸æ–¹æ³•é‡å†™åœ¨åå­—ä¸Šå¾ˆç›¸ä¼¼ï¼Œå°±åƒæ˜¯å…„å¼Ÿä¿©ï¼Œå¯¼è‡´åˆå­¦è€…ç»å¸¸æŠŠå®ƒä»¬ä¿©ææ··ã€‚â€

â€œæ–¹æ³•é‡è½½çš„è‹±æ–‡åå« Overloadingï¼Œæ–¹æ³•é‡å†™çš„è‹±æ–‡åå« Overridingï¼Œå› æ­¤ï¼Œä¸ä»…ä¸­æ–‡åå¾ˆç›¸è¿‘ï¼Œè‹±æ–‡åä¹‹é—´ä¹Ÿå¾ˆç›¸è¿‘ï¼Œè¿™å°±æ›´å®¹æ˜“è®©åˆå­¦è€…ææ··äº†ã€‚â€

â€œä½†ä¸¤è€…å…¶å®æ˜¯å®Œå…¨ä¸åŒçš„ï¼é€šè¿‡ä¸‹é¢è¿™å¼ å›¾ï¼Œä½ å°±èƒ½çœ‹å¾—ä¸€æ¸…äºŒæ¥šã€‚â€

è¯éŸ³åˆšè½ï¼Œæˆ‘å°±åœ¨ IDEA ä¸­å™¼é‡Œå•ªå•¦åœ°æ•²äº†èµ·æ¥ã€‚ä¸¤æ®µä»£ç ï¼Œåˆ†åˆ«æ˜¯æ–¹æ³•é‡å†™å’Œæ–¹æ³•é‡è½½ã€‚ç„¶åï¼ŒæŠŠè¿™ä¸¤æ®µä»£ç æˆªå›¾åˆ° draw.ioï¼ˆä¸€ä¸ªå¾ˆæ¼‚äº®çš„åœ¨çº¿ç”»å›¾ç½‘ç«™ï¼‰ä¸Šï¼ŒåŠ äº†ä¸€äº›æ–‡å­—è¯´æ˜ã€‚æœ€åï¼Œæ‰“å¼€ Photoscape Xï¼ŒæŠŠä¸¤å¼ å›¾ç‰‡åˆå¹¶åˆ°äº†ä¸€èµ·ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-points/21-01.png)

### 01ã€æ–¹æ³•é‡è½½

â€œä¸‰å¦¹ï¼Œä½ ä»”ç»†å¬å“¦ã€‚â€æˆ‘ç¼“äº†ä¸€å£æ°”åç»§ç»­è¯´é“ã€‚

â€œåœ¨ Java ä¸­ï¼Œæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è¾¾åˆ°æ–¹æ³•é‡è½½çš„ç›®çš„ã€‚â€

â€œç¬¬ä¸€ï¼Œæ”¹å˜å‚æ•°çš„æ•°ç›®ã€‚æ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ã€‚â€

```java
public class OverloadingByParamNum {
    public static void main(String[] args) {
        System.out.println(Adder.add(10, 19));
        System.out.println(Adder.add(10, 19, 20));
    }
}

class Adder {
    static int add(int a, int b) {
        return a + b;
    }

    static int add(int a, int b, int c) {
        return a + b + c;
    }
}  
```

â€œAdder ç±»æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œç¬¬ä¸€ä¸ª `add()` æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™å¯ä»¥ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼›ç¬¬äºŒä¸ª `add()` æ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™å¯ä»¥ä¼ é€’ä¸‰ä¸ªå‚æ•°ã€‚â€

â€œäºŒå“¥ï¼Œè¿™æ ·çš„ä»£ç ä¸ä¼šæ˜¾å¾—å•°å—¦å—ï¼Ÿå¦‚æœæœ‰å››ä¸ªå‚æ•°çš„æ—¶å€™å°±å†è¿½åŠ ä¸€ä¸ªæ–¹æ³•ï¼Ÿâ€ä¸‰å¦¹çªç„¶æäº†ä¸€ä¸ªå¾ˆå°–é”çš„é—®é¢˜ã€‚

â€œé‚£å€’æ˜¯ï¼Œè¿™ä¸ªä¾‹å­åªæ˜¯ä¸ºäº†è¯´æ˜æ–¹æ³•é‡è½½çš„ä¸€ç§ç±»å‹ã€‚å¦‚æœå‚æ•°ç±»å‹ç›¸åŒçš„è¯ï¼ŒJava æä¾›äº†å¯å˜å‚æ•°çš„æ–¹å¼ï¼Œå°±åƒä¸‹é¢è¿™æ ·ã€‚â€

```java
static int add(int ... args) {
    int sum = 0;
    for ( int a: args) {
        sum += a;
    }
    return sum;
}
```

â€œç¬¬äºŒï¼Œé€šè¿‡æ”¹å˜å‚æ•°ç±»å‹ï¼Œä¹Ÿå¯ä»¥è¾¾åˆ°æ–¹æ³•é‡è½½çš„ç›®çš„ã€‚æ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ã€‚â€

```java
public class OverloadingByParamType {
    public static void main(String[] args) {
        System.out.println(Adder.add(10, 19));
        System.out.println(Adder.add(10.1, 19.2));
    }
}

class Adder {
    static int add(int a, int b) {
        return a + b;
    }

    static double add(double a, double b) {
        return a + b;
    }
}
```

â€œAdder ç±»æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œç¬¬ä¸€ä¸ª `add()` æ–¹æ³•çš„å‚æ•°ç±»å‹ä¸º intï¼Œç¬¬äºŒä¸ª `add()` æ–¹æ³•çš„å‚æ•°ç±»å‹ä¸º doubleã€‚â€

â€œäºŒå“¥ï¼Œæ”¹å˜å‚æ•°çš„æ•°ç›®å’Œç±»å‹éƒ½å¯ä»¥å®ç°æ–¹æ³•é‡è½½ï¼Œä¸ºä»€ä¹ˆæ”¹å˜æ–¹æ³•çš„è¿”å›å€¼ç±»å‹å°±ä¸å¯ä»¥å‘¢ï¼Ÿâ€ä¸‰å¦¹å¾ˆèƒ½æŠ“ä½é—®é¢˜çš„é‡ç‚¹å˜›ã€‚

â€œå› ä¸ºä»…ä»…æ”¹å˜è¿”å›å€¼ç±»å‹çš„è¯ï¼Œä¼šæŠŠç¼–è¯‘å™¨ææ‡µé€¼çš„ã€‚â€æˆ‘ç•¥å¸¦è°ƒçš®çš„å£å»å›ç­”å¥¹ã€‚

â€œç¼–è¯‘æ—¶æŠ¥é”™ä¼˜äºè¿è¡Œæ—¶æŠ¥é”™ï¼Œæ‰€ä»¥å½“ä¸¤ä¸ªæ–¹æ³•çš„åå­—ç›¸åŒï¼Œå‚æ•°ä¸ªæ•°å’Œç±»å‹ä¹Ÿç›¸åŒçš„æ—¶å€™ï¼Œè™½ç„¶è¿”å›å€¼ç±»å‹ä¸åŒï¼Œä½†ä¾ç„¶ä¼šæç¤ºæ–¹æ³•å·²ç»è¢«å®šä¹‰çš„é”™è¯¯ã€‚â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-points/21-02.png)

â€œä½ æƒ³å•Šï¼Œä¸‰å¦¹ã€‚æˆ‘ä»¬åœ¨è°ƒç”¨ä¸€ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šè¿”å›å€¼ç±»å‹ï¼Œä¹Ÿå¯ä»¥ä¸æŒ‡å®šã€‚å½“ä¸æŒ‡å®šçš„æ—¶å€™ï¼Œç›´æ¥æŒ‡å®š `add(1, 2)` çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨å°±ä¸çŸ¥é“è¯¥è°ƒç”¨è¿”å› int çš„ `add()` æ–¹æ³•è¿˜æ˜¯è¿”å› double çš„ `add()` æ–¹æ³•ï¼Œäº§ç”Ÿäº†æ­§ä¹‰ã€‚â€

â€œæ–¹æ³•çš„è¿”å›å€¼åªæ˜¯ä½œä¸ºæ–¹æ³•è¿è¡Œåçš„ä¸€ä¸ªçŠ¶æ€ï¼Œå®ƒæ˜¯ä¿æŒæ–¹æ³•çš„è°ƒç”¨è€…å’Œè¢«è°ƒç”¨è€…è¿›è¡Œé€šä¿¡çš„ä¸€ä¸ªçº½å¸¦ï¼Œä½†å¹¶ä¸èƒ½ä½œä¸ºæŸä¸ªæ–¹æ³•çš„â€˜æ ‡è¯†â€™ã€‚â€

â€œäºŒå“¥ï¼Œæˆ‘æƒ³åˆ°äº†ä¸€ä¸ªç‚¹ï¼Œ`main()` æ–¹æ³•å¯ä»¥é‡è½½å—ï¼Ÿâ€

â€œä¸‰å¦¹ï¼Œè¿™æ˜¯ä¸ªå¥½é—®é¢˜å•Šï¼ç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œæ¯•ç«Ÿ `main()` æ–¹æ³•ä¹Ÿæ˜¯ä¸ªæ–¹æ³•ï¼Œåªä¸è¿‡ï¼ŒJava è™šæ‹Ÿæœºåœ¨è¿è¡Œçš„æ—¶å€™åªä¼šè°ƒç”¨å¸¦æœ‰ String æ•°ç»„çš„é‚£ä¸ª `main()` æ–¹æ³•ã€‚â€

```java
public class OverloadingMain {
    public static void main(String[] args) {
        System.out.println("String[] args");
    }

    public static void main(String args) {
        System.out.println("String args");
    }

    public static void main() {
        System.out.println("æ— å‚");
    }
}
```

â€œç¬¬ä¸€ä¸ª `main()` æ–¹æ³•çš„å‚æ•°å½¢å¼ä¸º `String[] args`ï¼Œæ˜¯æœ€æ ‡å‡†çš„å†™æ³•ï¼›ç¬¬äºŒä¸ª `main()` æ–¹æ³•çš„å‚æ•°å½¢å¼ä¸º `String args`ï¼Œå°‘äº†ä¸­æ‹¬å·ï¼›ç¬¬ä¸‰ä¸ª `main()` æ–¹æ³•æ²¡æœ‰å‚æ•°ã€‚â€

â€œæ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„è¾“å‡ºç»“æœã€‚â€

```
String[] args
```

â€œä»ç»“æœä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å¾—å‡ºï¼Œå°½ç®¡ `main()` æ–¹æ³•å¯ä»¥é‡è½½ï¼Œä½†ç¨‹åºåªè®¤æ ‡å‡†å†™æ³•ã€‚â€

â€œç”±äºå¯ä»¥é€šè¿‡æ”¹å˜å‚æ•°ç±»å‹çš„æ–¹å¼å®ç°æ–¹æ³•é‡è½½ï¼Œé‚£ä¹ˆå½“ä¼ é€’çš„å‚æ•°æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ–¹æ³•æ—¶ï¼Œå°±ä¼šå‘ç”Ÿéšå¼çš„ç±»å‹è½¬æ¢ã€‚â€

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/basic-extra-meal/override-overload-0d30f41f-1f53-4988-b506-731d79ed16d1.png)

â€œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œbyte å¯ä»¥å‘ä¸Šè½¬æ¢ä¸º shortã€intã€longã€float å’Œ doubleï¼Œshort å¯ä»¥å‘ä¸Šè½¬æ¢ä¸º intã€longã€float å’Œ doubleï¼Œchar å¯ä»¥å‘ä¸Šè½¬æ¢ä¸º intã€longã€float å’Œ doubleï¼Œä¾æ¬¡ç±»æ¨ã€‚â€

â€œä¸‰å¦¹ï¼Œæ¥çœ‹ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ã€‚â€

```java
public class OverloadingTypePromotion {
    void sum(int a, long b) {
        System.out.println(a + b);
    }

    void sum(int a, int b, int c) {
        System.out.println(a + b + c);
    }

    public static void main(String args[]) {
        OverloadingTypePromotion obj = new OverloadingTypePromotion();
        obj.sum(20, 20);
        obj.sum(20, 20, 20);
    }
}
```

â€œæ‰§è¡Œ `obj.sum(20, 20)` çš„æ—¶å€™ï¼Œå‘ç°æ²¡æœ‰ `sum(int a, int b)` çš„æ–¹æ³•ï¼Œæ‰€ä»¥æ­¤æ—¶ç¬¬äºŒä¸ª 20 å‘ä¸Šè½¬å‹ä¸º longï¼Œæ‰€ä»¥è°ƒç”¨çš„æ˜¯ `sum(int a, long b)` çš„æ–¹æ³•ã€‚â€

â€œå†æ¥çœ‹ä¸€ä¸ªç¤ºä¾‹ã€‚â€

```java
public class OverloadingTypePromotion1 {
    void sum(int a, int b) {
        System.out.println("int");
    }

    void sum(long a, long b) {
        System.out.println("long");
    }

    public static void main(String args[]) {
        OverloadingTypePromotion1 obj = new OverloadingTypePromotion1();
        obj.sum(20, 20);
    }
}
```

â€œæ‰§è¡Œ `obj.sum(20, 20)` çš„æ—¶å€™ï¼Œå‘ç°æœ‰ `sum(int a, int b)` çš„æ–¹æ³•ï¼Œæ‰€ä»¥å°±ä¸ä¼šå‘ä¸Šè½¬å‹ä¸º longï¼Œè°ƒç”¨ `sum(long a, long b)`ã€‚â€

â€œæ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„è¾“å‡ºç»“æœã€‚â€

```
int
```

â€œç»§ç»­æ¥çœ‹ç¤ºä¾‹ã€‚â€

```java
public class OverloadingTypePromotion2 {
    void sum(long a, int b) {
        System.out.println("long int");
    }

    void sum(int a, long b) {
        System.out.println("int long");
    }

    public static void main(String args[]) {
        OverloadingTypePromotion2 obj = new OverloadingTypePromotion2();
        obj.sum(20, 20);
    }
}
```

â€œäºŒå“¥ï¼Œæˆ‘åˆæƒ³åˆ°ä¸€ä¸ªé—®é¢˜ã€‚å½“æœ‰ä¸¤ä¸ªæ–¹æ³• `sum(long a, int b)` å’Œ `sum(int a, long b)`ï¼Œå‚æ•°ä¸ªæ•°ç›¸åŒï¼Œå‚æ•°ç±»å‹ç›¸åŒï¼Œåªä¸è¿‡ä½ç½®ä¸åŒçš„æ—¶å€™ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿâ€

â€œå½“é€šè¿‡ `obj.sum(20, 20)` æ¥è°ƒç”¨ sum æ–¹æ³•çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¼šæç¤ºé”™è¯¯ã€‚â€
![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-points/21-04.png)

â€œä¸æ˜ç¡®ï¼Œç¼–è¯‘å™¨ä¼šå¾ˆä¸ºéš¾ï¼Œç©¶ç«Ÿæ˜¯æŠŠç¬¬ä¸€ä¸ª 20 ä» int è½¬æˆ long å‘¢ï¼Œè¿˜æ˜¯æŠŠç¬¬äºŒä¸ª 20 ä» int è½¬æˆ longï¼Œæ™ºéšœäº†ï¼æ‰€ä»¥ï¼Œä¸èƒ½å†™è¿™æ ·è®©ç¼–è¯‘å™¨å·¦å³ä¸ºéš¾çš„ä»£ç ã€‚â€

### 02ã€æ–¹æ³•é‡å†™

â€œä¸‰å¦¹ï¼Œç´¯å—ï¼Ÿæˆ‘ä»¬ç¨å¾®ä¼‘æ¯ä¸€ä¸‹å§ã€‚â€æˆ‘æŠŠçœ¼é•œæ‘˜ä¸‹æ¥ï¼Œæ”¾åˆ°æ¡Œå­ä¸Šï¼Œé—­ä¸Šäº†çœ¼ç›ï¼Œå¼€å§‹èƒ¡æ€ä¹±æƒ³èµ·æ¥ã€‚

2000 å¹´ï¼Œå‘¨æ°ä¼¦æ¨ªç©ºå‡ºä¸–ï¼Œè®©é’é»„ä¸æ¥çš„å”±ç‰‡è¡Œä¸šä¸ºä¹‹ä¸€æŒ¯ï¼Œç”±æ­¤å¼€å¯äº†æ–°ä¸€ä»£å¤©ç‹äº‰éœ¸çš„é»„é‡‘æ—¶ä»£ã€‚2020 å¹´ï¼Œæ°ä¼¦èƒ–äº†ï¼Œä¹Ÿè´ªç©äº†ï¼Œä¸€å¹´å‡ºä¸€å¼ å•æ›²éƒ½å˜å¾—å¯é‡ä¸å¯æ±‚ã€‚

20 å¹´å‰ï¼Œç¨‹åºå‘˜å¾ˆç¨€æœ‰ï¼›20 å¹´åï¼Œç¨‹åºå‘˜å†…å·äº†ã€‚æ—¶é—´æ°¸è¿œä¸ä¼šåœä¸‹è„šæ­¥ï¼Œæ˜å¹´ä¼šä¸ä¼šå¥½èµ·æ¥å‘¢ï¼Ÿ

â€œå“¥ï¼Œé†’é†’ï¼Œä½ å°±è¯´ä¼‘æ¯ä¸€ä¼šï¼Œæ²¡è¯´ç¡ç€å•Šã€‚èµ¶ç´§ï¼Œæˆ‘è¿˜æœ‰åŠä¸ªå°æ—¶å°±è¦èµ°äº†ã€‚â€

æˆ‘æˆ´ä¸Šçœ¼é•œï¼Œå¯¹ä¸‰å¦¹ç»§ç»­è¯´é“ï¼šâ€œåœ¨ Java ä¸­ï¼Œæ–¹æ³•é‡å†™éœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªè§„åˆ™ã€‚â€

- é‡å†™çš„æ–¹æ³•å¿…é¡»å’Œçˆ¶ç±»ä¸­çš„æ–¹æ³•æœ‰ç€ç›¸åŒçš„åå­—ï¼›
- é‡å†™çš„æ–¹æ³•å¿…é¡»å’Œçˆ¶ç±»ä¸­çš„æ–¹æ³•æœ‰ç€ç›¸åŒçš„å‚æ•°ï¼›
- å¿…é¡»æ˜¯ is-a çš„å…³ç³»ï¼ˆç»§æ‰¿å…³ç³»ï¼‰ã€‚

â€œæ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ã€‚â€

```java
public class Bike extends Vehicle {
    public static void main(String[] args) {
        Bike bike = new Bike();
        bike.run();
    }
}

class Vehicle {
    void run() {
        System.out.println("è½¦è¾†åœ¨è·‘");
    }
}
```

â€œæ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„è¾“å‡ºç»“æœã€‚â€

```
è½¦è¾†åœ¨è·‘
```

â€œBike is-a Vehicleï¼Œè‡ªè¡Œè½¦æ˜¯ä¸€ç§è½¦ï¼Œæ²¡é”™ã€‚Vehicle ç±»æœ‰ä¸€ä¸ª `run()` çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´è½¦è¾†å¯ä»¥è·‘ï¼ŒBike ç»§æ‰¿äº† Vehicleï¼Œä¹Ÿå¯ä»¥è·‘ã€‚ä½†å¦‚æœ Bike æ²¡æœ‰é‡å†™ `run()` æ–¹æ³•çš„è¯ï¼Œè‡ªè¡Œè½¦å°±åªèƒ½æ˜¯â€˜è½¦è¾†åœ¨è·‘â€™ï¼Œè€Œä¸æ˜¯â€˜è‡ªè¡Œè½¦åœ¨è·‘â€™ï¼Œå¯¹å§ï¼Ÿâ€

â€œå¦‚æœæœ‰äº†æ–¹æ³•é‡å†™ï¼Œä¸€åˆ‡å°±å¥½åŠäº†ã€‚â€

```java
public class Bike extends Vehicle {
    @Override
    void run() {
        System.out.println("è‡ªè¡Œè½¦åœ¨è·‘");
    }

    public static void main(String[] args) {
        Bike bike = new Bike();
        bike.run();
    }
}

class Vehicle {
    void run() {
        System.out.println("è½¦è¾†åœ¨è·‘");
    }
}
```

æˆ‘æŠŠé¼ æ ‡ç§»åŠ¨åˆ° Bike ç±»çš„ `run()` æ–¹æ³•ï¼Œå¯¹ä¸‰å¦¹è¯´ï¼šâ€œä½ çœ‹ï¼Œåœ¨æ–¹æ³•é‡å†™çš„æ—¶å€™ï¼ŒIDEA ä¼šå»ºè®®ä½¿ç”¨ `@Override` æ³¨è§£ï¼Œæ˜¾å¼çš„è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé‡å†™åçš„æ–¹æ³•ï¼Œå°½ç®¡å¯ä»¥ç¼ºçœã€‚â€

â€œæ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„è¾“å‡ºç»“æœã€‚â€

```
è‡ªè¡Œè½¦åœ¨è·‘
```

â€œBike é‡å†™äº† `run()` æ–¹æ³•ï¼Œä¹Ÿå°±æ„å‘³ç€ï¼ŒBike å¯ä»¥è·‘å‡ºè‡ªå·±çš„é£æ ¼ã€‚â€

å¥½ï¼Œæ¥ä¸‹æ¥è¯´ä¸€ä¸‹é‡å†™æ—¶åº”å½“éµå®ˆçš„ 12 æ¡è§„åˆ™ï¼Œåº”å½“è°¨è®°å“¦ã€‚

#### **è§„åˆ™ä¸€ï¼šåªèƒ½é‡å†™ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•**ã€‚

å› ä¸ºé‡å†™æ˜¯åœ¨å­ç±»é‡æ–°å®ç°ä»çˆ¶ç±»[ç»§æ‰¿](https://tobebetterjavaer.com/oo/extends-bigsai.html)è¿‡æ¥çš„æ–¹æ³•æ—¶å‘ç”Ÿçš„ï¼Œæ‰€ä»¥åªèƒ½é‡å†™ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•ï¼Œè¿™å¾ˆå¥½ç†è§£ã€‚è¿™å°±æ„å‘³ç€ï¼Œåªèƒ½é‡å†™é‚£äº›è¢« publicã€protected æˆ–è€… default ä¿®é¥°çš„æ–¹æ³•ï¼Œprivate ä¿®é¥°çš„æ–¹æ³•æ— æ³•è¢«é‡å†™ã€‚

Animal ç±»æœ‰ `move()`ã€`eat()` å’Œ `sleep()` ä¸‰ä¸ªæ–¹æ³•ï¼š

```java
public class Animal {
    public void move() { }

    protected void eat() { }
    
    void sleep(){ }
}
```

Dog ç±»æ¥é‡å†™è¿™ä¸‰ä¸ªæ–¹æ³•ï¼š

```java
public class Dog extends Animal {
    public void move() { }

    protected void eat() { }

    void sleep(){ }
}
```

OKï¼Œå®Œå…¨æ²¡æœ‰é—®é¢˜ã€‚ä½†å¦‚æœçˆ¶ç±»ä¸­çš„æ–¹æ³•æ˜¯ private çš„ï¼Œå°±è¡Œä¸é€šäº†ã€‚

```java
public class Animal {
    private void move() { }
}
```

æ­¤æ—¶ï¼ŒDog ç±»ä¸­çš„ `move()` æ–¹æ³•å°±ä¸å†æ˜¯ä¸€ä¸ªé‡å†™æ–¹æ³•äº†ï¼Œå› ä¸ºçˆ¶ç±»çš„ `move()` æ–¹æ³•æ˜¯ private çš„ï¼Œå¯¹å­ç±»å¹¶ä¸å¯è§ã€‚

```java
public class Dog extends Animal {
    public void move() { }
}
```

#### **è§„åˆ™äºŒï¼šfinalã€static çš„æ–¹æ³•ä¸èƒ½è¢«é‡å†™**ã€‚

ä¸€ä¸ªæ–¹æ³•æ˜¯ [final](https://tobebetterjavaer.com/oo/final.html) çš„å°±æ„å‘³ç€å®ƒæ— æ³•è¢«å­ç±»ç»§æ‰¿åˆ°ï¼Œæ‰€ä»¥å°±æ²¡åŠæ³•é‡å†™ã€‚

```java
public class Animal {
    final void move() { }
}
```

ç”±äºçˆ¶ç±» Animal ä¸­çš„ `move()` æ˜¯ final çš„ï¼Œæ‰€ä»¥å­ç±»åœ¨å°è¯•é‡å†™è¯¥æ–¹æ³•çš„æ—¶å€™å°±å‡ºç°ç¼–è¯‘é”™è¯¯äº†ï¼

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/basic-extra-meal/Overriding-2.png)

åŒæ ·çš„ï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•æ˜¯ [static](https://tobebetterjavaer.com/oo/static.html) çš„ï¼Œä¹Ÿä¸å…è®¸é‡å†™ï¼Œå› ä¸ºé™æ€æ–¹æ³•å¯ç”¨äºçˆ¶ç±»ä»¥åŠå­ç±»çš„æ‰€æœ‰å®ä¾‹ã€‚

```java
public class Animal {
    final void move() { }
}
```

é‡å†™çš„ç›®çš„åœ¨äºæ ¹æ®å¯¹è±¡çš„ç±»å‹ä¸åŒè€Œè¡¨ç°å‡ºå¤šæ€ï¼Œè€Œé™æ€æ–¹æ³•ä¸éœ€è¦åˆ›å»ºå¯¹è±¡å°±å¯ä»¥ä½¿ç”¨ã€‚æ²¡æœ‰äº†å¯¹è±¡ï¼Œé‡å†™æ‰€éœ€è¦çš„â€œå¯¹è±¡çš„ç±»å‹â€ä¹Ÿå°±æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰äº†ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/basic-extra-meal/Overriding-3.png)

#### **è§„åˆ™ä¸‰ï¼šé‡å†™çš„æ–¹æ³•å¿…é¡»æœ‰ç›¸åŒçš„å‚æ•°åˆ—è¡¨**ã€‚

```java
public class Animal {
    void eat(String food) { }
}
```

Dog ç±»ä¸­çš„ `eat()` æ–¹æ³•ä¿æŒäº†çˆ¶ç±»æ–¹æ³• `eat()` çš„åŒä¸€ä¸ªè°ƒè°ƒï¼Œéƒ½æœ‰ä¸€ä¸ªå‚æ•°â€”â€”String ç±»å‹çš„ foodã€‚

```java
public class Dog extends Animal {
    public void eat(String food) { }
}
```

ä¸€æ—¦å­ç±»æ²¡æœ‰æŒ‰ç…§è¿™ä¸ªè§„åˆ™æ¥ï¼Œæ¯”å¦‚è¯´å¢åŠ äº†ä¸€ä¸ªå‚æ•°ï¼š

```java
public class Dog extends Animal {
    public void eat(String food, int amount) { }
}
```

è¿™å°±ä¸å†æ˜¯é‡å†™çš„èŒƒç•´äº†ï¼Œå½“ç„¶ä¹Ÿä¸æ˜¯é‡è½½çš„èŒƒç•´ï¼Œå› ä¸ºé‡è½½è€ƒè™‘çš„æ˜¯åŒä¸€ä¸ªç±»ã€‚

**è§„åˆ™å››ï¼šé‡å†™çš„æ–¹æ³•å¿…é¡»è¿”å›ç›¸åŒçš„ç±»å‹**ã€‚

çˆ¶ç±»æ²¡æœ‰è¿”å›ç±»å‹ï¼š

```java
public class Animal {
    void eat(String food) { }
}
```

å­ç±»å°è¯•è¿”å› Stringï¼š

```java
public class Dog extends Animal {
    public String eat(String food) {
        return null;
    }
}
```

äºæ˜¯å°±ç¼–è¯‘å‡ºé”™äº†ï¼ˆè¿”å›ç±»å‹ä¸å…¼å®¹ï¼‰ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/basic-extra-meal/Overriding-4.png)

#### **è§„åˆ™äº”ï¼šé‡å†™çš„æ–¹æ³•ä¸èƒ½ä½¿ç”¨é™åˆ¶ç­‰çº§æ›´ä¸¥æ ¼çš„æƒé™ä¿®é¥°ç¬¦**ã€‚

å¯ä»¥è¿™æ ·æ¥ç†è§£ï¼š

- å¦‚æœè¢«é‡å†™çš„æ–¹æ³•æ˜¯ defaultï¼Œé‚£ä¹ˆé‡å†™çš„æ–¹æ³•å¯ä»¥æ˜¯ defaultã€protected æˆ–è€… publicã€‚
- å¦‚æœè¢«é‡å†™çš„æ–¹æ³•æ˜¯ protectedï¼Œé‚£ä¹ˆé‡å†™çš„æ–¹æ³•åªèƒ½æ˜¯ protected æˆ–è€… publicã€‚
- å¦‚æœè¢«é‡å†™çš„æ–¹æ³•æ˜¯ publicï¼Œ é‚£ä¹ˆé‡å†™çš„æ–¹æ³•å°±åªèƒ½æ˜¯ publicã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œçˆ¶ç±»ä¸­çš„æ–¹æ³•æ˜¯ protectedï¼š

```java
public class Animal {
    protected void eat() { }
}
```

å­ç±»ä¸­çš„æ–¹æ³•å¯ä»¥æ˜¯ publicï¼š

```java
public class Dog extends Animal {
    public void eat() { }
}
```

å¦‚æœå­ç±»ä¸­çš„æ–¹æ³•ç”¨äº†æ›´ä¸¥æ ¼çš„æƒé™ä¿®é¥°ç¬¦ï¼Œç¼–è¯‘å™¨å°±æŠ¥é”™äº†ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/basic-extra-meal/Overriding-5.png)

#### **è§„åˆ™å…­ï¼šé‡å†™åçš„æ–¹æ³•ä¸èƒ½æŠ›å‡ºæ¯”çˆ¶ç±»ä¸­æ›´é«˜çº§åˆ«çš„å¼‚å¸¸**ã€‚

ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœçˆ¶ç±»ä¸­çš„æ–¹æ³•æŠ›å‡ºçš„æ˜¯ IOExceptionï¼Œé‚£ä¹ˆå­ç±»ä¸­é‡å†™çš„æ–¹æ³•ä¸èƒ½æŠ›å‡º Exceptionï¼Œå¯ä»¥æ˜¯ IOException çš„å­ç±»æˆ–è€…ä¸æŠ›å‡ºä»»ä½•[å¼‚å¸¸](https://tobebetterjavaer.com/exception/gailan.html)ã€‚è¿™æ¡è§„åˆ™åªé€‚ç”¨äºå¯æ£€æŸ¥çš„å¼‚å¸¸ã€‚

å¯æ£€æŸ¥ï¼ˆcheckedï¼‰å¼‚å¸¸å¿…é¡»åœ¨æºä»£ç ä¸­æ˜¾å¼åœ°è¿›è¡Œæ•è·å¤„ç†ï¼Œä¸æ£€æŸ¥ï¼ˆuncheckedï¼‰å¼‚å¸¸å°±æ˜¯æ‰€è°“çš„è¿è¡Œæ—¶å¼‚å¸¸ï¼Œæ¯”å¦‚è¯´ NullPointerExceptionã€ArrayIndexOutOfBoundsException ä¹‹ç±»çš„ï¼Œä¸ä¼šåœ¨ç¼–è¯‘å™¨å¼ºåˆ¶è¦æ±‚ã€‚

çˆ¶ç±»æŠ›å‡º IOExceptionï¼š

```java
public class Animal {
    protected void eat() throws IOException { }
}
```

å­ç±»æŠ›å‡º FileNotFoundException æ˜¯å¯ä»¥æ»¡è¶³é‡å†™çš„è§„åˆ™çš„ï¼Œå› ä¸º FileNotFoundException æ˜¯ IOException çš„å­ç±»ã€‚

```java
public class Dog extends Animal {
   public void eat() throws FileNotFoundException { }
}
```

å¦‚æœå­ç±»æŠ›å‡ºäº†ä¸€ä¸ªæ–°çš„å¼‚å¸¸ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ª checked å¼‚å¸¸ï¼š

```java
public class Dog extends Animal {
   public void eat() throws FileNotFoundException, InterruptedException { }
}
```

é‚£ç¼–è¯‘å™¨å°±ä¼šæç¤ºé”™è¯¯ï¼š

```
Error:(9, 16) java: com.itwanger.overriding.Dogä¸­çš„eat()æ— æ³•è¦†ç›–com.itwanger.overriding.Animalä¸­çš„eat()
  è¢«è¦†ç›–çš„æ–¹æ³•æœªæŠ›å‡ºjava.lang.InterruptedException
```

ä½†å¦‚æœå­ç±»æŠ›å‡ºçš„æ˜¯ä¸€ä¸ª unchecked å¼‚å¸¸ï¼Œé‚£å°±æ²¡æœ‰å†²çªï¼š

```java
public class Dog extends Animal {
   public void eat() throws FileNotFoundException, IllegalArgumentException { }
}
```

å¦‚æœå­ç±»æŠ›å‡ºçš„æ˜¯ä¸€ä¸ªæ›´é«˜çº§åˆ«çš„å¼‚å¸¸ï¼š

```java
public class Dog extends Animal {
   public void eat() throws Exception { }
}
```

ç¼–è¯‘å™¨åŒæ ·ä¼šæç¤ºé”™è¯¯ï¼Œå› ä¸º Exception æ˜¯ IOException çš„çˆ¶ç±»ã€‚

```
Error:(9, 16) java: com.itwanger.overriding.Dogä¸­çš„eat()æ— æ³•è¦†ç›–com.itwanger.overriding.Animalä¸­çš„eat()
  è¢«è¦†ç›–çš„æ–¹æ³•æœªæŠ›å‡ºjava.lang.Exception
```

#### **è§„åˆ™ä¸ƒï¼šå¯ä»¥åœ¨å­ç±»ä¸­é€šè¿‡ super å…³é”®å­—æ¥è°ƒç”¨çˆ¶ç±»ä¸­è¢«é‡å†™çš„æ–¹æ³•**ã€‚

å­ç±»ç»§æ‰¿çˆ¶ç±»çš„æ–¹æ³•è€Œä¸æ˜¯é‡æ–°å®ç°æ˜¯å¾ˆå¸¸è§çš„ä¸€ç§åšæ³•ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥æŒ‰ç…§ä¸‹é¢çš„å½¢å¼è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼š

```java
super.overriddenMethodName();
```

æ¥çœ‹ä¾‹å­ã€‚

```java
public class Animal {
    protected void eat() { }
}
```

å­ç±»é‡å†™äº† `eat()` æ–¹æ³•ï¼Œç„¶ååœ¨å­ç±»çš„ `eat()` æ–¹æ³•ä¸­ï¼Œå¯ä»¥åœ¨æ–¹æ³•ä½“çš„ç¬¬ä¸€è¡Œé€šè¿‡ `super.eat()` è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œç„¶åå†å¢åŠ å±äºè‡ªå·±çš„ä»£ç ã€‚

```java
public class Dog extends Animal {
   public void eat() {
       super.eat();
       // Dog-eat
   }
}
```

#### **è§„åˆ™å…«ï¼šæ„é€ æ–¹æ³•ä¸èƒ½è¢«é‡å†™**ã€‚

å› ä¸º[æ„é€ æ–¹æ³•](https://tobebetterjavaer.com/oo/construct.html)å¾ˆç‰¹æ®Šï¼Œè€Œä¸”å­ç±»çš„æ„é€ æ–¹æ³•ä¸èƒ½å’Œçˆ¶ç±»çš„æ„é€ æ–¹æ³•åŒåï¼ˆç±»åä¸åŒï¼‰ï¼Œæ‰€ä»¥æ„é€ æ–¹æ³•å’Œé‡å†™ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚

#### **è§„åˆ™ä¹ï¼šå¦‚æœä¸€ä¸ªç±»ç»§æ‰¿äº†æŠ½è±¡ç±»ï¼ŒæŠ½è±¡ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•å¿…é¡»åœ¨å­ç±»ä¸­è¢«é‡å†™**ã€‚

å…ˆæ¥çœ‹è¿™æ ·ä¸€ä¸ªæ¥å£ï¼š

```java
public interface Animal {
    void move();
}
```

æ¥å£ä¸­çš„æ–¹æ³•é»˜è®¤éƒ½æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œé€šè¿‡åç¼–è¯‘æ˜¯å¯ä»¥çœ‹å¾—åˆ°çš„ï¼š

```java
public interface Animal
{
    public abstract void move();
}
```

å¦‚æœä¸€ä¸ªæŠ½è±¡ç±»å®ç°äº† Animal æ¥å£ï¼Œ`move()` æ–¹æ³•ä¸æ˜¯å¿…é¡»è¢«é‡å†™çš„ï¼š

```java
public abstract class AbstractDog implements Animal {
    protected abstract void bark();
}
```

ä½†å¦‚æœä¸€ä¸ªç±»ç»§æ‰¿äº†æŠ½è±¡ç±» AbstractDogï¼Œé‚£ä¹ˆ Animal æ¥å£ä¸­çš„ `move()` æ–¹æ³•å’ŒæŠ½è±¡ç±» AbstractDog ä¸­çš„æŠ½è±¡æ–¹æ³• `bark()` éƒ½å¿…é¡»è¢«é‡å†™ï¼š

```java
public class BullDog extends AbstractDog {
 
    public void move() {}
 
    protected void bark() {}
}
```

#### **è§„åˆ™åï¼šsynchronized å…³é”®å­—å¯¹é‡å†™è§„åˆ™æ²¡æœ‰ä»»ä½•å½±å“**ã€‚

[synchronized å…³é”®å­—](https://tobebetterjavaer.com/thread/synchronized-1.html)ç”¨äºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è·å–å’Œé‡Šæ”¾ç›‘å¬å¯¹è±¡ï¼Œå› æ­¤å®ƒå¯¹é‡å†™è§„åˆ™æ²¡æœ‰ä»»ä½•å½±å“ï¼Œè¿™å°±æ„å‘³ç€ synchronized æ–¹æ³•å¯ä»¥å»é‡å†™ä¸€ä¸ªéåŒæ­¥æ–¹æ³•ã€‚

#### **è§„åˆ™åä¸€ï¼šstrictfp å…³é”®å­—å¯¹é‡å†™è§„åˆ™æ²¡æœ‰ä»»ä½•å½±å“**ã€‚

å¦‚æœä½ æƒ³è®©æµ®ç‚¹è¿ç®—æ›´åŠ ç²¾ç¡®ï¼Œè€Œä¸”ä¸ä¼šå› ä¸ºç¡¬ä»¶å¹³å°çš„ä¸åŒå¯¼è‡´æ‰§è¡Œçš„ç»“æœä¸ä¸€è‡´çš„è¯ï¼Œå¯ä»¥åœ¨æ–¹æ³•ä¸Šæ·»åŠ  [strictfp å…³é”®å­—ï¼Œä¹‹å‰è®²è¿‡](https://tobebetterjavaer.com/basic-extra-meal/48-keywords.html)ã€‚å› æ­¤ strictfp å…³é”®å­—å’Œé‡å†™è§„åˆ™æ— å…³ã€‚

### 03ã€æ€»ç»“

â€œå¥½äº†ï¼Œä¸‰å¦¹ï¼Œæˆ‘æ¥ç®€å•åšä¸ªæ€»ç»“ã€‚â€æˆ‘ç¥äº†ä¸€çœ¼ç”µè„‘å³ä¸Šè§’çš„æ—¶é’Ÿï¼Œç¦»ä¸‰å¦¹ç¦»å¼€çš„æ—¶é—´ä¸åˆ° 10 åˆ†é’Ÿäº†ã€‚

â€œé¦–å…ˆæ¥è¯´ä¸€ä¸‹æ–¹æ³•é‡è½½æ—¶çš„æ³¨æ„äº‹é¡¹ï¼Œâ€˜ä¸¤åŒä¸€ä¸åŒâ€™ã€‚â€

â€œâ€˜ä¸¤åŒâ€™ï¼šåœ¨åŒä¸€ä¸ªç±»ï¼Œæ–¹æ³•åç›¸åŒã€‚â€

â€œâ€˜ä¸€ä¸åŒâ€™ï¼šå‚æ•°ä¸åŒã€‚â€

â€œå†æ¥è¯´ä¸€ä¸‹æ–¹æ³•é‡å†™æ—¶çš„æ³¨æ„äº‹é¡¹ï¼Œâ€˜ä¸¤åŒä¸€å°ä¸€å¤§â€™ã€‚â€

â€œâ€˜ä¸¤åŒâ€™ï¼šæ–¹æ³•åç›¸åŒï¼Œå‚æ•°ç›¸åŒã€‚â€

â€œâ€˜ä¸€å°â€™ï¼šå­ç±»æ–¹æ³•å£°æ˜çš„å¼‚å¸¸ç±»å‹è¦æ¯”çˆ¶ç±»å°ä¸€äº›æˆ–è€…ç›¸ç­‰ã€‚â€

â€œâ€˜ä¸€å¤§â€™ï¼šå­ç±»æ–¹æ³•çš„è®¿é—®æƒé™åº”è¯¥æ¯”çˆ¶ç±»çš„æ›´å¤§æˆ–è€…ç›¸ç­‰ã€‚â€

â€œè®°ä½äº†å§ï¼Ÿä¸‰å¦¹ã€‚å¸¦ä¸Šå£ç½©ï¼Œæ‹¿å¥½æ‰‹æœºï¼Œå’±å‡†å¤‡å‡ºé—¨å§ã€‚â€ä»Šå¤©é™å·ï¼Œæ²¡æ³•å¼€è½¦é€ä¸‰å¦¹å»å­¦æ ¡äº†ã€‚


----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 5.20 Javaæ³¨è§£

â€œäºŒå“¥ï¼Œè¿™èŠ‚è®²æ³¨è§£å—ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œæ˜¯çš„ã€‚â€æˆ‘è¯´ï¼Œâ€œæ³¨è§£æ˜¯ Java ä¸­éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œä½†ç»å¸¸è¢«å¿½è§†ä¹Ÿæ˜¯çœŸçš„ã€‚ä¹‹æ‰€ä»¥è¿™ä¹ˆè¯´æ˜¯å› ä¸ºæˆ‘ä»¬æ›´å€¾å‘æˆä¸ºä¸€åæ³¨è§£çš„ä½¿ç”¨è€…è€Œä¸æ˜¯åˆ›å»ºè€…ã€‚`@Override` æ³¨è§£ç”¨è¿‡å§ï¼Ÿ[æ–¹æ³•é‡å†™](https://tobebetterjavaer.com/basic-extra-meal/override-overload.html)çš„æ—¶å€™ç”¨åˆ°è¿‡ã€‚ä½†ä½ çŸ¥é“æ€ä¹ˆè‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£å—ï¼Ÿâ€

ä¸‰å¦¹æ¯«ä¸çŠ¹è±«åœ°æ‘‡æ‘‡å¤´ï¼Œæ‘†æ‘†æ‰‹ï¼Œä¸å¥½æ„æ€åœ°æ‰¿è®¤è‡ªå·±çš„ç¡®æ²¡æœ‰è‡ªå®šä¹‰è¿‡ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/annotation/annotation-01.png)

â€œå¥½å§ï¼Œå“¥æ¥å‘Šè¯‰ä½ å§ã€‚â€

æ³¨è§£ï¼ˆAnnotationï¼‰æ˜¯åœ¨ Java 1.5 æ—¶å¼•å…¥çš„æ¦‚å¿µï¼ŒåŒ class å’Œ interface ä¸€æ ·ï¼Œä¹Ÿå±äºä¸€ç§ç±»å‹ã€‚æ³¨è§£æä¾›äº†ä¸€ç³»åˆ—æ•°æ®ç”¨æ¥è£…é¥°ç¨‹åºä»£ç ï¼ˆç±»ã€æ–¹æ³•ã€å­—æ®µç­‰ï¼‰ï¼Œä½†æ˜¯æ³¨è§£å¹¶ä¸æ˜¯æ‰€è£…é¥°ä»£ç çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå¯¹ä»£ç çš„è¿è¡Œæ•ˆæœæ²¡æœ‰ç›´æ¥å½±å“ï¼Œç”±ç¼–è¯‘å™¨å†³å®šè¯¥æ‰§è¡Œå“ªäº›æ“ä½œã€‚

æ¥çœ‹ä¸€æ®µä»£ç ã€‚

```java
public class AutowiredTest {
    @Autowired
    private String name;

    public static void main(String[] args) {
        System.out.println("æ²‰é»˜ç‹äºŒï¼Œä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜");
    }
}
```

æ³¨æ„åˆ° `@Autowired` è¿™ä¸ªæ³¨è§£äº†å§ï¼Ÿå®ƒæœ¬æ¥æ˜¯ä¸º Springï¼ˆåé¢ä¼šè®²ï¼‰å®¹å™¨æ³¨å…¥ Bean çš„ï¼Œç°åœ¨è¢«æˆ‘æ— æƒ…åœ°æ‰”åœ¨äº†å­—æ®µ name çš„èº«ä¸Šï¼Œä½†è¿™æ®µä»£ç æ‰€åœ¨çš„é¡¹ç›®ä¸­å¹¶æ²¡æœ‰å¯ç”¨ Springï¼Œæ„å‘³ç€ `@Autowired` æ³¨è§£æ­¤æ—¶åªæ˜¯ä¸€ä¸ªæ‘†è®¾ã€‚

â€œæ—¢ç„¶åªæ˜¯ä¸ªæ‘†è®¾ï¼Œé‚£ä½ è¿™ä¸ªåœ°æ–¹ä¸ºä»€ä¹ˆè¿˜è¦ç”¨ `@Autowired` å‘¢ï¼Ÿâ€ä¸‰å¦¹å¥½å¥‡åœ°é—®ã€‚

â€œå‚»å‘€ä½ ï¼Œå°±æ˜¯ç»™ä½ ä¸¾ä¸ªä¾‹å­ï¼Œè¯æ˜ï¼šæ³¨è§£å¯¹ä»£ç çš„è¿è¡Œæ•ˆæœæ²¡æœ‰ç›´æ¥å½±å“ï¼Œæ˜ç™½æˆ‘çš„ç”¨æ„äº†å§ï¼Ÿâ€æˆ‘æ¯«ä¸å®¢æ°”åœ°è¯´ã€‚

â€œå“¦ã€‚â€ä¸‰å¦¹è‹¥æœ‰æ‰€æ€åœ°è¯´ã€‚

â€œè®¤çœŸå¬å“ˆï¼Œæ¥ä¸‹æ¥ç»™ä½ è®²è®²æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸã€‚â€æˆ‘ç…äº†ç…ä¸‰å¦¹ï¼Œçœ‹å¥¹æ˜¯å¦åœ¨ä¸“æ³¨çš„å¬ï¼Œç„¶åç»§ç»­è¯´ï¼Œâ€œæ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸæœ‰ 3 ç§ç­–ç•¥ï¼Œå®šä¹‰åœ¨ RetentionPolicy æšä¸¾ä¸­ã€‚â€

1ï¼‰SOURCEï¼šåœ¨æºæ–‡ä»¶ä¸­æœ‰æ•ˆï¼Œè¢«ç¼–è¯‘å™¨ä¸¢å¼ƒã€‚

2ï¼‰CLASSï¼šåœ¨ç¼–è¯‘å™¨ç”Ÿæˆçš„å­—èŠ‚ç æ–‡ä»¶ä¸­æœ‰æ•ˆï¼Œä½†åœ¨è¿è¡Œæ—¶ä¼šè¢«å¤„ç†ç±»æ–‡ä»¶çš„ JVM ä¸¢å¼ƒã€‚

3ï¼‰RUNTIMEï¼šåœ¨è¿è¡Œæ—¶æœ‰æ•ˆã€‚è¿™ä¹Ÿæ˜¯æ³¨è§£ç”Ÿå‘½å‘¨æœŸä¸­æœ€å¸¸ç”¨çš„ä¸€ç§ç­–ç•¥ï¼Œå®ƒå…è®¸ç¨‹åºé€šè¿‡åå°„çš„æ–¹å¼è®¿é—®æ³¨è§£ï¼Œå¹¶æ ¹æ®æ³¨è§£çš„å®šä¹‰æ‰§è¡Œç›¸åº”çš„ä»£ç ã€‚

â€œç„¶åæˆ‘ä»¬æ¥è®²æ³¨è§£è£…é¥°çš„ç›®æ ‡ã€‚â€æˆ‘çœ‹ä¸‰å¦¹è¿˜åœ¨çº¿ï¼Œå°±ç»§ç»­è¯´ã€‚

æ³¨è§£çš„ç›®æ ‡å®šä¹‰äº†æ³¨è§£å°†é€‚ç”¨äºå“ªä¸€ç§çº§åˆ«çš„ Java ä»£ç ä¸Šï¼Œæœ‰äº›æ³¨è§£åªé€‚ç”¨äºæ–¹æ³•ï¼Œæœ‰äº›åªé€‚ç”¨äºæˆå‘˜å˜é‡ï¼Œæœ‰äº›åªé€‚ç”¨äºç±»ï¼Œæœ‰äº›åˆ™éƒ½é€‚ç”¨ã€‚æˆªæ­¢åˆ° Java 9ï¼Œæ³¨è§£çš„ç±»å‹ä¸€å…±æœ‰ 11 ç§ï¼Œå®šä¹‰åœ¨ ElementType æšä¸¾ä¸­ã€‚

1ï¼‰TYPEï¼šç”¨äºç±»ã€æ¥å£ã€æ³¨è§£ã€æšä¸¾

2ï¼‰FIELDï¼šç”¨äºå­—æ®µï¼ˆç±»çš„æˆå‘˜å˜é‡ï¼‰ï¼Œæˆ–è€…æšä¸¾å¸¸é‡

3ï¼‰METHODï¼šç”¨äºæ–¹æ³•

4ï¼‰PARAMETERï¼šç”¨äºæ™®é€šæ–¹æ³•æˆ–è€…æ„é€ æ–¹æ³•çš„å‚æ•°

5ï¼‰CONSTRUCTORï¼šç”¨äºæ„é€ æ–¹æ³•

6ï¼‰LOCAL_VARIABLEï¼šç”¨äºå˜é‡

7ï¼‰ANNOTATION_TYPEï¼šç”¨äºæ³¨è§£

8ï¼‰PACKAGEï¼šç”¨äºåŒ…

9ï¼‰TYPE_PARAMETERï¼šç”¨äºæ³›å‹å‚æ•°

10ï¼‰TYPE_USEï¼šç”¨äºå£°æ˜è¯­å¥ã€æ³›å‹æˆ–è€…å¼ºåˆ¶è½¬æ¢è¯­å¥ä¸­çš„ç±»å‹

11ï¼‰MODULEï¼šç”¨äºæ¨¡å—

â€œå“¥ï¼Œä½ å°†è¿™äº›æˆ‘éƒ½è®°ä¸ä½ï¼Œèƒ½ä¸èƒ½ç›´æ¥å¼€æ’¸æ³¨è§£å‘€ï¼ï¼ï¼ï¼ï¼â€ä¸‰å¦¹ä¸è€çƒ¦äº†ã€‚

â€œç¡®å®å“ˆï¼Œè¯´å†å¤šï¼Œéƒ½ä¸å¦‚æ’¸ä¸ªæ³¨è§£æ¥å¾—è®©äººå¿ƒåŠ¨ã€‚æ’¸ä¸ªä»€ä¹ˆæ ·çš„æ³¨è§£å‘¢ï¼Ÿä¸€ä¸ªå­—æ®µæ³¨è§£å§ï¼Œå®ƒç”¨æ¥æ ‡è®°å¯¹è±¡åœ¨åºåˆ—åŒ–æˆ JSON çš„æ—¶å€™è¦ä¸è¦åŒ…å«è¿™ä¸ªå­—æ®µã€‚â€æˆ‘ç¬‘ç€å¯¹ä¸‰å¦¹è¯´ï¼Œâ€œæ€ä¹ˆæ ·ï¼Ÿâ€

â€œå¥½å‘€ï¼â€

â€œæ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ã€‚â€

```java
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.FIELD)
public @interface JsonField {
    public String value() default "";
}
```

1ï¼‰JsonField æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ RUNTIMEï¼Œä¹Ÿå°±æ˜¯è¿è¡Œæ—¶æœ‰æ•ˆã€‚

2ï¼‰JsonField æ³¨è§£è£…é¥°çš„ç›®æ ‡æ˜¯ FIELDï¼Œä¹Ÿå°±æ˜¯é’ˆå¯¹å­—æ®µçš„ã€‚

3ï¼‰åˆ›å»ºæ³¨è§£éœ€è¦ç”¨åˆ° `@interface` å…³é”®å­—ã€‚

4ï¼‰JsonField æ³¨è§£æœ‰ä¸€ä¸ªå‚æ•°ï¼Œåå­—ä¸º valueï¼Œç±»å‹ä¸º Stringï¼Œé»˜è®¤å€¼ä¸ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚

â€œä¸ºä»€ä¹ˆå‚æ•°åè¦ä¸º value å‘¢ï¼Ÿæœ‰ä»€ä¹ˆç‰¹æ®Šçš„å«ä¹‰å—ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œå½“ç„¶æ˜¯æœ‰çš„ï¼Œvalue å…è®¸æ³¨è§£çš„ä½¿ç”¨è€…æä¾›ä¸€ä¸ªæ— éœ€æŒ‡å®šåå­—çš„å‚æ•°ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªå­—æ®µä¸Šä½¿ç”¨ `@JsonField(value = "æ²‰é»˜ç‹äºŒ")`ï¼Œä¹Ÿå¯ä»¥æŠŠ `value =` çœç•¥ï¼Œå˜æˆ `@JsonField("æ²‰é»˜ç‹äºŒ")`ã€‚â€æˆ‘è¯´ã€‚





â€œé‚£ `default ""` æœ‰ä»€ä¹ˆç‰¹æ®Šå«ä¹‰å—ï¼Ÿâ€ä¸‰å¦¹ç»§ç»­é—®ã€‚

â€œå½“ç„¶ä¹Ÿæ˜¯æœ‰çš„ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨ä¸€ä¸ªå­—æ®µä¸Šç›´æ¥ä½¿ç”¨ `@JsonField`ï¼Œè€Œæ— éœ€æŒ‡å®šå‚æ•°çš„åå’Œå€¼ã€‚â€æˆ‘å›ç­”è¯´ã€‚


â€œæ˜ç™½äº†ï¼Œé‚£ `@JsonField` æ³¨è§£å·²ç»æ’¸å¥½äº†ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥ä½¿ç”¨å®ƒäº†å‘€ï¼Ÿâ€ä¸‰å¦¹æ¿€åŠ¨åœ°è¯´ã€‚

â€œå—¯ï¼Œå‡è®¾æœ‰ä¸€ä¸ª Writer ç±»ï¼Œä»–æœ‰ 3 ä¸ªå­—æ®µï¼Œåˆ†åˆ«æ˜¯ ageã€name å’Œ bookNameï¼Œå 2 ä¸ªæ˜¯å¿…é¡»åºåˆ—åŒ–çš„å­—æ®µã€‚å°±å¯ä»¥è¿™æ ·æ¥ç”¨ `@JsonField` æ³¨è§£ã€‚â€æˆ‘è¯´ã€‚

```java
public class Writer {
    private int age;

    @JsonField("writerName")
    private String name;

    @JsonField
    private String bookName;

    public Writer(int age, String name, String bookName) {
        this.age = age;
        this.name = name;
        this.bookName = bookName;
    }

    // getter / setter

    @Override
    public String toString() {
        return "Writer{" +
                "age=" + age +
                ", name='" + name + '\'' +
                ", bookName='" + bookName + '\'' +
                '}';
    }
}
```

1ï¼‰name ä¸Šçš„ `@JsonField` æ³¨è§£æä¾›äº†æ˜¾å¼çš„å­—ç¬¦ä¸²å€¼ã€‚

2ï¼‰bookName ä¸Šçš„ `@JsonField` æ³¨è§£ä½¿ç”¨äº†ç¼ºçœé¡¹ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥ç¼–å†™åºåˆ—åŒ–ç±» JsonSerializerï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```java
public class JsonSerializer {
    public static String serialize(Object object) throws IllegalAccessException {
        Class<?> objectClass = object.getClass();
        Map<String, String> jsonElements = new HashMap<>();
        for (Field field : objectClass.getDeclaredFields()) {
            field.setAccessible(true);
            if (field.isAnnotationPresent(JsonField.class)) {
                jsonElements.put(getSerializedKey(field), (String) field.get(object));
            }
        }
        return toJsonString(jsonElements);
    }

    private static String getSerializedKey(Field field) {
        String annotationValue = field.getAnnotation(JsonField.class).value();
        if (annotationValue.isEmpty()) {
            return field.getName();
        } else {
            return annotationValue;
        }
    }

    private static String toJsonString(Map<String, String> jsonMap) {
        String elementsString = jsonMap.entrySet()
                .stream()
                .map(entry -> "\"" + entry.getKey() + "\":\"" + entry.getValue() + "\"")
                .collect(Collectors.joining(","));
        return "{" + elementsString + "}";
    }
}
```

â€œJsonSerializer ç±»çš„å†…å®¹çœ‹èµ·æ¥ä¼¼ä¹æœ‰ç‚¹å¤šå•Šï¼ŒäºŒå“¥ï¼Œæˆ‘æœ‰ç‚¹çœ‹ä¸æ‡‚ã€‚â€ä¸‰å¦¹è¯´ã€‚

â€œä¸è¦æ€•ï¼Œæˆ‘ä¸€ç‚¹ç‚¹æ¥è§£é‡Šï¼Œç›´åˆ°ä½ ææ˜ç™½ä¸ºæ­¢ã€‚â€

1ï¼‰`serialize()` æ–¹æ³•æ˜¯ç”¨æ¥åºåˆ—åŒ–å¯¹è±¡çš„ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ª Object ç±»å‹çš„å‚æ•°ã€‚`objectClass.getDeclaredFields()` é€šè¿‡åå°„çš„æ–¹å¼è·å–å¯¹è±¡å£°æ˜çš„æ‰€æœ‰å­—æ®µï¼Œç„¶åè¿›è¡Œ for å¾ªç¯éå†ã€‚åœ¨ for å¾ªç¯ä¸­ï¼Œå…ˆé€šè¿‡ `field.setAccessible(true)` å°†åå°„å¯¹è±¡çš„å¯è®¿é—®æ€§è®¾ç½®ä¸º trueï¼Œä¾›åºåˆ—åŒ–ä½¿ç”¨ï¼ˆå¦‚æœæ²¡æœ‰è¿™ä¸ªæ­¥éª¤çš„è¯ï¼Œprivate å­—æ®µæ˜¯æ— æ³•è·å–çš„ï¼Œä¼šæŠ›å‡º IllegalAccessException å¼‚å¸¸ï¼‰ï¼›å†é€šè¿‡ `isAnnotationPresent()` åˆ¤æ–­å­—æ®µæ˜¯å¦è£…é¥°äº† `JsonField` æ³¨è§£ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œè°ƒç”¨ `getSerializedKey()` æ–¹æ³•ï¼Œä»¥åŠè·å–è¯¥å¯¹è±¡ä¸Šç”±æ­¤å­—æ®µè¡¨ç¤ºçš„å€¼ï¼Œå¹¶æ”¾å…¥ jsonElements ä¸­ã€‚

2ï¼‰`getSerializedKey()` æ–¹æ³•ç”¨æ¥è·å–å­—æ®µä¸Šæ³¨è§£çš„å€¼ï¼Œå¦‚æœæ³¨è§£çš„å€¼æ˜¯ç©ºçš„ï¼Œåˆ™è¿”å›å­—æ®µåã€‚

3ï¼‰`toJsonString()` æ–¹æ³•å€ŸåŠ© Stream æµçš„æ–¹å¼è¿”å›æ ¼å¼åŒ–åçš„ JSON å­—ç¬¦ä¸²ã€‚Stream æµä½ è¿˜æ²¡æœ‰æ¥è§¦è¿‡ï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œåé¢æˆ‘å†ç»™ä½ è®²ã€‚

â€œç°åœ¨æ˜¯ä¸æ˜¯è±ç„¶å¼€æœ—äº†ï¼Ÿâ€æˆ‘é—®ä¸‰å¦¹ï¼Œçœ‹åˆ°ä¸‰å¦¹ç‚¹äº†ç‚¹å¤´ï¼Œæˆ‘ç»§ç»­è¯´ï¼Œâ€œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å†™ä¸€ä¸ªæµ‹è¯•ç±» JsonFieldTestã€‚â€

```java
public class JsonFieldTest {
    public static void main(String[] args) throws IllegalAccessException {
        Writer cmower = new Writer(18,"æ²‰é»˜ç‹äºŒ","Webå…¨æ ˆå¼€å‘è¿›é˜¶ä¹‹è·¯");
        System.out.println(JsonSerializer.serialize(cmower));
    }
}
```

ç¨‹åºè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š

```
{"bookName":"Webå…¨æ ˆå¼€å‘è¿›é˜¶ä¹‹è·¯","writerName":"æ²‰é»˜ç‹äºŒ"}
```

ä»ç»“æœä¸Šæ¥çœ‹ï¼š

1ï¼‰Writer ç±»çš„ age å­—æ®µæ²¡æœ‰è£…é¥° `@JsonField` æ³¨è§£ï¼Œæ‰€ä»¥æ²¡æœ‰åºåˆ—åŒ–ã€‚

2ï¼‰Writer ç±»çš„ name å­—æ®µè£…é¥°äº† `@JsonField` æ³¨è§£ï¼Œå¹¶ä¸”æ˜¾ç¤ºæŒ‡å®šäº†å­—ç¬¦ä¸²â€œwriterNameâ€ï¼Œæ‰€ä»¥åºåˆ—åŒ–åå˜æˆäº† writerNameã€‚

3ï¼‰Writer ç±»çš„ bookName å­—æ®µè£…é¥°äº† `@JsonField` æ³¨è§£ï¼Œä½†æ²¡æœ‰æ˜¾å¼æŒ‡å®šå€¼ï¼Œæ‰€ä»¥åºåˆ—åŒ–åä»ç„¶æ˜¯ bookNameã€‚

â€œæ€ä¹ˆæ ·ï¼Œä¸‰å¦¹ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿä¸æ˜¯ç‰¹åˆ«éš¾ï¼Ÿâ€æˆ‘å¯¹ä¸‰å¦¹è¯´ã€‚

â€œæ’¸ä¸ªæ³¨è§£å¥½åƒçœŸæ²¡ä»€ä¹ˆéš¾åº¦ï¼Œä½†ä½ æ¥ä¸‹æ¥çš„é‚£ä¸ª JsonSerializer æˆ‘è¿˜éœ€è¦å†æ¶ˆåŒ–ä¸€ä¸‹ã€‚â€ä¸‰å¦¹å¾ˆè®¤çœŸåœ°è¯´ã€‚

â€œå—¯ï¼Œä½ å¥½å¥½å¤ä¹ ä¸‹ï¼Œæˆ‘çœ‹ä¼šã€Šç¼–è¯‘åŸç†ã€‹ã€‚â€è¯´å®Œæˆ‘æ‹¿èµ·æ¡Œå­è¾¹ä¸Šçš„ä¸€æœ¬ä¹¦å°±èµ°äº†ã€‚


----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 5.21 Javaæšä¸¾ï¼ˆenumï¼‰

â€œä»Šå¤©æˆ‘ä»¬æ¥å­¦ä¹ æšä¸¾å§ï¼Œä¸‰å¦¹ï¼â€æˆ‘è¯´ï¼Œâ€œåŒå­¦è®©ä½ å»å¥¹å®¶ç©äº†ä¸¤å¤©ï¼Œæ„Ÿè§‰æ€ä¹ˆæ ·å‘€ï¼Ÿâ€

â€œå¿ƒæƒ…æ”¾æ¾äº†ä¸å°‘ã€‚â€ä¸‰å¦¹è¯´ï¼Œâ€œå¯ä»¥å¼€å§‹å­¦ Java äº†ï¼ŒäºŒå“¥ã€‚â€

â€œOKã€‚â€

â€œæšä¸¾ï¼ˆenumï¼‰ï¼Œæ˜¯ Java 1.5 æ—¶å¼•å…¥çš„å…³é”®å­—ï¼Œå®ƒè¡¨ç¤ºä¸€ç§ç‰¹æ®Šç±»å‹çš„ç±»ï¼Œç»§æ‰¿è‡ª java.lang.Enumã€‚â€

â€œæˆ‘ä»¬æ¥æ–°å»ºä¸€ä¸ªæšä¸¾ PlayerTypeã€‚â€

```java
public enum PlayerType {
    TENNIS,
    FOOTBALL,
    BASKETBALL
}
```

â€œäºŒå“¥ï¼Œæˆ‘æ²¡çœ‹åˆ°æœ‰ç»§æ‰¿å…³ç³»å‘€ï¼â€

â€œåˆ«ç€æ€¥ï¼Œçœ‹ä¸€ä¸‹åç¼–è¯‘åçš„å­—èŠ‚ç ï¼Œä½ å°±æ˜ç™½äº†ã€‚â€

```java
public final class PlayerType extends Enum
{

    public static PlayerType[] values()
    {
        return (PlayerType[])$VALUES.clone();
    }

    public static PlayerType valueOf(String name)
    {
        return (PlayerType)Enum.valueOf(com/cmower/baeldung/enum1/PlayerType, name);
    }

    private PlayerType(String s, int i)
    {
        super(s, i);
    }

    public static final PlayerType TENNIS;
    public static final PlayerType FOOTBALL;
    public static final PlayerType BASKETBALL;
    private static final PlayerType $VALUES[];

    static 
    {
        TENNIS = new PlayerType("TENNIS", 0);
        FOOTBALL = new PlayerType("FOOTBALL", 1);
        BASKETBALL = new PlayerType("BASKETBALL", 2);
        $VALUES = (new PlayerType[] {
            TENNIS, FOOTBALL, BASKETBALL
        });
    }
}
```

â€œçœ‹åˆ°æ²¡ï¼ŸJava ç¼–è¯‘å™¨å¸®æˆ‘ä»¬åšäº†å¾ˆå¤šéšå¼çš„å·¥ä½œï¼Œä¸ç„¶æ‰‹å†™ä¸€ä¸ªæšä¸¾å°±æ²¡é‚£ä¹ˆçœå¿ƒçœäº‹äº†ã€‚â€

- è¦ç»§æ‰¿ Enum ç±»ï¼›
- è¦å†™æ„é€ æ–¹æ³•ï¼›
- è¦å£°æ˜é™æ€å˜é‡å’Œæ•°ç»„ï¼›
- è¦ç”¨ static å—æ¥åˆå§‹åŒ–é™æ€å˜é‡å’Œæ•°ç»„ï¼›
- è¦æä¾›é™æ€æ–¹æ³•ï¼Œæ¯”å¦‚è¯´ `values()` å’Œ  `valueOf(String name)`ã€‚

â€œç¡®å®ï¼Œä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬çš„ä»£ç é‡å‡å°‘äº†ï¼Œæšä¸¾çœ‹èµ·æ¥ç®€æ´æ˜äº†ã€‚â€ä¸‰å¦¹è¯´ã€‚

â€œæ—¢ç„¶æšä¸¾æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»ï¼Œé‚£å®ƒå…¶å®æ˜¯å¯ä»¥å®šä¹‰åœ¨ä¸€ä¸ªç±»çš„å†…éƒ¨çš„ï¼Œè¿™æ ·å®ƒçš„ä½œç”¨åŸŸå°±å¯ä»¥é™å®šäºè¿™ä¸ªå¤–éƒ¨ç±»ä¸­ä½¿ç”¨ã€‚â€æˆ‘è¯´ã€‚

```java
public class Player {
    private PlayerType type;
    public enum PlayerType {
        TENNIS,
        FOOTBALL,
        BASKETBALL
    }
    
    public boolean isBasketballPlayer() {
      return getType() == PlayerType.BASKETBALL;
    }

    public PlayerType getType() {
        return type;
    }

    public void setType(PlayerType type) {
        this.type = type;
    }
}
```

PlayerType å°±ç›¸å½“äº Player çš„å†…éƒ¨ç±»ã€‚

ç”±äºæšä¸¾æ˜¯ final çš„ï¼Œæ‰€ä»¥å¯ä»¥ç¡®ä¿åœ¨ Java è™šæ‹Ÿæœºä¸­ä»…æœ‰ä¸€ä¸ªå¸¸é‡å¯¹è±¡ï¼ŒåŸºäºè¿™ä¸ªåŸå› ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€œ==â€è¿ç®—ç¬¦æ¥æ¯”è¾ƒä¸¤ä¸ªæšä¸¾æ˜¯å¦ç›¸ç­‰ï¼Œå‚ç…§ `isBasketballPlayer()` æ–¹æ³•ã€‚

â€œé‚£ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ `equals()` æ–¹æ³•åˆ¤æ–­å‘¢ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

```java
if(player.getType().equals(Player.PlayerType.BASKETBALL)){};
```

â€œæˆ‘æ¥ç»™ä½ è§£é‡Šä¸‹ã€‚â€

â€œ==â€è¿ç®—ç¬¦æ¯”è¾ƒçš„æ—¶å€™ï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡éƒ½ä¸º nullï¼Œå¹¶ä¸ä¼šå‘ç”Ÿ `NullPointerException`ï¼Œè€Œ `equals()` æ–¹æ³•åˆ™ä¼šã€‚

å¦å¤–ï¼Œ â€œ==â€è¿ç®—ç¬¦ä¼šåœ¨ç¼–è¯‘æ—¶è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœä¸¤ä¾§çš„ç±»å‹ä¸åŒ¹é…ï¼Œä¼šæç¤ºé”™è¯¯ï¼Œè€Œ `equals()` æ–¹æ³•åˆ™ä¸ä¼šã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/enum/enum-01.png)

â€œæšä¸¾è¿˜å¯ç”¨äº switch è¯­å¥ï¼Œå’ŒåŸºæœ¬æ•°æ®ç±»å‹çš„ç”¨æ³•ä¸€è‡´ã€‚â€æˆ‘è¯´ã€‚

```java
switch (playerType) {
    case TENNIS:
        return "ç½‘çƒè¿åŠ¨å‘˜è´¹å¾·å‹’";
    case FOOTBALL:
        return "è¶³çƒè¿åŠ¨å‘˜Cç½—";
    case BASKETBALL:
        return "ç¯®çƒè¿åŠ¨å‘˜è©¹å§†æ–¯";
    case UNKNOWN:
        throw new IllegalArgumentException("æœªçŸ¥");
    default:
        throw new IllegalArgumentException(
                "è¿åŠ¨å‘˜ç±»å‹: " + playerType);

}
```

â€œå¦‚æœæšä¸¾ä¸­éœ€è¦åŒ…å«æ›´å¤šä¿¡æ¯çš„è¯ï¼Œå¯ä»¥ä¸ºå…¶æ·»åŠ ä¸€äº›å­—æ®µï¼Œæ¯”å¦‚ä¸‹é¢ç¤ºä¾‹ä¸­çš„ nameï¼Œæ­¤æ—¶éœ€è¦ä¸ºæšä¸¾æ·»åŠ ä¸€ä¸ªå¸¦å‚çš„æ„é€ æ–¹æ³•ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨å®šä¹‰æšä¸¾æ—¶æ·»åŠ å¯¹åº”çš„åç§°äº†ã€‚â€æˆ‘ç»§ç»­è¯´ã€‚

```java
public enum PlayerType {
    TENNIS("ç½‘çƒ"),
    FOOTBALL("è¶³çƒ"),
    BASKETBALL("ç¯®çƒ");

    private String name;

    PlayerType(String name) {
        this.name = name;
    }
}
```

â€œget äº†å§ï¼Œä¸‰å¦¹ï¼Ÿâ€

â€œå—¯ï¼Œæ¯”è¾ƒå¥½ç†è§£ã€‚â€

â€œé‚£æ¥ä¸‹æ¥ï¼Œæˆ‘å°±æ¥è¯´ç‚¹ä¸ä¸€æ ·çš„ã€‚â€

â€œæ¥å§ï¼Œæˆ‘å‡†å¤‡å¥½äº†ã€‚â€

â€œEnumSet æ˜¯ä¸€ä¸ªä¸“é—¨é’ˆå¯¹æšä¸¾ç±»å‹çš„ [Set æ¥å£](https://tobebetterjavaer.com/collection/gailan.html)ï¼ˆåé¢ä¼šè®²ï¼‰çš„å®ç°ç±»ï¼Œå®ƒæ˜¯å¤„ç†æšä¸¾ç±»å‹æ•°æ®çš„ä¸€æŠŠåˆ©å™¨ï¼Œéå¸¸é«˜æ•ˆã€‚â€æˆ‘è¯´ï¼Œâ€œä»åå­—ä¸Šå°±å¯ä»¥çœ‹å¾—å‡ºï¼ŒEnumSet ä¸ä»…å’Œ Set æœ‰å…³ç³»ï¼Œå’Œæšä¸¾ä¹Ÿæœ‰å…³ç³»ã€‚â€

â€œå› ä¸º EnumSet æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ‰€ä»¥åˆ›å»º EnumSet æ—¶ä¸èƒ½ä½¿ç”¨ new å…³é”®å­—ã€‚ä¸è¿‡ï¼ŒEnumSet æä¾›äº†å¾ˆå¤šæœ‰ç”¨çš„é™æ€å·¥å‚æ–¹æ³•ã€‚â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/enum/enum-02.png)

â€œæ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `noneOf()` é™æ€å·¥å‚æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªç©ºçš„ PlayerType ç±»å‹çš„ EnumSetï¼›ä½¿ç”¨ `allOf()` é™æ€å·¥å‚æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«æ‰€æœ‰ PlayerType ç±»å‹çš„ EnumSetã€‚â€

```java
public class EnumSetTest {
    public enum PlayerType {
        TENNIS,
        FOOTBALL,
        BASKETBALL
    }

    public static void main(String[] args) {
        EnumSet<PlayerType> enumSetNone = EnumSet.noneOf(PlayerType.class);
        System.out.println(enumSetNone);

        EnumSet<PlayerType> enumSetAll = EnumSet.allOf(PlayerType.class);
        System.out.println(enumSetAll);
    }
}
```

â€œæ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœã€‚â€

```java
[]
[TENNIS, FOOTBALL, BASKETBALL]
```

æœ‰äº† EnumSet åï¼Œå°±å¯ä»¥ä½¿ç”¨ Set çš„ä¸€äº›æ–¹æ³•äº†ï¼Œè§ä¸‹å›¾ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/enum/enum-03.png)

â€œé™¤äº† EnumSetï¼Œè¿˜æœ‰ EnumMapï¼Œæ˜¯ä¸€ä¸ªä¸“é—¨é’ˆå¯¹æšä¸¾ç±»å‹çš„ Map æ¥å£çš„å®ç°ç±»ï¼Œå®ƒå¯ä»¥å°†æšä¸¾å¸¸é‡ä½œä¸ºé”®æ¥ä½¿ç”¨ã€‚EnumMap çš„æ•ˆç‡æ¯” HashMap è¿˜è¦é«˜ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡æ•°ç»„ä¸‹æ ‡ï¼ˆæšä¸¾çš„ ordinal å€¼ï¼‰è®¿é—®åˆ°å…ƒç´ ã€‚â€

â€œå’Œ EnumSet ä¸åŒï¼ŒEnumMap ä¸æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ‰€ä»¥åˆ›å»º EnumMap æ—¶å¯ä»¥ä½¿ç”¨ new å…³é”®å­—ã€‚â€

```java
EnumMap<PlayerType, String> enumMap = new EnumMap<>(PlayerType.class);
```

æœ‰äº† EnumMap å¯¹è±¡åå°±å¯ä»¥ä½¿ç”¨ Map çš„ä¸€äº›æ–¹æ³•äº†ï¼Œè§ä¸‹å›¾ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/enum/enum-04.png)

å’Œ [HashMap](https://tobebetterjavaer.com/collection/hashmap.html)ï¼ˆåé¢ä¼šè®²ï¼‰çš„ä½¿ç”¨æ–¹æ³•å¤§è‡´ç›¸åŒï¼Œæ¥çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚

```java
EnumMap<PlayerType, String> enumMap = new EnumMap<>(PlayerType.class);
enumMap.put(PlayerType.BASKETBALL,"ç¯®çƒè¿åŠ¨å‘˜");
enumMap.put(PlayerType.FOOTBALL,"è¶³çƒè¿åŠ¨å‘˜");
enumMap.put(PlayerType.TENNIS,"ç½‘çƒè¿åŠ¨å‘˜");
System.out.println(enumMap);

System.out.println(enumMap.get(PlayerType.BASKETBALL));
System.out.println(enumMap.containsKey(PlayerType.BASKETBALL));
System.out.println(enumMap.remove(PlayerType.BASKETBALL));
```

â€œæ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœã€‚â€

```
{TENNIS=ç½‘çƒè¿åŠ¨å‘˜, FOOTBALL=è¶³çƒè¿åŠ¨å‘˜, BASKETBALL=ç¯®çƒè¿åŠ¨å‘˜}
ç¯®çƒè¿åŠ¨å‘˜
true
ç¯®çƒè¿åŠ¨å‘˜
```

â€œé™¤äº†ä»¥ä¸Šè¿™äº›ï¼Œã€ŠEffective Javaã€‹è¿™æœ¬ä¹¦é‡Œè¿˜æåˆ°äº†ä¸€ç‚¹ï¼Œå¦‚æœè¦å®ç°å•ä¾‹çš„è¯ï¼Œæœ€å¥½ä½¿ç”¨æšä¸¾çš„æ–¹å¼ã€‚â€æˆ‘è¯´ã€‚

â€œç­‰ç­‰äºŒå“¥ï¼Œå•ä¾‹æ˜¯ä»€ä¹ˆï¼Ÿâ€ä¸‰å¦¹æ²¡ç­‰æˆ‘å¾€ä¸‹è¯´ï¼Œå°±è¿å¿™é—®é“ã€‚

â€œå•ä¾‹ï¼ˆSingletonï¼‰ç”¨æ¥ä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ï¼Œåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ã€‚å› ä¸ºè¿™ä¸ªç±»åªæœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥å°±ä¸èƒ½å†ä½¿ç”¨ `new` å…³é”®å­—æ¥åˆ›å»ºæ–°çš„å¯¹è±¡äº†ã€‚â€

â€œJava æ ‡å‡†åº“æœ‰ä¸€äº›ç±»å°±æ˜¯å•ä¾‹ï¼Œæ¯”å¦‚è¯´ Runtime è¿™ä¸ªç±»ã€‚â€

```java
Runtime runtime = Runtime.getRuntime();
```

â€œRuntime ç±»å¯ä»¥ç”¨æ¥è·å– Java ç¨‹åºè¿è¡Œæ—¶çš„ç¯å¢ƒã€‚â€

â€œå…³äºå•ä¾‹ï¼Œæ‡‚äº†äº›å§ï¼Ÿâ€æˆ‘é—®ä¸‰å¦¹ã€‚

â€œå™¢å™¢å™¢å™¢ã€‚â€ä¸‰å¦¹ç‚¹äº†ç‚¹å¤´ã€‚

â€œé€šå¸¸æƒ…å†µä¸‹ï¼Œå®ç°å•ä¾‹å¹¶éæ˜“äº‹ï¼Œæ¥çœ‹ä¸‹é¢è¿™ç§å†™æ³•ã€‚â€

```java
public class Singleton {  
    private volatile static Singleton singleton; 
    private Singleton (){}  
    public static Singleton getSingleton() {  
    if (singleton == null) {
        synchronized (Singleton.class) { 
        if (singleton == null) {  
            singleton = new Singleton(); 
        }  
        }  
    }  
    return singleton;  
    }  
}
```

â€œè¦ç”¨åˆ° [volatile](https://tobebetterjavaer.com/thread/volatile.html)ã€[synchronized](https://tobebetterjavaer.com/thread/synchronized-1.html) å…³é”®å­—ç­‰ç­‰ï¼Œä½†æšä¸¾çš„å‡ºç°ï¼Œè®©ä»£ç é‡å‡å°‘åˆ°æè‡´ã€‚â€

```java
public enum EasySingleton{
    INSTANCE;
}
```

â€œå°±è¿™ï¼Ÿâ€ä¸‰å¦¹çå¤§äº†çœ¼ç›ã€‚

â€œå¯¹å•Šï¼Œæšä¸¾é»˜è®¤å®ç°äº† [Serializable æ¥å£](https://tobebetterjavaer.com/io/Serializbale.html)ï¼Œå› æ­¤ Java è™šæ‹Ÿæœºå¯ä»¥ä¿è¯è¯¥ç±»ä¸ºå•ä¾‹ï¼Œè¿™ä¸ä¼ ç»Ÿçš„å®ç°æ–¹å¼ä¸å¤§ç›¸åŒã€‚ä¼ ç»Ÿæ–¹å¼ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿å•ä¾‹åœ¨ååºåˆ—åŒ–æœŸé—´ä¸èƒ½åˆ›å»ºä»»ä½•æ–°å®ä¾‹ã€‚â€æˆ‘è¯´ã€‚

â€œå¥½äº†ï¼Œå…³äºæšä¸¾å°±è®²è¿™ä¹ˆå¤šå§ï¼Œä¸‰å¦¹ï¼Œä½ æŠŠè¿™äº›ä»£ç éƒ½æ‰‹æ•²ä¸€éå§ï¼â€

â€œå¥½å‹’ï¼Œè¿™å°±å®‰æ’ã€‚äºŒå“¥ï¼Œä½ å»ä¼‘æ¯å§ã€‚â€

â€œå—¯å—¯ã€‚â€è®²äº†è¿™ä¹ˆå¤šï¼Œå¿…é¡»è·‘å»æŠ½çƒŸæœºé‚£é‡Œå®‰æ’ä¸€æ ¹åå­äº†ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

# ç¬¬å…­ç« ï¼šJava é›†åˆæ¡†æ¶



## 6.1 Listã€Setã€Mapã€é˜Ÿåˆ—ï¼Œå…¨é¢è§£æ

çœ¼ç…ç€ä¸‰å¦¹çš„ç‹è€…è£è€€æ€å¾—æ­£å—¨ï¼Œæˆ‘è¶æœºå–Šåˆ°ï¼šâ€œåˆ«æ‰“äº†ï¼Œä¸‰å¦¹ï¼Œæˆ‘ä»¬æ¥ä¸€èµ·å­¦ä¹  Java çš„é›†åˆæ¡†æ¶å§ã€‚â€

â€œæ‰ä¸è¦å‘¢ï¼Œç­‰æˆ‘æ‰“å®Œè¿™ä¸€å±€å•Šã€‚â€ä¸‰å¦¹å€”å¼ºåœ°è¯´ã€‚

â€œå¥½å§ã€‚â€æˆ‘åªå¥½æ‘Šæ‘Šæ‰‹åœ°è¯´ï¼Œâ€œé‚£æˆ‘å…ˆç”»å¼ é›†åˆæ¡†æ¶çš„ç»“æ„å›¾ç­‰ç€ä½ ã€‚â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/gailan-01.png)


â€œå®Œäº†æ²¡ï¼Ÿä¸‰å¦¹ã€‚â€

â€œå®Œäº†å¥½ä¸€ä¼šå„¿äº†ï¼ŒäºŒå“¥ï¼Œä½ å›¾ç”»å¾—çœŸæ…¢ï¼Œè®©æˆ‘ç§ç§æ€ä¹ˆæ ·ï¼Ÿâ€

â€œå®³ï¼Œå›¾è¦ç”»å¾—æ¸…æ™°æ˜äº†ï¼Œä¸å®¹æ˜“çš„ã€‚ä¸‰å¦¹ï¼Œä½ ç§ï¼Œä¸é”™å§ã€‚â€

â€œå“‡ï¼Œæœç„¶å¾ˆæ£’ï¼Œå“¥ï¼Œä½ å¯çœŸè®¤çœŸï¼â€

â€œæˆ‘æ¥ç®€å•ä»‹ç»ä¸€ä¸‹å§ï¼ŒJava é›†åˆæ¡†æ¶å¯ä»¥åˆ†ä¸ºä¸¤æ¡å¤§çš„æ”¯çº¿ï¼šâ€

- Collectionï¼Œä¸»è¦ç”± Listã€Setã€Queue ç»„æˆï¼ŒList ä»£è¡¨æœ‰åºã€å¯é‡å¤çš„é›†åˆï¼Œå…¸å‹ä»£è¡¨å°±æ˜¯å°è£…äº†åŠ¨æ€æ•°ç»„çš„ ArrayList å’Œå°è£…äº†é“¾è¡¨çš„ LinkedListï¼›Set ä»£è¡¨æ— åºã€ä¸å¯é‡å¤çš„é›†åˆï¼Œå…¸å‹ä»£è¡¨å°±æ˜¯ HashSet å’Œ TreeSetï¼›Queue ä»£è¡¨é˜Ÿåˆ—ï¼Œå…¸å‹ä»£è¡¨å°±æ˜¯åŒç«¯é˜Ÿåˆ— ArrayDequeï¼Œä»¥åŠä¼˜å…ˆçº§é˜Ÿåˆ— PriorityQueueã€‚
- Mapï¼Œä»£è¡¨é”®å€¼å¯¹çš„é›†åˆï¼Œå…¸å‹ä»£è¡¨å°±æ˜¯ HashMapã€‚

### 01ã€List

List çš„ç‰¹ç‚¹æ˜¯å­˜å–æœ‰åºï¼Œå¯ä»¥å­˜æ”¾é‡å¤çš„å…ƒç´ ï¼Œå¯ä»¥ç”¨ä¸‹æ ‡å¯¹å…ƒç´ è¿›è¡Œæ“ä½œã€‚

#### **1ï¼‰ArrayList**

å…ˆæ¥ä¸€æ®µ ArrayList çš„å¢åˆ æ”¹æŸ¥ï¼Œå­¦ä¼šç”¨ã€‚

```java
// åˆ›å»ºä¸€ä¸ªé›†åˆ
ArrayList<String> list = new ArrayList<String>();
// æ·»åŠ å…ƒç´ 
list.add("ç‹äºŒ");
list.add("æ²‰é»˜");
list.add("é™ˆæ¸…æ‰¬");

// éå†é›†åˆ for å¾ªç¯
for (int i = 0; i < list.size(); i++) {
    String s = list.get(i);
    System.out.println(s);
}
// éå†é›†åˆ for each
for (String s : list) {
    System.out.println(s);
}

// åˆ é™¤å…ƒç´ 
list.remove(1);
// éå†é›†åˆ
for (String s : list) {
    System.out.println(s);
}

// ä¿®æ”¹å…ƒç´ 
list.set(1, "ç‹äºŒç‹—");
// éå†é›†åˆ
for (String s : list) {
    System.out.println(s);
}
```

ç®€å•ä»‹ç»ä¸€ä¸‹ ArrayList çš„ç‰¹å¾ï¼Œ[åé¢è¿˜ä¼šè¯¦ç»†è®²](https://tobebetterjavaer.com/collection/arraylist.html)ã€‚

- ArrayList æ˜¯ç”±æ•°ç»„å®ç°çš„ï¼Œæ”¯æŒéšæœºå­˜å–ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥é€šè¿‡ä¸‹æ ‡ç›´æ¥å­˜å–å…ƒç´ ï¼›
- ä»å°¾éƒ¨æ’å…¥å’Œåˆ é™¤å…ƒç´ ä¼šæ¯”è¾ƒå¿«æ·ï¼Œä»ä¸­é—´æ’å…¥å’Œåˆ é™¤å…ƒç´ ä¼šæ¯”è¾ƒä½æ•ˆï¼Œå› ä¸ºæ¶‰åŠåˆ°æ•°ç»„å…ƒç´ çš„å¤åˆ¶å’Œç§»åŠ¨ï¼›
- å¦‚æœå†…éƒ¨æ•°ç»„çš„å®¹é‡ä¸è¶³æ—¶ä¼šè‡ªåŠ¨æ‰©å®¹ï¼Œå› æ­¤å½“å…ƒç´ éå¸¸åºå¤§çš„æ—¶å€™ï¼Œæ•ˆç‡ä¼šæ¯”è¾ƒä½ã€‚

#### **2ï¼‰LinkedList**

åŒæ ·å…ˆæ¥ä¸€æ®µ LinkedList çš„å¢åˆ æ”¹æŸ¥ï¼Œå’Œ ArrayList å‡ ä¹æ²¡ä»€ä¹ˆå·®åˆ«ã€‚

```java
// åˆ›å»ºä¸€ä¸ªé›†åˆ
LinkedList<String> list = new LinkedList<String>();
// æ·»åŠ å…ƒç´ 
list.add("ç‹äºŒ");
list.add("æ²‰é»˜");
list.add("é™ˆæ¸…æ‰¬");

// éå†é›†åˆ for å¾ªç¯
for (int i = 0; i < list.size(); i++) {
    String s = list.get(i);
    System.out.println(s);
}
// éå†é›†åˆ for each
for (String s : list) {
    System.out.println(s);
}

// åˆ é™¤å…ƒç´ 
list.remove(1);
// éå†é›†åˆ
for (String s : list) {
    System.out.println(s);
}

// ä¿®æ”¹å…ƒç´ 
list.set(1, "ç‹äºŒç‹—");
// éå†é›†åˆ
for (String s : list) {
    System.out.println(s);
}
```

ä¸è¿‡ï¼ŒLinkedList å’Œ ArrayList ä»ç„¶æœ‰è¾ƒå¤§çš„ä¸åŒï¼Œ[åé¢ä¹Ÿä¼šè¯¦ç»†åœ°è®²](https://tobebetterjavaer.com/collection/linkedlist.html)ã€‚

- LinkedList æ˜¯ç”±åŒå‘é“¾è¡¨å®ç°çš„ï¼Œä¸æ”¯æŒéšæœºå­˜å–ï¼Œåªèƒ½ä»ä¸€ç«¯å¼€å§‹éå†ï¼Œç›´åˆ°æ‰¾åˆ°éœ€è¦çš„å…ƒç´ åè¿”å›ï¼›
- ä»»æ„ä½ç½®æ’å…¥å’Œåˆ é™¤å…ƒç´ éƒ½å¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºåªéœ€è¦æ”¹å˜å‰ä¸€ä¸ªèŠ‚ç‚¹å’Œåä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨å³å¯ï¼Œä¸åƒ ArrayList é‚£æ ·éœ€è¦å¤åˆ¶å’Œç§»åŠ¨æ•°ç»„å…ƒç´ ï¼›
- å› ä¸ºæ¯ä¸ªå…ƒç´ éƒ½å­˜å‚¨äº†å‰ä¸€ä¸ªå’Œåä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ï¼Œæ‰€ä»¥ç›¸å¯¹æ¥è¯´ï¼Œå ç”¨çš„å†…å­˜ç©ºé—´ä¼šæ¯” ArrayList å¤šä¸€äº›ã€‚

#### **3ï¼‰Vector å’Œ Stack**

List çš„å®ç°ç±»è¿˜æœ‰ä¸€ä¸ª Vectorï¼Œæ˜¯ä¸€ä¸ªå…ƒè€çº§çš„ç±»ï¼Œæ¯” ArrayList å‡ºç°å¾—æ›´æ—©ã€‚ArrayList å’Œ Vector éå¸¸ç›¸ä¼¼ï¼Œåªä¸è¿‡ Vector æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåƒ getã€setã€add è¿™äº›æ–¹æ³•éƒ½åŠ äº† `synchronized` å…³é”®å­—ï¼Œå°±å¯¼è‡´æ‰§è¡Œæ‰§è¡Œæ•ˆç‡ä¼šæ¯”è¾ƒä½ï¼Œæ‰€ä»¥ç°åœ¨å·²ç»å¾ˆå°‘ç”¨äº†ã€‚

æˆ‘å°±ä¸å†™å¤ªå¤šä»£ç äº†ï¼Œåªçœ‹ä¸€ä¸‹ add æ–¹æ³•çš„æºç å°±æ˜ç™½äº†ã€‚

```java
public synchronized boolean add(E e) {
    elementData[elementCount++] = e;
    return true;
}
```

è¿™ç§åŠ äº†åŒæ­¥æ–¹æ³•çš„ç±»ï¼Œæ³¨å®šä¼šè¢«æ·˜æ±°æ‰ï¼Œå°±åƒ[StringBuilderå–ä»£StringBuffer](https://tobebetterjavaer.com/string/builder-buffer.html)é‚£æ ·ã€‚JDK æºç ä¹Ÿè¯´äº†ï¼š

>å¦‚æœä¸éœ€è¦çº¿ç¨‹å®‰å…¨ï¼Œå»ºè®®ä½¿ç”¨ArrayListä»£æ›¿Vectorã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection//gailan-20bfd65a-1f1d-4de7-a3e3-3dda739e6f9d.png)

Stack æ˜¯ Vector çš„ä¸€ä¸ªå­ç±»ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯ç”±åŠ¨æ€æ•°ç»„å®ç°çš„ï¼Œåªä¸è¿‡è¿˜å®ç°äº†å…ˆè¿›åå‡ºçš„åŠŸèƒ½ï¼ˆåœ¨ getã€setã€add æ–¹æ³•çš„åŸºç¡€ä¸Šè¿½åŠ äº† popã€Œè¿”å›å¹¶ç§»é™¤æ ˆé¡¶çš„å…ƒç´ ã€ã€peekã€Œåªè¿”å›æ ˆé¡¶å…ƒç´ ã€ç­‰æ–¹æ³•ï¼‰ï¼Œæ‰€ä»¥å«æ ˆã€‚

ä¸‹é¢æ˜¯è¿™ä¸¤ä¸ªæ–¹æ³•çš„æºç ï¼Œå¢åˆ æ”¹æŸ¥æˆ‘å°±ä¸å†™äº†ï¼Œå’Œ ArrayList å’Œ LinkedList å‡ ä¹ä¸€æ ·ã€‚

```java
public synchronized E pop() {
    E       obj;
    int     len = size();

    obj = peek();
    removeElementAt(len - 1);

    return obj;
}

public synchronized E peek() {
    int     len = size();

    if (len == 0)
        throw new EmptyStackException();
    return elementAt(len - 1);
}
```

ä¸è¿‡ï¼Œç”±äº Stack æ‰§è¡Œæ•ˆç‡æ¯”è¾ƒä½ï¼ˆæ–¹æ³•ä¸ŠåŒæ ·åŠ äº† synchronized å…³é”®å­—ï¼‰ï¼Œå°±è¢«åŒç«¯é˜Ÿåˆ— ArrayDeque å–ä»£äº†ï¼ˆä¸‹é¢ä¼šä»‹ç»ï¼‰ã€‚

### 02ã€Set

Set çš„ç‰¹ç‚¹æ˜¯å­˜å–æ— åºï¼Œä¸å¯ä»¥å­˜æ”¾é‡å¤çš„å…ƒç´ ï¼Œä¸å¯ä»¥ç”¨ä¸‹æ ‡å¯¹å…ƒç´ è¿›è¡Œæ“ä½œï¼Œå’Œ List æœ‰å¾ˆå¤šä¸åŒã€‚

#### **1ï¼‰HashSet**

HashSet å…¶å®æ˜¯ç”± HashMap å®ç°çš„ï¼Œåªä¸è¿‡å€¼ç”±ä¸€ä¸ªå›ºå®šçš„ Object å¯¹è±¡å¡«å……ï¼Œè€Œé”®ç”¨äºæ“ä½œã€‚æ¥ç®€å•çœ‹ä¸€ä¸‹å®ƒçš„æºç ã€‚

```java
public class HashSet<E>
    extends AbstractSet<E>
    implements Set<E>, Cloneable, java.io.Serializable
{
    private transient HashMap<E,Object> map;

    // Dummy value to associate with an Object in the backing Map
    private static final Object PRESENT = new Object();

    public HashSet() {
        map = new HashMap<>();
    }

    public boolean add(E e) {
        return map.put(e, PRESENT)==null;
    }

    public boolean remove(Object o) {
        return map.remove(o)==PRESENT;
    }
}
```

å®é™…å¼€å‘ä¸­ï¼ŒHashSet å¹¶ä¸å¸¸ç”¨ï¼Œæ¯”å¦‚ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æŒ‰ç…§é¡ºåºå­˜å‚¨ä¸€ç»„å…ƒç´ ï¼Œé‚£ä¹ˆArrayListå’ŒLinkedListå¯èƒ½æ›´é€‚åˆï¼›å¦‚æœæˆ‘ä»¬éœ€è¦å­˜å‚¨é”®å€¼å¯¹å¹¶æ ¹æ®é”®è¿›è¡ŒæŸ¥æ‰¾ï¼Œé‚£ä¹ˆHashMapå¯èƒ½æ›´é€‚åˆã€‚

å½“ç„¶ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒHashSetä»ç„¶æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬éœ€è¦å¿«é€ŸæŸ¥æ‰¾ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºæŸä¸ªé›†åˆä¸­ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸éœ€è¦å¯¹å…ƒç´ è¿›è¡Œæ’åºæ—¶ï¼ŒHashSetå¯ä»¥æä¾›é«˜æ•ˆçš„æ€§èƒ½ã€‚

æ¥ä¸€æ®µå¢åˆ æ”¹æŸ¥ä½“éªŒä¸€ä¸‹ï¼š

```java
// åˆ›å»ºä¸€ä¸ªæ–°çš„HashSet
HashSet<String> set = new HashSet<>();

// æ·»åŠ å…ƒç´ 
set.add("æ²‰é»˜");
set.add("ç‹äºŒ");
set.add("é™ˆæ¸…æ‰¬");

// è¾“å‡ºHashSetçš„å…ƒç´ ä¸ªæ•°
System.out.println("HashSet size: " + set.size()); // output: 3

// åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨äºHashSetä¸­
boolean containsWanger = set.contains("ç‹äºŒ");
System.out.println("Does set contain 'ç‹äºŒ'? " + containsWanger); // output: true

// åˆ é™¤å…ƒç´ 
boolean removeWanger = set.remove("ç‹äºŒ");
System.out.println("Removed 'ç‹äºŒ'? " + removeWanger); // output: true

// ä¿®æ”¹å…ƒç´ ï¼Œéœ€è¦å…ˆåˆ é™¤åæ·»åŠ 
boolean removeChenmo = set.remove("æ²‰é»˜");
boolean addBuChenmo = set.add("ä¸æ²‰é»˜");
System.out.println("Modified set? " + (removeChenmo && addBuChenmo)); // output: true

// è¾“å‡ºä¿®æ”¹åçš„HashSet
System.out.println("HashSet after modification: " + set); // output: [é™ˆæ¸…æ‰¬, ä¸æ²‰é»˜]
```


#### **2ï¼‰LinkedHashSet**

LinkedHashSet è™½ç„¶ç»§æ‰¿è‡ª HashSetï¼Œå…¶å®æ˜¯ç”± [LinkedHashMap](https://tobebetterjavaer.com/collection/linkedhashmap.html) å®ç°çš„ã€‚

è¿™æ˜¯ LinkedHashSet çš„æ— å‚æ„é€ æ–¹æ³•ï¼š

```java
public LinkedHashSet() {
    super(16, .75f, true);
}
```

[super](https://tobebetterjavaer.com/oo/this-super.html) çš„æ„æ€æ˜¯å®ƒå°†è°ƒç”¨çˆ¶ç±»çš„ HashSet çš„ä¸€ä¸ªæœ‰å‚æ„é€ æ–¹æ³•ï¼š

```java
HashSet(int initialCapacity, float loadFactor, boolean dummy) {
    map = new LinkedHashMap<>(initialCapacity, loadFactor);
}
```

çœ‹åˆ° [LinkedHashMap](https://tobebetterjavaer.com/collection/linkedhashmap.html) äº†å§ï¼Œè¿™ä¸ªæˆ‘ä»¬åé¢ä¼šå»è®²ã€‚

å¥½å§ï¼Œæ¥çœ‹ä¸€æ®µ LinkedHashSet çš„å¢åˆ æ”¹æŸ¥å§ã€‚

```java
LinkedHashSet<String> set = new LinkedHashSet<>();

// æ·»åŠ å…ƒç´ 
set.add("æ²‰é»˜");
set.add("ç‹äºŒ");
set.add("é™ˆæ¸…æ‰¬");

// åˆ é™¤å…ƒç´ 
set.remove("ç‹äºŒ");

// ä¿®æ”¹å…ƒç´ 
set.remove("æ²‰é»˜");
set.add("æ²‰é»˜çš„åŠ›é‡");

// æŸ¥æ‰¾å…ƒç´ 
boolean hasChenQingYang = set.contains("é™ˆæ¸…æ‰¬");
System.out.println("setåŒ…å«é™ˆæ¸…æ‰¬å—ï¼Ÿ" + hasChenQingYang);
```

åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªLinkedHashSetå¯¹è±¡ï¼Œç„¶åä½¿ç”¨addæ–¹æ³•ä¾æ¬¡æ·»åŠ äº†ä¸‰ä¸ªå…ƒç´ ï¼šæ²‰é»˜ã€ç‹äºŒå’Œé™ˆæ¸…æ‰¬ã€‚æ¥ç€ï¼Œæˆ‘ä»¬ä½¿ç”¨removeæ–¹æ³•åˆ é™¤äº†ç‹äºŒè¿™ä¸ªå…ƒç´ ï¼Œå¹¶ä½¿ç”¨removeå’Œaddæ–¹æ³•ä¿®æ”¹äº†æ²‰é»˜è¿™ä¸ªå…ƒç´ ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨containsæ–¹æ³•æŸ¥æ‰¾äº†é™ˆæ¸…æ‰¬è¿™ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºsetä¸­ï¼Œå¹¶æ‰“å°äº†ç»“æœã€‚

LinkedHashSetæ˜¯ä¸€ç§åŸºäºå“ˆå¸Œè¡¨å®ç°çš„Setæ¥å£ï¼Œå®ƒç»§æ‰¿è‡ªHashSetï¼Œå¹¶ä¸”ä½¿ç”¨é“¾è¡¨ç»´æŠ¤äº†å…ƒç´ çš„æ’å…¥é¡ºåºã€‚å› æ­¤ï¼Œå®ƒæ—¢å…·æœ‰HashSetçš„å¿«é€ŸæŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œçš„ä¼˜ç‚¹ï¼Œåˆå¯ä»¥ç»´æŠ¤å…ƒç´ çš„æ’å…¥é¡ºåºã€‚

#### **3ï¼‰TreeSet**

â€œäºŒå“¥ï¼Œä¸ç”¨ä½ è®²äº†ï¼Œæˆ‘èƒ½çŒœåˆ°ï¼ŒTreeSet æ˜¯ç”± [TreeMapï¼ˆåé¢ä¼šè®²ï¼‰](https://tobebetterjavaer.com/collection/treemap.html) å®ç°çš„ï¼Œåªä¸è¿‡åŒæ ·æ“ä½œçš„é”®ä½ï¼Œå€¼ç”±ä¸€ä¸ªå›ºå®šçš„ Object å¯¹è±¡å¡«å……ã€‚â€

å“‡ï¼Œä¸‰å¦¹éƒ½å­¦ä¼šäº†æ¨ç†ã€‚

æ˜¯çš„ï¼Œä¸ TreeMap ç›¸ä¼¼ï¼ŒTreeSet æ˜¯ä¸€ç§åŸºäºçº¢é»‘æ ‘å®ç°çš„æœ‰åºé›†åˆï¼Œå®ƒå®ç°äº† SortedSet æ¥å£ï¼Œå¯ä»¥è‡ªåŠ¨å¯¹é›†åˆä¸­çš„å…ƒç´ è¿›è¡Œæ’åºã€‚æŒ‰ç…§é”®çš„è‡ªç„¶é¡ºåºæˆ–æŒ‡å®šçš„æ¯”è¾ƒå™¨é¡ºåºè¿›è¡Œæ’åºã€‚

```java
// åˆ›å»ºä¸€ä¸ª TreeSet å¯¹è±¡
TreeSet<String> set = new TreeSet<>();

// æ·»åŠ å…ƒç´ 
set.add("æ²‰é»˜");
set.add("ç‹äºŒ");
set.add("é™ˆæ¸…æ‰¬");
System.out.println(set); // è¾“å‡º [æ²‰é»˜, ç‹äºŒ, é™ˆæ¸…æ‰¬]

// åˆ é™¤å…ƒç´ 
set.remove("ç‹äºŒ");
System.out.println(set); // è¾“å‡º [æ²‰é»˜, é™ˆæ¸…æ‰¬]

// ä¿®æ”¹å…ƒç´ ï¼šTreeSet ä¸­çš„å…ƒç´ ä¸æ”¯æŒç›´æ¥ä¿®æ”¹ï¼Œéœ€è¦å…ˆåˆ é™¤å†æ·»åŠ 
set.remove("é™ˆæ¸…æ‰¬");
set.add("é™ˆé’é˜³");
System.out.println(set); // è¾“å‡º [æ²‰é»˜, é™ˆé’é˜³]

// æŸ¥æ‰¾å…ƒç´ 
System.out.println(set.contains("æ²‰é»˜")); // è¾“å‡º true
System.out.println(set.contains("ç‹äºŒ")); // è¾“å‡º false
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒTreeSet ä¸å…è®¸æ’å…¥ null å…ƒç´ ï¼Œå¦åˆ™ä¼šæŠ›å‡º NullPointerException å¼‚å¸¸ã€‚

â€œæ€»ä½“ä¸Šæ¥è¯´ï¼ŒSet é›†åˆä¸æ˜¯å…³æ³¨çš„é‡ç‚¹ï¼Œå› ä¸ºåº•å±‚éƒ½æ˜¯ç”± Map å®ç°çš„ï¼Œä¸ºä»€ä¹ˆè¦ç”¨ Map å®ç°å‘¢ï¼Ÿä¸‰å¦¹ä½ èƒ½çŒœåˆ°åŸå› å—ï¼Ÿâ€

â€œè®©æˆ‘æƒ³æƒ³ã€‚â€

â€œå—¯ï¼Ÿéš¾é“æ˜¯å› ä¸º Map çš„é”®ä¸å…è®¸é‡å¤ã€æ— åºå—ï¼Ÿâ€

è€å¤©ï¼Œç«Ÿç„¶è¢«ä¸‰å¦¹çŒœåˆ°äº†ã€‚

â€œæ˜¯çš„ï¼Œä½ è¿™æ°´å¹³é•¿è¿›äº†å‘€ï¼Œä¸‰å¦¹ã€‚â€

### 03ã€Queue

Queueï¼Œä¹Ÿå°±æ˜¯é˜Ÿåˆ—ï¼Œé€šå¸¸éµå¾ªå…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„åŸåˆ™ï¼Œæ–°å…ƒç´ æ’å…¥åˆ°é˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œè®¿é—®å…ƒç´ è¿”å›é˜Ÿåˆ—çš„å¤´éƒ¨ã€‚

#### **1ï¼‰ArrayDeque**

ä»åå­—ä¸Šå¯ä»¥çœ‹å¾—å‡ºï¼ŒArrayDeque æ˜¯ä¸€ä¸ªåŸºäºæ•°ç»„å®ç°çš„åŒç«¯é˜Ÿåˆ—ï¼Œä¸ºäº†æ»¡è¶³å¯ä»¥åŒæ—¶åœ¨æ•°ç»„ä¸¤ç«¯æ’å…¥æˆ–åˆ é™¤å…ƒç´ çš„éœ€æ±‚ï¼Œæ•°ç»„å¿…é¡»æ˜¯å¾ªç¯çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°ç»„çš„ä»»ä½•ä¸€ç‚¹éƒ½å¯ä»¥è¢«çœ‹ä½œæ˜¯èµ·ç‚¹æˆ–è€…ç»ˆç‚¹ã€‚

è¿™æ˜¯ä¸€ä¸ªåŒ…å«äº† 4 ä¸ªå…ƒç´ çš„åŒç«¯é˜Ÿåˆ—ï¼Œå’Œä¸€ä¸ªåŒ…å«äº† 5 ä¸ªå…ƒç´ çš„åŒç«¯é˜Ÿåˆ—ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/gailan-02.png)

head æŒ‡å‘é˜Ÿé¦–çš„ç¬¬ä¸€ä¸ªæœ‰æ•ˆçš„å…ƒç´ ï¼Œtail æŒ‡å‘é˜Ÿå°¾ç¬¬ä¸€ä¸ªå¯ä»¥æ’å…¥å…ƒç´ çš„ç©ºä½ï¼Œå› ä¸ºæ˜¯å¾ªç¯æ•°ç»„ï¼Œæ‰€ä»¥ head ä¸ä¸€å®šä»æ˜¯ä» 0 å¼€å§‹ï¼Œtail ä¹Ÿä¸ä¸€å®šæ€»æ˜¯æ¯” head å¤§ã€‚

æ¥ä¸€æ®µArrayDequeçš„å¢åˆ æ”¹æŸ¥å§ã€‚

```java
// åˆ›å»ºä¸€ä¸ªArrayDeque
ArrayDeque<String> deque = new ArrayDeque<>();

// æ·»åŠ å…ƒç´ 
deque.add("æ²‰é»˜");
deque.add("ç‹äºŒ");
deque.add("é™ˆæ¸…æ‰¬");

// åˆ é™¤å…ƒç´ 
deque.remove("ç‹äºŒ");

// ä¿®æ”¹å…ƒç´ 
deque.remove("æ²‰é»˜");
deque.add("æ²‰é»˜çš„åŠ›é‡");

// æŸ¥æ‰¾å…ƒç´ 
boolean hasChenQingYang = deque.contains("é™ˆæ¸…æ‰¬");
System.out.println("dequeåŒ…å«é™ˆæ¸…æ‰¬å—ï¼Ÿ" + hasChenQingYang);
```

#### **2ï¼‰LinkedList**

LinkedList ä¸€èˆ¬åº”è¯¥å½’åœ¨ List ä¸‹ï¼Œåªä¸è¿‡ï¼Œå®ƒä¹Ÿå®ç°äº† Deque æ¥å£ï¼Œå¯ä»¥ä½œä¸ºé˜Ÿåˆ—æ¥ä½¿ç”¨ã€‚ç­‰äºè¯´ï¼ŒLinkedList åŒæ—¶å®ç°äº† Stackã€Queueã€PriorityQueue çš„æ‰€æœ‰åŠŸèƒ½ã€‚

```java
public class LinkedList<E>
    extends AbstractSequentialList<E>
    implements List<E>, Deque<E>, Cloneable, java.io.Serializable
{}
```

æ¢å¥è¯è¯´ï¼ŒLinkedList å’Œ ArrayDeque éƒ½æ˜¯ Java é›†åˆæ¡†æ¶ä¸­çš„åŒå‘é˜Ÿåˆ—ï¼ˆdequeï¼‰ï¼Œå®ƒä»¬éƒ½æ”¯æŒåœ¨é˜Ÿåˆ—çš„ä¸¤ç«¯è¿›è¡Œå…ƒç´ çš„æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚ä¸è¿‡ï¼ŒLinkedList å’Œ ArrayDeque åœ¨å®ç°ä¸Šæœ‰ä¸€äº›ä¸åŒï¼š

- åº•å±‚å®ç°æ–¹å¼ä¸åŒï¼šLinkedList æ˜¯åŸºäºé“¾è¡¨å®ç°çš„ï¼Œè€Œ ArrayDeque æ˜¯åŸºäºæ•°ç»„å®ç°çš„ã€‚
- éšæœºè®¿é—®çš„æ•ˆç‡ä¸åŒï¼šç”±äºåº•å±‚å®ç°æ–¹å¼çš„ä¸åŒï¼ŒLinkedList å¯¹äºéšæœºè®¿é—®çš„æ•ˆç‡è¾ƒä½ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œè€Œ ArrayDeque å¯ä»¥é€šè¿‡ä¸‹æ ‡éšæœºè®¿é—®å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚
- è¿­ä»£å™¨çš„æ•ˆç‡ä¸åŒï¼šLinkedList å¯¹äºè¿­ä»£å™¨çš„æ•ˆç‡æ¯”è¾ƒä½ï¼Œå› ä¸ºéœ€è¦é€šè¿‡é“¾è¡¨è¿›è¡Œéå†ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œè€Œ ArrayDeque çš„è¿­ä»£å™¨æ•ˆç‡æ¯”è¾ƒé«˜ï¼Œå› ä¸ºå¯ä»¥ç›´æ¥è®¿é—®æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚
- å†…å­˜å ç”¨ä¸åŒï¼šç”±äº LinkedList æ˜¯åŸºäºé“¾è¡¨å®ç°çš„ï¼Œå®ƒåœ¨å­˜å‚¨å…ƒç´ æ—¶éœ€è¦é¢å¤–çš„ç©ºé—´æ¥å­˜å‚¨é“¾è¡¨èŠ‚ç‚¹ï¼Œå› æ­¤å†…å­˜å ç”¨ç›¸å¯¹è¾ƒé«˜ï¼Œè€Œ ArrayDeque æ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼Œå†…å­˜å ç”¨ç›¸å¯¹è¾ƒä½ã€‚

å› æ­¤ï¼Œåœ¨é€‰æ‹©ä½¿ç”¨ LinkedList è¿˜æ˜¯ ArrayDeque æ—¶ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯å’Œéœ€æ±‚æ¥é€‰æ‹©ã€‚å¦‚æœéœ€è¦åœ¨åŒå‘é˜Ÿåˆ—çš„ä¸¤ç«¯è¿›è¡Œé¢‘ç¹çš„æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œå¹¶ä¸”éœ€è¦éšæœºè®¿é—®å…ƒç´ ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ ArrayDequeï¼›å¦‚æœéœ€è¦åœ¨é˜Ÿåˆ—ä¸­é—´è¿›è¡Œé¢‘ç¹çš„æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ LinkedListã€‚

æ¥ä¸€æ®µ LinkedList ä½œä¸ºé˜Ÿåˆ—æ—¶å€™çš„å¢åˆ æ”¹æŸ¥å§ï¼Œæ³¨æ„å’Œå®ƒä½œä¸º List çš„æ—¶å€™æœ‰å¾ˆå¤§çš„ä¸åŒã€‚

```java
// åˆ›å»ºä¸€ä¸ª LinkedList å¯¹è±¡
LinkedList<String> queue = new LinkedList<>();

// æ·»åŠ å…ƒç´ 
queue.offer("æ²‰é»˜");
queue.offer("ç‹äºŒ");
queue.offer("é™ˆæ¸…æ‰¬");
System.out.println(queue); // è¾“å‡º [æ²‰é»˜, ç‹äºŒ, é™ˆæ¸…æ‰¬]

// åˆ é™¤å…ƒç´ 
queue.poll();
System.out.println(queue); // è¾“å‡º [ç‹äºŒ, é™ˆæ¸…æ‰¬]

// ä¿®æ”¹å…ƒç´ ï¼šLinkedList ä¸­çš„å…ƒç´ ä¸æ”¯æŒç›´æ¥ä¿®æ”¹ï¼Œéœ€è¦å…ˆåˆ é™¤å†æ·»åŠ 
String first = queue.poll();
queue.offer("ç‹å¤§äºŒ");
System.out.println(queue); // è¾“å‡º [é™ˆæ¸…æ‰¬, ç‹å¤§äºŒ]

// æŸ¥æ‰¾å…ƒç´ ï¼šLinkedList ä¸­çš„å…ƒç´ å¯ä»¥ä½¿ç”¨ get() æ–¹æ³•è¿›è¡ŒæŸ¥æ‰¾
System.out.println(queue.get(0)); // è¾“å‡º é™ˆæ¸…æ‰¬
System.out.println(queue.contains("æ²‰é»˜")); // è¾“å‡º false

// æŸ¥æ‰¾å…ƒç´ ï¼šä½¿ç”¨è¿­ä»£å™¨çš„æ–¹å¼æŸ¥æ‰¾é™ˆæ¸…æ‰¬
// ä½¿ç”¨è¿­ä»£å™¨ä¾æ¬¡éå†å…ƒç´ å¹¶æŸ¥æ‰¾
Iterator<String> iterator = queue.iterator();
while (iterator.hasNext()) {
    String element = iterator.next();
    if (element.equals("é™ˆæ¸…æ‰¬")) {
        System.out.println("æ‰¾åˆ°äº†ï¼š" + element);
        break;
    }
}
```

åœ¨ä½¿ç”¨ LinkedList ä½œä¸ºé˜Ÿåˆ—æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ offer() æ–¹æ³•å°†å…ƒç´ æ·»åŠ åˆ°é˜Ÿåˆ—çš„æœ«å°¾ï¼Œä½¿ç”¨ poll() æ–¹æ³•ä»é˜Ÿåˆ—çš„å¤´éƒ¨åˆ é™¤å…ƒç´ ã€‚å¦å¤–ï¼Œç”±äº LinkedList æ˜¯é“¾è¡¨ç»“æ„ï¼Œä¸æ”¯æŒéšæœºè®¿é—®å…ƒç´ ï¼Œå› æ­¤ä¸èƒ½ä½¿ç”¨ä¸‹æ ‡è®¿é—®å…ƒç´ ï¼Œéœ€è¦ä½¿ç”¨è¿­ä»£å™¨æˆ–è€… poll() æ–¹æ³•ä¾æ¬¡éå†å…ƒç´ ã€‚


#### **3ï¼‰PriorityQueue**

PriorityQueue æ˜¯ä¸€ç§ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå®ƒçš„å‡ºé˜Ÿé¡ºåºä¸å…ƒç´ çš„ä¼˜å…ˆçº§æœ‰å…³ï¼Œæ‰§è¡Œ remove æˆ–è€… poll æ–¹æ³•ï¼Œè¿”å›çš„æ€»æ˜¯ä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ ã€‚

```java
// åˆ›å»ºä¸€ä¸ª PriorityQueue å¯¹è±¡
PriorityQueue<String> queue = new PriorityQueue<>();

// æ·»åŠ å…ƒç´ 
queue.offer("æ²‰é»˜");
queue.offer("ç‹äºŒ");
queue.offer("é™ˆæ¸…æ‰¬");
System.out.println(queue); // è¾“å‡º [æ²‰é»˜, ç‹äºŒ, é™ˆæ¸…æ‰¬]

// åˆ é™¤å…ƒç´ 
queue.poll();
System.out.println(queue); // è¾“å‡º [ç‹äºŒ, é™ˆæ¸…æ‰¬]

// ä¿®æ”¹å…ƒç´ ï¼šPriorityQueue ä¸æ”¯æŒç›´æ¥ä¿®æ”¹å…ƒç´ ï¼Œéœ€è¦å…ˆåˆ é™¤å†æ·»åŠ 
String first = queue.poll();
queue.offer("å¼ ä¸‰");
System.out.println(queue); // è¾“å‡º [å¼ ä¸‰, é™ˆæ¸…æ‰¬]

// æŸ¥æ‰¾å…ƒç´ ï¼šPriorityQueue ä¸æ”¯æŒéšæœºè®¿é—®å…ƒç´ ï¼Œåªèƒ½è®¿é—®é˜Ÿé¦–å…ƒç´ 
System.out.println(queue.peek()); // è¾“å‡º å¼ ä¸‰
System.out.println(queue.contains("é™ˆæ¸…æ‰¬")); // è¾“å‡º true

// é€šè¿‡ for å¾ªç¯çš„æ–¹å¼æŸ¥æ‰¾é™ˆæ¸…æ‰¬
for (String element : queue) {
    if (element.equals("é™ˆæ¸…æ‰¬")) {
        System.out.println("æ‰¾åˆ°äº†ï¼š" + element);
        break;
    }
}
```

è¦æƒ³æœ‰ä¼˜å…ˆçº§ï¼Œå…ƒç´ å°±éœ€è¦å®ç° [Comparable æ¥å£æˆ–è€… Comparator æ¥å£](https://tobebetterjavaer.com/basic-extra-meal/comparable-omparator.html)ï¼ˆæˆ‘ä»¬åé¢ä¼šè®²ï¼‰ã€‚

è¿™é‡Œå…ˆæ¥ä¸€æ®µé€šè¿‡å®ç° Comparator æ¥å£æŒ‰ç…§å¹´é¾„å§“åæ’åºçš„ä¼˜å…ˆçº§é˜Ÿåˆ—å§ã€‚

```java
import java.util.Comparator;
import java.util.PriorityQueue;

class Student {
    private String name;
    private int chineseScore;
    private int mathScore;

    public Student(String name, int chineseScore, int mathScore) {
        this.name = name;
        this.chineseScore = chineseScore;
        this.mathScore = mathScore;
    }

    public String getName() {
        return name;
    }

    public int getChineseScore() {
        return chineseScore;
    }

    public int getMathScore() {
        return mathScore;
    }

    @Override
    public String toString() {
        return "Student{" +
                "name='" + name + '\'' +
                ", æ€»æˆç»©=" + (chineseScore + mathScore) +
                '}';
    }
}

class StudentComparator implements Comparator<Student> {
    @Override
    public int compare(Student s1, Student s2) {
        // æ¯”è¾ƒæ€»æˆç»©
        return Integer.compare(s2.getChineseScore() + s2.getMathScore(),
                s1.getChineseScore() + s1.getMathScore());
    }
}

public class PriorityQueueComparatorExample {

    public static void main(String[] args) {
        // åˆ›å»ºä¸€ä¸ªæŒ‰ç…§æ€»æˆç»©æ’åºçš„ä¼˜å…ˆçº§é˜Ÿåˆ—
        PriorityQueue<Student> queue = new PriorityQueue<>(new StudentComparator());

        // æ·»åŠ å…ƒç´ 
        queue.offer(new Student("ç‹äºŒ", 80, 90));
        System.out.println(queue);
        queue.offer(new Student("é™ˆæ¸…æ‰¬", 95, 95));
        System.out.println(queue);
        queue.offer(new Student("å°é©¼é“ƒ", 90, 95));
        System.out.println(queue);
        queue.offer(new Student("æ²‰é»˜", 90, 80));
        while (!queue.isEmpty()) {
            System.out.print(queue.poll() + " ");
        }
    }
}
```

Student æ˜¯ä¸€ä¸ªå­¦ç”Ÿå¯¹è±¡ï¼ŒåŒ…å«å§“åã€è¯­æ–‡æˆç»©å’Œæ•°å­¦æˆç»©ã€‚

StudentComparator å®ç°äº† Comparator æ¥å£ï¼Œå¯¹æ€»æˆç»©åšäº†ä¸€ä¸ªæ’åºã€‚

PriorityQueue æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå‚æ•°ä¸º StudentComparatorï¼Œç„¶åæˆ‘ä»¬æ·»åŠ äº† 4 ä¸ªå­¦ç”Ÿå¯¹è±¡è¿›å»ã€‚

æ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœï¼š

```
[Student{name='ç‹äºŒ', æ€»æˆç»©=170}]
[Student{name='é™ˆæ¸…æ‰¬', æ€»æˆç»©=190}, Student{name='ç‹äºŒ', æ€»æˆç»©=170}]
[Student{name='é™ˆæ¸…æ‰¬', æ€»æˆç»©=190}, Student{name='ç‹äºŒ', æ€»æˆç»©=170}, Student{name='å°é©¼é“ƒ', æ€»æˆç»©=185}]
Student{name='é™ˆæ¸…æ‰¬', æ€»æˆç»©=190} Student{name='å°é©¼é“ƒ', æ€»æˆç»©=185} Student{name='æ²‰é»˜', æ€»æˆç»©=170} Student{name='ç‹äºŒ', æ€»æˆç»©=170} 
```

æˆ‘ä»¬ä½¿ç”¨ offer æ–¹æ³•æ·»åŠ å…ƒç´ ï¼Œæœ€åç”¨ while å¾ªç¯éå†å…ƒç´ ï¼ˆé€šè¿‡ poll æ–¹æ³•å–å‡ºå…ƒç´ ï¼‰ï¼Œä»ç»“æœå¯ä»¥çœ‹å¾—å‡ºï¼Œ[PriorityQueue](https://tobebetterjavaer.com/collection/PriorityQueue.html)æŒ‰ç…§å­¦ç”Ÿçš„æ€»æˆç»©ç”±é«˜åˆ°ä½è¿›è¡Œäº†æ’åºã€‚


### 04ã€Map

Map ä¿å­˜çš„æ˜¯é”®å€¼å¯¹ï¼Œé”®è¦æ±‚ä¿æŒå”¯ä¸€æ€§ï¼Œå€¼å¯ä»¥é‡å¤ã€‚

#### **1ï¼‰HashMap**

HashMap å®ç°äº† Map æ¥å£ï¼Œå¯ä»¥æ ¹æ®é”®å¿«é€Ÿåœ°æŸ¥æ‰¾å¯¹åº”çš„å€¼â€”â€”é€šè¿‡å“ˆå¸Œå‡½æ•°å°†é”®æ˜ å°„åˆ°å“ˆå¸Œè¡¨ä¸­çš„ä¸€ä¸ªç´¢å¼•ä½ç½®ï¼Œä»è€Œå®ç°å¿«é€Ÿè®¿é—®ã€‚[åé¢ä¼šè¯¦ç»†èŠåˆ°](https://tobebetterjavaer.com/collection/hashmap.html)ã€‚

è¿™é‡Œå…ˆå¤§è‡´äº†è§£ä¸€ä¸‹ HashMap çš„ç‰¹ç‚¹ï¼š

- HashMap ä¸­çš„é”®å’Œå€¼éƒ½å¯ä»¥ä¸º nullã€‚å¦‚æœé”®ä¸º nullï¼Œåˆ™å°†è¯¥é”®æ˜ å°„åˆ°å“ˆå¸Œè¡¨çš„ç¬¬ä¸€ä¸ªä½ç½®ã€‚
- å¯ä»¥ä½¿ç”¨è¿­ä»£å™¨æˆ–è€… forEach æ–¹æ³•éå† HashMap ä¸­çš„é”®å€¼å¯¹ã€‚
- HashMap æœ‰ä¸€ä¸ªåˆå§‹å®¹é‡å’Œä¸€ä¸ªè´Ÿè½½å› å­ã€‚åˆå§‹å®¹é‡æ˜¯æŒ‡å“ˆå¸Œè¡¨çš„åˆå§‹å¤§å°ï¼Œè´Ÿè½½å› å­æ˜¯æŒ‡å“ˆå¸Œè¡¨åœ¨æ‰©å®¹ä¹‹å‰å¯ä»¥å­˜å‚¨çš„é”®å€¼å¯¹æ•°é‡ä¸å“ˆå¸Œè¡¨å¤§å°çš„æ¯”ç‡ã€‚é»˜è®¤çš„åˆå§‹å®¹é‡æ˜¯ 16ï¼Œè´Ÿè½½å› å­æ˜¯ 0.75ã€‚

æ¥ä¸ªç®€å•çš„å¢åˆ æ”¹æŸ¥å§ã€‚

```java
// åˆ›å»ºä¸€ä¸ª HashMap å¯¹è±¡
HashMap<String, String> hashMap = new HashMap<>();

// æ·»åŠ é”®å€¼å¯¹
hashMap.put("æ²‰é»˜", "cenzhong");
hashMap.put("ç‹äºŒ", "wanger");
hashMap.put("é™ˆæ¸…æ‰¬", "chenqingyang");

// è·å–æŒ‡å®šé”®çš„å€¼
String value1 = hashMap.get("æ²‰é»˜");
System.out.println("æ²‰é»˜å¯¹åº”çš„å€¼ä¸ºï¼š" + value1);

// ä¿®æ”¹é”®å¯¹åº”çš„å€¼
hashMap.put("æ²‰é»˜", "chenmo");
String value2 = hashMap.get("æ²‰é»˜");
System.out.println("ä¿®æ”¹åæ²‰é»˜å¯¹åº”çš„å€¼ä¸ºï¼š" + value2);

// åˆ é™¤æŒ‡å®šé”®çš„é”®å€¼å¯¹
hashMap.remove("ç‹äºŒ");

// éå† HashMap
for (String key : hashMap.keySet()) {
    String value = hashMap.get(key);
    System.out.println(key + " å¯¹åº”çš„å€¼ä¸ºï¼š" + value);
}
```

#### **2ï¼‰LinkedHashMap**

HashMap å·²ç»éå¸¸å¼ºå¤§äº†ï¼Œä½†å®ƒæ˜¯æ— åºçš„ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæœ‰åºçš„Mapï¼Œå°±è¦ç”¨åˆ° [LinkedHashMap](https://tobebetterjavaer.com/collection/linkedhashmap.html)ã€‚LinkedHashMap æ˜¯ HashMap çš„å­ç±»ï¼Œå®ƒä½¿ç”¨é“¾è¡¨æ¥è®°å½•æ’å…¥/è®¿é—®å…ƒç´ çš„é¡ºåºã€‚

LinkedHashMap å¯ä»¥çœ‹ä½œæ˜¯ HashMap + LinkedList çš„åˆä½“ï¼Œå®ƒä½¿ç”¨äº†å“ˆå¸Œè¡¨æ¥å­˜å‚¨æ•°æ®ï¼Œåˆç”¨äº†åŒå‘é“¾è¡¨æ¥ç»´æŒé¡ºåºã€‚

æ¥ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚

```java
// åˆ›å»ºä¸€ä¸ª LinkedHashMapï¼Œæ’å…¥çš„é”®å€¼å¯¹ä¸º æ²‰é»˜ ç‹äºŒ é™ˆæ¸…æ‰¬
LinkedHashMap<String, String> linkedHashMap = new LinkedHashMap<>();
linkedHashMap.put("æ²‰é»˜", "cenzhong");
linkedHashMap.put("ç‹äºŒ", "wanger");
linkedHashMap.put("é™ˆæ¸…æ‰¬", "chenqingyang");

// éå† LinkedHashMap
for (String key : linkedHashMap.keySet()) {
    String value = linkedHashMap.get(key);
    System.out.println(key + " å¯¹åº”çš„å€¼ä¸ºï¼š" + value);
}
```

æ¥çœ‹è¾“å‡ºç»“æœï¼š

```
æ²‰é»˜ å¯¹åº”çš„å€¼ä¸ºï¼šcenzhong
ç‹äºŒ å¯¹åº”çš„å€¼ä¸ºï¼šwanger
é™ˆæ¸…æ‰¬ å¯¹åº”çš„å€¼ä¸ºï¼šchenqingyang
```

ä»ç»“æœä¸­å¯ä»¥çœ‹å¾—å‡ºæ¥ï¼ŒLinkedHashMap ç»´æŒäº†é”®å€¼å¯¹çš„æ’å…¥é¡ºåºï¼Œå¯¹å§ï¼Ÿä¸ºäº†å’Œ LinkedHashMap åšå¯¹æ¯”ï¼Œæˆ‘ä»¬ç”¨åŒæ ·çš„æ•°æ®è¯•éªŒä¸€ä¸‹ HashMapã€‚

```java
// åˆ›å»ºä¸€ä¸ªHashMapï¼Œæ’å…¥çš„é”®å€¼å¯¹ä¸º æ²‰é»˜ ç‹äºŒ é™ˆæ¸…æ‰¬
HashMap<String, String> hashMap = new HashMap<>();
hashMap.put("æ²‰é»˜", "cenzhong");
hashMap.put("ç‹äºŒ", "wanger");
hashMap.put("é™ˆæ¸…æ‰¬", "chenqingyang");

// éå† HashMap
for (String key : hashMap.keySet()) {
    String value = hashMap.get(key);
    System.out.println(key + " å¯¹åº”çš„å€¼ä¸ºï¼š" + value);
}
```

æ¥çœ‹è¾“å‡ºç»“æœï¼š

```
æ²‰é»˜ å¯¹åº”çš„å€¼ä¸ºï¼šcenzhong
é™ˆæ¸…æ‰¬ å¯¹åº”çš„å€¼ä¸ºï¼šchenqingyang
ç‹äºŒ å¯¹åº”çš„å€¼ä¸ºï¼šwanger
```

HashMap æ²¡æœ‰ç»´æŒé”®å€¼å¯¹çš„æ’å…¥é¡ºåºï¼Œå¯¹å§ï¼Ÿ

#### **3ï¼‰TreeMap**

[TreeMap](https://tobebetterjavaer.com/collection/treemap.html) å®ç°äº† SortedMap æ¥å£ï¼Œå¯ä»¥è‡ªåŠ¨å°†é”®æŒ‰ç…§è‡ªç„¶é¡ºåºæˆ–æŒ‡å®šçš„æ¯”è¾ƒå™¨é¡ºåºæ’åºï¼Œå¹¶ä¿è¯å…¶å…ƒç´ çš„é¡ºåºã€‚å†…éƒ¨ä½¿ç”¨çº¢é»‘æ ‘æ¥å®ç°é”®çš„æ’åºå’ŒæŸ¥æ‰¾ã€‚

åŒæ ·æ¥ä¸€ä¸ªå¢åˆ æ”¹æŸ¥çš„ demoï¼š

```java
// åˆ›å»ºä¸€ä¸ª TreeMap å¯¹è±¡
Map<String, String> treeMap = new TreeMap<>();

// å‘ TreeMap ä¸­æ·»åŠ é”®å€¼å¯¹
treeMap.put("æ²‰é»˜", "cenzhong");
treeMap.put("ç‹äºŒ", "wanger");
treeMap.put("é™ˆæ¸…æ‰¬", "chenqingyang");

// æŸ¥æ‰¾é”®å€¼å¯¹
String name = "æ²‰é»˜";
if (treeMap.containsKey(name)) {
    System.out.println("æ‰¾åˆ°äº† " + name + ": " + treeMap.get(name));
} else {
    System.out.println("æ²¡æœ‰æ‰¾åˆ° " + name);
}

// ä¿®æ”¹é”®å€¼å¯¹
name = "ç‹äºŒ";
if (treeMap.containsKey(name)) {
    System.out.println("ä¿®æ”¹å‰çš„ " + name + ": " + treeMap.get(name));
    treeMap.put(name, "newWanger");
    System.out.println("ä¿®æ”¹åçš„ " + name + ": " + treeMap.get(name));
} else {
    System.out.println("æ²¡æœ‰æ‰¾åˆ° " + name);
}

// åˆ é™¤é”®å€¼å¯¹
name = "é™ˆæ¸…æ‰¬";
if (treeMap.containsKey(name)) {
    System.out.println("åˆ é™¤å‰çš„ " + name + ": " + treeMap.get(name));
    treeMap.remove(name);
    System.out.println("åˆ é™¤åçš„ " + name + ": " + treeMap.get(name));
} else {
    System.out.println("æ²¡æœ‰æ‰¾åˆ° " + name);
}

// éå† TreeMap
for (Map.Entry<String, String> entry : treeMap.entrySet()) {
    System.out.println(entry.getKey() + ": " + entry.getValue());
}
```

ä¸ HashMap ä¸åŒçš„æ˜¯ï¼ŒTreeMap ä¼šæŒ‰ç…§é”®çš„é¡ºåºæ¥è¿›è¡Œæ’åºã€‚

```java
// åˆ›å»ºä¸€ä¸ª TreeMap å¯¹è±¡
Map<String, String> treeMap = new TreeMap<>();

// å‘ TreeMap ä¸­æ·»åŠ é”®å€¼å¯¹
treeMap.put("c", "cat");
treeMap.put("a", "apple");
treeMap.put("b", "banana");

// éå† TreeMap
for (Map.Entry<String, String> entry : treeMap.entrySet()) {
    System.out.println(entry.getKey() + ": " + entry.getValue());
}
```

æ¥çœ‹è¾“å‡ºç»“æœï¼š

```
a: apple
b: banana
c: cat
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œå·²ç»æŒ‰ç…§é”®çš„è‡ªç„¶é¡ºåºæ’è¿‡äº†ã€‚

â€œå¥½äº†ï¼Œä¸‰å¦¹ï¼Œå…³äºé›†åˆæ¡†æ¶ï¼Œæˆ‘ä»¬å°±å…ˆèŠåˆ°è¿™ï¼Œéšåæˆ‘ä»¬ä¼šé’ˆå¯¹å¸¸ç”¨çš„å®¹å™¨è¿›è¡Œè¯¦ç»†åœ°è®²è§£ï¼Œæ¯”å¦‚è¯´ ArrayListã€LinkedListã€HashMap ç­‰ã€‚â€

â€œå“‡ï¼ŒäºŒå“¥ï¼Œè¿™ç¯‡è®²çš„ä¸œè¥¿å¯çœŸä¸å°‘ï¼Œè™½ç„¶éƒ½æ˜¯æ¯”è¾ƒåŸºç¡€çš„ï¼Œä½†å¯¹äºæˆ‘ä¸€ä¸ªå°ç™½æ¥è¯´ï¼Œè¿˜æ˜¯éœ€è¦èŠ±ç‚¹æ—¶é—´å»æ¶ˆåŒ–çš„ã€‚â€ä¸‰å¦¹å˜Ÿå˜Ÿå˜´è¯´åˆ°ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 6.2 æ—¶é—´å¤æ‚åº¦ï¼Œäº†è§£ä¸‹

â€œäºŒå“¥ï¼Œä¸ºä»€ä¹ˆè¦è®²æ—¶é—´å¤æ‚åº¦å‘€ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œå› ä¸ºæ¥ä¸‹æ¥è¦ç”¨åˆ°å•Šã€‚åé¢æˆ‘ä»¬å­¦ä¹  [ArrayList](https://tobebetterjavaer.com/collection/arraylist.html)ã€[LinkedList](https://tobebetterjavaer.com/collection/linkedlist.html) çš„æ—¶å€™ï¼Œä¼šæ¯”è¾ƒä¸¤è€…åœ¨å¢åˆ æ”¹æŸ¥æ—¶çš„æ‰§è¡Œæ•ˆç‡ï¼Œè€Œæ—¶é—´å¤æ‚åº¦æ˜¯è¡¡é‡æ‰§è¡Œæ•ˆç‡çš„ä¸€ä¸ªé‡è¦æ ‡å‡†ã€‚â€æˆ‘è¯´ã€‚

â€œåˆ°æ—¶å€™è·‘ä¸€ä¸‹ä»£ç ï¼Œç»Ÿè®¡ä¸€ä¸‹å‰åçš„æ—¶é—´å·®ä¸æ›´å‡†ç¡®å—ï¼Ÿâ€ä¸‰å¦¹åé—®é“ã€‚

â€œå®é™…ä¸Šï¼Œä½ è¯´çš„æ˜¯å¦å¤–ä¸€ç§è¯„ä¼°æ–¹æ³•ï¼Œè¿™ç§è¯„ä¼°æ–¹æ³•å¯ä»¥å¾—å‡ºéå¸¸å‡†ç¡®çš„æ•°å€¼ï¼Œä½†ä¹Ÿæœ‰å¾ˆå¤§çš„å±€é™æ€§ã€‚â€æˆ‘ä¸æ€¥ä¸æ…¢åœ°è¯´ã€‚

ç¬¬ä¸€ï¼Œæµ‹è¯•ç»“æœä¼šå—åˆ°æµ‹è¯•ç¯å¢ƒçš„å½±å“ã€‚ä½ æ¯”å¦‚è¯´ï¼ŒåŒæ ·çš„ä»£ç ï¼Œåœ¨æˆ‘è¿™å° iMac ä¸Šè·‘å‡ºæ¥çš„æ—¶é—´å’Œåœ¨ä½ é‚£å°åä¸ºçš„ MacBook ä¸Šè·‘å‡ºçš„æ—¶é—´å¯èƒ½å°±å·®åˆ«å¾ˆå¤§ã€‚

ç¬¬äºŒï¼Œæµ‹è¯•ç»“æœä¼šå—åˆ°æµ‹è¯•æ•°æ®çš„å½±å“ã€‚ä½ æ¯”å¦‚è¯´ï¼Œä¸€ä¸ªæ’åºåçš„æ•°ç»„å’Œä¸€ä¸ªæ²¡æœ‰æ’åºåçš„æ•°ç»„ï¼Œè°ƒç”¨äº†åŒä¸€ä¸ªæŸ¥è¯¢æ–¹æ³•ï¼Œå¾—å‡ºæ¥çš„ç»“æœå¯èƒ½ä¼šå·®åˆ«ç‰¹åˆ«å¤§ã€‚

â€œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è¿™ç§ä¸ä¾èµ–äºå…·ä½“æµ‹è¯•ç¯å¢ƒå’Œæµ‹è¯•æ•°æ®å°±èƒ½ç²—ç•¥åœ°ä¼°ç®—å‡ºæ‰§è¡Œæ•ˆç‡çš„æ–¹æ³•ï¼Œæ—¶é—´å¤æ‚åº¦å°±æ˜¯å…¶ä¸­çš„ä¸€ç§ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯ç©ºé—´å¤æ‚åº¦ã€‚â€æˆ‘ç»§ç»­è¡¥å……é“ï¼Œâ€œå¦‚æœä½ åé¢åˆ· LeetCodeçš„è¯ï¼Œå¯¹æ—¶é—´å¤æ‚åº¦è¿™ä¸ªæ¦‚å¿µä¹Ÿä¼šæ¯”è¾ƒä¾èµ–ã€‚â€

æ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼š

```java
public static int sum(int n) {
    int sum = 0; // ç¬¬ 1 è¡Œ
    for (int i=0;i<n;i++) { // ç¬¬ 2 è¡Œ
        sum = sum + 1; // ç¬¬ 3 è¡Œ
    } // ç¬¬ 4 è¡Œ
    return sum; // ç¬¬ 5 è¡Œ
}
```

è¿™æ®µä»£ç éå¸¸ç®€å•ï¼Œæ–¹æ³•ä½“é‡Œæ€»å…± 5 è¡Œä»£ç ï¼ŒåŒ…æ‹¬â€œ}â€é‚£ä¸€è¡Œã€‚æ¯æ®µä»£ç çš„æ‰§è¡Œæ—¶é—´å¯èƒ½éƒ½ä¸å¤§ä¸€æ ·ï¼Œä½†å‡è®¾æˆ‘ä»¬è®¤ä¸ºæ¯è¡Œä»£ç çš„æ‰§è¡Œæ—¶é—´æ˜¯ä¸€æ ·çš„ï¼Œæ¯”å¦‚è¯´ unit_timeï¼Œé‚£ä¹ˆè¿™æ®µä»£ç æ€»çš„æ‰§è¡Œæ—¶é—´ä¸ºå¤šå°‘å‘¢ï¼Ÿ

â€œè¿™ä¸ªæˆ‘çŸ¥é“å‘€ï¼â€ä¸‰å¦¹å–Šé“ï¼Œâ€œç¬¬ 1ã€5 è¡Œéœ€è¦ 2 ä¸ª unit_timeï¼Œç¬¬ 2ã€3 è¡Œéœ€è¦ 2*n*unit_timeï¼Œæ€»çš„æ—¶é—´å°±æ˜¯ 2(n+1)*unit_timeã€‚â€

â€œå¯¹ï¼Œä¸€æ®µä»£ç çš„æ‰§è¡Œæ—¶é—´ T(n) å’Œæ€»çš„æ‰§è¡Œæ¬¡æ•°æˆæ­£æ¯”ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»£ç æ‰§è¡Œçš„æ¬¡æ•°è¶Šå¤šï¼ŒèŠ±è´¹çš„æ—¶é—´å°±è¶Šå¤šã€‚â€æˆ‘æ€»ç»“é“ï¼Œâ€œè¿™ä¸ªè§„å¾‹å¯ä»¥ç”¨ä¸€ä¸ªå…¬å¼æ¥è¡¨è¾¾ï¼šâ€

> T(n) = O(f(n))

f(n) è¡¨ç¤ºä»£ç æ€»çš„æ‰§è¡Œæ¬¡æ•°ï¼Œå¤§å†™ O è¡¨ç¤ºä»£ç çš„æ‰§è¡Œæ—¶é—´ T(n) å’Œ f(n) æˆæ­£æ¯”ã€‚

è¿™ä¹Ÿå°±æ˜¯å¤§ O è¡¨ç¤ºæ³•ï¼Œå®ƒä¸å…³å¿ƒä»£ç å…·ä½“çš„æ‰§è¡Œæ—¶é—´æ˜¯å¤šå°‘ï¼Œå®ƒå…³å¿ƒçš„æ˜¯ä»£ç æ‰§è¡Œæ—¶é—´çš„å˜åŒ–è¶‹åŠ¿ï¼Œè¿™ä¹Ÿå°±æ˜¯æ—¶é—´å¤æ‚åº¦è¿™ä¸ªæ¦‚å¿µçš„ç”±æ¥ã€‚

å¯¹äºä¸Šé¢é‚£æ®µä»£ç  `sum()` æ¥è¯´ï¼Œå½±å“æ—¶é—´å¤æ‚åº¦çš„ä¸»è¦æ˜¯ç¬¬ 2 è¡Œä»£ç ï¼Œå…¶ä½™çš„ï¼Œåƒç³»æ•° 2ã€å¸¸æ•° 2 éƒ½æ˜¯å¯ä»¥å¿½ç•¥ä¸è®¡çš„ï¼Œæˆ‘ä»¬åªå…³å¿ƒå½±å“æœ€å¤§çš„é‚£ä¸ªï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦å°±è¡¨ç¤ºä¸º `O(n)`ã€‚

å¸¸è§çš„æ—¶é—´å¤æ‚åº¦æœ‰è¿™ä¹ˆ 3 ä¸ªï¼š

### 1ï¼‰`O(1)`

ä»£ç çš„æ‰§è¡Œæ—¶é—´ï¼Œå’Œæ•°æ®è§„æ¨¡ n æ²¡æœ‰å¤šå¤§å…³ç³»ã€‚

æ‹¬å·ä¸­çš„ 1 å¯ä»¥æ˜¯ 3ï¼Œå¯ä»¥æ˜¯ 5ï¼Œå¯ä»¥ 100ï¼Œæˆ‘ä»¬ä¹ æƒ¯ç”¨ 1 æ¥è¡¨ç¤ºï¼Œè¡¨ç¤ºè¿™æ®µä»£ç çš„æ‰§è¡Œæ—¶é—´æ˜¯ä¸€ä¸ªå¸¸æ•°çº§åˆ«ã€‚æ¯”å¦‚è¯´ä¸‹é¢è¿™æ®µä»£ç ï¼š

```java
int i = 0;
int j = 0;
int k = i + j;
```

å®é™…ä¸Šæ‰§è¡Œäº† 3 æ¬¡ï¼Œä½†æˆ‘ä»¬ä¹Ÿè®¤ä¸ºè¿™æ®µä»£ç çš„æ—¶é—´å¤æ‚åº¦ä¸º `O(1)`ã€‚

å†ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚å½“æˆ‘ä»¬è®¿é—®æ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå®ƒçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯å¸¸æ•°æ—¶é—´å¤æ‚åº¦ O(1)ã€‚

```java
int[] nums = {1, 2, 3, 4, 5};
int x = nums[2]; // è®¿é—®æ•°ç»„ä¸­ä¸‹æ ‡ä¸º2çš„å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)
```

### 2ï¼‰`O(n)`

æ—¶é—´å¤æ‚åº¦å’Œæ•°æ®è§„æ¨¡ n æ˜¯çº¿æ€§å…³ç³»ã€‚æ¢å¥è¯è¯´ï¼Œæ•°æ®è§„æ¨¡å¢å¤§ K å€ï¼Œä»£ç æ‰§è¡Œçš„æ—¶é—´å°±å¤§è‡´å¢åŠ  K å€ã€‚

å½“æˆ‘ä»¬éå†ä¸€ä¸ªæ•°ç»„æ—¶ï¼Œå®ƒçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯çº¿æ€§æ—¶é—´å¤æ‚åº¦ O(n)ã€‚

```java
int[] nums = {1, 2, 3, 4, 5};
for (int i = 0; i < nums.length; i++) { // éå†æ•´ä¸ªæ•°ç»„ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)
    System.out.println(nums[i]);
}
```

### 3ï¼‰`O(logn)`

æ—¶é—´å¤æ‚åº¦å’Œæ•°æ®è§„æ¨¡ n æ˜¯å¯¹æ•°å…³ç³»ã€‚æ¢å¥è¯è¯´ï¼Œæ•°æ®è§„æ¨¡å¤§å¹…å¢åŠ æ—¶ï¼Œä»£ç æ‰§è¡Œçš„æ—¶é—´åªæœ‰å°‘é‡å¢åŠ ã€‚

æ¥çœ‹ä¸€ä¸‹ä»£ç ç¤ºä¾‹ï¼Œ

```java
public static void logn(int n) { 
    int i = 1;
    while (i < n) {
        i *= 2;
    }
}
```

æ¢å¥è¯è¯´ï¼Œå½“æ•°æ®é‡ n ä» 2 å¢åŠ åˆ° 2^64 æ—¶ï¼Œä»£ç æ‰§è¡Œçš„æ—¶é—´åªå¢åŠ äº† 64 å€ã€‚

```
éå†æ¬¡æ•° |   i
----------+-------
    0     |   i
    1     |  i*2
    2     |  i*4
   ...    |  ...
   ...    |  ...
    k     |  i*2^k 
```

å†ä¸¾ä¸ªä¾‹å­ã€‚å½“æˆ‘ä»¬å¯¹ä¸€ä¸ªå·²æ’åºçš„æ•°ç»„è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾æ—¶ï¼Œå®ƒçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯å¯¹æ•°æ—¶é—´å¤æ‚åº¦ O(log n)ã€‚

```java
int[] nums = {1, 2, 3, 4, 5};
int target = 3;
int left = 0, right = nums.length - 1;
while (left <= right) {
    int mid = left + (right - left) / 2;
    if (nums[mid] == target) {
        System.out.println("æ‰¾åˆ°äº†ï¼Œä¸‹æ ‡ä¸º" + mid);
        break;
    } else if (nums[mid] < target) {
        left = mid + 1;
    } else {
        right = mid - 1;
    }
}
```

### 4ï¼‰å¹³æ–¹æ—¶é—´å¤æ‚åº¦ `O(n^2)`

å½“æˆ‘ä»¬å¯¹ä¸€ä¸ªæ•°ç»„è¿›è¡ŒåµŒå¥—å¾ªç¯æ—¶ï¼Œå®ƒçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯å¹³æ–¹æ—¶é—´å¤æ‚åº¦ O(n^2)ã€‚

```java
int[] nums = {1, 2, 3, 4, 5};
for (int i = 0; i < nums.length; i++) {
    for (int j = 0; j < nums.length; j++) {
        System.out.println(nums[i] + " " + nums[j]);
    }
}
```

### 5ï¼‰æŒ‡æ•°æ—¶é—´å¤æ‚åº¦ `O(2^n)`

å½“æˆ‘ä»¬é€’å½’æ±‚è§£ä¸€ä¸ªé—®é¢˜æ—¶ï¼Œæ¯ä¸€æ¬¡é€’å½’éƒ½ä¼šåˆ†æˆä¸¤ä¸ªå­é—®é¢˜ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯æŒ‡æ•°æ—¶é—´å¤æ‚åº¦ O(2^n)ã€‚

```java
public static int fib(int n) {
    if (n <= 1) {
        return n;
    }
    return fib(n - 1) + fib(n - 2);
}
```

ä¸Šé¢çš„ä»£ç æ˜¯é€’å½’æ±‚è§£æ–æ³¢é‚£å¥‘æ•°åˆ—çš„æ–¹æ³•ï¼Œå®ƒçš„æ—¶é—´å¤æ‚åº¦æ˜¯æŒ‡æ•°çº§åˆ«çš„ã€‚


â€œå¥½äº†ï¼Œä¸‰å¦¹ï¼Œè¿™èŠ‚å°±è®²åˆ°è¿™å§ï¼Œç†è§£äº†ä¸Šé¢ 5 ä¸ªæ—¶é—´å¤æ‚åº¦ï¼Œåé¢æˆ‘ä»¬å­¦ä¹  ArrayListã€LinkedList çš„æ—¶å€™ï¼Œä¸¤è€…åœ¨å¢åˆ æ”¹æŸ¥æ—¶çš„æ‰§è¡Œæ•ˆç‡å°±å¾ˆå®¹æ˜“å¯¹æ¯”æ¸…æ¥šäº†ã€‚â€æˆ‘ä¼¸äº†ä¸ªæ‡’è…°åå¯¹ä¸‰å¦¹è¯´ã€‚

â€œå¥½çš„ï¼ŒäºŒå“¥ã€‚â€ä¸‰å¦¹é‡æ–°å›ç­”æ²™å‘ä¸Šï¼Œä¸€ç›˜ç‹è€…è£è€€å³å°†å¼€å§‹ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 6.3 ArrayListè¯¦è§£ï¼ˆé™„æºç ï¼‰

â€œäºŒå“¥ï¼Œå¬è¯´ä»Šå¤©æˆ‘ä»¬å¼€è®² ArrayList äº†ï¼Ÿå¥½æœŸå¾…å“¦ï¼â€ä¸‰å¦¹æ˜çŸ¥æ•…é—®ï¼Œè¿™ä¸ªæ‰˜é…åˆå¾—ä¾ç„¶å¤©è¡£æ— ç¼ã€‚

â€œæ˜¯çš„å‘€ï¼Œä¸‰å¦¹ã€‚â€æˆ‘è‚¯å®šåœ°ç‚¹äº†ç‚¹å¤´ï¼Œç»§ç»­è¯´é“ï¼Œâ€œArrayList å¯ä»¥ç§°å¾—ä¸Šæ˜¯é›†åˆæ¡†æ¶æ–¹é¢æœ€å¸¸ç”¨çš„ç±»äº†ï¼Œå¯ä»¥å’Œ HashMap ä¸€è¾ƒé«˜ä¸‹ã€‚â€

ä»åå­—å°±å¯ä»¥çœ‹å¾—å‡ºæ¥ï¼ŒArrayList å®ç°äº† List æ¥å£ï¼Œå¹¶ä¸”æ˜¯åŸºäºæ•°ç»„å®ç°çš„ã€‚

æ•°ç»„çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œä¸€æ—¦åˆ›å»ºçš„æ—¶å€™æŒ‡å®šäº†å¤§å°ï¼Œå°±ä¸èƒ½å†è°ƒæ•´äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ•°ç»„æ»¡äº†ï¼Œå°±ä¸èƒ½å†æ·»åŠ ä»»ä½•å…ƒç´ äº†ã€‚ArrayList åœ¨æ•°ç»„çš„åŸºç¡€ä¸Šå®ç°äº†è‡ªåŠ¨æ‰©å®¹ï¼Œå¹¶ä¸”æä¾›äº†æ¯”æ•°ç»„æ›´ä¸°å¯Œçš„é¢„å®šä¹‰æ–¹æ³•ï¼ˆå„ç§å¢åˆ æ”¹æŸ¥ï¼‰ï¼Œéå¸¸çµæ´»ã€‚

Java è¿™é—¨ç¼–ç¨‹è¯­è¨€å’Œåˆ«çš„ç¼–ç¨‹è¯­è¨€ï¼Œæ¯”å¦‚è¯´ Cè¯­è¨€çš„ä¸åŒä¹‹å¤„å°±åœ¨è¿™é‡Œï¼Œå¦‚æœæ˜¯ Cè¯­è¨€çš„è¯ï¼Œä½ å°±å¿…é¡»å¾—åŠ¨æ‰‹å®ç°è‡ªå·±çš„ ArrayListï¼ŒåŸç”Ÿçš„åº“å‡½æ•°é‡Œé¢æ˜¯æ²¡æœ‰çš„ã€‚

### 01ã€åˆ›å»º ArrayList

â€œäºŒå“¥ï¼Œ**å¦‚ä½•åˆ›å»ºä¸€ä¸ª ArrayList å•Š**ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

```java
ArrayList<String> alist = new ArrayList<String>();
```

å¯ä»¥é€šè¿‡ä¸Šé¢çš„è¯­å¥æ¥åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„ ArrayListï¼ˆé€šè¿‡å°–æ‹¬å·æ¥é™å®š ArrayList ä¸­å…ƒç´ çš„ç±»å‹ï¼Œå¦‚æœå°è¯•æ·»åŠ å…¶ä»–ç±»å‹çš„å…ƒç´ ï¼Œå°†ä¼šäº§ç”Ÿç¼–è¯‘é”™è¯¯ï¼‰ï¼Œæ›´ç®€åŒ–çš„å†™æ³•å¦‚ä¸‹ï¼š

```java
List<String> alist = new ArrayList<>();
```

ç”±äº ArrayList å®ç°äº† List æ¥å£ï¼Œæ‰€ä»¥ alist å˜é‡çš„ç±»å‹å¯ä»¥æ˜¯ List ç±»å‹ï¼›new å…³é”®å­—å£°æ˜åçš„å°–æ‹¬å·ä¸­å¯ä»¥ä¸å†æŒ‡å®šå…ƒç´ çš„ç±»å‹ï¼Œå› ä¸ºç¼–è¯‘å™¨å¯ä»¥é€šè¿‡å‰é¢å°–æ‹¬å·ä¸­çš„ç±»å‹è¿›è¡Œæ™ºèƒ½æ¨æ–­ã€‚

æ­¤æ—¶ä¼šè°ƒç”¨æ— å‚æ„é€ æ–¹æ³•ï¼ˆè§ä¸‹é¢çš„ä»£ç ï¼‰åˆ›å»ºä¸€ä¸ªç©ºçš„æ•°ç»„ï¼Œå¸¸é‡DEFAULTCAPACITY_EMPTY_ELEMENTDATAçš„å€¼ä¸º `{}`ã€‚

```java
public ArrayList() {
    this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;
}
```

å¦‚æœéå¸¸ç¡®å®š ArrayList ä¸­å…ƒç´ çš„ä¸ªæ•°ï¼Œåœ¨åˆ›å»ºçš„æ—¶å€™è¿˜å¯ä»¥æŒ‡å®šåˆå§‹å¤§å°ã€‚

```java
List<String> alist = new ArrayList<>(20);
```

è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå¯ä»¥æœ‰æ•ˆåœ°é¿å…åœ¨æ·»åŠ æ–°çš„å…ƒç´ æ—¶è¿›è¡Œä¸å¿…è¦çš„æ‰©å®¹ã€‚

### 02ã€å‘ ArrayList ä¸­æ·»åŠ å…ƒç´ 

â€œäºŒå“¥ï¼Œ**é‚£æ€ä¹ˆå‘ ArrayList ä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ å‘¢**ï¼Ÿâ€ä¸‰å¦¹ç»§ç»­é—®ã€‚

å¯ä»¥é€šè¿‡ `add()` æ–¹æ³•å‘ ArrayList ä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ ã€‚

```java
alist.add("æ²‰é»˜ç‹äºŒ");
```

æˆ‘ä»¬æ¥è·Ÿä¸€ä¸‹æºç ï¼Œçœ‹çœ‹ add æ–¹æ³•åˆ°åº•æ‰§è¡Œäº†å“ªäº›æ“ä½œã€‚è·Ÿçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å·å¸ˆåˆ° Java æºç çš„ä½œè€…ï¼ˆå¤§å¸ˆçº§ç¨‹åºå‘˜ï¼‰æ˜¯å¦‚ä½•ä¼˜é›…åœ°å†™ä»£ç çš„ã€‚

æˆ‘å…ˆç»™ä¸ªç»“è®ºï¼Œå…¨å½“æŠ›ç –å¼•ç‰ã€‚

```
å †æ ˆè¿‡ç¨‹å›¾ç¤ºï¼š
add(element)
â””â”€â”€ if (size == elementData.length) // åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹
    â”œâ”€â”€ grow(minCapacity) // æ‰©å®¹
    â”‚   â””â”€â”€ newCapacity = oldCapacity + (oldCapacity >> 1) // è®¡ç®—æ–°çš„æ•°ç»„å®¹é‡
    â”‚   â””â”€â”€ Arrays.copyOf(elementData, newCapacity) // åˆ›å»ºæ–°çš„æ•°ç»„
    â”œâ”€â”€ elementData[size++] = element; // æ·»åŠ æ–°å…ƒç´ 
    â””â”€â”€ return true; // æ·»åŠ æˆåŠŸ
```

æ¥å…·ä½“çœ‹ä¸€ä¸‹ï¼Œå…ˆæ˜¯ `add()` æ–¹æ³•çš„æºç ï¼ˆå·²æ·»åŠ å¥½è¯¦ç»†åœ°æ³¨é‡Šï¼‰

```java
/**
 * å°†æŒ‡å®šå…ƒç´ æ·»åŠ åˆ° ArrayList çš„æœ«å°¾
 * @param e è¦æ·»åŠ çš„å…ƒç´ 
 * @return æ·»åŠ æˆåŠŸè¿”å› true
 */
public boolean add(E e) {
    ensureCapacityInternal(size + 1);  // ç¡®ä¿ ArrayList èƒ½å¤Ÿå®¹çº³æ–°çš„å…ƒç´ 
    elementData[size++] = e; // åœ¨ ArrayList çš„æœ«å°¾æ·»åŠ æŒ‡å®šå…ƒç´ 
    return true;
}
```

å‚æ•° e ä¸ºè¦æ·»åŠ çš„å…ƒç´ ï¼Œæ­¤æ—¶çš„å€¼ä¸ºâ€œæ²‰é»˜ç‹äºŒâ€ï¼Œsize ä¸º ArrayList çš„é•¿åº¦ï¼Œæ­¤æ—¶ä¸º 0ã€‚

ç»§ç»­è·Ÿä¸‹å»ï¼Œæ¥çœ‹çœ‹ `ensureCapacityInternal()`æ–¹æ³•ï¼š

```java
/**
 * ç¡®ä¿ ArrayList èƒ½å¤Ÿå®¹çº³æŒ‡å®šå®¹é‡çš„å…ƒç´ 
 * @param minCapacity æŒ‡å®šå®¹é‡çš„æœ€å°å€¼
 */
private void ensureCapacityInternal(int minCapacity) {
    if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) { // å¦‚æœ elementData è¿˜æ˜¯é»˜è®¤çš„ç©ºæ•°ç»„
        minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity); // ä½¿ç”¨ DEFAULT_CAPACITY å’ŒæŒ‡å®šå®¹é‡çš„æœ€å°å€¼ä¸­çš„è¾ƒå¤§å€¼
    }

    ensureExplicitCapacity(minCapacity); // ç¡®ä¿å®¹é‡èƒ½å¤Ÿå®¹çº³æŒ‡å®šå®¹é‡çš„å…ƒç´ 
}
```

æ­¤æ—¶ï¼š

- å‚æ•° minCapacity ä¸º 1ï¼ˆsize+1 ä¼ è¿‡æ¥çš„ï¼‰
- elementData ä¸ºå­˜æ”¾ ArrayList å…ƒç´ çš„åº•å±‚æ•°ç»„ï¼Œå‰é¢å£°æ˜ ArrayList çš„æ—¶å€™è®²è¿‡äº†ï¼Œæ­¤æ—¶ä¸ºç©º `{}`
- DEFAULTCAPACITY_EMPTY_ELEMENTDATA å‰é¢ä¹Ÿè®²è¿‡äº†ï¼Œä¸º `{}`

æ‰€ä»¥ï¼Œif æ¡ä»¶æ­¤æ—¶ä¸º trueï¼Œif è¯­å¥`minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity)`è¦æ‰§è¡Œã€‚

DEFAULT_CAPACITY ä¸º 10ï¼ˆè§ä¸‹é¢çš„ä»£ç ï¼‰ï¼Œæ‰€ä»¥æ‰§è¡Œå®Œè¿™è¡Œä»£ç åï¼ŒminCapacity ä¸º 10ï¼Œ`Math.max()` æ–¹æ³•çš„ä½œç”¨æ˜¯å–ä¸¤ä¸ªå½“ä¸­æœ€å¤§çš„é‚£ä¸ªã€‚

```java
private static final int DEFAULT_CAPACITY = 10;
```

æ¥ä¸‹æ¥æ‰§è¡Œ `ensureExplicitCapacity()` æ–¹æ³•ï¼Œæ¥çœ‹ä¸€ä¸‹æºç ï¼š

```java
/**
 * æ£€æŸ¥å¹¶ç¡®ä¿é›†åˆå®¹é‡è¶³å¤Ÿï¼Œå¦‚æœéœ€è¦åˆ™å¢åŠ é›†åˆå®¹é‡ã€‚
 *
 * @param minCapacity æ‰€éœ€æœ€å°å®¹é‡
 */
private void ensureExplicitCapacity(int minCapacity) {
    // æ£€æŸ¥æ˜¯å¦è¶…å‡ºäº†æ•°ç»„èŒƒå›´ï¼Œç¡®ä¿ä¸ä¼šæº¢å‡º
    if (minCapacity - elementData.length > 0)
        // å¦‚æœéœ€è¦å¢åŠ å®¹é‡ï¼Œåˆ™è°ƒç”¨ grow æ–¹æ³•
        grow(minCapacity);
}
```

æ­¤æ—¶ï¼š

- å‚æ•° minCapacity ä¸º 10
- elementData.length ä¸º 0ï¼ˆæ•°ç»„ä¸ºç©ºï¼‰

æ‰€ä»¥ 10-0>0ï¼Œif æ¡ä»¶ä¸º trueï¼Œè¿›å…¥ if è¯­å¥æ‰§è¡Œ `grow()` æ–¹æ³•ï¼Œæ¥çœ‹æºç ï¼š

```java
/**
 * æ‰©å®¹ ArrayList çš„æ–¹æ³•ï¼Œç¡®ä¿èƒ½å¤Ÿå®¹çº³æŒ‡å®šå®¹é‡çš„å…ƒç´ 
 * @param minCapacity æŒ‡å®šå®¹é‡çš„æœ€å°å€¼
 */
private void grow(int minCapacity) {
    // æ£€æŸ¥æ˜¯å¦ä¼šå¯¼è‡´æº¢å‡ºï¼ŒoldCapacity ä¸ºå½“å‰æ•°ç»„é•¿åº¦
    int oldCapacity = elementData.length;
    int newCapacity = oldCapacity + (oldCapacity >> 1); // æ‰©å®¹è‡³åŸæ¥çš„1.5å€
    if (newCapacity - minCapacity < 0) // å¦‚æœè¿˜æ˜¯å°äºæŒ‡å®šå®¹é‡çš„æœ€å°å€¼
        newCapacity = minCapacity; // ç›´æ¥æ‰©å®¹è‡³æŒ‡å®šå®¹é‡çš„æœ€å°å€¼
    if (newCapacity - MAX_ARRAY_SIZE > 0) // å¦‚æœè¶…å‡ºäº†æ•°ç»„çš„æœ€å¤§é•¿åº¦
        newCapacity = hugeCapacity(minCapacity); // æ‰©å®¹è‡³æ•°ç»„çš„æœ€å¤§é•¿åº¦
    // å°†å½“å‰æ•°ç»„å¤åˆ¶åˆ°ä¸€ä¸ªæ–°æ•°ç»„ä¸­ï¼Œé•¿åº¦ä¸º newCapacity
    elementData = Arrays.copyOf(elementData, newCapacity);
}
```

æ­¤æ—¶ï¼š

- å‚æ•° minCapacity ä¸º 10
- å˜é‡ oldCapacity ä¸º 0

æ‰€ä»¥ newCapacity ä¹Ÿä¸º 0ï¼Œäºæ˜¯ `newCapacity - minCapacity` ç­‰äº -10 å°äº 0ï¼Œäºæ˜¯ç¬¬ä¸€ä¸ª if æ¡ä»¶ä¸º trueï¼Œæ‰§è¡Œç¬¬ä¸€ä¸ª if è¯­å¥ `newCapacity = minCapacity`ï¼Œç„¶å newCapacity ä¸º 10ã€‚

ç´§æ¥ç€æ‰§è¡Œ `elementData = Arrays.copyOf(elementData, newCapacity);`ï¼Œä¹Ÿå°±æ˜¯è¿›è¡Œæ•°ç»„çš„ç¬¬ä¸€æ¬¡æ‰©å®¹ï¼Œé•¿åº¦ä¸º 10ã€‚

å›åˆ° `add()` æ–¹æ³•ï¼š

```java
public boolean add(E e) {
    ensureCapacityInternal(size + 1);
    elementData[size++] = e;
    return true;
}
```

æ‰§è¡Œ `elementData[size++] = e`ã€‚

æ­¤æ—¶ï¼š

- size ä¸º 0
- e ä¸º â€œæ²‰é»˜ç‹äºŒâ€

æ‰€ä»¥æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆä¸‹æ ‡ä¸º 0ï¼‰ è¢«èµ‹å€¼ä¸ºâ€œæ²‰é»˜ç‹äºŒâ€ï¼Œæ¥ç€è¿”å› trueï¼Œç¬¬ä¸€æ¬¡ add æ–¹æ³•æ‰§è¡Œå®Œæ¯•ã€‚

PSï¼šadd è¿‡ç¨‹ä¸­ä¼šé‡åˆ°ä¸€ä¸ªä»¤æ–°æ‰‹æ„Ÿåˆ°å›°æƒ‘çš„å³ç§»æ“ä½œç¬¦ `>>`ï¼Œå€Ÿè¿™ä¸ªæœºä¼šæ¥è§£é‡Šä¸€ä¸‹ã€‚

ArrayList åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œ add åä¼šæ‰©å®¹ä¸º 10ï¼Œé‚£ ArrayList ç¬¬äºŒæ¬¡æ‰©å®¹å‘ç”Ÿåœ¨ä»€ä¹ˆæ—¶å€™å‘¢ï¼Ÿ

ç­”æ¡ˆæ˜¯æ·»åŠ ç¬¬ 11 ä¸ªå…ƒç´ æ—¶ï¼Œå¤§å®¶å¯ä»¥å°è¯•åˆ†æä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ã€‚

### 03ã€å³ç§»æ“ä½œç¬¦

â€œoldCapacity ç­‰äº 10ï¼Œ`oldCapacity >> 1` è¿™ä¸ªè¡¨è¾¾å¼ç­‰äºå¤šå°‘å‘¢ï¼Ÿä¸‰å¦¹ä½ çŸ¥é“å—ï¼Ÿâ€æˆ‘é—®ä¸‰å¦¹ã€‚

â€œä¸çŸ¥é“å•Šï¼Œ`>>` æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿâ€ä¸‰å¦¹å¾ˆç–‘æƒ‘ã€‚

â€œ`>>` æ˜¯å³ç§»è¿ç®—ç¬¦ï¼Œ`oldCapacity >> 1` ç›¸å½“äº oldCapacity é™¤ä»¥ 2ã€‚â€æˆ‘ç»™ä¸‰å¦¹è§£é‡Šé“ï¼Œâ€œåœ¨è®¡ç®—æœºå†…éƒ¨ï¼Œéƒ½æ˜¯æŒ‰ç…§äºŒè¿›åˆ¶å­˜å‚¨çš„ï¼Œ10 çš„äºŒè¿›åˆ¶å°±æ˜¯ 1010ï¼Œä¹Ÿå°±æ˜¯ `0*2^0 + 1*2^1 + 0*2^2 + 1*2^3`=0+2+0+8=10 ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚â€

è¿˜æ²¡ç­‰æˆ‘è§£é‡Šå®Œï¼Œä¸‰å¦¹å°±æ‰“æ–­äº†æˆ‘ï¼Œâ€œäºŒå“¥ï¼Œèƒ½å†è¯¦ç»†è§£é‡Šä¸€ä¸‹åˆ°åº•ä¸ºä»€ä¹ˆå—ï¼Ÿâ€

â€œå½“ç„¶å¯ä»¥å•Šã€‚â€æˆ‘æ‹ç€èƒ¸è„¯å¯¹ä¸‰å¦¹è¯´ã€‚

å…ˆä»ä½æƒçš„å«ä¹‰è¯´èµ·å§ã€‚

å¹³å¸¸æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯åè¿›åˆ¶æ•°ï¼Œæ¯”å¦‚è¯´ 39ï¼Œå¹¶ä¸æ˜¯ç®€å•çš„ 3 å’Œ 9ï¼Œ3 è¡¨ç¤ºçš„æ˜¯ `3*10 = 30`ï¼Œ9 è¡¨ç¤ºçš„æ˜¯ `9*1 = 9`ï¼Œå’Œ 3 ç›¸ä¹˜çš„ 10ï¼Œå’Œ 9 ç›¸ä¹˜çš„ 1ï¼Œå°±æ˜¯**ä½æƒ**ã€‚ä½æ•°ä¸åŒï¼Œä½æƒå°±ä¸åŒï¼Œç¬¬ 1 ä½æ˜¯ 10 çš„ 0 æ¬¡æ–¹ï¼ˆä¹Ÿå°±æ˜¯ `10^0=1`ï¼‰ï¼Œç¬¬ 2 ä½æ˜¯ 10 çš„ 1 æ¬¡æ–¹ï¼ˆ`10^1=10`ï¼‰ï¼Œç¬¬ 3 ä½æ˜¯ 10 çš„ 2 æ¬¡æ–¹ï¼ˆ`10^2=100`ï¼‰ï¼Œæœ€å³è¾¹çš„æ˜¯ç¬¬ä¸€ä½ï¼Œä¾æ¬¡ç±»æ¨ã€‚

ä½æƒè¿™ä¸ªæ¦‚å¿µåŒæ ·é€‚ç”¨äºäºŒè¿›åˆ¶ï¼Œç¬¬ 1 ä½æ˜¯ 2 çš„ 0 æ¬¡æ–¹ï¼ˆä¹Ÿå°±æ˜¯ `2^0=1`ï¼‰ï¼Œç¬¬ 2 ä½æ˜¯ 2 çš„ 1 æ¬¡æ–¹ï¼ˆ`2^1=2`ï¼‰ï¼Œç¬¬ 3 ä½æ˜¯ 2 çš„ 2 æ¬¡æ–¹ï¼ˆ`2^2=4`ï¼‰ï¼Œç¬¬ 34 ä½æ˜¯ 2 çš„ 3 æ¬¡æ–¹ï¼ˆ`2^3=8`ï¼‰ã€‚

åè¿›åˆ¶çš„æƒ…å†µä¸‹ï¼Œ10 æ˜¯åŸºæ•°ï¼ŒäºŒè¿›åˆ¶çš„æƒ…å†µä¸‹ï¼Œ2 æ˜¯åŸºæ•°ã€‚

10 åœ¨åè¿›åˆ¶çš„è¡¨ç¤ºæ³•æ˜¯ `0*10^0+1*10^1`=0+10=10ã€‚

10 çš„äºŒè¿›åˆ¶æ•°æ˜¯ 1010ï¼Œä¹Ÿå°±æ˜¯ `0*2^0 + 1*2^1 + 0*2^2 + 1*2^3`=0+2+0+8=10ã€‚

ç„¶åæ˜¯**ç§»ä½è¿ç®—**ï¼Œç§»ä½åˆ†ä¸ºå·¦ç§»å’Œå³ç§»ï¼Œåœ¨ Java ä¸­ï¼Œå·¦ç§»çš„è¿ç®—ç¬¦æ˜¯ `<<`ï¼Œå³ç§»çš„è¿ç®—ç¬¦ `>>`ã€‚

æ‹¿ `oldCapacity >> 1` æ¥è¯´å§ï¼Œ`>>` å·¦è¾¹çš„æ˜¯è¢«ç§»ä½çš„å€¼ï¼Œæ­¤æ—¶æ˜¯ 10ï¼Œä¹Ÿå°±æ˜¯äºŒè¿›åˆ¶ `1010`ï¼›`>>` å³è¾¹çš„æ˜¯è¦ç§»ä½çš„ä½æ•°ï¼Œæ­¤æ—¶æ˜¯ 1ã€‚

1010 å‘å³ç§»ä¸€ä½å°±æ˜¯ 101ï¼Œç©ºå‡ºæ¥çš„æœ€é«˜ä½æ­¤æ—¶è¦è¡¥ 0ï¼Œä¹Ÿå°±æ˜¯ 0101ã€‚

â€œé‚£ä¸ºä»€ä¹ˆä¸è¡¥ 1 å‘¢ï¼Ÿâ€ä¸‰å¦¹è¿™ä¸ªé—®é¢˜å¾ˆå°–é”ã€‚

â€œå› ä¸ºæ˜¯ç®—æœ¯å³ç§»ï¼Œå¹¶ä¸”æ˜¯æ­£æ•°ï¼Œæ‰€ä»¥æœ€é«˜ä½è¡¥ 0ï¼›å¦‚æœè¡¨ç¤ºçš„æ˜¯è´Ÿæ•°ï¼Œå°±éœ€è¦è¡¥ 1ã€‚â€æˆ‘æ…¢åååœ°å›ç­”é“ï¼Œâ€œ0101 çš„åè¿›åˆ¶å°±åˆšå¥½æ˜¯ `1*2^0 + 0*2^1 + 1*2^2 + 0*2^3`=1+0+4+0=5ï¼Œå¦‚æœå¤šç§»å‡ ä¸ªæ•°æ¥æ‰¾è§„å¾‹çš„è¯ï¼Œå°±ä¼šå‘ç°ï¼Œå³ç§» 1 ä½æ˜¯åŸæ¥çš„ 1/2ï¼Œå³ç§» 2 ä½æ˜¯åŸæ¥çš„ 1/4ï¼Œè¯¸å¦‚æ­¤ç±»ã€‚â€

ä¹Ÿå°±æ˜¯è¯´ï¼ŒArrayList çš„å¤§å°ä¼šæ‰©å®¹ä¸ºåŸæ¥çš„å¤§å°+åŸæ¥å¤§å°/2ï¼Œä¹Ÿå°±æ˜¯ 1.5 å€ã€‚

è¿™ä¸‹æ˜ç™½äº†å§ï¼Ÿ

ä½ å¯ä»¥é€šè¿‡åœ¨ ArrayList ä¸­æ·»åŠ ç¬¬ 11 ä¸ªå…ƒç´ æ¥ debug éªŒè¯ä¸€ä¸‹ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection//arraylist-d01f248c-114f-47e3-af18-7135feac2a5e.png)

### 04ã€å‘ ArrayList çš„æŒ‡å®šä½ç½®æ·»åŠ å…ƒç´ 

é™¤äº† `add(E e)` æ–¹æ³•ï¼Œè¿˜å¯ä»¥é€šè¿‡ `add(int index, E element)` æ–¹æ³•æŠŠå…ƒç´ æ·»åŠ åˆ° ArrayList çš„æŒ‡å®šä½ç½®ï¼š

```java
alist.add(0, "æ²‰é»˜ç‹ä¸‰");
```

`add(int index, E element)` æ–¹æ³•çš„æºç å¦‚ä¸‹ï¼š

```java
/**
 * åœ¨æŒ‡å®šä½ç½®æ’å…¥ä¸€ä¸ªå…ƒç´ ã€‚
 *
 * @param index   è¦æ’å…¥å…ƒç´ çš„ä½ç½®
 * @param element è¦æ’å…¥çš„å…ƒç´ 
 * @throws IndexOutOfBoundsException å¦‚æœç´¢å¼•è¶…å‡ºèŒƒå›´ï¼Œåˆ™æŠ›å‡ºæ­¤å¼‚å¸¸
 */
public void add(int index, E element) {
    rangeCheckForAdd(index); // æ£€æŸ¥ç´¢å¼•æ˜¯å¦è¶Šç•Œ

    ensureCapacityInternal(size + 1);  // ç¡®ä¿å®¹é‡è¶³å¤Ÿï¼Œå¦‚æœéœ€è¦æ‰©å®¹å°±æ‰©å®¹
    System.arraycopy(elementData, index, elementData, index + 1,
            size - index); // å°† index åŠå…¶åé¢çš„å…ƒç´ å‘åç§»åŠ¨ä¸€ä½
    elementData[index] = element; // å°†å…ƒç´ æ’å…¥åˆ°æŒ‡å®šä½ç½®
    size++; // å…ƒç´ ä¸ªæ•°åŠ ä¸€
}
```

`add(int index, E element)`æ–¹æ³•ä¼šè°ƒç”¨åˆ°ä¸€ä¸ªéå¸¸é‡è¦çš„[æœ¬åœ°æ–¹æ³•](https://tobebetterjavaer.com/oo/native-method.html) `System.arraycopy()`ï¼Œå®ƒä¼šå¯¹æ•°ç»„è¿›è¡Œå¤åˆ¶ï¼ˆè¦æ’å…¥ä½ç½®ä¸Šçš„å…ƒç´ å¾€åå¤åˆ¶ï¼‰ã€‚

æ¥ç»†å“ä¸€ä¸‹ã€‚

è¿™æ˜¯ arraycopy() çš„è¯­æ³•ï¼š

```java
System.arraycopy(Object src, int srcPos, Object dest, int destPos, int length);
```

åœ¨ `ArrayList.add(int index, E element)` æ–¹æ³•ä¸­ï¼Œå…·ä½“ç”¨æ³•å¦‚ä¸‹ï¼š

```java
System.arraycopy(elementData, index, elementData, index + 1, size - index);
```

- elementDataï¼šè¡¨ç¤ºè¦å¤åˆ¶çš„æºæ•°ç»„ï¼Œå³ ArrayList ä¸­çš„å…ƒç´ æ•°ç»„ã€‚
- indexï¼šè¡¨ç¤ºæºæ•°ç»„ä¸­è¦å¤åˆ¶çš„èµ·å§‹ä½ç½®ï¼Œå³éœ€è¦å°† index åŠå…¶åé¢çš„å…ƒç´ å‘åç§»åŠ¨ä¸€ä½ã€‚
- elementDataï¼šè¡¨ç¤ºè¦å¤åˆ¶åˆ°çš„ç›®æ ‡æ•°ç»„ï¼Œå³ ArrayList ä¸­çš„å…ƒç´ æ•°ç»„ã€‚
- index + 1ï¼šè¡¨ç¤ºç›®æ ‡æ•°ç»„ä¸­å¤åˆ¶çš„èµ·å§‹ä½ç½®ï¼Œå³å°† index åŠå…¶åé¢çš„å…ƒç´ å‘åç§»åŠ¨ä¸€ä½åï¼Œåº”è¯¥æ’å…¥åˆ°çš„ä½ç½®ã€‚
- size - indexï¼šè¡¨ç¤ºè¦å¤åˆ¶çš„å…ƒç´ ä¸ªæ•°ï¼Œå³éœ€è¦å°† index åŠå…¶åé¢çš„å…ƒç´ å‘åç§»åŠ¨ä¸€ä½ï¼Œéœ€è¦ç§»åŠ¨çš„å…ƒç´ ä¸ªæ•°ä¸º size - indexã€‚


â€œä¸‰å¦¹ï¼Œæ³¨æ„çœ‹ï¼Œæˆ‘ç”»å¹…å›¾æ¥è¡¨ç¤ºä¸‹ã€‚â€æˆ‘è®¤çœŸåœ°åšèµ·äº†å›¾ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/arraylist-01.png)

### 05ã€æ›´æ–° ArrayList ä¸­çš„å…ƒç´ 

â€œäºŒå“¥ï¼Œé‚£æ€ä¹ˆ**æ›´æ–° ArrayList ä¸­çš„å…ƒç´ **å‘¢ï¼Ÿâ€ä¸‰å¦¹ç»§ç»­é—®ã€‚

å¯ä»¥ä½¿ç”¨ `set()` æ–¹æ³•æ¥æ›´æ”¹ ArrayList ä¸­çš„å…ƒç´ ï¼Œéœ€è¦æä¾›ä¸‹æ ‡å’Œæ–°å…ƒç´ ã€‚

```java
alist.set(0, "æ²‰é»˜ç‹å››");
```

å‡è®¾åŸæ¥ 0 ä½ç½®ä¸Šçš„å…ƒç´ ä¸ºâ€œæ²‰é»˜ç‹ä¸‰â€ï¼Œç°åœ¨å¯ä»¥å°†å…¶æ›´æ–°ä¸ºâ€œæ²‰é»˜ç‹å››â€ã€‚

æ¥çœ‹ä¸€ä¸‹ `set()` æ–¹æ³•çš„æºç ï¼š

```java
/**
 * ç”¨æŒ‡å®šå…ƒç´ æ›¿æ¢æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚
 *
 * @param index   è¦æ›¿æ¢çš„å…ƒç´ çš„ç´¢å¼•
 * @param element è¦å­˜å‚¨åœ¨æŒ‡å®šä½ç½®çš„å…ƒç´ 
 * @return å…ˆå‰åœ¨æŒ‡å®šä½ç½®çš„å…ƒç´ 
 * @throws IndexOutOfBoundsException å¦‚æœç´¢å¼•è¶…å‡ºèŒƒå›´ï¼Œåˆ™æŠ›å‡ºæ­¤å¼‚å¸¸
 */
public E set(int index, E element) {
    rangeCheck(index); // æ£€æŸ¥ç´¢å¼•æ˜¯å¦è¶Šç•Œ

    E oldValue = elementData(index); // è·å–åŸæ¥åœ¨æŒ‡å®šä½ç½®ä¸Šçš„å…ƒç´ 
    elementData[index] = element; // å°†æ–°å…ƒç´ æ›¿æ¢åˆ°æŒ‡å®šä½ç½®ä¸Š
    return oldValue; // è¿”å›åŸæ¥åœ¨æŒ‡å®šä½ç½®ä¸Šçš„å…ƒç´ 
}
```

è¯¥æ–¹æ³•ä¼šå…ˆå¯¹æŒ‡å®šçš„ä¸‹æ ‡è¿›è¡Œæ£€æŸ¥ï¼Œçœ‹æ˜¯å¦è¶Šç•Œï¼Œç„¶åæ›¿æ¢æ–°å€¼å¹¶è¿”å›æ—§å€¼ã€‚

### 06ã€åˆ é™¤ ArrayList ä¸­çš„å…ƒç´ 

â€œäºŒå“¥ï¼Œé‚£æ€ä¹ˆ**åˆ é™¤ ArrayList ä¸­çš„å…ƒç´ **å‘¢ï¼Ÿâ€ä¸‰å¦¹ç»§ç»­é—®ã€‚

`remove(int index)` æ–¹æ³•ç”¨äºåˆ é™¤æŒ‡å®šä¸‹æ ‡ä½ç½®ä¸Šçš„å…ƒç´ ï¼Œ`remove(Object o)` æ–¹æ³•ç”¨äºåˆ é™¤æŒ‡å®šå€¼çš„å…ƒç´ ã€‚

```java
alist.remove(1);
alist.remove("æ²‰é»˜ç‹å››");
```

å…ˆæ¥çœ‹ `remove(int index)` æ–¹æ³•çš„æºç ï¼š

```java
/**
 * åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚
 *
 * @param index è¦åˆ é™¤çš„å…ƒç´ çš„ç´¢å¼•
 * @return å…ˆå‰åœ¨æŒ‡å®šä½ç½®çš„å…ƒç´ 
 * @throws IndexOutOfBoundsException å¦‚æœç´¢å¼•è¶…å‡ºèŒƒå›´ï¼Œåˆ™æŠ›å‡ºæ­¤å¼‚å¸¸
 */
public E remove(int index) {
    rangeCheck(index); // æ£€æŸ¥ç´¢å¼•æ˜¯å¦è¶Šç•Œ

    E oldValue = elementData(index); // è·å–è¦åˆ é™¤çš„å…ƒç´ 

    int numMoved = size - index - 1; // è®¡ç®—éœ€è¦ç§»åŠ¨çš„å…ƒç´ ä¸ªæ•°
    if (numMoved > 0) // å¦‚æœéœ€è¦ç§»åŠ¨å…ƒç´ ï¼Œå°±ç”¨ System.arraycopy æ–¹æ³•å®ç°
        System.arraycopy(elementData, index+1, elementData, index,
                numMoved);
    elementData[--size] = null; // å°†æ•°ç»„æœ«å°¾çš„å…ƒç´ ç½®ä¸º nullï¼Œè®© GC å›æ”¶è¯¥å…ƒç´ å ç”¨çš„ç©ºé—´

    return oldValue; // è¿”å›è¢«åˆ é™¤çš„å…ƒç´ 
}
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ ArrayList ä¸­ï¼Œåˆ é™¤å…ƒç´ æ—¶ï¼Œéœ€è¦å°†åˆ é™¤ä½ç½®åé¢çš„å…ƒç´ å‘å‰ç§»åŠ¨ä¸€ä½ï¼Œä»¥å¡«è¡¥åˆ é™¤ä½ç½®ç•™ä¸‹çš„ç©ºç¼ºã€‚å¦‚æœéœ€è¦ç§»åŠ¨å…ƒç´ ï¼Œåˆ™éœ€è¦ä½¿ç”¨ System.arraycopy æ–¹æ³•å°†åˆ é™¤ä½ç½®åé¢çš„å…ƒç´ å‘å‰ç§»åŠ¨ä¸€ä½ã€‚æœ€åï¼Œå°†æ•°ç»„æœ«å°¾çš„å…ƒç´ ç½®ä¸º nullï¼Œä»¥ä¾¿è®©åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶è¯¥å…ƒç´ å ç”¨çš„ç©ºé—´ã€‚

å†æ¥çœ‹ `remove(Object o)` æ–¹æ³•çš„æºç ï¼š

```java
/**
 * åˆ é™¤åˆ—è¡¨ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„æŒ‡å®šå…ƒç´ ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚
 *
 * @param o è¦åˆ é™¤çš„å…ƒç´ 
 * @return å¦‚æœåˆ—è¡¨åŒ…å«æŒ‡å®šå…ƒç´ ï¼Œåˆ™è¿”å› trueï¼›å¦åˆ™è¿”å› false
 */
public boolean remove(Object o) {
    if (o == null) { // å¦‚æœè¦åˆ é™¤çš„å…ƒç´ æ˜¯ null
        for (int index = 0; index < size; index++) // éå†åˆ—è¡¨
            if (elementData[index] == null) { // å¦‚æœæ‰¾åˆ°äº† null å…ƒç´ 
                fastRemove(index); // è°ƒç”¨ fastRemove æ–¹æ³•å¿«é€Ÿåˆ é™¤å…ƒç´ 
                return true; // è¿”å› trueï¼Œè¡¨ç¤ºæˆåŠŸåˆ é™¤å…ƒç´ 
            }
    } else { // å¦‚æœè¦åˆ é™¤çš„å…ƒç´ ä¸æ˜¯ null
        for (int index = 0; index < size; index++) // éå†åˆ—è¡¨
            if (o.equals(elementData[index])) { // å¦‚æœæ‰¾åˆ°äº†è¦åˆ é™¤çš„å…ƒç´ 
                fastRemove(index); // è°ƒç”¨ fastRemove æ–¹æ³•å¿«é€Ÿåˆ é™¤å…ƒç´ 
                return true; // è¿”å› trueï¼Œè¡¨ç¤ºæˆåŠŸåˆ é™¤å…ƒç´ 
            }
    }
    return false; // å¦‚æœæ‰¾ä¸åˆ°è¦åˆ é™¤çš„å…ƒç´ ï¼Œåˆ™è¿”å› false
}
```

è¯¥æ–¹æ³•é€šè¿‡éå†çš„æ–¹å¼æ‰¾åˆ°è¦åˆ é™¤çš„å…ƒç´ ï¼Œnull çš„æ—¶å€™ä½¿ç”¨ == æ“ä½œç¬¦åˆ¤æ–­ï¼Œé null çš„æ—¶å€™ä½¿ç”¨ `equals()` æ–¹æ³•ï¼Œç„¶åè°ƒç”¨ `fastRemove()` æ–¹æ³•ã€‚

æ³¨æ„ï¼š

- æœ‰ç›¸åŒå…ƒç´ æ—¶ï¼Œåªä¼šåˆ é™¤ç¬¬ä¸€ä¸ªã€‚
- åˆ¤æ–­ä¸¤ä¸ªå…ƒç´ æ˜¯å¦ç›¸ç­‰ï¼Œå¯ä»¥å‚è€ƒ[Javaå¦‚ä½•åˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰](https://tobebetterjavaer.com/string/equals.html)

ç»§ç»­å¾€åé¢è·Ÿï¼Œæ¥çœ‹ä¸€ä¸‹ `fastRemove()` æ–¹æ³•ï¼š

```java
/**
 * å¿«é€Ÿåˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚
 *
 * @param index è¦åˆ é™¤çš„å…ƒç´ çš„ç´¢å¼•
 */
private void fastRemove(int index) {
    int numMoved = size - index - 1; // è®¡ç®—éœ€è¦ç§»åŠ¨çš„å…ƒç´ ä¸ªæ•°
    if (numMoved > 0) // å¦‚æœéœ€è¦ç§»åŠ¨å…ƒç´ ï¼Œå°±ç”¨ System.arraycopy æ–¹æ³•å®ç°
        System.arraycopy(elementData, index+1, elementData, index,
                numMoved);
    elementData[--size] = null; // å°†æ•°ç»„æœ«å°¾çš„å…ƒç´ ç½®ä¸º nullï¼Œè®© GC å›æ”¶è¯¥å…ƒç´ å ç”¨çš„ç©ºé—´
}
```

åŒæ ·æ˜¯è°ƒç”¨ `System.arraycopy()` æ–¹æ³•å¯¹æ•°ç»„è¿›è¡Œå¤åˆ¶å’Œç§»åŠ¨ã€‚

â€œä¸‰å¦¹ï¼Œæ³¨æ„çœ‹ï¼Œæˆ‘ç”»å¹…å›¾æ¥è¡¨ç¤ºä¸‹ã€‚â€æˆ‘è®¤çœŸåœ°åšèµ·äº†å›¾ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/arraylist-02.png)

### 07ã€æŸ¥æ‰¾ ArrayList ä¸­çš„å…ƒç´ 

â€œäºŒå“¥ï¼Œé‚£æ€ä¹ˆ**æŸ¥æ‰¾ ArrayList ä¸­çš„å…ƒç´ **å‘¢ï¼Ÿâ€ä¸‰å¦¹ç»§ç»­é—®ã€‚

å¦‚æœè¦æ­£åºæŸ¥æ‰¾ä¸€ä¸ªå…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨ `indexOf()` æ–¹æ³•ï¼›å¦‚æœè¦å€’åºæŸ¥æ‰¾ä¸€ä¸ªå…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨ `lastIndexOf()` æ–¹æ³•ã€‚

```java
alist.indexOf("æ²‰é»˜ç‹äºŒ");
alist.lastIndexOf("æ²‰é»˜ç‹äºŒ");
```

æ¥çœ‹ä¸€ä¸‹ `indexOf()` æ–¹æ³•çš„æºç ï¼š

```java
/**
 * è¿”å›æŒ‡å®šå…ƒç´ åœ¨åˆ—è¡¨ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ã€‚
 * å¦‚æœåˆ—è¡¨ä¸åŒ…å«è¯¥å…ƒç´ ï¼Œåˆ™è¿”å› -1ã€‚
 *
 * @param o è¦æŸ¥æ‰¾çš„å…ƒç´ 
 * @return æŒ‡å®šå…ƒç´ åœ¨åˆ—è¡¨ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼›å¦‚æœåˆ—è¡¨ä¸åŒ…å«è¯¥å…ƒç´ ï¼Œåˆ™è¿”å› -1
 */
public int indexOf(Object o) {
    if (o == null) { // å¦‚æœè¦æŸ¥æ‰¾çš„å…ƒç´ æ˜¯ null
        for (int i = 0; i < size; i++) // éå†åˆ—è¡¨
            if (elementData[i]==null) // å¦‚æœæ‰¾åˆ°äº† null å…ƒç´ 
                return i; // è¿”å›å…ƒç´ çš„ç´¢å¼•
    } else { // å¦‚æœè¦æŸ¥æ‰¾çš„å…ƒç´ ä¸æ˜¯ null
        for (int i = 0; i < size; i++) // éå†åˆ—è¡¨
            if (o.equals(elementData[i])) // å¦‚æœæ‰¾åˆ°äº†è¦æŸ¥æ‰¾çš„å…ƒç´ 
                return i; // è¿”å›å…ƒç´ çš„ç´¢å¼•
    }
    return -1; // å¦‚æœæ‰¾ä¸åˆ°è¦æŸ¥æ‰¾çš„å…ƒç´ ï¼Œåˆ™è¿”å› -1
}
```

å¦‚æœå…ƒç´ ä¸º null çš„æ—¶å€™ä½¿ç”¨â€œ==â€æ“ä½œç¬¦ï¼Œå¦åˆ™ä½¿ç”¨ `equals()` æ–¹æ³•ã€‚

`lastIndexOf()` æ–¹æ³•å’Œ `indexOf()` æ–¹æ³•ç±»ä¼¼ï¼Œä¸è¿‡éå†çš„æ—¶å€™ä»æœ€åå¼€å§‹ã€‚

```java
/**
 * è¿”å›æŒ‡å®šå…ƒç´ åœ¨åˆ—è¡¨ä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®ã€‚
 * å¦‚æœåˆ—è¡¨ä¸åŒ…å«è¯¥å…ƒç´ ï¼Œåˆ™è¿”å› -1ã€‚
 *
 * @param o è¦æŸ¥æ‰¾çš„å…ƒç´ 
 * @return æŒ‡å®šå…ƒç´ åœ¨åˆ—è¡¨ä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼›å¦‚æœåˆ—è¡¨ä¸åŒ…å«è¯¥å…ƒç´ ï¼Œåˆ™è¿”å› -1
 */
public int lastIndexOf(Object o) {
    if (o == null) { // å¦‚æœè¦æŸ¥æ‰¾çš„å…ƒç´ æ˜¯ null
        for (int i = size-1; i >= 0; i--) // ä»åå¾€å‰éå†åˆ—è¡¨
            if (elementData[i]==null) // å¦‚æœæ‰¾åˆ°äº† null å…ƒç´ 
                return i; // è¿”å›å…ƒç´ çš„ç´¢å¼•
    } else { // å¦‚æœè¦æŸ¥æ‰¾çš„å…ƒç´ ä¸æ˜¯ null
        for (int i = size-1; i >= 0; i--) // ä»åå¾€å‰éå†åˆ—è¡¨
            if (o.equals(elementData[i])) // å¦‚æœæ‰¾åˆ°äº†è¦æŸ¥æ‰¾çš„å…ƒç´ 
                return i; // è¿”å›å…ƒç´ çš„ç´¢å¼•
    }
    return -1; // å¦‚æœæ‰¾ä¸åˆ°è¦æŸ¥æ‰¾çš„å…ƒç´ ï¼Œåˆ™è¿”å› -1
}
```

`contains()` æ–¹æ³•å¯ä»¥åˆ¤æ–­ ArrayList ä¸­æ˜¯å¦åŒ…å«æŸä¸ªå…ƒç´ ï¼Œå…¶å†…éƒ¨å°±æ˜¯é€šè¿‡ `indexOf()` æ–¹æ³•å®ç°çš„ï¼š

```java
public boolean contains(Object o) {
    return indexOf(o) >= 0;
}
```

### 08ã€äºŒåˆ†æŸ¥æ‰¾æ³•

å¦‚æœ ArrayList ä¸­çš„å…ƒç´ æ˜¯ç»è¿‡æ’åºçš„ï¼Œå°±å¯ä»¥ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•ï¼Œæ•ˆç‡æ›´å¿«ã€‚

[`Collections`](https://tobebetterjavaer.com/common-tool/collections.html) ç±»çš„ `sort()` æ–¹æ³•å¯ä»¥å¯¹ ArrayList è¿›è¡Œæ’åºï¼Œè¯¥æ–¹æ³•ä¼šæŒ‰ç…§å­—æ¯é¡ºåºå¯¹ String ç±»å‹çš„åˆ—è¡¨è¿›è¡Œæ’åºã€‚å¦‚æœæ˜¯è‡ªå®šä¹‰ç±»å‹çš„åˆ—è¡¨ï¼Œè¿˜å¯ä»¥æŒ‡å®š Comparator è¿›è¡Œæ’åºã€‚

è¿™é‡Œå…ˆç®€å•åœ°äº†è§£ä¸€ä¸‹ï¼Œåé¢ä¼šè¯¦ç»†åœ°è®²ã€‚

```java
List<String> copy = new ArrayList<>(alist);
copy.add("a");
copy.add("c");
copy.add("b");
copy.add("d");

Collections.sort(copy);
System.out.println(copy);
```

è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
[a, b, c, d]
```

æ’åºåå°±å¯ä»¥ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•äº†ï¼š

```java
int index = Collections.binarySearch(copy, "b");
```

### 09ã€ArrayListå¢åˆ æ”¹æŸ¥æ—¶çš„æ—¶é—´å¤æ‚åº¦

â€œæœ€åï¼Œä¸‰å¦¹ï¼Œæˆ‘ä»¬æ¥ç®€å•æ€»ç»“ä¸€ä¸‹ ArrayList çš„æ—¶é—´å¤æ‚åº¦å§ï¼Œæ–¹ä¾¿åé¢å­¦ä¹  LinkedList æ—¶å¯¹æ¯”ã€‚â€æˆ‘å–äº†ä¸€å£æ°´åè¡¥å……é“ã€‚

#### 1ï¼‰æŸ¥è¯¢

æ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œå› ä¸º ArrayList å†…éƒ¨ä½¿ç”¨æ•°ç»„æ¥å­˜å‚¨å…ƒç´ ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æ ¹æ®ç´¢å¼•æ¥è®¿é—®å…ƒç´ ã€‚

```java
/**
 * è¿”å›åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚
 *
 * @param index è¦è¿”å›çš„å…ƒç´ çš„ç´¢å¼•
 * @return åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ 
 * @throws IndexOutOfBoundsException å¦‚æœç´¢å¼•è¶…å‡ºèŒƒå›´ï¼ˆindex < 0 || index >= size()ï¼‰
 */
public E get(int index) {
    rangeCheck(index); // æ£€æŸ¥ç´¢å¼•æ˜¯å¦åˆæ³•
    return elementData(index); // è°ƒç”¨ elementData æ–¹æ³•è·å–å…ƒç´ 
}

/**
 * è¿”å›åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚
 * æ­¤æ–¹æ³•ä¸è¿›è¡Œè¾¹ç•Œæ£€æŸ¥ï¼Œå› æ­¤åªåº”ç”±å†…éƒ¨æ–¹æ³•å’Œè¿­ä»£å™¨è°ƒç”¨ã€‚
 *
 * @param index è¦è¿”å›çš„å…ƒç´ çš„ç´¢å¼•
 * @return åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ 
 */
E elementData(int index) {
    return (E) elementData[index]; // è¿”å›æŒ‡å®šç´¢å¼•ä½ç½®ä¸Šçš„å…ƒç´ 
}
```

#### 2ï¼‰æ’å…¥

æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼ˆè°ƒç”¨ `add()` æ–¹æ³•æ—¶ï¼‰çš„æ—¶é—´å¤æ‚åº¦æœ€å¥½æƒ…å†µä¸º O(1)ï¼Œæœ€åæƒ…å†µä¸º O(n)ã€‚

- å¦‚æœåœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚
- å¦‚æœè¦åœ¨åˆ—è¡¨çš„ä¸­é—´æˆ–å¼€å¤´æ’å…¥å…ƒç´ ï¼Œåˆ™éœ€è¦å°†æ’å…¥ä½ç½®ä¹‹åçš„å…ƒç´ å…¨éƒ¨å‘åç§»åŠ¨ä¸€ä½ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚

#### 3ï¼‰åˆ é™¤

åˆ é™¤ä¸€ä¸ªå…ƒç´ ï¼ˆè°ƒç”¨ `remove(Object)` æ–¹æ³•æ—¶ï¼‰çš„æ—¶é—´å¤æ‚åº¦æœ€å¥½æƒ…å†µ O(1)ï¼Œæœ€åæƒ…å†µ O(n)ã€‚

- å¦‚æœè¦åˆ é™¤åˆ—è¡¨æœ«å°¾çš„å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚
- å¦‚æœè¦åˆ é™¤åˆ—è¡¨ä¸­é—´æˆ–å¼€å¤´çš„å…ƒç´ ï¼Œåˆ™éœ€è¦å°†åˆ é™¤ä½ç½®ä¹‹åçš„å…ƒç´ å…¨éƒ¨å‘å‰ç§»åŠ¨ä¸€ä½ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚


#### 4ï¼‰ä¿®æ”¹

ä¿®æ”¹ä¸€ä¸ªå…ƒç´ ï¼ˆè°ƒç”¨ `set()`æ–¹æ³•æ—¶ï¼‰ä¸æŸ¥è¯¢æ“ä½œç±»ä¼¼ï¼Œå¯ä»¥ç›´æ¥æ ¹æ®ç´¢å¼•æ¥è®¿é—®å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚

```java
/**
 * ç”¨æŒ‡å®šå…ƒç´ æ›¿æ¢åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚
 *
 * @param index è¦æ›¿æ¢å…ƒç´ çš„ç´¢å¼•
 * @param element è¦æ”¾å…¥åˆ—è¡¨ä¸­çš„å…ƒç´ 
 * @return åŸæ¥åœ¨æŒ‡å®šä½ç½®ä¸Šçš„å…ƒç´ 
 * @throws IndexOutOfBoundsException å¦‚æœç´¢å¼•è¶…å‡ºèŒƒå›´ï¼ˆindex < 0 || index >= size()ï¼‰
 */
public E set(int index, E element) {
    rangeCheck(index); // æ£€æŸ¥ç´¢å¼•æ˜¯å¦åˆæ³•

    E oldValue = elementData(index); // è·å–åŸæ¥åœ¨æŒ‡å®šä½ç½®ä¸Šçš„å…ƒç´ 
    elementData[index] = element; // å°†æŒ‡å®šä½ç½®ä¸Šçš„å…ƒç´ æ›¿æ¢ä¸ºæ–°å…ƒç´ 
    return oldValue; // è¿”å›åŸæ¥åœ¨æŒ‡å®šä½ç½®ä¸Šçš„å…ƒç´ 
}
```

### 10ã€æ€»ç»“

ArrayListï¼Œå¦‚æœæœ‰ä¸ªä¸­æ–‡åçš„è¯ï¼Œåº”è¯¥å«åŠ¨æ€æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯å¯å¢é•¿çš„æ•°ç»„ï¼Œå¯è°ƒæ•´å¤§å°çš„æ•°ç»„ã€‚åŠ¨æ€æ•°ç»„å…‹æœäº†é™æ€æ•°ç»„çš„é™åˆ¶ï¼Œé™æ€æ•°ç»„çš„å®¹é‡æ˜¯å›ºå®šçš„ï¼Œåªèƒ½åœ¨é¦–æ¬¡åˆ›å»ºçš„æ—¶å€™æŒ‡å®šã€‚è€ŒåŠ¨æ€æ•°ç»„ä¼šéšç€å…ƒç´ çš„å¢åŠ è‡ªåŠ¨è°ƒæ•´å¤§å°ï¼Œæ›´ç¬¦åˆå®é™…çš„å¼€å‘éœ€æ±‚ã€‚

å­¦ä¹ é›†åˆæ¡†æ¶ï¼ŒArrayList æ˜¯ç¬¬ä¸€è¯¾ï¼Œä¹Ÿæ˜¯æ–°æ‰‹è¿›é˜¶çš„é‡è¦ä¸€è¯¾ã€‚è¦æƒ³å®Œå…¨æŒæ¡ ArrayListï¼Œæ‰©å®¹è¿™ä¸ªæœºåˆ¶æ˜¯å¿…é¡»å¾—æŒæ¡ï¼Œä¹Ÿæ˜¯é¢è¯•ä¸­ç»å¸¸è€ƒå¯Ÿçš„ä¸€ä¸ªç‚¹ã€‚

è¦æƒ³æŒæ¡æ‰©å®¹æœºåˆ¶ï¼Œå°±å¿…é¡»å¾—è¯»æºç ï¼Œä¹Ÿå°±è‚¯å®šä¼šé‡åˆ° `oldCapacity >> 1`ï¼Œæœ‰äº›åˆå­¦è€…ä¼šé€‰æ‹©è·³è¿‡ï¼Œè™½ç„¶ä¸å½±å“æ•´ä½“ä¸Šçš„å­¦ä¹ ï¼Œä½†ä¹Ÿé”™è¿‡äº†ä¸€ä¸ªç²¾è¿›çš„æœºä¼šã€‚

è®¡ç®—æœºå†…éƒ¨æ˜¯å¦‚ä½•è¡¨ç¤ºåè¿›åˆ¶æ•°çš„ï¼Œå³ç§»æ—¶åˆå‘ç”Ÿäº†ä»€ä¹ˆï¼Œé™ä¸‹å¿ƒæ¥å»ç ”ç©¶ä¸€ä¸‹ï¼Œä½ å°±ä¼šå‘ç°ï¼Œå“¦ï¼ŒåŸæ¥è¿™ä¹ˆæœ‰è¶£å‘¢ï¼Ÿ

â€œå¥½äº†ï¼Œä¸‰å¦¹ï¼Œè¿™ä¸€èŠ‚æˆ‘ä»¬å°±å­¦åˆ°è¿™é‡Œï¼Œæ”¶å·¥ï¼â€

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 6.4 LinkedListè¯¦è§£ï¼ˆé™„æºç ï¼‰

>è¿™ç¯‡æ¢ä¸ªè¡¨è¾¾æ–¹å¼ï¼Œä¸€èµ·æ¥æ¬£èµã€‚

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ LinkedListï¼Œå’Œ ArrayList æ˜¯åŒé—¨å¸ˆå…„å¼Ÿï¼Œä½†æˆ‘ä¿©ç»ƒçš„å†…åŠŸå´å®Œå…¨ä¸åŒã€‚å¸ˆå…„ç»ƒçš„æ˜¯åŠ¨æ€æ•°ç»„ï¼Œæˆ‘ç»ƒçš„æ˜¯é“¾è¡¨ã€‚

é—®å¤§å®¶ä¸€ä¸ªé—®é¢˜ï¼ŒçŸ¥é“æˆ‘ä¸ºä»€ä¹ˆè¦ç»ƒé“¾è¡¨è¿™é—¨å†…åŠŸå—ï¼Ÿ

ä¸¾ä¸ªä¾‹å­æ¥è®²å§ï¼Œå‡å¦‚ä½ ä»¬æ‰‹å¤´è¦ç®¡ç†ä¸€æ¨ç¥¨æ®ï¼Œå¯èƒ½æœ‰ä¸€å¼ ï¼Œä¹Ÿå¯èƒ½æœ‰ä¸€äº¿å¼ ã€‚

è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

ç”³è¯·ä¸€ä¸ª 10G çš„å¤§æ•°ç»„ç­‰ç€ï¼Ÿé‚£ä¸‡ä¸€ç¥¨æ®åªæœ‰ 100 å¼ å‘¢ï¼Ÿ

ç”³è¯·ä¸€ä¸ªé»˜è®¤å¤§å°çš„æ•°ç»„ï¼Œéšç€æ•°æ®é‡çš„å¢å¤§æ‰©å®¹ï¼Ÿè¦çŸ¥é“æ‰©å®¹æ˜¯éœ€è¦é‡æ–°å¤åˆ¶æ•°ç»„çš„ï¼Œå¾ˆè€—æ—¶é—´ã€‚

å…³é”®æ˜¯ï¼Œæ•°ç»„è¿˜æœ‰ä¸€ä¸ªå¼Šç«¯å°±æ˜¯ï¼Œå‡å¦‚ç°åœ¨æœ‰ 500 ä¸‡å¼ ç¥¨æ®ï¼Œç°åœ¨è¦ä»ä¸­é—´åˆ é™¤ä¸€ä¸ªç¥¨æ®ï¼Œå°±éœ€è¦æŠŠ 250 ä¸‡å¼ ç¥¨æ®å¾€å‰ç§»åŠ¨ä¸€æ ¼ã€‚

é‡åˆ°è¿™ç§æƒ…å†µçš„æ—¶å€™ï¼Œæˆ‘å¸ˆå…„å‡ ä¹æƒ…ç»ªå´©æºƒï¼Œéš¾å—çš„è¦å‘½ã€‚å¸ˆçˆ¶ä¸å¿å¿ƒçœ‹åˆ°å¸ˆå…„è¿™æ ·ç—›è‹¦ï¼Œäºæ˜¯æ‰“æˆ‘è¿›å…¥å¸ˆé—¨é‚£ä¸€å¤©ï¼Œå°±å¼ºè¿«æˆ‘ç»ƒé“¾è¡¨è¿™é—¨å†…åŠŸï¼Œä¸€å¼€å§‹æˆ‘å¾ˆä¸ç†è§£ï¼Œå®³æ€•å¸ˆçˆ¶åå¿ƒï¼Œä¸æŠŠå¸ˆé—¨æœ€å‰å®³çš„å†…åŠŸæ•™æˆ‘ã€‚

ç›´åˆ°æœ‰ä¸€å¤©ï¼Œæˆ‘äº²çœ¼ç›®ç¹å¸ˆå…„å·®ç‚¹å› ä¸ºç§»åŠ¨æ•°æ®è€Œèµ°ç«å…¥é­”ï¼Œæˆ‘æ‰æ˜ç™½å¸ˆçˆ¶çš„è‰¯è‹¦ç”¨å¿ƒã€‚ä»æ­¤ä»¥åï¼Œæˆ‘è‹¦ç»ƒâ€œé“¾è¡¨â€è¿™é—¨å†…åŠŸï¼Œå–å¾—äº†æ˜¾è‘—çš„è¿›æ­¥ï¼Œå¸ˆçˆ¶å’Œå¸ˆå…„éƒ½å¤¸æˆ‘æœ‰å¤©èµ‹ã€‚

é“¾è¡¨è¿™é—¨å†…åŠŸå¤§è‡´åˆ†ä¸ºä¸‰ä¸ªå±‚æ¬¡ï¼š

- ç¬¬ä¸€å±‚å«åšâ€œå•å‘é“¾è¡¨â€ï¼Œæˆ‘åªæœ‰ä¸€ä¸ªåæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªæ•°æ®ï¼›
- ç¬¬äºŒå±‚å«åšâ€œåŒå‘é“¾è¡¨â€ï¼Œæˆ‘æœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼ŒåæŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªæ•°æ®ï¼Œå‰æŒ‡é’ˆæŒ‡å‘ä¸Šä¸€ä¸ªæ•°æ®ã€‚
- ç¬¬ä¸‰å±‚å«åšâ€œäºŒå‰æ ‘â€ï¼ŒæŠŠåæŒ‡é’ˆå»æ‰ï¼Œæ¢æˆå·¦å³æŒ‡é’ˆã€‚

ä½†æˆ‘ç°åœ¨çš„åŠŸåŠ›è¿˜è¾¾ä¸åˆ°ç¬¬ä¸‰å±‚ï¼Œä¸è¿‡å¸ˆçˆ¶è¯´æˆ‘æœ‰è¿™ä¸ªæ½œåŠ›ï¼Œç»ƒæˆç¥åŠŸæ˜¯æ—©æ™šçš„äº‹ã€‚

### 01ã€LinkedListçš„å†…åŠŸå¿ƒæ³•

å¥½äº†ï¼Œç»è¿‡æˆ‘è¿™ä¹ˆæ ·çš„ä¸€ä¸ªå‰–ç™½åï¼Œå¤§å®¶å¯¹æˆ‘åº”è¯¥å·²ç»ä¸é™Œç”Ÿäº†ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ç»™å¤§å®¶å±•ç¤ºä¸€ä¸‹æˆ‘çš„å†…åŠŸå¿ƒæ³•ã€‚

æˆ‘çš„å†…åŠŸå¿ƒæ³•ä¸»è¦æ˜¯ä¸€ä¸ªç§æœ‰çš„é™æ€å†…éƒ¨ç±»ï¼Œå« Nodeï¼Œä¹Ÿå°±æ˜¯èŠ‚ç‚¹ã€‚

```java
/**
 * é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ç±»ã€‚
 */
private static class Node<E> {
    E item; // èŠ‚ç‚¹ä¸­å­˜å‚¨çš„å…ƒç´ 
    Node<E> next; // æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆ
    Node<E> prev; // æŒ‡å‘ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆ

    /**
     * æ„é€ ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ã€‚
     *
     * @param prev å‰ä¸€ä¸ªèŠ‚ç‚¹
     * @param element èŠ‚ç‚¹ä¸­è¦å­˜å‚¨çš„å…ƒç´ 
     * @param next åä¸€ä¸ªèŠ‚ç‚¹
     */
    Node(Node<E> prev, E element, Node<E> next) {
        this.item = element; // å­˜å‚¨å…ƒç´ 
        this.next = next; // è®¾ç½®ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
        this.prev = prev; // è®¾ç½®ä¸Šä¸€ä¸ªèŠ‚ç‚¹
    }
}
```

å®ƒç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š

- èŠ‚ç‚¹ä¸Šçš„å…ƒç´ 
- ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
- ä¸Šä¸€ä¸ªèŠ‚ç‚¹

æˆ‘ç”»å¹…å›¾ç»™ä½ ä»¬å±•ç¤ºä¸‹å§ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/linkedlist-01.png)

- å¯¹äºç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ¥è¯´ï¼Œprev ä¸º nullï¼›
- å¯¹äºæœ€åä¸€ä¸ªèŠ‚ç‚¹æ¥è¯´ï¼Œnext ä¸º nullï¼›
- å…¶ä½™çš„èŠ‚ç‚¹å‘¢ï¼Œprev æŒ‡å‘å‰ä¸€ä¸ªï¼Œnext æŒ‡å‘åä¸€ä¸ªã€‚

æˆ‘çš„å†…åŠŸå¿ƒæ³•å°±è¿™ä¹ˆç®€å•ï¼Œå…¶å®æˆ‘æ—©å·²ç»ç‰¢è®°åœ¨å¿ƒäº†ã€‚ä½†å¸ˆçˆ¶å®å˜±æˆ‘ï¼Œæ¯å¤©æ—©ä¸Šé†’æ¥çš„æ—¶å€™ï¼Œæ¯å¤©æ™šä¸Šç¡è§‰çš„æ—¶å€™ï¼Œä¸€å®šè¦é»˜é»˜åœ°èƒŒè¯µä¸€éã€‚è™½ç„¶æˆ‘æœ‰äº›åŒçƒ¦ï¼Œä½†æˆ‘å¯¹å¸ˆçˆ¶çš„æ•™è¯²ä»æ¥éƒ½æ˜¯è¨€å¬è®¡ä»ã€‚

### 02ã€LinkedListçš„æ‹›å¼

å’Œå¸ˆå…„ ArrayList ä¸€æ ·ï¼Œæˆ‘çš„æ‹›å¼ä¹Ÿæ— å¤–ä¹â€œå¢åˆ æ”¹æŸ¥â€è¿™ 4 ç§ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éƒ½å¿…é¡»å¾—åˆå§‹åŒ–ã€‚

```java
LinkedList<String> list = new LinkedList();
```

å¸ˆå…„åœ¨åˆå§‹åŒ–çš„æ—¶å€™å¯ä»¥æŒ‡å®šå¤§å°ï¼Œä¹Ÿå¯ä»¥ä¸æŒ‡å®šï¼Œç­‰åˆ°æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™è¿›è¡Œç¬¬ä¸€æ¬¡æ‰©å®¹ã€‚è€Œæˆ‘ï¼Œæ²¡æœ‰å¤§å°ï¼Œåªè¦å†…å­˜å¤Ÿå¤§ï¼Œæˆ‘å°±å¯ä»¥æ— ç©·å¤§ã€‚

#### **1ï¼‰æ‹›å¼ä¸€ï¼šå¢**

å¯ä»¥è°ƒç”¨ add æ–¹æ³•æ·»åŠ å…ƒç´ ï¼š

```java
list.add("æ²‰é»˜ç‹äºŒ");
list.add("æ²‰é»˜ç‹ä¸‰");
list.add("æ²‰é»˜ç‹å››");
```

add æ–¹æ³•å†…éƒ¨å…¶å®è°ƒç”¨çš„æ˜¯ linkLast æ–¹æ³•ï¼š

```java
/**
 * å°†æŒ‡å®šçš„å…ƒç´ æ·»åŠ åˆ°åˆ—è¡¨çš„å°¾éƒ¨ã€‚
 *
 * @param e è¦æ·»åŠ åˆ°åˆ—è¡¨çš„å…ƒç´ 
 * @return å§‹ç»ˆä¸º trueï¼ˆæ ¹æ® Java é›†åˆæ¡†æ¶è§„èŒƒï¼‰
 */
public boolean add(E e) {
    linkLast(e); // åœ¨åˆ—è¡¨çš„å°¾éƒ¨æ·»åŠ å…ƒç´ 
    return true; // æ·»åŠ å…ƒç´ æˆåŠŸï¼Œè¿”å› true
}
```

linkLastï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åœ¨é“¾è¡¨çš„å°¾éƒ¨æ·»åŠ å…ƒç´ ï¼š

```java
/**
 * åœ¨åˆ—è¡¨çš„å°¾éƒ¨æ·»åŠ æŒ‡å®šçš„å…ƒç´ ã€‚
 *
 * @param e è¦æ·»åŠ åˆ°åˆ—è¡¨çš„å…ƒç´ 
 */
void linkLast(E e) {
    final Node<E> l = last; // è·å–é“¾è¡¨çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹
    final Node<E> newNode = new Node<>(l, e, null); // åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºé“¾è¡¨çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹
    last = newNode; // å°†æ–°çš„èŠ‚ç‚¹è®¾ç½®ä¸ºé“¾è¡¨çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹
    if (l == null) // å¦‚æœé“¾è¡¨ä¸ºç©ºï¼Œåˆ™å°†æ–°èŠ‚ç‚¹è®¾ç½®ä¸ºå¤´èŠ‚ç‚¹
        first = newNode;
    else
        l.next = newNode; // å¦åˆ™å°†æ–°èŠ‚ç‚¹é“¾æ¥åˆ°é“¾è¡¨çš„å°¾éƒ¨
    size++; // å¢åŠ é“¾è¡¨çš„å…ƒç´ ä¸ªæ•°
}
```

- æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œfirst å’Œ last éƒ½ä¸º nullã€‚
- ç„¶åæ–°å»ºä¸€ä¸ªèŠ‚ç‚¹ newNodeï¼Œå®ƒçš„ prev å’Œ next ä¹Ÿä¸º nullã€‚
- ç„¶åæŠŠ last å’Œ first éƒ½èµ‹å€¼ä¸º newNodeã€‚

æ­¤æ—¶è¿˜ä¸èƒ½ç§°ä¹‹ä¸ºé“¾è¡¨ï¼Œå› ä¸ºå‰åèŠ‚ç‚¹éƒ½æ˜¯æ–­è£‚çš„ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/linkedlist-02.png)

- æ·»åŠ ç¬¬äºŒä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œfirst å’Œ last éƒ½æŒ‡å‘çš„æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚
- ç„¶åæ–°å»ºä¸€ä¸ªèŠ‚ç‚¹ newNodeï¼Œå®ƒçš„ prev æŒ‡å‘çš„æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œnext ä¸º nullã€‚
- ç„¶åæŠŠç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„ next èµ‹å€¼ä¸º newNodeã€‚

æ­¤æ—¶çš„é“¾è¡¨è¿˜ä¸å®Œæ•´ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/linkedlist-03.png)

- æ·»åŠ ç¬¬ä¸‰ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œfirst æŒ‡å‘çš„æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œlast æŒ‡å‘çš„æ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹ã€‚
- ç„¶åæ–°å»ºä¸€ä¸ªèŠ‚ç‚¹ newNodeï¼Œå®ƒçš„ prev æŒ‡å‘çš„æ˜¯ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼Œnext ä¸º nullã€‚
- ç„¶åæŠŠç¬¬äºŒä¸ªèŠ‚ç‚¹çš„ next èµ‹å€¼ä¸º newNodeã€‚

æ­¤æ—¶çš„é“¾è¡¨å·²ç»å®Œæ•´äº†ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/linkedlist-04.png)

æˆ‘è¿™ä¸ªå¢çš„æ‹›å¼ï¼Œè¿˜å¯ä»¥æ¼”åŒ–æˆå¦å¤–ä¸¤ä¸ªç‰ˆæœ¬ï¼š

- `addFirst()` æ–¹æ³•å°†å…ƒç´ æ·»åŠ åˆ°ç¬¬ä¸€ä½ï¼›
- `addLast()` æ–¹æ³•å°†å…ƒç´ æ·»åŠ åˆ°æœ«å°¾ã€‚

addFirst å†…éƒ¨å…¶å®è°ƒç”¨çš„æ˜¯ linkFirstï¼š

```java
/**
 * åœ¨åˆ—è¡¨çš„å¼€å¤´æ·»åŠ æŒ‡å®šçš„å…ƒç´ ã€‚
 *
 * @param e è¦æ·»åŠ åˆ°åˆ—è¡¨çš„å…ƒç´ 
 */
public void addFirst(E e) {
    linkFirst(e); // åœ¨åˆ—è¡¨çš„å¼€å¤´æ·»åŠ å…ƒç´ 
}
```

linkFirst è´Ÿè´£æŠŠæ–°çš„èŠ‚ç‚¹è®¾ä¸º firstï¼Œå¹¶å°†æ–°çš„ first çš„ next æ›´æ–°ä¸ºä¹‹å‰çš„ firstã€‚

```java
/**
 * åœ¨åˆ—è¡¨çš„å¼€å¤´æ·»åŠ æŒ‡å®šçš„å…ƒç´ ã€‚
 *
 * @param e è¦æ·»åŠ åˆ°åˆ—è¡¨çš„å…ƒç´ 
 */
private void linkFirst(E e) {
    final Node<E> f = first; // è·å–é“¾è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
    final Node<E> newNode = new Node<>(null, e, f); // åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºé“¾è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
    first = newNode; // å°†æ–°çš„èŠ‚ç‚¹è®¾ç½®ä¸ºé“¾è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
    if (f == null) // å¦‚æœé“¾è¡¨ä¸ºç©ºï¼Œåˆ™å°†æ–°èŠ‚ç‚¹è®¾ç½®ä¸ºå°¾èŠ‚ç‚¹
        last = newNode;
    else
        f.prev = newNode; // å¦åˆ™å°†æ–°èŠ‚ç‚¹é“¾æ¥åˆ°é“¾è¡¨çš„å¤´éƒ¨
    size++; // å¢åŠ é“¾è¡¨çš„å…ƒç´ ä¸ªæ•°
}
```

addLast çš„å†…æ ¸å…¶å®å’Œ addFirst å·®ä¸å¤šï¼Œå†…éƒ¨è°ƒç”¨çš„æ˜¯ linkLast æ–¹æ³•ï¼Œå‰é¢åˆ†æè¿‡äº†ã€‚

```java
/**
 * åœ¨åˆ—è¡¨çš„å°¾éƒ¨æ·»åŠ æŒ‡å®šçš„å…ƒç´ ã€‚
 *
 * @param e è¦æ·»åŠ åˆ°åˆ—è¡¨çš„å…ƒç´ 
 * @return å§‹ç»ˆä¸º trueï¼ˆæ ¹æ® Java é›†åˆæ¡†æ¶è§„èŒƒï¼‰
 */
public boolean addLast(E e) {
    linkLast(e); // åœ¨åˆ—è¡¨çš„å°¾éƒ¨æ·»åŠ å…ƒç´ 
    return true; // æ·»åŠ å…ƒç´ æˆåŠŸï¼Œè¿”å› true
}
```


#### **2ï¼‰æ‹›å¼äºŒï¼šåˆ **

æˆ‘è¿™ä¸ªåˆ çš„æ‹›å¼è¿˜æŒºå¤šçš„ï¼š

- `remove()`ï¼šåˆ é™¤ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
- `remove(int)`ï¼šåˆ é™¤æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹
- `remove(Object)`ï¼šåˆ é™¤æŒ‡å®šå…ƒç´ çš„èŠ‚ç‚¹
- `removeFirst()`ï¼šåˆ é™¤ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
- `removeLast()`ï¼šåˆ é™¤æœ€åä¸€ä¸ªèŠ‚ç‚¹

`remove()` å†…éƒ¨è°ƒç”¨çš„æ˜¯ `removeFirst()`ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªæ‹›å¼çš„åŠŸæ•ˆä¸€æ ·ã€‚

`remove(int)` å†…éƒ¨å…¶å®è°ƒç”¨çš„æ˜¯ unlink æ–¹æ³•ã€‚

```java
/**
 * åˆ é™¤æŒ‡å®šä½ç½®ä¸Šçš„å…ƒç´ ã€‚
 *
 * @param index è¦åˆ é™¤çš„å…ƒç´ çš„ç´¢å¼•
 * @return ä»åˆ—è¡¨ä¸­åˆ é™¤çš„å…ƒç´ 
 * @throws IndexOutOfBoundsException å¦‚æœç´¢å¼•è¶Šç•Œï¼ˆindex &lt; 0 || index &gt;= size()ï¼‰
 */
public E remove(int index) {
    checkElementIndex(index); // æ£€æŸ¥ç´¢å¼•æ˜¯å¦è¶Šç•Œ
    return unlink(node(index)); // åˆ é™¤æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹ï¼Œå¹¶è¿”å›èŠ‚ç‚¹çš„å…ƒç´ 
}

```

unlink æ–¹æ³•å…¶å®å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯æ›´æ–°å½“å‰èŠ‚ç‚¹çš„ next å’Œ prevï¼Œç„¶åæŠŠå½“å‰èŠ‚ç‚¹ä¸Šçš„å…ƒç´ è®¾ä¸º nullã€‚

```java
/**
 * ä»é“¾è¡¨ä¸­åˆ é™¤æŒ‡å®šèŠ‚ç‚¹ã€‚
 *
 * @param x è¦åˆ é™¤çš„èŠ‚ç‚¹
 * @return ä»é“¾è¡¨ä¸­åˆ é™¤çš„èŠ‚ç‚¹çš„å…ƒç´ 
 */
E unlink(Node<E> x) {
    final E element = x.item; // è·å–è¦åˆ é™¤èŠ‚ç‚¹çš„å…ƒç´ 
    final Node<E> next = x.next; // è·å–è¦åˆ é™¤èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
    final Node<E> prev = x.prev; // è·å–è¦åˆ é™¤èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹

    if (prev == null) { // å¦‚æœè¦åˆ é™¤èŠ‚ç‚¹æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
        first = next; // å°†é“¾è¡¨çš„å¤´èŠ‚ç‚¹è®¾ç½®ä¸ºè¦åˆ é™¤èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
    } else {
        prev.next = next; // å°†è¦åˆ é™¤èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘è¦åˆ é™¤èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
        x.prev = null; // å°†è¦åˆ é™¤èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹è®¾ç½®ä¸ºç©º
    }

    if (next == null) { // å¦‚æœè¦åˆ é™¤èŠ‚ç‚¹æ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹
        last = prev; // å°†é“¾è¡¨çš„å°¾èŠ‚ç‚¹è®¾ç½®ä¸ºè¦åˆ é™¤èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹
    } else {
        next.prev = prev; // å°†è¦åˆ é™¤èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘è¦åˆ é™¤èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹
        x.next = null; // å°†è¦åˆ é™¤èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹è®¾ç½®ä¸ºç©º
    }

    x.item = null; // å°†è¦åˆ é™¤èŠ‚ç‚¹çš„å…ƒç´ è®¾ç½®ä¸ºç©º
    size--; // å‡å°‘é“¾è¡¨çš„å…ƒç´ ä¸ªæ•°
    return element; // è¿”å›è¢«åˆ é™¤èŠ‚ç‚¹çš„å…ƒç´ 
}
```

remove(Object) å†…éƒ¨ä¹Ÿè°ƒç”¨äº† unlink æ–¹æ³•ï¼Œåªä¸è¿‡åœ¨æ­¤ä¹‹å‰è¦å…ˆæ‰¾åˆ°å…ƒç´ æ‰€åœ¨çš„èŠ‚ç‚¹ï¼š

```java
/**
 * ä»é“¾è¡¨ä¸­åˆ é™¤æŒ‡å®šå…ƒç´ ã€‚
 *
 * @param o è¦ä»é“¾è¡¨ä¸­åˆ é™¤çš„å…ƒç´ 
 * @return å¦‚æœé“¾è¡¨åŒ…å«æŒ‡å®šå…ƒç´ ï¼Œåˆ™è¿”å› trueï¼›å¦åˆ™è¿”å› false
 */
public boolean remove(Object o) {
    if (o == null) { // å¦‚æœè¦åˆ é™¤çš„å…ƒç´ ä¸º null
        for (Node<E> x = first; x != null; x = x.next) { // éå†é“¾è¡¨
            if (x.item == null) { // å¦‚æœèŠ‚ç‚¹çš„å…ƒç´ ä¸º null
                unlink(x); // åˆ é™¤èŠ‚ç‚¹
                return true; // è¿”å› true è¡¨ç¤ºåˆ é™¤æˆåŠŸ
            }
        }
    } else { // å¦‚æœè¦åˆ é™¤çš„å…ƒç´ ä¸ä¸º null
        for (Node<E> x = first; x != null; x = x.next) { // éå†é“¾è¡¨
            if (o.equals(x.item)) { // å¦‚æœèŠ‚ç‚¹çš„å…ƒç´ ç­‰äºè¦åˆ é™¤çš„å…ƒç´ 
                unlink(x); // åˆ é™¤èŠ‚ç‚¹
                return true; // è¿”å› true è¡¨ç¤ºåˆ é™¤æˆåŠŸ
            }
        }
    }
    return false; // å¦‚æœé“¾è¡¨ä¸­ä¸åŒ…å«è¦åˆ é™¤çš„å…ƒç´ ï¼Œåˆ™è¿”å› false è¡¨ç¤ºåˆ é™¤å¤±è´¥
}
```

å…ƒç´ ä¸º null çš„æ—¶å€™ï¼Œå¿…é¡»ä½¿ç”¨ == æ¥åˆ¤æ–­ï¼›å…ƒç´ ä¸ºé null çš„æ—¶å€™ï¼Œè¦ä½¿ç”¨ equals æ¥åˆ¤æ–­ã€‚

removeFirst å†…éƒ¨è°ƒç”¨çš„æ˜¯ unlinkFirst æ–¹æ³•ï¼š

```java
/**
 * ä»é“¾è¡¨ä¸­åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ å¹¶è¿”å›å®ƒã€‚
 * å¦‚æœé“¾è¡¨ä¸ºç©ºï¼Œåˆ™æŠ›å‡º NoSuchElementException å¼‚å¸¸ã€‚
 *
 * @return ä»é“¾è¡¨ä¸­åˆ é™¤çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
 * @throws NoSuchElementException å¦‚æœé“¾è¡¨ä¸ºç©º
 */
public E removeFirst() {
    final Node<E> f = first; // è·å–é“¾è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
    if (f == null) // å¦‚æœé“¾è¡¨ä¸ºç©º
        throw new NoSuchElementException(); // æŠ›å‡º NoSuchElementException å¼‚å¸¸
    return unlinkFirst(f); // è°ƒç”¨ unlinkFirst æ–¹æ³•åˆ é™¤ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å¹¶è¿”å›å®ƒçš„å…ƒç´ 
}
```

unlinkFirst è´Ÿè´£çš„å°±æ˜¯æŠŠç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ¯å°¸ç­è¿¹ï¼Œå¹¶ä¸”æå¸¦æŠŠåä¸€ä¸ªèŠ‚ç‚¹çš„ prev è®¾ä¸º nullã€‚

```java
/**
 * åˆ é™¤é“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å¹¶è¿”å›å®ƒçš„å…ƒç´ ã€‚
 *
 * @param f è¦åˆ é™¤çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
 * @return è¢«åˆ é™¤èŠ‚ç‚¹çš„å…ƒç´ 
 */
private E unlinkFirst(Node<E> f) {
    final E element = f.item; // è·å–è¦åˆ é™¤çš„èŠ‚ç‚¹çš„å…ƒç´ 
    final Node<E> next = f.next; // è·å–è¦åˆ é™¤çš„èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
    f.item = null; // å°†è¦åˆ é™¤çš„èŠ‚ç‚¹çš„å…ƒç´ è®¾ç½®ä¸º null
    f.next = null; // å°†è¦åˆ é™¤çš„èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹è®¾ç½®ä¸º null
    first = next; // å°†é“¾è¡¨çš„å¤´èŠ‚ç‚¹è®¾ç½®ä¸ºè¦åˆ é™¤çš„èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
    if (next == null) // å¦‚æœé“¾è¡¨åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹
        last = null; // å°†é“¾è¡¨çš„å°¾èŠ‚ç‚¹è®¾ç½®ä¸º null
    else
        next.prev = null; // å°†è¦åˆ é™¤èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å‰é©±è®¾ç½®ä¸º null
    size--; // å‡å°‘é“¾è¡¨çš„å¤§å°
    return element; // è¿”å›è¢«åˆ é™¤èŠ‚ç‚¹çš„å…ƒç´ 
}
```

#### **3ï¼‰æ‹›å¼ä¸‰ï¼šæ”¹**

å¯ä»¥è°ƒç”¨ `set()` æ–¹æ³•æ¥æ›´æ–°å…ƒç´ ï¼š

```java
list.set(0, "æ²‰é»˜ç‹äº”");
```

æ¥çœ‹ä¸€ä¸‹ `set()` æ–¹æ³•ï¼š

```java
/**
 * å°†é“¾è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ æ›¿æ¢ä¸ºæŒ‡å®šå…ƒç´ ï¼Œå¹¶è¿”å›åŸæ¥çš„å…ƒç´ ã€‚
 *
 * @param index è¦æ›¿æ¢å…ƒç´ çš„ä½ç½®ï¼ˆä» 0 å¼€å§‹ï¼‰
 * @param element è¦æ’å…¥çš„å…ƒç´ 
 * @return æ›¿æ¢å‰çš„å…ƒç´ 
 * @throws IndexOutOfBoundsException å¦‚æœç´¢å¼•è¶…å‡ºèŒƒå›´ï¼ˆindex < 0 || index >= size()ï¼‰
 */
public E set(int index, E element) {
    checkElementIndex(index); // æ£€æŸ¥ç´¢å¼•æ˜¯å¦è¶…å‡ºèŒƒå›´
    Node<E> x = node(index); // è·å–è¦æ›¿æ¢çš„èŠ‚ç‚¹
    E oldVal = x.item; // è·å–è¦æ›¿æ¢èŠ‚ç‚¹çš„å…ƒç´ 
    x.item = element; // å°†è¦æ›¿æ¢çš„èŠ‚ç‚¹çš„å…ƒç´ è®¾ç½®ä¸ºæŒ‡å®šå…ƒç´ 
    return oldVal; // è¿”å›æ›¿æ¢å‰çš„å…ƒç´ 
}
```

æ¥çœ‹ä¸€ä¸‹nodeæ–¹æ³•ï¼š

```java
/**
 * è·å–é“¾è¡¨ä¸­æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹ã€‚
 *
 * @param index èŠ‚ç‚¹çš„ä½ç½®ï¼ˆä» 0 å¼€å§‹ï¼‰
 * @return æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹
 * @throws IndexOutOfBoundsException å¦‚æœç´¢å¼•è¶…å‡ºèŒƒå›´ï¼ˆindex < 0 || index >= size()ï¼‰
 */
Node<E> node(int index) {
    if (index < (size >> 1)) { // å¦‚æœç´¢å¼•åœ¨é“¾è¡¨çš„å‰åŠéƒ¨åˆ†
        Node<E> x = first;
        for (int i = 0; i < index; i++) // ä»å¤´èŠ‚ç‚¹å¼€å§‹å‘åéå†é“¾è¡¨ï¼Œç›´åˆ°æ‰¾åˆ°æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹
            x = x.next;
        return x; // è¿”å›æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹
    } else { // å¦‚æœç´¢å¼•åœ¨é“¾è¡¨çš„ååŠéƒ¨åˆ†
        Node<E> x = last;
        for (int i = size - 1; i > index; i--) // ä»å°¾èŠ‚ç‚¹å¼€å§‹å‘å‰éå†é“¾è¡¨ï¼Œç›´åˆ°æ‰¾åˆ°æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹
            x = x.prev;
        return x; // è¿”å›æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹
    }
}
```

`size >> 1`ï¼šä¹Ÿå°±æ˜¯å³ç§»ä¸€ä½ï¼Œç›¸å½“äºé™¤ä»¥ 2ã€‚å¯¹äºè®¡ç®—æœºæ¥è¯´ï¼Œç§»ä½æ¯”é™¤æ³•è¿ç®—æ•ˆç‡æ›´é«˜ï¼Œå› ä¸ºæ•°æ®åœ¨è®¡ç®—æœºå†…éƒ¨éƒ½æ˜¯ä»¥äºŒè¿›åˆ¶å­˜å‚¨çš„ã€‚

æ¢å¥è¯è¯´ï¼Œnode æ–¹æ³•ä¼šå¯¹ä¸‹æ ‡è¿›è¡Œä¸€ä¸ªåˆæ­¥åˆ¤æ–­ï¼Œå¦‚æœé è¿‘å‰åŠæˆªï¼Œå°±ä»ä¸‹æ ‡ 0 å¼€å§‹éå†ï¼›å¦‚æœé è¿‘ååŠæˆªï¼Œå°±ä»æœ«å°¾å¼€å§‹éå†ï¼Œè¿™æ ·å¯ä»¥æé«˜æ•ˆç‡ï¼Œæœ€å¤§èƒ½æé«˜ä¸€åŠçš„æ•ˆç‡ã€‚

æ‰¾åˆ°æŒ‡å®šä¸‹æ ‡çš„èŠ‚ç‚¹å°±ç®€å•äº†ï¼Œç›´æ¥æŠŠåŸæœ‰èŠ‚ç‚¹çš„å…ƒç´ æ›¿æ¢æˆæ–°çš„èŠ‚ç‚¹å°± OK äº†ï¼Œprev å’Œ next éƒ½ä¸ç”¨æ”¹åŠ¨ã€‚

#### **4ï¼‰æ‹›å¼å››ï¼šæŸ¥**

æˆ‘è¿™ä¸ªæŸ¥çš„æ‹›å¼å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š

- indexOf(Object)ï¼šæŸ¥æ‰¾æŸä¸ªå…ƒç´ æ‰€åœ¨çš„ä½ç½®
- get(int)ï¼šæŸ¥æ‰¾æŸä¸ªä½ç½®ä¸Šçš„å…ƒç´ 

æ¥çœ‹ä¸€ä¸‹ indexOf æ–¹æ³•çš„æºç ã€‚

```java
/**
 * è¿”å›é“¾è¡¨ä¸­é¦–æ¬¡å‡ºç°æŒ‡å®šå…ƒç´ çš„ä½ç½®ï¼Œå¦‚æœä¸å­˜åœ¨è¯¥å…ƒç´ åˆ™è¿”å› -1ã€‚
 *
 * @param o è¦æŸ¥æ‰¾çš„å…ƒç´ 
 * @return é¦–æ¬¡å‡ºç°æŒ‡å®šå…ƒç´ çš„ä½ç½®ï¼Œå¦‚æœä¸å­˜åœ¨è¯¥å…ƒç´ åˆ™è¿”å› -1
 */
public int indexOf(Object o) {
    int index = 0; // åˆå§‹åŒ–ç´¢å¼•ä¸º 0
    if (o == null) { // å¦‚æœè¦æŸ¥æ‰¾çš„å…ƒç´ ä¸º null
        for (Node<E> x = first; x != null; x = x.next) { // ä»å¤´èŠ‚ç‚¹å¼€å§‹å‘åéå†é“¾è¡¨
            if (x.item == null) // å¦‚æœæ‰¾åˆ°äº†è¦æŸ¥æ‰¾çš„å…ƒç´ 
                return index; // è¿”å›è¯¥å…ƒç´ çš„ç´¢å¼•
            index++; // ç´¢å¼•åŠ  1
        }
    } else { // å¦‚æœè¦æŸ¥æ‰¾çš„å…ƒç´ ä¸ä¸º null
        for (Node<E> x = first; x != null; x = x.next) { // ä»å¤´èŠ‚ç‚¹å¼€å§‹å‘åéå†é“¾è¡¨
            if (o.equals(x.item)) // å¦‚æœæ‰¾åˆ°äº†è¦æŸ¥æ‰¾çš„å…ƒç´ 
                return index; // è¿”å›è¯¥å…ƒç´ çš„ç´¢å¼•
            index++; // ç´¢å¼•åŠ  1
        }
    }
    return -1; // å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¦æŸ¥æ‰¾çš„å…ƒç´ ï¼Œåˆ™è¿”å› -1
}
```

get æ–¹æ³•çš„å†…æ ¸å…¶å®è¿˜æ˜¯ node æ–¹æ³•ï¼Œnode æ–¹æ³•ä¹‹å‰å·²ç»è¯´æ˜è¿‡äº†ï¼Œè¿™é‡Œç•¥è¿‡ã€‚

```java
public E get(int index) {
    checkElementIndex(index);
    return node(index).item;
}
```

å…¶å®ï¼ŒæŸ¥è¿™ä¸ªæ‹›å¼è¿˜å¯ä»¥æ¼”åŒ–ä¸ºå…¶ä»–çš„ä¸€äº›ï¼Œæ¯”å¦‚è¯´ï¼š

- `getFirst()` æ–¹æ³•ç”¨äºè·å–ç¬¬ä¸€ä¸ªå…ƒç´ ï¼›
- `getLast()` æ–¹æ³•ç”¨äºè·å–æœ€åä¸€ä¸ªå…ƒç´ ï¼›
- `poll()` å’Œ `pollFirst()` æ–¹æ³•ç”¨äºåˆ é™¤å¹¶è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆä¸¤ä¸ªæ–¹æ³•å°½ç®¡åå­—ä¸åŒï¼Œä½†æ–¹æ³•ä½“æ˜¯å®Œå…¨ç›¸åŒçš„ï¼‰ï¼›
- `pollLast()` æ–¹æ³•ç”¨äºåˆ é™¤å¹¶è¿”å›æœ€åä¸€ä¸ªå…ƒç´ ï¼›
- `peekFirst()` æ–¹æ³•ç”¨äºè¿”å›ä½†ä¸åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚

### 03ã€LinkedList çš„æŒ‘æˆ˜

è¯´å¥å®åœ¨è¯ï¼Œæˆ‘ä¸æ˜¯å¾ˆå–œæ¬¢å’Œå¸ˆå…„ ArrayList æ‹¿æ¥æ¯”è¾ƒï¼Œå› ä¸ºæˆ‘ä»¬å„è‡ªä¿®ç‚¼çš„å†…åŠŸä¸åŒï¼Œæ²¡æœ‰å­°é«˜å­°ä½ã€‚

è™½ç„¶å¸ˆå…„ç»å¸¸å–Šæˆ‘ä¸€å£°å¸ˆå¼Ÿï¼Œä½†æˆ‘ä»¬ä¹‹é—´å…¶å®æŒºå’Œè°çš„ã€‚ä½†æˆ‘çŸ¥é“ï¼Œåœ¨å¤–äººçœ¼é‡Œï¼ŒåŒé—¨å¸ˆå…„å¼Ÿï¼Œæ€»è¦ä¸€è¾ƒé«˜ä¸‹çš„ã€‚

æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬ä¿©åœ¨å¢åˆ æ”¹æŸ¥æ—¶å€™çš„æ—¶é—´å¤æ‚åº¦ã€‚

ä¹Ÿè®¸è¿™å°±æ˜¯å‘½è¿å§ï¼Œä»æˆ‘è¿›å…¥å¸ˆé—¨çš„é‚£å¤©èµ·ï¼Œè¿™ç§äº‰è®ºå°±ä¸€ç›´æ²¡æœ‰åœæ¯è¿‡ã€‚

æ— è®ºå¤–äººæ€ä¹ˆçœ‹å¾…æˆ‘ä»¬ï¼Œåœ¨æˆ‘çœ¼é‡Œï¼Œå¸ˆå…„æ°¸è¿œéƒ½æ˜¯ä¸€å“¥ï¼Œæˆ‘æ•¬é‡ä»–ï¼Œä»–ä¹Ÿæ„¿æ„ä¿æŠ¤æˆ‘ã€‚

[å¥½æˆåœ¨åå¤´](https://tobebetterjavaer.com/collection/list-war-2.html)ï¼Œç­‰ç€ç§å§ã€‚

æˆ‘è¿™é‡Œå…ˆç®€å•èŠä¸€ä¸‹ï¼Œæƒå½“æŠ›ç –å¼•ç‰ã€‚

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ åœ¨ç©ä¸€æ¬¾æ¸¸æˆï¼Œæ¸¸æˆä¸­æœ‰ä¸€ä¸ªé“å…·æ ï¼Œä½ éœ€è¦ä¸æ–­åœ°å¾€é‡Œé¢æ·»åŠ ã€åˆ é™¤é“å…·ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯æˆ‘çš„å¸ˆå…„ ArrayListï¼Œé‚£ä¹ˆæ¯æ¬¡æ·»åŠ ã€åˆ é™¤é“å…·æ—¶éƒ½éœ€è¦å°†åé¢çš„é“å…·å‘åç§»åŠ¨æˆ–å‘å‰ç§»åŠ¨ï¼Œè¿™æ ·å°±ä¼šéå¸¸è€—è´¹æ—¶é—´ã€‚ä½†æ˜¯å¦‚æœä½ ä½¿ç”¨çš„æ˜¯æˆ‘ LinkedListï¼Œé‚£ä¹ˆåªéœ€è¦å°†æ–°é“å…·æ’å…¥åˆ°é“¾è¡¨ä¸­çš„æŒ‡å®šä½ç½®ï¼Œæˆ–è€…å°†è¦åˆ é™¤çš„é“å…·ä»é“¾è¡¨ä¸­åˆ é™¤å³å¯ï¼Œè¿™æ ·å°±å¯ä»¥å¿«é€Ÿåœ°å®Œæˆé“å…·æ çš„æ›´æ–°ã€‚

é™¤äº†æ¸¸æˆä¸­çš„é“å…·æ ï¼Œæˆ‘ LinkedList è¿˜å¯ä»¥ç”¨äºå®ç° LRUï¼ˆLeast Recently Usedï¼‰ç¼“å­˜æ·˜æ±°ç®—æ³•ã€‚LRU ç¼“å­˜æ·˜æ±°ç®—æ³•æ˜¯ä¸€ç§å¸¸ç”¨çš„ç¼“å­˜æ·˜æ±°ç­–ç•¥ï¼Œå®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼Œå½“ç¼“å­˜ç©ºé—´ä¸å¤Ÿæ—¶ï¼Œä¼˜å…ˆæ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ç¼“å­˜æ•°æ®ã€‚åœ¨å®ç° LRU ç¼“å­˜æ·˜æ±°ç®—æ³•æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨æˆ‘ LinkedList æ¥å­˜å‚¨ç¼“å­˜æ•°æ®ï¼Œæ¯æ¬¡è®¿é—®ç¼“å­˜æ•°æ®æ—¶ï¼Œå°†è¯¥æ•°æ®ä»é“¾è¡¨ä¸­åˆ é™¤å¹¶ç§»åŠ¨åˆ°é“¾è¡¨çš„å¤´éƒ¨ï¼Œè¿™æ ·é“¾è¡¨çš„å°¾éƒ¨å°±æ˜¯æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ç¼“å­˜æ•°æ®ï¼Œå½“ç¼“å­˜ç©ºé—´ä¸å¤Ÿæ—¶ï¼Œåªéœ€è¦å°†é“¾è¡¨å°¾éƒ¨çš„ç¼“å­˜æ•°æ®æ·˜æ±°å³å¯ã€‚

æ€»ä¹‹ï¼Œå„æœ‰å„çš„å¥½ï¼Œä¸”è¡Œä¸”çæƒœã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 6.5 ArrayListå’ŒLinkedListçš„åŒºåˆ«

â€œç»ˆäºï¼ŒäºŒå“¥ï¼Œæˆ‘ä»¬è¦èŠ [LinkedList](https://tobebetterjavaer.com/collection/linkedlist.html) å’Œ [ArrayList](https://tobebetterjavaer.com/collection/arraylist.html) ä¹‹é—´çš„å·®åˆ«äº†ï¼Œæˆ‘æœŸå¾…äº†å¾ˆä¹…ã€‚â€ä¸‰å¦¹å˜Ÿå›”ç€è¯´ã€‚

â€œå…¶å®ç»è¿‡å‰é¢ä¸¤èŠ‚çš„åˆ†æï¼Œå·®åˆ«å·²ç»å¾ˆæ¸…æ™°äº†ã€‚â€æˆ‘å–ƒå–ƒé“ã€‚

â€œå“¥ï¼Œä½ å†è¯´ç‚¹å§ï¼Œæ·±æŒ–ä¸€ä¸‹ï¼ŒOKï¼Ÿâ€

â€œå¥½å§ï¼Œé‚£å°±è®©æˆ‘ä»¬å‡ºå‘å§ï¼â€

>PSï¼šä¸ºäº†å’Œå‰é¢ä¸¤èŠ‚çš„æºç åšé€‚å½“çš„åŒºåˆ†ï¼Œè¿™é‡Œé‡‡ç”¨çš„æ˜¯ Java 11 çš„æºç ï¼Œè¯·åŠ¡å¿…æ³¨æ„ã€‚ä½†æ•´ä½“ä¸Šå·®åˆ«å¾ˆå°ã€‚

### 01ã€ArrayList æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ

ArrayList å®ç°äº† List æ¥å£ï¼Œç»§æ‰¿äº† AbstractList æŠ½è±¡ç±»ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/list-war-2-01.png)

åº•å±‚æ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼Œå¹¶ä¸”å®ç°äº†åŠ¨æ€æ‰©å®¹ï¼ˆå½“éœ€è¦æ·»åŠ æ–°å…ƒç´ æ—¶ï¼Œå¦‚æœ elementData æ•°ç»„å·²æ»¡ï¼Œåˆ™ä¼šè‡ªåŠ¨æ‰©å®¹ï¼Œæ–°çš„å®¹é‡å°†æ˜¯åŸæ¥çš„ 1.5 å€ï¼‰ï¼Œæ¥çœ‹ä¸€ä¸‹ ArrayList çš„éƒ¨åˆ†æºç ã€‚

```java
public class ArrayList<E> extends AbstractList<E>
        implements List<E>, RandomAccess, Cloneable, java.io.Serializable
{
    private static final int DEFAULT_CAPACITY = 10; // é»˜è®¤å®¹é‡ä¸º 10
    transient Object[] elementData; // å­˜å‚¨å…ƒç´ çš„æ•°ç»„ï¼Œæ•°ç»„ç±»å‹ä¸º Object
    private int size; // åˆ—è¡¨çš„å¤§å°ï¼Œå³åˆ—è¡¨ä¸­å…ƒç´ çš„ä¸ªæ•°
}
```

ArrayList è¿˜å®ç°äº† RandomAccess æ¥å£ï¼Œè¿™æ˜¯ä¸€ä¸ªæ ‡è®°æ¥å£ï¼š

```java
public interface RandomAccess {
}
```

å†…éƒ¨æ˜¯ç©ºçš„ï¼Œæ ‡è®°â€œå®ç°äº†è¿™ä¸ªæ¥å£çš„ç±»æ”¯æŒå¿«é€Ÿï¼ˆé€šå¸¸æ˜¯å›ºå®šæ—¶é—´ï¼‰éšæœºè®¿é—®â€ã€‚å¿«é€Ÿéšæœºè®¿é—®æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå°±æ˜¯è¯´ä¸éœ€è¦éå†ï¼Œå°±å¯ä»¥é€šè¿‡ä¸‹æ ‡ï¼ˆç´¢å¼•ï¼‰ç›´æ¥è®¿é—®åˆ°å†…å­˜åœ°å€ã€‚è€Œ LinkedList æ²¡æœ‰å®ç°è¯¥æ¥å£ï¼Œè¡¨ç¤ºå®ƒä¸æ”¯æŒé«˜æ•ˆçš„éšæœºè®¿é—®ï¼Œéœ€è¦é€šè¿‡éå†æ¥è®¿é—®å…ƒç´ ã€‚

```java
/**
 * è¿”å›åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚
 *
 * @param index è¦è¿”å›çš„å…ƒç´ çš„ç´¢å¼•
 * @return åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ 
 * @throws IndexOutOfBoundsException å¦‚æœç´¢å¼•è¶Šç•Œï¼ˆindex < 0 || index >= size()ï¼‰
 */
public E get(int index) {
    Objects.checkIndex(index, size); // æ£€æŸ¥ç´¢å¼•æ˜¯å¦è¶Šç•Œ
    return elementData(index); // è°ƒç”¨ elementData æ–¹æ³•è·å–å…ƒç´ 
}

/**
 * è¿”å›åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚
 * æ³¨æ„ï¼šè¯¥æ–¹æ³•å¹¶æ²¡æœ‰æ£€æŸ¥ç´¢å¼•æ˜¯å¦è¶Šç•Œï¼Œè°ƒç”¨è¯¥æ–¹æ³•å‰éœ€è¦å…ˆæ£€æŸ¥ç´¢å¼•æ˜¯å¦è¶Šç•Œã€‚
 *
 * @param index è¦è¿”å›çš„å…ƒç´ çš„ç´¢å¼•
 * @return åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ 
 */
E elementData(int index) {
    return (E) elementData[index]; // å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œå°† Object ç±»å‹è½¬æ¢ä¸º E ç±»å‹
}
```

ArrayList è¿˜å®ç°äº† Cloneable æ¥å£ï¼Œè¿™è¡¨æ˜ ArrayList æ˜¯æ”¯æŒ[æ‹·è´](https://tobebetterjavaer.com/basic-extra-meal/deep-copy.html)çš„ã€‚ArrayList å†…éƒ¨çš„ç¡®ä¹Ÿé‡å†™äº† Object ç±»çš„ `clone()` æ–¹æ³•ã€‚

```java
/**
 * è¿”å›è¯¥åˆ—è¡¨çš„æµ…è¡¨å‰¯æœ¬ã€‚
 * ï¼ˆå…ƒç´ æœ¬èº«ä¸ä¼šè¢«å¤åˆ¶ã€‚ï¼‰
 *
 * @return è¯¥åˆ—è¡¨çš„å‰¯æœ¬
 */
public Object clone() {
    try {
        ArrayList<?> v = (ArrayList<?>) super.clone(); // è°ƒç”¨ Object ç±»çš„ clone æ–¹æ³•ï¼Œå¾—åˆ°ä¸€ä¸ªæµ…è¡¨å‰¯æœ¬
        v.elementData = Arrays.copyOf(elementData, size); // å¤åˆ¶ elementData æ•°ç»„ï¼Œåˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ä½œä¸ºå‰¯æœ¬
        v.modCount = 0; // å°† modCount ç½®ä¸º 0
        return v; // è¿”å›å‰¯æœ¬
    } catch (CloneNotSupportedException e) {
        // this shouldn't happen, since we are Cloneable
        throw new InternalError(e);
    }
}
```

ArrayList è¿˜å®ç°äº† [Serializable](https://tobebetterjavaer.com/io/Serializbale.html) æ¥å£ï¼ŒåŒæ ·æ˜¯ä¸€ä¸ªæ ‡è®°æ¥å£ï¼š

```java
public interface Serializable {
}
```

å†…éƒ¨ä¹Ÿæ˜¯ç©ºçš„ï¼Œæ ‡è®°â€œå®ç°äº†è¿™ä¸ªæ¥å£çš„ç±»æ”¯æŒåºåˆ—åŒ–â€ã€‚åºåˆ—åŒ–æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼ŸJava çš„åºåˆ—åŒ–æ˜¯æŒ‡ï¼Œå°†å¯¹è±¡è½¬æ¢æˆä»¥å­—èŠ‚åºåˆ—çš„å½¢å¼æ¥è¡¨ç¤ºï¼Œè¿™äº›å­—èŠ‚åºä¸­åŒ…å«äº†å¯¹è±¡çš„å­—æ®µå’Œæ–¹æ³•ã€‚åºåˆ—åŒ–åçš„å¯¹è±¡å¯ä»¥è¢«å†™åˆ°æ•°æ®åº“ã€å†™åˆ°æ–‡ä»¶ï¼Œä¹Ÿå¯ç”¨äºç½‘ç»œä¼ è¾“ã€‚

çœ¼ç›é›ªäº®çš„å°ä¼™ä¼´å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼ŒArrayList ä¸­çš„å…³é”®å­—æ®µ elementData ä½¿ç”¨äº† [transient å…³é”®å­—](https://tobebetterjavaer.com/io/transient.html)ä¿®é¥°ï¼Œè¿™ä¸ªå…³é”®å­—çš„ä½œç”¨æ˜¯ï¼Œè®©å®ƒä¿®é¥°çš„å­—æ®µä¸è¢«åºåˆ—åŒ–ã€‚

è¿™ä¸å‰åçŸ›ç›¾å—ï¼Ÿä¸€ä¸ªç±»æ—¢ç„¶å®ç°äº† Serilizable æ¥å£ï¼Œè‚¯å®šæ˜¯æƒ³è¦è¢«åºåˆ—åŒ–çš„ï¼Œå¯¹å§ï¼Ÿé‚£ä¸ºä»€ä¹ˆä¿å­˜å…³é”®æ•°æ®çš„ elementData åˆä¸æƒ³è¢«åºåˆ—åŒ–å‘¢?

è¿™è¿˜å¾—ä» â€œArrayList æ˜¯åŸºäºæ•°ç»„å®ç°çš„â€å¼€å§‹è¯´èµ·ã€‚å¤§å®¶éƒ½çŸ¥é“ï¼Œæ•°ç»„æ˜¯å®šé•¿çš„ï¼Œå°±æ˜¯è¯´ï¼Œæ•°ç»„ä¸€æ—¦å£°æ˜äº†ï¼Œé•¿åº¦ï¼ˆå®¹é‡ï¼‰å°±æ˜¯å›ºå®šçš„ï¼Œä¸èƒ½åƒæŸäº›ä¸œè¥¿ä¸€æ ·ä¼¸ç¼©è‡ªå¦‚ã€‚è¿™å°±å¾ˆéº»çƒ¦ï¼Œæ•°ç»„ä¸€æ—¦è£…æ»¡äº†ï¼Œå°±ä¸èƒ½æ·»åŠ æ–°çš„å…ƒç´ è¿›æ¥äº†ã€‚

ArrayList ä¸æƒ³åƒæ•°ç»„è¿™æ ·æ´»ç€ï¼Œå®ƒæƒ³èƒ½å±ˆèƒ½ä¼¸ï¼Œæ‰€ä»¥å®ƒå®ç°äº†åŠ¨æ€æ‰©å®¹ã€‚ä¸€æ—¦åœ¨æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œå‘ç°å®¹é‡ç”¨æ»¡äº† `s == elementData.length`ï¼Œå°±æŒ‰ç…§åŸæ¥æ•°ç»„çš„ 1.5 å€ï¼ˆ`oldCapacity >> 1`ï¼‰è¿›è¡Œæ‰©å®¹ã€‚æ‰©å®¹ä¹‹åï¼Œå†å°†åŸæœ‰çš„æ•°ç»„å¤åˆ¶åˆ°æ–°åˆ†é…çš„å†…å­˜åœ°å€ä¸Š `Arrays.copyOf(elementData, newCapacity)`ã€‚

è¿™éƒ¨åˆ†æºç æˆ‘ä»¬åœ¨ä¹‹å‰è®² [ArrayList](https://tobebetterjavaer.com/collection/arraylist.html) çš„æ—¶å€™å°±å·²ç»è®²çš„å¾ˆæ¸…æ¥šäº†ï¼Œè¿™é‡Œå°±ä¸€ç¬”å¸¦è¿‡ã€‚

åŠ¨æ€æ‰©å®¹æ„å‘³ç€ä»€ä¹ˆï¼Ÿ

æ„å‘³ç€æ•°ç»„çš„å®é™…å¤§å°å¯èƒ½æ°¸è¿œæ— æ³•è¢«å¡«æ»¡çš„ï¼Œæ€»æœ‰å¤šä½™å‡ºæ¥ç©ºç½®çš„å†…å­˜ç©ºé—´ã€‚

æ¯”å¦‚è¯´ï¼Œé»˜è®¤çš„æ•°ç»„å¤§å°æ˜¯ 10ï¼Œå½“æ·»åŠ ç¬¬ 11 ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œæ•°ç»„çš„é•¿åº¦æ‰©å®¹äº† 1.5 å€ï¼Œä¹Ÿå°±æ˜¯ 15ï¼Œæ„å‘³ç€è¿˜æœ‰ 4 ä¸ªå†…å­˜ç©ºé—´æ˜¯é—²ç½®çš„ï¼Œå¯¹å§ï¼Ÿ

åºåˆ—åŒ–çš„æ—¶å€™ï¼Œå¦‚æœæŠŠæ•´ä¸ªæ•°ç»„éƒ½åºåˆ—åŒ–çš„è¯ï¼Œæ˜¯ä¸æ˜¯å°±å¤šåºåˆ—åŒ–äº† 4 ä¸ªå†…å­˜ç©ºé—´ã€‚å½“å­˜å‚¨çš„å…ƒç´ æ•°é‡éå¸¸éå¸¸å¤šçš„æ—¶å€™ï¼Œé—²ç½®çš„ç©ºé—´å°±éå¸¸éå¸¸å¤§ï¼Œåºåˆ—åŒ–è€—è´¹çš„æ—¶é—´å°±ä¼šéå¸¸éå¸¸å¤šã€‚

äºæ˜¯ï¼ŒArrayList åšäº†ä¸€ä¸ªæ„‰å¿«è€Œåˆèªæ˜çš„å†³å®šï¼Œå†…éƒ¨æä¾›äº†ä¸¤ä¸ªç§æœ‰æ–¹æ³• writeObject å’Œ readObject æ¥å®Œæˆåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚

```java
/**
 * å°†æ­¤åˆ—è¡¨å®ä¾‹çš„çŠ¶æ€åºåˆ—å†™å…¥æŒ‡å®šçš„ ObjectOutputStreamã€‚
 * ï¼ˆå³ï¼Œä¿å­˜è¿™ä¸ªåˆ—è¡¨å®ä¾‹åˆ°ä¸€ä¸ªæµä¸­ã€‚ï¼‰
 *
 * @param s è¦å†™å…¥çš„æµ
 * @throws java.io.IOException å¦‚æœå†™å…¥æµæ—¶å‘ç”Ÿå¼‚å¸¸
 */
private void writeObject(java.io.ObjectOutputStream s)
        throws java.io.IOException {
    s.defaultWriteObject(); // å†™å‡ºå¯¹è±¡çš„é»˜è®¤å­—æ®µ

    // Write out size as capacity for behavioral compatibility with clone()
    s.writeInt(size); // å†™å‡º size

    // Write out all elements in the proper order.
    for (int i=0; i<size; i++) {
        s.writeObject(elementData[i]); // ä¾æ¬¡å†™å‡º elementData æ•°ç»„ä¸­çš„å…ƒç´ 
    }
}
```

ä» writeObject æ–¹æ³•çš„æºç ä¸­å¯ä»¥çœ‹å¾—å‡ºï¼Œå®ƒä½¿ç”¨äº† ArrayList çš„å®é™…å¤§å° size è€Œä¸æ˜¯æ•°ç»„çš„é•¿åº¦ï¼ˆ`elementData.length`ï¼‰æ¥ä½œä¸ºå…ƒç´ çš„ä¸Šé™è¿›è¡Œåºåˆ—åŒ–ã€‚

æ­¤å¤„åº”è¯¥æœ‰æŒå£°å•Šï¼ä¸æ˜¯ä¸ºæˆ‘ï¼Œä¸º Java æºç çš„ä½œè€…ä»¬ï¼Œä»–ä»¬çœŸçš„æ˜¯å¤ªå‰å®³äº†ï¼Œå¯ä»¥ç”¨ä¸¤ä¸ªè¯æ¥å½¢å®¹ä»–ä»¬â€”â€”æ®šç²¾ç«­è™‘ã€ç²¾ç›Šæ±‚ç²¾ã€‚

666

è¿™æ˜¯readObjectæ–¹æ³•çš„æºç ï¼š

```java
/**
 * ä»æŒ‡å®šçš„ ObjectInputStream ä¸­è¯»å–æ­¤åˆ—è¡¨å®ä¾‹çš„çŠ¶æ€åºåˆ—ã€‚
 * ï¼ˆå³ï¼Œä»æµä¸­æ¢å¤è¿™ä¸ªåˆ—è¡¨å®ä¾‹ã€‚ï¼‰
 *
 * @param s ä»ä¸­è¯»å–æ­¤åˆ—è¡¨å®ä¾‹çš„çŠ¶æ€åºåˆ—çš„æµ
 * @throws java.io.IOException å¦‚æœè¯»å–æµæ—¶å‘ç”Ÿå¼‚å¸¸
 * @throws ClassNotFoundException å¦‚æœåœ¨è¯»å–æµæ—¶æ‰¾ä¸åˆ°ç±»
 */
private void readObject(java.io.ObjectInputStream s)
        throws java.io.IOException, ClassNotFoundException {
    elementData = EMPTY_ELEMENTDATA; // åˆå§‹åŒ– elementData æ•°ç»„ä¸ºç©ºæ•°ç»„

    // è¯»å–é»˜è®¤å­—æ®µ
    s.defaultReadObject();

    // è¯»å–å®¹é‡ï¼Œè¿™ä¸ªå€¼è¢«å¿½ç•¥ï¼Œå› ä¸ºåœ¨ ArrayList ä¸­ï¼Œå®¹é‡å’Œé•¿åº¦æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µ
    s.readInt();

    if (size > 0) {
        // åˆ†é…ä¸€ä¸ªæ–°çš„ elementData æ•°ç»„ï¼Œå¤§å°ä¸º size
        ensureCapacityInternal(size);

        Object[] a = elementData;
        // ä¾æ¬¡ä»è¾“å…¥æµä¸­è¯»å–å…ƒç´ ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨æ•°ç»„ä¸­
        for (int i=0; i<size; i++) {
            a[i] = s.readObject(); // è¯»å–å¯¹è±¡å¹¶å­˜å‚¨åœ¨ elementData æ•°ç»„ä¸­
        }
    }
}
```

### 02ã€LinkedList æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ

LinkedList æ˜¯ä¸€ä¸ªç»§æ‰¿è‡ª AbstractSequentialList çš„åŒå‘é“¾è¡¨ï¼Œå› æ­¤å®ƒä¹Ÿå¯ä»¥è¢«å½“ä½œå †æ ˆã€é˜Ÿåˆ—æˆ–åŒç«¯é˜Ÿåˆ—è¿›è¡Œæ“ä½œã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/list-war-2-02.png)


æ¥çœ‹ä¸€ä¸‹éƒ¨åˆ†æºç ï¼š

```java
public class LinkedList<E>
    extends AbstractSequentialList<E>
    implements List<E>, Deque<E>, Cloneable, java.io.Serializable
{
    transient int size = 0; // éåºåˆ—åŒ–å­—æ®µï¼Œè¡¨ç¤ºé“¾è¡¨ä¸­çš„èŠ‚ç‚¹ä¸ªæ•°
    transient Node<E> first; // éåºåˆ—åŒ–å­—æ®µï¼ŒæŒ‡å‘é“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
    transient Node<E> last; // éåºåˆ—åŒ–å­—æ®µï¼ŒæŒ‡å‘é“¾è¡¨ä¸­çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹

    // ...
}
```

 LinkedList å†…éƒ¨å®šä¹‰äº†ä¸€ä¸ª Node èŠ‚ç‚¹ï¼Œå®ƒåŒ…å« 3 ä¸ªéƒ¨åˆ†ï¼šå…ƒç´ å†…å®¹ itemï¼Œå‰å¼•ç”¨ prev å’Œåå¼•ç”¨ nextã€‚è¿™ä¸ªåœ¨è®² [LinkedList](https://tobebetterjavaer.com/collection/linkedlist.html) çš„æ—¶å€™ä¹Ÿè®²è¿‡äº†ï¼Œè¿™é‡Œç•¥è¿‡ã€‚

LinkedList è¿˜å®ç°äº† Cloneable æ¥å£ï¼Œè¿™è¡¨æ˜ LinkedList æ˜¯æ”¯æŒæ‹·è´çš„ã€‚

LinkedList è¿˜å®ç°äº† Serializable æ¥å£ï¼Œè¿™è¡¨æ˜ LinkedList æ˜¯æ”¯æŒåºåˆ—åŒ–çš„ã€‚çœ¼ç›é›ªäº®çš„å°ä¼™ä¼´å¯èƒ½åˆæ³¨æ„åˆ°äº†ï¼ŒLinkedList ä¸­çš„å…³é”®å­—æ®µ sizeã€firstã€last éƒ½ä½¿ç”¨äº† transient å…³é”®å­—ä¿®é¥°ï¼Œè¿™ä¸åˆçŸ›ç›¾äº†å—ï¼Ÿåˆ°åº•æ˜¯æƒ³åºåˆ—åŒ–è¿˜æ˜¯ä¸æƒ³åºåˆ—åŒ–ï¼Ÿ

ç­”æ¡ˆæ˜¯ LinkedList æƒ³æŒ‰ç…§è‡ªå·±çš„æ–¹å¼åºåˆ—åŒ–ï¼Œæ¥çœ‹å®ƒè‡ªå·±å®ç°çš„ `writeObject()` æ–¹æ³•ï¼š

```java
private void writeObject(java.io.ObjectOutputStream s)
        throws java.io.IOException {
    // å†™å…¥é»˜è®¤çš„åºåˆ—åŒ–æ ‡è®°
    s.defaultWriteObject();

    // å†™å…¥é“¾è¡¨çš„èŠ‚ç‚¹ä¸ªæ•°
    s.writeInt(size);

    // æŒ‰æ­£ç¡®çš„é¡ºåºå†™å…¥æ‰€æœ‰å…ƒç´ 
    for (LinkedList.Node<E> x = first; x != null; x = x.next)
        s.writeObject(x.item);
}
```

å‘ç°æ²¡ï¼ŸLinkedList åœ¨åºåˆ—åŒ–çš„æ—¶å€™åªä¿ç•™äº†å…ƒç´ çš„å†…å®¹ itemï¼Œå¹¶æ²¡æœ‰ä¿ç•™å…ƒç´ çš„å‰åå¼•ç”¨ã€‚è¿™æ ·å°±èŠ‚çœäº†ä¸å°‘å†…å­˜ç©ºé—´ï¼Œå¯¹å§ï¼Ÿ

é‚£æœ‰äº›å°ä¼™ä¼´å¯èƒ½å°±ç–‘æƒ‘äº†ï¼Œåªä¿ç•™å…ƒç´ å†…å®¹ï¼Œä¸ä¿ç•™å‰åå¼•ç”¨ï¼Œé‚£ååºåˆ—åŒ–çš„æ—¶å€™æ€ä¹ˆåŠï¼Ÿ

```java
private void readObject(java.io.ObjectInputStream s)
        throws java.io.IOException, ClassNotFoundException {
    // è¯»å–é»˜è®¤çš„åºåˆ—åŒ–æ ‡è®°
    s.defaultReadObject();

    // è¯»å–é“¾è¡¨çš„èŠ‚ç‚¹ä¸ªæ•°
    int size = s.readInt();

    // æŒ‰æ­£ç¡®çš„é¡ºåºè¯»å–æ‰€æœ‰å…ƒç´ 
    for (int i = 0; i < size; i++)
        linkLast((E)s.readObject()); // è¯»å–å…ƒç´ å¹¶å°†å…¶æ·»åŠ åˆ°é“¾è¡¨æœ«å°¾
}

void linkLast(E e) {
    final LinkedList.Node<E> l = last;
    final LinkedList.Node<E> newNode = new LinkedList.Node<>(l, e, null);
    last = newNode; // å°†æ–°èŠ‚ç‚¹ä½œä¸ºé“¾è¡¨å°¾èŠ‚ç‚¹
    if (l == null)
        first = newNode; // å¦‚æœé“¾è¡¨ä¸ºç©ºï¼Œå°†æ–°èŠ‚ç‚¹ä½œä¸ºé“¾è¡¨å¤´èŠ‚ç‚¹
    else
        l.next = newNode; // å¦åˆ™å°†æ–°èŠ‚ç‚¹é“¾æ¥åˆ°é“¾è¡¨å°¾éƒ¨
    size++; // å¢åŠ èŠ‚ç‚¹ä¸ªæ•°
}
```

æ³¨æ„ for å¾ªç¯ä¸­çš„ `linkLast()` æ–¹æ³•ï¼Œå®ƒå¯ä»¥æŠŠé“¾è¡¨é‡æ–°é“¾æ¥èµ·æ¥ï¼Œè¿™æ ·å°±æ¢å¤äº†é“¾è¡¨åºåˆ—åŒ–ä¹‹å‰çš„é¡ºåºã€‚å¾ˆå¦™ï¼Œå¯¹å§ï¼Ÿ

å’Œ ArrayList ç›¸æ¯”ï¼ŒLinkedList æ²¡æœ‰å®ç° RandomAccess æ¥å£ï¼Œè¿™æ˜¯å› ä¸º LinkedList å­˜å‚¨æ•°æ®çš„å†…å­˜åœ°å€æ˜¯ä¸è¿ç»­çš„ï¼Œæ‰€ä»¥ä¸æ”¯æŒéšæœºè®¿é—®ã€‚

### 03ã€æ–°å¢å…ƒç´ æ—¶ç©¶ç«Ÿè°å¿«ï¼Ÿ

å‰é¢æˆ‘ä»¬å·²ç»ä»å¤šä¸ªç»´åº¦äº†è§£äº† ArrayList å’Œ LinkedList çš„å®ç°åŸç†å’Œå„è‡ªçš„ç‰¹ç‚¹ã€‚é‚£æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥èŠèŠ ArrayList å’Œ LinkedList åœ¨æ–°å¢å…ƒç´ æ—¶ç©¶ç«Ÿè°å¿«ï¼Ÿ

#### **1ï¼‰ArrayList**

ArrayList æ–°å¢å…ƒç´ æœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯ç›´æ¥å°†å…ƒç´ æ·»åŠ åˆ°æ•°ç»„æœ«å°¾ï¼Œä¸€ç§æ˜¯å°†å…ƒç´ æ’å…¥åˆ°æŒ‡å®šä½ç½®ã€‚

æ·»åŠ åˆ°æ•°ç»„æœ«å°¾çš„æºç ï¼ˆè¿™éƒ¨åˆ†å‰é¢è®² [ArrayList](https://tobebetterjavaer.com/collection/arraylist.html) çš„æ—¶å€™è®²è¿‡äº†ï¼Œè¿™é‡Œå†æ¸©æ•…ä¸€ä¸‹ï¼‰ï¼š

```java
public boolean add(E e) {
    add(e, elementData, size);
    return true;
}

private void add(E e, Object[] elementData, int s) {
    if (s == elementData.length)
        elementData = grow(); // æ‰©å®¹æ•°ç»„
    elementData[s] = e; // å°†å…ƒç´ æ·»åŠ åˆ°æ•°ç»„æœ«å°¾
    size = s + 1; // å¢åŠ å…ƒç´ ä¸ªæ•°
}
```

å¾ˆç®€å•ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œç„¶åç›´æ¥é€šè¿‡ç´¢å¼•å°†å…ƒç´ æ·»åŠ åˆ°æœ«å°¾ã€‚

æ’å…¥åˆ°æŒ‡å®šä½ç½®çš„æºç ï¼š

```java
public void add(int index, E element) {
    rangeCheckForAdd(index); // æ£€æŸ¥æ’å…¥ä½ç½®æ˜¯å¦è¶Šç•Œ
    final int s; // å½“å‰å…ƒç´ ä¸ªæ•°
    Object[] elementData; // å…ƒç´ æ•°ç»„
    if ((s = size) == (elementData = this.elementData).length) // å¦‚æœæ•°ç»„å·²æ»¡ï¼Œåˆ™æ‰©å®¹
        elementData = grow();
    System.arraycopy(elementData, index,
            elementData, index + 1,
            s - index); // å°†æ’å…¥ä½ç½®åçš„å…ƒç´ å‘å³ç§»åŠ¨ä¸€ä½
    elementData[index] = element; // å°†æ–°å…ƒç´ æ’å…¥åˆ°æŒ‡å®šä½ç½®
    size = s + 1; // å¢åŠ å…ƒç´ ä¸ªæ•°
}
```

å…ˆæ£€æŸ¥æ’å…¥çš„ä½ç½®æ˜¯å¦åœ¨åˆç†çš„èŒƒå›´ä¹‹å†…ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œå†æŠŠè¯¥ä½ç½®ä»¥åçš„å…ƒç´ å¤åˆ¶åˆ°æ–°æ·»åŠ å…ƒç´ çš„ä½ç½®ä¹‹åï¼Œæœ€åé€šè¿‡ç´¢å¼•å°†å…ƒç´ æ·»åŠ åˆ°æŒ‡å®šçš„ä½ç½®ã€‚

#### **2ï¼‰LinkedList**

LinkedList æ–°å¢å…ƒç´ ä¹Ÿæœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯ç›´æ¥å°†å…ƒç´ æ·»åŠ åˆ°é˜Ÿå°¾ï¼Œä¸€ç§æ˜¯å°†å…ƒç´ æ’å…¥åˆ°æŒ‡å®šä½ç½®ã€‚

æ·»åŠ åˆ°é˜Ÿå°¾çš„æºç ï¼š

```java
public boolean add(E e) {
    linkLast(e); // å°†å…ƒç´ æ·»åŠ åˆ°é“¾è¡¨æœ«å°¾
    return true;
}

void linkLast(E e) {
    final LinkedList.Node<E> l = last; // è·å–é“¾è¡¨çš„å°¾èŠ‚ç‚¹
    final LinkedList.Node<E> newNode = new LinkedList.Node<>(l, e, null); // åˆ›å»ºæ–°èŠ‚ç‚¹
    last = newNode; // å°†æ–°èŠ‚ç‚¹ä½œä¸ºé“¾è¡¨çš„å°¾èŠ‚ç‚¹
    if (l == null)
        first = newNode; // å¦‚æœé“¾è¡¨ä¸ºç©ºï¼Œåˆ™å°†æ–°èŠ‚ç‚¹ä½œä¸ºé“¾è¡¨çš„å¤´èŠ‚ç‚¹
    else
        l.next = newNode; // å¦åˆ™å°†æ–°èŠ‚ç‚¹é“¾æ¥åˆ°é“¾è¡¨çš„å°¾éƒ¨
    size++; // å¢åŠ èŠ‚ç‚¹ä¸ªæ•°
}
```

å…ˆå°†é˜Ÿå°¾çš„èŠ‚ç‚¹ last å­˜æ”¾åˆ°ä¸´æ—¶å˜é‡ l ä¸­ï¼Œç„¶åç”Ÿæˆæ–°çš„ Node èŠ‚ç‚¹ï¼Œå¹¶èµ‹ç»™ lastï¼Œå¦‚æœ l  ä¸º nullï¼Œè¯´æ˜æ˜¯ç¬¬ä¸€æ¬¡æ·»åŠ ï¼Œæ‰€ä»¥ first ä¸ºæ–°çš„èŠ‚ç‚¹ï¼›å¦åˆ™å°†æ–°çš„èŠ‚ç‚¹èµ‹ç»™ä¹‹å‰ last çš„ nextã€‚

æ’å…¥åˆ°æŒ‡å®šä½ç½®çš„æºç ï¼š

```java
public void add(int index, E element) {
    checkPositionIndex(index); // æ£€æŸ¥æ’å…¥ä½ç½®æ˜¯å¦è¶Šç•Œ

    if (index == size)
        linkLast(element); // å¦‚æœæ’å…¥ä½ç½®ä¸ºé“¾è¡¨æœ«å°¾ï¼Œåˆ™å°†å…ƒç´ æ·»åŠ åˆ°é“¾è¡¨æœ«å°¾
    else
        linkBefore(element, node(index)); // å¦åˆ™å°†å…ƒç´ æ’å…¥åˆ°æŒ‡å®šä½ç½®çš„å‰é¢çš„èŠ‚ç‚¹åé¢
}

LinkedList.Node<E> node(int index) {
    if (index < (size >> 1)) { // å¦‚æœæ’å…¥ä½ç½®åœ¨é“¾è¡¨å‰åŠéƒ¨åˆ†ï¼Œåˆ™ä»å¤´èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾
        LinkedList.Node<E> x = first;
        for (int i = 0; i < index; i++)
            x = x.next;
        return x;
    } else { // å¦åˆ™ä»å°¾èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾
        LinkedList.Node<E> x = last;
        for (int i = size - 1; i > index; i--)
            x = x.prev;
        return x;
    }
}

void linkBefore(E e, LinkedList.Node<E> succ) {
    final LinkedList.Node<E> pred = succ.prev; // è·å–æ’å…¥ä½ç½®çš„å‰é©±èŠ‚ç‚¹
    final LinkedList.Node<E> newNode = new LinkedList.Node<>(pred, e, succ); // åˆ›å»ºæ–°èŠ‚ç‚¹
    succ.prev = newNode; // å°†æ–°èŠ‚ç‚¹é“¾æ¥åˆ°åç»§èŠ‚ç‚¹
    if (pred == null)
        first = newNode; // å¦‚æœå‰é©±èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™å°†æ–°èŠ‚ç‚¹ä½œä¸ºå¤´èŠ‚ç‚¹
    else
        pred.next = newNode; // å¦åˆ™å°†æ–°èŠ‚ç‚¹é“¾æ¥åˆ°å‰é©±èŠ‚ç‚¹
    size++; // å¢åŠ èŠ‚ç‚¹ä¸ªæ•°
}
```

å…ˆæ£€æŸ¥æ’å…¥çš„ä½ç½®æ˜¯å¦åœ¨åˆç†çš„èŒƒå›´ä¹‹å†…ï¼Œç„¶ååˆ¤æ–­æ’å…¥çš„ä½ç½®æ˜¯å¦æ˜¯é˜Ÿå°¾ï¼Œå¦‚æœæ˜¯ï¼Œæ·»åŠ åˆ°é˜Ÿå°¾ï¼›å¦åˆ™æ‰§è¡Œ `linkBefore()` æ–¹æ³•ã€‚

åœ¨æ‰§è¡Œ `linkBefore()` æ–¹æ³•ä¹‹å‰ï¼Œä¼šè°ƒç”¨ `node()` æ–¹æ³•æŸ¥æ‰¾æŒ‡å®šä½ç½®ä¸Šçš„å…ƒç´ ï¼Œè¿™ä¸€æ­¥æ˜¯éœ€è¦éå† LinkedList çš„ã€‚å¦‚æœæ’å…¥çš„ä½ç½®é å‰å‰åŠæ®µï¼Œå°±ä»é˜Ÿå¤´å¼€å§‹å¾€åæ‰¾ï¼›å¦åˆ™ä»é˜Ÿå°¾å¾€å‰æ‰¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ’å…¥çš„ä½ç½®è¶Šé è¿‘ LinkedList çš„ä¸­é—´ä½ç½®ï¼Œéå†æ‰€èŠ±è´¹çš„æ—¶é—´å°±è¶Šå¤šã€‚

æ‰¾åˆ°æŒ‡å®šä½ç½®ä¸Šçš„å…ƒç´ ï¼ˆå‚æ•°succï¼‰ä¹‹åï¼Œå°±å¼€å§‹æ‰§è¡Œ `linkBefore()` æ–¹æ³•ï¼Œå…ˆå°† succ çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆprevï¼‰å­˜æ”¾åˆ°ä¸´æ—¶å˜é‡ pred ä¸­ï¼Œç„¶åç”Ÿæˆæ–°çš„ Node èŠ‚ç‚¹ï¼ˆnewNodeï¼‰ï¼Œå¹¶å°† succ çš„å‰ä¸€ä¸ªèŠ‚ç‚¹å˜æ›´ä¸º newNodeï¼Œå¦‚æœ pred ä¸º nullï¼Œè¯´æ˜æ’å…¥çš„æ˜¯é˜Ÿå¤´ï¼Œæ‰€ä»¥ first ä¸ºæ–°èŠ‚ç‚¹ï¼›å¦åˆ™å°† pred çš„åä¸€ä¸ªèŠ‚ç‚¹å˜æ›´ä¸º newNodeã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/list-war-2-03.png)

ç»è¿‡æºç åˆ†æä»¥åï¼Œä½ æ˜¯ä¸æ˜¯åœ¨æƒ³ï¼šâ€œå¥½åƒ ArrayList åœ¨æ–°å¢å…ƒç´ çš„æ—¶å€™æ•ˆç‡å¹¶ä¸ä¸€å®šæ¯” LinkedList ä½å•Šï¼â€

å½“ä¸¤è€…çš„èµ·å§‹é•¿åº¦æ˜¯ä¸€æ ·çš„æƒ…å†µä¸‹ï¼š

- å¦‚æœæ˜¯ä»é›†åˆçš„å¤´éƒ¨æ–°å¢å…ƒç´ ï¼ŒArrayList èŠ±è´¹çš„æ—¶é—´åº”è¯¥æ¯” LinkedList å¤šï¼Œå› ä¸ºéœ€è¦å¯¹å¤´éƒ¨ä»¥åçš„å…ƒç´ è¿›è¡Œå¤åˆ¶ã€‚

æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼š

```java
public class ArrayListTest {
    public static void addFromHeaderTest(int num) {
        ArrayList<String> list = new ArrayList<String>(num);
        int i = 0;

        long timeStart = System.currentTimeMillis();

        while (i < num) {
            list.add(0, i + "æ²‰é»˜ç‹äºŒ");
            i++;
        }
        long timeEnd = System.currentTimeMillis();

        System.out.println("ArrayListä»é›†åˆå¤´éƒ¨ä½ç½®æ–°å¢å…ƒç´ èŠ±è´¹çš„æ—¶é—´" + (timeEnd - timeStart));
    }
}

/**
 * @author å¾®ä¿¡æœã€Œæ²‰é»˜ç‹äºŒã€ï¼Œå›å¤å…³é”®å­— PDF
 */
public class LinkedListTest {
    public static void addFromHeaderTest(int num) {
        LinkedList<String> list = new LinkedList<String>();
        int i = 0;
        long timeStart = System.currentTimeMillis();
        while (i < num) {
            list.addFirst(i + "æ²‰é»˜ç‹äºŒ");
            i++;
        }
        long timeEnd = System.currentTimeMillis();

        System.out.println("LinkedListä»é›†åˆå¤´éƒ¨ä½ç½®æ–°å¢å…ƒç´ èŠ±è´¹çš„æ—¶é—´" + (timeEnd - timeStart));
    }
}
```

num ä¸º 10000ï¼Œä»£ç å®æµ‹åçš„æ—¶é—´å¦‚ä¸‹æ‰€ç¤ºï¼š

```
ArrayListä»é›†åˆå¤´éƒ¨ä½ç½®æ–°å¢å…ƒç´ èŠ±è´¹çš„æ—¶é—´595
LinkedListä»é›†åˆå¤´éƒ¨ä½ç½®æ–°å¢å…ƒç´ èŠ±è´¹çš„æ—¶é—´15
```

æ­¤æ—¶ï¼ŒArrayList èŠ±è´¹çš„æ—¶é—´æ¯” LinkedList è¦å¤šå¾ˆå¤šã€‚

- å¦‚æœæ˜¯ä»é›†åˆçš„ä¸­é—´ä½ç½®æ–°å¢å…ƒç´ ï¼ŒArrayList èŠ±è´¹çš„æ—¶é—´æä¸å¥½è¦æ¯” LinkedList å°‘ï¼Œå› ä¸º LinkedList éœ€è¦éå†ã€‚

æ¥çœ‹æµ‹è¯•ä»£ç ã€‚

```java
public class ArrayListTest {
    public static void addFromMidTest(int num) {
        ArrayList<String> list = new ArrayList<String>(num);
        int i = 0;

        long timeStart = System.currentTimeMillis();
        while (i < num) {
            int temp = list.size();
            list.add(temp / 2, i + "æ²‰é»˜ç‹äºŒ");
            i++;
        }
        long timeEnd = System.currentTimeMillis();

        System.out.println("ArrayListä»é›†åˆä¸­é—´ä½ç½®æ–°å¢å…ƒç´ èŠ±è´¹çš„æ—¶é—´" + (timeEnd - timeStart));
    }
}

public class LinkedListTest {
    public static void addFromMidTest(int num) {
        LinkedList<String> list = new LinkedList<String>();
        int i = 0;
        long timeStart = System.currentTimeMillis();
        while (i < num) {
            int temp = list.size();
            list.add(temp / 2, i + "æ²‰é»˜ç‹äºŒ");
            i++;
        }
        long timeEnd = System.currentTimeMillis();

        System.out.println("LinkedListä»é›†åˆä¸­é—´ä½ç½®æ–°å¢å…ƒç´ èŠ±è´¹çš„æ—¶é—´" + (timeEnd - timeStart));
    }
}
```

num ä¸º 10000ï¼Œä»£ç å®æµ‹åçš„æ—¶é—´å¦‚ä¸‹æ‰€ç¤ºï¼š

```
ArrayListä»é›†åˆä¸­é—´ä½ç½®æ–°å¢å…ƒç´ èŠ±è´¹çš„æ—¶é—´16
LinkedListä»é›†åˆä¸­é—´ä½ç½®æ–°å¢å…ƒç´ èŠ±è´¹çš„æ—¶é—´114
```

ArrayList èŠ±è´¹çš„æ—¶é—´æ¯” LinkedList è¦å°‘å¾ˆå¤šå¾ˆå¤šã€‚

- å¦‚æœæ˜¯ä»é›†åˆçš„å°¾éƒ¨æ–°å¢å…ƒç´ ï¼ŒArrayList èŠ±è´¹çš„æ—¶é—´åº”è¯¥æ¯” LinkedList å°‘ï¼Œå› ä¸ºæ•°ç»„æ˜¯ä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œä¹Ÿä¸éœ€è¦å¤åˆ¶æ•°ç»„ï¼›è€Œé“¾è¡¨éœ€è¦åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œå‰åå¼•ç”¨ä¹Ÿè¦é‡æ–°æ’åˆ—ã€‚

æ¥çœ‹æµ‹è¯•ä»£ç ï¼š

```java
public class ArrayListTest {
    public static void addFromTailTest(int num) {
        ArrayList<String> list = new ArrayList<String>(num);
        int i = 0;

        long timeStart = System.currentTimeMillis();

        while (i < num) {
            list.add(i + "æ²‰é»˜ç‹äºŒ");
            i++;
        }

        long timeEnd = System.currentTimeMillis();

        System.out.println("ArrayListä»é›†åˆå°¾éƒ¨ä½ç½®æ–°å¢å…ƒç´ èŠ±è´¹çš„æ—¶é—´" + (timeEnd - timeStart));
    }
}

public class LinkedListTest {
    public static void addFromTailTest(int num) {
        LinkedList<String> list = new LinkedList<String>();
        int i = 0;
        long timeStart = System.currentTimeMillis();
        while (i < num) {
            list.add(i + "æ²‰é»˜ç‹äºŒ");
            i++;
        }
        long timeEnd = System.currentTimeMillis();

        System.out.println("LinkedListä»é›†åˆå°¾éƒ¨ä½ç½®æ–°å¢å…ƒç´ èŠ±è´¹çš„æ—¶é—´" + (timeEnd - timeStart));
    }
}
```

num ä¸º 10000ï¼Œä»£ç å®æµ‹åçš„æ—¶é—´å¦‚ä¸‹æ‰€ç¤ºï¼š

```
ArrayListä»é›†åˆå°¾éƒ¨ä½ç½®æ–°å¢å…ƒç´ èŠ±è´¹çš„æ—¶é—´69
LinkedListä»é›†åˆå°¾éƒ¨ä½ç½®æ–°å¢å…ƒç´ èŠ±è´¹çš„æ—¶é—´193
```

ArrayList èŠ±è´¹çš„æ—¶é—´æ¯” LinkedList è¦å°‘ä¸€äº›ã€‚

è¿™æ ·çš„ç»“è®ºå’Œé¢„æœŸçš„æ˜¯ä¸æ˜¯ä¸å¤ªç›¸ç¬¦ï¼ŸArrayList åœ¨æ·»åŠ å…ƒç´ çš„æ—¶å€™å¦‚æœä¸æ¶‰åŠåˆ°æ‰©å®¹ï¼Œæ€§èƒ½åœ¨ä¸¤ç§æƒ…å†µä¸‹ï¼ˆä¸­é—´ä½ç½®æ–°å¢å…ƒç´ ã€å°¾éƒ¨æ–°å¢å…ƒç´ ï¼‰æ¯” LinkedList å¥½å¾ˆå¤šï¼Œåªæœ‰å¤´éƒ¨æ–°å¢å…ƒç´ çš„æ—¶å€™æ¯” LinkedList å·®ï¼Œå› ä¸ºæ•°ç»„å¤åˆ¶çš„åŸå› ã€‚

å½“ç„¶äº†ï¼Œå¦‚æœæ¶‰åŠåˆ°æ•°ç»„æ‰©å®¹çš„è¯ï¼ŒArrayList çš„æ€§èƒ½å°±æ²¡é‚£ä¹ˆå¯è§‚äº†ï¼Œå› ä¸ºæ‰©å®¹çš„æ—¶å€™ä¹Ÿè¦å¤åˆ¶æ•°ç»„ã€‚

### 04ã€åˆ é™¤å…ƒç´ æ—¶ç©¶ç«Ÿè°å¿«ï¼Ÿ

#### **1ï¼‰ArrayList**

ArrayList åˆ é™¤å…ƒç´ çš„æ—¶å€™ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ç›´æ¥åˆ é™¤å…ƒç´ ï¼ˆ`remove(Object)`ï¼‰ï¼Œéœ€è¦ç›´å…ˆéå†æ•°ç»„ï¼Œæ‰¾åˆ°å…ƒç´ å¯¹åº”çš„ç´¢å¼•ï¼›ä¸€ç§æ˜¯æŒ‰ç…§ç´¢å¼•åˆ é™¤å…ƒç´ ï¼ˆ`remove(int)`ï¼‰ã€‚

æ¥çœ‹ä¸€ä¸‹æºç ï¼ˆå…¶å®å‰é¢ä¹Ÿè®²è¿‡äº†ï¼Œè¿™é‡Œæ¸©ä¹ ä¸€ä¸‹ï¼‰ï¼š

```java
public boolean remove(Object o) {
    final Object[] es = elementData; // è·å–æ•°ç»„å…ƒç´ 
    final int size = this.size; // è·å–æ•°ç»„å¤§å°
    int i = 0;
    found: {
        if (o == null) {
            for (; i < size; i++)
                if (es[i] == null)
                    break found;
        } else {
            for (; i < size; i++)
                if (o.equals(es[i]))
                    break found;
        }
        return false;
    }
    fastRemove(es, i); // è°ƒç”¨ fastRemove æ–¹æ³•å¿«é€Ÿç§»é™¤å…ƒç´ 
    return true;
}

public E remove(int index) {
    Objects.checkIndex(index, size); // æ£€æŸ¥ç´¢å¼•æ˜¯å¦è¶Šç•Œ
    final Object[] es = elementData; // è·å–æ•°ç»„å…ƒç´ 

    oldValue = (E) es[index]; // è·å–è¦åˆ é™¤çš„å…ƒç´ 
    fastRemove(es, index); // è°ƒç”¨ fastRemove æ–¹æ³•å¿«é€Ÿç§»é™¤å…ƒç´ 

    return oldValue; // è¿”å›è¢«åˆ é™¤çš„å…ƒç´ 
}
```

æœ¬è´¨ä¸Šè®²ï¼Œä¸¤ä¸ªæ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œå®ƒä»¬æœ€åè°ƒç”¨çš„éƒ½æ˜¯ `fastRemove(Object, int)` æ–¹æ³•ã€‚

```java
private void fastRemove(Object[] es, int i) {
    final int newSize;
    if ((newSize = size - 1) > i) // å¦‚æœè¦åˆ é™¤çš„ä¸æ˜¯æœ€åä¸€ä¸ªå…ƒç´ 
        System.arraycopy(es, i + 1, es, i, newSize - i); // å°†è¦åˆ é™¤å…ƒç´ åé¢çš„å…ƒç´ å‘å‰ç§»åŠ¨ä¸€ä½
    es[size = newSize] = null; // å°†æœ€åä¸€ä¸ªå…ƒç´ ç½®ä¸º nullï¼Œå¸®åŠ©åƒåœ¾å›æ”¶
}
```

ä»æºç å¯ä»¥çœ‹å¾—å‡ºï¼Œåªè¦åˆ é™¤çš„ä¸æ˜¯æœ€åä¸€ä¸ªå…ƒç´ ï¼Œéƒ½éœ€è¦é‡æ–°ç§»åŠ¨æ•°ç»„ã€‚åˆ é™¤çš„å…ƒç´ ä½ç½®è¶Šé å‰ï¼Œä»£ä»·å°±è¶Šå¤§ã€‚

#### **2ï¼‰LinkedList**

LinkedList åˆ é™¤å…ƒç´ çš„æ—¶å€™ï¼Œæœ‰å››ç§å¸¸ç”¨çš„æ–¹å¼ï¼š

- `remove(int)`ï¼Œåˆ é™¤æŒ‡å®šä½ç½®ä¸Šçš„å…ƒç´ 

```java
public E remove(int index) {
    checkElementIndex(index);
    return unlink(node(index));
}
```

å…ˆæ£€æŸ¥ç´¢å¼•ï¼Œå†è°ƒç”¨ `node(int)` æ–¹æ³•ï¼ˆ å‰ååŠæ®µéå†ï¼Œå’Œæ–°å¢å…ƒç´ æ“ä½œä¸€æ ·ï¼‰æ‰¾åˆ°èŠ‚ç‚¹ Nodeï¼Œç„¶åè°ƒç”¨ `unlink(Node)` è§£é™¤èŠ‚ç‚¹çš„å‰åå¼•ç”¨ï¼ŒåŒæ—¶æ›´æ–°å‰èŠ‚ç‚¹çš„åå¼•ç”¨å’ŒåèŠ‚ç‚¹çš„å‰å¼•ç”¨ï¼š

```java
E unlink(Node<E> x) {
    final E element = x.item; // è·å–è¦åˆ é™¤çš„èŠ‚ç‚¹çš„å…ƒç´ 
    final Node<E> next = x.next; // è·å–è¦åˆ é™¤çš„èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹
    final Node<E> prev = x.prev; // è·å–è¦åˆ é™¤çš„èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹

    if (prev == null) { // å¦‚æœè¦åˆ é™¤çš„èŠ‚ç‚¹æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
        first = next; // å°†å¤´èŠ‚ç‚¹æ›´æ–°ä¸ºè¦åˆ é™¤çš„èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹
    } else {
        prev.next = next; // å°†è¦åˆ é™¤çš„èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹æŒ‡å‘è¦åˆ é™¤çš„èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹
        x.prev = null; // å°†è¦åˆ é™¤çš„èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹ç½®ä¸º nullï¼Œå¸®åŠ©åƒåœ¾å›æ”¶
    }

    if (next == null) { // å¦‚æœè¦åˆ é™¤çš„èŠ‚ç‚¹æ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹
        last = prev; // å°†å°¾èŠ‚ç‚¹æ›´æ–°ä¸ºè¦åˆ é™¤çš„èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹
    } else {
        next.prev = prev; // å°†è¦åˆ é™¤çš„èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æŒ‡å‘è¦åˆ é™¤çš„èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹
        x.next = null; // å°†è¦åˆ é™¤çš„èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ç½®ä¸º nullï¼Œå¸®åŠ©åƒåœ¾å›æ”¶
    }

    x.item = null; // å°†è¦åˆ é™¤çš„èŠ‚ç‚¹çš„å…ƒç´ ç½®ä¸º nullï¼Œå¸®åŠ©åƒåœ¾å›æ”¶
    size--; // å°†é“¾è¡¨çš„é•¿åº¦å‡ä¸€
    return element; // è¿”å›è¢«åˆ é™¤çš„å…ƒç´ 
}
```

- `remove(Object)`ï¼Œç›´æ¥åˆ é™¤å…ƒç´ 

```java
public boolean remove(Object o) {
    if (o == null) { // å¦‚æœè¦åˆ é™¤çš„å…ƒç´ ä¸º null
        for (LinkedList.Node<E> x = first; x != null; x = x.next) {
            if (x.item == null) { // å¦‚æœæ‰¾åˆ°äº†è¦åˆ é™¤çš„èŠ‚ç‚¹
                unlink(x); // è°ƒç”¨ unlink æ–¹æ³•åˆ é™¤æŒ‡å®šèŠ‚ç‚¹
                return true; // è¿”å›åˆ é™¤æˆåŠŸ
            }
        }
    } else {
        for (LinkedList.Node<E> x = first; x != null; x = x.next) {
            if (o.equals(x.item)) { // å¦‚æœæ‰¾åˆ°äº†è¦åˆ é™¤çš„èŠ‚ç‚¹
                unlink(x); // è°ƒç”¨ unlink æ–¹æ³•åˆ é™¤æŒ‡å®šèŠ‚ç‚¹
                return true; // è¿”å›åˆ é™¤æˆåŠŸ
            }
        }
    }
    return false; // æ²¡æœ‰æ‰¾åˆ°è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œè¿”å›åˆ é™¤å¤±è´¥
}
```

ä¹Ÿæ˜¯å…ˆå‰ååŠæ®µéå†ï¼Œæ‰¾åˆ°è¦åˆ é™¤çš„å…ƒç´ åè°ƒç”¨ `unlink(Node)`ã€‚

- `removeFirst()`ï¼Œåˆ é™¤ç¬¬ä¸€ä¸ªèŠ‚ç‚¹

```java
public E removeFirst() {
    final LinkedList.Node<E> f = first;
    if (f == null)
        throw new NoSuchElementException();
    return unlinkFirst(f);
}

private E unlinkFirst(LinkedList.Node<E> f) {
    final E element = f.item; // è·å–è¦åˆ é™¤çš„èŠ‚ç‚¹çš„å…ƒç´ 
    final LinkedList.Node<E> next = f.next; // è·å–è¦åˆ é™¤çš„èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹
    f.item = null; // å°†è¦åˆ é™¤çš„èŠ‚ç‚¹çš„å…ƒç´ ç½®ä¸º nullï¼Œå¸®åŠ©åƒåœ¾å›æ”¶
    f.next = null; // å°†è¦åˆ é™¤çš„èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ç½®ä¸º nullï¼Œå¸®åŠ©åƒåœ¾å›æ”¶
    first = next; // å°†å¤´èŠ‚ç‚¹æ›´æ–°ä¸ºè¦åˆ é™¤çš„èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹
    if (next == null) // å¦‚æœé“¾è¡¨å·²ç»ä¸ºç©º
        last = null; // å°†å°¾èŠ‚ç‚¹ç½®ä¸º null
    else
        next.prev = null; // å°†è¦åˆ é™¤çš„èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹ç½®ä¸º nullï¼Œå¸®åŠ©åƒåœ¾å›æ”¶
    size--; // å°†é“¾è¡¨çš„é•¿åº¦å‡ä¸€
    return element; // è¿”å›è¢«åˆ é™¤çš„å…ƒç´ 
}
```

åˆ é™¤ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å°±ä¸éœ€è¦éå†äº†ï¼Œåªéœ€è¦æŠŠç¬¬äºŒä¸ªèŠ‚ç‚¹æ›´æ–°ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹å³å¯ã€‚

- `removeLast()`ï¼Œåˆ é™¤æœ€åä¸€ä¸ªèŠ‚ç‚¹

åˆ é™¤æœ€åä¸€ä¸ªèŠ‚ç‚¹å’Œåˆ é™¤ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ç±»ä¼¼ï¼Œåªéœ€è¦æŠŠå€’æ•°ç¬¬äºŒä¸ªèŠ‚ç‚¹æ›´æ–°ä¸ºæœ€åä¸€ä¸ªèŠ‚ç‚¹å³å¯ã€‚

å¯ä»¥çœ‹å¾—å‡ºï¼ŒLinkedList åœ¨åˆ é™¤æ¯”è¾ƒé å‰å’Œæ¯”è¾ƒé åçš„å…ƒç´ æ—¶ï¼Œéå¸¸é«˜æ•ˆï¼Œä½†å¦‚æœåˆ é™¤çš„æ˜¯ä¸­é—´ä½ç½®çš„å…ƒç´ ï¼Œæ•ˆç‡å°±æ¯”è¾ƒä½äº†ã€‚

è¿™é‡Œå°±ä¸å†åšä»£ç æµ‹è¯•äº†ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥è‡ªå·±è¯•è¯•ï¼Œç»“æœå’Œæ–°å¢å…ƒç´ ä¿æŒä¸€è‡´ï¼š

- ä»é›†åˆå¤´éƒ¨åˆ é™¤å…ƒç´ æ—¶ï¼ŒArrayList èŠ±è´¹çš„æ—¶é—´æ¯” LinkedList å¤šå¾ˆå¤šï¼›
- ä»é›†åˆä¸­é—´ä½ç½®åˆ é™¤å…ƒç´ æ—¶ï¼ŒArrayList èŠ±è´¹çš„æ—¶é—´æ¯” LinkedList å°‘å¾ˆå¤šï¼›
- ä»é›†åˆå°¾éƒ¨åˆ é™¤å…ƒç´ æ—¶ï¼ŒArrayList èŠ±è´¹çš„æ—¶é—´æ¯” LinkedList å°‘ä¸€ç‚¹ã€‚

æˆ‘æœ¬åœ°çš„ç»Ÿè®¡ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼Œå¯ä»¥ä½œä¸ºå‚è€ƒï¼š

```
ArrayListä»é›†åˆå¤´éƒ¨ä½ç½®åˆ é™¤å…ƒç´ èŠ±è´¹çš„æ—¶é—´380
LinkedListä»é›†åˆå¤´éƒ¨ä½ç½®åˆ é™¤å…ƒç´ èŠ±è´¹çš„æ—¶é—´4
ArrayListä»é›†åˆä¸­é—´ä½ç½®åˆ é™¤å…ƒç´ èŠ±è´¹çš„æ—¶é—´381
LinkedListä»é›†åˆä¸­é—´ä½ç½®åˆ é™¤å…ƒç´ èŠ±è´¹çš„æ—¶é—´5922
ArrayListä»é›†åˆå°¾éƒ¨ä½ç½®åˆ é™¤å…ƒç´ èŠ±è´¹çš„æ—¶é—´8
LinkedListä»é›†åˆå°¾éƒ¨ä½ç½®åˆ é™¤å…ƒç´ èŠ±è´¹çš„æ—¶é—´12
```

### 05ã€éå†å…ƒç´ æ—¶ç©¶ç«Ÿè°å¿«ï¼Ÿ

#### **1ï¼‰ArrayList**

éå† ArrayList æ‰¾åˆ°æŸä¸ªå…ƒç´ çš„è¯ï¼Œé€šå¸¸æœ‰ä¸¤ç§å½¢å¼ï¼š

- `get(int)`ï¼Œæ ¹æ®ç´¢å¼•æ‰¾å…ƒç´ 

```java
public E get(int index) {
    Objects.checkIndex(index, size);
    return elementData(index);
}
```

ç”±äº ArrayList æ˜¯ç”±æ•°ç»„å®ç°çš„ï¼Œæ‰€ä»¥æ ¹æ®ç´¢å¼•æ‰¾å…ƒç´ éå¸¸çš„å¿«ï¼Œä¸€æ­¥åˆ°ä½ã€‚

- `indexOf(Object)`ï¼Œæ ¹æ®å…ƒç´ æ‰¾ç´¢å¼•

```java
public int indexOf(Object o) {
    return indexOfRange(o, 0, size);
}

int indexOfRange(Object o, int start, int end) {
    Object[] es = elementData; // è·å– ArrayList ä¸­çš„å…ƒç´ æ•°ç»„
    if (o == null) { // å¦‚æœè¦æŸ¥æ‰¾çš„å…ƒç´ ä¸º null
        for (int i = start; i < end; i++) {
            if (es[i] == null) { // å¦‚æœæ‰¾åˆ°äº†è¦æŸ¥æ‰¾çš„å…ƒç´ 
                return i; // è¿”å›å…ƒç´ åœ¨ ArrayList ä¸­çš„ç´¢å¼•
            }
        }
    } else {
        for (int i = start; i < end; i++) {
            if (o.equals(es[i])) { // å¦‚æœæ‰¾åˆ°äº†è¦æŸ¥æ‰¾çš„å…ƒç´ 
                return i; // è¿”å›å…ƒç´ åœ¨ ArrayList ä¸­çš„ç´¢å¼•
            }
        }
    }
    return -1; // æ²¡æœ‰æ‰¾åˆ°è¦æŸ¥æ‰¾çš„å…ƒç´ ï¼Œè¿”å› -1
}
```

æ ¹æ®å…ƒç´ æ‰¾ç´¢å¼•çš„è¯ï¼Œå°±éœ€è¦éå†æ•´ä¸ªæ•°ç»„äº†ï¼Œä»å¤´åˆ°å°¾ä¾æ¬¡æ‰¾ã€‚


#### **2ï¼‰LinkedList**

éå† LinkedList æ‰¾åˆ°æŸä¸ªå…ƒç´ çš„è¯ï¼Œé€šå¸¸ä¹Ÿæœ‰ä¸¤ç§å½¢å¼ï¼š

- `get(int)`ï¼Œæ‰¾æŒ‡å®šä½ç½®ä¸Šçš„å…ƒç´ 

```java
public E get(int index) {
    checkElementIndex(index);
    return node(index).item;
}
```

æ—¢ç„¶éœ€è¦è°ƒç”¨ `node(int)` æ–¹æ³•ï¼Œå°±æ„å‘³ç€éœ€è¦å‰ååŠæ®µéå†äº†ã€‚

- `indexOf(Object)`ï¼Œæ‰¾å…ƒç´ æ‰€åœ¨çš„ä½ç½®

```java
public int indexOf(Object o) {
    int index = 0; // åˆå§‹åŒ–ç´¢å¼•ä¸º 0
    if (o == null) { // å¦‚æœè¦æŸ¥æ‰¾çš„å…ƒç´ ä¸º null
        for (LinkedList.Node<E> x = first; x != null; x = x.next) { // ä»å¤´èŠ‚ç‚¹å¼€å§‹éå†é“¾è¡¨
            if (x.item == null) // å¦‚æœæ‰¾åˆ°äº†è¦æŸ¥æ‰¾çš„å…ƒç´ 
                return index; // è¿”å›å…ƒç´ åœ¨ LinkedList ä¸­çš„ç´¢å¼•
            index++; // ç´¢å¼•åŠ ä¸€
        }
    } else {
        for (LinkedList.Node<E> x = first; x != null; x = x.next) { // ä»å¤´èŠ‚ç‚¹å¼€å§‹éå†é“¾è¡¨
            if (o.equals(x.item)) // å¦‚æœæ‰¾åˆ°äº†è¦æŸ¥æ‰¾çš„å…ƒç´ 
                return index; // è¿”å›å…ƒç´ åœ¨ LinkedList ä¸­çš„ç´¢å¼•
            index++; // ç´¢å¼•åŠ ä¸€
        }
    }
    return -1; // æ²¡æœ‰æ‰¾åˆ°è¦æŸ¥æ‰¾çš„å…ƒç´ ï¼Œè¿”å› -1
}
```

éœ€è¦éå†æ•´ä¸ªé“¾è¡¨ï¼Œå’Œ ArrayList çš„ `indexOf()` ç±»ä¼¼ã€‚

é‚£åœ¨æˆ‘ä»¬å¯¹é›†åˆéå†çš„æ—¶å€™ï¼Œé€šå¸¸æœ‰ä¸¤ç§åšæ³•ï¼Œä¸€ç§æ˜¯ä½¿ç”¨ for å¾ªç¯ï¼Œä¸€ç§æ˜¯ä½¿ç”¨[è¿­ä»£å™¨ï¼ˆIteratorï¼‰](https://tobebetterjavaer.com/collection/iterator-iterable.html)ã€‚

å¦‚æœä½¿ç”¨çš„æ˜¯ for å¾ªç¯ï¼Œå¯æƒ³è€ŒçŸ¥ LinkedList åœ¨ get çš„æ—¶å€™æ€§èƒ½ä¼šéå¸¸å·®ï¼Œå› ä¸ºæ¯ä¸€æ¬¡å¤–å±‚çš„ for å¾ªç¯ï¼Œéƒ½è¦æ‰§è¡Œä¸€æ¬¡ `node(int)` æ–¹æ³•è¿›è¡Œå‰ååŠæ®µçš„éå†ã€‚

```java
LinkedList.Node<E> node(int index) {
    // assert isElementIndex(index);

    if (index < (size >> 1)) { // å¦‚æœè¦æŸ¥æ‰¾çš„å…ƒç´ åœ¨é“¾è¡¨çš„å‰åŠéƒ¨åˆ†
        LinkedList.Node<E> x = first; // ä»å¤´èŠ‚ç‚¹å¼€å§‹éå†é“¾è¡¨
        for (int i = 0; i < index; i++) // å¾ªç¯æŸ¥æ‰¾å…ƒç´ 
            x = x.next;
        return x; // è¿”å›è¦æŸ¥æ‰¾çš„å…ƒç´ èŠ‚ç‚¹
    } else { // å¦‚æœè¦æŸ¥æ‰¾çš„å…ƒç´ åœ¨é“¾è¡¨çš„ååŠéƒ¨åˆ†
        LinkedList.Node<E> x = last; // ä»å°¾èŠ‚ç‚¹å¼€å§‹éå†é“¾è¡¨
        for (int i = size - 1; i > index; i--) // å¾ªç¯æŸ¥æ‰¾å…ƒç´ 
            x = x.prev;
        return x; // è¿”å›è¦æŸ¥æ‰¾çš„å…ƒç´ èŠ‚ç‚¹
    }
}
```

é‚£å¦‚æœä½¿ç”¨çš„æ˜¯è¿­ä»£å™¨å‘¢ï¼Ÿ

```java
LinkedList<String> list = new LinkedList<String>();
for (Iterator<String> it = list.iterator(); it.hasNext();) {
    it.next();
}
```

è¿­ä»£å™¨åªä¼šè°ƒç”¨ä¸€æ¬¡ `node(int)` æ–¹æ³•ï¼Œåœ¨æ‰§è¡Œ `list.iterator()` çš„æ—¶å€™ï¼šå…ˆè°ƒç”¨ AbstractSequentialList ç±»çš„ `iterator()` æ–¹æ³•ï¼Œå†è°ƒç”¨ AbstractList ç±»çš„ `listIterator()` æ–¹æ³•ï¼Œå†è°ƒç”¨ LinkedList ç±»çš„ `listIterator(int)` æ–¹æ³•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/list-war-2-04.png)

æœ€åè¿”å›çš„æ˜¯ LinkedList ç±»çš„å†…éƒ¨ç§æœ‰ç±» ListItr å¯¹è±¡ï¼š

```java
public ListIterator<E> listIterator(int index) {
    checkPositionIndex(index); // æ£€æŸ¥ç´¢å¼•æ˜¯å¦åœ¨æœ‰æ•ˆèŒƒå›´å†…
    return new LinkedList.ListItr(index); // åˆ›å»ºä¸€ä¸ªæ–°çš„ ListItr å¯¹è±¡å¹¶è¿”å›
}

private class ListItr implements ListIterator<E> {
    private LinkedList.Node<E> lastReturned; // ä¸Šä¸€ä¸ªå·²è¿”å›çš„èŠ‚ç‚¹
    private LinkedList.Node<E> next; // ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
    private int nextIndex; // ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„ç´¢å¼•
    private int expectedModCount = modCount; // é“¾è¡¨è¢«ä¿®æ”¹çš„æ¬¡æ•°

    ListItr(int index) {
        // assert isPositionIndex(index);
        next = (index == size) ? null : node(index); // å¦‚æœ index ç­‰äº sizeï¼Œnext ä¸º nullï¼Œå¦åˆ™è¿”å› node(index)
        nextIndex = index; // è®¾ç½® nextIndex ä¸º index
    }

    public boolean hasNext() {
        return nextIndex < size; // å¦‚æœä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„ç´¢å¼•å°äºé“¾è¡¨çš„é•¿åº¦ï¼Œè¿”å› trueï¼Œå¦åˆ™è¿”å› false
    }

    public E next() {
        checkForComodification(); // æ£€æŸ¥é“¾è¡¨æ˜¯å¦å·²ç»è¢«ä¿®æ”¹
        if (!hasNext()) // å¦‚æœæ²¡æœ‰ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒæŠ›å‡º NoSuchElementException å¼‚å¸¸
            throw new NoSuchElementException();

        lastReturned = next; // å°†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹è®¾ç½®ä¸ºä¸Šä¸€ä¸ªå·²è¿”å›èŠ‚ç‚¹
        next = next.next; // å°†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹è®¾ç½®ä¸ºå½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
        nextIndex++; // å°†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„ç´¢å¼•å¢åŠ  1
        return lastReturned.item; // è¿”å›ä¸Šä¸€ä¸ªå·²è¿”å›èŠ‚ç‚¹çš„å…ƒç´ 
    }
}
```

æ‰§è¡Œ ListItr çš„æ„é€ æ–¹æ³•æ—¶è°ƒç”¨äº†ä¸€æ¬¡ `node(int)` æ–¹æ³•ï¼Œè¿”å›ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚åœ¨æ­¤ä¹‹åï¼Œè¿­ä»£å™¨å°±æ‰§è¡Œ `hasNext()` åˆ¤æ–­æœ‰æ²¡æœ‰ä¸‹ä¸€ä¸ªï¼Œæ‰§è¡Œ `next()` æ–¹æ³•ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚

ç”±æ­¤ï¼Œå¯ä»¥å¾—å‡ºè¿™æ ·çš„ç»“è®ºï¼š**éå† LinkedList çš„æ—¶å€™ï¼Œåƒä¸‡ä¸è¦ä½¿ç”¨ for å¾ªç¯ï¼Œè¦ä½¿ç”¨è¿­ä»£å™¨ã€‚**

ä¹Ÿå°±æ˜¯è¯´ï¼Œfor å¾ªç¯éå†çš„æ—¶å€™ï¼ŒArrayList èŠ±è´¹çš„æ—¶é—´è¿œå°äº LinkedListï¼›è¿­ä»£å™¨éå†çš„æ—¶å€™ï¼Œä¸¤è€…æ€§èƒ½å·®ä¸å¤šã€‚

### 06ã€ä¸¤è€…çš„ä½¿ç”¨åœºæ™¯

å½“éœ€è¦é¢‘ç¹éšæœºè®¿é—®å…ƒç´ çš„æ—¶å€™ï¼Œä¾‹å¦‚è¯»å–å¤§é‡æ•°æ®å¹¶è¿›è¡Œå¤„ç†æˆ–è€…éœ€è¦å¯¹æ•°æ®è¿›è¡Œæ’åºæˆ–æŸ¥æ‰¾çš„åœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨ ArrayListã€‚ä¾‹å¦‚ä¸€ä¸ªå­¦ç”Ÿç®¡ç†ç³»ç»Ÿï¼Œéœ€è¦å¯¹å­¦ç”Ÿåˆ—è¡¨è¿›è¡Œæ’åºæˆ–æŸ¥æ‰¾æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ ArrayList å­˜å‚¨å­¦ç”Ÿä¿¡æ¯ï¼Œä»¥ä¾¿å¿«é€Ÿè®¿é—®å’Œå¤„ç†ã€‚

å½“éœ€è¦é¢‘ç¹æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶å€™ï¼Œä¾‹å¦‚å®ç°é˜Ÿåˆ—æˆ–æ ˆï¼Œæˆ–è€…éœ€è¦åœ¨ä¸­é—´æ’å…¥æˆ–åˆ é™¤å…ƒç´ çš„åœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨ LinkedListã€‚ä¾‹å¦‚ä¸€ä¸ªå®æ—¶èŠå¤©ç³»ç»Ÿï¼Œéœ€è¦å®ç°ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¯ä»¥ä½¿ç”¨ LinkedList å­˜å‚¨æ¶ˆæ¯ï¼Œä»¥ä¾¿å¿«é€Ÿæ’å…¥å’Œåˆ é™¤æ¶ˆæ¯ã€‚

åœ¨ä¸€äº›ç‰¹æ®Šåœºæ™¯ä¸‹ï¼Œå¯èƒ½éœ€è¦åŒæ—¶æ”¯æŒéšæœºè®¿é—®å’Œæ’å…¥/åˆ é™¤æ“ä½œã€‚ä¾‹å¦‚ä¸€ä¸ªåœ¨çº¿æ¸¸æˆç³»ç»Ÿï¼Œéœ€è¦å®ç°ä¸€ä¸ªç©å®¶åˆ—è¡¨ï¼Œéœ€è¦æ”¯æŒå¿«é€ŸæŸ¥æ‰¾å’Œéå†ç©å®¶ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦æ”¯æŒç©å®¶çš„åŠ å…¥å’Œç¦»å¼€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ LinkedList å’Œ ArrayList çš„ç»„åˆï¼Œä¾‹å¦‚ä½¿ç”¨ LinkedList å­˜å‚¨ç©å®¶ï¼Œä»¥ä¾¿å¿«é€Ÿæ’å…¥å’Œåˆ é™¤ç©å®¶ï¼ŒåŒæ—¶ä½¿ç”¨ ArrayList å­˜å‚¨ç©å®¶åˆ—è¡¨ï¼Œä»¥ä¾¿å¿«é€ŸæŸ¥æ‰¾å’Œéå†ç©å®¶ã€‚

â€œå¥½äº†ï¼Œä¸‰å¦¹ï¼Œå…³äº LinkedList å’Œ ArrayList çš„å·®åˆ«ï¼Œæˆ‘ä»¬å°±å…ˆèŠåˆ°è¿™ï¼Œä½ ä¹Ÿä¸ç”¨å¤ªå»æ‰£ç»†èŠ‚ï¼Œç›´åˆ°å…¶ä¸­çš„å·®åˆ«å°±å¥½äº†ã€‚â€

â€œå¥½çš„ï¼ŒäºŒå“¥ã€‚â€

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 6.6 Javaæ³›å‹ï¼Œæ·±å…¥è§£æ

â€œäºŒå“¥ï¼Œä¸ºä»€ä¹ˆè¦è®¾è®¡æ³›å‹å•Šï¼Ÿâ€ä¸‰å¦¹å¼€é—¨è§å±±åœ°é—®ã€‚

â€œä¸‰å¦¹å•Šï¼Œå¬å“¥æ…¢æ…¢ç»™ä½ è®²å•Šã€‚â€æˆ‘è¯´ã€‚

Java åœ¨ 1.5 æ—¶å¢åŠ äº†æ³›å‹æœºåˆ¶ï¼Œæ®è¯´ä¸“å®¶ä»¬ä¸ºæ­¤èŠ±è´¹äº† 5 å¹´å·¦å³çš„æ—¶é—´ï¼ˆå¬èµ·æ¥æ˜¯ç›¸å½“ä¸å®¹æ˜“ï¼‰ã€‚æœ‰äº†æ³›å‹ä¹‹åï¼Œå°¤å…¶æ˜¯å¯¹é›†åˆç±»çš„ä½¿ç”¨ï¼Œå°±å˜å¾—æ›´è§„èŒƒäº†ã€‚

çœ‹ä¸‹é¢è¿™æ®µç®€å•çš„ä»£ç ã€‚

```java
ArrayList<String> list = new ArrayList<String>();
list.add("æ²‰é»˜ç‹äºŒ");
String str = list.get(0);
```

â€œä¸‰å¦¹ï¼Œä½ èƒ½æƒ³è±¡åˆ°åœ¨æ²¡æœ‰æ³›å‹ä¹‹å‰è¯¥æ€ä¹ˆåŠå—ï¼Ÿâ€

â€œå—¯ï¼Œæƒ³ä¸åˆ°ï¼Œè¿˜æ˜¯äºŒå“¥ä½ è¯´å§ã€‚â€

å—¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Object æ•°ç»„æ¥è®¾è®¡ `Arraylist` ç±»ã€‚

```java
class Arraylist {
    private Object[] objs;
    private int i = 0;
    public void add(Object obj) {
        objs[i++] = obj;
    }
    
    public Object get(int i) {
        return objs[i];
    }
}
```

ç„¶åï¼Œæˆ‘ä»¬å‘ `Arraylist` ä¸­å­˜å–æ•°æ®ã€‚

```java
Arraylist list = new Arraylist();
list.add("æ²‰é»˜ç‹äºŒ");
list.add(new Date());
String str = (String)list.get(0);
```

â€œä¸‰å¦¹ï¼Œä½ æœ‰æ²¡æœ‰å‘ç°è¿™ä¸¤ä¸ªé—®é¢˜ï¼Ÿâ€

- Arraylist å¯ä»¥å­˜æ”¾ä»»ä½•ç±»å‹çš„æ•°æ®ï¼ˆæ—¢å¯ä»¥å­˜å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ··å…¥æ—¥æœŸï¼‰ï¼Œå› ä¸ºæ‰€æœ‰ç±»éƒ½ç»§æ‰¿è‡ª Object ç±»ã€‚
- ä» Arraylist å–å‡ºæ•°æ®çš„æ—¶å€™éœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œå› ä¸ºç¼–è¯‘å™¨å¹¶ä¸èƒ½ç¡®å®šä½ å–çš„æ˜¯å­—ç¬¦ä¸²è¿˜æ˜¯æ—¥æœŸã€‚

â€œå—¯å—¯ï¼Œæ˜¯çš„å‘¢ã€‚â€ä¸‰å¦¹è¯´ã€‚

å¯¹æ¯”ä¸€ä¸‹ï¼Œä½ å°±èƒ½æ˜æ˜¾åœ°æ„Ÿå—åˆ°æ³›å‹çš„ä¼˜ç§€ä¹‹å¤„ï¼šä½¿ç”¨**ç±»å‹å‚æ•°**è§£å†³äº†å…ƒç´ çš„ä¸ç¡®å®šæ€§â€”â€”å‚æ•°ç±»å‹ä¸º String çš„é›†åˆä¸­æ˜¯ä¸å…è®¸å­˜æ”¾å…¶ä»–ç±»å‹å…ƒç´ çš„ï¼Œå–å‡ºæ•°æ®çš„æ—¶å€™ä¹Ÿä¸éœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢äº†ã€‚

### åŠ¨æ‰‹è®¾è®¡ä¸€ä¸ªæ³›å‹

â€œäºŒå“¥ï¼Œé‚£æ€ä¹ˆæ‰èƒ½è®¾è®¡ä¸€ä¸ªæ³›å‹å‘¢ï¼Ÿâ€

â€œä¸‰å¦¹å•Šï¼Œä½ ä¸€ä¸ªå°ç™½åªè¦ä¼šç”¨æ³›å‹å°±è¡Œäº†ï¼Œè¿˜æƒ³è®¾è®¡æ³›å‹å•Šï¼Ÿï¼ä¸è¿‡ï¼Œæ—¢ç„¶ä½ æƒ³äº†è§£ï¼Œå“¥ä¹‰ä¸å®¹è¾ã€‚â€

é¦–å…ˆï¼Œæˆ‘ä»¬æ¥æŒ‰ç…§æ³›å‹çš„æ ‡å‡†é‡æ–°è®¾è®¡ä¸€ä¸‹ `Arraylist` ç±»ã€‚

```java
class Arraylist<E> {
    private Object[] elementData;
    private int size = 0;

    public Arraylist(int initialCapacity) {
        this.elementData = new Object[initialCapacity];
    }
    
    public boolean add(E e) {
        elementData[size++] = e;
        return true;
    }
    
    E elementData(int index) {
        return (E) elementData[index];
    }
}
```

ä¸€ä¸ªæ³›å‹ç±»å°±æ˜¯å…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç±»å‹å˜é‡çš„ç±»ã€‚Arraylist ç±»å¼•å…¥çš„ç±»å‹å˜é‡ä¸º Eï¼ˆElementï¼Œå…ƒç´ çš„é¦–å­—æ¯ï¼‰ï¼Œä½¿ç”¨å°–æ‹¬å· `<>` æ‹¬èµ·æ¥ï¼Œæ”¾åœ¨ç±»åçš„åé¢ã€‚

ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å…·ä½“çš„ç±»å‹ï¼ˆæ¯”å¦‚å­—ç¬¦ä¸²ï¼‰æ›¿æ¢ç±»å‹å˜é‡æ¥å®ä¾‹åŒ–æ³›å‹ç±»ã€‚

```java
Arraylist<String> list = new Arraylist<String>();
list.add("æ²‰é»˜ç‹ä¸‰");
String str = list.get(0);
```

Date ç±»å‹ä¹Ÿå¯ä»¥çš„ã€‚

```java
Arraylist<Date> list = new Arraylist<Date>();
list.add(new Date());
Date date = list.get(0);
```

å…¶æ¬¡ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨ä¸€ä¸ªéæ³›å‹çš„ç±»ï¼ˆæˆ–è€…æ³›å‹ç±»ï¼‰ä¸­å®šä¹‰æ³›å‹æ–¹æ³•ã€‚

```java
class Arraylist<E> {
    public <T> T[] toArray(T[] a) {
        return (T[]) Arrays.copyOf(elementData, size, a.getClass());
    }
}
```

ä¸è¿‡ï¼Œè¯´å®è¯ï¼Œæ³›å‹æ–¹æ³•çš„å®šä¹‰çœ‹èµ·æ¥ç•¥æ˜¾æ™¦æ¶©ã€‚æ¥ä¸€å‰¯å›¾å§ï¼ˆæ³¨æ„ï¼šæ–¹æ³•è¿”å›ç±»å‹å’Œæ–¹æ³•å‚æ•°ç±»å‹è‡³å°‘éœ€è¦ä¸€ä¸ªï¼‰ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/generic/generic-01.png)

ç°åœ¨ï¼Œæˆ‘ä»¬æ¥è°ƒç”¨ä¸€ä¸‹æ³›å‹æ–¹æ³•ã€‚

```java
Arraylist<String> list = new Arraylist<>(4);
list.add("æ²‰");
list.add("é»˜");
list.add("ç‹");
list.add("äºŒ");

String [] strs = new String [4];
strs = list.toArray(strs);

for (String str : strs) {
    System.out.println(str);
}
```

### æ³›å‹é™å®šç¬¦

ç„¶åï¼Œæˆ‘ä»¬å†æ¥è¯´è¯´æ³›å‹å˜é‡çš„é™å®šç¬¦ `extends`ã€‚

åœ¨è§£é‡Šè¿™ä¸ªé™å®šç¬¦ä¹‹å‰ï¼Œæˆ‘ä»¬å‡è®¾æœ‰ä¸‰ä¸ªç±»ï¼Œå®ƒä»¬ä¹‹é—´çš„å®šä¹‰æ˜¯è¿™æ ·çš„ã€‚

```java
class Wanglaoer {
    public String toString() {
        return "ç‹è€äºŒ";
    }
}

class Wanger extends Wanglaoer{
    public String toString() {
        return "ç‹äºŒ";
    }
}

class Wangxiaoer extends Wanger{
    public String toString() {
        return "ç‹å°äºŒ";
    }
}
```

æˆ‘ä»¬ä½¿ç”¨é™å®šç¬¦ `extends` æ¥é‡æ–°è®¾è®¡ä¸€ä¸‹ `Arraylist` ç±»ã€‚

```java
class Arraylist<E extends Wanger> {
}
```

å½“æˆ‘ä»¬å‘ `Arraylist` ä¸­æ·»åŠ  `Wanglaoer` å…ƒç´ çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¼šæç¤ºé”™è¯¯ï¼š`Arraylist` åªå…è®¸æ·»åŠ  `Wanger` åŠå…¶å­ç±» `Wangxiaoer` å¯¹è±¡ï¼Œä¸å…è®¸æ·»åŠ å…¶çˆ¶ç±» `Wanglaoer`ã€‚

```java
Arraylist<Wanger> list = new Arraylist<>(3);
list.add(new Wanger());
list.add(new Wanglaoer());
// The method add(Wanger) in the type Arraylist<Wanger> is not applicable for the arguments 
// (Wanglaoer)
list.add(new Wangxiaoer());
```

ä¹Ÿå°±æ˜¯è¯´ï¼Œé™å®šç¬¦ `extends` å¯ä»¥ç¼©å°æ³›å‹çš„ç±»å‹èŒƒå›´ã€‚

### ç±»å‹æ“¦é™¤

â€œå“¦ï¼Œæ˜ç™½äº†ã€‚â€ä¸‰å¦¹è‹¥æœ‰æ‰€æ€çš„ç‚¹ç‚¹å¤´ï¼Œâ€œäºŒå“¥ï¼Œå¬è¯´è™šæ‹Ÿæœºæ²¡æœ‰æ³›å‹ï¼Ÿâ€

â€œä¸‰å¦¹ï¼Œä½ åŠŸè¯¾åšå¾—å¯ä»¥å•Šã€‚å“¥å¯ä»¥è‚¯å®šåœ°å›ç­”ä½ ï¼Œè™šæ‹Ÿæœºæ˜¯æ²¡æœ‰æ³›å‹çš„ã€‚â€

â€œæ€ä¹ˆç¡®å®šè™šæ‹Ÿæœºæœ‰æ²¡æœ‰æ³›å‹å‘¢ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œåªè¦æˆ‘ä»¬æŠŠæ³›å‹ç±»çš„å­—èŠ‚ç è¿›è¡Œåç¼–è¯‘å°±çœ‹åˆ°äº†ï¼â€ç”¨åç¼–è¯‘å·¥å…·ï¼ˆæˆ‘å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ç”¨çš„æ˜¯ jadï¼Œä½ ä¹Ÿå¯ä»¥ç”¨å…¶ä»–çš„å·¥å…·ï¼‰å°† class æ–‡ä»¶åç¼–è¯‘åï¼Œæˆ‘è¯´ï¼Œâ€œä¸‰å¦¹ï¼Œä½ çœ‹ã€‚â€

```java
// Decompiled by Jad v1.5.8g. Copyright 2001 Pavel Kouznetsov.
// Jad home page: http://www.kpdus.com/jad.html
// Decompiler options: packimports(3) 
// Source File Name:   Arraylist.java

package com.cmower.java_demo.fanxing;

import java.util.Arrays;

class Arraylist
{

    public Arraylist(int initialCapacity)
    {
        size = 0;
        elementData = new Object[initialCapacity];
    }

    public boolean add(Object e)
    {
        elementData[size++] = e;
        return true;
    }

    Object elementData(int index)
    {
        return elementData[index];
    }

    private Object elementData[];
    private int size;
}
```

ç±»å‹å˜é‡ `<E>` æ¶ˆå¤±äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ Object ï¼

â€œæ—¢ç„¶å¦‚æ­¤ï¼Œé‚£å¦‚æœæ³›å‹ç±»ä½¿ç”¨äº†é™å®šç¬¦ `extends`ï¼Œç»“æœä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿâ€ä¸‰å¦¹è¿™ä¸ªé—®é¢˜é—®çš„å¾ˆå·§å¦™ã€‚

æ¥çœ‹è¿™æ®µä»£ç ã€‚

```java
class Arraylist2<E extends Wanger> {
    private Object[] elementData;
    private int size = 0;

    public Arraylist2(int initialCapacity) {
        this.elementData = new Object[initialCapacity];
    }

    public boolean add(E e) {
        elementData[size++] = e;
        return true;
    }

    E elementData(int index) {
        return (E) elementData[index];
    }
}
```

åç¼–è¯‘åçš„ç»“æœå¦‚ä¸‹ã€‚

```java
// Decompiled by Jad v1.5.8g. Copyright 2001 Pavel Kouznetsov.
// Jad home page: http://www.kpdus.com/jad.html
// Decompiler options: packimports(3) 
// Source File Name:   Arraylist2.java

package com.cmower.java_demo.fanxing;


// Referenced classes of package com.cmower.java_demo.fanxing:
//            Wanger

class Arraylist2
{

    public Arraylist2(int initialCapacity)
    {
        size = 0;
        elementData = new Object[initialCapacity];
    }

    public boolean add(Wanger e)
    {
        elementData[size++] = e;
        return true;
    }

    Wanger elementData(int index)
    {
        return (Wanger)elementData[index];
    }

    private Object elementData[];
    private int size;
}
```

â€œä½ çœ‹ï¼Œç±»å‹å˜é‡ `<E extends Wanger>` ä¸è§äº†ï¼ŒE è¢«æ›¿æ¢æˆäº† `Wanger`â€ï¼Œæˆ‘è¯´ï¼Œâ€œé€šè¿‡ä»¥ä¸Šä¸¤ä¸ªä¾‹å­è¯´æ˜ï¼ŒJava è™šæ‹Ÿæœºä¼šå°†æ³›å‹çš„ç±»å‹å˜é‡æ“¦é™¤ï¼Œå¹¶æ›¿æ¢ä¸ºé™å®šç±»å‹ï¼ˆæ²¡æœ‰é™å®šçš„è¯ï¼Œå°±ç”¨ `Object`ï¼‰â€

â€œäºŒå“¥ï¼Œç±»å‹æ“¦é™¤ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿâ€ä¸‰å¦¹åˆé—®äº†ä¸€ä¸ªå¾ˆæœ‰æ°´å¹³çš„é—®é¢˜ã€‚

â€œä¸‰å¦¹å•Šï¼Œä½ è¿˜åˆ«è¯´ï¼Œç±»å‹æ“¦é™¤çœŸçš„ä¼šæœ‰ä¸€äº›é—®é¢˜ã€‚â€æˆ‘è¯´ï¼Œâ€œæ¥çœ‹ä¸€ä¸‹è¿™æ®µä»£ç ã€‚â€

```java
public class Cmower {
    
    public static void method(Arraylist<String> list) {
        System.out.println("Arraylist<String> list");
    }

    public static void method(Arraylist<Date> list) {
        System.out.println("Arraylist<Date> list");
    }

}
```

åœ¨æµ…å±‚çš„æ„è¯†ä¸Šï¼Œæˆ‘ä»¬ä¼šæƒ³å½“ç„¶åœ°è®¤ä¸º `Arraylist<String> list` å’Œ `Arraylist<Date> list` æ˜¯ä¸¤ç§ä¸åŒçš„ç±»å‹ï¼Œå› ä¸º String å’Œ Date æ˜¯ä¸åŒçš„ç±»ã€‚

ä½†ç”±äºç±»å‹æ“¦é™¤çš„åŸå› ï¼Œä»¥ä¸Šä»£ç æ˜¯ä¸ä¼šé€šè¿‡ç¼–è¯‘çš„â€”â€”ç¼–è¯‘å™¨ä¼šæç¤ºä¸€ä¸ªé”™è¯¯ï¼ˆè¿™æ­£æ˜¯ç±»å‹æ“¦é™¤å¼•å‘çš„é‚£äº›â€œé—®é¢˜â€ï¼‰ï¼š

```
>Erasure of method method(Arraylist<String>) is the same as another method in type 
 Cmower
>
>Erasure of method method(Arraylist<Date>) is the same as another method in type 
 Cmower
```


å¤§è‡´çš„æ„æ€å°±æ˜¯ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•çš„å‚æ•°ç±»å‹åœ¨æ“¦é™¤åæ˜¯ç›¸åŒçš„ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œ`method(Arraylist<String> list)` å’Œ `method(Arraylist<Date> list)` æ˜¯åŒä¸€ç§å‚æ•°ç±»å‹çš„æ–¹æ³•ï¼Œä¸èƒ½åŒæ—¶å­˜åœ¨ã€‚ç±»å‹å˜é‡ `String` å’Œ `Date` åœ¨æ“¦é™¤åä¼šè‡ªåŠ¨æ¶ˆå¤±ï¼Œmethod æ–¹æ³•çš„å®é™…å‚æ•°æ˜¯ `Arraylist list`ã€‚

æœ‰å¥ä¿—è¯å«åšï¼šâ€œç™¾é—»ä¸å¦‚ä¸€è§â€ï¼Œä½†å³ä½¿è§åˆ°äº†ä¹Ÿæœªå¿…ä¸ºçœŸâ€”â€”æ³›å‹çš„æ“¦é™¤é—®é¢˜å°±å¯ä»¥å¾ˆå¥½åœ°ä½è¯è¿™ä¸ªè§‚ç‚¹ã€‚

### æ³›å‹é€šé…ç¬¦

â€œå“¦ï¼Œæ˜ç™½äº†ã€‚äºŒå“¥ï¼Œå¬è¯´æ³›å‹è¿˜æœ‰é€šé…ç¬¦ï¼Ÿâ€

â€œä¸‰å¦¹å•Šï¼Œå“¥çªç„¶è§‰å¾—ä½ å¾ˆé€‚åˆä½œä¸€æšå¯çˆ±çš„ç¨‹åºåª›å•Šï¼ä½ è¿™é¢„ä¹ çš„åŠŸè¯¾åšå¾—å¯çœŸåˆ°å®¶å•Šï¼Œè¿é€šé…ç¬¦éƒ½çŸ¥é“ï¼â€

é€šé…ç¬¦ä½¿ç”¨è‹±æ–‡çš„é—®å·`ï¼ˆ?ï¼‰`æ¥è¡¨ç¤ºã€‚åœ¨æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ³›å‹å¯¹è±¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å…³é”®å­— `extends` é™å®šå­ç±»ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…³é”®å­— `super` é™å®šçˆ¶ç±»ã€‚

æˆ‘ä»¬æ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ã€‚

```java
// å®šä¹‰ä¸€ä¸ªæ³›å‹ç±» Arraylist<E>ï¼ŒE è¡¨ç¤ºå…ƒç´ ç±»å‹
class Arraylist<E> {
    // ç§æœ‰æˆå‘˜å˜é‡ï¼Œå­˜å‚¨å…ƒç´ æ•°ç»„å’Œå…ƒç´ æ•°é‡
    private Object[] elementData;
    private int size = 0;

    // æ„é€ å‡½æ•°ï¼Œä¼ å…¥åˆå§‹å®¹é‡ initialCapacityï¼Œåˆ›å»ºä¸€ä¸ªæŒ‡å®šå®¹é‡çš„ Object æ•°ç»„
    public Arraylist(int initialCapacity) {
        this.elementData = new Object[initialCapacity];
    }

    // æ·»åŠ å…ƒç´ åˆ°æ•°ç»„æœ«å°¾ï¼Œè¿”å›æ·»åŠ æˆåŠŸä¸å¦
    public boolean add(E e) {
        elementData[size++] = e;
        return true;
    }

    // è·å–æŒ‡å®šä¸‹æ ‡çš„å…ƒç´ 
    public E get(int index) {
        return (E) elementData[index];
    }

    // æŸ¥æ‰¾æŒ‡å®šå…ƒç´ ç¬¬ä¸€æ¬¡å‡ºç°çš„ä¸‹æ ‡ï¼Œå¦‚æœæ‰¾ä¸åˆ°åˆ™è¿”å› -1
    public int indexOf(Object o) {
        if (o == null) {
            for (int i = 0; i < size; i++)
                if (elementData[i]==null)
                    return i;
        } else {
            for (int i = 0; i < size; i++)
                if (o.equals(elementData[i]))
                    return i;
        }
        return -1;
    }

    // åˆ¤æ–­æŒ‡å®šå…ƒç´ æ˜¯å¦åœ¨æ•°ç»„ä¸­å‡ºç°
    public boolean contains(Object o) {
        return indexOf(o) >= 0;
    }

    // å°†æ•°ç»„ä¸­çš„å…ƒç´ è½¬åŒ–æˆå­—ç¬¦ä¸²è¾“å‡º
    public String toString() {
        StringBuilder sb = new StringBuilder();
        
        for (Object o : elementData) {
            if (o != null) {
                E e = (E)o;
                sb.append(e.toString());
                sb.append(',').append(' ');
            }
        }
        return sb.toString();
    }

    // è¿”å›æ•°ç»„ä¸­å…ƒç´ çš„æ•°é‡
    public int size() {
        return size;
    }

    // ä¿®æ”¹æŒ‡å®šä¸‹æ ‡çš„å…ƒç´ ï¼Œè¿”å›ä¿®æ”¹å‰çš„å…ƒç´ 
    public E set(int index, E element) {
        E oldValue = (E) elementData[index];
        elementData[index] = element;
        return oldValue;
    }
}
```

1ï¼‰æ–°å¢ `indexOf(Object o)` æ–¹æ³•ï¼Œåˆ¤æ–­å…ƒç´ åœ¨ `Arraylist` ä¸­çš„ä½ç½®ã€‚æ³¨æ„å‚æ•°ä¸º `Object` è€Œä¸æ˜¯æ³›å‹ `E`ã€‚

2ï¼‰æ–°å¢ `contains(Object o)` æ–¹æ³•ï¼Œåˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨ `Arraylist` ä¸­ã€‚æ³¨æ„å‚æ•°ä¸º `Object` è€Œä¸æ˜¯æ³›å‹ `E`ã€‚

3ï¼‰æ–°å¢ `toString()` æ–¹æ³•ï¼Œæ–¹ä¾¿å¯¹ `Arraylist` è¿›è¡Œæ‰“å°ã€‚

4ï¼‰æ–°å¢ `set(int index, E element)` æ–¹æ³•ï¼Œæ–¹ä¾¿å¯¹ `Arraylist` å…ƒç´ çš„æ›´æ”¹ã€‚

å› ä¸ºæ³›å‹æ“¦é™¤çš„åŸå› ï¼Œ`Arraylist<Wanger> list = new Arraylist<Wangxiaoer>();` è¿™æ ·çš„è¯­å¥æ˜¯æ— æ³•é€šè¿‡ç¼–è¯‘çš„ï¼Œå°½ç®¡ Wangxiaoer æ˜¯ Wanger çš„å­ç±»ã€‚ä½†å¦‚æœæˆ‘ä»¬ç¡®å®éœ€è¦è¿™ç§ â€œå‘ä¸Šè½¬å‹â€ çš„å…³ç³»ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™æ—¶å€™å°±éœ€è¦é€šé…ç¬¦æ¥å‘æŒ¥ä½œç”¨äº†ã€‚

åˆ©ç”¨ `<? extends Wanger>` å½¢å¼çš„é€šé…ç¬¦ï¼Œå¯ä»¥å®ç°æ³›å‹çš„å‘ä¸Šè½¬å‹ï¼Œæ¥çœ‹ä¾‹å­ã€‚

```java
Arraylist<? extends Wanger> list2 = new Arraylist<>(4);
list2.add(null);
// list2.add(new Wanger());
// list2.add(new Wangxiaoer());

Wanger w2 = list2.get(0);
// Wangxiaoer w3 = list2.get(1);
```

list2 çš„ç±»å‹æ˜¯ `Arraylist<? extends Wanger>`ï¼Œç¿»è¯‘ä¸€ä¸‹å°±æ˜¯ï¼Œlist2 æ˜¯ä¸€ä¸ª `Arraylist`ï¼Œå…¶ç±»å‹æ˜¯ `Wanger` åŠå…¶å­ç±»ã€‚

æ³¨æ„ï¼Œâ€œå…³é”®â€æ¥äº†ï¼list2 å¹¶ä¸å…è®¸é€šè¿‡ `add(E e)` æ–¹æ³•å‘å…¶æ·»åŠ  `Wanger` æˆ–è€… `Wangxiaoer` çš„å¯¹è±¡ï¼Œå”¯ä¸€ä¾‹å¤–çš„æ˜¯ `null`ã€‚

â€œé‚£å°±å¥‡äº†æ€ªäº†ï¼Œæ—¢ç„¶ä¸è®©å­˜æ”¾å…ƒç´ ï¼Œé‚£è¦ `Arraylist<? extends Wanger>` è¿™æ ·çš„ list2 æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿâ€ä¸‰å¦¹å¥½å¥‡åœ°é—®ã€‚

è™½ç„¶ä¸èƒ½é€šè¿‡ `add(E e)` æ–¹æ³•å¾€ list2 ä¸­æ·»åŠ å…ƒç´ ï¼Œä½†å¯ä»¥ç»™å®ƒèµ‹å€¼ã€‚

```java
Arraylist<Wanger> list = new Arraylist<>(4);

Wanger wanger = new Wanger();
list.add(wanger);

Wangxiaoer wangxiaoer = new Wangxiaoer();
list.add(wangxiaoer);

Arraylist<? extends Wanger> list2 = list;

Wanger w2 = list2.get(1);
System.out.println(w2);

System.out.println(list2.indexOf(wanger));
System.out.println(list2.contains(new Wangxiaoer()));
```

`Arraylist<? extends Wanger> list2 = list;` è¯­å¥æŠŠ list çš„å€¼èµ‹äºˆäº† list2ï¼Œæ­¤æ—¶ `list2 == list`ã€‚ç”±äº list2 ä¸å…è®¸å¾€å…¶æ·»åŠ å…¶ä»–å…ƒç´ ï¼Œæ‰€ä»¥æ­¤æ—¶å®ƒæ˜¯å®‰å…¨çš„â€”â€”æˆ‘ä»¬å¯ä»¥ä»å®¹åœ°å¯¹ list2 è¿›è¡Œ `get()`ã€`indexOf()` å’Œ `contains()`ã€‚æƒ³ä¸€æƒ³ï¼Œå¦‚æœå¯ä»¥å‘ list2 æ·»åŠ å…ƒç´ çš„è¯ï¼Œè¿™ 3 ä¸ªæ–¹æ³•åè€Œå˜å¾—ä¸å¤ªå®‰å…¨ï¼Œå®ƒä»¬çš„å€¼å¯èƒ½å°±ä¼šå˜ã€‚

åˆ©ç”¨ `<? super Wanger>` å½¢å¼çš„é€šé…ç¬¦ï¼Œå¯ä»¥å‘ Arraylist ä¸­å­˜å…¥çˆ¶ç±»æ˜¯ `Wanger` çš„å…ƒç´ ï¼Œæ¥çœ‹ä¾‹å­ã€‚

```java
Arraylist<? super Wanger> list3 = new Arraylist<>(4);
list3.add(new Wanger());
list3.add(new Wangxiaoer());

// Wanger w3 = list3.get(0);
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ— æ³•ä» `Arraylist<? super Wanger>` è¿™æ ·ç±»å‹çš„ list3 ä¸­å–å‡ºæ•°æ®ã€‚

### å°ç»“

å¥½äº†ï¼Œä¸‰å¦¹ï¼Œå…³äºæ³›å‹ï¼Œæˆ‘ä»¬å†æ¥åšä¸€ä¸ªç®€å•çš„æ€»ç»“ã€‚

åœ¨ Java ä¸­ï¼Œæ³›å‹æ˜¯ä¸€ç§å¼ºç±»å‹çº¦æŸæœºåˆ¶ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æœŸé—´æ£€æŸ¥ç±»å‹å®‰å…¨æ€§ï¼Œå¹¶ä¸”å¯ä»¥æé«˜ä»£ç çš„å¤ç”¨æ€§å’Œå¯è¯»æ€§ã€‚

#### 1ï¼‰ç±»å‹å‚æ•°åŒ–

æ³›å‹çš„æœ¬è´¨æ˜¯å‚æ•°åŒ–ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å®šä¹‰ç±»ã€æ¥å£æˆ–æ–¹æ³•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªç±»å‹å‚æ•°æ¥è¡¨ç¤ºå‚æ•°åŒ–ç±»å‹ã€‚

ä¾‹å¦‚è¿™æ ·å¯ä»¥å®šä¹‰ä¸€ä¸ªæ³›å‹ç±»ã€‚

```java
public class Box<T> {
    private T value;

    public Box(T value) {
        this.value = value;
    }

    public T getValue() {
        return value;
    }

    public void setValue(T value) {
        this.value = value;
    }
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`<T>` è¡¨ç¤ºç±»å‹å‚æ•°ï¼Œå¯ä»¥åœ¨ç±»ä¸­ä»»ä½•éœ€è¦ä½¿ç”¨ç±»å‹çš„åœ°æ–¹ä½¿ç”¨ T ä»£æ›¿å…·ä½“çš„ç±»å‹ã€‚é€šè¿‡ä½¿ç”¨æ³›å‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹å¯¹è±¡çš„ç›’å­ã€‚

```java
Box<Integer> intBox = new Box<>(123);
Box<String> strBox = new Box<>("Hello, world!");
```

æ³›å‹åœ¨å®é™…å¼€å‘ä¸­çš„åº”ç”¨éå¸¸å¹¿æ³›ï¼Œä¾‹å¦‚é›†åˆæ¡†æ¶ä¸­çš„ Listã€Setã€Map ç­‰å®¹å™¨ç±»ï¼Œä»¥åŠå¹¶å‘æ¡†æ¶ä¸­çš„ Futureã€Callable ç­‰å·¥å…·ç±»éƒ½ä½¿ç”¨äº†æ³›å‹ã€‚

#### 2ï¼‰ç±»å‹æ“¦é™¤

åœ¨ Java çš„æ³›å‹æœºåˆ¶ä¸­ï¼Œæœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼šç±»å‹æ“¦é™¤å’Œé€šé…ç¬¦ã€‚

æ³›å‹åœ¨ç¼–è¯‘æ—¶ä¼šå°†æ³›å‹ç±»å‹æ“¦é™¤ï¼Œå°†æ³›å‹ç±»å‹æ›¿æ¢æˆ Object ç±»å‹ã€‚è¿™æ˜¯ä¸ºäº†å‘åå…¼å®¹ï¼Œé¿å…å¯¹åŸæœ‰çš„ Java ä»£ç é€ æˆå½±å“ã€‚

ä¾‹å¦‚ï¼Œå¯¹äºä¸‹é¢çš„ä»£ç ï¼š

```java
List<Integer> intList = new ArrayList<>();
intList.add(123);
int value = intList.get(0);
```

åœ¨ç¼–è¯‘æ—¶ï¼ŒJava ç¼–è¯‘å™¨ä¼šå°†æ³›å‹ç±»å‹ `List<Integer>` æ›¿æ¢æˆ `List<Object>`ï¼Œå°† get æ–¹æ³•çš„è¿”å›å€¼ç±»å‹ Integer æ›¿æ¢æˆ Objectï¼Œç”Ÿæˆçš„å­—èŠ‚ç ä¸ä¸‹é¢çš„ä»£ç ç­‰ä»·ï¼š

```java
List intList = new ArrayList();
intList.add(Integer.valueOf(123));
int value = (Integer) intList.get(0);
```

Java æ³›å‹åªåœ¨ç¼–è¯‘æ—¶èµ·ä½œç”¨ï¼Œè¿è¡Œæ—¶å¹¶ä¸ä¼šä¿ç•™æ³›å‹ç±»å‹ä¿¡æ¯ã€‚

#### 3ï¼‰é€šé…ç¬¦

é€šé…ç¬¦ç”¨äºè¡¨ç¤ºæŸç§æœªçŸ¥çš„ç±»å‹ï¼Œä¾‹å¦‚ `List<?>` è¡¨ç¤ºä¸€ä¸ªå¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹å¯¹è±¡çš„ Listï¼Œä½†æ˜¯ä¸èƒ½å¯¹å…¶ä¸­çš„å…ƒç´ è¿›è¡Œæ·»åŠ æ“ä½œã€‚é€šé…ç¬¦å¯ä»¥ç”¨æ¥è§£å†³ç±»å‹ä¸ç¡®å®šçš„æƒ…å†µï¼Œä¾‹å¦‚åœ¨æ–¹æ³•å‚æ•°æˆ–è¿”å›å€¼ä¸­ä½¿ç”¨ã€‚

ä½¿ç”¨é€šé…ç¬¦å¯ä»¥ä½¿æ–¹æ³•æ›´åŠ é€šç”¨ï¼ŒåŒæ—¶ä¿è¯ç±»å‹å®‰å…¨ã€‚

ä¾‹å¦‚ï¼Œå®šä¹‰ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼š

```java
public static void printList(List<?> list) {
    for (Object obj : list) {
        System.out.print(obj + " ");
    }
    System.out.println();
}
```

è¿™ä¸ªæ–¹æ³•å¯ä»¥æ¥å—ä»»æ„ç±»å‹çš„ Listï¼Œä¾‹å¦‚ `List<Integer>`ã€`List<String>` ç­‰ç­‰ã€‚

##### ä¸Šé™é€šé…ç¬¦

æ³›å‹è¿˜æä¾›äº†ä¸Šé™é€šé…ç¬¦ `<? extends T>`ï¼Œè¡¨ç¤ºé€šé…ç¬¦åªèƒ½æ¥å— T æˆ– T çš„å­ç±»ã€‚ä½¿ç”¨ä¸Šé™é€šé…ç¬¦å¯ä»¥æé«˜ç¨‹åºçš„ç±»å‹å®‰å…¨æ€§ã€‚

ä¾‹å¦‚ï¼Œå®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œåªæ¥å— Number åŠå…¶å­ç±»çš„ Listï¼š

```java
public static void printNumberList(List<? extends Number> list) {
    for (Number num : list) {
        System.out.print(num + " ");
    }
    System.out.println();
}
```

è¿™ä¸ªæ–¹æ³•å¯ä»¥æ¥å— `List<Integer>`ã€`List<Double>` ç­‰ç­‰ã€‚

##### ä¸‹é™é€šé…ç¬¦

ä¸‹é™é€šé…ç¬¦ï¼ˆLower Bounded Wildcardsï¼‰ç”¨ super å…³é”®å­—æ¥å£°æ˜ï¼Œå…¶è¯­æ³•å½¢å¼ä¸º `<? super T>`ï¼Œå…¶ä¸­ T è¡¨ç¤ºç±»å‹å‚æ•°ã€‚å®ƒè¡¨ç¤ºçš„æ˜¯è¯¥ç±»å‹å‚æ•°å¿…é¡»æ˜¯æŸä¸ªæŒ‡å®šç±»çš„è¶…ç±»ï¼ˆåŒ…æ‹¬è¯¥ç±»æœ¬èº«ï¼‰ã€‚

å½“æˆ‘ä»¬éœ€è¦å¾€ä¸€ä¸ªæ³›å‹é›†åˆä¸­æ·»åŠ å…ƒç´ æ—¶ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯ä¸Šé™é€šé…ç¬¦ï¼Œé›†åˆä¸­çš„å…ƒç´ ç±»å‹å¯èƒ½ä¼šè¢«é™åˆ¶ï¼Œä»è€Œæ— æ³•æ·»åŠ æŸäº›ç±»å‹çš„å…ƒç´ ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸‹é™é€šé…ç¬¦ï¼Œå¯ä»¥å°†æŒ‡å®šç±»å‹çš„å­ç±»å‹æ·»åŠ åˆ°é›†åˆä¸­ï¼Œä¿è¯äº†å…ƒç´ çš„å®Œæ•´æ€§ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰ä¸€ä¸ªç±» Animalï¼Œä»¥åŠä¸¤ä¸ªå­ç±» Dog å’Œ Catã€‚ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ª `List<? super Dog>` é›†åˆï¼Œå®ƒçš„ç±»å‹å‚æ•°å¿…é¡»æ˜¯ Dog æˆ–å…¶çˆ¶ç±»ç±»å‹ã€‚æˆ‘ä»¬å¯ä»¥å‘è¯¥é›†åˆä¸­æ·»åŠ  Dog ç±»å‹çš„å…ƒç´ ï¼Œä¹Ÿå¯ä»¥æ·»åŠ å®ƒçš„å­ç±»ã€‚ä½†æ˜¯ï¼Œä¸èƒ½å‘å…¶ä¸­æ·»åŠ  Cat ç±»å‹çš„å…ƒç´ ï¼Œå› ä¸º Cat ä¸æ˜¯ Dog çš„å­ç±»ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ä¸‹é™é€šé…ç¬¦çš„ç¤ºä¾‹ï¼š

```java
List<? super Dog> animals = new ArrayList<>();

// å¯ä»¥æ·»åŠ  Dog ç±»å‹çš„å…ƒç´ å’Œå…¶å­ç±»å‹å…ƒç´ 
animals.add(new Dog());
animals.add(new Bulldog());

// ä¸èƒ½æ·»åŠ  Cat ç±»å‹çš„å…ƒç´ 
animals.add(new Cat()); // ç¼–è¯‘æŠ¥é”™
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ä½¿ç”¨ä¸‹é™é€šé…ç¬¦å¯ä»¥æ·»åŠ æŸäº›å­ç±»å‹å…ƒç´ ï¼Œä½†æ˜¯åœ¨è¯»å–å…ƒç´ æ—¶ï¼Œæˆ‘ä»¬åªèƒ½ç¡®ä¿å…¶æ˜¯ Object ç±»å‹çš„ï¼Œæ— æ³•ç¡®ä¿å…¶æ˜¯æŒ‡å®šç±»å‹æˆ–å…¶çˆ¶ç±»å‹ã€‚å› æ­¤ï¼Œåœ¨è¯»å–å…ƒç´ æ—¶éœ€è¦è¿›è¡Œç±»å‹è½¬æ¢ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```java
List<? super Dog> animals = new ArrayList<>();
animals.add(new Dog());

// è¯»å–å…ƒç´ æ—¶éœ€è¦è¿›è¡Œç±»å‹è½¬æ¢
Object animal = animals.get(0);
Dog dog = (Dog) animal;
```

æ€»çš„æ¥è¯´ï¼ŒJava çš„æ³›å‹æœºåˆ¶æ˜¯ä¸€ç§éå¸¸å¼ºå¤§çš„ç±»å‹çº¦æŸæœºåˆ¶ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æ—¶æ£€æŸ¥ç±»å‹å®‰å…¨æ€§ï¼Œå¹¶æé«˜ä»£ç çš„å¤ç”¨æ€§å’Œå¯è¯»æ€§ã€‚ä½†æ˜¯ï¼Œåœ¨ä½¿ç”¨æ³›å‹æ—¶ä¹Ÿéœ€è¦æ³¨æ„ç±»å‹æ“¦é™¤å’Œé€šé…ç¬¦ç­‰é—®é¢˜ï¼Œä»¥ç¡®ä¿ä»£ç çš„æ­£ç¡®æ€§ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 6.7 Iteratorå’ŒIterableçš„åŒºåˆ«

>PS: è¿™ç¯‡åŒæ ·æ¥æ¢ä¸€ä¸ªé£æ ¼ï¼Œä¸€èµ·æ¥æ¬£èµã€‚

é‚£å¤©ï¼Œå°äºŒå»æµ·åº·å¨è§†é¢è¯•ï¼Œé¢è¯•å®˜è€ç‹ä¸€ä¸Šæ¥å°±ç”©ç»™äº†ä»–ä¸€é“é¢è¯•é¢˜ï¼šè¯·é—® Iteratorä¸Iterableæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

å°äºŒè¡¨ç¤ºå¾ˆå¼€å¿ƒï¼Œå› ä¸ºä»–3 å¤©å‰åˆšå¥½åœ¨ã€Š[äºŒå“¥çš„Javaè¿›é˜¶ä¹‹è·¯](https://tobebetterjavaer.com/collection/iterator-iterable.html)ã€‹ä¸Šè¯»è¿‡è¿™ç¯‡æ–‡ç« ï¼Œæ‰€ä»¥å›ç­”å¾—èƒ¸æœ‰æˆç«¹ã€‚

ä»¥ä¸‹â†“æ˜¯å°äºŒå½“æ—¶è¯»è¿‡çš„æ–‡ç« å†…å®¹ï¼Œä»–å°è±¡æ·±åˆ»ã€‚

----

åœ¨ Java ä¸­ï¼Œæˆ‘ä»¬å¯¹ List è¿›è¡Œéå†çš„æ—¶å€™ï¼Œä¸»è¦æœ‰è¿™ä¹ˆä¸‰ç§æ–¹å¼ã€‚

ç¬¬ä¸€ç§ï¼šfor å¾ªç¯ã€‚

```java
for (int i = 0; i < list.size(); i++) {
    System.out.print(list.get(i) + "ï¼Œ");
}
```

ç¬¬äºŒç§ï¼šè¿­ä»£å™¨ã€‚

```java
Iterator it = list.iterator();
while (it.hasNext()) {
    System.out.print(it.next() + "ï¼Œ");
}
```

ç¬¬ä¸‰ç§ï¼šfor-eachã€‚

```java
for (String str : list) {
    System.out.print(str + "ï¼Œ");
}
```

ç¬¬ä¸€ç§æˆ‘ä»¬ç•¥è¿‡ï¼Œç¬¬äºŒç§ç”¨çš„æ˜¯ Iteratorï¼Œç¬¬ä¸‰ç§çœ‹èµ·æ¥æ˜¯ for-eachï¼Œå…¶å®èƒŒåä¹Ÿæ˜¯ Iteratorï¼Œçœ‹ä¸€ä¸‹åç¼–è¯‘åçš„ä»£ç ï¼ˆå¦‚ä¸‹æ‰€ç¤ºï¼‰å°±æ˜ç™½äº†ã€‚

```java
Iterator var3 = list.iterator();

while(var3.hasNext()) {
    String str = (String)var3.next();
    System.out.print(str + "ï¼Œ");
}
```

for-each åªä¸è¿‡æ˜¯ä¸ªè¯­æ³•ç³–ï¼Œè®©æˆ‘ä»¬å¼€å‘è€…åœ¨éå† List çš„æ—¶å€™å¯ä»¥å†™æ›´å°‘çš„ä»£ç ï¼Œæ›´ç®€æ´æ˜äº†ã€‚

Iterator æ˜¯ä¸ªæ¥å£ï¼ŒJDK 1.2 çš„æ—¶å€™å°±æœ‰äº†ï¼Œç”¨æ¥æ”¹è¿› Enumeration æ¥å£ï¼š

- å…è®¸åˆ é™¤å…ƒç´ ï¼ˆå¢åŠ äº† remove æ–¹æ³•ï¼‰
- ä¼˜åŒ–äº†æ–¹æ³•åï¼ˆEnumeration ä¸­æ˜¯ hasMoreElements å’Œ nextElementï¼Œä¸ç®€æ´ï¼‰

æ¥çœ‹ä¸€ä¸‹ Iterator çš„æºç ï¼š

```java
public interface Iterator<E> {
    // åˆ¤æ–­é›†åˆä¸­æ˜¯å¦å­˜åœ¨ä¸‹ä¸€ä¸ªå¯¹è±¡
    boolean hasNext();
    // è¿”å›é›†åˆä¸­çš„ä¸‹ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶å°†è®¿é—®æŒ‡é’ˆç§»åŠ¨ä¸€ä½
    E next();
    // åˆ é™¤é›†åˆä¸­è°ƒç”¨next()æ–¹æ³•è¿”å›çš„å¯¹è±¡
    default void remove() {
        throw new UnsupportedOperationException("remove");
    }
}
```

JDK 1.8 æ—¶ï¼ŒIterable æ¥å£ä¸­æ–°å¢äº† forEach æ–¹æ³•ã€‚è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª Consumer å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œç”¨äºå¯¹é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œã€‚è¯¥æ–¹æ³•çš„å®ç°æ–¹å¼æ˜¯ä½¿ç”¨ for-each å¾ªç¯éå†é›†åˆä¸­çš„å…ƒç´ ï¼Œå¯¹äºæ¯ä¸ªå…ƒç´ ï¼Œè°ƒç”¨ Consumer å¯¹è±¡çš„ accept æ–¹æ³•æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œã€‚

```java
default void forEach(Consumer<? super T> action) {
    Objects.requireNonNull(action);
    for (T t : this) {
        action.accept(t);
    }
}
```

è¯¥æ–¹æ³•å®ç°æ—¶é¦–å…ˆä¼šå¯¹ action å‚æ•°è¿›è¡Œéç©ºæ£€æŸ¥ï¼Œå¦‚æœä¸º null åˆ™æŠ›å‡º NullPointerException å¼‚å¸¸ã€‚ç„¶åä½¿ç”¨ for-each å¾ªç¯éå†é›†åˆä¸­çš„å…ƒç´ ï¼Œå¹¶å¯¹æ¯ä¸ªå…ƒç´ è°ƒç”¨ action.accept(t) æ–¹æ³•æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œã€‚ç”±äº Iterable æ¥å£æ˜¯ Java é›†åˆæ¡†æ¶ä¸­æ‰€æœ‰é›†åˆç±»å‹çš„åŸºæœ¬æ¥å£ï¼Œå› æ­¤è¯¥æ–¹æ³•å¯ä»¥è¢«æ‰€æœ‰å®ç°äº† Iterable æ¥å£çš„é›†åˆç±»å‹ä½¿ç”¨ã€‚

å®ƒå¯¹ Iterable çš„æ¯ä¸ªå…ƒç´ æ‰§è¡Œç»™å®šæ“ä½œï¼Œå…·ä½“æŒ‡å®šçš„æ“ä½œéœ€è¦è‡ªå·±å†™Consumeræ¥å£é€šè¿‡acceptæ–¹æ³•å›è°ƒå‡ºæ¥ã€‚

```java
List<Integer> list = new ArrayList<>(Arrays.asList(1, 2, 3));
list.forEach(integer -> System.out.println(integer));
```

å†™å¾—æ›´æµ…æ˜¾æ˜“æ‡‚ç‚¹ï¼Œå°±æ˜¯ï¼š

```java
List<Integer> list = new ArrayList<>(Arrays.asList(1, 2, 3));
list.forEach(new Consumer<Integer>() {
    @Override
    public void accept(Integer integer) {
        System.out.println(integer);
    }
});
```

å¦‚æœæˆ‘ä»¬ä»”ç»†è§‚å¯ŸArrayList æˆ–è€… LinkedList çš„â€œæˆ·å£æœ¬â€å°±ä¼šå‘ç°ï¼Œå¹¶æ²¡æœ‰ç›´æ¥æ‰¾åˆ° Iterator çš„å½±å­ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/iterator-iterable-01.png)

åè€Œæ‰¾åˆ°äº† Iterableï¼

```java
public interface Iterable<T> {
    Iterator<T> iterator();
}
```

ä¹Ÿå°±æ˜¯è¯´ï¼ŒList çš„å…³ç³»å›¾è°±ä¸­å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨ Iteratorï¼Œè€Œæ˜¯ä½¿ç”¨ Iterable åšäº†è¿‡æ¸¡ã€‚

å›å¤´å†æ¥çœ‹ä¸€ä¸‹ç¬¬äºŒç§éå† List çš„æ–¹å¼ã€‚

```java
Iterator it = list.iterator();
while (it.hasNext()) {
}
```

å‘ç°åˆšå¥½å‘¼åº”ä¸Šäº†ã€‚æ‹¿ ArrayList æ¥è¯´å§ï¼Œå®ƒé‡å†™äº† Iterable æ¥å£çš„ iterator æ–¹æ³•ï¼š

```java
public Iterator<E> iterator() {
    return new Itr();
}
```

è¿”å›çš„å¯¹è±¡ Itr æ˜¯ä¸ªå†…éƒ¨ç±»ï¼Œå®ç°äº† Iterator æ¥å£ï¼Œå¹¶ä¸”æŒ‰ç…§è‡ªå·±çš„æ–¹å¼é‡å†™äº† hasNextã€nextã€remove ç­‰æ–¹æ³•ã€‚

```java
/**
 * ArrayList è¿­ä»£å™¨çš„å®ç°ï¼Œå†…éƒ¨ç±»ã€‚
 */
private class Itr implements Iterator<E> {

    /**
     * æ¸¸æ ‡ä½ç½®ï¼Œå³ä¸‹ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ã€‚
     */
    int cursor;

    /**
     * ä¸Šä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ã€‚
     */
    int lastRet = -1;

    /**
     * é¢„æœŸçš„ç»“æ„æ€§ä¿®æ”¹æ¬¡æ•°ã€‚
     */
    int expectedModCount = modCount;

    /**
     * åˆ¤æ–­æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚
     *
     * @return å¦‚æœè¿˜æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚
     */
    public boolean hasNext() {
        return cursor != size;
    }

    /**
     * è·å–ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚
     *
     * @return åˆ—è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚
     * @throws NoSuchElementException å¦‚æœæ²¡æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™æŠ›å‡º NoSuchElementException å¼‚å¸¸ã€‚
     */
    @SuppressWarnings("unchecked")
    public E next() {
        // è·å– ArrayList å¯¹è±¡çš„å†…éƒ¨æ•°ç»„
        Object[] elementData = ArrayList.this.elementData;
        // è®°å½•å½“å‰è¿­ä»£å™¨çš„ä½ç½®
        int i = cursor;
        if (i >= size) {
            throw new NoSuchElementException();
        }
        // å°†æ¸¸æ ‡ä½ç½®åŠ  1ï¼Œä¸ºä¸‹ä¸€æ¬¡è¿­ä»£åšå‡†å¤‡
        cursor = i + 1;
        // è®°å½•ä¸Šä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•
        return (E) elementData[lastRet = i];
    }

    /**
     * åˆ é™¤æœ€åä¸€ä¸ªè¿”å›çš„å…ƒç´ ã€‚
     * è¿­ä»£å™¨åªèƒ½åˆ é™¤æœ€åä¸€æ¬¡è°ƒç”¨ next æ–¹æ³•è¿”å›çš„å…ƒç´ ã€‚
     *
     * @throws ConcurrentModificationException å¦‚æœåœ¨æœ€åä¸€æ¬¡è°ƒç”¨ next æ–¹æ³•ä¹‹ååˆ—è¡¨ç»“æ„è¢«ä¿®æ”¹ï¼Œåˆ™æŠ›å‡º ConcurrentModificationException å¼‚å¸¸ã€‚
     * @throws IllegalStateException         å¦‚æœåœ¨è°ƒç”¨ next æ–¹æ³•ä¹‹å‰æ²¡æœ‰è°ƒç”¨ remove æ–¹æ³•ï¼Œæˆ–è€…åœ¨åŒä¸€æ¬¡è¿­ä»£ä¸­å¤šæ¬¡è°ƒç”¨ remove æ–¹æ³•ï¼Œåˆ™æŠ›å‡º IllegalStateException å¼‚å¸¸ã€‚
     */
    public void remove() {
        // æ£€æŸ¥åœ¨æœ€åä¸€æ¬¡è°ƒç”¨ next æ–¹æ³•ä¹‹åæ˜¯å¦è¿›è¡Œäº†ç»“æ„æ€§ä¿®æ”¹
        if (expectedModCount != modCount) {
            throw new ConcurrentModificationException();
        }
        // å¦‚æœä¸Šä¸€æ¬¡è°ƒç”¨ next æ–¹æ³•ä¹‹å‰æ²¡æœ‰è°ƒç”¨ remove æ–¹æ³•ï¼Œåˆ™æŠ›å‡º IllegalStateException å¼‚å¸¸
        if (lastRet < 0) {
            throw new IllegalStateException();
        }
        try {
            // è°ƒç”¨ ArrayList å¯¹è±¡çš„ remove(int index) æ–¹æ³•åˆ é™¤ä¸Šä¸€ä¸ªå…ƒç´ 
            ArrayList.this.remove(lastRet);
            // å°†æ¸¸æ ‡ä½ç½®è®¾ç½®ä¸ºä¸Šä¸€ä¸ªå…ƒç´ çš„ä½ç½®
            cursor = lastRet;
            // å°†ä¸Šä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•è®¾ç½®ä¸º -1ï¼Œè¡¨ç¤ºæ²¡æœ‰ä¸Šä¸€ä¸ªå…ƒç´ 
            lastRet = -1;
            // æ›´æ–°é¢„æœŸçš„ç»“æ„æ€§ä¿®æ”¹æ¬¡æ•°
            expectedModCount = modCount;
        } catch (IndexOutOfBoundsException ex) {
            throw new ConcurrentModificationException();
        }
    }
}
```

é‚£å¯èƒ½æœ‰äº›å°ä¼™ä¼´ä¼šé—®ï¼šä¸ºä»€ä¹ˆä¸ç›´æ¥å°† Iterator ä¸­çš„æ ¸å¿ƒæ–¹æ³• hasNextã€next æ”¾åˆ° Iterable æ¥å£ä¸­å‘¢ï¼Ÿç›´æ¥åƒä¸‹é¢è¿™æ ·ä½¿ç”¨ä¸æ˜¯æ›´æ–¹ä¾¿ï¼Ÿ

```java
Iterable it = list.iterator();
while (it.hasNext()) {
}
```

ä»è‹±æ–‡å•è¯çš„åç¼€è¯­æ³•ä¸Šæ¥çœ‹ï¼Œï¼ˆIterableï¼‰able è¡¨ç¤ºè¿™ä¸ª List æ˜¯æ”¯æŒè¿­ä»£çš„ï¼Œè€Œ ï¼ˆIteratorï¼‰tor è¡¨ç¤ºè¿™ä¸ª List æ˜¯å¦‚ä½•è¿­ä»£çš„ã€‚

æ”¯æŒè¿­ä»£ä¸å…·ä½“æ€ä¹ˆè¿­ä»£æ˜¾ç„¶ä¸èƒ½æ··åœ¨ä¸€èµ·ï¼Œå¦åˆ™å°±ä¹±çš„ä¸€ç¬”ã€‚è¿˜æ˜¯å„å¸å…¶èŒçš„å¥½ã€‚

æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæŠŠ Iterator å’Œ Iterable åˆå¹¶ï¼Œfor-each è¿™ç§éå† List çš„æ–¹å¼æ˜¯ä¸æ˜¯å°±ä¸å¥½åŠäº†ï¼Ÿ

åŸåˆ™ä¸Šï¼Œåªè¦ä¸€ä¸ª List å®ç°äº† Iterable æ¥å£ï¼Œé‚£ä¹ˆå®ƒå°±å¯ä»¥ä½¿ç”¨ for-each è¿™ç§æ–¹å¼æ¥éå†ï¼Œé‚£å…·ä½“è¯¥æ€ä¹ˆéå†ï¼Œè¿˜æ˜¯è¦çœ‹å®ƒè‡ªå·±æ˜¯æ€ä¹ˆå®ç° Iterator æ¥å£çš„ã€‚

Map å°±æ²¡åŠæ³•ç›´æ¥ä½¿ç”¨ for-eachï¼Œå› ä¸º Map æ²¡æœ‰å®ç° Iterable æ¥å£ï¼Œåªæœ‰é€šè¿‡ `map.entrySet()`ã€`map.keySet()`ã€`map.values()` è¿™ç§è¿”å›ä¸€ä¸ª  Collection çš„æ–¹å¼æ‰èƒ½ ä½¿ç”¨ for-eachã€‚

å¦‚æœæˆ‘ä»¬ä»”ç»†ç ”ç©¶ LinkedList çš„æºç å°±ä¼šå‘ç°ï¼ŒLinkedList å¹¶æ²¡æœ‰ç›´æ¥é‡å†™ Iterable æ¥å£çš„ iterator æ–¹æ³•ï¼Œè€Œæ˜¯ç”±å®ƒçš„çˆ¶ç±» AbstractSequentialList æ¥å®Œæˆã€‚

```java
public Iterator<E> iterator() {
    return listIterator();
}
```

LinkedList é‡å†™äº† listIterator æ–¹æ³•ï¼š

```java
public ListIterator<E> listIterator(int index) {
    checkPositionIndex(index);
    return new ListItr(index);
}
```

è¿™é‡Œæˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªæ–°çš„è¿­ä»£å™¨ ListIteratorï¼Œå®ƒç»§æ‰¿äº† Iterator æ¥å£ï¼Œåœ¨éå†List æ—¶å¯ä»¥ä»ä»»æ„ä¸‹æ ‡å¼€å§‹éå†ï¼Œè€Œä¸”æ”¯æŒåŒå‘éå†ã€‚

```java
public interface ListIterator<E> extends Iterator<E> {
    boolean hasNext();
    E next();
    boolean hasPrevious();
    E previous();
}
```

æˆ‘ä»¬çŸ¥é“ï¼Œé›†åˆï¼ˆCollectionï¼‰ä¸ä»…æœ‰ Listï¼Œè¿˜æœ‰ Setï¼Œé‚£ Iterator ä¸ä»…æ”¯æŒ Listï¼Œè¿˜æ”¯æŒ Setï¼Œä½† ListIterator å°±åªæ”¯æŒ Listã€‚

é‚£å¯èƒ½æœ‰äº›å°ä¼™ä¼´ä¼šé—®ï¼šä¸ºä»€ä¹ˆä¸ç›´æ¥è®© List å®ç° Iterator æ¥å£ï¼Œè€Œæ˜¯è¦ç”¨å†…éƒ¨ç±»æ¥å®ç°å‘¢ï¼Ÿ

è¿™æ˜¯å› ä¸ºæœ‰äº› List å¯èƒ½ä¼šæœ‰å¤šç§éå†æ–¹å¼ï¼Œæ¯”å¦‚è¯´ LinkedListï¼Œé™¤äº†æ”¯æŒæ­£åºçš„éå†æ–¹å¼ï¼Œè¿˜æ”¯æŒé€†åºçš„éå†æ–¹å¼â€”â€”DescendingIteratorï¼š

```java
/**
 * ArrayList é€†å‘è¿­ä»£å™¨çš„å®ç°ï¼Œå†…éƒ¨ç±»ã€‚
 */
private class DescendingIterator implements Iterator<E> {

    /**
     * ä½¿ç”¨ ListItr å¯¹è±¡è¿›è¡Œé€†å‘éå†ã€‚
     */
    private final ListItr itr = new ListItr(size());

    /**
     * åˆ¤æ–­æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚
     *
     * @return å¦‚æœè¿˜æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚
     */
    public boolean hasNext() {
        return itr.hasPrevious();
    }

    /**
     * è·å–ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚
     *
     * @return åˆ—è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚
     * @throws NoSuchElementException å¦‚æœæ²¡æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™æŠ›å‡º NoSuchElementException å¼‚å¸¸ã€‚
     */
    public E next() {
        return itr.previous();
    }

    /**
     * åˆ é™¤æœ€åä¸€ä¸ªè¿”å›çš„å…ƒç´ ã€‚
     * è¿­ä»£å™¨åªèƒ½åˆ é™¤æœ€åä¸€æ¬¡è°ƒç”¨ next æ–¹æ³•è¿”å›çš„å…ƒç´ ã€‚
     *
     * @throws UnsupportedOperationException å¦‚æœåˆ—è¡¨ä¸æ”¯æŒåˆ é™¤æ“ä½œï¼Œåˆ™æŠ›å‡º UnsupportedOperationException å¼‚å¸¸ã€‚
     * @throws IllegalStateException         å¦‚æœåœ¨è°ƒç”¨ next æ–¹æ³•ä¹‹å‰æ²¡æœ‰è°ƒç”¨ remove æ–¹æ³•ï¼Œæˆ–è€…åœ¨åŒä¸€æ¬¡è¿­ä»£ä¸­å¤šæ¬¡è°ƒç”¨ remove æ–¹æ³•ï¼Œåˆ™æŠ›å‡º IllegalStateException å¼‚å¸¸ã€‚
     */
    public void remove() {
        itr.remove();
    }
}
```

å¯ä»¥çœ‹å¾—åˆ°ï¼ŒDescendingIterator åˆšå¥½åˆ©ç”¨äº† ListIterator å‘å‰éå†çš„æ–¹å¼ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹çš„æ–¹å¼æ¥ä½¿ç”¨ï¼š

```java
Iterator it = list.descendingIterator();
while (it.hasNext()) {
}
```

å¥½äº†ï¼Œå…³äºIteratorä¸Iterableæˆ‘ä»¬å°±å…ˆèŠè¿™ä¹ˆå¤šï¼Œæ€»ç»“ä¸¤ç‚¹ï¼š

- å­¦ä¼šæ·±å…¥æ€è€ƒï¼Œä¸€ç‚¹ç‚¹æŠ½ä¸å‰¥èŒ§ï¼Œå¤šæƒ³æƒ³ä¸ºä»€ä¹ˆè¿™æ ·å®ç°ï¼Œå¾ˆå¤šé—®é¢˜æ²¡æœ‰è‡ªå·±æƒ³è±¡ä¸­çš„é‚£ä¹ˆå¤æ‚ã€‚
- é‡åˆ°ç–‘æƒ‘ä¸æ”¾å¼ƒï¼Œè¿™æ˜¯æå‡è‡ªå·±æœ€å¥½çš„æœºä¼šï¼Œé‡åˆ°æŸä¸ªç–‘éš¾çš„ç‚¹ï¼Œè§£å†³çš„è¿‡ç¨‹ä¸­ä¼šæŒ–æ˜å‡ºå¾ˆå¤šç›¸å…³çš„ä¸œè¥¿ã€‚


----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 6.8 Java foreach å¾ªç¯é™·é˜±

>è¿™ç¯‡æ–‡ç« åŒæ ·é‡‡ç”¨å°äºŒå»é¢è¯•çš„å½¢å¼ï¼Œç»™å¤§å®¶æ¢ä¸ªèƒƒå£ã€‚

é‚£å¤©ï¼Œå°äºŒå»é˜¿é‡Œé¢è¯•ï¼Œé¢è¯•å®˜è€ç‹ä¸€ä¸Šæ¥å°±ç”©ç»™äº†ä»–ä¸€é“é¢è¯•é¢˜ï¼šä¸ºä»€ä¹ˆé˜¿é‡Œçš„ Java å¼€å‘æ‰‹å†Œé‡Œä¼šå¼ºåˆ¶ä¸è¦åœ¨ foreach é‡Œè¿›è¡Œå…ƒç´ çš„åˆ é™¤æ“ä½œï¼Ÿ

![](https://img-blog.csdnimg.cn/20191202223028397.png)

å°äºŒå¬å®Œè¿™å¥è¯å°±ä¹äº†ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºä¸€å¤©å‰ä»–åˆšåœ¨ã€Š[äºŒå“¥çš„Javaè¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ä¸Šçœ‹åˆ°è¿‡è¿™é“é¢˜çš„ç­”æ¡ˆã€‚

ä»¥ä¸‹æ˜¯æ•´ç¯‡æ–‡ç« çš„å†…å®¹ã€‚

### å…³äºfail-fast

ä¸ºäº†é•‡æ¥¼ï¼Œå…ˆæ¬ä¸€æ®µè‹±æ–‡æ¥è§£é‡Šä¸€ä¸‹ fail-fastã€‚

>In systems design, a fail-fast system is one which immediately reports at its interface any condition that is likely to indicate a failure. Fail-fast systems are usually designed to stop normal operation rather than attempt to continue a possibly flawed process. Such designs often check the system's state at several points in an operation, so any failures can be detected early. The responsibility of a fail-fast module is detecting errors, then letting the next-highest level of the system handle them.

è¿™æ®µè¯çš„å¤§è‡´æ„æ€å°±æ˜¯ï¼Œfail-fast æ˜¯ä¸€ç§é€šç”¨çš„ç³»ç»Ÿè®¾è®¡æ€æƒ³ï¼Œä¸€æ—¦æ£€æµ‹åˆ°å¯èƒ½ä¼šå‘ç”Ÿé”™è¯¯ï¼Œå°±ç«‹é©¬æŠ›å‡ºå¼‚å¸¸ï¼Œç¨‹åºå°†ä¸å†å¾€ä¸‹æ‰§è¡Œã€‚

```java
public void test(Wanger wanger) {   
    if (wanger == null) {
        throw new RuntimeException("wanger ä¸èƒ½ä¸ºç©º");
    }
    
    System.out.println(wanger.toString());
}
```

ä¸€æ—¦æ£€æµ‹åˆ° wanger ä¸º nullï¼Œå°±ç«‹é©¬æŠ›å‡ºå¼‚å¸¸ï¼Œè®©è°ƒç”¨è€…æ¥å†³å®šè¿™ç§æƒ…å†µä¸‹è¯¥æ€ä¹ˆå¤„ç†ï¼Œä¸‹ä¸€æ­¥ `wanger.toString()` å°±ä¸ä¼šæ‰§è¡Œäº†â€”â€”é¿å…æ›´ä¸¥é‡çš„é”™è¯¯å‡ºç°ã€‚

å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä¼šæŠŠ fail-fast å½’ç±»ä¸º Java é›†åˆæ¡†æ¶çš„ä¸€ç§é”™è¯¯æ£€æµ‹æœºåˆ¶ï¼Œä½†å…¶å® fail-fast å¹¶ä¸æ˜¯ Java é›†åˆæ¡†æ¶ç‰¹æœ‰çš„æœºåˆ¶ã€‚

### for-each åˆ é™¤å…ƒç´ æŠ¥é”™

ä¹‹æ‰€ä»¥æˆ‘ä»¬æŠŠ fail-fast æ”¾åœ¨é›†åˆæ¡†æ¶ç¯‡é‡Œä»‹ç»ï¼Œæ˜¯å› ä¸ºé—®é¢˜æ¯”è¾ƒå®¹æ˜“å†ç°ã€‚

```java
List<String> list = new ArrayList<>();
list.add("æ²‰é»˜ç‹äºŒ");
list.add("æ²‰é»˜ç‹ä¸‰");
list.add("ä¸€ä¸ªæ–‡ç« çœŸç‰¹ä¹ˆæœ‰è¶£çš„ç¨‹åºå‘˜");

for (String str : list) {
	if ("æ²‰é»˜ç‹äºŒ".equals(str)) {
		list.remove(str);
	}
}

System.out.println(list);
```

è¿™æ®µä»£ç çœ‹èµ·æ¥æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†è¿è¡Œèµ·æ¥å°±æŠ¥é”™äº†ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/fail-fast-01.png)


æ ¹æ®é”™è¯¯çš„å †æ ˆä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å®šä½åˆ° ArrayList çš„ç¬¬ 901 è¡Œä»£ç ã€‚

```java
final void checkForComodification() {
    if (modCount != expectedModCount)
        throw new ConcurrentModificationException();
}
```

ä¹Ÿå°±æ˜¯è¯´ï¼Œremove çš„æ—¶å€™è§¦å‘æ‰§è¡Œäº† `checkForComodification` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯¹ modCount å’Œ expectedModCount è¿›è¡Œäº†æ¯”è¾ƒï¼Œå‘ç°ä¸¤è€…ä¸ç­‰ï¼Œå°±æŠ›å‡ºäº† `ConcurrentModificationException` å¼‚å¸¸ã€‚

ä¸ºä»€ä¹ˆä¼šæ‰§è¡Œ `checkForComodification` æ–¹æ³•å‘¢ï¼Ÿ

æ˜¯å› ä¸º for-each æœ¬è´¨ä¸Šæ˜¯ä¸ªè¯­æ³•ç³–ï¼Œåº•å±‚æ˜¯é€šè¿‡[è¿­ä»£å™¨ Iterator](https://tobebetterjavaer.com/collection/iterator-iterable.html) é…åˆ while å¾ªç¯å®ç°çš„ï¼Œæ¥çœ‹ä¸€ä¸‹åç¼–è¯‘åçš„å­—èŠ‚ç ã€‚

```java
List<String> list = new ArrayList();
list.add("æ²‰é»˜ç‹äºŒ");
list.add("æ²‰é»˜ç‹ä¸‰");
list.add("ä¸€ä¸ªæ–‡ç« çœŸç‰¹ä¹ˆæœ‰è¶£çš„ç¨‹åºå‘˜");
Iterator var2 = list.iterator();

while(var2.hasNext()) {
    String str = (String)var2.next();
    if ("æ²‰é»˜ç‹äºŒ".equals(str)) {
        list.remove(str);
    }
}

System.out.println(list);
```

æ¥çœ‹ä¸€ä¸‹ ArrayList çš„ iterator æ–¹æ³•å§ï¼š

```java
public Iterator<E> iterator() {
    return new Itr();
}
```

å†…éƒ¨ç±» Itr å®ç°äº† Iterator æ¥å£ï¼Œè¿™æ˜¯ Itr çš„æºç ã€‚

```java
private class Itr implements Iterator<E> {
    int cursor;             // ä¸‹ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•
    int lastRet = -1;       // ä¸Šä¸€ä¸ªè¿”å›å…ƒç´ çš„ç´¢å¼•ï¼›å¦‚æœæ²¡æœ‰åˆ™ä¸º -1
    int expectedModCount = modCount; // ArrayList çš„ä¿®æ”¹æ¬¡æ•°

    Itr() { }  // æ„é€ å‡½æ•°

    public boolean hasNext() { // åˆ¤æ–­æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ 
        return cursor != size;
    }

    @SuppressWarnings("unchecked")
    public E next() { // è¿”å›ä¸‹ä¸€ä¸ªå…ƒç´ 
        checkForComodification(); // æ£€æŸ¥ ArrayList æ˜¯å¦è¢«ä¿®æ”¹è¿‡
        int i = cursor; // å½“å‰ç´¢å¼•
        Object[] elementData = ArrayList.this.elementData; // ArrayList ä¸­çš„å…ƒç´ æ•°ç»„
        if (i >= elementData.length) // è¶…å‡ºæ•°ç»„èŒƒå›´
            throw new ConcurrentModificationException(); // æŠ›å‡ºå¼‚å¸¸
        cursor = i + 1; // æ›´æ–°ä¸‹ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•
        return (E) elementData[lastRet = i]; // è¿”å›ä¸‹ä¸€ä¸ªå…ƒç´ 
    }
}
```

ä¹Ÿå°±æ˜¯è¯´ `new Itr()` çš„æ—¶å€™ expectedModCount è¢«èµ‹å€¼ä¸º modCountï¼Œè€Œ modCount æ˜¯ ArrayList ä¸­çš„ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºè®°å½• ArrayList å¯¹è±¡è¢«ä¿®æ”¹çš„æ¬¡æ•°ã€‚ArrayList çš„ä¿®æ”¹æ“ä½œåŒ…æ‹¬æ·»åŠ ã€åˆ é™¤ã€è®¾ç½®å…ƒç´ å€¼ç­‰ã€‚æ¯æ¬¡å¯¹ ArrayList è¿›è¡Œä¿®æ”¹æ“ä½œæ—¶ï¼ŒmodCount çš„å€¼ä¼šè‡ªå¢ 1ã€‚

åœ¨è¿­ä»£ ArrayList æ—¶ï¼Œå¦‚æœè¿­ä»£è¿‡ç¨‹ä¸­å‘ç° modCount çš„å€¼ä¸è¿­ä»£å™¨çš„ expectedModCount ä¸ä¸€è‡´ï¼Œåˆ™è¯´æ˜ ArrayList å·²è¢«ä¿®æ”¹è¿‡ï¼Œæ­¤æ—¶ä¼šæŠ›å‡º ConcurrentModificationException å¼‚å¸¸ã€‚è¿™ç§æœºåˆ¶å¯ä»¥ä¿è¯è¿­ä»£å™¨åœ¨éå† ArrayList æ—¶ï¼Œä¸ä¼šé—æ¼æˆ–é‡å¤å…ƒç´ ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ£€æµ‹åˆ°å¹¶å‘ä¿®æ”¹é—®é¢˜ã€‚

```java
protected transient int modCount = 0;
```

### åˆ†æä»£ç æ‰§è¡Œçš„é€»è¾‘

æˆ‘ä»¬æ¥ç»§ç»­å®šä½ä¹‹å‰æŠ¥é”™çš„é”™è¯¯å †æ ˆã€‚è¿™æ˜¯ä¹‹å‰çš„ä»£ç ã€‚

```java
List<String> list = new ArrayList<>();
list.add("æ²‰é»˜ç‹äºŒ");
list.add("æ²‰é»˜ç‹ä¸‰");
list.add("ä¸€ä¸ªæ–‡ç« çœŸç‰¹ä¹ˆæœ‰è¶£çš„ç¨‹åºå‘˜");

for (String str : list) {
	if ("æ²‰é»˜ç‹äºŒ".equals(str)) {
		list.remove(str);
	}
}

System.out.println(list);
```

ç”±äº list æ­¤å‰æ‰§è¡Œäº† 3 æ¬¡ add æ–¹æ³•ã€‚

- add æ–¹æ³•è°ƒç”¨ ensureCapacityInternal æ–¹æ³•
- ensureCapacityInternal æ–¹æ³•è°ƒç”¨ ensureExplicitCapacity æ–¹æ³•
- ensureExplicitCapacity æ–¹æ³•ä¸­ä¼šæ‰§è¡Œ `modCount++`

```java
private void ensureExplicitCapacity(int minCapacity) {
    modCount++;
}
```

æ‰€ä»¥ modCount çš„å€¼åœ¨ç»è¿‡ä¸‰æ¬¡ add åä¸º 3ï¼Œäºæ˜¯ `new Itr()` å expectedModCount çš„å€¼ä¹Ÿä¸º 3ï¼ˆå›åˆ°å‰é¢å»çœ‹ä¸€ä¸‹ Itr çš„æºç ï¼‰ã€‚

æ¥ç€æ¥æ‰§è¡Œ for-each çš„å¾ªç¯éå†ã€‚

æ‰§è¡Œç¬¬ä¸€æ¬¡å¾ªç¯æ—¶ï¼Œå‘ç°â€œæ²‰é»˜ç‹äºŒâ€ç­‰äº strï¼Œäºæ˜¯æ‰§è¡Œ `list.remove(str)`ã€‚

- remove æ–¹æ³•è°ƒç”¨ fastRemove æ–¹æ³•
- fastRemove æ–¹æ³•ä¸­ä¼šæ‰§è¡Œ `modCount++`

```java
private void fastRemove(int index) {
    modCount++;
}
```

modCount çš„å€¼å˜æˆäº† 4ã€‚

ç¬¬äºŒæ¬¡éå†æ—¶ï¼Œä¼šæ‰§è¡Œ Itr çš„ next æ–¹æ³•ï¼ˆ`String str = (String) var3.next();`ï¼‰ï¼Œnext æ–¹æ³•å°±ä¼šè°ƒç”¨ `checkForComodification` æ–¹æ³•ã€‚

```java
final void checkForComodification() {
    if (modCount != expectedModCount)
        throw new ConcurrentModificationException();
}
```

æ­¤æ—¶ expectedModCount ä¸º 3ï¼ŒmodCount ä¸º 4ï¼Œå°±åªå¥½æŠ›å‡º ConcurrentModificationException å¼‚å¸¸äº†ã€‚

é‚£å…¶å®åœ¨é˜¿é‡Œå·´å·´çš„ Java å¼€å‘æ‰‹å†Œé‡Œä¹Ÿæåˆ°äº†ï¼Œä¸è¦åœ¨ for-each å¾ªç¯é‡Œè¿›è¡Œå…ƒç´ çš„ remove/add æ“ä½œã€‚remove å…ƒç´ è¯·ä½¿ç”¨ Iterator æ–¹å¼ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/fail-fast-02.png)

é‚£åŸå› å…¶å®å°±æ˜¯æˆ‘ä»¬ä¸Šé¢åˆ†æçš„è¿™äº›ï¼Œå‡ºäº fail-fast ä¿æŠ¤æœºåˆ¶ã€‚

### é‚£è¯¥å¦‚ä½•æ­£ç¡®åœ°åˆ é™¤å…ƒç´ å‘¢ï¼Ÿ

#### **1ï¼‰remove å break**

```java
List<String> list = new ArrayList<>();
list.add("æ²‰é»˜ç‹äºŒ");
list.add("æ²‰é»˜ç‹ä¸‰");
list.add("ä¸€ä¸ªæ–‡ç« çœŸç‰¹ä¹ˆæœ‰è¶£çš„ç¨‹åºå‘˜");

for (String str : list) {
	if ("æ²‰é»˜ç‹äºŒ".equals(str)) {
		list.remove(str);
		break;
	}
}
```

break åå¾ªç¯å°±ä¸å†éå†äº†ï¼Œæ„å‘³ç€ Iterator çš„ next æ–¹æ³•ä¸å†æ‰§è¡Œäº†ï¼Œä¹Ÿå°±æ„å‘³ç€ `checkForComodification` æ–¹æ³•ä¸å†æ‰§è¡Œäº†ï¼Œæ‰€ä»¥å¼‚å¸¸ä¹Ÿå°±ä¸ä¼šæŠ›å‡ºäº†ã€‚

ä½†æ˜¯å‘¢ï¼Œå½“ List ä¸­æœ‰é‡å¤å…ƒç´ è¦åˆ é™¤çš„æ—¶å€™ï¼Œbreak å°±ä¸åˆé€‚äº†ã€‚


#### **2ï¼‰for å¾ªç¯**

```java
List<String> list = new ArrayList<>();
list.add("æ²‰é»˜ç‹äºŒ");
list.add("æ²‰é»˜ç‹ä¸‰");
list.add("ä¸€ä¸ªæ–‡ç« çœŸç‰¹ä¹ˆæœ‰è¶£çš„ç¨‹åºå‘˜");
for (int i = 0; i < list.size(); i++) {
	String str = list.get(i);
	if ("æ²‰é»˜ç‹äºŒ".equals(str)) {
		list.remove(str);
	}
}
```

for å¾ªç¯è™½ç„¶å¯ä»¥é¿å¼€ fail-fast ä¿æŠ¤æœºåˆ¶ï¼Œä¹Ÿå°±è¯´ remove å…ƒç´ åä¸å†æŠ›å‡ºå¼‚å¸¸ï¼›ä½†æ˜¯å‘¢ï¼Œè¿™æ®µç¨‹åºåœ¨åŸåˆ™ä¸Šæ˜¯æœ‰é—®é¢˜çš„ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

ç¬¬ä¸€æ¬¡å¾ªç¯çš„æ—¶å€™ï¼Œi ä¸º 0ï¼Œ`list.size()` ä¸º 3ï¼Œå½“æ‰§è¡Œå®Œ remove æ–¹æ³•åï¼Œi ä¸º 1ï¼Œ`list.size()` å´å˜æˆäº† 2ï¼Œå› ä¸º list çš„å¤§å°åœ¨ remove åå‘ç”Ÿäº†å˜åŒ–ï¼Œä¹Ÿå°±æ„å‘³ç€â€œæ²‰é»˜ç‹ä¸‰â€è¿™ä¸ªå…ƒç´ è¢«è·³è¿‡äº†ã€‚èƒ½æ˜ç™½å—ï¼Ÿ

remove ä¹‹å‰ `list.get(1)` ä¸ºâ€œæ²‰é»˜ç‹ä¸‰â€ï¼›ä½† remove ä¹‹å `list.get(1)` å˜æˆäº†â€œä¸€ä¸ªæ–‡ç« çœŸç‰¹ä¹ˆæœ‰è¶£çš„ç¨‹åºå‘˜â€ï¼Œè€Œ `list.get(0)` å˜æˆäº†â€œæ²‰é»˜ç‹ä¸‰â€ã€‚

#### **3ï¼‰ä½¿ç”¨ Iterator**

```java
List<String> list = new ArrayList<>();
list.add("æ²‰é»˜ç‹äºŒ");
list.add("æ²‰é»˜ç‹ä¸‰");
list.add("ä¸€ä¸ªæ–‡ç« çœŸç‰¹ä¹ˆæœ‰è¶£çš„ç¨‹åºå‘˜");

Iterator<String> itr = list.iterator();

while (itr.hasNext()) {
	String str = itr.next();
	if ("æ²‰é»˜ç‹äºŒ".equals(str)) {
		itr.remove();
	}
}
```

ä¸ºä»€ä¹ˆä½¿ç”¨ Iterator çš„ remove æ–¹æ³•å°±å¯ä»¥é¿å¼€ fail-fast ä¿æŠ¤æœºåˆ¶å‘¢ï¼Ÿçœ‹ä¸€ä¸‹ remove çš„æºç å°±æ˜ç™½äº†ã€‚

```java
public void remove() {
    if (lastRet < 0) // å¦‚æœæ²¡æœ‰ä¸Šä¸€ä¸ªè¿”å›å…ƒç´ çš„ç´¢å¼•ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸
        throw new IllegalStateException();
    checkForComodification(); // æ£€æŸ¥ ArrayList æ˜¯å¦è¢«ä¿®æ”¹è¿‡

    try {
        ArrayList.this.remove(lastRet); // åˆ é™¤ä¸Šä¸€ä¸ªè¿”å›å…ƒç´ 
        cursor = lastRet; // æ›´æ–°ä¸‹ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•
        lastRet = -1; // æ¸…ç©ºä¸Šä¸€ä¸ªè¿”å›å…ƒç´ çš„ç´¢å¼•
        expectedModCount = modCount; // æ›´æ–° ArrayList çš„ä¿®æ”¹æ¬¡æ•°
    } catch (IndexOutOfBoundsException ex) {
        throw new ConcurrentModificationException(); // æŠ›å‡ºå¼‚å¸¸
    }
}
```

åˆ é™¤å®Œä¼šæ‰§è¡Œ `expectedModCount = modCount`ï¼Œä¿è¯äº† expectedModCount ä¸ modCount çš„åŒæ­¥ã€‚

### å°ç»“

ä¸ºä»€ä¹ˆä¸èƒ½åœ¨foreaché‡Œæ‰§è¡Œåˆ é™¤æ“ä½œï¼Ÿ

å› ä¸º foreach å¾ªç¯æ˜¯åŸºäºè¿­ä»£å™¨å®ç°çš„ï¼Œè€Œè¿­ä»£å™¨åœ¨éå†é›†åˆæ—¶ä¼šç»´æŠ¤ä¸€ä¸ª expectedModCount å±æ€§æ¥è®°å½•é›†åˆè¢«ä¿®æ”¹çš„æ¬¡æ•°ã€‚å¦‚æœåœ¨ foreach å¾ªç¯ä¸­æ‰§è¡Œåˆ é™¤æ“ä½œä¼šå¯¼è‡´ expectedModCount å±æ€§å€¼ä¸å®é™…çš„ modCount å±æ€§å€¼ä¸ä¸€è‡´ï¼Œä»è€Œå¯¼è‡´è¿­ä»£å™¨çš„ hasNext() å’Œ next() æ–¹æ³•æŠ›å‡º ConcurrentModificationException å¼‚å¸¸ã€‚

ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œåº”è¯¥ä½¿ç”¨è¿­ä»£å™¨çš„ remove() æ–¹æ³•æ¥åˆ é™¤å…ƒç´ ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨åˆ é™¤å…ƒç´ åæ›´æ–°è¿­ä»£å™¨çŠ¶æ€ï¼Œç¡®ä¿å¾ªç¯çš„æ­£ç¡®æ€§ã€‚å¦‚æœéœ€è¦åœ¨å¾ªç¯ä¸­åˆ é™¤å…ƒç´ ï¼Œåº”è¯¥ä½¿ç”¨è¿­ä»£å™¨çš„ remove() æ–¹æ³•ï¼Œè€Œä¸æ˜¯é›†åˆè‡ªèº«çš„ remove() æ–¹æ³•ã€‚

å°±åƒè¿™æ ·ã€‚

```java
List<String> list = new ArrayList<>();
list.add("æ²‰é»˜ç‹äºŒ");
list.add("æ²‰é»˜ç‹ä¸‰");
list.add("ä¸€ä¸ªæ–‡ç« çœŸç‰¹ä¹ˆæœ‰è¶£çš„ç¨‹åºå‘˜");

Iterator<String> itr = list.iterator();

while (itr.hasNext()) {
	String str = itr.next();
	if ("æ²‰é»˜ç‹äºŒ".equals(str)) {
		itr.remove();
	}
}
```

é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é‡‡ç”¨ [Stream æµ](https://tobebetterjavaer.com/java8/stream.html)çš„filter() æ–¹æ³•æ¥è¿‡æ»¤é›†åˆä¸­çš„å…ƒç´ ï¼Œç„¶åå†é€šè¿‡ collect() æ–¹æ³•å°†è¿‡æ»¤åçš„å…ƒç´ æ”¶é›†åˆ°ä¸€ä¸ªæ–°çš„é›†åˆä¸­ã€‚

```java
List<String> list = new ArrayList<>(Arrays.asList("æ²‰é»˜", "ç‹äºŒ", "é™ˆæ¸…æ‰¬"));
list = list.stream().filter(s -> !s.equals("é™ˆæ¸…æ‰¬")).collect(Collectors.toList());
```

å¥½äº†ï¼Œå…³äºè¿™ä¸ªé—®é¢˜ï¼Œå°±èŠåˆ°è¿™é‡Œå§ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°ä½ ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 6.9 HashMapè¯¦è§£ï¼ˆé™„æºç ï¼‰

è¿™ç¯‡æ–‡ç« å°†é€šè¿‡æºç çš„æ–¹å¼ï¼Œè¯¦ç»†é€å½»åœ°è®²æ¸…æ¥š Java çš„ HashMapï¼ŒåŒ…æ‹¬ hash æ–¹æ³•çš„åŸç†ã€HashMap çš„æ‰©å®¹æœºåˆ¶ã€HashMapçš„åŠ è½½å› å­ä¸ºä»€ä¹ˆæ˜¯ 0.75 è€Œä¸æ˜¯ 0.6ã€0.8ï¼Œä»¥åŠ HashMap ä¸ºä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼ŒåŸºæœ¬ä¸Š HashMap çš„[å¸¸è§é¢è¯•é¢˜](https://tobebetterjavaer.com/interview/java-hashmap-13.html)ï¼Œéƒ½ä¼šåœ¨è¿™ä¸€ç¯‡æ–‡ç« é‡Œè®²æ˜ç™½ã€‚

HashMap æ˜¯ Java ä¸­å¸¸ç”¨çš„æ•°æ®ç»“æ„ä¹‹ä¸€ï¼Œç”¨äºå­˜å‚¨é”®å€¼å¯¹ã€‚åœ¨ HashMap ä¸­ï¼Œæ¯ä¸ªé”®éƒ½æ˜ å°„åˆ°ä¸€ä¸ªå”¯ä¸€çš„å€¼ï¼Œå¯ä»¥é€šè¿‡é”®æ¥å¿«é€Ÿè®¿é—®å¯¹åº”çš„å€¼ã€‚

HashMap ä¸ä»…åœ¨æ—¥å¸¸å¼€å‘ä¸­ç»å¸¸ç”¨åˆ°ï¼Œåœ¨é¢è¯•ä¸­ä¹Ÿæ˜¯é‡ç‚¹è€ƒå¯Ÿçš„å¯¹è±¡ã€‚

ä»¥ä¸‹æ˜¯ HashMap å¢åˆ æ”¹æŸ¥çš„ç®€å•ä¾‹å­ï¼š

**1ï¼‰å¢åŠ å…ƒç´ **ï¼š

å°†ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆå…ƒç´ ï¼‰æ·»åŠ åˆ° HashMap ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ put() æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå°†åå­—å’Œå¹´é¾„ä½œä¸ºé”®å€¼å¯¹æ·»åŠ åˆ° HashMap ä¸­ï¼š

```java
HashMap<String, Integer> map = new HashMap<>();
map.put("æ²‰é»˜", 20);
map.put("ç‹äºŒ", 25);
```

**2ï¼‰åˆ é™¤å…ƒç´ **ï¼š

ä» HashMap ä¸­åˆ é™¤ä¸€ä¸ªé”®å€¼å¯¹ï¼Œå¯ä»¥ä½¿ç”¨ remove() æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œåˆ é™¤åå­—ä¸º "æ²‰é»˜" çš„é”®å€¼å¯¹ï¼š

```java
map.remove("æ²‰é»˜");
```

**3ï¼‰ä¿®æ”¹å…ƒç´ **ï¼š

ä¿®æ”¹ HashMap ä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ï¼Œå¯ä»¥ä½¿ç”¨ put() æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå°†åå­—ä¸º "æ²‰é»˜" çš„å¹´é¾„ä¿®æ”¹ä¸º 30ï¼š

```java
map.put("æ²‰é»˜", 30);
```

ä¸ºä»€ä¹ˆå’Œæ·»åŠ å…ƒç´ çš„æ–¹æ³•ä¸€æ ·å‘¢ï¼Ÿè¿™ä¸ªæˆ‘ä»¬åé¢ä¼šè®²ï¼Œå…ˆç®€å•è¯´ä¸€ä¸‹ï¼Œæ˜¯å› ä¸º HashMap çš„é”®æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥å†æ¬¡ put çš„æ—¶å€™ä¼šè¦†ç›–æ‰ä¹‹å‰çš„é”®å€¼å¯¹ã€‚

**4ï¼‰æŸ¥æ‰¾å…ƒç´ **ï¼š

ä» HashMap ä¸­æŸ¥æ‰¾ä¸€ä¸ªé”®å¯¹åº”çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ get() æ–¹æ³•ã€‚ä¾‹å¦‚ï¼ŒæŸ¥æ‰¾åå­—ä¸º "æ²‰é»˜" çš„å¹´é¾„ï¼š

```java
int age = map.get("æ²‰é»˜");
```

åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒHashMap å¯ä»¥ç”¨äºç¼“å­˜ã€ç´¢å¼•ç­‰åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†ç”¨æˆ· ID ä½œä¸ºé”®ï¼Œç”¨æˆ·ä¿¡æ¯ä½œä¸ºå€¼ï¼Œå°†ç”¨æˆ·ä¿¡æ¯ç¼“å­˜åˆ° HashMap ä¸­ï¼Œä»¥ä¾¿å¿«é€ŸæŸ¥æ‰¾ã€‚åˆå¦‚ï¼Œå¯ä»¥å°†å…³é”®å­—ä½œä¸ºé”®ï¼Œæ–‡æ¡£ ID åˆ—è¡¨ä½œä¸ºå€¼ï¼Œå°†æ–‡æ¡£ç´¢å¼•ç¼“å­˜åˆ° HashMap ä¸­ï¼Œä»¥ä¾¿å¿«é€Ÿæœç´¢æ–‡æ¡£ã€‚

HashMap çš„å®ç°åŸç†æ˜¯åŸºäºå“ˆå¸Œè¡¨çš„ï¼Œå®ƒçš„åº•å±‚æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸ªä½ç½®å¯èƒ½æ˜¯ä¸€ä¸ªé“¾è¡¨æˆ–çº¢é»‘æ ‘ï¼Œä¹Ÿå¯èƒ½åªæ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆåé¢ä¼šè®²ï¼‰ã€‚å½“æ·»åŠ ä¸€ä¸ªé”®å€¼å¯¹æ—¶ï¼ŒHashMap ä¼šæ ¹æ®é”®çš„å“ˆå¸Œå€¼è®¡ç®—å‡ºè¯¥é”®å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ï¼ˆç´¢å¼•ï¼‰ï¼Œç„¶åå°†é”®å€¼å¯¹æ’å…¥åˆ°å¯¹åº”çš„ä½ç½®ã€‚

å½“é€šè¿‡é”®æŸ¥æ‰¾å€¼æ—¶ï¼ŒHashMap ä¹Ÿä¼šæ ¹æ®é”®çš„å“ˆå¸Œå€¼è®¡ç®—å‡ºæ•°ç»„ä¸‹æ ‡ï¼Œå¹¶æŸ¥æ‰¾å¯¹åº”çš„å€¼ã€‚

### 01ã€hashæ–¹æ³•çš„åŸç†

ç®€å•äº†è§£ HashMap åï¼Œæˆ‘ä»¬æ¥è®¨è®ºç¬¬ä¸€ä¸ªé—®é¢˜ï¼šhash æ–¹æ³•çš„åŸç†ï¼Œå¯¹åƒé€ HashMap ä¼šå¤§æœ‰å¸®åŠ©ã€‚

æ¥çœ‹ä¸€ä¸‹ hash æ–¹æ³•çš„æºç ï¼ˆJDK 8 ä¸­çš„ HashMapï¼‰ï¼š

```java
static final int hash(Object key) {
    int h;
    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
}
```

è¿™æ®µä»£ç ç©¶ç«Ÿæ˜¯ç”¨æ¥å¹²å˜›çš„å‘¢ï¼Ÿ

**å°† key çš„ hashCode å€¼è¿›è¡Œå¤„ç†ï¼Œå¾—åˆ°æœ€ç»ˆçš„å“ˆå¸Œå€¼**ã€‚

æ€ä¹ˆç†è§£è¿™å¥è¯å‘¢ï¼Ÿä¸è¦ç€æ€¥ã€‚

æˆ‘ä»¬æ¥ new ä¸€ä¸ª HashMapï¼Œå¹¶é€šè¿‡ put æ–¹æ³•æ·»åŠ ä¸€ä¸ªå…ƒç´ ã€‚

```java
HashMap<String, String> map = new HashMap<>();
map.put("chenmo", "æ²‰é»˜");
```

æ¥çœ‹ä¸€ä¸‹ put æ–¹æ³•çš„æºç ã€‚

```java
public V put(K key, V value) {
    return putVal(hash(key), key, value, false, true);
}
```

çœ‹åˆ° hash æ–¹æ³•çš„èº«å½±äº†å§ï¼Ÿ

#### hash æ–¹æ³•çš„ä½œç”¨

å‰é¢ä¹Ÿè¯´äº†ï¼ŒHashMap çš„åº•å±‚æ˜¯é€šè¿‡æ•°ç»„çš„å½¢å¼å®ç°çš„ï¼Œåˆå§‹å¤§å°æ˜¯ 16ï¼ˆè¿™ä¸ªåé¢ä¼šè®²ï¼‰ï¼Œå…ˆè®°ä½ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼ŒHashMap åœ¨æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡é”®çš„å“ˆå¸Œç åœ¨å¤§å°ä¸º 16 çš„æ•°ç»„ä¸­ç¡®å®šä¸€ä¸ªä½ç½®ï¼ˆç´¢å¼•ï¼‰ï¼Œæ€ä¹ˆç¡®å®šå‘¢ï¼Ÿ

ä¸ºäº†æ–¹ä¾¿å¤§å®¶ç›´è§‚çš„æ„Ÿå—ï¼Œæˆ‘è¿™é‡Œç”»äº†ä¸€å‰¯å›¾ï¼Œ16 ä¸ªæ–¹æ ¼å­ï¼ˆå¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªä¸€ä¸ªæ¡¶ï¼‰ï¼Œæ¯ä¸ªæ ¼å­éƒ½æœ‰ä¸€ä¸ªç¼–å·ï¼Œå¯¹åº”å¤§å°ä¸º 16 çš„æ•°ç»„ä¸‹æ ‡ï¼ˆç´¢å¼•ï¼‰ã€‚

![](https://files.mdnice.com/user/3903/65e8110b-71b1-4146-b2fa-7fc4ee8530af.png)

ç°åœ¨ï¼Œæˆ‘ä»¬è¦æŠŠ key ä¸º â€œchenmoâ€ï¼Œvalue ä¸ºâ€œæ²‰é»˜â€çš„é”®å€¼å¯¹æ”¾åˆ°è¿™ 16 ä¸ªæ ¼å­ä¸­çš„ä¸€ä¸ªã€‚

æ€ä¹ˆç¡®å®šä½ç½®ï¼ˆç´¢å¼•ï¼‰å‘¢ï¼Ÿ

æˆ‘å…ˆå‘Šè¯‰å¤§å®¶ç»“è®ºï¼Œé€šè¿‡è¿™ä¸ªä¸è¿ç®— `(n - 1) & hash`ï¼Œå…¶ä¸­å˜é‡ n ä¸ºæ•°ç»„çš„é•¿åº¦ï¼Œå˜é‡ hash å°±æ˜¯é€šè¿‡ `hash()` æ–¹æ³•è®¡ç®—åçš„ç»“æœã€‚

é‚£â€œchenmoâ€è¿™ä¸ª key è®¡ç®—åçš„ä½ç½®ï¼ˆç´¢å¼•ï¼‰æ˜¯å¤šå°‘å‘¢ï¼Ÿ

ç­”æ¡ˆæ˜¯ 8ï¼Œä¹Ÿå°±æ˜¯è¯´ `map.put("chenmo", "æ²‰é»˜")` ä¼šæŠŠkey ä¸º â€œchenmoâ€ï¼Œvalue ä¸ºâ€œæ²‰é»˜â€çš„é”®å€¼å¯¹æ”¾åˆ°ä¸‹æ ‡ä¸º 8 çš„ä½ç½®ä¸Šï¼ˆä¹Ÿå°±æ˜¯ç´¢å¼•ä¸º 8 çš„æ¡¶ä¸Šï¼‰ã€‚

![](https://files.mdnice.com/user/3903/e23299c2-a11f-4f0f-a4e5-138fa1fdb331.png)

è¿™æ ·å¤§å®¶å°±ä¼šå¯¹ HashMap å­˜æ”¾é”®å€¼å¯¹ï¼ˆå…ƒç´ ï¼‰çš„æ—¶å€™æœ‰ä¸€ä¸ªå¤§è‡´çš„å°è±¡ã€‚å…¶ä¸­çš„ä¸€ç‚¹æ˜¯ï¼Œhash æ–¹æ³•å¯¹è®¡ç®—é”®å€¼å¯¹çš„ä½ç½®èµ·åˆ°äº†è‡³å…³é‡è¦çš„ä½œç”¨ã€‚

å›åˆ° hash æ–¹æ³•ï¼š

```java
static final int hash(Object key) {
    int h;
    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
}
```

ä¸‹é¢æ˜¯å¯¹è¯¥æ–¹æ³•çš„ä¸€äº›è§£é‡Šï¼š

- å‚æ•° keyï¼šéœ€è¦è®¡ç®—å“ˆå¸Œç çš„é”®å€¼ã€‚
- `key == null ? 0 : (h = key.hashCode()) ^ (h >>> 16)`ï¼šè¿™æ˜¯ä¸€ä¸ªä¸‰ç›®è¿ç®—ç¬¦ï¼Œå¦‚æœé”®å€¼ä¸ºnullï¼Œåˆ™å“ˆå¸Œç ä¸º0ï¼ˆä¾æ—§æ˜¯è¯´å¦‚æœé”®ä¸º nullï¼Œåˆ™å­˜æ”¾åœ¨ç¬¬ä¸€ä¸ªä½ç½®ï¼‰ï¼›å¦åˆ™ï¼Œé€šè¿‡è°ƒç”¨`hashCode()`æ–¹æ³•è·å–é”®çš„å“ˆå¸Œç ï¼Œå¹¶å°†å…¶ä¸å³ç§»16ä½çš„å“ˆå¸Œç è¿›è¡Œå¼‚æˆ–è¿ç®—ã€‚
- `^` è¿ç®—ç¬¦ï¼šå¼‚æˆ–è¿ç®—ç¬¦æ˜¯Javaä¸­çš„ä¸€ç§ä½è¿ç®—ç¬¦ï¼Œå®ƒç”¨äºå°†ä¸¤ä¸ªæ•°çš„äºŒè¿›åˆ¶ä½è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒåˆ™ä¸º0ï¼Œä¸åŒåˆ™ä¸º1ã€‚
- `h >>> 16`ï¼šå°†å“ˆå¸Œç å‘å³ç§»åŠ¨16ä½ï¼Œç›¸å½“äºå°†åŸæ¥çš„å“ˆå¸Œç åˆ†æˆäº†ä¸¤ä¸ª16ä½çš„éƒ¨åˆ†ã€‚
- æœ€ç»ˆè¿”å›çš„æ˜¯ç»è¿‡å¼‚æˆ–è¿ç®—åå¾—åˆ°çš„å“ˆå¸Œç å€¼ã€‚

è¿™çŸ­çŸ­çš„ä¸€è¡Œä»£ç ï¼Œæ±‡èšä¸å°‘è®¡ç®—æœºå·¨ä½¬ä»¬çš„èªæ˜æ‰æ™ºã€‚

ç†è®ºä¸Šï¼Œå“ˆå¸Œå€¼ï¼ˆå“ˆå¸Œç ï¼‰æ˜¯ä¸€ä¸ª int ç±»å‹ï¼ŒèŒƒå›´ä»-2147483648 åˆ° 2147483648ã€‚å‰ååŠ èµ·æ¥å¤§æ¦‚ 40 äº¿çš„æ˜ å°„ç©ºé—´ï¼Œåªè¦å“ˆå¸Œå€¼æ˜ å°„å¾—æ¯”è¾ƒå‡åŒ€æ¾æ•£ï¼Œä¸€èˆ¬æ˜¯ä¸ä¼šå‡ºç°å“ˆå¸Œç¢°æ’ï¼ˆå“ˆå¸Œå†²çªä¼šé™ä½ HashMap çš„æ•ˆç‡ï¼‰ã€‚

ä½†é—®é¢˜æ˜¯ä¸€ä¸ª 40 äº¿é•¿åº¦çš„æ•°ç»„ï¼Œå†…å­˜æ˜¯æ”¾ä¸ä¸‹çš„ã€‚HashMap æ‰©å®¹ä¹‹å‰çš„æ•°ç»„åˆå§‹å¤§å°åªæœ‰ 16ï¼Œæ‰€ä»¥è¿™ä¸ªå“ˆå¸Œå€¼æ˜¯ä¸èƒ½ç›´æ¥æ‹¿æ¥ç”¨çš„ï¼Œç”¨ä¹‹å‰è¦å’Œæ•°ç»„çš„é•¿åº¦åšå–æ¨¡è¿ç®—ï¼ˆå‰æ–‡æåˆ°çš„ `(n - 1) & hash`ï¼‰ï¼Œç”¨å¾—åˆ°çš„ä½™æ•°æ¥è®¿é—®æ•°ç»„ä¸‹æ ‡æ‰è¡Œã€‚

#### å–æ¨¡è¿ç®—

å–æ¨¡è¿ç®—ï¼ˆï¼ˆâ€œModulo Operationâ€ï¼‰ï¼‰å’Œå–ä½™è¿ç®—ï¼ˆï¼ˆâ€œRemainder Operation â€ï¼‰ï¼‰æ˜¯ä¸¤ç§ä¸åŒçš„è¿ç®—æ–¹å¼ï¼Œå®ƒä»¬åœ¨è®¡ç®—æœºä¸­çš„å®ç°ä¹Ÿä¸åŒã€‚

åœ¨æ•°å­¦ä¸­ï¼Œå–æ¨¡è¿ç®—å’Œå–ä½™è¿ç®—æ˜¯ç­‰ä»·çš„ï¼Œéƒ½æ˜¯è®¡ç®—ä¸€ä¸ªæ•°é™¤ä»¥å¦ä¸€ä¸ªæ•°çš„ä½™æ•°ã€‚ä¾‹å¦‚ï¼Œ10 mod 3 å’Œ 10 % 3 éƒ½ç­‰äº 1ï¼Œå› ä¸º 10 é™¤ä»¥ 3 çš„ä½™æ•°æ˜¯ 1ã€‚

åœ¨è®¡ç®—æœºä¸­ï¼Œå–æ¨¡è¿ç®—å’Œå–ä½™è¿ç®—çš„å·®åˆ«åœ¨äºï¼Œå½“è¢«é™¤æ•°ä¸ºè´Ÿæ•°æ—¶ï¼Œ**å–æ¨¡è¿ç®—çš„ç»“æœç¬¦å·ä¸è¢«é™¤æ•°ç›¸åŒï¼Œå–ä½™è¿ç®—çš„ç»“æœç¬¦å·ä¸é™¤æ•°ç›¸åŒ**ã€‚

ä¾‹å¦‚ï¼Œ-10 mod 3 çš„ç»“æœæ˜¯ -1ï¼Œè€Œ -10 % 3 çš„ç»“æœæ˜¯ 2ï¼Œå› ä¸º -10 é™¤ä»¥ 3 çš„ä½™æ•°æ˜¯ -1ï¼Œæ‰€ä»¥ -10 å–æ¨¡ 3 çš„ç»“æœåº”è¯¥æ˜¯ -1ï¼›è€Œ -10 å¯¹ 3 å–ä½™çš„ç»“æœæ˜¯ 2ï¼Œå› ä¸ºï¼š-10 Ã· 3 = -3 ä½™ -1ï¼Œç”±äºé™¤æ•°ä¸ºæ­£æ•° 3ï¼Œä½™æ•°çš„ç¬¦å·åº”ä¸è¢«é™¤æ•°çš„ç¬¦å·ç›¸åŒï¼Œå› æ­¤ä½™æ•°åº”ä¸ºæ­£æ•° 2ï¼Œè€Œä¸æ˜¯ -1ã€‚

åœ¨ Java ä¸­ï¼Œå–æ¨¡è¿ç®—ä½¿ç”¨ % è¿ç®—ç¬¦ï¼Œå–ä½™è¿ç®—ä½¿ç”¨ `Math.floorMod()` æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œè®¡ç®— -10 mod 3 å’Œ -10 % 3 çš„ç»“æœï¼š

```java
int a = -10 % 3; // a = -1
int b = Math.floorMod(-10, 3); // b = 2
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ•°å­¦ä¸­ï¼Œå–æ¨¡è¿ç®—å’Œå–ä½™è¿ç®—éƒ½æœ‰å®šä¹‰åŸŸçš„é™åˆ¶ï¼Œå³é™¤æ•°ä¸èƒ½ä¸º 0ã€‚åœ¨è®¡ç®—æœºä¸­ï¼Œé™¤æ•°ä¸º 0 ä¼šæŠ›å‡ºå¼‚å¸¸æˆ–è¿”å› NaNï¼ˆNot a Numberï¼‰ã€‚

HashMap çš„å–æ¨¡è¿ç®—æœ‰ä¸¤å¤„ã€‚

ä¸€å¤„æ˜¯å¾€ HashMap ä¸­ put çš„æ—¶å€™ï¼ˆä¼šè°ƒç”¨ç§æœ‰çš„ `putVal` æ–¹æ³•ï¼‰ï¼š

```java
final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) {
    // æ•°ç»„
    HashMap.Node<K,V>[] tab; 
    // å…ƒç´ 
    HashMap.Node<K,V> p; 

    // n ä¸ºæ•°ç»„çš„é•¿åº¦ i ä¸ºä¸‹æ ‡
    int n, i;
    // æ•°ç»„ä¸ºç©ºçš„æ—¶å€™
    if ((tab = table) == null || (n = tab.length) == 0)
        // ç¬¬ä¸€æ¬¡æ‰©å®¹åçš„æ•°ç»„é•¿åº¦
        n = (tab = resize()).length;
    // è®¡ç®—èŠ‚ç‚¹çš„æ’å…¥ä½ç½®ï¼Œå¦‚æœè¯¥ä½ç½®ä¸ºç©ºï¼Œåˆ™æ–°å»ºä¸€ä¸ªèŠ‚ç‚¹æ’å…¥
    if ((p = tab[i = (n - 1) & hash]) == null)
        tab[i] = newNode(hash, key, value, null);
}
```

å…¶ä¸­ `(n - 1) & hash` ä¸ºå–æ¨¡è¿ç®—ï¼Œä¸ºä»€ä¹ˆæ²¡ç”¨ `%`ï¼Œæˆ‘ä»¬éšåè§£é‡Šã€‚

ä¸€å¤„æ˜¯ä» HashMap ä¸­ get çš„æ—¶å€™ï¼ˆä¼šè°ƒç”¨ `getNode` æ–¹æ³•ï¼‰ï¼š

```java
final Node<K,V> getNode(int hash, Object key) {
    // è·å–å½“å‰çš„æ•°ç»„å’Œé•¿åº¦ï¼Œä»¥åŠå½“å‰èŠ‚ç‚¹é“¾è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæ ¹æ®ç´¢å¼•ç›´æ¥ä»æ•°ç»„ä¸­æ‰¾ï¼‰
    Node<K,V>[] tab; 
    Node<K,V> first, e; 
    int n; 
    K k;
    if ((tab = table) != null && (n = tab.length) > 0 &&
            (first = tab[(n - 1) & hash]) != null) {
        // å¦‚æœç¬¬ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯è¦æŸ¥æ‰¾çš„èŠ‚ç‚¹ï¼Œåˆ™ç›´æ¥è¿”å›
        if (first.hash == hash && ((k = first.key) == key || (key != null && key.equals(k))))
            return first;
        // å¦‚æœç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸æ˜¯è¦æŸ¥æ‰¾çš„èŠ‚ç‚¹ï¼Œåˆ™éå†èŠ‚ç‚¹é“¾è¡¨æŸ¥æ‰¾
        if ((e = first.next) != null) {
            do {
                if (e.hash == hash && ((k = e.key) == key || (key != null && key.equals(k))))
                    return e;
            } while ((e = e.next) != null);
        }
    }
    // å¦‚æœèŠ‚ç‚¹é“¾è¡¨ä¸­æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„èŠ‚ç‚¹ï¼Œåˆ™è¿”å› null
    return null;
}
```

çœ‹åˆ°æ²¡ï¼Œå–æ¨¡è¿ç®— `(n - 1) & hash` å†æ¬¡å‡ºç°ï¼Œè¯´ç®€å•ç‚¹ï¼Œå°±æ˜¯æŠŠé”®çš„å“ˆå¸Œç ç»è¿‡ `hash()` æ–¹æ³•è®¡ç®—åï¼Œå†å’Œï¼ˆæ•°ç»„é•¿åº¦-1ï¼‰åšäº†ä¸€ä¸ªâ€œä¸â€è¿ç®—ã€‚

#### å–æ¨¡è¿ç®—%å’Œä½è¿ç®—&

å¯èƒ½å¤§å®¶åœ¨ç–‘æƒ‘ï¼š**å–æ¨¡è¿ç®—éš¾é“ä¸è¯¥ç”¨ `%` å—ï¼Ÿä¸ºä»€ä¹ˆè¦ç”¨ä½è¿ç®— `&` å‘¢**ï¼Ÿ

è¿™æ˜¯å› ä¸º `&` è¿ç®—æ¯” `%` æ›´åŠ é«˜æ•ˆï¼Œå¹¶ä¸”å½“ b ä¸º 2 çš„ n æ¬¡æ–¹æ—¶ï¼Œå­˜åœ¨ä¸‹é¢è¿™æ ·ä¸€ä¸ªå…¬å¼ã€‚

> a % b = a & (b-1)

ç”¨ $2^n$ æ›¿æ¢ä¸‹ b å°±æ˜¯ï¼š

>a % $2^n$ = a & ($2^n$-1)

æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ï¼Œå‡å¦‚ a = 14ï¼Œb = 8ï¼Œä¹Ÿå°±æ˜¯ $2^3$ï¼Œn=3ã€‚

14%8ï¼ˆä½™æ•°ä¸º 6ï¼‰ã€‚

14 çš„äºŒè¿›åˆ¶ä¸º 1110ï¼Œ8 çš„äºŒè¿›åˆ¶ 1000ï¼Œ8-1 = 7ï¼Œ7 çš„äºŒè¿›åˆ¶ä¸º 0111ï¼Œ1110&0111=0110ï¼Œä¹Ÿå°±æ˜¯ 0`*`$2^0$+1`*`$2^1$+1`*`$2^2$+0`*`$2^3$=0+2+4+0=6ï¼Œ14%8 åˆšå¥½ä¹Ÿç­‰äº 6ã€‚

å®³ï¼Œè®¡ç®—æœºå°±æ˜¯è¿™ä¹ˆè®²é“ç†ï¼Œæ²¡åŠæ³•ï¼ŒğŸ˜

è¿™ä¹Ÿæ­£å¥½è§£é‡Šäº†ä¸ºä»€ä¹ˆ HashMap çš„æ•°ç»„é•¿åº¦è¦å– 2 çš„æ•´æ¬¡æ–¹ã€‚

ä¸ºä»€ä¹ˆä¼šè¿™æ ·å·§å‘¢ï¼Ÿ

å› ä¸ºï¼ˆæ•°ç»„é•¿åº¦-1ï¼‰æ­£å¥½ç›¸å½“äºä¸€ä¸ªâ€œä½ä½æ©ç â€â€”â€”è¿™ä¸ªæ©ç çš„ä½ä½æœ€å¥½å…¨æ˜¯ 1ï¼Œè¿™æ · & æ“ä½œæ‰æœ‰æ„ä¹‰ï¼Œå¦åˆ™ç»“æœå°±è‚¯å®šæ˜¯ 0ï¼Œé‚£ä¹ˆ & æ“ä½œå°±æ²¡æœ‰æ„ä¹‰äº†ã€‚

> a&b æ“ä½œçš„ç»“æœæ˜¯ï¼šaã€b ä¸­å¯¹åº”ä½åŒæ—¶ä¸º 1ï¼Œåˆ™å¯¹åº”ç»“æœä½ä¸º 1ï¼Œå¦åˆ™ä¸º 0

2 çš„æ•´æ¬¡å¹‚åˆšå¥½æ˜¯å¶æ•°ï¼Œå¶æ•°-1 æ˜¯å¥‡æ•°ï¼Œå¥‡æ•°çš„äºŒè¿›åˆ¶æœ€åä¸€ä½æ˜¯ 1ï¼Œä¿è¯äº† hash &(length-1) çš„æœ€åä¸€ä½å¯èƒ½ä¸º 0ï¼Œä¹Ÿå¯èƒ½ä¸º 1ï¼ˆè¿™å–å†³äº h çš„å€¼ï¼‰ï¼Œå³ & è¿ç®—åçš„ç»“æœå¯èƒ½ä¸ºå¶æ•°ï¼Œä¹Ÿå¯èƒ½ä¸ºå¥‡æ•°ï¼Œè¿™æ ·ä¾¿å¯ä»¥ä¿è¯å“ˆå¸Œå€¼çš„å‡åŒ€æ€§ã€‚

& æ“ä½œçš„ç»“æœå°±æ˜¯å°†å“ˆå¸Œå€¼çš„é«˜ä½å…¨éƒ¨å½’é›¶ï¼Œåªä¿ç•™ä½ä½å€¼ï¼Œç”¨æ¥åšæ•°ç»„ä¸‹æ ‡è®¿é—®ã€‚

å‡è®¾æŸå“ˆå¸Œå€¼ä¸º `10100101 11000100 00100101`ï¼Œç”¨å®ƒæ¥åšå–æ¨¡è¿ç®—ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç»“æœã€‚HashMap çš„åˆå§‹é•¿åº¦ä¸º 16ï¼ˆå†…éƒ¨æ˜¯æ•°ç»„ï¼‰ï¼Œ16-1=15ï¼ŒäºŒè¿›åˆ¶æ˜¯ `00000000 00000000 00001111`ï¼ˆé«˜ä½ç”¨ 0 æ¥è¡¥é½ï¼‰ï¼š

```
	 10100101 11000100 00100101
&	00000000 00000000 00001111
----------------------------------
	 00000000 00000000 00000101
```

å› ä¸º 15 çš„é«˜ä½å…¨éƒ¨æ˜¯ 0ï¼Œæ‰€ä»¥ & è¿ç®—åçš„é«˜ä½ç»“æœè‚¯å®šæ˜¯ 0ï¼Œåªå‰©ä¸‹ 4 ä¸ªä½ä½ `0101`ï¼Œä¹Ÿå°±æ˜¯åè¿›åˆ¶çš„ 5ï¼Œä¹Ÿå°±æ˜¯å°†å“ˆå¸Œå€¼ä¸º `10100101 11000100 00100101` çš„é”®æ”¾åœ¨æ•°ç»„çš„ç¬¬ 5 ä½ã€‚

å½“ç„¶äº†ï¼Œå¦‚æœä½ æ˜¯æ–°æ‰‹ï¼Œä¸Šé¢è¿™äº› 01 ä¸²æ²¡çœ‹æ‡‚ï¼Œä¹Ÿæ²¡å…³ç³»ï¼Œè®°ä½å–æ¨¡è¿ç®—å°±è¡Œäº†ï¼Œè®°ä¸ä½å–æ¨¡è¿ç®—ä¹Ÿæ²¡å…³ç³»ï¼Œè®°ä½**å–æ¨¡è¿ç®—æ˜¯ä¸ºäº†è®¡ç®—æ•°ç»„çš„ä¸‹æ ‡å°±å¯ä»¥äº†**ã€‚

- put çš„æ—¶å€™è®¡ç®—ä¸‹æ ‡ï¼ŒæŠŠé”®å€¼å¯¹æ”¾åˆ°å¯¹åº”çš„æ¡¶ä¸Šã€‚
- get çš„æ—¶å€™é€šè¿‡ä¸‹æ ‡ï¼ŒæŠŠé”®å€¼å¯¹ä»å¯¹åº”çš„æ¡¶ä¸Šå–å‡ºæ¥ã€‚

#### ä¸ºä»€ä¹ˆå–æ¨¡è¿ç®—ä¹‹å‰è¦è°ƒç”¨ hash æ–¹æ³•å‘¢ï¼Ÿ

çœ‹ä¸‹é¢è¿™ä¸ªå›¾ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hash-01.png)

æŸå“ˆå¸Œå€¼ä¸º `11111111 11111111 11110000 1110 1010`ï¼Œå°†å®ƒå³ç§» 16 ä½ï¼ˆh >>> 16ï¼‰ï¼Œåˆšå¥½æ˜¯ `00000000 00000000 11111111 11111111`ï¼Œå†è¿›è¡Œå¼‚æˆ–æ“ä½œï¼ˆh ^ (h >>> 16)ï¼‰ï¼Œç»“æœæ˜¯ `11111111 11111111 00001111 00010101`

> å¼‚æˆ–ï¼ˆ`^`ï¼‰è¿ç®—æ˜¯åŸºäºäºŒè¿›åˆ¶çš„ä½è¿ç®—ï¼Œé‡‡ç”¨ç¬¦å· XOR æˆ–è€…`^`æ¥è¡¨ç¤ºï¼Œè¿ç®—è§„åˆ™æ˜¯ï¼šå¦‚æœæ˜¯åŒå€¼å– 0ã€å¼‚å€¼å– 1

ç”±äºæ··åˆäº†åŸæ¥å“ˆå¸Œå€¼çš„é«˜ä½å’Œä½ä½ï¼Œæ‰€ä»¥ä½ä½çš„éšæœºæ€§åŠ å¤§äº†ï¼ˆæºæ‚äº†éƒ¨åˆ†é«˜ä½çš„ç‰¹å¾ï¼Œé«˜ä½çš„ä¿¡æ¯ä¹Ÿå¾—åˆ°äº†ä¿ç•™ï¼‰ã€‚

ç»“æœå†ä¸æ•°ç»„é•¿åº¦-1ï¼ˆ`00000000 00000000 00000000 00001111`ï¼‰åšå–æ¨¡è¿ç®—ï¼Œå¾—åˆ°çš„ä¸‹æ ‡å°±æ˜¯ `00000000 00000000 00000000 00000101`ï¼Œä¹Ÿå°±æ˜¯ 5ã€‚

è¿˜è®°å¾—ä¹‹å‰æˆ‘ä»¬å‡è®¾çš„æŸå“ˆå¸Œå€¼ `10100101 11000100 00100101` å—ï¼Ÿåœ¨æ²¡æœ‰è°ƒç”¨ hash æ–¹æ³•ä¹‹å‰ï¼Œä¸ 15 åšå–æ¨¡è¿ç®—åçš„ç»“æœä¹Ÿæ˜¯ 5ï¼Œæˆ‘ä»¬ä¸å¦¨æ¥çœ‹çœ‹è°ƒç”¨ hash ä¹‹åçš„å–æ¨¡è¿ç®—ç»“æœæ˜¯å¤šå°‘ã€‚

æŸå“ˆå¸Œå€¼ `00000000 10100101 11000100 00100101`ï¼ˆè¡¥é½ 32 ä½ï¼‰ï¼Œå°†å®ƒå³ç§» 16 ä½ï¼ˆh >>> 16ï¼‰ï¼Œåˆšå¥½æ˜¯ `00000000 00000000 00000000 10100101`ï¼Œå†è¿›è¡Œå¼‚æˆ–æ“ä½œï¼ˆh ^ (h >>> 16)ï¼‰ï¼Œç»“æœæ˜¯ `00000000 10100101 00111011 10000000`

ç»“æœå†ä¸æ•°ç»„é•¿åº¦-1ï¼ˆ`00000000 00000000 00000000 00001111`ï¼‰åšå–æ¨¡è¿ç®—ï¼Œå¾—åˆ°çš„ä¸‹æ ‡å°±æ˜¯ `00000000 00000000 00000000 00000000`ï¼Œä¹Ÿå°±æ˜¯ 0ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼Œ**hash æ–¹æ³•æ˜¯ç”¨æ¥åšå“ˆå¸Œå€¼ä¼˜åŒ–çš„**ï¼ŒæŠŠå“ˆå¸Œå€¼å³ç§» 16 ä½ï¼Œä¹Ÿå°±æ­£å¥½æ˜¯è‡ªå·±é•¿åº¦çš„ä¸€åŠï¼Œä¹‹åä¸åŸå“ˆå¸Œå€¼åšå¼‚æˆ–è¿ç®—ï¼Œè¿™æ ·å°±æ··åˆäº†åŸå“ˆå¸Œå€¼ä¸­çš„é«˜ä½å’Œä½ä½ï¼Œå¢å¤§äº†éšæœºæ€§ã€‚

è¯´ç™½äº†ï¼Œ**hash æ–¹æ³•å°±æ˜¯ä¸ºäº†å¢åŠ éšæœºæ€§ï¼Œè®©æ•°æ®å…ƒç´ æ›´åŠ å‡è¡¡çš„åˆ†å¸ƒï¼Œå‡å°‘ç¢°æ’**ã€‚

æˆ‘è¿™é‡Œå†™äº†ä¸€æ®µæµ‹è¯•ä»£ç ï¼Œå‡å¦‚ HashMap çš„å®¹é‡å°±æ˜¯ç¬¬ä¸€æ¬¡æ‰©å®¹æ—¶å€™çš„ 16ï¼Œæˆ‘åœ¨é‡Œé¢æ”¾äº†äº”ä¸ªé”®å€¼å¯¹ï¼Œæ¥çœ‹ä¸€ä¸‹é”®çš„ hash å€¼ï¼ˆç»è¿‡ `hash()` æ–¹æ³•è®¡ç®—åçš„å“ˆå¸Œç ï¼‰å’Œç´¢å¼•ï¼ˆå–æ¨¡è¿ç®—åï¼‰

```java
HashMap<String, String> map = new HashMap<>();
map.put("chenmo", "æ²‰é»˜");
map.put("wanger", "ç‹äºŒ");
map.put("chenqingyang", "é™ˆæ¸…æ‰¬");
map.put("xiaozhuanling", "å°è½¬é“ƒ");
map.put("fangxiaowan", "æ–¹å°å©‰");

// éå† HashMap
for (String key : map.keySet()) {
    int h, n = 16;
    int hash = (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
    int i = (n - 1) & hash;
    // æ‰“å° key çš„ hash å€¼ å’Œ ç´¢å¼• i
    System.out.println(key + "çš„hashå€¼ : " + hash +" çš„ç´¢å¼• : " + i);
}
```

è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
xiaozhuanlingçš„hashå€¼ : 14597045 çš„ç´¢å¼• : 5
fangxiaowançš„hashå€¼ : -392727066 çš„ç´¢å¼• : 6
chenmoçš„hashå€¼ : -1361556696 çš„ç´¢å¼• : 8
chenqingyangçš„hashå€¼ : -613818743 çš„ç´¢å¼• : 9
wangerçš„hashå€¼ : -795084437 çš„ç´¢å¼• : 11
```

ä¹Ÿå°±æ˜¯è¯´ï¼Œæ­¤æ—¶è¿˜æ²¡æœ‰å‘ç”Ÿå“ˆå¸Œå†²çªï¼Œç´¢å¼•å€¼éƒ½æ˜¯æ¯”è¾ƒå‡åŒ€åˆ†å¸ƒçš„ï¼Œ5ã€6ã€8ã€9ã€11ï¼Œè¿™å…¶ä¸­çš„å¾ˆå¤§ä¸€éƒ¨åˆ†åŠŸåŠ³ï¼Œå°±æ¥è‡ªäº hash æ–¹æ³•ã€‚

#### å°ç»“

hash æ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯å°† key çš„ hashCode å€¼è¿›è¡Œå¤„ç†ï¼Œå¾—åˆ°æœ€ç»ˆçš„å“ˆå¸Œå€¼ã€‚ç”±äº key çš„ hashCode å€¼æ˜¯ä¸ç¡®å®šçš„ï¼Œå¯èƒ½ä¼šå‡ºç°å“ˆå¸Œå†²çªï¼Œå› æ­¤éœ€è¦å°†å“ˆå¸Œå€¼é€šè¿‡ä¸€å®šçš„ç®—æ³•æ˜ å°„åˆ° HashMap çš„å®é™…å­˜å‚¨ä½ç½®ä¸Šã€‚

hash æ–¹æ³•çš„åŸç†æ˜¯ï¼Œå…ˆè·å– key å¯¹è±¡çš„ hashCode å€¼ï¼Œç„¶åå°†å…¶é«˜ä½ä¸ä½ä½è¿›è¡Œå¼‚æˆ–æ“ä½œï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„å“ˆå¸Œå€¼ã€‚ä¸ºä»€ä¹ˆè¦è¿›è¡Œå¼‚æˆ–æ“ä½œå‘¢ï¼Ÿå› ä¸ºå¯¹äº hashCode çš„é«˜ä½å’Œä½ä½ï¼Œå®ƒä»¬çš„åˆ†å¸ƒæ˜¯æ¯”è¾ƒå‡åŒ€çš„ï¼Œå¦‚æœåªæ˜¯ç®€å•åœ°å°†å®ƒä»¬åŠ èµ·æ¥æˆ–è€…è¿›è¡Œä½è¿ç®—ï¼Œå®¹æ˜“å‡ºç°å“ˆå¸Œå†²çªï¼Œè€Œå¼‚æˆ–æ“ä½œå¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚

ç„¶åå°†æ–°çš„å“ˆå¸Œå€¼å–æ¨¡ï¼ˆmodï¼‰ï¼Œå¾—åˆ°ä¸€ä¸ªå®é™…çš„å­˜å‚¨ä½ç½®ã€‚è¿™ä¸ªå–æ¨¡æ“ä½œçš„ç›®çš„æ˜¯å°†å“ˆå¸Œå€¼æ˜ å°„åˆ°æ¡¶ï¼ˆBucketï¼‰çš„ç´¢å¼•ä¸Šï¼Œæ¡¶æ˜¯ HashMap ä¸­çš„ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸ªæ¡¶ä¸­ä¼šå­˜å‚¨ç€ä¸€ä¸ªé“¾è¡¨ï¼ˆæˆ–è€…çº¢é»‘æ ‘ï¼‰ï¼Œè£…è½½å“ˆå¸Œå€¼ç›¸åŒçš„é”®å€¼å¯¹ï¼ˆæ²¡æœ‰ç›¸åŒå“ˆå¸Œå€¼çš„è¯å°±åªå­˜å‚¨ä¸€ä¸ªé”®å€¼å¯¹ï¼‰ã€‚

æ€»çš„æ¥è¯´ï¼ŒHashMap çš„ hash æ–¹æ³•å°±æ˜¯å°† key å¯¹è±¡çš„ hashCode å€¼è¿›è¡Œå¤„ç†ï¼Œå¾—åˆ°æœ€ç»ˆçš„å“ˆå¸Œå€¼ï¼Œå¹¶é€šè¿‡ä¸€å®šçš„ç®—æ³•æ˜ å°„åˆ°å®é™…çš„å­˜å‚¨ä½ç½®ä¸Šã€‚è¿™ä¸ªè¿‡ç¨‹å†³å®šäº† HashMap å†…éƒ¨é”®å€¼å¯¹çš„æŸ¥æ‰¾æ•ˆç‡ã€‚

### 02ã€HashMapçš„æ‰©å®¹æœºåˆ¶

å¥½ï¼Œç†è§£äº† hash æ–¹æ³•åæˆ‘ä»¬æ¥çœ‹ç¬¬äºŒä¸ªé—®é¢˜ï¼ŒHashMap çš„æ‰©å®¹æœºåˆ¶ã€‚

å¤§å®¶éƒ½çŸ¥é“ï¼Œæ•°ç»„ä¸€æ—¦åˆå§‹åŒ–åå¤§å°å°±æ— æ³•æ”¹å˜äº†ï¼Œæ‰€ä»¥å°±æœ‰äº† [ArrayList](https://tobebetterjavaer.com/collection/arraylist.html)è¿™ç§â€œåŠ¨æ€æ•°ç»„â€ï¼Œå¯ä»¥è‡ªåŠ¨æ‰©å®¹ã€‚

HashMap çš„åº•å±‚ç”¨çš„ä¹Ÿæ˜¯æ•°ç»„ã€‚å‘ HashMap é‡Œä¸åœåœ°æ·»åŠ å…ƒç´ ï¼Œå½“æ•°ç»„æ— æ³•è£…è½½æ›´å¤šå…ƒç´ æ—¶ï¼Œå°±éœ€è¦å¯¹æ•°ç»„è¿›è¡Œæ‰©å®¹ï¼Œä»¥ä¾¿è£…å…¥æ›´å¤šçš„å…ƒç´ ï¼›é™¤æ­¤ä¹‹å¤–ï¼Œå®¹é‡çš„æå‡ä¹Ÿä¼šç›¸åº”åœ°æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œå› ä¸ºâ€œæ¡¶ï¼ˆå‘ï¼‰â€æ›´å¤šäº†å˜›ï¼ŒåŸæ¥éœ€è¦é€šè¿‡é“¾è¡¨å­˜å‚¨çš„ï¼ˆæŸ¥è¯¢çš„æ—¶å€™éœ€è¦éå†ï¼‰ï¼Œæ‰©å®¹åå¯èƒ½å°±æœ‰è‡ªå·±ä¸“å±çš„â€œå‘ä½â€äº†ï¼ˆç›´æ¥å°±èƒ½æŸ¥å‡ºæ¥ï¼‰ã€‚

æ¥çœ‹è¿™ä¸ªä¾‹å­ï¼Œå®¹é‡æˆ‘ä»¬å®šä½ 16ï¼š

```java
HashMap<String, String> map = new HashMap<>();
map.put("chenmo", "æ²‰é»˜");
map.put("wanger", "ç‹äºŒ");
map.put("chenqingyang", "é™ˆæ¸…æ‰¬");
map.put("xiaozhuanling", "å°è½¬é“ƒ");
map.put("fangxiaowan", "æ–¹å°å©‰");
map.put("yexin", "å¶è¾›");
map.put("liuting","åˆ˜å©·");
map.put("yaoxiaojuan","å§šå°å¨Ÿ");

// éå† HashMap
for (String key : map.keySet()) {
    int h, n = 16;
    int hash = (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
    int i = (n - 1) & hash;
    // æ‰“å° key çš„ hash å€¼ å’Œ ç´¢å¼• i
    System.out.println(key + "çš„hashå€¼ : " + hash +" çš„ç´¢å¼• : " + i);
}
```

æ¥çœ‹è¾“å‡ºç»“æœï¼š

```
liutingçš„hashå€¼ : 183821170 çš„ç´¢å¼• : 2
xiaozhuanlingçš„hashå€¼ : 14597045 çš„ç´¢å¼• : 5
fangxiaowançš„hashå€¼ : -392727066 çš„ç´¢å¼• : 6
yaoxiaojuançš„hashå€¼ : 1231568918 çš„ç´¢å¼• : 6
chenmoçš„hashå€¼ : -1361556696 çš„ç´¢å¼• : 8
chenqingyangçš„hashå€¼ : -613818743 çš„ç´¢å¼• : 9
yexinçš„hashå€¼ : 114873289 çš„ç´¢å¼• : 9
wangerçš„hashå€¼ : -795084437 çš„ç´¢å¼• : 11
```

çœ‹åˆ°æ²¡ï¼Ÿ

- fangxiaowanï¼ˆæ–¹å°å©‰ï¼‰å’Œ yaoxiaojuanï¼ˆå§šå°å¨Ÿï¼‰çš„ç´¢å¼•éƒ½æ˜¯ 6ï¼›
- chenqingyangï¼ˆé™ˆæ¸…æ‰¬ï¼‰å’Œyexinï¼ˆå¶è¾›ï¼‰çš„ç´¢å¼•éƒ½æ˜¯ 9

è¿™å°±æ„å‘³ç€ï¼Œè¦é‡‡ç”¨æ‹‰é“¾æ³•ï¼ˆåé¢ä¼šè®²ï¼‰å°†ä»–ä»¬æ”¾åœ¨åŒä¸€ä¸ªç´¢å¼•çš„é“¾è¡¨ä¸Šã€‚æŸ¥è¯¢çš„æ—¶å€™ï¼Œå°±ä¸èƒ½ç›´æ¥é€šè¿‡ç´¢å¼•çš„æ–¹å¼ç›´æ¥æ‹¿åˆ°ï¼ˆ[æ—¶é—´å¤æ‚åº¦](https://tobebetterjavaer.com/collection/time-complexity.html)ä¸º O(1)ï¼‰ï¼Œè€Œè¦é€šè¿‡éå†çš„æ–¹å¼ï¼ˆæ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼‰ã€‚

é‚£å‡å¦‚æŠŠæ•°ç»„çš„é•¿åº¦ç”± 16 æ‰©å®¹ä¸º 32 å‘¢ï¼Ÿ

å°†ä¹‹å‰ç¤ºä¾‹ä¸­çš„ n ç”± 16 æ”¹ä¸º 32 å³å¯å¾—åˆ°å¦‚ä¸‹çš„ç­”æ¡ˆï¼š

```java
liutingçš„hashå€¼ : 183821170 çš„ç´¢å¼• : 18
xiaozhuanlingçš„hashå€¼ : 14597045 çš„ç´¢å¼• : 21
fangxiaowançš„hashå€¼ : -392727066 çš„ç´¢å¼• : 6
yaoxiaojuançš„hashå€¼ : 1231568918 çš„ç´¢å¼• : 22
chenmoçš„hashå€¼ : -1361556696 çš„ç´¢å¼• : 8
chenqingyangçš„hashå€¼ : -613818743 çš„ç´¢å¼• : 9
yexinçš„hashå€¼ : 114873289 çš„ç´¢å¼• : 9
wangerçš„hashå€¼ : -795084437 çš„ç´¢å¼• : 11
```

å¯ä»¥çœ‹åˆ°ï¼š

- è™½ç„¶chenqingyangï¼ˆé™ˆæ¸…æ‰¬ï¼‰å’Œyexinï¼ˆå¶è¾›ï¼‰çš„ç´¢å¼•ä»ç„¶æ˜¯ 9ã€‚
- ä½† fangxiaowanï¼ˆæ–¹å°å©‰ï¼‰çš„ç´¢å¼•ä¸º 6ï¼Œyaoxiaojuanï¼ˆå§šå°å¨Ÿï¼‰çš„ç´¢å¼•ç”± 6 å˜ä¸º 22ï¼Œå„è‡ªéƒ½æœ‰å‘äº†ã€‚

å½“ç„¶äº†ï¼Œæ•°ç»„æ˜¯æ— æ³•è‡ªåŠ¨æ‰©å®¹çš„ï¼Œæ‰€ä»¥å¦‚æœè¦æ‰©å®¹çš„è¯ï¼Œå°±éœ€è¦æ–°å»ºä¸€ä¸ªå¤§çš„æ•°ç»„ï¼Œç„¶åæŠŠä¹‹å‰å°çš„æ•°ç»„çš„å…ƒç´ å¤åˆ¶è¿‡å»ï¼Œå¹¶ä¸”è¦é‡æ–°è®¡ç®—å“ˆå¸Œå€¼å’Œé‡æ–°åˆ†é…æ¡¶ï¼ˆé‡æ–°æ•£åˆ—ï¼‰ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿæ˜¯æŒºè€—æ—¶çš„ã€‚

#### resizeæ–¹æ³•

HashMap çš„æ‰©å®¹æ˜¯é€šè¿‡ resize æ–¹æ³•æ¥å®ç°çš„ï¼ŒJDK 8 ä¸­èå…¥äº†çº¢é»‘æ ‘ï¼ˆé“¾è¡¨é•¿åº¦è¶…è¿‡ 8 çš„æ—¶å€™ï¼Œä¼šå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘æ¥æé«˜æŸ¥è¯¢æ•ˆç‡ï¼‰ï¼Œå¯¹äºæ–°æ‰‹æ¥è¯´ï¼Œå¯èƒ½æ¯”è¾ƒéš¾ç†è§£ã€‚

ä¸ºäº†å‡è½»å¤§å®¶çš„å­¦ä¹ å‹åŠ›ï¼Œå°±è¿˜ä½¿ç”¨ JDK 7 çš„æºç ï¼Œææ¸…æ¥šäº† JDK 7 çš„ï¼Œå†çœ‹ JDK 8 çš„å°±ä¼šè½»æ¾å¾ˆå¤šã€‚

æ¥çœ‹ Java7 çš„ resize æ–¹æ³•æºç ï¼Œæˆ‘åŠ äº†æ³¨é‡Šï¼š

```java
// newCapacityä¸ºæ–°çš„å®¹é‡
void resize(int newCapacity) {
    // å°æ•°ç»„ï¼Œä¸´æ—¶è¿‡åº¦ä¸‹
    Entry[] oldTable = table;
    // æ‰©å®¹å‰çš„å®¹é‡
    int oldCapacity = oldTable.length;
    // MAXIMUM_CAPACITY ä¸ºæœ€å¤§å®¹é‡ï¼Œ2 çš„ 30 æ¬¡æ–¹ = 1<<30
    if (oldCapacity == MAXIMUM_CAPACITY) {
        // å®¹é‡è°ƒæ•´ä¸º Integer çš„æœ€å¤§å€¼ 0x7fffffffï¼ˆåå…­è¿›åˆ¶ï¼‰=2 çš„ 31 æ¬¡æ–¹-1
        threshold = Integer.MAX_VALUE;
        return;
    }

    // åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼ˆå¤§å®¹é‡ï¼‰
    Entry[] newTable = new Entry[newCapacity];
    // æŠŠå°æ•°ç»„çš„å…ƒç´ è½¬ç§»åˆ°å¤§æ•°ç»„ä¸­
    transfer(newTable, initHashSeedAsNeeded(newCapacity));
    // å¼•ç”¨æ–°çš„å¤§æ•°ç»„
    table = newTable;
    // é‡æ–°è®¡ç®—é˜ˆå€¼
    threshold = (int)Math.min(newCapacity * loadFactor, MAXIMUM_CAPACITY + 1);
}
```

è¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ªæ–°çš„å®¹é‡ newCapacityï¼Œç„¶åå°† HashMap çš„å®¹é‡æ‰©å¤§åˆ° newCapacityã€‚

é¦–å…ˆï¼Œæ–¹æ³•è·å–å½“å‰ HashMap çš„æ—§æ•°ç»„ oldTable å’Œæ—§å®¹é‡ oldCapacityã€‚å¦‚æœæ—§å®¹é‡å·²ç»è¾¾åˆ° HashMap æ”¯æŒçš„æœ€å¤§å®¹é‡ MAXIMUM_CAPACITYï¼ˆ 2 çš„ 30 æ¬¡æ–¹ï¼‰ï¼Œå°±å°†æ–°çš„é˜ˆå€¼ threshold è°ƒæ•´ä¸º Integer.MAX_VALUEï¼ˆ2 çš„ 31 æ¬¡æ–¹ - 1ï¼‰ï¼Œè¿™æ˜¯å› ä¸º HashMap çš„å®¹é‡ä¸èƒ½è¶…è¿‡ MAXIMUM_CAPACITYã€‚

å› ä¸º 2,147,483,647ï¼ˆInteger.MAX_VALUEï¼‰ - 1,073,741,824ï¼ˆMAXIMUM_CAPACITYï¼‰ = 1,073,741,823ï¼Œåˆšå¥½ç›¸å·®ä¸€å€ï¼ˆHashMap æ¯æ¬¡æ‰©å®¹éƒ½æ˜¯ä¹‹å‰çš„ä¸€å€ï¼‰ã€‚

æ¥ç€ï¼Œæ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ newTableï¼Œå¹¶å°†æ—§æ•°ç»„ oldTable ä¸­çš„å…ƒç´ è½¬ç§»åˆ°æ–°æ•°ç»„ newTable ä¸­ã€‚è½¬ç§»è¿‡ç¨‹æ˜¯é€šè¿‡è°ƒç”¨ transfer æ–¹æ³•æ¥å®ç°çš„ã€‚è¯¥æ–¹æ³•éå†æ—§æ•°ç»„ä¸­çš„æ¯ä¸ªæ¡¶ï¼Œå¹¶å°†æ¯ä¸ªæ¡¶ä¸­çš„é”®å€¼å¯¹é‡æ–°è®¡ç®—å“ˆå¸Œå€¼åï¼Œå°†å…¶æ’å…¥åˆ°æ–°æ•°ç»„å¯¹åº”çš„æ¡¶ä¸­ã€‚

è½¬ç§»å®Œæˆåï¼Œæ–¹æ³•å°† HashMap å†…éƒ¨çš„æ•°ç»„å¼•ç”¨ table æŒ‡å‘æ–°æ•°ç»„ newTableï¼Œå¹¶é‡æ–°è®¡ç®—é˜ˆå€¼ thresholdã€‚æ–°çš„é˜ˆå€¼æ˜¯æ–°å®¹é‡ newCapacity ä¹˜ä»¥è´Ÿè½½å› å­ loadFactor çš„ç»“æœï¼Œä½†å¦‚æœè®¡ç®—ç»“æœè¶…è¿‡äº† HashMap æ”¯æŒçš„æœ€å¤§å®¹é‡ MAXIMUM_CAPACITYï¼Œåˆ™å°†é˜ˆå€¼è®¾ç½®ä¸º MAXIMUM_CAPACITY + 1ï¼Œè¿™æ˜¯å› ä¸º HashMap çš„å…ƒç´ æ•°é‡ä¸èƒ½è¶…è¿‡ MAXIMUM_CAPACITYã€‚

#### æ–°å®¹é‡newCapacity

é‚£ newCapacity æ˜¯å¦‚ä½•è®¡ç®—çš„å‘¢ï¼Ÿ

```java
int newCapacity = oldCapacity * 2;
if (newCapacity < 0 || newCapacity >= MAXIMUM_CAPACITY) {
    newCapacity = MAXIMUM_CAPACITY;
} else if (newCapacity < DEFAULT_INITIAL_CAPACITY) {
    newCapacity = DEFAULT_INITIAL_CAPACITY;
}
```

æ–°å®¹é‡ newCapacity è¢«åˆå§‹åŒ–ä¸ºåŸå®¹é‡ oldCapacity çš„ä¸¤å€ã€‚ç„¶åï¼Œå¦‚æœ newCapacity è¶…è¿‡äº† HashMap çš„å®¹é‡é™åˆ¶ MAXIMUM_CAPACITYï¼ˆ2^30ï¼‰ï¼Œå°±å°† newCapacity è®¾ç½®ä¸º MAXIMUM_CAPACITYã€‚å¦‚æœ newCapacity å°äºé»˜è®¤åˆå§‹å®¹é‡ DEFAULT_INITIAL_CAPACITYï¼ˆ16ï¼‰ï¼Œå°±å°† newCapacity è®¾ç½®ä¸º DEFAULT_INITIAL_CAPACITYã€‚è¿™æ ·å¯ä»¥é¿å…æ–°å®¹é‡å¤ªå°æˆ–å¤ªå¤§å¯¼è‡´å“ˆå¸Œå†²çªè¿‡å¤šæˆ–è€…æµªè´¹ç©ºé—´ã€‚

Java 8 çš„æ—¶å€™ï¼ŒnewCapacity çš„è®¡ç®—æ–¹å¼å‘ç”Ÿäº†ä¸€äº›ç»†å¾®çš„å˜åŒ–ã€‚

```java
int newCapacity = oldCapacity << 1;
if (newCapacity >= DEFAULT_INITIAL_CAPACITY && oldCapacity >= DEFAULT_INITIAL_CAPACITY) {
    if (newCapacity > MAXIMUM_CAPACITY)
        newCapacity = MAXIMUM_CAPACITY;
} else {
    if (newCapacity < DEFAULT_INITIAL_CAPACITY)
        newCapacity = DEFAULT_INITIAL_CAPACITY;
}
```

æ³¨æ„ï¼Œ`oldCapacity * 2` å˜æˆäº† `oldCapacity << 1`ï¼Œå‡ºç°äº†å·¦ç§»ï¼ˆ`<<`ï¼‰ï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ï¼š

```
a=39
b = a << 2
```

åè¿›åˆ¶ 39 ç”¨ 8 ä½çš„äºŒè¿›åˆ¶æ¥è¡¨ç¤ºï¼Œå°±æ˜¯ 00100111ï¼Œå·¦ç§»ä¸¤ä½åæ˜¯ 10011100ï¼ˆä½ä½ç”¨ 0 è¡¥ä¸Šï¼‰ï¼Œå†è½¬æˆåè¿›åˆ¶æ•°å°±æ˜¯ 156ã€‚

ç§»ä½è¿ç®—é€šå¸¸å¯ä»¥ç”¨æ¥ä»£æ›¿ä¹˜æ³•è¿ç®—å’Œé™¤æ³•è¿ç®—ã€‚ä¾‹å¦‚ï¼Œå°† 0010011ï¼ˆ39ï¼‰å·¦ç§»ä¸¤ä½å°±æ˜¯ 10011100ï¼ˆ156ï¼‰ï¼Œåˆšå¥½å˜æˆäº†åŸæ¥çš„ 4 å€ã€‚

å®é™…ä¸Šå‘¢ï¼ŒäºŒè¿›åˆ¶æ•°å·¦ç§»åä¼šå˜æˆåŸæ¥çš„ 2 å€ã€4 å€ã€8 å€ï¼Œè®°ä½è¿™ä¸ªå°±å¥½ã€‚

#### transferæ–¹æ³•

æ¥ä¸‹æ¥ï¼Œæ¥è¯´ transfer æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨æ¥è½¬ç§»ï¼Œå°†æ—§çš„å°æ•°ç»„å…ƒç´ æ‹·è´åˆ°æ–°çš„å¤§æ•°ç»„ä¸­ã€‚

```java
void transfer(Entry[] newTable, boolean rehash) {
    // æ–°çš„å®¹é‡
    int newCapacity = newTable.length;
    // éå†å°æ•°ç»„
    for (Entry<K,V> e : table) {
        while(null != e) {
            // æ‹‰é“¾æ³•ï¼Œç›¸åŒ key ä¸Šçš„ä¸åŒå€¼
            Entry<K,V> next = e.next;
            // æ˜¯å¦éœ€è¦é‡æ–°è®¡ç®— hash
            if (rehash) {
                e.hash = null == e.key ? 0 : hash(e.key);
            }
            // æ ¹æ®å¤§æ•°ç»„çš„å®¹é‡ï¼Œå’Œé”®çš„ hash è®¡ç®—å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡
            int i = indexFor(e.hash, newCapacity);

            // åŒä¸€ä½ç½®ä¸Šçš„æ–°å…ƒç´ è¢«æ”¾åœ¨é“¾è¡¨çš„å¤´éƒ¨
            e.next = newTable[i];

            // æ”¾åœ¨æ–°çš„æ•°ç»„ä¸Š
            newTable[i] = e;

            // é“¾è¡¨ä¸Šçš„ä¸‹ä¸€ä¸ªå…ƒç´ 
            e = next;
        }
    }
}
```

è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªæ–°çš„ Entry æ•°ç»„ newTable å’Œä¸€ä¸ªå¸ƒå°”å€¼ rehash ä½œä¸ºå‚æ•°ï¼Œå…¶ä¸­ newTable è¡¨ç¤ºæ–°çš„å“ˆå¸Œè¡¨ï¼Œrehash è¡¨ç¤ºæ˜¯å¦éœ€è¦é‡æ–°è®¡ç®—é”®çš„å“ˆå¸Œå€¼ã€‚

åœ¨æ–¹æ³•ä¸­ï¼Œé¦–å…ˆè·å–æ–°å“ˆå¸Œè¡¨ï¼ˆæ•°ç»„ï¼‰çš„é•¿åº¦ newCapacityï¼Œç„¶åéå†æ—§å“ˆå¸Œè¡¨ä¸­çš„æ¯ä¸ª Entryã€‚å¯¹äºæ¯ä¸ª Entryï¼Œä½¿ç”¨æ‹‰é“¾æ³•å°†ç›¸åŒ key å€¼çš„ä¸åŒ value å€¼å­˜å‚¨åœ¨åŒä¸€ä¸ªé“¾è¡¨ä¸­ã€‚å¦‚æœ rehash ä¸º trueï¼Œåˆ™éœ€è¦é‡æ–°è®¡ç®—é”®çš„å“ˆå¸Œå€¼ï¼Œå¹¶å°†æ–°çš„å“ˆå¸Œå€¼å­˜å‚¨åœ¨ Entry çš„ hash å±æ€§ä¸­ã€‚

æ¥ç€ï¼Œæ ¹æ®æ–°å“ˆå¸Œè¡¨çš„é•¿åº¦å’Œé”®çš„å“ˆå¸Œå€¼ï¼Œè®¡ç®— Entry åœ¨æ–°æ•°ç»„ä¸­çš„ä½ç½® iï¼Œç„¶åå°†è¯¥ Entry æ·»åŠ åˆ°æ–°æ•°ç»„çš„ i ä½ç½®ä¸Šã€‚ç”±äºæ–°å…ƒç´ éœ€è¦è¢«æ”¾åœ¨é“¾è¡¨çš„å¤´éƒ¨ï¼Œå› æ­¤å°†æ–°å…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ è®¾ç½®ä¸ºå½“å‰æ•°ç»„ä½ç½®ä¸Šçš„å…ƒç´ ã€‚

æœ€åï¼Œéå†å®Œæ—§å“ˆå¸Œè¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ åï¼Œè½¬ç§»å·¥ä½œå®Œæˆï¼Œæ–°çš„å“ˆå¸Œè¡¨ newTable å·²ç»åŒ…å«äº†æ—§å“ˆå¸Œè¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚

#### æ‹‰é“¾æ³•

æ³¨æ„ï¼Œ`e.next = newTable[i]`ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨äº†å•é“¾è¡¨çš„å¤´æ’å…¥æ–¹å¼ï¼ŒåŒä¸€ä½ç½®ä¸Šæ–°å…ƒç´ æ€»ä¼šè¢«æ”¾åœ¨é“¾è¡¨çš„å¤´éƒ¨ä½ç½®ï¼›è¿™æ ·å…ˆæ”¾åœ¨ä¸€ä¸ªç´¢å¼•ä¸Šçš„å…ƒç´ æœ€ç»ˆä¼šè¢«æ”¾åˆ°é“¾è¡¨çš„å°¾éƒ¨ï¼Œè¿™å°±ä¼šå¯¼è‡´**åœ¨æ—§æ•°ç»„ä¸­åŒä¸€ä¸ªé“¾è¡¨ä¸Šçš„å…ƒç´ ï¼Œé€šè¿‡é‡æ–°è®¡ç®—ç´¢å¼•ä½ç½®åï¼Œæœ‰å¯èƒ½è¢«æ”¾åˆ°äº†æ–°æ•°ç»„çš„ä¸åŒä½ç½®ä¸Š**ã€‚

å°±è¿™ç‚¹ä¸Šï¼ŒJava 8 åšäº†å¾ˆå¤§çš„ä¼˜åŒ–ï¼ˆä¸‹é¢ä¼šè®²ï¼‰ã€‚

ç°åœ¨å‡è®¾ hash ç®—æ³•å°±æ˜¯ç®€å•çš„ç”¨é”®çš„å“ˆå¸Œå€¼ï¼ˆä¸€ä¸ª int å€¼ï¼‰å’Œæ•°ç»„å¤§å°å–æ¨¡ï¼ˆä¹Ÿå°±æ˜¯ `hashCode % table.length`ï¼‰ã€‚

ç»§ç»­å‡è®¾ï¼š

- æ•°ç»„ table çš„é•¿åº¦ä¸º 2
- é”®çš„å“ˆå¸Œå€¼ä¸º 3ã€7ã€5

å–æ¨¡è¿ç®—åï¼Œå“ˆå¸Œå†²çªéƒ½åˆ° table[1] ä¸Šäº†ï¼Œå› ä¸ºä½™æ•°ä¸º 1ã€‚é‚£ä¹ˆæ‰©å®¹å‰çš„æ ·å­å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-resize-01.png)

æ•°ç»„çš„å®¹é‡ä¸º 2ï¼Œ key 3ã€7ã€5 éƒ½åœ¨ table[1] çš„é“¾è¡¨ä¸Šã€‚

å‡è®¾è´Ÿè½½å› å­ï¼ˆåé¢ä¼šç»†è®²ï¼‰ loadFactor ä¸º 1ï¼Œä¹Ÿå°±æ˜¯å½“å…ƒç´ çš„ä¸ªæ•°å¤§äº table çš„é•¿åº¦æ—¶è¿›è¡Œæ‰©å®¹ã€‚

æ‰©å®¹åçš„æ•°ç»„å®¹é‡ä¸º 4ã€‚

- key 3 å–æ¨¡ï¼ˆ3%4ï¼‰åæ˜¯ 3ï¼Œæ”¾åœ¨ table[3] ä¸Šã€‚
- key 7 å–æ¨¡ï¼ˆ7%4ï¼‰åæ˜¯ 3ï¼Œæ”¾åœ¨ table[3] ä¸Šçš„é“¾è¡¨å¤´éƒ¨ã€‚
- key 5 å–æ¨¡ï¼ˆ5%4ï¼‰åæ˜¯ 1ï¼Œæ”¾åœ¨ table[1] ä¸Šã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-resize-02.png)

æŒ‰ç…§æˆ‘ä»¬çš„é¢„æœŸï¼Œæ‰©å®¹åçš„ 7 ä»ç„¶åº”è¯¥åœ¨ 3 è¿™æ¡é“¾è¡¨çš„åé¢ï¼Œä½†å®é™…ä¸Šå‘¢ï¼Ÿ 7 è·‘åˆ° 3 è¿™æ¡é“¾è¡¨çš„å¤´éƒ¨äº†ã€‚

é’ˆå¯¹ JDK 7 ä¸­çš„è¿™ä¸ªæƒ…å†µï¼ŒJDK 8 åšäº†å“ªäº›ä¼˜åŒ–å‘¢ï¼Ÿ

çœ‹ä¸‹é¢è¿™å¼ å›¾ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-resize-03.png)

n ä¸º table çš„é•¿åº¦ï¼Œé»˜è®¤å€¼ä¸º 16ã€‚

- n-1 ä¹Ÿå°±æ˜¯äºŒè¿›åˆ¶çš„ 0000 1111ï¼ˆ1X$2^0$+1X$2^1$+1X$2^2$+1X$2^3$=1+2+4+8=15ï¼‰ï¼›
- key1 å“ˆå¸Œå€¼çš„æœ€å 8 ä½ä¸º 0000 0101
- key2 å“ˆå¸Œå€¼çš„æœ€å 8 ä½ä¸º 0001 0101ï¼ˆå’Œ key1 ä¸åŒï¼‰
- åšä¸è¿ç®—åå‘ç”Ÿäº†å“ˆå¸Œå†²çªï¼Œç´¢å¼•éƒ½åœ¨ï¼ˆ0000 0101ï¼‰ä¸Šã€‚

æ‰©å®¹åä¸º 32ã€‚

- n-1 ä¹Ÿå°±æ˜¯äºŒè¿›åˆ¶çš„ 0001 1111ï¼ˆ1X$2^0$+1X$2^1$+1X$2^2$+1X$2^3$+1X$2^4$=1+2+4+8+16=31ï¼‰ï¼Œæ‰©å®¹å‰æ˜¯ 0000 1111ã€‚
- key1 å“ˆå¸Œå€¼çš„ä½ä½ä¸º 0000 0101
- key2 å“ˆå¸Œå€¼çš„ä½ä½ä¸º 0001 0101ï¼ˆå’Œ key1 ä¸åŒï¼‰
- key1 åšä¸è¿ç®—åï¼Œç´¢å¼•ä¸º 0000 0101ã€‚
- key2 åšä¸è¿ç®—åï¼Œç´¢å¼•ä¸º 0001 0101ã€‚

æ–°çš„ç´¢å¼•å°±ä¼šå‘ç”Ÿè¿™æ ·çš„å˜åŒ–ï¼š

- åŸæ¥çš„ç´¢å¼•æ˜¯ 5ï¼ˆ*0* 0101ï¼‰
- åŸæ¥çš„å®¹é‡æ˜¯ 16
- æ‰©å®¹åçš„å®¹é‡æ˜¯ 32
- æ‰©å®¹åçš„ç´¢å¼•æ˜¯ 21ï¼ˆ*1* 0101ï¼‰ï¼Œä¹Ÿå°±æ˜¯ 5+16ï¼Œä¹Ÿå°±æ˜¯åŸæ¥çš„ç´¢å¼•+åŸæ¥çš„å®¹é‡

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-resize-04.png)


ä¹Ÿå°±æ˜¯è¯´ï¼ŒJDK 8 ä¸éœ€è¦åƒ JDK 7 é‚£æ ·é‡æ–°è®¡ç®— hashï¼Œåªéœ€è¦çœ‹åŸæ¥çš„hashå€¼æ–°å¢çš„é‚£ä¸ªbitæ˜¯1è¿˜æ˜¯0å°±å¥½äº†ï¼Œæ˜¯0çš„è¯å°±è¡¨ç¤ºç´¢å¼•æ²¡å˜ï¼Œæ˜¯1çš„è¯ï¼Œç´¢å¼•å°±å˜æˆäº†â€œåŸç´¢å¼•+åŸæ¥çš„å®¹é‡â€ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-resize-05.png)

JDK 8 çš„è¿™ä¸ªè®¾è®¡éå¸¸å·§å¦™ï¼Œæ—¢çœå»äº†é‡æ–°è®¡ç®—hashçš„æ—¶é—´ï¼ŒåŒæ—¶ï¼Œç”±äºæ–°å¢çš„1 bitæ˜¯0è¿˜æ˜¯1æ˜¯éšæœºçš„ï¼Œå› æ­¤æ‰©å®¹çš„è¿‡ç¨‹ï¼Œå¯ä»¥å‡åŒ€åœ°æŠŠä¹‹å‰çš„èŠ‚ç‚¹åˆ†æ•£åˆ°æ–°çš„ä½ç½®ä¸Šã€‚

wocï¼Œåªèƒ½è¯´ HashMap çš„ä½œè€… Doug Leaã€Josh Blochã€Arthur van Hoffã€Neal Gafter çœŸçš„å¼ºâ€”â€”çš„ä¸€ç¬”ã€‚

#### Java 8 æ‰©å®¹

JDK 8 çš„æ‰©å®¹æºä»£ç ï¼š

```java
final Node<K,V>[] resize() {
    Node<K,V>[] oldTab = table; // è·å–åŸæ¥çš„æ•°ç»„ table
    int oldCap = (oldTab == null) ? 0 : oldTab.length; // è·å–æ•°ç»„é•¿åº¦ oldCap
    int oldThr = threshold; // è·å–é˜ˆå€¼ oldThr
    int newCap, newThr = 0;
    if (oldCap > 0) { // å¦‚æœåŸæ¥çš„æ•°ç»„ table ä¸ä¸ºç©º
        if (oldCap >= MAXIMUM_CAPACITY) { // è¶…è¿‡æœ€å¤§å€¼å°±ä¸å†æ‰©å……äº†ï¼Œå°±åªå¥½éšä½ ç¢°æ’å»å§
            threshold = Integer.MAX_VALUE;
            return oldTab;
        }
        else if ((newCap = oldCap << 1) < MAXIMUM_CAPACITY && // æ²¡è¶…è¿‡æœ€å¤§å€¼ï¼Œå°±æ‰©å……ä¸ºåŸæ¥çš„2å€
                 oldCap >= DEFAULT_INITIAL_CAPACITY)
            newThr = oldThr << 1; // double threshold
    }
    else if (oldThr > 0) // initial capacity was placed in threshold
        newCap = oldThr;
    else { // zero initial threshold signifies using defaults
        newCap = DEFAULT_INITIAL_CAPACITY;
        newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);
    }
    // è®¡ç®—æ–°çš„ resize ä¸Šé™
    if (newThr == 0) {
        float ft = (float)newCap * loadFactor;
        newThr = (newCap < MAXIMUM_CAPACITY && ft < (float)MAXIMUM_CAPACITY ?
                  (int)ft : Integer.MAX_VALUE);
    }
    threshold = newThr; // å°†æ–°é˜ˆå€¼èµ‹å€¼ç»™æˆå‘˜å˜é‡ threshold
    @SuppressWarnings({"rawtypes","unchecked"})
        Node<K,V>[] newTab = (Node<K,V>[])new Node[newCap]; // åˆ›å»ºæ–°æ•°ç»„ newTab
    table = newTab; // å°†æ–°æ•°ç»„ newTab èµ‹å€¼ç»™æˆå‘˜å˜é‡ table
    if (oldTab != null) { // å¦‚æœæ—§æ•°ç»„ oldTab ä¸ä¸ºç©º
        for (int j = 0; j < oldCap; ++j) { // éå†æ—§æ•°ç»„çš„æ¯ä¸ªå…ƒç´ 
            Node<K,V> e;
            if ((e = oldTab[j]) != null) { // å¦‚æœè¯¥å…ƒç´ ä¸ä¸ºç©º
                oldTab[j] = null; // å°†æ—§æ•°ç»„ä¸­è¯¥ä½ç½®çš„å…ƒç´ ç½®ä¸º nullï¼Œä»¥ä¾¿åƒåœ¾å›æ”¶
                if (e.next == null) // å¦‚æœè¯¥å…ƒç´ æ²¡æœ‰å†²çª
                    newTab[e.hash & (newCap - 1)] = e; // ç›´æ¥å°†è¯¥å…ƒç´ æ”¾å…¥æ–°æ•°ç»„
                else if (e instanceof TreeNode) // å¦‚æœè¯¥å…ƒç´ æ˜¯æ ‘èŠ‚ç‚¹
                    ((TreeNode<K,V>)e).split(this, newTab, j, oldCap); // å°†è¯¥æ ‘èŠ‚ç‚¹åˆ†è£‚æˆä¸¤ä¸ªé“¾è¡¨
                else { // å¦‚æœè¯¥å…ƒç´ æ˜¯é“¾è¡¨
                    Node<K,V> loHead = null, loTail = null; // ä½ä½é“¾è¡¨çš„å¤´ç»“ç‚¹å’Œå°¾ç»“ç‚¹
                    Node<K,V> hiHead = null, hiTail = null; // é«˜ä½é“¾è¡¨çš„å¤´ç»“ç‚¹å’Œå°¾ç»“ç‚¹
                    Node<K,V> next;
                    do { // éå†è¯¥é“¾è¡¨
                        next = e.next;
                        if ((e.hash & oldCap) == 0) { // å¦‚æœè¯¥å…ƒç´ åœ¨ä½ä½é“¾è¡¨ä¸­
                            if (loTail == null) // å¦‚æœä½ä½é“¾è¡¨è¿˜æ²¡æœ‰ç»“ç‚¹
                                loHead = e; // å°†è¯¥å…ƒç´ ä½œä¸ºä½ä½é“¾è¡¨çš„å¤´ç»“ç‚¹
                            else
                                loTail.next = e; // å¦‚æœä½ä½é“¾è¡¨å·²ç»æœ‰ç»“ç‚¹ï¼Œå°†è¯¥å…ƒç´ åŠ å…¥ä½ä½é“¾è¡¨çš„å°¾éƒ¨
                            loTail = e; // æ›´æ–°ä½ä½é“¾è¡¨çš„å°¾ç»“ç‚¹
                        }
                        else { // å¦‚æœè¯¥å…ƒç´ åœ¨é«˜ä½é“¾è¡¨ä¸­
                            if (hiTail == null) // å¦‚æœé«˜ä½é“¾è¡¨è¿˜æ²¡æœ‰ç»“ç‚¹
                                hiHead = e; // å°†è¯¥å…ƒç´ ä½œä¸ºé«˜ä½é“¾è¡¨çš„å¤´ç»“ç‚¹
                            else
                                hiTail.next = e; // å¦‚æœé«˜ä½é“¾è¡¨å·²ç»æœ‰ç»“ç‚¹ï¼Œå°†è¯¥å…ƒç´ åŠ å…¥é«˜ä½é“¾è¡¨çš„å°¾éƒ¨
                            hiTail = e; // æ›´æ–°é«˜ä½é“¾è¡¨çš„å°¾ç»“ç‚¹
                        }
                    } while ((e = next) != null); //
                    if (loTail != null) { // å¦‚æœä½ä½é“¾è¡¨ä¸ä¸ºç©º
                        loTail.next = null; // å°†ä½ä½é“¾è¡¨çš„å°¾ç»“ç‚¹æŒ‡å‘ nullï¼Œä»¥ä¾¿åƒåœ¾å›æ”¶
                        newTab[j] = loHead; // å°†ä½ä½é“¾è¡¨ä½œä¸ºæ–°æ•°ç»„å¯¹åº”ä½ç½®çš„å…ƒç´ 
                    }
                    if (hiTail != null) { // å¦‚æœé«˜ä½é“¾è¡¨ä¸ä¸ºç©º
                        hiTail.next = null; // å°†é«˜ä½é“¾è¡¨çš„å°¾ç»“ç‚¹æŒ‡å‘ nullï¼Œä»¥ä¾¿åƒåœ¾å›æ”¶
                        newTab[j + oldCap] = hiHead; // å°†é«˜ä½é“¾è¡¨ä½œä¸ºæ–°æ•°ç»„å¯¹åº”ä½ç½®çš„å…ƒç´ 
                    }
                }
            }
        }
    }
    return newTab; // è¿”å›æ–°æ•°ç»„
}
```

1ã€è·å–åŸæ¥çš„æ•°ç»„ tableã€æ•°ç»„é•¿åº¦ oldCap å’Œé˜ˆå€¼ oldThrã€‚

2ã€å¦‚æœåŸæ¥çš„æ•°ç»„ table ä¸ä¸ºç©ºï¼Œåˆ™æ ¹æ®æ‰©å®¹è§„åˆ™è®¡ç®—æ–°æ•°ç»„é•¿åº¦ newCap å’Œæ–°é˜ˆå€¼ newThrï¼Œç„¶åå°†åŸæ•°ç»„ä¸­çš„å…ƒç´ å¤åˆ¶åˆ°æ–°æ•°ç»„ä¸­ã€‚

3ã€å¦‚æœåŸæ¥çš„æ•°ç»„ table ä¸ºç©ºä½†é˜ˆå€¼ oldThr ä¸ä¸ºé›¶ï¼Œåˆ™è¯´æ˜æ˜¯é€šè¿‡å¸¦å‚æ•°æ„é€ å‡½æ•°åˆ›å»ºçš„ HashMapï¼Œæ­¤æ—¶å°†é˜ˆå€¼ä½œä¸ºæ–°æ•°ç»„é•¿åº¦ newCapã€‚

4ã€å¦‚æœåŸæ¥çš„æ•°ç»„ table å’Œé˜ˆå€¼ oldThr éƒ½ä¸ºé›¶ï¼Œåˆ™è¯´æ˜æ˜¯é€šè¿‡æ— å‚æ•°æ„é€ å‡½æ•°åˆ›å»ºçš„ HashMapï¼Œæ­¤æ—¶å°†é»˜è®¤åˆå§‹å®¹é‡ DEFAULT_INITIAL_CAPACITYï¼ˆ16ï¼‰å’Œé»˜è®¤è´Ÿè½½å› å­ DEFAULT_LOAD_FACTORï¼ˆ0.75ï¼‰è®¡ç®—å‡ºæ–°æ•°ç»„é•¿åº¦ newCap å’Œæ–°é˜ˆå€¼ newThrã€‚

5ã€è®¡ç®—æ–°é˜ˆå€¼ thresholdï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™æˆå‘˜å˜é‡ thresholdã€‚

6ã€åˆ›å»ºæ–°æ•°ç»„ newTabï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™æˆå‘˜å˜é‡ tableã€‚

7ã€å¦‚æœæ—§æ•°ç»„ oldTab ä¸ä¸ºç©ºï¼Œåˆ™éå†æ—§æ•°ç»„çš„æ¯ä¸ªå…ƒç´ ï¼Œå°†å…¶å¤åˆ¶åˆ°æ–°æ•°ç»„ä¸­ã€‚

8ã€è¿”å›æ–°æ•°ç»„ newTabã€‚

#### å°ç»“

HashMap çš„å†…éƒ¨å®ç°æ˜¯é€šè¿‡ä¸€ä¸ªæ•°ç»„å’Œé“¾è¡¨æˆ–çº¢é»‘æ ‘çš„ç»„åˆæ¥å®ç°çš„ã€‚å½“æˆ‘ä»¬å¾€ HashMap ä¸­ä¸æ–­æ·»åŠ å…ƒç´ æ—¶ï¼ŒHashMap ä¼šè‡ªåŠ¨è¿›è¡Œæ‰©å®¹æ“ä½œï¼ˆæ¡ä»¶æ˜¯å…ƒç´ æ•°é‡è¾¾åˆ°è´Ÿè½½å› å­ï¼ˆload factorï¼‰ä¹˜ä»¥æ•°ç»„é•¿åº¦æ—¶ï¼‰ï¼Œä»¥ä¿è¯å…¶å­˜å‚¨çš„å…ƒç´ æ•°é‡ä¸ä¼šè¶…å‡ºå…¶å®¹é‡é™åˆ¶ã€‚ä¸‹é¢æ˜¯ HashMap çš„æ‰©å®¹æœºåˆ¶ï¼š

1ã€åœ¨è¿›è¡Œæ‰©å®¹æ“ä½œæ—¶ï¼ŒHashMap ä¼šå…ˆå°†æ•°ç»„çš„é•¿åº¦æ‰©å¤§ä¸€å€ï¼Œç„¶åå°†åŸæ¥çš„å…ƒç´ é‡æ–°æ•£åˆ—ï¼ˆè¿™ä¸ªè¯è¿˜æ˜¯æŒºè´´åˆ‡çš„ï¼‰åˆ°æ–°çš„æ•°ç»„ä¸­ã€‚ç”±äºå…ƒç´ çš„æ•£åˆ—ä½ç½®æ˜¯é€šè¿‡ key çš„ hashcode å’Œæ•°ç»„é•¿åº¦å–æ¨¡å¾—åˆ°çš„ï¼Œå› æ­¤åœ¨æ•°ç»„é•¿åº¦æ‰©å¤§åï¼Œå…ƒç´ çš„æ•£åˆ—ä½ç½®ä¹Ÿä¼šå‘ç”Ÿä¸€äº›æ”¹å˜ã€‚

2ã€åœ¨é‡æ–°æ•£åˆ—å…ƒç´ æ—¶ï¼Œå¦‚æœä¸€ä¸ªå…ƒç´ çš„æ•£åˆ—ä½ç½®å‘ç”Ÿäº†æ”¹å˜ï¼Œé‚£ä¹ˆå®ƒéœ€è¦è¢«ç§»åŠ¨åˆ°æ–°çš„ä½ç½®ã€‚å¦‚æœæ–°çš„ä½ç½®ä¸Šå·²ç»æœ‰å…ƒç´ äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ å°±ä¼šè¢«æ·»åŠ åˆ°é“¾è¡¨çš„æœ«å°¾ï¼Œå¦‚æœé“¾è¡¨çš„é•¿åº¦è¶…è¿‡äº†é˜ˆå€¼ï¼ˆ8ä¸ªï¼‰ï¼Œé‚£ä¹ˆå®ƒå°†ä¼šè¢«è½¬æ¢æˆçº¢é»‘æ ‘ã€‚

æ€»ä¹‹ï¼ŒHashMap çš„æ‰©å®¹æœºåˆ¶æ˜¯é€šè¿‡å¢åŠ æ•°ç»„é•¿åº¦å’Œé‡æ–°æ•£åˆ—å…ƒç´ æ¥å®ç°çš„ï¼Œå®ƒå¯ä»¥ä¿è¯ HashMap çš„å­˜å‚¨å®¹é‡è¶³å¤Ÿå¤§ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä¿è¯ HashMap çš„å­˜å‚¨æ•ˆç‡å’Œæ£€ç´¢æ•ˆç‡ã€‚ä½†æ˜¯ï¼Œç”±äºæ‰©å®¹æ“ä½œéœ€è¦è€—è´¹ä¸€å®šçš„æ—¶é—´å’Œç©ºé—´ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨ä½¿ç”¨ HashMap æ—¶ï¼Œåˆç†åœ°è®¾ç½®åˆå§‹å®¹é‡å’Œè´Ÿè½½å› å­ï¼Œä»¥é¿å…è¿‡å¤šçš„æ‰©å®¹æ“ä½œã€‚

### 03ã€åŠ è½½å› å­ä¸ºä»€ä¹ˆæ˜¯0.75

ä¸Šä¸€ä¸ªé—®é¢˜æåˆ°äº†åŠ è½½å› å­ï¼ˆæˆ–è€…å«è´Ÿè½½å› å­ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªé—®é¢˜æˆ‘ä»¬æ¥è®¨è®ºä¸ºä»€ä¹ˆåŠ è½½å› å­æ˜¯ 0.75 è€Œä¸æ˜¯ 0.6ã€0.8ã€‚

æˆ‘ä»¬çŸ¥é“ï¼ŒHashMap æ˜¯ç”¨æ•°ç»„+é“¾è¡¨/çº¢é»‘æ ‘å®ç°çš„ï¼Œæˆ‘ä»¬è¦æƒ³å¾€ HashMap ä¸­æ·»åŠ æ•°æ®ï¼ˆå…ƒç´ /é”®å€¼å¯¹ï¼‰æˆ–è€…å–æ•°æ®ï¼Œå°±éœ€è¦ç¡®å®šæ•°æ®åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ï¼ˆç´¢å¼•ï¼‰ã€‚

å…ˆæŠŠæ•°æ®çš„é”®è¿›è¡Œä¸€æ¬¡ hashï¼š

```java
static final int hash(Object key) {
    int h;
    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
}
```

å†åšä¸€æ¬¡å–æ¨¡è¿ç®—ç¡®å®šä¸‹æ ‡ï¼š

```java
i = (n - 1) & hash
```

é‚£è¿™æ ·çš„è¿‡ç¨‹å®¹æ˜“äº§ç”Ÿä¸¤ä¸ªé—®é¢˜ï¼š

- æ•°ç»„çš„å®¹é‡è¿‡å°ï¼Œç»è¿‡å“ˆå¸Œè®¡ç®—åçš„ä¸‹æ ‡ï¼Œå®¹æ˜“å‡ºç°å†²çªï¼›
- æ•°ç»„çš„å®¹é‡è¿‡å¤§ï¼Œå¯¼è‡´ç©ºé—´åˆ©ç”¨ç‡ä¸é«˜ã€‚

åŠ è½½å› å­æ˜¯ç”¨æ¥è¡¨ç¤º HashMap ä¸­æ•°æ®çš„å¡«æ»¡ç¨‹åº¦ï¼š

>åŠ è½½å› å­ = å¡«å…¥å“ˆå¸Œè¡¨ä¸­çš„æ•°æ®ä¸ªæ•° / å“ˆå¸Œè¡¨çš„é•¿åº¦

è¿™å°±æ„å‘³ç€ï¼š

- åŠ è½½å› å­è¶Šå°ï¼Œå¡«æ»¡çš„æ•°æ®å°±è¶Šå°‘ï¼Œå“ˆå¸Œå†²çªçš„å‡ ç‡å°±å‡å°‘äº†ï¼Œä½†æµªè´¹äº†ç©ºé—´ï¼Œè€Œä¸”è¿˜ä¼šæé«˜æ‰©å®¹çš„è§¦å‘å‡ ç‡ï¼›
- åŠ è½½å› å­è¶Šå¤§ï¼Œå¡«æ»¡çš„æ•°æ®å°±è¶Šå¤šï¼Œç©ºé—´åˆ©ç”¨ç‡å°±é«˜ï¼Œä½†å“ˆå¸Œå†²çªçš„å‡ ç‡å°±å˜å¤§äº†ã€‚

å¥½éš¾ï¼ï¼ï¼ï¼

è¿™å°±å¿…é¡»åœ¨â€œ**å“ˆå¸Œå†²çª**â€ä¸â€œ**ç©ºé—´åˆ©ç”¨ç‡**â€ä¸¤è€…ä¹‹é—´æœ‰æ‰€å–èˆï¼Œå°½é‡ä¿æŒå¹³è¡¡ï¼Œè°ä¹Ÿä¸ç¢ç€è°ã€‚

æˆ‘ä»¬çŸ¥é“ï¼ŒHashMap æ˜¯é€šè¿‡æ‹‰é“¾æ³•æ¥è§£å†³å“ˆå¸Œå†²çªçš„ã€‚

ä¸ºäº†å‡å°‘å“ˆå¸Œå†²çªå‘ç”Ÿçš„æ¦‚ç‡ï¼Œå½“ HashMap çš„æ•°ç»„é•¿åº¦è¾¾åˆ°ä¸€ä¸ª**ä¸´ç•Œå€¼**çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘æ‰©å®¹ï¼Œæ‰©å®¹åä¼šå°†ä¹‹å‰å°æ•°ç»„ä¸­çš„å…ƒç´ è½¬ç§»åˆ°å¤§æ•°ç»„ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å½“è€—æ—¶çš„æ“ä½œã€‚

è¿™ä¸ªä¸´ç•Œå€¼ç”±ä»€ä¹ˆæ¥ç¡®å®šå‘¢ï¼Ÿ

>ä¸´ç•Œå€¼ = åˆå§‹å®¹é‡ * åŠ è½½å› å­

ä¸€å¼€å§‹ï¼ŒHashMap çš„å®¹é‡æ˜¯ 16ï¼š

```java
static final int DEFAULT_INITIAL_CAPACITY = 1 << 4; // aka 16
```

åŠ è½½å› å­æ˜¯ 0.75ï¼š

```java
static final float DEFAULT_LOAD_FACTOR = 0.75f;
```

ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ 16*0.75=12 æ—¶ï¼Œä¼šè§¦å‘æ‰©å®¹æœºåˆ¶ã€‚

**ä¸ºä»€ä¹ˆåŠ è½½å› å­ä¼šé€‰æ‹© 0.75 å‘¢ï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯0.8ã€0.6å‘¢**ï¼Ÿ

è¿™è·Ÿç»Ÿè®¡å­¦é‡Œçš„ä¸€ä¸ªå¾ˆé‡è¦çš„åŸç†â€”â€”æ³Šæ¾åˆ†å¸ƒæœ‰å…³ã€‚

æ˜¯æ—¶å€™ä¸Šç»´åŸºç™¾ç§‘äº†ï¼š

>æ³Šæ¾åˆ†å¸ƒï¼Œæ˜¯ä¸€ç§ç»Ÿè®¡ä¸æ¦‚ç‡å­¦é‡Œå¸¸è§åˆ°çš„ç¦»æ•£æ¦‚ç‡åˆ†å¸ƒï¼Œç”±æ³•å›½æ•°å­¦å®¶è¥¿è«æ©Â·å¾·å°¼Â·æ³Šæ¾åœ¨1838å¹´æ—¶æå‡ºã€‚å®ƒä¼šå¯¹éšæœºäº‹ä»¶çš„å‘ç”Ÿæ¬¡æ•°è¿›è¡Œå»ºæ¨¡ï¼Œé€‚ç”¨äºæ¶‰åŠè®¡ç®—åœ¨ç»™å®šçš„æ—¶é—´æ®µã€è·ç¦»ã€é¢ç§¯ç­‰èŒƒå›´å†…å‘ç”Ÿéšæœºäº‹ä»¶çš„æ¬¡æ•°çš„åº”ç”¨æƒ…å½¢ã€‚

é˜®ä¸€å³°è€å¸ˆæ›¾åœ¨ä¸€ç¯‡åšæ–‡ä¸­è¯¦ç»†çš„ä»‹ç»äº†æ³Šæ¾åˆ†å¸ƒå’ŒæŒ‡æ•°åˆ†å¸ƒï¼Œå¤§å®¶å¯ä»¥å»çœ‹ä¸€ä¸‹ã€‚

>é“¾æ¥ï¼š[https://www.ruanyifeng.com/blog/2015/06/poisson-distribution.html](https://www.ruanyifeng.com/blog/2015/06/poisson-distribution.html)

å…·ä½“æ˜¯ç”¨è¿™ä¹ˆä¸€ä¸ªå…¬å¼æ¥è¡¨ç¤ºçš„ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-loadfactor-01.png)

ç­‰å·çš„å·¦è¾¹ï¼ŒP è¡¨ç¤ºæ¦‚ç‡ï¼ŒNè¡¨ç¤ºæŸç§å‡½æ•°å…³ç³»ï¼Œt è¡¨ç¤ºæ—¶é—´ï¼Œn è¡¨ç¤ºæ•°é‡ã€‚

åœ¨ HashMap çš„ doc æ–‡æ¡£é‡Œï¼Œæ›¾æœ‰è¿™ä¹ˆä¸€æ®µæè¿°ï¼š

```
Because TreeNodes are about twice the size of regular nodes, we
use them only when bins contain enough nodes to warrant use
(see TREEIFY_THRESHOLD). And when they become too small (due to
removal or resizing) they are converted back to plain bins.  In
usages with well-distributed user hashCodes, tree bins are
rarely used.  Ideally, under random hashCodes, the frequency of
nodes in bins follows a Poisson distribution
(http://en.wikipedia.org/wiki/Poisson_distribution) with a
parameter of about 0.5 on average for the default resizing
threshold of 0.75, although with a large variance because of
resizing granularity. Ignoring variance, the expected
occurrences of list size k are (exp(-0.5) * pow(0.5, k) /
factorial(k)). The first values are:
0:    0.60653066
1:    0.30326533
2:    0.07581633
3:    0.01263606
4:    0.00157952
5:    0.00015795
6:    0.00001316
7:    0.00000094
8:    0.00000006
more: less than 1 in ten million
```

ä¸ºäº†ä¾¿äºå¤§å®¶çš„ç†è§£ï¼Œè¿™é‡Œæ¥é‡æ¸©ä¸€ä¸‹ HashMap çš„æ‹‰é“¾æ³•å’Œçº¢é»‘æ ‘ç»“æ„ã€‚

Java 8 ä¹‹å‰ï¼ŒHashMap ä½¿ç”¨é“¾è¡¨æ¥è§£å†³å†²çªï¼Œå³å½“ä¸¤ä¸ªæˆ–è€…å¤šä¸ªé”®æ˜ å°„åˆ°åŒä¸€ä¸ªæ¡¶æ—¶ï¼Œå®ƒä»¬è¢«æ”¾åœ¨åŒä¸€ä¸ªæ¡¶çš„é“¾è¡¨ä¸Šã€‚å½“é“¾è¡¨ä¸Šçš„èŠ‚ç‚¹ï¼ˆNodeï¼‰è¿‡å¤šæ—¶ï¼Œé“¾è¡¨ä¼šå˜å¾—å¾ˆé•¿ï¼ŒæŸ¥æ‰¾çš„æ•ˆç‡ï¼ˆ[LinkedList](https://tobebetterjavaer.com/collection/linkedlist.html) çš„æŸ¥æ‰¾æ•ˆç‡ä¸º Oï¼ˆnï¼‰ï¼‰å°±ä¼šå—åˆ°å½±å“ã€‚

Java 8 ä¸­ï¼Œå½“é“¾è¡¨çš„èŠ‚ç‚¹æ•°è¶…è¿‡ä¸€ä¸ªé˜ˆå€¼ï¼ˆ8ï¼‰æ—¶ï¼Œé“¾è¡¨å°†è½¬ä¸ºçº¢é»‘æ ‘ï¼ˆèŠ‚ç‚¹ä¸ºTreeNodeï¼‰ï¼Œçº¢é»‘æ ‘ï¼ˆåœ¨è®²[TreeMap](https://tobebetterjavaer.com/collection/treemap.html)æ—¶ä¼šç»†è¯´ï¼‰æ˜¯ä¸€ç§é«˜æ•ˆçš„å¹³è¡¡æ ‘ç»“æ„ï¼Œèƒ½å¤Ÿåœ¨ O(log n) çš„æ—¶é—´å†…å®Œæˆæ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾ç­‰æ“ä½œã€‚è¿™ç§ç»“æ„åœ¨èŠ‚ç‚¹æ•°å¾ˆå¤šæ—¶ï¼Œå¯ä»¥æé«˜ HashMap çš„æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚

å¥½ï¼Œæœ‰äº†è¿™ä¸ªèƒŒæ™¯ï¼Œæˆ‘ä»¬æ¥æŠŠä¸Šé¢çš„ doc æ–‡æ¡£ç¿»è¯‘ä¸ºä¸­æ–‡ï¼š

```
å› ä¸ºTreeNodeï¼ˆçº¢é»‘æ ‘çš„èŠ‚ç‚¹ï¼‰çš„å¤§å°å¤§çº¦æ˜¯å¸¸è§„èŠ‚ç‚¹ï¼ˆé“¾è¡¨çš„èŠ‚ç‚¹ Nodeï¼‰çš„ä¸¤å€ï¼Œæ‰€ä»¥åªæœ‰å½“æ¡¶å†…åŒ…å«è¶³å¤Ÿå¤šçš„èŠ‚ç‚¹æ—¶æ‰ä½¿ç”¨çº¢é»‘æ ‘ï¼ˆå‚è§TREEIFY_THRESHOLDã€Œé˜ˆå€¼ï¼Œå€¼ä¸º8ã€ï¼ŒèŠ‚ç‚¹æ•°é‡è¾ƒå¤šæ—¶ï¼Œçº¢é»‘æ ‘å¯ä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ï¼‰ã€‚

ç”±äºåˆ é™¤å…ƒç´ æˆ–è€…è°ƒæ•´æ•°ç»„å¤§å°ï¼ˆæ‰©å®¹ï¼‰æ—¶ï¼ˆå†æ¬¡æ•£åˆ—ï¼‰ï¼Œçº¢é»‘æ ‘å¯èƒ½ä¼šè¢«è½¬æ¢ä¸ºé“¾è¡¨ï¼ˆèŠ‚ç‚¹æ•°é‡å°äº 8 æ—¶ï¼‰ï¼ŒèŠ‚ç‚¹æ•°é‡è¾ƒå°‘æ—¶ï¼Œé“¾è¡¨çš„æ•ˆç‡æ¯”çº¢é»‘æ ‘æ›´é«˜ï¼Œå› ä¸ºçº¢é»‘æ ‘éœ€è¦æ›´å¤šçš„å†…å­˜ç©ºé—´æ¥å­˜å‚¨èŠ‚ç‚¹ã€‚

åœ¨å…·æœ‰è‰¯å¥½åˆ†å¸ƒçš„hashCodeä½¿ç”¨ä¸­ï¼Œå¾ˆå°‘ä½¿ç”¨çº¢é»‘æ ‘ã€‚

ç†æƒ³æƒ…å†µä¸‹ï¼Œåœ¨éšæœºhashCodeä¸‹ï¼ŒèŠ‚ç‚¹åœ¨æ¡¶ä¸­çš„é¢‘ç‡éµå¾ªæ³Šæ¾åˆ†å¸ƒï¼ˆhttps://zh.wikipedia.org/wiki/åœç“¦æ¾åˆ†å¸ƒï¼‰ï¼Œå¹³å‡ç¼©æ”¾é˜ˆå€¼ä¸º0.75ï¼Œå¿½ç•¥æ–¹å·®ï¼Œåˆ—è¡¨å¤§å°kçš„é¢„æœŸå‡ºç°æ¬¡æ•°ä¸ºï¼ˆexpï¼ˆ-0.5ï¼‰* powï¼ˆ0.5ï¼Œkï¼‰/ factorialï¼ˆkï¼‰ï¼‰ã€‚

å‰å‡ ä¸ªå€¼æ˜¯ï¼š
0: 0.60653066
1: 0.30326533
2: 0.07581633
3: 0.01263606
4: 0.00157952
5: 0.00015795
6: 0.00001316
7: 0.00000094
8: 0.00000006

æ›´å¤šï¼šå°äºä¸€åƒä¸‡åˆ†ä¹‹ä¸€
```

è™½ç„¶è¿™æ®µè¯çš„æœ¬æ„æ›´å¤šçš„æ˜¯è¡¨ç¤º jdk 8ä¸­ä¸ºä»€ä¹ˆæ‹‰é“¾é•¿åº¦è¶…è¿‡8çš„æ—¶å€™è¿›è¡Œäº†çº¢é»‘æ ‘è½¬æ¢ï¼Œä½†æåˆ°äº† 0.75 è¿™ä¸ªåŠ è½½å› å­ï¼Œä½†æ²¡æåˆ°åº•ä¸ºä»€ä¹ˆã€‚

ä¸ºäº†ææ¸…æ¥šåˆ°åº•ä¸ºä»€ä¹ˆï¼Œæˆ‘çœ‹åˆ°äº†è¿™ç¯‡æ–‡ç« ï¼š

>å‚è€ƒé“¾æ¥ï¼š[https://segmentfault.com/a/1190000023308658](https://segmentfault.com/a/1190000023308658)

é‡Œé¢æåˆ°äº†ä¸€ä¸ªæ¦‚å¿µï¼š**äºŒé¡¹åˆ†å¸ƒï¼ˆBinomial Distributionï¼‰**ã€‚

åœ¨åšä¸€ä»¶äº‹æƒ…çš„æ—¶å€™ï¼Œå…¶ç»“æœçš„æ¦‚ç‡åªæœ‰2ç§æƒ…å†µï¼Œå’ŒæŠ›ç¡¬å¸ä¸€æ ·ï¼Œä¸æ˜¯æ­£é¢å°±æ˜¯åé¢ã€‚

å‡å¦‚ï¼Œæˆ‘ä»¬åšäº† N æ¬¡å®éªŒï¼Œé‚£ä¹ˆåœ¨æ¯æ¬¡è¯•éªŒä¸­åªæœ‰ä¸¤ç§å¯èƒ½çš„ç»“æœï¼Œå¹¶ä¸”æ¯æ¬¡å®éªŒæ˜¯ç‹¬ç«‹çš„ï¼Œä¸åŒå®éªŒä¹‹é—´äº’ä¸å½±å“ï¼Œæ¯æ¬¡å®éªŒæˆåŠŸçš„æ¦‚ç‡éƒ½æ˜¯ä¸€æ ·çš„ã€‚

ä»¥æ­¤ç†è®ºä¸ºåŸºç¡€ï¼šæˆ‘ä»¬å¾€å“ˆå¸Œè¡¨ä¸­æ‰”æ•°æ®ï¼Œå¦‚æœå‘ç”Ÿå“ˆå¸Œå†²çªå°±ä¸ºå¤±è´¥ï¼Œå¦åˆ™ä¸ºæˆåŠŸã€‚

æˆ‘ä»¬å¯ä»¥è®¾æƒ³ï¼Œå®éªŒçš„hashå€¼æ˜¯éšæœºçš„ï¼Œå¹¶ä¸”ç»è¿‡hashè¿ç®—çš„é”®éƒ½ä¼šæ˜ å°„åˆ°hashè¡¨çš„åœ°å€ç©ºé—´ä¸Šï¼Œé‚£ä¹ˆè¿™ä¸ªç»“æœä¹Ÿæ˜¯éšæœºçš„ã€‚æ‰€ä»¥ï¼Œæ¯æ¬¡putçš„æ—¶å€™å°±ç›¸å½“äºæˆ‘ä»¬åœ¨æ‰”ä¸€ä¸ª16é¢ï¼ˆHashMap ç¬¬ä¸€æ¬¡æ‰©å®¹åçš„æ•°ç»„é»˜è®¤é•¿åº¦ä¸º16ï¼‰çš„éª°å­ï¼Œæ‰”éª°å­å®éªŒé‚£è‚¯å®šæ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚ç¢°æ’å‘ç”Ÿå³æ‰”äº†næ¬¡æœ‰å‡ºç°é‡å¤æ•°å­—ã€‚

ç„¶åï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯å•¥å‘¢ï¼Ÿ

å°±æ˜¯æ·äº†kæ¬¡éª°å­ï¼Œæ²¡æœ‰ä¸€æ¬¡æ˜¯ç›¸åŒçš„æ¦‚ç‡ï¼Œéœ€è¦å°½å¯èƒ½çš„å¤§äº›ï¼Œä¸€èˆ¬æ„ä¹‰ä¸Šæˆ‘ä»¬è‚¯å®šè¦å¤§äº0.5ï¼ˆè¿™ä¸ªæ•°æ˜¯ä¸ªç†æƒ³æ•°ï¼‰ã€‚

äºæ˜¯ï¼Œnæ¬¡äº‹ä»¶é‡Œé¢ï¼Œç¢°æ’ä¸º0çš„æ¦‚ç‡ï¼Œç”±ä¸Šé¢å…¬å¼å¾—ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-loadfactor-02.png)

è¿™ä¸ªæ¦‚ç‡å€¼éœ€è¦å¤§äº0.5ï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™æ ·çš„hashmapå¯ä»¥æä¾›å¾ˆä½çš„ç¢°æ’ç‡ã€‚æ‰€ä»¥ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-loadfactor-03png)

è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯¹äºè¯¥å…¬å¼å…¶å®æœ€æƒ³æ±‚çš„æ—¶å€™é•¿åº¦sçš„æ—¶å€™ï¼Œnä¸ºå¤šå°‘æ¬¡å°±åº”è¯¥è¿›è¡Œæ‰©å®¹äº†ï¼Ÿè€Œè´Ÿè½½å› å­åˆ™æ˜¯$n/s$çš„å€¼ã€‚æ‰€ä»¥æ¨å¯¼å¦‚ä¸‹ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-loadfactor-04.png)

æ‰€ä»¥å¯ä»¥å¾—åˆ°

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-loadfactor-05.png)

å…¶ä¸­

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-loadfactor-06.png)

è¿™å°±æ˜¯ä¸€ä¸ªæ±‚ `âˆâ‹…0`å‡½æ•°æé™é—®é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆä»¤$s = m+1ï¼ˆm \to \inftyï¼‰$åˆ™è½¬åŒ–ä¸º

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-loadfactor-07.png)

æˆ‘ä»¬å†ä»¤ $x = \frac{1}{m} ï¼ˆx \to 0ï¼‰$ åˆ™æœ‰ï¼Œ

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-loadfactor-08.png)

æ‰€ä»¥

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-loadfactor-09.png)


è€ƒè™‘åˆ° HashMapçš„å®¹é‡æœ‰ä¸€ä¸ªè¦æ±‚ï¼šå®ƒå¿…é¡»æ˜¯2çš„n æ¬¡å¹‚ã€‚å½“åŠ è½½å› å­é€‰æ‹©äº†0.75å°±å¯ä»¥ä¿è¯å®ƒä¸å®¹é‡çš„ä¹˜ç§¯ä¸ºæ•´æ•°ã€‚

```
16*0.75=12
32*0.75=24
```

é™¤äº† 0.75ï¼Œ0.5~1 ä¹‹é—´è¿˜æœ‰ 0.625ï¼ˆ5/8ï¼‰ã€0.875ï¼ˆ7/8ï¼‰å¯é€‰ï¼Œä»ä¸­ä½æ•°çš„è§’åº¦ï¼ŒæŒ‘ 0.75 æ¯”è¾ƒå®Œç¾ã€‚å¦å¤–ï¼Œç»´åŸºç™¾ç§‘ä¸Šè¯´ï¼Œæ‹‰é“¾æ³•ï¼ˆè§£å†³å“ˆå¸Œå†²çªçš„ä¸€ç§ï¼‰çš„åŠ è½½å› å­æœ€å¥½é™åˆ¶åœ¨ 0.7-0.8ä»¥ä¸‹ï¼Œè¶…è¿‡0.8ï¼ŒæŸ¥è¡¨æ—¶çš„CPUç¼“å­˜ä¸å‘½ä¸­ï¼ˆcache missingï¼‰ä¼šæŒ‰ç…§æŒ‡æ•°æ›²çº¿ä¸Šå‡ã€‚

ç»¼ä¸Šï¼Œ0.75 æ˜¯ä¸ªæ¯”è¾ƒå®Œç¾çš„é€‰æ‹©ã€‚

#### å°ç»“

HashMap çš„åŠ è½½å› å­ï¼ˆload factorï¼Œç›´è¯‘ä¸ºåŠ è½½å› å­ï¼Œæ„è¯‘ä¸ºè´Ÿè½½å› å­ï¼‰æ˜¯æŒ‡å“ˆå¸Œè¡¨ä¸­å¡«å……å…ƒç´ çš„ä¸ªæ•°ä¸æ¡¶çš„æ•°é‡çš„æ¯”å€¼ï¼Œå½“å…ƒç´ ä¸ªæ•°è¾¾åˆ°è´Ÿè½½å› å­ä¸æ¡¶çš„æ•°é‡çš„ä¹˜ç§¯æ—¶ï¼Œå°±éœ€è¦è¿›è¡Œæ‰©å®¹ã€‚è¿™ä¸ªå€¼ä¸€èˆ¬é€‰æ‹© 0.75ï¼Œæ˜¯å› ä¸ºè¿™ä¸ªå€¼å¯ä»¥åœ¨æ—¶é—´å’Œç©ºé—´æˆæœ¬ä¹‹é—´åšåˆ°ä¸€ä¸ªæŠ˜ä¸­ï¼Œä½¿å¾—å“ˆå¸Œè¡¨çš„æ€§èƒ½è¾¾åˆ°è¾ƒå¥½çš„è¡¨ç°ã€‚

å¦‚æœè´Ÿè½½å› å­è¿‡å¤§ï¼Œå¡«å……å› å­è¾ƒå¤šï¼Œé‚£ä¹ˆå“ˆå¸Œè¡¨ä¸­çš„å…ƒç´ å°±ä¼šè¶Šæ¥è¶Šå¤šåœ°èšé›†åœ¨å°‘æ•°çš„æ¡¶ä¸­ï¼Œè¿™å°±å¯¼è‡´äº†å†²çªçš„å¢åŠ ï¼Œè¿™äº›å†²çªä¼šå¯¼è‡´æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ•ˆç‡ä¸‹é™ã€‚åŒæ—¶ï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´éœ€è¦æ›´é¢‘ç¹åœ°è¿›è¡Œæ‰©å®¹ï¼Œè¿›ä¸€æ­¥é™ä½äº†æ€§èƒ½ã€‚

å¦‚æœè´Ÿè½½å› å­è¿‡å°ï¼Œé‚£ä¹ˆæ¡¶çš„æ•°é‡ä¼šå¾ˆå¤šï¼Œè™½ç„¶å¯ä»¥å‡å°‘å†²çªï¼Œä½†æ˜¯åœ¨ç©ºé—´åˆ©ç”¨ä¸Šé¢ä¹Ÿä¼šæœ‰æµªè´¹ï¼Œå› æ­¤é€‰æ‹© 0.75 æ˜¯ä¸ºäº†å–å¾—ä¸€ä¸ªå¹³è¡¡ç‚¹ï¼Œå³åœ¨æ—¶é—´å’Œç©ºé—´æˆæœ¬ä¹‹é—´å–å¾—ä¸€ä¸ªæ¯”è¾ƒå¥½çš„å¹³è¡¡ç‚¹ã€‚

æ€»ä¹‹ï¼Œé€‰æ‹© 0.75 è¿™ä¸ªå€¼æ˜¯ä¸ºäº†åœ¨æ—¶é—´å’Œç©ºé—´æˆæœ¬ä¹‹é—´è¾¾åˆ°ä¸€ä¸ªè¾ƒå¥½çš„å¹³è¡¡ç‚¹ï¼Œæ—¢å¯ä»¥ä¿è¯å“ˆå¸Œè¡¨çš„æ€§èƒ½è¡¨ç°ï¼Œåˆèƒ½å¤Ÿå……åˆ†åˆ©ç”¨ç©ºé—´ã€‚

### 04ã€çº¿ç¨‹ä¸å®‰å…¨

å…¶å®è¿™ä¸ªé—®é¢˜ä¹Ÿä¸ç”¨è¯´å¤ªå¤šï¼Œä½†è€ƒè™‘åˆ°[é¢è¯•çš„æ—¶å€™æœ‰äº›é¢è¯•å®˜ä¼šé—®](https://tobebetterjavaer.com/interview/java-hashmap-13.html)ï¼Œé‚£å°±ç®€å•è¯´ä¸€ä¸‹ã€‚

ä¸‰æ–¹é¢åŸå› ï¼š

- å¤šçº¿ç¨‹ä¸‹æ‰©å®¹ä¼šæ­»å¾ªç¯
- å¤šçº¿ç¨‹ä¸‹ put ä¼šå¯¼è‡´å…ƒç´ ä¸¢å¤±
- put å’Œ get å¹¶å‘æ—¶ä¼šå¯¼è‡´ get åˆ° null

#### 1ï¼‰å¤šçº¿ç¨‹ä¸‹æ‰©å®¹ä¼šæ­»å¾ªç¯

ä¼—æ‰€å‘¨çŸ¥ï¼ŒHashMap æ˜¯é€šè¿‡æ‹‰é“¾æ³•æ¥è§£å†³å“ˆå¸Œå†²çªçš„ï¼Œä¹Ÿå°±æ˜¯å½“å“ˆå¸Œå†²çªæ—¶ï¼Œä¼šå°†ç›¸åŒå“ˆå¸Œå€¼çš„é”®å€¼å¯¹é€šè¿‡é“¾è¡¨çš„å½¢å¼å­˜æ”¾èµ·æ¥ã€‚

JDK 7 æ—¶ï¼Œé‡‡ç”¨çš„æ˜¯å¤´éƒ¨æ’å…¥çš„æ–¹å¼æ¥å­˜æ”¾é“¾è¡¨çš„ï¼Œä¹Ÿå°±æ˜¯ä¸‹ä¸€ä¸ªå†²çªçš„é”®å€¼å¯¹ä¼šæ”¾åœ¨ä¸Šä¸€ä¸ªé”®å€¼å¯¹çš„å‰é¢ï¼ˆè®²æ‰©å®¹çš„æ—¶å€™è®²è¿‡äº†ï¼‰ã€‚æ‰©å®¹çš„æ—¶å€™å°±æœ‰å¯èƒ½å¯¼è‡´å‡ºç°ç¯å½¢é“¾è¡¨ï¼Œé€ æˆæ­»å¾ªç¯ã€‚

resize æ–¹æ³•çš„æºç ï¼š

```java
// newCapacityä¸ºæ–°çš„å®¹é‡
void resize(int newCapacity) {
    // å°æ•°ç»„ï¼Œä¸´æ—¶è¿‡åº¦ä¸‹
    Entry[] oldTable = table;
    // æ‰©å®¹å‰çš„å®¹é‡
    int oldCapacity = oldTable.length;
    // MAXIMUM_CAPACITY ä¸ºæœ€å¤§å®¹é‡ï¼Œ2 çš„ 30 æ¬¡æ–¹ = 1<<30
    if (oldCapacity == MAXIMUM_CAPACITY) {
        // å®¹é‡è°ƒæ•´ä¸º Integer çš„æœ€å¤§å€¼ 0x7fffffffï¼ˆåå…­è¿›åˆ¶ï¼‰=2 çš„ 31 æ¬¡æ–¹-1
        threshold = Integer.MAX_VALUE;
        return;
    }

    // åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼ˆå¤§å®¹é‡ï¼‰
    Entry[] newTable = new Entry[newCapacity];
    // æŠŠå°æ•°ç»„çš„å…ƒç´ è½¬ç§»åˆ°å¤§æ•°ç»„ä¸­
    transfer(newTable, initHashSeedAsNeeded(newCapacity));
    // å¼•ç”¨æ–°çš„å¤§æ•°ç»„
    table = newTable;
    // é‡æ–°è®¡ç®—é˜ˆå€¼
    threshold = (int)Math.min(newCapacity * loadFactor, MAXIMUM_CAPACITY + 1);
}
```

transfer æ–¹æ³•ç”¨æ¥è½¬ç§»ï¼Œå°†å°æ•°ç»„çš„å…ƒç´ æ‹·è´åˆ°æ–°çš„æ•°ç»„ä¸­ã€‚

```java
void transfer(Entry[] newTable, boolean rehash) {
    // æ–°çš„å®¹é‡
    int newCapacity = newTable.length;
    // éå†å°æ•°ç»„
    for (Entry<K,V> e : table) {
        while(null != e) {
            // æ‹‰é“¾æ³•ï¼Œç›¸åŒ key ä¸Šçš„ä¸åŒå€¼
            Entry<K,V> next = e.next;
            // æ˜¯å¦éœ€è¦é‡æ–°è®¡ç®— hash
            if (rehash) {
                e.hash = null == e.key ? 0 : hash(e.key);
            }
            // æ ¹æ®å¤§æ•°ç»„çš„å®¹é‡ï¼Œå’Œé”®çš„ hash è®¡ç®—å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡
            int i = indexFor(e.hash, newCapacity);

            // åŒä¸€ä½ç½®ä¸Šçš„æ–°å…ƒç´ è¢«æ”¾åœ¨é“¾è¡¨çš„å¤´éƒ¨
            e.next = newTable[i];

            // æ”¾åœ¨æ–°çš„æ•°ç»„ä¸Š
            newTable[i] = e;

            // é“¾è¡¨ä¸Šçš„ä¸‹ä¸€ä¸ªå…ƒç´ 
            e = next;
        }
    }
}
```

æ³¨æ„ `e.next = newTable[i]` å’Œ `newTable[i] = e` è¿™ä¸¤è¡Œä»£ç ï¼Œå°±ä¼šå°†åŒä¸€ä½ç½®ä¸Šçš„æ–°å…ƒç´ è¢«æ”¾åœ¨é“¾è¡¨çš„å¤´éƒ¨ã€‚

æ‰©å®¹å‰çš„æ ·å­å‡å¦‚æ˜¯ä¸‹é¢è¿™æ ·å­ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-thread-nosafe-01.png)

é‚£ä¹ˆæ­£å¸¸æ‰©å®¹åå°±æ˜¯ä¸‹é¢è¿™æ ·å­ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-thread-nosafe-02.png)

å‡è®¾ç°åœ¨æœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œæ‰©å®¹ï¼Œçº¿ç¨‹ A åœ¨æ‰§è¡Œåˆ° `newTable[i] = e;` è¢«æŒ‚èµ·ï¼Œæ­¤æ—¶çº¿ç¨‹ A ä¸­ï¼še=3ã€next=7ã€e.next=null

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-thread-nosafe-03.png)


çº¿ç¨‹ B å¼€å§‹æ‰§è¡Œï¼Œå¹¶ä¸”å®Œæˆäº†æ•°æ®è½¬ç§»ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-thread-nosafe-04.png)


æ­¤æ—¶ï¼Œ7 çš„ next ä¸º 3ï¼Œ3 çš„ next ä¸º nullã€‚

éšåçº¿ç¨‹Aè·å¾—CPUæ—¶é—´ç‰‡ç»§ç»­æ‰§è¡Œ `newTable[i] = e`ï¼Œå°†3æ”¾å…¥æ–°æ•°ç»„å¯¹åº”çš„ä½ç½®ï¼Œæ‰§è¡Œå®Œæ­¤è½®å¾ªç¯åçº¿ç¨‹Açš„æƒ…å†µå¦‚ä¸‹ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-thread-nosafe-05.png)

æ‰§è¡Œä¸‹ä¸€è½®å¾ªç¯ï¼Œæ­¤æ—¶ e=7ï¼ŒåŸæœ¬çº¿ç¨‹ A ä¸­ 7 çš„ next ä¸º 5ï¼Œä½†ç”±äº table æ˜¯çº¿ç¨‹ A å’Œçº¿ç¨‹ B å…±äº«çš„ï¼Œè€Œçº¿ç¨‹ B é¡ºåˆ©æ‰§è¡Œå®Œåï¼Œ7 çš„ next å˜æˆäº† 3ï¼Œé‚£ä¹ˆæ­¤æ—¶çº¿ç¨‹ A ä¸­ï¼Œ7 çš„ next ä¹Ÿä¸º 3 äº†ã€‚

é‡‡ç”¨å¤´éƒ¨æ’å…¥çš„æ–¹å¼ï¼Œå˜æˆäº†ä¸‹é¢è¿™æ ·å­ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-thread-nosafe-06.png)

å¥½åƒä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œæ­¤æ—¶ next = 3ï¼Œe = 3ã€‚

è¿›è¡Œä¸‹ä¸€è½®å¾ªç¯ï¼Œä½†æ­¤æ—¶ï¼Œç”±äºçº¿ç¨‹ B å°† 3 çš„ next å˜ä¸ºäº† nullï¼Œæ‰€ä»¥æ­¤è½®å¾ªç¯åº”è¯¥æ˜¯æœ€åä¸€è½®äº†ã€‚

æ¥ä¸‹æ¥å½“æ‰§è¡Œå®Œ `e.next=newTable[i]` å³ 3.next=7 åï¼Œ3 å’Œ 7 ä¹‹é—´å°±ç›¸äº’é“¾æ¥äº†ï¼Œæ‰§è¡Œå®Œ `newTable[i]=e` åï¼Œ3 è¢«å¤´æ’æ³•é‡æ–°æ’å…¥åˆ°é“¾è¡¨ä¸­ï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-thread-nosafe-07.png)

å¥—å¨ƒå¼€å§‹ï¼Œå…ƒç´  5 ä¹Ÿå°±æˆäº†å¼ƒå©´ï¼Œæƒ¨~~~

ä¸è¿‡ï¼ŒJDK 8 æ—¶å·²ç»ä¿®å¤äº†è¿™ä¸ªé—®é¢˜ï¼Œæ‰©å®¹æ—¶ä¼šä¿æŒé“¾è¡¨åŸæ¥çš„é¡ºåºï¼ˆå—¯ï¼Œç­‰äºè¯´äº†åŠå¤©ç™½è¯´äº†ï¼Œå“ˆå“ˆï¼Œè¿™ä¸ªé¢è¯•é¢˜ç¡®å®æ˜¯è¿™æ ·ï¼Œå¾ˆæ°´ï¼Œä½†æœ‰äº›é¢è¯•å®˜åˆç¡®å®æ¯”è¾ƒè£…é€¼ï¼‰ã€‚

#### 2ï¼‰å¤šçº¿ç¨‹ä¸‹ put ä¼šå¯¼è‡´å…ƒç´ ä¸¢å¤±

æ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼ŒHashMap æ˜¯è¿™æ ·çš„ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-thread-nosafe-08.png)

ä½†å¤šçº¿ç¨‹åŒæ—¶æ‰§è¡Œ put æ“ä½œæ—¶ï¼Œå¦‚æœè®¡ç®—å‡ºæ¥çš„ç´¢å¼•ä½ç½®æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¼šé€ æˆå‰ä¸€ä¸ª key è¢«åä¸€ä¸ª key è¦†ç›–ï¼Œä»è€Œå¯¼è‡´å…ƒç´ çš„ä¸¢å¤±ã€‚

put çš„æºç ï¼š

```java
final V putVal(int hash, K key, V value, boolean onlyIfAbsent,
               boolean evict) {
    Node<K,V>[] tab; Node<K,V> p; int n, i;

    // æ­¥éª¤â‘ ï¼štabä¸ºç©ºåˆ™åˆ›å»º
    if ((tab = table) == null || (n = tab.length) == 0)
        n = (tab = resize()).length;

    // æ­¥éª¤â‘¡ï¼šè®¡ç®—indexï¼Œå¹¶å¯¹nullåšå¤„ç† 
    if ((p = tab[i = (n - 1) & hash]) == null)
        tab[i] = newNode(hash, key, value, null);
    else {
        Node<K,V> e; K k;

        // æ­¥éª¤â‘¢ï¼šèŠ‚ç‚¹keyå­˜åœ¨ï¼Œç›´æ¥è¦†ç›–value
        if (p.hash == hash &&
            ((k = p.key) == key || (key != null && key.equals(k))))
            e = p;

        // æ­¥éª¤â‘£ï¼šåˆ¤æ–­è¯¥é“¾ä¸ºçº¢é»‘æ ‘
        else if (p instanceof TreeNode)
            e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value);

        // æ­¥éª¤â‘¤ï¼šè¯¥é“¾ä¸ºé“¾è¡¨
        else {
            for (int binCount = 0; ; ++binCount) {
                if ((e = p.next) == null) {
                    p.next = newNode(hash, key, value, null);

                    //é“¾è¡¨é•¿åº¦å¤§äº8è½¬æ¢ä¸ºçº¢é»‘æ ‘è¿›è¡Œå¤„ç†
                    if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st
                        treeifyBin(tab, hash);
                    break;
                }

                // keyå·²ç»å­˜åœ¨ç›´æ¥è¦†ç›–value
                if (e.hash == hash &&
                    ((k = e.key) == key || (key != null && key.equals(k))))
                    break;
                p = e;
            }
        }

        // æ­¥éª¤â‘¥ã€ç›´æ¥è¦†ç›–
        if (e != null) { // existing mapping for key
            V oldValue = e.value;
            if (!onlyIfAbsent || oldValue == null)
                e.value = value;
            afterNodeAccess(e);
            return oldValue;
        }
    }
    ++modCount;

    // æ­¥éª¤â‘¦ï¼šè¶…è¿‡æœ€å¤§å®¹é‡ å°±æ‰©å®¹
    if (++size > threshold)
        resize();
    afterNodeInsertion(evict);
    return null;
}
```

é—®é¢˜å‘ç”Ÿåœ¨æ­¥éª¤ â‘¡ è¿™é‡Œï¼š

```java
if ((p = tab[i = (n - 1) & hash]) == null)
    tab[i] = newNode(hash, key, value, null);
```

ä¸¤ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œäº† if è¯­å¥ï¼Œå‡è®¾çº¿ç¨‹ A å…ˆæ‰§è¡Œäº† ` tab[i] = newNode(hash, key, value, null)`ï¼Œé‚£ table æ˜¯è¿™æ ·çš„ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-thread-nosafe-09.png)

æ¥ç€ï¼Œçº¿ç¨‹ B æ‰§è¡Œäº† ` tab[i] = newNode(hash, key, value, null)`ï¼Œé‚£ table æ˜¯è¿™æ ·çš„ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/hashmap-thread-nosafe-10.png)

3 è¢«å¹²æ‰äº†ã€‚

#### 3ï¼‰put å’Œ get å¹¶å‘æ—¶ä¼šå¯¼è‡´ get åˆ° null

çº¿ç¨‹ A æ‰§è¡Œputæ—¶ï¼Œå› ä¸ºå…ƒç´ ä¸ªæ•°è¶…å‡ºé˜ˆå€¼è€Œå‡ºç°æ‰©å®¹ï¼Œçº¿ç¨‹B æ­¤æ—¶æ‰§è¡Œgetï¼Œæœ‰å¯èƒ½å¯¼è‡´è¿™ä¸ªé—®é¢˜ã€‚

æ³¨æ„æ¥çœ‹ resize æºç ï¼š

```java
final Node<K,V>[] resize() {
    Node<K,V>[] oldTab = table;
    int oldCap = (oldTab == null) ? 0 : oldTab.length;
    int oldThr = threshold;
    int newCap, newThr = 0;
    if (oldCap > 0) {
        // è¶…è¿‡æœ€å¤§å€¼å°±ä¸å†æ‰©å……äº†ï¼Œå°±åªå¥½éšä½ ç¢°æ’å»å§
        if (oldCap >= MAXIMUM_CAPACITY) {
            threshold = Integer.MAX_VALUE;
            return oldTab;
        }
        // æ²¡è¶…è¿‡æœ€å¤§å€¼ï¼Œå°±æ‰©å……ä¸ºåŸæ¥çš„2å€
        else if ((newCap = oldCap << 1) < MAXIMUM_CAPACITY &&
                 oldCap >= DEFAULT_INITIAL_CAPACITY)
            newThr = oldThr << 1; // double threshold
    }
    else if (oldThr > 0) // initial capacity was placed in threshold
        newCap = oldThr;
    else {               // zero initial threshold signifies using defaults
        newCap = DEFAULT_INITIAL_CAPACITY;
        newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);
    }
    // è®¡ç®—æ–°çš„resizeä¸Šé™
    if (newThr == 0) {
        float ft = (float)newCap * loadFactor;
        newThr = (newCap < MAXIMUM_CAPACITY && ft < (float)MAXIMUM_CAPACITY ?
                  (int)ft : Integer.MAX_VALUE);
    }
    threshold = newThr;
    @SuppressWarnings({"rawtypes","unchecked"})
        Node<K,V>[] newTab = (Node<K,V>[])new Node[newCap];
    table = newTab;
}
```

çº¿ç¨‹ A æ‰§è¡Œå®Œ `table = newTab` ä¹‹åï¼Œçº¿ç¨‹ B ä¸­çš„ table æ­¤æ—¶ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œæ­¤æ—¶å» get çš„æ—¶å€™å½“ç„¶ä¼š get åˆ° null äº†ï¼Œå› ä¸ºå…ƒç´ è¿˜æ²¡æœ‰è½¬ç§»ã€‚

å‚è€ƒé“¾æ¥ï¼š

> - [https://blog.csdn.net/lonyw/article/details/80519652](https://blog.csdn.net/lonyw/article/details/80519652)
> - [https://zhuanlan.zhihu.com/p/91636401](https://zhuanlan.zhihu.com/p/91636401)
> - [https://www.zhihu.com/question/20733617](https://www.zhihu.com/question/20733617)
> - [https://zhuanlan.zhihu.com/p/21673805](https://zhuanlan.zhihu.com/p/21673805)

#### 4ï¼‰å°ç»“

HashMap æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ä¸»è¦æ˜¯å› ä¸ºå®ƒåœ¨è¿›è¡Œæ’å…¥ã€åˆ é™¤å’Œæ‰©å®¹ç­‰æ“ä½œæ—¶å¯èƒ½ä¼šå¯¼è‡´é“¾è¡¨çš„ç»“æ„å‘ç”Ÿå˜åŒ–ï¼Œä»è€Œç ´åäº† HashMap çš„ä¸å˜æ€§ã€‚å…·ä½“æ¥è¯´ï¼Œå¦‚æœåœ¨ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨éå† HashMap çš„é“¾è¡¨æ—¶ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹å¯¹è¯¥é“¾è¡¨è¿›è¡Œäº†ä¿®æ”¹ï¼ˆæ¯”å¦‚æ·»åŠ äº†ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´é“¾è¡¨çš„ç»“æ„å‘ç”Ÿå˜åŒ–ï¼Œä»è€Œç ´åäº†å½“å‰çº¿ç¨‹æ­£åœ¨è¿›è¡Œçš„éå†æ“ä½œï¼Œå¯èƒ½å¯¼è‡´éå†å¤±è´¥æˆ–è€…å‡ºç°æ­»å¾ªç¯ç­‰é—®é¢˜ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJava æä¾›äº†çº¿ç¨‹å®‰å…¨çš„ HashMap å®ç°ç±» [ConcurrentHashMap](https://tobebetterjavaer.com/thread/ConcurrentHashMap.html)ã€‚ConcurrentHashMap å†…éƒ¨é‡‡ç”¨äº†åˆ†æ®µé”ï¼ˆSegmentï¼‰ï¼Œå°†æ•´ä¸ª Map æ‹†åˆ†ä¸ºå¤šä¸ªå°çš„ HashMapï¼Œæ¯ä¸ªå°çš„ HashMap éƒ½æœ‰è‡ªå·±çš„é”ï¼Œä¸åŒçš„çº¿ç¨‹å¯ä»¥åŒæ—¶è®¿é—®ä¸åŒçš„å° Mapï¼Œä»è€Œå®ç°äº†çº¿ç¨‹å®‰å…¨ã€‚åœ¨è¿›è¡Œæ’å…¥ã€åˆ é™¤å’Œæ‰©å®¹ç­‰æ“ä½œæ—¶ï¼Œåªéœ€è¦é”ä½å½“å‰å° Mapï¼Œä¸ä¼šå¯¹æ•´ä¸ª Map è¿›è¡Œé”å®šï¼Œæé«˜äº†å¹¶å‘è®¿é—®çš„æ•ˆç‡ã€‚

### 05ã€æ€»ç»“

HashMapæ˜¯Javaä¸­æœ€å¸¸ç”¨çš„é›†åˆä¹‹ä¸€ï¼Œå®ƒæ˜¯ä¸€ç§é”®å€¼å¯¹å­˜å‚¨çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥æ ¹æ®é”®æ¥å¿«é€Ÿè®¿é—®å¯¹åº”çš„å€¼ã€‚ä»¥ä¸‹æ˜¯å¯¹HashMapçš„æ€»ç»“ï¼š

- HashMapé‡‡ç”¨æ•°ç»„+é“¾è¡¨/çº¢é»‘æ ‘çš„å­˜å‚¨ç»“æ„ï¼Œèƒ½å¤Ÿåœ¨O(1)çš„æ—¶é—´å¤æ‚åº¦å†…å®ç°å…ƒç´ çš„æ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾ç­‰æ“ä½œã€‚
- HashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå› æ­¤åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹éœ€è¦ä½¿ç”¨[ConcurrentHashMap](https://tobebetterjavaer.com/thread/ConcurrentHashMap.html)æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚
- HashMapçš„æ‰©å®¹æœºåˆ¶æ˜¯é€šè¿‡æ‰©å¤§æ•°ç»„å®¹é‡å’Œé‡æ–°è®¡ç®—hashå€¼æ¥å®ç°çš„ï¼Œæ‰©å®¹æ—¶éœ€è¦é‡æ–°è®¡ç®—æ‰€æœ‰å…ƒç´ çš„hashå€¼ï¼Œå› æ­¤åœ¨å…ƒç´ è¾ƒå¤šæ—¶æ‰©å®¹ä¼šå½±å“æ€§èƒ½ã€‚
- åœ¨Java 8ä¸­ï¼ŒHashMapçš„å®ç°å¼•å…¥äº†æ‹‰é“¾æ³•ã€æ ‘åŒ–ç­‰æœºåˆ¶æ¥ä¼˜åŒ–å¤§é‡å…ƒç´ å­˜å‚¨çš„æƒ…å†µï¼Œè¿›ä¸€æ­¥æå‡äº†æ€§èƒ½ã€‚
- HashMapä¸­çš„keyæ˜¯å”¯ä¸€çš„ï¼Œå¦‚æœè¦å­˜å‚¨é‡å¤çš„keyï¼Œåˆ™åé¢çš„å€¼ä¼šè¦†ç›–å‰é¢çš„å€¼ã€‚
- HashMapçš„åˆå§‹å®¹é‡å’ŒåŠ è½½å› å­éƒ½å¯ä»¥è®¾ç½®ï¼Œåˆå§‹å®¹é‡è¡¨ç¤ºæ•°ç»„çš„åˆå§‹å¤§å°ï¼ŒåŠ è½½å› å­è¡¨ç¤ºæ•°ç»„çš„å¡«å……å› å­ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåˆå§‹å®¹é‡ä¸º16ï¼ŒåŠ è½½å› å­ä¸º0.75ã€‚
- HashMapåœ¨éå†æ—¶æ˜¯æ— åºçš„ï¼Œå› æ­¤å¦‚æœéœ€è¦æœ‰åºéå†ï¼Œå¯ä»¥ä½¿ç”¨[TreeMap](https://tobebetterjavaer.com/collection/treemap.html)ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼ŒHashMapæ˜¯ä¸€ç§é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå…·æœ‰å¿«é€ŸæŸ¥æ‰¾å’Œæ’å…¥å…ƒç´ çš„èƒ½åŠ›ï¼Œä½†éœ€è¦æ³¨æ„çº¿ç¨‹å®‰å…¨å’Œæ€§èƒ½é—®é¢˜ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 6.10 LinkedHashMapè¯¦è§£ï¼ˆé™„æºç ï¼‰

>è¿™ç¯‡ç»§ç»­æ¢ä¸ªæ–‡é£æ¥å†™ï¼Œç»™å¤§å®¶ä¸€ç‚¹æ–°é²œçš„ç©ºæ°”ã€‚

ä¿—è¯è¯´äº†ï¼Œâ€œé‡‘æ— è¶³èµ¤äººæ— å®Œäººâ€ï¼ŒHashMap ä¹Ÿä¸ä¾‹å¤–ï¼Œæœ‰ä¸€ç§éœ€æ±‚å®ƒå°±æ»¡è¶³ä¸äº†ï¼Œå‡å¦‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæŒ‰ç…§æ’å…¥é¡ºåºæ¥æ’åˆ—çš„é”®å€¼å¯¹é›†åˆï¼Œé‚£ HashMap å°±æ— èƒ½ä¸ºåŠ›äº†ã€‚é‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå¿…é¡»å¾—ä¸Šä»Šå¤©è¿™ç¯‡æ–‡ç« çš„ä¸»è§’ï¼šLinkedHashMapã€‚

åŒå­¦ä»¬å¥½å•Šï¼Œè¿˜è®°å¾— [HashMap](https://tobebetterjavaer.com/collection/hashmap.html) é‚£ç¯‡å—ï¼Ÿæˆ‘è‡ªå·±æ„Ÿè§‰å†™å¾—éå¸¸æ£’å•Šï¼Œæ—¢é€šä¿—æ˜“æ‡‚ï¼Œåˆæ·±å…¥æºç ï¼ŒçœŸçš„æ˜¯åˆ†æå¾—é€é€å½»å½»ã€æ¸…æ¸…æ¥šæ¥šã€æ˜æ˜ç™½ç™½çš„ã€‚ï¼ˆä¸€ä¸å°å¿ƒåˆç”©äº†ä¸‰ä¸ªæˆè¯­ï¼Œæœ‰æ–‡åŒ–å§ï¼Ÿï¼‰HashMap å“ªå“ªéƒ½å¥½ï¼ŒçœŸçš„ï¼Œåªè¦ä½ æƒ³ç”¨é”®å€¼å¯¹ï¼Œç¬¬ä¸€æ—¶é—´å°±åº”è¯¥æƒ³åˆ°å®ƒã€‚

ä¸ºäº†æé«˜æŸ¥æ‰¾æ•ˆç‡ï¼ŒHashMap åœ¨æ’å…¥çš„æ—¶å€™å¯¹é”®åšäº†ä¸€æ¬¡å“ˆå¸Œç®—æ³•ï¼Œè¿™å°±å¯¼è‡´æ’å…¥çš„å…ƒç´ æ˜¯æ— åºçš„ã€‚

å¯¹è¿™ä¸€ç‚¹è¿˜ä¸å¤ªæ˜ç™½çš„åŒå­¦ï¼Œå¯ä»¥å†å›åˆ° [HashMap](https://tobebetterjavaer.com/collection/hashmap.html) é‚£ä¸€ç¯‡ï¼Œçœ‹çœ‹ hash æ–¹æ³•ï¼Œå†çœ‹çœ‹æˆ‘å¯¹ `put()` æ–¹æ³•çš„è®²è§£ï¼Œå°±èƒ½æ˜ç™½äº†ï¼Œæˆ‘ä»¬è¿™é‡Œå†æ¥å›é¡¾ä¸€ä¸‹ã€‚

```java
finalÂ VÂ putVal(intÂ hash,Â KÂ key,Â VÂ value,Â booleanÂ onlyIfAbsent,

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â booleanÂ evict)Â {
Â Â Â Â HashMap.Node<K,V>[]Â tab;Â HashMap.Node<K,V>Â p;Â intÂ n,Â i;
Â Â Â Â //Â â‘ ã€æ•°ç»„Â tableÂ ä¸ºÂ nullÂ æ—¶ï¼Œè°ƒç”¨Â resizeÂ æ–¹æ³•åˆ›å»ºé»˜è®¤å¤§å°çš„æ•°ç»„
Â Â Â Â ifÂ ((tabÂ =Â table)Â ==Â nullÂ ||Â (nÂ =Â tab.length)Â ==Â 0)
Â Â Â Â Â Â Â Â nÂ =Â (tabÂ =Â resize()).length;
Â Â Â Â //Â â‘¡ã€è®¡ç®—ä¸‹æ ‡ï¼Œå¦‚æœè¯¥ä½ç½®ä¸Šæ²¡æœ‰å€¼ï¼Œåˆ™å¡«å……
Â Â Â Â ifÂ ((pÂ =Â tab[iÂ =Â (nÂ -Â 1)Â &Â hash])Â ==Â null)
Â Â Â Â Â Â Â Â tab[i]Â =Â newNode(hash,Â key,Â value,Â null);
}
```

å…¶ä¸­è¿™ä¸ªå…¬å¼ `i = (n - 1) & hash` è®¡ç®—åçš„å€¼å°±æ˜¯é”®ä½åœ¨æ•°ç»„ï¼ˆæ¡¶ï¼‰ä¸­çš„ç´¢å¼•ï¼ˆä¸‹æ ‡/ä½ç½®ï¼‰ï¼Œä½†è¿™å®ƒå¹¶ä¸æ˜¯æŒ‰ç…§ 0ã€1ã€2ã€3ã€4ã€5 è¿™æ ·æœ‰åºçš„ä¸‹æ ‡å°†é”®å€¼å¯¹æ’å…¥åˆ°æ•°ç»„å½“ä¸­çš„ï¼Œè€Œæ˜¯æœ‰ä¸€å®šçš„éšæœºæ€§ã€‚

æ¯”å¦‚è¯´é»˜è®¤å¤§å°ä¸º 16 çš„ HashMapï¼Œå¦‚æœ put äº† 4 ä¸ªé”®å€¼å¯¹ï¼Œå¯èƒ½ä¸‹æ ‡æ˜¯ 0ã€4ã€9ã€11ï¼Œé‚£è¿™æ ·çš„è¯ï¼Œåœ¨éå† HashMap çš„æ—¶å€™ï¼Œå°±ä¸ä¸€å®šèƒ½æŒ‰ç…§æ’å…¥é¡ºåºæ¥äº†ã€‚

çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚

```java
// åˆ›å»º HashMap å¯¹è±¡ï¼Œé”®ç±»å‹ä¸º Stringï¼Œå€¼ç±»å‹ä¸º String
Map<String, String> map = new HashMap<>();

// ä½¿ç”¨ put() æ–¹æ³•å‘ HashMap ä¸­æ·»åŠ æ•°æ®
map.put("chenmo", "æ²‰é»˜");
map.put("wanger", "ç‹äºŒ");
map.put("chenqingyang", "é™ˆæ¸…æ‰¬");

// éå† HashMapï¼Œè¾“å‡ºæ‰€æœ‰é”®å€¼å¯¹
for (Map.Entry<String, String> entry : map.entrySet()) {
    String key = entry.getKey();
    String value = entry.getValue();
    System.out.println("Key: " + key + ", Value: " + value);
}
```

æ¥çœ‹è¾“å‡ºç»“æœ

```
Key: chenmo, Value: æ²‰é»˜
Key: chenqingyang, Value: é™ˆæ¸…æ‰¬
Key: wanger, Value: ç‹äºŒ
```

å¯¹æ¯”ä¸€ä¸‹è¾“å‡ºç»“æœå°±å¯ä»¥çœ‹å¾—å‡ºæ¥ï¼Œput çš„æ—¶å€™æ˜¯ æ²‰é»˜ã€ç‹äºŒã€é™ˆæ¸…æ‰¬çš„é¡ºåºï¼Œä½†éå†çš„æ—¶å€™å°±æ²¡æœ‰æŒ‰ç…§è¿™ä¸ªé¡ºåºæ¥ï¼šæ²‰é»˜ã€é™ˆæ¸…æ‰¬ã€ç‹äºŒï¼Œå› ä¸º HashMap æ˜¯æ— åºçš„ã€‚

é‚£æ€ä¹ˆä¿è¯é”®å€¼å¯¹çš„æ’å…¥é¡ºåºå‘¢ï¼Ÿ

LinkedHashMap å°±æ˜¯ä¸ºè¿™ä¸ªéœ€æ±‚åº”è¿è€Œç”Ÿçš„ã€‚LinkedHashMap ç»§æ‰¿äº† HashMapï¼Œæ‰€ä»¥ HashMap æœ‰çš„å…³äºé”®å€¼å¯¹çš„åŠŸèƒ½ï¼Œå®ƒä¹Ÿæœ‰äº†ã€‚

```java
publicÂ classÂ LinkedHashMap<K,V>

Â Â Â Â extendsÂ HashMap<K,V>

Â Â Â Â implementsÂ Map<K,V>{}
```

åœ¨æ­¤åŸºç¡€ä¸Šï¼ŒLinkedHashMap å†…éƒ¨è¿½åŠ äº†åŒå‘é“¾è¡¨ï¼Œæ¥ç»´æŠ¤å…ƒç´ çš„æ’å…¥é¡ºåºã€‚æ³¨æ„ä¸‹é¢ä»£ç ä¸­çš„ before å’Œ afterï¼Œå®ƒä¿©å°±æ˜¯ç”¨æ¥ç»´æŠ¤å½“å‰å…ƒç´ çš„å‰ä¸€ä¸ªå…ƒç´ å’Œåä¸€ä¸ªå…ƒç´ çš„é¡ºåºçš„ã€‚

```java
static class Entry<K,V> extends HashMap.Node<K,V> {
    Entry<K,V> before, after;
    Entry(int hash, K key, V value, Node<K,V> next) {
        super(hash, key, value, next);
    }
}
```

å…³äºåŒå‘é“¾è¡¨ï¼ŒåŒå­¦ä»¬å¯ä»¥å›å¤´çœ‹ä¸€éæˆ‘å†™çš„ [LinkedList](https://tobebetterjavaer.com/collection/linkedlist.html) é‚£ç¯‡æ–‡ç« ï¼Œä¼šå¯¹ç†è§£æœ¬ç¯‡çš„ LinkedHashMap æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚

ç”¨ LinkedHashMap æ›¿æ¢ HashMapï¼Œå†æ¥å¯¹æ¯”ä¸€ä¸‹è¾“å‡ºç»“æœã€‚

```java
// åˆ›å»º LinkedHashMap å¯¹è±¡ï¼Œé”®ç±»å‹ä¸º Stringï¼Œå€¼ç±»å‹ä¸º String
Map<String, String> map = new LinkedHashMap<>();

// ä½¿ç”¨ put() æ–¹æ³•å‘ LinkedHashMap ä¸­æ·»åŠ æ•°æ®
map.put("chenmo", "æ²‰é»˜");
map.put("wanger", "ç‹äºŒ");
map.put("chenqingyang", "é™ˆæ¸…æ‰¬");

// éå† LinkedHashMapï¼Œè¾“å‡ºæ‰€æœ‰é”®å€¼å¯¹
for (Map.Entry<String, String> entry : map.entrySet()) {
    String key = entry.getKey();
    String value = entry.getValue();
    System.out.println("Key: " + key + ", Value: " + value);
}
```

æ¥çœ‹è¾“å‡ºç»“æœï¼š

```
Key: chenmo, Value: æ²‰é»˜
Key: wanger, Value: ç‹äºŒ
Key: chenqingyang, Value: é™ˆæ¸…æ‰¬
```

çœ‹ï¼ŒLinkedHashMap æ˜¯ä¸æ˜¯ä¿æŒäº†æ’å…¥é¡ºåºï¼Ÿè¿™å°±å¯¹äº†ã€‚

### 01ã€æ’å…¥é¡ºåº

åœ¨ [HashMap](https://tobebetterjavaer.com/collection/hashmap.html) é‚£ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘æœ‰è®²è§£åˆ°ä¸€ç‚¹ï¼Œä¸çŸ¥é“åŒå­¦ä»¬è®°ä¸è®°å¾—ï¼Œå°±æ˜¯ null ä¼šæ’å…¥åˆ° HashMap çš„ç¬¬ä¸€ä½ã€‚

```java
Map<String,Â String>Â hashMapÂ =Â newÂ HashMap<>();
hashMap.put("æ²‰",Â "æ²‰é»˜ç‹äºŒ");
hashMap.put("é»˜",Â "æ²‰é»˜ç‹äºŒ");
hashMap.put("ç‹",Â "æ²‰é»˜ç‹äºŒ");
hashMap.put("äºŒ",Â "æ²‰é»˜ç‹äºŒ");
hashMap.put(null,Â null);

forÂ (StringÂ keyÂ :Â hashMap.keySet())Â {
Â Â Â Â System.out.println(keyÂ +Â "Â :Â "Â +Â hashMap.get(key));
}
```

è¾“å‡ºçš„ç»“æœæ˜¯ï¼š

```
nullÂ :Â null
é»˜Â :Â æ²‰é»˜ç‹äºŒ
æ²‰Â :Â æ²‰é»˜ç‹äºŒ
ç‹Â :Â æ²‰é»˜ç‹äºŒ
äºŒÂ :Â æ²‰é»˜ç‹äºŒ
```

è™½ç„¶ null æœ€åä¸€ä½ put è¿›å»çš„ï¼Œä½†åœ¨éå†è¾“å‡ºçš„æ—¶å€™ï¼Œè·‘åˆ°äº†ç¬¬ä¸€ä½ã€‚

é‚£å†æ¥å¯¹æ¯”çœ‹ä¸€ä¸‹ LinkedHashMapã€‚

```java
Map<String,Â String>Â linkedHashMapÂ =Â newÂ LinkedHashMap<>();
linkedHashMap.put("æ²‰",Â "æ²‰é»˜ç‹äºŒ");
linkedHashMap.put("é»˜",Â "æ²‰é»˜ç‹äºŒ");
linkedHashMap.put("ç‹",Â "æ²‰é»˜ç‹äºŒ");
linkedHashMap.put("äºŒ",Â "æ²‰é»˜ç‹äºŒ");
linkedHashMap.put(null,Â null);

forÂ (StringÂ keyÂ :Â linkedHashMap.keySet())Â {
Â Â Â Â System.out.println(keyÂ +Â "Â :Â "Â +Â linkedHashMap.get(key));
}
```

è¾“å‡ºç»“æœæ˜¯ï¼š

```
æ²‰Â :Â æ²‰é»˜ç‹äºŒ
é»˜Â :Â æ²‰é»˜ç‹äºŒ
ç‹Â :Â æ²‰é»˜ç‹äºŒ
äºŒÂ :Â æ²‰é»˜ç‹äºŒ
nullÂ :Â null
```

null åœ¨æœ€åä¸€ä½æ’å…¥ï¼Œåœ¨æœ€åä¸€ä½è¾“å‡ºã€‚

è¾“å‡ºç»“æœå¯ä»¥å†æ¬¡è¯æ˜ï¼Œ**HashMap æ˜¯æ— åºçš„ï¼ŒLinkedHashMap æ˜¯å¯ä»¥ç»´æŒæ’å…¥é¡ºåºçš„**ã€‚

é‚£ LinkedHashMap æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹å‘¢ï¼Ÿæˆ‘ç›¸ä¿¡åŒå­¦ä»¬å’Œæˆ‘ä¸€æ ·ï¼Œéå¸¸å¸Œæœ›çŸ¥é“åŸå› ã€‚

è¦æƒ³ææ¸…æ¥šï¼Œå°±éœ€è¦æ·±å…¥ç ”ç©¶ä¸€ä¸‹ LinkedHashMap çš„æºç ã€‚LinkedHashMap å¹¶æœªé‡å†™ HashMap çš„ `put()` æ–¹æ³•ï¼Œè€Œæ˜¯é‡å†™äº† `put()` æ–¹æ³•éœ€è¦è°ƒç”¨çš„å†…éƒ¨æ–¹æ³• `newNode()`ã€‚

è¿™æ˜¯ HashMap çš„ã€‚

```java
Node<K,V> newNode(int hash, K key, V value, Node<K,V> next) {
    return new Node<>(hash, key, value, next);
}
```

è¿™æ˜¯ LinkedHashMap çš„ã€‚

```java
HashMap.Node<K,V>Â newNode(intÂ hash,Â KÂ key,Â VÂ value,Â HashMap.Node<K,V>Â e)Â {
Â Â Â Â LinkedHashMap.Entry<K,V>Â pÂ =
Â Â Â Â Â Â Â Â Â Â Â Â newÂ LinkedHashMap.Entry<>(hash,Â key,Â value,Â e);
Â Â Â Â linkNodeLast(p);
Â Â Â Â returnÂ p;
}
```

å‰é¢æ›¾æåˆ° LinkedHashMap.Entry ç»§æ‰¿äº† HashMap.Nodeï¼Œå¹¶ä¸”è¿½åŠ äº†ä¸¤ä¸ªå­—æ®µ before å’Œ afterï¼Œç”¨æ¥ç»´æŒé”®å€¼å¯¹çš„å…³ç³»ã€‚

```java
static class Entry<K,V> extends HashMap.Node<K,V> {
    Entry<K,V> before, after;
    Entry(int hash, K key, V value, Node<K,V> next) {
        super(hash, key, value, next);
    }
}
```

åœ¨ LinkedHashMap ä¸­ï¼Œé“¾è¡¨ä¸­çš„èŠ‚ç‚¹é¡ºåºæ˜¯æŒ‰ç…§æ’å…¥é¡ºåºç»´æŠ¤çš„ã€‚å½“ä½¿ç”¨ put() æ–¹æ³•å‘ LinkedHashMap ä¸­æ·»åŠ é”®å€¼å¯¹æ—¶ï¼Œä¼šå°†æ–°èŠ‚ç‚¹æ’å…¥åˆ°é“¾è¡¨çš„å°¾éƒ¨ï¼Œå¹¶æ›´æ–° before å’Œ after å±æ€§ï¼Œä»¥ä¿è¯é“¾è¡¨çš„é¡ºåºå…³ç³»â€”â€”ç”± `linkNodeLast()` æ–¹æ³•æ¥å®Œæˆï¼š

```java
/**
 * å°†æŒ‡å®šèŠ‚ç‚¹æ’å…¥åˆ°é“¾è¡¨çš„å°¾éƒ¨
 *
 * @param p è¦æ’å…¥çš„èŠ‚ç‚¹
 */
private void linkNodeLast(LinkedHashMap.Entry<K,V> p) {
    LinkedHashMap.Entry<K,V> last = tail; // è·å–é“¾è¡¨çš„å°¾èŠ‚ç‚¹
    tail = p; // å°† p è®¾ä¸ºå°¾èŠ‚ç‚¹
    if (last == null)
        head = p; // å¦‚æœé“¾è¡¨ä¸ºç©ºï¼Œåˆ™å°† p è®¾ä¸ºå¤´èŠ‚ç‚¹
    else {
        p.before = last; // å°† p çš„å‰é©±èŠ‚ç‚¹è®¾ä¸ºé“¾è¡¨çš„å°¾èŠ‚ç‚¹
        last.after = p; // å°†é“¾è¡¨çš„å°¾èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹è®¾ä¸º p
    }
}
```

çœ‹åˆ°äº†å§ï¼ŒLinkedHashMap åœ¨æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œä¼šæŠŠ head èµ‹å€¼ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç­‰åˆ°ç¬¬äºŒä¸ªå…ƒç´ æ·»åŠ è¿›æ¥çš„æ—¶å€™ï¼Œä¼šæŠŠç¬¬äºŒä¸ªå…ƒç´ çš„ before èµ‹å€¼ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ çš„ afer èµ‹å€¼ä¸ºç¬¬äºŒä¸ªå…ƒç´ ã€‚

è¿™å°±ä¿è¯äº†é”®å€¼å¯¹æ˜¯æŒ‰ç…§æ’å…¥é¡ºåºæ’åˆ—çš„ï¼Œæ˜ç™½äº†å§ï¼Ÿ

### 02ã€è®¿é—®é¡ºåº

LinkedHashMap ä¸ä»…èƒ½å¤Ÿç»´æŒæ’å…¥é¡ºåºï¼Œè¿˜èƒ½å¤Ÿç»´æŒè®¿é—®é¡ºåºã€‚è®¿é—®åŒ…æ‹¬è°ƒç”¨ `get()` æ–¹æ³•ã€`remove()` æ–¹æ³•å’Œ `put()` æ–¹æ³•ã€‚

è¦ç»´æŠ¤è®¿é—®é¡ºåºï¼Œéœ€è¦æˆ‘ä»¬åœ¨å£°æ˜ LinkedHashMap çš„æ—¶å€™æŒ‡å®šä¸‰ä¸ªå‚æ•°ã€‚

```java
LinkedHashMap<String,Â String>Â mapÂ =Â newÂ LinkedHashMap<>(16,Â .75f,Â true);
```

ç¬¬ä¸€ä¸ªå‚æ•°å’Œç¬¬äºŒä¸ªå‚æ•°ï¼Œçœ‹è¿‡ [HashMap](https://tobebetterjavaer.com/collection/hashmap.html) çš„åŒå­¦ä»¬åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼ŒæŒ‡çš„æ˜¯åˆå§‹å®¹é‡å’Œè´Ÿè½½å› å­ã€‚

ç¬¬ä¸‰ä¸ªå‚æ•°å¦‚æœä¸º true çš„è¯ï¼Œå°±è¡¨ç¤º LinkedHashMap è¦ç»´æŠ¤è®¿é—®é¡ºåºï¼›å¦åˆ™ï¼Œç»´æŠ¤æ’å…¥é¡ºåºã€‚é»˜è®¤æ˜¯ falseã€‚

```java
Map<String,Â String>Â linkedHashMapÂ =Â newÂ LinkedHashMap<>(16,Â .75f,Â true);
linkedHashMap.put("æ²‰",Â "æ²‰é»˜ç‹äºŒ");
linkedHashMap.put("é»˜",Â "æ²‰é»˜ç‹äºŒ");
linkedHashMap.put("ç‹",Â "æ²‰é»˜ç‹äºŒ");
linkedHashMap.put("äºŒ",Â "æ²‰é»˜ç‹äºŒ");

System.out.println(linkedHashMap);

linkedHashMap.get("é»˜");
System.out.println(linkedHashMap);

linkedHashMap.get("ç‹");
System.out.println(linkedHashMap);
```

è¾“å‡ºçš„ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
{æ²‰=æ²‰é»˜ç‹äºŒ,Â é»˜=æ²‰é»˜ç‹äºŒ,Â ç‹=æ²‰é»˜ç‹äºŒ,Â äºŒ=æ²‰é»˜ç‹äºŒ}
{æ²‰=æ²‰é»˜ç‹äºŒ,Â ç‹=æ²‰é»˜ç‹äºŒ,Â äºŒ=æ²‰é»˜ç‹äºŒ,Â é»˜=æ²‰é»˜ç‹äºŒ}
{æ²‰=æ²‰é»˜ç‹äºŒ,Â äºŒ=æ²‰é»˜ç‹äºŒ,Â é»˜=æ²‰é»˜ç‹äºŒ,Â ç‹=æ²‰é»˜ç‹äºŒ}
```

å½“æˆ‘ä»¬ä½¿ç”¨ `get()` æ–¹æ³•è®¿é—®é”®ä½â€œé»˜â€çš„å…ƒç´ åï¼Œè¾“å‡ºç»“æœä¸­ï¼Œ`é»˜=æ²‰é»˜ç‹äºŒ` åœ¨æœ€åï¼›å½“æˆ‘ä»¬è®¿é—®é”®ä½â€œç‹â€çš„å…ƒç´ åï¼Œè¾“å‡ºç»“æœä¸­ï¼Œ`ç‹=æ²‰é»˜ç‹äºŒ` åœ¨æœ€åï¼Œ`é»˜=æ²‰é»˜ç‹äºŒ` åœ¨å€’æ•°ç¬¬äºŒä½ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€ä¸ç»å¸¸è®¿é—®çš„æ”¾åœ¨å¤´éƒ¨ï¼Œè¿™å°±æœ‰æ„æ€äº†ã€‚æœ‰æ„æ€åœ¨å“ªå‘¢ï¼Ÿ

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ LinkedHashMap æ¥å®ç° LRU ç¼“å­˜ï¼ŒLRU æ˜¯ Least Recently Used çš„ç¼©å†™ï¼Œå³æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œæ˜¯ä¸€ç§å¸¸ç”¨çš„é¡µé¢ç½®æ¢ç®—æ³•ï¼Œé€‰æ‹©æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„é¡µé¢äºˆä»¥æ·˜æ±°ã€‚

```java
/**
 * è‡ªå®šä¹‰çš„ MyLinkedHashMap ç±»ï¼Œç»§æ‰¿äº† Java ä¸­å†…ç½®çš„ LinkedHashMap<K, V> ç±»ã€‚
 * ç”¨äºå®ç°ä¸€ä¸ªå…·æœ‰å›ºå®šå¤§å°çš„ç¼“å­˜ï¼Œå½“ç¼“å­˜è¾¾åˆ°æœ€å¤§å®¹é‡æ—¶ï¼Œä¼šè‡ªåŠ¨ç§»é™¤æœ€æ—©åŠ å…¥çš„å…ƒç´ ï¼Œä»¥è…¾å‡ºç©ºé—´ç»™æ–°çš„å…ƒç´ ã€‚
 *
 * @param <K> é”®çš„ç±»å‹
 * @param <V> å€¼çš„ç±»å‹
 */
public class MyLinkedHashMap<K, V> extends LinkedHashMap<K, V> {

    private static final int MAX_ENTRIES = 5; // è¡¨ç¤º MyLinkedHashMap ä¸­æœ€å¤šå­˜å‚¨çš„é”®å€¼å¯¹æ•°é‡

    /**
     * æ„é€ æ–¹æ³•ï¼Œä½¿ç”¨ super() è°ƒç”¨äº†çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œå¹¶ä¼ é€’äº†ä¸‰ä¸ªå‚æ•°ï¼šinitialCapacityã€loadFactor å’Œ accessOrderã€‚
     *
     * @param initialCapacity åˆå§‹å®¹é‡
     * @param loadFactor      è´Ÿè½½å› å­
     * @param accessOrder     è®¿é—®é¡ºåº
     */
    public MyLinkedHashMap(int initialCapacity, float loadFactor, boolean accessOrder) {
        super(initialCapacity, loadFactor, accessOrder);
    }

    /**
     * é‡å†™çˆ¶ç±»çš„ removeEldestEntry() æ–¹æ³•ï¼Œç”¨äºæŒ‡ç¤ºæ˜¯å¦åº”è¯¥ç§»é™¤æœ€æ—©åŠ å…¥çš„å…ƒç´ ã€‚
     * å¦‚æœè¿”å› trueï¼Œé‚£ä¹ˆå°†åˆ é™¤æœ€æ—©åŠ å…¥çš„å…ƒç´ ã€‚
     *
     * @param eldest æœ€æ—©åŠ å…¥çš„å…ƒç´ 
     * @return å¦‚æœå½“å‰ MyLinkedHashMap ä¸­å…ƒç´ çš„æ•°é‡å¤§äº MAX_ENTRIESï¼Œè¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚
     */
    @Override
    protected boolean removeEldestEntry(Map.Entry eldest) {
        return size() > MAX_ENTRIES;
    }

}
```

MyLinkedHashMap æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ç±»ï¼Œå®ƒç»§æ‰¿äº† LinkedHashMapï¼Œå¹¶ä¸”é‡å†™äº† `removeEldestEntry()` æ–¹æ³•â€”â€”ä½¿ Map æœ€å¤šå¯å®¹çº³ 5 ä¸ªå…ƒç´ ï¼Œè¶…å‡ºåå°±æ·˜æ±°ã€‚

æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ã€‚

```java
MyLinkedHashMap<String,String>Â mapÂ =Â newÂ MyLinkedHashMap<>(16,0.75f,true);
map.put("æ²‰",Â "æ²‰é»˜ç‹äºŒ");
map.put("é»˜",Â "æ²‰é»˜ç‹äºŒ");
map.put("ç‹",Â "æ²‰é»˜ç‹äºŒ");
map.put("äºŒ",Â "æ²‰é»˜ç‹äºŒ");
map.put("ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜",Â "ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜");

System.out.println(map);

map.put("ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜",Â "ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜");
System.out.println(map);

map.put("ä¸€æšæœ‰æ‰åçš„ç¨‹åºå‘˜","ä¸€æšæœ‰æ‰åçš„ç¨‹åºå‘˜");
System.out.println(map);
```

è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
{æ²‰=æ²‰é»˜ç‹äºŒ,Â é»˜=æ²‰é»˜ç‹äºŒ,Â ç‹=æ²‰é»˜ç‹äºŒ,Â äºŒ=æ²‰é»˜ç‹äºŒ,Â ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜=ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜}
{é»˜=æ²‰é»˜ç‹äºŒ,Â ç‹=æ²‰é»˜ç‹äºŒ,Â äºŒ=æ²‰é»˜ç‹äºŒ,Â ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜=ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜,Â ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜=ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜}
{ç‹=æ²‰é»˜ç‹äºŒ,Â äºŒ=æ²‰é»˜ç‹äºŒ,Â ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜=ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜,Â ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜=ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜,Â ä¸€æšæœ‰æ‰åçš„ç¨‹åºå‘˜=ä¸€æšæœ‰æ‰åçš„ç¨‹åºå‘˜}
```

`æ²‰=æ²‰é»˜ç‹äºŒ` å’Œ `é»˜=æ²‰é»˜ç‹äºŒ` ä¾æ¬¡è¢«æ·˜æ±°å‡ºå±€ã€‚

å‡å¦‚åœ¨ put â€œä¸€æšæœ‰æ‰åçš„ç¨‹åºå‘˜â€ä¹‹å‰ get äº†é”®ä½ä¸ºâ€œé»˜â€çš„å…ƒç´ ï¼š

```java
MyLinkedHashMap<String,String>Â mapÂ =Â newÂ MyLinkedHashMap<>(16,0.75f,true);
map.put("æ²‰",Â "æ²‰é»˜ç‹äºŒ");
map.put("é»˜",Â "æ²‰é»˜ç‹äºŒ");
map.put("ç‹",Â "æ²‰é»˜ç‹äºŒ");
map.put("äºŒ",Â "æ²‰é»˜ç‹äºŒ");
map.put("ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜",Â "ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜");

System.out.println(map);

map.put("ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜",Â "ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜");
System.out.println(map);

map.get("é»˜");
map.put("ä¸€æšæœ‰æ‰åçš„ç¨‹åºå‘˜","ä¸€æšæœ‰æ‰åçš„ç¨‹åºå‘˜");
System.out.println(map);
```

é‚£è¾“å‡ºç»“æœå°±å˜äº†ï¼Œå¯¹å§ï¼Ÿ

```
{æ²‰=æ²‰é»˜ç‹äºŒ,Â é»˜=æ²‰é»˜ç‹äºŒ,Â ç‹=æ²‰é»˜ç‹äºŒ,Â äºŒ=æ²‰é»˜ç‹äºŒ,Â ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜=ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜}
{é»˜=æ²‰é»˜ç‹äºŒ,Â ç‹=æ²‰é»˜ç‹äºŒ,Â äºŒ=æ²‰é»˜ç‹äºŒ,Â ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜=ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜,Â ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜=ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜}
{äºŒ=æ²‰é»˜ç‹äºŒ,Â ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜=ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜,Â ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜=ä¸€æšæœ‰é¢œå€¼çš„ç¨‹åºå‘˜,Â é»˜=æ²‰é»˜ç‹äºŒ,Â ä¸€æšæœ‰æ‰åçš„ç¨‹åºå‘˜=ä¸€æšæœ‰æ‰åçš„ç¨‹åºå‘˜}
```

`æ²‰=æ²‰é»˜ç‹äºŒ` å’Œ `ç‹=æ²‰é»˜ç‹äºŒ` è¢«æ·˜æ±°å‡ºå±€äº†ã€‚

é‚£ LinkedHashMap æ˜¯å¦‚ä½•æ¥ç»´æŒè®¿é—®é¡ºåºå‘¢ï¼ŸåŒå­¦ä»¬æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥ç ”ç©¶ä¸€ä¸‹ä¸‹é¢è¿™ä¸‰ä¸ªæ–¹æ³•ã€‚

```java
voidÂ afterNodeAccess(Node<K,V>Â p)Â {Â }
voidÂ afterNodeInsertion(booleanÂ evict)Â {Â }
voidÂ afterNodeRemoval(Node<K,V>Â p)Â {Â }
```

`afterNodeAccess()` ä¼šåœ¨è°ƒç”¨ `get()` æ–¹æ³•çš„æ—¶å€™è¢«è°ƒç”¨ï¼Œ`afterNodeInsertion()` ä¼šåœ¨è°ƒç”¨ `put()` æ–¹æ³•çš„æ—¶å€™è¢«è°ƒç”¨ï¼Œ`afterNodeRemoval()` ä¼šåœ¨è°ƒç”¨ `remove()` æ–¹æ³•çš„æ—¶å€™è¢«è°ƒç”¨ã€‚

æˆ‘æ¥ä»¥ `afterNodeAccess()` ä¸ºä¾‹æ¥è®²è§£ä¸€ä¸‹ã€‚

```java
/**
 * åœ¨è®¿é—®èŠ‚ç‚¹åï¼Œå°†èŠ‚ç‚¹ç§»åŠ¨åˆ°é“¾è¡¨çš„å°¾éƒ¨
 *
 * @param e è¦ç§»åŠ¨çš„èŠ‚ç‚¹
 */
void afterNodeAccess(HashMap.Node<K,V> e) { // move node to last
    LinkedHashMap.Entry<K,V> last;
    if (accessOrder && (last = tail) != e) { // å¦‚æœæŒ‰è®¿é—®é¡ºåºæ’åºï¼Œå¹¶ä¸”è®¿é—®çš„èŠ‚ç‚¹ä¸æ˜¯å°¾èŠ‚ç‚¹
        LinkedHashMap.Entry<K,V> p = (LinkedHashMap.Entry<K,V>)e, b = p.before, a = p.after;
        p.after = null; // å°†è¦ç§»åŠ¨çš„èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹è®¾ä¸º null
        if (b == null)
            head = a; // å¦‚æœè¦ç§»åŠ¨çš„èŠ‚ç‚¹æ²¡æœ‰å‰é©±èŠ‚ç‚¹ï¼Œåˆ™å°†è¦ç§»åŠ¨çš„èŠ‚ç‚¹è®¾ä¸ºå¤´èŠ‚ç‚¹
        else
            b.after = a; // å°†è¦ç§»åŠ¨çš„èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹è®¾ä¸ºè¦ç§»åŠ¨çš„èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹
        if (a != null)
            a.before = b; // å¦‚æœè¦ç§»åŠ¨çš„èŠ‚ç‚¹æœ‰åç»§èŠ‚ç‚¹ï¼Œåˆ™å°†è¦ç§»åŠ¨çš„èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹è®¾ä¸ºè¦ç§»åŠ¨çš„èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹
        else
            last = b; // å¦‚æœè¦ç§»åŠ¨çš„èŠ‚ç‚¹æ²¡æœ‰åç»§èŠ‚ç‚¹ï¼Œåˆ™å°†è¦ç§»åŠ¨çš„èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹è®¾ä¸ºå°¾èŠ‚ç‚¹
        if (last == null)
            head = p; // å¦‚æœå°¾èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™å°†è¦ç§»åŠ¨çš„èŠ‚ç‚¹è®¾ä¸ºå¤´èŠ‚ç‚¹
        else {
            p.before = last; // å°†è¦ç§»åŠ¨çš„èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹è®¾ä¸ºå°¾èŠ‚ç‚¹
            last.after = p; // å°†å°¾èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹è®¾ä¸ºè¦ç§»åŠ¨çš„èŠ‚ç‚¹
        }
        tail = p; // å°†è¦ç§»åŠ¨çš„èŠ‚ç‚¹è®¾ä¸ºå°¾èŠ‚ç‚¹
        ++modCount; // ä¿®æ”¹è®¡æ•°å™¨
    }
}
```

å“ªä¸ªå…ƒç´ è¢« get å°±æŠŠå“ªä¸ªå…ƒç´ æ”¾åœ¨æœ€åã€‚äº†è§£äº†å§ï¼Ÿ

é‚£åŒå­¦ä»¬å¯èƒ½è¿˜æƒ³çŸ¥é“ï¼Œä¸ºä»€ä¹ˆ LinkedHashMap èƒ½å®ç° LRU ç¼“å­˜ï¼ŒæŠŠæœ€ä¸ç»å¸¸è®¿é—®çš„é‚£ä¸ªå…ƒç´ æ·˜æ±°ï¼Ÿ

åœ¨æ’å…¥å…ƒç´ çš„æ—¶å€™ï¼Œéœ€è¦è°ƒç”¨ `put()` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æœ€åä¼šè°ƒç”¨ `afterNodeInsertion()` æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è¢« LinkedHashMap é‡å†™äº†ã€‚

```java
/**
 * åœ¨æ’å…¥èŠ‚ç‚¹åï¼Œå¦‚æœéœ€è¦ï¼Œå¯èƒ½ä¼šåˆ é™¤æœ€æ—©åŠ å…¥çš„å…ƒç´ 
 *
 * @param evict æ˜¯å¦éœ€è¦åˆ é™¤æœ€æ—©åŠ å…¥çš„å…ƒç´ 
 */
void afterNodeInsertion(boolean evict) { // possibly remove eldest
    LinkedHashMap.Entry<K,V> first;
    if (evict && (first = head) != null && removeEldestEntry(first)) { // å¦‚æœéœ€è¦åˆ é™¤æœ€æ—©åŠ å…¥çš„å…ƒç´ 
        K key = first.key; // è·å–è¦åˆ é™¤å…ƒç´ çš„é”®
        removeNode(hash(key), key, null, false, true); // è°ƒç”¨ removeNode() æ–¹æ³•åˆ é™¤å…ƒç´ 
    }
}
```

`removeEldestEntry()` æ–¹æ³•ä¼šåˆ¤æ–­ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å¦è¶…å‡ºäº†å¯å®¹çº³çš„æœ€å¤§èŒƒå›´ï¼Œå¦‚æœè¶…å‡ºï¼Œé‚£å°±ä¼šè°ƒç”¨ `removeNode()` æ–¹æ³•å¯¹æœ€ä¸ç»å¸¸è®¿é—®çš„é‚£ä¸ªå…ƒç´ è¿›è¡Œåˆ é™¤ã€‚

### 03ã€å°ç»“

ç”±äº LinkedHashMap è¦ç»´æŠ¤åŒå‘é“¾è¡¨ï¼Œæ‰€ä»¥ LinkedHashMap åœ¨æ’å…¥ã€åˆ é™¤æ“ä½œçš„æ—¶å€™ï¼ŒèŠ±è´¹çš„æ—¶é—´è¦æ¯” HashMap å¤šä¸€äº›ã€‚

è¿™ä¹Ÿæ˜¯æ²¡åŠæ³•çš„äº‹ï¼Œå¯¹å§ï¼Œæ¬²æˆ´çš‡å† å¿…æ‰¿å…¶é‡å˜›ã€‚æ—¢ç„¶æƒ³è¦ç»´æŠ¤å…ƒç´ çš„é¡ºåºï¼Œæ€»è¦ä»˜å‡ºç‚¹ä»£ä»·æ‰è¡Œã€‚

ç®€å•æ€»ç»“ä¸€ä¸‹å§ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬çŸ¥é“ HashMap æ˜¯ä¸€ç§å¸¸ç”¨çš„å“ˆå¸Œè¡¨æ•°æ®ç»“æ„ï¼Œå®ƒå¯ä»¥å¿«é€Ÿåœ°è¿›è¡Œé”®å€¼å¯¹çš„æŸ¥æ‰¾å’Œæ’å…¥æ“ä½œã€‚ä½†æ˜¯ï¼ŒHashMap æœ¬èº«å¹¶ä¸ä¿è¯é”®å€¼å¯¹çš„é¡ºåºï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æŒ‰ç…§æ’å…¥é¡ºåºæˆ–è®¿é—®é¡ºåºæ¥éå†é”®å€¼å¯¹ï¼Œå°±éœ€è¦ä½¿ç”¨ LinkedHashMap äº†ã€‚

LinkedHashMap ç»§æ‰¿è‡ª HashMapï¼Œå®ƒåœ¨ HashMap çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†ä¸€ä¸ªåŒå‘é“¾è¡¨æ¥ç»´æŠ¤é”®å€¼å¯¹çš„é¡ºåºã€‚è¿™ä¸ªé“¾è¡¨å¯ä»¥æŒ‰ç…§æ’å…¥é¡ºåºæˆ–è®¿é—®é¡ºåºæ’åºï¼Œå®ƒçš„å¤´èŠ‚ç‚¹è¡¨ç¤ºæœ€æ—©æ’å…¥æˆ–è®¿é—®çš„å…ƒç´ ï¼Œå°¾èŠ‚ç‚¹è¡¨ç¤ºæœ€æ™šæ’å…¥æˆ–è®¿é—®çš„å…ƒç´ ã€‚è¿™ä¸ªé“¾è¡¨çš„ä½œç”¨å°±æ˜¯è®© LinkedHashMap å¯ä»¥ä¿æŒé”®å€¼å¯¹çš„é¡ºåºï¼Œå¹¶ä¸”å¯ä»¥æŒ‰ç…§é¡ºåºéå†é”®å€¼å¯¹ã€‚

LinkedHashMap è¿˜æä¾›äº†ä¸¤ä¸ªæ„é€ æ–¹æ³•æ¥æŒ‡å®šæ’åºæ–¹å¼ï¼Œåˆ†åˆ«æ˜¯æŒ‰ç…§æ’å…¥é¡ºåºæ’åºå’ŒæŒ‰ç…§è®¿é—®é¡ºåºæ’åºã€‚åœ¨æŒ‰ç…§è®¿é—®é¡ºåºæ’åºçš„æƒ…å†µä¸‹ï¼Œæ¯æ¬¡è®¿é—®ä¸€ä¸ªé”®å€¼å¯¹ï¼Œéƒ½ä¼šå°†è¯¥é”®å€¼å¯¹ç§»åˆ°é“¾è¡¨çš„å°¾éƒ¨ï¼Œä»¥ä¿è¯æœ€è¿‘è®¿é—®çš„å…ƒç´ åœ¨æœ€åé¢ã€‚å¦‚æœéœ€è¦åˆ é™¤æœ€æ—©åŠ å…¥çš„å…ƒç´ ï¼Œå¯ä»¥é€šè¿‡é‡å†™ removeEldestEntry() æ–¹æ³•æ¥å®ç°ã€‚

æ€»ä¹‹ï¼ŒLinkedHashMap é€šè¿‡ç»´æŠ¤ä¸€ä¸ªåŒå‘é“¾è¡¨æ¥ä¿æŒé”®å€¼å¯¹çš„é¡ºåºï¼Œå¯ä»¥æŒ‰ç…§æ’å…¥é¡ºåºæˆ–è®¿é—®é¡ºåºæ¥éå†é”®å€¼å¯¹ã€‚å¦‚æœä½ éœ€è¦æŒ‰ç…§é¡ºåºæ¥éå†é”®å€¼å¯¹ï¼Œé‚£ä¹ˆ LinkedHashMap å°±æ˜¯ä½ çš„ä¸äºŒé€‰æ‹©äº†ï¼

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 6.11 TreeMapè¯¦è§£ï¼ˆé™„æºç ï¼‰

>ä¸‹é¢æœ‰è¯·ç‹è€å¸ˆä¸Šå°ï¼Œæ¥ç»™å¤§å®¶è®²ä¸€è®² TreeMapï¼Œé¼“æŒäº†ï¼

ä¹‹å‰ [LinkedHashMap](https://tobebetterjavaer.com/collection/linkedhashmap.html) é‚£ç¯‡æ–‡ç« é‡Œæåˆ°è¿‡äº†ï¼ŒHashMap æ˜¯æ— åºçš„ï¼Œæ‰€ä»¥æœ‰äº† LinkedHashMapï¼ŒåŠ ä¸Šäº†åŒå‘é“¾è¡¨åï¼Œå°±å¯ä»¥ä¿æŒå…ƒç´ çš„æ’å…¥é¡ºåºå’Œè®¿é—®é¡ºåºï¼Œé‚£ TreeMap å‘¢ï¼Ÿ

TreeMap ç”±çº¢é»‘æ ‘å®ç°ï¼Œå¯ä»¥ä¿æŒå…ƒç´ çš„è‡ªç„¶é¡ºåºï¼Œæˆ–è€…å®ç°äº† Comparator æ¥å£çš„è‡ªå®šä¹‰é¡ºåºã€‚

å¯èƒ½æœ‰äº›åŒå­¦ä¸äº†è§£çº¢é»‘æ ‘ï¼Œæˆ‘è¿™é‡Œæ¥æ™®åŠä¸€ä¸‹ï¼š

> çº¢é»‘æ ‘ï¼ˆè‹±è¯­ï¼šRedâ€“black treeï¼‰æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBinary Search Treeï¼‰ï¼Œç»“æ„å¤æ‚ï¼Œä½†å´æœ‰ç€è‰¯å¥½çš„æ€§èƒ½ï¼Œå®ŒæˆæŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤çš„[æ—¶é—´å¤æ‚åº¦](https://tobebetterjavaer.com/collection/time-complexity.html)å‡ä¸º log(n)ã€‚

äºŒå‰æŸ¥æ‰¾æ ‘æ˜¯ä¸€ç§å¸¸è§çš„æ ‘å½¢ç»“æ„ï¼Œå®ƒçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«ä¸€ä¸ªé”®å€¼å¯¹ã€‚æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å­æ ‘èŠ‚ç‚¹çš„é”®å€¼å°äºè¯¥èŠ‚ç‚¹çš„é”®å€¼ï¼Œå³å­æ ‘èŠ‚ç‚¹çš„é”®å€¼å¤§äºè¯¥èŠ‚ç‚¹çš„é”®å€¼ï¼Œè¿™ä¸ªç‰¹æ€§ä½¿å¾—äºŒå‰æŸ¥æ‰¾æ ‘éå¸¸é€‚åˆè¿›è¡Œæ•°æ®çš„æŸ¥æ‰¾å’Œæ’åºæ“ä½œã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ‰‹ç»˜å›¾ï¼Œå±•ç¤ºäº†ä¸€ä¸ªäºŒå‰æŸ¥æ‰¾æ ‘çš„ç»“æ„ï¼š

```
        8
      /   \
     3     10
    / \      \
   1   6     14
      / \    /
     4   7  13
```

åœ¨ä¸Šé¢è¿™ä¸ªäºŒå‰æŸ¥æ‰¾æ ‘ä¸­ï¼Œæ ¹èŠ‚ç‚¹æ˜¯ 8ï¼Œå·¦å­æ ‘èŠ‚ç‚¹åŒ…æ‹¬ 3ã€1ã€6ã€4 å’Œ 7ï¼Œå³å­æ ‘èŠ‚ç‚¹åŒ…æ‹¬ 10ã€14 å’Œ 13ã€‚

- 3<8<10
- 1<3<6
- 4<6<7
- 10<14
- 13<14

è¿™æ˜¯ä¸€é¢—å…¸å‹çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼š

- 1ï¼‰å·¦å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å°äºæˆ–ç­‰äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ã€‚
- 2ï¼‰å³å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å¤§äºæˆ–ç­‰äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ã€‚
- 3ï¼‰å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘ã€‚






äºŒå‰æŸ¥æ‰¾æ ‘ç”¨æ¥æŸ¥æ‰¾éå¸¸æ–¹é¢ï¼Œä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹çš„é”®å€¼ç­‰äºè¦æŸ¥æ‰¾çš„é”®å€¼ï¼Œåˆ™æŸ¥æ‰¾æˆåŠŸï¼›å¦‚æœè¦æŸ¥æ‰¾çš„é”®å€¼å°äºå½“å‰èŠ‚ç‚¹çš„é”®å€¼ï¼Œåˆ™ç»§ç»­éå†å·¦å­æ ‘ï¼›å¦‚æœè¦æŸ¥æ‰¾çš„é”®å€¼å¤§äºå½“å‰èŠ‚ç‚¹çš„é”®å€¼ï¼Œåˆ™ç»§ç»­éå†å³å­æ ‘ã€‚å¦‚æœéå†åˆ°å¶å­èŠ‚ç‚¹ä»ç„¶æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™æŸ¥æ‰¾å¤±è´¥ã€‚

æ’å…¥æ“ä½œä¹Ÿéå¸¸ç®€å•ï¼Œä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œå¦‚æœè¦æ’å…¥çš„é”®å€¼å°äºå½“å‰èŠ‚ç‚¹çš„é”®å€¼ï¼Œåˆ™å°†å…¶æ’å…¥åˆ°å·¦å­æ ‘ä¸­ï¼›å¦‚æœè¦æ’å…¥çš„é”®å€¼å¤§äºå½“å‰èŠ‚ç‚¹çš„é”®å€¼ï¼Œåˆ™å°†å…¶æ’å…¥åˆ°å³å­æ ‘ä¸­ã€‚å¦‚æœè¦æ’å…¥çš„é”®å€¼å·²ç»å­˜åœ¨äºæ ‘ä¸­ï¼Œåˆ™æ›´æ–°è¯¥èŠ‚ç‚¹çš„å€¼ã€‚

åˆ é™¤æ“ä½œç¨å¾®å¤æ‚ä¸€äº›ï¼Œéœ€è¦è€ƒè™‘å¤šç§æƒ…å†µï¼ŒåŒ…æ‹¬è¦åˆ é™¤çš„èŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹ã€è¦åˆ é™¤çš„èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ã€è¦åˆ é™¤çš„èŠ‚ç‚¹æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ç­‰ç­‰ã€‚

æ€»ä¹‹ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘æ˜¯ä¸€ç§éå¸¸å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°æ•°æ®çš„æŸ¥æ‰¾ã€æ’åºå’Œåˆ é™¤ç­‰æ“ä½œã€‚

ç†è§£äºŒå‰æŸ¥æ‰¾æ ‘äº†å§ï¼Ÿ

ä¸è¿‡ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘æœ‰ä¸€ä¸ªæ˜æ˜¾çš„ä¸è¶³ï¼Œå°±æ˜¯å®¹æ˜“å˜æˆç˜¸å­ï¼Œå°±æ˜¯ä¸€ä¾§å¤šï¼Œä¸€ä¾§å°‘ï¼Œæ¯”å¦‚è¯´è¿™æ ·ï¼š

```
        6
      /   \
     4     8
    /     / \
   3     7   9
  /
 1
```

åœ¨ä¸Šé¢è¿™ä¸ªä¸å¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ä¸­ï¼Œå·¦å­æ ‘æ¯”å³å­æ ‘é«˜ã€‚æ ¹èŠ‚ç‚¹æ˜¯ 6ï¼Œå·¦å­æ ‘èŠ‚ç‚¹åŒ…æ‹¬ 4ã€3 å’Œ 1ï¼Œå³å­æ ‘èŠ‚ç‚¹åŒ…æ‹¬ 8ã€7 å’Œ 9ã€‚

ç”±äºå·¦å­æ ‘æ¯”å³å­æ ‘é«˜ï¼Œè¿™ä¸ªä¸å¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘å¯èƒ½ä¼šå¯¼è‡´æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ•ˆç‡ä¸‹é™ã€‚

æ¥ä¸€ä¸ªæ›´æç«¯çš„æƒ…å†µã€‚

```
    1
     \
      2
       \
        3
         \
          4
           \
            5
             \
              6
```

åœ¨ä¸Šé¢è¿™ä¸ªæåº¦ä¸å¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ä¸­ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½åªæœ‰ä¸€ä¸ªå³å­èŠ‚ç‚¹ï¼Œæ ¹èŠ‚ç‚¹æ˜¯ 1ï¼Œå³å­æ ‘èŠ‚ç‚¹åŒ…æ‹¬ 2ã€3ã€4ã€5 å’Œ 6ã€‚

è¿™ç§æåº¦ä¸å¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ä¼šå¯¼è‡´æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ•ˆç‡æ€¥å‰§ä¸‹é™ï¼Œå› ä¸ºæ¯æ¬¡æ“ä½œéƒ½åªèƒ½åœ¨å³å­æ ‘ä¸­è¿›è¡Œï¼Œè€Œå·¦å­æ ‘å‡ ä¹æ²¡æœ‰è¢«åˆ©ç”¨åˆ°ã€‚

æŸ¥æ‰¾çš„æ•ˆç‡å°±è¦ä» log(n) å˜æˆ o(n) äº†ï¼ˆæˆ³[è¿™é‡Œ](https://tobebetterjavaer.com/collection/time-complexity.html)äº†è§£æ—¶é—´å¤æ‚åº¦ï¼‰ï¼Œå¯¹å§ï¼Ÿ

å¿…é¡»è¦å¹³è¡¡ä¸€ä¸‹ï¼Œå¯¹å§ï¼Ÿäºæ˜¯å°±æœ‰äº†å¹³è¡¡äºŒå‰æ ‘ï¼Œå·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡ 1ï¼Œå°±åƒä¸‹å›¾è¿™æ ·ï¼š

```
        8
      /   \
     4     12
    / \    / \
   2   6  10  14
      / \    / \
     5   7  13  15
```

æ ¹èŠ‚ç‚¹æ˜¯ 8ï¼Œå·¦å­æ ‘èŠ‚ç‚¹åŒ…æ‹¬ 4ã€2ã€6ã€5 å’Œ 7ï¼Œå³å­æ ‘èŠ‚ç‚¹åŒ…æ‹¬ 12ã€10ã€14ã€13 å’Œ 15ã€‚å·¦å­æ ‘å’Œå³å­æ ‘çš„é«˜åº¦å·®ä¸è¶…è¿‡1ï¼Œå› æ­¤å®ƒæ˜¯ä¸€ä¸ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ã€‚

å¹³è¡¡äºŒå‰æ ‘å°±åƒæ˜¯ä¸€æ£µæ ‘å½¢ç§¤ï¼Œå®ƒçš„å·¦å³ä¸¤è¾¹çš„é‡é‡è¦å°½å¯èƒ½çš„å¹³è¡¡ã€‚å½“æˆ‘ä»¬å¾€å¹³è¡¡äºŒå‰æ ‘ä¸­æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œå¹³è¡¡äºŒå‰æ ‘ä¼šè‡ªåŠ¨è°ƒæ•´èŠ‚ç‚¹çš„ä½ç½®ï¼Œä»¥ä¿è¯æ ‘çš„å·¦å³ä¸¤è¾¹çš„é«˜åº¦å·®ä¸è¶…è¿‡1ã€‚ç±»ä¼¼åœ°ï¼Œå½“æˆ‘ä»¬åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œå¹³è¡¡äºŒå‰æ ‘ä¹Ÿä¼šè‡ªåŠ¨è°ƒæ•´èŠ‚ç‚¹çš„ä½ç½®ï¼Œä»¥ä¿è¯æ ‘çš„å·¦å³ä¸¤è¾¹çš„é«˜åº¦å·®ä¸è¶…è¿‡1ã€‚

å¸¸è§çš„å¹³è¡¡äºŒå‰æ ‘åŒ…æ‹¬AVLæ ‘ã€çº¢é»‘æ ‘ç­‰ç­‰ï¼Œå®ƒä»¬éƒ½æ˜¯é€šè¿‡æ—‹è½¬æ“ä½œæ¥è°ƒæ•´æ ‘çš„å¹³è¡¡ï¼Œä½¿å¾—å·¦å­æ ‘å’Œå³å­æ ‘çš„é«˜åº¦å°½å¯èƒ½æ¥è¿‘ã€‚

AVLæ ‘çš„ç¤ºæ„å›¾ï¼š

```
           8
         /   \
        4     12
       / \   /  \
      2   6 10  14
         / \
        5   7
```

AVLæ ‘æ˜¯ä¸€ç§é«˜åº¦å¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œå®ƒè¦æ±‚å·¦å­æ ‘å’Œå³å­æ ‘çš„é«˜åº¦å·®ä¸è¶…è¿‡1ã€‚ç”±äºAVLæ ‘çš„å¹³è¡¡åº¦æ¯”è¾ƒé«˜ï¼Œå› æ­¤åœ¨è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œæ—¶éœ€è¦è¿›è¡Œæ›´å¤šçš„æ—‹è½¬æ“ä½œæ¥ä¿æŒå¹³è¡¡ï¼Œä½†æ˜¯åœ¨æŸ¥æ‰¾æ“ä½œæ—¶æ•ˆç‡è¾ƒé«˜ã€‚AVLæ ‘é€‚ç”¨äºè¯»æ“ä½œæ¯”è¾ƒå¤šçš„åœºæ™¯ã€‚

ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªéœ€è¦é¢‘ç¹è¿›è¡ŒæŸ¥æ‰¾æ“ä½œçš„åœºæ™¯ï¼Œå¦‚å­—å…¸æ ‘ã€å“ˆå¸Œè¡¨ç­‰æ•°æ®ç»“æ„ï¼Œå¯ä»¥ä½¿ç”¨AVLæ ‘æ¥è¿›è¡Œä¼˜åŒ–ã€‚å¦å¤–ï¼ŒAVLæ ‘ä¹Ÿé€‚ç”¨äºéœ€è¦ä¿è¯æ•°æ®æœ‰åºæ€§çš„åœºæ™¯ï¼Œå¦‚æ•°æ®åº“ä¸­çš„ç´¢å¼•ã€‚

AVLæ ‘æœ€åˆç”±ä¸¤ä½è‹è”çš„è®¡ç®—æœºç§‘å­¦å®¶ï¼ŒAdelson-Velskiiå’ŒLandisï¼Œäº1962å¹´æå‡ºã€‚å› æ­¤ï¼ŒAVLæ ‘å°±ä»¥ä»–ä»¬ä¸¤äººåå­—çš„é¦–å­—æ¯ç¼©å†™å‘½åäº†ã€‚

AVLæ ‘çš„å‘æ˜å¯¹è®¡ç®—æœºç§‘å­¦çš„å‘å±•æœ‰ç€é‡è¦çš„å½±å“ï¼Œä¸ä»…ä¸ºåæ¥çš„å¹³è¡¡äºŒå‰æ ‘æä¾›äº†åŸºç¡€ï¼Œè€Œä¸”ä¸ºå…¶ä»–é¢†åŸŸçš„æ•°æ®ç»“æ„å’Œç®—æ³•æä¾›äº†å¯ç¤ºã€‚

çº¢é»‘æ ‘çš„ç¤ºæ„å›¾ï¼ˆR å³ Redã€Œçº¢ã€ã€B å³ Blackã€Œé»‘ã€ï¼‰ï¼š

```
           8B
         /   \
        4R    12R
       / \   /  \
      2B 6B 10B 14B
         / \
        5R 7R
```

çº¢é»‘æ ‘ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯èŠ‚ç‚¹æ˜¯çº¢è‰²æˆ–è€…é»‘è‰²çš„å¹³è¡¡äºŒå‰æ ‘ï¼Œå®ƒé€šè¿‡é¢œè‰²çš„çº¦æŸæ¥ç»´æŒäºŒå‰æ ‘çš„å¹³è¡¡ï¼Œå®ƒè¦æ±‚ä»»æ„ä¸€æ¡è·¯å¾„ä¸Šçš„é»‘è‰²èŠ‚ç‚¹æ•°ç›®ç›¸åŒï¼ŒåŒæ—¶è¿˜éœ€è¦æ»¡è¶³ä¸€äº›å…¶ä»–ç‰¹å®šçš„æ¡ä»¶ï¼Œå¦‚çº¢è‰²èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹å¿…é¡»ä¸ºé»‘è‰²èŠ‚ç‚¹ç­‰ã€‚

- 1ï¼‰æ¯ä¸ªèŠ‚ç‚¹éƒ½åªèƒ½æ˜¯çº¢è‰²æˆ–è€…é»‘è‰²
- 2ï¼‰æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²
- 3ï¼‰æ¯ä¸ªå¶èŠ‚ç‚¹ï¼ˆNIL èŠ‚ç‚¹ï¼Œç©ºèŠ‚ç‚¹ï¼‰æ˜¯é»‘è‰²çš„ã€‚
- 4ï¼‰å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œåˆ™å®ƒä¸¤ä¸ªå­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨ä¸€æ¡è·¯å¾„ä¸Šä¸èƒ½å‡ºç°ç›¸é‚»çš„ä¸¤ä¸ªçº¢è‰²èŠ‚ç‚¹ã€‚
- 5ï¼‰ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ã€‚

ç”±äºçº¢é»‘æ ‘çš„å¹³è¡¡åº¦æ¯”AVLæ ‘ç¨ä½ï¼Œå› æ­¤åœ¨è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œæ—¶éœ€è¦è¿›è¡Œçš„æ—‹è½¬æ“ä½œè¾ƒå°‘ï¼Œä½†æ˜¯åœ¨æŸ¥æ‰¾æ“ä½œæ—¶æ•ˆç‡ä»ç„¶è¾ƒé«˜ã€‚çº¢é»‘æ ‘é€‚ç”¨äºè¯»å†™æ“ä½œæ¯”è¾ƒå‡è¡¡çš„åœºæ™¯ã€‚

é‚£ï¼Œå…³äºçº¢é»‘æ ‘ï¼ŒåŒå­¦ä»¬å°±å…ˆäº†è§£åˆ°è¿™ï¼Œè„‘å­é‡Œæœ‰ä¸ªå¤§æ¦‚çš„å°è±¡ï¼ŒçŸ¥é“ TreeMap æ˜¯ä¸ªä»€ä¹ˆç©æ„ã€‚

### 01ã€è‡ªç„¶é¡ºåº

é»˜è®¤æƒ…å†µä¸‹ï¼ŒTreeMap æ˜¯æ ¹æ® key çš„è‡ªç„¶é¡ºåºæ’åˆ—çš„ã€‚æ¯”å¦‚è¯´æ•´æ•°ï¼Œå°±æ˜¯å‡åºï¼Œ1ã€2ã€3ã€4ã€5ã€‚

```java
TreeMap<Integer,String>Â mapIntÂ =Â newÂ TreeMap<>();
mapInt.put(3,Â "æ²‰é»˜ç‹äºŒ");
mapInt.put(2,Â "æ²‰é»˜ç‹äºŒ");
mapInt.put(1,Â "æ²‰é»˜ç‹äºŒ");
mapInt.put(5,Â "æ²‰é»˜ç‹äºŒ");
mapInt.put(4,Â "æ²‰é»˜ç‹äºŒ");

System.out.println(mapInt);
```

è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
{1=æ²‰é»˜ç‹äºŒ,Â 2=æ²‰é»˜ç‹äºŒ,Â 3=æ²‰é»˜ç‹äºŒ,Â 4=æ²‰é»˜ç‹äºŒ,Â 5=æ²‰é»˜ç‹äºŒ}
```

TreeMap æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿæƒ³ä¸€æ¢ç©¶ç«Ÿï¼Œå°±å¾—ä¸Šæºç äº†ï¼Œæ¥çœ‹ TreeMap çš„ `put()` æ–¹æ³•ï¼š

```java
public V put(K key, V value) {
    Entry<K,V> t = root; // å°†æ ¹èŠ‚ç‚¹èµ‹å€¼ç»™å˜é‡t
    if (t == null) { // å¦‚æœæ ¹èŠ‚ç‚¹ä¸ºnullï¼Œè¯´æ˜TreeMapä¸ºç©º
        compare(key, key); // type (and possibly null) checkï¼Œæ£€æŸ¥keyçš„ç±»å‹æ˜¯å¦åˆæ³•
        root = new Entry<>(key, value, null); // åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹ä½œä¸ºæ ¹èŠ‚ç‚¹
        size = 1; // sizeè®¾ç½®ä¸º1
        return null; // è¿”å›nullï¼Œè¡¨ç¤ºæ’å…¥æˆåŠŸ
    }
    int cmp;
    Entry<K,V> parent;
    // split comparator and comparable pathsï¼Œæ ¹æ®ä½¿ç”¨çš„æ¯”è¾ƒæ–¹æ³•è¿›è¡ŒæŸ¥æ‰¾
    Comparator<? super K> cpr = comparator; // è·å–æ¯”è¾ƒå™¨
    if (cpr != null) { // å¦‚æœä½¿ç”¨äº†Comparator
        do {
            parent = t; // å°†å½“å‰èŠ‚ç‚¹èµ‹å€¼ç»™parent
            cmp = cpr.compare(key, t.key); // ä½¿ç”¨Comparatoræ¯”è¾ƒkeyå’Œtçš„é”®çš„å¤§å°
            if (cmp < 0) // å¦‚æœkeyå°äºtçš„é”®
                t = t.left; // åœ¨tçš„å·¦å­æ ‘ä¸­æŸ¥æ‰¾
            else if (cmp > 0) // å¦‚æœkeyå¤§äºtçš„é”®
                t = t.right; // åœ¨tçš„å³å­æ ‘ä¸­æŸ¥æ‰¾
            else // å¦‚æœkeyç­‰äºtçš„é”®
                return t.setValue(value); // ç›´æ¥æ›´æ–°tçš„å€¼
        } while (t != null);
    }
    else { // å¦‚æœæ²¡æœ‰ä½¿ç”¨Comparator
        if (key == null) // å¦‚æœkeyä¸ºnull
            throw new NullPointerException(); // æŠ›å‡ºNullPointerExceptionå¼‚å¸¸
            Comparable<? super K> k = (Comparable<? super K>) key; // å°†keyå¼ºåˆ¶è½¬æ¢ä¸ºComparableç±»å‹
        do {
            parent = t; // å°†å½“å‰èŠ‚ç‚¹èµ‹å€¼ç»™parent
            cmp = k.compareTo(t.key); // ä½¿ç”¨Comparableæ¯”è¾ƒkeyå’Œtçš„é”®çš„å¤§å°
            if (cmp < 0) // å¦‚æœkeyå°äºtçš„é”®
                t = t.left; // åœ¨tçš„å·¦å­æ ‘ä¸­æŸ¥æ‰¾
            else if (cmp > 0) // å¦‚æœkeyå¤§äºtçš„é”®
                t = t.right; // åœ¨tçš„å³å­æ ‘ä¸­æŸ¥æ‰¾
            else // å¦‚æœkeyç­‰äºtçš„é”®
                return t.setValue(value); // ç›´æ¥æ›´æ–°tçš„å€¼
        } while (t != null);
    }
    // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç›¸åŒçš„é”®ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹æ’å…¥åˆ°TreeMapä¸­
    Entry<K,V> e = new Entry<>(key, value, parent); // åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹
    if (cmp < 0) // å¦‚æœkeyå°äºparentçš„é”®
        parent.left = e; // å°†eä½œä¸ºparentçš„å·¦å­èŠ‚ç‚¹
    else
        parent.right = e; // å°†eä½œä¸ºparentçš„å³å­èŠ‚ç‚¹
    fixAfterInsertion(e); // æ’å…¥èŠ‚ç‚¹åéœ€è¦è¿›è¡Œå¹³è¡¡æ“ä½œ
    size++; // sizeåŠ 1
    return null; // è¿”å›nullï¼Œè¡¨ç¤ºæ’å…¥æˆåŠŸ
}
```

- é¦–å…ˆå®šä¹‰ä¸€ä¸ªEntryç±»å‹çš„å˜é‡tï¼Œç”¨äºè¡¨ç¤ºå½“å‰çš„æ ¹èŠ‚ç‚¹ï¼›
- å¦‚æœtä¸ºnullï¼Œè¯´æ˜TreeMapä¸ºç©ºï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ä½œä¸ºæ ¹èŠ‚ç‚¹ï¼Œå¹¶å°†sizeè®¾ç½®ä¸º1ï¼›
- å¦‚æœtä¸ä¸ºnullï¼Œè¯´æ˜éœ€è¦åœ¨TreeMapä¸­æŸ¥æ‰¾é”®æ‰€å¯¹åº”çš„èŠ‚ç‚¹ã€‚å› ä¸ºTreeMapä¸­çš„å…ƒç´ æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾çš„æ–¹å¼æ¥æŸ¥æ‰¾èŠ‚ç‚¹ï¼›
- å¦‚æœTreeMapä¸­ä½¿ç”¨äº†Comparatoræ¥è¿›è¡Œæ’åºï¼Œåˆ™ä½¿ç”¨Comparatorè¿›è¡Œæ¯”è¾ƒï¼Œå¦åˆ™ä½¿ç”¨Comparableè¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœæŸ¥æ‰¾åˆ°äº†ç›¸åŒçš„é”®ï¼Œåˆ™ç›´æ¥æ›´æ–°é”®æ‰€å¯¹åº”çš„å€¼ï¼›
- å¦‚æœæ²¡æœ‰æŸ¥æ‰¾åˆ°ç›¸åŒçš„é”®ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶æ’å…¥åˆ°TreeMapä¸­ã€‚ç„¶åä½¿ç”¨fixAfterInsertion()æ–¹æ³•æ¥ä¿®æ­£æ’å…¥èŠ‚ç‚¹åçš„å¹³è¡¡çŠ¶æ€ï¼›
- æœ€åå°†TreeMapçš„sizeåŠ 1ï¼Œç„¶åè¿”å›nullã€‚å¦‚æœæ›´æ–°äº†é”®æ‰€å¯¹åº”çš„å€¼ï¼Œåˆ™è¿”å›åŸå…ˆçš„å€¼ã€‚

æ³¨æ„ `cmp = k.compareTo(t.key)` è¿™è¡Œä»£ç ï¼Œå°±æ˜¯ç”¨æ¥è¿›è¡Œ key æ¯”è¾ƒçš„ï¼Œç”±äºæ­¤æ—¶ key æ˜¯ Stringï¼Œæ‰€ä»¥å°±ä¼šè°ƒç”¨ String ç±»çš„ `compareTo()` æ–¹æ³•è¿›è¡Œæ¯”è¾ƒã€‚

```java
public int compareTo(String anotherString) {
    // è·å–å½“å‰å­—ç¬¦ä¸²å’Œå¦ä¸€ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦
    int len1 = value.length;
    int len2 = anotherString.value.length;
    // å–ä¸¤ä¸ªå­—ç¬¦ä¸²é•¿åº¦çš„è¾ƒçŸ­è€…ä½œä¸ºæ¯”è¾ƒçš„ä¸Šé™
    int lim = Math.min(len1, len2);
    // è·å–å½“å‰å­—ç¬¦ä¸²å’Œå¦ä¸€ä¸ªå­—ç¬¦ä¸²çš„å­—ç¬¦æ•°ç»„
    char v1[] = value;
    char v2[] = anotherString.value;

    int k = 0;
    // å¯¹ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æ¯ä¸ªå­—ç¬¦è¿›è¡Œæ¯”è¾ƒ
    while (k < lim) {
        char c1 = v1[k];
        char c2 = v2[k];
        // å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸ç›¸ç­‰ï¼Œè¿”å›å®ƒä»¬çš„å·®å€¼
        if (c1 != c2) {
            return c1 - c2;
        }
        k++;
    }
    // å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²å‰é¢çš„å­—ç¬¦éƒ½ç›¸ç­‰ï¼Œè¿”å›å®ƒä»¬é•¿åº¦çš„å·®å€¼
    return len1 - len2;
}
```

æ¥çœ‹ä¸‹é¢çš„ç¤ºä¾‹ã€‚

```java
TreeMap<String,String>Â mapStringÂ =Â newÂ TreeMap<>();
mapString.put("c",Â "æ²‰é»˜ç‹äºŒ");
mapString.put("b",Â "æ²‰é»˜ç‹äºŒ");
mapString.put("a",Â "æ²‰é»˜ç‹äºŒ");
mapString.put("e",Â "æ²‰é»˜ç‹äºŒ");
mapString.put("d",Â "æ²‰é»˜ç‹äºŒ");

System.out.println(mapString);
```

è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
{a=æ²‰é»˜ç‹äºŒ,Â b=æ²‰é»˜ç‹äºŒ,Â c=æ²‰é»˜ç‹äºŒ,Â d=æ²‰é»˜ç‹äºŒ,Â e=æ²‰é»˜ç‹äºŒ}
```

ä»ç»“æœå¯ä»¥çœ‹å¾—å‡ºï¼Œæ˜¯æŒ‰ç…§å­—æ¯çš„å‡åºè¿›è¡Œæ’åºçš„ã€‚

### 02ã€è‡ªå®šä¹‰æ’åº

å¦‚æœè‡ªç„¶é¡ºåºä¸æ»¡è¶³ï¼Œé‚£å°±å¯ä»¥åœ¨å£°æ˜ TreeMap å¯¹è±¡çš„æ—¶å€™æŒ‡å®šæ’åºè§„åˆ™ã€‚

```java
TreeMap<Integer,String>Â mapIntReverseÂ =Â newÂ TreeMap<>(Comparator.reverseOrder());
mapIntReverse.put(3,Â "æ²‰é»˜ç‹äºŒ");
mapIntReverse.put(2,Â "æ²‰é»˜ç‹äºŒ");
mapIntReverse.put(1,Â "æ²‰é»˜ç‹äºŒ");
mapIntReverse.put(5,Â "æ²‰é»˜ç‹äºŒ");
mapIntReverse.put(4,Â "æ²‰é»˜ç‹äºŒ");

System.out.println(mapIntReverse);
```

TreeMap æä¾›äº†å¯ä»¥æŒ‡å®šæ’åºè§„åˆ™çš„æ„é€ æ–¹æ³•ï¼š

```java
publicÂ TreeMap(Comparator<?Â superÂ K>Â comparator)Â {
Â Â Â Â this.comparatorÂ =Â comparator;
}
```

`Comparator.reverseOrder()` è¿”å›çš„æ˜¯ Collections.ReverseComparator å¯¹è±¡ï¼Œå°±æ˜¯ç”¨æ¥åè½¬é¡ºåºçš„ï¼Œéå¸¸æ–¹ä¾¿ã€‚

```java
private static class ReverseComparator
        implements Comparator<Comparable<Object>>, Serializable {
    // å•ä¾‹æ¨¡å¼ï¼Œç”¨äºè¡¨ç¤ºé€†åºæ¯”è¾ƒå™¨
    static final ReverseComparator REVERSE_ORDER
            = new ReverseComparator();

    // å®ç°æ¯”è¾ƒæ–¹æ³•ï¼Œå¯¹ä¸¤ä¸ªå®ç°äº†Comparableæ¥å£çš„å¯¹è±¡è¿›è¡Œé€†åºæ¯”è¾ƒ
    public int compare(Comparable<Object> c1, Comparable<Object> c2) {
        return c2.compareTo(c1); // è°ƒç”¨c2çš„compareTo()æ–¹æ³•ï¼Œä»¥c1ä¸ºå‚æ•°ï¼Œå®ç°é€†åºæ¯”è¾ƒ
    }

    // ååºåˆ—åŒ–æ—¶ï¼Œè¿”å›Collections.reverseOrder()ï¼Œä¿è¯å•ä¾‹æ¨¡å¼
    private Object readResolve() {
        return Collections.reverseOrder();
    }

    // è¿”å›æ­£åºæ¯”è¾ƒå™¨
    @Override
    public Comparator<Comparable<Object>> reversed() {
        return Comparator.naturalOrder();
    }
}
```

æ‰€ä»¥ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
{5=æ²‰é»˜ç‹äºŒ,Â 4=æ²‰é»˜ç‹äºŒ,Â 3=æ²‰é»˜ç‹äºŒ,Â 2=æ²‰é»˜ç‹äºŒ,Â 1=æ²‰é»˜ç‹äºŒ}
```

HashMap æ˜¯æ— åºçš„ï¼Œæ’å…¥çš„é¡ºåºéšç€å…ƒç´ çš„å¢åŠ ä¼šä¸åœåœ°å˜åŠ¨ã€‚ä½† TreeMap èƒ½å¤Ÿè‡³å§‹è‡³ç»ˆæŒ‰ç…§æŒ‡å®šçš„é¡ºåºæ’åˆ—ï¼Œè¿™å¯¹äºéœ€è¦è‡ªå®šä¹‰æ’åºçš„åœºæ™¯ï¼Œå®åœ¨æ˜¯å¤ªæœ‰ç”¨äº†ï¼

### 03ã€æ’åºçš„å¥½å¤„

æ—¢ç„¶ TreeMap çš„å…ƒç´ æ˜¯ç»è¿‡æ’åºçš„ï¼Œé‚£æ‰¾å‡ºæœ€å¤§çš„é‚£ä¸ªï¼Œæœ€å°çš„é‚£ä¸ªï¼Œæˆ–è€…æ‰¾å‡ºæ‰€æœ‰å¤§äºæˆ–è€…å°äºæŸä¸ªå€¼çš„é”®æ¥è¯´ï¼Œå°±æ–¹ä¾¿å¤šäº†ã€‚

```java
IntegerÂ highestKeyÂ =Â mapInt.lastKey();
IntegerÂ lowestKeyÂ =Â mapInt.firstKey();
Set<Integer>Â keysLessThan3Â =Â mapInt.headMap(3).keySet();
Set<Integer>Â keysGreaterThanEqTo3Â =Â mapInt.tailMap(3).keySet();

System.out.println(highestKey);
System.out.println(lowestKey);

System.out.println(keysLessThan3);
System.out.println(keysGreaterThanEqTo3);
```

TreeMap è€ƒè™‘å¾—å¾ˆå‘¨å…¨ï¼Œæ°å¥½å°±æä¾›äº† `lastKey()`ã€`firstKey()` è¿™æ ·è·å–æœ€åä¸€ä¸ª key å’Œç¬¬ä¸€ä¸ª key çš„æ–¹æ³•ã€‚

`headMap()` è·å–çš„æ˜¯åˆ°æŒ‡å®š key ä¹‹å‰çš„ keyï¼›`tailMap()` è·å–çš„æ˜¯æŒ‡å®š key ä¹‹åçš„ keyï¼ˆåŒ…æ‹¬æŒ‡å®š keyï¼‰ã€‚

æ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœï¼š

```
5
1
[1,Â 2]
[3,Â 4,Â 5]
```

å†æ¥çœ‹ä¸€ä¸‹ä¾‹å­ï¼š

```java
TreeMap<Integer, String> treeMap = new TreeMap<>();
treeMap.put(1, "value1");
treeMap.put(2, "value2");
treeMap.put(3, "value3");
treeMap.put(4, "value4");
treeMap.put(5, "value5");

// headMapç¤ºä¾‹ï¼Œè·å–å°äº3çš„é”®å€¼å¯¹
Map<Integer, String> headMap = treeMap.headMap(3);
System.out.println(headMap); // è¾“å‡º {1=value1, 2=value2}

// tailMapç¤ºä¾‹ï¼Œè·å–å¤§äºç­‰äº4çš„é”®å€¼å¯¹
Map<Integer, String> tailMap = treeMap.tailMap(4);
System.out.println(tailMap); // è¾“å‡º {4=value4, 5=value5}

// subMapç¤ºä¾‹ï¼Œè·å–å¤§äºç­‰äº2ä¸”å°äº4çš„é”®å€¼å¯¹
Map<Integer, String> subMap = treeMap.subMap(2, 4);
System.out.println(subMap); // è¾“å‡º {2=value2, 3=value3}
```

headMapã€tailMapã€subMapæ–¹æ³•åˆ†åˆ«è·å–äº†å°äº3ã€å¤§äºç­‰äº4ã€å¤§äºç­‰äº2ä¸”å°äº4çš„é”®å€¼å¯¹ã€‚


### 04ã€å¦‚ä½•é€‰æ‹© Map

åœ¨å­¦ä¹  TreeMap ä¹‹å‰ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ äº† [HashMap](https://tobebetterjavaer.com/collection/hashmap.html) å’Œ [LinkedHashMap](https://tobebetterjavaer.com/collection/linkedhashmap.html) ï¼Œé‚£å¦‚ä½•ä»å®ƒä»¬ä¸‰ä¸ªä¸­é—´é€‰æ‹©å‘¢ï¼Ÿ

éœ€è¦è€ƒè™‘ä»¥ä¸‹å› ç´ ï¼š

- æ˜¯å¦éœ€è¦æŒ‰ç…§é”®çš„è‡ªç„¶é¡ºåºæˆ–è€…è‡ªå®šä¹‰é¡ºåºè¿›è¡Œæ’åºã€‚å¦‚æœéœ€è¦æŒ‰ç…§é”®æ’åºï¼Œåˆ™å¯ä»¥ä½¿ç”¨ TreeMapï¼›å¦‚æœä¸éœ€è¦æ’åºï¼Œåˆ™å¯ä»¥ä½¿ç”¨ HashMap æˆ– LinkedHashMapã€‚
- æ˜¯å¦éœ€è¦ä¿æŒæ’å…¥é¡ºåºã€‚å¦‚æœéœ€è¦ä¿æŒæ’å…¥é¡ºåºï¼Œåˆ™å¯ä»¥ä½¿ç”¨ LinkedHashMapï¼›å¦‚æœä¸éœ€è¦ä¿æŒæ’å…¥é¡ºåºï¼Œåˆ™å¯ä»¥ä½¿ç”¨ TreeMap æˆ– HashMapã€‚
- æ˜¯å¦éœ€è¦é«˜æ•ˆçš„æŸ¥æ‰¾ã€‚å¦‚æœéœ€è¦é«˜æ•ˆçš„æŸ¥æ‰¾ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ LinkedHashMap æˆ– HashMapï¼Œå› ä¸ºå®ƒä»¬çš„æŸ¥æ‰¾æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œè€Œæ˜¯ TreeMap æ˜¯ O(log n)ã€‚

>LinkedHashMap å†…éƒ¨ä½¿ç”¨å“ˆå¸Œè¡¨æ¥å­˜å‚¨é”®å€¼å¯¹ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªåŒå‘é“¾è¡¨æ¥ç»´æŠ¤æ’å…¥é¡ºåºï¼Œä½†æŸ¥æ‰¾æ“ä½œåªéœ€è¦åœ¨å“ˆå¸Œè¡¨ä¸­è¿›è¡Œï¼Œä¸é“¾è¡¨æ— å…³ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦ä¸º O(1)

æ¥ä¸ªè¡¨æ ¼å§ï¼Œä¸€ç›®äº†ç„¶ã€‚

ç‰¹æ€§|	TreeMap|	HashMap|	LinkedHashMap
---|---|---|---|
æ’åº|	æ”¯æŒ|	ä¸æ”¯æŒ|	ä¸æ”¯æŒ
æ’å…¥é¡ºåº|	ä¸ä¿è¯|	ä¸ä¿è¯|	ä¿è¯
æŸ¥æ‰¾æ•ˆç‡|	O(log n)|	O(1)|	O(1)
ç©ºé—´å ç”¨|	é€šå¸¸è¾ƒå¤§|	é€šå¸¸è¾ƒå°|	é€šå¸¸è¾ƒå¤§
é€‚ç”¨åœºæ™¯|	éœ€è¦æ’åºçš„åœºæ™¯|	æ— éœ€æ’åºçš„åœºæ™¯|	éœ€è¦ä¿æŒæ’å…¥é¡ºåº

å¥½äº†ï¼Œä¸‹è¯¾ï¼Œå…³äº TreeMap æˆ‘ä»¬å°±è®²åˆ°è¿™é‡Œå§ï¼Œå¸Œæœ›åŒå­¦ä»¬éƒ½èƒ½å¯¹ TreeMap æœ‰ä¸€ä¸ªæ¸…æ™°çš„è®¤è¯†ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾è§~

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 6.12 åŒç«¯é˜Ÿåˆ—ArrayDequeè¯¦è§£

>å¥½ï¼Œæˆ‘ä»¬è¿™èŠ‚ç»§ç»­æœ‰è¯·ç‹è€å¸ˆä¸Šå°æ¥ç»™å¤§å®¶è®² ArrayDequeï¼Œé¼“æŒæ¬¢è¿äº†ğŸ‘ğŸ»ã€‚

Java é‡Œæœ‰ä¸€ä¸ªå«åš*Stack*çš„ç±»ï¼Œå´æ²¡æœ‰å«åš*Queue*çš„ç±»ï¼ˆå®ƒåªæ˜¯ä¸ªæ¥å£åå­—ï¼Œå’Œç±»è¿˜ä¸ä¸€æ ·ï¼‰ã€‚

```java
public interface Queue<E> extends Collection<E> {}
```

å½“éœ€è¦ä½¿ç”¨æ ˆæ—¶ï¼ŒJava å·²ä¸æ¨èä½¿ç”¨*Stack*ï¼Œè€Œæ˜¯æ¨èä½¿ç”¨æ›´é«˜æ•ˆçš„*ArrayDeque*ï¼ˆåŒç«¯é˜Ÿåˆ—ï¼‰ï¼ŒåŸå› æˆ‘ä»¬ç¬¬ä¸€æ¬¡è®²[é›†åˆæ¡†æ¶](https://tobebetterjavaer.com/collection/gailan.html)çš„æ—¶å€™ï¼Œå…¶å®å·²ç»èŠè¿‡äº†ï¼ŒStack æ˜¯ä¸€ä¸ªâ€œåŸå§‹â€ç±»ï¼Œå®ƒçš„æ ¸å¿ƒæ–¹æ³•ä¸Šéƒ½åŠ äº† `synchronized` å…³é”®å­—ä»¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œå½“æˆ‘ä»¬ä¸éœ€è¦çº¿ç¨‹å®‰å…¨ï¼ˆæ¯”å¦‚è¯´å•çº¿ç¨‹ç¯å¢ƒä¸‹ï¼‰æ€§èƒ½å°±ä¼šæ¯”è¾ƒå·®ã€‚

![](http://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection//arraydeque-51e3552c-af39-4d00-8494-1ff0a4913357.png)

ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“éœ€è¦ä½¿ç”¨æ ˆæ—¶å€™ï¼Œè¯·é¦–é€‰*ArrayDeque*ã€‚

```java
// å£°æ˜ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—
ArrayDeque<String> stack = new ArrayDeque<>();

// å¢åŠ å…ƒç´ 
stack.push("æ²‰é»˜");
stack.push("ç‹äºŒ");
stack.push("é™ˆæ¸…æ‰¬");

// è·å–æ ˆé¡¶å…ƒç´ 
String top = stack.peek();
System.out.println("æ ˆé¡¶å…ƒç´ ä¸ºï¼š" + top); // é™ˆæ¸…æ‰¬

// å¼¹å‡ºæ ˆé¡¶å…ƒç´ 
String pop = stack.pop();
System.out.println("å¼¹å‡ºçš„å…ƒç´ ä¸ºï¼š" + pop); // é™ˆæ¸…æ‰¬

// ä¿®æ”¹æ ˆé¡¶å…ƒç´ 
stack.pop();
stack.push("å°æ˜");
System.out.println("ä¿®æ”¹åçš„æ ˆä¸ºï¼š" + stack); // [æ²‰é»˜, å°æ˜]

// éå†é˜Ÿåˆ—æŸ¥æ‰¾å…ƒç´ 
Iterator<String> iterator = stack.iterator();
int index = -1;
String target = "ç‹äºŒ";
while (iterator.hasNext()) {
    String element = iterator.next();
    index++;
    if (element.equals(target)) {
        break;
    }
}

if (index == -1) {
    System.out.println("å…ƒç´  " + target + " ä¸å­˜åœ¨äºé˜Ÿåˆ—ä¸­");
} else {
    System.out.println("å…ƒç´  " + target + " åœ¨é˜Ÿåˆ—ä¸­çš„ä½ç½®ä¸ºï¼š" + index);
}
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºäº†ä¸€ä¸ª ArrayDeque å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ push æ–¹æ³•å‘æ ˆä¸­æ·»åŠ äº†ä¸‰ä¸ªå…ƒç´ ã€‚æ¥ç€ä½¿ç”¨ peek æ–¹æ³•è·å–æ ˆé¡¶å…ƒç´ ï¼Œä½¿ç”¨ pop æ–¹æ³•å¼¹å‡ºæ ˆé¡¶å…ƒç´ ï¼Œä½¿ç”¨ pop å’Œ push æ–¹æ³•ä¿®æ”¹æ ˆé¡¶å…ƒç´ ï¼Œä½¿ç”¨è¿­ä»£å™¨æŸ¥æ‰¾å…ƒç´ åœ¨æ ˆä¸­çš„ä½ç½®ã€‚

ArrayDeque åˆå®ç°äº† Deque æ¥å£ï¼ˆDeque åˆå®ç°äº† Queue æ¥å£ï¼‰ï¼š

```java
public class ArrayDeque<E> extends AbstractCollection<E>
                           implements Deque<E>, Cloneable, Serializable
{}
```

å› æ­¤ï¼Œå½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨é˜Ÿåˆ—çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥é€‰æ‹© ArrayDequeã€‚

```java
ArrayDeque<String> queue = new ArrayDeque<>();

// å¢åŠ å…ƒç´ 
queue.offer("æ²‰é»˜");
queue.offer("ç‹äºŒ");
queue.offer("é™ˆæ¸…æ‰¬");

// è·å–é˜Ÿé¦–å…ƒç´ 
String front = queue.peek();
System.out.println("é˜Ÿé¦–å…ƒç´ ä¸ºï¼š" + front); // æ²‰é»˜

// å¼¹å‡ºé˜Ÿé¦–å…ƒç´ 
String poll = queue.poll();
System.out.println("å¼¹å‡ºçš„å…ƒç´ ä¸ºï¼š" + poll); // æ²‰é»˜

// ä¿®æ”¹é˜Ÿåˆ—ä¸­çš„å…ƒç´ 
queue.poll();
queue.offer("å°æ˜");
System.out.println("ä¿®æ”¹åçš„é˜Ÿåˆ—ä¸ºï¼š" + queue); // [é™ˆæ¸…æ‰¬, å°æ˜]

// æŸ¥æ‰¾å…ƒç´ 
Iterator<String> iterator = queue.iterator();
int index = 0;
while (iterator.hasNext()) {
    String element = iterator.next();
    if (element.equals("ç‹äºŒ")) {
        System.out.println("å…ƒç´ åœ¨é˜Ÿåˆ—ä¸­çš„ä½ç½®ä¸ºï¼š" + index); // 0
        break;
    }
    index++;
}
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºäº†ä¸€ä¸ª ArrayDeque å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ offer æ–¹æ³•å‘é˜Ÿåˆ—ä¸­æ·»åŠ äº†ä¸‰ä¸ªå…ƒç´ ã€‚æ¥ç€ä½¿ç”¨ peek æ–¹æ³•è·å–é˜Ÿé¦–å…ƒç´ ï¼Œä½¿ç”¨ poll æ–¹æ³•å¼¹å‡ºé˜Ÿé¦–å…ƒç´ ï¼Œä½¿ç”¨ poll å’Œ offer æ–¹æ³•ä¿®æ”¹é˜Ÿåˆ—ä¸­çš„å…ƒç´ ï¼Œä½¿ç”¨è¿­ä»£å™¨æŸ¥æ‰¾å…ƒç´ åœ¨é˜Ÿåˆ—ä¸­çš„ä½ç½®ã€‚

[æˆ‘ä»¬å‰é¢è®²äº†](https://tobebetterjavaer.com/collection/gailan.html)ï¼ŒLinkedListä¸åªæ˜¯ä¸ª Listï¼Œè¿˜æ˜¯ä¸€ä¸ª Queueï¼Œå®ƒä¹Ÿå®ç°äº† Deque æ¥å£ã€‚

```java
public class LinkedList<E>
    extends AbstractSequentialList<E>
    implements List<E>, Deque<E>, Cloneable, java.io.Serializable
{}
```

æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨é˜Ÿåˆ—æ—¶ï¼Œè¿˜å¯ä»¥é€‰æ‹©[LinkedList](https://tobebetterjavaer.com/collection/linkedlist.html)ã€‚

```java
// åˆ›å»ºä¸€ä¸ª LinkedList å¯¹è±¡
LinkedList<String> queue = new LinkedList<>();

// æ·»åŠ å…ƒç´ 
queue.offer("æ²‰é»˜");
queue.offer("ç‹äºŒ");
queue.offer("é™ˆæ¸…æ‰¬");
System.out.println(queue); // è¾“å‡º [æ²‰é»˜, ç‹äºŒ, é™ˆæ¸…æ‰¬]

// åˆ é™¤å…ƒç´ 
queue.poll();
System.out.println(queue); // è¾“å‡º [ç‹äºŒ, é™ˆæ¸…æ‰¬]

// ä¿®æ”¹å…ƒç´ ï¼šLinkedList ä¸­çš„å…ƒç´ ä¸æ”¯æŒç›´æ¥ä¿®æ”¹ï¼Œéœ€è¦å…ˆåˆ é™¤å†æ·»åŠ 
String first = queue.poll();
queue.offer("ç‹å¤§äºŒ");
System.out.println(queue); // è¾“å‡º [é™ˆæ¸…æ‰¬, ç‹å¤§äºŒ]

// æŸ¥æ‰¾å…ƒç´ ï¼šLinkedList ä¸­çš„å…ƒç´ å¯ä»¥ä½¿ç”¨ get() æ–¹æ³•è¿›è¡ŒæŸ¥æ‰¾
System.out.println(queue.get(0)); // è¾“å‡º é™ˆæ¸…æ‰¬
System.out.println(queue.contains("æ²‰é»˜")); // è¾“å‡º false

// æŸ¥æ‰¾å…ƒç´ ï¼šä½¿ç”¨è¿­ä»£å™¨çš„æ–¹å¼æŸ¥æ‰¾é™ˆæ¸…æ‰¬
// ä½¿ç”¨è¿­ä»£å™¨ä¾æ¬¡éå†å…ƒç´ å¹¶æŸ¥æ‰¾
Iterator<String> iterator = queue.iterator();
while (iterator.hasNext()) {
    String element = iterator.next();
    if (element.equals("é™ˆæ¸…æ‰¬")) {
        System.out.println("æ‰¾åˆ°äº†ï¼š" + element);
        break;
    }
}
```

åœ¨ä½¿ç”¨ LinkedList ä½œä¸ºé˜Ÿåˆ—æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ offer() æ–¹æ³•å°†å…ƒç´ æ·»åŠ åˆ°é˜Ÿåˆ—çš„æœ«å°¾ï¼Œä½¿ç”¨ poll() æ–¹æ³•ä»é˜Ÿåˆ—çš„å¤´éƒ¨åˆ é™¤å…ƒç´ ï¼Œä½¿ç”¨è¿­ä»£å™¨æˆ–è€… poll() æ–¹æ³•ä¾æ¬¡éå†å…ƒç´ ã€‚

### æ ˆå’Œé˜Ÿåˆ—

è¦è®²æ ˆå’Œé˜Ÿåˆ—ï¼Œé¦–å…ˆè¦è®²*Deque*æ¥å£ã€‚*Deque*çš„å«ä¹‰æ˜¯â€œdouble ended queueâ€ï¼Œå³åŒç«¯é˜Ÿåˆ—ï¼Œå®ƒæ—¢å¯ä»¥å½“ä½œæ ˆä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å½“ä½œé˜Ÿåˆ—ä½¿ç”¨ã€‚ä¸‹è¡¨åˆ—å‡ºäº†*Deque*ä¸*Queue*ç›¸å¯¹åº”çš„æ¥å£ï¼š

| Queue Method | Equivalent Deque Method | è¯´æ˜                                   |
| ------------ | ----------------------- | -------------------------------------- |
| add(e)       | addLast(e)              | å‘é˜Ÿå°¾æ’å…¥å…ƒç´ ï¼Œå¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸         |
| offer(e)     | offerLast(e)            | å‘é˜Ÿå°¾æ’å…¥å…ƒç´ ï¼Œå¤±è´¥åˆ™è¿”å›`false`      |
| remove()     | removeFirst()           | è·å–å¹¶åˆ é™¤é˜Ÿé¦–å…ƒç´ ï¼Œå¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸     |
| poll()       | pollFirst()             | è·å–å¹¶åˆ é™¤é˜Ÿé¦–å…ƒç´ ï¼Œå¤±è´¥åˆ™è¿”å›`null`   |
| element()    | getFirst()              | è·å–ä½†ä¸åˆ é™¤é˜Ÿé¦–å…ƒç´ ï¼Œå¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸   |
| peek()       | peekFirst()             | è·å–ä½†ä¸åˆ é™¤é˜Ÿé¦–å…ƒç´ ï¼Œå¤±è´¥åˆ™è¿”å›`null` |

ä¸‹è¡¨åˆ—å‡ºäº†*Deque*ä¸*Stack*å¯¹åº”çš„æ¥å£ï¼š

| Stack Method | Equivalent Deque Method | è¯´æ˜                                   |
| ------------ | ----------------------- | -------------------------------------- |
| push(e)      | addFirst(e)             | å‘æ ˆé¡¶æ’å…¥å…ƒç´ ï¼Œå¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸         |
| æ—            | offerFirst(e)           | å‘æ ˆé¡¶æ’å…¥å…ƒç´ ï¼Œå¤±è´¥åˆ™è¿”å›`false`      |
| pop()        | removeFirst()           | è·å–å¹¶åˆ é™¤æ ˆé¡¶å…ƒç´ ï¼Œå¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸     |
| æ—            | pollFirst()             | è·å–å¹¶åˆ é™¤æ ˆé¡¶å…ƒç´ ï¼Œå¤±è´¥åˆ™è¿”å›`null`   |
| peek()       | getFirst()             | è·å–ä½†ä¸åˆ é™¤æ ˆé¡¶å…ƒç´ ï¼Œå¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸   |
| æ—            | peekFirst()             | è·å–ä½†ä¸åˆ é™¤æ ˆé¡¶å…ƒç´ ï¼Œå¤±è´¥åˆ™è¿”å›`null` |

ä¸Šé¢ä¸¤ä¸ªè¡¨å…±å®šä¹‰äº†*Deque*çš„ 12 ä¸ªæ¥å£ã€‚

æ·»åŠ ï¼Œåˆ é™¤ï¼Œå–å€¼éƒ½æœ‰ä¸¤å¥—æ¥å£ï¼Œå®ƒä»¬åŠŸèƒ½ç›¸åŒï¼ŒåŒºåˆ«æ˜¯å¯¹å¤±è´¥æƒ…å†µçš„å¤„ç†ä¸åŒã€‚

**ä¸€å¥—æ¥å£é‡åˆ°å¤±è´¥å°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¦ä¸€å¥—é‡åˆ°å¤±è´¥ä¼šè¿”å›ç‰¹æ®Šå€¼ï¼ˆ`false`æˆ–`null`ï¼‰**ã€‚é™¤éæŸç§å®ç°å¯¹å®¹é‡æœ‰é™åˆ¶ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ·»åŠ æ“ä½œæ˜¯ä¸ä¼šå¤±è´¥çš„ã€‚

**è™½ç„¶*Deque*çš„æ¥å£æœ‰ 12 ä¸ªä¹‹å¤šï¼Œä½†æ— éå°±æ˜¯å¯¹å®¹å™¨çš„ä¸¤ç«¯è¿›è¡Œæ“ä½œï¼Œæˆ–æ·»åŠ ï¼Œæˆ–åˆ é™¤ï¼Œæˆ–æŸ¥çœ‹**ã€‚æ˜ç™½äº†è¿™ä¸€ç‚¹è®²è§£èµ·æ¥å°±ä¼šéå¸¸ç®€å•ã€‚

*ArrayDeque*å’Œ*LinkedList*æ˜¯*Deque*çš„ä¸¤ä¸ªé€šç”¨å®ç°ï¼Œç”±äºå®˜æ–¹æ›´æ¨èä½¿ç”¨*ArrayDeque*ç”¨ä½œæ ˆå’Œé˜Ÿåˆ—ï¼ŒåŠ ä¹‹ä¸Šä¸€ç¯‡å·²ç»è®²è§£è¿‡[LinkedList](https://tobebetterjavaer.com/collection/linkedlist.html)ï¼Œæœ¬æ–‡å°†ç€é‡è®²è§£*ArrayDeque*çš„å…·ä½“å®ç°ã€‚

ä»åå­—å¯ä»¥çœ‹å‡º*ArrayDeque*åº•å±‚é€šè¿‡æ•°ç»„å®ç°ï¼Œä¸ºäº†æ»¡è¶³å¯ä»¥åŒæ—¶åœ¨æ•°ç»„ä¸¤ç«¯æ’å…¥æˆ–åˆ é™¤å…ƒç´ çš„éœ€æ±‚ï¼Œè¯¥æ•°ç»„è¿˜å¿…é¡»æ˜¯å¾ªç¯çš„ï¼Œå³**å¾ªç¯æ•°ç»„ï¼ˆcircular arrayï¼‰**ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°ç»„çš„ä»»ä½•ä¸€ç‚¹éƒ½å¯èƒ½è¢«çœ‹ä½œèµ·ç‚¹æˆ–è€…ç»ˆç‚¹ã€‚

*ArrayDeque*æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼ˆnot thread-safeï¼‰ï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶ä½¿ç”¨çš„æ—¶å€™ï¼Œéœ€è¦æ‰‹åŠ¨åŒæ­¥ï¼›å¦å¤–ï¼Œè¯¥å®¹å™¨ä¸å…è®¸æ”¾å…¥`null`å…ƒç´ ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/arraydeque-1e7086a3-3d31-4553-aa16-5eaf2193649e.png)


ä¸Šå›¾ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œ**`head`æŒ‡å‘é¦–ç«¯ç¬¬ä¸€ä¸ªæœ‰æ•ˆå…ƒç´ ï¼Œ`tail`æŒ‡å‘å°¾ç«¯ç¬¬ä¸€ä¸ªå¯ä»¥æ’å…¥å…ƒç´ çš„ç©ºä½**ã€‚å› ä¸ºæ˜¯å¾ªç¯æ•°ç»„ï¼Œæ‰€ä»¥`head`ä¸ä¸€å®šæ€»ç­‰äº 0ï¼Œ`tail`ä¹Ÿä¸ä¸€å®šæ€»æ˜¯æ¯”`head`å¤§ã€‚

### æ–¹æ³•å‰–æ

#### addFirst()

`addFirst(E e)`çš„ä½œç”¨æ˜¯åœ¨*Deque*çš„é¦–ç«¯æ’å…¥å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯åœ¨`head`çš„å‰é¢æ’å…¥å…ƒç´ ï¼Œåœ¨ç©ºé—´è¶³å¤Ÿä¸”ä¸‹æ ‡æ²¡æœ‰è¶Šç•Œçš„æƒ…å†µä¸‹ï¼Œåªéœ€è¦å°†`elements[--head] = e`å³å¯ã€‚


![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/arraydeque-459afbba-2778-4241-97fb-f01a29b79458.png)

å®é™…éœ€è¦è€ƒè™‘ï¼š

1. ç©ºé—´æ˜¯å¦å¤Ÿç”¨ï¼Œä»¥åŠ 
2. ä¸‹æ ‡æ˜¯å¦è¶Šç•Œçš„é—®é¢˜ã€‚

ä¸Šå›¾ä¸­ï¼Œå¦‚æœ`head`ä¸º`0`ä¹‹åæ¥ç€è°ƒç”¨`addFirst()`ï¼Œè™½ç„¶ç©ºä½™ç©ºé—´è¿˜å¤Ÿç”¨ï¼Œä½†`head`ä¸º`-1`ï¼Œä¸‹æ ‡è¶Šç•Œäº†ã€‚ä¸‹åˆ—ä»£ç å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸¤ä¸ªé—®é¢˜ã€‚


```java
//addFirst(E e)
public void addFirst(E e) {
    if (e == null)//ä¸å…è®¸æ”¾å…¥null
        throw new NullPointerException();
    elements[head = (head - 1) & (elements.length - 1)] = e;//2.ä¸‹æ ‡æ˜¯å¦è¶Šç•Œ
    if (head == tail)//1.ç©ºé—´æ˜¯å¦å¤Ÿç”¨
        doubleCapacity();//æ‰©å®¹
}
```

ä¸Šè¿°ä»£ç æˆ‘ä»¬çœ‹åˆ°ï¼Œ**ç©ºé—´é—®é¢˜æ˜¯åœ¨æ’å…¥ä¹‹åè§£å†³çš„**ï¼Œå› ä¸º`tail`æ€»æ˜¯æŒ‡å‘ä¸‹ä¸€ä¸ªå¯æ’å…¥çš„ç©ºä½ï¼Œä¹Ÿå°±æ„å‘³ç€`elements`æ•°ç»„è‡³å°‘æœ‰ä¸€ä¸ªç©ºä½ï¼Œæ‰€ä»¥æ’å…¥å…ƒç´ çš„æ—¶å€™ä¸ç”¨è€ƒè™‘ç©ºé—´é—®é¢˜ã€‚

ä¸‹æ ‡è¶Šç•Œçš„å¤„ç†è§£å†³èµ·æ¥éå¸¸ç®€å•ï¼Œ`head = (head - 1) & (elements.length - 1)`å°±å¯ä»¥äº†ï¼Œ**è¿™æ®µä»£ç ç›¸å½“äºå–ä½™ï¼ŒåŒæ—¶è§£å†³äº†`head`ä¸ºè´Ÿå€¼çš„æƒ…å†µ**ã€‚å› ä¸º`elements.length`å¿…éœ€æ˜¯`2`çš„æŒ‡æ•°å€ï¼Œ`elements - 1`å°±æ˜¯äºŒè¿›åˆ¶ä½ä½å…¨`1`ï¼Œè·Ÿ`head - 1`ç›¸ä¸ä¹‹åå°±èµ·åˆ°äº†å–æ¨¡çš„ä½œç”¨ï¼Œå¦‚æœ`head - 1`ä¸ºè´Ÿæ•°ï¼ˆå…¶å®åªå¯èƒ½æ˜¯-1ï¼‰ï¼Œåˆ™ç›¸å½“äºå¯¹å…¶å–ç›¸å¯¹äº`elements.length`çš„è¡¥ç ã€‚

ä¸‹é¢å†è¯´è¯´æ‰©å®¹å‡½æ•°`doubleCapacity()`ï¼Œå…¶é€»è¾‘æ˜¯ç”³è¯·ä¸€ä¸ªæ›´å¤§çš„æ•°ç»„ï¼ˆåŸæ•°ç»„çš„ä¸¤å€ï¼‰ï¼Œç„¶åå°†åŸæ•°ç»„å¤åˆ¶è¿‡å»ã€‚è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/arraydeque-f1386b63-10be-4998-bb6d-bf6560cca7ee.png)

å›¾ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œå¤åˆ¶åˆ†ä¸¤æ¬¡è¿›è¡Œï¼Œç¬¬ä¸€æ¬¡å¤åˆ¶`head`å³è¾¹çš„å…ƒç´ ï¼Œç¬¬äºŒæ¬¡å¤åˆ¶`head`å·¦è¾¹çš„å…ƒç´ ã€‚

```java
//doubleCapacity()
private void doubleCapacity() {
    assert head == tail;
    int p = head;
    int n = elements.length;
    int r = n - p; // headå³è¾¹å…ƒç´ çš„ä¸ªæ•°
    int newCapacity = n << 1;//åŸç©ºé—´çš„2å€
    if (newCapacity < 0)
        throw new IllegalStateException("Sorry, deque too big");
    Object[] a = new Object[newCapacity];
    System.arraycopy(elements, p, a, 0, r);//å¤åˆ¶å³åŠéƒ¨åˆ†ï¼Œå¯¹åº”ä¸Šå›¾ä¸­ç»¿è‰²éƒ¨åˆ†
    System.arraycopy(elements, 0, a, r, p);//å¤åˆ¶å·¦åŠéƒ¨åˆ†ï¼Œå¯¹åº”ä¸Šå›¾ä¸­ç°è‰²éƒ¨åˆ†
    elements = (E[])a;
    head = 0;
    tail = n;
}
```

è¯¥æ–¹æ³•çš„å®ç°ä¸­ï¼Œé¦–å…ˆæ£€æŸ¥ head å’Œ tail æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœä¸ç›¸ç­‰åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ç„¶åè®¡ç®—å‡º head å³è¾¹çš„å…ƒç´ ä¸ªæ•° rï¼Œä»¥åŠæ–°çš„å®¹é‡ newCapacityï¼Œå¦‚æœ newCapacity å¤ªå¤§åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚

æ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ Object æ•°ç»„ aï¼Œå°†åŸæœ‰ ArrayDeque ä¸­ head å³è¾¹çš„å…ƒç´ å¤åˆ¶åˆ° a çš„å‰é¢ï¼ˆå³å›¾ä¸­ç»¿è‰²éƒ¨åˆ†ï¼‰ï¼Œå°† head å·¦è¾¹çš„å…ƒç´ å¤åˆ¶åˆ° a çš„åé¢ï¼ˆå³å›¾ä¸­ç°è‰²éƒ¨åˆ†ï¼‰ã€‚æœ€åå°† elements æ•°ç»„æ›¿æ¢ä¸º aï¼Œhead è®¾ç½®ä¸º 0ï¼Œtail è®¾ç½®ä¸º nï¼ˆå³æ–°å®¹é‡çš„é•¿åº¦ï¼‰ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äº elements æ•°ç»„è¢«æ›¿æ¢ä¸º a æ•°ç»„ï¼Œå› æ­¤åœ¨æ–¹æ³•è°ƒç”¨ç»“æŸåï¼ŒåŸæœ‰çš„ elements æ•°ç»„å°†ä¸å†è¢«å¼•ç”¨ï¼Œä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚

#### addLast()

`addLast(E e)`çš„ä½œç”¨æ˜¯åœ¨*Deque*çš„å°¾ç«¯æ’å…¥å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯åœ¨`tail`çš„ä½ç½®æ’å…¥å…ƒç´ ï¼Œç”±äº`tail`æ€»æ˜¯æŒ‡å‘ä¸‹ä¸€ä¸ªå¯ä»¥æ’å…¥çš„ç©ºä½ï¼Œå› æ­¤åªéœ€è¦`elements[tail] = e;`å³å¯ã€‚æ’å…¥å®Œæˆåå†æ£€æŸ¥ç©ºé—´ï¼Œå¦‚æœç©ºé—´å·²ç»ç”¨å…‰ï¼Œåˆ™è°ƒç”¨`doubleCapacity()`è¿›è¡Œæ‰©å®¹ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/arraydeque-832c796a-6c24-4546-9f91-22ed39884363.png)

```java
public void addLast(E e) {
    if (e == null)//ä¸å…è®¸æ”¾å…¥null
        throw new NullPointerException();
    elements[tail] = e;//èµ‹å€¼
    if ( (tail = (tail + 1) & (elements.length - 1)) == head)//ä¸‹æ ‡è¶Šç•Œå¤„ç†
        doubleCapacity();//æ‰©å®¹
}
```

ä¸‹æ ‡è¶Šç•Œå¤„ç†æ–¹å¼`addFirt()`ä¸­å·²ç»è®²è¿‡ï¼Œä¸å†èµ˜è¿°ã€‚

#### pollFirst()

`pollFirst()`çš„ä½œç”¨æ˜¯åˆ é™¤å¹¶è¿”å›*Deque*é¦–ç«¯å…ƒç´ ï¼Œä¹Ÿå³æ˜¯`head`ä½ç½®å¤„çš„å…ƒç´ ã€‚å¦‚æœå®¹å™¨ä¸ç©ºï¼Œåªéœ€è¦ç›´æ¥è¿”å›`elements[head]`å³å¯ï¼Œå½“ç„¶è¿˜éœ€è¦å¤„ç†ä¸‹æ ‡çš„é—®é¢˜ã€‚ç”±äº`ArrayDeque`ä¸­ä¸å…è®¸æ”¾å…¥`null`ï¼Œå½“`elements[head] == null`æ—¶ï¼Œæ„å‘³ç€å®¹å™¨ä¸ºç©ºã€‚

```java
public E pollFirst() {
    E result = elements[head];
    if (result == null)//nullå€¼æ„å‘³ç€dequeä¸ºç©º
        return null;
    elements[h] = null;//let GC work
    head = (head + 1) & (elements.length - 1);//ä¸‹æ ‡è¶Šç•Œå¤„ç†
    return result;
}
```

#### pollLast()

`pollLast()`çš„ä½œç”¨æ˜¯åˆ é™¤å¹¶è¿”å›*Deque*å°¾ç«¯å…ƒç´ ï¼Œä¹Ÿå³æ˜¯`tail`ä½ç½®å‰é¢çš„é‚£ä¸ªå…ƒç´ ã€‚

```java
public E pollLast() {
    int t = (tail - 1) & (elements.length - 1);//tailçš„ä¸Šä¸€ä¸ªä½ç½®æ˜¯æœ€åä¸€ä¸ªå…ƒç´ 
    E result = elements[t];
    if (result == null)//nullå€¼æ„å‘³ç€dequeä¸ºç©º
        return null;
    elements[t] = null;//let GC work
    tail = t;
    return result;
}
```

#### peekFirst()

`peekFirst()`çš„ä½œç”¨æ˜¯è¿”å›ä½†ä¸åˆ é™¤*Deque*é¦–ç«¯å…ƒç´ ï¼Œä¹Ÿå³æ˜¯`head`ä½ç½®å¤„çš„å…ƒç´ ï¼Œç›´æ¥è¿”å›`elements[head]`å³å¯ã€‚

```java
public E peekFirst() {
    return elements[head]; // elements[head] is null if deque empty
}
```

#### peekLast()

`peekLast()`çš„ä½œç”¨æ˜¯è¿”å›ä½†ä¸åˆ é™¤*Deque*å°¾ç«¯å…ƒç´ ï¼Œä¹Ÿå³æ˜¯`tail`ä½ç½®å‰é¢çš„é‚£ä¸ªå…ƒç´ ã€‚

```java
public E peekLast() {
    return elements[(tail - 1) & (elements.length - 1)];
}
```

### å°ç»“

å½“éœ€è¦å®ç°å…ˆè¿›å…ˆå‡º(FIFO)æˆ–è€…å…ˆè¿›åå‡º(LIFO)çš„æ•°æ®ç»“æ„æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ ArrayDequeã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ä½¿ç”¨ ArrayDeque çš„åœºæ™¯ï¼š

- ç®¡ç†ä»»åŠ¡é˜Ÿåˆ—ï¼šå¦‚æœéœ€è¦å®ç°ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œå¯ä»¥ä½¿ç”¨ ArrayDeque æ¥å­˜å‚¨ä»»åŠ¡å…ƒç´ ã€‚åœ¨é˜Ÿåˆ—å¤´éƒ¨æ·»åŠ æ–°ä»»åŠ¡å…ƒç´ ï¼Œä»é˜Ÿåˆ—å°¾éƒ¨å–å‡ºä»»åŠ¡è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥ä¿è¯ä»»åŠ¡æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºæ‰§è¡Œã€‚
- å®ç°æ ˆï¼šArrayDeque å¯ä»¥ä½œä¸ºæ ˆçš„å®ç°æ–¹å¼ï¼Œæ”¯æŒ pushã€popã€peek ç­‰æ“ä½œï¼Œå¯ä»¥ç”¨äºéœ€è¦åè¿›å…ˆå‡ºçš„åœºæ™¯ã€‚
- å®ç°ç¼“å­˜ï¼šåœ¨éœ€è¦ç¼“å­˜ä¸€å®šæ•°é‡çš„æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ ArrayDequeã€‚å½“ç¼“å­˜çš„æ•°æ®é‡è¶…è¿‡å®¹é‡æ—¶ï¼Œå¯ä»¥ä»é˜Ÿåˆ—å¤´éƒ¨åˆ é™¤æœ€è€çš„æ•°æ®ï¼Œä»é˜Ÿåˆ—å°¾éƒ¨æ·»åŠ æ–°çš„æ•°æ®ã€‚
- å®ç°äº‹ä»¶å¤„ç†å™¨ï¼šArrayDeque å¯ä»¥ä½œä¸ºäº‹ä»¶å¤„ç†å™¨çš„å®ç°æ–¹å¼ï¼Œæ”¯æŒä»é˜Ÿåˆ—å¤´éƒ¨è·å–äº‹ä»¶è¿›è¡Œå¤„ç†ï¼Œä»é˜Ÿåˆ—å°¾éƒ¨æ·»åŠ æ–°çš„äº‹ä»¶ã€‚

ç®€å•æ€»ç»“ä¸€ä¸‹å§ã€‚

ArrayDeque æ˜¯ Java æ ‡å‡†åº“ä¸­çš„ä¸€ç§åŒç«¯é˜Ÿåˆ—å®ç°ï¼Œåº•å±‚åŸºäºæ•°ç»„å®ç°ã€‚ä¸ LinkedList ç›¸æ¯”ï¼ŒArrayDeque çš„æ€§èƒ½æ›´ä¼˜ï¼Œå› ä¸ºå®ƒä½¿ç”¨è¿ç»­çš„å†…å­˜ç©ºé—´å­˜å‚¨å…ƒç´ ï¼Œå¯ä»¥æ›´å¥½åœ°åˆ©ç”¨ CPU ç¼“å­˜ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä¹Ÿæ›´å¿«ã€‚

ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ

å› ä¸ºArrayDeque çš„åº•å±‚å®ç°æ˜¯æ•°ç»„ï¼Œè€Œ LinkedList çš„åº•å±‚å®ç°æ˜¯é“¾è¡¨ã€‚æ•°ç»„æ˜¯ä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œè€Œé“¾è¡¨æ˜¯ç”±å¤šä¸ªèŠ‚ç‚¹ç»„æˆçš„ï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨æ•°æ®å’ŒæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨ LinkedList æ—¶ï¼Œéœ€è¦é¢‘ç¹è¿›è¡Œå†…å­˜åˆ†é…å’Œé‡Šæ”¾ï¼Œè€Œ ArrayDeque åœ¨åˆ›å»ºæ—¶å°±ä¸€æ¬¡æ€§åˆ†é…äº†è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œä¸éœ€è¦é¢‘ç¹è¿›è¡Œå†…å­˜åˆ†é…å’Œé‡Šæ”¾ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½åœ°åˆ©ç”¨ CPU ç¼“å­˜ï¼Œæé«˜è®¿é—®æ•ˆç‡ã€‚

ç°ä»£è®¡ç®—æœºCPUå¯¹äºæ•°æ®çš„å±€éƒ¨æ€§æœ‰å¾ˆå¼ºçš„ä¾èµ–ï¼Œå¦‚æœéœ€è¦è®¿é—®çš„æ•°æ®åœ¨å†…å­˜ä¸­æ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨CPUçš„ç¼“å­˜æœºåˆ¶ï¼Œæé«˜è®¿é—®æ•ˆç‡ã€‚è€Œå½“æ•°æ®å­˜å‚¨åœ¨ä¸åŒçš„å†…å­˜å—é‡Œæ—¶ï¼Œæ¯æ¬¡è®¿é—®éƒ½éœ€è¦ä»å†…å­˜ä¸­è¯»å–ï¼Œæ•ˆç‡ä¼šå—åˆ°å½±å“ã€‚

å½“ç„¶äº†ï¼Œä½¿ç”¨ ArrayDeque æ—¶ï¼Œæ•°ç»„å¤åˆ¶æ“ä½œä¹Ÿæ˜¯éœ€è¦è€ƒè™‘çš„æ€§èƒ½æ¶ˆè€—ä¹‹ä¸€ã€‚

å½“ ArrayDeque çš„å…ƒç´ æ•°é‡è¶…è¿‡äº†åˆå§‹å®¹é‡æ—¶ï¼Œä¼šè§¦å‘æ‰©å®¹æ“ä½œã€‚æ‰©å®¹æ“ä½œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œå¹¶å°†åŸæœ‰å…ƒç´ å¤åˆ¶åˆ°æ–°æ•°ç»„ä¸­ã€‚æ‰©å®¹æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚

ä¸è¿‡ï¼ŒArrayDeque çš„æ‰©å®¹ç­–ç•¥ï¼ˆå½“ ArrayDeque ä¸­çš„å…ƒç´ æ•°é‡è¾¾åˆ°æ•°ç»„å®¹é‡æ—¶ï¼Œå°±éœ€è¦è¿›è¡Œæ‰©å®¹æ“ä½œï¼Œæ‰©å®¹æ—¶ä¼šå°†æ•°ç»„å®¹é‡æ‰©å¤§ä¸ºåŸæ¥çš„ä¸¤å€ï¼‰å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘æ•°ç»„å¤åˆ¶çš„æ¬¡æ•°å’Œæ—¶é—´æ¶ˆè€—ï¼ŒåŒæ—¶ä¿è¯ ArrayDeque çš„æ€§èƒ½å’Œç©ºé—´åˆ©ç”¨ç‡ã€‚

ArrayDeque ä¸ä»…æ”¯æŒå¸¸è§çš„é˜Ÿåˆ—æ“ä½œï¼Œå¦‚æ·»åŠ å…ƒç´ ã€åˆ é™¤å…ƒç´ ã€è·å–é˜Ÿåˆ—å¤´éƒ¨å…ƒç´ ã€è·å–é˜Ÿåˆ—å°¾éƒ¨å…ƒç´ ç­‰ã€‚åŒæ—¶ï¼Œå®ƒè¿˜æ”¯æŒæ ˆæ“ä½œï¼Œå¦‚ pushã€popã€peek ç­‰ã€‚è¿™ä½¿å¾— ArrayDeque æˆä¸ºä¸€ç§éå¸¸çµæ´»çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥ç”¨äºå„ç§åœºæ™¯çš„æ•°æ®å­˜å‚¨å’Œå¤„ç†ã€‚


>å‚è€ƒé“¾æ¥ï¼š[https://github.com/CarpenterLee/JCFInternals](https://github.com/CarpenterLee/JCFInternals)ï¼Œä½œè€…ï¼šæè±ªï¼Œæ•´ç†ï¼šæ²‰é»˜ç‹äºŒ


----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 6.13 ä¼˜å…ˆçº§é˜Ÿåˆ—PriorityQueueè¯¦è§£

>ç»§ç»­æœ‰è¯·ç‹è€å¸ˆï¼Œæ¥ä¸Šå°ç»™å¤§å®¶è®²è®²ä¼˜å…ˆçº§é˜Ÿåˆ— PriorityQueueã€‚

PriorityQueue æ˜¯ Java ä¸­çš„ä¸€ä¸ªåŸºäºä¼˜å…ˆçº§å †çš„ä¼˜å…ˆé˜Ÿåˆ—å®ç°ï¼Œå®ƒèƒ½å¤Ÿåœ¨ O(log n) çš„æ—¶é—´å¤æ‚åº¦å†…å®ç°å…ƒç´ çš„æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œå¹¶ä¸”èƒ½å¤Ÿè‡ªåŠ¨ç»´æŠ¤é˜Ÿåˆ—ä¸­å…ƒç´ çš„ä¼˜å…ˆçº§é¡ºåºã€‚

é€šä¿—æ¥è¯´ï¼ŒPriorityQueue å°±æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œä½†æ˜¯å®ƒä¸æ˜¯å…ˆè¿›å…ˆå‡ºçš„ï¼Œè€Œæ˜¯æŒ‰ç…§å…ƒç´ ä¼˜å…ˆçº§è¿›è¡Œæ’åºçš„ã€‚å½“ä½ å¾€ PriorityQueue ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨æ ¹æ®å…ƒç´ çš„ä¼˜å…ˆçº§å°†å…¶æ’å…¥åˆ°åˆé€‚çš„ä½ç½®ã€‚å½“ä½ ä» PriorityQueue ä¸­åˆ é™¤ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å°†ä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ å‡ºé˜Ÿã€‚

ä¸‹é¢ğŸ‘‡ğŸ»æ˜¯ä¸€ä¸ªç®€å•çš„PriorityQueueç¤ºä¾‹ï¼š

```java
// åˆ›å»º PriorityQueue å¯¹è±¡
PriorityQueue<String> priorityQueue = new PriorityQueue<>();

// æ·»åŠ å…ƒç´ åˆ° PriorityQueue
priorityQueue.offer("æ²‰é»˜ç‹äºŒ");
priorityQueue.offer("é™ˆæ¸…æ‰¬");
priorityQueue.offer("å°è½¬é“ƒ");

// æ‰“å° PriorityQueue ä¸­çš„å…ƒç´ 
System.out.println("PriorityQueue ä¸­çš„å…ƒç´ ï¼š");
while (!priorityQueue.isEmpty()) {
    System.out.print(priorityQueue.poll() + " ");
}
```

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª PriorityQueue å¯¹è±¡ï¼Œå¹¶å‘å…¶ä¸­æ·»åŠ äº†ä¸‰ä¸ªå…ƒç´ ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ while å¾ªç¯éå† PriorityQueue ä¸­çš„å…ƒç´ ï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚æ¥çœ‹è¾“å‡ºç»“æœï¼š

```
PriorityQueue ä¸­çš„å…ƒç´ ï¼š
å°è½¬é“ƒ æ²‰é»˜ç‹äºŒ é™ˆæ¸…æ‰¬ 
```

å†æ¥çœ‹ä¸€ä¸‹ç¤ºä¾‹ã€‚

```java
// åˆ›å»º PriorityQueue å¯¹è±¡ï¼Œå¹¶æŒ‡å®šä¼˜å…ˆçº§é¡ºåº
PriorityQueue<String> priorityQueue = new PriorityQueue<>(Comparator.reverseOrder());

// æ·»åŠ å…ƒç´ åˆ° PriorityQueue
priorityQueue.offer("æ²‰é»˜ç‹äºŒ");
priorityQueue.offer("é™ˆæ¸…æ‰¬");
priorityQueue.offer("å°è½¬é“ƒ");

// æ‰“å° PriorityQueue ä¸­çš„å…ƒç´ 
System.out.println("PriorityQueue ä¸­çš„å…ƒç´ ï¼š");
while (!priorityQueue.isEmpty()) {
    System.out.print(priorityQueue.poll() + " ");
}
```

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Comparator.reverseOrder() æ–¹æ³•æŒ‡å®šäº† PriorityQueue çš„ä¼˜å…ˆçº§é¡ºåºä¸ºé™åºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒPriorityQueue ä¸­çš„å…ƒç´ ä¼šæŒ‰ç…§ä»å¤§åˆ°å°çš„é¡ºåºæ’åºã€‚

å…¶ä»–éƒ¨åˆ†çš„ä»£ç ä¸ä¹‹å‰çš„ä¾‹å­ç›¸åŒï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœï¼š

```
PriorityQueue ä¸­çš„å…ƒç´ ï¼š
é™ˆæ¸…æ‰¬ æ²‰é»˜ç‹äºŒ å°è½¬é“ƒ
```

å¯¹æ¯”ä¸€ä¸‹ä¸¤ä¸ªä¾‹å­çš„è¾“å‡ºç»“æœï¼Œä¸éš¾å‘ç°ï¼Œé¡ºåºæ­£å¥½ç›¸åã€‚

### PriorityQueueçš„ä½œç”¨

PriorityQueue çš„ä¸»è¦ä½œç”¨æ˜¯ç»´æŠ¤ä¸€ç»„æ•°æ®çš„æ’åºï¼Œä½¿å¾—å–å‡ºæ•°æ®æ—¶å¯ä»¥æŒ‰ç…§ä¸€å®šçš„ä¼˜å…ˆçº§é¡ºåºè¿›è¡Œï¼Œå½“æˆ‘ä»¬è°ƒç”¨ poll() æ–¹æ³•æ—¶ï¼Œå®ƒä¼šä»é˜Ÿåˆ—çš„é¡¶éƒ¨å¼¹å‡ºæœ€é«˜ä¼˜å…ˆçº§çš„å…ƒç´ ã€‚å®ƒåœ¨å¾ˆå¤šåœºæ™¯ä¸‹éƒ½æœ‰å¹¿æ³›çš„åº”ç”¨ï¼Œä¾‹å¦‚ä»»åŠ¡è°ƒåº¦ã€äº‹ä»¶å¤„ç†ç­‰åœºæ™¯ï¼Œä»¥åŠä¸€äº›ç®—æ³•ä¸­éœ€è¦å¯¹æ•°æ®è¿›è¡Œæ’åºçš„åœºæ™¯ã€‚

åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒPriorityQueue ä¹Ÿç»å¸¸ç”¨äºå®ç° Dijkstra ç®—æ³•ã€Prim ç®—æ³•ã€Huffman ç¼–ç ç­‰ç®—æ³•ã€‚è¿™é‡Œç®€å•è¯´ä¸€ä¸‹è¿™å‡ ç§ç®—æ³•çš„ä½œç”¨ï¼Œç†è§£ä¸äº†ä¹Ÿæ²¡å…³ç³»å“ˆã€‚

Dijkstraç®—æ³•æ˜¯ä¸€ç§ç”¨äºè®¡ç®—å¸¦æƒå›¾ä¸­çš„æœ€çŸ­è·¯å¾„çš„ç®—æ³•ã€‚è¯¥ç®—æ³•é‡‡ç”¨è´ªå¿ƒçš„ç­–ç•¥ï¼Œåœ¨éå†å›¾çš„è¿‡ç¨‹ä¸­ï¼Œæ¯æ¬¡é€‰å–å½“å‰åˆ°æºç‚¹è·ç¦»æœ€çŸ­çš„ä¸€ä¸ªé¡¶ç‚¹ï¼Œå¹¶ä»¥å®ƒä¸ºä¸­å¿ƒè¿›è¡Œæ‰©å±•ï¼Œæ›´æ–°å…¶ä»–é¡¶ç‚¹çš„è·ç¦»å€¼ã€‚ç»è¿‡å¤šæ¬¡æ‰©å±•ï¼Œå¯ä»¥å¾—åˆ°æºç‚¹åˆ°å…¶å®ƒæ‰€æœ‰é¡¶ç‚¹çš„æœ€çŸ­è·¯å¾„ã€‚

Primç®—æ³•æ˜¯ä¸€ç§ç”¨äºæ±‚è§£æœ€å°ç”Ÿæˆæ ‘çš„ç®—æ³•ï¼Œå¯ä»¥åœ¨åŠ æƒè¿é€šå›¾ä¸­æ‰¾åˆ°ä¸€æ£µç”Ÿæˆæ ‘ï¼Œä½¿å¾—è¿™æ£µç”Ÿæˆæ ‘çš„æ‰€æœ‰è¾¹çš„æƒå€¼ä¹‹å’Œæœ€å°ã€‚è¯¥ç®—æ³•ä»ä»»æ„ä¸€ä¸ªé¡¶ç‚¹å¼€å§‹ï¼Œé€æ¸æ‰©å±•ç”Ÿæˆæ ‘çš„è§„æ¨¡ï¼Œæ¯æ¬¡é€‰æ‹©ä¸€ä¸ªè·ç¦»å·²ç”Ÿæˆæ ‘æœ€è¿‘çš„é¡¶ç‚¹åŠ å…¥åˆ°ç”Ÿæˆæ ‘ä¸­ã€‚

Huffmanç¼–ç æ˜¯ä¸€ç§åŸºäºéœå¤«æ›¼æ ‘çš„å‹ç¼©ç®—æ³•ï¼Œç”¨äºå°†ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºäºŒè¿›åˆ¶ç¼–ç ä»¥è¿›è¡Œå‹ç¼©ã€‚è¯¥ç®—æ³•çš„ä¸»è¦æ€æƒ³æ˜¯é€šè¿‡å»ºç«‹éœå¤«æ›¼æ ‘ï¼Œå°†å‡ºç°é¢‘ç‡è¾ƒé«˜çš„å­—ç¬¦ç”¨è¾ƒçŸ­çš„ç¼–ç è¡¨ç¤ºï¼Œè€Œå‡ºç°é¢‘ç‡è¾ƒä½çš„å­—ç¬¦ç”¨è¾ƒé•¿çš„ç¼–ç è¡¨ç¤ºï¼Œä»è€Œå®ç°å¯¹å­—ç¬¦ä¸²çš„å‹ç¼©ã€‚åœ¨è§£å‹ç¼©æ—¶ï¼Œæ ¹æ®ç¼–ç é€æ­¥è§£æå‡ºåŸå­—ç¬¦ä¸²ã€‚

ç”±äº PriorityQueue çš„åº•å±‚æ˜¯åŸºäºå †å®ç°çš„ï¼Œå› æ­¤åœ¨æ•°æ®é‡æ¯”è¾ƒå¤§æ—¶ï¼Œä½¿ç”¨ PriorityQueue å¯ä»¥è·å¾—è¾ƒå¥½çš„æ—¶é—´å¤æ‚åº¦ã€‚

è¿™é‡Œç‰µæ¶‰åˆ°äº†å¤§å°å…³ç³»ï¼Œ**å…ƒç´ å¤§å°çš„è¯„åˆ¤å¯ä»¥é€šè¿‡å…ƒç´ æœ¬èº«çš„è‡ªç„¶é¡ºåºï¼ˆ_natural ordering_ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ„é€ æ—¶ä¼ å…¥çš„æ¯”è¾ƒå™¨**ï¼ˆ_Comparator_ï¼Œæˆ–è€…å…ƒç´ è‡ªèº«å®ç° Comparable æ¥å£ï¼‰æ¥å†³å®šã€‚

åœ¨ PriorityQueue ä¸­ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªä¼˜å…ˆçº§ï¼Œè¿™ä¸ªä¼˜å…ˆçº§å†³å®šäº†å…ƒç´ åœ¨é˜Ÿåˆ—ä¸­çš„ä½ç½®ã€‚é˜Ÿåˆ—å†…éƒ¨é€šè¿‡å°é¡¶å †ï¼ˆä¹Ÿå¯ä»¥æ˜¯å¤§é¡¶å †ï¼‰çš„æ–¹å¼æ¥ç»´æŠ¤å…ƒç´ çš„ä¼˜å…ˆçº§å…³ç³»ã€‚å…·ä½“æ¥è¯´ï¼Œå°é¡¶å †æ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ï¼Œä»»ä½•ä¸€ä¸ªéå¶å­èŠ‚ç‚¹çš„æƒå€¼ï¼Œéƒ½ä¸å¤§äºå…¶å·¦å³å­èŠ‚ç‚¹çš„æƒå€¼ï¼Œè¿™æ ·ä¿è¯äº†é˜Ÿåˆ—çš„é¡¶éƒ¨å…ƒç´ ï¼ˆå †é¡¶ï¼‰ä¸€å®šæ˜¯ä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ ã€‚

å®Œå…¨äºŒå‰æ ‘ï¼ˆComplete Binary Treeï¼‰æ˜¯ä¸€ç§äºŒå‰æ ‘ï¼Œå…¶ä¸­é™¤äº†æœ€åä¸€å±‚ï¼Œå…¶ä»–å±‚çš„èŠ‚ç‚¹æ•°éƒ½æ˜¯æ»¡çš„ï¼Œæœ€åä¸€å±‚çš„èŠ‚ç‚¹éƒ½é å·¦å¯¹é½ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘çš„ç¤ºæ„å›¾ï¼š

```
        1
      /   \
     2     3
    / \   /
   4   5 6
```

å †æ˜¯ä¸€ç§å®Œå…¨äºŒå‰æ ‘ï¼Œå †çš„ç‰¹ç‚¹æ˜¯æ ¹èŠ‚ç‚¹çš„å€¼æœ€å°ï¼ˆå°é¡¶å †ï¼‰æˆ–æœ€å¤§ï¼ˆå¤§é¡¶å †ï¼‰ï¼Œå¹¶ä¸”ä»»æ„éæ ¹èŠ‚ç‚¹içš„å€¼éƒ½ä¸å¤§äºï¼ˆæˆ–ä¸å°äºï¼‰å…¶çˆ¶èŠ‚ç‚¹çš„å€¼ã€‚

è¿™æ˜¯ä¸€é¢—åŒ…å«æ•´æ•° 1, 2, 3, 4, 5, 6, 7 çš„å°é¡¶å †ï¼š

```
      1
     / \
    2   3
   / \ / \
  4  5 6  7
```

è¿™æ˜¯ä¸€é¢—å¤§é¡¶å †ã€‚

```
            8
          /   \
         7     5
        / \   / \
       6   4 2   1
```

å› ä¸ºå®Œå…¨äºŒå‰æ ‘çš„ç»“æ„æ¯”è¾ƒè§„åˆ™ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨æ•°ç»„æ¥å­˜å‚¨å †çš„å…ƒç´ ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨æŒ‡é’ˆç­‰é¢å¤–çš„ç©ºé—´ã€‚

åœ¨å †ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹æ ‡å’Œå…¶åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå‡è®¾èŠ‚ç‚¹ä¸‹æ ‡ä¸ºiï¼Œåˆ™å…¶çˆ¶èŠ‚ç‚¹ä¸‹æ ‡ä¸ºi/2ï¼Œå…¶å·¦å­èŠ‚ç‚¹ä¸‹æ ‡ä¸º2iï¼Œå…¶å³å­èŠ‚ç‚¹ä¸‹æ ‡ä¸º2i+1ã€‚

å‡è®¾æœ‰ä¸€ä¸ªæ•°ç»„arr=[10, 20, 15, 30, 40]ï¼Œç°åœ¨è¦å°†å…¶è½¬åŒ–ä¸ºä¸€ä¸ªå°é¡¶å †ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å°†æ•°ç»„æŒ‰ç…§å®Œå…¨äºŒå‰æ ‘çš„å½¢å¼æ’åˆ—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

```
      10
     /  \
   20    15
  /  \
30   40
```

ä»ä¸Šå¾€ä¸‹ã€ä»å·¦å¾€å³ä¾æ¬¡ç»™æ¯ä¸ªèŠ‚ç‚¹ç¼–å·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```
      1
     / \
    2   3
   / \
  4   5
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŒ‰ç…§ä¸Šè¿°å…¬å¼ï¼Œä¾æ¬¡ç¡®å®šæ¯ä¸ªèŠ‚ç‚¹åœ¨æ•°ç»„ä¸­çš„ä½ç½®ã€‚ä¾‹å¦‚ï¼ŒèŠ‚ç‚¹1çš„çˆ¶èŠ‚ç‚¹ä¸‹æ ‡ä¸º1/2=0ï¼Œå·¦å­èŠ‚ç‚¹ä¸‹æ ‡ä¸º2\*1=2ï¼Œå³å­èŠ‚ç‚¹ä¸‹æ ‡ä¸º2\*1+1=3ï¼Œå› æ­¤èŠ‚ç‚¹1åœ¨æ•°ç»„ä¸­çš„ä½ç½®ä¸º0ï¼ŒèŠ‚ç‚¹2åœ¨æ•°ç»„ä¸­çš„ä½ç½®ä¸º2ï¼ŒèŠ‚ç‚¹3åœ¨æ•°ç»„ä¸­çš„ä½ç½®ä¸º3ã€‚

å¯¹åº”çš„æ•°ç»„ä¸º[10, 20, 15, 30, 40]ï¼Œç¬¦åˆå°é¡¶å †çš„å®šä¹‰ï¼Œå³æ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å°äºæˆ–ç­‰äºå…¶å­èŠ‚ç‚¹çš„å€¼ã€‚

å¥½ï¼Œæˆ‘ä»¬ç”»å¹…å›¾å†æ¥ç†è§£ä¸€ä¸‹ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/PriorityQueue-8dca2f55-a7c7-49e1-95a5-df1a34f2aef5.png)

ä¸Šå›¾ä¸­æˆ‘ä»¬ç»™æ¯ä¸ªå…ƒç´ æŒ‰ç…§å±‚åºéå†çš„æ–¹å¼è¿›è¡Œäº†ç¼–å·ï¼Œå¦‚æœä½ è¶³å¤Ÿç»†å¿ƒï¼Œä¼šå‘ç°çˆ¶èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹çš„ç¼–å·æ˜¯æœ‰è”ç³»çš„ï¼Œæ›´ç¡®åˆ‡çš„è¯´çˆ¶å­èŠ‚ç‚¹çš„ç¼–å·ä¹‹é—´æœ‰å¦‚ä¸‹å…³ç³»ï¼š

```
leftNo = parentNo\*2+1

rightNo = parentNo\*2+2

parentNo = (nodeNo-1)/2
```

é€šè¿‡ä¸Šè¿°ä¸‰ä¸ªå…¬å¼ï¼Œå¯ä»¥è½»æ˜“è®¡ç®—å‡ºæŸä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä»¥åŠå­èŠ‚ç‚¹çš„ä¸‹æ ‡ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå¯ä»¥ç›´æ¥ç”¨æ•°ç»„æ¥å­˜å‚¨å †çš„åŸå› ã€‚

### æ–¹æ³•å‰–æ

#### add()å’Œ offer()

`add(E e)`å’Œ`offer(E e)`çš„è¯­ä¹‰ç›¸åŒï¼Œéƒ½æ˜¯å‘ä¼˜å…ˆé˜Ÿåˆ—ä¸­æ’å…¥å…ƒç´ ï¼Œåªæ˜¯`Queue`æ¥å£è§„å®šäºŒè€…å¯¹æ’å…¥å¤±è´¥æ—¶çš„å¤„ç†ä¸åŒï¼Œå‰è€…åœ¨æ’å…¥å¤±è´¥æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œååˆ™åˆ™ä¼šè¿”å›`false`ã€‚å¯¹äº*PriorityQueue*è¿™ä¸¤ä¸ªæ–¹æ³•å…¶å®æ²¡ä»€ä¹ˆå·®åˆ«ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/PriorityQueue-0fb89aa7-c8fa-4fad-adbb-40c61c3bb0e9.png)

æ–°åŠ å…¥çš„å…ƒç´ å¯èƒ½ä¼šç ´åå°é¡¶å †çš„æ€§è´¨ï¼Œå› æ­¤éœ€è¦è¿›è¡Œå¿…è¦çš„è°ƒæ•´ã€‚

```Java
//offer(E e)
public boolean offer(E e) {
    if (e == null)//ä¸å…è®¸æ”¾å…¥nullå…ƒç´ 
        throw new NullPointerException();
    modCount++;
    int i = size;
    if (i >= queue.length)
        grow(i + 1);//è‡ªåŠ¨æ‰©å®¹
    size = i + 1;
    if (i == 0)//é˜Ÿåˆ—åŸæ¥ä¸ºç©ºï¼Œè¿™æ˜¯æ’å…¥çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
        queue[0] = e;
    else
        siftUp(i, e);//è°ƒæ•´
    return true;
}
```

ä¸Šè¿°ä»£ç ä¸­ï¼Œæ‰©å®¹å‡½æ•°`grow()`ç±»ä¼¼äº`ArrayList`é‡Œçš„`grow()`å‡½æ•°ï¼Œå°±æ˜¯å†ç”³è¯·ä¸€ä¸ªæ›´å¤§çš„æ•°ç»„ï¼Œå¹¶å°†åŸæ•°ç»„çš„å…ƒç´ å¤åˆ¶è¿‡å»ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯`siftUp(int k, E x)`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºæ’å…¥å…ƒç´ `x`å¹¶ç»´æŒå †çš„ç‰¹æ€§ã€‚

```Java
//siftUp()
private void siftUp(int k, E x) {
    while (k > 0) {
        int parent = (k - 1) >>> 1;//parentNo = (nodeNo-1)/2
        Object e = queue[parent];
        if (comparator.compare(x, (E) e) >= 0)//è°ƒç”¨æ¯”è¾ƒå™¨çš„æ¯”è¾ƒæ–¹æ³•
            break;
        queue[k] = e;
        k = parent;
    }
    queue[k] = x;
}
```

è°ƒæ•´çš„è¿‡ç¨‹ä¸ºï¼š**ä»`k`æŒ‡å®šçš„ä½ç½®å¼€å§‹ï¼Œå°†`x`é€å±‚ä¸å½“å‰ç‚¹çš„`parent`è¿›è¡Œæ¯”è¾ƒå¹¶äº¤æ¢ï¼Œç›´åˆ°æ»¡è¶³`x >= queue[parent]`ä¸ºæ­¢**ã€‚æ³¨æ„è¿™é‡Œçš„æ¯”è¾ƒå¯ä»¥æ˜¯å…ƒç´ çš„è‡ªç„¶é¡ºåºï¼Œä¹Ÿå¯ä»¥æ˜¯ä¾é æ¯”è¾ƒå™¨çš„é¡ºåºã€‚

#### element()å’Œ peek()

`element()`å’Œ`peek()`çš„è¯­ä¹‰å®Œå…¨ç›¸åŒï¼Œéƒ½æ˜¯è·å–ä½†ä¸åˆ é™¤é˜Ÿé¦–å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯é˜Ÿåˆ—ä¸­æƒå€¼æœ€å°çš„é‚£ä¸ªå…ƒç´ ï¼ŒäºŒè€…å”¯ä¸€çš„åŒºåˆ«æ˜¯å½“æ–¹æ³•å¤±è´¥æ—¶å‰è€…æŠ›å‡ºå¼‚å¸¸ï¼Œåè€…è¿”å›`null`ã€‚æ ¹æ®å°é¡¶å †çš„æ€§è´¨ï¼Œå †é¡¶é‚£ä¸ªå…ƒç´ å°±æ˜¯å…¨å±€æœ€å°çš„é‚£ä¸ªï¼›ç”±äºå †ç”¨æ•°ç»„è¡¨ç¤ºï¼Œæ ¹æ®ä¸‹æ ‡å…³ç³»ï¼Œ`0`ä¸‹æ ‡å¤„çš„é‚£ä¸ªå…ƒç´ æ—¢æ˜¯å †é¡¶å…ƒç´ ã€‚æ‰€ä»¥**ç›´æ¥è¿”å›æ•°ç»„`0`ä¸‹æ ‡å¤„çš„é‚£ä¸ªå…ƒç´ å³å¯**ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/PriorityQueue-5059f157-845e-4d1c-b993-5cfe539d5607.png)

ä»£ç ä¹Ÿå°±éå¸¸ç®€æ´ï¼š

```Java
//peek()
public E peek() {
    if (size == 0)
        return null;
    return (E) queue[0];//0ä¸‹æ ‡å¤„çš„é‚£ä¸ªå…ƒç´ å°±æ˜¯æœ€å°çš„é‚£ä¸ª
}
```

#### remove()å’Œ poll()

`remove()`å’Œ`poll()`æ–¹æ³•çš„è¯­ä¹‰ä¹Ÿå®Œå…¨ç›¸åŒï¼Œéƒ½æ˜¯è·å–å¹¶åˆ é™¤é˜Ÿé¦–å…ƒç´ ï¼ŒåŒºåˆ«æ˜¯å½“æ–¹æ³•å¤±è´¥æ—¶å‰è€…æŠ›å‡ºå¼‚å¸¸ï¼Œåè€…è¿”å›`null`ã€‚ç”±äºåˆ é™¤æ“ä½œä¼šæ”¹å˜é˜Ÿåˆ—çš„ç»“æ„ï¼Œä¸ºç»´æŠ¤å°é¡¶å †çš„æ€§è´¨ï¼Œéœ€è¦è¿›è¡Œå¿…è¦çš„è°ƒæ•´ã€‚

![PriorityQueue_poll.png](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/PriorityQueue-e25ba931-2e6f-4c17-84b8-9b959733d541.png)

ä»£ç å¦‚ä¸‹ï¼š

```Java
public E poll() {
    if (size == 0)
        return null;
    int s = --size;
    modCount++;
    E result = (E) queue[0];//0ä¸‹æ ‡å¤„çš„é‚£ä¸ªå…ƒç´ å°±æ˜¯æœ€å°çš„é‚£ä¸ª
    E x = (E) queue[s];
    queue[s] = null;
    if (s != 0)
        siftDown(0, x);//è°ƒæ•´
    return result;
}
```

ä¸Šè¿°ä»£ç é¦–å…ˆè®°å½•`0`ä¸‹æ ‡å¤„çš„å…ƒç´ ï¼Œå¹¶ç”¨æœ€åä¸€ä¸ªå…ƒç´ æ›¿æ¢`0`ä¸‹æ ‡ä½ç½®çš„å…ƒç´ ï¼Œä¹‹åè°ƒç”¨`siftDown()`æ–¹æ³•å¯¹å †è¿›è¡Œè°ƒæ•´ï¼Œæœ€åè¿”å›åŸæ¥`0`ä¸‹æ ‡å¤„çš„é‚£ä¸ªå…ƒç´ ï¼ˆä¹Ÿå°±æ˜¯æœ€å°çš„é‚£ä¸ªå…ƒç´ ï¼‰ã€‚é‡ç‚¹æ˜¯`siftDown(int k, E x)`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯**ä»`k`æŒ‡å®šçš„ä½ç½®å¼€å§‹ï¼Œå°†`x`é€å±‚å‘ä¸‹ä¸å½“å‰ç‚¹çš„å·¦å³å­©å­ä¸­è¾ƒå°çš„é‚£ä¸ªäº¤æ¢ï¼Œç›´åˆ°`x`å°äºæˆ–ç­‰äºå·¦å³å­©å­ä¸­çš„ä»»ä½•ä¸€ä¸ªä¸ºæ­¢**ã€‚

```Java
//siftDown()
private void siftDown(int k, E x) {
    int half = size >>> 1;
    while (k < half) {
      //é¦–å…ˆæ‰¾åˆ°å·¦å³å­©å­ä¸­è¾ƒå°çš„é‚£ä¸ªï¼Œè®°å½•åˆ°cé‡Œï¼Œå¹¶ç”¨childè®°å½•å…¶ä¸‹æ ‡
        int child = (k << 1) + 1;//leftNo = parentNo*2+1
        Object c = queue[child];
        int right = child + 1;
        if (right < size &&
            comparator.compare((E) c, (E) queue[right]) > 0)
            c = queue[child = right];
        if (comparator.compare(x, (E) c) <= 0)
            break;
        queue[k] = c;//ç„¶åç”¨cå–ä»£åŸæ¥çš„å€¼
        k = child;
    }
    queue[k] = x;
}
```

#### remove(Object o)

`remove(Object o)`æ–¹æ³•ç”¨äºåˆ é™¤é˜Ÿåˆ—ä¸­è·Ÿ`o`ç›¸ç­‰çš„æŸä¸€ä¸ªå…ƒç´ ï¼ˆå¦‚æœæœ‰å¤šä¸ªç›¸ç­‰ï¼Œåªåˆ é™¤ä¸€ä¸ªï¼‰ï¼Œè¯¥æ–¹æ³•ä¸æ˜¯*Queue*æ¥å£å†…çš„æ–¹æ³•ï¼Œè€Œæ˜¯*Collection*æ¥å£çš„æ–¹æ³•ã€‚ç”±äºåˆ é™¤æ“ä½œä¼šæ”¹å˜é˜Ÿåˆ—ç»“æ„ï¼Œæ‰€ä»¥è¦è¿›è¡Œè°ƒæ•´ï¼›åˆç”±äºåˆ é™¤å…ƒç´ çš„ä½ç½®å¯èƒ½æ˜¯ä»»æ„çš„ï¼Œæ‰€ä»¥è°ƒæ•´è¿‡ç¨‹æ¯”å…¶å®ƒæ–¹æ³•ç¨åŠ ç¹çã€‚

å…·ä½“æ¥è¯´ï¼Œ`remove(Object o)`å¯ä»¥åˆ†ä¸º 2 ç§æƒ…å†µï¼š

1. åˆ é™¤çš„æ˜¯æœ€åä¸€ä¸ªå…ƒç´ ã€‚ç›´æ¥åˆ é™¤å³å¯ï¼Œä¸éœ€è¦è°ƒæ•´ã€‚
2. åˆ é™¤çš„ä¸æ˜¯æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä»åˆ é™¤ç‚¹å¼€å§‹ä»¥æœ€åä¸€ä¸ªå…ƒç´ ä¸ºå‚ç…§è°ƒç”¨ä¸€æ¬¡`siftDown()`å³å¯ã€‚æ­¤å¤„ä¸å†èµ˜è¿°ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/collection/PriorityQueue-ed0d08d3-b38e-44a1-a710-ee7a01afda62.png)

å…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```Java
//remove(Object o)
public boolean remove(Object o) {
  //é€šè¿‡éå†æ•°ç»„çš„æ–¹å¼æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³o.equals(queue[i])å…ƒç´ çš„ä¸‹æ ‡
    int i = indexOf(o);
    if (i == -1)
        return false;
    int s = --size;
    if (s == i) //æƒ…å†µ1
        queue[i] = null;
    else {
        E moved = (E) queue[s];
        queue[s] = null;
        siftDown(i, moved);//æƒ…å†µ2
        ......
    }
    return true;
}
```

### å°ç»“

PriorityQueue æ˜¯ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„å †ï¼ˆHeapï¼‰å®ç°ï¼Œå¯ä»¥ç”¨æ¥é«˜æ•ˆåœ°ç»´æŠ¤ä¸€ä¸ªæœ‰åºçš„é›†åˆã€‚

- å®ƒçš„åº•å±‚å®ç°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé€šè¿‡å †çš„æ€§è´¨æ¥ç»´æŠ¤å…ƒç´ çš„é¡ºåºã€‚
- å–å‡ºå…ƒç´ æ—¶æŒ‰ç…§ä¼˜å…ˆçº§é¡ºåºï¼ˆä»å°åˆ°å¤§æˆ–è€…ä»å¤§åˆ°å°ï¼‰è¿›è¡Œå–å‡ºã€‚
- å¦‚æœéœ€è¦æŒ‡å®šæ’åºï¼Œå…ƒç´ å¿…é¡»å®ç° Comparable æ¥å£æˆ–è€…ä¼ å…¥ä¸€ä¸ª Comparator æ¥è¿›è¡Œæ¯”è¾ƒã€‚

> å‚è€ƒé“¾æ¥ï¼š[https://github.com/CarpenterLee/JCFInternals](https://github.com/CarpenterLee/JCFInternals)ï¼Œä½œè€…ï¼šæè±ªï¼Œæ•´ç†ï¼šæ²‰é»˜ç‹äºŒ



----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 6.14 Comparableå’ŒComparatorçš„åŒºåˆ«

>åœ¨å‰é¢å­¦ä¹ [ä¼˜å…ˆçº§é˜Ÿåˆ—](https://tobebetterjavaer.com/collection/PriorityQueue.html)çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ›¾æåˆ°è¿‡ Comparableå’ŒComparatorï¼Œé‚£è¿™ç¯‡ç»§ç»­ä»¥é¢è¯•å®˜çš„è§’åº¦å»åˆ‡å…¥ï¼Œä¸€èµ·æ¥çœ‹ã€‚

é‚£å¤©ï¼Œå°äºŒå»é©¬èœ‚çªé¢è¯•ï¼Œé¢è¯•å®˜è€ç‹ä¸€ä¸Šæ¥å°±ç”©ç»™äº†ä»–ä¸€é“é¢è¯•é¢˜ï¼šè¯·é—®Comparableå’ŒComparatoræœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå°äºŒå·®ç‚¹ç¬‘å‡ºå£°ï¼Œå› ä¸ºä¸‰å¹´å‰ï¼Œä¹Ÿå°±æ˜¯ 2021 å¹´ï¼Œä»–åœ¨ã€Š[äºŒå“¥çš„Javaè¿›é˜¶ä¹‹è·¯](https://tobebetterjavaer.com/basic-extra-meal/comparable-omparator.html)ã€‹ä¸Šçœ‹åˆ°è¿‡è¿™é¢˜ğŸ˜†ã€‚

Comparable å’Œ Comparator æ˜¯ Java çš„ä¸¤ä¸ªæ¥å£ï¼Œä»åå­—ä¸Šæˆ‘ä»¬å°±èƒ½å¤Ÿè¯»å‡ºæ¥å®ƒä»¬ä¿©çš„ç›¸ä¼¼æ€§ï¼šä»¥æŸç§æ–¹å¼æ¥æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ã€‚

ä½†å®ƒä»¬ä¹‹é—´åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿè¯·éšæˆ‘æ¥ï¼Œæ‰“æ€ªè¿›é˜¶å–½ï¼

### 01ã€Comparable

Comparable æ¥å£çš„å®šä¹‰éå¸¸ç®€å•ï¼Œæºç å¦‚ä¸‹æ‰€ç¤ºã€‚

```java
public interface Comparable<T> {
    int compareTo(T t);
}
```

å¦‚æœä¸€ä¸ªç±»å®ç°äº† Comparable æ¥å£ï¼ˆåªéœ€è¦å¹²ä¸€ä»¶äº‹ï¼Œé‡å†™ `compareTo()` æ–¹æ³•ï¼‰ï¼Œå°±å¯ä»¥æŒ‰ç…§è‡ªå·±åˆ¶å®šçš„è§„åˆ™å°†ç”±å®ƒåˆ›å»ºçš„å¯¹è±¡è¿›è¡Œæ¯”è¾ƒã€‚ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¾‹å­ã€‚

```java
public class Cmower implements Comparable<Cmower> {
    private int age;
    private String name;

    public Cmower(int age, String name) {
        this.age = age;
        this.name = name;
    }

    @Override
    public int compareTo(Cmower o) {
        return this.getAge() - o.getAge();
    }

    public static void main(String[] args) {
        Cmower wanger = new Cmower(19,"æ²‰é»˜ç‹äºŒ");
        Cmower wangsan = new Cmower(16,"æ²‰é»˜ç‹ä¸‰");

        if (wanger.compareTo(wangsan) < 0) {
            System.out.println(wanger.getName() + "æ¯”è¾ƒå¹´è½»æœ‰ä¸º");
        } else {
            System.out.println(wangsan.getName() + "æ¯”è¾ƒå¹´è½»æœ‰ä¸º");
        }
    }
}
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ª Cmower ç±»ï¼Œå®ƒæœ‰ä¸¤ä¸ªå­—æ®µï¼šage å’Œ nameã€‚Cmower ç±»å®ç°äº† Comparable æ¥å£ï¼Œå¹¶é‡å†™äº† `compareTo()` æ–¹æ³•ã€‚

ç¨‹åºè¾“å‡ºçš„ç»“æœæ˜¯â€œæ²‰é»˜ç‹ä¸‰æ¯”è¾ƒå¹´è½»æœ‰ä¸ºâ€ï¼Œå› ä¸ºä»–æ¯”æ²‰é»˜ç‹äºŒå°ä¸‰å²ã€‚è¿™ä¸ªç»“æœæœ‰ä»€ä¹ˆå‡­è¯å—ï¼Ÿ

å‡­è¯å°±åœ¨äº `compareTo()` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„è¿”å›å€¼å¯èƒ½ä¸ºè´Ÿæ•°ï¼Œé›¶æˆ–è€…æ­£æ•°ï¼Œä»£è¡¨çš„æ„æ€æ˜¯è¯¥å¯¹è±¡æŒ‰ç…§æ’åºçš„è§„åˆ™å°äºã€ç­‰äºæˆ–è€…å¤§äºè¦æ¯”è¾ƒçš„å¯¹è±¡ã€‚å¦‚æœæŒ‡å®šå¯¹è±¡çš„ç±»å‹ä¸æ­¤å¯¹è±¡ä¸èƒ½è¿›è¡Œæ¯”è¾ƒï¼Œåˆ™å¼•å‘ `ClassCastException` å¼‚å¸¸ï¼ˆè‡ªä»æœ‰äº†[æ³›å‹](https://tobebetterjavaer.com/basic-extra-meal/generic.html)ï¼Œè¿™ç§æƒ…å†µå°±å°‘æœ‰å‘ç”Ÿäº†ï¼‰ã€‚

### 02ã€Comparator

Comparator æ¥å£çš„å®šä¹‰ç›¸æ¯”è¾ƒäº Comparable å°±å¤æ‚çš„å¤šäº†ï¼Œä¸è¿‡ï¼Œæ ¸å¿ƒçš„æ–¹æ³•åªæœ‰ä¸¤ä¸ªï¼Œæ¥çœ‹ä¸€ä¸‹æºç ã€‚

```java
public interface Comparator<T> {
    int compare(T o1, T o2);
    boolean equals(Object obj);
}
```

ç¬¬ä¸€ä¸ªæ–¹æ³• `compare(T o1, T o2)` çš„è¿”å›å€¼å¯èƒ½ä¸ºè´Ÿæ•°ï¼Œé›¶æˆ–è€…æ­£æ•°ï¼Œä»£è¡¨çš„æ„æ€æ˜¯ç¬¬ä¸€ä¸ªå¯¹è±¡å°äºã€ç­‰äºæˆ–è€…å¤§äºç¬¬äºŒä¸ªå¯¹è±¡ã€‚

ç¬¬äºŒä¸ªæ–¹æ³• `equals(Object obj)` éœ€è¦ä¼ å…¥ä¸€ä¸ª Object ä½œä¸ºå‚æ•°ï¼Œå¹¶åˆ¤æ–­è¯¥ Object æ˜¯å¦å’Œ Comparator ä¿æŒä¸€è‡´ã€‚

æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³è®©ç±»ä¿æŒå®ƒçš„åŸè²Œï¼Œä¸æƒ³ä¸»åŠ¨å®ç° Comparable æ¥å£ï¼Œä½†æˆ‘ä»¬åˆéœ€è¦å®ƒä»¬ä¹‹é—´è¿›è¡Œæ¯”è¾ƒï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

Comparator å°±æ´¾ä¸Šç”¨åœºäº†ï¼Œæ¥çœ‹ä¸€ä¸‹ç¤ºä¾‹ã€‚

#### 1ï¼‰åŸå°ä¸åŠ¨çš„ Cmower ç±»ã€‚

```java
public class Cmower  {
    private int age;
    private String name;

    public Cmower(int age, String name) {
        this.age = age;
        this.name = name;
    }
}
```

Cmower ç±»æœ‰ä¸¤ä¸ªå­—æ®µï¼šage å’Œ nameï¼Œæ„å‘³ç€è¯¥ç±»å¯ä»¥æŒ‰ç…§ age æˆ–è€… name è¿›è¡Œæ’åºã€‚

#### 2ï¼‰å†æ¥çœ‹ Comparator æ¥å£çš„å®ç°ç±»ã€‚

```java
public class CmowerComparator implements Comparator<Cmower> {
    @Override
    public int compare(Cmower o1, Cmower o2) {
        return o1.getAge() - o2.getAge();
    }
}
```

æŒ‰ç…§ age è¿›è¡Œæ¯”è¾ƒã€‚å½“ç„¶ä¹Ÿå¯ä»¥å†å®ç°ä¸€ä¸ªæ¯”è¾ƒå™¨ï¼ŒæŒ‰ç…§ name è¿›è¡Œè‡ªç„¶æ’åºï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚

```java
public class CmowerNameComparator implements Comparator<Cmower> {
    @Override
    public int compare(Cmower o1, Cmower o2) {
        if (o1.getName().hashCode() < o2.getName().hashCode()) {
            return -1;
        } else if (o1.getName().hashCode() == o2.getName().hashCode()) {
            return 0;
        }
        return 1;
    }
}
```

#### 3ï¼‰å†æ¥çœ‹æµ‹è¯•ç±»ã€‚

```java
Cmower wanger = new Cmower(19,"æ²‰é»˜ç‹äºŒ");
Cmower wangsan = new Cmower(16,"æ²‰é»˜ç‹ä¸‰");
Cmower wangyi = new Cmower(28,"æ²‰é»˜ç‹ä¸€");

List<Cmower> list = new ArrayList<>();
list.add(wanger);
list.add(wangsan);
list.add(wangyi);

list.sort(new CmowerComparator());

for (Cmower c : list) {
    System.out.println(c.getName());
}
```

åˆ›å»ºäº†ä¸‰ä¸ªå¯¹è±¡ï¼Œage ä¸åŒï¼Œname ä¸åŒï¼Œå¹¶æŠŠå®ƒä»¬åŠ å…¥åˆ°äº† List å½“ä¸­ã€‚ç„¶åä½¿ç”¨ List çš„ `sort()` æ–¹æ³•è¿›è¡Œæ’åºï¼Œæ¥çœ‹ä¸€ä¸‹è¾“å‡ºçš„ç»“æœã€‚

```
æ²‰é»˜ç‹ä¸‰
æ²‰é»˜ç‹äºŒ
æ²‰é»˜ç‹ä¸€
```

è¿™æ„å‘³ç€æ²‰é»˜ç‹ä¸‰çš„å¹´çºªæ¯”æ²‰é»˜ç‹äºŒå°ï¼Œæ’åœ¨ç¬¬ä¸€ä½ï¼›æ²‰é»˜ç‹ä¸€çš„å¹´çºªæ¯”æ²‰é»˜ç‹äºŒå¤§ï¼Œæ’åœ¨ç¬¬ä¸‰ä½ã€‚å’Œæˆ‘ä»¬çš„é¢„æœŸå®Œå…¨ç¬¦åˆã€‚

å€Ÿæ­¤æœºä¼šï¼Œå†æ¥çœ‹ä¸€ä¸‹ sort æ–¹æ³•çš„æºç ï¼š

```java
public void sort(Comparator<? super E> c) {
    // ä¿å­˜å½“å‰é˜Ÿåˆ—çš„ modCount å€¼ï¼Œç”¨äºæ£€æµ‹ sort æ“ä½œæ˜¯å¦éæ³•
    final int expectedModCount = modCount;
    // è°ƒç”¨ Arrays.sort å¯¹ elementData æ•°ç»„è¿›è¡Œæ’åºï¼Œä½¿ç”¨ä¼ å…¥çš„æ¯”è¾ƒå™¨ c
    Arrays.sort((E[]) elementData, 0, size, c);
    // æ£€æŸ¥æ“ä½œæœŸé—´ modCount æ˜¯å¦è¢«ä¿®æ”¹ï¼Œå¦‚æœè¢«ä¿®æ”¹åˆ™æŠ›å‡ºå¹¶å‘ä¿®æ”¹å¼‚å¸¸
    if (modCount != expectedModCount) {
        throw new ConcurrentModificationException();
    }
    // å¢åŠ  modCount å€¼ï¼Œè¡¨ç¤ºé˜Ÿåˆ—å·²ç»è¢«ä¿®æ”¹è¿‡
    modCount++;
}
```

å¯ä»¥çœ‹åˆ°ï¼Œå‚æ•°å°±æ˜¯ä¸€ä¸ª Comparator æ¥å£ï¼Œå¹¶ä¸”ä½¿ç”¨äº†[æ³›å‹](https://tobebetterjavaer.com/basic-extra-meal/generic.html) `Comparator<? super E> c`ã€‚

### 03ã€åˆ°åº•è¯¥ç”¨å“ªä¸€ä¸ªï¼Ÿ

é€šè¿‡ä¸Šé¢çš„ä¸¤ä¸ªä¾‹å­å¯ä»¥æ¯”è¾ƒå‡º Comparable å’Œ Comparator ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«ï¼š

- ä¸€ä¸ªç±»å®ç°äº† Comparable æ¥å£ï¼Œæ„å‘³ç€è¯¥ç±»çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¿›è¡Œæ¯”è¾ƒï¼ˆæ’åºï¼‰ï¼Œä½†æ¯”è¾ƒï¼ˆæ’åºï¼‰çš„æ–¹å¼åªæœ‰ä¸€ç§ï¼Œå¾ˆå•ä¸€ã€‚
- ä¸€ä¸ªç±»å¦‚æœæƒ³è¦ä¿æŒåŸæ ·ï¼Œåˆéœ€è¦è¿›è¡Œä¸åŒæ–¹å¼çš„æ¯”è¾ƒï¼ˆæ’åºï¼‰ï¼Œå°±å¯ä»¥å®šåˆ¶æ¯”è¾ƒå™¨ï¼ˆå®ç° Comparator æ¥å£ï¼‰ã€‚
- Comparable æ¥å£åœ¨ `java.lang` åŒ…ä¸‹ï¼Œè€Œ `Comparator` æ¥å£åœ¨ `java.util` åŒ…ä¸‹ï¼Œç®—ä¸ä¸Šæ˜¯äº²å…„å¼Ÿï¼Œä½†å¯ä»¥ç§°å¾—ä¸Šæ˜¯è¡¨ï¼ˆå ‚ï¼‰å…„å¼Ÿã€‚

ä¸¾ä¸ªä¸æ°å½“çš„ä¾‹å­ã€‚æˆ‘æƒ³ä»æ´›é˜³å‡ºå‘å»åŒ—äº¬çœ‹é•¿åŸï¼Œä½“éªŒä¸€ä¸‹å¥½æ±‰çš„æ„Ÿè§‰ï¼Œè¦ä¹ˆåé£æœºï¼Œè¦ä¹ˆåé«˜é“ï¼›ä½†å¦‚æœæ˜¯å­™æ‚Ÿç©ºçš„è¯ï¼Œç¿»ä¸ªç­‹æ–—å°±åˆ°äº†ã€‚æˆ‘å’Œå­™æ‚Ÿç©ºä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ

å­™æ‚Ÿç©ºè‡ªå·±å®ç°äº† Comparable æ¥å£ï¼ˆä»–é‚£å¹´ä»£ä¹Ÿæ²¡æœ‰é£æœºå’Œé«˜é“ï¼Œæ²¡å¾—é€‰ï¼‰ï¼Œè€Œæˆ‘å¯ä»¥å€ŸåŠ© Comparator æ¥å£ï¼ˆç°ä»£åŒ–çš„äº¤é€šå·¥å…·ï¼‰ã€‚

å¥½äº†ï¼Œå…³äº Comparable å’Œ Comparator æˆ‘ä»¬å°±å…ˆèŠè¿™ä¹ˆå¤šã€‚æ€»è€Œè¨€ä¹‹ï¼Œå¦‚æœå¯¹è±¡çš„æ’åºéœ€è¦åŸºäºè‡ªç„¶é¡ºåºï¼Œè¯·é€‰æ‹© `Comparable`ï¼Œå¦‚æœéœ€è¦æŒ‰ç…§å¯¹è±¡çš„ä¸åŒå±æ€§è¿›è¡Œæ’åºï¼Œè¯·é€‰æ‹© `Comparator`ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

# ç¬¬ä¸ƒç« ï¼šJava IO



## 7.1 IO åˆ†ç±»

â€œè€ç‹ï¼ŒJava IO ä¹Ÿå¤ªä¸Šå¤´äº†å§ï¼Ÿâ€æ–°å…µè›‹å­å°äºŒå‘å¤´é¡¶å¾ˆå‡‰å¿«çš„è€ç‹æŠ±æ€¨é“ï¼Œâ€œä½ ç§ï¼Œæˆ‘å°±æŒ‰ç…§ä¼ è¾“æ–¹å¼å¯¹ IO è¿›è¡Œäº†ä¸€ä¸ªç®€å•çš„åˆ†ç±»ï¼Œå°±èƒ½æå‡ºæ¥è¿™ä¹ˆå¤šçš„ç©æ„ï¼â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/io/shangtou-01.png)

å¥½ä¹…æ²¡æè¿‡ IO äº†ï¼Œè€ç‹çœ‹åˆ°è¿™å¹…æ€ç»´å¯¼å›¾ä¹Ÿæ˜¯åƒäº†ä¸€æƒŠã€‚æƒ³æƒ³ä¹Ÿæ˜¯ï¼Œä»–å½“åˆå­¦ä¹  Java IO çš„æ—¶å€™å¤´ä¹Ÿå¤§ï¼Œä¹Œå¤®ä¹Œå¤®çš„ä¸€ç‰‡ï¼Œå…¨æ˜¯ç±»ï¼Œä¼°è®¡æ˜¯æ‰€æœ‰ Java åŒ…é‡Œé¢ç±»æœ€å¤šçš„ï¼Œä¸€ä¼šæ˜¯ Input ä¸€ä¼šæ˜¯ Outputï¼Œä¸€ä¼šæ˜¯ Reader ä¸€ä¼šæ˜¯ Writerï¼ŒçœŸä¸çŸ¥é“ Java çš„è®¾è®¡è€…æ˜¯æ€ä¹ˆæƒ³çš„ã€‚

çœ‹ç€è‚ºéƒ½å¿«è¦æ°”ç‚¸çš„å°äºŒï¼Œè€ç‹æ·±æ·±åœ°å¸äº†ä¸€å£æ°”ï¼Œè€å¿ƒåœ°å¯¹å°äºŒè¯´ï¼šâ€œä¸»è¦æ˜¯ Java çš„è®¾è®¡è€…è€ƒè™‘å¾—æ¯”è¾ƒå¤šå§ï¼Œæ‰€ä»¥ IO ç»™äººä¸€ç§å¾ˆä¹±çš„æ„Ÿè§‰ï¼Œæˆ‘æ¥ç»™ä½ æ¢³ç†ä¸€ä¸‹ã€‚â€

### 00ã€åˆè¯† Java IO

IOï¼Œå³inå’Œoutï¼Œä¹Ÿå°±æ˜¯è¾“å…¥å’Œè¾“å‡ºï¼ŒæŒ‡åº”ç”¨ç¨‹åºå’Œå¤–éƒ¨è®¾å¤‡ä¹‹é—´çš„æ•°æ®ä¼ é€’ï¼Œå¸¸è§çš„å¤–éƒ¨è®¾å¤‡åŒ…æ‹¬æ–‡ä»¶ã€ç®¡é“ã€ç½‘ç»œè¿æ¥ã€‚

Java ä¸­æ˜¯é€šè¿‡æµå¤„ç†IO çš„ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯æµï¼Ÿ

æµï¼ˆStreamï¼‰ï¼Œæ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œæ˜¯æŒ‡ä¸€è¿ä¸²çš„æ•°æ®ï¼ˆå­—ç¬¦æˆ–å­—èŠ‚ï¼‰ï¼Œæ˜¯ä»¥å…ˆè¿›å…ˆå‡ºçš„æ–¹å¼å‘é€ä¿¡æ¯çš„é€šé“ã€‚

å½“ç¨‹åºéœ€è¦è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œå°±ä¼šå¼€å¯ä¸€ä¸ªé€šå‘æ•°æ®æºçš„æµï¼Œè¿™ä¸ªæ•°æ®æºå¯ä»¥æ˜¯æ–‡ä»¶ï¼Œå†…å­˜ï¼Œæˆ–æ˜¯ç½‘ç»œè¿æ¥ã€‚ç±»ä¼¼çš„ï¼Œå½“ç¨‹åºéœ€è¦å†™å…¥æ•°æ®çš„æ—¶å€™ï¼Œå°±ä¼šå¼€å¯ä¸€ä¸ªé€šå‘ç›®çš„åœ°çš„æµã€‚è¿™æ—¶å€™ä½ å°±å¯ä»¥æƒ³è±¡æ•°æ®å¥½åƒåœ¨è¿™å…¶ä¸­â€œæµâ€åŠ¨ä¸€æ ·ã€‚

ä¸€èˆ¬æ¥è¯´å…³äºæµçš„ç‰¹æ€§æœ‰ä¸‹é¢å‡ ç‚¹ï¼š

- å…ˆè¿›å…ˆå‡ºï¼šæœ€å…ˆå†™å…¥è¾“å‡ºæµçš„æ•°æ®æœ€å…ˆè¢«è¾“å…¥æµè¯»å–åˆ°ã€‚
- é¡ºåºå­˜å–ï¼šå¯ä»¥ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°å¾€æµä¸­å†™å…¥ä¸€ä¸²å­—èŠ‚ï¼Œè¯»å‡ºæ—¶ä¹Ÿå°†æŒ‰å†™å…¥é¡ºåºè¯»å–ä¸€ä¸²å­—èŠ‚ï¼Œä¸èƒ½éšæœºè®¿é—®ä¸­é—´çš„æ•°æ®ã€‚ï¼ˆRandomAccessFileé™¤å¤–ï¼‰
- åªè¯»æˆ–åªå†™ï¼šæ¯ä¸ªæµåªèƒ½æ˜¯è¾“å…¥æµæˆ–è¾“å‡ºæµçš„ä¸€ç§ï¼Œä¸èƒ½åŒæ—¶å…·å¤‡ä¸¤ä¸ªåŠŸèƒ½ï¼Œè¾“å…¥æµåªèƒ½è¿›è¡Œè¯»æ“ä½œï¼Œå¯¹è¾“å‡ºæµåªèƒ½è¿›è¡Œå†™æ“ä½œã€‚åœ¨ä¸€ä¸ªæ•°æ®ä¼ è¾“é€šé“ä¸­ï¼Œå¦‚æœæ—¢è¦å†™å…¥æ•°æ®ï¼Œåˆè¦è¯»å–æ•°æ®ï¼Œåˆ™è¦åˆ†åˆ«æä¾›ä¸¤ä¸ªæµã€‚

### 01ã€ä¼ è¾“æ–¹å¼åˆ’åˆ†

å°±æŒ‰ç…§ä½ çš„é‚£å‰¯æ€ç»´å¯¼å›¾æ¥è¯´å§ã€‚

ä¼ è¾“æ–¹å¼æœ‰ä¸¤ç§ï¼Œå­—èŠ‚å’Œå­—ç¬¦ï¼Œé‚£é¦–å…ˆå¾—ææ˜ç™½å­—èŠ‚å’Œå­—ç¬¦æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå¯¹å§ï¼Ÿ

å­—èŠ‚ï¼ˆbyteï¼‰æ˜¯è®¡ç®—æœºä¸­ç”¨æ¥è¡¨ç¤ºå­˜å‚¨å®¹é‡çš„ä¸€ä¸ªè®¡é‡å•ä½ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå­—èŠ‚æœ‰ 8 ä½ï¼ˆbitï¼‰ã€‚

å­—ç¬¦ï¼ˆcharï¼‰å¯ä»¥æ˜¯è®¡ç®—æœºä¸­ä½¿ç”¨çš„å­—æ¯ã€æ•°å­—ã€å’Œç¬¦å·ï¼Œæ¯”å¦‚è¯´ A 1 $ è¿™äº›ã€‚

é€šå¸¸æ¥è¯´ï¼Œä¸€ä¸ªå­—æ¯æˆ–è€…ä¸€ä¸ªå­—ç¬¦å ç”¨ä¸€ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªæ±‰å­—å ç”¨ä¸¤ä¸ªå­—èŠ‚ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/io/shangtou-02.png)

å…·ä½“è¿˜è¦çœ‹å­—ç¬¦ç¼–ç ï¼Œæ¯”å¦‚è¯´åœ¨ UTF-8 ç¼–ç ä¸‹ï¼Œä¸€ä¸ªè‹±æ–‡å­—æ¯ï¼ˆä¸åˆ†å¤§å°å†™ï¼‰ä¸ºä¸€ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªä¸­æ–‡æ±‰å­—ä¸ºä¸‰ä¸ªå­—èŠ‚ï¼›åœ¨ Unicode ç¼–ç ä¸­ï¼Œä¸€ä¸ªè‹±æ–‡å­—æ¯ä¸ºä¸€ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªä¸­æ–‡æ±‰å­—ä¸ºä¸¤ä¸ªå­—èŠ‚ã€‚

>PSï¼šå…³äºå­—ç¬¦ç¼–ç ï¼Œå¯ä»¥çœ‹å‰é¢çš„ç« èŠ‚ï¼š[é”Ÿæ–¤æ‹·](https://tobebetterjavaer.com/basic-extra-meal/java-unicode.html)

æ˜ç™½äº†å­—èŠ‚ä¸å­—ç¬¦çš„åŒºåˆ«ï¼Œå†æ¥çœ‹å­—èŠ‚æµå’Œå­—ç¬¦æµå°±ä¼šè½»æ¾å¤šäº†ã€‚

å­—èŠ‚æµç”¨æ¥å¤„ç†äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ¯”å¦‚è¯´å›¾ç‰‡å•Šã€MP3 å•Šã€è§†é¢‘å•Šã€‚

å­—ç¬¦æµç”¨æ¥å¤„ç†æ–‡æœ¬æ–‡ä»¶ï¼Œæ–‡æœ¬æ–‡ä»¶å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåªä¸è¿‡ç»è¿‡äº†ç¼–ç ï¼Œä¾¿äºäººä»¬é˜…è¯»ã€‚

æ¢å¥è¯è¯´å°±æ˜¯ï¼Œå­—èŠ‚æµå¯ä»¥å¤„ç†ä¸€åˆ‡æ–‡ä»¶ï¼Œè€Œå­—ç¬¦æµåªèƒ½å¤„ç†æ–‡æœ¬ã€‚

è™½ç„¶ IO ç±»å¾ˆå¤šï¼Œä½†æ ¸å¿ƒçš„å°±æ˜¯ 4 ä¸ªæŠ½è±¡ç±»ï¼šInputStreamã€OutputStreamã€Readerã€Writerã€‚

ï¼ˆ**æŠ½è±¡å¤§æ³•çœŸå¥½**ï¼‰

è™½ç„¶ IO ç±»çš„æ–¹æ³•ä¹Ÿå¾ˆå¤šï¼Œä½†æ ¸å¿ƒçš„ä¹Ÿå°± 2 ä¸ªï¼šread å’Œ writeã€‚

**InputStream ç±»**

- `int read()`ï¼šè¯»å–æ•°æ®
- `int read(byte b[], int off, int len)`ï¼šä»ç¬¬ off ä½ç½®å¼€å§‹è¯»ï¼Œè¯»å– len é•¿åº¦çš„å­—èŠ‚ï¼Œç„¶åæ”¾å…¥æ•°ç»„ b ä¸­
- `long skip(long n)`ï¼šè·³è¿‡æŒ‡å®šä¸ªæ•°çš„å­—èŠ‚
- `int available()`ï¼šè¿”å›å¯è¯»çš„å­—èŠ‚æ•°
- `void close()`ï¼šå…³é—­æµï¼Œé‡Šæ”¾èµ„æº

**OutputStream ç±»**

- `void write(int b)`ï¼š å†™å…¥ä¸€ä¸ªå­—èŠ‚ï¼Œè™½ç„¶å‚æ•°æ˜¯ä¸€ä¸ª int ç±»å‹ï¼Œä½†åªæœ‰ä½ 8 ä½æ‰ä¼šå†™å…¥ï¼Œé«˜ 24 ä½ä¼šèˆå¼ƒï¼ˆè¿™å—åé¢å†è®²ï¼‰
- `void write(byte b[], int off, int len)`ï¼š å°†æ•°ç»„ b ä¸­çš„ä» off ä½ç½®å¼€å§‹ï¼Œé•¿åº¦ä¸º len çš„å­—èŠ‚å†™å…¥
- `void flush()`ï¼š å¼ºåˆ¶åˆ·æ–°ï¼Œå°†ç¼“å†²åŒºçš„æ•°æ®å†™å…¥
- `void close()`ï¼šå…³é—­æµ

**Reader ç±»**

- `int read()`ï¼šè¯»å–å•ä¸ªå­—ç¬¦
- `int read(char cbuf[], int off, int len)`ï¼šä»ç¬¬ off ä½ç½®å¼€å§‹è¯»ï¼Œè¯»å– len é•¿åº¦çš„å­—ç¬¦ï¼Œç„¶åæ”¾å…¥æ•°ç»„ b ä¸­
- `long skip(long n)`ï¼šè·³è¿‡æŒ‡å®šä¸ªæ•°çš„å­—ç¬¦
- `int ready()`ï¼šæ˜¯å¦å¯ä»¥è¯»äº†
- `void close()`ï¼šå…³é—­æµï¼Œé‡Šæ”¾èµ„æº

**Writer ç±»**

- `void write(int c)`ï¼š å†™å…¥ä¸€ä¸ªå­—ç¬¦
- `void write( char cbuf[], int off, int len)`ï¼š å°†æ•°ç»„ cbuf ä¸­çš„ä» off ä½ç½®å¼€å§‹ï¼Œé•¿åº¦ä¸º len çš„å­—ç¬¦å†™å…¥
- `void flush()`ï¼š å¼ºåˆ¶åˆ·æ–°ï¼Œå°†ç¼“å†²åŒºçš„æ•°æ®å†™å…¥
- `void close()`ï¼šå…³é—­æµ

ç†è§£äº†ä¸Šé¢è¿™äº›æ–¹æ³•ï¼ŒåŸºæœ¬ä¸Š IO çš„çµé­‚ä¹Ÿå°±å…¨éƒ¨æŒæ¡äº†ã€‚

å­—èŠ‚æµå’Œå­—ç¬¦æµçš„åŒºåˆ«ï¼š

- å­—èŠ‚æµä¸€èˆ¬ç”¨æ¥å¤„ç†å›¾åƒã€è§†é¢‘ã€éŸ³é¢‘ã€PPTã€Wordç­‰ç±»å‹çš„æ–‡ä»¶ã€‚å­—ç¬¦æµä¸€èˆ¬ç”¨äºå¤„ç†çº¯æ–‡æœ¬ç±»å‹çš„æ–‡ä»¶ï¼Œå¦‚TXTæ–‡ä»¶ç­‰ï¼Œä½†ä¸èƒ½å¤„ç†å›¾åƒè§†é¢‘ç­‰éæ–‡æœ¬æ–‡ä»¶ã€‚ç”¨ä¸€å¥è¯è¯´å°±æ˜¯ï¼šå­—èŠ‚æµå¯ä»¥å¤„ç†ä¸€åˆ‡æ–‡ä»¶ï¼Œè€Œå­—ç¬¦æµåªèƒ½å¤„ç†çº¯æ–‡æœ¬æ–‡ä»¶ã€‚
- å­—èŠ‚æµæœ¬èº«æ²¡æœ‰ç¼“å†²åŒºï¼Œç¼“å†²å­—èŠ‚æµç›¸å¯¹äºå­—èŠ‚æµï¼Œæ•ˆç‡æå‡éå¸¸é«˜ã€‚è€Œå­—ç¬¦æµæœ¬èº«å°±å¸¦æœ‰ç¼“å†²åŒºï¼Œç¼“å†²å­—ç¬¦æµç›¸å¯¹äºå­—ç¬¦æµæ•ˆç‡æå‡å°±ä¸æ˜¯é‚£ä¹ˆå¤§äº†ã€‚

ä»¥å†™æ–‡ä»¶ä¸ºä¾‹ï¼Œæˆ‘ä»¬æŸ¥çœ‹å­—ç¬¦æµçš„æºç ï¼Œå‘ç°ç¡®å®æœ‰åˆ©ç”¨åˆ°ç¼“å†²åŒºï¼š

```java
// å£°æ˜ä¸€ä¸ª char ç±»å‹çš„æ•°ç»„ï¼Œç”¨äºå†™å…¥è¾“å‡ºæµ
private char[] writeBuffer;

// å®šä¹‰ writeBuffer æ•°ç»„çš„å¤§å°ï¼Œå¿…é¡» >= 1
private static final int WRITE_BUFFER_SIZE = 1024;

// å†™å…¥ç»™å®šå­—ç¬¦ä¸²ä¸­çš„ä¸€éƒ¨åˆ†åˆ°è¾“å‡ºæµä¸­
public void write(String str, int off, int len) throws IOException {
    // ä½¿ç”¨ synchronized å…³é”®å­—åŒæ­¥ä»£ç å—ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨
    synchronized (lock) {
        char cbuf[];
        // å¦‚æœ len <= WRITE_BUFFER_SIZEï¼Œåˆ™ä½¿ç”¨ writeBuffer æ•°ç»„è¿›è¡Œå†™å…¥
        if (len <= WRITE_BUFFER_SIZE) {
            // å¦‚æœ writeBuffer ä¸º nullï¼Œåˆ™åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º WRITE_BUFFER_SIZE çš„æ–° char æ•°ç»„
            if (writeBuffer == null) {
                writeBuffer = new char[WRITE_BUFFER_SIZE];
            }
            cbuf = writeBuffer;
        } else {    // å¦‚æœ len > WRITE_BUFFER_SIZEï¼Œåˆ™ä¸æ°¸ä¹…åˆ†é…éå¸¸å¤§çš„ç¼“å†²åŒº
            // åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º len çš„æ–° char æ•°ç»„
            cbuf = new char[len];
        }
        // å°† str ä¸­çš„ä¸€éƒ¨åˆ†ï¼ˆä» off å¼€å§‹ï¼Œé•¿åº¦ä¸º lenï¼‰æ‹·è´åˆ° cbuf æ•°ç»„ä¸­
        str.getChars(off, (off + len), cbuf, 0);
        // å°† cbuf æ•°ç»„ä¸­çš„æ•°æ®å†™å…¥è¾“å‡ºæµä¸­
        write(cbuf, 0, len);
    }
}
```

è¿™æ®µä»£ç æ˜¯ Java IO ç±»åº“ä¸­çš„ OutputStreamWriter ç±»çš„ write æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°ç¼“å†²åŒºçš„å¤§å°æ˜¯ 1024 ä¸ª charã€‚

æˆ‘ä»¬å†ä»¥æ–‡ä»¶çš„å­—ç¬¦æµå’Œå­—èŠ‚æµæ¥åšä¸€ä¸‹å¯¹æ¯”ï¼Œä»£ç å·®åˆ«å¾ˆå°ã€‚

```java
// å­—èŠ‚æµ
try (FileInputStream fis = new FileInputStream("input.txt");
     FileOutputStream fos = new FileOutputStream("output.txt")) {
    byte[] buffer = new byte[1024];
    int len;
    while ((len = fis.read(buffer)) != -1) {
        fos.write(buffer, 0, len);
    }
} catch (IOException e) {
    e.printStackTrace();
}

// å­—ç¬¦æµ
try (FileReader fr = new FileReader("input.txt");
     FileWriter fw = new FileWriter("output.txt")) {
    char[] buffer = new char[1024];
    int len;
    while ((len = fr.read(buffer)) != -1) {
        fw.write(buffer, 0, len);
    }
} catch (IOException e) {
    e.printStackTrace();
}
```

### 02ã€æ“ä½œå¯¹è±¡åˆ’åˆ†

å°äºŒï¼Œä½ ç»†æƒ³ä¸€ä¸‹ï¼ŒIO IOï¼Œä¸å°±æ˜¯è¾“å…¥è¾“å‡ºï¼ˆInput/Outputï¼‰å˜›ï¼š

- Inputï¼šå°†å¤–éƒ¨çš„æ•°æ®è¯»å…¥å†…å­˜ï¼Œæ¯”å¦‚è¯´æŠŠæ–‡ä»¶ä»ç¡¬ç›˜è¯»å–åˆ°å†…å­˜ï¼Œä»ç½‘ç»œè¯»å–æ•°æ®åˆ°å†…å­˜ç­‰ç­‰
- Outputï¼šå°†å†…å­˜ä¸­çš„æ•°æ®å†™å…¥åˆ°å¤–éƒ¨ï¼Œæ¯”å¦‚è¯´æŠŠæ•°æ®ä»å†…å­˜å†™å…¥åˆ°æ–‡ä»¶ï¼ŒæŠŠæ•°æ®ä»å†…å­˜è¾“å‡ºåˆ°ç½‘ç»œç­‰ç­‰ã€‚

æ‰€æœ‰çš„ç¨‹åºï¼Œåœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œéƒ½æ˜¯åœ¨å†…å­˜ä¸Šè¿›è¡Œçš„ï¼Œä¸€æ—¦å…³æœºï¼Œå†…å­˜ä¸­çš„æ•°æ®å°±æ²¡äº†ï¼Œé‚£å¦‚æœæƒ³è¦æŒä¹…åŒ–ï¼Œå°±éœ€è¦æŠŠå†…å­˜ä¸­çš„æ•°æ®è¾“å‡ºåˆ°å¤–éƒ¨ï¼Œæ¯”å¦‚è¯´æ–‡ä»¶ã€‚

æ–‡ä»¶æ“ä½œç®—æ˜¯ IO ä¸­æœ€å…¸å‹çš„æ“ä½œäº†ï¼Œä¹Ÿæ˜¯æœ€é¢‘ç¹çš„æ“ä½œã€‚é‚£å…¶å®ä½ å¯ä»¥æ¢ä¸ªè§’åº¦æ¥æ€è€ƒï¼Œæ¯”å¦‚è¯´æŒ‰ç…§ IO çš„æ“ä½œå¯¹è±¡æ¥æ€è€ƒï¼ŒIO å°±å¯ä»¥åˆ†ç±»ä¸ºï¼šæ–‡ä»¶ã€æ•°ç»„ã€ç®¡é“ã€åŸºæœ¬æ•°æ®ç±»å‹ã€ç¼“å†²ã€æ‰“å°ã€å¯¹è±¡åºåˆ—åŒ–/ååºåˆ—åŒ–ï¼Œä»¥åŠè½¬æ¢ç­‰ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/io/shangtou-03.png)


#### **1ï¼‰æ–‡ä»¶**

æ–‡ä»¶æµä¹Ÿå°±æ˜¯ç›´æ¥æ“ä½œæ–‡ä»¶çš„æµï¼Œå¯ä»¥ç»†åˆ†ä¸ºå­—èŠ‚æµï¼ˆFileInputStream å’Œ FileOuputStreamï¼‰å’Œå­—ç¬¦æµï¼ˆFileReader å’Œ FileWriterï¼‰ã€‚

FileInputStream çš„ä¾‹å­ï¼š

```java
// å£°æ˜ä¸€ä¸ª int ç±»å‹çš„å˜é‡ bï¼Œç”¨äºå­˜å‚¨è¯»å–åˆ°çš„å­—èŠ‚
int b;
// åˆ›å»ºä¸€ä¸ª FileInputStream å¯¹è±¡ï¼Œç”¨äºè¯»å–æ–‡ä»¶ fis.txt ä¸­çš„æ•°æ®
FileInputStream fis1 = new FileInputStream("fis.txt");

// å¾ªç¯è¯»å–æ–‡ä»¶ä¸­çš„æ•°æ®
while ((b = fis1.read()) != -1) {
    // å°†è¯»å–åˆ°çš„å­—èŠ‚è½¬æ¢ä¸ºå¯¹åº”çš„ ASCII å­—ç¬¦ï¼Œå¹¶è¾“å‡ºåˆ°æ§åˆ¶å°
    System.out.println((char)b);
}

// å…³é—­ FileInputStream å¯¹è±¡ï¼Œé‡Šæ”¾èµ„æº
fis1.close();
```

FileOutputStream çš„ä¾‹å­ï¼š

```java
// åˆ›å»ºä¸€ä¸ª FileOutputStream å¯¹è±¡ï¼Œç”¨äºå†™å…¥æ•°æ®åˆ°æ–‡ä»¶ fos.txt ä¸­
FileOutputStream fos = new FileOutputStream("fos.txt");

// å‘æ–‡ä»¶ä¸­å†™å…¥æ•°æ®ï¼Œè¿™é‡Œå†™å…¥çš„æ˜¯å­—ç¬¦ä¸² "æ²‰é»˜ç‹äºŒ" å¯¹åº”çš„å­—èŠ‚æ•°ç»„
fos.write("æ²‰é»˜ç‹äºŒ".getBytes());

// å…³é—­ FileOutputStream å¯¹è±¡ï¼Œé‡Šæ”¾èµ„æº
fos.close();
```

FileReader çš„ä¾‹å­ï¼š

```java
// å£°æ˜ä¸€ä¸ª int ç±»å‹çš„å˜é‡ bï¼Œç”¨äºå­˜å‚¨è¯»å–åˆ°çš„å­—ç¬¦
int b = 0;

// åˆ›å»ºä¸€ä¸ª FileReader å¯¹è±¡ï¼Œç”¨äºè¯»å–æ–‡ä»¶ read.txt ä¸­çš„æ•°æ®
FileReader fileReader = new FileReader("read.txt");

// å¾ªç¯è¯»å–æ–‡ä»¶ä¸­çš„æ•°æ®
while ((b = fileReader.read()) != -1) {
    // å°†è¯»å–åˆ°çš„å­—ç¬¦å¼ºåˆ¶è½¬æ¢ä¸º char ç±»å‹ï¼Œå¹¶è¾“å‡ºåˆ°æ§åˆ¶å°
    System.out.println((char)b);
}

// å…³é—­ FileReader å¯¹è±¡ï¼Œé‡Šæ”¾èµ„æº
fileReader.close();
```

FileWriter çš„ä¾‹å­ï¼š

```java
// åˆ›å»ºä¸€ä¸ª FileWriter å¯¹è±¡ï¼Œç”¨äºå†™å…¥æ•°æ®åˆ°æ–‡ä»¶ fw.txt ä¸­
FileWriter fileWriter = new FileWriter("fw.txt");

// å°†å­—ç¬¦ä¸² "æ²‰é»˜ç‹äºŒ" è½¬æ¢ä¸ºå­—ç¬¦æ•°ç»„
char[] chars = "æ²‰é»˜ç‹äºŒ".toCharArray();

// å‘æ–‡ä»¶ä¸­å†™å…¥æ•°æ®ï¼Œè¿™é‡Œå†™å…¥çš„æ˜¯ chars æ•°ç»„ä¸­çš„æ‰€æœ‰å­—ç¬¦
fileWriter.write(chars, 0, chars.length);

// å…³é—­ FileWriter å¯¹è±¡ï¼Œé‡Šæ”¾èµ„æº
fileWriter.close();
```

æ–‡ä»¶æµè¿˜å¯ä»¥ç”¨äºåˆ›å»ºã€åˆ é™¤ã€é‡å‘½åæ–‡ä»¶ç­‰æ“ä½œã€‚FileOutputStream å’Œ FileWriter æ„é€ å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æŒ‡å®šæ˜¯å¦è¿½åŠ æ•°æ®åˆ°æ–‡ä»¶æœ«å°¾ã€‚

ç¤ºä¾‹ä»£ç ï¼š

```java
// åˆ›å»ºæ–‡ä»¶
File file = new File("test.txt");
if (file.createNewFile()) {
    System.out.println("æ–‡ä»¶åˆ›å»ºæˆåŠŸ");
} else {
    System.out.println("æ–‡ä»¶å·²å­˜åœ¨");
}

// åˆ é™¤æ–‡ä»¶
if (file.delete()) {
    System.out.println("æ–‡ä»¶åˆ é™¤æˆåŠŸ");
} else {
    System.out.println("æ–‡ä»¶åˆ é™¤å¤±è´¥");
}

// é‡å‘½åæ–‡ä»¶
File oldFile = new File("old.txt");
File newFile = new File("new.txt");
if (oldFile.renameTo(newFile)) {
    System.out.println("æ–‡ä»¶é‡å‘½åæˆåŠŸ");
} else {
    System.out.println("æ–‡ä»¶é‡å‘½åå¤±è´¥");
}
```

å½“æŒæ¡äº†æ–‡ä»¶çš„è¾“å…¥è¾“å‡ºï¼Œå…¶ä»–çš„è‡ªç„¶ä¹Ÿå°±æŒæ¡äº†ï¼Œéƒ½å¤§å·®ä¸å·®ã€‚

#### **2ï¼‰æ•°ç»„ï¼ˆå†…å­˜ï¼‰**

é€šå¸¸æ¥è¯´ï¼Œé’ˆå¯¹æ–‡ä»¶çš„è¯»å†™æ“ä½œï¼Œä½¿ç”¨æ–‡ä»¶æµé…åˆç¼“å†²æµå°±å¤Ÿç”¨äº†ï¼Œä½†ä¸ºäº†æå‡æ•ˆç‡ï¼Œé¢‘ç¹åœ°è¯»å†™æ–‡ä»¶å¹¶ä¸æ˜¯å¤ªå¥½ï¼Œé‚£ä¹ˆå°±å‡ºç°äº†æ•°ç»„æµï¼Œæœ‰æ—¶å€™ä¹Ÿç§°ä¸ºå†…å­˜æµã€‚

ByteArrayInputStream çš„ä¾‹å­ï¼š

```java
// åˆ›å»ºä¸€ä¸ª ByteArrayInputStream å¯¹è±¡ï¼Œç”¨äºä»å­—èŠ‚æ•°ç»„ä¸­è¯»å–æ•°æ®
InputStream is = new BufferedInputStream(
        new ByteArrayInputStream(
                "æ²‰é»˜ç‹äºŒ".getBytes(StandardCharsets.UTF_8)));

// å®šä¹‰ä¸€ä¸ªå­—èŠ‚æ•°ç»„ç”¨äºå­˜å‚¨è¯»å–åˆ°çš„æ•°æ®
byte[] flush = new byte[1024];

// å®šä¹‰ä¸€ä¸ªå˜é‡ç”¨äºå­˜å‚¨æ¯æ¬¡è¯»å–åˆ°çš„å­—èŠ‚æ•°
int len = 0;

// å¾ªç¯è¯»å–å­—èŠ‚æ•°ç»„ä¸­çš„æ•°æ®ï¼Œå¹¶è¾“å‡ºåˆ°æ§åˆ¶å°
while (-1 != (len = is.read(flush))) {
    // å°†è¯»å–åˆ°çš„å­—èŠ‚è½¬æ¢ä¸ºå¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œå¹¶è¾“å‡ºåˆ°æ§åˆ¶å°
    System.out.println(new String(flush, 0, len));
}

// å…³é—­è¾“å…¥æµï¼Œé‡Šæ”¾èµ„æº
is.close();
```

ByteArrayOutputStream çš„ä¾‹å­ï¼š

```java
// åˆ›å»ºä¸€ä¸ª ByteArrayOutputStream å¯¹è±¡ï¼Œç”¨äºå†™å…¥æ•°æ®åˆ°å†…å­˜ç¼“å†²åŒºä¸­
ByteArrayOutputStream bos = new ByteArrayOutputStream();

// å®šä¹‰ä¸€ä¸ªå­—èŠ‚æ•°ç»„ç”¨äºå­˜å‚¨è¦å†™å…¥å†…å­˜ç¼“å†²åŒºä¸­çš„æ•°æ®
byte[] info = "æ²‰é»˜ç‹äºŒ".getBytes();

// å‘å†…å­˜ç¼“å†²åŒºä¸­å†™å…¥æ•°æ®ï¼Œè¿™é‡Œå†™å…¥çš„æ˜¯ info æ•°ç»„ä¸­çš„æ‰€æœ‰å­—èŠ‚
bos.write(info, 0, info.length);

// å°†å†…å­˜ç¼“å†²åŒºä¸­çš„æ•°æ®è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„
byte[] dest = bos.toByteArray();

// å…³é—­ ByteArrayOutputStream å¯¹è±¡ï¼Œé‡Šæ”¾èµ„æº
bos.close();
```

æ•°ç»„æµå¯ä»¥ç”¨äºåœ¨å†…å­˜ä¸­è¯»å†™æ•°æ®ï¼Œæ¯”å¦‚å°†æ•°æ®å­˜å‚¨åœ¨å­—èŠ‚æ•°ç»„ä¸­è¿›è¡Œå‹ç¼©ã€åŠ å¯†ã€åºåˆ—åŒ–ç­‰æ“ä½œã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ä¸éœ€è¦åˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼Œå¯ä»¥æé«˜ç¨‹åºçš„æ•ˆç‡ã€‚ä½†æ˜¯ï¼Œæ•°ç»„æµä¹Ÿæœ‰ç¼ºç‚¹ï¼Œå®ƒåªèƒ½å­˜å‚¨æœ‰é™çš„æ•°æ®é‡ï¼Œå¦‚æœå­˜å‚¨çš„æ•°æ®é‡è¿‡å¤§ï¼Œä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚

#### **3ï¼‰ç®¡é“**

Java ä¸­çš„ç®¡é“å’Œ Unix/Linux ä¸­çš„ç®¡é“ä¸åŒï¼Œåœ¨ Unix/Linux ä¸­ï¼Œä¸åŒçš„è¿›ç¨‹ä¹‹é—´å¯ä»¥é€šè¿‡ç®¡é“æ¥é€šä¿¡ï¼Œä½† Java ä¸­ï¼Œé€šä¿¡çš„åŒæ–¹å¿…é¡»åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œä¹Ÿå°±æ˜¯åœ¨åŒä¸€ä¸ª JVM ä¸­ï¼Œç®¡é“ä¸ºçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æä¾›äº†é€šä¿¡èƒ½åŠ›ã€‚

ä¸€ä¸ªçº¿ç¨‹é€šè¿‡ PipedOutputStream å†™å…¥çš„æ•°æ®å¯ä»¥è¢«å¦å¤–ä¸€ä¸ªçº¿ç¨‹é€šè¿‡ç›¸å…³è”çš„ PipedInputStream è¯»å–å‡ºæ¥ã€‚

```java
// åˆ›å»ºä¸€ä¸ª PipedOutputStream å¯¹è±¡å’Œä¸€ä¸ª PipedInputStream å¯¹è±¡
final PipedOutputStream pipedOutputStream = new PipedOutputStream();
final PipedInputStream pipedInputStream = new PipedInputStream(pipedOutputStream);

// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå‘ PipedOutputStream ä¸­å†™å…¥æ•°æ®
Thread thread1 = new Thread(new Runnable() {
    @Override
    public void run() {
        try {
            // å°†å­—ç¬¦ä¸² "æ²‰é»˜ç‹äºŒ" è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„ï¼Œå¹¶å†™å…¥åˆ° PipedOutputStream ä¸­
            pipedOutputStream.write("æ²‰é»˜ç‹äºŒ".getBytes(StandardCharsets.UTF_8));
            // å…³é—­ PipedOutputStreamï¼Œé‡Šæ”¾èµ„æº
            pipedOutputStream.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
});

// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä» PipedInputStream ä¸­è¯»å–æ•°æ®å¹¶è¾“å‡ºåˆ°æ§åˆ¶å°
Thread thread2 = new Thread(new Runnable() {
    @Override
    public void run() {
        try {
            // å®šä¹‰ä¸€ä¸ªå­—èŠ‚æ•°ç»„ç”¨äºå­˜å‚¨è¯»å–åˆ°çš„æ•°æ®
            byte[] flush = new byte[1024];
            // å®šä¹‰ä¸€ä¸ªå˜é‡ç”¨äºå­˜å‚¨æ¯æ¬¡è¯»å–åˆ°çš„å­—èŠ‚æ•°
            int len = 0;
            // å¾ªç¯è¯»å–å­—èŠ‚æ•°ç»„ä¸­çš„æ•°æ®ï¼Œå¹¶è¾“å‡ºåˆ°æ§åˆ¶å°
            while (-1 != (len = pipedInputStream.read(flush))) {
                // å°†è¯»å–åˆ°çš„å­—èŠ‚è½¬æ¢ä¸ºå¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œå¹¶è¾“å‡ºåˆ°æ§åˆ¶å°
                System.out.println(new String(flush, 0, len));
            }
            // å…³é—­ PipedInputStreamï¼Œé‡Šæ”¾èµ„æº
            pipedInputStream.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
});

// å¯åŠ¨çº¿ç¨‹1å’Œçº¿ç¨‹2
thread1.start();
thread2.start();
```

ä½¿ç”¨ç®¡é“æµå¯ä»¥å®ç°ä¸åŒçº¿ç¨‹ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œå¯ä»¥ç”¨äºçº¿ç¨‹é—´çš„é€šä¿¡ã€æ•°æ®çš„ä¼ é€’ç­‰ã€‚ä½†æ˜¯ï¼Œç®¡é“æµä¹Ÿæœ‰ä¸€äº›å±€é™æ€§ï¼Œæ¯”å¦‚åªèƒ½åœ¨åŒä¸€ä¸ª JVM ä¸­çš„çº¿ç¨‹ä¹‹é—´ä½¿ç”¨ï¼Œä¸èƒ½è·¨è¶Šä¸åŒçš„ JVM è¿›ç¨‹ã€‚

#### **4ï¼‰åŸºæœ¬æ•°æ®ç±»å‹**

åŸºæœ¬æ•°æ®ç±»å‹è¾“å…¥è¾“å‡ºæµæ˜¯ä¸€ä¸ªå­—èŠ‚æµï¼Œè¯¥æµä¸ä»…å¯ä»¥è¯»å†™å­—èŠ‚å’Œå­—ç¬¦ï¼Œè¿˜å¯ä»¥è¯»å†™åŸºæœ¬æ•°æ®ç±»å‹ã€‚

DataInputStream æä¾›äº†ä¸€ç³»åˆ—å¯ä»¥è¯»åŸºæœ¬æ•°æ®ç±»å‹çš„æ–¹æ³•ï¼š

```java
// åˆ›å»ºä¸€ä¸ª DataInputStream å¯¹è±¡ï¼Œç”¨äºä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®
DataInputStream dis = new DataInputStream(new FileInputStream("das.txt"));

// è¯»å–ä¸€ä¸ªå­—èŠ‚ï¼Œå°†å…¶è½¬æ¢ä¸º byte ç±»å‹
byte b = dis.readByte();

// è¯»å–ä¸¤ä¸ªå­—èŠ‚ï¼Œå°†å…¶è½¬æ¢ä¸º short ç±»å‹
short s = dis.readShort();

// è¯»å–å››ä¸ªå­—èŠ‚ï¼Œå°†å…¶è½¬æ¢ä¸º int ç±»å‹
int i = dis.readInt();

// è¯»å–å…«ä¸ªå­—èŠ‚ï¼Œå°†å…¶è½¬æ¢ä¸º long ç±»å‹
long l = dis.readLong();

// è¯»å–å››ä¸ªå­—èŠ‚ï¼Œå°†å…¶è½¬æ¢ä¸º float ç±»å‹
float f = dis.readFloat();

// è¯»å–å…«ä¸ªå­—èŠ‚ï¼Œå°†å…¶è½¬æ¢ä¸º double ç±»å‹
double d = dis.readDouble();

// è¯»å–ä¸€ä¸ªå­—èŠ‚ï¼Œå°†å…¶è½¬æ¢ä¸º boolean ç±»å‹
boolean bb = dis.readBoolean();

// è¯»å–ä¸¤ä¸ªå­—èŠ‚ï¼Œå°†å…¶è½¬æ¢ä¸º char ç±»å‹
char ch = dis.readChar();

// å…³é—­ DataInputStreamï¼Œé‡Šæ”¾èµ„æº
dis.close();
```

DataOutputStream æä¾›äº†ä¸€ç³»åˆ—å¯ä»¥å†™åŸºæœ¬æ•°æ®ç±»å‹çš„æ–¹æ³•ï¼š

```java
// åˆ›å»ºä¸€ä¸ª DataOutputStream å¯¹è±¡ï¼Œç”¨äºå°†æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­
DataOutputStream das = new DataOutputStream(new FileOutputStream("das.txt"));

// å°†ä¸€ä¸ª byte ç±»å‹çš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­
das.writeByte(10);

// å°†ä¸€ä¸ª short ç±»å‹çš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­
das.writeShort(100);

// å°†ä¸€ä¸ª int ç±»å‹çš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­
das.writeInt(1000);

// å°†ä¸€ä¸ª long ç±»å‹çš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­
das.writeLong(10000L);

// å°†ä¸€ä¸ª float ç±»å‹çš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­
das.writeFloat(12.34F);

// å°†ä¸€ä¸ª double ç±»å‹çš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­
das.writeDouble(12.56);

// å°†ä¸€ä¸ª boolean ç±»å‹çš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­
das.writeBoolean(true);

// å°†ä¸€ä¸ª char ç±»å‹çš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­
das.writeChar('A');

// å…³é—­ DataOutputStreamï¼Œé‡Šæ”¾èµ„æº
das.close();
```

é™¤äº† DataInputStream å’Œ DataOutputStreamï¼ŒJava IO è¿˜æä¾›äº†å…¶ä»–ä¸€äº›è¯»å†™åŸºæœ¬æ•°æ®ç±»å‹å’Œå­—ç¬¦ä¸²çš„æµç±»ï¼ŒåŒ…æ‹¬ ObjectInputStream å’Œ ObjectOutputStreamï¼ˆç”¨äºè¯»å†™å¯¹è±¡ï¼‰ã€‚

ç¤ºä¾‹ä»£ç ï¼š

```java
public static void main(String[] args) {
    try (ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream("person.dat"))) {
        Person p = new Person("å¼ ä¸‰", 20);
        oos.writeObject(p);
    } catch (IOException e) {
        e.printStackTrace();
    }

    try (ObjectInputStream ois = new ObjectInputStream(new FileInputStream("person.dat"))) {
        Person p = (Person) ois.readObject();
        System.out.println(p);
    } catch (IOException | ClassNotFoundException e) {
        e.printStackTrace();
    }
}
```

ä»¥ä¸Šä»£ç åˆ›å»ºäº†ä¸€ä¸ª Person å¯¹è±¡ï¼Œå°†å…¶å†™å…¥æ–‡ä»¶ä¸­ï¼Œç„¶åä»æ–‡ä»¶ä¸­è¯»å–è¯¥å¯¹è±¡ï¼Œå¹¶æ‰“å°åœ¨æ§åˆ¶å°ä¸Šã€‚

#### **5ï¼‰ç¼“å†²**

CPU å¾ˆå¿«ï¼Œå®ƒæ¯”å†…å­˜å¿« 100 å€ï¼Œæ¯”ç£ç›˜å¿«ç™¾ä¸‡å€ã€‚é‚£ä¹Ÿå°±æ„å‘³ç€ï¼Œç¨‹åºå’Œå†…å­˜äº¤äº’ä¼šå¾ˆå¿«ï¼Œå’Œç¡¬ç›˜äº¤äº’ç›¸å¯¹å°±å¾ˆæ…¢ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚

ä¸ºäº†å‡å°‘ç¨‹åºå’Œç¡¬ç›˜çš„äº¤äº’ï¼Œæå‡ç¨‹åºçš„æ•ˆç‡ï¼Œå°±å¼•å…¥äº†ç¼“å†²æµï¼Œä¹Ÿå°±æ˜¯ç±»åå‰ç¼€å¸¦æœ‰ Buffer çš„é‚£äº›ï¼Œæ¯”å¦‚è¯´ BufferedInputStreamã€BufferedOutputStreamã€BufferedReaderã€BufferedWriterã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/io/shangtou-04.png)


ç¼“å†²æµåœ¨å†…å­˜ä¸­è®¾ç½®äº†ä¸€ä¸ªç¼“å†²åŒºï¼Œåªæœ‰ç¼“å†²åŒºå­˜å‚¨äº†è¶³å¤Ÿå¤šçš„å¸¦æ“ä½œçš„æ•°æ®åï¼Œæ‰ä¼šå’Œå†…å­˜æˆ–è€…ç¡¬ç›˜è¿›è¡Œäº¤äº’ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä¸€æ¬¡å¤šè¯»/å†™ç‚¹ï¼Œå°‘è¯»/å†™å‡ æ¬¡ï¼Œè¿™æ ·ç¨‹åºçš„æ€§èƒ½å°±ä¼šæé«˜ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ BufferedInputStream è¯»å–æ–‡ä»¶çš„ç¤ºä¾‹ä»£ç ï¼š

```java
// åˆ›å»ºä¸€ä¸ª BufferedInputStream å¯¹è±¡ï¼Œç”¨äºä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®
BufferedInputStream bis = new BufferedInputStream(new FileInputStream("data.txt"));

// åˆ›å»ºä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œä½œä¸ºç¼“å­˜åŒº
byte[] buffer = new byte[1024];

// è¯»å–æ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œå¹¶å°†å…¶å­˜å‚¨åˆ°ç¼“å­˜åŒºä¸­
int bytesRead;
while ((bytesRead = bis.read(buffer)) != -1) {
    // å¯¹ç¼“å­˜åŒºä¸­çš„æ•°æ®è¿›è¡Œå¤„ç†
    // è¿™é‡Œåªæ˜¯ç®€å•åœ°å°†è¯»å–åˆ°çš„å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶æ‰“å°å‡ºæ¥
    System.out.println(new String(buffer, 0, bytesRead));
}

// å…³é—­ BufferedInputStreamï¼Œé‡Šæ”¾èµ„æº
bis.close();
```

ä¸Šè¿°ä»£ç ä¸­ï¼Œé¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª BufferedInputStream å¯¹è±¡ï¼Œç”¨äºä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚ç„¶ååˆ›å»ºäº†ä¸€ä¸ªå­—èŠ‚æ•°ç»„ä½œä¸ºç¼“å­˜åŒºï¼Œæ¯æ¬¡è¯»å–æ•°æ®æ—¶å°†æ•°æ®å­˜å‚¨åˆ°ç¼“å­˜åŒºä¸­ã€‚è¯»å–æ•°æ®çš„è¿‡ç¨‹æ˜¯é€šè¿‡ while å¾ªç¯å®ç°çš„ï¼Œæ¯æ¬¡è¯»å–æ•°æ®åå¯¹ç¼“å­˜åŒºä¸­çš„æ•°æ®è¿›è¡Œå¤„ç†ã€‚æœ€åå…³é—­ BufferedInputStreamï¼Œé‡Šæ”¾èµ„æºã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ BufferedOutputStream å†™å…¥æ–‡ä»¶çš„ç¤ºä¾‹ä»£ç ï¼š

```java
// åˆ›å»ºä¸€ä¸ª BufferedOutputStream å¯¹è±¡ï¼Œç”¨äºå°†æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­
BufferedOutputStream bos = new BufferedOutputStream(new FileOutputStream("data.txt"));

// åˆ›å»ºä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œä½œä¸ºç¼“å­˜åŒº
byte[] buffer = new byte[1024];

// å°†æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­
String data = "æ²‰é»˜ç‹äºŒæ˜¯ä¸ªå¤§å‚»å­!";
buffer = data.getBytes();
bos.write(buffer);

// åˆ·æ–°ç¼“å­˜åŒºï¼Œå°†ç¼“å­˜åŒºä¸­çš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­
bos.flush();

// å…³é—­ BufferedOutputStreamï¼Œé‡Šæ”¾èµ„æº
bos.close();
```

ä¸Šè¿°ä»£ç ä¸­ï¼Œé¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª BufferedOutputStream å¯¹è±¡ï¼Œç”¨äºå°†æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚ç„¶ååˆ›å»ºäº†ä¸€ä¸ªå­—èŠ‚æ•°ç»„ä½œä¸ºç¼“å­˜åŒºï¼Œå°†æ•°æ®å†™å…¥åˆ°ç¼“å­˜åŒºä¸­ã€‚å†™å…¥æ•°æ®çš„è¿‡ç¨‹æ˜¯é€šè¿‡ write() æ–¹æ³•å®ç°çš„ï¼Œå°†å­—èŠ‚æ•°ç»„ä½œä¸ºå‚æ•°ä¼ é€’ç»™ write() æ–¹æ³•å³å¯ã€‚

æœ€åï¼Œé€šè¿‡ flush() æ–¹æ³•å°†ç¼“å­˜åŒºä¸­çš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚åœ¨å†™å…¥æ•°æ®æ—¶ï¼Œç”±äºä½¿ç”¨äº† BufferedOutputStreamï¼Œæ•°æ®ä¼šå…ˆè¢«å†™å…¥åˆ°ç¼“å­˜åŒºä¸­ï¼Œåªæœ‰åœ¨ç¼“å­˜åŒºè¢«å¡«æ»¡æˆ–è€…è°ƒç”¨äº† flush() æ–¹æ³•æ—¶æ‰ä¼šå°†ç¼“å­˜åŒºä¸­çš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ BufferedReader è¯»å–æ–‡ä»¶çš„ç¤ºä¾‹ä»£ç ï¼š

```java
// åˆ›å»ºä¸€ä¸ª BufferedReader å¯¹è±¡ï¼Œç”¨äºä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®
BufferedReader br = new BufferedReader(new FileReader("data.txt"));

// è¯»å–æ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œå¹¶å°†å…¶å­˜å‚¨åˆ°å­—ç¬¦ä¸²ä¸­
String line;
while ((line = br.readLine()) != null) {
    // å¯¹è¯»å–åˆ°çš„æ•°æ®è¿›è¡Œå¤„ç†
    // è¿™é‡Œåªæ˜¯ç®€å•åœ°å°†è¯»å–åˆ°çš„æ¯ä¸€è¡Œå­—ç¬¦ä¸²æ‰“å°å‡ºæ¥
    System.out.println(line);
}

// å…³é—­ BufferedReaderï¼Œé‡Šæ”¾èµ„æº
br.close();
```

ä¸Šè¿°ä»£ç ä¸­ï¼Œé¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª BufferedReader å¯¹è±¡ï¼Œç”¨äºä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚ç„¶åä½¿ç”¨ readLine() æ–¹æ³•è¯»å–æ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œæ¯æ¬¡è¯»å–ä¸€è¡Œæ•°æ®å¹¶å°†å…¶å­˜å‚¨åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚è¯»å–æ•°æ®çš„è¿‡ç¨‹æ˜¯é€šè¿‡ while å¾ªç¯å®ç°çš„ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ BufferedWriter å†™å…¥æ–‡ä»¶çš„ç¤ºä¾‹ä»£ç ï¼š

```java
// åˆ›å»ºä¸€ä¸ª BufferedWriter å¯¹è±¡ï¼Œç”¨äºå°†æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­
BufferedWriter bw = new BufferedWriter(new FileWriter("data.txt"));

// å°†æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­
String data = "æ²‰é»˜ç‹äºŒï¼ŒçœŸå¸…æ°”";
bw.write(data);

// åˆ·æ–°ç¼“å­˜åŒºï¼Œå°†ç¼“å­˜åŒºä¸­çš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­
bw.flush();

// å…³é—­ BufferedWriterï¼Œé‡Šæ”¾èµ„æº
bw.close();
```

ä¸Šè¿°ä»£ç ä¸­ï¼Œé¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª BufferedWriter å¯¹è±¡ï¼Œç”¨äºå°†æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚ç„¶åä½¿ç”¨ write() æ–¹æ³•å°†æ•°æ®å†™å…¥åˆ°ç¼“å­˜åŒºä¸­ï¼Œå†™å…¥æ•°æ®çš„è¿‡ç¨‹å’Œä½¿ç”¨ FileWriter ç±»ä¼¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ BufferedWriter å†™å…¥æ•°æ®æ—¶ï¼Œæ•°æ®ä¼šå…ˆè¢«å†™å…¥åˆ°ç¼“å­˜åŒºä¸­ï¼Œåªæœ‰åœ¨ç¼“å­˜åŒºè¢«å¡«æ»¡æˆ–è€…è°ƒç”¨äº† flush() æ–¹æ³•æ—¶æ‰ä¼šå°†ç¼“å­˜åŒºä¸­çš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚

æœ€åï¼Œé€šè¿‡ flush() æ–¹æ³•å°†ç¼“å­˜åŒºä¸­çš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œå¹¶é€šè¿‡ close() æ–¹æ³•å…³é—­ BufferedWriterï¼Œé‡Šæ”¾èµ„æºã€‚

ä½¿ç”¨ç¼“å†²æµå¯ä»¥æé«˜è¯»å†™æ•ˆç‡ï¼Œå‡å°‘äº†é¢‘ç¹çš„è¯»å†™ç£ç›˜æˆ–ç½‘ç»œçš„æ¬¡æ•°ï¼Œä»è€Œæé«˜äº†ç¨‹åºçš„æ€§èƒ½ã€‚ä½†æ˜¯ï¼Œåœ¨ä½¿ç”¨ç¼“å†²æµæ—¶éœ€è¦æ³¨æ„ç¼“å†²åŒºçš„å¤§å°å’Œæ¸…ç©ºç¼“å†²åŒºçš„æ—¶æœºï¼Œä»¥é¿å…æ•°æ®ä¸¢å¤±æˆ–ä¸å®Œæ•´çš„é—®é¢˜ã€‚

#### **6ï¼‰æ‰“å°**

Java çš„æ‰“å°æµæ˜¯ä¸€ç»„ç”¨äºæ‰“å°è¾“å‡ºæ•°æ®çš„ç±»ï¼ŒåŒ…æ‹¬ PrintStream å’Œ PrintWriter ä¸¤ä¸ªç±»ã€‚

ææ€• Java ç¨‹åºå‘˜ä¸€ç”Ÿå½“ä¸­æœ€å¸¸ç”¨çš„å°±æ˜¯æ‰“å°æµäº†ï¼š`System.out` å…¶å®è¿”å›çš„å°±æ˜¯ä¸€ä¸ª PrintStream å¯¹è±¡ï¼Œå¯ä»¥ç”¨æ¥æ‰“å°å„å¼å„æ ·çš„å¯¹è±¡ã€‚

```java
System.out.println("æ²‰é»˜ç‹äºŒæ˜¯çœŸçš„äºŒï¼");
```

PrintStream æœ€ç»ˆè¾“å‡ºçš„æ˜¯å­—èŠ‚æ•°æ®ï¼Œè€Œ PrintWriter åˆ™æ˜¯æ‰©å±•äº† Writer æ¥å£ï¼Œæ‰€ä»¥å®ƒçš„ `print()/println()` æ–¹æ³•æœ€ç»ˆè¾“å‡ºçš„æ˜¯å­—ç¬¦æ•°æ®ã€‚ä½¿ç”¨ä¸Šå‡ ä¹å’Œ PrintStream ä¸€æ¨¡ä¸€æ ·ã€‚

```java
StringWriter buffer = new StringWriter();
try (PrintWriter pw = new PrintWriter(buffer)) {
    pw.println("æ²‰é»˜ç‹äºŒ");
}
System.out.println(buffer.toString());
```

#### **7ï¼‰å¯¹è±¡åºåˆ—åŒ–/ååºåˆ—åŒ–**

åºåˆ—åŒ–æœ¬è´¨ä¸Šæ˜¯å°†ä¸€ä¸ª Java å¯¹è±¡è½¬æˆå­—èŠ‚æ•°ç»„ï¼Œç„¶åå¯ä»¥å°†å…¶ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œæˆ–è€…é€šè¿‡ç½‘ç»œä¼ è¾“åˆ°è¿œç¨‹ã€‚

```java
// åˆ›å»ºä¸€ä¸ª ByteArrayOutputStream å¯¹è±¡ bufferï¼Œç”¨äºå­˜å‚¨æ•°æ®
ByteArrayOutputStream buffer = new ByteArrayOutputStream();

// ä½¿ç”¨ try-with-resources è¯­å¥åˆ›å»ºä¸€ä¸ª ObjectOutputStream å¯¹è±¡ outputï¼Œå¹¶å°†å…¶ä¸ buffer å…³è”
try (ObjectOutputStream output = new ObjectOutputStream(buffer)) {
    
    // ä½¿ç”¨ writeUTF() æ–¹æ³•å°†å­—ç¬¦ä¸² "æ²‰é»˜ç‹äºŒ" å†™å…¥åˆ°ç¼“å†²åŒºä¸­
    output.writeUTF("æ²‰é»˜ç‹äºŒ");
}

// ä½¿ç”¨ toByteArray() æ–¹æ³•å°†ç¼“å†²åŒºä¸­çš„æ•°æ®è½¬æ¢æˆå­—èŠ‚æ•°ç»„ï¼Œå¹¶è¾“å‡ºåˆ°æ§åˆ¶å°
System.out.println(Arrays.toString(buffer.toByteArray()));
```

ä¸å…¶å¯¹åº”çš„ï¼Œæœ‰åºåˆ—åŒ–ï¼Œå°±æœ‰ååºåˆ—åŒ–ï¼Œä¹Ÿå°±æ˜¯å†å°†å­—èŠ‚æ•°ç»„è½¬æˆ Java å¯¹è±¡çš„è¿‡ç¨‹ã€‚

```java
try (ObjectInputStream input = new ObjectInputStream(new FileInputStream(
        new File("Person.txt")))) {
    String s = input.readUTF();
}
```

è¿™æ®µä»£ç ä¸»è¦ä½¿ç”¨äº† Java çš„ ByteArrayOutputStream å’Œ ObjectOutputStream ç±»ï¼Œå°†å­—ç¬¦ä¸² "æ²‰é»˜ç‹äºŒ" å†™å…¥åˆ°ä¸€ä¸ªå­—èŠ‚æ•°ç»„ç¼“å†²åŒºä¸­ï¼Œå¹¶å°†ç¼“å†²åŒºä¸­çš„æ•°æ®è½¬æ¢æˆå­—èŠ‚æ•°ç»„è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚

å…·ä½“çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š

- åˆ›å»ºä¸€ä¸ª ByteArrayOutputStream å¯¹è±¡ bufferï¼Œç”¨äºå­˜å‚¨æ•°æ®ã€‚
- ä½¿ç”¨ [try-with-resources](https://tobebetterjavaer.com/exception/try-with-resources.html) è¯­å¥åˆ›å»ºä¸€ä¸ª ObjectOutputStream å¯¹è±¡ outputï¼Œå¹¶å°†å…¶ä¸ buffer å…³è”ã€‚
- ä½¿ç”¨ writeUTF() æ–¹æ³•å°†å­—ç¬¦ä¸² "æ²‰é»˜ç‹äºŒ" å†™å…¥åˆ°ç¼“å†²åŒºä¸­ã€‚
- å½“ try-with-resources è¯­å¥æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ output çš„ close() æ–¹æ³•å…³é—­è¾“å‡ºæµï¼Œé‡Šæ”¾èµ„æºã€‚
- ä½¿ç”¨ toByteArray() æ–¹æ³•å°†ç¼“å†²åŒºä¸­çš„æ•°æ®è½¬æ¢æˆå­—èŠ‚æ•°ç»„ã€‚
- ä½¿ç”¨ Arrays.toString() æ–¹æ³•å°†å­—èŠ‚æ•°ç»„è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå¹¶è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚

#### **8ï¼‰è½¬æ¢**

InputStreamReader æ˜¯ä»å­—èŠ‚æµåˆ°å­—ç¬¦æµçš„æ¡¥è¿æ¥ï¼Œå®ƒä½¿ç”¨æŒ‡å®šçš„å­—ç¬¦é›†è¯»å–å­—èŠ‚å¹¶å°†å®ƒä»¬è§£ç ä¸ºå­—ç¬¦ã€‚

```java
// åˆ›å»ºä¸€ä¸ª InputStreamReader å¯¹è±¡ isrï¼Œä½¿ç”¨ FileInputStream å¯¹è±¡è¯»å–æ–‡ä»¶ demo.txt çš„å†…å®¹å¹¶å°†å…¶è½¬æ¢ä¸ºå­—ç¬¦æµ
InputStreamReader isr = new InputStreamReader(new FileInputStream("demo.txt"));

// åˆ›å»ºä¸€ä¸ªå­—ç¬¦æ•°ç»„ chaï¼Œç”¨äºå­˜å‚¨è¯»å–çš„å­—ç¬¦æ•°æ®ï¼Œå…¶ä¸­ 1024 è¡¨ç¤ºæ•°ç»„çš„é•¿åº¦
char[] cha = new char[1024];

// ä½¿ç”¨ read() æ–¹æ³•è¯»å– isr ä¸­çš„æ•°æ®ï¼Œå¹¶å°†è¯»å–çš„å­—ç¬¦æ•°æ®å­˜å‚¨åˆ° cha æ•°ç»„ä¸­ï¼Œè¿”å›å€¼ len è¡¨ç¤ºè¯»å–çš„å­—ç¬¦æ•°
int len = isr.read(cha);

// å°† cha æ•°ç»„ä¸­ä»ä¸‹æ ‡ 0 å¼€å§‹ã€é•¿åº¦ä¸º len çš„éƒ¨åˆ†è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå¹¶è¾“å‡ºåˆ°æ§åˆ¶å°
System.out.println(new String(cha, 0, len));

// å…³é—­ InputStreamReader å¯¹è±¡ isrï¼Œé‡Šæ”¾èµ„æº
isr.close();
```

è¿™æ®µä»£ç ä¸»è¦ä½¿ç”¨äº† Java çš„ InputStreamReader å’Œ FileInputStream ç±»ï¼Œä»æ–‡ä»¶ demo.txt ä¸­è¯»å–æ•°æ®å¹¶å°†å…¶è½¬æ¢ä¸ºå­—ç¬¦æµï¼Œç„¶åå°†è¯»å–çš„å­—ç¬¦æ•°æ®å­˜å‚¨åˆ°ä¸€ä¸ªå­—ç¬¦æ•°ç»„ä¸­ï¼Œå¹¶è¾“å‡ºè½¬æ¢æˆå­—ç¬¦ä¸²åçš„ç»“æœåˆ°æ§åˆ¶å°ã€‚

OutputStreamWriter å°†ä¸€ä¸ªå­—ç¬¦æµçš„è¾“å‡ºå¯¹è±¡å˜ä¸ºå­—èŠ‚æµçš„è¾“å‡ºå¯¹è±¡ï¼Œæ˜¯å­—ç¬¦æµé€šå‘å­—èŠ‚æµçš„æ¡¥æ¢ã€‚

```java
// åˆ›å»ºä¸€ä¸ª File å¯¹è±¡ fï¼Œè¡¨ç¤ºæ–‡ä»¶ test.txt
File f = new File("test.txt");

// åˆ›å»ºä¸€ä¸ª OutputStreamWriter å¯¹è±¡ outï¼Œä½¿ç”¨ FileOutputStream å¯¹è±¡å°†æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ f ä¸­ï¼Œå¹¶å°†å­—èŠ‚æµè½¬æ¢æˆå­—ç¬¦æµ
Writer out = new OutputStreamWriter(new FileOutputStream(f));

// ä½¿ç”¨ write() æ–¹æ³•å°†å­—ç¬¦ä¸² "æ²‰é»˜ç‹äºŒ!!" å†™å…¥åˆ°æ–‡ä»¶ f ä¸­
out.write("æ²‰é»˜ç‹äºŒ!!");

// å…³é—­ Writer å¯¹è±¡ outï¼Œé‡Šæ”¾èµ„æº
out.close();
```

ä½¿ç”¨è½¬æ¢æµå¯ä»¥æ–¹ä¾¿åœ°åœ¨å­—èŠ‚æµå’Œå­—ç¬¦æµä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚åœ¨è¿›è¡Œæ–‡æœ¬æ–‡ä»¶è¯»å†™æ—¶ï¼Œé€šå¸¸ä½¿ç”¨å­—ç¬¦æµè¿›è¡Œæ“ä½œï¼Œè€Œåœ¨è¿›è¡Œç½‘ç»œä¼ è¾“æˆ–ä¸è®¾å¤‡è¿›è¡Œé€šä¿¡æ—¶ï¼Œé€šå¸¸ä½¿ç”¨å­—èŠ‚æµè¿›è¡Œæ“ä½œã€‚

å¦å¤–ï¼Œåœ¨ä½¿ç”¨è½¬æ¢æµæ—¶éœ€è¦æ³¨æ„å­—ç¬¦ç¼–ç çš„é—®é¢˜ã€‚å¦‚æœä¸æŒ‡å®šå­—ç¬¦ç¼–ç ï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„å­—ç¬¦ç¼–ç ï¼Œå¯èƒ½ä¼šå‡ºç°ä¹±ç é—®é¢˜ã€‚å› æ­¤ï¼Œå»ºè®®åœ¨ä½¿ç”¨è½¬æ¢æµæ—¶ï¼Œå§‹ç»ˆæŒ‡å®šæ­£ç¡®çš„å­—ç¬¦ç¼–ç ï¼Œä»¥é¿å…å‡ºç°ä¹±ç é—®é¢˜ã€‚

â€œå°äºŒå•Šï¼Œä½ çœ‹ï¼Œç»è¿‡æˆ‘çš„æ¢³ç†ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰ IO ä¹Ÿæ²¡å¤šå°‘ä¸œè¥¿ï¼é’ˆå¯¹ä¸åŒçš„åœºæ™¯ã€ä¸åŒçš„ä¸šåŠ¡ï¼Œé€‰æ‹©å¯¹åº”çš„ IO æµå°±å¯ä»¥äº†ï¼Œç”¨æ³•ä¸Šå°±æ˜¯è¯»å’Œå†™ã€‚â€è€ç‹ä¸€å£æ°”è®²å®Œè¿™äº›ï¼Œé•¿é•¿çš„èˆ’äº†ä¸€å£æ°”ã€‚

æ­¤æ—¶æ­¤åˆ»çš„å°äºŒï¼Œè¿˜æ²‰æµ¸åœ¨è€ç‹çš„æ»”æ»”ä¸ç»ä¸­ã€‚ä¸ä»…æ„Ÿè§‰è€ç‹çš„è‚ºæ´»é‡æ˜¯çœŸçš„å¤§ï¼Œè¿˜æ„Ÿæ…¨è€ç‹ä¸æ„§æ˜¯å·¥ä½œäº†åå¤šå¹´çš„â€œè€æ²¹æ¡â€ï¼Œä¸€ä¸‹å­å°±æŠŠè‡ªå·±æ„Ÿè§‰å¤´å¤§çš„ IO ç»™æ¢³ç†å¾—å¾ˆæ¸…æ™°äº†ã€‚

---------

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 7.2 æ–‡ä»¶æµ

åœ¨ IO æ“ä½œä¸­ï¼Œæ–‡ä»¶çš„æ“ä½œç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œä½†ä¹Ÿæ˜¯ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬å‡ ä¹æ‰€æœ‰çš„é¡¹ç›®ä¸­å‡ ä¹éƒ½èººç€ä¸€ä¸ªå«åš FileUtil æˆ–è€… FileUtils çš„å·¥å…·ç±»ã€‚

`java.io.File` ç±»æ˜¯ä¸“é—¨å¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œçš„ç±»ï¼Œæ³¨æ„åªèƒ½å¯¹æ–‡ä»¶æœ¬èº«è¿›è¡Œæ“ä½œï¼Œä¸èƒ½å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œæ“ä½œï¼Œæƒ³è¦æ“ä½œå†…å®¹ï¼Œå¿…é¡»å€ŸåŠ©è¾“å…¥è¾“å‡ºæµã€‚

`File` ç±»æ˜¯æ–‡ä»¶å’Œç›®å½•çš„æŠ½è±¡è¡¨ç¤ºï¼Œä¸»è¦ç”¨äºæ–‡ä»¶å’Œç›®å½•çš„åˆ›å»ºã€æŸ¥æ‰¾å’Œåˆ é™¤ç­‰æ“ä½œã€‚

æ€ä¹ˆç†è§£ä¸Šé¢ä¸¤å¥è¯ï¼Ÿå…¶å®å¾ˆç®€å•ï¼

ç¬¬ä¸€å¥æ˜¯è¯´ File è·Ÿæµæ— å…³ï¼ŒFile ç±»ä¸èƒ½å¯¹æ–‡ä»¶è¿›è¡Œè¯»å’Œå†™ï¼Œä¹Ÿå°±æ˜¯è¾“å…¥å’Œè¾“å‡ºï¼

ç¬¬äºŒå¥æ˜¯è¯´ File å¯ä»¥è¡¨ç¤º`D:\\æ–‡ä»¶ç›®å½•1`ä¸`D:\\æ–‡ä»¶ç›®å½•1\\æ–‡ä»¶.txt`ï¼Œå‰è€…æ˜¯æ–‡ä»¶å¤¹ï¼ˆDirectoryï¼Œæˆ–è€…å«ç›®å½•ï¼‰åè€…æ˜¯æ–‡ä»¶(file)ï¼ŒFile ç±»å°±æ˜¯ç”¨æ¥æ“ä½œå®ƒä¿©çš„ã€‚

### File æ„é€ æ–¹æ³•

åœ¨ Java ä¸­ï¼Œä¸€åˆ‡çš†æ˜¯å¯¹è±¡ï¼ŒFile ç±»ä¹Ÿä¸ä¾‹å¤–ï¼Œä¸è®ºæ˜¯å“ªä¸ªå¯¹è±¡éƒ½åº”è¯¥ä»è¯¥å¯¹è±¡çš„æ„é€ è¯´èµ·ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥åˆ†æåˆ†æ`File`ç±»çš„æ„é€ æ–¹æ³•ã€‚

æ¯”è¾ƒå¸¸ç”¨çš„æ„é€ æ–¹æ³•æœ‰ä¸‰ä¸ªï¼š

1ã€ `File(String pathname)` ï¼šé€šè¿‡ç»™å®šçš„**è·¯å¾„**æ¥åˆ›å»ºæ–°çš„ File å®ä¾‹ã€‚

2ã€ `File(String parent, String child)` ï¼šä»**çˆ¶è·¯å¾„ï¼ˆå­—ç¬¦ä¸²ï¼‰å’Œå­è·¯å¾„**åˆ›å»ºæ–°çš„ File å®ä¾‹ã€‚

3ã€ `File(File parent, String child)` ï¼šä»**çˆ¶è·¯å¾„ï¼ˆFileï¼‰å’Œå­è·¯å¾„åå­—ç¬¦ä¸²**åˆ›å»ºæ–°çš„ File å®ä¾‹ã€‚

çœ‹æ–‡å­—æè¿°ä¸å¤Ÿç”ŸåŠ¨ã€ä¸å¤Ÿå½¢è±¡ã€ä¸å¾—åŠ²ï¼Ÿæ²¡äº‹ï¼Œé€šè¿‡ä¸¾ä¾‹é©¬ä¸Šå°±ç”ŸåŠ¨å½¢è±¡äº†ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
// æ–‡ä»¶è·¯å¾„å
String path = "/Users/username/123.txt";
File file1 = new File(path);
// æ–‡ä»¶è·¯å¾„å
String path2 = "/Users/username/1/2.txt";
File file2 = new File(path2); -------------ç›¸å½“äº/Users/username/1/2.txt
// é€šè¿‡çˆ¶è·¯å¾„å’Œå­è·¯å¾„å­—ç¬¦ä¸²
String parent = "/Users/username/aaa";
String child = "bbb.txt";
File file3 = new File(parent, child); --------ç›¸å½“äº/Users/username/aaa/bbb.txt
// é€šè¿‡çˆ¶çº§Fileå¯¹è±¡å’Œå­è·¯å¾„å­—ç¬¦ä¸²
File parentDir = new File("/Users/username/aaa");
String child = "bbb.txt";
File file4 = new File(parentDir, child); --------ç›¸å½“äº/Users/username/aaa/bbb.txt
```

æ³¨æ„ï¼ŒmacOS è·¯å¾„ä½¿ç”¨æ­£æ–œæ ï¼ˆ`/`ï¼‰ä½œä¸ºè·¯å¾„åˆ†éš”ç¬¦ï¼Œè€Œ Windows è·¯å¾„ä½¿ç”¨åæ–œæ ï¼ˆ`\`ï¼‰ä½œä¸ºè·¯å¾„åˆ†éš”ç¬¦ã€‚æ‰€ä»¥åœ¨é‡åˆ°è·¯å¾„åˆ†éš”ç¬¦çš„æ—¶å€™ï¼Œä¸è¦ç›´æ¥å»å†™`/`æˆ–è€…`\`ã€‚

Java ä¸­æä¾›äº†ä¸€ä¸ªè·¨å¹³å°çš„æ–¹æ³•æ¥è·å–è·¯å¾„åˆ†éš”ç¬¦ï¼Œå³ä½¿ç”¨ `File.separator`ï¼Œè¿™ä¸ªå±æ€§ä¼šæ ¹æ®æ“ä½œç³»ç»Ÿè‡ªåŠ¨è¿”å›æ­£ç¡®çš„è·¯å¾„åˆ†éš”ç¬¦ã€‚

File ç±»çš„æ³¨æ„ç‚¹ï¼š

1.  ä¸€ä¸ª File å¯¹è±¡ä»£è¡¨ç¡¬ç›˜ä¸­å®é™…å­˜åœ¨çš„ä¸€ä¸ªæ–‡ä»¶æˆ–è€…ç›®å½•ã€‚
2.  File ç±»çš„æ„é€ æ–¹æ³•ä¸ä¼šæ£€éªŒè¿™ä¸ªæ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦çœŸå®å­˜åœ¨ï¼Œå› æ­¤æ— è®ºè¯¥è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨æ–‡ä»¶æˆ–è€…ç›®å½•ï¼Œéƒ½ä¸å½±å“ File å¯¹è±¡çš„åˆ›å»ºã€‚

### File å¸¸ç”¨æ–¹æ³•

File çš„å¸¸ç”¨æ–¹æ³•ä¸»è¦åˆ†ä¸ºè·å–åŠŸèƒ½ã€è·å–ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„ã€åˆ¤æ–­åŠŸèƒ½ã€åˆ›å»ºåˆ é™¤åŠŸèƒ½çš„æ–¹æ³•ã€‚

#### **1ï¼‰è·å–åŠŸèƒ½çš„æ–¹æ³•**

1ã€`getAbsolutePath()` ï¼šè¿”å›æ­¤ File çš„ç»å¯¹è·¯å¾„ã€‚

2ã€`getPath()` ï¼šç»“æœå’Œ getAbsolutePath ä¸€è‡´ã€‚

3ã€`getName()` ï¼šè¿”å›æ–‡ä»¶åæˆ–ç›®å½•åã€‚

4ã€`length()` ï¼šè¿”å›æ–‡ä»¶é•¿åº¦ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚

æµ‹è¯•ä»£ç å¦‚ä¸‹ã€æ³¨æ„æµ‹è¯•ä»¥ä½ è‡ªå·±çš„ç”µè„‘æ–‡ä»¶å¤¹ä¸ºå‡†ã€‘ï¼š

```java
File f = new File("/Users/username/aaa/bbb.java");
System.out.println("æ–‡ä»¶ç»å¯¹è·¯å¾„:"+f.getAbsolutePath());
System.out.println("æ–‡ä»¶æ„é€ è·¯å¾„:"+f.getPath());
System.out.println("æ–‡ä»¶åç§°:"+f.getName());
System.out.println("æ–‡ä»¶é•¿åº¦:"+f.length()+"å­—èŠ‚");

File f2 = new File("/Users/username/aaa");
System.out.println("ç›®å½•ç»å¯¹è·¯å¾„:"+f2.getAbsolutePath());
System.out.println("ç›®å½•æ„é€ è·¯å¾„:"+f2.getPath());
System.out.println("ç›®å½•åç§°:"+f2.getName());
System.out.println("ç›®å½•é•¿åº¦:"+f2.length());
```

æ³¨æ„ï¼š`length()` è¡¨ç¤ºæ–‡ä»¶çš„é•¿åº¦ï¼Œ`File` å¯¹è±¡è¡¨ç¤ºç›®å½•çš„æ—¶å€™ï¼Œè¿”å›å€¼å¹¶æ— æ„ä¹‰ã€‚

#### **2ï¼‰ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„**

ç»å¯¹è·¯å¾„æ˜¯ä»æ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•å¼€å§‹çš„å®Œæ•´è·¯å¾„ï¼Œå®ƒæè¿°äº†ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ç¡®åˆ‡ä½ç½®ã€‚åœ¨ Windows ç³»ç»Ÿä¸­ï¼Œç»å¯¹è·¯å¾„é€šå¸¸ä»¥ç›˜ç¬¦ï¼ˆå¦‚ C:ï¼‰å¼€å§‹ï¼Œä¾‹å¦‚ "`C:\Program Files\Java\jdk1.8.0_291\bin\java.exe`"ã€‚åœ¨ macOS å’Œ Linux ç³»ç»Ÿä¸­ï¼Œç»å¯¹è·¯å¾„é€šå¸¸ä»¥æ–œæ ï¼ˆ`/`ï¼‰å¼€å§‹ï¼Œä¾‹å¦‚ "`/usr/local/bin/python3`"ã€‚

ç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹äºå½“å‰å·¥ä½œç›®å½•çš„è·¯å¾„ï¼Œå®ƒæè¿°äº†ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•ä¸å½“å‰å·¥ä½œç›®å½•ä¹‹é—´çš„ä½ç½®å…³ç³»ã€‚åœ¨ Java ä¸­ï¼Œç›¸å¯¹è·¯å¾„é€šå¸¸æ˜¯ç›¸å¯¹äºå½“å‰ Java ç¨‹åºæ‰€åœ¨çš„ç›®å½•ï¼Œä¾‹å¦‚ "`config/config.properties`"ã€‚å¦‚æœå½“å‰å·¥ä½œç›®å½•æ˜¯ "`/Users/username/project`"ï¼Œé‚£ä¹ˆç›¸å¯¹è·¯å¾„ "`config/config.properties`" å°±è¡¨ç¤º "`/Users/username/project/config/config.properties`"ã€‚

æ³¨æ„ï¼š

- åœ¨ Windows æ“ä½œç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶ç³»ç»Ÿé»˜è®¤æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œå³åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶åå’Œè·¯å¾„çš„å¤§å°å†™å¯ä»¥æ··åˆä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œ"`C:\Users\username\Documents\example.txt`" å’Œ "`C:\Users\Username\Documents\Example.txt`" è¡¨ç¤ºçš„æ˜¯åŒä¸€ä¸ªæ–‡ä»¶ã€‚ä½†æ˜¯ï¼ŒWindows æ“ä½œç³»ç»Ÿæä¾›äº†ä¸€ä¸ªåŒºåˆ†å¤§å°å†™çš„é€‰é¡¹ï¼Œå¯ä»¥åœ¨æ ¼å¼åŒ–ç£ç›˜æ—¶é€‰æ‹©å¯ç”¨ï¼Œè¿™æ ·æ–‡ä»¶ç³»ç»Ÿå°±ä¼šåŒºåˆ†å¤§å°å†™ã€‚
- åœ¨ macOS å’Œ Linux ç­‰ Unix ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶ç³»ç»Ÿé»˜è®¤æ˜¯åŒºåˆ†å¤§å°å†™çš„ã€‚ä¾‹å¦‚ï¼Œåœ¨ macOS ç³»ç»Ÿä¸­ï¼Œ"`/Users/username/Documents/example.txt`" å’Œ "`/Users/username/Documents/Example.txt`" è¡¨ç¤ºçš„æ˜¯ä¸¤ä¸ªä¸åŒçš„æ–‡ä»¶ã€‚

```java
// ç»å¯¹è·¯å¾„ç¤ºä¾‹
File absoluteFile = new File("/Users/username/example/test.txt");
System.out.println("ç»å¯¹è·¯å¾„ï¼š" + absoluteFile.getAbsolutePath());

// ç›¸å¯¹è·¯å¾„ç¤ºä¾‹
File relativeFile = new File("example/test.txt");
System.out.println("ç›¸å¯¹è·¯å¾„ï¼š" + relativeFile.getPath());
```

#### **3ï¼‰åˆ¤æ–­åŠŸèƒ½çš„æ–¹æ³•**

1ã€ `exists()` ï¼šåˆ¤æ–­æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨ã€‚

2ã€ `isDirectory()` ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºç›®å½•ã€‚

3ã€`isFile()` ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºæ–‡ä»¶ã€‚

æ–¹æ³•æ¼”ç¤ºï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
File file = new File("/Users/username/example");

// åˆ¤æ–­æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨
if (file.exists()) {
    System.out.println("æ–‡ä»¶æˆ–ç›®å½•å­˜åœ¨");
} else {
    System.out.println("æ–‡ä»¶æˆ–ç›®å½•ä¸å­˜åœ¨");
}

// åˆ¤æ–­æ˜¯å¦æ˜¯ç›®å½•
if (file.isDirectory()) {
    System.out.println("æ˜¯ç›®å½•");
} else {
    System.out.println("ä¸æ˜¯ç›®å½•");
}

// åˆ¤æ–­æ˜¯å¦æ˜¯æ–‡ä»¶
if (file.isFile()) {
    System.out.println("æ˜¯æ–‡ä»¶");
} else {
    System.out.println("ä¸æ˜¯æ–‡ä»¶");
}
```

#### **4ï¼‰åˆ›å»ºã€åˆ é™¤åŠŸèƒ½çš„æ–¹æ³•**

- `createNewFile()` ï¼šæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºæ–‡ä»¶å¹¶è¿”å›`true`ï¼Œæ–‡ä»¶å­˜åœ¨ï¼Œä¸åˆ›å»ºæ–‡ä»¶å¹¶è¿”å›`false`ã€‚
- `delete()` ï¼šåˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ã€‚å¦‚æœæ˜¯ç›®å½•ï¼Œåªæœ‰ç›®å½•ä¸ºç©ºæ‰èƒ½åˆ é™¤ã€‚
- `mkdir()` ï¼šåªèƒ½åˆ›å»ºä¸€çº§ç›®å½•ï¼Œå¦‚æœçˆ¶ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå¤±è´¥ã€‚è¿”å› true è¡¨ç¤ºåˆ›å»ºæˆåŠŸï¼Œè¿”å› false è¡¨ç¤ºåˆ›å»ºå¤±è´¥ã€‚
- `mkdirs()` ï¼šå¯ä»¥åˆ›å»ºå¤šçº§ç›®å½•ï¼Œå¦‚æœçˆ¶ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™ä¼šä¸€å¹¶åˆ›å»ºã€‚è¿”å› true è¡¨ç¤ºåˆ›å»ºæˆåŠŸï¼Œè¿”å› false è¡¨ç¤ºåˆ›å»ºå¤±è´¥æˆ–ç›®å½•å·²ç»å­˜åœ¨ã€‚

**å¼€å‘ä¸­ä¸€èˆ¬ç”¨**`mkdirs()`;

æ–¹æ³•æµ‹è¯•ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
// åˆ›å»ºæ–‡ä»¶
File file = new File("/Users/username/example/test.txt");
if (file.createNewFile()) {
    System.out.println("åˆ›å»ºæ–‡ä»¶æˆåŠŸï¼š" + file.getAbsolutePath());
} else {
    System.out.println("åˆ›å»ºæ–‡ä»¶å¤±è´¥ï¼š" + file.getAbsolutePath());
}

// åˆ é™¤æ–‡ä»¶
if (file.delete()) {
    System.out.println("åˆ é™¤æ–‡ä»¶æˆåŠŸï¼š" + file.getAbsolutePath());
} else {
    System.out.println("åˆ é™¤æ–‡ä»¶å¤±è´¥ï¼š" + file.getAbsolutePath());
}

// åˆ›å»ºå¤šçº§ç›®å½•
File directory = new File("/Users/username/example/subdir1/subdir2");
if (directory.mkdirs()) {
    System.out.println("åˆ›å»ºç›®å½•æˆåŠŸï¼š" + directory.getAbsolutePath());
} else {
    System.out.println("åˆ›å»ºç›®å½•å¤±è´¥ï¼š" + directory.getAbsolutePath());
}
```

#### 5ï¼‰ç›®å½•çš„éå†

- `String[] list()` ï¼šè¿”å›ä¸€ä¸ª String æ•°ç»„ï¼Œè¡¨ç¤ºè¯¥ File ç›®å½•ä¸­çš„æ‰€æœ‰å­æ–‡ä»¶æˆ–ç›®å½•ã€‚
- `File[] listFiles()` ï¼šè¿”å›ä¸€ä¸ª File æ•°ç»„ï¼Œè¡¨ç¤ºè¯¥ File ç›®å½•ä¸­çš„æ‰€æœ‰çš„å­æ–‡ä»¶æˆ–ç›®å½•ã€‚

```java
File directory = new File("/Users/itwanger/Documents/Github/paicoding");

// åˆ—å‡ºç›®å½•ä¸‹çš„æ–‡ä»¶å
String[] files = directory.list();
System.out.println("ç›®å½•ä¸‹çš„æ–‡ä»¶åï¼š");
for (String file : files) {
    System.out.println(file);
}

// åˆ—å‡ºç›®å½•ä¸‹çš„æ–‡ä»¶å’Œå­ç›®å½•
File[] filesAndDirs = directory.listFiles();
System.out.println("ç›®å½•ä¸‹çš„æ–‡ä»¶å’Œå­ç›®å½•ï¼š");
for (File fileOrDir : filesAndDirs) {
    if (fileOrDir.isFile()) {
        System.out.println("æ–‡ä»¶ï¼š" + fileOrDir.getName());
    } else if (fileOrDir.isDirectory()) {
        System.out.println("ç›®å½•ï¼š" + fileOrDir.getName());
    }
}
```

**listFiles**åœ¨è·å–æŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶æˆ–è€…å­ç›®å½•æ—¶å¿…é¡»æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ï¼š

- 1. **æŒ‡å®šçš„ç›®å½•å¿…é¡»å­˜åœ¨**
- 2. **æŒ‡å®šçš„å¿…é¡»æ˜¯ç›®å½•ã€‚å¦åˆ™å®¹æ˜“å¼•å‘ NullPointerException å¼‚å¸¸**

#### 6ï¼‰é€’å½’éå†

ä¸è¯´å•¥äº†ï¼Œç›´æ¥ä¸Šä»£ç ï¼š

```java
public static void main(String[] args) {
    File directory = new File("/Users/itwanger/Documents/Github/paicoding");

    // é€’å½’éå†ç›®å½•ä¸‹çš„æ–‡ä»¶å’Œå­ç›®å½•
    traverseDirectory(directory);
}

public static void traverseDirectory(File directory) {
    // åˆ—å‡ºç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•
    File[] filesAndDirs = directory.listFiles();

    // éå†æ¯ä¸ªæ–‡ä»¶å’Œå­ç›®å½•
    for (File fileOrDir : filesAndDirs) {
        if (fileOrDir.isFile()) {
            // å¦‚æœæ˜¯æ–‡ä»¶ï¼Œè¾“å‡ºæ–‡ä»¶å
            System.out.println("æ–‡ä»¶ï¼š" + fileOrDir.getName());
        } else if (fileOrDir.isDirectory()) {
            // å¦‚æœæ˜¯ç›®å½•ï¼Œé€’å½’éå†å­ç›®å½•
            System.out.println("ç›®å½•ï¼š" + fileOrDir.getName());
            traverseDirectory(fileOrDir);
        }
    }
}
```

### RandomAccessFile

RandomAccessFile æ˜¯ Java ä¸­ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„ç±»ï¼Œå®ƒæ—¢å¯ä»¥ç”¨æ¥è¯»å–æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å†™å…¥æ–‡ä»¶ã€‚ä¸å…¶ä»– IO ç±»ï¼ˆå¦‚ FileInputStream å’Œ FileOutputStreamï¼‰ä¸åŒï¼ŒRandomAccessFile å…è®¸æ‚¨è·³è½¬åˆ°æ–‡ä»¶çš„ä»»ä½•ä½ç½®ï¼Œä»é‚£é‡Œå¼€å§‹è¯»å–æˆ–å†™å…¥ã€‚è¿™ä½¿å¾—å®ƒç‰¹åˆ«é€‚ç”¨äºéœ€è¦åœ¨æ–‡ä»¶ä¸­éšæœºè®¿é—®æ•°æ®çš„åœºæ™¯ï¼Œå¦‚æ•°æ®åº“ç³»ç»Ÿã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ RandomAccessFile çš„ç¤ºä¾‹ï¼ŒåŒ…æ‹¬å†™å…¥å’Œè¯»å–æ–‡ä»¶ï¼š

```java
import java.io.IOException;
import java.io.RandomAccessFile;

public class RandomAccessFileDemo {

    public static void main(String[] args) {
        String filePath = "logs/javabetter/itwanger.txt";

        try {
            // ä½¿ç”¨ RandomAccessFile å†™å…¥æ–‡ä»¶
            writeToFile(filePath, "Hello, æ²‰é»˜ç‹äºŒ!");

            // ä½¿ç”¨ RandomAccessFile è¯»å–æ–‡ä»¶
            String content = readFromFile(filePath);
            System.out.println("æ–‡ä»¶å†…å®¹: " + content);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    private static void writeToFile(String filePath, String content) throws IOException {
        try (RandomAccessFile randomAccessFile = new RandomAccessFile(filePath, "rw")) {
            // å°†æ–‡ä»¶æŒ‡é’ˆç§»åŠ¨åˆ°æ–‡ä»¶æœ«å°¾ï¼ˆåœ¨æ­¤å¤„è¿½åŠ å†…å®¹ï¼‰
            randomAccessFile.seek(randomAccessFile.length());

            // å†™å…¥å†…å®¹
            randomAccessFile.writeUTF(content);
        }
    }

    private static String readFromFile(String filePath) throws IOException {
        StringBuilder content = new StringBuilder();

        try (RandomAccessFile randomAccessFile = new RandomAccessFile(filePath, "r")) {
            // å°†æ–‡ä»¶æŒ‡é’ˆç§»åŠ¨åˆ°æ–‡ä»¶å¼€å§‹å¤„ï¼ˆä»å¤´å¼€å§‹è¯»å–ï¼‰
            randomAccessFile.seek(0);

            content.append(randomAccessFile.readUTF());
        }

        return content.toString();
    }
}
```

ä¸ºäº†é¿å…ä¸­æ–‡ä¹±ç é—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨ RandomAccessFile çš„ writeUTF å’Œ readUTF æ–¹æ³•ï¼Œå®ƒä»¬å°†ä½¿ç”¨ UTF-8 ç¼–ç å¤„ç†å­—ç¬¦ä¸²ã€‚å¤§å®¶å¯ä»¥è¿è¡Œä¸€ä¸‹è¿™æ®µä»£ç ï¼Œä½“éªŒä¸€ä¸‹ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/file-path-20230331193604.png)

æ¥ä¸‹æ¥ï¼Œä¼šè¯¦ç»†ä»‹ç»ä¸€ä¸‹ RandomAccessFile çš„æ„é€ æ–¹æ³•å’Œå¸¸ç”¨çš„æ–¹æ³•ã€‚

#### æ„é€ æ–¹æ³•

RandomAccessFile ä¸»è¦æœ‰ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼š

- `RandomAccessFile(File file, String mode)`ï¼šä½¿ç”¨ç»™å®šçš„æ–‡ä»¶å¯¹è±¡å’Œè®¿é—®æ¨¡å¼åˆ›å»ºä¸€ä¸ªæ–°çš„ RandomAccessFile å®ä¾‹ã€‚
- `RandomAccessFile(String name, String mode)`ï¼šä½¿ç”¨ç»™å®šçš„æ–‡ä»¶åå’Œè®¿é—®æ¨¡å¼åˆ›å»ºä¸€ä¸ªæ–°çš„ RandomAccessFile å®ä¾‹ã€‚

è®¿é—®æ¨¡å¼ mode çš„å€¼å¯ä»¥æ˜¯ï¼š

- "r"ï¼šä»¥åªè¯»æ¨¡å¼æ‰“å¼€æ–‡ä»¶ã€‚è°ƒç”¨ç»“æœå¯¹è±¡çš„ä»»ä½• write æ–¹æ³•éƒ½å°†å¯¼è‡´ IOExceptionã€‚
- "rw"ï¼šä»¥è¯»å†™æ¨¡å¼æ‰“å¼€æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå®ƒå°†è¢«åˆ›å»ºã€‚
- "rws"ï¼šä»¥è¯»å†™æ¨¡å¼æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶è¦æ±‚å¯¹å†…å®¹æˆ–å…ƒæ•°æ®çš„æ¯ä¸ªæ›´æ–°éƒ½è¢«ç«‹å³å†™å…¥åˆ°åº•å±‚å­˜å‚¨è®¾å¤‡ã€‚è¿™ç§æ¨¡å¼æ˜¯åŒæ­¥çš„ï¼Œå¯ä»¥ç¡®ä¿åœ¨ç³»ç»Ÿå´©æºƒæ—¶ä¸ä¼šä¸¢å¤±æ•°æ®ã€‚
- "rwd"ï¼šä¸â€œrwsâ€ç±»ä¼¼ï¼Œä»¥è¯»å†™æ¨¡å¼æ‰“å¼€æ–‡ä»¶ï¼Œä½†ä»…è¦æ±‚å¯¹æ–‡ä»¶å†…å®¹çš„æ›´æ–°è¢«ç«‹å³å†™å…¥ã€‚å…ƒæ•°æ®å¯èƒ½ä¼šè¢«å»¶è¿Ÿå†™å…¥ã€‚

#### ä¸»è¦æ–¹æ³•

- `long getFilePointer()`ï¼šè¿”å›æ–‡ä»¶æŒ‡é’ˆçš„å½“å‰ä½ç½®ã€‚
- `long length()`ï¼šè¿”å›æ­¤æ–‡ä»¶çš„é•¿åº¦ã€‚
- `int read()`ï¼šä»è¯¥æ–‡ä»¶ä¸­è¯»å–ä¸€ä¸ªå­—èŠ‚æ•°æ®ã€‚
- `int read(byte[] b)`ï¼šä»è¯¥æ–‡ä»¶ä¸­è¯»å–å­—èŠ‚æ•°æ®å¹¶å°†å…¶å­˜å‚¨åˆ°æŒ‡å®šçš„å­—èŠ‚æ•°ç»„ä¸­ã€‚
- `int read(byte[] b, int off, int len)`ï¼šä»è¯¥æ–‡ä»¶ä¸­è¯»å–å­—èŠ‚æ•°æ®å¹¶å°†å…¶å­˜å‚¨åˆ°æŒ‡å®šçš„å­—èŠ‚æ•°ç»„ä¸­ï¼Œä»åç§»é‡ off å¼€å§‹ï¼Œæœ€å¤šè¯»å– len ä¸ªå­—èŠ‚ã€‚
- `String readLine()`ï¼šä»è¯¥æ–‡ä»¶ä¸­è¯»å–ä¸€è¡Œæ–‡æœ¬ã€‚
- `readUTF()`ï¼šä»æ–‡ä»¶è¯»å– UTF-8 ç¼–ç çš„å­—ç¬¦ä¸²ã€‚æ­¤æ–¹æ³•é¦–å…ˆè¯»å–ä¸¤ä¸ªå­—èŠ‚çš„é•¿åº¦ä¿¡æ¯ï¼Œç„¶åæ ¹æ®è¿™ä¸ªé•¿åº¦è¯»å–å­—ç¬¦ä¸²çš„ UTF-8 å­—èŠ‚ã€‚æœ€åï¼Œè¿™äº›å­—èŠ‚è¢«è½¬æ¢ä¸º Java å­—ç¬¦ä¸²ã€‚è¿™æ„å‘³ç€å½“ä½ ä½¿ç”¨ readUTF æ–¹æ³•è¯»å–å­—ç¬¦ä¸²æ—¶ï¼Œéœ€è¦ç¡®ä¿æ–‡ä»¶ä¸­çš„å­—ç¬¦ä¸²æ˜¯ä½¿ç”¨ writeUTF æ–¹æ³•å†™å…¥çš„ï¼Œè¿™æ ·å®ƒä»¬ä¹‹é—´çš„é•¿åº¦ä¿¡æ¯å’Œç¼–ç æ–¹å¼æ‰èƒ½ä¿æŒä¸€è‡´ã€‚
- `void seek(long pos)`ï¼šå°†æ–‡ä»¶æŒ‡é’ˆè®¾ç½®åˆ°æ–‡ä»¶ä¸­çš„ pos ä½ç½®ã€‚
- `void write(byte[] b)`ï¼šå°†æŒ‡å®šçš„å­—èŠ‚æ•°ç»„çš„æ‰€æœ‰å­—èŠ‚å†™å…¥è¯¥æ–‡ä»¶ã€‚
- `void write(byte[] b, int off, int len)`ï¼šå°†æŒ‡å®šå­—èŠ‚æ•°ç»„çš„éƒ¨åˆ†å­—èŠ‚å†™å…¥è¯¥æ–‡ä»¶ï¼Œä»åç§»é‡ off å¼€å§‹ï¼Œå†™å…¥ len ä¸ªå­—èŠ‚ã€‚
- `void write(int b)`ï¼šå°†æŒ‡å®šçš„å­—èŠ‚å†™å…¥è¯¥æ–‡ä»¶ã€‚
- `writeUTF(String str)`ï¼šå°†ä¸€ä¸ªå­—ç¬¦ä¸²ä»¥ UTF-8 ç¼–ç å†™å…¥æ–‡ä»¶ã€‚æ­¤æ–¹æ³•é¦–å…ˆå†™å…¥ä¸¤ä¸ªå­—èŠ‚çš„é•¿åº¦ä¿¡æ¯ï¼Œè¡¨ç¤ºå­—ç¬¦ä¸²çš„ UTF-8 å­—èŠ‚é•¿åº¦ï¼Œç„¶åå†™å…¥ UTF-8 å­—èŠ‚æœ¬èº«ã€‚å› æ­¤ï¼Œå½“ä½ ä½¿ç”¨ writeUTF å†™å…¥å­—ç¬¦ä¸²æ—¶ï¼Œå®é™…å†™å…¥çš„å­—èŠ‚æ•°ä¼šæ¯”å­—ç¬¦ä¸²çš„ UTF-8 å­—èŠ‚é•¿åº¦å¤šä¸¤ä¸ªå­—èŠ‚ã€‚è¿™ä¸¤ä¸ªå­—èŠ‚ç”¨äºåœ¨è¯»å–å­—ç¬¦ä¸²æ—¶ç¡®å®šæ­£ç¡®çš„å­—ç¬¦ä¸²é•¿åº¦ã€‚

å†æ¥çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼Œç»“åˆå‰é¢çš„è®²è§£ï¼Œå°±ä¼šå½»åº•æŒæ¡ RandomAccessFileã€‚

```java
File file = new File("logs/javabetter/itwanger.txt");

try (RandomAccessFile raf = new RandomAccessFile(file, "rw")) {
    // å†™å…¥æ–‡ä»¶
    raf.writeUTF("Hello, æ²‰é»˜ç‹äºŒ!");

    // å°†æ–‡ä»¶æŒ‡é’ˆç§»åŠ¨åˆ°æ–‡ä»¶å¼€å¤´
    raf.seek(0);

    // è¯»å–æ–‡ä»¶å†…å®¹
    String content = raf.readUTF();
    System.out.println("å†…å®¹: " + content);

} catch (IOException e) {
    e.printStackTrace();
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªåä¸º itwanger.txt çš„æ–‡ä»¶å¯¹è±¡ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨ RandomAccessFile ä»¥è¯»å†™æ¨¡å¼æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ writeUTF æ–¹æ³•å°†å­—ç¬¦ä¸²"Hello, æ²‰é»˜ç‹äºŒ!"å†™å…¥æ–‡ä»¶ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ seek æ–¹æ³•å°†æ–‡ä»¶æŒ‡é’ˆç§»åŠ¨åˆ°æ–‡ä»¶å¼€å¤´ï¼Œå¹¶ä½¿ç”¨ readUTF æ–¹æ³•è¯»å–æ–‡ä»¶å†…å®¹ã€‚è¾“å‡ºåº”è¯¥æ˜¯"Hello, æ²‰é»˜ç‹äºŒ!"ã€‚

æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨[try-with-resources](https://tobebetterjavaer.com/exception/try-with-resources.html)è¯­å¥ç¡®ä¿ RandomAccessFile åœ¨æ“ä½œå®Œæˆåè¢«æ­£ç¡®å…³é—­ã€‚

### Apache FileUtils ç±»

FileUtils ç±»æ˜¯ Apache Commons IO åº“ä¸­çš„ä¸€ä¸ªç±»ï¼Œæä¾›äº†ä¸€äº›æ›´ä¸ºæ–¹ä¾¿çš„æ–¹æ³•æ¥æ“ä½œæ–‡ä»¶æˆ–ç›®å½•ã€‚

#### **1ï¼‰å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•ï¼š**

```java
File srcFile = new File("path/to/src/file");
File destFile = new File("path/to/dest/file");
// å¤åˆ¶æ–‡ä»¶
FileUtils.copyFile(srcFile, destFile);
// å¤åˆ¶ç›®å½•
FileUtils.copyDirectory(srcFile, destFile);
```

#### **2ï¼‰åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ï¼š**

```java
File file = new File("path/to/file");
// åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•
FileUtils.delete(file);
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¦åˆ é™¤ä¸€ä¸ªéç©ºç›®å½•ï¼Œéœ€è¦å…ˆåˆ é™¤ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•ã€‚

#### **3ï¼‰ç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•ï¼š**

```java
File srcFile = new File("path/to/src/file");
File destFile = new File("path/to/dest/file");
// ç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•
FileUtils.moveFile(srcFile, destFile);
```

#### **4ï¼‰æŸ¥è¯¢æ–‡ä»¶æˆ–ç›®å½•çš„ä¿¡æ¯ï¼š**

```java
File file = new File("path/to/file");
// è·å–æ–‡ä»¶æˆ–ç›®å½•çš„ä¿®æ”¹æ—¶é—´
Date modifyTime = FileUtils.lastModified(file);
// è·å–æ–‡ä»¶æˆ–ç›®å½•çš„å¤§å°
long size = FileUtils.sizeOf(file);
// è·å–æ–‡ä»¶æˆ–ç›®å½•çš„æ‰©å±•å
String extension = FileUtils.getExtension(file.getName());
```

### Hutool FileUtil ç±»

FileUtil ç±»æ˜¯ [Hutool](https://hutool.cn) å·¥å…·åŒ…ä¸­çš„æ–‡ä»¶æ“ä½œå·¥å…·ç±»ï¼Œæä¾›äº†ä¸€ç³»åˆ—ç®€å•æ˜“ç”¨çš„æ–‡ä»¶æ“ä½œæ–¹æ³•ï¼Œå¯ä»¥å¸®åŠ© Java å¼€å‘è€…å¿«é€Ÿå®Œæˆæ–‡ä»¶ç›¸å…³çš„æ“ä½œä»»åŠ¡ã€‚

FileUtil ç±»åŒ…å«ä»¥ä¸‹å‡ ç±»æ“ä½œå·¥å…·ï¼š

- æ–‡ä»¶æ“ä½œï¼šåŒ…æ‹¬æ–‡ä»¶ç›®å½•çš„æ–°å»ºã€åˆ é™¤ã€å¤åˆ¶ã€ç§»åŠ¨ã€æ”¹åç­‰
- æ–‡ä»¶åˆ¤æ–­ï¼šåˆ¤æ–­æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦éç©ºï¼Œæ˜¯å¦ä¸ºç›®å½•ï¼Œæ˜¯å¦ä¸ºæ–‡ä»¶ç­‰ç­‰ã€‚
- ç»å¯¹è·¯å¾„ï¼šé’ˆå¯¹ ClassPath ä¸­çš„æ–‡ä»¶è½¬æ¢ä¸ºç»å¯¹è·¯å¾„æ–‡ä»¶ã€‚
- æ–‡ä»¶åï¼šä¸»æ–‡ä»¶åï¼Œæ‰©å±•åçš„è·å–
- è¯»æ“ä½œï¼šåŒ…æ‹¬ getReaderã€readXXX æ“ä½œ
- å†™æ“ä½œï¼šåŒ…æ‹¬ getWriterã€writeXXX æ“ä½œ

ä¸‹é¢æ˜¯ FileUtil ç±»ä¸­ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•ï¼š

1ã€copyFileï¼šå¤åˆ¶æ–‡ä»¶ã€‚è¯¥æ–¹æ³•å¯ä»¥å°†æŒ‡å®šçš„æºæ–‡ä»¶å¤åˆ¶åˆ°æŒ‡å®šçš„ç›®æ ‡æ–‡ä»¶ä¸­ã€‚

```java
File dest = FileUtil.file("FileUtilDemo2.java");
```

2ã€moveï¼šç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•ã€‚è¯¥æ–¹æ³•å¯ä»¥å°†æŒ‡å®šçš„æºæ–‡ä»¶æˆ–ç›®å½•ç§»åŠ¨åˆ°æŒ‡å®šçš„ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•ä¸­ã€‚

```java
FileUtil.move(file, dest, true);
```

3ã€delï¼šåˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ã€‚è¯¥æ–¹æ³•å¯ä»¥åˆ é™¤æŒ‡å®šçš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¦‚æœæŒ‡å®šçš„æ–‡ä»¶æˆ–ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

```java
FileUtil.del(file);
```

4ã€renameï¼šé‡å‘½åæ–‡ä»¶æˆ–ç›®å½•ã€‚è¯¥æ–¹æ³•å¯ä»¥å°†æŒ‡å®šçš„æ–‡ä»¶æˆ–ç›®å½•é‡å‘½åä¸ºæŒ‡å®šçš„æ–°åç§°ã€‚

```java
FileUtil.rename(file, "FileUtilDemo3.java", true);
```

5ã€readLinesï¼šä»æ–‡ä»¶ä¸­è¯»å–æ¯ä¸€è¡Œæ•°æ®ã€‚

```java
FileUtil.readLines(file, "UTF-8").forEach(System.out::println);
```

æ›´å¤šæ–¹æ³•ï¼Œå¯ä»¥å»çœ‹ä¸€ä¸‹ hutool çš„æºç ï¼Œé‡Œé¢æœ‰éå¸¸å¤šå®ç”¨çš„æ–¹æ³•ï¼Œå¤šçœ‹çœ‹ï¼Œç»å¯¹èƒ½æå‡ä¸å°‘ç¼–ç¨‹æ°´å¹³ã€‚

---

æœ€è¿‘æ•´ç†äº†ä¸€ä»½ç‰›é€¼çš„å­¦ä¹ èµ„æ–™ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº Java åŸºç¡€éƒ¨åˆ†ï¼ˆJVMã€Java é›†åˆæ¡†æ¶ã€å¤šçº¿ç¨‹ï¼‰ï¼Œè¿˜å›Šæ‹¬äº† **æ•°æ®åº“ã€è®¡ç®—æœºç½‘ç»œã€ç®—æ³•ä¸æ•°æ®ç»“æ„ã€è®¾è®¡æ¨¡å¼ã€æ¡†æ¶ç±» Springã€Nettyã€å¾®æœåŠ¡ï¼ˆDubboï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ ç½‘å…³** ç­‰ç­‰ç­‰ç­‰â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¯ä»¥è¯´æ˜¯ 2022 å¹´å…¨ç½‘æœ€å…¨çš„å­¦ä¹ å’Œæ‰¾å·¥ä½œçš„ PDF èµ„æºäº†](https://tobebetterjavaer.com/pdf/programmer-111.html)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 7.3 å­—èŠ‚æµ

æˆ‘ä»¬å¿…é¡»å¾—æ˜ç¡®ä¸€ç‚¹ï¼Œä¸€åˆ‡æ–‡ä»¶ï¼ˆæ–‡æœ¬ã€è§†é¢‘ã€å›¾ç‰‡ï¼‰çš„æ•°æ®éƒ½æ˜¯ä»¥äºŒè¿›åˆ¶çš„å½¢å¼å­˜å‚¨çš„ï¼Œä¼ è¾“æ—¶ä¹Ÿæ˜¯ã€‚æ‰€ä»¥ï¼Œå­—èŠ‚æµå¯ä»¥ä¼ è¾“ä»»æ„ç±»å‹çš„æ–‡ä»¶æ•°æ®ã€‚

### å­—èŠ‚è¾“å‡ºæµï¼ˆOutputStreamï¼‰

`java.io.OutputStream` æ˜¯**å­—èŠ‚è¾“å‡ºæµ**çš„**è¶…ç±»**ï¼ˆçˆ¶ç±»ï¼‰ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ƒå®šä¹‰çš„ä¸€äº›å…±æ€§æ–¹æ³•ï¼š

1ã€ `close()` ï¼šå…³é—­æ­¤è¾“å‡ºæµå¹¶é‡Šæ”¾ä¸æ­¤æµç›¸å…³è”çš„ç³»ç»Ÿèµ„æºã€‚

2ã€ `flush()` ï¼šåˆ·æ–°æ­¤è¾“å‡ºæµå¹¶å¼ºåˆ¶ç¼“å†²åŒºçš„å­—èŠ‚è¢«å†™å…¥åˆ°ç›®çš„åœ°ã€‚

3ã€ `write(byte[] b)`ï¼šå°† b.length ä¸ªå­—èŠ‚ä»æŒ‡å®šçš„å­—èŠ‚æ•°ç»„å†™å…¥æ­¤è¾“å‡ºæµã€‚

4ã€ `write(byte[] b, int off, int len)` ï¼šä»æŒ‡å®šçš„å­—èŠ‚æ•°ç»„å†™å…¥ len å­—èŠ‚åˆ°æ­¤è¾“å‡ºæµï¼Œä»åç§»é‡ offå¼€å§‹ã€‚ **ä¹Ÿå°±æ˜¯è¯´ä»offä¸ªå­—èŠ‚æ•°å¼€å§‹ä¸€ç›´åˆ°lenä¸ªå­—èŠ‚ç»“æŸ**

### FileOutputStreamç±»

`OutputStream` æœ‰å¾ˆå¤šå­ç±»ï¼Œæˆ‘ä»¬ä»æœ€ç®€å•çš„ä¸€ä¸ªå­ç±» FileOutputStream å¼€å§‹ã€‚çœ‹åå­—å°±çŸ¥é“æ˜¯æ–‡ä»¶è¾“å‡ºæµï¼Œç”¨äºå°†æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ã€‚

#### **1ï¼‰FileOutputStrea çš„æ„é€ æ–¹æ³•**

1ã€ä½¿ç”¨æ–‡ä»¶ååˆ›å»º FileOutputStream å¯¹è±¡ã€‚

```java
String fileName = "example.txt";
FileOutputStream fos = new FileOutputStream(fileName);
```

ä»¥ä¸Šä»£ç ä½¿ç”¨æ–‡ä»¶å "example.txt" åˆ›å»ºä¸€ä¸ª FileOutputStream å¯¹è±¡ï¼Œå°†æ•°æ®å†™å…¥åˆ°è¯¥æ–‡ä»¶ä¸­ã€‚**å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼›å¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™è¦†ç›–åŸæœ‰æ–‡ä»¶**ã€‚

2ã€ä½¿ç”¨æ–‡ä»¶å¯¹è±¡åˆ›å»º FileOutputStream å¯¹è±¡ã€‚

```java
File file = new File("example.txt");
FileOutputStream fos = new FileOutputStream(file);
```

FileOutputStream çš„ä½¿ç”¨ç¤ºä¾‹ï¼š

```java
FileOutputStream fos = null;
try {
  fos = new FileOutputStream("example.txt");
  fos.write("æ²‰é»˜ç‹äºŒ".getBytes());
} catch (IOException e) {
  e.printStackTrace();
} finally {
  if (fos != null) {
    try {
      fos.close();
    } catch (IOException e) {
      e.printStackTrace();
    }
  }
}
```

ä»¥ä¸Šä»£ç åˆ›å»ºäº†ä¸€ä¸ª FileOutputStream å¯¹è±¡ï¼Œå°†å­—ç¬¦ä¸² "æ²‰é»˜ç‹äºŒ" å†™å…¥åˆ° example.txt æ–‡ä»¶ä¸­ï¼Œå¹¶åœ¨æœ€åå…³é—­äº†è¾“å‡ºæµã€‚


#### **2ï¼‰FileOutputStream å†™å…¥å­—èŠ‚æ•°æ®**

ä½¿ç”¨ FileOutputStream å†™å…¥å­—èŠ‚æ•°æ®ä¸»è¦é€šè¿‡ `write` æ–¹æ³•ï¼š

```java
write(int b)
write(byte[] b)
write(byte[] b,int off,int len)  //ä»`off`ç´¢å¼•å¼€å§‹ï¼Œ`len`ä¸ªå­—èŠ‚
```


â‘ ã€**å†™å…¥å­—èŠ‚**ï¼š`write(int b)` æ–¹æ³•ï¼Œæ¯æ¬¡å¯ä»¥å†™å…¥ä¸€ä¸ªå­—èŠ‚ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
// ä½¿ç”¨æ–‡ä»¶åç§°åˆ›å»ºæµå¯¹è±¡
FileOutputStream fos = new FileOutputStream("fos.txt");     
// å†™å‡ºæ•°æ®
fos.write(97); // ç¬¬1ä¸ªå­—èŠ‚
fos.write(98); // ç¬¬2ä¸ªå­—èŠ‚
fos.write(99); // ç¬¬3ä¸ªå­—èŠ‚
// å…³é—­èµ„æº
fos.close();
```

å­—ç¬¦ a çš„ [ASCII å€¼](https://tobebetterjavaer.com/basic-extra-meal/java-unicode.html)ä¸º 97ï¼Œå­—ç¬¦ b çš„ASCII å€¼ä¸º 98ï¼Œå­—ç¬¦ b çš„ASCII å€¼ä¸º 99ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»¥ä¸Šä»£ç å¯ä»¥å†™æˆï¼š

```java
// ä½¿ç”¨æ–‡ä»¶åç§°åˆ›å»ºæµå¯¹è±¡
FileOutputStream fos = new FileOutputStream("fos.txt");     
// å†™å‡ºæ•°æ®
fos.write('a'); // ç¬¬1ä¸ªå­—èŠ‚
fos.write('b'); // ç¬¬2ä¸ªå­—èŠ‚
fos.write('c'); // ç¬¬3ä¸ªå­—èŠ‚
// å…³é—­èµ„æº
fos.close();
```

å½“ä½¿ç”¨ `write(int b)` æ–¹æ³•å†™å‡ºä¸€ä¸ªå­—èŠ‚æ—¶ï¼Œå‚æ•° b è¡¨ç¤ºè¦å†™å‡ºçš„å­—èŠ‚çš„æ•´æ•°å€¼ã€‚ç”±äºä¸€ä¸ªå­—èŠ‚åªæœ‰8ä½ï¼Œå› æ­¤å‚æ•° b çš„å–å€¼èŒƒå›´åº”è¯¥åœ¨ 0 åˆ° 255 ä¹‹é—´ï¼Œè¶…å‡ºè¿™ä¸ªèŒƒå›´çš„å€¼å°†ä¼šè¢«æˆªæ–­ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå‚æ•° b çš„å€¼ä¸º -1ï¼Œé‚£ä¹ˆå®ƒä¼šè¢«æˆªæ–­ä¸º 255ï¼Œå¦‚æœå‚æ•° b çš„å€¼ä¸º 256ï¼Œé‚£ä¹ˆå®ƒä¼šè¢«æˆªæ–­ä¸º 0ã€‚

åœ¨å°†å‚æ•° b å†™å…¥è¾“å‡ºæµä¸­æ—¶ï¼Œwrite(int b) æ–¹æ³•åªä¼šå°†å‚æ•° b çš„ä½8ä½å†™å…¥ï¼Œè€Œå¿½ç•¥é«˜24ä½ã€‚è¿™æ˜¯å› ä¸ºåœ¨ Java ä¸­ï¼Œæ•´å‹ç±»å‹ï¼ˆåŒ…æ‹¬ byteã€shortã€intã€longï¼‰åœ¨å†…å­˜ä¸­ä»¥äºŒè¿›åˆ¶è¡¥ç å½¢å¼è¡¨ç¤ºã€‚å½“å°†ä¸€ä¸ªæ•´å‹å€¼ä¼ é€’ç»™ write(int b) æ–¹æ³•æ—¶ï¼Œæ–¹æ³•ä¼šå°†è¯¥å€¼è½¬æ¢ä¸º byte ç±»å‹ï¼Œåªä¿ç•™äºŒè¿›åˆ¶è¡¥ç çš„ä½8ä½ï¼Œè€Œå¿½ç•¥é«˜24ä½ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœè¦å†™å‡ºçš„æ•´æ•°ä¸º 0x12345678ï¼Œå®ƒçš„äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºä¸º 0001 0010 0011 0100 0101 0110 0111 1000ã€‚å½“ä½¿ç”¨ write(int b) æ–¹æ³•å†™å‡ºè¯¥æ•´æ•°æ—¶ï¼Œåªä¼šå°†äºŒè¿›åˆ¶è¡¥ç çš„ä½8ä½ 0111 1000 å†™å‡ºï¼Œè€Œå¿½ç•¥é«˜24ä½ 0001 0010 0011 0100 0101 0110ã€‚è¿™å°±æ˜¯å‚æ•° b çš„é«˜24ä½è¢«å¿½ç•¥çš„åŸå› ã€‚

0111 1000 æ˜¯ä¸€ä¸ª8ä½çš„äºŒè¿›åˆ¶æ•°ï¼Œå®ƒå¯¹åº”çš„åè¿›åˆ¶æ•°æ˜¯ 120ï¼Œå¯¹åº”çš„ ASCII ç å­—ç¬¦æ˜¯å°å†™å­—æ¯ "x"ã€‚åœ¨ ASCII ç è¡¨ä¸­ï¼Œå°å†™å­—æ¯ "x" çš„åè¿›åˆ¶ ASCII ç å€¼ä¸º 120ã€‚å› æ­¤ï¼Œå¦‚æœä½¿ç”¨ write(int b) æ–¹æ³•å†™å‡ºä¸€ä¸ªå­—èŠ‚å€¼ä¸º 0x78ï¼ˆåè¿›åˆ¶ä¸º 120ï¼‰ï¼Œé‚£ä¹ˆå†™å‡ºçš„ç»“æœå°±æ˜¯å°å†™å­—æ¯ "x"ã€‚

æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ï¼š

```java
FileOutputStream fos = null;
try {
    fos = new FileOutputStream("example.txt");

    fos.write(120);
    fos.write('x');
    fos.write(0x12345678);
} catch (IOException e) {
    e.printStackTrace();
} finally {
    if (fos != null) {
        try {
            fos.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

æ¥çœ‹ä¸€ä¸‹ç»“æœï¼š

![](https://cdn.tobebetterjavaer.com/studymore/stream-20230318105229.png)

æœç„¶æ˜¯ 3 ä¸ª xã€‚

â‘¡ã€**å†™å…¥å­—èŠ‚æ•°ç»„**ï¼š`write(byte[] b)`ï¼Œä»£ç ç¤ºä¾‹ï¼š

```java
// ä½¿ç”¨æ–‡ä»¶åç§°åˆ›å»ºæµå¯¹è±¡
FileOutputStream fos = new FileOutputStream("fos.txt");     
// å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„
byte[] b = "æ²‰é»˜ç‹äºŒæœ‰ç‚¹å¸…".getBytes();
// å†™å…¥å­—èŠ‚æ•°ç»„æ•°æ®
fos.write(b);
// å…³é—­èµ„æº
fos.close();
```


â‘¢ã€**å†™å…¥æŒ‡å®šé•¿åº¦å­—èŠ‚æ•°ç»„**ï¼š`write(byte[] b, int off, int len)`ï¼Œä»£ç ç¤ºä¾‹ï¼š

```java
// ä½¿ç”¨æ–‡ä»¶åç§°åˆ›å»ºæµå¯¹è±¡
FileOutputStream fos = new FileOutputStream("fos.txt");     
// å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„
byte[] b = "abcde".getBytes();
// ä»ç´¢å¼•2å¼€å§‹ï¼Œ2ä¸ªå­—èŠ‚ã€‚ç´¢å¼•2æ˜¯cï¼Œä¸¤ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯cdã€‚
fos.write(b,2,2);
// å…³é—­èµ„æº
fos.close();
```


#### **3ï¼‰FileOutputStreamå®ç°æ•°æ®è¿½åŠ ã€æ¢è¡Œ**

åœ¨ä¸Šé¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œæ¯æ¬¡è¿è¡Œç¨‹åºéƒ½ä¼šåˆ›å»ºæ–°çš„è¾“å‡ºæµå¯¹è±¡ï¼Œäºæ˜¯æ–‡ä»¶ä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ¸…ç©ºã€‚å¦‚æœæƒ³ä¿ç•™ç›®æ ‡æ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œè¿˜èƒ½ç»§ç»­**è¿½åŠ æ–°æ•°æ®**ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿä»¥åŠå¦‚ä½•å®ç°**æ¢è¡Œ**å‘¢ï¼Ÿ

å…¶å®å¾ˆç®€å•ã€‚

æˆ‘ä»¬æ¥å­¦ä¹ `FileOutputStream`çš„å¦å¤–ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š

1ã€ä½¿ç”¨æ–‡ä»¶åå’Œè¿½åŠ æ ‡å¿—åˆ›å»º FileOutputStream å¯¹è±¡

```java
String fileName = "example.txt";
boolean append = true;
FileOutputStream fos = new FileOutputStream(fileName, append);
```

ä»¥ä¸Šä»£ç ä½¿ç”¨æ–‡ä»¶å "example.txt" å’Œè¿½åŠ æ ‡å¿—åˆ›å»ºä¸€ä¸ª FileOutputStream å¯¹è±¡ï¼Œå°†æ•°æ®è¿½åŠ åˆ°è¯¥æ–‡ä»¶çš„æœ«å°¾ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼›å¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™åœ¨æ–‡ä»¶æœ«å°¾è¿½åŠ æ•°æ®ã€‚

2ã€ä½¿ç”¨æ–‡ä»¶å¯¹è±¡å’Œè¿½åŠ æ ‡å¿—åˆ›å»º FileOutputStream å¯¹è±¡

```java
File file = new File("example.txt");
boolean append = true;
FileOutputStream fos = new FileOutputStream(file, append);
```

ä»¥ä¸Šä»£ç ä½¿ç”¨æ–‡ä»¶å¯¹è±¡å’Œè¿½åŠ æ ‡å¿—åˆ›å»ºä¸€ä¸ª FileOutputStream å¯¹è±¡ï¼Œå°†æ•°æ®è¿½åŠ åˆ°è¯¥æ–‡ä»¶çš„æœ«å°¾ã€‚

è¿™ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸­éƒ½éœ€è¦ä¼ å…¥ä¸€ä¸ªbooleanç±»å‹çš„å€¼ï¼Œ`true` è¡¨ç¤ºè¿½åŠ æ•°æ®ï¼Œ`false` è¡¨ç¤ºä¸è¿½åŠ ä¹Ÿå°±æ˜¯æ¸…ç©ºåŸæœ‰æ•°æ®ã€‚

å®ç°æ•°æ®è¿½åŠ ä»£ç å¦‚ä¸‹ï¼š

```java
// ä½¿ç”¨æ–‡ä»¶åç§°åˆ›å»ºæµå¯¹è±¡
FileOutputStream fos = new FileOutputStream("fos.txt",true);     
// å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„
byte[] b = "abcde".getBytes();
// å†™å‡ºä»ç´¢å¼•2å¼€å§‹ï¼Œ2ä¸ªå­—èŠ‚ã€‚ç´¢å¼•2æ˜¯cï¼Œä¸¤ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯cdã€‚
fos.write(b);
// å…³é—­èµ„æº
fos.close();
```

å¤šæ¬¡è¿è¡Œä»£ç ï¼Œä½ ä¼šå‘ç°æ•°æ®åœ¨ä¸æ–­åœ°è¿½åŠ ã€‚

åœ¨ Windows ç³»ç»Ÿä¸­ï¼Œæ¢è¡Œç¬¦å·æ˜¯`\r\n`ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```java
String filename = "example.txt";
FileOutputStream fos = new FileOutputStream(filename, true);  // è¿½åŠ æ¨¡å¼
String content = "æ²‰é»˜ç‹äºŒ\r\n";  // ä½¿ç”¨å›è½¦ç¬¦å’Œæ¢è¡Œç¬¦çš„ç»„åˆ
fos.write(content.getBytes());
fos.close();
```

åœ¨ macOS ç³»ç»Ÿä¸­ï¼Œæ¢è¡Œç¬¦æ˜¯ `\n`ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```java
String filename = "example.txt";
FileOutputStream fos = new FileOutputStream(filename, true);  // è¿½åŠ æ¨¡å¼
String content = "æ²‰é»˜ç‹äºŒ\n";  // åªä½¿ç”¨æ¢è¡Œç¬¦
fos.write(content.getBytes());
fos.close();
```

è¿™é‡Œå†å” ä¸€å” å›è½¦ç¬¦å’Œæ¢è¡Œç¬¦ã€‚

å›è½¦ç¬¦ï¼ˆ`\r`ï¼‰å’Œæ¢è¡Œç¬¦ï¼ˆ`\n`ï¼‰æ˜¯è®¡ç®—æœºä¸­å¸¸è§çš„æ§åˆ¶å­—ç¬¦ï¼Œç”¨äºè¡¨ç¤ºä¸€è¡Œçš„ç»“æŸæˆ–è€…æ¢è¡Œçš„æ“ä½œã€‚å®ƒä»¬åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿå’Œç¼–ç¨‹è¯­è¨€ä¸­çš„ä½¿ç”¨æ–¹å¼å¯èƒ½æœ‰æ‰€ä¸åŒã€‚

åœ¨ Windows ç³»ç»Ÿä¸­ï¼Œé€šå¸¸ä½¿ç”¨å›è½¦ç¬¦å’Œæ¢è¡Œç¬¦çš„ç»„åˆï¼ˆ`\r\n`ï¼‰æ¥è¡¨ç¤ºä¸€è¡Œçš„ç»“æŸã€‚åœ¨æ–‡æœ¬æ–‡ä»¶ä¸­ï¼Œæ¯è¡Œçš„æœ«å°¾éƒ½ä¼šä»¥ä¸€ä¸ªå›è½¦ç¬¦å’Œä¸€ä¸ªæ¢è¡Œç¬¦çš„ç»„åˆç»“æŸã€‚è¿™æ˜¯ç”±äºæ—©æœŸçš„æ‰“å°æœºå’Œç»ˆç«¯è®¾å¤‡éœ€è¦å›è½¦ç¬¦å’Œæ¢è¡Œç¬¦çš„ç»„åˆæ¥å®Œæˆä¸€è¡Œçš„ç»“æŸå’Œæ¢è¡Œæ“ä½œã€‚åœ¨ Windows ä¸­ï¼Œæ–‡æœ¬ç¼–è¾‘å™¨å’Œå‘½ä»¤è¡Œç»ˆç«¯ç­‰å·¥å…·éƒ½æ”¯æŒä½¿ç”¨å›è½¦ç¬¦å’Œæ¢è¡Œç¬¦çš„ç»„åˆæ¥è¡¨ç¤ºä¸€è¡Œçš„ç»“æŸã€‚

è€Œåœ¨ macOS å’Œ Linux ç³»ç»Ÿä¸­ï¼Œé€šå¸¸åªä½¿ç”¨æ¢è¡Œç¬¦ï¼ˆ`\n`ï¼‰æ¥è¡¨ç¤ºä¸€è¡Œçš„ç»“æŸã€‚åœ¨æ–‡æœ¬æ–‡ä»¶ä¸­ï¼Œæ¯è¡Œçš„æœ«å°¾åªæœ‰ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚è¿™æ˜¯ç”±äºæ—©æœŸ Unix ç³»ç»Ÿä¸­çš„ç»ˆç«¯è®¾å¤‡åªéœ€è¦æ¢è¡Œç¬¦æ¥å®Œæˆä¸€è¡Œçš„ç»“æŸå’Œè·¨è¡Œæ“ä½œã€‚åœ¨ macOS å’Œ Linux ä¸­ï¼Œæ–‡æœ¬ç¼–è¾‘å™¨å’Œç»ˆç«¯ç­‰å·¥å…·éƒ½æ”¯æŒä½¿ç”¨æ¢è¡Œç¬¦æ¥è¡¨ç¤ºä¸€è¡Œçš„ç»“æŸã€‚

åœ¨ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œé€šå¸¸ä¹Ÿä¼šä½¿ç”¨å›è½¦ç¬¦å’Œæ¢è¡Œç¬¦æ¥è¿›è¡Œå­—ç¬¦ä¸²çš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œåœ¨ Java ä¸­ï¼Œå­—ç¬¦ä¸²ä¸­çš„å›è½¦ç¬¦å¯ä»¥ç”¨ "`\r`" æ¥è¡¨ç¤ºï¼Œæ¢è¡Œç¬¦å¯ä»¥ç”¨ "`\n`" æ¥è¡¨ç¤ºã€‚åœ¨é€šè¿‡è¾“å…¥è¾“å‡ºæµè¿›è¡Œæ–‡ä»¶è¯»å†™æ—¶ï¼Œä¹Ÿéœ€è¦æ³¨æ„å›è½¦ç¬¦å’Œæ¢è¡Œç¬¦çš„ä½¿ç”¨æ–¹å¼å’Œæ“ä½œç³»ç»Ÿçš„å·®å¼‚ã€‚

### å­—èŠ‚è¾“å…¥æµï¼ˆInputStreamï¼‰

`java.io.InputStream` æ˜¯**å­—èŠ‚è¾“å…¥æµ**çš„**è¶…ç±»**ï¼ˆçˆ¶ç±»ï¼‰ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ƒçš„ä¸€äº›å…±æ€§æ–¹æ³•ï¼š

1ã€`close()` ï¼šå…³é—­æ­¤è¾“å…¥æµå¹¶é‡Šæ”¾ä¸æ­¤æµç›¸å…³çš„ç³»ç»Ÿèµ„æºã€‚

2ã€`int read()`ï¼š ä»è¾“å…¥æµè¯»å–æ•°æ®çš„ä¸‹ä¸€ä¸ªå­—èŠ‚ã€‚

3ã€`read(byte[] b)`ï¼š è¯¥æ–¹æ³•è¿”å›çš„ int å€¼ä»£è¡¨çš„æ˜¯è¯»å–äº†å¤šå°‘ä¸ªå­—èŠ‚ï¼Œè¯»åˆ°å‡ ä¸ªè¿”å›å‡ ä¸ªï¼Œè¯»å–ä¸åˆ°è¿”å›-1

### FileInputStreamç±»

InputStream æœ‰å¾ˆå¤šå­ç±»ï¼Œæˆ‘ä»¬ä»æœ€ç®€å•çš„ä¸€ä¸ªå­ç±» FileInputStream å¼€å§‹ã€‚çœ‹åå­—å°±çŸ¥é“æ˜¯æ–‡ä»¶è¾“å…¥æµï¼Œç”¨äºå°†æ•°æ®ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚

#### 1ï¼‰FileInputStreamçš„æ„é€ æ–¹æ³•

1ã€`FileInputStream(String name)`ï¼šåˆ›å»ºä¸€ä¸ª FileInputStream å¯¹è±¡ï¼Œå¹¶æ‰“å¼€æŒ‡å®šåç§°çš„æ–‡ä»¶è¿›è¡Œè¯»å–ã€‚æ–‡ä»¶åç”± name å‚æ•°æŒ‡å®šã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°†ä¼šæŠ›å‡º FileNotFoundException å¼‚å¸¸ã€‚

2ã€`FileInputStream(File file)`ï¼šåˆ›å»ºä¸€ä¸ª FileInputStream å¯¹è±¡ï¼Œå¹¶æ‰“å¼€æŒ‡å®šçš„ File å¯¹è±¡è¡¨ç¤ºçš„æ–‡ä»¶è¿›è¡Œè¯»å–ã€‚

ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
// åˆ›å»ºä¸€ä¸ª FileInputStream å¯¹è±¡
FileInputStream fis = new FileInputStream("test.txt");

// è¯»å–æ–‡ä»¶å†…å®¹
int data;
while ((data = fis.read()) != -1) {
    System.out.print((char) data);
}

// å…³é—­è¾“å…¥æµ
fis.close();
```

#### 2ï¼‰FileInputStreamè¯»å–å­—èŠ‚æ•°æ®

â‘ ã€**è¯»å–å­—èŠ‚**ï¼š`read()`æ–¹æ³•ä¼šè¯»å–ä¸€ä¸ªå­—èŠ‚å¹¶è¿”å›å…¶æ•´æ•°è¡¨ç¤ºã€‚å¦‚æœå·²ç»åˆ°è¾¾æ–‡ä»¶çš„æœ«å°¾ï¼Œåˆ™è¿”å› -1ã€‚å¦‚æœåœ¨è¯»å–æ—¶å‘ç”Ÿé”™è¯¯ï¼Œåˆ™ä¼šæŠ›å‡º IOException å¼‚å¸¸ã€‚

ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
// åˆ›å»ºä¸€ä¸ª FileInputStream å¯¹è±¡
FileInputStream fis = new FileInputStream("test.txt");

// è¯»å–æ–‡ä»¶å†…å®¹
int data;
while ((data = fis.read()) != -1) {
    System.out.print((char) data);
}

// å…³é—­è¾“å…¥æµ
fis.close();
```


â‘¡ã€**ä½¿ç”¨å­—èŠ‚æ•°ç»„è¯»å–**ï¼š`read(byte[] b)` æ–¹æ³•ä¼šä»è¾“å…¥æµä¸­æœ€å¤šè¯»å– b.length ä¸ªå­—èŠ‚ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åˆ°ç¼“å†²åŒºæ•°ç»„ b ä¸­ã€‚

ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
// åˆ›å»ºä¸€ä¸ª FileInputStream å¯¹è±¡
FileInputStream fis = new FileInputStream("test.txt");

// è¯»å–æ–‡ä»¶å†…å®¹åˆ°ç¼“å†²åŒº
byte[] buffer = new byte[1024];
int count;
while ((count = fis.read(buffer)) != -1) {
    System.out.println(new String(buffer, 0, count));
}

// å…³é—­è¾“å…¥æµ
fis.close();
```

#### 3ï¼‰å­—èŠ‚æµFileInputstreamå¤åˆ¶å›¾ç‰‡

åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠå›¾ç‰‡ä¿¡æ¯è¯»å…¥åˆ°å­—èŠ‚è¾“å…¥æµä¸­ï¼Œå†é€šè¿‡å­—èŠ‚è¾“å‡ºæµå†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚

ä»£ç ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
// åˆ›å»ºä¸€ä¸ª FileInputStream å¯¹è±¡ä»¥è¯»å–åŸå§‹å›¾ç‰‡æ–‡ä»¶
FileInputStream fis = new FileInputStream("original.jpg");

// åˆ›å»ºä¸€ä¸ª FileOutputStream å¯¹è±¡ä»¥å†™å…¥å¤åˆ¶åçš„å›¾ç‰‡æ–‡ä»¶
FileOutputStream fos = new FileOutputStream("copy.jpg");

// åˆ›å»ºä¸€ä¸ªç¼“å†²åŒºæ•°ç»„ä»¥å­˜å‚¨è¯»å–çš„æ•°æ®
byte[] buffer = new byte[1024];
int count;

// è¯»å–åŸå§‹å›¾ç‰‡æ–‡ä»¶å¹¶å°†æ•°æ®å†™å…¥å¤åˆ¶åçš„å›¾ç‰‡æ–‡ä»¶
while ((count = fis.read(buffer)) != -1) {
    fos.write(buffer, 0, count);
}

// å…³é—­è¾“å…¥æµå’Œè¾“å‡ºæµ
fis.close();
fos.close();
```

ä¸Šé¢çš„ä»£ç åˆ›å»ºäº†ä¸€ä¸ª FileInputStream å¯¹è±¡ä»¥è¯»å–åŸå§‹å›¾ç‰‡æ–‡ä»¶ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ª FileOutputStream å¯¹è±¡ä»¥å†™å…¥å¤åˆ¶åçš„å›¾ç‰‡æ–‡ä»¶ã€‚ç„¶åï¼Œä½¿ç”¨ while å¾ªç¯é€ä¸ªè¯»å–åŸå§‹å›¾ç‰‡æ–‡ä»¶ä¸­çš„å­—èŠ‚ï¼Œå¹¶å°†å…¶å†™å…¥å¤åˆ¶åçš„å›¾ç‰‡æ–‡ä»¶ä¸­ã€‚æœ€åï¼Œå…³é—­è¾“å…¥æµå’Œè¾“å‡ºæµé‡Šæ”¾èµ„æºã€‚

### å°ç»“

InputStream æ˜¯å­—èŠ‚è¾“å…¥æµçš„æŠ½è±¡ç±»ï¼Œå®ƒå®šä¹‰äº†è¯»å–å­—èŠ‚æ•°æ®çš„æ–¹æ³•ï¼Œå¦‚ `read()`ã€`read(byte[] b)`ã€`read(byte[] b, int off, int len)` ç­‰ã€‚OutputStream æ˜¯å­—èŠ‚è¾“å‡ºæµçš„æŠ½è±¡ç±»ï¼Œå®ƒå®šä¹‰äº†å†™å…¥å­—èŠ‚æ•°æ®çš„æ–¹æ³•ï¼Œå¦‚ `write(int b)`ã€`write(byte[] b)`ã€`write(byte[] b, int off, int len)` ç­‰ã€‚è¿™ä¸¤ä¸ªæŠ½è±¡ç±»æ˜¯å­—èŠ‚æµçš„åŸºç¡€ã€‚

FileInputStream æ˜¯ä»æ–‡ä»¶ä¸­è¯»å–å­—èŠ‚æ•°æ®çš„æµï¼Œå®ƒç»§æ‰¿è‡ª InputStreamã€‚FileOutputStream æ˜¯å°†å­—èŠ‚æ•°æ®å†™å…¥æ–‡ä»¶çš„æµï¼Œå®ƒç»§æ‰¿è‡ª OutputStreamã€‚è¿™ä¸¤ä¸ªç±»æ˜¯å­—èŠ‚æµæœ€å¸¸ç”¨çš„å®ç°ç±»ä¹‹ä¸€ã€‚

---------

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 7.4 å­—ç¬¦æµ

å­—ç¬¦æµ Reader å’Œ Writer çš„æ•…äº‹è¦ä»å®ƒä»¬çš„ç±»å…³ç³»å›¾å¼€å§‹ï¼Œæ¥çœ‹å›¾ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/reader-writer-20230320164938.png)

å­—ç¬¦æµæ˜¯ä¸€ç§ç”¨äºè¯»å–å’Œå†™å…¥å­—ç¬¦æ•°æ®çš„è¾“å…¥è¾“å‡ºæµã€‚ä¸å­—èŠ‚æµä¸åŒï¼Œå­—ç¬¦æµä»¥å­—ç¬¦ä¸ºå•ä½è¯»å–å’Œå†™å…¥æ•°æ®ï¼Œè€Œä¸æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½ã€‚å¸¸ç”¨æ¥å¤„ç†æ–‡æœ¬ä¿¡æ¯ã€‚

å¦‚æœç”¨å­—èŠ‚æµç›´æ¥è¯»å–ä¸­æ–‡ï¼Œå¯èƒ½ä¼šé‡åˆ°ä¹±ç é—®é¢˜ï¼Œè§ä¸‹ä¾‹ï¼š

```java
//FileInputStreamä¸ºæ“ä½œæ–‡ä»¶çš„å­—ç¬¦è¾“å…¥æµ
FileInputStream inputStream = new FileInputStream("a.txt");//å†…å®¹ä¸ºâ€œæ²‰é»˜ç‹äºŒæ˜¯å‚» Xâ€

int len;
while ((len=inputStream.read())!=-1){
    System.out.print((char)len);
}
```

æ¥çœ‹è¿è¡Œç»“æœï¼š

```
è¿è¡Œç»“æœï¼š   Ã¦Â²Â‰Ã©Â»Â˜Ã§ÂÂ‹Ã¤ÂºÂŒÃ¦Â˜Â¯Ã¥Â‚Â» X
```

çœ‹ä¸€ä¸‹æˆªå›¾ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/io/reader-writer-0b68ef81-26d0-4a4e-9c1b-61928ce8646c.png)


ä¹‹æ‰€ä»¥å‡ºç°ä¹±ç æ˜¯å› ä¸ºåœ¨å­—èŠ‚æµä¸­ï¼Œä¸€ä¸ªå­—ç¬¦é€šå¸¸ç”±å¤šä¸ªå­—èŠ‚ç»„æˆï¼Œè€Œä¸åŒçš„å­—ç¬¦ç¼–ç ä½¿ç”¨çš„å­—èŠ‚æ•°ä¸åŒã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨äº†é”™è¯¯çš„å­—ç¬¦ç¼–ç ï¼Œæˆ–è€…åœ¨è¯»å–å’Œå†™å…¥æ•°æ®æ—¶æ²¡æœ‰æ­£ç¡®å¤„ç†å­—ç¬¦ç¼–ç çš„è½¬æ¢ï¼Œå°±ä¼šå¯¼è‡´è¯»å–å‡ºæ¥çš„ä¸­æ–‡å­—ç¬¦å‡ºç°ä¹±ç ã€‚

ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨é»˜è®¤çš„å­—ç¬¦ç¼–ç ï¼ˆè§ä¸Šä¾‹ï¼‰è¯»å–ä¸€ä¸ªåŒ…å«ä¸­æ–‡å­—ç¬¦çš„æ–‡æœ¬æ–‡ä»¶æ—¶ï¼Œå°±ä¼šå‡ºç°ä¹±ç ã€‚å› ä¸ºé»˜è®¤çš„å­—ç¬¦ç¼–ç é€šå¸¸æ˜¯ ASCII ç¼–ç ï¼Œå®ƒåªèƒ½è¡¨ç¤ºè‹±æ–‡å­—ç¬¦ï¼Œè€Œä¸èƒ½æ­£ç¡®åœ°è§£æä¸­æ–‡å­—ç¬¦ã€‚

é‚£ä½¿ç”¨å­—èŠ‚æµè¯¥å¦‚ä½•æ­£ç¡®åœ°è¯»å‡ºä¸­æ–‡å‘¢ï¼Ÿè§ä¸‹ä¾‹ã€‚

```java
try (FileInputStream inputStream = new FileInputStream("a.txt")) {
    byte[] bytes = new byte[1024];
    int len;
    while ((len = inputStream.read(bytes)) != -1) {
        System.out.print(new String(bytes, 0, len));
    }
}
```

ä¸ºä»€ä¹ˆè¿™ç§æ–¹å¼å°±å¯ä»¥å‘¢ï¼Ÿ

å› ä¸ºæˆ‘ä»¬æ‹¿ String ç±»è¿›è¡Œäº†è§£ç ï¼ŒæŸ¥çœ‹`new String(byte bytes[], int offset, int length)`çš„æºç å°±å¯ä»¥å‘ç°ï¼Œè¯¥æ„é€ æ–¹æ³•æœ‰è§£ç åŠŸèƒ½ï¼š

```java
public String(byte bytes[], int offset, int length) {
    checkBounds(bytes, offset, length);
    this.value = StringCoding.decode(bytes, offset, length);
}
```

ç»§ç»­è¿½çœ‹ `StringCoding.decode()` æ–¹æ³•è°ƒç”¨çš„ `defaultCharset()` æ–¹æ³•ï¼Œä¼šå‘ç°é»˜è®¤ç¼–ç æ˜¯`UTF-8`ï¼Œä»£ç å¦‚ä¸‹

```java
public static Charset defaultCharset() {
    if (defaultCharset == null) {
        synchronized (Charset.class) {
            if (cs != null)
                defaultCharset = cs;
            else
                defaultCharset = forName("UTF-8");
        }
    }
    return defaultCharset;
}
static char[] decode(byte[] ba, int off, int len) {
    String csn = Charset.defaultCharset().name();
    try {
        // use charset name decode() variant which provides caching.
        return decode(csn, ba, off, len);
    } catch (UnsupportedEncodingException x) {
        warnUnsupportedCharset(csn);
    }
}
```

åœ¨ Java ä¸­ï¼Œå¸¸ç”¨çš„å­—ç¬¦ç¼–ç æœ‰ ASCIIã€ISO-8859-1ã€UTF-8ã€UTF-16 ç­‰ã€‚å…¶ä¸­ï¼ŒASCII å’Œ ISO-8859-1 åªèƒ½è¡¨ç¤ºéƒ¨åˆ†å­—ç¬¦ï¼Œè€Œ UTF-8 å’Œ UTF-16 å¯ä»¥è¡¨ç¤ºæ‰€æœ‰çš„ Unicode å­—ç¬¦ï¼ŒåŒ…æ‹¬ä¸­æ–‡å­—ç¬¦ã€‚

å½“æˆ‘ä»¬ä½¿ç”¨ `new String(byte bytes[], int offset, int length)` å°†å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦ä¸²æ—¶ï¼ŒJava ä¼šæ ¹æ® UTF-8 çš„è§„åˆ™å°†æ¯ 3 ä¸ªå­—èŠ‚è§£ç ä¸ºä¸€ä¸ªä¸­æ–‡å­—ç¬¦ï¼Œä»è€Œæ­£ç¡®åœ°è§£ç å‡ºä¸­æ–‡ã€‚

å°½ç®¡å­—èŠ‚æµä¹Ÿæœ‰åŠæ³•è§£å†³ä¹±ç é—®é¢˜ï¼Œä½†ä¸å¤Ÿç›´æ¥ï¼Œäºæ˜¯å°±æœ‰äº†å­—ç¬¦æµï¼Œ`ä¸“é—¨ç”¨äºå¤„ç†æ–‡æœ¬`æ–‡ä»¶ï¼ˆéŸ³é¢‘ã€å›¾ç‰‡ã€è§†é¢‘ç­‰ä¸ºéæ–‡æœ¬æ–‡ä»¶ï¼‰ã€‚

ä»å¦ä¸€è§’åº¦æ¥è¯´ï¼š**å­—ç¬¦æµ = å­—èŠ‚æµ + ç¼–ç è¡¨**

### 01ã€å­—ç¬¦è¾“å…¥æµï¼ˆReaderï¼‰

`java.io.Reader`æ˜¯**å­—ç¬¦è¾“å…¥æµ**çš„**è¶…ç±»**ï¼ˆçˆ¶ç±»ï¼‰ï¼Œå®ƒå®šä¹‰äº†å­—ç¬¦è¾“å…¥æµçš„ä¸€äº›å…±æ€§æ–¹æ³•ï¼š

- 1ã€`close()`ï¼šå…³é—­æ­¤æµå¹¶é‡Šæ”¾ä¸æ­¤æµç›¸å…³çš„ç³»ç»Ÿèµ„æºã€‚
- 2ã€`read()`ï¼šä»è¾“å…¥æµè¯»å–ä¸€ä¸ªå­—ç¬¦ã€‚
- 3ã€`read(char[] cbuf)`ï¼šä»è¾“å…¥æµä¸­è¯»å–ä¸€äº›å­—ç¬¦ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åˆ°å­—ç¬¦æ•°ç»„ `cbuf`ä¸­

FileReader æ˜¯ Reader çš„å­ç±»ï¼Œç”¨äºä»æ–‡ä»¶ä¸­è¯»å–å­—ç¬¦æ•°æ®ã€‚å®ƒçš„ä¸»è¦ç‰¹ç‚¹å¦‚ä¸‹ï¼š

- å¯ä»¥é€šè¿‡æ„é€ æ–¹æ³•æŒ‡å®šè¦è¯»å–çš„æ–‡ä»¶è·¯å¾„ã€‚
- æ¯æ¬¡å¯ä»¥è¯»å–ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚
- å¯ä»¥è¯»å– Unicode å­—ç¬¦é›†ä¸­çš„å­—ç¬¦ï¼Œé€šè¿‡æŒ‡å®šå­—ç¬¦ç¼–ç æ¥å®ç°å­—ç¬¦é›†çš„è½¬æ¢ã€‚

#### 1ï¼‰FileReaderæ„é€ æ–¹æ³•

- 1ã€`FileReader(File file)`ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ FileReaderï¼Œå‚æ•°ä¸º**Fileå¯¹è±¡**ã€‚
- 2ã€`FileReader(String fileName)`ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ FileReaderï¼Œå‚æ•°ä¸ºæ–‡ä»¶åã€‚

ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
// ä½¿ç”¨Fileå¯¹è±¡åˆ›å»ºæµå¯¹è±¡
File file = new File("a.txt");
FileReader fr = new FileReader(file);

// ä½¿ç”¨æ–‡ä»¶åç§°åˆ›å»ºæµå¯¹è±¡
FileReader fr = new FileReader("b.txt");
```

#### 2ï¼‰FileReaderè¯»å–å­—ç¬¦æ•°æ®

â‘ ã€**è¯»å–å­—ç¬¦**ï¼š`read`æ–¹æ³•ï¼Œæ¯æ¬¡å¯ä»¥è¯»å–ä¸€ä¸ªå­—ç¬¦ï¼Œè¿”å›è¯»å–çš„å­—ç¬¦ï¼ˆè½¬ä¸º int ç±»å‹ï¼‰ï¼Œå½“è¯»å–åˆ°æ–‡ä»¶æœ«å°¾æ—¶ï¼Œè¿”å›`-1`ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
// ä½¿ç”¨æ–‡ä»¶åç§°åˆ›å»ºæµå¯¹è±¡
FileReader fr = new FileReader("abc.txt");
// å®šä¹‰å˜é‡ï¼Œä¿å­˜æ•°æ®
int b;
// å¾ªç¯è¯»å–
while ((b = fr.read())!=-1) {
    System.out.println((char)b);
}
// å…³é—­èµ„æº
fr.close();
```

â‘¡ã€**è¯»å–æŒ‡å®šé•¿åº¦çš„å­—ç¬¦**ï¼š`read(char[] cbuf, int off, int len)`ï¼Œå¹¶å°†å…¶å­˜å‚¨åˆ°å­—ç¬¦æ•°ç»„ä¸­ã€‚å…¶ä¸­ï¼Œcbuf è¡¨ç¤ºå­˜å‚¨è¯»å–ç»“æœçš„å­—ç¬¦æ•°ç»„ï¼Œoff è¡¨ç¤ºå­˜å‚¨ç»“æœçš„èµ·å§‹ä½ç½®ï¼Œlen è¡¨ç¤ºè¦è¯»å–çš„å­—ç¬¦æ•°ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
File textFile = new File("docs/çº¦å®š.md");
// ç»™ä¸€ä¸ª FileReader çš„ç¤ºä¾‹
// try-with-resources FileReader
try(FileReader reader = new FileReader(textFile);) {
    // read(char[] cbuf)
    char[] buffer = new char[1024];
    int len;
    while ((len = reader.read(buffer, 0, buffer.length)) != -1) {
        System.out.print(new String(buffer, 0, len));
    }
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨ FileReader ä»æ–‡ä»¶ä¸­è¯»å–å­—ç¬¦æ•°æ®ï¼Œå¹¶å°†å…¶å­˜å‚¨åˆ°ä¸€ä¸ªå¤§å°ä¸º 1024 çš„å­—ç¬¦æ•°ç»„ä¸­ã€‚æ¯æ¬¡è¯»å– len ä¸ªå­—ç¬¦ï¼Œç„¶åä½¿ç”¨ String æ„é€ æ–¹æ³•å°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶è¾“å‡ºã€‚

FileReader å®ç°äº† AutoCloseable æ¥å£ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ [try-with-resources](https://tobebetterjavaer.com/exception/try-with-resources.html) è¯­å¥è‡ªåŠ¨å…³é—­èµ„æºï¼Œé¿å…äº†æ‰‹åŠ¨å…³é—­èµ„æºçš„ç¹çæ“ä½œã€‚

### 02ã€å­—ç¬¦è¾“å‡ºæµï¼ˆWriterï¼‰

`java.io.Writer` æ˜¯**å­—ç¬¦è¾“å‡ºæµ**ç±»çš„**è¶…ç±»**ï¼ˆçˆ¶ç±»ï¼‰ï¼Œå¯ä»¥å°†æŒ‡å®šçš„å­—ç¬¦ä¿¡æ¯å†™å…¥åˆ°ç›®çš„åœ°ï¼Œæ¥çœ‹å®ƒå®šä¹‰çš„ä¸€äº›å…±æ€§æ–¹æ³•ï¼š

- 1ã€`write(int c)` å†™å…¥å•ä¸ªå­—ç¬¦ã€‚
- 2ã€`write(char[] cbuf)` å†™å…¥å­—ç¬¦æ•°ç»„ã€‚
- 3ã€`write(char[] cbuf, int off, int len)` å†™å…¥å­—ç¬¦æ•°ç»„çš„ä¸€éƒ¨åˆ†ï¼Œoffä¸ºå¼€å§‹ç´¢å¼•ï¼Œlenä¸ºå­—ç¬¦ä¸ªæ•°ã€‚
- 4ã€`write(String str)` å†™å…¥å­—ç¬¦ä¸²ã€‚
- 5ã€`write(String str, int off, int len)` å†™å…¥å­—ç¬¦ä¸²çš„æŸä¸€éƒ¨åˆ†ï¼Œoff æŒ‡å®šè¦å†™å…¥çš„å­ä¸²åœ¨ str ä¸­çš„èµ·å§‹ä½ç½®ï¼Œlen æŒ‡å®šè¦å†™å…¥çš„å­ä¸²çš„é•¿åº¦ã€‚
- 6ã€`flush()` åˆ·æ–°è¯¥æµçš„ç¼“å†²ã€‚
- 7ã€`close()` å…³é—­æ­¤æµï¼Œä½†è¦å…ˆåˆ·æ–°å®ƒã€‚

`java.io.FileWriter` ç±»æ˜¯ Writer çš„å­ç±»ï¼Œç”¨æ¥å°†å­—ç¬¦å†™å…¥åˆ°æ–‡ä»¶ã€‚

#### 1ï¼‰FileWriter æ„é€ æ–¹æ³•

- `FileWriter(File file)`ï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„ FileWriterï¼Œå‚æ•°ä¸ºè¦è¯»å–çš„Fileå¯¹è±¡ã€‚
- `FileWriter(String fileName)`ï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„ FileWriterï¼Œå‚æ•°ä¸ºè¦è¯»å–çš„æ–‡ä»¶çš„åç§°ã€‚

ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
// ç¬¬ä¸€ç§ï¼šä½¿ç”¨Fileå¯¹è±¡åˆ›å»ºæµå¯¹è±¡
File file = new File("a.txt");
FileWriter fw = new FileWriter(file);

// ç¬¬äºŒç§ï¼šä½¿ç”¨æ–‡ä»¶åç§°åˆ›å»ºæµå¯¹è±¡
FileWriter fw = new FileWriter("b.txt");
```

#### 2ï¼‰FileWriterå†™å…¥æ•°æ®

â‘ ã€**å†™å…¥å­—ç¬¦**ï¼š`write(int b)` æ–¹æ³•ï¼Œæ¯æ¬¡å¯ä»¥å†™å‡ºä¸€ä¸ªå­—ç¬¦ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
FileWriter fw = null;
try {
    fw = new FileWriter("output.txt");
    fw.write(72); // å†™å…¥å­—ç¬¦'H'çš„ASCIIç 
    fw.write(101); // å†™å…¥å­—ç¬¦'e'çš„ASCIIç 
    fw.write(108); // å†™å…¥å­—ç¬¦'l'çš„ASCIIç 
    fw.write(108); // å†™å…¥å­—ç¬¦'l'çš„ASCIIç 
    fw.write(111); // å†™å…¥å­—ç¬¦'o'çš„ASCIIç 
} catch (IOException e) {
    e.printStackTrace();
} finally {
    try {
        if (fw != null) {
            fw.close();
        }
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä»£ç ä¸­ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª FileWriter å¯¹è±¡ fwï¼Œå¹¶æŒ‡å®šè¦å†™å…¥çš„æ–‡ä»¶è·¯å¾„ "output.txt"ã€‚ç„¶åä½¿ç”¨ fw.write() æ–¹æ³•å°†å­—èŠ‚å†™å…¥æ–‡ä»¶ä¸­ï¼Œè¿™é‡Œåˆ†åˆ«å†™å…¥å­—ç¬¦'H'ã€'e'ã€'l'ã€'l'ã€'o'çš„ ASCII ç ã€‚æœ€ååœ¨ finally å—ä¸­å…³é—­ FileWriter å¯¹è±¡ï¼Œé‡Šæ”¾èµ„æºã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ `write(int b)` æ–¹æ³•å†™å…¥çš„æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ã€‚å¦‚æœéœ€è¦å†™å…¥å­—ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨ `write(char cbuf[])` æˆ– `write(String str)` æ–¹æ³•ã€‚

â‘¡ã€**å†™å…¥å­—ç¬¦æ•°ç»„**ï¼š`write(char[] cbuf)` æ–¹æ³•ï¼Œå°†æŒ‡å®šå­—ç¬¦æ•°ç»„å†™å…¥è¾“å‡ºæµã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
FileWriter fw = null;
try {
    fw = new FileWriter("output.txt");
    char[] chars = {'H', 'e', 'l', 'l', 'o'};
    fw.write(chars); // å°†å­—ç¬¦æ•°ç»„å†™å…¥æ–‡ä»¶
} catch (IOException e) {
    e.printStackTrace();
} finally {
    try {
        if (fw != null) {
            fw.close();
        }
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

â‘¢ã€**å†™å…¥æŒ‡å®šå­—ç¬¦æ•°ç»„**ï¼š`write(char[] cbuf, int off, int len)` æ–¹æ³•ï¼Œå°†æŒ‡å®šå­—ç¬¦æ•°ç»„çš„ä¸€éƒ¨åˆ†å†™å…¥è¾“å‡ºæµã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼ˆé‡å¤çš„éƒ¨åˆ†å°±ä¸å†™äº†å“ˆï¼Œå‚ç…§ä¸Šé¢çš„éƒ¨åˆ†ï¼‰ï¼š

```java
fw = new FileWriter("output.txt");
    char[] chars = {'H', 'e', 'l', 'l', 'o', ',', ' ', 'W', 'o', 'r', 'l', 'd', '!'};
fw.write(chars, 0, 5); // å°†å­—ç¬¦æ•°ç»„çš„å‰ 5 ä¸ªå­—ç¬¦å†™å…¥æ–‡ä»¶
```

ä½¿ç”¨ `fw.write()` æ–¹æ³•å°†å­—ç¬¦æ•°ç»„çš„å‰ 5 ä¸ªå­—ç¬¦å†™å…¥æ–‡ä»¶ä¸­ã€‚

â‘£ã€**å†™å…¥å­—ç¬¦ä¸²**ï¼š`write(String str)` æ–¹æ³•ï¼Œå°†æŒ‡å®šå­—ç¬¦ä¸²å†™å…¥è¾“å‡ºæµã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
fw = new FileWriter("output.txt");
String str = "æ²‰é»˜ç‹äºŒ";
fw.write(str); // å°†å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶
```

â‘¤ã€**å†™å…¥æŒ‡å®šå­—ç¬¦ä¸²**ï¼š`write(String str, int off, int len)` æ–¹æ³•ï¼Œå°†æŒ‡å®šå­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†å†™å…¥è¾“å‡ºæµã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼ˆtry-with-resourceså½¢å¼ï¼‰ï¼š

```java
String str = "æ²‰é»˜ç‹äºŒçœŸçš„å¸…å•Šï¼";
try (FileWriter fw = new FileWriter("output.txt")) {
    fw.write(str, 0, 5); // å°†å­—ç¬¦ä¸²çš„å‰ 5 ä¸ªå­—ç¬¦å†™å…¥æ–‡ä»¶
} catch (IOException e) {
    e.printStackTrace();
}
```

>ã€æ³¨æ„ã€‘å¦‚æœä¸å…³é—­èµ„æºï¼Œæ•°æ®åªæ˜¯ä¿å­˜åˆ°ç¼“å†²åŒºï¼Œå¹¶æœªä¿å­˜åˆ°æ–‡ä»¶ä¸­ã€‚

#### 3ï¼‰å…³é—­closeå’Œåˆ·æ–°flush

å› ä¸º FileWriter å†…ç½®äº†ç¼“å†²åŒº ByteBufferï¼Œæ‰€ä»¥å¦‚æœä¸å…³é—­è¾“å‡ºæµï¼Œå°±æ— æ³•æŠŠå­—ç¬¦å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/reader-writer-20230320183546.png)

ä½†æ˜¯å…³é—­äº†æµå¯¹è±¡ï¼Œå°±æ— æ³•ç»§ç»­å†™æ•°æ®äº†ã€‚å¦‚æœæˆ‘ä»¬æ—¢æƒ³å†™å…¥æ•°æ®ï¼Œåˆæƒ³ç»§ç»­ä½¿ç”¨æµï¼Œå°±éœ€è¦ `flush` æ–¹æ³•äº†ã€‚

`flush` ï¼šåˆ·æ–°ç¼“å†²åŒºï¼Œæµå¯¹è±¡å¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚

`close` ï¼šå…ˆåˆ·æ–°ç¼“å†²åŒºï¼Œç„¶åé€šçŸ¥ç³»ç»Ÿé‡Šæ”¾èµ„æºã€‚æµå¯¹è±¡ä¸å¯ä»¥å†è¢«ä½¿ç”¨äº†ã€‚

flushè¿˜æ˜¯æ¯”è¾ƒæœ‰è¶£çš„ï¼Œæ¥æ®µä»£ç ä½“ä¼šä½“ä¼šï¼š

```java
//æº   ä¹Ÿå°±æ˜¯è¾“å…¥æµã€è¯»å–æµã€‘ è¯»å–a.txtæ–‡ä»¶
FileReader fr=new FileReader("abc.txt");  //å¿…é¡»è¦å­˜åœ¨a.txtæ–‡ä»¶ï¼Œå¦åˆ™æŠ¥FileNotFoundExceptionå¼‚å¸¸
//ç›®çš„åœ°  ä¹Ÿå°±æ˜¯è¾“å‡ºæµ
FileWriter fw=new FileWriter("b.txt");  //ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºb.txtï¼Œå› ä¸ºå®ƒæ˜¯è¾“å‡ºæµï¼
int len;
while((len=fr.read())!=-1){
    fw.write(len);
}
//æ³¨æ„è¿™é‡Œæ˜¯æ²¡æœ‰ä½¿ç”¨closeå…³é—­æµï¼Œå¼€å‘ä¸­ä¸èƒ½è¿™æ ·åšï¼Œä½†æ˜¯ä¸ºäº†æ›´å¥½çš„ä½“ä¼šflushçš„ä½œç”¨
```

è¿è¡Œæ•ˆæœæ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿç­”æ¡ˆæ˜¯b.txtæ–‡ä»¶ä¸­ä¾æ—§æ˜¯ç©ºçš„ï¼Œå¹¶æ²¡æœ‰ä»»ä½•ä¸œè¥¿ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/io/reader-writer-3b4fd024-856f-45ee-8183-1a1ee808e5ce.png)

åŸå› æˆ‘ä»¬å‰é¢å·²ç»è¯´è¿‡äº†ã€‚**ç¼–ç¨‹å°±æ˜¯è¿™æ ·ï¼Œä¸å»æ•²ï¼Œæ°¸è¿œå­¦ä¸ä¼š**ï¼ï¼ï¼æ‰€ä»¥ä¸€å®šè¦å»æ•²ï¼Œå¤šæ•²å•Šï¼ï¼ï¼

åœ¨ä»¥ä¸Šçš„ä»£ç ä¸­å†æ·»åŠ ä¸‹é¢ä¸‰å¥ä»£ç ï¼Œb.txtæ–‡ä»¶å°±èƒ½å¤åˆ¶åˆ°æºæ–‡ä»¶çš„æ•°æ®äº†ï¼

```java
fr.close();
fw.flush();
fw.close();
```

`flush()`è¿™ä¸ªæ–¹æ³•æ˜¯æ¸…ç©ºç¼“å­˜çš„æ„æ€ï¼Œç”¨äºæ¸…ç©ºç¼“å†²åŒºçš„æ•°æ®æµï¼Œè¿›è¡Œæµçš„æ“ä½œæ—¶ï¼Œæ•°æ®å…ˆè¢«è¯»åˆ°å†…å­˜ä¸­ï¼Œç„¶åå†æŠŠæ•°æ®å†™åˆ°æ–‡ä»¶ä¸­ã€‚

ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç ç¤ºä¾‹å†ä½“éªŒä¸€ä¸‹ï¼š

```java
// ä½¿ç”¨æ–‡ä»¶åç§°åˆ›å»ºæµå¯¹è±¡
FileWriter fw = new FileWriter("fw.txt");
// å†™å‡ºæ•°æ®ï¼Œé€šè¿‡flush
fw.write('åˆ·'); // å†™å‡ºç¬¬1ä¸ªå­—ç¬¦
fw.flush();
fw.write('æ–°'); // ç»§ç»­å†™å‡ºç¬¬2ä¸ªå­—ç¬¦ï¼Œå†™å‡ºæˆåŠŸ
fw.flush();

// å†™å‡ºæ•°æ®ï¼Œç„¶åclose
fw.write('å…³'); // å†™å‡ºç¬¬1ä¸ªå­—ç¬¦
fw.close();
fw.write('é—­'); // ç»§ç»­å†™å‡ºç¬¬2ä¸ªå­—ç¬¦,ã€æŠ¥é”™ã€‘java.io.IOException: Stream closed
fw.close();
```

æ³¨æ„ï¼Œå³ä¾¿æ˜¯flushæ–¹æ³•å†™å‡ºäº†æ•°æ®ï¼Œæ“ä½œçš„æœ€åè¿˜æ˜¯è¦è°ƒç”¨closeæ–¹æ³•ï¼Œé‡Šæ”¾ç³»ç»Ÿèµ„æºã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç”¨ try-with-resources çš„æ–¹å¼ã€‚

#### 4ï¼‰FileWriterçš„ç»­å†™å’Œæ¢è¡Œ

**ç»­å†™å’Œæ¢è¡Œ**ï¼šæ“ä½œç±»ä¼¼äº[FileOutputStreamæ“ä½œ](https://tobebetterjavaer.com/io/stream.html)ï¼Œç›´æ¥ä¸Šä»£ç ï¼š

```java
// ä½¿ç”¨æ–‡ä»¶åç§°åˆ›å»ºæµå¯¹è±¡ï¼Œå¯ä»¥ç»­å†™æ•°æ®
FileWriter fw = new FileWriter("fw.txt",true);     
// å†™å‡ºå­—ç¬¦ä¸²
fw.write("æ²‰é»˜ç‹äºŒ");
// å†™å‡ºæ¢è¡Œ
fw.write("\r\n");
// å†™å‡ºå­—ç¬¦ä¸²
fw.write("æ˜¯å‚» X");
// å…³é—­èµ„æº
fw.close();
```

è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
è¾“å‡ºç»“æœ:
æ²‰é»˜ç‹äºŒ
æ˜¯å‚» X
```


#### 5ï¼‰æ–‡æœ¬æ–‡ä»¶å¤åˆ¶

ç›´æ¥ä¸Šä»£ç ï¼š

```java
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;

public class CopyFile {
    public static void main(String[] args) throws IOException {
        //åˆ›å»ºè¾“å…¥æµå¯¹è±¡
        FileReader fr=new FileReader("aa.txt");//æ–‡ä»¶ä¸å­˜åœ¨ä¼šæŠ›å‡ºjava.io.FileNotFoundException
        //åˆ›å»ºè¾“å‡ºæµå¯¹è±¡
        FileWriter fw=new FileWriter("copyaa.txt");
        /*åˆ›å»ºè¾“å‡ºæµåšçš„å·¥ä½œï¼š
         *      1ã€è°ƒç”¨ç³»ç»Ÿèµ„æºåˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶
         *      2ã€åˆ›å»ºè¾“å‡ºæµå¯¹è±¡
         *      3ã€æŠŠè¾“å‡ºæµå¯¹è±¡æŒ‡å‘æ–‡ä»¶        
         * */
        //æ–‡æœ¬æ–‡ä»¶å¤åˆ¶ï¼Œä¸€æ¬¡è¯»ä¸€ä¸ªå­—ç¬¦
        copyMethod1(fr, fw);
        //æ–‡æœ¬æ–‡ä»¶å¤åˆ¶ï¼Œä¸€æ¬¡è¯»ä¸€ä¸ªå­—ç¬¦æ•°ç»„
        copyMethod2(fr, fw);
        
        fr.close();
        fw.close();
    }

    public static void copyMethod1(FileReader fr, FileWriter fw) throws IOException {
        int ch;
        while((ch=fr.read())!=-1) {//è¯»æ•°æ®
            fw.write(ch);//å†™æ•°æ®
        }
        fw.flush();
    }

    public static void copyMethod2(FileReader fr, FileWriter fw) throws IOException {
        char chs[]=new char[1024];
        int len=0;
        while((len=fr.read(chs))!=-1) {//è¯»æ•°æ®
            fw.write(chs,0,len);//å†™æ•°æ®
        }
        fw.flush();
    }
}
```

### 03ã€IOå¼‚å¸¸çš„å¤„ç†

æˆ‘ä»¬åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¹ æƒ¯æŠŠå¼‚å¸¸æŠ›å‡ºï¼Œè€Œå®é™…å¼€å‘ä¸­å»ºè®®ä½¿ç”¨`try...catch...finally` ä»£ç å—ï¼Œå¤„ç†å¼‚å¸¸éƒ¨åˆ†ï¼Œæ ¼å¼ä»£ç å¦‚ä¸‹ï¼š

```java
// å£°æ˜å˜é‡
FileWriter fw = null;
try {
    //åˆ›å»ºæµå¯¹è±¡
    fw = new FileWriter("fw.txt");
    // å†™å‡ºæ•°æ®
    fw.write("äºŒå“¥çœŸçš„å¸…"); //å“¥æ•¢æ‘¸si
} catch (IOException e) {
    e.printStackTrace();
} finally {
    try {
        if (fw != null) {
            fw.close();
        }
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

æˆ–è€…ç›´æ¥ä½¿ç”¨ try-with-resources çš„æ–¹å¼ã€‚

```java
try (FileWriter fw = new FileWriter("fw.txt")) {
    // å†™å‡ºæ•°æ®
    fw.write("äºŒå“¥çœŸçš„å¸…"); //å“¥æ•¢æ‘¸si
} catch (IOException e) {
    e.printStackTrace();
}
```

åœ¨è¿™ä¸ªä»£ç ä¸­ï¼Œtry-with-resources ä¼šåœ¨ try å—æ‰§è¡Œå®Œæ¯•åè‡ªåŠ¨å…³é—­ FileWriter å¯¹è±¡ fwï¼Œä¸éœ€è¦æ‰‹åŠ¨å…³é—­æµã€‚å¦‚æœåœ¨ try å—ä¸­å‘ç”Ÿäº†å¼‚å¸¸ï¼Œä¹Ÿä¼šè‡ªåŠ¨å…³é—­æµå¹¶æŠ›å‡ºå¼‚å¸¸ã€‚å› æ­¤ï¼Œä½¿ç”¨ try-with-resources å¯ä»¥è®©ä»£ç æ›´åŠ ç®€æ´ã€å®‰å…¨å’Œæ˜“è¯»ã€‚

###  04ã€å°ç»“

Writer å’Œ Reader æ˜¯ Java I/O ä¸­ç”¨äºå­—ç¬¦è¾“å…¥è¾“å‡ºçš„æŠ½è±¡ç±»ï¼Œå®ƒä»¬æä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•ç”¨äºè¯»å–å’Œå†™å…¥å­—ç¬¦æ•°æ®ã€‚å®ƒä»¬çš„åŒºåˆ«åœ¨äº Writer ç”¨äºå°†å­—ç¬¦æ•°æ®å†™å…¥åˆ°è¾“å‡ºæµä¸­ï¼Œè€Œ Reader ç”¨äºä»è¾“å…¥æµä¸­è¯»å–å­—ç¬¦æ•°æ®ã€‚

Writer å’Œ Reader çš„å¸¸ç”¨å­ç±»æœ‰ FileWriterã€FileReaderï¼Œå¯ä»¥å°†å­—ç¬¦æµå†™å…¥å’Œè¯»å–åˆ°æ–‡ä»¶ä¸­ã€‚

åœ¨ä½¿ç”¨ Writer å’Œ Reader è¿›è¡Œå­—ç¬¦è¾“å…¥è¾“å‡ºæ—¶ï¼Œéœ€è¦æ³¨æ„å­—ç¬¦ç¼–ç çš„é—®é¢˜ã€‚

---------

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 7.5 ç¼“å†²æµ

Java çš„ç¼“å†²æµæ˜¯å¯¹å­—èŠ‚æµå’Œå­—ç¬¦æµçš„ä¸€ç§å°è£…ï¼Œé€šè¿‡åœ¨å†…å­˜ä¸­å¼€è¾Ÿç¼“å†²åŒºæ¥æé«˜ I/O æ“ä½œçš„æ•ˆç‡ã€‚Java é€šè¿‡ BufferedInputStream å’Œ BufferedOutputStream æ¥å®ç°å­—èŠ‚æµçš„ç¼“å†²ï¼Œé€šè¿‡ BufferedReader å’Œ BufferedWriter æ¥å®ç°å­—ç¬¦æµçš„ç¼“å†²ã€‚

ç¼“å†²æµçš„å·¥ä½œåŸç†æ˜¯å°†æ•°æ®å…ˆå†™å…¥ç¼“å†²åŒºä¸­ï¼Œå½“ç¼“å†²åŒºæ»¡æ—¶å†ä¸€æ¬¡æ€§å†™å…¥æ–‡ä»¶æˆ–è¾“å‡ºæµï¼Œæˆ–è€…å½“ç¼“å†²åŒºä¸ºç©ºæ—¶ä¸€æ¬¡æ€§ä»æ–‡ä»¶æˆ–è¾“å…¥æµä¸­è¯»å–ä¸€å®šé‡çš„æ•°æ®ã€‚è¿™æ ·å¯ä»¥å‡å°‘ç³»ç»Ÿçš„ I/O æ“ä½œæ¬¡æ•°ï¼Œæé«˜ç³»ç»Ÿçš„ I/O æ•ˆç‡ï¼Œä»è€Œæé«˜ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚

### 01ã€å­—èŠ‚ç¼“å†²æµ

BufferedInputStream å’Œ BufferedOutputStream å±äºå­—èŠ‚ç¼“å†²æµï¼Œå¼ºåŒ–äº†å­—èŠ‚æµ InputStream å’Œ OutputStreamï¼Œå…³äºå­—èŠ‚æµï¼Œæˆ‘ä»¬å‰é¢å·²ç»è¯¦ç»†åœ°è®²è¿‡äº†ï¼Œå¯ä»¥[æˆ³è¿™ä¸ªé“¾æ¥](https://tobebetterjavaer.com/io/stream.html)å»æ¸©ä¹ ã€‚

#### 1ï¼‰æ„é€ æ–¹æ³•

*   `BufferedInputStream(InputStream in)` ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç¼“å†²è¾“å…¥æµï¼Œæ³¨æ„å‚æ•°ç±»å‹ä¸º**InputStream**ã€‚
*   `BufferedOutputStream(OutputStream out)`ï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„ç¼“å†²è¾“å‡ºæµï¼Œæ³¨æ„å‚æ•°ç±»å‹ä¸º**OutputStream**ã€‚

ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
// åˆ›å»ºå­—èŠ‚ç¼“å†²è¾“å…¥æµï¼Œå…ˆå£°æ˜å­—èŠ‚æµ
FileInputStream fps = new FileInputStream(b.txt);
BufferedInputStream bis = new BufferedInputStream(fps)

// åˆ›å»ºå­—èŠ‚ç¼“å†²è¾“å…¥æµï¼ˆä¸€æ­¥åˆ°ä½ï¼‰
BufferedInputStream bis = new BufferedInputStream(new FileInputStream("b.txt"));

// åˆ›å»ºå­—èŠ‚ç¼“å†²è¾“å‡ºæµï¼ˆä¸€æ­¥åˆ°ä½ï¼‰
BufferedOutputStream bos = new BufferedOutputStream(new FileOutputStream("b.txt"));
```

#### 2ï¼‰ç¼“å†²æµçš„é«˜æ•ˆ

æˆ‘ä»¬é€šè¿‡å¤åˆ¶ä¸€ä¸ª 370M+ çš„å¤§æ–‡ä»¶ï¼Œæ¥æµ‹è¯•ç¼“å†²æµçš„æ•ˆç‡ã€‚ä¸ºäº†åšå¯¹æ¯”ï¼Œæˆ‘ä»¬å…ˆç”¨åŸºæœ¬æµæ¥å®ç°ä¸€ä¸‹ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
// è®°å½•å¼€å§‹æ—¶é—´
long start = System.currentTimeMillis();
// åˆ›å»ºæµå¯¹è±¡
try (FileInputStream fis = new FileInputStream("py.mp4");//exeæ–‡ä»¶å¤Ÿå¤§
        FileOutputStream fos = new FileOutputStream("copyPy.mp4")){
    // è¯»å†™æ•°æ®
    int b;
    while ((b = fis.read()) != -1) {
        fos.write(b);
    }
}
// è®°å½•ç»“æŸæ—¶é—´
long end = System.currentTimeMillis();
System.out.println("æ™®é€šæµå¤åˆ¶æ—¶é—´:"+(end - start)+" æ¯«ç§’");
```

ä¸å¥½æ„æ€ï¼Œæˆ‘æœ¬æœºæ¯”è¾ƒèœï¼Œ10 åˆ†é’Ÿè¿˜åœ¨å¤åˆ¶ä¸­ã€‚åˆ‡æ¢åˆ°ç¼“å†²æµè¯•ä¸€ä¸‹ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
// è®°å½•å¼€å§‹æ—¶é—´
long start = System.currentTimeMillis();
// åˆ›å»ºæµå¯¹è±¡
try (BufferedInputStream bis = new BufferedInputStream(new FileInputStream("py.mp4"));
        BufferedOutputStream bos = new BufferedOutputStream(new FileOutputStream("copyPy.mp4"));){
    // è¯»å†™æ•°æ®
    int b;
    while ((b = bis.read()) != -1) {
        bos.write(b);
    }
}
// è®°å½•ç»“æŸæ—¶é—´
long end = System.currentTimeMillis();
System.out.println("ç¼“å†²æµå¤åˆ¶æ—¶é—´:"+(end - start)+" æ¯«ç§’");
```

åªéœ€è¦ 8016 æ¯«ç§’ï¼Œå¦‚ä½•æ›´å¿«å‘¢ï¼Ÿ

å¯ä»¥æ¢æ•°ç»„çš„æ–¹å¼æ¥è¯»å†™ï¼Œè¿™ä¸ªæˆ‘ä»¬å‰é¢ä¹Ÿæœ‰è®²åˆ°ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
// è®°å½•å¼€å§‹æ—¶é—´
long start = System.currentTimeMillis();
// åˆ›å»ºæµå¯¹è±¡
try (BufferedInputStream bis = new BufferedInputStream(new FileInputStream("py.mp4"));
        BufferedOutputStream bos = new BufferedOutputStream(new FileOutputStream("copyPy.mp4"));){
    // è¯»å†™æ•°æ®
    int len;
    byte[] bytes = new byte[8*1024];
    while ((len = bis.read(bytes)) != -1) {
        bos.write(bytes, 0 , len);
    }
}
// è®°å½•ç»“æŸæ—¶é—´
long end = System.currentTimeMillis();
System.out.println("ç¼“å†²æµä½¿ç”¨æ•°ç»„å¤åˆ¶æ—¶é—´:"+(end - start)+" æ¯«ç§’");
```

è¿™ä¸‹å°±æ›´å¿«äº†ï¼Œåªéœ€è¦ 521 æ¯«ç§’ã€‚

#### 3ï¼‰ä¸ºä»€ä¹ˆå­—èŠ‚ç¼“å†²æµä¼šè¿™ä¹ˆå¿«ï¼Ÿ


ä¼ ç»Ÿçš„ Java IO æ˜¯é˜»å¡æ¨¡å¼çš„ï¼Œå®ƒçš„å·¥ä½œçŠ¶æ€å°±æ˜¯â€œè¯»/å†™ï¼Œç­‰å¾…ï¼Œè¯»/å†™ï¼Œç­‰å¾…ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚â€

å­—èŠ‚ç¼“å†²æµè§£å†³çš„å°±æ˜¯è¿™ä¸ªé—®é¢˜ï¼š**ä¸€æ¬¡å¤šè¯»ç‚¹å¤šå†™ç‚¹ï¼Œå‡å°‘è¯»å†™çš„é¢‘ç‡ï¼Œç”¨ç©ºé—´æ¢æ—¶é—´**ã€‚

- å‡å°‘ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ï¼šåœ¨ä½¿ç”¨å­—èŠ‚ç¼“å†²æµæ—¶ï¼Œæ•°æ®ä¸æ˜¯ç«‹å³å†™å…¥ç£ç›˜æˆ–è¾“å‡ºæµï¼Œè€Œæ˜¯å…ˆå†™å…¥ç¼“å†²åŒºï¼Œå½“ç¼“å†²åŒºæ»¡æ—¶å†ä¸€æ¬¡æ€§å†™å…¥ç£ç›˜æˆ–è¾“å‡ºæµã€‚è¿™æ ·å¯ä»¥å‡å°‘ç³»ç»Ÿè°ƒç”¨çš„æ¬¡æ•°ï¼Œä»è€Œæé«˜ I/O æ“ä½œçš„æ•ˆç‡ã€‚
- å‡å°‘ç£ç›˜è¯»å†™æ¬¡æ•°ï¼šåœ¨ä½¿ç”¨å­—èŠ‚ç¼“å†²æµæ—¶ï¼Œå½“éœ€è¦è¯»å–æ•°æ®æ—¶ï¼Œç¼“å†²æµä¼šå…ˆä»ç¼“å†²åŒºä¸­è¯»å–æ•°æ®ï¼Œå¦‚æœç¼“å†²åŒºä¸­æ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®ï¼Œåˆ™ä¼šä¸€æ¬¡æ€§ä»ç£ç›˜æˆ–è¾“å…¥æµä¸­è¯»å–ä¸€å®šé‡çš„æ•°æ®ã€‚åŒæ ·åœ°ï¼Œå½“éœ€è¦å†™å…¥æ•°æ®æ—¶ï¼Œç¼“å†²æµä¼šå…ˆå°†æ•°æ®å†™å…¥ç¼“å†²åŒºï¼Œå¦‚æœç¼“å†²åŒºæ»¡äº†ï¼Œåˆ™ä¼šä¸€æ¬¡æ€§å°†ç¼“å†²åŒºä¸­çš„æ•°æ®å†™å…¥ç£ç›˜æˆ–è¾“å‡ºæµã€‚è¿™æ ·å¯ä»¥å‡å°‘ç£ç›˜è¯»å†™çš„æ¬¡æ•°ï¼Œä»è€Œæé«˜ I/O æ“ä½œçš„æ•ˆç‡ã€‚
- æé«˜æ•°æ®ä¼ è¾“æ•ˆç‡ï¼šåœ¨ä½¿ç”¨å­—èŠ‚ç¼“å†²æµæ—¶ï¼Œç”±äºæ•°æ®æ˜¯ä»¥å—çš„å½¢å¼è¿›è¡Œä¼ è¾“ï¼Œå› æ­¤å¯ä»¥å‡å°‘æ•°æ®ä¼ è¾“çš„æ¬¡æ•°ï¼Œä»è€Œæé«˜æ•°æ®ä¼ è¾“çš„æ•ˆç‡ã€‚

æˆ‘ä»¬æ¥çœ‹ BufferedInputStream çš„ read æ–¹æ³•ï¼š

```java
public synchronized int read() throws IOException {
    if (pos >= count) {     // å¦‚æœå½“å‰ä½ç½®å·²ç»åˆ°è¾¾ç¼“å†²åŒºæœ«å°¾
        fill();             // å¡«å……ç¼“å†²åŒº
        if (pos >= count)   // å¦‚æœå¡«å……åä»ç„¶åˆ°è¾¾ç¼“å†²åŒºæœ«å°¾ï¼Œè¯´æ˜å·²ç»è¯»å–å®Œæ¯•
            return -1;      // è¿”å› -1 è¡¨ç¤ºå·²ç»è¯»å–å®Œæ¯•
    }
    return getBufIfOpen()[pos++] & 0xff; // è¿”å›å½“å‰ä½ç½®çš„å­—èŠ‚ï¼Œå¹¶å°†ä½ç½®åŠ  1
}
```

è¿™æ®µä»£ç ä¸»è¦æœ‰ä¸¤éƒ¨åˆ†ï¼š

- `fill()`ï¼šè¯¥æ–¹æ³•ä¼šå°†ç¼“å†² buf å¡«æ»¡ã€‚
- `getBufIfOpen()[pos++] & 0xff`ï¼šè¿”å›å½“å‰è¯»å–ä½ç½® pos å¤„çš„å­—èŠ‚ï¼ˆ`getBufIfOpen()`è¿”å›çš„æ˜¯ buffer æ•°ç»„ï¼Œæ˜¯ byte ç±»å‹ï¼‰ï¼Œå¹¶å°†å…¶ä¸ 0xff è¿›è¡Œä½ä¸è¿ç®—ã€‚è¿™é‡Œçš„ç›®çš„æ˜¯å°†è¯»å–åˆ°çš„å­—èŠ‚ b å½“åšæ— ç¬¦å·çš„å­—èŠ‚å¤„ç†ï¼Œå› ä¸º Java çš„ byte ç±»å‹æ˜¯æœ‰ç¬¦å·çš„ï¼Œè€Œå°† b ä¸ 0xff è¿›è¡Œä½ä¸è¿ç®—ï¼Œå°±å¯ä»¥å°†å…¶è½¬æ¢ä¸ºæ— ç¬¦å·çš„å­—èŠ‚ï¼Œå…¶èŒƒå›´ä¸º 0 åˆ° 255ã€‚

>byte & 0xFF æˆ‘ä»¬ä¸€ä¼šå†ç»†è®²ã€‚

å†æ¥çœ‹ FileInputStream çš„ read æ–¹æ³•ï¼š

![](https://cdn.tobebetterjavaer.com/stutymore/buffer-20230321154534.png)

åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ`read0()` æ–¹æ³•æ˜¯ä¸€ä¸ª[æœ¬åœ°æ–¹æ³•](https://tobebetterjavaer.com/oo/native-method.html)ï¼Œå®ƒçš„å®ç°æ˜¯ç”±åº•å±‚æ“ä½œç³»ç»Ÿæä¾›çš„ï¼Œå¹¶ä¸æ˜¯ Java è¯­è¨€å®ç°çš„ã€‚åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šï¼Œ`read0()` æ–¹æ³•çš„å®ç°å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯å®ƒä»¬çš„åŠŸèƒ½éƒ½æ˜¯ç›¸åŒçš„ï¼Œéƒ½æ˜¯ç”¨äº**è¯»å–ä¸€ä¸ªå­—èŠ‚**ã€‚

å†æ¥çœ‹ä¸€ä¸‹ BufferedOutputStream çš„ `write(byte b[], int off, int len)` æ–¹æ³•ï¼š

```java
public synchronized void write(byte b[], int off, int len) throws IOException {
    if (len >= buf.length) {    // å¦‚æœå†™å…¥çš„å­—èŠ‚æ•°å¤§äºç­‰äºç¼“å†²åŒºé•¿åº¦
        /* å¦‚æœè¯·æ±‚çš„é•¿åº¦è¶…è¿‡äº†è¾“å‡ºç¼“å†²åŒºçš„å¤§å°ï¼Œ
           å…ˆåˆ·æ–°ç¼“å†²åŒºï¼Œç„¶åç›´æ¥å°†æ•°æ®å†™å…¥ã€‚
           è¿™æ ·å¯ä»¥é¿å…ç¼“å†²æµçº§è”æ—¶çš„é—®é¢˜ã€‚*/
        flushBuffer();          // å…ˆåˆ·æ–°ç¼“å†²åŒº
        out.write(b, off, len); // ç›´æ¥å°†æ•°æ®å†™å…¥è¾“å‡ºæµ
        return;
    }
    if (len > buf.length - count) { // å¦‚æœå†™å…¥çš„å­—èŠ‚æ•°å¤§äºç©ºä½™ç©ºé—´
        flushBuffer();              // å…ˆåˆ·æ–°ç¼“å†²åŒº
    }
    System.arraycopy(b, off, buf, count, len); // å°†æ•°æ®æ‹·è´åˆ°ç¼“å†²åŒºä¸­
    count += len;                             // æ›´æ–°è®¡æ•°å™¨
}
```

é¦–å…ˆï¼Œè¯¥æ–¹æ³•ä¼šæ£€æŸ¥å†™å…¥çš„å­—èŠ‚æ•°æ˜¯å¦å¤§äºç­‰äºç¼“å†²åŒºé•¿åº¦ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å…ˆå°†ç¼“å†²åŒºä¸­çš„æ•°æ®åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼Œç„¶åç›´æ¥å°†æ•°æ®å†™å…¥è¾“å‡ºæµã€‚è¿™æ ·åšæ˜¯ä¸ºäº†é¿å…ç¼“å†²æµçº§è”æ—¶çš„é—®é¢˜ï¼Œå³ç¼“å†²åŒºçš„å¤§å°ä¸è¶³ä»¥å®¹çº³å†™å…¥çš„æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šå¼•å‘çº§è”åˆ·æ–°ï¼Œå¯¼è‡´æ•ˆç‡é™ä½ã€‚

>çº§è”é—®é¢˜ï¼ˆCascade Problemï¼‰æ˜¯æŒ‡åœ¨ä¸€ç»„ç¼“å†²æµï¼ˆBuffered Streamï¼‰ä¸­ï¼Œç”±äºç¼“å†²åŒºçš„å¤§å°ä¸è¶³ä»¥å®¹çº³è¦å†™å…¥çš„æ•°æ®ï¼Œå¯¼è‡´æ•°æ®è¢«åˆ†å‰²æˆå¤šä¸ªéƒ¨åˆ†ï¼Œå¹¶åˆ†åˆ«å†™å…¥åˆ°ä¸åŒçš„ç¼“å†²åŒºä¸­ï¼Œæœ€ç»ˆéœ€è¦é€ä¸ªåˆ·æ–°ç¼“å†²åŒºï¼Œä»è€Œå¯¼è‡´æ€§èƒ½ä¸‹é™çš„é—®é¢˜ã€‚

å…¶æ¬¡ï¼Œå¦‚æœå†™å…¥çš„å­—èŠ‚æ•°å°äºç¼“å†²åŒºé•¿åº¦ï¼Œåˆ™æ£€æŸ¥ç¼“å†²åŒºä¸­å‰©ä½™çš„ç©ºé—´æ˜¯å¦è¶³å¤Ÿå®¹çº³è¦å†™å…¥çš„å­—èŠ‚æ•°ï¼Œå¦‚æœä¸å¤Ÿï¼Œåˆ™å…ˆå°†ç¼“å†²åŒºä¸­çš„æ•°æ®åˆ·æ–°åˆ°ç£ç›˜ä¸­ã€‚ç„¶åï¼Œä½¿ç”¨ `System.arraycopy()` æ–¹æ³•å°†è¦å†™å…¥çš„æ•°æ®æ‹·è´åˆ°ç¼“å†²åŒºä¸­ï¼Œå¹¶æ›´æ–°è®¡æ•°å™¨ countã€‚

æœ€åï¼Œå¦‚æœå†™å…¥çš„å­—èŠ‚æ•°å°äºç¼“å†²åŒºé•¿åº¦ä¸”ç¼“å†²åŒºä¸­è¿˜æœ‰å‰©ä½™ç©ºé—´ï¼Œåˆ™ç›´æ¥å°†è¦å†™å…¥çš„æ•°æ®æ‹·è´åˆ°ç¼“å†²åŒºä¸­ï¼Œå¹¶æ›´æ–°è®¡æ•°å™¨ countã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰å½“ buf å†™æ»¡äº†ï¼Œæ‰ä¼š flushï¼Œå°†æ•°æ®åˆ·åˆ°ç£ç›˜ï¼Œé»˜è®¤ä¸€æ¬¡åˆ· 8192 ä¸ªå­—èŠ‚ã€‚

```java
public BufferedOutputStream(OutputStream out) {
    this(out, 8192);
}
```

å¦‚æœ buf æ²¡æœ‰å†™æ»¡ï¼Œä¼šç»§ç»­å†™ bufã€‚

å¯¹æ¯”ä¸€ä¸‹ FileOutputStream çš„ write æ–¹æ³•ï¼ŒåŒæ ·æ˜¯æœ¬åœ°æ–¹æ³•ï¼Œä¸€æ¬¡åªèƒ½å†™å…¥ä¸€ä¸ªå­—èŠ‚ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/buffer-20230321162808.png)

å½“æŠŠ BufferedOutputStream å’Œ BufferedInputStream é…åˆèµ·æ¥ä½¿ç”¨åï¼Œå°±å‡å°‘äº†å¤§é‡çš„è¯»å†™æ¬¡æ•°ï¼Œå°¤å…¶æ˜¯ `byte[] bytes = new byte[8*1024]`ï¼Œå°±ç›¸å½“äºç¼“å†²åŒºçš„ç©ºé—´æœ‰ 8 ä¸ª 1024 å­—èŠ‚ï¼Œé‚£è¯»å†™æ•ˆç‡å°±ä¼šå¤§å¤§æé«˜ã€‚

#### 4ï¼‰`byte & 0xFF`

byte ç±»å‹é€šå¸¸è¢«ç”¨äºå­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ï¼Œä¾‹å¦‚è¯»å–å’Œå†™å…¥æ–‡ä»¶ã€ç½‘ç»œä¼ è¾“ç­‰åœºæ™¯ã€‚åœ¨è¿™äº›åœºæ™¯ä¸‹ï¼Œbyte ç±»å‹çš„å˜é‡å¯ä»¥ç”¨æ¥å­˜å‚¨æ•°æ®æµä¸­çš„æ¯ä¸ªå­—èŠ‚ï¼Œä»è€Œè¿›è¡Œè¯»å–å’Œå†™å…¥æ“ä½œã€‚

byte ç±»å‹æ˜¯æœ‰ç¬¦å·çš„ï¼Œå³å…¶å–å€¼èŒƒå›´ä¸º -128 åˆ° 127ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›å¾—åˆ°çš„æ˜¯ä¸€ä¸ªæ— ç¬¦å·çš„ byte å€¼ï¼Œå°±éœ€è¦ä½¿ç”¨ `byte & 0xFF` æ¥è¿›è¡Œè½¬æ¢ã€‚

è¿™æ˜¯å› ä¸º 0xFF æ˜¯ä¸€ä¸ªæ— ç¬¦å·çš„æ•´æ•°ï¼Œå®ƒçš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸º 11111111ã€‚å½“ä¸€ä¸ª byte ç±»å‹çš„å€¼ä¸ 0xFF è¿›è¡Œä½ä¸è¿ç®—æ—¶ï¼Œä¼šå°† byte ç±»å‹çš„å€¼è½¬æ¢ä¸ºä¸€ä¸ªæ— ç¬¦å·çš„æ•´æ•°ï¼Œå…¶èŒƒå›´ä¸º 0 åˆ° 255ã€‚

0xff æ˜¯ä¸€ä¸ªåå…­è¿›åˆ¶çš„æ•°ï¼Œç›¸å½“äºäºŒè¿›åˆ¶çš„ 11111111ï¼Œ& è¿ç®—ç¬¦çš„æ„æ€æ˜¯ï¼šå¦‚æœä¸¤ä¸ªæ“ä½œæ•°çš„å¯¹åº”ä½ä¸º 1ï¼Œåˆ™è¾“å‡º 1ï¼Œå¦åˆ™ä¸º 0ï¼›ç”±äº 0xff æœ‰ 8 ä¸ª 1ï¼Œå•ä¸ª byte è½¬æˆ int å…¶å®å°±æ˜¯å°† byte å’Œ int ç±»å‹çš„ 255 è¿›è¡Œ(&)ä¸è¿ç®—ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ª byte ç±»å‹çš„å˜é‡ bï¼Œå…¶å€¼ä¸º -1ï¼Œé‚£ä¹ˆ b & 0xFF çš„ç»“æœå°±æ˜¯ 255ã€‚è¿™æ ·å°±å¯ä»¥å°†ä¸€ä¸ªæœ‰ç¬¦å·çš„ byte ç±»å‹çš„å€¼è½¬æ¢ä¸ºä¸€ä¸ªæ— ç¬¦å·çš„æ•´æ•°ã€‚

& è¿ç®—æ˜¯ä¸€ç§äºŒè¿›åˆ¶æ•°æ®çš„è®¡ç®—æ–¹å¼, ä¸¤ä¸ªæ“ä½œä½éƒ½ä¸º1ï¼Œç»“æœæ‰ä¸º1ï¼Œå¦åˆ™ç»“æœä¸º0. åœ¨ä¸Šé¢çš„ `getBufIfOpen()[pos++] & 0xff` è®¡ç®—è¿‡ç¨‹ä¸­, byte æœ‰ 8bit, OXFF æ˜¯16è¿›åˆ¶çš„255, è¡¨ç¤ºçš„æ˜¯ int ç±»å‹, int æœ‰ 32bit.

å¦‚æœ `getBufIfOpen()[pos++]` ä¸º -118, é‚£ä¹ˆå…¶åŸç è¡¨ç¤ºä¸º

```
00000000 00000000 00000000 10001010
```

åç ä¸º

```
11111111 11111111 11111111 11110101
```

è¡¥ç ä¸º

```
11111111 11111111 11111111 11110110
```

0XFF è¡¨ç¤º16è¿›åˆ¶çš„æ•°æ®255, åŸç , åç , è¡¥ç éƒ½æ˜¯ä¸€æ ·çš„, å…¶äºŒè¿›åˆ¶æ•°æ®ä¸º

```
00000000 00000000 00000000 11111111
```

0XFF å’Œ -118 è¿›è¡Œ&è¿ç®—åç»“æœä¸º

```
00000000 00000000 00000000 11110110
```

è¿˜åŸä¸ºåŸç åä¸º

```
00000000 00000000 00000000 10001010
```

å…¶è¡¨ç¤ºçš„ int å€¼ä¸º 138ï¼Œå¯è§å°† byte ç±»å‹çš„ -118 ä¸ 0XFF è¿›è¡Œä¸è¿ç®—åå€¼ç”± -118 å˜æˆäº† int ç±»å‹çš„ 138ï¼Œå…¶ä¸­ä½8ä½å’Œbyteçš„-118å®Œå…¨ä¸€è‡´ã€‚

é¡ºå¸¦èŠä¸€ä¸‹ åŸç ã€åç å’Œè¡¥ç ã€‚

â‘ ã€åŸç 

åŸç å°±æ˜¯ç¬¦å·ä½åŠ ä¸ŠçœŸå€¼çš„ç»å¯¹å€¼ï¼Œå³ç”¨ç¬¬ä¸€ä½è¡¨ç¤ºç¬¦å·ï¼Œå…¶ä½™ä½è¡¨ç¤ºå€¼ã€‚æ¯”å¦‚å¦‚æœæ˜¯8ä½äºŒè¿›åˆ¶:

```
[+1]åŸ = 0000 0001

[-1]åŸ = 1000 0001
```

ç¬¬ä¸€ä½æ˜¯ç¬¦å·ä½ã€‚å› ä¸ºç¬¬ä¸€ä½æ˜¯ç¬¦å·ä½ï¼Œæ‰€ä»¥8ä½äºŒè¿›åˆ¶æ•°çš„å–å€¼èŒƒå›´å°±æ˜¯ï¼š

```
[1111 1111 , 0111 1111]
```

å³

```
[-127 , 127]
```

â‘¡ã€åç 

åç çš„è¡¨ç¤ºæ–¹æ³•æ˜¯ï¼š

- æ­£æ•°çš„åç æ˜¯å…¶æœ¬èº«
- è´Ÿæ•°çš„åç æ˜¯åœ¨å…¶åŸç çš„åŸºç¡€ä¸Šï¼Œç¬¦å·ä½ä¸å˜ï¼Œå…¶ä½™å„ä¸ªä½å–åã€‚


ä¾‹å¦‚ï¼š

```
[+1] = [00000001]åŸ = [00000001]å

[-1] = [10000001]åŸ = [11111110]å
```

å¯è§å¦‚æœä¸€ä¸ªåç è¡¨ç¤ºçš„æ˜¯è´Ÿæ•°ï¼Œäººè„‘æ— æ³•ç›´è§‚çš„çœ‹å‡ºæ¥å®ƒçš„æ•°å€¼ã€‚é€šå¸¸è¦å°†å…¶è½¬æ¢æˆåŸç å†è®¡ç®—ã€‚

â‘¢ã€è¡¥ç 

è¡¥ç çš„è¡¨ç¤ºæ–¹æ³•æ˜¯ï¼š

- æ­£æ•°çš„è¡¥ç å°±æ˜¯å…¶æœ¬èº«
- è´Ÿæ•°çš„è¡¥ç æ˜¯åœ¨å…¶åŸç çš„åŸºç¡€ä¸Šï¼Œç¬¦å·ä½ä¸å˜ï¼Œå…¶ä½™å„ä½å–åï¼Œæœ€å+1ã€‚(å³åœ¨åç çš„åŸºç¡€ä¸Š+1)

```
[+1] = [00000001]åŸ = [00000001]å = [00000001]è¡¥

[-1] = [10000001]åŸ = [11111110]å = [11111111]è¡¥
```

å¯¹äºè´Ÿæ•°ï¼Œè¡¥ç è¡¨ç¤ºæ–¹å¼ä¹Ÿæ˜¯äººè„‘æ— æ³•ç›´è§‚çœ‹å‡ºå…¶æ•°å€¼çš„ã€‚é€šå¸¸ä¹Ÿéœ€è¦è½¬æ¢æˆåŸç åœ¨è®¡ç®—å…¶æ•°å€¼ã€‚

ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼š

- å¯¹äºæ­£æ•°ï¼šåŸç ï¼Œåç ï¼Œè¡¥ç éƒ½æ˜¯ä¸€æ ·çš„
- å¯¹äºè´Ÿæ•°ï¼šåŸç ï¼Œåç ï¼Œè¡¥ç éƒ½æ˜¯ä¸ä¸€æ ·çš„

### 02ã€å­—ç¬¦ç¼“å†²æµ

BufferedReader ç±»ç»§æ‰¿è‡ª Reader ç±»ï¼Œæä¾›äº†ä¸€äº›ä¾¿æ·çš„æ–¹æ³•ï¼Œä¾‹å¦‚ `readLine()` æ–¹æ³•å¯ä»¥ä¸€æ¬¡è¯»å–ä¸€è¡Œæ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—ç¬¦åœ°è¯»å–ã€‚

BufferedWriter ç±»ç»§æ‰¿è‡ª Writer ç±»ï¼Œæä¾›äº†ä¸€äº›ä¾¿æ·çš„æ–¹æ³•ï¼Œä¾‹å¦‚ `newLine()` æ–¹æ³•å¯ä»¥å†™å…¥ä¸€ä¸ªç³»ç»Ÿç‰¹å®šçš„è¡Œåˆ†éš”ç¬¦ã€‚

#### 1ï¼‰æ„é€ æ–¹æ³•

*   `BufferedReader(Reader in)` ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç¼“å†²è¾“å…¥æµï¼Œæ³¨æ„å‚æ•°ç±»å‹ä¸º**Reader**ã€‚
*   `BufferedWriter(Writer out)`ï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„ç¼“å†²è¾“å‡ºæµï¼Œæ³¨æ„å‚æ•°ç±»å‹ä¸º**Writer**ã€‚

ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
// åˆ›å»ºå­—ç¬¦ç¼“å†²è¾“å…¥æµ
BufferedReader br = new BufferedReader(new FileReader("b.txt"));
// åˆ›å»ºå­—ç¬¦ç¼“å†²è¾“å‡ºæµ
BufferedWriter bw = new BufferedWriter(new FileWriter("b.txt"));
```

#### 2ï¼‰å­—ç¬¦ç¼“å†²æµç‰¹æœ‰æ–¹æ³•

å­—ç¬¦ç¼“å†²æµçš„åŸºæœ¬æ–¹æ³•ä¸[æ™®é€šå­—ç¬¦æµ](https://tobebetterjavaer.com/io/reader-writer.html)è°ƒç”¨æ–¹å¼ä¸€è‡´ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï¼Œæˆ‘ä»¬æ¥çœ‹å­—ç¬¦ç¼“å†²æµ**ç‰¹æœ‰**çš„æ–¹æ³•ã€‚

*   BufferedReaderï¼š`String readLine()`: **è¯»ä¸€è¡Œæ•°æ®**ï¼Œè¯»å–åˆ°æœ€åè¿”å› null
*   BufferedWriterï¼š`newLine()`: **æ¢è¡Œ**ï¼Œç”±ç³»ç»Ÿå®šä¹‰æ¢è¡Œç¬¦ã€‚

æ¥çœ‹ `readLine()`æ–¹æ³•çš„ä»£ç ç¤ºä¾‹ï¼š

```java
// åˆ›å»ºæµå¯¹è±¡
BufferedReader br = new BufferedReader(new FileReader("a.txt"));
// å®šä¹‰å­—ç¬¦ä¸²,ä¿å­˜è¯»å–çš„ä¸€è¡Œæ–‡å­—
String line  = null;
// å¾ªç¯è¯»å–,è¯»å–åˆ°æœ€åè¿”å›null
while ((line = br.readLine())!=null) {
    System.out.print(line);
    System.out.println("------");
}
// é‡Šæ”¾èµ„æº
br.close();
```

å†æ¥çœ‹ `newLine()` æ–¹æ³•çš„ä»£ç ç¤ºä¾‹ï¼š

```java
// åˆ›å»ºæµå¯¹è±¡
BfferedWriter bw = new BufferedWriter(new FileWriter("b.txt"));
// å†™å‡ºæ•°æ®
bw.write("æ²‰");
// å†™å‡ºæ¢è¡Œ
bw.newLine();
bw.write("é»˜");
bw.newLine();
bw.write("ç‹");
bw.newLine();
bw.write("äºŒ");
bw.newLine();
// é‡Šæ”¾èµ„æº
bw.close();
```

### 03ã€å­—ç¬¦ç¼“å†²æµç»ƒä¹ 

æ¥æ¬£èµä¸€ä¸‹æˆ‘å†™çš„è¿™ç¯‡è¯—ï¼š

> 6.å²‘å¤«å­ï¼Œä¸¹ä¸˜ç”Ÿï¼Œå°†è¿›é…’ï¼Œæ¯è«åœã€‚
> 
> 1.å›ä¸è§é»„æ²³ä¹‹æ°´å¤©ä¸Šæ¥ï¼Œå¥”æµåˆ°æµ·ä¸å¤å›ã€‚
> 
> 8.é’Ÿé¼“é¦”ç‰ä¸è¶³è´µï¼Œä½†æ„¿é•¿é†‰ä¸æ„¿é†’ã€‚
> 
> 3.äººç”Ÿå¾—æ„é¡»å°½æ¬¢ï¼Œè«ä½¿é‡‘æ¨½ç©ºå¯¹æœˆã€‚
> 
> 5.çƒ¹ç¾Šå®°ç‰›ä¸”ä¸ºä¹ï¼Œä¼šé¡»ä¸€é¥®ä¸‰ç™¾æ¯ã€‚
> 
> 2.å›ä¸è§é«˜å ‚æ˜é•œæ‚²ç™½å‘ï¼Œæœå¦‚é’ä¸æš®æˆé›ªã€‚
> 
> 7.ä¸å›æ­Œä¸€æ›²ï¼Œè¯·å›ä¸ºæˆ‘å€¾è€³å¬ã€‚
> 
> 4.å¤©ç”Ÿæˆ‘æå¿…æœ‰ç”¨ï¼Œåƒé‡‘æ•£å°½è¿˜å¤æ¥ã€‚

æ¬£èµå®Œäº†æ²¡ï¼Ÿ

ä¼°è®¡ä½ ä¹Ÿçœ‹å‡ºæ¥äº†ï¼Œè¿™æ˜¯æç™½å†™çš„ã€Šå°†è¿›é…’ã€‹ï¼Œä¸æ˜¯æˆ‘ç‹äºŒå†™çš„ã€‚ğŸ˜

ä¸è¿‡ï¼Œé¡ºåºæ˜¯ä¹±çš„ï¼Œè¿˜å¥½ï¼Œæˆ‘éƒ½ç¼–äº†å·ã€‚é‚£å¦‚ä½•æ‰èƒ½æŒ‰ç…§æ­£ç¡®çš„é¡ºåºæ¥å‘¢ï¼Ÿ

æ¥çœ‹ä»£ç å®ç°ï¼š

```java
// åˆ›å»ºmapé›†åˆ,ä¿å­˜æ–‡æœ¬æ•°æ®,é”®ä¸ºåºå·,å€¼ä¸ºæ–‡å­—
HashMap<String, String> lineMap = new HashMap<>();

// åˆ›å»ºæµå¯¹è±¡  æº
BufferedReader br = new BufferedReader(new FileReader("logs/test.log"));
//ç›®æ ‡
BufferedWriter bw = new BufferedWriter(new FileWriter("logs/test1.txt"));

// è¯»å–æ•°æ®
String line;
while ((line = br.readLine())!=null) {
    // è§£ææ–‡æœ¬
    if (line.isEmpty()) {
        continue;
    }
    String[] split = line.split(Pattern.quote("."));
    // ä¿å­˜åˆ°é›†åˆ
    lineMap.put(split[0], split[1]);
}
// é‡Šæ”¾èµ„æº
br.close();

// éå†mapé›†åˆ
for (int i = 1; i <= lineMap.size(); i++) {
    String key = String.valueOf(i);
    // è·å–mapä¸­æ–‡æœ¬
    String value = lineMap.get(key);
    // å†™å‡ºæ‹¼æ¥æ–‡æœ¬
    bw.write(key+"."+value);
    // å†™å‡ºæ¢è¡Œ
    bw.newLine();
}
// é‡Šæ”¾èµ„æº
bw.close();
```

è¿™é‡Œé¢ç”¨åˆ°çš„çŸ¥è¯†éƒ½æ˜¯æˆ‘ä»¬å‰é¢å­¦è¿‡çš„ï¼Œæ¯”å¦‚è¯´ [HashMap](https://tobebetterjavaer.com/collection/hashmap.html)ï¼Œ[å­—ç¬¦ä¸²åˆ†å‰²](https://tobebetterjavaer.com/string/split.html)ï¼ŒåŒ…æ‹¬åˆšåˆšå­¦ä¹ çš„å­—ç¬¦ç¼“å†²æµã€‚


æ¥çœ‹è¾“å‡ºç»“æœ

```
1.å›ä¸è§é»„æ²³ä¹‹æ°´å¤©ä¸Šæ¥ï¼Œå¥”æµåˆ°æµ·ä¸å¤å›ã€‚
2.å›ä¸è§é«˜å ‚æ˜é•œæ‚²ç™½å‘ï¼Œæœå¦‚é’ä¸æš®æˆé›ªã€‚
3.äººç”Ÿå¾—æ„é¡»å°½æ¬¢ï¼Œè«ä½¿é‡‘æ¨½ç©ºå¯¹æœˆã€‚
4.å¤©ç”Ÿæˆ‘æå¿…æœ‰ç”¨ï¼Œåƒé‡‘æ•£å°½è¿˜å¤æ¥ã€‚
5.çƒ¹ç¾Šå®°ç‰›ä¸”ä¸ºä¹ï¼Œä¼šé¡»ä¸€é¥®ä¸‰ç™¾æ¯ã€‚
6.å²‘å¤«å­ï¼Œä¸¹ä¸˜ç”Ÿï¼Œå°†è¿›é…’ï¼Œæ¯è«åœã€‚
7.ä¸å›æ­Œä¸€æ›²ï¼Œè¯·å›ä¸ºæˆ‘å€¾è€³å¬ã€‚
8.é’Ÿé¼“é¦”ç‰ä¸è¶³è´µï¼Œä½†æ„¿é•¿é†‰ä¸æ„¿é†’ã€‚
```

---------

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 7.6 è½¬æ¢æµ

è½¬æ¢æµå¯ä»¥å°†ä¸€ä¸ª[å­—èŠ‚æµ](https://tobebetterjavaer.com/io/stream.html)åŒ…è£…æˆ[å­—ç¬¦æµ](https://tobebetterjavaer.com/io/reader-writer.html)ï¼Œæˆ–è€…å°†ä¸€ä¸ªå­—ç¬¦æµåŒ…è£…æˆå­—èŠ‚æµã€‚è¿™ç§è½¬æ¢é€šå¸¸ç”¨äºå¤„ç†æ–‡æœ¬æ•°æ®ï¼Œå¦‚è¯»å–æ–‡æœ¬æ–‡ä»¶æˆ–å°†æ•°æ®ä»ç½‘ç»œä¼ è¾“åˆ°åº”ç”¨ç¨‹åºã€‚

è½¬æ¢æµä¸»è¦æœ‰ä¸¤ç§ç±»å‹ï¼šInputStreamReader å’Œ OutputStreamWriterã€‚

InputStreamReader å°†ä¸€ä¸ªå­—èŠ‚è¾“å…¥æµè½¬æ¢ä¸ºä¸€ä¸ªå­—ç¬¦è¾“å…¥æµï¼Œè€Œ OutputStreamWriter å°†ä¸€ä¸ªå­—èŠ‚è¾“å‡ºæµè½¬æ¢ä¸ºä¸€ä¸ªå­—ç¬¦è¾“å‡ºæµã€‚å®ƒä»¬ä½¿ç”¨æŒ‡å®šçš„å­—ç¬¦é›†å°†å­—èŠ‚æµå’Œå­—ç¬¦æµä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚å¸¸ç”¨çš„å­—ç¬¦é›†åŒ…æ‹¬ UTF-8ã€GBKã€ISO-8859-1 ç­‰ã€‚

![](https://cdn.tobebetterjavaer.com/studymore/char-byte-20230322165959.png)

### 01ã€ç¼–ç å’Œè§£ç 

åœ¨è®¡ç®—æœºä¸­ï¼Œæ•°æ®é€šå¸¸ä»¥äºŒè¿›åˆ¶å½¢å¼å­˜å‚¨å’Œä¼ è¾“ã€‚

- ç¼–ç å°±æ˜¯å°†åŸå§‹æ•°æ®ï¼ˆæ¯”å¦‚è¯´æ–‡æœ¬ã€å›¾åƒã€è§†é¢‘ã€éŸ³é¢‘ç­‰ï¼‰è½¬æ¢ä¸ºäºŒè¿›åˆ¶å½¢å¼ã€‚
- è§£ç å°±æ˜¯å°†äºŒè¿›åˆ¶æ•°æ®è½¬æ¢ä¸ºåŸå§‹æ•°æ®ï¼Œæ˜¯ä¸€ä¸ªåå‘çš„è¿‡ç¨‹ã€‚

å¸¸è§çš„ç¼–ç å’Œè§£ç æ–¹å¼æœ‰å¾ˆå¤šï¼Œä¸¾å‡ ä¸ªä¾‹å­ï¼š

- ASCII ç¼–ç å’Œè§£ç ï¼šåœ¨è®¡ç®—æœºä¸­ï¼Œå¸¸å¸¸ä½¿ç”¨ ASCII ç æ¥è¡¨ç¤ºå­—ç¬¦ï¼Œå¦‚é”®ç›˜ä¸Šçš„å­—æ¯ã€æ•°å­—å’Œç¬¦å·ç­‰ã€‚ä¾‹å¦‚ï¼Œå­—æ¯ A å¯¹åº”çš„ ASCII ç æ˜¯ 65ï¼Œå­—ç¬¦ + å¯¹åº”çš„ ASCII ç æ˜¯ 43ã€‚
- Unicode ç¼–ç å’Œè§£ç ï¼šUnicode æ˜¯ä¸€ç§å­—ç¬¦é›†ï¼Œæ”¯æŒå¤šç§è¯­è¨€å’Œå­—ç¬¦é›†ã€‚åœ¨è®¡ç®—æœºä¸­ï¼ŒUnicode å¯ä»¥ä½¿ç”¨ UTF-8ã€UTF-16 ç­‰ç¼–ç æ–¹å¼å°†å­—ç¬¦è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°æ®è¿›è¡Œå­˜å‚¨å’Œä¼ è¾“ã€‚
- Base64 ç¼–ç å’Œè§£ç ï¼šBase64 æ˜¯ä¸€ç§å°†äºŒè¿›åˆ¶æ•°æ®è½¬æ¢ä¸º ASCII ç çš„ç¼–ç æ–¹å¼ã€‚å®ƒå°† 3 ä¸ªå­—èŠ‚çš„äºŒè¿›åˆ¶æ•°æ®è½¬æ¢ä¸º 4 ä¸ª ASCII å­—ç¬¦ï¼Œä»¥ä¾¿åœ¨ç½‘ç»œä¼ è¾“ä¸­ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œå°†å­—ç¬¦ä¸² "Hello, world!" è¿›è¡Œ Base64 ç¼–ç åï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ "SGVsbG8sIHdvcmxkIQ=="ã€‚
- å›¾åƒç¼–ç å’Œè§£ç ï¼šåœ¨å›¾åƒå¤„ç†ä¸­ï¼Œå¸¸å¸¸ä½¿ç”¨ JPEGã€PNGã€GIF ç­‰ç¼–ç æ–¹å¼å°†å›¾åƒè½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°æ®è¿›è¡Œå­˜å‚¨å’Œä¼ è¾“ã€‚åœ¨è§£ç æ—¶ï¼Œå¯ä»¥å°†äºŒè¿›åˆ¶æ•°æ®è½¬æ¢ä¸ºå›¾åƒï¼Œä»¥ä¾¿æ˜¾ç¤ºæˆ–å¤„ç†ã€‚
- è§†é¢‘ç¼–ç å’Œè§£ç ï¼šåœ¨è§†é¢‘å¤„ç†ä¸­ï¼Œå¸¸å¸¸ä½¿ç”¨ H.264ã€AVCã€MPEG-4 ç­‰ç¼–ç æ–¹å¼å°†è§†é¢‘è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°æ®è¿›è¡Œå­˜å‚¨å’Œä¼ è¾“ã€‚åœ¨è§£ç æ—¶ï¼Œå¯ä»¥å°†äºŒè¿›åˆ¶æ•°æ®è½¬æ¢ä¸ºè§†é¢‘ï¼Œä»¥ä¾¿æ’­æ”¾æˆ–å¤„ç†ã€‚

ç®€å•ä¸€ç‚¹è¯´å°±æ˜¯ï¼š

- ç¼–ç ï¼šå­—ç¬¦(èƒ½çœ‹æ‡‚çš„)-->å­—èŠ‚(çœ‹ä¸æ‡‚çš„)
- è§£ç ï¼šå­—èŠ‚(çœ‹ä¸æ‡‚çš„)-->å­—ç¬¦(èƒ½çœ‹æ‡‚çš„)

æˆ‘ç”¨ä»£ç æ¥è¡¨ç¤ºä¸€ä¸‹ï¼š

```java
String str = "æ²‰é»˜ç‹äºŒ";
String charsetName = "UTF-8";

// ç¼–ç 
byte[] bytes = str.getBytes(Charset.forName(charsetName));
System.out.println("ç¼–ç : " + bytes);

// è§£ç 
String decodedStr = new String(bytes, Charset.forName(charsetName));
System.out.println("è§£ç : " + decodedStr);
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡ str å’Œä¸€ä¸ªå­—ç¬¦é›†åç§° charsetNameã€‚ç„¶åï¼Œä½¿ç”¨ `Charset.forName()` æ–¹æ³•è·å–æŒ‡å®šå­—ç¬¦é›†çš„ Charset å¯¹è±¡ã€‚æ¥ç€ï¼Œä½¿ç”¨å­—ç¬¦ä¸²çš„ getBytes() æ–¹æ³•å°†å­—ç¬¦ä¸²ç¼–ç ä¸ºæŒ‡å®šå­—ç¬¦é›†çš„å­—èŠ‚æ•°ç»„ã€‚æœ€åï¼Œä½¿ç”¨ `new String()` æ–¹æ³•å°†å­—èŠ‚æ•°ç»„è§£ç ä¸ºå­—ç¬¦ä¸²ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ç¼–ç å’Œè§£ç è¿‡ç¨‹ä¸­ï¼Œè¦ä¿è¯ä½¿ç”¨ç›¸åŒçš„å­—ç¬¦é›†ï¼Œä»¥ä¾¿æ­£ç¡®åœ°è½¬æ¢æ•°æ®ã€‚

### 02ã€å­—ç¬¦é›†

Charsetï¼šå­—ç¬¦é›†ï¼Œæ˜¯ä¸€ç»„å­—ç¬¦çš„é›†åˆï¼Œæ¯ä¸ªå­—ç¬¦éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç¼–ç å€¼ï¼Œä¹Ÿç§°ä¸ºç ç‚¹ã€‚

å¸¸è§çš„å­—ç¬¦é›†åŒ…æ‹¬ ASCIIã€Unicode å’Œ GBKï¼Œè€Œ Unicode å­—ç¬¦é›†åŒ…å«äº†å¤šç§ç¼–ç æ–¹å¼ï¼Œæ¯”å¦‚è¯´ UTF-8ã€UTF-16ã€‚

![](https://cdn.tobebetterjavaer.com/studymore/char-byte-20230322174312.png)

#### **ASCII å­—ç¬¦é›†**

ASCIIï¼ˆAmerican Standard Code for Information Interchangeï¼Œç¾å›½ä¿¡æ¯äº¤æ¢æ ‡å‡†ä»£ç ï¼‰å­—ç¬¦é›†æ˜¯ä¸€ç§æœ€æ—©çš„å­—ç¬¦é›†ï¼ŒåŒ…å« 128 ä¸ªå­—ç¬¦ï¼Œå…¶ä¸­åŒ…æ‹¬æ§åˆ¶å­—ç¬¦ã€æ•°å­—ã€è‹±æ–‡å­—æ¯ä»¥åŠä¸€äº›æ ‡ç‚¹ç¬¦å·ã€‚ASCII å­—ç¬¦é›†ä¸­çš„æ¯ä¸ªå­—ç¬¦éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ 7 ä½äºŒè¿›åˆ¶ç¼–ç ï¼ˆç”± 0 å’Œ 1 ç»„æˆï¼‰ï¼Œå¯ä»¥è¡¨ç¤ºä¸ºåè¿›åˆ¶æ•°æˆ–åå…­è¿›åˆ¶æ•°ã€‚

ASCII ç¼–ç æ–¹å¼æ˜¯ä¸€ç§å›ºå®šé•¿åº¦çš„ç¼–ç æ–¹å¼ï¼Œæ¯ä¸ªå­—ç¬¦éƒ½ä½¿ç”¨ 7 ä½äºŒè¿›åˆ¶ç¼–ç æ¥è¡¨ç¤ºã€‚ASCII ç¼–ç åªèƒ½è¡¨ç¤ºè‹±æ–‡å­—æ¯ã€æ•°å­—å’Œå°‘é‡çš„ç¬¦å·ï¼Œä¸èƒ½è¡¨ç¤ºå…¶ä»–è¯­è¨€çš„æ–‡å­—å’Œç¬¦å·ï¼Œå› æ­¤åœ¨å…¨çƒèŒƒå›´å†…çš„åº”ç”¨å—åˆ°äº†å¾ˆå¤§çš„é™åˆ¶ã€‚

#### Unicode å­—ç¬¦é›†

Unicode åŒ…å«äº†ä¸–ç•Œä¸Šå‡ ä¹æ‰€æœ‰çš„å­—ç¬¦ï¼Œç”¨äºè¡¨ç¤ºäººç±»è¯­è¨€ã€ç¬¦å·å’Œè¡¨æƒ…ç­‰å„ç§ä¿¡æ¯ã€‚Unicode å­—ç¬¦é›†ä¸­çš„æ¯ä¸ªå­—ç¬¦éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç ç‚¹ï¼ˆcode pointï¼‰ï¼Œç”¨äºè¡¨ç¤ºè¯¥å­—ç¬¦åœ¨å­—ç¬¦é›†ä¸­çš„ä½ç½®ï¼Œå¯ä»¥ç”¨åå…­è¿›åˆ¶æ•°è¡¨ç¤ºã€‚

ä¸ºäº†åœ¨è®¡ç®—æœºä¸­å­˜å‚¨å’Œä¼ è¾“ Unicode å­—ç¬¦é›†ä¸­çš„å­—ç¬¦ï¼Œéœ€è¦ä½¿ç”¨ä¸€ç§ç¼–ç æ–¹å¼ã€‚UTF-8ã€UTF-16 å’Œ UTF-32 éƒ½æ˜¯ Unicode å­—ç¬¦é›†çš„ç¼–ç æ–¹å¼ï¼Œç”¨äºå°† Unicode å­—ç¬¦é›†ä¸­çš„å­—ç¬¦è½¬æ¢æˆå­—èŠ‚åºåˆ—ï¼Œä»¥ä¾¿äºå­˜å‚¨å’Œä¼ è¾“ã€‚å®ƒä»¬çš„å·®åˆ«åœ¨äºä½¿ç”¨çš„å­—èŠ‚é•¿åº¦ä¸åŒã€‚

- UTF-8 æ˜¯ä¸€ç§å¯å˜é•¿åº¦çš„ç¼–ç æ–¹å¼ï¼Œå¯¹äº ASCII å­—ç¬¦ï¼ˆç ç‚¹èŒƒå›´ä¸º `0x00~0x7F`ï¼‰ï¼Œä½¿ç”¨ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œå¯¹äºå…¶ä»– Unicode å­—ç¬¦ï¼Œä½¿ç”¨ä¸¤ä¸ªã€ä¸‰ä¸ªæˆ–å››ä¸ªå­—èŠ‚è¡¨ç¤ºã€‚UTF-8 ç¼–ç æ–¹å¼è¢«å¹¿æ³›åº”ç”¨äºäº’è”ç½‘å’Œè®¡ç®—æœºé¢†åŸŸï¼Œå› ä¸ºå®ƒå¯ä»¥æœ‰æ•ˆåœ°å‹ç¼©æ•°æ®ï¼Œé€‚ç”¨äºç½‘ç»œä¼ è¾“å’Œå­˜å‚¨ã€‚
- UTF-16 æ˜¯ä¸€ç§å›ºå®šé•¿åº¦çš„ç¼–ç æ–¹å¼ï¼Œå¯¹äºåŸºæœ¬å¤šè¯­è¨€å¹³é¢ï¼ˆBasic Multilingual Planeï¼ŒUnicode å­—ç¬¦é›†ä¸­çš„ä¸€ä¸ªç ä½èŒƒå›´ï¼ŒåŒ…å«äº†ä¸–ç•Œä¸Šå¤§éƒ¨åˆ†å¸¸ç”¨çš„å­—ç¬¦ï¼Œæ€»å…±åŒ…å«äº†è¶…è¿‡ 65,000 ä¸ªç ä½ï¼‰ä¸­çš„å­—ç¬¦ï¼ˆç ç‚¹èŒƒå›´ä¸º `0x0000~0xFFFF`ï¼‰ï¼Œä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œå¯¹äºå…¶ä»– Unicode å­—ç¬¦ï¼Œä½¿ç”¨å››ä¸ªå­—èŠ‚è¡¨ç¤ºã€‚
- UTF-32 æ˜¯ä¸€ç§å›ºå®šé•¿åº¦çš„ç¼–ç æ–¹å¼ï¼Œå¯¹äºæ‰€æœ‰ Unicode å­—ç¬¦ï¼Œä½¿ç”¨å››ä¸ªå­—èŠ‚è¡¨ç¤ºã€‚

#### GBK å­—ç¬¦é›†

GBK åŒ…å«äº† GB2312 å­—ç¬¦é›†ä¸­çš„å­—ç¬¦ï¼ŒåŒæ—¶è¿˜æ‰©å±•äº†è®¸å¤šå…¶ä»–æ±‰å­—å­—ç¬¦å’Œç¬¦å·ï¼Œå…±æ”¶å½•äº† 21,913 ä¸ªå­—ç¬¦ã€‚GBK é‡‡ç”¨åŒå­—èŠ‚ç¼–ç æ–¹å¼ï¼Œæ¯ä¸ªæ±‰å­—å ç”¨ 2 ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­é«˜å­—èŠ‚å’Œä½å­—èŠ‚éƒ½ä½¿ç”¨äº† 8 ä½ï¼Œå› æ­¤ GBK ç¼–ç å…±æœ‰ `2^16=65536` ç§å¯èƒ½çš„ç¼–ç ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†è¢«ç”¨äºè¡¨ç¤ºæ±‰å­—å­—ç¬¦ã€‚

GBK ç¼–ç æ˜¯ä¸€ç§å˜é•¿çš„ç¼–ç æ–¹å¼ï¼Œå¯¹äº ASCII å­—ç¬¦ï¼ˆç ä½èŒƒå›´ä¸º 0x00 åˆ° 0x7Fï¼‰ï¼Œä½¿ç”¨ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œå¯¹äºå…¶ä»–å­—ç¬¦ï¼Œä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºã€‚GBK ç¼–ç ä¸­çš„æ¯ä¸ªå­—èŠ‚éƒ½å¯ä»¥é‡‡ç”¨ 0x81 åˆ° 0xFE ä¹‹é—´çš„ä»»æ„ä¸€ä¸ªå€¼ï¼Œå› æ­¤å¯ä»¥è¡¨ç¤º `2^15=32768` ä¸ªå­—ç¬¦ã€‚ä¸ºäº†é¿å…ä¸ ASCII ç å†²çªï¼ŒGBK ç¼–ç çš„ç¬¬ä¸€ä¸ªå­—èŠ‚é‡‡ç”¨äº† 0x81 åˆ° 0xFE ä¹‹é—´é™¤äº† 0x7F çš„æ‰€æœ‰å€¼ï¼Œç¬¬äºŒä¸ªå­—èŠ‚é‡‡ç”¨äº† 0x40 åˆ° 0x7E å’Œ 0x80 åˆ° 0xFE ä¹‹é—´çš„æ‰€æœ‰å€¼ï¼Œå…± 94 ä¸ªå€¼ã€‚

GB2312 çš„å…¨åæ˜¯ã€Šä¿¡æ¯äº¤æ¢ç”¨æ±‰å­—ç¼–ç å­—ç¬¦é›†åŸºæœ¬é›†ã€‹ï¼Œä¹Ÿè¢«ç§°ä¸ºâ€œå›½æ ‡ç â€ã€‚é‡‡ç”¨äº†åŒå­—èŠ‚ç¼–ç æ–¹å¼ï¼Œæ¯ä¸ªæ±‰å­—å ç”¨ 2 ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­é«˜å­—èŠ‚å’Œä½å­—èŠ‚éƒ½ä½¿ç”¨äº† 8 ä½ï¼Œå› æ­¤ GB2312 ç¼–ç å…±æœ‰ `2^16=65536` ç§å¯èƒ½çš„ç¼–ç ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†è¢«ç”¨äºè¡¨ç¤ºæ±‰å­—å­—ç¬¦ã€‚GB2312 ç¼–ç ä¸­çš„æ¯ä¸ªå­—èŠ‚éƒ½å¯ä»¥é‡‡ç”¨ 0xA1 åˆ° 0xF7 ä¹‹é—´çš„ä»»æ„ä¸€ä¸ªå€¼ï¼Œå› æ­¤å¯ä»¥è¡¨ç¤º 126 ä¸ªå­—ç¬¦ã€‚

GB2312 æ˜¯ä¸€ä¸ªè¾ƒä¸ºç®€å•çš„å­—ç¬¦é›†ï¼ŒåªåŒ…å«äº†å¸¸ç”¨çš„æ±‰å­—å’Œç¬¦å·ï¼Œå› æ­¤å¯¹äºä¸€äº›è¾ƒä¸ºç½•è§çš„æ±‰å­—å’Œç”Ÿåƒ»å­—ï¼ŒGB2312 ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œç°åœ¨å·²ç»é€æ¸è¢« GBKã€GB18030 ç­‰å­—ç¬¦é›†æ‰€å–ä»£ã€‚

GB18030 æ˜¯æœ€æ–°çš„ä¸­æ–‡ç è¡¨ã€‚æ”¶å½•æ±‰å­— 70244 ä¸ªï¼Œé‡‡ç”¨å¤šå­—èŠ‚ç¼–ç ï¼Œæ¯ä¸ªå­—å¯ä»¥ç”± 1 ä¸ªã€2 ä¸ªæˆ– 4 ä¸ªå­—èŠ‚ç»„æˆã€‚æ”¯æŒä¸­å›½å›½å†…å°‘æ•°æ°‘æ—çš„æ–‡å­—ï¼ŒåŒæ—¶æ”¯æŒç¹ä½“æ±‰å­—ä»¥åŠæ—¥éŸ©æ±‰å­—ç­‰ã€‚

### 03ã€ä¹±ç 

å½“ä½¿ç”¨ä¸åŒçš„ç¼–ç æ–¹å¼è¯»å–æˆ–è€…å†™å…¥æ–‡ä»¶æ—¶ï¼Œå°±ä¼šå‡ºç°ä¹±ç é—®é¢˜ï¼Œæ¥çœ‹ç¤ºä¾‹ã€‚

```java
String s = "æ²‰é»˜ç‹äºŒï¼";

try {
    // å°†å­—ç¬¦ä¸²æŒ‰GBKç¼–ç æ–¹å¼ä¿å­˜åˆ°æ–‡ä»¶ä¸­
    OutputStreamWriter out = new OutputStreamWriter(
            new FileOutputStream("logs/test_utf8.txt"), "GBK");
    out.write(s);
    out.close();

    FileReader fileReader = new FileReader("logs/test_utf8.txt");
    int read;
    while ((read = fileReader.read()) != -1) {
        System.out.print((char)read);
    }
    fileReader.close();
} catch (IOException e) {
    e.printStackTrace();
}
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªåŒ…å«ä¸­æ–‡å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œç„¶åå°†è¯¥å­—ç¬¦ä¸²æŒ‰ GBK ç¼–ç æ–¹å¼ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œæ¥ç€å°†æ–‡ä»¶æŒ‰é»˜è®¤ç¼–ç æ–¹å¼ï¼ˆUTF-8ï¼‰è¯»å–ï¼Œå¹¶æ˜¾ç¤ºå†…å®¹ã€‚æ­¤æ—¶å°±ä¼šå‡ºç°ä¹±ç é—®é¢˜ï¼Œæ˜¾ç¤ºä¸ºâ€œï¿½ï¿½Ä¬ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½â€ã€‚

è¿™æ˜¯å› ä¸ºæ–‡ä»¶ä¸­çš„ GBK ç¼–ç çš„å­—ç¬¦åœ¨ä½¿ç”¨ UTF-8 ç¼–ç æ–¹å¼è§£ææ—¶æ— æ³•æ­£ç¡®è§£æï¼Œä»è€Œå¯¼è‡´å‡ºç°ä¹±ç é—®é¢˜ã€‚

é‚£å¦‚ä½•æ‰èƒ½è§£å†³ä¹±ç é—®é¢˜å‘¢ï¼Ÿ

è¿™å°±å¼•å‡ºæˆ‘ä»¬ä»Šå¤©çš„ä¸»è§’äº†â€”â€”è½¬æ¢æµã€‚

### 04ã€InputStreamReader

`java.io.InputStreamReader` æ˜¯ Reader ç±»çš„å­ç±»ã€‚å®ƒçš„ä½œç”¨æ˜¯å°†å­—èŠ‚æµï¼ˆInputStreamï¼‰è½¬æ¢ä¸ºå­—ç¬¦æµï¼ˆReaderï¼‰ï¼ŒåŒæ—¶æ”¯æŒæŒ‡å®šçš„å­—ç¬¦é›†ç¼–ç æ–¹å¼ï¼Œä»è€Œå®ç°å­—ç¬¦æµä¸å­—èŠ‚æµä¹‹é—´çš„è½¬æ¢ã€‚

#### 1ï¼‰æ„é€ æ–¹æ³•

- `InputStreamReader(InputStream in)`: åˆ›å»ºä¸€ä¸ªä½¿ç”¨é»˜è®¤å­—ç¬¦é›†çš„å­—ç¬¦æµã€‚
- `InputStreamReader(InputStream in, String charsetName)`: åˆ›å»ºä¸€ä¸ªæŒ‡å®šå­—ç¬¦é›†çš„å­—ç¬¦æµã€‚

ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
InputStreamReader isr = new InputStreamReader(new FileInputStream("in.txt"));
InputStreamReader isr2 = new InputStreamReader(new FileInputStream("in.txt") , "GBK");
```

#### 2ï¼‰è§£å†³ç¼–ç é—®é¢˜

ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ InputStreamReader è§£å†³ä¹±ç é—®é¢˜çš„ç¤ºä¾‹ä»£ç ï¼š

```java
String s = "æ²‰é»˜ç‹äºŒï¼";

try {
    // å°†å­—ç¬¦ä¸²æŒ‰GBKç¼–ç æ–¹å¼ä¿å­˜åˆ°æ–‡ä»¶ä¸­
    OutputStreamWriter outUtf8 = new OutputStreamWriter(
            new FileOutputStream("logs/test_utf8.txt"), "GBK");
    outUtf8.write(s);
    outUtf8.close();

    // å°†å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµï¼Œä½¿ç”¨GBKç¼–ç æ–¹å¼
    InputStreamReader isr = new InputStreamReader(new FileInputStream("logs/test_utf8.txt"), "GBK");
    // è¯»å–å­—ç¬¦æµ
    int c;
    while ((c = isr.read()) != -1) {
        System.out.print((char) c);
    }
    isr.close();
} catch (IOException e) {
    e.printStackTrace();
}
```

ç”±äºä½¿ç”¨äº† InputStreamReader å¯¹å­—èŠ‚æµè¿›è¡Œäº†ç¼–ç æ–¹å¼çš„è½¬æ¢ï¼Œå› æ­¤åœ¨è¯»å–å­—ç¬¦æµæ—¶å°±å¯ä»¥æ­£ç¡®åœ°è§£æå‡ºä¸­æ–‡å­—ç¬¦ï¼Œé¿å…äº†ä¹±ç é—®é¢˜ã€‚

### 05ã€OutputStreamWriter

`java.io.OutputStreamWriter` æ˜¯ Writer çš„å­ç±»ï¼Œå­—é¢çœ‹å®¹æ˜“è¯¯ä»¥ä¸ºæ˜¯è½¬ä¸ºå­—ç¬¦æµï¼Œå…¶å®æ˜¯å°†å­—ç¬¦æµè½¬æ¢ä¸ºå­—èŠ‚æµï¼Œæ˜¯å­—ç¬¦æµåˆ°å­—èŠ‚æµçš„æ¡¥æ¢ã€‚

- `OutputStreamWriter(OutputStream in)`: åˆ›å»ºä¸€ä¸ªä½¿ç”¨é»˜è®¤å­—ç¬¦é›†çš„å­—ç¬¦æµã€‚
- `OutputStreamWriter(OutputStream in, String charsetName)`ï¼šåˆ›å»ºä¸€ä¸ªæŒ‡å®šå­—ç¬¦é›†çš„å­—ç¬¦æµã€‚

ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
OutputStreamWriter isr = new OutputStreamWriter(new FileOutputStream("a.txt"));
OutputStreamWriter isr2 = new OutputStreamWriter(new FileOutputStream("b.txt") , "GBK");
```

é€šå¸¸ä¸ºäº†æé«˜è¯»å†™æ•ˆç‡ï¼Œæˆ‘ä»¬ä¼šåœ¨è½¬æ¢æµä¸Šå†åŠ ä¸€å±‚[ç¼“å†²æµ](https://tobebetterjavaer.com/io/buffer.html)ï¼Œæ¥çœ‹ä»£ç ç¤ºä¾‹ï¼š

```java
try {
    // ä»æ–‡ä»¶è¯»å–å­—èŠ‚æµï¼Œä½¿ç”¨UTF-8ç¼–ç æ–¹å¼
    FileInputStream fis = new FileInputStream("test.txt");
    // å°†å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµï¼Œä½¿ç”¨UTF-8ç¼–ç æ–¹å¼
    InputStreamReader isr = new InputStreamReader(fis, "UTF-8");
    // ä½¿ç”¨ç¼“å†²æµåŒ…è£…å­—ç¬¦æµï¼Œæé«˜è¯»å–æ•ˆç‡
    BufferedReader br = new BufferedReader(isr);
    // åˆ›å»ºè¾“å‡ºæµï¼Œä½¿ç”¨UTF-8ç¼–ç æ–¹å¼
    FileOutputStream fos = new FileOutputStream("output.txt");
    // å°†è¾“å‡ºæµåŒ…è£…ä¸ºè½¬æ¢æµï¼Œä½¿ç”¨UTF-8ç¼–ç æ–¹å¼
    OutputStreamWriter osw = new OutputStreamWriter(fos, "UTF-8");
    // ä½¿ç”¨ç¼“å†²æµåŒ…è£…è½¬æ¢æµï¼Œæé«˜å†™å…¥æ•ˆç‡
    BufferedWriter bw = new BufferedWriter(osw);

    // è¯»å–è¾“å…¥æ–‡ä»¶çš„æ¯ä¸€è¡Œï¼Œå†™å…¥åˆ°è¾“å‡ºæ–‡ä»¶ä¸­
    String line;
    while ((line = br.readLine()) != null) {
        bw.write(line);
        bw.newLine(); // æ¯è¡Œç»“æŸåå†™å…¥ä¸€ä¸ªæ¢è¡Œç¬¦
    }

    // å…³é—­æµ
    br.close();
    bw.close();
} catch (IOException e) {
    e.printStackTrace();
}
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œé¦–å…ˆä½¿ç”¨ FileInputStream ä»æ–‡ä»¶ä¸­è¯»å–å­—èŠ‚æµï¼Œä½¿ç”¨ UTF-8 ç¼–ç æ–¹å¼è¿›è¡Œè¯»å–ã€‚ç„¶åï¼Œä½¿ç”¨ InputStreamReader å°†å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµï¼Œä½¿ç”¨ UTF-8 ç¼–ç æ–¹å¼è¿›è¡Œè½¬æ¢ã€‚æ¥ç€ï¼Œä½¿ç”¨ BufferedReader åŒ…è£…å­—ç¬¦æµï¼Œæé«˜è¯»å–æ•ˆç‡ã€‚ç„¶åï¼Œåˆ›å»º FileOutputStream ç”¨äºè¾“å‡ºæ–‡ä»¶ï¼Œä½¿ç”¨ UTF-8 ç¼–ç æ–¹å¼è¿›è¡Œåˆ›å»ºã€‚æ¥ç€ï¼Œä½¿ç”¨ OutputStreamWriter å°†è¾“å‡ºæµè½¬æ¢ä¸ºå­—ç¬¦æµï¼Œä½¿ç”¨ UTF-8 ç¼–ç æ–¹å¼è¿›è¡Œè½¬æ¢ã€‚æœ€åï¼Œä½¿ç”¨ BufferedWriter åŒ…è£…è½¬æ¢æµï¼Œæé«˜å†™å…¥æ•ˆç‡ã€‚

### 06ã€å°ç»“

InputStreamReader å’Œ OutputStreamWriter æ˜¯å°†å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµæˆ–è€…å°†å­—ç¬¦æµè½¬æ¢ä¸ºå­—èŠ‚æµã€‚é€šå¸¸ç”¨äºè§£å†³å­—èŠ‚æµå’Œå­—ç¬¦æµä¹‹é—´çš„è½¬æ¢é—®é¢˜ï¼Œå¯ä»¥å°†å­—èŠ‚æµä»¥æŒ‡å®šçš„å­—ç¬¦é›†ç¼–ç æ–¹å¼è½¬æ¢ä¸ºå­—ç¬¦æµï¼Œæˆ–è€…å°†å­—ç¬¦æµä»¥æŒ‡å®šçš„å­—ç¬¦é›†ç¼–ç æ–¹å¼è½¬æ¢ä¸ºå­—èŠ‚æµã€‚

InputStreamReader ç±»çš„å¸¸ç”¨æ–¹æ³•åŒ…æ‹¬ï¼š

- `read()`ï¼šä»è¾“å…¥æµä¸­è¯»å–ä¸€ä¸ªå­—ç¬¦çš„æ•°æ®ã€‚
- `read(char[] cbuf, int off, int len)`ï¼šä»è¾“å…¥æµä¸­è¯»å– len ä¸ªå­—ç¬¦çš„æ•°æ®åˆ°æŒ‡å®šçš„å­—ç¬¦æ•°ç»„ cbuf ä¸­ï¼Œä» off ä½ç½®å¼€å§‹å­˜æ”¾ã€‚
- `ready()`ï¼šè¿”å›æ­¤æµæ˜¯å¦å·²å‡†å¤‡å¥½è¯»å–ã€‚
- `close()`ï¼šå…³é—­è¾“å…¥æµã€‚

OutputStreamWriter ç±»çš„å¸¸ç”¨æ–¹æ³•åŒ…æ‹¬ï¼š

- `write(int c)`ï¼šå‘è¾“å‡ºæµä¸­å†™å…¥ä¸€ä¸ªå­—ç¬¦çš„æ•°æ®ã€‚
- `write(char[] cbuf, int off, int len)`ï¼šå‘è¾“å‡ºæµä¸­å†™å…¥æŒ‡å®šå­—ç¬¦æ•°ç»„ cbuf ä¸­çš„ len ä¸ªå­—ç¬¦ï¼Œä» off ä½ç½®å¼€å§‹ã€‚
- `flush()`ï¼šå°†ç¼“å†²åŒºçš„æ•°æ®å†™å…¥è¾“å‡ºæµä¸­ã€‚
- `close()`ï¼šå…³é—­è¾“å‡ºæµã€‚

åœ¨ä½¿ç”¨è½¬æ¢æµæ—¶ï¼Œéœ€è¦æŒ‡å®šæ­£ç¡®çš„å­—ç¬¦é›†ç¼–ç æ–¹å¼ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´æ•°æ®è¯»å–æˆ–å†™å…¥å‡ºç°ä¹±ç ã€‚

---

æœ€è¿‘æ•´ç†äº†ä¸€ä»½ç‰›é€¼çš„å­¦ä¹ èµ„æ–™ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº Java åŸºç¡€éƒ¨åˆ†ï¼ˆJVMã€Java é›†åˆæ¡†æ¶ã€å¤šçº¿ç¨‹ï¼‰ï¼Œè¿˜å›Šæ‹¬äº† **æ•°æ®åº“ã€è®¡ç®—æœºç½‘ç»œã€ç®—æ³•ä¸æ•°æ®ç»“æ„ã€è®¾è®¡æ¨¡å¼ã€æ¡†æ¶ç±» Springã€Nettyã€å¾®æœåŠ¡ï¼ˆDubboï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ ç½‘å…³** ç­‰ç­‰ç­‰ç­‰â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¯ä»¥è¯´æ˜¯ 2022 å¹´å…¨ç½‘æœ€å…¨çš„å­¦ä¹ å’Œæ‰¾å·¥ä½œçš„ PDF èµ„æºäº†](https://tobebetterjavaer.com/pdf/programmer-111.html)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 7.7 æ‰“å°æµ

åœ¨æˆ‘çš„èŒä¸šç”Ÿæ¶¯ä¸­ï¼Œ `System.out.println()` çš„ä½¿ç”¨é¢‘ç‡ææ€•ä¸äºšäº main æ–¹æ³•çš„ä½¿ç”¨é¢‘ç‡ã€‚å…¶ä¸­ `System.out` è¿”å›çš„æ­£æ˜¯æ‰“å°æµ `PrintStream` ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å®ƒè¿˜æœ‰ä¸€ä¸ªå­ªç”Ÿå…„å¼Ÿï¼ŒPrintWriterã€‚PrintStream æ˜¯ OutputStream çš„å­ç±»ï¼ŒPrintWriter æ˜¯ Writer çš„å­ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ª[å­—èŠ‚æµ](https://tobebetterjavaer.com/io/stream.html)ï¼Œä¸€ä¸ªæ˜¯[å­—ç¬¦æµ](https://tobebetterjavaer.com/io/reader-writer.html)ã€‚

æ‰“å°æµå…·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š

* å¯ä»¥è‡ªåŠ¨è¿›è¡Œæ•°æ®ç±»å‹è½¬æ¢ï¼šæ‰“å°æµå¯ä»¥å°†å„ç§æ•°æ®ç±»å‹è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶è¾“å‡ºåˆ°æŒ‡å®šçš„è¾“å‡ºæµä¸­ã€‚
* å¯ä»¥è‡ªåŠ¨è¿›è¡Œæ¢è¡Œæ“ä½œï¼šæ‰“å°æµå¯ä»¥åœ¨è¾“å‡ºå­—ç¬¦ä¸²çš„æœ«å°¾è‡ªåŠ¨æ·»åŠ æ¢è¡Œç¬¦ï¼Œæ–¹ä¾¿è¾“å‡ºå¤šä¸ªå­—ç¬¦ä¸²æ—¶çš„æ ¼å¼æ§åˆ¶ã€‚
* å¯ä»¥è¾“å‡ºåˆ°æ§åˆ¶å°æˆ–è€…æ–‡ä»¶ä¸­ï¼šæ‰“å°æµå¯ä»¥å°†æ•°æ®è¾“å‡ºåˆ°æ§åˆ¶å°æˆ–è€…æ–‡ä»¶ä¸­ï¼Œæ–¹ä¾¿è°ƒè¯•å’Œæ—¥å¿—è®°å½•ï¼ˆå°½ç®¡ç”Ÿäº§ç¯å¢ƒä¸‹æ›´æ¨èä½¿ç”¨ [Logback](https://tobebetterjavaer.com/gongju/logback.html)ã€ELK ç­‰ï¼‰ã€‚

PrintStream ç±»çš„å¸¸ç”¨æ–¹æ³•åŒ…æ‹¬ï¼š

- `print()`ï¼šè¾“å‡ºä¸€ä¸ªå¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚
- `println()`ï¼šè¾“å‡ºä¸€ä¸ªå¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ï¼Œå¹¶åœ¨æœ«å°¾æ·»åŠ ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚
- `printf()`ï¼šä½¿ç”¨æŒ‡å®šçš„æ ¼å¼å­—ç¬¦ä¸²å’Œå‚æ•°è¾“å‡ºæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ã€‚

æ¥ä¸€ä¸ªç¤ºä¾‹ä½“éªŒä¸€ä¸‹ã€‚

```java
PrintStream ps = System.out;
ps.println("æ²‰é»˜ç‹äºŒ");
ps.print("æ²‰ ");
ps.print("é»˜ ");
ps.print("ç‹ ");
ps.print("äºŒ ");
ps.println();

ps.printf("å§“åï¼š%sï¼Œå¹´é¾„ï¼š%dï¼Œæˆç»©ï¼š%f", "æ²‰é»˜ç‹äºŒ", 18, 99.9);
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª PrintStream å¯¹è±¡ psï¼Œå®ƒè¾“å‡ºåˆ°æ§åˆ¶å°ã€‚æˆ‘ä»¬ä½¿ç”¨ ps çš„ print å’Œ println æ–¹æ³•è¾“å‡ºäº†ä¸€äº›å­—ç¬¦ä¸²ã€‚

ä½¿ç”¨ printf æ–¹æ³•è¾“å‡ºäº†ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œå…¶ä¸­ %sã€%d å’Œ %.2f åˆ†åˆ«è¡¨ç¤ºå­—ç¬¦ä¸²ã€æ•´æ•°å’Œæµ®ç‚¹æ•°çš„æ ¼å¼åŒ–è¾“å‡ºã€‚æˆ‘ä»¬ä½¿ç”¨é€—å·åˆ†éš”çš„å‚æ•°åˆ—è¡¨æŒ‡å®šäº†è¦è¾“å‡ºçš„å€¼ã€‚

æ¥è¯¦ç»†è¯´è¯´ printf æ–¹æ³•å“ˆã€‚

```java
public PrintStream printf(String format, Object... args);
```

å…¶ä¸­ï¼Œformat å‚æ•°æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œargs å‚æ•°æ˜¯è¦è¾“å‡ºçš„å‚æ•°åˆ—è¡¨ã€‚æ ¼å¼åŒ–å­—ç¬¦ä¸²åŒ…å«äº†æ™®é€šå­—ç¬¦å’Œè½¬æ¢è¯´æ˜ç¬¦ã€‚æ™®é€šå­—ç¬¦æ˜¯æŒ‡é™¤äº†è½¬æ¢è¯´æ˜ç¬¦ä¹‹å¤–çš„å­—ç¬¦ï¼Œå®ƒä»¬åœ¨è¾“å‡ºæ—¶ç›´æ¥è¾“å‡ºã€‚è½¬æ¢è¯´æ˜ç¬¦æ˜¯ç”±ç™¾åˆ†å·ï¼ˆ%ï¼‰å’Œä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ç»„æˆçš„ï¼Œç”¨äºæŒ‡å®šè¾“å‡ºçš„æ ¼å¼å’Œæ•°æ®ç±»å‹ã€‚

ä¸‹é¢æ˜¯ Java çš„å¸¸ç”¨è½¬æ¢è¯´æ˜ç¬¦åŠå¯¹åº”çš„è¾“å‡ºæ ¼å¼ï¼š

- `%s`ï¼šè¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚
- `%d` æˆ– `%i`ï¼šè¾“å‡ºä¸€ä¸ªåè¿›åˆ¶æ•´æ•°ã€‚
- `%x` æˆ– `%X`ï¼šè¾“å‡ºä¸€ä¸ªåå…­è¿›åˆ¶æ•´æ•°ï¼Œ`%x` è¾“å‡ºå°å†™å­—æ¯ï¼Œ`%X` è¾“å‡ºå¤§å†™å­—æ¯ã€‚
- `%f` æˆ– `%F`ï¼šè¾“å‡ºä¸€ä¸ªæµ®ç‚¹æ•°ã€‚
- `%e` æˆ– `%E`ï¼šè¾“å‡ºä¸€ä¸ªç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºçš„æµ®ç‚¹æ•°ï¼Œ`%e` è¾“å‡ºå°å†™å­—æ¯ eï¼Œ`%E` è¾“å‡ºå¤§å†™å­—æ¯ Eã€‚
- `%g` æˆ– `%G`ï¼šè¾“å‡ºä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œè‡ªåŠ¨é€‰æ‹© `%f` æˆ– `%e/%E` æ ¼å¼è¾“å‡ºã€‚
- `%c`ï¼šè¾“å‡ºä¸€ä¸ªå­—ç¬¦ã€‚
- `%b`ï¼šè¾“å‡ºä¸€ä¸ªå¸ƒå°”å€¼ã€‚
- `%h`ï¼šè¾“å‡ºä¸€ä¸ªå“ˆå¸Œç ï¼ˆ16è¿›åˆ¶ï¼‰ã€‚
- `%n`ï¼šæ¢è¡Œç¬¦ã€‚

é™¤äº†è½¬æ¢è¯´æ˜ç¬¦ä¹‹å¤–ï¼ŒJava çš„ printf æ–¹æ³•è¿˜æ”¯æŒä¸€äº›ä¿®é¥°ç¬¦ï¼Œç”¨äºæŒ‡å®šè¾“å‡ºçš„å®½åº¦ã€ç²¾åº¦ã€å¯¹é½æ–¹å¼ç­‰ã€‚

- å®½åº¦ä¿®é¥°ç¬¦ï¼šç”¨æ•°å­—æŒ‡å®šè¾“å‡ºçš„æœ€å°å®½åº¦ï¼Œå¦‚æœè¾“å‡ºçš„æ•°æ®ä¸è¶³æŒ‡å®šå®½åº¦ï¼Œåˆ™åœ¨å·¦ä¾§æˆ–å³ä¾§å¡«å……ç©ºæ ¼æˆ–é›¶ã€‚
- ç²¾åº¦ä¿®é¥°ç¬¦ï¼šç”¨ç‚¹å·ï¼ˆ.ï¼‰å’Œæ•°å­—æŒ‡å®šæµ®ç‚¹æ•°æˆ–å­—ç¬¦ä¸²çš„ç²¾åº¦ï¼Œå¯¹äºæµ®ç‚¹æ•°ï¼ŒæŒ‡å®šå°æ•°ç‚¹åçš„ä½æ•°ï¼Œå¯¹äºå­—ç¬¦ä¸²ï¼ŒæŒ‡å®šè¾“å‡ºçš„å­—ç¬¦æ•°ã€‚
- å¯¹é½ä¿®é¥°ç¬¦ï¼šç”¨å‡å·ï¼ˆ-ï¼‰æˆ–é›¶å·ï¼ˆ0ï¼‰æŒ‡å®šè¾“å‡ºçš„å¯¹é½æ–¹å¼ï¼Œå‡å·è¡¨ç¤ºå·¦å¯¹é½ï¼Œé›¶å·è¡¨ç¤ºå³å¯¹é½å¹¶å¡«å……é›¶ã€‚

ä¸‹é¢æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š

```java
int num = 123;
System.out.printf("%5d\n", num); // è¾“å‡º "  123"
System.out.printf("%-5d\n", num); // è¾“å‡º "123  "
System.out.printf("%05d\n", num); // è¾“å‡º "00123"

double pi = Math.PI;
System.out.printf("%10.2f\n", pi); // è¾“å‡º "      3.14"
System.out.printf("%-10.4f\n", pi); // è¾“å‡º "3.1416    "

String name = "æ²‰é»˜ç‹äºŒ";
System.out.printf("%10s\n", name); // è¾“å‡º "     æ²‰é»˜ç‹äºŒ"
System.out.printf("%-10s\n", name); // è¾“å‡º "æ²‰é»˜ç‹äºŒ     "
```

å…·ä½“æ¥è¯´ï¼Œ

- æˆ‘ä»¬ä½¿ç”¨ `%5d` æ¥æŒ‡å®šè¾“å‡ºçš„æ•´æ•°å æ® 5 ä¸ªå­—ç¬¦çš„å®½åº¦ï¼Œä¸è¶³éƒ¨åˆ†åœ¨å·¦ä¾§å¡«å……ç©ºæ ¼ã€‚
- ä½¿ç”¨ `%-5d` æ¥æŒ‡å®šè¾“å‡ºçš„æ•´æ•°å æ® 5 ä¸ªå­—ç¬¦çš„å®½åº¦ï¼Œä¸è¶³éƒ¨åˆ†åœ¨å³ä¾§å¡«å……ç©ºæ ¼ã€‚
- ä½¿ç”¨ `%05d` æ¥æŒ‡å®šè¾“å‡ºçš„æ•´æ•°å æ® 5 ä¸ªå­—ç¬¦çš„å®½åº¦ï¼Œä¸è¶³éƒ¨åˆ†åœ¨å·¦ä¾§å¡«å…… 0ã€‚
- ä½¿ç”¨ `%10.2f` æ¥æŒ‡å®šè¾“å‡ºçš„æµ®ç‚¹æ•°å æ® 10 ä¸ªå­—ç¬¦çš„å®½åº¦ï¼Œä¿ç•™ 2 ä½å°æ•°ï¼Œä¸è¶³éƒ¨åˆ†åœ¨å·¦ä¾§å¡«å……ç©ºæ ¼ã€‚
- ä½¿ç”¨ `%-10.4f` æ¥æŒ‡å®šè¾“å‡ºçš„æµ®ç‚¹æ•°å æ® 10 ä¸ªå­—ç¬¦çš„å®½åº¦ï¼Œä¿ç•™ 4 ä½å°æ•°ï¼Œä¸è¶³éƒ¨åˆ†åœ¨å³ä¾§å¡«å……ç©ºæ ¼ã€‚
- ä½¿ç”¨ `%10s` æ¥æŒ‡å®šè¾“å‡ºçš„å­—ç¬¦ä¸²å æ® 10 ä¸ªå­—ç¬¦çš„å®½åº¦ï¼Œä¸è¶³éƒ¨åˆ†åœ¨å·¦ä¾§å¡«å……ç©ºæ ¼ã€‚
- ä½¿ç”¨ `%-10s` æ¥æŒ‡å®šè¾“å‡ºçš„å­—ç¬¦ä¸²å æ® 10 ä¸ªå­—ç¬¦çš„å®½åº¦ï¼Œä¸è¶³éƒ¨åˆ†åœ¨å³ä¾§å¡«å……ç©ºæ ¼ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»™å‡ºä¸€ä¸ª PrintWriter çš„ç¤ºä¾‹ï¼š

```java
PrintWriter writer = new PrintWriter(new FileWriter("output.txt"));
writer.println("æ²‰é»˜ç‹äºŒ");
writer.printf("ä»–çš„å¹´çºªä¸º %d.\n", 18);
writer.close();
```

é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª PrintWriter å¯¹è±¡ï¼Œå®ƒçš„æ„é€ å‡½æ•°æ¥æ”¶ä¸€ä¸ª Writer å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ FileWriter æ¥åˆ›å»ºä¸€ä¸ªè¾“å‡ºæ–‡ä»¶æµï¼Œå¹¶å°†å…¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™ PrintWriter çš„æ„é€ å‡½æ•°ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ PrintWriter çš„ println å’Œ printf æ–¹æ³•æ¥è¾“å‡ºä¸¤è¡Œå†…å®¹ï¼Œå…¶ä¸­ printf æ–¹æ³•å¯ä»¥æ¥æ”¶æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨ PrintWriter çš„ close æ–¹æ³•æ¥å…³é—­è¾“å‡ºæµã€‚

æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸åˆ›å»º FileWriter å¯¹è±¡ï¼Œç›´æ¥æŒ‡å®šæ–‡ä»¶åã€‚

```java
PrintWriter pw = new PrintWriter("output.txt");
pw.println("æ²‰é»˜ç‹äºŒ");
pw.printf("ä»–çš„å¹´çºªä¸º %d.\n", 18);
pw.close();
```

å¥½ï¼Œå…³äºæ‰“å°æµæˆ‘ä»¬å°±è¯´è¿™ä¹ˆå¤šï¼Œæ¯”è¾ƒç®€å•ã€‚è‡³äº printf çš„ä¸€äº›è§„åˆ™ï¼Œç”¨åˆ°çš„æ—¶å€™å¯ä»¥å†æŸ¥ä½¿ç”¨è¯´æ˜æˆ–è€…çœ‹ API æ–‡æ¡£å°±å¯ä»¥äº†ï¼Œè®°ä¸ä½æ²¡å…³ç³»ã€‚

---------

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 7.8 åºåˆ—æµ(åºåˆ—åŒ–å’Œååºåˆ—åŒ–)

Java çš„åºåˆ—æµï¼ˆObjectInputStream å’Œ ObjectOutputStreamï¼‰æ˜¯ä¸€ç§å¯ä»¥å°† Java å¯¹è±¡åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æµã€‚

åºåˆ—åŒ–æ˜¯æŒ‡å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢ä¸ºä¸€ä¸ªå­—èŠ‚åºåˆ—ï¼ˆåŒ…å«`å¯¹è±¡çš„æ•°æ®`ã€`å¯¹è±¡çš„ç±»å‹`å’Œ`å¯¹è±¡ä¸­å­˜å‚¨çš„å±æ€§`ç­‰ä¿¡æ¯ï¼‰ï¼Œä»¥ä¾¿åœ¨ç½‘ç»œä¸Šä¼ è¾“æˆ–ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œæˆ–è€…åœ¨ç¨‹åºä¹‹é—´ä¼ é€’ã€‚åœ¨ Java ä¸­ï¼Œåºåˆ—åŒ–é€šè¿‡å®ç° java.io.Serializable æ¥å£æ¥å®ç°ï¼Œåªæœ‰å®ç°äº† [Serializable æ¥å£](https://tobebetterjavaer.com/io/Serializbale.html)çš„å¯¹è±¡æ‰èƒ½è¢«åºåˆ—åŒ–ã€‚

ååºåˆ—åŒ–æ˜¯æŒ‡å°†ä¸€ä¸ªå­—èŠ‚åºåˆ—è½¬æ¢ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä»¥ä¾¿åœ¨ç¨‹åºä¸­ä½¿ç”¨ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/serialize-20230323105551.png)

### 01ã€ObjectOutputStream

`java.io.ObjectOutputStream` ç»§æ‰¿è‡ª OutputStream ç±»ï¼Œå› æ­¤å¯ä»¥å°†åºåˆ—åŒ–åçš„å­—èŠ‚åºåˆ—å†™å…¥åˆ°æ–‡ä»¶ã€ç½‘ç»œç­‰è¾“å‡ºæµä¸­ã€‚

æ¥çœ‹ ObjectOutputStream çš„æ„é€ æ–¹æ³•ï¼š
`ObjectOutputStream(OutputStream out)`

è¯¥æ„é€ æ–¹æ³•æ¥æ”¶ä¸€ä¸ª OutputStream å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œç”¨äºå°†åºåˆ—åŒ–åçš„å­—èŠ‚åºåˆ—è¾“å‡ºåˆ°æŒ‡å®šçš„è¾“å‡ºæµä¸­ã€‚ä¾‹å¦‚ï¼š

```java
FileOutputStream fos = new FileOutputStream("file.txt");
ObjectOutputStream oos = new ObjectOutputStream(fos);
```

ä¸€ä¸ªå¯¹è±¡è¦æƒ³åºåˆ—åŒ–ï¼Œå¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶:

- è¯¥ç±»å¿…é¡»å®ç°[`java.io.Serializable` æ¥å£](https://tobebetterjavaer.com/io/Serializbale.html)ï¼Œå¦åˆ™ä¼šæŠ›å‡º`NotSerializableException` ã€‚
- è¯¥ç±»çš„æ‰€æœ‰å­—æ®µéƒ½å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ã€‚å¦‚æœä¸€ä¸ªå­—æ®µä¸éœ€è¦åºåˆ—åŒ–ï¼Œåˆ™éœ€è¦ä½¿ç”¨[`transient` å…³é”®å­—](https://tobebetterjavaer.com/io/transient.html)è¿›è¡Œä¿®é¥°ã€‚

ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
public class Employee implements Serializable {
    public String name;
    public String address;
    public transient int age; // transientç¬æ€ä¿®é¥°æˆå‘˜,ä¸ä¼šè¢«åºåˆ—åŒ–
}
```

æ¥ä¸‹æ¥ï¼Œæ¥èŠèŠ `writeObject (Object obj)` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯ ObjectOutputStream ç±»ä¸­ç”¨äºå°†å¯¹è±¡åºåˆ—åŒ–æˆå­—èŠ‚åºåˆ—å¹¶è¾“å‡ºåˆ°è¾“å‡ºæµä¸­çš„æ–¹æ³•ï¼Œå¯ä»¥å¤„ç†å¯¹è±¡ä¹‹é—´çš„å¼•ç”¨å…³ç³»ã€ç»§æ‰¿å…³ç³»ã€é™æ€å­—æ®µå’Œ transient å­—æ®µã€‚

```java
public class ObjectOutputStreamDemo {
    public static void main(String[] args) {
        Person person = new Person("æ²‰é»˜ç‹äºŒ", 20);
        try {
            FileOutputStream fos = new FileOutputStream("logs/person.dat");
            ObjectOutputStream oos = new ObjectOutputStream(fos);
            oos.writeObject(person);
            oos.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
class Person implements Serializable {
    private String name;
    private int age;

    public Person(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public String getName() {
        return name;
    }

    public int getAge() {
        return age;
    }
}
```

ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª Person å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ FileOutputStream å’Œ ObjectOutputStream å°† Person å¯¹è±¡åºåˆ—åŒ–å¹¶è¾“å‡ºåˆ° person.dat æ–‡ä»¶ä¸­ã€‚åœ¨ Person ç±»ä¸­ï¼Œå®ç°äº† Serializable æ¥å£ï¼Œè¡¨ç¤ºè¯¥ç±»å¯ä»¥è¿›è¡Œå¯¹è±¡åºåˆ—åŒ–ã€‚

### 02ã€ObjectInputStream

ObjectInputStream å¯ä»¥è¯»å– ObjectOutputStream å†™å…¥çš„å­—èŠ‚æµï¼Œå¹¶å°†å…¶ååºåˆ—åŒ–ä¸ºç›¸åº”çš„å¯¹è±¡ï¼ˆåŒ…å«`å¯¹è±¡çš„æ•°æ®`ã€`å¯¹è±¡çš„ç±»å‹`å’Œ`å¯¹è±¡ä¸­å­˜å‚¨çš„å±æ€§`ç­‰ä¿¡æ¯ï¼‰ã€‚

è¯´ç®€å•ç‚¹å°±æ˜¯ï¼Œåºåˆ—åŒ–ä¹‹å‰æ˜¯ä»€ä¹ˆæ ·å­ï¼Œååºåˆ—åŒ–åå°±æ˜¯ä»€ä¹ˆæ ·å­ã€‚

æ¥çœ‹ä¸€ä¸‹æ„é€ æ–¹æ³•ï¼š`ObjectInputStream(InputStream in)` ï¼š åˆ›å»ºä¸€ä¸ªæŒ‡å®š InputStream çš„ ObjectInputStreamã€‚

å…¶ä¸­ï¼ŒObjectInputStream çš„ readObject æ–¹æ³•ç”¨æ¥è¯»å–æŒ‡å®šæ–‡ä»¶ä¸­çš„å¯¹è±¡ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
String filename = "logs/person.dat"; // å¾…ååºåˆ—åŒ–çš„æ–‡ä»¶å
try (FileInputStream fileIn = new FileInputStream(filename);
     ObjectInputStream in = new ObjectInputStream(fileIn)) {
     // ä»æŒ‡å®šçš„æ–‡ä»¶è¾“å…¥æµä¸­è¯»å–å¯¹è±¡å¹¶ååºåˆ—åŒ–
     Object obj = in.readObject();
     // å°†ååºåˆ—åŒ–åçš„å¯¹è±¡å¼ºåˆ¶è½¬æ¢ä¸ºæŒ‡å®šç±»å‹
     Person p = (Person) obj;
     // æ‰“å°ååºåˆ—åŒ–åçš„å¯¹è±¡ä¿¡æ¯
     System.out.println("Deserialized Object: " + p);
} catch (IOException | ClassNotFoundException e) {
     e.printStackTrace();
}
```

æˆ‘ä»¬é¦–å…ˆæŒ‡å®šäº†å¾…ååºåˆ—åŒ–çš„æ–‡ä»¶åï¼ˆå‰é¢é€šè¿‡ ObjectOutputStream åºåˆ—åŒ–åçš„æ–‡ä»¶ï¼‰ï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ª FileInputStream å¯¹è±¡å’Œä¸€ä¸ª ObjectInputStream å¯¹è±¡ã€‚æ¥ç€æˆ‘ä»¬è°ƒç”¨ ObjectInputStream çš„ readObject æ–¹æ³•æ¥è¯»å–æŒ‡å®šæ–‡ä»¶ä¸­çš„å¯¹è±¡ï¼Œå¹¶å°†å…¶å¼ºåˆ¶è½¬æ¢ä¸º Person ç±»å‹ã€‚æœ€åæˆ‘ä»¬æ‰“å°äº†ååºåˆ—åŒ–åçš„å¯¹è±¡ä¿¡æ¯ã€‚

### 03ã€Kryo

å®é™…å¼€å‘ä¸­ï¼Œå¾ˆå°‘ä½¿ç”¨ JDK è‡ªå¸¦çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œè¿™æ˜¯å› ä¸ºï¼š

- å¯ç§»æ¤æ€§å·®ï¼šJava ç‰¹æœ‰çš„ï¼Œæ— æ³•è·¨è¯­è¨€è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚
- æ€§èƒ½å·®ï¼šåºåˆ—åŒ–åçš„å­—èŠ‚ä½“ç§¯å¤§ï¼Œå¢åŠ äº†ä¼ è¾“/ä¿å­˜æˆæœ¬ã€‚
- å®‰å…¨é—®é¢˜ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„æ•°æ®æ¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œä»è€Œå¯¹ç³»ç»Ÿé€ æˆä¸¥é‡çš„å®‰å…¨å¨èƒã€‚ç›¸å…³é˜…è¯»ï¼š[Java ååºåˆ—åŒ–æ¼æ´ä¹‹æ®‡](https://cryin.github.io/blog/secure-development-java-deserialization-vulnerability/) ã€‚

Kryo æ˜¯ä¸€ä¸ªä¼˜ç§€çš„ Java åºåˆ—åŒ–å’Œååºåˆ—åŒ–åº“ï¼Œå…·æœ‰é«˜æ€§èƒ½ã€é«˜æ•ˆç‡å’Œæ˜“äºä½¿ç”¨å’Œæ‰©å±•ç­‰ç‰¹ç‚¹ï¼Œæœ‰æ•ˆåœ°è§£å†³äº† JDK è‡ªå¸¦çš„åºåˆ—åŒ–æœºåˆ¶çš„ç—›ç‚¹ã€‚

>GitHub åœ°å€ï¼š[https://github.com/EsotericSoftware/kryo](https://github.com/EsotericSoftware/kryo)

ä½¿ç”¨ç¤ºä¾‹ï¼š

ç¬¬ä¸€æ­¥ï¼Œåœ¨ pom.xml ä¸­å¼•å…¥ä¾èµ–ã€‚

```
<!-- å¼•å…¥ Kryo åºåˆ—åŒ–å·¥å…· -->
<dependency>
     <groupId>com.esotericsoftware</groupId>
     <artifactId>kryo</artifactId>
     <version>5.4.0</version>
</dependency>
```

ç¬¬äºŒæ­¥ï¼Œåˆ›å»ºä¸€ä¸ª Kryo å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ `register()` æ–¹æ³•å°†å¯¹è±¡è¿›è¡Œæ³¨å†Œã€‚ç„¶åï¼Œä½¿ç”¨ `writeObject()` æ–¹æ³•å°† Java å¯¹è±¡åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶æµï¼Œå†ä½¿ç”¨ `readObject()` æ–¹æ³•å°†äºŒè¿›åˆ¶æµååºåˆ—åŒ–ä¸º Java å¯¹è±¡ã€‚æœ€åï¼Œè¾“å‡ºååºåˆ—åŒ–åçš„ Java å¯¹è±¡ã€‚

```java
public class KryoDemo {
    public static void main(String[] args) throws FileNotFoundException {
        Kryo kryo = new Kryo();
        kryo.register(KryoParam.class);

        KryoParam object = new KryoParam("æ²‰é»˜ç‹äºŒ", 123);

        Output output = new Output(new FileOutputStream("logs/kryo.bin"));
        kryo.writeObject(output, object);
        output.close();

        Input input = new Input(new FileInputStream("logs/kryo.bin"));
        KryoParam object2 = kryo.readObject(input, KryoParam.class);
        System.out.println(object2);
        input.close();
    }
}

class KryoParam {
    private String name;
    private int age;

    public KryoParam() {
    }

    public KryoParam(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }

    @Override
    public String toString() {
        return "KryoParam{" +
                "name='" + name + '\'' +
                ", age=" + age +
                '}';
    }
}
```

### 04ã€å°ç»“

æœ¬èŠ‚æˆ‘ä»¬ä»‹ç»äº† Java çš„åºåˆ—åŒ–æœºåˆ¶ï¼Œå¹¶æ¨èäº†ä¸€æ¬¾é«˜æ€§èƒ½çš„ Java ç±»åº“ Kryo æ¥å–ä»£ JDK è‡ªå¸¦çš„åºåˆ—åŒ–æœºåˆ¶ï¼Œå·²ç»åœ¨ Twitterã€Grouponã€Yahoo ä»¥åŠå¤šä¸ªè‘—åå¼€æºé¡¹ç›®ï¼ˆå¦‚ Hiveã€Stormï¼‰ä¸­å¹¿æ³›ä½¿ç”¨ã€‚

ä»¥ä¸Šï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°å¤§å®¶ã€‚

---------

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 7.9 åºåˆ—æ¥å£Serializable

å¯¹äº Java çš„åºåˆ—åŒ–ï¼Œæˆ‘ä¹‹å‰ä¸€ç›´åœç•™åœ¨æœ€æµ…å±‚æ¬¡çš„è®¤çŸ¥ä¸Šâ€”â€”æŠŠé‚£ä¸ªè¦[åºåˆ—åŒ–](https://tobebetterjavaer.com/io/serialize.html)çš„ç±»å®ç° `Serializbale` æ¥å£å°±å¯ä»¥äº†å˜›ã€‚

æˆ‘ä¼¼ä¹ä¸æ„¿æ„åšæ›´æ·±å…¥çš„ç ”ç©¶ï¼Œå› ä¸ºä¼šç”¨å°±è¡Œäº†å˜›ã€‚

ä½†éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè§åˆ° `Serializbale` çš„æ¬¡æ•°è¶Šæ¥è¶Šå¤šï¼Œæˆ‘ä¾¿å¯¹å®ƒäº§ç”Ÿäº†æµ“åšçš„å…´è¶£ã€‚æ˜¯æ—¶å€™èŠ±ç‚¹æ—¶é—´ç ”ç©¶ç ”ç©¶äº†ã€‚

### 01ã€å…ˆæ¥ç‚¹ç†è®º

Java åºåˆ—åŒ–æ˜¯ JDK 1.1 æ—¶å¼•å…¥çš„ä¸€ç»„å¼€åˆ›æ€§çš„ç‰¹æ€§ï¼Œç”¨äºå°† Java å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„ï¼Œä¾¿äºå­˜å‚¨æˆ–ä¼ è¾“ã€‚æ­¤åï¼Œä»ç„¶å¯ä»¥å°†å­—èŠ‚æ•°ç»„è½¬æ¢å› Java å¯¹è±¡åŸæœ‰çš„çŠ¶æ€ã€‚

åºåˆ—åŒ–çš„æ€æƒ³æ˜¯â€œå†»ç»“â€å¯¹è±¡çŠ¶æ€ï¼Œç„¶åå†™åˆ°ç£ç›˜æˆ–è€…åœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼›[ååºåˆ—åŒ–](https://tobebetterjavaer.com/io/serialize.html)çš„æ€æƒ³æ˜¯â€œè§£å†»â€å¯¹è±¡çŠ¶æ€ï¼Œé‡æ–°è·å¾—å¯ç”¨çš„ Java å¯¹è±¡ã€‚

åºåˆ—åŒ–æœ‰ä¸€æ¡è§„åˆ™ï¼Œå°±æ˜¯è¦åºåˆ—åŒ–çš„å¯¹è±¡å¿…é¡»å®ç° `Serializbale` æ¥å£ï¼Œå¦åˆ™å°±ä¼šæŠ¥ NotSerializableException å¼‚å¸¸ã€‚

å¥½ï¼Œæ¥çœ‹çœ‹ `Serializbale` æ¥å£çš„å®šä¹‰å§ï¼š

```java
public interface Serializable {
}
```

æ²¡åˆ«çš„äº†ï¼

æ˜æ˜å°±ä¸€ä¸ªç©ºçš„æ¥å£å˜›ï¼Œç«Ÿç„¶èƒ½å¤Ÿä¿è¯å®ç°äº†å®ƒçš„â€œç±»å¯¹è±¡â€è¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Ÿ

### 02ã€å†æ¥ç‚¹å®æˆ˜

åœ¨å›ç­”ä¸Šè¿°é—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥åˆ›å»ºä¸€ä¸ªç±»ï¼ˆåªæœ‰ä¸¤ä¸ªå­—æ®µï¼Œå’Œå¯¹åº”çš„ `getter/setter`ï¼‰ï¼Œç”¨äºåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚

```java
class Wanger {
    private String name;
    private int age;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }
}
```

å†æ¥åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±»ï¼Œé€šè¿‡ `ObjectOutputStream` å°†â€œ18 å²çš„ç‹äºŒâ€å†™å…¥åˆ°æ–‡ä»¶å½“ä¸­ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ç§åºåˆ—åŒ–çš„è¿‡ç¨‹ï¼›å†é€šè¿‡ `ObjectInputStream` å°†â€œ18 å²çš„ç‹äºŒâ€ä»æ–‡ä»¶ä¸­è¯»å‡ºæ¥ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ç§ååºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚ï¼ˆå‰é¢æˆ‘ä»¬å­¦ä¹ [åºåˆ—æµ](https://tobebetterjavaer.com/io/serialize.html)çš„æ—¶å€™ä¹Ÿè®²è¿‡ï¼‰

```java
// åˆå§‹åŒ–
Wanger wanger = new Wanger();
wanger.setName("ç‹äºŒ");
wanger.setAge(18);
System.out.println(wanger);

// æŠŠå¯¹è±¡å†™åˆ°æ–‡ä»¶ä¸­
try (ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream("chenmo"));){
    oos.writeObject(wanger);
} catch (IOException e) {
    e.printStackTrace();
}

// ä»æ–‡ä»¶ä¸­è¯»å‡ºå¯¹è±¡
try (ObjectInputStream ois = new ObjectInputStream(new FileInputStream(new File("chenmo")));){
    Wanger wanger1 = (Wanger) ois.readObject();
    System.out.println(wanger1);
} catch (IOException | ClassNotFoundException e) {
    e.printStackTrace();
}
```

ä¸è¿‡ï¼Œç”±äº `Wanger` æ²¡æœ‰å®ç° `Serializbale` æ¥å£ï¼Œæ‰€ä»¥åœ¨è¿è¡Œæµ‹è¯•ç±»çš„æ—¶å€™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå †æ ˆä¿¡æ¯å¦‚ä¸‹ï¼š

```
java.io.NotSerializableException: com.cmower.java_demo.xuliehua.Wanger
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1184)
	at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348)
	at com.cmower.java_demo.xuliehua.Test.main(Test.java:21)
```

é¡ºç€å †æ ˆä¿¡æ¯ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ `ObjectOutputStream` çš„ `writeObject0()` æ–¹æ³•ã€‚å…¶éƒ¨åˆ†æºç å¦‚ä¸‹ï¼š

```java
// åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è°ƒç”¨ writeString æ–¹æ³•è¿›è¡Œåºåˆ—åŒ–
if (obj instanceof String) {
    writeString((String) obj, unshared);
}
// åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºæ•°ç»„ç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è°ƒç”¨ writeArray æ–¹æ³•è¿›è¡Œåºåˆ—åŒ–
else if (cl.isArray()) {
    writeArray(obj, desc, unshared);
}
// åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºæšä¸¾ç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è°ƒç”¨ writeEnum æ–¹æ³•è¿›è¡Œåºåˆ—åŒ–
else if (obj instanceof Enum) {
    writeEnum((Enum<?>) obj, desc, unshared);
}
// åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºå¯åºåˆ—åŒ–ç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è°ƒç”¨ writeOrdinaryObject æ–¹æ³•è¿›è¡Œåºåˆ—åŒ–
else if (obj instanceof Serializable) {
    writeOrdinaryObject(obj, desc, unshared);
}
// å¦‚æœå¯¹è±¡ä¸èƒ½è¢«åºåˆ—åŒ–ï¼Œåˆ™æŠ›å‡º NotSerializableException å¼‚å¸¸
else {
if (extendedDebugInfo) {
    throw new NotSerializableException(
        cl.getName() + "\n" + debugInfoStack.toString());
} else {
    throw new NotSerializableException(cl.getName());
}
}
```

ä¹Ÿå°±æ˜¯è¯´ï¼Œ`ObjectOutputStream` åœ¨åºåˆ—åŒ–çš„æ—¶å€™ï¼Œä¼šåˆ¤æ–­è¢«åºåˆ—åŒ–çš„å¯¹è±¡æ˜¯å“ªä¸€ç§ç±»å‹ï¼Œå­—ç¬¦ä¸²ï¼Ÿæ•°ç»„ï¼Ÿæšä¸¾ï¼Ÿè¿˜æ˜¯ `Serializable`ï¼Œå¦‚æœå…¨éƒ½ä¸æ˜¯çš„è¯ï¼ŒæŠ›å‡º `NotSerializableException`ã€‚

å‡å¦‚ `Wanger` å®ç°äº† `Serializable` æ¥å£ï¼Œå°±å¯ä»¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–äº†ã€‚

```java
class Wanger implements Serializable{
    private static final long serialVersionUID = -2095916884810199532L;
    
    private String name;
    private int age;
}
```

å…·ä½“æ€ä¹ˆåºåˆ—åŒ–å‘¢ï¼Ÿ

ä»¥ `ObjectOutputStream` ä¸ºä¾‹å§ï¼Œå®ƒåœ¨åºåˆ—åŒ–çš„æ—¶å€™ä¼šä¾æ¬¡è°ƒç”¨ `writeObject()`â†’`writeObject0()`â†’`writeOrdinaryObject()`â†’`writeSerialData()`â†’`invokeWriteObject()`â†’`defaultWriteFields()`ã€‚

```java
private void defaultWriteFields(Object obj, ObjectStreamClass desc) throws IOException {
    // è·å–å¯¹è±¡çš„ç±»ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦å¯ä»¥è¿›è¡Œé»˜è®¤çš„åºåˆ—åŒ–
    Class<?> cl = desc.forClass();
    desc.checkDefaultSerialize();

    // è·å–å¯¹è±¡çš„åŸºæœ¬ç±»å‹å­—æ®µçš„æ•°é‡ï¼Œä»¥åŠè¿™äº›å­—æ®µçš„å€¼
    int primDataSize = desc.getPrimDataSize();
    desc.getPrimFieldValues(obj, primVals);
    // å°†åŸºæœ¬ç±»å‹å­—æ®µçš„å€¼å†™å…¥è¾“å‡ºæµ
    bout.write(primVals, 0, primDataSize, false);

    // è·å–å¯¹è±¡çš„éåŸºæœ¬ç±»å‹å­—æ®µçš„å€¼
    ObjectStreamField[] fields = desc.getFields(false);
    Object[] objVals = new Object[desc.getNumObjFields()];
    int numPrimFields = fields.length - objVals.length;
    desc.getObjFieldValues(obj, objVals);
    // å¾ªç¯å†™å…¥å¯¹è±¡çš„éåŸºæœ¬ç±»å‹å­—æ®µçš„å€¼
    for (int i = 0; i < objVals.length; i++) {
        // è°ƒç”¨ writeObject0 æ–¹æ³•å°†å¯¹è±¡çš„éåŸºæœ¬ç±»å‹å­—æ®µåºåˆ—åŒ–å†™å…¥è¾“å‡ºæµ
        try {
            writeObject0(objVals[i], fields[numPrimFields + i].isUnshared());
        }
        // å¦‚æœåœ¨å†™å…¥è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œåˆ™å°†å¼‚å¸¸åŒ…è£…æˆ IOException æŠ›å‡º
        catch (IOException ex) {
            if (abortIOException == null) {
                abortIOException = ex;
            }
        }
    }
}
```

é‚£æ€ä¹ˆååºåˆ—åŒ–å‘¢ï¼Ÿ

ä»¥ `ObjectInputStream` ä¸ºä¾‹ï¼Œå®ƒåœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¼šä¾æ¬¡è°ƒç”¨ `readObject()`â†’`readObject0()`â†’`readOrdinaryObject()`â†’`readSerialData()`â†’`defaultReadFields()`ã€‚

```java
private void defaultReadFields(Object obj, ObjectStreamClass desc) throws IOException {
    // è·å–å¯¹è±¡çš„ç±»ï¼Œå¹¶æ£€æŸ¥å¯¹è±¡æ˜¯å¦å±äºè¯¥ç±»
    Class<?> cl = desc.forClass();
    if (cl != null && obj != null && !cl.isInstance(obj)) {
        throw new ClassCastException();
    }

    // è·å–å¯¹è±¡çš„åŸºæœ¬ç±»å‹å­—æ®µçš„æ•°é‡å’Œå€¼
    int primDataSize = desc.getPrimDataSize();
    if (primVals == null || primVals.length < primDataSize) {
        primVals = new byte[primDataSize];
    }
    // ä»è¾“å…¥æµä¸­è¯»å–åŸºæœ¬ç±»å‹å­—æ®µçš„å€¼ï¼Œå¹¶å­˜å‚¨åœ¨ primVals æ•°ç»„ä¸­
    bin.readFully(primVals, 0, primDataSize, false);
    if (obj != null) {
        // å°† primVals æ•°ç»„ä¸­çš„åŸºæœ¬ç±»å‹å­—æ®µçš„å€¼è®¾ç½®åˆ°å¯¹è±¡çš„ç›¸åº”å­—æ®µä¸­
        desc.setPrimFieldValues(obj, primVals);
    }

    // è·å–å¯¹è±¡çš„éåŸºæœ¬ç±»å‹å­—æ®µçš„æ•°é‡å’Œå€¼
    int objHandle = passHandle;
    ObjectStreamField[] fields = desc.getFields(false);
    Object[] objVals = new Object[desc.getNumObjFields()];
    int numPrimFields = fields.length - objVals.length;
    // å¾ªç¯è¯»å–å¯¹è±¡çš„éåŸºæœ¬ç±»å‹å­—æ®µçš„å€¼
    for (int i = 0; i < objVals.length; i++) {
        // è°ƒç”¨ readObject0 æ–¹æ³•è¯»å–å¯¹è±¡çš„éåŸºæœ¬ç±»å‹å­—æ®µçš„å€¼
        ObjectStreamField f = fields[numPrimFields + i];
        objVals[i] = readObject0(Object.class, f.isUnshared());
        // å¦‚æœè¯¥å­—æ®µæ˜¯ä¸€ä¸ªå¼•ç”¨å­—æ®µï¼Œåˆ™å°†å…¶æ ‡è®°ä¸ºä¾èµ–è¯¥å¯¹è±¡
        if (f.getField() != null) {
            handles.markDependency(objHandle, passHandle);
        }
    }
    if (obj != null) {
        // å°† objVals æ•°ç»„ä¸­çš„éåŸºæœ¬ç±»å‹å­—æ®µçš„å€¼è®¾ç½®åˆ°å¯¹è±¡çš„ç›¸åº”å­—æ®µä¸­
        desc.setObjFieldValues(obj, objVals);
    }
    passHandle = objHandle;
}
```

æˆ‘æƒ³çœ‹åˆ°è¿™ï¼Œä½ åº”è¯¥ä¼šæç„¶å¤§æ‚Ÿçš„â€œå“¦â€ä¸€å£°äº†ã€‚`Serializable` æ¥å£ä¹‹æ‰€ä»¥å®šä¹‰ä¸ºç©ºï¼Œæ˜¯å› ä¸ºå®ƒåªèµ·åˆ°äº†ä¸€ä¸ªæ ‡è¯†çš„ä½œç”¨ï¼Œå‘Šè¯‰ç¨‹åºå®ç°äº†å®ƒçš„å¯¹è±¡æ˜¯å¯ä»¥è¢«åºåˆ—åŒ–çš„ï¼Œä½†çœŸæ­£åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ“ä½œå¹¶ä¸éœ€è¦å®ƒæ¥å®Œæˆã€‚

### 03ã€å†æ¥ç‚¹æ³¨æ„äº‹é¡¹

å¼€é—¨è§å±±çš„è¯´å§ï¼Œ[`static`](https://tobebetterjavaer.com/oo/static.html) å’Œ [`transient`](https://tobebetterjavaer.com/io/transient.html) ä¿®é¥°çš„å­—æ®µæ˜¯ä¸ä¼šè¢«åºåˆ—åŒ–çš„ã€‚

ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥è¯æ˜ï¼Œå†æ¥è§£é‡ŠåŸå› ã€‚

é¦–å…ˆï¼Œåœ¨ `Wanger` ç±»ä¸­å¢åŠ ä¸¤ä¸ªå­—æ®µã€‚

```java
class Wanger implements Serializable {
    private static final long serialVersionUID = -2095916884810199532L;

    private String name;
    private int age;

    public static String pre = "æ²‰é»˜";
    transient String meizi = "ç‹ä¸‰";

    @Override
    public String toString() {
        return "Wanger{" + "name=" + name + ",age=" + age + ",pre=" + pre + ",meizi=" + meizi + "}";
    }
}
```

å…¶æ¬¡ï¼Œåœ¨æµ‹è¯•ç±»ä¸­æ‰“å°åºåˆ—åŒ–å‰å’Œååºåˆ—åŒ–åçš„å¯¹è±¡ï¼Œå¹¶åœ¨åºåˆ—åŒ–åå’Œååºåˆ—åŒ–å‰æ”¹å˜ `static` å­—æ®µçš„å€¼ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```java
// åˆå§‹åŒ–
Wanger wanger = new Wanger();
wanger.setName("ç‹äºŒ");
wanger.setAge(18);
System.out.println(wanger);

// æŠŠå¯¹è±¡å†™åˆ°æ–‡ä»¶ä¸­
try (ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream("chenmo"));){
        oos.writeObject(wanger);
    } catch (IOException e) {
        e.printStackTrace();
    }
   
    // æ”¹å˜ static å­—æ®µçš„å€¼
Wanger.pre ="ä¸æ²‰é»˜";

// ä»æ–‡ä»¶ä¸­è¯»å‡ºå¯¹è±¡
try (ObjectInputStream ois = new ObjectInputStream(new FileInputStream(new File("chenmo")));){
    Wanger wanger1 = (Wanger) ois.readObject();
    System.out.println(wanger1);
} catch (IOException | ClassNotFoundException e) {
    e.printStackTrace();
}
```

è¾“å‡ºç»“æœï¼š

```
Wanger{name=ç‹äºŒ,age=18,pre=æ²‰é»˜,meizi=ç‹ä¸‰}
Wanger{name=ç‹äºŒ,age=18,pre=ä¸æ²‰é»˜,meizi=null}
```

ä»ç»“æœçš„å¯¹æ¯”å½“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼š

1ï¼‰åºåˆ—åŒ–å‰ï¼Œ`pre` çš„å€¼ä¸ºâ€œæ²‰é»˜â€ï¼Œåºåˆ—åŒ–åï¼Œ`pre` çš„å€¼ä¿®æ”¹ä¸ºâ€œä¸æ²‰é»˜â€ï¼Œååºåˆ—åŒ–åï¼Œ`pre` çš„å€¼ä¸ºâ€œä¸æ²‰é»˜â€ï¼Œè€Œä¸æ˜¯åºåˆ—åŒ–å‰çš„çŠ¶æ€â€œæ²‰é»˜â€ã€‚

ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºåºåˆ—åŒ–ä¿å­˜çš„æ˜¯å¯¹è±¡çš„çŠ¶æ€ï¼Œè€Œ `static` ä¿®é¥°çš„å­—æ®µå±äºç±»çš„çŠ¶æ€ï¼Œå› æ­¤å¯ä»¥è¯æ˜åºåˆ—åŒ–å¹¶ä¸ä¿å­˜ `static` ä¿®é¥°çš„å­—æ®µã€‚

2ï¼‰åºåˆ—åŒ–å‰ï¼Œ`meizi` çš„å€¼ä¸ºâ€œç‹ä¸‰â€ï¼Œååºåˆ—åŒ–åï¼Œ`meizi` çš„å€¼ä¸º `null`ï¼Œè€Œä¸æ˜¯åºåˆ—åŒ–å‰çš„çŠ¶æ€â€œç‹ä¸‰â€ã€‚

ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ`transient` çš„ä¸­æ–‡å­—ä¹‰ä¸ºâ€œä¸´æ—¶çš„â€ï¼ˆè®ºè‹±è¯­çš„é‡è¦æ€§ï¼‰ï¼Œå®ƒå¯ä»¥é˜»æ­¢å­—æ®µè¢«åºåˆ—åŒ–åˆ°æ–‡ä»¶ä¸­ï¼Œåœ¨è¢«ååºåˆ—åŒ–åï¼Œ`transient` å­—æ®µçš„å€¼è¢«è®¾ä¸ºåˆå§‹å€¼ï¼Œæ¯”å¦‚ `int` å‹çš„åˆå§‹å€¼ä¸º 0ï¼Œå¯¹è±¡å‹çš„åˆå§‹å€¼ä¸º `null`ã€‚

å¦‚æœæƒ³è¦æ·±ç©¶æºç çš„è¯ï¼Œä½ å¯ä»¥åœ¨ `ObjectStreamClass` ä¸­å‘ç°ä¸‹é¢è¿™æ ·çš„ä»£ç ï¼š

```java
private static ObjectStreamField[] getDefaultSerialFields(Class<?> cl) {
    // è·å–è¯¥ç±»ä¸­å£°æ˜çš„æ‰€æœ‰å­—æ®µ
    Field[] clFields = cl.getDeclaredFields();
    ArrayList<ObjectStreamField> list = new ArrayList<>();
    int mask = Modifier.STATIC | Modifier.TRANSIENT;

    // éå†æ‰€æœ‰å­—æ®µï¼Œå°†é static å’Œ transient çš„å­—æ®µæ·»åŠ åˆ° list ä¸­
    for (int i = 0; i < clFields.length; i++) {
        Field field = clFields[i];
        int mods = field.getModifiers();
        if ((mods & mask) == 0) {
            // æ ¹æ®å­—æ®µåã€å­—æ®µç±»å‹å’Œå­—æ®µæ˜¯å¦å¯åºåˆ—åŒ–åˆ›å»ºä¸€ä¸ª ObjectStreamField å¯¹è±¡
            ObjectStreamField osf = new ObjectStreamField(field.getName(), field.getType(), !Serializable.class.isAssignableFrom(cl));
            list.add(osf);
        }
    }

    int size = list.size();
    // å¦‚æœ list ä¸ºç©ºï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºçš„ ObjectStreamField æ•°ç»„ï¼Œå¦åˆ™å°† list è½¬æ¢ä¸º ObjectStreamField æ•°ç»„å¹¶è¿”å›
    return (size == 0) ? NO_FIELDS :
        list.toArray(new ObjectStreamField[size]);
}
```

çœ‹åˆ° `Modifier.STATIC | Modifier.TRANSIENT` äº†å§ï¼Œè¿™ä¸¤ä¸ªä¿®é¥°ç¬¦æ ‡è®°çš„å­—æ®µå°±æ²¡æœ‰è¢«æ”¾å…¥åˆ°åºåˆ—åŒ–çš„å­—æ®µä¸­ï¼Œæ˜ç™½äº†å§ï¼Ÿ

### 04ã€å†æ¥ç‚¹å¹²è´§

é™¤äº† `Serializable` ä¹‹å¤–ï¼ŒJava è¿˜æä¾›äº†ä¸€ä¸ªåºåˆ—åŒ–æ¥å£ `Externalizable`ï¼ˆå¿µèµ·æ¥æœ‰ç‚¹æ‹—å£ï¼‰ã€‚

ä¸¤ä¸ªæ¥å£æœ‰ä»€ä¹ˆä¸ä¸€æ ·çš„å—ï¼Ÿè¯•ä¸€è¯•å°±çŸ¥é“äº†ã€‚

é¦–å…ˆï¼ŒæŠŠ `Wanger` ç±»å®ç°çš„æ¥å£  `Serializable` æ›¿æ¢ä¸º `Externalizable`ã€‚

```java
class Wanger implements Externalizable {
	private String name;
	private int age;

	public Wanger() {

	}

	public String getName() {
		return name;
	}

	
	@Override
	public String toString() {
		return "Wanger{" + "name=" + name + ",age=" + age + "}";
	}

	@Override
	public void writeExternal(ObjectOutput out) throws IOException {

	}

	@Override
	public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException {

	}

}
```

å®ç° `Externalizable` æ¥å£çš„ `Wanger` ç±»å’Œå®ç° `Serializable` æ¥å£çš„ `Wanger` ç±»æœ‰ä¸€äº›ä¸åŒï¼š

1ï¼‰æ–°å¢äº†ä¸€ä¸ªæ— å‚çš„æ„é€ æ–¹æ³•ã€‚

ä½¿ç”¨ `Externalizable` è¿›è¡Œååºåˆ—åŒ–çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨è¢«åºåˆ—åŒ–ç±»çš„æ— å‚æ„é€ æ–¹æ³•å»åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œç„¶åå†å°†è¢«ä¿å­˜å¯¹è±¡çš„å­—æ®µå€¼å¤åˆ¶è¿‡å»ã€‚å¦åˆ™çš„è¯ï¼Œä¼šæŠ›å‡ºä»¥ä¸‹å¼‚å¸¸ï¼š

```
java.io.InvalidClassException: com.cmower.java_demo.xuliehua1.Wanger; no valid constructor
	at java.io.ObjectStreamClass$ExceptionInfo.newInvalidClassException(ObjectStreamClass.java:150)
	at java.io.ObjectStreamClass.checkDeserialize(ObjectStreamClass.java:790)
	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1782)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1353)
	at java.io.ObjectInputStream.readObject(ObjectInputStream.java:373)
	at com.cmower.java_demo.xuliehua1.Test.main(Test.java:27)
```

2ï¼‰æ–°å¢äº†ä¸¤ä¸ªæ–¹æ³• `writeExternal()` å’Œ `readExternal()`ï¼Œå®ç° `Externalizable` æ¥å£æ‰€å¿…é¡»çš„ã€‚

ç„¶åï¼Œæˆ‘ä»¬å†åœ¨æµ‹è¯•ç±»ä¸­æ‰“å°åºåˆ—åŒ–å‰å’Œååºåˆ—åŒ–åçš„å¯¹è±¡ã€‚

```java
// åˆå§‹åŒ–
Wanger wanger = new Wanger();
wanger.setName("ç‹äºŒ");
wanger.setAge(18);
System.out.println(wanger);

// æŠŠå¯¹è±¡å†™åˆ°æ–‡ä»¶ä¸­
try (ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream("chenmo"));) {
	oos.writeObject(wanger);
} catch (IOException e) {
	e.printStackTrace();
}

// ä»æ–‡ä»¶ä¸­è¯»å‡ºå¯¹è±¡
try (ObjectInputStream ois = new ObjectInputStream(new FileInputStream(new File("chenmo")));) {
	Wanger wanger1 = (Wanger) ois.readObject();
	System.out.println(wanger1);
} catch (IOException | ClassNotFoundException e) {
	e.printStackTrace();
}
// Wanger{name=ç‹äºŒ,age=18}
// Wanger{name=null,age=0}
```

ä»è¾“å‡ºçš„ç»“æœçœ‹ï¼Œååºåˆ—åŒ–åå¾—åˆ°çš„å¯¹è±¡å­—æ®µéƒ½å˜æˆäº†é»˜è®¤å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåºåˆ—åŒ–ä¹‹å‰çš„å¯¹è±¡çŠ¶æ€æ²¡æœ‰è¢«â€œå†»ç»“â€ä¸‹æ¥ã€‚

ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä¸º `Wanger` ç±»é‡å†™å…·ä½“çš„ `writeExternal()` å’Œ `readExternal()` æ–¹æ³•ã€‚é‚£è¯¥æ€ä¹ˆé‡å†™å‘¢ï¼Ÿ

```java
@Override
public void writeExternal(ObjectOutput out) throws IOException {
	out.writeObject(name);
	out.writeInt(age);
}

@Override
public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException {
	name = (String) in.readObject();
	age = in.readInt();
}
```

1ï¼‰è°ƒç”¨ `ObjectOutput` çš„ `writeObject()` æ–¹æ³•å°†å­—ç¬¦ä¸²ç±»å‹çš„ `name` å†™å…¥åˆ°è¾“å‡ºæµä¸­ï¼›

2ï¼‰è°ƒç”¨ `ObjectOutput` çš„ `writeInt()` æ–¹æ³•å°†æ•´å‹çš„ `age` å†™å…¥åˆ°è¾“å‡ºæµä¸­ï¼›

3ï¼‰è°ƒç”¨ `ObjectInput` çš„ `readObject()` æ–¹æ³•å°†å­—ç¬¦ä¸²ç±»å‹çš„ `name` è¯»å…¥åˆ°è¾“å…¥æµä¸­ï¼›

4ï¼‰è°ƒç”¨ `ObjectInput` çš„ `readInt()` æ–¹æ³•å°†å­—ç¬¦ä¸²ç±»å‹çš„ `age` è¯»å…¥åˆ°è¾“å…¥æµä¸­ï¼›

å†è¿è¡Œä¸€æ¬¡æµ‹è¯•äº†ç±»ï¼Œä½ ä¼šå‘ç°å¯¹è±¡å¯ä»¥æ­£å¸¸åœ°åºåˆ—åŒ–å’Œååºåˆ—åŒ–äº†ã€‚

>åºåˆ—åŒ–å‰ï¼šWanger{name=ç‹äºŒ,age=18}
åºåˆ—åŒ–åï¼šWanger{name=ç‹äºŒ,age=18}

æ€»ç»“ä¸€ä¸‹ï¼š

Externalizable å’Œ Serializable éƒ½æ˜¯ç”¨äºå®ç° Java å¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ¥å£ï¼Œä½†æ˜¯å®ƒä»¬æœ‰ä»¥ä¸‹åŒºåˆ«ï¼š

â‘ ã€Serializable æ˜¯ Java æ ‡å‡†åº“æä¾›çš„æ¥å£ï¼Œè€Œ Externalizable æ˜¯ Serializable çš„å­æ¥å£ï¼›

![](https://cdn.tobebetterjavaer.com/stutymore/Serializbale-20230323161831.png)


â‘¡ã€Serializable æ¥å£ä¸éœ€è¦å®ç°ä»»ä½•æ–¹æ³•ï¼Œåªéœ€è¦å°†éœ€è¦åºåˆ—åŒ–çš„ç±»æ ‡è®°ä¸º Serializable å³å¯ï¼Œè€Œ Externalizable æ¥å£éœ€è¦å®ç° writeExternal å’Œ readExternal ä¸¤ä¸ªæ–¹æ³•ï¼›

â‘¢ã€Externalizable æ¥å£æä¾›äº†æ›´é«˜çš„åºåˆ—åŒ–æ§åˆ¶èƒ½åŠ›ï¼Œå¯ä»¥åœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ä¸­å¯¹å¯¹è±¡è¿›è¡Œè‡ªå®šä¹‰çš„å¤„ç†ï¼Œå¦‚å¯¹ä¸€äº›æ•æ„Ÿä¿¡æ¯è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚

### 05ã€å†æ¥ç‚¹ç”œç‚¹

è®©æˆ‘å…ˆé—®é—®ä½ å§ï¼Œä½ çŸ¥é“ ` private static final long serialVersionUID = -2095916884810199532L;` è¿™æ®µä»£ç çš„ä½œç”¨å—ï¼Ÿ

å—¯......

`serialVersionUID` è¢«ç§°ä¸ºåºåˆ—åŒ– IDï¼Œå®ƒæ˜¯å†³å®š Java å¯¹è±¡èƒ½å¦ååºåˆ—åŒ–æˆåŠŸçš„é‡è¦å› å­ã€‚åœ¨ååºåˆ—åŒ–æ—¶ï¼ŒJava è™šæ‹Ÿæœºä¼šæŠŠå­—èŠ‚æµä¸­çš„ `serialVersionUID` ä¸è¢«åºåˆ—åŒ–ç±»ä¸­çš„ `serialVersionUID` è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒåˆ™å¯ä»¥è¿›è¡Œååºåˆ—åŒ–ï¼Œå¦åˆ™å°±ä¼šæŠ›å‡ºåºåˆ—åŒ–ç‰ˆæœ¬ä¸ä¸€è‡´çš„å¼‚å¸¸ã€‚

å½“ä¸€ä¸ªç±»å®ç°äº† `Serializable` æ¥å£åï¼ŒIDE å°±ä¼šæé†’è¯¥ç±»æœ€å¥½äº§ç”Ÿä¸€ä¸ªåºåˆ—åŒ– IDï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/io/Serializbale-7a9a05f6-a65c-46b0-b4d7-8b619297f351.jpg)

1ï¼‰æ·»åŠ ä¸€ä¸ªé»˜è®¤ç‰ˆæœ¬çš„åºåˆ—åŒ– IDï¼š

```java
private static final long serialVersionUID = 1Lã€‚
```

2ï¼‰æ·»åŠ ä¸€ä¸ªéšæœºç”Ÿæˆçš„ä¸é‡å¤çš„åºåˆ—åŒ– IDã€‚

```java
private static final long serialVersionUID = -2095916884810199532L;
```

3ï¼‰æ·»åŠ  `@SuppressWarnings` æ³¨è§£ã€‚

```java
@SuppressWarnings("serial")
```

æ€ä¹ˆé€‰æ‹©å‘¢ï¼Ÿ

é¦–å…ˆï¼Œæˆ‘ä»¬é‡‡ç”¨ç¬¬äºŒç§åŠæ³•ï¼Œåœ¨è¢«åºåˆ—åŒ–ç±»ä¸­æ·»åŠ ä¸€ä¸ªéšæœºç”Ÿæˆçš„åºåˆ—åŒ– IDã€‚

```java
class Wanger implements Serializable {
	private static final long serialVersionUID = -2095916884810199532L;
	
	private String name;
	private int age;

	// å…¶ä»–ä»£ç å¿½ç•¥
}
```

ç„¶åï¼Œåºåˆ—åŒ–ä¸€ä¸ª `Wanger` å¯¹è±¡åˆ°æ–‡ä»¶ä¸­ã€‚

```java
// åˆå§‹åŒ–
Wanger wanger = new Wanger();
wanger.setName("ç‹äºŒ");
wanger.setAge(18);
System.out.println(wanger);

// æŠŠå¯¹è±¡å†™åˆ°æ–‡ä»¶ä¸­
try (ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream("chenmo"));) {
	oos.writeObject(wanger);
} catch (IOException e) {
	e.printStackTrace();
}
```

è¿™æ—¶å€™ï¼Œæˆ‘ä»¬æ‚„æ‚„åœ°æŠŠ `Wanger` ç±»çš„åºåˆ—åŒ– ID å·æ¢æ¢æŸ±ä¸€ä¸‹ï¼Œå˜¿å˜¿ã€‚

```java
// private static final long serialVersionUID = -2095916884810199532L;
private static final long serialVersionUID = -2095916884810199533L;
```

å¥½äº†ï¼Œå‡†å¤‡ååºåˆ—åŒ–å§ã€‚

```java
try (ObjectInputStream ois = new ObjectInputStream(new FileInputStream(new File("chenmo")));) {
	Wanger wanger = (Wanger) ois.readObject();
	System.out.println(wanger);
} catch (IOException | ClassNotFoundException e) {
	e.printStackTrace();
}
```

å“å‘€ï¼Œå‡ºé”™äº†ã€‚

```
java.io.InvalidClassException:  local class incompatible: stream classdesc 
serialVersionUID = -2095916884810199532,
local class serialVersionUID = -2095916884810199533
	at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1521)
	at com.cmower.java_demo.xuliehua1.Test.main(Test.java:27)
```

å¼‚å¸¸å †æ ˆä¿¡æ¯é‡Œé¢å‘Šè¯‰æˆ‘ä»¬ï¼Œä»æŒä¹…åŒ–æ–‡ä»¶é‡Œé¢è¯»å–åˆ°çš„åºåˆ—åŒ– ID å’Œæœ¬åœ°çš„åºåˆ—åŒ– ID ä¸ä¸€è‡´ï¼Œæ— æ³•ååºåˆ—åŒ–ã€‚

é‚£å‡å¦‚æˆ‘ä»¬é‡‡ç”¨ç¬¬ä¸‰ç§æ–¹æ³•ï¼Œä¸º `Wanger` ç±»æ·»åŠ ä¸ª `@SuppressWarnings("serial")` æ³¨è§£å‘¢ï¼Ÿ

```java
@SuppressWarnings("serial")
class Wanger implements Serializable {
// çœç•¥å…¶ä»–ä»£ç 
}
```

å¥½äº†ï¼Œå†æ¥ä¸€æ¬¡ååºåˆ—åŒ–å§ã€‚å¯æƒœä¾ç„¶æŠ¥é”™ã€‚

```
java.io.InvalidClassException:  local class incompatible: stream classdesc 
serialVersionUID = -2095916884810199532, 
local class serialVersionUID = -3818877437117647968
	at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1521)
	at com.cmower.java_demo.xuliehua1.Test.main(Test.java:27)
```

å¼‚å¸¸å †æ ˆä¿¡æ¯é‡Œé¢å‘Šè¯‰æˆ‘ä»¬ï¼Œæœ¬åœ°çš„åºåˆ—åŒ– ID ä¸º -3818877437117647968ï¼Œå’ŒæŒä¹…åŒ–æ–‡ä»¶é‡Œé¢è¯»å–åˆ°çš„åºåˆ—åŒ– ID ä»ç„¶ä¸ä¸€è‡´ï¼Œæ— æ³•ååºåˆ—åŒ–ã€‚è¿™è¯´æ˜ä»€ä¹ˆå‘¢ï¼Ÿä½¿ç”¨ `@SuppressWarnings("serial")` æ³¨è§£æ—¶ï¼Œè¯¥æ³¨è§£ä¼šä¸ºè¢«åºåˆ—åŒ–ç±»è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšæœºçš„åºåˆ—åŒ– IDã€‚

ç”±æ­¤å¯ä»¥è¯æ˜ï¼Œ**Java è™šæ‹Ÿæœºæ˜¯å¦å…è®¸ååºåˆ—åŒ–ï¼Œä¸ä»…å–å†³äºç±»è·¯å¾„å’ŒåŠŸèƒ½ä»£ç æ˜¯å¦ä¸€è‡´ï¼Œè¿˜æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„å› ç´ å°±æ˜¯åºåˆ—åŒ– ID æ˜¯å¦ä¸€è‡´**ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œé‡‡ç”¨é»˜è®¤çš„åºåˆ—åŒ– IDï¼ˆ1Lï¼‰å°±å¯ä»¥ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ä»£ç ä¸€è‡´æ—¶ååºåˆ—åŒ–æˆåŠŸã€‚

```java
class Wanger implements Serializable {
	private static final long serialVersionUID = 1L;
// çœç•¥å…¶ä»–ä»£ç 
}
```

### 06ã€å†æ¥ç‚¹æ€»ç»“

å†™è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œæˆ‘çœŸæ²¡æƒ³åˆ°ï¼šâ€œç©ºç©ºå…¶èº«â€çš„`Serializable` ç«Ÿç„¶æœ‰è¿™ä¹ˆå¤šå¯ä»¥ç ”ç©¶çš„å†…å®¹ï¼

å†™å®Œè¿™ç¯‡æ–‡ç« ä¹‹åï¼Œæˆ‘ä¸ç”±å¾—æƒ³èµ·ç†ç§‘çŠ¶å…ƒæ›¹æ—èè¯´è¯´è¿‡çš„ä¸€å¥è¯ï¼šâ€œåœ¨å­¦ä¹ ä¸­å†å°çš„é—®é¢˜ä¹Ÿä¸æ”¾è¿‡ï¼Œæ¯ä¸ªçŸ¥è¯†ç‚¹éƒ½è¦æ€»ç»“â€â€”â€”è¯´å¾—çœŸçœŸçœŸçœŸçš„å¯¹å•Šï¼

---------

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 7.10 transientå…³é”®å­—

å®³ï¼Œå°äºŒæœ€ç†Ÿçš„æ˜¯ Javaï¼Œä½†å¾ˆå¤š Java åŸºç¡€çŸ¥è¯†éƒ½ä¸çŸ¥é“ï¼Œæ¯”å¦‚ transient å…³é”®å­—ä»¥å‰å°±æ²¡ç”¨åˆ°è¿‡ï¼Œæ‰€ä»¥ä¸çŸ¥é“å®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Œä»Šå¤©å»æ‹›é“¶é¢è¯•çš„æ—¶å€™ï¼Œé¢è¯•å®˜é—®åˆ°äº†è¿™ä¸ªï¼šè¯´è¯´ Java çš„ transient å…³é”®å­—å§ï¼Œç»“æœå°äºŒç›´æ¥æ‡µé€¼äº†ã€‚

ä¸‹é¢æ˜¯ä»–è‡ªå·±é¢è¯•å‡‰äº†ä»¥åå›å»åšçš„æ€»ç»“ï¼Œåˆ†äº«å‡ºæ¥ï¼Œå¤§å®¶ä¸€èµ·æ¶¨ä¸‹å§¿åŠ¿~~~å¥½äº†ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œä¸‹é¢å¼€å§‹ï¼š

### 01ã€transient çš„ä½œç”¨åŠä½¿ç”¨æ–¹æ³•

æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªå¯¹è±¡åªè¦å®ç°äº† [Serilizable æ¥å£](https://tobebetterjavaer.com/io/Serializbale.html)ï¼Œå®ƒå°±å¯ä»¥è¢«[åºåˆ—åŒ–](https://tobebetterjavaer.com/io/serialize.html)ã€‚

åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šé‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼Œä¸€ä¸ªç±»çš„æœ‰äº›å­—æ®µéœ€è¦åºåˆ—åŒ–ï¼Œæœ‰äº›å­—æ®µä¸éœ€è¦ï¼Œæ¯”å¦‚è¯´ç”¨æˆ·çš„ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ã€é“¶è¡Œå¡å·ç­‰ï¼‰ï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œä¸å¸Œæœ›åœ¨ç½‘ç»œæ“ä½œä¸­ä¼ è¾“æˆ–è€…æŒä¹…åŒ–åˆ°ç£ç›˜æ–‡ä»¶ä¸­ï¼Œé‚£è¿™äº›å­—æ®µå°±å¯ä»¥åŠ ä¸Š `transient` å…³é”®å­—ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¢« transient å…³é”®å­—ä¿®é¥°çš„æˆå‘˜å˜é‡åœ¨ååºåˆ—åŒ–æ—¶ä¼šè¢«è‡ªåŠ¨åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ï¼Œä¾‹å¦‚åŸºæœ¬æ•°æ®ç±»å‹ä¸º 0ï¼Œå¼•ç”¨ç±»å‹ä¸º nullã€‚

æ¥çœ‹ç¤ºä¾‹ï¼š

```java
public class TransientTest {
    public static void main(String[] args) {
        
        User user = new User();
        user.setUsername("æ²‰é»˜ç‹äºŒ");
        user.setPasswd("123456");
        
        System.out.println("read before Serializable: ");
        System.out.println("username: " + user.getUsername());
        System.err.println("password: " + user.getPasswd());
        
        try {
            ObjectOutputStream os = new ObjectOutputStream(
                    new FileOutputStream("user.txt"));
            os.writeObject(user); // å°†Userå¯¹è±¡å†™è¿›æ–‡ä»¶
            os.flush();
            os.close();
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        }
        try {
            ObjectInputStream is = new ObjectInputStream(new FileInputStream(
                    "user.txt"));
            user = (User) is.readObject(); // ä»æµä¸­è¯»å–Userçš„æ•°æ®
            is.close();
            
            System.out.println("\nread after Serializable: ");
            System.out.println("username: " + user.getUsername());
            System.err.println("password: " + user.getPasswd());
            
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        }
    }
}

class User implements Serializable {
    private static final long serialVersionUID = 8294180014912103005L;  
    
    private String username;
    private transient String passwd;
    
    public String getUsername() {
        return username;
    }
    
    public void setUsername(String username) {
        this.username = username;
    }
    
    public String getPasswd() {
        return passwd;
    }
    
    public void setPasswd(String passwd) {
        this.passwd = passwd;
    }

}
```

è¾“å‡ºä¸ºï¼š

```
read before Serializable:
username: æ²‰é»˜ç‹äºŒ
password: 123456 
read after Serializable:
username: æ²‰é»˜ç‹äºŒ
password: null
```

å¯†ç å­—æ®µä¸º nullï¼Œè¯´æ˜ååºåˆ—åŒ–æ—¶æ ¹æœ¬æ²¡æœ‰ä»æ–‡ä»¶ä¸­è·å–åˆ°ä¿¡æ¯ã€‚

### 02ã€transient ä½¿ç”¨å°ç»“

1ï¼‰ä¸€æ—¦å­—æ®µè¢« transient ä¿®é¥°ï¼Œæˆå‘˜å˜é‡å°†ä¸å†æ˜¯å¯¹è±¡æŒä¹…åŒ–çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥å˜é‡çš„å€¼åœ¨åºåˆ—åŒ–åæ— æ³•è®¿é—®ã€‚

2ï¼‰transient å…³é”®å­—åªèƒ½ä¿®é¥°å­—æ®µï¼Œè€Œä¸èƒ½ä¿®é¥°æ–¹æ³•å’Œç±»ã€‚

3ï¼‰è¢« transient å…³é”®å­—ä¿®é¥°çš„å­—æ®µä¸èƒ½è¢«åºåˆ—åŒ–ï¼Œä¸€ä¸ªé™æ€å˜é‡ï¼ˆ[staticå…³é”®å­—](https://tobebetterjavaer.com/oo/static.html)ä¿®é¥°ï¼‰ä¸ç®¡æ˜¯å¦è¢« transient ä¿®é¥°ï¼Œå‡ä¸èƒ½è¢«åºåˆ—åŒ–ï¼Œ[å‰é¢è®²åˆ°è¿‡](https://tobebetterjavaer.com/io/Serializbale.html)ã€‚

æ¥çœ‹ç¤ºä¾‹ï¼š

```java
public class TransientTest {
    public static void main(String[] args) {
        
        User user = new User();
        user.setUsername("æ²‰é»˜ç‹äºŒ");
        user.setPasswd("123456");
        
        System.out.println("read before Serializable: ");
        System.out.println("username: " + user.getUsername());
        System.err.println("password: " + user.getPasswd());
        
        try {
            ObjectOutputStream os = new ObjectOutputStream(
                    new FileOutputStream("user.txt"));
            os.writeObject(user); // å°†Userå¯¹è±¡å†™è¿›æ–‡ä»¶
            os.flush();
            os.close();
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        }
        try {
            // åœ¨ååºåˆ—åŒ–ä¹‹å‰æ”¹å˜usernameçš„å€¼
            User.username = "æ²‰é»˜ç‹ä¸‰";
            
            ObjectInputStream is = new ObjectInputStream(new FileInputStream(
                    "user.txt"));
            user = (User) is.readObject(); // ä»æµä¸­è¯»å–Userçš„æ•°æ®
            is.close();
            
            System.out.println("\nread after Serializable: ");
            System.out.println("username: " + user.getUsername());
            System.err.println("password: " + user.getPasswd());
            
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        }
    }
}

class User implements Serializable {
    private static final long serialVersionUID = 8294180014912103005L;  
    
    public static String username;
    private transient String passwd;
    
    public String getUsername() {
        return username;
    }
    
    public void setUsername(String username) {
        this.username = username;
    }
    
    public String getPasswd() {
        return passwd;
    }
    
    public void setPasswd(String passwd) {
        this.passwd = passwd;
    }
}
```

è¿è¡Œç»“æœä¸ºï¼š

```
read before Serializable:
username: æ²‰é»˜ç‹äºŒ
password: 123456 
read after Serializable:
username: æ²‰é»˜ç‹ä¸‰
password: null
```

åºåˆ—åŒ–å‰ï¼Œstatic ä¿®é¥°çš„ username ä¸º æ²‰é»˜ç‹äºŒï¼Œç„¶åæˆ‘ä»¬åœ¨ååºåˆ—åŒ–å‰å°†å…¶ä¿®æ”¹ä¸º æ²‰é»˜ç‹ä¸‰ äº†ï¼Œå¦‚æœè¯´ static ä¿®é¥°çš„å­—æ®µèƒ½ä¿æŒçŠ¶æ€çš„è¯ï¼Œååºåˆ—åŒ–ååº”è¯¥æ˜¯ æ²‰é»˜ç‹äºŒï¼Œå¯¹å§ï¼Ÿ

ä½†ç»“æœæ˜¯ æ²‰é»˜ç‹ä¸‰ï¼Œè¿™å°±è¯æ˜äº†æˆ‘ä»¬ä¹‹å‰çš„ç»“è®ºï¼š**static ä¿®é¥°çš„å­—æ®µä¸èƒ½è¢«åºåˆ—åŒ–**ã€‚

### 03ã€transient ä¿®é¥°çš„å­—æ®µçœŸçš„ä¸èƒ½è¢«åºåˆ—åŒ–ï¼Ÿ

æ€è€ƒä¸‹é¢çš„ä¾‹å­ï¼š

```java
public class ExternalizableTest implements Externalizable {
    private transient String content = "æ˜¯çš„ï¼Œæˆ‘å°†ä¼šè¢«åºåˆ—åŒ–ï¼Œä¸ç®¡æˆ‘æ˜¯å¦è¢«transientå…³é”®å­—ä¿®é¥°";

    @Override
    public void writeExternal(ObjectOutput out) throws IOException {
        out.writeObject(content);
    }

    @Override
    public void readExternal(ObjectInput in) throws IOException,
            ClassNotFoundException {
        content = (String) in.readObject();
    }

    public static void main(String[] args) throws Exception {
        
        ExternalizableTest et = new ExternalizableTest();
        ObjectOutput out = new ObjectOutputStream(new FileOutputStream(
                new File("test")));
        out.writeObject(et);

        ObjectInput in = new ObjectInputStream(new FileInputStream(new File(
                "test")));
        et = (ExternalizableTest) in.readObject();
        System.out.println(et.content);

        out.close();
        in.close();
    }
}
```

æ¥çœ‹ä¸‹è¾“å‡ºç»“æœï¼š

```
æ˜¯çš„ï¼Œæˆ‘å°†ä¼šè¢«åºåˆ—åŒ–ï¼Œä¸ç®¡æˆ‘æ˜¯å¦è¢«transientå…³é”®å­—ä¿®é¥°
```

è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿä¸æ˜¯è¯´ transient å…³é”®å­—ä¿®é¥°çš„å­—æ®µä¸èƒ½åºåˆ—åŒ–å—ï¼Ÿ

æˆ‘å…ˆè¯´ç»“è®ºï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº† Externalizable æ¥å£è€Œä¸æ˜¯ Serializableæ¥å£ï¼Œè¿™ä¸ª[çŸ¥è¯†ç‚¹æˆ‘ä»¬å‰é¢å…¶å®ä¹Ÿè®²åˆ°è¿‡](https://tobebetterjavaer.com/io/Serializbale.html)ã€‚

åœ¨ Java ä¸­ï¼Œå¯¹è±¡çš„åºåˆ—åŒ–å¯ä»¥é€šè¿‡å®ç°ä¸¤ç§æ¥å£æ¥å®ç°ï¼Œå¦‚æœå®ç°çš„æ˜¯ Serializable æ¥å£ï¼Œåˆ™æ‰€æœ‰çš„åºåˆ—åŒ–å°†ä¼šè‡ªåŠ¨è¿›è¡Œï¼Œå¦‚æœå®ç°çš„æ˜¯ Externalizable æ¥å£ï¼Œåˆ™éœ€è¦åœ¨ writeExternal æ–¹æ³•ä¸­æŒ‡å®šè¦åºåˆ—åŒ–çš„å­—æ®µï¼Œä¸ transient å…³é”®å­—ä¿®é¥°æ— å…³ã€‚

å› æ­¤ä¾‹å­è¾“å‡ºçš„æ˜¯å˜é‡ content çš„å†…å®¹ï¼Œè€Œä¸æ˜¯ nullã€‚

### 04ã€å°ç»“

transient å…³é”®å­—ç”¨äºä¿®é¥°ç±»çš„æˆå‘˜å˜é‡ï¼Œåœ¨åºåˆ—åŒ–å¯¹è±¡æ—¶ï¼Œè¢«ä¿®é¥°çš„æˆå‘˜å˜é‡ä¸ä¼šè¢«åºåˆ—åŒ–å’Œä¿å­˜åˆ°æ–‡ä»¶ä¸­ã€‚å…¶ä½œç”¨æ˜¯å‘Šè¯‰ JVM åœ¨åºåˆ—åŒ–å¯¹è±¡æ—¶ä¸éœ€è¦å°†è¯¥å˜é‡çš„å€¼æŒä¹…åŒ–ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸€äº›å®‰å…¨æˆ–è€…æ€§èƒ½é—®é¢˜ã€‚ä½†æ˜¯ï¼Œtransient ä¿®é¥°çš„æˆå‘˜å˜é‡åœ¨ååºåˆ—åŒ–æ—¶ä¼šè¢«åˆå§‹åŒ–ä¸ºå…¶é»˜è®¤å€¼ï¼ˆå¦‚ int ç±»å‹ä¼šè¢«åˆå§‹åŒ–ä¸º 0ï¼Œå¼•ç”¨ç±»å‹ä¼šè¢«åˆå§‹åŒ–ä¸º nullï¼‰ï¼Œå› æ­¤éœ€è¦åœ¨ç¨‹åºä¸­è¿›è¡Œé€‚å½“çš„å¤„ç†ã€‚

transient å…³é”®å­—å’Œ static å…³é”®å­—éƒ½å¯ä»¥ç”¨æ¥ä¿®é¥°ç±»çš„æˆå‘˜å˜é‡ã€‚å…¶ä¸­ï¼Œtransient å…³é”®å­—è¡¨ç¤ºè¯¥æˆå‘˜å˜é‡ä¸å‚ä¸åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œè€Œ static å…³é”®å­—è¡¨ç¤ºè¯¥æˆå‘˜å˜é‡æ˜¯å±äºç±»çš„ï¼Œä¸å±äºå¯¹è±¡çš„ï¼Œå› æ­¤ä¸éœ€è¦åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚

åœ¨ Serializable å’Œ Externalizable æ¥å£ä¸­ï¼Œtransient å…³é”®å­—çš„è¡¨ç°ä¹Ÿä¸åŒï¼Œåœ¨ Serializable ä¸­è¡¨ç¤ºè¯¥æˆå‘˜å˜é‡ä¸å‚ä¸åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œåœ¨ Externalizable ä¸­ä¸èµ·ä½œç”¨ï¼Œå› ä¸º Externalizable æ¥å£éœ€è¦å®ç° readExternal å’Œ writeExternal æ–¹æ³•ï¼Œéœ€è¦æ‰‹åŠ¨å®Œæˆåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚

---------

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

# ç¬¬å…«ç« ï¼šå¼‚å¸¸å¤„ç†




## 8.1 Javaå¼‚å¸¸å¤„ç†å…¨é¢è§£æ

### 01ã€ä»€ä¹ˆæ˜¯å¼‚å¸¸

â€œäºŒå“¥ï¼Œä»Šå¤©å°±è¦å­¦ä¹ å¼‚å¸¸äº†å—ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œæ˜¯çš„ã€‚åªæœ‰æ­£ç¡®åœ°å¤„ç†å¥½å¼‚å¸¸ï¼Œæ‰èƒ½ä¿è¯ç¨‹åºçš„å¯é æ€§ï¼Œæ‰€ä»¥å¼‚å¸¸çš„å­¦ä¹ è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚â€æˆ‘è¯´ã€‚

â€œé‚£åˆ°åº•ä»€ä¹ˆæ˜¯å¼‚å¸¸å‘¢ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œå¼‚å¸¸æ˜¯æŒ‡ä¸­æ–­ç¨‹åºæ­£å¸¸æ‰§è¡Œçš„ä¸€ä¸ªä¸ç¡®å®šçš„äº‹ä»¶ã€‚å½“å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œç¨‹åºçš„æ­£å¸¸æ‰§è¡Œæµç¨‹å°±ä¼šè¢«æ‰“æ–­ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç¨‹åºéƒ½ä¼šæœ‰å¾ˆå¤šæ¡è¯­å¥ï¼Œå¦‚æœæ²¡æœ‰å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œå‰é¢çš„è¯­å¥ä¸€æ—¦å‡ºç°äº†å¼‚å¸¸ï¼Œåé¢çš„è¯­å¥å°±æ²¡åŠæ³•ç»§ç»­æ‰§è¡Œäº†ã€‚â€

â€œæœ‰äº†å¼‚å¸¸å¤„ç†æœºåˆ¶åï¼Œç¨‹åºåœ¨å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™å°±ä¸ä¼šä¸­æ–­ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å¼‚å¸¸è¿›è¡Œæ•è·ï¼Œç„¶åæ”¹å˜ç¨‹åºæ‰§è¡Œçš„æµç¨‹ã€‚â€

â€œé™¤æ­¤ä¹‹å¤–ï¼Œå¼‚å¸¸å¤„ç†æœºåˆ¶å¯ä»¥ä¿è¯æˆ‘ä»¬å‘ç”¨æˆ·æä¾›å‹å¥½çš„æç¤ºä¿¡æ¯ï¼Œè€Œä¸æ˜¯ç¨‹åºåŸç”Ÿçš„å¼‚å¸¸ä¿¡æ¯â€”â€”ç”¨æˆ·æ ¹æœ¬ç†è§£ä¸äº†ã€‚â€

â€œä¸è¿‡ï¼Œç«™åœ¨å¼€å‘è€…çš„è§’åº¦ï¼Œæˆ‘ä»¬æ›´å¸Œæœ›çœ‹åˆ°åŸç”Ÿçš„å¼‚å¸¸ä¿¡æ¯ï¼Œå› ä¸ºè¿™æœ‰åŠ©äºæˆ‘ä»¬æ›´å¿«åœ°æ‰¾åˆ° bug çš„æ ¹æºï¼Œåè€Œè¢«è¿‡åº¦åŒ…è£…çš„å¼‚å¸¸ä¿¡æ¯ä¼šå¹²æ‰°æˆ‘ä»¬çš„è§†çº¿ã€‚â€

â€œJava è¯­è¨€åœ¨ä¸€å¼€å§‹å°±æä¾›äº†ç›¸å¯¹å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œè¿™ç§æœºåˆ¶å¤§å¤§é™ä½äº†ç¼–å†™å¯é ç¨‹åºçš„é—¨æ§›ï¼Œè¿™ä¹Ÿæ˜¯ Java ä¹‹æ‰€ä»¥èƒ½å¤Ÿæµè¡Œçš„åŸå› ä¹‹ä¸€ã€‚â€

â€œé‚£å¯¼è‡´ç¨‹åºæŠ›å‡ºå¼‚å¸¸çš„åŸå› æœ‰å“ªäº›å‘¢ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

æ¯”å¦‚è¯´ï¼š

- ç¨‹åºåœ¨è¯•å›¾æ‰“å¼€ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ï¼›
- ç¨‹åºé‡åˆ°äº†ç½‘ç»œè¿æ¥é—®é¢˜ï¼›
- ç”¨æˆ·è¾“å…¥äº†ç³Ÿç³•çš„æ•°æ®ï¼›
- ç¨‹åºåœ¨å¤„ç†ç®—æœ¯é—®é¢˜æ—¶æ²¡æœ‰è€ƒè™‘é™¤æ•°ä¸º 0 çš„æƒ…å†µï¼›

ç­‰ç­‰ç­‰ç­‰ã€‚

æŒ‘ä¸ªæœ€ç®€å•çš„åŸå› æ¥è¯´å§ã€‚

```java
public class Demo {
    public static void main(String[] args) {
        System.out.println(10/0);
    }
}
```

è¿™æ®µä»£ç åœ¨è¿è¡Œçš„æ—¶å€™æŠ›å‡ºçš„å¼‚å¸¸ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºï¼š

```
Exception in thread "main" java.lang.ArithmeticException: / by zero
	at com.itwanger.s41.Demo.main(Demo.java:8)
```

â€œä½ çœ‹ï¼Œä¸‰å¦¹ï¼Œè¿™ä¸ªåŸç”Ÿçš„å¼‚å¸¸ä¿¡æ¯å¯¹ç”¨æˆ·æ¥è¯´ï¼Œæ˜¾ç„¶æ˜¯ä¸å¤ªå®¹æ˜“ç†è§£çš„ï¼Œä½†å¯¹äºæˆ‘ä»¬å¼€å‘è€…æ¥è¯´ï¼Œç®€ç›´ä¸è¦å¤ªç›´ç™½äº†â€”â€”å¾ˆå®¹æ˜“å°±èƒ½å®šä½åˆ°å¼‚å¸¸å‘ç”Ÿçš„æ ¹æºã€‚â€

### 02ã€Exceptionå’ŒErrorçš„åŒºåˆ«

â€œå“¦ï¼Œæˆ‘çŸ¥é“äº†ã€‚ä¸‹ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ç»å¸¸çœ‹åˆ°ä¸€äº›æ–‡ç« é‡Œæåˆ° Exception å’Œ Errorï¼ŒäºŒå“¥ä½ èƒ½å¸®æˆ‘è§£é‡Šä¸€ä¸‹å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«å—ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œè¿™æ˜¯ä¸€ä¸ªå¥½é—®é¢˜å‘€ï¼Œä¸‰å¦¹ï¼â€

ä»å•è¯çš„é‡Šä¹‰ä¸Šæ¥çœ‹ï¼Œerror ä¸ºé”™è¯¯ï¼Œexception ä¸ºå¼‚å¸¸ï¼Œé”™è¯¯çš„ç­‰çº§æ˜æ˜¾æ¯”å¼‚å¸¸è¦é«˜ä¸€äº›ã€‚

ä»ç¨‹åºçš„è§’åº¦æ¥çœ‹ï¼Œä¹Ÿçš„ç¡®å¦‚æ­¤ã€‚

Error çš„å‡ºç°ï¼Œæ„å‘³ç€ç¨‹åºå‡ºç°äº†ä¸¥é‡çš„é—®é¢˜ï¼Œè€Œè¿™äº›é—®é¢˜ä¸åº”è¯¥å†äº¤ç»™ Java çš„å¼‚å¸¸å¤„ç†æœºåˆ¶æ¥å¤„ç†ï¼Œç¨‹åºåº”è¯¥ç›´æ¥å´©æºƒæ‰ï¼Œæ¯”å¦‚è¯´ OutOfMemoryErrorï¼Œå†…å­˜æº¢å‡ºäº†ï¼Œè¿™å°±æ„å‘³ç€ç¨‹åºåœ¨è¿è¡Œæ—¶ç”³è¯·çš„å†…å­˜å¤§äºç³»ç»Ÿèƒ½å¤Ÿæä¾›çš„å†…å­˜ï¼Œå¯¼è‡´å‡ºç°çš„é”™è¯¯ï¼Œè¿™ç§é”™è¯¯çš„å‡ºç°ï¼Œå¯¹äºç¨‹åºæ¥è¯´æ˜¯è‡´å‘½çš„ã€‚

Exception çš„å‡ºç°ï¼Œæ„å‘³ç€ç¨‹åºå‡ºç°äº†ä¸€äº›åœ¨å¯æ§èŒƒå›´å†…çš„é—®é¢˜ï¼Œæˆ‘ä»¬åº”å½“é‡‡å–æªæ–½è¿›è¡ŒæŒ½æ•‘ã€‚

æ¯”å¦‚è¯´ä¹‹å‰æåˆ°çš„ ArithmeticExceptionï¼Œå¾ˆæ˜æ˜¾æ˜¯å› ä¸ºé™¤æ•°å‡ºç°äº† 0 çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æ•è·å¼‚å¸¸ï¼Œç„¶åæç¤ºç”¨æˆ·ä¸åº”è¯¥è¿›è¡Œé™¤ 0 æ“ä½œï¼Œå½“ç„¶äº†ï¼Œæ›´å¥½çš„åšæ³•æ˜¯ç›´æ¥å¯¹é™¤æ•°è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ˜¯ 0 å°±ä¸è¿›è¡Œé™¤æ³•è¿ç®—ï¼Œè€Œæ˜¯å‘Šè¯‰ç”¨æˆ·æ¢ä¸€ä¸ªé 0 çš„æ•°è¿›è¡Œè¿ç®—ã€‚

### 03ã€checkedå’Œuncheckedå¼‚å¸¸

â€œä¸‰å¦¹ï¼Œè¿˜èƒ½æƒ³åˆ°å…¶ä»–çš„é—®é¢˜å—ï¼Ÿâ€

â€œå—¯ï¼Œä¸ç”¨æƒ³ï¼ŒäºŒå“¥ï¼Œæˆ‘å·²ç»æå‰åšå¥½é¢„ä¹ å·¥ä½œäº†ã€‚â€ä¸‰å¦¹è‡ªä¿¡åœ°è¯´ï¼Œâ€œå¼‚å¸¸åˆå¯ä»¥åˆ†ä¸º checked å’Œ uncheckedï¼Œå®ƒä»¬ä¹‹é—´åˆæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿâ€

â€œå“‡ï¼Œä¸‰å¦¹ï¼Œæœç„¶åˆæ˜¯ä¸€ä¸ªå¥½é—®é¢˜å‘¢ã€‚â€

checked å¼‚å¸¸ï¼ˆæ£€æŸ¥å‹å¼‚å¸¸ï¼‰åœ¨æºä»£ç é‡Œå¿…é¡»æ˜¾å¼åœ°æ•è·æˆ–è€…æŠ›å‡ºï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæç¤ºä½ è¿›è¡Œç›¸åº”çš„æ“ä½œï¼›è€Œ unchecked å¼‚å¸¸ï¼ˆéæ£€æŸ¥å‹å¼‚å¸¸ï¼‰å°±æ˜¯æ‰€è°“çš„è¿è¡Œæ—¶å¼‚å¸¸ï¼Œé€šå¸¸æ˜¯å¯ä»¥é€šè¿‡ç¼–ç è¿›è¡Œè§„é¿çš„ï¼Œå¹¶ä¸éœ€è¦æ˜¾å¼åœ°æ•è·æˆ–è€…æŠ›å‡ºã€‚

â€œæˆ‘å…ˆç”»ä¸€å¹…æ€ç»´å¯¼å›¾ç»™ä½ æ„Ÿå—ä¸€ä¸‹ã€‚â€

![](https://cdn.tobebetterjavaer.com/studymore/gailan-20230326090207.png)

é¦–å…ˆï¼ŒException å’Œ Error éƒ½ç»§æ‰¿äº† Throwable ç±»ã€‚æ¢å¥è¯è¯´ï¼Œåªæœ‰ Throwable ç±»ï¼ˆæˆ–è€…å­ç±»ï¼‰çš„å¯¹è±¡æ‰èƒ½ä½¿ç”¨ throw å…³é”®å­—æŠ›å‡ºï¼Œæˆ–è€…ä½œä¸º catch çš„å‚æ•°ç±»å‹ã€‚

é¢è¯•ä¸­ç»å¸¸é—®åˆ°çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼ŒNoClassDefFoundError å’Œ ClassNotFoundException æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

â€œä¸‰å¦¹ä½ çŸ¥é“å—ï¼Ÿâ€

â€œä¸çŸ¥é“ï¼ŒäºŒå“¥ï¼Œä½ è§£é‡Šä¸‹å‘—ã€‚â€

å®ƒä»¬éƒ½æ˜¯ç”±äºç³»ç»Ÿè¿è¡Œæ—¶æ‰¾ä¸åˆ°è¦åŠ è½½çš„ç±»å¯¼è‡´çš„ï¼Œä½†æ˜¯è§¦å‘çš„åŸå› ä¸ä¸€æ ·ã€‚

- NoClassDefFoundErrorï¼šç¨‹åºåœ¨ç¼–è¯‘æ—¶å¯ä»¥æ‰¾åˆ°æ‰€ä¾èµ–çš„ç±»ï¼Œä½†æ˜¯åœ¨è¿è¡Œæ—¶æ‰¾ä¸åˆ°æŒ‡å®šçš„ç±»æ–‡ä»¶ï¼Œå¯¼è‡´æŠ›å‡ºè¯¥é”™è¯¯ï¼›åŸå› å¯èƒ½æ˜¯ jar åŒ…ç¼ºå¤±æˆ–è€…è°ƒç”¨äº†åˆå§‹åŒ–å¤±è´¥çš„ç±»ã€‚
- ClassNotFoundExceptionï¼šå½“åŠ¨æ€åŠ è½½ Class å¯¹è±¡çš„æ—¶å€™æ‰¾ä¸åˆ°å¯¹åº”çš„ç±»æ—¶æŠ›å‡ºè¯¥å¼‚å¸¸ï¼›åŸå› å¯èƒ½æ˜¯è¦åŠ è½½çš„ç±»ä¸å­˜åœ¨æˆ–è€…ç±»åå†™é”™äº†ã€‚


å…¶æ¬¡ï¼Œåƒ IOExceptionã€ClassNotFoundExceptionã€SQLException éƒ½å±äº checked å¼‚å¸¸ï¼›åƒ RuntimeException ä»¥åŠå­ç±» ArithmeticExceptionã€ClassCastExceptionã€ArrayIndexOutOfBoundsExceptionã€NullPointerExceptionï¼Œéƒ½å±äº unchecked å¼‚å¸¸ã€‚

unchecked å¼‚å¸¸å¯ä»¥ä¸åœ¨ç¨‹åºä¸­æ˜¾ç¤ºå¤„ç†ï¼Œå°±åƒä¹‹å‰æåˆ°çš„ ArithmeticException å°±æ˜¯çš„ï¼›ä½† checked å¼‚å¸¸å¿…é¡»æ˜¾å¼å¤„ç†ã€‚

æ¯”å¦‚è¯´ä¸‹é¢è¿™è¡Œä»£ç ï¼š

```java
Class clz = Class.forName("com.itwanger.s41.Demo1");
```

å¦‚æœæ²¡åšå¤„ç†ï¼Œæ¯”å¦‚è¯´åœ¨ Intellij IDEA ç¯å¢ƒä¸‹ï¼Œå°±ä¼šæç¤ºä½ è¿™è¡Œä»£ç å¯èƒ½ä¼šæŠ›å‡º `java.lang.ClassNotFoundException`ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/exception/gailan-02.png)

å»ºè®®ä½ è¦ä¹ˆä½¿ç”¨ try-catch è¿›è¡Œæ•è·ï¼š

```java
try {
    Class clz = Class.forName("com.itwanger.s41.Demo1");
} catch (ClassNotFoundException e) {
    e.printStackTrace();
}
```

æ³¨æ„æ‰“å°å¼‚å¸¸å †æ ˆä¿¡æ¯çš„ `printStackTrace()` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šå°†å¼‚å¸¸çš„å †æ ˆä¿¡æ¯æ‰“å°åˆ°æ ‡å‡†çš„æ§åˆ¶å°ä¸‹ï¼Œå¦‚æœæ˜¯æµ‹è¯•ç¯å¢ƒï¼Œè¿™æ ·çš„å†™æ³•è¿˜ OKï¼Œå¦‚æœæ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œè¿™æ ·çš„å†™æ³•æ˜¯ä¸å¯å–çš„ï¼Œå¿…é¡»ä½¿ç”¨æ—¥å¿—æ¡†æ¶æŠŠå¼‚å¸¸çš„å †æ ˆä¿¡æ¯è¾“å‡ºåˆ°æ—¥å¿—ç³»ç»Ÿä¸­ï¼Œå¦åˆ™å¯èƒ½æ²¡åŠæ³•è·Ÿè¸ªã€‚

è¦ä¹ˆåœ¨æ–¹æ³•ç­¾åä¸Šä½¿ç”¨ throws å…³é”®å­—æŠ›å‡ºï¼š

```java
public class Demo1 {
    public static void main(String[] args) throws ClassNotFoundException {
        Class clz = Class.forName("com.itwanger.s41.Demo1");
    }
}
```

è¿™æ ·åšçš„å¥½å¤„æ˜¯ä¸éœ€è¦å¯¹å¼‚å¸¸è¿›è¡Œæ•è·å¤„ç†ï¼Œåªéœ€è¦äº¤ç»™ Java è™šæ‹Ÿæœºæ¥å¤„ç†å³å¯ï¼›åå¤„å°±æ˜¯æ²¡æ³•é’ˆå¯¹è¿™ç§æƒ…å†µåšç›¸åº”çš„å¤„ç†ã€‚

â€œäºŒå“¥ï¼Œé’ˆå¯¹ checked å¼‚å¸¸ï¼Œæˆ‘åœ¨çŸ¥ä¹ä¸Šçœ‹åˆ°ä¸€ä¸ªå¸–å­ï¼Œè¯´ Java ä¸­çš„ checked å¾ˆæ²¡æœ‰å¿…è¦ï¼Œè¿™ç§å¼‚å¸¸åœ¨ç¼–è¯‘æœŸè¦ä¹ˆ try-catchï¼Œè¦ä¹ˆ throwsï¼Œä½†åˆä¸ä¸€å®šä¼šå‡ºç°å¼‚å¸¸ï¼Œä½ è§‰å¾—è¿™æ ·çš„è®¾è®¡æœ‰æ„ä¹‰å—ï¼Ÿâ€ä¸‰å¦¹æå‡ºäº†ä¸€ä¸ªå¾ˆå°–é”çš„é—®é¢˜ã€‚

â€œå“‡ï¼Œè¿™ç§é—®é¢˜é—®çš„å¥½ã€‚â€æˆ‘ä¸ç”±å¾—å¯¹ä¸‰å¦¹å¿ƒç”Ÿæ•¬ä½©ã€‚

â€œçš„ç¡®ï¼Œchecked å¼‚å¸¸åœ¨ä¸šç•Œæ˜¯æœ‰äº‰è®ºçš„ï¼Œå®ƒå‡è®¾æˆ‘ä»¬æ•è·äº†å¼‚å¸¸ï¼Œå¹¶ä¸”é’ˆå¯¹è¿™ç§æƒ…å†µä½œäº†ç›¸åº”çš„å¤„ç†ï¼Œä½†æœ‰äº›æ—¶å€™ï¼Œæ ¹æœ¬å°±æ²¡æ³•å¤„ç†ã€‚â€æˆ‘è¯´ï¼Œâ€œå°±æ‹¿ä¸Šé¢æåˆ°çš„ ClassNotFoundException å¼‚å¸¸æ¥è¯´ï¼Œæˆ‘ä»¬å‡è®¾å¯¹å…¶è¿›è¡Œäº† try-catchï¼Œå¯çœŸçš„å‡ºç°äº† ClassNotFoundException å¼‚å¸¸åï¼Œæˆ‘ä»¬ä¹Ÿæ²¡å¤šå°‘çš„å¯æ“ä½œæ€§ï¼Œå† `Class.forName()` ä¸€æ¬¡ï¼Ÿâ€

å¦å¤–ï¼Œchecked å¼‚å¸¸ä¹Ÿä¸å…¼å®¹å‡½æ•°å¼ç¼–ç¨‹ï¼Œåé¢å¦‚æœä½ å†™ Lambda/Stream ä»£ç çš„æ—¶å€™ï¼Œå°±ä¼šä½“éªŒåˆ°è¿™ç§è‹¦æ¶©ã€‚

å½“ç„¶äº†ï¼Œchecked å¼‚å¸¸å¹¶ä¸æ˜¯ä¸€æ— æ˜¯å¤„ï¼Œå°¤å…¶æ˜¯åœ¨é‡åˆ° IO æˆ–è€…ç½‘ç»œå¼‚å¸¸çš„æ—¶å€™ï¼Œæ¯”å¦‚è¯´è¿›è¡Œ Socket é“¾æ¥ï¼Œæˆ‘å¤§è‡´å†™äº†ä¸€æ®µï¼š

```java
public class Demo2 {
    private String mHost;
    private int mPort;
    private Socket mSocket;
    private final Object mLock = new Object();

    public void run() {
    }

    private void initSocket() {
        while (true) {
            try {
                Socket socket = new Socket(mHost, mPort);
                synchronized (mLock) {
                    mSocket = socket;
                }
                break;
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }
}
```

å½“å‘ç”Ÿ IOException çš„æ—¶å€™ï¼Œsocket å°±é‡æ–°å°è¯•è¿æ¥ï¼Œå¦åˆ™å°± break è·³å‡ºå¾ªç¯ã€‚æ„å‘³ç€å¦‚æœ IOException ä¸æ˜¯ checked å¼‚å¸¸ï¼Œè¿™ç§å†™æ³•å°±ç•¥æ˜¾çªå…€ï¼Œå› ä¸º IOException æ²¡åŠæ³•åƒ ArithmeticException é‚£æ ·ç”¨ä¸€ä¸ª if è¯­å¥åˆ¤æ–­é™¤æ•°æ˜¯å¦ä¸º 0 å»è§„é¿ã€‚

æˆ–è€…è¯´ï¼Œå¼ºåˆ¶æ€§çš„ checked å¼‚å¸¸å¯ä»¥è®©æˆ‘ä»¬åœ¨ç¼–ç¨‹çš„æ—¶å€™å»æ€è€ƒï¼Œé‡åˆ°è¿™ç§å¼‚å¸¸çš„æ—¶å€™è¯¥æ€ä¹ˆæ›´ä¼˜é›…çš„å»å¤„ç†ã€‚æ˜¾ç„¶ï¼ŒSocket ç¼–ç¨‹ä¸­ï¼Œè‚¯å®šæ˜¯ä¼šé‡åˆ° IOException çš„ï¼Œå‡å¦‚ IOException æ˜¯éæ£€æŸ¥å‹å¼‚å¸¸ï¼Œå°±æ„å‘³ç€å¼€å‘è€…ä¹Ÿå¯ä»¥ä¸è€ƒè™‘ï¼Œç›´æ¥è·³è¿‡ï¼Œäº¤ç»™ Java è™šæ‹Ÿæœºæ¥å¤„ç†ï¼Œä½†æˆ‘è§‰å¾—è¿™æ ·åšè‚¯å®šæ›´ä¸åˆé€‚ã€‚

### 04ã€å…³äº throw å’Œ throws

â€œäºŒå“¥ï¼Œä½ èƒ½å‘Šè¯‰æˆ‘ throw å’Œ throws ä¸¤ä¸ªå…³é”®å­—çš„åŒºåˆ«å—ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œthrow å…³é”®å­—ï¼Œç”¨äºä¸»åŠ¨åœ°æŠ›å‡ºå¼‚å¸¸ï¼›æ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“é™¤æ•°ä¸º 0 çš„æ—¶å€™ï¼Œç¨‹åºä¼šä¸»åŠ¨æŠ›å‡º ArithmeticExceptionï¼›ä½†å¦‚æœæˆ‘ä»¬æƒ³è¦é™¤æ•°ä¸º 1 çš„æ—¶å€™ä¹ŸæŠ›å‡º ArithmeticExceptionï¼Œå°±å¯ä»¥ä½¿ç”¨ throw å…³é”®å­—ä¸»åŠ¨åœ°æŠ›å‡ºå¼‚å¸¸ã€‚â€æˆ‘è¯´ã€‚

```java
throw new exception_class("error message");
```

è¯­æ³•ä¹Ÿéå¸¸ç®€å•ï¼Œthrow å…³é”®å­—åè·Ÿä¸Š new å…³é”®å­—ï¼Œä»¥åŠå¼‚å¸¸çš„ç±»å‹è¿˜æœ‰å‚æ•°å³å¯ã€‚

ä¸¾ä¸ªä¾‹å­ã€‚

```java
public class ThrowDemo {
    static void checkEligibilty(int stuage){
        if(stuage<18) {
            throw new ArithmeticException("å¹´çºªæœªæ»¡ 18 å²ï¼Œç¦æ­¢è§‚å½±");
        } else {
            System.out.println("è¯·è®¤çœŸè§‚å½±!!");
        }
    }

    public static void main(String args[]){
        checkEligibilty(10);
        System.out.println("æ„‰å¿«åœ°å‘¨æœ«..");
    }
}
```

è¿™æ®µä»£ç åœ¨è¿è¡Œçš„æ—¶å€™å°±ä¼šæŠ›å‡ºä»¥ä¸‹é”™è¯¯ï¼š

```
Exception in thread "main" java.lang.ArithmeticException: å¹´çºªæœªæ»¡ 18 å²ï¼Œç¦æ­¢è§‚å½±
    at com.itwanger.s43.ThrowDemo.checkEligibilty(ThrowDemo.java:9)
    at com.itwanger.s43.ThrowDemo.main(ThrowDemo.java:16)
```

â€œthrows å…³é”®å­—çš„ä½œç”¨å°±å’Œ throw å®Œå…¨ä¸åŒã€‚â€æˆ‘è¯´ï¼Œâ€œå‰é¢çš„å°èŠ‚é‡Œå·²ç»è®²äº† checked exception å’Œ unchecked exceptionï¼Œä¹Ÿå°±æ˜¯æ£€æŸ¥å‹å¼‚å¸¸å’Œéæ£€æŸ¥å‹å¼‚å¸¸ï¼›å¯¹äºæ£€æŸ¥å‹å¼‚å¸¸æ¥è¯´ï¼Œå¦‚æœä½ æ²¡æœ‰åšå¤„ç†ï¼Œç¼–è¯‘å™¨å°±ä¼šæç¤ºä½ ã€‚â€

`Class.forName()` æ–¹æ³•åœ¨æ‰§è¡Œçš„æ—¶å€™å¯èƒ½ä¼šé‡åˆ° `java.lang.ClassNotFoundException` å¼‚å¸¸ï¼Œä¸€ä¸ªæ£€æŸ¥å‹å¼‚å¸¸ï¼Œå¦‚æœæ²¡æœ‰åšå¤„ç†ï¼ŒIDEA å°±ä¼šæç¤ºä½ ï¼Œè¦ä¹ˆåœ¨æ–¹æ³•ç­¾åä¸Šå£°æ˜ï¼Œè¦ä¹ˆæ”¾åœ¨ try-catch ä¸­ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/exception/throw-throws-01.png)

â€œé‚£ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨ throws è€Œä¸æ˜¯ try-catch å‘¢ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œå‡è®¾ç°åœ¨æœ‰è¿™ä¹ˆä¸€ä¸ªæ–¹æ³• `myMethod()`ï¼Œå¯èƒ½ä¼šå‡ºç° ArithmeticException å¼‚å¸¸ï¼Œä¹Ÿå¯èƒ½ä¼šå‡ºç° NullPointerExceptionã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ try-catch æ¥å¤„ç†ã€‚â€æˆ‘å›ç­”ã€‚

```java
public void myMethod() {
    try {
        // å¯èƒ½æŠ›å‡ºå¼‚å¸¸ 
    } catch (ArithmeticException e) {
        // ç®—æœ¯å¼‚å¸¸
    } catch (NullPointerException e) {
        // ç©ºæŒ‡é’ˆå¼‚å¸¸
    }
}
```

â€œä½†å‡è®¾æœ‰å¥½å‡ ä¸ªç±»ä¼¼ `myMethod()` çš„æ–¹æ³•ï¼Œå¦‚æœä¸ºæ¯ä¸ªæ–¹æ³•éƒ½åŠ ä¸Š try-catchï¼Œå°±ä¼šæ˜¾å¾—éå¸¸ç¹çã€‚ä»£ç å°±ä¼šå˜å¾—åˆè‡­åˆé•¿ï¼Œå¯è¯»æ€§å°±å·®äº†ã€‚â€æˆ‘ç»§ç»­è¯´ã€‚

â€œä¸€ä¸ªè§£å†³åŠæ³•å°±æ˜¯ï¼Œä½¿ç”¨ throws å…³é”®å­—ï¼Œåœ¨æ–¹æ³•ç­¾åä¸Šå£°æ˜å¯èƒ½ä¼šæŠ›å‡ºçš„å¼‚å¸¸ï¼Œç„¶ååœ¨è°ƒç”¨è¯¥æ–¹æ³•çš„åœ°æ–¹ä½¿ç”¨ try-catch è¿›è¡Œå¤„ç†ã€‚â€

```java
public static void main(String args[]){
    try {
        myMethod1();
    } catch (ArithmeticException e) {
        // ç®—æœ¯å¼‚å¸¸
    } catch (NullPointerException e) {
        // ç©ºæŒ‡é’ˆå¼‚å¸¸
    }
}
public static void myMethod1() throws ArithmeticException, NullPointerException{
    // æ–¹æ³•ç­¾åä¸Šå£°æ˜å¼‚å¸¸
}
```

â€œå¥½äº†ï¼Œæˆ‘æ¥æ€»ç»“ä¸‹ throw å’Œ throws çš„åŒºåˆ«ï¼Œä¸‰å¦¹ï¼Œä½ è®°ä¸€ä¸‹ã€‚â€

 1ï¼‰throws å…³é”®å­—ç”¨äºå£°æ˜å¼‚å¸¸ï¼Œå®ƒçš„ä½œç”¨å’Œ try-catch ç›¸ä¼¼ï¼›è€Œ throw å…³é”®å­—ç”¨äºæ˜¾å¼çš„æŠ›å‡ºå¼‚å¸¸ã€‚

2ï¼‰throws å…³é”®å­—åé¢è·Ÿçš„æ˜¯å¼‚å¸¸çš„åå­—ï¼›è€Œ throw å…³é”®å­—åé¢è·Ÿçš„æ˜¯å¼‚å¸¸çš„å¯¹è±¡ã€‚

ç¤ºä¾‹ã€‚

```java
throws ArithmeticException;
```

```java
throw new ArithmeticException("ç®—æœ¯å¼‚å¸¸");
```

3ï¼‰throws å…³é”®å­—å‡ºç°åœ¨æ–¹æ³•ç­¾åä¸Šï¼Œè€Œ throw å…³é”®å­—å‡ºç°åœ¨æ–¹æ³•ä½“é‡Œã€‚

4ï¼‰throws å…³é”®å­—åœ¨å£°æ˜å¼‚å¸¸çš„æ—¶å€™å¯ä»¥è·Ÿå¤šä¸ªï¼Œç”¨é€—å·éš”å¼€ï¼›è€Œ throw å…³é”®å­—æ¯æ¬¡åªèƒ½æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚

### 05ã€å…³äº try-catch-finally

â€œäºŒå“¥ï¼Œä¹‹å‰ä½ è®²äº†å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œè¿™ä¸€èŠ‚è®²ä»€ä¹ˆå‘¢ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œè¯¥è®² try-catch-finally äº†ã€‚â€æˆ‘è¯´ï¼Œâ€œtry å…³é”®å­—åé¢ä¼šè·Ÿä¸€ä¸ªå¤§æ‹¬å· `{}`ï¼Œæˆ‘ä»¬æŠŠä¸€äº›å¯èƒ½å‘ç”Ÿå¼‚å¸¸çš„ä»£ç æ”¾åˆ°å¤§æ‹¬å·é‡Œï¼›`try` å—åé¢ä¸€èˆ¬ä¼šè·Ÿ `catch` å—ï¼Œç”¨æ¥å¤„ç†å‘ç”Ÿå¼‚å¸¸çš„æƒ…å†µï¼›å½“ç„¶äº†ï¼Œå¼‚å¸¸ä¸ä¸€å®šä¼šå‘ç”Ÿï¼Œä¸ºäº†ä¿è¯å‘ä¸å‘ç”Ÿå¼‚å¸¸éƒ½èƒ½æ‰§è¡Œä¸€äº›ä»£ç ï¼Œå°±ä¼šè·Ÿä¸€ä¸ª `finally` å—ã€‚â€

â€œå…·ä½“è¯¥æ€ä¹ˆç”¨å‘€ï¼ŒäºŒå“¥ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œåˆ«æ‹…å¿ƒï¼Œä¸‰å¦¹ï¼Œæˆ‘ä¸€ä¸€æ¥è¯´æ˜ä¸‹ã€‚â€æˆ‘è¯´ã€‚

`try` å—çš„è¯­æ³•å¾ˆç®€å•ï¼š

```java
try{
// å¯èƒ½å‘ç”Ÿå¼‚å¸¸çš„ä»£ç 
}
```

â€œæ³¨æ„å•Šï¼Œä¸‰å¦¹ï¼Œå¦‚æœä¸€äº›ä»£ç ç¡®å®šä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå°±å°½é‡ä¸è¦æŠŠå®ƒåŒ…è£¹åœ¨ `try` å—é‡Œï¼Œå› ä¸ºåŠ äº†å¼‚å¸¸å¤„ç†çš„ä»£ç æ‰§è¡Œèµ·æ¥è¦æ¯”æ²¡æœ‰åŠ çš„èŠ±è´¹æ›´å¤šçš„æ—¶é—´ã€‚â€

`catch` å—çš„è¯­æ³•ä¹Ÿå¾ˆç®€å•ï¼š

```java
try{
// å¯èƒ½å‘ç”Ÿå¼‚å¸¸çš„ä»£ç 
}catch (exception(type) e(object)){
// å¼‚å¸¸å¤„ç†ä»£ç 
}
```

ä¸€ä¸ª `try` å—åé¢å¯ä»¥è·Ÿå¤šä¸ª `catch` å—ï¼Œç”¨æ¥æ•è·ä¸åŒç±»å‹çš„å¼‚å¸¸å¹¶åšç›¸åº”çš„å¤„ç†ï¼Œå½“ try å—ä¸­çš„æŸä¸€è¡Œä»£ç å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œä¹‹åçš„ä»£ç å°±ä¸å†æ‰§è¡Œï¼Œè€Œæ˜¯ä¼šè·³è½¬åˆ°å¼‚å¸¸å¯¹åº”çš„ catch å—ä¸­æ‰§è¡Œã€‚

å¦‚æœä¸€ä¸ª try å—åé¢è·Ÿäº†å¤šä¸ªä¸ä¹‹å…³è”çš„ catch å—ï¼Œé‚£ä¹ˆåº”è¯¥æŠŠç‰¹å®šçš„å¼‚å¸¸æ”¾åœ¨å‰é¢ï¼Œé€šç”¨å‹çš„å¼‚å¸¸æ”¾åœ¨åé¢ï¼Œä¸ç„¶ç¼–è¯‘å™¨ä¼šæç¤ºé”™è¯¯ã€‚ä¸¾ä¾‹æ¥è¯´ã€‚

```java
static void test() {
    int num1, num2;
    try {
        num1 = 0;
        num2 = 62 / num1;
        System.out.println(num2);
        System.out.println("try å—çš„æœ€åä¸€å¥");
    } catch (ArithmeticException e) {
        // ç®—æœ¯è¿ç®—å‘ç”Ÿæ—¶è·³è½¬åˆ°è¿™é‡Œ
        System.out.println("é™¤æ•°ä¸èƒ½ä¸ºé›¶");
    } catch (Exception e) {
        // é€šç”¨å‹çš„å¼‚å¸¸æ„å‘³ç€å¯ä»¥æ•è·æ‰€æœ‰çš„å¼‚å¸¸ï¼Œå®ƒåº”è¯¥æ”¾åœ¨æœ€åé¢ï¼Œ
        System.out.println("å¼‚å¸¸å‘ç”Ÿäº†");
    }
    System.out.println("try-catch ä¹‹å¤–çš„ä»£ç .");
}
```

â€œä¸ºä»€ä¹ˆ Exception ä¸èƒ½æ”¾åˆ° ArithmeticException å‰é¢å‘¢ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œå› ä¸º ArithmeticException æ˜¯ Exception çš„å­ç±»ï¼Œå®ƒæ›´å…·ä½“ï¼Œæˆ‘ä»¬çœ‹åˆ°å°±è¿™ä¸ªå¼‚å¸¸å°±çŸ¥é“æ˜¯å‘ç”Ÿäº†ç®—æœ¯é”™è¯¯ï¼Œè€Œ Exception æ¯”è¾ƒæ³›ï¼Œå®ƒéšè—äº†å…·ä½“çš„å¼‚å¸¸ä¿¡æ¯ï¼Œæˆ‘ä»¬çœ‹åˆ°åå¹¶ä¸ç¡®å®šåˆ°åº•æ˜¯å‘ç”Ÿäº†å“ªä¸€ç§ç±»å‹çš„å¼‚å¸¸ï¼Œå¯¹é”™è¯¯çš„æ’æŸ¥å¾ˆä¸åˆ©ã€‚â€æˆ‘è¯´ï¼Œâ€œå†è€…ï¼Œå¦‚æœæŠŠé€šç”¨å‹çš„å¼‚å¸¸æ”¾åœ¨å‰é¢ï¼Œå°±æ„å‘³ç€å…¶ä»–çš„ catch å—æ°¸è¿œä¹Ÿä¸ä¼šæ‰§è¡Œï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å°±ç›´æ¥æç¤ºé”™è¯¯äº†ã€‚â€

â€œå†ç»™ä½ ä¸¾ä¸ªä¾‹å­ï¼Œæ³¨æ„çœ‹ï¼Œä¸‰å¦¹ã€‚â€

```java
static void test1 () {
    try{
        int arr[]=new int[7];
        arr[4]=30/0;
        System.out.println("try å—çš„æœ€å");
    } catch(ArithmeticException e){
        System.out.println("é™¤æ•°å¿…é¡»æ˜¯ 0");
    } catch(ArrayIndexOutOfBoundsException e){
        System.out.println("æ•°ç»„è¶Šç•Œäº†");
    } catch(Exception e){
        System.out.println("ä¸€äº›å…¶ä»–çš„å¼‚å¸¸");
    }
    System.out.println("try-catch ä¹‹å¤–");
}
```

è¿™æ®µä»£ç åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ª catch å—ä¼šæ‰§è¡Œï¼Œå› ä¸ºé™¤æ•°ä¸ºé›¶ï¼›æˆ‘å†æ¥ç¨å¾®æ”¹åŠ¨ä¸‹ä»£ç ã€‚

```java
static void test1 () {
    try{
        int arr[]=new int[7];
        arr[9]=30/1;
        System.out.println("try å—çš„æœ€å");
    } catch(ArithmeticException e){
        System.out.println("é™¤æ•°å¿…é¡»æ˜¯ 0");
    } catch(ArrayIndexOutOfBoundsException e){
        System.out.println("æ•°ç»„è¶Šç•Œäº†");
    } catch(Exception e){
        System.out.println("ä¸€äº›å…¶ä»–çš„å¼‚å¸¸");
    }
    System.out.println("try-catch ä¹‹å¤–");
}
```

â€œæˆ‘çŸ¥é“ï¼ŒäºŒå“¥ï¼Œç¬¬äºŒä¸ª catch å—ä¼šæ‰§è¡Œï¼Œå› ä¸ºæ²¡æœ‰å‘ç”Ÿç®—æœ¯å¼‚å¸¸ï¼Œä½†æ•°ç»„è¶Šç•Œäº†ã€‚â€ä¸‰å¦¹æ²¡ç­‰æˆ‘æŠŠä»£ç è¿è¡Œèµ·æ¥å°±è¯´å‡ºäº†ç­”æ¡ˆã€‚

â€œä¸‰å¦¹ï¼Œä½ è¯´å¾—å¾ˆå¯¹ï¼Œæˆ‘å†æ¥æ”¹ä¸€ä¸‹ä»£ç ã€‚â€

```java
static void test1 () {
    try{
        int arr[]=new int[7];
        arr[9]=30/1;
        System.out.println("try å—çš„æœ€å");
    } catch(ArithmeticException | ArrayIndexOutOfBoundsException e){
        System.out.println("é™¤æ•°å¿…é¡»æ˜¯ 0");
    }
    System.out.println("try-catch ä¹‹å¤–");
}
```

â€œå½“æœ‰å¤šä¸ª catch çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨ä¸€èµ·ï¼Œç”¨ç«–åˆ’çº¿ `|` éš”å¼€ï¼Œå°±åƒä¸Šé¢è¿™æ ·ã€‚â€æˆ‘è¯´ã€‚

â€œè¿™æ ·ä¸é”™å‘€ï¼Œçœ‹èµ·æ¥æ›´ç®€æ´äº†ã€‚â€ä¸‰å¦¹è¯´ã€‚

`finally` å—çš„è¯­æ³•ä¹Ÿä¸å¤æ‚ã€‚

```java
try {
    // å¯èƒ½å‘ç”Ÿå¼‚å¸¸çš„ä»£ç 
}catch {
   // å¼‚å¸¸å¤„ç†
}finally {
   // å¿…é¡»æ‰§è¡Œçš„ä»£ç 
}
```

åœ¨æ²¡æœ‰ [`try-with-resources`](https://tobebetterjavaer.com/exception/try-with-resources.html) ä¹‹å‰ï¼Œfinally å—å¸¸ç”¨æ¥å…³é—­ä¸€äº›è¿æ¥èµ„æºï¼Œæ¯”å¦‚è¯´ socketã€æ•°æ®åº“é“¾æ¥ã€IO è¾“å…¥è¾“å‡ºæµç­‰ã€‚

```java
OutputStream osf = new FileOutputStream( "filename" );
OutputStream osb = new BufferedOutputStream(opf);
ObjectOutput op = new ObjectOutputStream(osb);
try{
    output.writeObject(writableObject);
} finally{
    op.close();
}
```

â€œä¸‰å¦¹ï¼Œæ³¨æ„ï¼Œä½¿ç”¨ finally å—çš„æ—¶å€™éœ€è¦éµå®ˆè¿™äº›è§„åˆ™ã€‚â€

- finally å—å‰é¢å¿…é¡»æœ‰ try å—ï¼Œä¸è¦æŠŠ finally å—å•ç‹¬æ‹‰å‡ºæ¥ä½¿ç”¨ã€‚ç¼–è¯‘å™¨ä¹Ÿä¸å…è®¸è¿™æ ·åšã€‚
- finally å—ä¸æ˜¯å¿…é€‰é¡¹ï¼Œæœ‰ try å—çš„æ—¶å€™ä¸ä¸€å®šè¦æœ‰ finally å—ã€‚
- å¦‚æœ finally å—ä¸­çš„ä»£ç å¯èƒ½ä¼šå‘ç”Ÿå¼‚å¸¸ï¼Œä¹Ÿåº”è¯¥ä½¿ç”¨ try-catch è¿›è¡ŒåŒ…è£¹ã€‚
- å³ä¾¿æ˜¯ try å—ä¸­æ‰§è¡Œäº† returnã€breakã€continue è¿™äº›è·³è½¬è¯­å¥ï¼Œfinally å—ä¹Ÿä¼šè¢«æ‰§è¡Œã€‚

â€œçœŸçš„å—ï¼ŒäºŒå“¥ï¼Ÿâ€ä¸‰å¦¹å¯¹æœ€åä¸€ä¸ªè§„åˆ™å……æ»¡äº†ç–‘æƒ‘ã€‚

â€œæ¥è¯•ä¸€ä¸‹å°±çŸ¥é“äº†ã€‚â€æˆ‘è¯´ã€‚

```java
static int test2 () {
    try {
        return 112;
    }
    finally {
        System.out.println("å³ä½¿ try å—æœ‰ returnï¼Œfinally å—ä¹Ÿä¼šæ‰§è¡Œ");
    }
}
```

æ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœï¼š

```
å³ä½¿ try å—æœ‰ returnï¼Œfinally å—ä¹Ÿä¼šæ‰§è¡Œ
```

â€œé‚£ï¼Œä¼šä¸ä¼šæœ‰ä¸æ‰§è¡Œ finally çš„æƒ…å†µå‘€ï¼Ÿâ€ä¸‰å¦¹å¾ˆå¥½å¥‡ã€‚

â€œæœ‰çš„ã€‚â€æˆ‘æ–©é’‰æˆªé“åœ°å›ç­”ã€‚

- é‡åˆ°äº†æ­»å¾ªç¯ã€‚
- æ‰§è¡Œäº† `System. exit()` è¿™è¡Œä»£ç ã€‚

`System.exit()` å’Œ `return` è¯­å¥ä¸åŒï¼Œå‰è€…æ˜¯ç”¨æ¥é€€å‡ºç¨‹åºçš„ï¼Œåè€…åªæ˜¯å›åˆ°äº†ä¸Šä¸€çº§æ–¹æ³•è°ƒç”¨ã€‚

â€œä¸‰å¦¹ï¼Œæ¥çœ‹ä¸€ä¸‹æºç çš„æ–‡æ¡£æ³¨é‡Šå°±å…¨æ˜ç™½äº†ï¼â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/exception/try-catch-finally-01.png)

è‡³äºå‚æ•° status çš„å€¼ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå¦‚æœæ˜¯å¼‚å¸¸é€€å‡ºï¼Œè®¾ç½®ä¸ºé 0 å³å¯ï¼Œé€šå¸¸ç”¨ 1 æ¥è¡¨ç¤ºï¼›å¦‚æœæ˜¯æƒ³æ­£å¸¸é€€å‡ºç¨‹åºï¼Œç”¨ 0 è¡¨ç¤ºå³å¯ã€‚

### 06ã€å°ç»“

Java çš„å¼‚å¸¸å¤„ç†æ˜¯ä¸€ç§é‡è¦çš„æœºåˆ¶ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¤„ç†ç¨‹åºæ‰§è¡ŒæœŸé—´å‘ç”Ÿçš„é”™è¯¯âæˆ–å¼‚å¸¸ã€‚

å¼‚å¸¸åˆ†ä¸ºä¸¤ç±»ï¼šChecked Exception å’Œ Unchecked Exceptionï¼Œå…¶ä¸­ Checked Exception éœ€è¦åœ¨ä»£ç ä¸­æ˜¾å¼åœ°å¤„ç†æˆ–å£°æ˜æŠ›å‡ºï¼Œè€Œ Unchecked Exception ä¸éœ€è¦åœ¨ä»£ç ä¸­æ˜¾å¼åœ°å¤„ç†æˆ–å£°æ˜æŠ›å‡ºã€‚å¼‚å¸¸å¤„ç†é€šå¸¸ä½¿ç”¨ try-catch-finally å—æ¥å¤„ç†ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ throws å…³é”®å­—å°†å¼‚å¸¸æŠ›å‡ºç»™è°ƒç”¨è€…å¤„ç†ã€‚

ä¸‹é¢æ˜¯ Java å¼‚å¸¸å¤„ç†çš„ä¸€äº›æ€»ç»“ï¼š

- ä½¿ç”¨ try-catch å—æ•è·å¹¶å¤„ç†å¼‚å¸¸ï¼Œå¯ä»¥é¿å…ç¨‹åºå› å¼‚å¸¸è€Œå´©æºƒã€‚
- å¯ä»¥ä½¿ç”¨å¤šä¸ª catch å—æ¥æ•è·ä¸åŒç±»å‹çš„å¼‚å¸¸ï¼Œå¹¶è¿›è¡Œä¸åŒçš„å¤„ç†ã€‚
- å¯ä»¥ä½¿ç”¨ finally å—æ¥æ‰§è¡Œä¸€äº›å¿…è¦çš„æ¸…ç†å·¥ä½œï¼Œæ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸éƒ½ä¼šæ‰§è¡Œã€‚
- å¯ä»¥ä½¿ç”¨ throw å…³é”®å­—æ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œç”¨äºåœ¨ç¨‹åºä¸­æ˜ç¡®æŒ‡å®šæŸäº›å¼‚å¸¸æƒ…å†µã€‚
- å¯ä»¥ä½¿ç”¨ throws å…³é”®å­—å°†å¼‚å¸¸æŠ›å‡ºç»™è°ƒç”¨è€…å¤„ç†ï¼Œç”¨äºåœ¨æ–¹æ³•ç­¾åä¸­å£°æ˜å¯èƒ½ä¼šå‡ºç°çš„å¼‚å¸¸ã€‚
- Checked Exception é€šå¸¸æ˜¯ç”±äºå¤–éƒ¨å› ç´ å¯¼è‡´çš„é—®é¢˜ï¼Œéœ€è¦åœ¨ä»£ç ä¸­æ˜¾å¼åœ°å¤„ç†æˆ–å£°æ˜æŠ›å‡ºã€‚
- Unchecked Exception é€šå¸¸æ˜¯ç”±äºç¨‹åºå†…éƒ¨é€»è¾‘æˆ–æ•°æ®å¼‚å¸¸å¯¼è‡´çš„ï¼Œå¯ä»¥ä¸å¤„ç†æˆ–è€…åœ¨éœ€è¦æ—¶è¿›è¡Œå¤„ç†ã€‚
- åœ¨å¤„ç†å¼‚å¸¸æ—¶ï¼Œåº”è¯¥æ ¹æ®å…·ä½“çš„å¼‚å¸¸ç±»å‹è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚å¯ä»¥å°è¯•é‡æ–°æ‰“å¼€æ–‡ä»¶ã€é‡æ–°å»ºç«‹ç½‘ç»œè¿æ¥ç­‰æ“ä½œã€‚
- å¼‚å¸¸å¤„ç†åº”è¯¥æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚å’Œè®¾è®¡åŸåˆ™è¿›è¡Œï¼Œé¿å…è¿‡åº¦æ•è·å’Œå¤„ç†å¼‚å¸¸ï¼Œä»è€Œé™ä½ç¨‹åºçš„æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 8.2 try-with-resources

â€œäºŒå“¥ï¼Œç»ˆäºç­‰åˆ°ä½ è®² try-with-resources äº†ï¼â€ä¸‰å¦¹å¤¸å¼ çš„è¡¨æƒ…è®©æˆ‘æœ‰äº›åƒæƒŠã€‚

â€œä¸‰å¦¹ï¼Œä¸è¦æ¿€åŠ¨å‘€ï¼å¼€è®²ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦æ¥å›é¡¾ä¸€ä¸‹ tryâ€“catch-finallyï¼Œå¥½åšä¸ªé“ºå«ã€‚â€æˆ‘è¯´ï¼Œâ€œæ¥çœ‹çœ‹è¿™æ®µä»£ç å§ã€‚â€

```java
public class TrycatchfinallyDecoder {
    public static void main(String[] args) {
        BufferedReader br = null;
        try {
            String path = TrycatchfinallyDecoder.class.getResource("/ç‰›é€¼.txt").getFile();
            String decodePath = URLDecoder.decode(path,"utf-8");
            br = new BufferedReader(new FileReader(decodePath));

            String str = null;
            while ((str =br.readLine()) != null) {
                System.out.println(str);
            }
        } catch (IOException e) {
            e.printStackTrace();
        } finally {
            if (br != null) {
                try {
                    br.close();
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        }
    }
}
```

â€œæˆ‘ç®€å•æ¥è§£é‡Šä¸‹ã€‚â€ç­‰ä¸‰å¦¹çœ‹å®Œè¿™æ®µä»£ç åï¼Œæˆ‘ç»§ç»­è¯´ï¼Œâ€œåœ¨ try å—ä¸­è¯»å–æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œå¹¶ä¸€è¡Œä¸€è¡Œåœ°æ‰“å°åˆ°æ§åˆ¶å°ã€‚å¦‚æœæ–‡ä»¶æ‰¾ä¸åˆ°æˆ–è€…å‡ºç° IO è¯»å†™é”™è¯¯ï¼Œå°±åœ¨ catch ä¸­æ•è·å¹¶æ‰“å°é”™è¯¯çš„å †æ ˆä¿¡æ¯ã€‚æœ€åï¼Œåœ¨ finally ä¸­å…³é—­ç¼“å†²å­—ç¬¦è¯»å–å™¨å¯¹è±¡ BufferedReaderï¼Œæœ‰æ•ˆæœç»äº†èµ„æºæœªè¢«å…³é—­çš„æƒ…å†µä¸‹é€ æˆçš„ä¸¥é‡æ€§èƒ½åæœã€‚â€

â€œåœ¨ Java 7 ä¹‹å‰ï¼Œtryâ€“catch-finally çš„ç¡®æ˜¯ç¡®ä¿èµ„æºä¼šè¢«åŠæ—¶å…³é—­çš„æœ€ä½³æ–¹æ³•ï¼Œæ— è®ºç¨‹åºæ˜¯å¦ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚â€

ä¸‰å¦¹ç‚¹äº†ç‚¹å¤´ï¼Œè¡¨ç¤ºåŒæ„ã€‚

â€œä¸è¿‡ï¼Œè¿™æ®µä»£ç è¿˜æ˜¯æœ‰äº›è‡ƒè‚¿ï¼Œå°¤å…¶æ˜¯ finally ä¸­çš„ä»£ç ã€‚â€æˆ‘è¯´ï¼Œâ€œå†µä¸”ï¼Œtryâ€“catch-finally è‡³å§‹è‡³ç»ˆå­˜åœ¨ä¸€ä¸ªä¸¥é‡çš„éšæ‚£ï¼štry ä¸­çš„ `br.readLine()` æœ‰å¯èƒ½ä¼šæŠ›å‡º `IOException`ï¼Œfinally ä¸­çš„ `br.close()` ä¹Ÿæœ‰å¯èƒ½ä¼šæŠ›å‡º `IOException`ã€‚å‡å¦‚ä¸¤å¤„éƒ½ä¸å¹¸åœ°æŠ›å‡ºäº† IOExceptionï¼Œé‚£ç¨‹åºçš„è°ƒè¯•ä»»åŠ¡å°±å˜å¾—å¤æ‚äº†èµ·æ¥ï¼Œåˆ°åº•æ˜¯å“ªä¸€å¤„å‡ºäº†é”™è¯¯ï¼Œå°±éœ€è¦èŠ±ä¸€ç•ªåŠŸå¤«ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸æ„¿æ„çœ‹åˆ°çš„ç»“æœã€‚â€

â€œæˆ‘æ¥ç»™ä½ æ¼”ç¤ºä¸‹ï¼Œä¸‰å¦¹ã€‚â€

â€œé¦–å…ˆï¼Œæˆ‘ä»¬æ¥å®šä¹‰è¿™æ ·ä¸€ä¸ªç±» MyfinallyReadLineThrowï¼Œå®ƒæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ `readLine()` å’Œ `close()`ï¼Œæ–¹æ³•ä½“éƒ½æ˜¯ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸ã€‚â€

```java
class MyfinallyReadLineThrow {
    public void close() throws Exception {
        throw new Exception("close");
    }

    public void readLine() throws Exception {
        throw new Exception("readLine");
    }
}
```

â€œç„¶ååœ¨ `main()` æ–¹æ³•ä¸­ä½¿ç”¨ try-catch-finally çš„æ–¹å¼è°ƒç”¨ MyfinallyReadLineThrow çš„ `readLine()` å’Œ `close()` æ–¹æ³•ã€‚â€

```java
public class TryfinallyCustomReadLineThrow {
    public static void main(String[] args) throws Exception {
        MyfinallyReadLineThrow myThrow = null;
        try {
            myThrow = new MyfinallyReadLineThrow();
            myThrow.readLine();
        } finally {
            myThrow.close();
        }
    }
}
```

è¿è¡Œä¸Šè¿°ä»£ç åï¼Œé”™è¯¯å †æ ˆå¦‚ä¸‹æ‰€ç¤ºï¼š

```
Exception in thread "main" java.lang.Exception: close
	at com.cmower.dzone.trycatchfinally.MyfinallyOutThrow.close(TryfinallyCustomOutThrow.java:17)
	at com.cmower.dzone.trycatchfinally.TryfinallyCustomOutThrow.main(TryfinallyCustomOutThrow.java:10)
```

â€œçœ‹å‡ºæ¥é—®é¢˜äº†å—ï¼Œä¸‰å¦¹ï¼Ÿâ€

â€œå•Šï¼Ÿ`readLine()` æ–¹æ³•çš„å¼‚å¸¸ä¿¡æ¯ç«Ÿç„¶è¢« `close()` æ–¹æ³•çš„å †æ ˆä¿¡æ¯åƒäº†ï¼â€

â€œä¸é”™å•Šï¼Œä¸‰å¦¹ï¼Œç«çœ¼é‡‘ç›ï¼Œçš„ç¡®ï¼Œè¿™ä¼šè®©æˆ‘ä»¬è¯¯ä»¥ä¸ºè¦è°ƒæŸ¥çš„ç›®æ ‡æ˜¯ `close()` æ–¹æ³•è€Œä¸æ˜¯ `readLine()` æ–¹æ³•â€”â€”å°½ç®¡å®ƒä¹Ÿæ˜¯åº”è¯¥æ€€ç–‘çš„å¯¹è±¡ã€‚â€

â€œä½†æœ‰äº† try-with-resources åï¼Œè¿™äº›é—®é¢˜å°±è¿åˆƒè€Œè§£äº†ã€‚å‰ææ¡ä»¶åªæœ‰ä¸€ä¸ªï¼Œå°±æ˜¯éœ€è¦é‡Šæ”¾çš„èµ„æºï¼ˆæ¯”å¦‚ BufferedReaderï¼‰å®ç°äº† AutoCloseable æ¥å£ã€‚â€

```java
try (BufferedReader br = new BufferedReader(new FileReader(decodePath));) {
    String str = null;
    while ((str =br.readLine()) != null) {
        System.out.println(str);
    }
} catch (IOException e) {
    e.printStackTrace();
}
```

â€œä½ ç§ï¼Œä¸‰å¦¹ï¼Œfinally å—æ¶ˆå¤±äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æŠŠè¦é‡Šæ”¾çš„èµ„æºå†™åœ¨ try åçš„ `()` ä¸­ã€‚å¦‚æœæœ‰å¤šä¸ªèµ„æºï¼ˆBufferedReader å’Œ PrintWriterï¼‰éœ€è¦é‡Šæ”¾çš„è¯ï¼Œå¯ä»¥ç›´æ¥åœ¨ `()` ä¸­æ·»åŠ ã€‚â€

```java
try (BufferedReader br = new BufferedReader(new FileReader(decodePath));
     PrintWriter writer = new PrintWriter(new File(writePath))) {
    String str = null;
    while ((str =br.readLine()) != null) {
        writer.print(str);
    }
} catch (IOException e) {
    e.printStackTrace();
}
```

â€œå¦‚æœæƒ³é‡Šæ”¾è‡ªå®šä¹‰èµ„æºçš„è¯ï¼Œåªè¦è®©å®ƒå®ç° AutoCloseable æ¥å£ï¼Œå¹¶æä¾› `close()` æ–¹æ³•å³å¯ã€‚â€

```java
public class TrywithresourcesCustom {
    public static void main(String[] args) {
        try (MyResource resource = new MyResource();) {
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}

class MyResource implements AutoCloseable {
    @Override
    public void close() throws Exception {
        System.out.println("å…³é—­è‡ªå®šä¹‰èµ„æº");
    }
}
```

æ¥çœ‹ä¸€ä¸‹ä»£ç è¿è¡Œåçš„è¾“å‡ºç»“æœï¼š

```
å…³é—­è‡ªå®šä¹‰èµ„æº
```

â€œå¥½ç¥å¥‡å‘€ï¼â€ä¸‰å¦¹æ¬£å–œè‹¥ç‹‚ï¼Œâ€œåœ¨ `try ()` ä¸­åªæ˜¯ new äº†ä¸€ä¸ª MyResource çš„å¯¹è±¡ï¼Œå…¶ä»–ä»€ä¹ˆä¹Ÿæ²¡å¹²ï¼Œ`close()` æ–¹æ³•å°±æ‰§è¡Œäº†ï¼â€

â€œæƒ³çŸ¥é“ä¸ºä»€ä¹ˆå—ï¼Ÿä¸‰å¦¹ã€‚â€

â€œå½“ç„¶æƒ³å•Šã€‚â€

â€œæ¥çœ‹çœ‹åç¼–è¯‘åçš„å­—èŠ‚ç å§ã€‚â€

```java
class MyResource implements AutoCloseable {
    MyResource() {
    }

    public void close() throws Exception {
        System.out.println("å…³é—­è‡ªå®šä¹‰èµ„æº");
    }
}

public class TrywithresourcesCustom {
    public TrywithresourcesCustom() {
    }

    public static void main(String[] args) {
        try {
            MyResource resource = new MyResource();
            resource.close();
        } catch (Exception var2) {
            var2.printStackTrace();
        }

    }
}
```

â€œå•Šï¼ŒåŸæ¥å¦‚æ­¤ã€‚ç¼–è¯‘å™¨ä¸»åŠ¨ä¸º try-with-resources è¿›è¡Œäº†å˜èº«ï¼Œåœ¨ try ä¸­è°ƒç”¨äº† `close()` æ–¹æ³•ã€‚â€

â€œæ˜¯è¿™æ ·çš„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨ `MyResourceOut` ç±»ä¸­å†æ·»åŠ ä¸€ä¸ª `out()` æ–¹æ³•ã€‚â€

```java
class MyResourceOut implements AutoCloseable {
    @Override
    public void close() throws Exception {
        System.out.println("å…³é—­è‡ªå®šä¹‰èµ„æº");
    }

    public void out() throws Exception{
        System.out.println("æ²‰é»˜ç‹äºŒï¼Œä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜");
    }
}
```

â€œè¿™æ¬¡ï¼Œæˆ‘ä»¬åœ¨ try ä¸­è°ƒç”¨ä¸€ä¸‹ `out()` æ–¹æ³•ã€‚â€

```java
public class TrywithresourcesCustomOut {
    public static void main(String[] args) {
        try (MyResourceOut resource = new MyResourceOut();) {
            resource.out();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

â€œå†æ¥çœ‹ä¸€ä¸‹åç¼–è¯‘çš„å­—èŠ‚ç ã€‚â€

```java
public class TrywithresourcesCustomOut {
    public TrywithresourcesCustomOut() {
    }

    public static void main(String[] args) {
        try {
            MyResourceOut resource = new MyResourceOut();

            try {
                resource.out();
            } catch (Throwable var5) {
                try {
                    resource.close();
                } catch (Throwable var4) {
                    var5.addSuppressed(var4);
                }

                throw var5;
            }

            resource.close();
        } catch (Exception var6) {
            var6.printStackTrace();
        }

    }
}
```

â€œè¿™æ¬¡ï¼Œ`catch` å—ä¸»åŠ¨è°ƒç”¨äº† `resource.close()`ï¼Œå¹¶ä¸”æœ‰ä¸€æ®µå¾ˆå…³é”®çš„ä»£ç  ` var5.addSuppressed(var4)`ã€‚â€

â€œè¿™æ˜¯ä¸ºäº†ä»€ä¹ˆå‘¢ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œå½“ä¸€ä¸ªå¼‚å¸¸è¢«æŠ›å‡ºçš„æ—¶å€™ï¼Œå¯èƒ½æœ‰å…¶ä»–å¼‚å¸¸å› ä¸ºè¯¥å¼‚å¸¸è€Œè¢«æŠ‘åˆ¶ä½ï¼Œä»è€Œæ— æ³•æ­£å¸¸æŠ›å‡ºã€‚è¿™æ—¶å¯ä»¥é€šè¿‡ `addSuppressed()` æ–¹æ³•æŠŠè¿™äº›è¢«æŠ‘åˆ¶çš„æ–¹æ³•è®°å½•ä¸‹æ¥ï¼Œç„¶åè¢«æŠ‘åˆ¶çš„å¼‚å¸¸å°±ä¼šå‡ºç°åœ¨æŠ›å‡ºçš„å¼‚å¸¸çš„å †æ ˆä¿¡æ¯ä¸­ï¼Œå¯ä»¥é€šè¿‡ `getSuppressed()` æ–¹æ³•æ¥è·å–è¿™äº›å¼‚å¸¸ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ä¸ä¼šä¸¢å¤±ä»»ä½•å¼‚å¸¸ï¼Œæ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œè°ƒè¯•ã€‚â€æˆ‘è¯´ã€‚

â€œæœ‰æ²¡æœ‰æƒ³åˆ°ä¹‹å‰çš„é‚£ä¸ªä¾‹å­â€”â€”åœ¨ try-catch-finally ä¸­ï¼Œ`readLine()` æ–¹æ³•çš„å¼‚å¸¸ä¿¡æ¯ç«Ÿç„¶è¢« `close()` æ–¹æ³•çš„å †æ ˆä¿¡æ¯åƒäº†ã€‚ç°åœ¨æœ‰äº† try-with-resourcesï¼Œå†æ¥çœ‹çœ‹å’Œ `readLine()` æ–¹æ³•ä¸€è‡´çš„ `out()` æ–¹æ³•ä¼šä¸ä¼šè¢« `close()` åƒæ‰å§ã€‚â€

```java
class MyResourceOutThrow implements AutoCloseable {
    @Override
    public void close() throws Exception {
        throw  new Exception("close()");
    }

    public void out() throws Exception{
        throw new Exception("out()");
    }
}
```

â€œè°ƒç”¨è¿™ 2 ä¸ªæ–¹æ³•ã€‚â€

```java
public class TrywithresourcesCustomOutThrow {
    public static void main(String[] args) {
        try (MyResourceOutThrow resource = new MyResourceOutThrow();) {
            resource.out();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

â€œç¨‹åºè¾“å‡ºçš„ç»“æœå¦‚ä¸‹æ‰€ç¤ºã€‚â€

```
java.lang.Exception: out()
	at com.cmower.dzone.trycatchfinally.MyResourceOutThrow.out(TrywithresourcesCustomOutThrow.java:20)
	at com.cmower.dzone.trycatchfinally.TrywithresourcesCustomOutThrow.main(TrywithresourcesCustomOutThrow.java:6)
	Suppressed: java.lang.Exception: close()
		at com.cmower.dzone.trycatchfinally.MyResourceOutThrow.close(TrywithresourcesCustomOutThrow.java:16)
		at com.cmower.dzone.trycatchfinally.TrywithresourcesCustomOutThrow.main(TrywithresourcesCustomOutThrow.java:5)
```

â€œç§ï¼Œè¿™æ¬¡ä¸ä¼šäº†ï¼Œ`out()` çš„å¼‚å¸¸å †æ ˆä¿¡æ¯æ‰“å°å‡ºæ¥äº†ï¼Œå¹¶ä¸” `close()` æ–¹æ³•çš„å †æ ˆä¿¡æ¯ä¸ŠåŠ äº†ä¸€ä¸ªå…³é”®å­— `Suppressed`ï¼Œä¸€ç›®äº†ç„¶ã€‚â€

â€œä¸‰å¦¹ï¼Œæ€ä¹ˆæ ·ï¼Ÿæ˜¯ä¸æ˜¯æ„Ÿè§‰ try-with-resources å¥½ç”¨å¤šäº†ï¼æˆ‘æ¥ç®€å•æ€»ç»“ä¸‹å“ˆï¼Œåœ¨å¤„ç†å¿…é¡»å…³é—­çš„èµ„æºæ—¶ï¼Œå§‹ç»ˆæœ‰é™è€ƒè™‘ä½¿ç”¨ try-with-resourcesï¼Œè€Œä¸æ˜¯ tryâ€“catch-finallyã€‚å‰è€…äº§ç”Ÿçš„ä»£ç æ›´åŠ ç®€æ´ã€æ¸…æ™°ï¼Œäº§ç”Ÿçš„å¼‚å¸¸ä¿¡æ¯ä¹Ÿæ›´é è°±ã€‚â€

â€œé è°±ï¼â€ä¸‰å¦¹è¯´ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 8.3 å¼‚å¸¸å¤„ç†çš„20ä¸ªæœ€ä½³å®è·µ

â€œä¸‰å¦¹å•Šï¼Œä»Šå¤©æˆ‘æ¥ç»™ä½ ä¼ æˆ 20 ä¸ªå¼‚å¸¸å¤„ç†çš„æœ€ä½³å®è·µç»éªŒï¼Œä»¥å…ä½ ä»¥ååœ¨å¼€å‘ä¸­é‡‡å‘ã€‚â€æˆ‘é¢å¸¦ç€å¾®ç¬‘å¯¹ä¸‰å¦¹è¯´ã€‚

â€œå¥½å•Šï¼ŒäºŒå“¥ï¼Œæˆ‘æ´—è€³æ­å¬ã€‚â€ä¸‰å¦¹ä¹Ÿå¾®å¾®ä¸€ç¬‘ï¼Œæ¬£ç„¶æ¥å—ã€‚

â€œå¥½ï¼Œé‚£å“¥å°±ä¸åºŸè¯äº†ã€‚å¼€æ•´ã€‚â€

### 01ã€å°½é‡ä¸è¦æ•è· RuntimeException

[é˜¿é‡Œå‡ºå“çš„ Java å¼€å‘æ‰‹å†Œ](https://tobebetterjavaer.com/pdf/ali-java-shouce.html)ä¸Šè¿™æ ·è§„å®šï¼š

>å°½é‡ä¸è¦ catch RuntimeExceptionï¼Œæ¯”å¦‚ NullPointerExceptionã€IndexOutOfBoundsException ç­‰ç­‰ï¼Œåº”è¯¥ç”¨é¢„æ£€æŸ¥çš„æ–¹å¼æ¥è§„é¿ã€‚

æ­£ä¾‹ï¼š

```java
if (obj != null) {
  //...
}
```

åä¾‹ï¼š

```java
try { 
  obj.method(); 
} catch (NullPointerException e) {
  //...
}
```

â€œå“¦ï¼Œé‚£å¦‚æœæœ‰äº›å¼‚å¸¸é¢„æ£€æŸ¥ä¸å‡ºæ¥å‘¢ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œçš„ç¡®ä¼šå­˜åœ¨è¿™æ ·çš„æƒ…å†µï¼Œæ¯”å¦‚è¯´ NumberFormatExceptionï¼Œè™½ç„¶ä¹Ÿå±äº RuntimeExceptionï¼Œä½†æ²¡åŠæ³•é¢„æ£€æŸ¥ï¼Œæ‰€ä»¥è¿˜æ˜¯åº”è¯¥ç”¨ catch æ•è·å¤„ç†ã€‚â€æˆ‘è¯´ã€‚

### 02ã€å°½é‡ä½¿ç”¨ try-with-resource æ¥å…³é—­èµ„æº

å½“éœ€è¦å…³é—­èµ„æºæ—¶ï¼Œå°½é‡ä¸è¦ä½¿ç”¨ try-catch-finallyï¼Œç¦æ­¢åœ¨ try å—ä¸­ç›´æ¥å…³é—­èµ„æºã€‚

åä¾‹ï¼š

```java
public void doNotCloseResourceInTry() {
    FileInputStream inputStream = null;
    try {
        File file = new File("./tmp.txt");
        inputStream = new FileInputStream(file);
        inputStream.close();
    } catch (FileNotFoundException e) {
        log.error(e);
    } catch (IOException e) {
        log.error(e);
    }
}
```

â€œä¸ºä»€ä¹ˆå‘¢ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œåŸå› ä¹Ÿå¾ˆç®€å•ï¼Œå› ä¸ºä¸€æ—¦ `close()` ä¹‹å‰å‘ç”Ÿäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆèµ„æºå°±æ— æ³•å…³é—­ã€‚ç›´æ¥ä½¿ç”¨ [try-with-resource](https://tobebetterjavaer.com/exception/try-with-resources.html) æ¥å¤„ç†æ˜¯æœ€ä½³æ–¹å¼ã€‚â€æˆ‘è¯´ã€‚

```java
public void automaticallyCloseResource() {
    File file = new File("./tmp.txt");
    try (FileInputStream inputStream = new FileInputStream(file);) {
    } catch (FileNotFoundException e) {
        log.error(e);
    } catch (IOException e) {
        log.error(e);
    }
}
```

â€œé™¤éèµ„æºæ²¡æœ‰å®ç° AutoCloseable æ¥å£ã€‚â€æˆ‘è¡¥å……é“ã€‚

â€œé‚£è¿™ç§æƒ…å†µä¸‹æ€ä¹ˆåŠå‘¢ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œå°±åœ¨ finally å—å…³é—­æµã€‚â€æˆ‘è¯´ã€‚

```java
public void closeResourceInFinally() {
    FileInputStream inputStream = null;
    try {
        File file = new File("./tmp.txt");
        inputStream = new FileInputStream(file);
    } catch (FileNotFoundException e) {
        log.error(e);
    } finally {
        if (inputStream != null) {
            try {
                inputStream.close();
            } catch (IOException e) {
                log.error(e);
            }
        }
    }
}
```

### 03ã€ä¸è¦æ•è· Throwable

Throwable æ˜¯ exception å’Œ error çš„çˆ¶ç±»ï¼Œå¦‚æœåœ¨ catch å­å¥ä¸­æ•è·äº† Throwableï¼Œå¾ˆå¯èƒ½æŠŠè¶…å‡ºç¨‹åºå¤„ç†èƒ½åŠ›ä¹‹å¤–çš„é”™è¯¯ä¹Ÿæ•è·äº†ã€‚

```java
public void doNotCatchThrowable() {
    try {
    } catch (Throwable t) {
        // ä¸è¦è¿™æ ·åš
    }
}
```

â€œåˆ°åº•ä¸ºä»€ä¹ˆå•Šï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œå› ä¸ºæœ‰äº› error æ˜¯ä¸éœ€è¦ç¨‹åºæ¥å¤„ç†ï¼Œç¨‹åºå¯èƒ½ä¹Ÿå¤„ç†ä¸äº†ï¼Œæ¯”å¦‚è¯´ OutOfMemoryError æˆ–è€… StackOverflowErrorï¼Œå‰è€…æ˜¯å› ä¸º Java è™šæ‹Ÿæœºæ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ç©ºé—´æ—¶å‡ºç°çš„éæ­£å¸¸çš„é”™è¯¯ï¼Œåè€…æ˜¯å› ä¸ºçº¿ç¨‹ç”³è¯·çš„æ ˆæ·±åº¦è¶…è¿‡äº†å…è®¸çš„æœ€å¤§æ·±åº¦å‡ºç°çš„éæ­£å¸¸é”™è¯¯ï¼Œå¦‚æœæ•è·äº†ï¼Œå°±æ©ç›–äº†ç¨‹åºåº”è¯¥è¢«å‘ç°çš„ä¸¥é‡é”™è¯¯ã€‚â€æˆ‘è¯´ã€‚

â€œæ‰“ä¸ªæ¯”æ–¹ï¼Œä¸€åŒ¹é©¬åªèƒ½æ‹‰ä¸€è½¦å¢çš„è´§ç‰©ï¼Œæ‹‰ä¸¤è½¦å¢å¯èƒ½å°±æŒ‚äº†ï¼Œä½†ä¸€ catchï¼Œå°±å‘ç°ä¸äº†é—®é¢˜äº†ã€‚â€æˆ‘è¡¥å……é“ã€‚

### 04ã€ä¸è¦çœç•¥å¼‚å¸¸ä¿¡æ¯çš„è®°å½•

å¾ˆå¤šæ—¶å€™ï¼Œç”±äºç–å¿½å¤§æ„ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æ•è·äº†å¼‚å¸¸å´æ²¡æœ‰è®°å½•å¼‚å¸¸ä¿¡æ¯ï¼Œå¯¼è‡´ç¨‹åºä¸Šçº¿åçœŸçš„å‡ºç°äº†é—®é¢˜å´æ²¡æœ‰è®°å½•å¯æŸ¥ã€‚

```java
public void doNotIgnoreExceptions() {
    try {
    } catch (NumberFormatException e) {
        // æ²¡æœ‰è®°å½•å¼‚å¸¸
    }
}
```

åº”è¯¥æŠŠé”™è¯¯ä¿¡æ¯è®°å½•ä¸‹æ¥ã€‚

```java
public void logAnException() {
    try {
    } catch (NumberFormatException e) {
        log.error("å“¦ï¼Œé”™è¯¯ç«Ÿç„¶å‘ç”Ÿäº†: " + e);
    }
}
```

### 05ã€ä¸è¦è®°å½•äº†å¼‚å¸¸åˆæŠ›å‡ºäº†å¼‚å¸¸

è¿™çº¯å±ç”»è›‡æ·»è¶³ï¼Œå¹¶ä¸”å®¹æ˜“é€ æˆé”™è¯¯ä¿¡æ¯çš„æ··ä¹±ã€‚

åä¾‹ï¼š

```java
try {
} catch (NumberFormatException e) {
    log.error(e);
    throw e;
}
```

è¦æŠ›å‡ºå°±æŠ›å‡ºï¼Œä¸è¦è®°å½•ï¼Œè®°å½•äº†åˆæŠ›å‡ºï¼Œç­‰äºå¤šæ­¤ä¸€ä¸¾ã€‚

åä¾‹ï¼š

```java
public void wrapException(String input) throws MyBusinessException {
    try {
    } catch (NumberFormatException e) {
        throw new MyBusinessException("é”™è¯¯ä¿¡æ¯æè¿°ï¼š", e);
    }
}
```

è¿™ç§ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ï¼Œæ—¢ç„¶å·²ç»æ•è·äº†ï¼Œå°±ä¸è¦åœ¨æ–¹æ³•ç­¾åä¸ŠæŠ›å‡ºäº†ã€‚

### 06ã€ä¸è¦åœ¨ finally å—ä¸­ä½¿ç”¨ return

[é˜¿é‡Œå‡ºå“çš„ Java å¼€å‘æ‰‹å†Œ](https://tobebetterjavaer.com/pdf/ali-java-shouce.html)ä¸Šè¿™æ ·è§„å®šï¼š

>try å—ä¸­çš„ return è¯­å¥æ‰§è¡ŒæˆåŠŸåï¼Œå¹¶ä¸ä¼šé©¬ä¸Šè¿”å›ï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œ finally å—ä¸­çš„è¯­å¥ï¼Œå¦‚æœ finally å—ä¸­ä¹Ÿå­˜åœ¨ return è¯­å¥ï¼Œé‚£ä¹ˆ try å—ä¸­çš„ return å°±å°†è¢«è¦†ç›–ã€‚

åä¾‹ï¼š

```java
private int x = 0;
public int checkReturn() {
    try {
        return ++x;
    } finally {
        return ++x;
    }
}
```

â€œå“¦ï¼Œç¡®å®å•Šï¼Œtry å—ä¸­ x è¿”å›çš„å€¼ä¸º 1ï¼Œåˆ°äº† finally å—ä¸­å°±è¿”å› 2 äº†ã€‚â€ä¸‰å¦¹è¯´ã€‚

â€œæ˜¯è¿™æ ·çš„ã€‚â€æˆ‘ç‚¹ç‚¹å¤´ã€‚

### 07ã€æŠ›å‡ºå…·ä½“å®šä¹‰çš„æ£€æŸ¥æ€§å¼‚å¸¸è€Œä¸æ˜¯ Exception

```java
public void foo() throws Exception { //é”™è¯¯æ–¹å¼
}
```

ä¸€å®šè¦é¿å…å‡ºç°ä¸Šé¢çš„ä»£ç ï¼Œå®ƒç ´åäº†æ£€æŸ¥æ€§ï¼ˆcheckedï¼‰å¼‚å¸¸çš„ç›®çš„ã€‚å£°æ˜çš„æ–¹æ³•åº”è¯¥å°½å¯èƒ½æŠ›å‡ºå…·ä½“çš„æ£€æŸ¥æ€§å¼‚å¸¸ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•å¯èƒ½ä¼šæŠ›å‡º SQLException å¼‚å¸¸ï¼Œåº”è¯¥æ˜¾å¼åœ°å£°æ˜æŠ›å‡º SQLException è€Œä¸æ˜¯ Exception ç±»å‹çš„å¼‚å¸¸ã€‚è¿™æ ·å¯ä»¥è®©å…¶ä»–å¼€å‘è€…æ›´å¥½åœ°ç†è§£ä»£ç çš„æ„å›¾å’Œå¼‚å¸¸å¤„ç†çš„æ–¹å¼ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ® SQLException çš„å®šä¹‰å’Œæ–‡æ¡£æ¥ç¡®å®šå¼‚å¸¸çš„å¤„ç†æ–¹å¼å’Œç­–ç•¥ã€‚

### 08ã€æ•è·å…·ä½“çš„å­ç±»è€Œä¸æ˜¯æ•è· Exception ç±»

```java
try {
   someMethod();
} catch (Exception e) { //é”™è¯¯æ–¹å¼
   LOGGER.error("method has failed", e);
}
```

å¦‚æœåœ¨ catch å—ä¸­æ•è· Exception ç±»å‹çš„å¼‚å¸¸ï¼Œä¼šå°†æ‰€æœ‰å¼‚å¸¸éƒ½æ•è·ï¼Œä»è€Œå¯èƒ½ä¼šç»™ç¨‹åºå¸¦æ¥ä¸å¿…è¦çš„éº»çƒ¦ã€‚å…·ä½“æ¥è¯´ï¼Œå¦‚æœæ•è· Exception ç±»å‹çš„å¼‚å¸¸ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š

- éš¾ä»¥è¯†åˆ«å’Œå®šä½å¼‚å¸¸ï¼šå¦‚æœæ•è· Exception ç±»å‹çš„å¼‚å¸¸ï¼Œå¯èƒ½ä¼šæ•è·åˆ°ä¸€äº›ä¸åº”è¯¥è¢«å¤„ç†çš„å¼‚å¸¸ï¼Œä»è€Œå¯¼è‡´ç¨‹åºéš¾ä»¥è¯†åˆ«å’Œå®šä½å¼‚å¸¸ã€‚
- éš¾ä»¥è°ƒè¯•å’Œæ’é”™ï¼šå¦‚æœæ•è· Exception ç±»å‹çš„å¼‚å¸¸ï¼Œå¯èƒ½ä¼šä½¿å¾—è°ƒè¯•å’Œæ’é”™å˜å¾—æ›´åŠ å›°éš¾ï¼Œå› ä¸ºæ— æ³•ç¡®å®šå…·ä½“çš„å¼‚å¸¸ç±»å‹å’Œå¼‚å¸¸å‘ç”Ÿçš„åŸå› ã€‚

ä¸‹é¢ä¸¾ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ä¸ºä»€ä¹ˆåº”è¯¥å°½å¯èƒ½åœ°æ•è·å…·ä½“çš„å­ç±»è€Œä¸æ˜¯ Exception ç±»å‹çš„å¼‚å¸¸ã€‚

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–¹æ³• `readFromFile(String filePath)`ï¼Œç”¨äºä»æŒ‡å®šæ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚åœ¨æ–¹æ³•å®ç°è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸¤ç§å¼‚å¸¸ï¼šFileNotFoundException å’Œ IOExceptionã€‚

å¦‚æœåœ¨æ–¹æ³•ä¸­ä½¿ç”¨ä»¥ä¸‹ catch å—æ¥æ•è·å¼‚å¸¸ï¼š

```java
try {
    // è¯»å–æ•°æ®çš„ä»£ç 
} catch (Exception e) {
    // å¼‚å¸¸å¤„ç†çš„ä»£ç 
}
```

è¿™æ ·åšä¼šæ•è·æ‰€æœ‰ç±»å‹çš„å¼‚å¸¸ï¼ŒåŒ…æ‹¬ Checked Exception å’Œ Unchecked Exceptionã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š

- å‘ç”Ÿ RuntimeException ç±»å‹çš„å¼‚å¸¸æ—¶ï¼Œä¹Ÿä¼šè¢«æ•è·ï¼Œä»è€Œå¯èƒ½ä¼šæ©ç›–å®é™…çš„å¼‚å¸¸ä¿¡æ¯ã€‚
- åœ¨è°ƒè¯•å’Œæ’é”™æ—¶ï¼Œæ— æ³•ç¡®å®šå¼‚å¸¸çš„å…·ä½“ç±»å‹å’Œå‘ç”ŸåŸå› ï¼Œä»è€Œå¢åŠ äº†è°ƒè¯•å’Œæ’é”™çš„éš¾åº¦ã€‚
- åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå¯èƒ½ä¼šæ•è·ä¸€äº›ä¸éœ€è¦å¤„ç†çš„å¼‚å¸¸ï¼ˆå¦‚ NullPointerExceptionã€IllegalArgumentException ç­‰ï¼‰ï¼Œä»è€Œé™ä½ç¨‹åºçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚

å› æ­¤ï¼Œä¸ºäº†æ›´å¥½åœ°å®šä½å’Œå¤„ç†å¼‚å¸¸ï¼Œåº”è¯¥å°½å¯èƒ½åœ°æ•è·å…·ä½“çš„å­ç±»ï¼Œä¾‹å¦‚ï¼š

```java
try {
    // è¯»å–æ•°æ®çš„ä»£ç 
} catch (FileNotFoundException e) {
    // å¤„ç†æ–‡ä»¶æœªæ‰¾åˆ°å¼‚å¸¸çš„ä»£ç 
} catch (IOException e) {
    // å¤„ç†è¾“å…¥è¾“å‡ºå¼‚å¸¸çš„ä»£ç 
}
```
è¿™æ ·åšå¯ä»¥æ›´å‡†ç¡®åœ°æ•è·å¼‚å¸¸ï¼Œä»è€Œæé«˜ç¨‹åºçš„å¥å£®æ€§å’Œç¨³å®šæ€§ã€‚

### 09ã€è‡ªå®šä¹‰å¼‚å¸¸æ—¶ä¸è¦ä¸¢å¤±å †æ ˆè·Ÿè¸ª

```java
catch (NoSuchMethodException e) {
   throw new MyServiceException("Some information: " + e.getMessage());  //é”™è¯¯æ–¹å¼
}
```

è¿™ç ´åäº†åŸå§‹å¼‚å¸¸çš„å †æ ˆè·Ÿè¸ªï¼Œæ­£ç¡®çš„åšæ³•æ˜¯ï¼š

```java
catch (NoSuchMethodException e) {
   throw new MyServiceException("Some information: " , e);  //æ­£ç¡®æ–¹å¼
}
```

ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼Œå®ƒé‡å†™äº† printStackTrace() æ–¹æ³•æ¥æ‰“å°å †æ ˆè·Ÿè¸ªä¿¡æ¯ï¼š

```java
public class MyException extends Exception {
    public MyException(String message, Throwable cause) {
        super(message, cause);
    }

    @Override
    public void printStackTrace() {
        System.err.println("MyException:");
        super.printStackTrace();
    }
}
```

è¿™æ ·åšå¯ä»¥ä¿ç•™å †æ ˆè·Ÿè¸ªä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æä¾›è‡ªå®šä¹‰çš„å¼‚å¸¸ä¿¡æ¯ã€‚åœ¨æŠ›å‡º MyException å¼‚å¸¸æ—¶ï¼Œå¯ä»¥å¾—åˆ°å®Œæ•´çš„å †æ ˆè·Ÿè¸ªä¿¡æ¯ï¼Œä»è€Œæ›´å¥½åœ°å®šä½å’Œè§£å†³å¼‚å¸¸ã€‚

### 10ã€finally å—ä¸­ä¸è¦æŠ›å‡ºä»»ä½•å¼‚å¸¸

```java
try {
  someMethod();  //Throws exceptionOne
} finally {
  cleanUp();    //å¦‚æœfinallyè¿˜æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆexceptionOneå°†æ°¸è¿œä¸¢å¤±
}
```

finally å—ç”¨äºå®šä¹‰ä¸€æ®µä»£ç ï¼Œæ— è®º try å—ä¸­æ˜¯å¦å‡ºç°å¼‚å¸¸ï¼Œéƒ½ä¼šè¢«æ‰§è¡Œã€‚finally å—é€šå¸¸ç”¨äºé‡Šæ”¾èµ„æºã€å…³é—­æ–‡ä»¶ç­‰å¿…é¡»æ‰§è¡Œçš„æ“ä½œã€‚

å¦‚æœåœ¨ finally å—ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œå¯èƒ½ä¼šå¯¼è‡´åŸå§‹å¼‚å¸¸è¢«æ©ç›–ã€‚æ¯”å¦‚è¯´ä¸Šä¾‹ä¸­ï¼Œä¸€æ—¦ cleanup æŠ›å‡ºå¼‚å¸¸ï¼ŒsomeMethod ä¸­çš„å¼‚å¸¸å°†ä¼šè¢«è¦†ç›–ã€‚

### 11ã€ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ `printStackTrace()`

åœ¨ Java ä¸­ï¼Œ`printStackTrace()` æ–¹æ³•ç”¨äºå°†å¼‚å¸¸çš„å †æ ˆè·Ÿè¸ªä¿¡æ¯è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯æµä¸­ã€‚è¿™ä¸ªæ–¹æ³•å¯¹äºè°ƒè¯•å’Œæ’é”™éå¸¸æœ‰ç”¨ã€‚ä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸åº”è¯¥ä½¿ç”¨ `printStackTrace()` æ–¹æ³•ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š

- `printStackTrace()` æ–¹æ³•å°†å¼‚å¸¸çš„å †æ ˆè·Ÿè¸ªä¿¡æ¯è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯æµä¸­ï¼Œè¿™å¯èƒ½ä¼šæš´éœ²æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚æ–‡ä»¶è·¯å¾„ã€ç”¨æˆ·åã€å¯†ç ç­‰ã€‚
- `printStackTrace()` æ–¹æ³•ä¼šå°†å †æ ˆè·Ÿè¸ªä¿¡æ¯è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯æµä¸­ï¼Œè¿™å¯èƒ½ä¼šå½±å“ç¨‹åºçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚åœ¨é«˜å¹¶å‘çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¤§é‡çš„å¼‚å¸¸å †æ ˆè·Ÿè¸ªä¿¡æ¯å¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒæˆ–å‡ºç°æ„å¤–çš„è¡Œä¸ºã€‚
- ç”±äºç”Ÿäº§ç¯å¢ƒä¸­å¾€å¾€æ˜¯å¤šçº¿ç¨‹ã€åˆ†å¸ƒå¼çš„å¤æ‚ç³»ç»Ÿï¼Œ`printStackTrace()` æ–¹æ³•è¾“å‡ºçš„å †æ ˆè·Ÿè¸ªä¿¡æ¯å¯èƒ½å¹¶ä¸å®Œæ•´æˆ–å‡†ç¡®ã€‚

åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œåº”è¯¥ä½¿ç”¨æ—¥å¿—ç³»ç»Ÿæ¥è®°å½•å¼‚å¸¸ä¿¡æ¯ï¼Œä¾‹å¦‚ [log4j](https://tobebetterjavaer.com/gongju/log4j.html)ã€[slf4j](https://tobebetterjavaer.com/gongju/slf4j.html)ã€[logback](https://tobebetterjavaer.com/gongju/logback.html) ç­‰ã€‚æ—¥å¿—ç³»ç»Ÿå¯ä»¥å°†å¼‚å¸¸ä¿¡æ¯è®°å½•åˆ°æ–‡ä»¶æˆ–æ•°æ®åº“ä¸­ï¼Œè€Œä¸ä¼šæš´éœ²æ•æ„Ÿä¿¡æ¯ï¼Œä¹Ÿä¸ä¼šå½±å“ç¨‹åºçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚åŒæ—¶ï¼Œæ—¥å¿—ç³»ç»Ÿä¹Ÿæä¾›äº†æ›´å¤šçš„åŠŸèƒ½ï¼Œå¦‚çº§åˆ«æ§åˆ¶ã€æ»šåŠ¨æ—¥å¿—ã€é‚®ä»¶é€šçŸ¥ç­‰ã€‚

```java
ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ logback è®°å½•å¼‚å¸¸ä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
try {
    // some code
} catch (Exception e) {
    logger.error("An error occurred: ", e);
}
```

### 12ã€å¯¹äºä¸æ‰“ç®—å¤„ç†çš„å¼‚å¸¸ï¼Œç›´æ¥ä½¿ç”¨ try-finallyï¼Œä¸ç”¨ catch

```java
try {
  method1();  // ä¼šè°ƒç”¨ Method 2
} finally {
  cleanUp();    //do cleanup here
}
```

å¦‚æœ method1 æ­£åœ¨è®¿é—® Method 2ï¼Œè€Œ Method 2 æŠ›å‡ºä¸€äº›ä½ ä¸æƒ³åœ¨ Method 1 ä¸­å¤„ç†çš„å¼‚å¸¸ï¼Œä½†æ˜¯ä»ç„¶å¸Œæœ›åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶è¿›è¡Œä¸€äº›æ¸…ç†ï¼Œå¯ä»¥ç›´æ¥åœ¨ finally å—ä¸­è¿›è¡Œæ¸…ç†ï¼Œä¸è¦ä½¿ç”¨ catch å—ã€‚

### 13ã€è®°ä½æ—© throw æ™š catch åŸåˆ™

â€œæ—© throw, æ™š catchâ€ æ˜¯ Java ä¸­çš„ä¸€ç§å¼‚å¸¸å¤„ç†åŸåˆ™ã€‚è¿™ä¸ªåŸåˆ™æŒ‡çš„æ˜¯åœ¨ä»£ç ä¸­å°½å¯èƒ½æ—©åœ°æŠ›å‡ºå¼‚å¸¸ï¼Œä»¥ä¾¿åœ¨å¼‚å¸¸å‘ç”Ÿæ—¶èƒ½å¤ŸåŠæ—¶åœ°å¤„ç†å¼‚å¸¸ã€‚åŒæ—¶ï¼Œåœ¨ catch å—ä¸­å°½å¯èƒ½æ™šåœ°æ•è·å¼‚å¸¸ï¼Œä»¥ä¾¿åœ¨æ•è·å¼‚å¸¸æ—¶èƒ½å¤Ÿè·å¾—æ›´å¤šçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»è€Œæ›´å¥½åœ°å¤„ç†å¼‚å¸¸ã€‚

æ¥ä¸¾ä¸ª â€œæ—© throwâ€ ä¾‹å­ï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•éœ€è¦ä¼ é€’å‚æ•°ï¼Œå¹¶ä¸”è¯¥å‚æ•°å¿…é¡»æ»¡è¶³ä¸€å®šçš„æ¡ä»¶ï¼Œå¦‚æœå‚æ•°ä¸ç¬¦åˆæ¡ä»¶ï¼Œåˆ™åº”è¯¥ç«‹å³æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œä¸æ˜¯åœ¨æ–¹æ³•ä¸­è¿›è¡Œå…¶ä»–æ“ä½œã€‚è¿™å¯ä»¥ç¡®ä¿å¼‚å¸¸åœ¨å‘ç”Ÿæ—¶èƒ½å¤ŸåŠæ—¶è¢«å¤„ç†ï¼Œé¿å…æ›´ä¸¥é‡çš„é—®é¢˜ã€‚

å†æ¥ä¸¾ä¸ªâ€œæ™š catchâ€çš„ä¾‹å­ï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•è°ƒç”¨äº†å…¶ä»–æ–¹æ³•ï¼Œå¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœåœ¨æ–¹æ³•å†…éƒ¨ç«‹å³æ•è·å¼‚å¸¸ï¼Œåˆ™å¯èƒ½ä¼šå¯¼è‡´å¯¹å¼‚å¸¸çš„å¤„ç†ä¸å……åˆ†ã€‚

æ¥çœ‹è¿™æ®µä»£ç ï¼š

```java
public class ExceptionDemo1 {
    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);
        String str = sc.nextLine();
        try {
            int num = parseInt(str);
            System.out.println("è½¬æ¢ç»“æœï¼š" + num);
        } catch (NumberFormatException e) {
            System.out.println("è½¬æ¢å¤±è´¥ï¼š" + e.getMessage());
        }
    }

    public static int parseInt(String str) {
        if (str == null || "".equals(str)) {
            throw new NullPointerException("å­—ç¬¦ä¸²ä¸ºç©º");
        }
        if (!str.matches("\\d+")) {
            throw new NumberFormatException("å­—ç¬¦ä¸²ä¸æ˜¯æ•°å­—");
        }
        return Integer.parseInt(str);
    }
}
```

è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ª `parseInt()` æ–¹æ³•ï¼Œç”¨äºå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°ã€‚åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œé¦–å…ˆæ£€æµ‹å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™ç«‹å³æŠ›å‡º NullPointerException å¼‚å¸¸ã€‚ç„¶åï¼Œæ£€æµ‹å­—ç¬¦ä¸²æ˜¯å¦ä¸ºæ•°å­—ï¼Œå¦‚æœä¸æ˜¯æ•°å­—ï¼Œåˆ™æŠ›å‡º NumberFormatException å¼‚å¸¸ã€‚æœ€åï¼Œä½¿ç”¨ `Integer.parseInt()` æ–¹æ³•å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°ï¼Œå¹¶è¿”å›ã€‚

åœ¨ç¤ºä¾‹çš„ `main()` æ–¹æ³•ä¸­ï¼Œè°ƒç”¨ `parseInt()` æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨ try-catch å—æ•è·å¯èƒ½æŠ›å‡ºçš„ NumberFormatException å¼‚å¸¸ã€‚å¦‚æœè½¬æ¢æˆåŠŸï¼Œåˆ™è¾“å‡ºè½¬æ¢ç»“æœï¼Œå¦åˆ™è¾“å‡ºè½¬æ¢å¤±è´¥ä¿¡æ¯ã€‚

è¿™ä¸ªç¤ºä¾‹ä½¿ç”¨äº† â€œæ—© throw, æ™š catchâ€ çš„åŸåˆ™ï¼Œåœ¨ `parseInt()` æ–¹æ³•ä¸­å°½å¯èƒ½æ—©åœ°æŠ›å‡ºå¼‚å¸¸ï¼Œåœ¨ `main()` æ–¹æ³•ä¸­å°½å¯èƒ½æ™šåœ°æ•è·å¼‚å¸¸ï¼Œä»¥ä¾¿åœ¨æ•è·å¼‚å¸¸æ—¶èƒ½å¤Ÿè·å¾—æ›´å¤šçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»è€Œæ›´å¥½åœ°å¤„ç†å¼‚å¸¸ã€‚

è¿è¡Œè¯¥ç¤ºä¾‹ï¼Œè¾“å…¥ä¸€ä¸ªæ•°å­—å­—ç¬¦ä¸²ï¼Œå¯ä»¥çœ‹åˆ°è¾“å‡ºè½¬æ¢ç»“æœã€‚å¦‚æœè¾“å…¥ä¸€ä¸ªéæ•°å­—å­—ç¬¦ä¸²ï¼Œåˆ™è¾“å‡ºè½¬æ¢å¤±è´¥ä¿¡æ¯ã€‚

### 14ã€åªæŠ›å‡ºå’Œæ–¹æ³•ç›¸å…³çš„å¼‚å¸¸

ç›¸å…³æ€§å¯¹äºä¿æŒä»£ç çš„æ•´æ´éå¸¸é‡è¦ã€‚ä¸€ç§å°è¯•è¯»å–æ–‡ä»¶çš„æ–¹æ³•ï¼Œå¦‚æœæŠ›å‡º NullPointerExceptionï¼Œé‚£ä¹ˆå®ƒä¸ä¼šç»™ç”¨æˆ·æä¾›æœ‰ä»·å€¼çš„ä¿¡æ¯ã€‚ç›¸åï¼Œå¦‚æœè¿™ç§å¼‚å¸¸è¢«åŒ…è£¹åœ¨è‡ªå®šä¹‰å¼‚å¸¸ä¸­ï¼Œåˆ™ä¼šæ›´å¥½ã€‚NoSuchFileFoundException åˆ™å¯¹è¯¥æ–¹æ³•çš„ç”¨æˆ·æ›´æœ‰ç”¨ã€‚

```java
public class Demo {
    public static void main(String[] args) {
        try {
            int result = divide(10, 0);
            System.out.println("The result is: " + result);
        } catch (ArithmeticException e) {
            System.err.println("Error: " + e.getMessage());
        }
    }

    public static int divide(int a, int b) throws ArithmeticException {
        if (b == 0) {
            throw new ArithmeticException("Division by zero");
        }
        return a / b;
    }
}
```

åœ¨è¯¥ç¤ºä¾‹ä¸­ï¼ŒåªæŠ›å‡ºäº†å’Œæ–¹æ³•ç›¸å…³çš„å¼‚å¸¸ ArithmeticExceptionï¼Œè¿™å¯ä»¥ä½¿ä»£ç æ›´åŠ æ¸…æ™°å’Œæ˜“äºç»´æŠ¤ã€‚

### 15ã€åˆ‡å‹¿åœ¨ä»£ç ä¸­ä½¿ç”¨å¼‚å¸¸æ¥è¿›è¡Œæµç¨‹æ§åˆ¶

åœ¨ä»£ç ä¸­ä½¿ç”¨å¼‚å¸¸æ¥è¿›è¡Œæµç¨‹æ§åˆ¶ä¼šå¯¼è‡´ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œæ€§èƒ½å‡ºç°é—®é¢˜ã€‚

```java
public class Demo {
    public static void main(String[] args) {
        String input = "1,2,3,a,5";
        String[] values = input.split(",");
        for (String value : values) {
            try {
                int num = Integer.parseInt(value);
                System.out.println(num);
            } catch (NumberFormatException e) {
                System.err.println(value + " is not a valid number");
            }
        }
    }
}
```

è™½ç„¶è¿™ä¸ªç¤ºä¾‹å¯ä»¥æ­£ç¡®åœ°å¤„ç†è¾“å…¥å­—ç¬¦ä¸²ä¸­çš„éæ•°å­—å­—ç¬¦ï¼Œä½†æ˜¯å®ƒä½¿ç”¨å¼‚å¸¸è¿›è¡Œæµç¨‹æ§åˆ¶ï¼Œè¿™å°±å¯¼è‡´ä»£ç å˜å¾—æ··ä¹±ã€éš¾ä»¥ç†è§£ã€‚åº”è¯¥ä½¿ç”¨å…¶ä»–åˆé€‚çš„[æ§åˆ¶ç»“æ„](https://tobebetterjavaer.com/basic-grammar/flow-control.html)ï¼ˆå¦‚ ifã€switchã€å¾ªç¯ç­‰ï¼‰æ¥ç®¡ç†ç¨‹åºçš„æµç¨‹ã€‚

### 16ã€å°½æ—©éªŒè¯ç”¨æˆ·è¾“å…¥ä»¥åœ¨è¯·æ±‚å¤„ç†çš„æ—©æœŸæ•è·å¼‚å¸¸

ä¾‹å¦‚ï¼šåœ¨ç”¨æˆ·æ³¨å†Œçš„ä¸šåŠ¡ä¸­ï¼Œå¦‚æœæŒ‰ç…§è¿™æ ·æ¥åšï¼š

1.  éªŒè¯ç”¨æˆ·
2.  æ’å…¥ç”¨æˆ·
3.  éªŒè¯åœ°å€
4.  æ’å…¥åœ°å€
5.  å¦‚æœå‡ºé—®é¢˜å›æ»šä¸€åˆ‡

è¿™æ˜¯ä¸æ­£ç¡®çš„åšæ³•ï¼Œå®ƒä¼šä½¿æ•°æ®åº“åœ¨å„ç§æƒ…å†µä¸‹å¤„äºä¸ä¸€è‡´çš„çŠ¶æ€ï¼Œåº”è¯¥é¦–å…ˆéªŒè¯æ‰€æœ‰å†…å®¹ï¼Œç„¶åå†è¿›è¡Œæ•°æ®åº“æ›´æ–°ã€‚æ­£ç¡®çš„åšæ³•æ˜¯ï¼š

1.  éªŒè¯ç”¨æˆ·
2.  éªŒè¯åœ°å€
3.  æ’å…¥ç”¨æˆ·
4.  æ’å…¥åœ°å€
5.  å¦‚æœé—®é¢˜å›æ»šä¸€åˆ‡

ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ç”¨ JDBC çš„æ–¹å¼å¾€æ•°æ®åº“æ’å…¥æ•°æ®ï¼Œé‚£ä¹ˆæœ€å¥½æ˜¯å…ˆ validate å† insertï¼Œè€Œä¸æ˜¯ validateUserInputã€insertUserDataã€validateAddressInputã€insertAddressDataã€‚

```java
Connection conn = null;
try {
    // Connect to the database
    conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/mydatabase", "username", "password");

    // Start a transaction
    conn.setAutoCommit(false);

    // Validate user input
    validateUserInput();

    // Insert user data
    insertUserData(conn);

    // Validate address input
    validateAddressInput();

    // Insert address data
    insertAddressData(conn);

    // Commit the transaction if everything is successful
    conn.commit();

} catch (SQLException e) {
    // Rollback the transaction if there is an error
    if (conn != null) {
        try {
            conn.rollback();
        } catch (SQLException ex) {
            System.err.println("Error: " + ex.getMessage());
        }
    }
    System.err.println("Error: " + e.getMessage());
} finally {
    // Close the database connection
    if (conn != null) {
        try {
            conn.close();
        } catch (SQLException e) {
            System.err.println("Error: " + e.getMessage());
        }
    }
}
```

### 17ã€ä¸€ä¸ªå¼‚å¸¸åªèƒ½åŒ…å«åœ¨ä¸€ä¸ªæ—¥å¿—ä¸­

ä¸è¦è¿™æ ·åšï¼š

```java
log.debug("Using cache sector A");
log.debug("Using retry sector B");
```

åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸­ï¼Œè¿™æ ·çœ‹èµ·æ¥æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å¦‚æœåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œè¿™ä¸¤è¡Œç´§æŒ¨ç€çš„ä»£ç ä¸­é—´å¯èƒ½ä¼šè¾“å‡ºå¾ˆå¤šå…¶ä»–çš„å†…å®¹ï¼Œå¯¼è‡´é—®é¢˜æŸ¥èµ·æ¥ä¼šå¾ˆéš¾å—ã€‚åº”è¯¥è¿™æ ·åšï¼š

```java
LOGGER.debug("Using cache sector A, using retry sector B");
```

### 18ã€å°†æ‰€æœ‰ç›¸å…³ä¿¡æ¯å°½å¯èƒ½åœ°ä¼ é€’ç»™å¼‚å¸¸

æœ‰ç”¨çš„å¼‚å¸¸æ¶ˆæ¯å’Œå †æ ˆè·Ÿè¸ªéå¸¸é‡è¦ï¼Œå¦‚æœä½ çš„æ—¥å¿—ä¸èƒ½å®šä½å¼‚å¸¸ä½ç½®ï¼Œé‚£è¦æ—¥å¿—æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ

```java
// Log exception message and stack trace
LOGGER.debug("Error reading file", e);
```

åº”è¯¥å°½é‡æŠŠ `String message, Throwable cause` å¼‚å¸¸ä¿¡æ¯å’Œå †æ ˆéƒ½è¾“å‡ºã€‚

### 19ã€ç»ˆæ­¢æ‰è¢«ä¸­æ–­çº¿ç¨‹

```java
while (true) {
  try {
    Thread.sleep(100000);
  } catch (InterruptedException e) {} //åˆ«è¿™æ ·åš
  doSomethingCool();
}
```

InterruptedException æç¤ºåº”è¯¥åœæ­¢ç¨‹åºæ­£åœ¨åšçš„äº‹æƒ…ï¼Œæ¯”å¦‚äº‹åŠ¡è¶…æ—¶æˆ–çº¿ç¨‹æ± è¢«å…³é—­ç­‰ã€‚

åº”è¯¥å°½æœ€å¤§åŠªåŠ›å®Œæˆæ­£åœ¨åšçš„äº‹æƒ…ï¼Œå¹¶å®Œæˆå½“å‰æ‰§è¡Œçš„çº¿ç¨‹ï¼Œè€Œä¸æ˜¯å¿½ç•¥ InterruptedExceptionã€‚ä¿®æ”¹åçš„ç¨‹åºå¦‚ä¸‹ï¼š

```java
while (true) {
  try {
    Thread.sleep(100000);
  } catch (InterruptedException e) {
    break;
  }
}
doSomethingCool();
```

### 20ã€å¯¹äºé‡å¤çš„ try-catchï¼Œä½¿ç”¨æ¨¡æ¿æ–¹æ³•

ç±»ä¼¼çš„ catch å—æ˜¯æ— ç”¨çš„ï¼Œåªä¼šå¢åŠ ä»£ç çš„é‡å¤æ€§ï¼Œé’ˆå¯¹è¿™æ ·çš„é—®é¢˜å¯ä»¥ä½¿ç”¨æ¨¡æ¿æ–¹æ³•ã€‚

ä¾‹å¦‚ï¼Œåœ¨å°è¯•å…³é—­æ•°æ®åº“è¿æ¥æ—¶çš„å¼‚å¸¸å¤„ç†ã€‚

```java
class DBUtil{
    public static void closeConnection(Connection conn){
        try{
            conn.close();
        } catch(Exception ex){
            //Log Exception - Cannot close connection
        }
    }
}
```

è¿™ç±»çš„æ–¹æ³•å°†åœ¨åº”ç”¨ç¨‹åºå¾ˆå¤šåœ°æ–¹ä½¿ç”¨ã€‚ä¸è¦æŠŠè¿™å—ä»£ç æ”¾çš„åˆ°å¤„éƒ½æ˜¯ï¼Œè€Œæ˜¯å®šä¹‰ä¸Šé¢çš„æ–¹æ³•ï¼Œç„¶ååƒä¸‹é¢è¿™æ ·ä½¿ç”¨å®ƒï¼š

```java
public void dataAccessCode() {
    Connection conn = null;
    try{
        conn = getConnection();
        ....
    } finally{
        DBUtil.closeConnection(conn);
    }
}
```

â€œå¥½äº†ï¼Œä¸‰å¦¹ï¼Œå…³äºå¼‚å¸¸å¤„ç†å®è·µå°±å…ˆè®²è¿™ 20 æ¡å§ï¼Œå®é™…å¼€å‘ä¸­ä½ è¿˜ä¼šç¢°åˆ°å…¶ä»–çš„ä¸€äº›å‘ï¼Œè‡ªå·±è¸©ä¸€è¸©å¯èƒ½å°è±¡æ›´æ·±åˆ»ä¸€äº›ã€‚â€æˆ‘è¯´ã€‚

â€œé‚£ä¸‡ä¸€åˆ°æ—¶å€™æˆ‘å·¥ä½œåè¢«é¢†å¯¼éª‚äº†æ€ä¹ˆåŠï¼Ÿâ€ä¸‰å¦¹å§”å±ˆåœ°è¯´ã€‚

â€œæ–°äººå˜›ï¼Œæ€»è¦å†™å‡ ä¸ª bug æ‰èƒ½å¯¹å¾—èµ·æ–°äººè¿™ä¸ªç§°å·å˜›ã€‚â€æˆ‘è½»ææ·¡å†™åœ°è¯´ã€‚

â€œå¥½å§ã€‚â€ä¸‰å¦¹æ— å¥ˆåœ°å¹äº†å£æ°”ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 8.4 ç©ºæŒ‡é’ˆçš„ä¼ è¯´

**ç©ºæŒ‡é’ˆ**ï¼Œå·ç§°å¤©ä¸‹æœ€å¼ºåˆºå®¢ã€‚

ä»–åŸæœ¬ä¸å«è¿™ä¸ªåå­—ï¼Œç©ºæŒ‡é’ˆåŸæœ¬å¤å§“**å¼‚å¸¸**ï¼Œç©ºæŒ‡é’ˆåªä¸è¿‡æ˜¯ä»–çš„æ­¦å™¨ï¼Œä½†ä»–æ€æˆ®è¿‡å¤šï¼Œæ¸æ¸åœ°äººä»¬åªè®°ä½äº†ç©ºæŒ‡é’ˆè¿™ä¸‰ä¸ªå­—ã€‚

å¤©ä¸‹æ­¦åŠŸï¼Œå”¯å¿«ä¸ç ´ï¼Œç©ºæŒ‡é’ˆçš„é’ˆï¼Œä»¥å¿«å’Œè¯¡å¼‚è‘—ç§°ï¼Œç¨æœ‰ä¸æ…ï¼Œä¾¿æ˜¯ä¼¤äº¡ã€‚

... ...

æˆ‘å«ç‹äºŒï¼Œæˆ‘æ¥åˆ°è¿™ä¸ªå¥‡æ€ªçš„ä¸–ç•Œå·²ç»ä¸€å¹´äº†ï¼Œæˆ‘ç­‰äº†ä¸€å¹´ï¼Œç©¿è¶Šé™„èµ çš„è€çˆ·çˆ·ã€æˆ’æŒ‡ã€ç³»ç»Ÿä»€ä¹ˆçš„æˆ‘åˆ°ç°åœ¨éƒ½æ²¡å‘ç°ã€‚

è€Œä¸”è¿™ä¸ªä¸–ç•Œçœ‹èµ·æ¥ä¹Ÿå¤ªå¥‡æ€ªäº†ï¼Œè¿™é‡Œå¥½åƒå«ä»€ä¹ˆÂ **Java**Â å¤§é™†ï¼Œæˆ‘åªçŸ¥é“è¿™ä¸ªä¸–ç•Œçš„æœ€å¼ºè€…å«åšÂ **Object**ï¼Œå¬è¯´æ˜¯ä»€ä¹ˆé“ç¥–çº§çš„å­˜åœ¨ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“æ˜¯ä»€ä¹ˆæ„æ€ï¼Œæ¯•ç«Ÿæˆ‘ç°åœ¨å¥½åƒè¿˜æ˜¯ä¸ªèœé¸¡ï¼Œåˆ«çš„ä¸»è§’ä¸€å¹´éƒ½åº”è¯¥è¦é£å‡ä»™ç•Œäº†å§ï¼Œæˆ‘è¿˜è¿ä¸ªå°ç«çƒéƒ½æ”¾ä¸å‡ºæ¥ã€‚

å“¦ï¼Œå¯¹äº†ï¼Œä¸Šé¢çš„é‚£æ®µè¯æ˜¯æˆ‘åœ¨èŒ¶é¦†å–èŒ¶çš„æ—¶å€™å¬è¯´ä¹¦çš„å…ˆç”Ÿè¯´çš„ï¼Œæ€»è§‰å¾—ç©ºæŒ‡é’ˆè¿™ä¸ªåå­—æ€ªæ€ªçš„ï¼Œå¥½åƒåœ¨ä»€ä¹ˆåœ°æ–¹å¬è¯´è¿‡ã€‚

æˆ‘çš„å¤´ç—›çš„æ¯›ç—…åˆçŠ¯äº†ï¼Œæˆ‘å·²ç»è®°ä¸èµ·æ¥æˆ‘ä¸ºä»€ä¹ˆæ¥åˆ°è¿™é‡Œäº†ï¼Œæˆ‘åªè®°å¾—æˆ‘çš„åå­—å«ç‹äºŒï¼Œå…¶ä»–çš„ï¼Œæˆ‘åªæ„Ÿè§‰è¿™ä¸ªå¥‡æ€ªçš„ä¸–ç•Œæœ‰ä¸€ç§ç†Ÿæ‚‰ï¼Œä½†æ˜¯æˆ‘ä»€ä¹ˆéƒ½è®°ä¸èµ·æ¥äº†ã€‚

ç®—äº†ï¼Œå¾—è¿‡ä¸”è¿‡å§ã€‚

æˆ‘å‡†å¤‡å»æ‰¾ç©ºæŒ‡é’ˆäº†ï¼Œè™½ç„¶å¬è¯´ä»–å¾ˆå¯æ€•ï¼Œä½†æ˜¯å¥½åƒå¬è¯´ä»–ä¸æ˜¯å—œæ€ä¹‹äººï¼Œåº”è¯¥ä¸ä¼šæ»¥æ€æ— è¾œå§ï¼Œç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä¹Ÿåªå¯¹è¿™ä¸‰ä¸ªå­—æœ‰ç†Ÿæ‚‰çš„æ„Ÿè§‰äº†ï¼Œæˆ‘ä¸€å®šè¦æ‰¾åˆ°ä»–ï¼Œæ‰¾å›æˆ‘çš„è®°å¿†ï¼

æˆ‘æ‰“å¬äº†å¾ˆä¹…ï¼ŒåŸæ¥ç©ºæŒ‡é’ˆæ˜¯**å¼‚å¸¸ç»„ç»‡**çš„ä¸‰ä»£å«¡ä¼ ï¼Œå¼‚å¸¸ç»„ç»‡æ˜¯è¿™ä¸ªä¸–ç•Œä¸Šæœ€ææ€–çš„æ€æ‰‹ç»„ç»‡ï¼Œç©ºæŒ‡é’ˆå°±æ˜¯å¼‚å¸¸ç°åœ¨æœ€å‡ºè‰²çš„åˆºå®¢ã€‚

å¬è¯´ç©ºæŒ‡é’ˆå‡ºç”Ÿçš„æ—¶å€™ï¼Œè„–å­ä¸Šå°±æŒ‚ç€ä¸€æ ¹é’ˆï¼Œæ•´ä¸ª Java å¤§é™†é›ªä¸‹ä¸€æœˆä¸åœï¼ŒLinux æ£®æ—å¤šå—é™†åœ°ç›´æ¥æ²‰é™·ï¼Œäºæ˜¯ä»–çš„çˆ¶äº²Â **RuntimeException**Â å°±ç»™ä»–èµ·äº†ç©ºæŒ‡é’ˆè¿™ä¸ªåå­—ã€‚

ç©ºæŒ‡é’ˆå‡ºç”Ÿçš„å¤©ç”Ÿå¼‚è±¡ä¹Ÿå¼•èµ·äº†å¼‚å¸¸ç»„ç»‡é«˜å±‚çš„æ³¨æ„ï¼Œå¬è¯´ä»–çš„ç¥–çˆ¶Â **Exception**ï¼Œè¿˜æœ‰æ•´ä¸ªå¼‚å¸¸ç»„ç»‡çš„é¢†å†›äººç‰©Â **Throwable**Â éƒ½äº²è‡ªæ¥è§äº†ç©ºæŒ‡é’ˆï¼Œå¹¶ä¸”è®¤ä¸ºç©ºæŒ‡é’ˆå¤©èµ‹å¼‚ç¦€ï¼Œæœªæ¥å¯æœŸã€‚

è¦çŸ¥é“ï¼Œ**Throwable**Â å¯æ˜¯Â **Object**Â äº²è‡ªä»»å‘½çš„å¼‚å¸¸ç»„ç»‡å¤´é¢†ã€‚ä½œä¸º Object æœ€å€¼å¾—ä¿¡ä»»çš„äº²ä¿¡ï¼Œè·Ÿéš Object ä¸‡å¹´ä»¥æ¥ï¼Œæ‰€æœ‰çš„è„æ´»ç´¯æ´»éƒ½ä¾é  Thrwoable åˆ›ç«‹çš„å¼‚å¸¸ç»„ç»‡æ¥å¤„ç†ï¼ŒçœŸå¯è°“ä¸€äººä¹‹ä¸‹ï¼Œä¸‡äººä¹‹ä¸Šã€‚

Throwable åªæœ‰ä¸¤ä¸ªäº²å­ï¼Œå°±æ˜¯ Error å’Œ Exceptionï¼Œä¼ è¯´ä¸­ Error å¿ƒç‹ æ‰‹è¾£ï¼Œæ‰‹ä¸‹æ— ä¸€æ´»å£ï¼Œè§è¿‡ Error çš„äººè¿˜èƒ½æ´»ä¸‹æ¥çš„å¯¥å¯¥æ— å‡ ã€‚

æ•´ä¸ªå¤§é™†åªæœ‰ä»–ä»¬ææ€–çš„ä¼ è¯´ï¼Œè°ä¹Ÿä¸çŸ¥é“ä»–ä»¬ä»€ä¹ˆæ—¶å€™å‡ºç°ï¼Œä½†æ˜¯ä¸€æ—¦ä»–ä»¬å‡ºç°ï¼ŒåŸºæœ¬å®£å‘Šç€ä½ å·²ç»æ˜¯ä¸ªæ­»äººäº†ã€‚

è€Œæˆ‘å¬è¯´è¿‡æœ€ææ€–çš„å°±æ˜¯`OutOfMemoryError`Â å’ŒÂ `StackOverflowError`Â è¿™ä¸¤ä½åˆºå®¢ï¼Œå› ä¸ºå¤§é™†ä¸Šæ°¸è¿œæœ‰ä¸€åº§é£äº‘æ¦œæ‚¬æŒ‚åœ¨å¸éƒ½é—¨å£ï¼Œè€Œè¿™ä¸¤ä½ï¼Œä¸€ç›´ä½å±…æ€æ‰‹æ¦œæ¦œé¦–ä½ç½®ï¼Œç©ºæŒ‡é’ˆä¹Ÿåªåªèƒ½å±ˆå±…ç¬¬ä¸‰è€Œå·²ã€‚å½“ç„¶ï¼Œå¤§é™†ä¸å°‘äººéƒ½è®¤ä¸ºç©ºæŒ‡é’ˆä¼šåæ¥å±…ä¸Šã€‚

æˆ‘çš„æ¶ˆæ¯åªæ˜¯æ‰“å¬åˆ°è¿™ä¹ˆå¤šï¼Œæ¥ä¸‹æ¥çš„æ—¥å­ï¼Œæˆ‘èµ°è¿‡æ— æ•°çš„åŸå¸‚ã€è’é‡ï¼Œæˆ‘ç©¿è¿‡æ²™æ¼ ã€ä¸›æ—ï¼Œè¿™ä¸€å¤©ï¼Œç»ˆäºï¼Œæˆ‘æ¥åˆ°äº†å¤§é™†çš„å¸éƒ½--**å †**ã€‚

è¿™ä¸ªåå­—å¬èµ·æ¥ä¹Ÿæœ‰ç‚¹è€³ç†Ÿï¼Œä¸ç®¡ä»–ï¼Œå…ˆè¿›åŸå†è¯´ã€‚

è¿›åŸåæˆ‘å‘ç°è¿™é‡Œéå¸¸è¯¡å¼‚ï¼Œæ•´åº§åŸå¸‚å¥½åƒéƒ½éå¸¸å¹´è½»ï¼Œå¥½åƒè¿ä¸€ä¸ªæˆå¹´äººéƒ½æ²¡æœ‰ï¼è¡—é“ä¸Šç†™ç†™æ”˜æ”˜ç«Ÿç„¶éƒ½æ˜¯å¹´è½»äººã€‚

å¸¦ç€ç–‘æƒ‘ï¼Œæˆ‘èµ°è¿›äº†ä¸€å®¶å«åš*åŒç¦å®¢æ ˆ*çš„é…’æ¥¼ã€‚

â€å®¢å®˜ï¼Œæ‰“å°–è¿˜æ˜¯ä½åº—å•Šï¼Ÿâ€œä¸€ä¸ªå°äºŒæ¨¡æ ·çš„*å°å­©*å¸¦ç€ä¸€ä¸è°„åªšçš„å¯¹æˆ‘è¯´ã€‚

â€ä½åº—ï¼Œå¸¦æˆ‘å»æœ€å¥½çš„æˆ¿é—´ï¼Œè¿™äº›é’±å…ˆæŠ¼ä½ è¿™é‡Œï¼Œä¸å¤Ÿå†è·Ÿæˆ‘è¦ã€‚â€œä¸€è·¯èµ°æ¥ï¼Œå¯¹äºè¿™äº›åœ°æ–¹çš„è¡Œæƒ…æˆ‘ä¹Ÿç®—è½»è½¦ç†Ÿè·¯äº†ã€‚

â€å°æœ‹å‹ï¼Œè¿™é‡Œæ˜¯æ€ä¹ˆå›äº‹ï¼Ÿä½ ä»¬è¿™é‡Œæ²¡æœ‰å¤§äººå—ï¼Ÿâ€œæˆ‘ä¸€è¾¹èµ°ä¸€è¾¹é—®è¿™ä¸ªåªæœ‰æˆ‘ä¸€åŠèº«é«˜çš„å°å­©ï¼Œæ ¹æ®æˆ‘ç›®æµ‹ï¼Œä»–èº«é«˜ä¸è¶…è¿‡1ç±³ï¼Œåº”è¯¥è¿˜åªæœ‰ä¸ƒå…«å²çš„æ ·å­ï¼Œéš¾é“è¿™é‡Œçš„å•†äººå¦‚æ­¤é»‘å¿ƒï¼Œç«Ÿç„¶é›‡ä½£ç«¥å·¥ï¼Œä¸è¿‡è¿™ä¹Ÿä¸è²Œä¼¼ä¸å¯¹ï¼Œå› ä¸ºå‘¨å›´çš„å®¢äººå¥½åƒä¹Ÿéƒ½æ˜¯è¿™èˆ¬å¹´çºªï¼Œä»–ä»¬ç«Ÿç„¶è¿˜æœ‰åœ¨æŠ½çƒŸå–é…’çš„ï¼

â€å®¢å®˜å¯çœŸå¹½é»˜ï¼Œä¸è¿‡æˆ‘çœ‹å®¢å®˜åº”è¯¥æ˜¯åˆšæ¥å¸éƒ½ï¼Œä¸ç’æ‚¨è¯´ï¼Œæ•´ä¸ªå¸éƒ½å°±åŸºæœ¬æ²¡æœ‰è¶…è¿‡15å²çš„äººï¼Œè¶…è¿‡15çš„æ®è¯´éƒ½åœ¨å«åšè€å¹´åŒºçš„å…»è€å»äº†ï¼å°±æ‹¿æˆ‘æ¥è¯´å§ï¼Œæˆ‘ä»Šå¹´å¯ä¸å°äº†ï¼Œæˆ‘éƒ½8å²äº†ï¼Œåƒæˆ‘è¿™èˆ¬å¹´çºªçš„å·²ç»åŠæˆªè…¿è¿ˆè¿›æ£ºæå’¯ã€‚å“ï¼Œè¿™èº«å­ä¹Ÿæ˜¯ä¸€å¹´ä¸å¦‚ä¸€å¹´äº†ã€‚â€œ

çœ‹ç€è¿™ä¸ªå°äºŒä¸€è„¸è®¤çœŸçš„æ ·å­ï¼Œæˆ‘è¶Šå‘è§‰å¾—è¿™åº§åŸå¸‚è¯¡å¼‚èµ·æ¥äº†ï¼8å²ï¼Œä»€ä¹ˆé¬¼ï¼Ÿ8å²ä¸æ˜¯åº”è¯¥åœ¨å®¶é‡Œçœ‹å–œç¾Šç¾Šå—ï¼Ÿï¼è¿˜åŠæˆªè…¿è¿ˆè¿›æ£ºæï¼

â€å¯æ˜¯ä½ çœ‹æˆ‘æ¯”ä½ é«˜è¿™ä¹ˆå¤šï¼Œä½ ä¸è§‰å¾—å¥‡æ€ªå—ï¼Ÿâ€œæˆ‘å¥‡æ€ªçš„é—®ä»–ã€‚

â€æœ‰ä»€ä¹ˆå¥½å¥‡æ€ªçš„ï¼Œè¦ä¸æ˜¯æˆ‘å°æ—¶å€™å–å¤šäº†ä¸‰é¹¿ï¼Œæ²¡å‡†æˆ‘ä¹Ÿé•¿è¿™ä¹ˆé«˜äº†ï¼â€œå°äºŒæœ‰ç‚¹ç”Ÿæ°”çš„å¯¹æˆ‘è¯´ã€‚

è¡Œå§ï¼Œå†è¯´ä¸¤å¥æŠŠä»–æ¿€æ€’äº†ï¼Œè·³èµ·æ¥æ‰“æˆ‘è†ç›–å°±å¤§äº‹ä¸å¦™äº†ã€‚

æ¥ä¸‹æ¥çš„å‡ å¤©ï¼Œç»è¿‡æˆ‘çš„æ‰“æ¢ï¼ŒåŸæ¥æˆ‘åœ¨çš„åœ°æ–¹æ˜¯å«åšå¹´è½»åŒºï¼Œæ•´ä¸ªå¸éƒ½å°±åªæœ‰è¿™ä¸¤ä¸ªåŒºåŸŸï¼Œå¹´è½»åŒºçš„äººå¹´é¾„ç¡®å®æ²¡æœ‰è¶…è¿‡15å²çš„ï¼Œæœ‰äº›äººåˆšå‡ºç”Ÿæ²¡å‡ å¤©å°±æ­»äº†ï¼Œå¯¹æ­¤ï¼Œç”Ÿæ´»åœ¨è¿™é‡Œçš„äººä¹Ÿè§æ€ªä¸æ€ªäº†ã€‚å¯¹äºä»–ä»¬æ¥è¯´ï¼Œå¯„å¸Œæœ›èƒ½æ´»åˆ°è¶…è¿‡15å²è¿›å…¥è€å¹´åŒºå…»è€å°±æ˜¯ä»–ä»¬çš„æ¢¦æƒ³ã€‚

æˆ‘åœ¨æ€€ç–‘æ˜¯ä¸æ˜¯å¼‚å¸¸ç»„ç»‡åœ¨è¿™é‡Œæš—æ€ï¼Œå¯æ˜¯å‘ç°ç»“æœå¹¶ä¸æ˜¯ï¼Œè¿™é‡Œçš„äººè²Œä¼¼å·²ç»ä¹ æƒ¯äº†ï¼Œç”Ÿæ´»å¯¹ä»–ä»¬æ¥è¯´å°±æ˜¯éšä¾¿æ´»æ´»å°±å¥½äº†ï¼Œæ¯æ¬¡çš„æ­»äº¡å¯¹äºä»–ä»¬æ¥è¯´æ¯«æ— å¾å…†ï¼Œå¯èƒ½åˆšè¸¢ç€çƒå‘¢ï¼Œå°±çªç„¶æŒ‚äº†ï¼Œæœ‰çš„ä¸Šç€å•æ‰€çªç„¶å°±æ­»äº†ï¼Œä¸´æ­»å‰è¿ä¸ªå±è‚¡éƒ½æ²¡æ“¦ï¼Œä¸è¯´äº†ï¼Œæœ‰ç‚¹æ¶å¿ƒã€‚

å°±åœ¨æˆ‘ç­‰çš„ä¸è€çƒ¦æƒ³æ‰“ç®—å»è€å¹´åŒºçœ‹çœ‹çš„æ—¶å€™ï¼Œä¸€ä¸ªç©¿ç€é»‘è¡£çš„äººæ‰¾åˆ°äº†æˆ‘ã€‚

â€ä½ æ˜¯è°ï¼Ÿâ€œæˆ‘è­¦æƒ•çš„é—®ä»–ã€‚

â€æœ¬åº§IOExceptionã€‚â€œé»‘è¡£äººç¥æƒ…å†°å†·çš„çœ‹ç€æˆ‘è¯´ã€‚

â€ä½ æ‰¾æˆ‘ä»€ä¹ˆäº‹ï¼Ÿâ€œ

â€è¿™äº›ä½ ä¸ç”¨çŸ¥é“ï¼Œè·Ÿæˆ‘èµ°ä¸€è¶Ÿå§ï¼â€œ

æˆ‘åˆšæƒ³è¯´è¯æ‹’ç»ï¼Œå¼€ä»€ä¹ˆç©ç¬‘ï¼Œè·Ÿä½ ä»¬å¼‚å¸¸ç»„æ‰“äº¤é“çš„äººéæ­»å³æ®‹ï¼Œè°è¦è·Ÿä½ å»ã€‚

ä½†æ˜¯ç”±ä¸å¾—æˆ‘æ‹’ç»ï¼Œæˆ‘åªæ„Ÿè§‰ä¸€é˜µå¤©æ—‹åœ°è½¬ï¼Œæˆ‘æ„Ÿè§‰æˆ‘åœ¨å¤©ä¸Šé£ï¼Œç„¶åæˆ‘å°±å¤±å»äº†æ„è¯†ã€‚å½“æˆ‘é†’æ¥çš„æ—¶å€™ï¼Œæˆ‘å‘ç°æˆ‘èººåœ¨ä¸€å¼ å·¨å¤§çš„åºŠä¸Šï¼Œæ¡Œå­ä¸Šç‚¹ç€ä¸€æ”¯æª€é¦™ï¼Œæ•´ä¸ªæˆ¿é—´åªæœ‰ä¸€å¼ æ¡Œå­ã€ä¸€æŠŠæ¤…å­å’Œæˆ‘èººçš„åœ°æ–¹ã€‚

æˆ¿é—´å¾ˆå°ï¼Œåº”è¯¥åªæœ‰10å‡ ä¸ªå¹³æ–¹ï¼Œä½†æ˜¯æˆ‘ç«Ÿç„¶åˆæœ‰ä¸€ç§ç†Ÿæ‚‰çš„æ„Ÿè§‰ï¼Œè¿™ç§æ„Ÿè§‰è¦ç»•åœ¨æˆ‘å¿ƒå¤´æŒ¥æ•£ä¸å»ã€‚

æ²¡ç­‰æˆ‘å†æƒ³æ›´å¤šï¼Œæˆ¿é—¨æ‰“å¼€äº†ã€‚

â€æ˜¯ä½ ï¼Œä½ æŠŠæˆ‘å¸¦æ¥å¹²ä»€ä¹ˆï¼Ÿâ€œ

â€èµ°å§ï¼Œæœ‰äººè¦è§ä½ ã€‚â€œ

è¿˜æ˜¯ä¸å®¹æˆ‘æŠ—æ‹’ï¼Œå¦‚æœæˆ‘çš„æˆ˜æ–—åŠ›æ˜¯5çš„è¯ï¼Œæˆ‘æƒ³ï¼ŒIOä»–è¯¥æœ‰å¥½å‡ ä¸‡äº†å§ã€‚

åˆæ˜¯è¿™è¯¥æ­»çš„çœ©æ™•æ„Ÿï¼Œä¸è¿‡è¿™æ¬¡æ²¡æœ‰å‡ ç§’é’Ÿï¼Œæˆ‘å°±å‘ç°æˆ‘åœ¨ä¸€ä¸ªèŠ±å›­é‡Œï¼ŒèŠ±å›­ä¸­é—´ä¸€ä¸ªèº«ç©¿é»„è¢çš„ä¸­å¹´äººæ­£åœ¨æ…¢æ‚ æ‚ çš„å–èŒ¶ã€‚åœ¨ä»–èº«ä¸Šæˆ‘æ„Ÿå—ä¸åˆ°ä»»ä½•å¼ºå¤§çš„æ°”æ¯ï¼Œç”šè‡³ä¸å¦‚IOExceptionç»™æˆ‘çš„å‹è¿«æ„Ÿå¼ºçƒˆã€‚è¿™æ˜¯è°ï¼Ÿ

ä¸ç­‰æˆ‘æ€ç»ªé£˜é£ï¼ŒIOExceptionå¼¯è…°èº¬èº«è¯´é“ï¼šâ€é™›ä¸‹ï¼Œäººå¸¦è¿‡æ¥äº†ã€‚â€œ

â€å—¯ï¼Œä½ é€€ä¸‹å§ã€‚â€œä¸­å¹´äººè½¬è¿‡èº«æ¥ï¼Œè„¸ä¸Šä¸æ¯«çœ‹ä¸å‡ºæƒ…ç»ªçš„è¯´é“ã€‚

æˆ‘å¤§æ¦‚çŒœåˆ°äº†è¿™æ˜¯å“ªé‡Œäº†ï¼Œäºæ˜¯ä¹Ÿæ”¾ä¸‹å¿ƒæ¥ï¼Œåœ¨è¿™é‡Œï¼Œæˆ–è®¸èƒ½æ‰¾åˆ°æˆ‘çš„ç­”æ¡ˆã€‚

åæ­£ä»–è¦å¯¹æˆ‘æ€ä¹ˆæ ·ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰åŠæ³•åæŠ—ï¼Œæˆ‘å¾„ç›´ååˆ°ä»–çš„å¯¹é¢ï¼Œçœ‹ç€ä»–è¯´ï¼šâ€æ‚¨å°±æ˜¯Objecté™›ä¸‹å§ï¼Œä¸çŸ¥æ‰¾æˆ‘æ‰€è°“ä½•äº‹ï¼Ÿâ€œ

ä¸­å¹´äººä¹Ÿä¸åœ¨æ„ï¼Œæ²¡æœ‰æ­£é¢å›ç­”æˆ‘çš„é—®é¢˜ï¼Œåè€Œç•¥å¸¦ä¸€ä¸è°ƒä¾ƒçš„è¯´é“ï¼šâ€ä¸ç”¨å’¬æ–‡åš¼å­—ï¼Œè¯´ç‚¹æ­£å¸¸äººçš„è¯å§ã€‚â€œ

... ...

è¿™ä¸æŒ‰å¥—è·¯å‡ºç‰Œå•Šï¼Œæˆ‘è¿™ä¸æ˜¯æ¥ä¹…äº†ï¼Œæ¨¡ä»¿ä½ ä»¬å¤ä»£äººè¯´è¯å˜›ï¼Œæ€ä¹ˆè¿˜åŸ‹æ€¨èµ·æˆ‘æ¥äº†ï¼Ÿï¼

â€é‚£æˆ‘å°±ç›´è¯´äº†ï¼Œæˆ‘æƒ³çŸ¥é“ç©ºæŒ‡é’ˆåœ¨å“ªé‡Œã€‚â€œ

â€ç©ºæŒ‡é’ˆå°±åœ¨çš‡å®«è½®å€¼ï¼Œä½ æ‰¾ä»–å¹²å˜›ï¼Ÿâ€œ

â€æˆ‘æš‚æ—¶ä¸èƒ½è¯´â€œ

â€å‘µå‘µï¼Œä½ å°±ä¸å¥½å¥‡æˆ‘ä¸ºä»€ä¹ˆçŸ¥é“ä½ ï¼Œä¸ºä»€ä¹ˆåˆæŠŠä½ å¸¦è¿‡æ¥ï¼Ÿâ€œ

â€å¥½å¥‡ï¼Œå¯æ˜¯æˆ‘å°±æ˜¯ä¸æƒ³é—®ã€‚â€œ

Objectå–äº†å£èŒ¶ï¼Œä¸ç´§ä¸æ…¢çš„å›é“ï¼šâ€å¹´è½»äººæœ‰æ€§æ ¼æ˜¯å¥½äº‹ï¼Œå¯æ˜¯è¿‡åˆšæ˜“æŠ˜çš„é“ç†ä½ åº”è¯¥æ˜ç™½ã€‚â€œ

â€æˆ‘ä¸æ˜ç™½ï¼Œæˆ‘åœ¨è¿™é‡Œåæ­£ä¹Ÿæ²¡çœ‹è§ä»€ä¹ˆè€äººï¼Œå½“ç„¶ï¼Œé™¤äº†ä½ ã€‚â€œæˆ‘ç†æ‰€å½“ç„¶çš„è®¤ä¸ºè¿™è‚¯å®šæ˜¯Objectæå¾—é¬¼ï¼Œæ•´ä¸ªå¸éƒ½éƒ½æ˜¯å°æœ‹å‹ï¼Œè¦æ˜¯æ²¡æœ‰çŒ«è…»ï¼Œéª—é¬¼å‘¢ï¼

Objectå¬åˆ°è¿™è¯ï¼Œçš±äº†çš±çœ‰ï¼Œä»–æ²‰é»˜äº†ä¸€ä¼šå„¿ï¼Œç¼“ç¼“ç«™èµ·èº«å­èµ°åˆ°ä¸€é¢—æŸ³æ ‘ä¸‹ï¼ŒèƒŒç€æ‰‹è¯´é“ï¼šâ€œä½ ä¸çŸ¥é“è¿™ä¸€åˆ‡æ˜¯ä¸ºä»€ä¹ˆå—ï¼Ÿâ€

åºŸè¯ï¼Œæˆ‘å½“ç„¶ä¸çŸ¥é“äº†ï¼Œæˆ‘çŸ¥é“è¿˜èƒ½é—®ä½ å—ï¼Ÿï¼

åˆæ˜¯æ²‰é»˜... ...è¿™ä¸ªæ°”æ°›è®©æˆ‘æ„Ÿè§‰å¾ˆä¸èˆ’æœã€‚å°±åœ¨æˆ‘å—ä¸äº†æƒ³è¯´è¯çš„æ—¶å€™ï¼ŒObjectçªç„¶è¯´äº†ä¸€å¥ï¼šâ€œå¸¦ä»–å»è§ç©ºæŒ‡é’ˆå§ã€‚â€

â€œæ˜¯ï¼Œé™›ä¸‹ï¼â€çªç„¶ï¼Œä¸€ä¸ªèº«ç©¿çº¢è¢çš„æ¯ç˜¦è€è€…å‡ºç°åœ¨æˆ‘èƒŒåï¼ŒæŠŠæˆ‘å“äº†ä¸€è·³ã€‚

æˆ‘ä¹Ÿä¸æƒ³å†å¤šç”Ÿäº‹ç«¯ï¼Œç›´è§‰å‘Šè¯‰æˆ‘è¿™é‡Œä¸æ˜¯ä¹…ç•™ä¹‹åœ°ï¼Œè™½ç„¶æœ‰ç‚¹è«åå…¶å¦™ï¼Œæˆ‘è¿˜æ˜¯è·Ÿç€çº¢è¢è€è€…æ¥èµ°äº†ã€‚

... ...

â€œé™›ä¸‹ï¼Œæ˜¯ä»–å—ï¼Ÿâ€ä¸€ä¸ªå…‰å¤´å¤§æ±‰çš„èº«å½±åœ¨åŠç©ºè‹¥å½±è‹¥ç°çš„è¯´é“ã€‚

â€œè¿˜ä¸èƒ½ç¡®å®š... ä¸è¿‡ï¼Œç•™ç»™æˆ‘ä»¬çš„æ—¶é—´ä¸å¤šäº†ï¼Œä¸‹ä¸€æ¬¡çš„è½®å›å°±å¿«æ¥äº†ã€‚â€

â€œè½®å›ï¼Œåˆæ˜¯è½®å›ã€‚æˆ‘ä»¬è¿˜æœ‰å¸Œæœ›å—ï¼Ÿâ€å¤§æ±‰å‘¢å–ƒç€ï¼Œä¸çŸ¥é“æ˜¯å¯¹è‡ªå·±è¯´è¿˜æ˜¯å¯¹ä¸­å¹´äººè¯´ã€‚

ä¸­å¹´äººä¾ç„¶èƒŒç€æ‰‹ï¼ŒæŠ¬å¤´æœ›ç€æ¼«å¤©çš„æŸ³çµ®è¯´é“ï¼šâ€œè¿™ä¸€ä¸–ï¼Œè¯¥æ˜¯ä¸ªäº†æ–­äº†ã€‚â€

... ...

æ²¡å¤šä¹…ï¼Œä»–æŠŠæˆ‘å¸¦åˆ°ä¸€ä¸ªæˆ¿é—´é—¨å£ï¼Œä¹Ÿæ˜¯é¢æ— è¡¨æƒ…çš„è¯´é“ï¼šâ€œè¿›å»å§ï¼Œç©ºæŒ‡é’ˆå°±åœ¨é‡Œé¢ã€‚â€

æˆ‘æŒºä½è„šæ­¥ï¼Œè½¬è¿‡èº«é—®ä»–ï¼šâ€œä½ æ˜¯è°ï¼Ÿæˆ‘ä»¬æ˜¯ä¸æ˜¯è§è¿‡ï¼Ÿâ€

çº¢è¢è€è€…æ€ªå¼‚ä¸€ç¬‘ï¼šâ€œä¹Ÿè®¸å§ï¼Œè€å¤«`IndexOutOfBoundsException`ï¼Œç©ºæŒ‡é’ˆä¾¿æ˜¯æˆ‘å¥½å‹ã€‚â€

è¿™ä¸ªåå­—å¯çœŸé•¿ï¼Œæˆ‘å¬è¯´è¿‡ä»–ï¼Œæ®ä¼ é—»ä»–çš„å®åŠ›ä¹Ÿéå¸¸ä¹‹å¼ºï¼Œå¯èƒ½ä¸ä¸‹äºç©ºæŒ‡é’ˆï¼Œéƒ½æ˜¯ä»¥è¯¡å¼‚çš„å‡ºæ‰‹è§’åº¦è‘—ç§°ï¼Œä¸è¿‡ç›¸æ¯”äºç©ºæŒ‡é’ˆçš„å¤§åï¼Œä»–å¥½åƒæ›´ä½è°ƒï¼Œéš¾æ€ªåœ¨çš‡å®«å½“ä¸ªè€å¤ªç›‘ä¸€èˆ¬ã€‚

æˆ‘ä¹Ÿä¸åœ¨å¤šæƒ³ï¼Œç‚¹ç‚¹å¤´ï¼Œèµ°è¿›äº†æˆ¿é—´ã€‚åˆšè¿›æˆ¿é—´ï¼Œæˆ‘å°±çœ‹è§ä¸€ä¸ªä¸€èº«ç™½è¡£çš„èº«å½±èƒŒå¯¹ç€æˆ‘ï¼Œç¬”ç›´çš„èº«å½±å¥½åƒè¦å†²ç ´å¤©é™…ï¼Œèº«ä¸Šçš„æ°”åŠ¿å¼ºå¤§æ— æ¯”ï¼Œè‡³å°‘åœ¨æˆ‘è§è¿‡çš„æ‰€æœ‰äººé‡Œè¶³ä»¥æ’è¿›å‰ä¸‰äº†ã€‚ç©ºæŒ‡é’ˆï¼Œæœç„¶åä¸è™šä¼ ï¼

æˆ‘èµ°åˆ°æˆ¿é—´ä¸­å¤®ï¼Œç¯ç›®å››æœ›æ‰å‘ç°è¿™å¥½åƒæ˜¯ä¸€åº§ç¥ å ‚çš„æ ·å­ï¼Œå°±åœ¨æˆ‘è¿˜åœ¨æ‰“é‡å››å‘¨ä¹‹é™…ï¼Œä¸€é“æ¸…å†·çš„å£°éŸ³ä¼ åˆ°æˆ‘çš„è€³è¾¹ï¼š

â€œä½ èº«ä¸Šçš„æ°”æ¯è®©æˆ‘éå¸¸è®¨åŒï¼â€

ä»–è½¬è¿‡èº«æ¥ï¼Œæˆ‘å‘ç°æˆ‘æ ¹æœ¬çœ‹ä¸æ¸…ç©ºæŒ‡é’ˆé•¿ä»€ä¹ˆæ ·å­ï¼Œä»–çš„è„¸å¥½åƒæ‰“ä¸Šäº†é©¬èµ›å…‹ã€‚å¬åˆ°ä»–çš„è¯ï¼Œæˆ‘å¿ƒé‡Œçš„ç–‘æƒ‘æ›´å¤šäº†ï¼Œæˆ‘åªæ˜¯è§‰å¾—ä»–çš„æ°”æ¯è®©æˆ‘æ„Ÿåˆ°éå¸¸ç†Ÿæ‚‰ï¼Œä»–çš„è¯è®©æˆ‘æœ‰ç‚¹è«åå…¶å¦™ã€‚äºæ˜¯æˆ‘è¯•æ¢é“ï¼š

â€œä½ çŸ¥é“æˆ‘æ˜¯è°ï¼Ÿâ€

å¬åˆ°æˆ‘çš„è¯ï¼Œä»–ä¸€æ­¥æ­¥èµ°è¿›æˆ‘ï¼Œåœ¨æˆ‘èº«è¾¹é—»äº†é—»ï¼Œè¿™è®©æˆ‘ä»€ä¹ˆä¸€ç´§ï¼Œè™½ç„¶æˆ‘æƒ³ææ¸…æ¥šæˆ‘èº«ä¸Šçš„é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä¸æ˜¯å‡ºå–è‚‰ä½“çš„äººï¼Œæˆ‘é€€åä¸€æ­¥è¯´ï¼š

â€œä½ æƒ³å¹²å˜›ï¼Ÿâ€

ç©ºæŒ‡é’ˆçš±ç´§äº†çœ‰å¤´ï¼Œä»¿ä½›è‡ªè¨€è‡ªè¯­é“ï¼šâ€œä¸å¯¹ï¼Œä¸å¯¹ï¼Œè¿™æ˜¯... è§„åˆ™çš„æ°”æ¯ï¼Ÿå¯æ˜¯ä»–æ˜æ˜èº«ä¸Šæ²¡æœ‰ä»»ä½•èƒ½é‡æ³¢åŠ¨ã€‚â€

æˆ‘è§ä»–å¥½åƒé­”æ€”äº†ï¼Œä»¿ä½›åœ¨æ€è€ƒä»€ä¹ˆï¼Œäºæ˜¯è¿ˆæ­¥èµ°åˆ°ä»–åˆšæ‰ç«™ç«‹çš„åœ°æ–¹çœ‹ç€å‰é¢ï¼ŒåŸæ¥ï¼Œè¿™æ˜¯ä»–ä»¬çš„æ—è°±ï¼è¿™é‡Œæ˜¯å¼‚å¸¸çš„ç¥ å ‚ï¼

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/exception/npe-1.jpg)

çœ‹å®Œè¿™å¼ æ—è°±ï¼Œæˆ‘æç„¶å¤§æ‚Ÿï¼Œå¥½åƒæ˜ç™½äº†ä»€ä¹ˆã€‚çªç„¶ï¼Œæˆ‘çš„è„‘è¢‹é‡Œå‡ºç°äº†ä¸€ä¸ªå†°å†·çš„æœºå™¨å£°éŸ³ï¼šâ€œè·å–å¼‚å¸¸æ—è°±ï¼Œå†ç»ƒå®Œæˆåº¦+100ã€‚â€

æˆ‘Kaoï¼Œç³»ç»Ÿï¼Œè¿™æ˜¯ç³»ç»Ÿå•Šï¼Œæˆ‘ä¸ç¦å†…ç‰›æ»¡é¢ï¼Œå•¥ä»»åŠ¡ç³»ç»Ÿå•Šï¼Œä¸€ç‚¹æç¤ºéƒ½æ²¡æœ‰ï¼Œæˆ‘èµ¶ç´§å–Šé“ï¼š

â€œç³»ç»Ÿï¼Œç³»ç»Ÿï¼Œè¿˜åœ¨å—ï¼Ÿåœ¨çº¿ç­‰ï¼ŒæŒºç€æ€¥çš„ã€‚â€å¯æ˜¯æ²¡æœ‰ä»»ä½•å›å¤ï¼è¿™å•¥ç ´ç³»ç»Ÿï¼å°±åœ¨æˆ‘æƒ³ç ´å£å¤§éª‚çš„æ—¶å€™ï¼Œç©ºæŒ‡é’ˆçœ‹åˆ°æˆ‘å’Œä¸ªäºŒå‚»å­ä¼¼çš„å¤§å‘¼å°å«ï¼Œçªç„¶ä¸€è„¸ä¸å¯æ€è®®çš„å¯¹ç€æˆ‘è¯´ï¼š

â€œä½ æ˜æ‚Ÿäº†è§„åˆ™ï¼Ÿâ€

æˆ‘æ„£äº†æ„£ï¼Œå—¯ï¼Ÿéš¾é“æˆ‘ä¸æ˜¯æˆ˜5æ¸£äº†ï¼Ÿè§„åˆ™ä¹‹åŠ›ï¼Ÿå¥½åƒæ˜¯å¾ˆé«˜ç«¯çš„æ ·å­å•Šï¼Ÿ

â€œæ’’è±†æˆå…µï¼â€

â€œå‘¼é£ï¼â€

â€å”¤é›¨ï¼â€œ

â€ä¸´å…µæ–—è€…çš†é˜µåˆ—åœ¨å‰ï¼â€œ

ä¸€ç‚¹ååº”éƒ½æ²¡æœ‰ã€‚ã€‚ã€‚å•¥ç©æ„å„¿ï¼Ÿè¿˜è§„åˆ™ä¹‹åŠ›ï¼Ÿä¹å­—çœŸè¨€éƒ½æ²¡ç”¨å•Šï¼Ÿ

ç©ºæŒ‡é’ˆå¥½åƒéƒ½è’™äº†ï¼Œä»–æ•²äº†æ•²å¤ªé˜³ç©´ï¼Œæ— è¯­çš„çœ‹ç€æˆ‘è¯´ï¼š

â€ä½ ä¸æ˜¯æ¥æ‰¾æˆ‘çš„å—ï¼Ÿè¯´å®Œä½ çš„é—®é¢˜ï¼Œç„¶åç»™æˆ‘æ»šï¼â€œ

å¯¹å•Šï¼Œè¿™ç³»ç»ŸæŠŠæˆ‘æ•´çš„æˆ‘éƒ½å¿˜è®°æˆ‘æ¥å¹²å˜›çš„äº†ï¼Œæˆ‘èµ¶ç´§è¯´ï¼š

â€ä½ è®¤è¯†æˆ‘å¯¹ä¸å¯¹ï¼Œä½ æ˜¯ä¸æ˜¯è§‰å¾—æˆ‘æœ‰ä¸€ç§ç†Ÿæ‚‰çš„æ„Ÿè§‰ï¼Ÿæˆ‘æƒ³çŸ¥é“æˆ‘çš„æ¥å†ï¼â€œ

ç©ºæŒ‡é’ˆåˆæ„£äº†æ„£ï¼Œä»–çœ‹ç€æˆ‘ï¼Œæ²‰é»˜äº†ä¸€ä¼šå„¿ï¼Œå›é“ï¼šâ€œä¸çŸ¥é“ï¼â€

æˆ‘æœ‰ç‚¹å¥‡æ€ªï¼Œçœ‹ä»–ä¸€è„¸ä¾¿ç§˜çš„è¡¨æƒ…åº”è¯¥æ˜¯è§è¿‡æˆ‘çš„ï¼Œä»–ä¸€å®šåœ¨æ’’è°ï¼Œæ—¢ç„¶å¦‚æ­¤...

â€œé‚£ä½ å‘Šè¯‰æˆ‘ä½ ä»¬æœ‰ä»€ä¹ˆåŠæ³•èƒ½åœ¨ä½ ä»¬å¼‚å¸¸çš„æ”»å‡»ä¸‹é˜²èº«å§ï¼Ÿâ€

ç©ºæŒ‡é’ˆå¤§æ€’ï¼Œåˆšæƒ³èµ·èº«è¯´è¯ï¼Œç©ºä¸­çªç„¶ä¼ æ¥ä¸€é“å£°éŸ³ï¼šç­”åº”ä»–çš„è¦æ±‚ï¼

ä»–å†·å“¼ä¸€å£°ï¼Œä¸¢ç»™æˆ‘ä¸€æœ¬ä¹¦ï¼Œä¸Šé¢å†™ç€**catch**ä¸€ä¸ªå­—ï¼Œè¿˜æœ‰ä¸€å—å†™ç€**catch**çš„ä»¤ç‰Œï¼Œå†°å†·çš„è¯´åˆ°ï¼šâ€œä½ æƒ³çŸ¥é“çš„éƒ½åœ¨è¿™é‡Œäº†ã€‚â€è¯´å®Œï¼Œæ‹‚è¢–è€Œå»ã€‚

æˆ‘çœ‹ç€æ¡Œå­ä¸Šçš„è¿™æœ¬ä¹¦ï¼Œæƒ³äº†æƒ³è¿˜æ˜¯ç¿»é˜…èµ·æ¥ã€‚

åŸæ¥`Exception`Â å’Œå®ƒçš„å„¿å­ä»¬ï¼Œé™¤äº†`RuntimeException`Â ä¸€æ”¯ï¼Œéƒ½å«ä½œ`Checked Exception`ï¼Œæˆ‘è¿˜èƒ½ç”¨catchä»¤ç‰Œæ¥å¯¹æŠ—ä»–ä»¬çš„æ”»å‡»ï¼åŒ…æ‹¬ç©ºæŒ‡é’ˆï¼Œä»¥åæˆ‘å°±ä¸æ€•ä»–ä»¬äº†ï¼

å¯æ˜¯ï¼Œä»–ä¸ºä»€ä¹ˆè¦ç»™æˆ‘ï¼Œçœ‹ä»–åˆšæ‰çš„æ ·å­éƒ½æƒ³æ‰“æˆ‘äº†ï¼Œåˆçªç„¶ç»™äº†æˆ‘è¿™äº›ï¼Ÿè¿˜æœ‰ä»–ä¸€ç›´åœ¨è¯´çš„è§„åˆ™ä¹‹åŠ›åˆæ˜¯ä»€ä¹ˆï¼Ÿè¿™åº§åŸå¸‚ä¸ºä»€ä¹ˆåˆè¿™ä¹ˆè¯¡å¼‚ï¼Ÿ

>è½¬è½½é“¾æ¥ï¼š[https://mp.weixin.qq.com/s/PDfd8HRtDZafXl47BCxyGg](https://mp.weixin.qq.com/s/PDfd8HRtDZafXl47BCxyGg)ï¼Œä½œè€…ï¼šè‰¾å°ä»™


----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 8.5 try-catchä¼šå½±å“æ€§èƒ½å—ï¼Ÿ

â€œäºŒå“¥ï¼Œä½ çœ‹ç€è¿™é¬¼ä»£ç ï¼Œç«Ÿç„¶åœ¨ for å¾ªç¯é‡Œé¢æäº†ä¸ª `try-catch`ï¼Œä¸çŸ¥é“`try-catch`æœ‰æ€§èƒ½æŸè€—å—ï¼Ÿâ€ è€ç‹ç…æœ‰å…¶äº‹åœ°æŒ‡ç€å±å¹•é‡Œçš„ä»£ç ï¼š

```java
Â forÂ (intÂ iÂ =Â 0;Â iÂ <Â 5000;Â i++)Â {
Â Â Â Â Â tryÂ {
Â Â Â Â Â Â Â Â Â dosth
Â Â Â Â Â }Â catchÂ (ExceptionÂ e)Â {
Â Â Â Â Â Â Â Â Â e.printStackTrace();
Â Â Â Â Â }
Â }
```

æˆ‘æ¢è¿‡å¤´å»çœ‹äº†çœ¼ä»£ç ï¼Œâ€œé‚£ è€ç‹ä½ è§‰å¾—è¯¥æ€ä¹ˆæ”¹ï¼Ÿâ€

â€œå½“ç„¶æ˜¯æŠŠ `try-catch` æåˆ°å¤–é¢å•Šï¼â€ è€ç‹è„‘å­éƒ½ä¸è½¬ä¸€ä¸‹ï¼Œè„±å£è€Œå‡ºã€‚

â€œä½ æ˜¯ä¸æ˜¯å‚»ï¼Ÿä¸”ä¸è¯´æ€§èƒ½ï¼Œè¿™ä»£ç çš„ç›®çš„æ˜æ˜¾æ˜¯è®©å¾ªç¯å†…éƒ¨å•æ¬¡è°ƒç”¨å‡ºé”™ä¸å½±å“å¾ªç¯çš„è¿è¡Œï¼Œä½ ç§»åˆ°å¤–é¢ï¼Œä¸šåŠ¡é€»è¾‘ä¸å°±å˜äº†å—ï¼â€

è€ç‹æŒ äº†æŒ ä»–çš„åœ°ä¸­æµ·ï¼Œâ€œå¥½åƒä¹Ÿæ˜¯å•Šï¼â€

â€œå›è¿‡å¤´æ¥ï¼Œcatch æ•´ä¸ª for å¾ªç¯å’Œåœ¨å¾ªç¯å†…éƒ¨ catchï¼Œåœ¨ä¸å‡ºé”™çš„æƒ…å†µä¸‹ï¼Œå…¶å®æ€§èƒ½å·®ä¸å¤šã€‚â€ æˆ‘å–ä¸€å£å’–å•¡ä¸ç»æ„åœ°æåˆ°ï¼Œå‡†å¤‡åœ¨ è€ç‹å‰é¢ç§€ä¸€ä¸‹ã€‚

â€œå•¥æ„æ€ï¼Ÿâ€ è€ç‹æœ‰ç‚¹æ‡µåœ°çœ‹ç€æˆ‘ï¼Œâ€œ`try-catch`æ˜¯æœ‰æ€§èƒ½æŸè€—çš„ï¼Œæˆ‘å¯æ˜¯çœ‹è¿‡ç½‘ä¸Šèµ„æ–™çš„ï¼â€

æœç„¶ï¼Œ è€ç‹ä¸Šé’©äº†ï¼Œæˆ‘äºŒè¯ä¸è¯´ç›´æ¥æ‰“å¼€ ideaï¼Œä¸€é¡¿æ“ä½œæ•²äº†ä»¥ä¸‹ä»£ç ï¼š

```java
public class TryCatchTest {
    // ç”¨ @Benchmark æ³¨è§£æ ‡è®°ä¸€ä¸ªæ–¹æ³•ä½œä¸ºåŸºå‡†æµ‹è¯•æ–¹æ³•
    @Benchmark
    public void tryfor(Blackhole blackhole) {
        // ä½¿ç”¨ try-catch è¯­å¥åŒ…è£…ä¸€ä¸ª for å¾ªç¯
        try {
            for (int i = 0; i < 1000; i++) {
                // åœ¨å¾ªç¯ä¸­è°ƒç”¨ Blackhole.consume() æ–¹æ³•
                blackhole.consume(i);
            }
        } catch (Exception e) {
            // æ•è·å¼‚å¸¸å¹¶æ‰“å°å †æ ˆè·Ÿè¸ªä¿¡æ¯
            e.printStackTrace();
        }
    }

    // ç”¨ @Benchmark æ³¨è§£æ ‡è®°å¦ä¸€ä¸ªæ–¹æ³•ä½œä¸ºåŸºå‡†æµ‹è¯•æ–¹æ³•
    @Benchmark
    public void fortry(Blackhole blackhole) {
        // ä½¿ç”¨ for å¾ªç¯åŒ…è£…ä¸€ä¸ª try-catch è¯­å¥
        for (int i = 0; i < 1000; i++) {
            try {
                // åœ¨ try å—ä¸­è°ƒç”¨ Blackhole.consume() æ–¹æ³•
                blackhole.consume(i);
            } catch (Exception e) {
                // æ•è·å¼‚å¸¸å¹¶æ‰“å°å †æ ˆè·Ÿè¸ªä¿¡æ¯
                e.printStackTrace();
            }
        }
    }
}
```

åœ¨è¿™é‡Œï¼Œè¯·å…è®¸æˆ‘è¡¥å……ä¸€äº›æ¦‚å¿µï¼Œä»¥ä¾¿å¤§å®¶èƒ½æ›´å¥½çš„ç†è§£è¿™æ®µä»£ç ã€‚

>ç¬¬ä¸€ä¸ªï¼š`@Benchmark` æ˜¯ä¸€ä¸ªæ¥è‡ªäº JMHï¼ˆJava Microbenchmark Harnessï¼‰åº“çš„æ³¨è§£ï¼Œç”¨æ¥æ ‡è®°ä¸€ä¸ªæ–¹æ³•ä½œä¸ºåŸºå‡†æµ‹è¯•æ–¹æ³•ã€‚JMH æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºç¼–å†™ [Java å¾®åŸºå‡†æµ‹è¯•](https://hezhiqiang8909.gitbook.io/java/docs/javalib/jmh)çš„å·¥å…·åŒ…ï¼ŒåŒ…å«äº†ä¸€äº›ç”¨äºæµ‹è¯• Java ä»£ç æ€§èƒ½å’Œå¾®è°ƒ JVM çš„å·¥å…·å’Œåº“ã€‚ä½¿ç”¨ `@Benchmark` æ³¨è§£æ ‡è®°çš„æ–¹æ³•å°†è¢« JMH è‡ªåŠ¨è¯†åˆ«ä¸ºåŸºå‡†æµ‹è¯•æ–¹æ³•ï¼Œå¹¶åœ¨è¿è¡Œæ—¶è¿›è¡ŒåŸºå‡†æµ‹è¯•ã€‚åœ¨åŸºå‡†æµ‹è¯•æœŸé—´ï¼ŒJMH ä¼šè¿è¡Œè¢«æ ‡è®°çš„æ–¹æ³•å¤šæ¬¡ï¼Œå¹¶æµ‹é‡æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´ã€ååé‡ã€å»¶è¿Ÿç­‰æŒ‡æ ‡ï¼Œå¹¶ç”Ÿæˆç»Ÿè®¡ç»“æœã€‚

>ç¬¬äºŒä¸ªï¼šåœ¨ JMH è¿›è¡ŒåŸºå‡†æµ‹è¯•æ—¶ï¼Œä¸ºäº†é¿å… JIT ç¼–è¯‘å™¨ä¼˜åŒ–æ‰æµ‹è¯•ä»£ç ä¸­çš„æŸäº›æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦åœ¨æµ‹è¯•ä»£ç ä¸­ä½¿ç”¨ä¸€äº›å ä½ç¬¦ï¼Œä»¥ä¾¿è®©ç¼–è¯‘å™¨è®¤ä¸ºè¿™äº›æ“ä½œæ˜¯æœ‰æ„ä¹‰çš„ï¼Œä¸åº”è¯¥è¢«ä¼˜åŒ–æ‰ã€‚`Blackhole.consume()` æ–¹æ³•å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªå ä½ç¬¦ã€‚å®ƒç”¨æ¥å ç”¨ä¸€äº› CPU æ—¶é—´å’Œå†…å­˜ç©ºé—´ï¼Œä»¥ç¡®ä¿æµ‹è¯•ç»“æœçš„å‡†ç¡®æ€§å’Œå¯é æ€§ã€‚

â€œBB ä¸å¦‚ show codeï¼Œçœ‹åˆ°æ²¡ï¼Œ è€ç‹ï¼Œæˆ‘æŠŠ `try-catch` ä» for å¾ªç¯é‡Œé¢æå‡ºæ¥è·Ÿåœ¨forå¾ªç¯é‡Œé¢åšä¸ªå¯¹æ¯”è·‘ä¸€ä¸‹ï¼Œä½ çŒœçŒœä¸¤ä¸ªå·®å¤šå°‘ï¼Ÿâ€

â€œåˆ‡ï¼Œè‚¯å®š tryfor æ€§èƒ½å¥½ï¼Œæƒ³éƒ½ä¸ç”¨æƒ³ï¼Œä¸æ˜¯çš„è¯æˆ‘å€’ç«‹æ´—å¤´ï¼â€ è€ç‹ä¿¡èª“æ—¦æ—¦é“ã€‚

æˆ‘æ‡’å¾—è·Ÿä»–BBï¼Œç›´æ¥å¼€å§‹äº† benchmarkï¼Œè·‘çš„ç»“æœå¦‚ä¸‹ï¼š

![](https://cdn.tobebetterjavaer.com/studymore/try-catch-xingneng-20230326204136.png)

å¯ä»¥çœ‹åˆ°ï¼Œä¸¤è€…çš„æ€§èƒ½ï¼ˆæ•°å­—è¶Šå¤§è¶Šå¥½ï¼‰å…¶å®å·®ä¸å¤šï¼š551063.024 VS 551525.861ã€‚

åœ¨è¿™é‡Œï¼Œç®€å•æ™®åŠä¸€ä¸‹ JMH çš„ä½¿ç”¨æŒ‡å—ã€‚

>ç¬¬ä¸€æ­¥ï¼Œåœ¨ pom.xml æ–‡ä»¶ä¸­åŠ å…¥ä¾èµ–ã€‚

```
<!-- å¼•å…¥ JMH å·¥å…·åŒ… -->
<dependency>
    <groupId>org.openjdk.jmh</groupId>
    <artifactId>jmh-core</artifactId>
    <version>1.35</version>
</dependency>

<dependency>
    <groupId>org.openjdk.jmh</groupId>
    <artifactId>jmh-generator-annprocess</artifactId>
    <version>1.35</version>
</dependency>
```

>ç¬¬äºŒæ­¥ï¼ŒIntellij IDEA ä¸­å®‰è£… JMH æ’ä»¶ã€‚

![](https://cdn.tobebetterjavaer.com/studymore/try-catch-xingneng-20230326200811.png)

>ç¬¬ä¸‰æ­¥ï¼Œåœ¨ä»£ç ç¼–è¾‘å™¨ä¸­ç‚¹å‡»è¿™ä¸ªå¸¦æœ‰æ—¶é—´å’Œè¿è¡Œçš„å›¾æ ‡ã€‚ç„¶åé™é™ç­‰å¾…ç»“æœå°±å¯ä»¥äº†ï¼Œæˆ‘æœ¬æœºï¼ˆ32G å†…å­˜ Intel i7 è·‘äº† 16 åˆ†é’Ÿï¼Œè´¼æ…¢ï¼Œå› ä¸º JMH æ¯”è¾ƒå–œæ¬¢è¿½æ±‚å…¬å¹³å…¬æ­£ğŸ˜‚ï¼‰

![](https://cdn.tobebetterjavaer.com/studymore/try-catch-xingneng-20230326200922.png)

è€ç‹ä¸€çœ‹å‚»äº†ï¼šâ€œè¯´å¥½çš„æ€§èƒ½å½±å“å‘¢ï¼Ÿæ€ä¹ˆæ²¡äº†ï¼Ÿâ€

æˆ‘ç›´æ¥ä¸€ä¸ªjavapï¼Œè®© è€ç‹çœ‹çœ‹ï¼Œå…¶å®ä¸¤ä¸ªå®ç°åœ¨å­—èŠ‚ç å±‚é¢æ²¡å•¥åŒºåˆ«ï¼š

> tryfor çš„å­—èŠ‚ç 

å¼‚å¸¸è¡¨è®°å½•çš„æ˜¯ 0 - 20 è¡Œï¼Œå¦‚æœè¿™äº›è¡Œé‡Œé¢çš„ä»£ç å‡ºç°é—®é¢˜ï¼Œç›´æ¥è·³åˆ° 23 è¡Œå¤„ç†ã€‚

![](https://cdn.tobebetterjavaer.com/studymore/try-catch-xingneng-20230326202911.png)

> fortry çš„å­—èŠ‚ç 

å·®åˆ«ä¹Ÿå°±æ˜¯å¼‚å¸¸è¡¨çš„èŒƒå›´å°ç‚¹ï¼ŒåŒ…çš„æ˜¯ 9-14 è¡Œï¼Œå…¶å®ƒè·Ÿ tryfor éƒ½å·®ä¸å¤šã€‚

![](https://cdn.tobebetterjavaer.com/studymore/try-catch-xingneng-20230326203005.png)

æ‰€ä»¥ä»å­—èŠ‚ç å±‚é¢æ¥çœ‹ï¼Œæ²¡æŠ›é”™ä¸¤è€…çš„æ‰§è¡Œæ•ˆç‡å…¶å®æ²¡å•¥å·®åˆ«ã€‚

â€œé‚£ä¸ºä»€ä¹ˆç½‘ä¸Šæµä¼ ç€`try-catch`ä¼šæœ‰æ€§èƒ½é—®é¢˜çš„è¯´æ³•å•Šï¼Ÿâ€ è€ç‹è§‰å¾—éå¸¸å¥‡æ€ªã€‚

è¿™ä¸ªè¯´æ³•ç¡®å®æœ‰ï¼Œåœ¨ã€ŠEffective Javaã€‹è¿™æœ¬ä¹¦é‡Œå°±æåˆ°äº† `try-catch` æ€§èƒ½é—®é¢˜ï¼š

![](https://cdn.tobebetterjavaer.com/studymore/try-catch-xingneng-20230326203449.png)

æ­£æ‰€è°“å¬è¯ä¸èƒ½å¬ä¸€åŠï¼Œä»¥å‰è¯»ä¹¦æ—¶å€™æœ€æ€•çš„å°±æ˜¯ä¸€çŸ¥åŠè§£ï¼Œå› ä¸ºå®Œå…¨ç†è§£é€‰æ‹©é¢˜èƒ½é€‰å¯¹ï¼Œå®Œå…¨ä¸æ‡‚è’™å¯èƒ½è’™å¯¹ï¼Œä¸€çŸ¥åŠè§£å¿…å®šé€‰åˆ°é”™è¯¯çš„é€‰é¡¹ï¼

ã€ŠEffective Javaã€‹ä¹¦ä¸­è¯´çš„å…¶å®æ˜¯ä¸è¦ç”¨ `try-catch` æ¥ä»£æ›¿æ­£å¸¸çš„ä»£ç ï¼Œä¹¦ä¸­çš„ä¸¾ä¾‹äº†æ­£å¸¸çš„ for å¾ªç¯è‚¯å®šè¿™æ ·å®ç°ï¼š

```java
 for ( Mountain m : range )
    m.climb();
```

ä½†æœ‰ä¸ªå§é¾™ååä¸è¿™æ ·å®ç°ï¼Œè¦é€šè¿‡ Â `try-catch` æ‹ç€å¼¯æ¥å®ç°å¾ªç¯ï¼š

```java
 /* Horrible abuse of exceptions. Don't ever do this! */
try {
    int i = 0;
    while ( true )
        range[i++].climb();
} catch ( ArrayIndexOutOfBoundsException e ) {
}
```

è¿™æ“ä½œæˆ‘åªèƒ½è¯´æœ‰ç‚¹é€†å¤©ï¼Œè¿™ä¸¤ä¸ªå®ç°çš„å¯¹æ¯”å°±æœ‰æ€§èƒ½æŸè€—äº†ã€‚

æˆ‘ä»¬ç›´æ¥å†è·‘ä¸‹æœ‰`try-catch` çš„ä»£ç å’Œæ²¡ `try-catch`çš„ for å¾ªç¯åŒºåˆ«ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
public class TryCatchTest1 {
    @Benchmark
    public void fornotry(Blackhole blackhole) {
        for (int i = 0; i < 1000; i++) {
            blackhole.consume(i);
        }
    }

    @Benchmark
    public void tryfor(Blackhole blackhole) {
        for (int i = 0; i < 1000; i++) {
            try {
                blackhole.consume(i);
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    }
}
```

ç»“æœå¦‚ä¸‹ï¼š

![](https://cdn.tobebetterjavaer.com/studymore/try-catch-xingneng-20230326210303.png)

+-å·®ä¸å¤šï¼Œç›´æ¥çœ‹å‰é¢çš„åˆ†æ•°å¯¹æ¯”ï¼Œæ²¡æœ‰ `ry-catch` çš„æ€§èƒ½ç¡®å®å¥½äº›ï¼Œè¿™ä¹Ÿå’Œä¹¦ä¸­è¯´çš„ `try-catch` ä¼šå½±å“ JVM ä¸€äº›ç‰¹å®šçš„ä¼˜åŒ–è¯´æ³•å»åˆï¼Œä½†æ˜¯å…·ä½“æ²¡æœ‰è¯´å½±å“å“ªäº›ä¼˜åŒ–ï¼Œæˆ‘çŒœæµ‹å¯èƒ½æ˜¯æŒ‡ä»¤é‡æ’ä¹‹ç±»çš„ã€‚

å¥½äº†ï¼Œæˆ‘å†æ€»ç»“ä¸‹æœ‰å…³ `try-catch` æ€§èƒ½é—®é¢˜è¯´æ³•ï¼š

1.  `try-catch` ç›¸æ¯”è¾ƒæ²¡ `try-catch`ï¼Œç¡®å®æœ‰ä¸€å®šçš„æ€§èƒ½å½±å“ï¼Œä½†æ˜¯æ—¨åœ¨ä¸æ¨èæˆ‘ä»¬ç”¨ `try-catch` æ¥ä»£æ›¿æ­£å¸¸èƒ½ä¸ç”¨ `try-catch` çš„å®ç°ï¼Œè€Œä¸æ˜¯ä¸è®©ç”¨ `try-catch`ã€‚
2.  forå¾ªç¯å†…ç”¨ Â `try-catch` å’Œç”¨ `try-catch` åŒ…è£¹æ•´ä¸ª for å¾ªç¯æ€§èƒ½å·®ä¸å¤šï¼Œä½†æ˜¯å…¶å®ä¸¤è€…æœ¬è´¨ä¸Šæ˜¯ä¸šåŠ¡å¤„ç†æ–¹å¼çš„ä¸åŒï¼Œè·Ÿæ€§èƒ½æ‰¯ä¸ä¸Šå…³ç³»ï¼Œå…³é”®çœ‹ä½ çš„ä¸šåŠ¡æµç¨‹å¤„ç†ã€‚
3.  è™½ç„¶çŸ¥é“`try-catch`ä¼šæœ‰æ€§èƒ½å½±å“ï¼Œä½†æ˜¯ä¸šåŠ¡ä¸Šä¸éœ€è¦é¿è®³å…¶ä½¿ç”¨ï¼Œä¸šåŠ¡å®ç°ä¼˜å…ˆï¼ˆåªè¦ä¸æ˜¯ä¹¦ä¸­ä¸¾ä¾‹çš„é‚£ç§é€†å¤©ä»£ç å°±è¡Œï¼‰ï¼Œéç‰¹æ®Šæƒ…å†µä¸‹æ€§èƒ½éƒ½æ˜¯å…¶æ¬¡ï¼Œæœ‰æ„è¯†åœ°é¿å…å¤§èŒƒå›´çš„`try-catch`ï¼Œåª catch éœ€è¦çš„éƒ¨åˆ†å³å¯ï¼ˆæ²¡æŠŠæ¡å…¨ catch ä¹Ÿè¡Œï¼Œä»£ç å®‰å…¨æ‰§è¡Œç¬¬ä¸€ï¼‰ã€‚

â€œå¥½äº†ï¼Œ è€ç‹ä½ æ‡‚äº†æ²¡ï¼Ÿâ€

â€œè¡Œå•ŠäºŒå“¥ï¼ŒBBæ˜¯ä¸€å¥—ä¸€å¥—çš„ï¼Œèµ°è¯·ä½ å–ç‡•éº¦æ‹¿é“ï¼â€  è€ç‹ä¸€æŠŠæ‹‰èµ·æˆ‘ï¼Œæˆ‘ç›´æ¥ä¸€ä¸ªæŒ£è„±ï¼Œâ€œå°‘æ¥ï¼Œæˆ‘åˆšå–è¿‡å’–å•¡ï¼Œä½ é‚£ä¸ªå€’ç«‹æ´—å¤´ï¼Œèµ¶ç´§çš„ï¼â€æˆ‘ç«‹é©¬æ„è¯†åˆ° è€ç‹æƒ³å²”å¼€è¯é¢˜ã€‚

â€œæ´—æ´—æ´—ï¼Œæˆ‘ä»¬å…ˆå–ä¸ªå’–å•¡ï¼Œæ™šä¸Šå›å»ç»™ä½ æ´—ï¼â€

>è½¬è½½é“¾æ¥ï¼š[https://mp.weixin.qq.com/s/H870jLz32oEI_HCMVt1m5Q](https://mp.weixin.qq.com/s/H870jLz32oEI_HCMVt1m5Q)ï¼Œä½œè€…ï¼šyesï¼Œä¿®è®¢å’Œä¼˜åŒ–ï¼šæ²‰é»˜ç‹äºŒ

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)



# ç¬¬ä¹ç« ï¼šå¸¸ç”¨å·¥å…·ç±»


## 9.1 Scannerå·¥å…·ç±»

Java çš„ Scanner ç±»æ˜¯ä¸€ä¸ªæ–¹ä¾¿åœ¨æ§åˆ¶å°æ‰«æç”¨æˆ·è¾“å…¥çš„å·¥å…·ç±»ï¼Œè™½ç„¶å®ƒä¹Ÿå¯ä»¥æ‰«ææ–‡ä»¶å†…å®¹ï¼Œä½†æˆ‘ä»¬é€šå¸¸æ›´å–œæ¬¢å®ƒæ‰®æ¼”å‰é¢çš„è§’è‰²ï¼Œå› ä¸ºæ‰«ææ–‡ä»¶å¯ä»¥é€šè¿‡[æ–‡ä»¶æµ](https://tobebetterjavaer.com/io/file-path.html)æ¥å®Œæˆã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡å‡ ä¸ªç®€å•çš„ç¤ºä¾‹è®²ä¸€ä¸‹ Scanner ç±»ã€‚

### 01ã€æ‰«ææ§åˆ¶å°è¾“å…¥

é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ Scanner ç±»æ¥æ‰«ææ§åˆ¶å°è¾“å…¥ï¼Œå°¤å…¶æ˜¯å¯¹äºåˆå­¦ Java çš„äººæ¥è¯´ï¼Œè¿™æ ·ä¼šéå¸¸çš„é…·ï¼Œå› ä¸ºç»ˆäºå¯ä»¥æ‹¿åˆ°æˆ‘ä»¬è‡ªå·±æƒ³è¦è¾“å…¥çš„æ•°æ®äº†ã€‚

æ¥çœ‹ä¸‹é¢çš„ç¤ºä¾‹ï¼š

```java
Scanner scanner = new Scanner(System.in); // åˆ›å»º Scanner å¯¹è±¡ï¼Œä»æ ‡å‡†è¾“å…¥æµä¸­è¯»å–æ•°æ®
System.out.print("è¯·è¾“å…¥ä¸€ä¸ªæ•´æ•°ï¼š");
int num = scanner.nextInt(); // è·å–ç”¨æˆ·è¾“å…¥çš„æ•´æ•°
System.out.println("æ‚¨è¾“å…¥çš„æ•´æ•°æ˜¯ï¼š" + num);
scanner.nextLine(); // è¯»å–æ¢è¡Œç¬¦ï¼Œé¿å…å½±å“ä¸‹ä¸€æ¬¡è¯»å–
System.out.print("è¯·è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼š");
String str = scanner.nextLine(); // è·å–ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²
System.out.println("æ‚¨è¾“å…¥çš„å­—ç¬¦ä¸²æ˜¯ï¼š" + str);
scanner.close(); // å…³é—­ Scanner å¯¹è±¡
```

è¿è¡Œåå°±å¯ä»¥åœ¨æ§åˆ¶å°äº¤äº’äº†ï¼Œå¯¹äºæ–°æ‰‹æ¥è¯´ï¼Œä¼°è®¡ä¼šè§‰å¾—æ¯”è¾ƒæœ‰è¶£ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/scanner-20230329150001.png)

å…¶ä¸­ System.in è¿”å›çš„æ˜¯ä¸€ä¸ª[å­—èŠ‚è¾“å…¥æµ](https://tobebetterjavaer.com/io/stream.html) InputStreamï¼Œå’Œ System.out åˆšå¥½å¯¹åº”ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/scanner-20230329151635.png)

#### 1ï¼‰nextLine

`nextLine()` æ–¹æ³•ä¼šæ‰«æè¾“å…¥æµä¸­çš„å­—ç¬¦ï¼Œç›´åˆ°é‡åˆ°è¡Œæœ«å°¾çš„æ¢è¡Œç¬¦ `\n`ï¼Œç„¶åå°†è¯¥è¡Œçš„å†…å®¹ä½œä¸ºå­—ç¬¦ä¸²è¿”å›ï¼ŒåŒæ—¶ï¼Œ`nextLine()` ä¼šå°† Scanner å¯¹è±¡çš„ä½ç½®ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œçš„å¼€å¤´ï¼Œä»¥ä¾¿ä¸‹ä¸€æ¬¡è¯»å–æ•°æ®æ—¶ä»ä¸‹ä¸€è¡Œçš„å¼€å¤´å¼€å§‹è¯»å–ã€‚

```java
Scanner scanner = new Scanner(System.in); // åˆ›å»º Scanner å¯¹è±¡ï¼Œä»æ ‡å‡†è¾“å…¥æµä¸­è¯»å–æ•°æ®
System.out.println("è¯·è¾“å…¥å¤šè¡Œæ–‡æœ¬ï¼Œä»¥ç©ºè¡Œç»“æŸï¼š");
StringBuilder sb = new StringBuilder(); // åˆ›å»º StringBuilder å¯¹è±¡ï¼Œç”¨äºä¿å­˜è¯»å–çš„æ–‡æœ¬
String line = scanner.nextLine(); // è¯»å–è¾“å…¥æµä¸­çš„ç¬¬ä¸€è¡Œ
while (!line.isEmpty()) { // å¦‚æœè¯»å–çš„è¡Œä¸ä¸ºç©ºï¼Œåˆ™ç»§ç»­è¯»å–ä¸‹ä¸€è¡Œ
    sb.append(line).append("\n"); // å°†å½“å‰è¡Œçš„å†…å®¹æ·»åŠ åˆ° StringBuilder å¯¹è±¡ä¸­ï¼Œå¹¶æ¢è¡Œ
    line = scanner.nextLine(); // è¯»å–ä¸‹ä¸€è¡Œ
}
System.out.println("æ‚¨è¾“å…¥çš„æ–‡æœ¬æ˜¯ï¼š\n" + sb.toString()); // æ‰“å°è¯»å–çš„æ–‡æœ¬
scanner.close(); // å…³é—­ Scanner å¯¹è±¡
```

#### 2ï¼‰nextInt

`nextInt()` ç”¨äºä»è¾“å…¥æµä¸­è¯»å–ä¸‹ä¸€ä¸ªæ•´æ•°å¹¶è¿”å›ï¼Œå¦‚æœè¾“å…¥æµä¸­æ²¡æœ‰æ•´æ•°ï¼Œæˆ–è€…ä¸æ˜¯æ•´æ•°ï¼Œå°†æŠ›å‡º InputMismatchException å¼‚å¸¸ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/scanner-20230329153155.png)

#### 3ï¼‰å…¶ä»–æ–¹æ³•

é™¤äº†ä»¥ä¸Šä¸¤ä¸ªå¸¸ç”¨çš„æ–¹æ³•ï¼ŒScanner ç±»ä¸­è¿˜æœ‰ä¸€äº›å…¶ä»–çš„æ–¹æ³•ï¼š

- `boolean hasNext()`ï¼šæ£€æŸ¥è¾“å…¥æµæ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªæ ‡è®°ã€‚
- `boolean hasNextLine()`ï¼šæ£€æŸ¥è¾“å…¥æµæ˜¯å¦è¿˜æœ‰ä¸‹ä¸€è¡Œã€‚
- `String next()`ï¼šè¯»å–è¾“å…¥æµä¸­çš„ä¸‹ä¸€ä¸ªæ ‡è®°ï¼ˆä½¿ç”¨é»˜è®¤çš„åˆ†éš”ç¬¦ï¼Œé€šå¸¸æ˜¯ç©ºæ ¼æˆ–æ¢è¡Œç¬¦ï¼‰ã€‚
- `double nextDouble()`ï¼šè¯»å–è¾“å…¥æµä¸­çš„ä¸‹ä¸€ä¸ªåŒç²¾åº¦æµ®ç‚¹æ•°ã€‚

æ¥ä¸ª demo å§ã€‚

```java
Scanner scanner = new Scanner(System.in); // åˆ›å»º Scanner å¯¹è±¡ï¼Œä»æ ‡å‡†è¾“å…¥æµä¸­è¯»å–æ•°æ®
System.out.print("è¯·è¾“å…¥ä¸€ä¸ªæ•´æ•°ï¼š");
if (scanner.hasNextInt()) { // åˆ¤æ–­è¾“å…¥æµä¸­æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªæ•´æ•°
    int num = scanner.nextInt(); // è¯»å–è¾“å…¥æµä¸­çš„ä¸‹ä¸€ä¸ªæ•´æ•°
    System.out.println("æ‚¨è¾“å…¥çš„æ•´æ•°æ˜¯ï¼š" + num);
} else {
    System.out.println("è¾“å…¥çš„ä¸æ˜¯æ•´æ•°ï¼");
}
scanner.nextLine(); // è¯»å–è¾“å…¥æµä¸­çš„æ¢è¡Œç¬¦

System.out.print("è¯·è¾“å…¥å¤šä¸ªå•è¯ï¼Œä»¥ç©ºæ ¼åˆ†éš”ï¼š");
while (scanner.hasNext()) { // åˆ¤æ–­è¾“å…¥æµä¸­æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªæ ‡è®°
    String word = scanner.next(); // è¯»å–è¾“å…¥æµä¸­çš„ä¸‹ä¸€ä¸ªå•è¯
    System.out.println("æ‚¨è¾“å…¥çš„å•è¯æ˜¯ï¼š" + word);
}
scanner.nextLine(); // è¯»å–è¾“å…¥æµä¸­çš„æ¢è¡Œç¬¦

System.out.print("è¯·è¾“å…¥ä¸€ä¸ªå®æ•°ï¼š");
if (scanner.hasNextDouble()) { // åˆ¤æ–­è¾“å…¥æµä¸­æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªå®æ•°
    double num = scanner.nextDouble(); // è¯»å–è¾“å…¥æµä¸­çš„ä¸‹ä¸€ä¸ªå®æ•°
    System.out.println("æ‚¨è¾“å…¥çš„å®æ•°æ˜¯ï¼š" + num);
} else {
    System.out.println("è¾“å…¥çš„ä¸æ˜¯å®æ•°ï¼");
}
scanner.nextLine(); // è¯»å–è¾“å…¥æµä¸­çš„æ¢è¡Œç¬¦

System.out.print("è¯·è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼š");
if (scanner.hasNextLine()) { // åˆ¤æ–­è¾“å…¥æµä¸­æ˜¯å¦æœ‰ä¸‹ä¸€è¡Œ
    String line = scanner.nextLine(); // è¯»å–è¾“å…¥æµä¸­çš„ä¸‹ä¸€è¡Œ
    System.out.println("æ‚¨è¾“å…¥çš„å­—ç¬¦ä¸²æ˜¯ï¼š" + line);
} else {
    System.out.println("è¾“å…¥çš„ä¸æ˜¯å­—ç¬¦ä¸²ï¼");
}
scanner.close(); // å…³é—­ Scanner å¯¹è±¡
```

### 02ã€æ‰«ææ–‡ä»¶

å½“ç„¶äº†ï¼ŒScanner ä¹Ÿæ˜¯å¯ä»¥ç”¨æ¥æ‰«ææ–‡ä»¶çš„ï¼Œæ–¹å¼ä¹Ÿéå¸¸çš„ç®€å•ï¼Œä»¥ä¸‹æ˜¯ä»£ç ç¤ºä¾‹ï¼š

```java
try {
    // åˆ›å»º File å¯¹è±¡ï¼Œè¡¨ç¤ºè¦æ‰«æçš„æ–‡ä»¶
    File file = new File("docs/å®‰è£…ç¯å¢ƒ.md");
    Scanner scanner = new Scanner(file); // åˆ›å»º Scanner å¯¹è±¡ï¼Œä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®
    while (scanner.hasNextLine()) { // åˆ¤æ–­æ–‡ä»¶ä¸­æ˜¯å¦æœ‰ä¸‹ä¸€è¡Œ
        String line = scanner.nextLine(); // è¯»å–æ–‡ä»¶ä¸­çš„ä¸‹ä¸€è¡Œ
        System.out.println(line); // æ‰“å°è¯»å–çš„è¡Œ
    }
    scanner.close(); // å…³é—­ Scanner å¯¹è±¡
} catch (FileNotFoundException e) {
    System.out.println("æ–‡ä»¶ä¸å­˜åœ¨ï¼");
}
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª File å¯¹è±¡ï¼Œè¡¨ç¤ºè¦æ‰«æçš„æ–‡ä»¶ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ Scanner ç±»çš„æ„é€ æ–¹æ³•æ¥åˆ›å»º Scanner å¯¹è±¡ï¼Œå°†æ–‡ä»¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ„é€ æ–¹æ³•ã€‚åœ¨ while å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `hasNextLine()` æ–¹æ³•æ¥åˆ¤æ–­æ–‡ä»¶ä¸­æ˜¯å¦æœ‰ä¸‹ä¸€è¡Œï¼Œå¦‚æœæœ‰ï¼Œåˆ™ä½¿ç”¨ `nextLine()` æ–¹æ³•è¯»å–è¯¥è¡Œå­—ç¬¦ä¸²ï¼Œå¹¶ä½¿ç”¨ `println()` æ–¹æ³•å°†å…¶æ‰“å°å‡ºæ¥ã€‚æœ€åï¼Œæˆ‘ä»¬åœ¨ç¨‹åºç»“æŸå‰ä½¿ç”¨ `close()` æ–¹æ³•å…³é—­ Scanner å¯¹è±¡ã€‚

é™¤äº†ä½¿ç”¨å¾ªç¯+nextLineï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ useDelimiter æ–¹æ³•è®¾ç½®æ–‡ä»¶ç»“æŸç¬¦ `\Z` æ¥è¯»å–æ•´ä¸ªæ–‡ä»¶ã€‚

```java
// åˆ›å»º File å¯¹è±¡ï¼Œè¡¨ç¤ºè¦æ‰«æçš„æ–‡ä»¶
Scanner scanner = new Scanner(new File("docs/å®‰è£…ç¯å¢ƒ.md")); // åˆ›å»º Scanner å¯¹è±¡ï¼Œä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®
scanner.useDelimiter("\\Z"); // è®¾ç½®åˆ†éš”ç¬¦ä¸ºæ–‡ä»¶ç»“å°¾
if (scanner.hasNext()) { // åˆ¤æ–­æ–‡ä»¶ä¸­æ˜¯å¦æœ‰ä¸‹ä¸€è¡Œ
    String content = scanner.next(); // è¯»å–æ–‡ä»¶ä¸­çš„ä¸‹ä¸€è¡Œ
    System.out.println(content); // æ‰“å°è¯»å–çš„è¡Œ
}
scanner.close(); // å…³é—­ Scanner å¯¹è±¡
```

æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ `\Z` è¡¨ç¤ºè¾“å…¥çš„ç»“å°¾ï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶ç»“æŸç¬¦ã€‚åœ¨ Scanner ç±»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `\Z` ä½œä¸ºåˆ†éš”ç¬¦ï¼Œä»¥ä¾¿è¯»å–æ•´ä¸ªæ–‡ä»¶å†…å®¹ã€‚

### 03ã€æŸ¥æ‰¾åŒ¹é…é¡¹

é™¤äº†ä¸Šé¢æåˆ°çš„æ‰«ææ§åˆ¶å°è¾“å…¥æµã€æ–‡ä»¶ï¼ŒScanner è¿˜æä¾›äº†å¦å¤–å››ä¸ªä»¥ find å¼€å¤´çš„æŸ¥æ‰¾åŒ¹é…é¡¹çš„æ–¹æ³•ï¼š

![](https://cdn.tobebetterjavaer.com/stutymore/scanner-20230329162213.png)

æ¥çœ‹ç¤ºä¾‹ï¼š

```java
String input = "good good study, day day up.";
Scanner scanner = new Scanner(input);
String result;

// ä½¿ç”¨ findInLine() æ–¹æ³•æŸ¥æ‰¾å­—ç¬¦ä¸²ä¸­çš„å•è¯
result = scanner.findInLine("study");
System.out.println("findInLine(): " + result); // è¾“å‡º "study"

// ä½¿ç”¨ findWithinHorizon() æ–¹æ³•æŸ¥æ‰¾å­—ç¬¦ä¸²ä¸­çš„å•è¯
scanner = new Scanner(input);
result = scanner.findWithinHorizon("study", 20);
System.out.println("findWithinHorizon(): " + result); // è¾“å‡º "study"

scanner.close(); // å…³é—­ Scanner å¯¹è±¡
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªå­—ç¬¦ä¸² inputï¼Œè¡¨ç¤ºè¦æŸ¥æ‰¾çš„æ–‡æœ¬ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ Scanner ç±»çš„æ„é€ æ–¹æ³•åˆ›å»º Scanner å¯¹è±¡ï¼Œå¹¶å°† input ä½œä¸ºè¾“å…¥æµä¼ é€’ç»™è¯¥å¯¹è±¡ã€‚æ¥ç€ï¼Œæˆ‘ä»¬ä½¿ç”¨ `findInLine()` æ–¹æ³•å’Œ `findWithinHorizon()` æ–¹æ³•åˆ†åˆ«æŸ¥æ‰¾å­—ç¬¦ä¸²ä¸­çš„å•è¯ "study"ã€‚å…¶ä¸­ï¼Œ`findInLine()` æ–¹æ³•åœ¨å½“å‰è¡Œä¸­æŸ¥æ‰¾åŒ¹é…é¡¹ï¼Œè€Œ `findWithinHorizon()` æ–¹æ³•åœ¨æŒ‡å®šçš„é™åˆ¶èŒƒå›´å†…æŸ¥æ‰¾åŒ¹é…é¡¹ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†æŸ¥æ‰¾çš„èŒƒå›´é™åˆ¶ä¸ºå‰ 20 ä¸ªå­—ç¬¦ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`findInLine()` æ–¹æ³•å’Œ `findWithinHorizon()` æ–¹æ³•éƒ½è¿”å›æ‰¾åˆ°çš„åŒ¹é…é¡¹ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…é¡¹ï¼Œåˆ™è¿”å› nullã€‚æ­¤å¤–ï¼Œ`findInLine()` æ–¹æ³•å’Œ `findWithinHorizon()` æ–¹æ³•éƒ½ä¼šå¿½ç•¥é»˜è®¤çš„åˆ†éš”ç¬¦ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥æŒ‡å®šæŸ¥æ‰¾çš„æ¨¡å¼ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å­—ç¬¦ä¸² "study" ä½œä¸ºæŸ¥æ‰¾çš„æ¨¡å¼ã€‚

å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬è¦åœ¨ä¸‹é¢çš„æ–‡ä»¶ä¸­æŸ¥æ‰¾ openjdk è¿™ä¸ªå…³é”®å­—ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/scanner-20230329163743.png)

ä»£ç å°±å¯ä»¥è¿™æ ·å†™ï¼š

```java
// åˆ›å»º File å¯¹è±¡ï¼Œè¡¨ç¤ºè¦æ‰«æçš„æ–‡ä»¶
Scanner scanner = new Scanner(new File("docs/å®‰è£…ç¯å¢ƒ.md")); // åˆ›å»º Scanner å¯¹è±¡ï¼Œä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®
Pattern pattern = Pattern.compile("op..jdk");
String result;
while ((result = scanner.findWithinHorizon(pattern, 0)) != null) {
    System.out.println("findWithinHorizon(): " + result);
}
```

æˆ‘ä»¬ç”¨æ­£åˆ™è¡¨è¾¾å¼ pattern æ¥è¡¨ç¤º `openjdk` è¿™ä¸ªå…³é”®å­—ï¼Œ`op..jdk` ä¸­çš„ `.` è¡¨ç¤ºä»»æ„å­—ç¬¦ï¼Œå¯ä»¥é€šè¿‡æŸ¥æ‰¾æ­£åˆ™è¡¨è¾¾å¼å»äº†è§£ã€‚

ç„¶åæˆ‘ä»¬ä½¿ç”¨ while å¾ªç¯æ¥æŸ¥æ‰¾æ–‡ä»¶ä¸­æ‰€æœ‰çš„ `openjdk`ï¼Œå…¶ä¸­ findWithinHorizon æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°å¦‚æœä¸º 0 åˆ™è¡¨ç¤ºå¿½ç•¥è¾¹ç•Œï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œä¼šè¿”å› nullã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/scanner-20230329165146.png)

ç”±äºæ–‡ä»¶ä¸­æœ‰ä¸¤ä¸ª openjdk å…³é”®å­—ï¼Œæ‰€ä»¥è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

![](https://cdn.tobebetterjavaer.com/stutymore/scanner-20230329165213.png)

### 04ã€å°ç»“

æ€»ä¹‹ï¼ŒScanner ç±»æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„è¾“å…¥å¤„ç†å·¥å…·ç±»ï¼Œä¸ä»…å¯ä»¥æ‰«ææ§åˆ¶å°çš„è¾“å…¥æµï¼Œè¿˜å¯ä»¥æ‰«ææ–‡ä»¶ï¼Œå¹¶ä¸”æä¾›äº†å¤šç§æ–¹æ³•æ¥è¯»å–ä¸åŒç±»å‹çš„æ•°æ®ï¼Œæ¯”å¦‚ `next()`, `nextInt()`, `nextLine()`, `nextDouble()` ç­‰ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ `useDelimiter()` æ–¹æ³•è®¾ç½®åˆ†éš”ç¬¦ï¼Œé€šè¿‡ `findInLine()`, `findWithinHorizon()` æŸ¥æ‰¾åŒ¹é…é¡¹ç­‰ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 9.2 Arrayså·¥å…·ç±»

â€œå“¥ï¼Œæ•°ç»„ä¸“ç”¨å·¥å…·ç±»æ˜¯ä¸“é—¨ç”¨æ¥æ“ä½œ[æ•°ç»„](https://tobebetterjavaer.com/array/array.html)çš„å—ï¼Ÿæ¯”å¦‚è¯´åˆ›å»ºæ•°ç»„ã€æ•°ç»„æ’åºã€æ•°ç»„æ£€ç´¢ç­‰ç­‰ã€‚â€ä¸‰å¦¹çš„æé—®å…¶å®å·²ç»æŠŠç­”æ¡ˆè¯´äº†å‡ºæ¥ã€‚

â€œæ˜¯æ»´ï¼Œè¿™é‡Œè¯´çš„æ•°ç»„ä¸“ç”¨å·¥å…·ç±»æŒ‡çš„æ˜¯ `java.util.Arrays` ç±»ï¼ŒåŸºæœ¬ä¸Šå¸¸è§çš„æ•°ç»„æ“ä½œï¼Œè¿™ä¸ªç±»éƒ½æä¾›äº†é™æ€æ–¹æ³•å¯ä¾›ç›´æ¥è°ƒç”¨ã€‚æ¯•ç«Ÿæ•°ç»„æœ¬èº«æƒ³å®Œæˆè¿™äº›æ“ä½œè¿˜æ˜¯æŒºéº»çƒ¦çš„ï¼Œæœ‰äº†è¿™å±‚å°è£…ï¼Œå°±æ–¹ä¾¿å¤šäº†ã€‚â€åœ¨å›ç­”ä¸‰å¦¹çš„åŒæ—¶ï¼Œæˆ‘æ‰“å¼€ Intellij IDEAï¼Œæ‰¾åˆ°äº† Arrays ç±»çš„æºç ã€‚

```java
package java.util;
/**
 * @author Josh Bloch
 * @author Neal Gafter
 * @author John Rose
 * @since  1.2
 */
public class Arrays {}
```

â€œå…·ä½“æ¥è¯´ï¼Œæ•°ç»„æ“ä½œå¯åˆ†ä¸ºä»¥ä¸‹ 9 ç§ã€‚â€

- åˆ›å»ºæ•°ç»„
- æ¯”è¾ƒæ•°ç»„
- æ•°ç»„æ’åº
- æ•°ç»„æ£€ç´¢
- æ•°ç»„è½¬æµ
- æ‰“å°æ•°ç»„
- æ•°ç»„è½¬ List
- setAllï¼ˆæ²¡æƒ³å¥½ä¸­æ–‡åï¼‰
- parallelPrefixï¼ˆæ²¡æƒ³å¥½ä¸­æ–‡åï¼‰

â€œæˆ‘ä»¬æ¥ä¸€ä¸ªä¸€ä¸ªå­¦ä¹ ã€‚â€

### 01ã€åˆ›å»ºæ•°ç»„

ä½¿ç”¨ Arrays ç±»åˆ›å»ºæ•°ç»„å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•ï¼š

- copyOfï¼Œå¤åˆ¶æŒ‡å®šçš„æ•°ç»„ï¼Œæˆªå–æˆ–ç”¨ null å¡«å……
- copyOfRangeï¼Œå¤åˆ¶æŒ‡å®šèŒƒå›´å†…çš„æ•°ç»„åˆ°ä¸€ä¸ªæ–°çš„æ•°ç»„
- fillï¼Œå¯¹æ•°ç»„è¿›è¡Œå¡«å……

#### 1ï¼‰copyOf

ç›´æ¥æ¥çœ‹ä¾‹å­ï¼š

```java
String[] intro = new String[] { "æ²‰", "é»˜", "ç‹", "äºŒ" };
String[] revised = Arrays.copyOf(intro, 3);
String[] expanded = Arrays.copyOf(intro, 5);
System.out.println(Arrays.toString(revised));
System.out.println(Arrays.toString(expanded));
```

revised å’Œ expanded æ˜¯å¤åˆ¶åçš„æ–°æ•°ç»„ï¼Œé•¿åº¦åˆ†åˆ«æ˜¯ 3 å’Œ 5ï¼ŒæŒ‡å®šçš„æ•°ç»„é•¿åº¦æ˜¯ 4ã€‚æ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœï¼š

```
[æ²‰, é»˜, ç‹]
[æ²‰, é»˜, ç‹, äºŒ, null]
```

çœ‹åˆ°æ²¡ï¼Ÿrevised æˆªå–äº†æœ€åä¸€ä½ï¼Œå› ä¸ºé•¿åº¦æ˜¯ 3 å˜›ï¼›expanded ç”¨ null å¡«å……äº†ä¸€ä½ï¼Œå› ä¸ºé•¿åº¦æ˜¯ 5ã€‚

ArrayListï¼ˆå†…éƒ¨çš„æ•°æ®ç»“æ„ç”¨çš„å°±æ˜¯æ•°ç»„ï¼‰æºç ä¸­çš„ `grow()` æ–¹æ³•å°±è°ƒç”¨äº† `copyOf()` æ–¹æ³•ï¼šå½“ ArrayList åˆå§‹å¤§å°ä¸æ»¡è¶³å…ƒç´ çš„å¢é•¿æ—¶å°±ä¼šæ‰©å®¹ã€‚

```java
private Object[] grow(int minCapacity) {
    return elementData = Arrays.copyOf(elementData,
            newCapacity(minCapacity));
}
```

#### 2ï¼‰copyOfRange

ç›´æ¥æ¥çœ‹ä¾‹å­ï¼š

```java
String[] intro = new String[] { "æ²‰", "é»˜", "ç‹", "äºŒ" };
String[] abridgement = Arrays.copyOfRange(intro, 0, 3);
System.out.println(Arrays.toString(abridgement));
```

`copyOfRange()` æ–¹æ³•éœ€è¦ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æŒ‡å®šçš„æ•°ç»„ï¼Œç¬¬äºŒä¸ªæ˜¯èµ·å§‹ä½ç½®ï¼ˆåŒ…å«ï¼‰ï¼Œç¬¬ä¸‰ä¸ªæ˜¯æˆªæ­¢ä½ç½®ï¼ˆä¸åŒ…å«ï¼‰ã€‚æ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœï¼š

```java
[æ²‰, é»˜, ç‹]
```

0 çš„ä½ç½®æ˜¯â€œæ²‰â€ï¼Œ3 çš„ä½ç½®æ˜¯â€œäºŒâ€ï¼Œä¹Ÿå°±æ˜¯è¯´æˆªå–äº†ä» 0 ä½ï¼ˆåŒ…å«ï¼‰åˆ° 3 ä½ï¼ˆä¸åŒ…å«ï¼‰çš„æ•°ç»„å…ƒç´ ã€‚é‚£å‡å¦‚è¯´ä¸‹æ ‡è¶…å‡ºäº†æ•°ç»„çš„é•¿åº¦ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ

```java
String[] abridgementExpanded = Arrays.copyOfRange(intro, 0, 6);
System.out.println(Arrays.toString(abridgementExpanded));
```

ç»“æŸä½ç½®æ­¤æ—¶ä¸º 6ï¼Œè¶…å‡ºäº†æŒ‡å®šæ•°ç»„çš„é•¿åº¦ 4ï¼Œæ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœï¼š

```
[æ²‰, é»˜, ç‹, äºŒ, null, null]
```

ä»ç„¶ä½¿ç”¨äº† null è¿›è¡Œå¡«å……ã€‚

â€œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿâ€ç»è¿‡è¿™æ®µæ—¶é—´çš„å­¦ä¹ ï¼Œä¸‰å¦¹çš„çœ¼å…‰è¶Šæ¥è¶Šæ¯’è¾£äº†ï¼Œé—®çš„é—®é¢˜éƒ½æ°åˆ°å¥½å¤„ã€‚

â€œå—¯ï¼Œæˆ‘æƒ³æ˜¯ Arrays çš„è®¾è®¡è€…è€ƒè™‘åˆ°äº†æ•°ç»„è¶Šç•Œçš„é—®é¢˜ï¼Œä¸ç„¶æ¯æ¬¡è°ƒç”¨ Arrays ç±»å°±è¦å…ˆåˆ¤æ–­å¾ˆå¤šæ¬¡é•¿åº¦ï¼Œå¾ˆéº»çƒ¦ã€‚â€ç¨ä½œæ€è€ƒåï¼Œæˆ‘ç»™å‡ºäº†è¿™æ ·ä¸€ä¸ªå›ç­”ã€‚

#### 3ï¼‰fill

ç›´æ¥æ¥çœ‹ä¾‹å­ï¼š

```java
String[] stutter = new String[4];
Arrays.fill(stutter, "æ²‰é»˜ç‹äºŒ");
System.out.println(Arrays.toString(stutter));
```

ä½¿ç”¨ new å…³é”®å­—åˆ›å»ºäº†ä¸€ä¸ªé•¿åº¦ä¸º 4 çš„æ•°ç»„ï¼Œç„¶åä½¿ç”¨ `fill()` æ–¹æ³•å°† 4 ä¸ªä½ç½®å¡«å……ä¸ºâ€œæ²‰é»˜ç‹äºŒâ€ï¼Œæ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœï¼š

```
[æ²‰é»˜ç‹äºŒ, æ²‰é»˜ç‹äºŒ, æ²‰é»˜ç‹äºŒ, æ²‰é»˜ç‹äºŒ]
```

å¦‚æœæƒ³è¦ä¸€ä¸ªå…ƒç´ å®Œå…¨ç›¸åŒçš„æ•°ç»„æ—¶ï¼Œ `fill()` æ–¹æ³•å°±æ´¾ä¸Šç”¨åœºäº†ã€‚

### 02ã€æ¯”è¾ƒæ•°ç»„

Arrays ç±»çš„ `equals()` æ–¹æ³•ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªæ•°ç»„æ˜¯å¦ç›¸ç­‰ï¼Œæ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š

```java
String[] intro = new String[] { "æ²‰", "é»˜", "ç‹", "äºŒ" };
boolean result = Arrays.equals(new String[] { "æ²‰", "é»˜", "ç‹", "äºŒ" }, intro);
System.out.println(result);
boolean result1 = Arrays.equals(new String[] { "æ²‰", "é»˜", "ç‹", "ä¸‰" }, intro);
System.out.println(result1);
```

è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
true
false
```

æŒ‡å®šçš„æ•°ç»„ä¸ºæ²‰é»˜ç‹äºŒå››ä¸ªå­—ï¼Œæ¯”è¾ƒçš„æ•°ç»„ä¸€ä¸ªæ˜¯æ²‰é»˜ç‹äºŒï¼Œä¸€ä¸ªæ˜¯æ²‰é»˜ç‹ä¸‰ï¼Œæ‰€ä»¥ result ä¸º trueï¼Œresult1 ä¸º falseã€‚

ç®€å•çœ‹ä¸€ä¸‹ `equals()` æ–¹æ³•çš„æºç ï¼š

```java
public static boolean equals(Object[] a, Object[] a2) {
    if (a==a2)
        return true;
    if (a==null || a2==null)
        return false;

    int length = a.length;
    if (a2.length != length)
        return false;

    for (int i=0; i<length; i++) {
        if (!Objects.equals(a[i], a2[i]))
            return false;
    }

    return true;
}
```

å› ä¸ºæ•°ç»„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥å…ˆä½¿ç”¨â€œ==â€æ“ä½œç¬¦è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œå†åˆ¤æ–­æ˜¯å¦ä¸º nullï¼Œå…¶ä¸­ä¸€ä¸ªä¸º nullï¼Œè¿”å› falseï¼›ç´§æ¥ç€åˆ¤æ–­ lengthï¼Œä¸ç­‰çš„è¯ï¼Œè¿”å› falseï¼›å¦åˆ™çš„è¯ï¼Œä¾æ¬¡è°ƒç”¨ `Objects.equals()` æ¯”è¾ƒç›¸åŒä½ç½®ä¸Šçš„å…ƒç´ æ˜¯å¦ç›¸ç­‰ã€‚

â€œè¿™æ®µä»£ç è¿˜æ˜¯éå¸¸ä¸¥è°¨çš„ï¼Œå¯¹å§ï¼Ÿä¸‰å¦¹ï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬å­¦ä¹ æºç çš„æ„ä¹‰ï¼Œæ¬£èµçš„åŒæ—¶ï¼Œå¯ä»¥å­¦ä¹ æºç ä½œè€…æ¸…æ™°çš„ç¼–ç æ€è·¯ã€‚â€æˆ‘è¯­é‡å¿ƒé•¿åœ°ç»™ä¸‰å¦¹è®²ã€‚

é™¤äº† `equals()` æ–¹æ³•ï¼Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªè¯€çªå¯ä»¥åˆ¤æ–­ä¸¤ä¸ªæ•°ç»„æ˜¯å¦ç›¸ç­‰ï¼Œå°½ç®¡å¯èƒ½ä¼šå‡ºç°è¯¯å·®ã€‚é‚£å°±æ˜¯ `Arrays.hashCode()` æ–¹æ³•ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹è¯¥æ–¹æ³•çš„æºç ï¼š

```java
public static int hashCode(Object a[]) {
    if (a == null)
        return 0;

    int result = 1;

    for (Object element : a)
        result = 31 * result + (element == null ? 0 : element.hashCode());

    return result;
}
```

å“ˆå¸Œç®—æ³•æœ¬èº«æ˜¯éå¸¸ä¸¥è°¨çš„ï¼Œæ‰€ä»¥å¦‚æœä¸¤ä¸ªæ•°ç»„çš„å“ˆå¸Œå€¼ç›¸ç­‰ï¼Œé‚£å‡ ä¹å¯ä»¥åˆ¤æ–­ä¸¤ä¸ªæ•°ç»„æ˜¯ç›¸ç­‰çš„ã€‚

```java
String[] intro = new String[] { "æ²‰", "é»˜", "ç‹", "äºŒ" };

System.out.println(Arrays.hashCode(intro));
System.out.println(Arrays.hashCode(new String[] { "æ²‰", "é»˜", "ç‹", "äºŒ" }));
```

æ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœï¼š

```
868681617
868681617
```

ä¸¤ä¸ªæ•°ç»„çš„å“ˆå¸Œå€¼ç›¸ç­‰ï¼Œæ¯•ç«Ÿå…ƒç´ æ˜¯ä¸€æ ·çš„ã€‚ä½†è¿™æ ·ç¡®å®ä¸å¤Ÿä¸¥è°¨ï¼Œä¼˜å…ˆä½¿ç”¨ `Objects.equals()` æ–¹æ³•ï¼Œå½“æˆ‘ä»¬æƒ³å¿«é€Ÿç¡®è®¤ä¸¤ä¸ªæ•°ç»„æ˜¯å¦ç›¸ç­‰æ—¶ï¼Œå¯ä»¥é€šè¿‡æ¯”è¾ƒ hashCode æ¥ç¡®è®¤â€”â€”ç®—æ˜¯æŠ•æœºå–å·§å§ï¼Œé«˜æ”¶ç›Šé«˜é£é™©ï¼Œå“ˆå“ˆã€‚

### 03ã€æ•°ç»„æ’åº

Arrays ç±»çš„ `sort()` æ–¹æ³•ç”¨æ¥å¯¹æ•°ç»„è¿›è¡Œæ’åºï¼Œæ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š

```java
String[] intro1 = new String[] { "chen", "mo", "wang", "er" };
String[] sorted = Arrays.copyOf(intro1, 4);
Arrays.sort(sorted);
System.out.println(Arrays.toString(sorted));
```

ç”±äºæ’åºä¼šæ”¹å˜åŸæœ‰çš„æ•°ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨äº† `copyOf()` æ–¹æ³•é‡æ–°å¤åˆ¶äº†ä¸€ä»½ã€‚æ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœï¼š

```
[chen, er, mo, wang]
```

å¯ä»¥çœ‹å¾—å‡ºï¼ŒæŒ‰ç…§çš„æ˜¯é¦–å­—æ¯çš„å‡åºè¿›è¡Œæ’åˆ—çš„ã€‚åŸºæœ¬æ•°æ®ç±»å‹æ˜¯æŒ‰ç…§åŒè½´å¿«é€Ÿæ’åºçš„ï¼Œå¼•ç”¨æ•°æ®ç±»å‹æ˜¯æŒ‰ç…§ TimSort æ’åºçš„ï¼Œä½¿ç”¨äº† Peter McIlroy çš„â€œä¹è§‚æ’åºå’Œä¿¡æ¯ç†è®ºå¤æ‚æ€§â€ä¸­çš„æŠ€æœ¯ã€‚

â€œå“¥ï¼Œä½ è¯´çš„è¿™äº›æ’åºç®—æ³•æˆ‘éƒ½ä¸å¤ªæ‡‚å•Šï¼â€ä¸‰å¦¹çœ¨å·´çœ¨å·´çœ¼ç›è¯´ã€‚

â€œä¸è¦ç´§çš„ï¼Œåé¢å­¦äº†æ•°æ®ç»“æ„ä¸ç®—æ³•åï¼Œå°±æ˜ç™½äº†ï¼Œç°åœ¨äº†è§£è¿™ä¸ªä¸œè¥¿å³å¯ã€‚â€æˆ‘èµ¶ç´§ç”©å‡ºäº†å®‰æŠšå¤§æ³•ã€‚

### 04ã€æ•°ç»„æ£€ç´¢

æ•°ç»„æ’åºåå°±å¯ä»¥ä½¿ç”¨ Arrays ç±»çš„ `binarySearch()` æ–¹æ³•è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾äº†ã€‚å¦åˆ™çš„è¯ï¼Œåªèƒ½çº¿æ€§æ£€ç´¢ï¼Œæ•ˆç‡å°±ä¼šä½å¾ˆå¤šã€‚

```java
String[] intro1 = new String[] { "chen", "mo", "wang", "er" };
String[] sorted = Arrays.copyOf(intro1, 4);
Arrays.sort(sorted);
int exact = Arrays.binarySearch(sorted, "wang");
System.out.println(exact);
int caseInsensitive = Arrays.binarySearch(sorted, "Wang", String::compareToIgnoreCase);
System.out.println(caseInsensitive);
```

 `binarySearch()` æ–¹æ³•æ—¢å¯ä»¥ç²¾ç¡®æ£€ç´¢ï¼Œä¹Ÿå¯ä»¥æ¨¡ç³Šæ£€ç´¢ï¼Œæ¯”å¦‚è¯´å¿½ç•¥å¤§å°å†™ã€‚æ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœï¼š

```
3
3
```

æ’åºåçš„ç»“æœæ˜¯ `[chen, er, mo, wang]`ï¼Œæ‰€ä»¥æ£€ç´¢å‡ºæ¥çš„ä¸‹æ ‡æ˜¯ 3ã€‚

â€œä¸‰å¦¹ï¼Œè®°ä½äº†ï¼Œä»¥åå¦‚æœè¦ä»æ•°ç»„æˆ–è€…é›†åˆä¸­æŸ¥æ‰¾å…ƒç´ çš„è¯ï¼Œå°½é‡å…ˆæ’åºï¼Œç„¶åä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•ï¼Œè¿™æ ·èƒ½æé«˜æ£€ç´¢çš„æ•ˆç‡ã€‚â€

ä¸‰å¦¹è‹¥æœ‰æ‰€æ€çš„ç‚¹äº†ç‚¹å¤´ã€‚

### 05ã€æ•°ç»„è½¬æµ

â€œæµæ˜¯ä»€ä¹ˆå‘€ï¼Ÿâ€ä¸‰å¦¹å¥½å¥‡çš„é—®ã€‚

â€œæµçš„è‹±æ–‡å•è¯æ˜¯ Streamï¼Œå®ƒå¯ä»¥æå¤§æé«˜ Java ç¨‹åºå‘˜çš„ç”Ÿäº§åŠ›ï¼Œè®©ç¨‹åºå‘˜å†™å‡ºé«˜æ•ˆã€å¹²å‡€ã€ç®€æ´çš„ä»£ç ã€‚ è¿™ç§é£æ ¼å°†è¦å¤„ç†çš„é›†åˆçœ‹ä½œæ˜¯ä¸€ç§æµï¼Œæƒ³è±¡ä¸€ä¸‹æ°´æµåœ¨ç®¡é“ä¸­æµè¿‡çš„æ ·å­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç®¡é“ä¸­å¯¹æµè¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚ç­›é€‰ã€æ’åºç­‰ç­‰ã€‚[Stream å…·ä½“æ€ä¹ˆä½¿ç”¨](https://tobebetterjavaer.com/java8/stream.html)ï¼Œæˆ‘ä»¬ç•™åˆ°åé¢å†è¯¦ç»†åœ°è®²ï¼Œè¿™é‡Œä½ å…ˆæœ‰ä¸€ä¸ªå¤§è‡´çš„å°è±¡å°±å¯ä»¥äº†ã€‚â€æˆ‘å›ç­”åˆ°ã€‚


Arrays ç±»çš„ `stream()` æ–¹æ³•å¯ä»¥å°†æ•°ç»„è½¬æ¢æˆæµï¼š

```java
String[] intro = new String[] { "æ²‰", "é»˜", "ç‹", "äºŒ" };
System.out.println(Arrays.stream(intro).count());
```

è¿˜å¯ä»¥ä¸º `stream()` æ–¹æ³•æŒ‡å®šèµ·å§‹ä¸‹æ ‡å’Œç»“æŸä¸‹æ ‡ï¼š

```java
System.out.println(Arrays.stream(intro, 1, 2).count());
```

å¦‚æœä¸‹æ ‡çš„èŒƒå›´æœ‰è¯¯çš„æ—¶å€™ï¼Œæ¯”å¦‚è¯´ä» 2 åˆ° 1 ç»“æŸï¼Œåˆ™ç¨‹åºä¼šæŠ›å‡º ArrayIndexOutOfBoundsException å¼‚å¸¸ï¼š

```
Exception in thread "main" java.lang.ArrayIndexOutOfBoundsException: origin(2) > fence(1)
	at java.base/java.util.Spliterators.checkFromToBounds(Spliterators.java:387)
```

### 06ã€æ‰“å°æ•°ç»„

å› ä¸ºæ•°ç»„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç›´æ¥ `System.out.println` çš„è¯ï¼Œç»“æœæ˜¯è¿™æ ·çš„ï¼š

```
[Ljava.lang.String;@3d075dc0
```

[æœ€ä¼˜é›…çš„æ‰“å°æ–¹å¼](https://tobebetterjavaer.com/array/print.html)ï¼Œæ˜¯ä½¿ç”¨ `Arrays.toString()`ï¼Œå…¶å®å‰é¢è®²è¿‡ã€‚æ¥çœ‹ä¸€ä¸‹è¯¥æ–¹æ³•çš„æºç ï¼š

```java
public static String toString(Object[] a) {
    if (a == null)
        return "null";

    int iMax = a.length - 1;
    if (iMax == -1)
        return "[]";

    StringBuilder b = new StringBuilder();
    b.append('[');
    for (int i = 0; ; i++) {
        b.append(String.valueOf(a[i]));
        if (i == iMax)
            return b.append(']').toString();
        b.append(", ");
    }
}
```

- å…ˆåˆ¤æ–­ nullï¼Œæ˜¯çš„è¯ï¼Œç›´æ¥è¿”å›â€œnullâ€å­—ç¬¦ä¸²ï¼›
- è·å–æ•°ç»„çš„é•¿åº¦ï¼Œå¦‚æœæ•°ç»„çš„é•¿åº¦ä¸º 0ï¼ˆ ç­‰ä»·äº length - 1 ä¸º -1ï¼‰ï¼Œè¿”å›ä¸­æ‹¬å·â€œ[]â€ï¼Œè¡¨ç¤ºæ•°ç»„ä¸ºç©ºçš„ï¼›
- å¦‚æœæ•°ç»„æ—¢ä¸æ˜¯ nullï¼Œé•¿åº¦ä¹Ÿä¸ä¸º 0ï¼Œå°±å£°æ˜ StringBuilder å¯¹è±¡ï¼Œç„¶åæ·»åŠ ä¸€ä¸ªæ•°ç»„çš„å¼€å§‹æ ‡è®°â€œ[â€ï¼Œä¹‹åå†éå†æ•°ç»„ï¼ŒæŠŠæ¯ä¸ªå…ƒç´ æ·»åŠ è¿›å»ï¼›å…¶ä¸­ä¸€ä¸ªå°æŠ€å·§å°±æ˜¯ï¼Œå½“é‡åˆ°æœ«å°¾å…ƒç´ çš„æ—¶å€™ï¼ˆi == iMaxï¼‰ï¼Œä¸å†æ·»åŠ é€—å·å’Œç©ºæ ¼â€œ, â€ï¼Œè€Œæ˜¯æ·»åŠ æ•°ç»„çš„é—­åˆæ ‡è®°â€œ]â€ã€‚

â€œå“¥ï¼Œæˆ‘èƒ½ä¸èƒ½é—®ä¸€ä¸ªé—®é¢˜å‘€ï¼Ÿâ€

â€œä½ é—®å•Šã€‚â€

â€œå°±æ˜¯ä¸ºä»€ä¹ˆåˆ¤æ–­æ•°ç»„é•¿åº¦ä¸º 0 çš„æ—¶å€™åˆ¤æ–­çš„æ˜¯å‡ 1 åæ¯”è¾ƒ -1 å‘¢ï¼Ÿä¸ºä»€ä¹ˆä¸ç›´æ¥æ¯”è¾ƒ 0 å‘¢ï¼Ÿâ€

â€œå‘€ï¼Œä½ è¿™ä¸ªé—®é¢˜é—®çš„å¾ˆå¦™å•Šï¼â€æˆ‘æƒ³åˆ°ä¸‰å¦¹è¯´ä¸€å¥â€œrespectâ€ï¼Œå¾ˆå¼ºï¼â€œå…¶å®æ˜¯å’Œéå†æ•°ç»„çš„æ—¶å€™åˆ¤æ–­ `i == iMax` æœ‰å…³äº†ï¼Œå¦åˆ™è¿™é‡Œå°±è¦ç”¨ `i == iMax -1` æ¥åˆ¤æ–­æ˜¯å¦åˆ°è¾¾æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ äº†ã€‚â€

â€œå“¦----------â€ä¸‰å¦¹ä¼¼ä¹æ˜ç™½äº†ä»€ä¹ˆã€‚

### 07ã€æ•°ç»„è½¬ List

å°½ç®¡æ•°ç»„éå¸¸å¼ºå¤§ï¼Œä½†å®ƒè‡ªèº«å¯ä»¥æ“ä½œçš„å·¥å…·æ–¹æ³•å¾ˆå°‘ï¼Œæ¯”å¦‚è¯´åˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦åŒ…å«æŸä¸ªå€¼ã€‚å¦‚æœèƒ½è½¬æˆ List çš„è¯ï¼Œå°±ç®€ä¾¿å¤šäº†ï¼Œå› ä¸º Java çš„[é›†åˆæ¡†æ¶ List](https://tobebetterjavaer.com/collection/gailan.html) ä¸­å°è£…äº†å¾ˆå¤šå¸¸ç”¨çš„æ–¹æ³•ã€‚

```java
String[] intro = new String[] { "æ²‰", "é»˜", "ç‹", "äºŒ" };
List<String> rets = Arrays.asList(intro);
System.out.println(rets.contains("äºŒ"));
```

ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`Arrays.asList()` è¿”å›çš„æ˜¯ `java.util.Arrays.ArrayList`ï¼Œå¹¶ä¸æ˜¯  [`java.util.ArrayList`](https://tobebetterjavaer.com/collection/arraylist.html)ï¼Œå®ƒçš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œæ— æ³•è¿›è¡Œå…ƒç´ çš„åˆ é™¤æˆ–è€…æ·»åŠ ã€‚

```java
rets.add("ä¸‰");
rets.remove("äºŒ");
```

è¿™ä¸ªåœ¨ç¼–ç çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„ï¼Œå¦åˆ™åœ¨æ‰§è¡Œè¿™ä¸¤ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼š

```
Exception in thread "main" java.lang.UnsupportedOperationException
	at java.base/java.util.AbstractList.add(AbstractList.java:153)
	at java.base/java.util.AbstractList.add(AbstractList.java:111)
```

è¦æƒ³æ“ä½œå…ƒç´ çš„è¯ï¼Œéœ€è¦å¤šä¸€æ­¥è½¬åŒ–ï¼Œè½¬æˆçœŸæ­£çš„ `java.util.ArrayList`ï¼š

```java
List<String> rets1 = new ArrayList<>(Arrays.asList(intro));
rets1.add("ä¸‰");
rets1.remove("äºŒ");
```

### 08ã€setAll

Java 8 æ–°å¢äº† `setAll()` æ–¹æ³•ï¼Œå®ƒæä¾›äº†ä¸€ä¸ª[å‡½æ•°å¼ç¼–ç¨‹](https://tobebetterjavaer.com/java8/Lambda.html)çš„å…¥å£ï¼Œå¯ä»¥å¯¹æ•°ç»„çš„å…ƒç´ è¿›è¡Œå¡«å……ï¼š

```java
int[] array = new int[10];
Arrays.setAll(array, i -> i * 10);
System.out.println(Arrays.toString(array));
```

â€œè¿™æ®µä»£ç ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

i å°±ç›¸å½“äºæ˜¯æ•°ç»„çš„ä¸‹æ ‡ï¼Œå€¼ä» 0 å¼€å§‹ï¼Œåˆ° 9 ç»“æŸï¼Œé‚£ä¹ˆ `i * 10` å°±æ„å‘³ç€å€¼ä» 0 * 10 å¼€å§‹ï¼Œåˆ° 9 * 10 ç»“æŸï¼Œæ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœï¼š

```
[0, 10, 20, 30, 40, 50, 60, 70, 80, 90]
```

å¯ä»¥ç”¨æ¥ä¸ºæ–°æ•°ç»„å¡«å……åŸºäºåŸæ¥æ•°ç»„çš„æ–°å…ƒç´ ã€‚

### 09ã€parallelPrefix

`parallelPrefix()` æ–¹æ³•å’Œ `setAll()` æ–¹æ³•ä¸€æ ·ï¼Œä¹Ÿæ˜¯ Java 8 ä¹‹åæä¾›çš„ï¼Œæä¾›äº†ä¸€ä¸ªå‡½æ•°å¼ç¼–ç¨‹çš„å…¥å£ï¼Œé€šè¿‡éå†æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œå°†å½“å‰ä¸‹æ ‡ä½ç½®ä¸Šçš„å…ƒç´ ä¸å®ƒä¹‹å‰ä¸‹æ ‡çš„å…ƒç´ è¿›è¡Œæ“ä½œï¼Œç„¶åå°†æ“ä½œåçš„ç»“æœè¦†ç›–å½“å‰ä¸‹æ ‡ä½ç½®ä¸Šçš„å…ƒç´ ã€‚

```java
int[] arr = new int[] { 1, 2, 3, 4};
Arrays.parallelPrefix(arr, (left, right) -> left + right);
System.out.println(Arrays.toString(arr));
```

ä¸Šé¢ä»£ç ä¸­æœ‰ä¸€ä¸ª Lambda è¡¨è¾¾å¼ï¼ˆ`(left, right) -> left + right`ï¼‰ï¼Œæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿä¸Šé¢è¿™æ®µä»£ç ç­‰åŒäºï¼š

```java
int[] arr = new int[]{1, 2, 3, 4};
Arrays.parallelPrefix(arr, (left, right) -> {
    System.out.println(left + "ï¼Œ" + right);
    return left + right;
});
System.out.println(Arrays.toString(arr));
```

æ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœå°±æ˜ç™½äº†ï¼š

```
1ï¼Œ2
3ï¼Œ3
6ï¼Œ4
[1, 3, 6, 10]
```

ä¹Ÿå°±æ˜¯è¯´ï¼Œ Lambda è¡¨è¾¾å¼æ‰§è¡Œäº†ä¸‰æ¬¡ï¼š

- ç¬¬ä¸€æ¬¡æ˜¯ 1 å’Œ 2 ç›¸åŠ ï¼Œç»“æœæ˜¯ 3ï¼Œæ›¿æ¢ä¸‹æ ‡ä¸º 1 çš„ä½ç½®
- ç¬¬äºŒæ¬¡æ˜¯ 3 å’Œ 3 ç›¸åŠ ï¼Œç»“æœæ˜¯ 6ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€æ¬¡çš„ç»“æœå’Œä¸‹æ ‡ä¸º 2 çš„å…ƒç´ ç›¸åŠ çš„ç»“æœ
- ç¬¬ä¸‰æ¬¡æ˜¯ 6 å’Œ 4 ç›¸åŠ ï¼Œç»“æœæ˜¯ 10ï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒæ¬¡çš„ç»“æœå’Œä¸‹æ ‡ä¸º 3 çš„å…ƒç´ ç›¸åŠ çš„ç»“æœ


### 10ã€æ€»ç»“

â€œå¥½äº†ï¼Œä¸‰å¦¹ï¼Œå°±å…ˆå­¦åˆ°è¿™å§ã€‚å¦‚æœä½ ä»¥åç¿» Java æºç çš„æ—¶å€™ï¼Œåªè¦æ˜¯ç”¨åˆ°æ•°ç»„çš„ï¼Œå°¤å…¶æ˜¯ ArrayList ç±»ï¼Œå°±å¯ä»¥çœ‹åˆ° Arrays ç±»çš„å¾ˆå¤šå½±å­ã€‚â€

â€œå—¯å—¯ï¼Œæˆ‘å…ˆå¤ä¹ ä¸€ä¸‹è¿™èŠ‚çš„å†…å®¹ã€‚å“¥ï¼Œä½ å»ä¼‘æ¯å§ã€‚â€

æˆ‘æ¥åˆ°å®¢å…ï¼Œååˆ°æ²™å‘ä¸Šï¼Œæ§èµ·é»„æ°¸ç‰å…ˆç”Ÿçš„ã€Šæ— æ„æ²³ä¸Šçš„æµªè¡æ±‰å­Â·å…«å¹´å· 1ã€‹çœ‹äº†èµ·æ¥ï¼Œæ´¥æ´¥æœ‰å‘³ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 9.3 StringUtilså·¥å…·ç±»

`å­—ç¬¦ä¸²`ï¼ˆ[String](https://tobebetterjavaer.com/string/immutable.html)ï¼‰åœ¨æˆ‘ä»¬çš„æ—¥å¸¸å·¥ä½œä¸­ï¼Œç”¨å¾—éå¸¸éå¸¸éå¸¸å¤šã€‚

åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­ç»å¸¸éœ€è¦å¯¹å­—ç¬¦ä¸²åˆ¤ç©ºï¼Œæˆªå–å­—ç¬¦ä¸²ã€è½¬æ¢å¤§å°å†™ã€[åˆ†éš”å­—ç¬¦ä¸²](https://tobebetterjavaer.com/string/split.html)ã€[æ¯”è¾ƒå­—ç¬¦ä¸²](https://tobebetterjavaer.com/string/equals.html)ã€å»æ‰å¤šä½™ç©ºæ ¼ã€[æ‹¼æ¥å­—ç¬¦ä¸²](https://tobebetterjavaer.com/string/join.html)ã€ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ç­‰ç­‰ã€‚

å¦‚æœåªç”¨ String ç±»æä¾›çš„é‚£äº›æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹å†™å¤§é‡çš„é¢å¤–ä»£ç ï¼Œä¸ç„¶å®¹æ˜“å‡ºç°å„ç§å¼‚å¸¸ã€‚

ç°åœ¨æœ‰ä¸ªå¥½æ¶ˆæ¯æ˜¯ï¼š`org.apache.commons.lang3`åŒ…ä¸‹çš„`StringUtils`å·¥å…·ç±»ï¼Œç»™æˆ‘ä»¬æä¾›äº†éå¸¸ä¸°å¯Œçš„é€‰æ‹©ã€‚

Maven åæ ‡ï¼š

```
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-lang3</artifactId>
    <version>3.12.0</version>
</dependency>
```

StringUtils æä¾›äº†éå¸¸å¤šå®ç”¨çš„æ–¹æ³•ï¼Œå¤§æ¦‚æœ‰ä¸‹å›¾çš„å››é¡µåˆ°äº”é¡µï¼Œæˆ‘åªæˆªäº†ä¸¤é¡µï¼Œå®åœ¨æ˜¯å¤ªå¤šäº†ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/StringUtils-20230330111122.png)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥æ‹¿ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•ä¸¾ä¾‹è¯´æ˜ã€‚

### å­—ç¬¦ä¸²åˆ¤ç©º

å…¶å®ç©ºå­—ç¬¦ä¸²ï¼Œä¸åªæ˜¯ null ä¸€ç§ï¼Œè¿˜æœ‰""ï¼Œ" "ï¼Œ"null"ç­‰ç­‰ï¼Œå¤šç§æƒ…å†µã€‚

StringUtils ç»™æˆ‘ä»¬æä¾›äº†å¤šä¸ªåˆ¤ç©ºçš„é™æ€æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š

```java
String str1 = null;
String str2 = "";
String str3 = " ";
String str4 = "abc";
System.out.println(StringUtils.isEmpty(str1));
System.out.println(StringUtils.isEmpty(str2));
System.out.println(StringUtils.isEmpty(str3));
System.out.println(StringUtils.isEmpty(str4));
System.out.println("=====");
System.out.println(StringUtils.isNotEmpty(str1));
System.out.println(StringUtils.isNotEmpty(str2));
System.out.println(StringUtils.isNotEmpty(str3));
System.out.println(StringUtils.isNotEmpty(str4));
System.out.println("=====");
System.out.println(StringUtils.isBlank(str1));
System.out.println(StringUtils.isBlank(str2));
System.out.println(StringUtils.isBlank(str3));
System.out.println(StringUtils.isBlank(str4));
System.out.println("=====");
System.out.println(StringUtils.isNotBlank(str1));
System.out.println(StringUtils.isNotBlank(str2));
System.out.println(StringUtils.isNotBlank(str3));
System.out.println(StringUtils.isNotBlank(str4));
```

æ‰§è¡Œç»“æœï¼š

```java
true
true
false
false
=====
false
false
true
true
=====
true
true
true
false
=====
false
false
false
true
```

ç¤ºä¾‹ä¸­çš„ï¼š`isEmpty`ã€`isNotEmpty`ã€`isBlank`å’Œ`isNotBlank`ï¼Œè¿™ 4 ä¸ªåˆ¤ç©ºæ–¹æ³•ä½ ä»¬å¯ä»¥æ ¹æ®å®é™…æƒ…å†µä½¿ç”¨ã€‚

ä¼˜å…ˆæ¨èä½¿ç”¨`isBlank`å’Œ`isNotBlank`æ–¹æ³•ï¼Œå› ä¸ºå®ƒä¼šæŠŠ`" "`ä¹Ÿè€ƒè™‘è¿›å»ã€‚

### åˆ†éš”å­—ç¬¦ä¸²

åˆ†éš”å­—ç¬¦ä¸²æ˜¯å¸¸è§éœ€æ±‚ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨ String ç±»çš„ split æ–¹æ³•ï¼Œå°±å¯èƒ½ä¼šå‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚

```java
String str1 = null;
System.out.println(StringUtils.split(str1,","));
System.out.println(str1.split(","));
```

æ‰§è¡Œç»“æœï¼š

```java
null
Exception in thread "main" java.lang.NullPointerException
\tat com.sue.jump.service.test1.UtilTest.main(UtilTest.java:21)
```

ä½¿ç”¨ StringUtils çš„ split æ–¹æ³•ä¼šè¿”å› nullï¼Œè€Œä½¿ç”¨ String çš„ split æ–¹æ³•ä¼šæŠ¥æŒ‡é’ˆå¼‚å¸¸ã€‚

### åˆ¤æ–­æ˜¯å¦çº¯æ•°å­—

ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ¤æ–­å®ƒæ˜¯å¦ä¸ºçº¯æ•°å­—ï¼Œå¯ä»¥ä½¿ç”¨`isNumeric`æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

```java
String str1 = "123";
String str2 = "123q";
String str3 = "0.33";
System.out.println(StringUtils.isNumeric(str1));
System.out.println(StringUtils.isNumeric(str2));
System.out.println(StringUtils.isNumeric(str3));
```

æ‰§è¡Œç»“æœï¼š

```java
true
false
false
```

### å°†é›†åˆæ‹¼æ¥æˆå­—ç¬¦ä¸²

æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å°†æŸä¸ªé›†åˆçš„å†…å®¹ï¼Œæ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åè¾“å‡ºï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨`join`æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

```java
List<String> list = Lists.newArrayList("a", "b", "c");
List<Integer> list2 = Lists.newArrayList(1, 2, 3);
System.out.println(StringUtils.join(list, ","));
System.out.println(StringUtils.join(list2, " "));
```

æ‰§è¡Œç»“æœï¼š

```java
a,b,c
1 2 3
```

### å…¶ä»–æ–¹æ³•

è¿™é‡Œå†åˆ—ä¸¾ä¸€äº›ï¼Œå…¶ä»–çš„æ–¹æ³•å¯ä»¥è‡ªå·±å»ç ”ç©¶ä¸€ä¸‹ã€‚

- `trim(String str)`ï¼šå»é™¤å­—ç¬¦ä¸²é¦–å°¾çš„ç©ºç™½å­—ç¬¦ã€‚
- `trimToEmpty(String str)`ï¼šå»é™¤å­—ç¬¦ä¸²é¦–å°¾çš„ç©ºç™½å­—ç¬¦ï¼Œå¦‚æœå­—ç¬¦ä¸²ä¸º nullï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚
- `trimToNull(String str)`ï¼šå»é™¤å­—ç¬¦ä¸²é¦–å°¾çš„ç©ºç™½å­—ç¬¦ï¼Œå¦‚æœç»“æœä¸ºç©ºå­—ç¬¦ä¸²ï¼Œåˆ™è¿”å› nullã€‚
- `equals(String str1, String str2)`ï¼šæ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ã€‚
- `equalsIgnoreCase(String str1, String str2)`ï¼šæ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ï¼Œå¿½ç•¥å¤§å°å†™ã€‚
- `startsWith(String str, String prefix)`ï¼šæ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä»¥æŒ‡å®šçš„å‰ç¼€å¼€å¤´ã€‚
- `endsWith(String str, String suffix)`ï¼šæ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä»¥æŒ‡å®šçš„åç¼€ç»“å°¾ã€‚
- `contains(String str, CharSequence seq)`ï¼šæ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«æŒ‡å®šçš„å­—ç¬¦åºåˆ—ã€‚
- `indexOf(String str, CharSequence seq)`ï¼šè¿”å›æŒ‡å®šå­—ç¬¦åºåˆ—åœ¨å­—ç¬¦ä¸²ä¸­é¦–æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¿”å› -1ã€‚
- `lastIndexOf(String str, CharSequence seq)`ï¼šè¿”å›æŒ‡å®šå­—ç¬¦åºåˆ—åœ¨å­—ç¬¦ä¸²ä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¿”å› -1ã€‚
- `substring(String str, int start, int end)`ï¼šæˆªå–å­—ç¬¦ä¸²ä¸­æŒ‡å®šèŒƒå›´çš„å­ä¸²ã€‚
- `replace(String str, String searchString, String replacement)`ï¼šæ›¿æ¢å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å‡ºç°çš„æœç´¢å­—ç¬¦ä¸²ä¸ºæŒ‡å®šçš„æ›¿æ¢å­—ç¬¦ä¸²ã€‚
- `replaceAll(String str, String regex, String replacement)`ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢å­—ç¬¦ä¸²ä¸­æ‰€æœ‰åŒ¹é…çš„éƒ¨åˆ†ã€‚
- `join(Iterable<?> iterable, String separator)`ï¼šä½¿ç”¨æŒ‡å®šçš„åˆ†éš”ç¬¦å°†å¯è¿­ä»£å¯¹è±¡ä¸­çš„å…ƒç´ è¿æ¥ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚
- `split(String str, String separator)`ï¼šä½¿ç”¨æŒ‡å®šçš„åˆ†éš”ç¬¦å°†å­—ç¬¦ä¸²åˆ†å‰²ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ã€‚
- `capitalize(String str)`ï¼šå°†å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦è½¬æ¢ä¸ºå¤§å†™ã€‚
- `uncapitalize(String str)`ï¼šå°†å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦è½¬æ¢ä¸ºå°å†™ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 9.4 Objectså·¥å…·ç±»

Java çš„ Objects ç±»æ˜¯ä¸€ä¸ªå®ç”¨å·¥å…·ç±»ï¼ŒåŒ…å«äº†ä¸€ç³»åˆ—é™æ€æ–¹æ³•ï¼Œç”¨äºå¤„ç†å¯¹è±¡ã€‚å®ƒä½äº java.util åŒ…ä¸­ï¼Œè‡ª Java 7 å¼•å…¥ã€‚Objects ç±»çš„ä¸»è¦ç›®çš„æ˜¯é™ä½ä»£ç ä¸­çš„[ç©ºæŒ‡é’ˆå¼‚å¸¸](https://tobebetterjavaer.com/exception/npe.html) (NullPointerException) é£é™©ï¼ŒåŒæ—¶æä¾›ä¸€äº›éå¸¸å®ç”¨çš„æ–¹æ³•ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚

### å¯¹è±¡åˆ¤ç©º

åœ¨ Java ä¸­ï¼Œä¸‡ç‰©çš†å¯¹è±¡ï¼Œå¯¹è±¡çš„åˆ¤ç©ºå¯ä»¥è¯´æ— å¤„ä¸åœ¨ã€‚Objects çš„ `isNull` æ–¹æ³•ç”¨äºåˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºç©ºï¼Œè€Œ `nonNull` æ–¹æ³•åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ä¸ºç©ºã€‚ä¾‹å¦‚ï¼š

```java
Integer integer = new Integer(1);

if (Objects.isNull(integer)) {
    System.out.println("å¯¹è±¡ä¸ºç©º");
}

if (Objects.nonNull(integer)) {
    System.out.println("å¯¹è±¡ä¸ä¸ºç©º");
}
```

### å¯¹è±¡ä¸ºç©ºæ—¶æŠ›å¼‚å¸¸

å¦‚æœæˆ‘ä»¬æƒ³åœ¨å¯¹è±¡ä¸ºç©ºæ—¶ï¼ŒæŠ›å‡º[ç©ºæŒ‡é’ˆå¼‚å¸¸](https://tobebetterjavaer.com/exception/npe.html)ï¼Œå¯ä»¥ä½¿ç”¨ Objects çš„ `requireNonNull` æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

```java
Integer integer1 = new Integer(128);

Objects.requireNonNull(integer1);
Objects.requireNonNull(integer1, "å‚æ•°ä¸èƒ½ä¸ºç©º");
Objects.requireNonNull(integer1, () -> "å‚æ•°ä¸èƒ½ä¸ºç©º");
```

### åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰

æˆ‘ä»¬ç»å¸¸éœ€è¦åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼ŒObjects ç»™æˆ‘ä»¬æä¾›äº† `equals` æ–¹æ³•ï¼Œèƒ½éå¸¸æ–¹ä¾¿çš„å®ç°ï¼š

```java
Integer integer1 = new Integer(1);
Integer integer2 = new Integer(1);

System.out.println(Objects.equals(integer1, integer2));
```

æ‰§è¡Œç»“æœï¼š

```java
true
```

ä½†ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æœ‰å‘ï¼Œæ¯”å¦‚ä¾‹å­æ”¹æˆï¼š

```java
Integer integer1 = new Integer(1);
Long integer2 = new Long(1);

System.out.println(Objects.equals(integer1, integer2));
```

æ‰§è¡Œç»“æœï¼š

```java
false
```

ä¸è¿‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ `Objects.equals()` æ–¹æ³•æœ¬èº«æ˜¯ç”¨æ¥é¿å…å‘çš„ï¼Œå› ä¸ºå®ƒå¯ä»¥å¤„ç† null å€¼çš„æ¯”è¾ƒï¼Œè€Œä¸ä¼šæŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸æ„å‘³ç€å®ƒæ²¡æœ‰ä»»ä½•æ½œåœ¨é—®é¢˜ã€‚å®é™…ä¸Šï¼Œ`Objects.equals()` æ–¹æ³•çš„ä¸€ä¸ªæ½œåœ¨é—®é¢˜æ˜¯ä¾èµ–äºè¢«æ¯”è¾ƒå¯¹è±¡çš„ `equals()` æ–¹æ³•å®ç°ã€‚

å½“ä¸¤ä¸ªå¯¹è±¡çš„ç±»æ²¡æœ‰æ­£ç¡®å®ç° `equals()` æ–¹æ³•æ—¶ï¼Œ`Objects.equals()` æ–¹æ³•å¯èƒ½ä¼šäº§ç”Ÿä¸ç¬¦åˆé¢„æœŸçš„ç»“æœã€‚ä¸¾ä¸ªä¾‹å­ï¼š

```java
public class ObjectsDemo1 {
    public static void main(String[] args) {
        Person person1 = new Person("æ²‰é»˜ç‹äºŒ", 18);
        Person person2 = new Person("æ²‰é»˜ç‹äºŒ", 18);

        System.out.println(Objects.equals(person1, person2)); // è¾“å‡ºï¼šfalse
    }
}
class Person {
    String name;
    int age;

    Person(String name, int age) {
        this.name = name;
        this.age = age;
    }
}
```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º Person çš„ç±»ï¼Œä½†æ˜¯æ²¡æœ‰é‡å†™ `equals()` æ–¹æ³•ã€‚ç„¶åæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªå…·æœ‰ç›¸åŒå±æ€§çš„ Person å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ `Objects.equals()` æ–¹æ³•æ¯”è¾ƒå®ƒä»¬ã€‚å°½ç®¡è¿™ä¸¤ä¸ªå¯¹è±¡çš„å±æ€§æ˜¯ç›¸åŒçš„ï¼Œä½†è¾“å‡ºç»“æœå´æ˜¯ falseã€‚è¿™æ˜¯å› ä¸º `Objects.equals()` æ–¹æ³•ä¾èµ–äºå¯¹è±¡çš„ `equals()` æ–¹æ³•ï¼Œè€Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒPerson ç±»æ²¡æœ‰æ­£ç¡®åœ°å®ç° `equals()` æ–¹æ³•ï¼Œæ‰€ä»¥é»˜è®¤æƒ…å†µä¸‹ä¼šä½¿ç”¨ Object ç±»çš„ `equals()` æ–¹æ³•ï¼Œå®ƒåªæ¯”è¾ƒå¯¹è±¡å¼•ç”¨æ˜¯å¦ç›¸åŒã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Person ç±»ä¸­é‡å†™ `equals()` æ–¹æ³•ï¼š

```java
@Override
public boolean equals(Object obj) {
    if (this == obj) {
        return true;
    }
    if (obj == null || getClass() != obj.getClass()) {
        return false;
    }
    Person person = (Person) obj;
    return age == person.age && Objects.equals(name, person.name);
}
```

ç°åœ¨ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ `Objects.equals()` æ–¹æ³•æ¯”è¾ƒä¸¤ä¸ªå…·æœ‰ç›¸åŒå±æ€§çš„ Person å¯¹è±¡æ—¶ï¼Œè¾“å‡ºå°†æ˜¯ trueï¼Œç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚

### è·å–å¯¹è±¡çš„hashCode

å¦‚æœä½ æƒ³è·å–æŸä¸ªå¯¹è±¡çš„ hashCodeï¼Œå¯ä»¥ä½¿ç”¨ Objects çš„ `hashCode` æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

```java
String str = new String("æ²‰é»˜ç‹äºŒ");
System.out.println(Objects.hashCode(str));
```

æ‰§è¡Œç»“æœï¼š

```java
867758096
```

### æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡

`compare()` æ–¹æ³•ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ï¼Œé€šå¸¸ç”¨äºè‡ªå®šä¹‰æ’åºã€‚å®ƒéœ€è¦ä¸€ä¸ª[æ¯”è¾ƒå™¨ (Comparator) ](https://tobebetterjavaer.com/basic-extra-meal/comparable-omparator.html)ä½œä¸ºå‚æ•°ã€‚å¦‚æœæ¯”è¾ƒå™¨ä¸º nullï¼Œåˆ™ä½¿ç”¨è‡ªç„¶é¡ºåºã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ª `compare()` æ–¹æ³•çš„ç¤ºä¾‹ï¼š

```java
class ObjectsCompareDemo {
    public static void main(String[] args) {
        PersonCompare person1 = new PersonCompare("itwanger", 30);
        PersonCompare person2 = new PersonCompare("chenqingyang", 25);

        Comparator<PersonCompare> ageComparator = Comparator.comparingInt(p -> p.age);
        int ageComparisonResult = Objects.compare(person1, person2, ageComparator);
        System.out.println("å¹´é¾„æ’åº: " + ageComparisonResult); // è¾“å‡ºï¼š1ï¼ˆè¡¨ç¤º person1 çš„ age åœ¨ person2 ä¹‹åï¼‰
    }
}

class PersonCompare {
    String name;
    int age;

    PersonCompare(String name, int age) {
        this.name = name;
        this.age = age;
    }
}
```

### æ¯”è¾ƒä¸¤ä¸ªæ•°ç»„

`deepEquals()` ç”¨äºæ¯”è¾ƒä¸¤ä¸ª[æ•°ç»„ç±»å‹](https://tobebetterjavaer.com/array/array.html)çš„å¯¹è±¡ï¼Œå½“å¯¹è±¡æ˜¯éæ•°ç»„çš„è¯ï¼Œè¡Œä¸ºå’Œ `equals()` ä¸€è‡´ã€‚

```java
int[] array1 = {1, 2, 3};
int[] array2 = {1, 2, 3};
int[] array3 = {1, 2, 4};

System.out.println(Objects.deepEquals(array1, array2)); // è¾“å‡ºï¼štrueï¼ˆå› ä¸º array1 å’Œ array2 çš„å†…å®¹ç›¸åŒï¼‰
System.out.println(Objects.deepEquals(array1, array3)); // è¾“å‡ºï¼šfalseï¼ˆå› ä¸º array1 å’Œ array3 çš„å†…å®¹ä¸åŒï¼‰

// å¯¹äºéæ•°ç»„å¯¹è±¡ï¼ŒdeepEquals() çš„è¡Œä¸ºä¸ equals() ç›¸åŒ
String string1 = "hello";
String string2 = "hello";
String string3 = "world";

System.out.println(Objects.deepEquals(string1, string2)); // è¾“å‡ºï¼štrueï¼ˆå› ä¸º string1 å’Œ string2 ç›¸åŒï¼‰
System.out.println(Objects.deepEquals(string1, string3)); // è¾“å‡ºï¼šfalseï¼ˆå› ä¸º string1 å’Œ string3 ä¸åŒï¼‰
```

å†æ¥ä¸ª[äºŒç»´æ•°ç»„](https://tobebetterjavaer.com/array/double-array.html)çš„ï¼š

```java
String[][] nestedArray1 = {{"A", "B"}, {"C", "D"}};
String[][] nestedArray2 = {{"A", "B"}, {"C", "D"}};
String[][] nestedArray3 = {{"A", "B"}, {"C", "E"}};

System.out.println(Objects.deepEquals(nestedArray1, nestedArray2)); // è¾“å‡ºï¼štrue (å› ä¸ºåµŒå¥—æ•°ç»„å…ƒç´ ç›¸åŒ)
System.out.println(Objects.deepEquals(nestedArray1, nestedArray3)); // è¾“å‡ºï¼šfalse (å› ä¸ºåµŒå¥—æ•°ç»„å…ƒç´ ä¸åŒ)
```

### å°ç»“

é™¤äº†ä¸Šé¢æåˆ°çš„è¿™äº›æ–¹æ³•ï¼ŒObjects è¿˜æä¾›äº†ä¸€äº›å…¶ä»–çš„æ–¹æ³•ï¼Œæ¯”å¦‚è¯´ toStringï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥è¯•ä¸€ä¸‹ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/Objects-83489814-9784-4274-841a-27ee75c046ac.jpg)

æ€»ä¹‹ï¼ŒObjects ç±»æä¾›çš„è¿™äº›æ–¹æ³•åœ¨è®¸å¤šæƒ…å†µä¸‹è¿˜æ˜¯éå¸¸æœ‰ç”¨å¾—ï¼Œå¯ä»¥ç®€åŒ–ä»£ç å¹¶å‡å°‘å‡ºé”™çš„å¯èƒ½æ€§ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 9.5 Collectionså·¥å…·ç±»

Collections æ˜¯ JDK æä¾›çš„ä¸€ä¸ªå·¥å…·ç±»ï¼Œä½äº java.util åŒ…ä¸‹ï¼Œæä¾›äº†ä¸€ç³»åˆ—çš„é™æ€æ–¹æ³•ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹é›†åˆè¿›è¡Œå„ç§éªšæ“ä½œï¼Œç®—æ˜¯é›†åˆæ¡†æ¶çš„ä¸€ä¸ªå¤§ç®¡å®¶ã€‚

è¿˜è®°å¾—æˆ‘ä»¬å‰é¢è®²è¿‡çš„ [Arrays å·¥å…·ç±»](https://tobebetterjavaer.com/common-tool/arrays.html)å—ï¼Ÿå¯ä»¥å›å»æ¸©ä¹ ä¸‹ã€‚

Collections çš„ç”¨æ³•å¾ˆç®€å•ï¼Œåœ¨ Intellij IDEA ä¸­æ•²å®Œ `Collections.` ä¹‹åå°±å¯ä»¥çœ‹åˆ°å®ƒæä¾›çš„æ–¹æ³•äº†ï¼Œå¤§è‡´çœ‹ä¸€ä¸‹æ–¹æ³•åå’Œå‚æ•°å°±èƒ½çŸ¥é“è¿™ä¸ªæ–¹æ³•æ˜¯å¹²å˜›çš„ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/collections-01.png)

ä¸ºäº†èŠ‚çœå¤§å®¶çš„å­¦ä¹ æ—¶é—´ï¼Œæˆ‘å°†è¿™äº›æ–¹æ³•åšäº†ä¸€äº›åˆ†ç±»ï¼Œå¹¶åˆ—ä¸¾äº†ä¸€äº›ç®€å•çš„ä¾‹å­ã€‚

### 01ã€æ’åºæ“ä½œ

- `reverse(List list)`ï¼šåè½¬é¡ºåº
- `shuffle(List list)`ï¼šæ´—ç‰Œï¼Œå°†é¡ºåºæ‰“ä¹±
- `sort(List list)`ï¼šè‡ªç„¶å‡åº
- `sort(List list, Comparator c)`ï¼šæŒ‰ç…§è‡ªå®šä¹‰çš„æ¯”è¾ƒå™¨æ’åº
- `swap(List list, int i, int j)`ï¼šå°† i å’Œ j ä½ç½®çš„å…ƒç´ äº¤æ¢ä½ç½®

æ¥çœ‹ä¾‹å­ï¼š

```java
List<String> list = new ArrayList<>();
list.add("æ²‰é»˜ç‹äºŒ");
list.add("æ²‰é»˜ç‹ä¸‰");
list.add("æ²‰é»˜ç‹å››");
list.add("æ²‰é»˜ç‹äº”");
list.add("æ²‰é»˜ç‹å…­");

System.out.println("åŸå§‹é¡ºåºï¼š" + list);

// åè½¬
Collections.reverse(list);
System.out.println("åè½¬åï¼š" + list);

// æ´—ç‰Œ
Collections.shuffle(list);
System.out.println("æ´—ç‰Œåï¼š" + list);

// è‡ªç„¶å‡åº
Collections.sort(list);
System.out.println("è‡ªç„¶å‡åºåï¼š" + list);

// äº¤æ¢
Collections.swap(list, 2,4);
System.out.println("äº¤æ¢åï¼š" + list);
```

è¾“å‡ºåï¼š

```
åŸå§‹é¡ºåºï¼š[æ²‰é»˜ç‹äºŒ, æ²‰é»˜ç‹ä¸‰, æ²‰é»˜ç‹å››, æ²‰é»˜ç‹äº”, æ²‰é»˜ç‹å…­]
åè½¬åï¼š[æ²‰é»˜ç‹å…­, æ²‰é»˜ç‹äº”, æ²‰é»˜ç‹å››, æ²‰é»˜ç‹ä¸‰, æ²‰é»˜ç‹äºŒ]
æ´—ç‰Œåï¼š[æ²‰é»˜ç‹äº”, æ²‰é»˜ç‹äºŒ, æ²‰é»˜ç‹å…­, æ²‰é»˜ç‹ä¸‰, æ²‰é»˜ç‹å››]
è‡ªç„¶å‡åºåï¼š[æ²‰é»˜ç‹ä¸‰, æ²‰é»˜ç‹äºŒ, æ²‰é»˜ç‹äº”, æ²‰é»˜ç‹å…­, æ²‰é»˜ç‹å››]
äº¤æ¢åï¼š[æ²‰é»˜ç‹ä¸‰, æ²‰é»˜ç‹äºŒ, æ²‰é»˜ç‹å››, æ²‰é»˜ç‹å…­, æ²‰é»˜ç‹äº”]
```

### 02ã€æŸ¥æ‰¾æ“ä½œ

- `binarySearch(List list, Object key)`ï¼šäºŒåˆ†æŸ¥æ‰¾æ³•ï¼Œå‰ææ˜¯ List å·²ç»æ’åºè¿‡äº†
- `max(Collection coll)`ï¼šè¿”å›æœ€å¤§å…ƒç´ 
- `max(Collection coll, Comparator comp)`ï¼šæ ¹æ®è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼Œè¿”å›æœ€å¤§å…ƒç´ 
- `min(Collection coll)`ï¼šè¿”å›æœ€å°å…ƒç´ 
- `min(Collection coll, Comparator comp)`ï¼šæ ¹æ®è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼Œè¿”å›æœ€å°å…ƒç´ 
- `fill(List list, Object obj)`ï¼šä½¿ç”¨æŒ‡å®šå¯¹è±¡å¡«å……
- `frequency(Collection c, Object o)`ï¼šè¿”å›æŒ‡å®šå¯¹è±¡å‡ºç°çš„æ¬¡æ•°

æ¥çœ‹ä¾‹å­ï¼š

```java
System.out.println("æœ€å¤§å…ƒç´ ï¼š" + Collections.max(list));
System.out.println("æœ€å°å…ƒç´ ï¼š" + Collections.min(list));
System.out.println("å‡ºç°çš„æ¬¡æ•°ï¼š" + Collections.frequency(list, "æ²‰é»˜ç‹äºŒ"));

// æ²¡æœ‰æ’åºç›´æ¥è°ƒç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œç»“æœæ˜¯ä¸ç¡®å®šçš„
System.out.println("æ’åºå‰çš„äºŒåˆ†æŸ¥æ‰¾ç»“æœï¼š" + Collections.binarySearch(list, "æ²‰é»˜ç‹äºŒ"));
Collections.sort(list);
// æ’åºåï¼ŒæŸ¥æ‰¾ç»“æœå’Œé¢„æœŸä¸€è‡´
System.out.println("æ’åºåçš„äºŒåˆ†æŸ¥æ‰¾ç»“æœï¼š" + Collections.binarySearch(list, "æ²‰é»˜ç‹äºŒ"));

Collections.fill(list, "æ²‰é»˜ç‹å…«");
System.out.println("å¡«å……åçš„ç»“æœï¼š" + list);
```

è¾“å‡ºåï¼š

```
åŸå§‹é¡ºåºï¼š[æ²‰é»˜ç‹äºŒ, æ²‰é»˜ç‹ä¸‰, æ²‰é»˜ç‹å››, æ²‰é»˜ç‹äº”, æ²‰é»˜ç‹å…­]
æœ€å¤§å…ƒç´ ï¼šæ²‰é»˜ç‹å››
æœ€å°å…ƒç´ ï¼šæ²‰é»˜ç‹ä¸‰
å‡ºç°çš„æ¬¡æ•°ï¼š1
æ’åºå‰çš„äºŒåˆ†æŸ¥æ‰¾ç»“æœï¼š0
æ’åºåçš„äºŒåˆ†æŸ¥æ‰¾ç»“æœï¼š1
å¡«å……åçš„ç»“æœï¼š[æ²‰é»˜ç‹å…«, æ²‰é»˜ç‹å…«, æ²‰é»˜ç‹å…«, æ²‰é»˜ç‹å…«, æ²‰é»˜ç‹å…«]
```

### 03ã€åŒæ­¥æ§åˆ¶

[HashMap æ˜¯çº¿ç¨‹ä¸å®‰å…¨](https://tobebetterjavaer.com/collection/hashmap.html#_04%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%AE%89%E5%85%A8)çš„ï¼Œè¿™ä¸ªæˆ‘ä»¬å‰é¢è®²åˆ°äº†ã€‚é‚£å…¶å® ArrayList ä¹Ÿæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œæ²¡æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œé‚£ Collections å·¥å…·ç±»ä¸­æä¾›äº†å¤šä¸ª synchronizedXxx æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªåŒæ­¥çš„å¯¹è±¡ï¼Œä»è€Œè§£å†³å¤šçº¿ç¨‹ä¸­è®¿é—®é›†åˆæ—¶çš„å®‰å…¨é—®é¢˜ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/collections-02.png)

ä½¿ç”¨èµ·æ¥ä¹Ÿéå¸¸çš„ç®€å•ï¼š

```java
SynchronizedList synchronizedList = Collections.synchronizedList(list);
```

çœ‹ä¸€çœ¼ SynchronizedList çš„æºç å°±æ˜ç™½äº†ï¼Œä¸è¿‡æ˜¯åœ¨æ–¹æ³•é‡Œé¢ä½¿ç”¨ [synchronized å…³é”®å­—](https://tobebetterjavaer.com/thread/synchronized-1.html)åŠ äº†ä¸€å±‚é”è€Œå·²ã€‚

```java
static class SynchronizedList<E>
    extends SynchronizedCollection<E>
    implements List<E> {
    private static final long serialVersionUID = -7754090372962971524L;

    final List<E> list;

    SynchronizedList(List<E> list) {
        super(list); // è°ƒç”¨çˆ¶ç±» SynchronizedCollection çš„æ„é€ æ–¹æ³•ï¼Œä¼ å…¥ list
        this.list = list; // åˆå§‹åŒ–æˆå‘˜å˜é‡ list
    }

    // è·å–æŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ 
    public E get(int index) {
        synchronized (mutex) {return list.get(index);} // åŠ é”ï¼Œè°ƒç”¨ list çš„ get æ–¹æ³•è·å–å…ƒç´ 
    }
    
    // åœ¨æŒ‡å®šç´¢å¼•å¤„æ’å…¥æŒ‡å®šå…ƒç´ 
    public void add(int index, E element) {
        synchronized (mutex) {list.add(index, element);} // åŠ é”ï¼Œè°ƒç”¨ list çš„ add æ–¹æ³•æ’å…¥å…ƒç´ 
    }
    
    // ç§»é™¤æŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ 
    public E remove(int index) {
        synchronized (mutex) {return list.remove(index);} // åŠ é”ï¼Œè°ƒç”¨ list çš„ remove æ–¹æ³•ç§»é™¤å…ƒç´ 
    }
}
```

é‚£è¿™æ ·çš„è¯ï¼Œå…¶å®æ•ˆç‡å’Œé‚£äº›ç›´æ¥åœ¨æ–¹æ³•ä¸ŠåŠ  synchronized å…³é”®å­—çš„ [Vectorã€Hashtable](https://tobebetterjavaer.com/collection/gailan.html) å·®ä¸å¤šï¼ˆJDK 1.0 æ—¶æœŸå°±æœ‰äº†ï¼‰ï¼Œè€Œè¿™äº›é›†åˆç±»åŸºæœ¬ä¸Šå·²ç»åºŸå¼ƒäº†ï¼Œå‡ ä¹ä¸æ€ä¹ˆç”¨ã€‚

```java
public class Vector<E>
    extends AbstractList<E>
    implements List<E>, RandomAccess, Cloneable, java.io.Serializable
{

    // è·å–æŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ 
    public synchronized E get(int index) {
        if (index >= elementCount) // å¦‚æœç´¢å¼•è¶…å‡ºäº†åˆ—è¡¨çš„å¤§å°ï¼Œåˆ™æŠ›å‡ºæ•°ç»„ä¸‹æ ‡è¶Šç•Œå¼‚å¸¸
            throw new ArrayIndexOutOfBoundsException(index);

        return elementData(index); // è¿”å›æŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ 
    }

    // ç§»é™¤æŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ 
    public synchronized E remove(int index) {
        modCount++; // ä¿®æ”¹è®¡æ•°å™¨ï¼Œæ ‡è¯†åˆ—è¡¨å·²è¢«ä¿®æ”¹
        if (index >= elementCount) // å¦‚æœç´¢å¼•è¶…å‡ºäº†åˆ—è¡¨çš„å¤§å°ï¼Œåˆ™æŠ›å‡ºæ•°ç»„ä¸‹æ ‡è¶Šç•Œå¼‚å¸¸
            throw new ArrayIndexOutOfBoundsException(index);
        E oldValue = elementData(index); // è·å–æŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ 

        int numMoved = elementCount - index - 1; // è®¡ç®—éœ€è¦ç§»åŠ¨çš„å…ƒç´ ä¸ªæ•°
        if (numMoved > 0) // å¦‚æœéœ€è¦ç§»åŠ¨å…ƒç´ 
            System.arraycopy(elementData, index+1, elementData, index,
                             numMoved); // å°†æ•°ç»„ä¸­çš„å…ƒç´ å‘å·¦ç§»åŠ¨ä¸€ä½
        elementData[--elementCount] = null; // å°†æœ€åä¸€ä¸ªå…ƒç´ è®¾ç½®ä¸º nullï¼Œç­‰å¾…åƒåœ¾å›æ”¶

        return oldValue; // è¿”å›è¢«ç§»é™¤çš„å…ƒç´ 
    }
}
```

æ­£ç¡®çš„åšæ³•æ˜¯ä½¿ç”¨å¹¶å‘åŒ…ä¸‹çš„ [CopyOnWriteArrayList](https://tobebetterjavaer.com/thread/CopyOnWriteArrayList.html)ã€[ConcurrentHashMap](https://tobebetterjavaer.com/thread/ConcurrentHashMap.html)ã€‚è¿™äº›æˆ‘ä»¬æ”¾åˆ°å¹¶å‘ç¼–ç¨‹æ—¶å†è®²ã€‚

### 04ã€ä¸å¯å˜é›†åˆ

- `emptyXxx()`ï¼šåˆ¶é€ ä¸€ä¸ªç©ºçš„ä¸å¯å˜é›†åˆ
- `singletonXxx()`ï¼šåˆ¶é€ ä¸€ä¸ªåªæœ‰ä¸€ä¸ªå…ƒç´ çš„ä¸å¯å˜é›†åˆ
- `unmodifiableXxx()`ï¼šä¸ºæŒ‡å®šé›†åˆåˆ¶ä½œä¸€ä¸ªä¸å¯å˜é›†åˆ

ä¸¾ä¸ªä¾‹å­ï¼š

```java
List emptyList = Collections.emptyList();
emptyList.add("éç©º");
System.out.println(emptyList);
```

è¿™æ®µä»£ç åœ¨æ‰§è¡Œçš„æ—¶å€™å°±æŠ›å‡ºé”™è¯¯äº†ã€‚

```
Exception in thread "main" java.lang.UnsupportedOperationException
	at java.util.AbstractList.add(AbstractList.java:148)
	at java.util.AbstractList.add(AbstractList.java:108)
	at com.itwanger.s64.Demo.main(Demo.java:61)
```

è¿™æ˜¯å› ä¸º `Collections.emptyList()` ä¼šè¿”å›ä¸€ä¸ª Collections çš„å†…éƒ¨ç±» EmptyListï¼Œè€Œ EmptyList å¹¶æ²¡æœ‰é‡å†™çˆ¶ç±» AbstractList çš„ `add(int index, E element)` æ–¹æ³•ï¼Œæ‰€ä»¥æ‰§è¡Œçš„æ—¶å€™å°±æŠ›å‡ºäº†ä¸æ”¯æŒè¯¥æ“ä½œçš„ UnsupportedOperationException äº†ã€‚

è¿™æ˜¯ä»åˆ†æ add æ–¹æ³•æºç å¾—å‡ºçš„åŸå› ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒemptyList æ–¹æ³•æ˜¯ final çš„ï¼Œè¿”å›çš„ EMPTY_LIST ä¹Ÿæ˜¯ final çš„ï¼Œç§ç§è¿¹è±¡è¡¨æ˜ emptyList è¿”å›çš„å°±æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œæ²¡æ³•è¿›è¡Œå¢åˆ æ”¹æŸ¥ã€‚

```java
public static final <T> List<T> emptyList() {
    return (List<T>) EMPTY_LIST;
}

public static final List EMPTY_LIST = new EmptyList<>();
```

### 05ã€å…¶ä»–

è¿˜æœ‰ä¸¤ä¸ªæ–¹æ³•æ¯”è¾ƒå¸¸ç”¨ï¼š

- `addAll(Collection<? super T> c, T... elements)`ï¼Œå¾€é›†åˆä¸­æ·»åŠ å…ƒç´ 
- `disjoint(Collection<?> c1, Collection<?> c2)`ï¼Œåˆ¤æ–­ä¸¤ä¸ªé›†åˆæ˜¯å¦æ²¡æœ‰äº¤é›†

ä¸¾ä¸ªä¾‹å­ï¼š

```java
List<String> allList = new ArrayList<>();
Collections.addAll(allList, "æ²‰é»˜ç‹ä¹","æ²‰é»˜ç‹å","æ²‰é»˜ç‹äºŒ");
System.out.println("addAll åï¼š" + allList);

System.out.println("æ˜¯å¦æ²¡æœ‰äº¤é›†ï¼š" + (Collections.disjoint(list, allList) ? "æ˜¯" : "å¦"));
```

è¾“å‡ºåï¼š

```
åŸå§‹é¡ºåºï¼š[æ²‰é»˜ç‹äºŒ, æ²‰é»˜ç‹ä¸‰, æ²‰é»˜ç‹å››, æ²‰é»˜ç‹äº”, æ²‰é»˜ç‹å…­]
addAll åï¼š[æ²‰é»˜ç‹ä¹, æ²‰é»˜ç‹å, æ²‰é»˜ç‹äºŒ]
æ˜¯å¦æ²¡æœ‰äº¤é›†ï¼šå¦
```

### 06ã€CollectionUtilsï¼šSpring å’Œ Apache éƒ½æœ‰æä¾›çš„é›†åˆå·¥å…·ç±»

å¯¹é›†åˆæ“ä½œï¼Œé™¤äº†å‰é¢è¯´çš„ JDK åŸç”Ÿ `Collections` å·¥å…·ç±»ï¼Œ`CollectionUtils`å·¥å…·ç±»ä¹Ÿå¾ˆå¸¸ç”¨ã€‚

ç›®å‰æ¯”è¾ƒä¸»æµçš„æ˜¯`Spring`çš„`org.springframework.util`åŒ…ä¸‹çš„ CollectionUtils å·¥å…·ç±»ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/utils-20230330101919.png)

å’Œ`Apache`çš„`org.apache.commons.collections`åŒ…ä¸‹çš„ CollectionUtils å·¥å…·ç±»ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/utils-20230330103825.png)

Maven åæ ‡å¦‚ä¸‹ï¼š

```
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-collections4</artifactId>
    <version>4.4</version>
</dependency>
```

Apache çš„æ–¹æ³•æ¯” Spring çš„æ›´å¤šä¸€äº›ï¼Œæˆ‘ä»¬å°±ä»¥ Apache çš„ä¸ºä¾‹ï¼Œæ¥ä»‹ç»ä¸€ä¸‹å¸¸ç”¨çš„æ–¹æ³•ã€‚

#### é›†åˆåˆ¤ç©º

é€šè¿‡ CollectionUtils å·¥å…·ç±»çš„`isEmpty`æ–¹æ³•å¯ä»¥è½»æ¾åˆ¤æ–­é›†åˆæ˜¯å¦ä¸ºç©ºï¼Œ`isNotEmpty`æ–¹æ³•åˆ¤æ–­é›†åˆä¸ä¸ºç©ºã€‚

```java
List<Integer> list = new ArrayList<>();
list.add(2);
list.add(1);
list.add(3);

if (CollectionUtils.isEmpty(list)) {
    System.out.println("é›†åˆä¸ºç©º");
}

if (CollectionUtils.isNotEmpty(list)) {
    System.out.println("é›†åˆä¸ä¸ºç©º");
}
```

#### å¯¹ä¸¤ä¸ªé›†åˆè¿›è¡Œæ“ä½œ

æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦å¯¹å·²æœ‰çš„ä¸¤ä¸ªé›†åˆè¿›è¡Œæ“ä½œï¼Œæ¯”å¦‚å–äº¤é›†æˆ–è€…å¹¶é›†ç­‰ã€‚

```java
List<Integer> list = new ArrayList<>();
list.add(2);
list.add(1);
list.add(3);

List<Integer> list2 = new ArrayList<>();
list2.add(2);
list2.add(4);

//è·å–å¹¶é›†
Collection<Integer> unionList = CollectionUtils.union(list, list2);
System.out.println(unionList);

//è·å–äº¤é›†
Collection<Integer> intersectionList = CollectionUtils.intersection(list, list2);
System.out.println(intersectionList);

//è·å–äº¤é›†çš„è¡¥é›†
Collection<Integer> disjunctionList = CollectionUtils.disjunction(list, list2);
System.out.println(disjunctionList);

//è·å–å·®é›†
Collection<Integer> subtractList = CollectionUtils.subtract(list, list2);
System.out.println(subtractList);
```

æ‰§è¡Œç»“æœï¼š

```java
[1, 2, 3, 4]
[2]
[1, 3, 4]
[1, 3]
```

è¯´å¥å®è¯ï¼Œå¯¹ä¸¤ä¸ªé›†åˆçš„æ“ä½œï¼Œåœ¨å®é™…å·¥ä½œä¸­ç”¨å¾—æŒºå¤šçš„ï¼Œç‰¹åˆ«æ˜¯å¾ˆå¤šæ‰¹é‡çš„åœºæ™¯ä¸­ã€‚ä»¥å‰æˆ‘ä»¬éœ€è¦å†™ä¸€å †ä»£ç ï¼Œä½†æ²¡æƒ³åˆ°æœ‰ç°æˆçš„è½®å­ã€‚

### 07ã€å°ç»“

æ•´ä½“ä¸Šï¼ŒCollections å·¥å…·ç±»ä½œä¸ºé›†åˆæ¡†æ¶çš„å¤§ç®¡å®¶ï¼Œæä¾›äº†ä¸€äº›éå¸¸ä¾¿åˆ©çš„æ–¹æ³•ä¾›æˆ‘ä»¬è°ƒç”¨ï¼Œä¹Ÿéå¸¸å®¹æ˜“æŒæ¡ï¼Œæ²¡ä»€ä¹ˆéš¾ç‚¹ï¼Œçœ‹çœ‹æ–¹æ³•çš„æ³¨é‡Šå°±èƒ½å¤§è‡´æ˜ç™½å¹²å˜›çš„ã€‚

ä¸è¿‡ï¼Œå·¥å…·å°±æ”¾åœ¨é‚£é‡Œï¼Œç”¨æ˜¯ä¸€å›äº‹ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆç”¨å°±æ˜¯å¦å¤–ä¸€å›äº‹äº†ã€‚èƒ½ä¸èƒ½æé«˜è‡ªå·±çš„ç¼–ç æ°´å¹³ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºä½ åˆ°åº•æœ‰æ²¡æœ‰å»é’»ä¸€é’»æºç ï¼Œçœ‹è¿™äº›è®¾è®¡ JDK çš„å¤§å¸ˆä»¬æ˜¯å¦‚ä½•å†™ä»£ç çš„ï¼Œå­¦ä¼šä¸€æ‹›åŠå¼ï¼Œåœ¨å·¥ä½œå½“ä¸­è¿˜æ˜¯èƒ½å¾ˆå¿«è„±é¢–è€Œå‡ºçš„ã€‚

ææ€• JDK çš„è®¾è®¡è€…æ˜¯è¿™ä¸ªä¸–ç•Œä¸Šæœ€å¥½çš„è€å¸ˆäº†ï¼Œæ–‡æ¡£å†™å¾—ä¸èƒ½å†è¯¦ç»†äº†ï¼Œä»£ç å†™å¾—ä¸èƒ½å†ä¼˜é›…äº†ï¼ŒåŸºæœ¬ä¸Šéƒ½è¾¾åˆ°äº†æ€§èƒ½ä¸Šçš„æè‡´ã€‚

å¯èƒ½æœ‰äººä¼šè¯´ï¼Œå·¥å…·ç±»æ²¡ä»€ä¹ˆé¸Ÿç”¨ï¼Œä¸è¿‡æ˜¯è°ƒç”¨ä¸‹æ–¹æ³•è€Œå·²ï¼Œä½†è¿™å°±å¤§é”™ç‰¹é”™äº†ï¼šå¦‚æœè¦ä½ æ¥å†™ï¼Œä½ èƒ½å†™å‡ºæ¥ Collections è¿™æ ·ä¸€ä¸ªå·¥å…·ç±»å—ï¼Ÿ

è¿™æ‰æ˜¯é«˜æ‰‹è¦æ€è€ƒçš„ä¸€ä¸ªé—®é¢˜ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 9.6 Hutoolå·¥å…·ç±»åº“

è¯»è€…ç¾¤é‡Œæœ‰ä¸ªå°ä¼™ä¼´æ„Ÿæ…¨è¯´ï¼Œâ€œHutool è¿™æ¬¾å¼€æºç±»åº“å¤ªå‰å®³äº†ï¼ŒåŸºæœ¬ä¸Šè¯¥æœ‰è¯¥çš„å·¥å…·ç±»ï¼Œå®ƒé‡Œé¢éƒ½æœ‰ã€‚â€è®²çœŸçš„ï¼Œæˆ‘å¹³å¸¸å·¥ä½œä¸­ä¹Ÿç»å¸¸ç”¨ Hutoolï¼Œå®ƒç¡®å®å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç®€åŒ–æ¯ä¸€è¡Œä»£ç ï¼Œä½¿ Java æ‹¥æœ‰å‡½æ•°å¼è¯­è¨€èˆ¬çš„ä¼˜é›…ï¼Œè®© Java è¯­è¨€å˜å¾—â€œç”œç”œçš„â€ã€‚

Hutool çš„ä½œè€…åœ¨[å®˜ç½‘](https://hutool.cn/)ä¸Šè¯´ï¼ŒHutool æ˜¯ Hu+tool çš„è‡ªé€ è¯ï¼ˆå¥½åƒä¸ç”¨è¯´ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½çŒœå¾—åˆ°ï¼‰ï¼Œâ€œHuâ€ç”¨æ¥è‡´æ•¬ä»–çš„â€œå‰ä»»â€å…¬å¸ï¼Œâ€œtoolâ€å°±æ˜¯å·¥å…·çš„æ„æ€ï¼Œè°éŸ³å°±æœ‰æ„æ€äº†ï¼Œâ€œç³Šæ¶‚â€ï¼Œå¯“æ„è¿½æ±‚â€œä¸‡äº‹éƒ½ä½œç³Šæ¶‚è§‚ï¼Œæ— æ‰€è°“å¤±ï¼Œæ— æ‰€è°“å¾—â€ï¼ˆä¸€ä¸ªå¼€æºç±»åº“ï¼Œä¸Šå‡åˆ°äº†å“²å­¦çš„é«˜åº¦ï¼Œä½œè€…å‰å®³äº†ï¼‰ã€‚

çœ‹äº†ä¸€ä¸‹å¼€å‘å›¢é˜Ÿçš„ä¸€ä¸ªæˆå‘˜ä»‹ç»ï¼Œä¸€ä¸ª Java åç«¯å·¥å…·çš„ä½œè€…ç«Ÿç„¶çˆ±å‰ç«¯ã€çˆ±æ•°ç ï¼Œçˆ±ç¾å¥³ï¼Œå—¯å—¯å—¯ï¼Œç¡®å®â€œéš¾å¾—ç³Šæ¶‚â€ï¼ˆæ‰‹åŠ¨ç‹—å¤´ï¼‰ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/hutool-01.png)

åºŸè¯å°±è¯´åˆ°è¿™ï¼Œæ¥å§ï¼Œå®æ“èµ°èµ·ï¼

### 01ã€å¼•å…¥ Hutool

Maven é¡¹ç›®åªéœ€è¦åœ¨ pom.xml æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–å³å¯ã€‚

```
<dependency>
    <groupId>cn.hutool</groupId>
    <artifactId>hutool-all</artifactId>
    <version>5.4.3</version>
</dependency>
```

Hutool çš„è®¾è®¡æ€æƒ³æ˜¯å°½é‡å‡å°‘é‡å¤çš„å®šä¹‰ï¼Œè®©é¡¹ç›®ä¸­çš„ util åŒ…å°½é‡å°‘ã€‚ä¸€ä¸ªå¥½çš„è½®å­å¯ä»¥åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…â€œå¤åˆ¶ç²˜è´´â€ï¼Œä»è€ŒèŠ‚çœæˆ‘ä»¬å¼€å‘äººå‘˜å¯¹é¡¹ç›®ä¸­å…¬ç”¨ç±»åº“å’Œå…¬ç”¨å·¥å…·æ–¹æ³•çš„å°è£…æ—¶é—´ã€‚åŒæ—¶å‘¢ï¼Œæˆç†Ÿçš„å¼€æºåº“ä¹Ÿå¯ä»¥æœ€å¤§é™åº¦çš„é¿å…å°è£…ä¸å®Œå–„å¸¦æ¥çš„ bugã€‚

å°±åƒä½œè€…åœ¨å®˜ç½‘ä¸Šè¯´çš„é‚£æ ·ï¼š

- ä»¥å‰ï¼Œæˆ‘ä»¬æ‰“å¼€æœç´¢å¼•æ“ -> æœâ€œJava MD5 åŠ å¯†â€ -> æ‰“å¼€æŸç¯‡åšå®¢ -> å¤åˆ¶ç²˜è´´ -> æ”¹æ”¹ï¼Œå˜å¾—å¥½ç”¨äº›
- æœ‰äº† Hutool ä»¥åå‘¢ï¼Œå¼•å…¥ Hutool -> ç›´æ¥ `SecureUtil.md5()`

Hutool å¯¹ä¸ä»…å¯¹ JDK åº•å±‚çš„æ–‡ä»¶ã€æµã€åŠ å¯†è§£å¯†ã€è½¬ç ã€æ­£åˆ™ã€çº¿ç¨‹ã€XMLç­‰åšäº†å°è£…ï¼Œè¿˜æä¾›äº†ä»¥ä¸‹è¿™äº›ç»„ä»¶ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/hutool-02.png)

éå¸¸å¤šï¼Œéå¸¸å…¨é¢ï¼Œé‰´äºæ­¤ï¼Œæˆ‘åªæŒ‘é€‰ä¸€äº›æˆ‘å–œæ¬¢çš„æ¥ä»‹ç»ä¸‹ï¼ˆå·å·åœ°å‘Šè¯‰ä½ ï¼Œæˆ‘å°±æ˜¯æƒ³å·æ‡’ï¼‰ã€‚

### 02ã€ç±»å‹è½¬æ¢

ç±»å‹è½¬æ¢åœ¨ Java å¼€å‘ä¸­å¾ˆå¸¸è§ï¼Œå°¤å…¶æ˜¯ä» HttpRequest ä¸­è·å–å‚æ•°çš„æ—¶å€™ï¼Œå‰ç«¯ä¼ é€’çš„æ˜¯æ•´å‹ï¼Œä½†åç«¯åªèƒ½å…ˆè·å–åˆ°å­—ç¬¦ä¸²ï¼Œç„¶åå†è°ƒç”¨ `parseXXX()` æ–¹æ³•è¿›è¡Œè½¬æ¢ï¼Œè¿˜è¦åŠ ä¸Šåˆ¤ç©ºï¼Œå¾ˆç¹çã€‚

Hutool çš„ Convert ç±»å¯ä»¥ç®€åŒ–è¿™ä¸ªæ“ä½œï¼Œå¯ä»¥å°†ä»»æ„å¯èƒ½çš„ç±»å‹è½¬æ¢ä¸ºæŒ‡å®šç±»å‹ï¼ŒåŒæ—¶ç¬¬äºŒä¸ªå‚æ•° defaultValue å¯ç”¨äºåœ¨è½¬æ¢å¤±è´¥æ—¶è¿”å›ä¸€ä¸ªé»˜è®¤å€¼ã€‚

```java
String param = "10";
int paramInt = Convert.toInt(param);
int paramIntDefault = Convert.toInt(param, 0);
```

æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆæ—¥æœŸï¼š

```java
String dateStr = "2020å¹´09æœˆ29æ—¥";
Date date = Convert.toDate(dateStr);
```

æŠŠå­—ç¬¦ä¸²è½¬æˆ Unicodeï¼š

```java
String unicodeStr = "æ²‰é»˜ç‹äºŒ";
String unicode = Convert.strToUnicode(unicodeStr);
```

### 03ã€æ—¥æœŸæ—¶é—´

JDK è‡ªå¸¦çš„ Date å’Œ Calendar ä¸å¤ªå¥½ç”¨ï¼ŒHutool å°è£…çš„ DateUtil ç”¨èµ·æ¥å°±èˆ’æœå¤šäº†ï¼

è·å–å½“å‰æ—¥æœŸï¼š

```java
Date date = DateUtil.date();
```

`DateUtil.date()` è¿”å›çš„å…¶å®æ˜¯ DateTimeï¼Œå®ƒç»§æ‰¿è‡ª Date å¯¹è±¡ï¼Œé‡å†™äº† `toString()` æ–¹æ³•ï¼Œè¿”å› `yyyy-MM-dd HH:mm:ss` æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚

æœ‰äº›å°ä¼™ä¼´æ˜¯ä¸æ˜¯æƒ³çœ‹çœ‹æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„æ—¶é—´ï¼Œè¾“å‡ºä¸€ä¸‹ç»™å¤§å®¶çœ‹çœ‹ï¼š

```
System.out.println(date);// 2020-09-29 04:28:02
```

å­—ç¬¦ä¸²è½¬æ—¥æœŸï¼š

```java
String dateStr = "2020-09-29";
Date date = DateUtil.parse(dateStr);
```

`DateUtil.parse()` ä¼šè‡ªåŠ¨è¯†åˆ«ä¸€äº›å¸¸ç”¨çš„æ ¼å¼ï¼Œæ¯”å¦‚è¯´ï¼š

- yyyy-MM-dd HH:mm:ss
- yyyy-MM-dd
- HH:mm:ss
- yyyy-MM-dd HH:mm
- yyyy-MM-dd HH:mm:ss.SSS

è¿˜å¯ä»¥è¯†åˆ«å¸¦ä¸­æ–‡çš„ï¼š

- å¹´æœˆæ—¥æ—¶åˆ†ç§’

æ ¼å¼åŒ–æ—¶é—´å·®ï¼š

```java
String dateStr1 = "2020-09-29 22:33:23";
Date date1 = DateUtil.parse(dateStr1);

String dateStr2 = "2020-10-01 23:34:27";
Date date2 = DateUtil.parse(dateStr2);

long betweenDay = DateUtil.between(date1, date2, DateUnit.MS);

// è¾“å‡ºï¼š2å¤©1å°æ—¶1åˆ†4ç§’
String formatBetween = DateUtil.formatBetween(betweenDay, BetweenFormater.Level.SECOND);
```

æ˜Ÿåº§å’Œå±ç›¸ï¼š

```java
// å°„æ‰‹åº§
String zodiac = DateUtil.getZodiac(Month.DECEMBER.getValue(), 10);
// è›‡
String chineseZodiac = DateUtil.getChineseZodiac(1989);
```

### 04ã€IO æµç›¸å…³

[IO æ“ä½œåŒ…æ‹¬è¯»å’Œå†™](https://tobebetterjavaer.com/io/shangtou.html)ï¼Œåº”ç”¨çš„åœºæ™¯ä¸»è¦åŒ…æ‹¬ç½‘ç»œæ“ä½œå’Œæ–‡ä»¶æ“ä½œï¼ŒåŸç”Ÿçš„ Java ç±»åº“åŒºåˆ†[å­—ç¬¦æµ](https://tobebetterjavaer.com/io/reader-writer.html)å’Œ[å­—èŠ‚æµ](https://tobebetterjavaer.com/io/stream.html)ï¼Œå­—èŠ‚æµ InputStream å’Œ OutputStream å°±æœ‰å¾ˆå¤šå¾ˆå¤šç§ï¼Œä½¿ç”¨èµ·æ¥è®©äººå¤´çš®å‘éº»ã€‚

Hutool å°è£…äº†æµæ“ä½œå·¥å…·ç±» IoUtilã€æ–‡ä»¶è¯»å†™æ“ä½œå·¥å…·ç±» FileUtilã€æ–‡ä»¶ç±»å‹åˆ¤æ–­å·¥å…·ç±» FileTypeUtil ç­‰ç­‰ã€‚

```java
BufferedInputStream in = FileUtil.getInputStream("hutool/origin.txt");
BufferedOutputStream out = FileUtil.getOutputStream("hutool/to.txt");
long copySize = IoUtil.copy(in, out, IoUtil.DEFAULT_BUFFER_SIZE);
```

åœ¨ IO æ“ä½œä¸­ï¼Œæ–‡ä»¶çš„æ“ä½œç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œä½†ä½¿ç”¨é¢‘ç‡ä¹Ÿå¾ˆé«˜ï¼Œå‡ ä¹æ‰€æœ‰çš„é¡¹ç›®ä¸­éƒ½èººç€ä¸€ä¸ªå« FileUtil æˆ–è€… FileUtils çš„å·¥å…·ç±»ã€‚Hutool çš„ FileUtil ç±»åŒ…å«ä»¥ä¸‹å‡ ç±»æ“ä½œï¼š

- æ–‡ä»¶æ“ä½œï¼šåŒ…æ‹¬æ–‡ä»¶ç›®å½•çš„æ–°å»ºã€åˆ é™¤ã€å¤åˆ¶ã€ç§»åŠ¨ã€æ”¹åç­‰
- æ–‡ä»¶åˆ¤æ–­ï¼šåˆ¤æ–­æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦éç©ºï¼Œæ˜¯å¦ä¸ºç›®å½•ï¼Œæ˜¯å¦ä¸ºæ–‡ä»¶ç­‰ç­‰
- ç»å¯¹è·¯å¾„ï¼šé’ˆå¯¹ ClassPath ä¸­çš„æ–‡ä»¶è½¬æ¢ä¸ºç»å¯¹è·¯å¾„æ–‡ä»¶
- æ–‡ä»¶åï¼šä¸»æ–‡ä»¶åï¼Œæ‰©å±•åçš„è·å–
- è¯»æ“ä½œï¼šåŒ…æ‹¬ getReaderã€readXXX æ“ä½œ
- å†™æ“ä½œï¼šåŒ…æ‹¬ getWriterã€writeXXX æ“ä½œ

é¡ºå¸¦è¯´è¯´ classpathã€‚

åœ¨å®é™…ç¼–ç å½“ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦ä»æŸäº›æ–‡ä»¶é‡Œé¢è¯»å–ä¸€äº›æ•°æ®ï¼Œæ¯”å¦‚é…ç½®æ–‡ä»¶ã€æ–‡æœ¬æ–‡ä»¶ã€å›¾ç‰‡ç­‰ç­‰ï¼Œé‚£è¿™äº›æ–‡ä»¶é€šå¸¸æ”¾åœ¨ä»€ä¹ˆä½ç½®å‘¢ï¼Ÿ

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/hutool-03.png)

æ”¾åœ¨é¡¹ç›®ç»“æ„å›¾ä¸­çš„ resources ç›®å½•ä¸‹ï¼Œå½“é¡¹ç›®ç¼–è¯‘åï¼Œä¼šå‡ºç°åœ¨ classes ç›®å½•ä¸‹ã€‚å¯¹åº”ç£ç›˜ä¸Šçš„ç›®å½•å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/hutool-04.png)

å½“æˆ‘ä»¬è¦è¯»å–æ–‡ä»¶çš„æ—¶å€™ï¼Œæˆ‘æ˜¯ä¸å»ºè®®ä½¿ç”¨ç»å¯¹è·¯å¾„çš„ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿä¸ä¸€æ ·çš„è¯ï¼Œæ–‡ä»¶çš„è·¯å¾„æ ‡è¯†ç¬¦ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚æœ€å¥½ä½¿ç”¨ç›¸å¯¹è·¯å¾„ã€‚

å‡è®¾åœ¨ `src/resources` ä¸‹æ”¾äº†ä¸€ä¸ªæ–‡ä»¶ origin.txtï¼Œæ–‡ä»¶çš„è·¯å¾„å‚æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
FileUtil.getInputStream("origin.txt")
```

å‡è®¾æ–‡ä»¶æ”¾åœ¨ `src/resources/hutool` ç›®å½•ä¸‹ï¼Œåˆ™è·¯å¾„å‚æ•°æ”¹ä¸ºï¼š

```java
FileUtil.getInputStream("hutool/origin.txt")
```

### 05ã€å­—ç¬¦ä¸²å·¥å…·

Hutool å°è£…çš„å­—ç¬¦ä¸²å·¥å…·ç±» StrUtil å’Œ Apache Commons Lang åŒ…ä¸­çš„ StringUtils ç±»ä¼¼ï¼Œä½œè€…è®¤ä¸ºä¼˜åŠ¿åœ¨äº Str æ¯” String çŸ­ï¼Œå°½ç®¡æˆ‘ä¸è§‰å¾—ã€‚ä¸è¿‡ï¼Œæˆ‘å€’æ˜¯æŒºå–œæ¬¢å…¶ä¸­çš„ä¸€ä¸ªæ–¹æ³•çš„ï¼š

```java
String template = "{}ï¼Œä¸€æšæ²‰é»˜ä½†æœ‰è¶£çš„ç¨‹åºå‘˜ï¼Œå–œæ¬¢ä»–çš„æ–‡ç« çš„è¯ï¼Œè¯·å¾®ä¿¡æœç´¢{}";
String str = StrUtil.format(template, "æ²‰é»˜ç‹äºŒ", "æ²‰é»˜ç‹äºŒ");
// æ²‰é»˜ç‹äºŒï¼Œä¸€æšæ²‰é»˜ä½†æœ‰è¶£çš„ç¨‹åºå‘˜ï¼Œå–œæ¬¢ä»–çš„æ–‡ç« çš„è¯ï¼Œè¯·å¾®ä¿¡æœç´¢æ²‰é»˜ç‹äºŒ
```

### 06ã€åå°„å·¥å…·

åå°„æœºåˆ¶å¯ä»¥è®© Java å˜å¾—æ›´åŠ çµæ´»ï¼Œå› æ­¤åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œåå°„å¯ä»¥åšåˆ°äº‹åŠåŠŸå€çš„æ•ˆæœã€‚Hutool å°è£…çš„åå°„å·¥å…· ReflectUtil åŒ…æ‹¬ï¼š

- è·å–æ„é€ æ–¹æ³•
- è·å–å­—æ®µ
- è·å–å­—æ®µå€¼
- è·å–æ–¹æ³•
- æ‰§è¡Œæ–¹æ³•ï¼ˆå¯¹è±¡æ–¹æ³•å’Œé™æ€æ–¹æ³•ï¼‰

```java
package com.itwanger.hutool.reflect;

import cn.hutool.core.util.ReflectUtil;

import java.lang.reflect.Constructor;
import java.lang.reflect.Field;
import java.lang.reflect.Method;

public class ReflectDemo {
    private int id;

    public ReflectDemo() {
        System.out.println("æ„é€ æ–¹æ³•");
    }

    public void print() {
        System.out.println("æˆ‘æ˜¯æ²‰é»˜ç‹äºŒ");
    }

    public static void main(String[] args) throws IllegalAccessException {
        // æ„å»ºå¯¹è±¡
        ReflectDemo reflectDemo = ReflectUtil.newInstance(ReflectDemo.class);

        // è·å–æ„é€ æ–¹æ³•
        Constructor[] constructors = ReflectUtil.getConstructors(ReflectDemo.class);
        for (Constructor constructor : constructors) {
            System.out.println(constructor.getName());
        }

        // è·å–å­—æ®µ
        Field field = ReflectUtil.getField(ReflectDemo.class, "id");
        field.setInt(reflectDemo, 10);
        // è·å–å­—æ®µå€¼
        System.out.println(ReflectUtil.getFieldValue(reflectDemo, field));

        // è·å–æ‰€æœ‰æ–¹æ³•
        Method[] methods = ReflectUtil.getMethods(ReflectDemo.class);
        for (Method m : methods) {
            System.out.println(m.getName());
        }

        // è·å–æŒ‡å®šæ–¹æ³•
        Method method = ReflectUtil.getMethod(ReflectDemo.class, "print");
        System.out.println(method.getName());


        // æ‰§è¡Œæ–¹æ³•
        ReflectUtil.invoke(reflectDemo, "print");
    }
}
```

### 07ã€å‹ç¼©å·¥å…·

åœ¨ Java ä¸­ï¼Œå¯¹æ–‡ä»¶ã€æ–‡ä»¶å¤¹æ‰“åŒ…å‹ç¼©æ˜¯ä¸€ä»¶å¾ˆç¹ççš„äº‹æƒ…ï¼ŒHutool å°è£…çš„ ZipUtil é’ˆå¯¹ java.util.zip åŒ…åšäº†ä¼˜åŒ–ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ–¹æ³•æå®šå‹ç¼©å’Œè§£å‹ï¼Œå¹¶ä¸”è‡ªåŠ¨å¤„ç†æ–‡ä»¶å’Œç›®å½•çš„é—®é¢˜ï¼Œä¸å†éœ€è¦ç”¨æˆ·åˆ¤æ–­ï¼Œå¤§å¤§ç®€åŒ–çš„å‹ç¼©è§£å‹çš„å¤æ‚åº¦ã€‚

```java
ZipUtil.zip("hutool", "hutool.zip");
File unzip = ZipUtil.unzip("hutool.zip", "hutoolzip");
```

### 08ã€èº«ä»½è¯å·¥å…·

Hutool å°è£…çš„ IdcardUtil å¯ä»¥ç”¨æ¥å¯¹èº«ä»½è¯è¿›è¡ŒéªŒè¯ï¼Œæ”¯æŒå¤§é™† 15 ä½ã€18 ä½èº«ä»½è¯ï¼Œæ¸¯æ¾³å° 10 ä½èº«ä»½è¯ã€‚

```java
String ID_18 = "321083197812162119";
String ID_15 = "150102880730303";

boolean valid = IdcardUtil.isValidCard(ID_18);
boolean valid15 = IdcardUtil.isValidCard(ID_15);
```

### 09ã€æ‰©å±• HashMap

Java ä¸­çš„ HashMap æ˜¯å¼ºç±»å‹çš„ï¼Œè€Œ Hutool å°è£…çš„ Dict å¯¹é”®çš„ç±»å‹è¦æ±‚æ²¡é‚£ä¹ˆä¸¥æ ¼ã€‚

```java
Dict dict = Dict.create()
        .set("age", 18)
        .set("name", "æ²‰é»˜ç‹äºŒ")
        .set("birthday", DateTime.now());

int age = dict.getInt("age");
String name = dict.getStr("name");
```

### 10ã€æ§åˆ¶å°æ‰“å°

æœ¬åœ°ç¼–ç çš„è¿‡ç¨‹ä¸­ï¼Œç»å¸¸éœ€è¦ä½¿ç”¨ `System.out` æ‰“å°ç»“æœï¼Œä½†æ˜¯å¾€å¾€ä¸€äº›å¤æ‚çš„å¯¹è±¡ä¸æ”¯æŒç›´æ¥æ‰“å°ï¼Œæ¯”å¦‚è¯´æ•°ç»„ï¼Œéœ€è¦è°ƒç”¨ `Arrays.toString`ã€‚Hutool å°è£…çš„ Console ç±»å€Ÿé‰´äº† JavaScript ä¸­çš„ `console.log()`ï¼Œä½¿å¾—æ‰“å°å˜æˆäº†ä¸€ä¸ªéå¸¸ä¾¿æ·çš„æ–¹å¼ã€‚

```java
public class ConsoleDemo {
    public static void main(String[] args) {
        // æ‰“å°å­—ç¬¦ä¸²
        Console.log("æ²‰é»˜ç‹äºŒï¼Œä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜");

        // æ‰“å°å­—ç¬¦ä¸²æ¨¡æ¿
        Console.log("æ´›é˜³æ˜¯{}æœå¤éƒ½",13);

        int [] ints = {1,2,3,4};
        // æ‰“å°æ•°ç»„
        Console.log(ints);
    }
}
```

### 11ã€å­—æ®µéªŒè¯å™¨

åš Web å¼€å‘çš„æ—¶å€™ï¼Œåç«¯é€šå¸¸éœ€è¦å¯¹è¡¨å•æäº¤è¿‡æ¥çš„æ•°æ®è¿›è¡ŒéªŒè¯ã€‚Hutool å°è£…çš„ Validator å¯ä»¥è¿›è¡Œå¾ˆå¤šæœ‰æ•ˆçš„æ¡ä»¶éªŒè¯ï¼š

- æ˜¯ä¸æ˜¯é‚®ç®±
- æ˜¯ä¸æ˜¯ IP V4ã€V6
- æ˜¯ä¸æ˜¯ç”µè¯å·ç 
- ç­‰ç­‰

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/hutool-05.png)

```java
Validator.isEmail("æ²‰é»˜ç‹äºŒ");
Validator.isMobile("itwanger.com");
```

### 12ã€åŒå‘æŸ¥æ‰¾ Map

[Guava](https://tobebetterjavaer.com/common-tool/guava.html) ä¸­æä¾›äº†ä¸€ç§ç‰¹æ®Šçš„ Map ç»“æ„ï¼Œå«åš BiMapï¼Œå®ç°äº†ä¸€ç§åŒå‘æŸ¥æ‰¾çš„åŠŸèƒ½ï¼Œå¯ä»¥æ ¹æ® key æŸ¥æ‰¾ valueï¼Œä¹Ÿå¯ä»¥æ ¹æ® value æŸ¥æ‰¾ keyï¼ŒHutool ä¹Ÿæä¾›è¿™ç§ Map ç»“æ„ã€‚

```java
BiMap<String, String> biMap = new BiMap<>(new HashMap<>());
biMap.put("wanger", "æ²‰é»˜ç‹äºŒ");
biMap.put("wangsan", "æ²‰é»˜ç‹ä¸‰");

// get value by key
biMap.get("wanger");
biMap.get("wangsan");

// get key by value
biMap.getKey("æ²‰é»˜ç‹äºŒ");
biMap.getKey("æ²‰é»˜ç‹ä¸‰");
```

åœ¨å®é™…çš„å¼€å‘å·¥ä½œä¸­ï¼Œå…¶å®æˆ‘æ›´å€¾å‘äºä½¿ç”¨ Guava çš„ BiMapï¼Œè€Œä¸æ˜¯ Hutool çš„ã€‚è¿™é‡Œæä¸€ä¸‹ï¼Œä¸»è¦æ˜¯æˆ‘å‘ç°äº† Hutool åœ¨çº¿æ–‡æ¡£ä¸Šçš„ä¸€å¤„é”™è¯¯ï¼Œæäº†ä¸ª issueï¼ˆä»ä¸­å¯ä»¥çœ‹å‡ºæˆ‘ä¸€é¢—ä¸€ä¸ä¸è‹Ÿçš„å¿ƒå’Œä¸€åŒæ¸…æ¾ˆæ˜äº®çš„å¤§çœ¼ç›å•Šï¼‰ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/hutool-06.png)

### 13ã€å›¾ç‰‡å·¥å…·

Hutool å°è£…çš„ ImgUtil å¯ä»¥å¯¹å›¾ç‰‡è¿›è¡Œç¼©æ”¾ã€è£å‰ªã€è½¬ä¸ºé»‘ç™½ã€åŠ æ°´å°ç­‰æ“ä½œã€‚

ç¼©æ”¾å›¾ç‰‡ï¼š

```java
ImgUtil.scale(
        FileUtil.file("hutool/wangsan.jpg"),
        FileUtil.file("hutool/wangsan_small.jpg"),
        0.5f
);
```

è£å‰ªå›¾ç‰‡ï¼š

```java
ImgUtil.cut(
        FileUtil.file("hutool/wangsan.jpg"),
        FileUtil.file("hutool/wangsan_cut.jpg"),
        new Rectangle(200, 200, 100, 100)
);
```

æ·»åŠ æ°´å°ï¼š

```java
ImgUtil.pressText(//
        FileUtil.file("hutool/wangsan.jpg"),
        FileUtil.file("hutool/wangsan_logo.jpg"),
        "æ²‰é»˜ç‹äºŒ", Color.WHITE,
        new Font("é»‘ä½“", Font.BOLD, 100),
        0,
        0,
        0.8f
);
```

è¶æœºè®©å¤§å®¶æ¬£èµä¸€ä¸‹äºŒå“¥å¸…æ°”çš„çœŸå®¹ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/hutool-07.png)

### 14ã€é…ç½®æ–‡ä»¶

>ä¼—æ‰€å‘¨çŸ¥ï¼ŒJava ä¸­å¹¿æ³›åº”ç”¨çš„é…ç½®æ–‡ä»¶ Properties å­˜åœ¨ä¸€ä¸ªç‰¹åˆ«å¤§çš„è¯Ÿç—…ï¼šä¸æ”¯æŒä¸­æ–‡ã€‚æ¯æ¬¡ä½¿ç”¨æ—¶ï¼Œå¦‚æœæƒ³å­˜æ”¾ä¸­æ–‡å­—ç¬¦ï¼Œå°±å¿…é¡»å€ŸåŠ© IDE ç›¸å…³æ’ä»¶æ‰èƒ½è½¬ä¸º Unicode ç¬¦å·ï¼Œè€Œè¿™ç§åäººç±»çš„ç¬¦å·åœ¨å‘½ä»¤è¡Œä¸‹æ ¹æœ¬æ²¡æ³•çœ‹ã€‚

äºæ˜¯ï¼ŒHutool çš„ Setting è¿ç”¨è€Œç”Ÿã€‚Setting é™¤äº†å…¼å®¹ Properties æ–‡ä»¶æ ¼å¼å¤–ï¼Œè¿˜æä¾›äº†ä¸€äº›ç‰¹æœ‰åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½åŒ…æ‹¬ï¼š

- å„ç§ç¼–ç æ–¹å¼æ”¯æŒ
- å˜é‡æ”¯æŒ
- åˆ†ç»„æ”¯æŒ

å…ˆæ•´ä¸ªé…ç½®æ–‡ä»¶ example.settingï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```
name=æ²‰é»˜ç‹äºŒ
age=18
```

å†æ¥è¯»å–å’Œæ›´æ–°é…ç½®æ–‡ä»¶ï¼š

```java
public class SettingDemo {
    private final static String SETTING = "hutool/example.setting";
    public static void main(String[] args) {
        // åˆå§‹åŒ– Setting
        Setting setting = new Setting(SETTING);

        // è¯»å–
        setting.getStr("name", "æ²‰é»˜ç‹äºŒ");

        // åœ¨é…ç½®æ–‡ä»¶å˜æ›´æ—¶è‡ªåŠ¨åŠ è½½
        setting.autoLoad(true);

        // é€šè¿‡ä»£ç æ–¹å¼å¢åŠ é”®å€¼å¯¹
        setting.set("birthday", "2020å¹´09æœˆ29æ—¥");
        setting.store(SETTING);
    }
}
```

### 15ã€æ—¥å¿—å·¥å‚

Hutool å°è£…çš„æ—¥å¿—å·¥å‚ LogFactory å…¼å®¹äº†å„å¤§æ—¥å¿—æ¡†æ¶ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿéå¸¸ç®€ä¾¿ã€‚

```java
public class LogDemo {
    private static final Log log = LogFactory.get();

    public static void main(String[] args) {
        log.debug("éš¾å¾—ç³Šæ¶‚");
    }
}
```

å…ˆé€šè¿‡ `LogFactory.get()` è‡ªåŠ¨è¯†åˆ«å¼•å…¥çš„æ—¥å¿—æ¡†æ¶ï¼Œä»è€Œåˆ›å»ºå¯¹åº”æ—¥å¿—æ¡†æ¶çš„é—¨é¢ Log å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ `debug()`ã€`info()` ç­‰æ–¹æ³•è¾“å‡ºæ—¥å¿—ã€‚

å¦‚æœä¸æƒ³åˆ›å»º Log å¯¹è±¡çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ StaticLogï¼Œé¡¾åæ€ä¹‰ï¼Œä¸€ä¸ªæä¾›äº†é™æ€æ–¹æ³•çš„æ—¥å¿—ç±»ã€‚

```java
StaticLog.info("çˆ½å•Š {}.", "æ²‰é»˜ç‹äºŒçš„æ–‡ç« ");
```

### 16ã€ç¼“å­˜å·¥å…·

CacheUtil æ˜¯ Hutool å°è£…çš„åˆ›å»ºç¼“å­˜çš„å¿«æ·å·¥å…·ç±»ï¼Œå¯ä»¥åˆ›å»ºä¸åŒçš„ç¼“å­˜å¯¹è±¡ï¼š

- FIFOCacheï¼šå…ˆå…¥å…ˆå‡ºï¼Œå…ƒç´ ä¸åœçš„åŠ å…¥ç¼“å­˜ç›´åˆ°ç¼“å­˜æ»¡ä¸ºæ­¢ï¼Œå½“ç¼“å­˜æ»¡æ—¶ï¼Œæ¸…ç†è¿‡æœŸç¼“å­˜å¯¹è±¡ï¼Œæ¸…ç†åä¾æ—§æ»¡åˆ™åˆ é™¤å…ˆå…¥çš„ç¼“å­˜ã€‚

```java
Cache<String, String> fifoCache = CacheUtil.newFIFOCache(3);
fifoCache.put("key1", "æ²‰é»˜ç‹ä¸€");
fifoCache.put("key2", "æ²‰é»˜ç‹äºŒ");
fifoCache.put("key3", "æ²‰é»˜ç‹ä¸‰");
fifoCache.put("key4", "æ²‰é»˜ç‹å››");

// å¤§å°ä¸º 3ï¼Œæ‰€ä»¥ key3 æ”¾å…¥å key1 è¢«æ¸…é™¤
String value1 = fifoCache.get("key1");
```

- LFUCacheï¼Œæœ€å°‘ä½¿ç”¨ï¼Œæ ¹æ®ä½¿ç”¨æ¬¡æ•°æ¥åˆ¤å®šå¯¹è±¡æ˜¯å¦è¢«æŒç»­ç¼“å­˜ï¼Œå½“ç¼“å­˜æ»¡æ—¶æ¸…ç†è¿‡æœŸå¯¹è±¡ï¼Œæ¸…ç†åä¾æ—§æ»¡çš„æƒ…å†µä¸‹æ¸…é™¤æœ€å°‘è®¿é—®çš„å¯¹è±¡å¹¶å°†å…¶ä»–å¯¹è±¡çš„è®¿é—®æ•°å‡å»è¿™ä¸ªæœ€å°‘è®¿é—®æ•°ï¼Œä»¥ä¾¿æ–°å¯¹è±¡è¿›å…¥åå¯ä»¥å…¬å¹³è®¡æ•°ã€‚

```java
Cache<String, String> lfuCache = CacheUtil.newLFUCache(3);

lfuCache.put("key1", "æ²‰é»˜ç‹ä¸€");
// ä½¿ç”¨æ¬¡æ•°+1
lfuCache.get("key1");
lfuCache.put("key2", "æ²‰é»˜ç‹äºŒ");
lfuCache.put("key3", "æ²‰é»˜ç‹ä¸‰");
lfuCache.put("key4", "æ²‰é»˜ç‹å››");

// ç”±äºç¼“å­˜å®¹é‡åªæœ‰ 3ï¼Œå½“åŠ å…¥ç¬¬ 4 ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œæœ€å°‘ä½¿ç”¨çš„å°†è¢«ç§»é™¤ï¼ˆ2,3è¢«ç§»é™¤ï¼‰
String value2 = lfuCache.get("key2");
String value3 = lfuCache.get("key3");
```

- LRUCacheï¼Œæœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ï¼Œæ ¹æ®ä½¿ç”¨æ—¶é—´æ¥åˆ¤å®šå¯¹è±¡æ˜¯å¦è¢«æŒç»­ç¼“å­˜ï¼Œå½“å¯¹è±¡è¢«è®¿é—®æ—¶æ”¾å…¥ç¼“å­˜ï¼Œå½“ç¼“å­˜æ»¡äº†ï¼Œæœ€ä¹…æœªè¢«ä½¿ç”¨çš„å¯¹è±¡å°†è¢«ç§»é™¤ã€‚

```java
Cache<String, String> lruCache = CacheUtil.newLRUCache(3);

lruCache.put("key1", "æ²‰é»˜ç‹ä¸€");
lruCache.put("key2", "æ²‰é»˜ç‹äºŒ");
lruCache.put("key3", "æ²‰é»˜ç‹ä¸‰");
// ä½¿ç”¨æ—¶é—´è¿‘äº†
lruCache.get("key1");
lruCache.put("key4", "æ²‰é»˜ç‹å››");

// ç”±äºç¼“å­˜å®¹é‡åªæœ‰ 3ï¼Œå½“åŠ å…¥ç¬¬ 4 ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œæœ€ä¹…ä½¿ç”¨çš„å°†è¢«ç§»é™¤ï¼ˆ2ï¼‰
String value2 = lruCache.get("key2");
System.out.println(value2);
```

### 17ã€åŠ å¯†è§£å¯†

åŠ å¯†åˆ†ä¸ºä¸‰ç§ï¼š

- å¯¹ç§°åŠ å¯†ï¼ˆsymmetricï¼‰ï¼Œä¾‹å¦‚ï¼šAESã€DES ç­‰
- éå¯¹ç§°åŠ å¯†ï¼ˆasymmetricï¼‰ï¼Œä¾‹å¦‚ï¼šRSAã€DSA ç­‰
- æ‘˜è¦åŠ å¯†ï¼ˆdigestï¼‰ï¼Œä¾‹å¦‚ï¼šMD5ã€SHA-1ã€SHA-256ã€HMAC ç­‰

Hutool é’ˆå¯¹è¿™ä¸‰ç§æƒ…å†µéƒ½åšäº†å°è£…ï¼š

- å¯¹ç§°åŠ å¯† SymmetricCrypto
- éå¯¹ç§°åŠ å¯† AsymmetricCrypto
- æ‘˜è¦åŠ å¯† Digester

å¿«é€ŸåŠ å¯†å·¥å…·ç±» SecureUtil æœ‰ä»¥ä¸‹è¿™äº›æ–¹æ³•ï¼š

1ï¼‰å¯¹ç§°åŠ å¯†

- SecureUtil.aes
- SecureUtil.des

2ï¼‰éå¯¹ç§°åŠ å¯†

- SecureUtil.rsa
- SecureUtil.dsa

3ï¼‰æ‘˜è¦åŠ å¯†

- SecureUtil.md5
- SecureUtil.sha1
- SecureUtil.hmac
- SecureUtil.hmacMd5
- SecureUtil.hmacSha1

åªå†™ä¸€ä¸ªç®€å•çš„ä¾‹å­ä½œä¸ºå‚è€ƒï¼š

```java
public class SecureUtilDemo {
    static AES aes = SecureUtil.aes();
    public static void main(String[] args) {
        String encry = aes.encryptHex("æ²‰é»˜ç‹äºŒ");
        System.out.println(encry);
        String oo = aes.decryptStr(encry);
        System.out.println(oo);
    }
}
```

### 18ã€å…¶ä»–ç±»åº“

Hutool ä¸­çš„ç±»åº“è¿˜æœ‰å¾ˆå¤šï¼Œå°¤å…¶æ˜¯ä¸€äº›å¯¹ç¬¬ä¸‰æ–¹ç±»åº“çš„è¿›ä¸€æ­¥å°è£…ï¼Œæ¯”å¦‚é‚®ä»¶å·¥å…· MailUtilï¼ŒäºŒç»´ç å·¥å…· QrCodeUtilï¼ŒEmoji å·¥å…· EmojiUtilï¼Œå°ä¼™ä¼´ä»¬å¯ä»¥å‚è€ƒ Hutool çš„å®˜æ–¹æ–‡æ¡£ï¼šhttps://www.hutool.cn/

é¡¹ç›®æºç åœ°å€ï¼š[https://github.com/looly/hutool](https://github.com/looly/hutool)

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 9.7 Guavaå·¥å…·åº“

### 01ã€å‰ä¸–ä»Šç”Ÿ

ä½ å¥½å‘€ï¼Œæˆ‘æ˜¯ Guavaã€‚

æˆ‘ç”± Google å…¬å¸å¼€æºï¼Œç›®å‰åœ¨ GitHub ä¸Šå·²ç»æœ‰ 39.9k çš„é“ç²‰äº†ï¼Œç”±æ­¤å¯ä»¥è¯æ˜æˆ‘çš„å—æ¬¢è¿ç¨‹åº¦ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/guava-01.png)

æˆ‘çš„èº«ä½“é‡Œä¸»è¦åŒ…å«æœ‰è¿™äº›å¸¸ç”¨çš„æ¨¡å—ï¼šé›†åˆ [collections] ã€ç¼“å­˜ [caching] ã€åŸç”Ÿç±»å‹æ”¯æŒ [primitives support] ã€å¹¶å‘åº“ [concurrency libraries] ã€é€šç”¨æ³¨è§£ [common annotations] ã€å­—ç¬¦ä¸²å¤„ç† [string processing] ã€I/O ç­‰ã€‚æ–°ç‰ˆçš„ JDK ä¸­å·²ç»ç›´æ¥æŠŠæˆ‘å¼•å…¥äº†ï¼Œå¯æƒ³è€ŒçŸ¥æˆ‘æœ‰å¤šä¼˜ç§€ï¼Œå¿ä¸ä½éª„å‚²äº†ã€‚

è¿™ä¹ˆè¯´å§ï¼Œå­¦å¥½å¦‚ä½•ä½¿ç”¨æˆ‘ï¼Œèƒ½è®©ä½ åœ¨ç¼–ç¨‹ä¸­å˜å¾—æ›´å¿«ä¹ï¼Œå†™å‡ºæ›´ä¼˜é›…çš„ä»£ç ï¼

### 02ã€å¼•å…¥ Guava

å¦‚æœä½ è¦åœ¨ Maven é¡¹ç›®ä½¿ç”¨æˆ‘çš„è¯ï¼Œéœ€è¦å…ˆåœ¨ pom.xml æ–‡ä»¶ä¸­å¼•å…¥æˆ‘çš„ä¾èµ–ã€‚

```
<dependency>
    <groupId>com.google.guava</groupId>
    <artifactId>guava</artifactId>
    <version>30.1-jre</version>
</dependency>
```

ä¸€ç‚¹è¦æ±‚ï¼ŒJDK ç‰ˆæœ¬éœ€è¦åœ¨ 8 ä»¥ä¸Šã€‚

### 03ã€åŸºæœ¬å·¥å…·

Doug Leaï¼Œjava.util.concurrent åŒ…çš„ä½œè€…ï¼Œæ›¾è¯´è¿‡ä¸€å¥è¯ï¼šâ€œ[null çœŸç³Ÿç³•](https://tobebetterjavaer.com/exception/npe.html)â€ã€‚Tony Hoareï¼Œå›¾çµå¥–å¾—ä¸»ã€å¿«é€Ÿæ’åºç®—æ³•çš„ä½œè€…ï¼Œå½“ç„¶ä¹Ÿæ˜¯ null çš„åˆ›å»ºè€…ï¼Œä¹Ÿæ›¾è¯´è¿‡ç±»ä¼¼çš„è¯ï¼šâ€œnull çš„ä½¿ç”¨ï¼Œè®©æˆ‘æŸå¤±äº†åäº¿ç¾å…ƒã€‚â€é‰´äºæ­¤ï¼Œæˆ‘ç”¨ Optional æ¥è¡¨ç¤ºå¯èƒ½ä¸º null çš„å¯¹è±¡ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/guava-20230329172935.png)


ä»£ç ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºã€‚

```java
Optional<Integer> possible = Optional.of(5);
possible.isPresent(); // returns true
possible.get(); // returns 5
```

æˆ‘å¤§å“¥ Java åœ¨ JDK 8 ä¸­æ–°å¢äº† [Optional ç±»](https://tobebetterjavaer.com/java8/optional.html)ï¼Œæ˜¾ç„¶æ˜¯ä»æˆ‘è¿™å€Ÿé‰´è¿‡å»çš„ï¼Œä¸è¿‡ä»–çš„å’Œæˆ‘çš„æœ‰äº›ä¸åŒã€‚

- æˆ‘çš„ Optional æ˜¯ abstract çš„ï¼Œæ„å‘³ç€æˆ‘å¯ä»¥æœ‰å­ç±»å¯¹è±¡ï¼›æˆ‘å¤§å“¥çš„æ˜¯ final çš„ï¼Œæ„å‘³ç€æ²¡æœ‰å­ç±»å¯¹è±¡ã€‚
- æˆ‘çš„ Optional å®ç°äº† Serializable æ¥å£ï¼Œå¯ä»¥åºåˆ—åŒ–ï¼›æˆ‘å¤§å“¥çš„æ²¡æœ‰ã€‚
- æˆ‘çš„ä¸€äº›æ–¹æ³•å’Œæˆ‘å¤§å“¥çš„ä¹Ÿä¸å°½ç›¸åŒã€‚

ä½¿ç”¨ Optional é™¤äº†èµ‹äºˆ null è¯­ä¹‰ï¼Œå¢åŠ äº†å¯è¯»æ€§ï¼Œæœ€å¤§çš„ä¼˜ç‚¹åœ¨äºå®ƒæ˜¯ä¸€ç§å‚»ç“œå¼çš„é˜²æŠ¤ã€‚Optional è¿«ä½¿ä½ ç§¯ææ€è€ƒå¼•ç”¨ç¼ºå¤±çš„æƒ…å†µï¼Œå› ä¸ºä½ å¿…é¡»æ˜¾å¼åœ°ä» Optional è·å–å¼•ç”¨ã€‚

é™¤äº† Optional ä¹‹å¤–ï¼Œæˆ‘è¿˜æä¾›äº†ï¼š

- å‚æ•°æ ¡éªŒ
- å¸¸è§çš„ Object æ–¹æ³•ï¼Œæ¯”å¦‚è¯´ Objects.equalsã€Objects.hashCodeï¼ŒJDK 7 å¼•å…¥çš„ Objects ç±»æä¾›åŒæ ·çš„æ–¹æ³•ï¼Œå½“ç„¶ä¹Ÿæ˜¯ä»æˆ‘è¿™å€Ÿé‰´çš„çµæ„Ÿã€‚
- æ›´å¼ºå¤§çš„æ¯”è¾ƒå™¨

### 04ã€é›†åˆ

é¦–å…ˆæˆ‘æ¥è¯´ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä¸å¯å˜é›†åˆã€‚

- ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚åœ¨å¹¶å‘ç¨‹åºä¸­ï¼Œä½¿ç”¨ä¸å¯å˜é›†åˆæ—¢ä¿è¯çº¿ç¨‹çš„å®‰å…¨æ€§ï¼Œä¹Ÿå¤§å¤§åœ°å¢å¼ºäº†å¹¶å‘æ—¶çš„æ•ˆç‡ï¼ˆè·Ÿå¹¶å‘é”æ–¹å¼ç›¸æ¯”ï¼‰ã€‚
- å¦‚æœä¸€ä¸ªå¯¹è±¡ä¸éœ€è¦æ”¯æŒä¿®æ”¹æ“ä½œï¼Œä¸å¯å˜çš„é›†åˆå°†ä¼šèŠ‚çœç©ºé—´å’Œæ—¶é—´çš„å¼€é”€ã€‚
- å¯ä»¥å½“ä½œä¸€ä¸ªå¸¸é‡æ¥å¯¹å¾…ï¼Œå¹¶ä¸”é›†åˆä¸­çš„å¯¹è±¡åœ¨ä»¥åä¹Ÿä¸ä¼šè¢«æ”¹å˜ã€‚

ä¸ JDK ä¸­æä¾›çš„ä¸å¯å˜é›†åˆç›¸æ¯”ï¼Œæˆ‘æä¾›çš„ Immutable æ‰æ˜¯çœŸæ­£çš„ä¸å¯å˜ï¼Œæˆ‘ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿæ¥çœ‹ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ã€‚

ä¸‹é¢çš„ä»£ç åˆ©ç”¨ JDK çš„ [`Collections.unmodifiableList(list)`](https://tobebetterjavaer.com/common-tool/collections.html) å¾—åˆ°ä¸€ä¸ªä¸å¯ä¿®æ”¹çš„é›†åˆ unmodifiableListã€‚

```java
List list = new ArrayList();
list.add("é›·å†›");
list.add("ä¹”å¸ƒæ–¯");

List unmodifiableList = Collections.unmodifiableList(list);
unmodifiableList.add("é©¬äº‘");
```

è¿è¡Œä»£ç å°†ä¼šå‡ºç°ä»¥ä¸‹å¼‚å¸¸ï¼š

```
Exception in thread "main" java.lang.UnsupportedOperationException
	at java.base/java.util.Collections$UnmodifiableCollection.add(Collections.java:1060)
	at com.itwanger.guava.NullTest.main(NullTest.java:29)
```

å¾ˆå¥½ï¼Œæ‰§è¡Œ `unmodifiableList.add()` çš„æ—¶å€™æŠ›å‡ºäº† UnsupportedOperationException å¼‚å¸¸ï¼Œè¯´æ˜ `Collections.unmodifiableList()` è¿”å›äº†ä¸€ä¸ªä¸å¯å˜é›†åˆã€‚ä½†çœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿ

ä½ å¯ä»¥æŠŠ `unmodifiableList.add()` æ¢æˆ `list.add()`ã€‚

```java
List list = new ArrayList();
list.add("é›·å†›");
list.add("ä¹”å¸ƒæ–¯");

List unmodifiableList = Collections.unmodifiableList(list);
list.add("é©¬äº‘");
```

å†æ¬¡æ‰§è¡Œçš„è¯ï¼Œç¨‹åºå¹¶æ²¡æœ‰æŠ¥é”™ï¼Œå¹¶ä¸”ä½ ä¼šå‘ç° unmodifiableList ä¸­çœŸçš„å¤šäº†ä¸€ä¸ªå…ƒç´ ã€‚è¯´æ˜ä»€ä¹ˆå‘¢ï¼Ÿ

`Collections.unmodifiableList(â€¦)` å®ç°çš„ä¸æ˜¯çœŸæ­£çš„ä¸å¯å˜é›†åˆï¼Œå½“åŸå§‹é›†åˆè¢«ä¿®æ”¹åï¼Œä¸å¯å˜é›†åˆé‡Œé¢çš„å…ƒç´ ä¹Ÿæ˜¯è·Ÿç€å‘ç”Ÿå˜åŒ–ã€‚

æˆ‘å°±ä¸ä¼šçŠ¯è¿™ç§é”™ï¼Œæ¥çœ‹ä¸‹é¢çš„ä»£ç ã€‚

```java
List<String> stringArrayList = Lists.newArrayList("é›·å†›","ä¹”å¸ƒæ–¯");
ImmutableList<String> immutableList = ImmutableList.copyOf(stringArrayList);
immutableList.add("é©¬äº‘");
```

å°è¯• `immutableList.add()` çš„æ—¶å€™ä¼šæŠ›å‡º `UnsupportedOperationException`ã€‚æˆ‘åœ¨æºç ä¸­å·²ç»æŠŠ `add()` æ–¹æ³•åºŸå¼ƒäº†ã€‚

```java
/**
  * Guaranteed to throw an exception and leave the collection unmodified.
  *
  * @throws UnsupportedOperationException always
  * @deprecated Unsupported operation.
  */
@CanIgnoreReturnValue
@Deprecated
@Override
public final boolean add(E e) {
  throw new UnsupportedOperationException();
}
```

å°è¯• `stringArrayList.add()` ä¿®æ”¹åŸé›†åˆçš„æ—¶å€™ immutableList å¹¶ä¸ä¼šå› æ­¤è€Œå‘ç”Ÿæ”¹å˜ã€‚

é™¤äº†ä¸å¯å˜é›†åˆä»¥å¤–ï¼Œæˆ‘è¿˜æä¾›äº†æ–°çš„é›†åˆç±»å‹ï¼Œæ¯”å¦‚è¯´ï¼š

- Multisetï¼Œå¯ä»¥å¤šæ¬¡æ·»åŠ ç›¸ç­‰çš„å…ƒç´ ã€‚å½“æŠŠ Multiset çœ‹æˆæ™®é€šçš„ Collection æ—¶ï¼Œå®ƒè¡¨ç°å¾—å°±åƒæ— åºçš„ ArrayListï¼›å½“æŠŠ Multiset çœ‹ä½œ `Map<E, Integer>` æ—¶ï¼Œå®ƒä¹Ÿæä¾›äº†ç¬¦åˆæ€§èƒ½æœŸæœ›çš„æŸ¥è¯¢æ“ä½œã€‚
- Multimapï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°æŠŠä¸€ä¸ªé”®æ˜ å°„åˆ°å¤šä¸ªå€¼ã€‚
- BiMapï¼Œä¸€ç§ç‰¹æ®Šçš„ Mapï¼Œå¯ä»¥ç”¨ `inverse()` åè½¬ 
 `BiMap<K, V>` çš„é”®å€¼æ˜ å°„ï¼›ä¿è¯å€¼æ˜¯å”¯ä¸€çš„ï¼Œå› æ­¤ `values()` è¿”å› Set è€Œä¸æ˜¯æ™®é€šçš„ Collectionã€‚

### 05ã€å­—ç¬¦ä¸²å¤„ç†

å­—ç¬¦ä¸²è¡¨ç¤ºå­—ç¬¦çš„ä¸å¯å˜åºåˆ—ï¼Œåˆ›å»ºåå°±ä¸èƒ½æ›´æ”¹ã€‚åœ¨æˆ‘ä»¬æ—¥å¸¸çš„å·¥ä½œä¸­ï¼Œå­—ç¬¦ä¸²çš„ä½¿ç”¨éå¸¸é¢‘ç¹ï¼Œç†Ÿç»ƒçš„å¯¹å…¶æ“ä½œå¯ä»¥æå¤§çš„æå‡æˆ‘ä»¬çš„å·¥ä½œæ•ˆç‡ã€‚

æˆ‘æä¾›äº†è¿æ¥å™¨â€”â€”Joinerï¼Œå¯ä»¥ç”¨åˆ†éš”ç¬¦æŠŠå­—ç¬¦ä¸²åºåˆ—è¿æ¥èµ·æ¥ã€‚ä¸‹é¢çš„ä»£ç å°†ä¼šè¿”å›â€œé›·å†›; ä¹”å¸ƒæ–¯â€ï¼Œä½ å¯ä»¥ä½¿ç”¨ `useForNull(String)` æ–¹æ³•ç”¨æŸä¸ªå­—ç¬¦ä¸²æ¥æ›¿æ¢ nullï¼Œè€Œä¸åƒ `skipNulls()` æ–¹æ³•é‚£æ ·ç›´æ¥å¿½ç•¥ nullã€‚

```java
Joiner joiner = Joiner.on("; ").skipNulls();
return joiner.join("é›·å†›", null, "ä¹”å¸ƒæ–¯");
```

æˆ‘è¿˜æä¾›äº†æ‹†åˆ†å™¨â€”â€” Splitterï¼Œå¯ä»¥æŒ‰ç…§æŒ‡å®šçš„åˆ†éš”ç¬¦æŠŠå­—ç¬¦ä¸²åºåˆ—è¿›è¡Œæ‹†åˆ†ã€‚

```java
Splitter.on(',')
        .trimResults()
        .omitEmptyStrings()
        .split("é›·å†›,ä¹”å¸ƒæ–¯,,   æ²‰é»˜ç‹äºŒ");
```

### 06ã€ç¼“å­˜

ç¼“å­˜åœ¨å¾ˆå¤šåœºæ™¯ä¸‹éƒ½æ˜¯ç›¸å½“æœ‰ç”¨çš„ã€‚ä½ åº”è¯¥çŸ¥é“ï¼Œæ£€ç´¢ä¸€ä¸ªå€¼çš„ä»£ä»·å¾ˆé«˜ï¼Œå°¤å…¶æ˜¯éœ€è¦ä¸æ­¢ä¸€æ¬¡è·å–å€¼çš„æ—¶å€™ï¼Œå°±åº”å½“è€ƒè™‘ä½¿ç”¨ç¼“å­˜ã€‚

æˆ‘æä¾›çš„ Cache å’Œ ConcurrentMap å¾ˆç›¸ä¼¼ï¼Œä½†ä¹Ÿä¸å®Œå…¨ä¸€æ ·ã€‚æœ€åŸºæœ¬çš„åŒºåˆ«æ˜¯ ConcurrentMap ä¼šä¸€ç›´ä¿å­˜æ‰€æœ‰æ·»åŠ çš„å…ƒç´ ï¼Œç›´åˆ°æ˜¾å¼åœ°ç§»é™¤ã€‚ç›¸å¯¹åœ°ï¼Œæˆ‘æä¾›çš„ Cache ä¸ºäº†é™åˆ¶å†…å­˜å ç”¨ï¼Œé€šå¸¸éƒ½è®¾å®šä¸ºè‡ªåŠ¨å›æ”¶å…ƒç´ ã€‚

å¦‚æœä½ æ„¿æ„æ¶ˆè€—ä¸€äº›å†…å­˜ç©ºé—´æ¥æå‡é€Ÿåº¦ï¼Œä½ èƒ½é¢„æ–™åˆ°æŸäº›é”®ä¼šè¢«æŸ¥è¯¢ä¸€æ¬¡ä»¥ä¸Šï¼Œç¼“å­˜ä¸­å­˜æ”¾çš„æ•°æ®æ€»é‡ä¸ä¼šè¶…å‡ºå†…å­˜å®¹é‡ï¼Œå°±å¯ä»¥ä½¿ç”¨ Cacheã€‚

æ¥ä¸ªç¤ºä¾‹ä½ æ„Ÿå—ä¸‹å§ã€‚

```java
@Test
public void testCache() throws ExecutionException, InterruptedException {

    CacheLoader cacheLoader = new CacheLoader<String, Animal>() {
        // å¦‚æœæ‰¾ä¸åˆ°å…ƒç´ ï¼Œä¼šè°ƒç”¨è¿™é‡Œ
        @Override
        public Animal load(String s) {
            return null;
        }
    };
    LoadingCache<String, Animal> loadingCache = CacheBuilder.newBuilder()
        .maximumSize(1000) // å®¹é‡
        .expireAfterWrite(3, TimeUnit.SECONDS) // è¿‡æœŸæ—¶é—´
        .removalListener(new MyRemovalListener()) // å¤±æ•ˆç›‘å¬å™¨
        .build(cacheLoader); //
    loadingCache.put("ç‹—", new Animal("æ—ºè´¢", 1));
    loadingCache.put("çŒ«", new Animal("æ±¤å§†", 3));
    loadingCache.put("ç‹¼", new Animal("ç°å¤ªç‹¼", 4));

    loadingCache.invalidate("çŒ«"); // æ‰‹åŠ¨å¤±æ•ˆ

    Animal animal = loadingCache.get("ç‹¼");
    System.out.println(animal);
    Thread.sleep(4 * 1000);
    // ç‹¼å·²ç»è‡ªåŠ¨è¿‡å»ï¼Œè·å–ä¸º null å€¼æŠ¥é”™
    System.out.println(loadingCache.get("ç‹¼"));
}

/**
 * ç¼“å­˜ç§»é™¤ç›‘å¬å™¨
 */
class MyRemovalListener implements RemovalListener<String, Animal> {

    @Override
    public void onRemoval(RemovalNotification<String, Animal> notification) {
        String reason = String.format("key=%s,value=%s,reason=%s", notification.getKey(), notification.getValue(), notification.getCause());
        System.out.println(reason);
    }
}

class Animal {
    private String name;
    private Integer age;

    public Animal(String name, Integer age) {
        this.name = name;
        this.age = age;
    }
}
```

CacheLoader ä¸­é‡å†™äº† load æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨æŸ¥è¯¢ç¼“å­˜æ²¡æœ‰å‘½ä¸­æ—¶è¢«è°ƒç”¨ï¼Œæˆ‘è¿™é‡Œç›´æ¥è¿”å›äº† nullï¼Œå…¶å®è¿™æ ·ä¼šåœ¨æ²¡æœ‰å‘½ä¸­æ—¶æŠ›å‡º CacheLoader returned null for key å¼‚å¸¸ä¿¡æ¯ã€‚

MyRemovalListener ä½œä¸ºç¼“å­˜å…ƒç´ å¤±æ•ˆæ—¶çš„ç›‘å¬ç±»ï¼Œåœ¨æœ‰å…ƒç´ ç¼“å­˜å¤±æ•ˆæ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ onRemoval æ–¹æ³•ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªæ–¹æ³•æ˜¯åŒæ­¥æ–¹æ³•ï¼Œå¦‚æœè¿™é‡Œè€—æ—¶è¾ƒé•¿ï¼Œä¼šé˜»å¡ç›´åˆ°å¤„ç†å®Œæˆã€‚

LoadingCache å°±æ˜¯ç¼“å­˜çš„ä¸»è¦æ“ä½œå¯¹è±¡äº†ï¼Œå¸¸ç”¨çš„å°±æ˜¯å…¶ä¸­çš„ put å’Œ get æ–¹æ³•äº†ã€‚

### 07ã€é›†åˆå·¥å…·

`com.google.common.collect`åŒ…ä¸‹çš„é›†åˆå·¥å…·ï¼š`Lists`ä¹Ÿéå¸¸å¼ºå¤§ã€‚

#### åˆ›å»ºç©ºé›†åˆ

æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªç©ºé›†åˆã€‚è¿™æ—¶å¯ä»¥ç”¨Listsçš„`newArrayList`æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š
```java
List<Integer> list = Lists.newArrayList();
```

#### å¿«é€Ÿåˆå§‹åŒ–é›†åˆ

æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³ç»™ä¸€ä¸ªé›†åˆä¸­åˆå§‹åŒ–ä¸€äº›å…ƒç´ ã€‚è¿™æ—¶å¯ä»¥ç”¨Listsçš„newArrayListæ–¹æ³•ï¼Œä¾‹å¦‚ï¼š
```java
List<Integer> list = Lists.newArrayList(1, 2, 3);
```
æ‰§è¡Œç»“æœï¼š
```java
[1, 2, 3]
```

#### ç¬›å¡å°”ç§¯

å¦‚æœä½ æƒ³å°†ä¸¤ä¸ªé›†åˆåš`ç¬›å¡å°”ç§¯`ï¼ŒListsçš„`cartesianProduct`æ–¹æ³•å¯ä»¥å¸®ä½ å®ç°ï¼š
```java
List<Integer> list1 = Lists.newArrayList(1, 2, 3);
List<Integer> list2 = Lists.newArrayList(4,5);
List<List<Integer>> productList = Lists.cartesianProduct(list1,list2);
System.out.println(productList);
```
æ‰§è¡Œç»“æœï¼š
```java
[[1, 4], [1, 5], [2, 4], [2, 5], [3, 4], [3, 5]]
```

#### åˆ†é¡µ

å¦‚æœä½ æƒ³å°†ä¸€ä¸ª`å¤§é›†åˆ`åˆ†æˆè‹¥å¹²ä¸ª`å°é›†åˆ`ï¼Œå¯ä»¥ä½¿ç”¨Listsçš„`partition`æ–¹æ³•ï¼š

```java
List<Integer> list = Lists.newArrayList(1, 2, 3, 4, 5);
List<List<Integer>> partitionList = Lists.partition(list, 2);
System.out.println(partitionList);
```

æ‰§è¡Œç»“æœï¼š

```java
[[1, 2], [3, 4], [5]]
```

è¿™ä¸ªä¾‹å­ä¸­ï¼Œlistæœ‰5æ¡æ•°æ®ï¼Œæˆ‘å°†listé›†åˆæŒ‰å¤§å°ä¸º2ï¼Œåˆ†æˆäº†3é¡µï¼Œå³å˜æˆ3ä¸ªå°é›†åˆã€‚

è¿™ä¸ªæ˜¯æˆ‘æœ€å–œæ¬¢çš„æ–¹æ³•ä¹‹ä¸€ï¼Œç»å¸¸åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ã€‚

æ¯”å¦‚æœ‰ä¸ªéœ€æ±‚ï¼šç°åœ¨æœ‰5000ä¸ªidï¼Œéœ€è¦è°ƒç”¨æ‰¹é‡ç”¨æˆ·æŸ¥è¯¢æ¥å£ï¼ŒæŸ¥å‡ºç”¨æˆ·æ•°æ®ã€‚ä½†å¦‚æœä½ ç›´æ¥æŸ¥5000ä¸ªç”¨æˆ·ï¼Œå•æ¬¡æ¥å£å“åº”æ—¶é—´å¯èƒ½ä¼šéå¸¸æ…¢ã€‚å¦‚æœæ”¹æˆåˆ†é¡µå¤„ç†ï¼Œæ¯æ¬¡åªæŸ¥500ä¸ªç”¨æˆ·ï¼Œå¼‚æ­¥è°ƒç”¨10æ¬¡æ¥å£ï¼Œå°±ä¸ä¼šæœ‰å•æ¬¡æ¥å£å“åº”æ…¢çš„é—®é¢˜ã€‚

#### æµå¤„ç†

å¦‚æœæˆ‘ä»¬æƒ³æŠŠæŸä¸ªé›†åˆè½¬æ¢æˆå¦å¤–ä¸€ä¸ªæ¥å£ï¼Œå¯ä»¥ä½¿ç”¨Listsçš„ `transform`æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

```java
List<String> list = Lists.newArrayList("a","b","c");
List<String> transformList = Lists.transform(list, x -> x.toUpperCase());
System.out.println(transformList);
```

å°†å°å†™å­—æ¯è½¬æ¢æˆäº†å¤§å†™å­—æ¯ã€‚

#### é¢ å€’é¡ºåº

Listsçš„æœ‰é¢ å€’é¡ºåºçš„æ–¹æ³•`reverse`ã€‚ä¾‹å¦‚ï¼š

```java
List<Integer> list = Lists.newArrayList(3, 1, 2);
List<Integer> reverseList = Lists.reverse(list);
System.out.println(reverseList);
```

æ‰§è¡Œç»“æœï¼š

```java
[2, 1, 3]
```

listçš„åŸå§‹é¡ºåºæ˜¯312ï¼Œä½¿ç”¨`reverse`æ–¹æ³•é¢ å€’é¡ºåºä¹‹åï¼Œå˜æˆäº†213ã€‚

Listsè¿˜æœ‰å…¶ä»–çš„å¥½ç”¨çš„å·¥å…·ï¼Œæˆ‘åœ¨è¿™é‡Œåªæ˜¯æŠ›ç –å¼•ç‰ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´ï¼Œå¯ä»¥ä»”ç»†ç ”ç©¶ä¸€ä¸‹ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/guava-4b962b06-a626-4707-9fe9-f5729536d9c5.jpg)

### 08ã€å°¾å£°

ä¸Šé¢ä»‹ç»äº†æˆ‘è®¤ä¸ºæœ€å¸¸ç”¨çš„åŠŸèƒ½ï¼Œä½œä¸º Google å…¬å¸å¼€æºçš„ Java å¼€å‘æ ¸å¿ƒåº“ï¼Œä¸ªäººè§‰å¾—å®ç”¨æ€§è¿˜æ˜¯å¾ˆé«˜çš„ï¼ˆä¸ç„¶å‘¢ï¼Ÿå˜¿å˜¿å˜¿ï¼‰ã€‚å¼•å…¥åˆ°ä½ çš„é¡¹ç›®åä¸ä»…èƒ½å¿«é€Ÿçš„å®ç°ä¸€äº›å¼€å‘ä¸­å¸¸ç”¨çš„åŠŸèƒ½ï¼Œè€Œä¸”è¿˜å¯ä»¥è®©ä»£ç æ›´åŠ çš„ä¼˜é›…ç®€æ´ã€‚

æˆ‘è§‰å¾—é€‚ç”¨äºæ¯ä¸€ä¸ª Java é¡¹ç›®ï¼Œè‡³äºå…¶ä»–çš„ä¸€äº›åŠŸèƒ½ï¼Œæ¯”å¦‚è¯´æ•£åˆ—ã€äº‹ä»¶æ€»çº¿ã€æ•°å­¦è¿ç®—ã€åå°„ï¼Œå°±ç­‰å¾…ä½ å»å‘æ˜äº†ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/guava-03.png)

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 9.8 å…¶ä»–å¸¸ç”¨å·¥å…·ç±»

é™¤äº†æˆ‘ä»¬å‰é¢æåˆ°çš„ Java åŸç”Ÿå·¥å…·ç±»ï¼Œæ¯”å¦‚è¯´ [Arrays](https://tobebetterjavaer.com/common-tool/arrays.html)ã€[Objects](https://tobebetterjavaer.com/common-tool/Objects.html)ã€[Collections](https://tobebetterjavaer.com/common-tool/collections.html)ã€[Scanner](https://tobebetterjavaer.com/common-tool/scanner.html) ç­‰ï¼Œè¿˜æœ‰ä¸€äº›ç¬¬ä¸‰æ–¹çš„å·¥å…·ç±»ï¼Œæ¯”å¦‚è¯´ [Hutool](https://tobebetterjavaer.com/common-tool/hutool.html)ã€[Guava](https://tobebetterjavaer.com/common-tool/guava.html) ç­‰ï¼Œä»¥åŠæˆ‘ä»¬ä»Šå¤©ä»‹ç»çš„ IpUtilã€CollectionUtilsã€StringUtilsã€MDCã€ClassUtilsã€BeanUtilsã€ReflectionUtils ç­‰ç­‰ï¼Œåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šèƒ½å¤Ÿæé«˜æˆ‘ä»¬çš„ç”Ÿäº§æ•ˆç‡ã€‚

å½“ç„¶äº†ï¼Œå¦‚æœèƒ½å¥½å¥½çœ‹ä¸€ä¸‹å®ƒä»¬çš„æºç ï¼Œå¯¹æŠ€æœ¯åŠŸåº•çš„æå‡ï¼Œä¹Ÿæ˜¯æœ‰å¾ˆå¤§å¸®åŠ©çš„ã€‚

### IpUtilï¼šè·å–æœ¬æœº Ip

è·å–æœ¬æœº IP ç®—æ˜¯æ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªéœ€æ±‚åœºæ™¯äº†ï¼Œæ¯”å¦‚ä¸šåŠ¡æŠ¥è­¦ï¼Œå¯èƒ½å°±ä¼šå¸¦ä¸Šå‡ºé—®é¢˜çš„æœºå™¨ IPï¼Œæ–¹ä¾¿ç›´æ¥ä¸Šå»çœ‹æ—¥å¿—å®šä½é—®é¢˜ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•è·å–æœºå™¨ IP å‘¢ï¼Ÿ

#### 1. åŸºæœ¬æ–¹æ³•

å¦‚ä½•è·å–æœºå™¨ IPï¼Ÿå¦‚æœäº†è§£ InetAddress è¿™ä¸ªå·¥å…·ç±»ï¼Œå°±å¾ˆå®¹æ˜“å†™å‡ºä¸€ä¸ªç®€å•çš„å·¥å…·ç±»ï¼Œå¦‚ä¸‹

```java
public static String getLocalIP() {
    try {
        return InetAddress.getLocalHost().getHostAddress();
    } catch (UnknownHostException e) {
        throw new RuntimeException(e);
    }
}
```

ä¸Šé¢çš„å®ç°æœ‰é—®é¢˜ä¹ˆï¼Ÿ

å½“ç„¶æ²¡é—®é¢˜ï¼Œæ‹¿æˆ‘æœ¬æœºå’Œé˜¿é‡ŒæœåŠ¡å™¨æ‰§è¡Œä¸€ä¸‹ï¼Œå¹¶æ²¡æœ‰é—®é¢˜å¦‚å®çš„è¾“å‡ºäº†é¢„æœŸçš„ IP

æœ¬æœºæ‰§è¡Œåæˆªå›¾å¦‚ä¸‹ï¼š

![](https://cdn.tobebetterjavaer.com/stutymore/utils-20230330093633.png)

é˜¿é‡Œäº‘æœºå™¨æ‰§è¡Œåæˆªå›¾å¦‚ä¸‹ï¼š

![](https://cdn.tobebetterjavaer.com/stutymore/utils-20230330095801.png)

#### 2. è¿›é˜¶ç‰ˆ

åšä¸€ç‚¹ç®€å•çš„æ”¹åŠ¨ï¼Œè·å– IPV4 çš„åœ°å€ï¼Œæºç å¦‚ä¸‹

```java
public static String getLocalIpByNetcard() {
    try {
        // æšä¸¾æ‰€æœ‰çš„ç½‘ç»œæ¥å£
        for (Enumeration<NetworkInterface> e = NetworkInterface.getNetworkInterfaces(); e.hasMoreElements(); ) {
            // è·å–å½“å‰ç½‘ç»œæ¥å£
            NetworkInterface item = e.nextElement();

            // éå†å½“å‰ç½‘ç»œæ¥å£çš„æ‰€æœ‰åœ°å€
            for (InterfaceAddress address : item.getInterfaceAddresses()) {
                // å¿½ç•¥å›ç¯åœ°å€å’Œæœªå¯ç”¨çš„ç½‘ç»œæ¥å£
                if (item.isLoopback() || !item.isUp()) {
                    continue;
                }

                // å¦‚æœå½“å‰åœ°å€æ˜¯ IPv4 åœ°å€ï¼Œåˆ™è¿”å›å…¶å­—ç¬¦ä¸²è¡¨ç¤º
                if (address.getAddress() instanceof Inet4Address) {
                    Inet4Address inet4Address = (Inet4Address) address.getAddress();
                    return inet4Address.getHostAddress();
                }
            }
        }

        // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ä»»ä½• IPv4 åœ°å€ï¼Œåˆ™è¿”å›æœ¬åœ°ä¸»æœºåœ°å€
        return InetAddress.getLocalHost().getHostAddress();
    } catch (SocketException | UnknownHostException e) {
        // æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸
        throw new RuntimeException(e);
    }
}
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ®µä»£ç åªè¿”å›æœ¬æœºçš„ IPv4 åœ°å€ï¼Œå¹¶ä¸”åªè¿”å›ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„åœ°å€ã€‚å¦‚æœæœ¬æœºæœ‰å¤šä¸ªç½‘ç»œæ¥å£æˆ–è€…æ¯ä¸ªæ¥å£æœ‰å¤šä¸ªåœ°å€ï¼Œåˆ™å¯èƒ½æ— æ³•è¿”å›é¢„æœŸçš„åœ°å€ã€‚æ­¤å¤–ï¼Œå¦‚æœæ‰¾ä¸åˆ°ä»»ä½• IPv4 åœ°å€ï¼Œåˆ™ä¼šè¿”å›æœ¬åœ°ä¸»æœºåœ°å€ã€‚

å†æ¬¡æµ‹è¯•ï¼Œè¾“å‡ºå¦‚ä¸‹

![](https://cdn.tobebetterjavaer.com/stutymore/utils-20230330100334.png)

#### 3. å®Œæ•´å·¥å…·ç±»

```java
import java.net.*;
import java.util.Enumeration;

public class IPUtil {
    public static final String DEFAULT_IP = "127.0.0.1";

    /**
     * ç›´æ¥æ ¹æ®ç¬¬ä¸€ä¸ªç½‘å¡åœ°å€ä½œä¸ºå…¶å†…ç½‘ipv4åœ°å€ï¼Œé¿å…è¿”å› 127.0.0.1
     *
     * @return ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„å†…ç½‘ IPv4 åœ°å€
     */
    public static String getLocalIpByNetcard() {
        try {
            // æšä¸¾æ‰€æœ‰çš„ç½‘ç»œæ¥å£
            for (Enumeration<NetworkInterface> e = NetworkInterface.getNetworkInterfaces(); e.hasMoreElements(); ) {
                // è·å–å½“å‰ç½‘ç»œæ¥å£
                NetworkInterface item = e.nextElement();
                // éå†å½“å‰ç½‘ç»œæ¥å£çš„æ‰€æœ‰åœ°å€
                for (InterfaceAddress address : item.getInterfaceAddresses()) {
                    // å¿½ç•¥å›ç¯åœ°å€å’Œæœªå¯ç”¨çš„ç½‘ç»œæ¥å£
                    if (item.isLoopback() || !item.isUp()) {
                        continue;
                    }
                    // å¦‚æœå½“å‰åœ°å€æ˜¯ IPv4 åœ°å€ï¼Œåˆ™è¿”å›å…¶å­—ç¬¦ä¸²è¡¨ç¤º
                    if (address.getAddress() instanceof Inet4Address) {
                        Inet4Address inet4Address = (Inet4Address) address.getAddress();
                        return inet4Address.getHostAddress();
                    }
                }
            }
            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„åœ°å€ï¼Œåˆ™è¿”å›æœ¬åœ°ä¸»æœºåœ°å€
            return InetAddress.getLocalHost().getHostAddress();
        } catch (SocketException | UnknownHostException e) {
            throw new RuntimeException(e);
        }
    }

    /**
     * è·å–æœ¬åœ°ä¸»æœºåœ°å€
     *
     * @return æœ¬åœ°ä¸»æœºåœ°å€
     */
    public static String getLocalIP() {
        try {
            return InetAddress.getLocalHost().getHostAddress();
        } catch (UnknownHostException e) {
            throw new RuntimeException(e);
        }
    }
}
```

IPUtil ç±»ä¸­å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ `getLocalIpByNetcard()` å’Œ `getLocalIP()`ã€‚å‰è€…æ˜¯è·å–æœ¬æœºçš„å†…ç½‘ IPv4 åœ°å€ï¼Œé¿å…äº†è¿”å› 127.0.0.1 çš„é—®é¢˜ã€‚åè€…æ˜¯è·å–æœ¬åœ°ä¸»æœºåœ°å€ï¼Œå¦‚æœæœ¬æœºæœ‰å¤šä¸ª IP åœ°å€ï¼Œåˆ™å¯èƒ½è¿”å›å…¶ä¸­çš„ä»»æ„ä¸€ä¸ªã€‚

### MDCï¼šä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å‚æ•°ä¼ é€’å·¥å…·ç±»

`MDC` æ˜¯ [`org.slf4j`](https://tobebetterjavaer.com/gongju/slf4j.html) åŒ…ä¸‹çš„ä¸€ä¸ªç±»ï¼Œå®ƒçš„å…¨ç§°æ˜¯ Mapped Diagnostic Contextï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å­˜æ”¾è¯Šæ–­æ—¥å¿—çš„å®¹å™¨ã€‚

MDC çš„åº•å±‚æ˜¯ç”¨äº† [`ThreadLocal`](https://tobebetterjavaer.com/thread/ThreadLocal.html) æ¥ä¿å­˜æ•°æ®çš„ã€‚

æˆ‘ä»¬å¯ä»¥ç”¨å®ƒä¼ é€’å‚æ•°ã€‚

ä¾‹å¦‚ç°åœ¨æœ‰è¿™æ ·ä¸€ç§åœºæ™¯ï¼šæˆ‘ä»¬ä½¿ç”¨`RestTemplate`è°ƒç”¨è¿œç¨‹æ¥å£æ—¶ï¼Œæœ‰æ—¶éœ€è¦åœ¨`header`ä¸­ä¼ é€’ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼štraceIdï¼Œsource ç­‰ï¼Œä¾¿äºåœ¨æŸ¥è¯¢æ—¥å¿—æ—¶èƒ½å¤Ÿä¸²è”ä¸€æ¬¡å®Œæ•´çš„è¯·æ±‚é“¾è·¯ï¼Œå¿«é€Ÿå®šä½é—®é¢˜ã€‚

è¿™ç§ä¸šåŠ¡åœºæ™¯å°±èƒ½é€šè¿‡`ClientHttpRequestInterceptor`æ¥å£å®ç°ï¼Œå…·ä½“åšæ³•å¦‚ä¸‹ï¼š

ç¬¬ä¸€æ­¥ï¼Œå®šä¹‰ä¸€ä¸ª LogFilter æ‹¦æˆªæ‰€æœ‰æ¥å£è¯·æ±‚ï¼Œåœ¨ MDC ä¸­è®¾ç½® traceIdï¼š

```java
public class LogFilter implements Filter {
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
    }

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
        MdcUtil.add(UUID.randomUUID().toString());
        System.out.println("è®°å½•è¯·æ±‚æ—¥å¿—");
        chain.doFilter(request, response);
        System.out.println("è®°å½•å“åº”æ—¥å¿—");
    }

    @Override
    public void destroy() {
    }
}
```

ç¬¬äºŒæ­¥ï¼Œå®ç°`ClientHttpRequestInterceptor`æ¥å£ï¼ŒMDC ä¸­è·å–å½“å‰è¯·æ±‚çš„ traceIdï¼Œç„¶åè®¾ç½®åˆ° header ä¸­ï¼š

```java
public class RestTemplateInterceptor implements ClientHttpRequestInterceptor {

    @Override
    public ClientHttpResponse intercept(HttpRequest request, byte[] body, ClientHttpRequestExecution execution) throws IOException {
        request.getHeaders().set("traceId", MdcUtil.get());
        return execution.execute(request, body);
    }
}
```

ç¬¬ä¸‰æ­¥ï¼Œå®šä¹‰é…ç½®ç±»ï¼Œé…ç½®ä¸Šé¢å®šä¹‰çš„`RestTemplateInterceptor`ç±»ï¼š

```java
@Configuration
public class RestTemplateConfiguration {

    @Bean
    public RestTemplate restTemplate() {
        RestTemplate restTemplate = new RestTemplate();
        restTemplate.setInterceptors(Collections.singletonList(restTemplateInterceptor()));
        return restTemplate;
    }

    @Bean
    public RestTemplateInterceptor restTemplateInterceptor() {
        return new RestTemplateInterceptor();
    }
}
```

å…¶ä¸­ MdcUtil å…¶å®æ˜¯åˆ©ç”¨ MDC å·¥å…·åœ¨ ThreadLocal ä¸­å­˜å‚¨å’Œè·å– traceId

```java
public class MdcUtil {

    private static final String TRACE_ID = "TRACE_ID";

    public static String get() {
        return MDC.get(TRACE_ID);
    }

    public static void add(String value) {
        MDC.put(TRACE_ID, value);
    }
}
```

å½“ç„¶ï¼Œè¿™ä¸ªä¾‹å­ä¸­æ²¡æœ‰æ¼”ç¤º MdcUtil ç±»çš„ add æ–¹æ³•å…·ä½“è°ƒçš„åœ°æ–¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ filter ä¸­æ‰§è¡Œæ¥å£æ–¹æ³•ä¹‹å‰ï¼Œç”Ÿæˆ traceIdï¼Œè°ƒç”¨ MdcUtil ç±»çš„ add æ–¹æ³•æ·»åŠ åˆ° MDC ä¸­ï¼Œç„¶ååœ¨åŒä¸€ä¸ªè¯·æ±‚çš„å…¶ä»–åœ°æ–¹å°±èƒ½é€šè¿‡ MdcUtil ç±»çš„ get æ–¹æ³•è·å–åˆ°è¯¥ traceIdã€‚

èƒ½ä½¿ç”¨ MDC ä¿å­˜ traceId ç­‰å‚æ•°çš„æ ¹æœ¬åŸå› æ˜¯ï¼Œç”¨æˆ·è¯·æ±‚åˆ°åº”ç”¨æœåŠ¡å™¨ï¼ŒTomcat ä¼šä»çº¿ç¨‹æ± ä¸­åˆ†é…ä¸€ä¸ªçº¿ç¨‹å»å¤„ç†è¯¥è¯·æ±‚ã€‚

é‚£ä¹ˆè¯¥è¯·æ±‚çš„æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¿å­˜åˆ° MDC çš„ ThreadLocal ä¸­çš„å‚æ•°ï¼Œä¹Ÿæ˜¯è¯¥çº¿ç¨‹ç‹¬äº«çš„ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

### ClassUtils

spring çš„`org.springframework.util`åŒ…ä¸‹çš„`ClassUtils`ç±»ï¼Œå®ƒé‡Œé¢æœ‰å¾ˆå¤šè®©æˆ‘ä»¬æƒŠå–œçš„åŠŸèƒ½ã€‚

å®ƒé‡Œé¢åŒ…å«äº†ç±»å’Œå¯¹è±¡ç›¸å…³çš„å¾ˆå¤šéå¸¸å®ç”¨çš„æ–¹æ³•ã€‚

#### è·å–å¯¹è±¡çš„æ‰€æœ‰æ¥å£

å¦‚æœä½ æƒ³è·å–æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨ ClassUtils çš„`getAllInterfaces`æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

```java
Class<?>[] allInterfaces = ClassUtils.getAllInterfaces(new User());
```

#### è·å–æŸä¸ªç±»çš„åŒ…å

å¦‚æœä½ æƒ³è·å–æŸä¸ªç±»çš„åŒ…åï¼Œå¯ä»¥ä½¿ç”¨ ClassUtils çš„`getPackageName`æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

```java
String packageName = ClassUtils.getPackageName(User.class);
System.out.println(packageName);
```

#### åˆ¤æ–­æŸä¸ªç±»æ˜¯å¦å†…éƒ¨ç±»

å¦‚æœä½ æƒ³åˆ¤æ–­æŸä¸ªç±»æ˜¯å¦å†…éƒ¨ç±»ï¼Œå¯ä»¥ä½¿ç”¨ ClassUtils çš„`isInnerClass`æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

```java
System.out.println(ClassUtils.isInnerClass(User.class));
```

#### åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä»£ç†å¯¹è±¡

å¦‚æœä½ æƒ³åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä»£ç†å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ ClassUtils çš„`isCglibProxy`æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

```java
System.out.println(ClassUtils.isCglibProxy(new User()));
```

ClassUtils è¿˜æœ‰å¾ˆå¤šæœ‰ç”¨çš„æ–¹æ³•ï¼Œç­‰å¾…ç€ä½ å»å‘æ˜ã€‚æ„Ÿå…´è¶£çš„å°ä¼™ä¼´ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹é¢çš„å†…å®¹ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/utils-c58920ac-cf04-4d95-ad29-90339a086569.jpg)

### BeanUtils

Spring ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª`JavaBean`çš„å·¥å…·ç±»ï¼Œå®ƒåœ¨`org.springframework.beans`åŒ…ä¸‹é¢ï¼Œå®ƒçš„åå­—å«åšï¼š`BeanUtils`ã€‚

è®©æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹è¿™ä¸ªå·¥å…·å¯ä»¥å¸¦ç»™æˆ‘ä»¬å“ªäº›æƒŠå–œã€‚

#### æ‹·è´å¯¹è±¡çš„å±æ€§

æ›¾å‡ ä½•æ—¶ï¼Œä½ æœ‰æ²¡æœ‰è¿™æ ·çš„éœ€æ±‚ï¼šæŠŠæŸä¸ªå¯¹è±¡ä¸­çš„æ‰€æœ‰å±æ€§ï¼Œéƒ½æ‹·è´åˆ°å¦å¤–ä¸€ä¸ªå¯¹è±¡ä¸­ã€‚è¿™æ—¶å°±èƒ½ä½¿ç”¨ BeanUtils çš„`copyProperties`æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

```java
User user1 = new User();
user1.setId(1L);
user1.setName("æ²‰é»˜ç‹äºŒ");
user1.setAddress("ä¸­å›½");

User user2 = new User();
BeanUtils.copyProperties(user1, user2);
System.out.println(user2);
```

#### å®ä¾‹åŒ–æŸä¸ªç±»

å¦‚æœä½ æƒ³é€šè¿‡åå°„å®ä¾‹åŒ–ä¸€ä¸ªç±»çš„å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ BeanUtils çš„`instantiateClass`æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

```java
User user = BeanUtils.instantiateClass(User.class);
System.out.println(user);
```

#### è·å–æŒ‡å®šç±»çš„æŒ‡å®šæ–¹æ³•

å¦‚æœä½ æƒ³è·å–æŸä¸ªç±»çš„æŒ‡å®šæ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨ BeanUtils çš„`findDeclaredMethod`æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

```java
Method declaredMethod = BeanUtils.findDeclaredMethod(User.class, "getId");
System.out.println(declaredMethod.getName());
```

#### è·å–æŒ‡å®šæ–¹æ³•çš„å‚æ•°

å¦‚æœä½ æƒ³è·å–æŸä¸ªæ–¹æ³•çš„å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ BeanUtils çš„`findPropertyForMethod`æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

```java
Method declaredMethod = BeanUtils.findDeclaredMethod(User.class, "getId");
PropertyDescriptor propertyForMethod = BeanUtils.findPropertyForMethod(declaredMethod);
System.out.println(propertyForMethod.getName());
```

å¦‚æœä½ å¯¹ BeanUtils æ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹é¢å†…å®¹ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/utils-629ecd75-259b-46aa-b1dd-82606cfc92ee.jpg)

### ReflectionUtils

æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®ä¸­ä½¿ç”¨`åå°„`åŠŸèƒ½ï¼Œå¦‚æœä½¿ç”¨æœ€åŸå§‹çš„æ–¹æ³•æ¥å¼€å‘ï¼Œä»£ç é‡ä¼šéå¸¸å¤šï¼Œè€Œä¸”å¾ˆéº»çƒ¦ï¼Œå®ƒéœ€è¦å¤„ç†ä¸€å¤§å †å¼‚å¸¸ä»¥åŠè®¿é—®æƒé™ç­‰é—®é¢˜ã€‚

å¥½æ¶ˆæ¯æ˜¯ Spring ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª`ReflectionUtils`å·¥å…·ï¼Œå®ƒåœ¨`org.springframework.util`åŒ…ä¸‹é¢ã€‚

#### è·å–æ–¹æ³•

å¦‚æœä½ æƒ³è·å–æŸä¸ªç±»çš„æŸä¸ªæ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨ ReflectionUtils ç±»çš„`findMethod`æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

```java
Method method = ReflectionUtils.findMethod(User.class, "getId");
```

#### è·å–å­—æ®µ

å¦‚æœä½ æƒ³è·å–æŸä¸ªç±»çš„æŸä¸ªå­—æ®µï¼Œå¯ä»¥ä½¿ç”¨ ReflectionUtils ç±»çš„`findField`æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

```java
Field field = ReflectionUtils.findField(User.class, "id");
```

#### æ‰§è¡Œæ–¹æ³•

å¦‚æœä½ æƒ³é€šè¿‡åå°„è°ƒç”¨æŸä¸ªæ–¹æ³•ï¼Œä¼ é€’å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ ReflectionUtils ç±»çš„`invokeMethod`æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

```java
 ReflectionUtils.invokeMethod(method, springContextsUtil.getBean(beanName), param);
```

#### åˆ¤æ–­å­—æ®µæ˜¯å¦å¸¸é‡

å¦‚æœä½ æƒ³åˆ¤æ–­æŸä¸ªå­—æ®µæ˜¯å¦å¸¸é‡ï¼Œå¯ä»¥ä½¿ç”¨ ReflectionUtils ç±»çš„`isPublicStaticFinal`æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

```java
Field field = ReflectionUtils.findField(User.class, "id");
System.out.println(ReflectionUtils.isPublicStaticFinal(field));
```

#### åˆ¤æ–­æ˜¯å¦ equals æ–¹æ³•

å¦‚æœä½ æƒ³åˆ¤æ–­æŸä¸ªæ–¹æ³•æ˜¯å¦ equals æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨ ReflectionUtils ç±»çš„`isEqualsMethod`æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

```java
Method method = ReflectionUtils.findMethod(User.class, "getId");
System.out.println(ReflectionUtils.isEqualsMethod(method));
```

å½“ç„¶è¿™ä¸ªç±»è¿˜æœ‰ä¸å°‘æœ‰è¶£çš„æ–¹æ³•ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹é¢å†…å®¹ï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/utils-0a4ecb9c-b9d2-4090-a7b7-c626a0672b94.jpg)

>å‚è€ƒé“¾æ¥ï¼š[https://juejin.cn/post/7102418518599008286](https://juejin.cn/post/7102418518599008286) ä½œè€…ï¼šè‹ä¸‰ï¼Œç¼–è¾‘ï¼šæ²‰é»˜ç‹äºŒ

---

æœ€è¿‘æ•´ç†äº†ä¸€ä»½ç‰›é€¼çš„å­¦ä¹ èµ„æ–™ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº Java åŸºç¡€éƒ¨åˆ†ï¼ˆJVMã€Java é›†åˆæ¡†æ¶ã€å¤šçº¿ç¨‹ï¼‰ï¼Œè¿˜å›Šæ‹¬äº† **æ•°æ®åº“ã€è®¡ç®—æœºç½‘ç»œã€ç®—æ³•ä¸æ•°æ®ç»“æ„ã€è®¾è®¡æ¨¡å¼ã€æ¡†æ¶ç±» Springã€Nettyã€å¾®æœåŠ¡ï¼ˆDubboï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ ç½‘å…³** ç­‰ç­‰ç­‰ç­‰â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¯ä»¥è¯´æ˜¯ 2022 å¹´å…¨ç½‘æœ€å…¨çš„å­¦ä¹ å’Œæ‰¾å·¥ä½œçš„ PDF èµ„æºäº†](https://tobebetterjavaer.com/pdf/programmer-111.html)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)



# ç¬¬åç« ï¼šJavaæ–°ç‰¹æ€§




## 10.1 æŒæ¡Streamæµ

ä¸¤ä¸ªæ˜ŸæœŸä»¥å‰ï¼Œå°±æœ‰è¯»è€…å¼ºçƒˆè¦æ±‚æˆ‘å†™ä¸€ç¯‡ Java Stream æµçš„æ–‡ç« ï¼Œæˆ‘è¯´å¸‚é¢ä¸Šä¸æ˜¯å·²ç»æœ‰å¾ˆå¤šäº†å—ï¼Œç»“æœä½ çŒœä»–æ€ä¹ˆè¯´ï¼šâ€œå°±æƒ³çœ‹ä½ å†™çš„å•Šï¼â€ä½ çœ‹ä½ çœ‹ï¼Œå¤šä¹ˆè‹ç™½çš„å–œæ¬¢å•Šã€‚é‚£å°±â€œå‹‰ä¸ºå…¶éš¾â€å†™ä¸€ç¯‡å§ï¼Œå˜»å˜»ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/java8/stream-1.jpg)

å•ä»â€œStreamâ€è¿™ä¸ªå•è¯ä¸Šæ¥çœ‹ï¼Œå®ƒä¼¼ä¹å’Œ java.io åŒ…ä¸‹çš„ InputStream å’Œ OutputStream æœ‰äº›å…³ç³»ã€‚å®é™…ä¸Šå‘¢ï¼Œæ²¡æ¯›å…³ç³»ã€‚Java 8 æ–°å¢çš„ Stream æ˜¯ä¸ºäº†è§£æ”¾ç¨‹åºå‘˜æ“ä½œé›†åˆï¼ˆCollectionï¼‰æ—¶çš„ç”Ÿäº§åŠ›ï¼Œä¹‹æ‰€ä»¥èƒ½è§£æ”¾ï¼Œå¾ˆå¤§ä¸€éƒ¨åˆ†åŸå› å¯ä»¥å½’åŠŸäºåŒæ—¶å‡ºç°çš„ Lambda è¡¨è¾¾å¼â€”â€”æå¤§çš„æé«˜äº†ç¼–ç¨‹æ•ˆç‡å’Œç¨‹åºå¯è¯»æ€§ã€‚

Stream ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

>Stream å°±å¥½åƒä¸€ä¸ªé«˜çº§çš„è¿­ä»£å™¨ï¼Œä½†åªèƒ½éå†ä¸€æ¬¡ï¼Œå°±å¥½åƒä¸€æ±Ÿæ˜¥æ°´å‘ä¸œæµï¼›åœ¨æµçš„è¿‡ç¨‹ä¸­ï¼Œå¯¹æµä¸­çš„å…ƒç´ æ‰§è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚â€œè¿‡æ»¤æ‰é•¿åº¦å¤§äº 10 çš„å­—ç¬¦ä¸²â€ã€â€œè·å–æ¯ä¸ªå­—ç¬¦ä¸²çš„é¦–å­—æ¯â€ç­‰ã€‚

è¦æƒ³æ“ä½œæµï¼Œé¦–å…ˆéœ€è¦æœ‰ä¸€ä¸ªæ•°æ®æºï¼Œå¯ä»¥æ˜¯æ•°ç»„æˆ–è€…é›†åˆã€‚æ¯æ¬¡æ“ä½œéƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„æµå¯¹è±¡ï¼Œæ–¹ä¾¿è¿›è¡Œé“¾å¼æ“ä½œï¼Œä½†åŸæœ‰çš„æµå¯¹è±¡ä¼šä¿æŒä¸å˜ã€‚

æµçš„æ“ä½œå¯ä»¥åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š

1ï¼‰ä¸­é—´æ“ä½œï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼Œæ¯æ¬¡è¿”å›ä¸€ä¸ªæ–°çš„æµï¼Œå¯è¿›è¡Œé“¾å¼æ“ä½œã€‚

2ï¼‰ç»ˆç«¯æ“ä½œï¼Œåªèƒ½æœ‰ä¸€ä¸ªï¼Œæ¯æ¬¡æ‰§è¡Œå®Œï¼Œè¿™ä¸ªæµä¹Ÿå°±ç”¨å…‰å…‰äº†ï¼Œæ— æ³•æ‰§è¡Œä¸‹ä¸€ä¸ªæ“ä½œï¼Œå› æ­¤åªèƒ½æ”¾åœ¨æœ€åã€‚

æ¥ä¸¾ä¸ªä¾‹å­ã€‚

```java
List<String> list = new ArrayList<>();
list.add("æ­¦æ±‰åŠ æ²¹");
list.add("ä¸­å›½åŠ æ²¹");
list.add("ä¸–ç•ŒåŠ æ²¹");
list.add("ä¸–ç•ŒåŠ æ²¹");

long count = list.stream().distinct().count();
System.out.println(count);
```

`distinct()` æ–¹æ³•æ˜¯ä¸€ä¸ªä¸­é—´æ“ä½œï¼ˆå»é‡ï¼‰ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªæ–°çš„æµï¼ˆæ²¡æœ‰å…±åŒå…ƒç´ ï¼‰ã€‚

```java
Stream<T> distinct();
```

`count()` æ–¹æ³•æ˜¯ä¸€ä¸ªç»ˆç«¯æ“ä½œï¼Œè¿”å›æµä¸­çš„å…ƒç´ ä¸ªæ•°ã€‚

```java
long count();
```

ä¸­é—´æ“ä½œä¸ä¼šç«‹å³æ‰§è¡Œï¼Œåªæœ‰ç­‰åˆ°ç»ˆç«¯æ“ä½œçš„æ—¶å€™ï¼Œæµæ‰å¼€å§‹çœŸæ­£åœ°éå†ï¼Œç”¨äºæ˜ å°„ã€è¿‡æ»¤ç­‰ã€‚é€šä¿—ç‚¹è¯´ï¼Œå°±æ˜¯ä¸€æ¬¡éå†æ‰§è¡Œå¤šä¸ªæ“ä½œï¼Œæ€§èƒ½å°±å¤§å¤§æé«˜äº†ã€‚

ç†è®ºéƒ¨åˆ†å°±æ‰¯è¿™ä¹ˆå¤šï¼Œä¸‹é¢ç›´æ¥è¿›å…¥å®æˆ˜éƒ¨åˆ†ã€‚

### 01ã€åˆ›å»ºæµ

å¦‚æœæ˜¯æ•°ç»„çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ `Arrays.stream()` æˆ–è€… `Stream.of()` åˆ›å»ºæµï¼›å¦‚æœæ˜¯é›†åˆçš„è¯ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ `stream()` æ–¹æ³•åˆ›å»ºæµï¼Œå› ä¸ºè¯¥æ–¹æ³•å·²ç»æ·»åŠ åˆ° Collection æ¥å£ä¸­ã€‚

```java
public class CreateStreamDemo {
    public static void main(String[] args) {
        String[] arr = new String[]{"æ­¦æ±‰åŠ æ²¹", "ä¸­å›½åŠ æ²¹", "ä¸–ç•ŒåŠ æ²¹"};
        Stream<String> stream = Arrays.stream(arr);

        stream = Stream.of("æ­¦æ±‰åŠ æ²¹", "ä¸­å›½åŠ æ²¹", "ä¸–ç•ŒåŠ æ²¹");

        List<String> list = new ArrayList<>();
        list.add("æ­¦æ±‰åŠ æ²¹");
        list.add("ä¸­å›½åŠ æ²¹");
        list.add("ä¸–ç•ŒåŠ æ²¹");
        stream = list.stream();
    }
}
```

æŸ¥çœ‹ Stream æºç çš„è¯ï¼Œä½ ä¼šå‘ç° `of()` æ–¹æ³•å†…éƒ¨å…¶å®è°ƒç”¨äº† `Arrays.stream()` æ–¹æ³•ã€‚

```java
public static<T> Stream<T> of(T... values) {
    return Arrays.stream(values);
}
```

å¦å¤–ï¼Œé›†åˆè¿˜å¯ä»¥è°ƒç”¨ `parallelStream()` æ–¹æ³•åˆ›å»ºå¹¶å‘æµï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯ `ForkJoinPool.commonPool()`çº¿ç¨‹æ± ã€‚

```java
List<Long> aList = new ArrayList<>();
Stream<Long> parallelStream = aList.parallelStream();
```

### 02ã€æ“ä½œæµ

Stream ç±»æä¾›äº†å¾ˆå¤šæœ‰ç”¨çš„æ“ä½œæµçš„æ–¹æ³•ï¼Œæˆ‘æ¥æŒ‘ä¸€äº›å¸¸ç”¨çš„ç»™ä½ ä»‹ç»ä¸€ä¸‹ã€‚

#### 1ï¼‰è¿‡æ»¤

é€šè¿‡ `filter()` æ–¹æ³•å¯ä»¥ä»æµä¸­ç­›é€‰å‡ºæˆ‘ä»¬æƒ³è¦çš„å…ƒç´ ã€‚

```java
public class FilterStreamDemo {
    public static void main(String[] args) {
        List<String> list = new ArrayList<>();
        list.add("å‘¨æ°ä¼¦");
        list.add("ç‹åŠ›å®");
        list.add("é™¶å–†");
        list.add("æ—ä¿Šæ°");
        Stream<String> stream = list.stream().filter(element -> element.contains("ç‹"));
        stream.forEach(System.out::println);
    }
}
```

`filter()` æ–¹æ³•æ¥æ”¶çš„æ˜¯ä¸€ä¸ª Predicateï¼ˆJava 8 æ–°å¢çš„ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œæ¥å—ä¸€ä¸ªè¾“å…¥å‚æ•°è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ç»“æœï¼‰ç±»å‹çš„å‚æ•°ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†ä¸€ä¸ª Lambda è¡¨è¾¾å¼ä¼ é€’ç»™è¯¥æ–¹æ³•ï¼Œæ¯”å¦‚è¯´ `element -> element.contains("ç‹")` å°±æ˜¯ç­›é€‰å‡ºå¸¦æœ‰â€œç‹â€çš„å­—ç¬¦ä¸²ã€‚

`forEach()` æ–¹æ³•æ¥æ”¶çš„æ˜¯ä¸€ä¸ª Consumerï¼ˆJava 8 æ–°å¢çš„ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œæ¥å—ä¸€ä¸ªè¾“å…¥å‚æ•°å¹¶ä¸”æ— è¿”å›çš„æ“ä½œï¼‰ç±»å‹çš„å‚æ•°ï¼Œ`ç±»å :: æ–¹æ³•å`æ˜¯ Java 8 å¼•å…¥çš„æ–°è¯­æ³•ï¼Œ`System.out` è¿”å› PrintStream ç±»ï¼Œprintln æ–¹æ³•ä½ åº”è¯¥çŸ¥é“æ˜¯æ‰“å°çš„ã€‚

`stream.forEach(System.out::println);` ç›¸å½“äºåœ¨ for å¾ªç¯ä¸­æ‰“å°ï¼Œç±»ä¼¼äºä¸‹é¢çš„ä»£ç ï¼š

```java
for (String s : strs) {
    System.out.println(s);
}
```

å¾ˆæ˜æ˜¾ï¼Œä¸€è¡Œä»£ç çœ‹èµ·æ¥æ›´ç®€æ´ä¸€äº›ã€‚æ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„è¾“å‡ºç»“æœï¼š

```
ç‹åŠ›å®
```

#### 2ï¼‰æ˜ å°„ 

å¦‚æœæƒ³é€šè¿‡æŸç§æ“ä½œæŠŠä¸€ä¸ªæµä¸­çš„å…ƒç´ è½¬åŒ–æˆæ–°çš„æµä¸­çš„å…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨ `map()` æ–¹æ³•ã€‚

```java
public class MapStreamDemo {
    public static void main(String[] args) {
        List<String> list = new ArrayList<>();
        list.add("å‘¨æ°ä¼¦");
        list.add("ç‹åŠ›å®");
        list.add("é™¶å–†");
        list.add("æ—ä¿Šæ°");
        Stream<Integer> stream = list.stream().map(String::length);
        stream.forEach(System.out::println);
    }
}
```

`map()` æ–¹æ³•æ¥æ”¶çš„æ˜¯ä¸€ä¸ª Functionï¼ˆJava 8 æ–°å¢çš„ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œæ¥å—ä¸€ä¸ªè¾“å…¥å‚æ•° Tï¼Œè¿”å›ä¸€ä¸ªç»“æœ Rï¼‰ç±»å‹çš„å‚æ•°ï¼Œæ­¤æ—¶å‚æ•° ä¸º String ç±»çš„ length æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æŠŠ `Stream<String>` çš„æµè½¬æˆä¸€ä¸ª `Stream<Integer>` çš„æµã€‚

ç¨‹åºè¾“å‡ºçš„ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
3
3
2
3
```

#### 3ï¼‰åŒ¹é…

Stream ç±»æä¾›äº†ä¸‰ä¸ªæ–¹æ³•å¯ä¾›è¿›è¡Œå…ƒç´ åŒ¹é…ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š

- `anyMatch()`ï¼Œåªè¦æœ‰ä¸€ä¸ªå…ƒç´ åŒ¹é…ä¼ å…¥çš„æ¡ä»¶ï¼Œå°±è¿”å› trueã€‚

- `allMatch()`ï¼Œåªæœ‰æœ‰ä¸€ä¸ªå…ƒç´ ä¸åŒ¹é…ä¼ å…¥çš„æ¡ä»¶ï¼Œå°±è¿”å› falseï¼›å¦‚æœå…¨éƒ¨åŒ¹é…ï¼Œåˆ™è¿”å› trueã€‚

- `noneMatch()`ï¼Œåªè¦æœ‰ä¸€ä¸ªå…ƒç´ åŒ¹é…ä¼ å…¥çš„æ¡ä»¶ï¼Œå°±è¿”å› falseï¼›å¦‚æœå…¨éƒ¨ä¸åŒ¹é…ï¼Œåˆ™è¿”å› trueã€‚

```java
public class MatchStreamDemo {
    public static void main(String[] args) {
        List<String> list = new ArrayList<>();
        list.add("å‘¨æ°ä¼¦");
        list.add("ç‹åŠ›å®");
        list.add("é™¶å–†");
        list.add("æ—ä¿Šæ°");

        boolean  anyMatchFlag = list.stream().anyMatch(element -> element.contains("ç‹"));
        boolean  allMatchFlag = list.stream().allMatch(element -> element.length() > 1);
        boolean  noneMatchFlag = list.stream().noneMatch(element -> element.endsWith("æ²‰"));
        System.out.println(anyMatchFlag);
        System.out.println(allMatchFlag);
        System.out.println(noneMatchFlag);
    }
}
```

å› ä¸ºâ€œç‹åŠ›å®â€ä»¥â€œç‹â€å­—å¼€å¤´ï¼Œæ‰€ä»¥ anyMatchFlag åº”è¯¥ä¸º trueï¼›å› ä¸ºâ€œå‘¨æ°ä¼¦â€ã€â€œç‹åŠ›å®â€ã€â€œé™¶å–†â€ã€â€œæ—ä¿Šæ°â€çš„å­—ç¬¦ä¸²é•¿åº¦éƒ½å¤§äº 1ï¼Œæ‰€ä»¥ allMatchFlag ä¸º trueï¼›å› ä¸º 4 ä¸ªå­—ç¬¦ä¸²ç»“å°¾éƒ½ä¸æ˜¯â€œæ²‰â€ï¼Œæ‰€ä»¥ noneMatchFlag  ä¸º trueã€‚

ç¨‹åºè¾“å‡ºçš„ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
true
true
true
```

#### 4ï¼‰ç»„åˆ

`reduce()` æ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯æŠŠ Stream ä¸­çš„å…ƒç´ ç»„åˆèµ·æ¥ï¼Œå®ƒæœ‰ä¸¤ç§ç”¨æ³•ï¼š

- `Optional<T> reduce(BinaryOperator<T> accumulator)`

æ²¡æœ‰èµ·å§‹å€¼ï¼Œåªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯è¿ç®—è§„åˆ™ï¼Œæ­¤æ—¶è¿”å› [Optional](https://mp.weixin.qq.com/s/PqK0KNVHyoEtZDtp5odocA)ã€‚

- `T reduce(T identity, BinaryOperator<T> accumulator)`

æœ‰èµ·å§‹å€¼ï¼Œæœ‰è¿ç®—è§„åˆ™ï¼Œä¸¤ä¸ªå‚æ•°ï¼Œæ­¤æ—¶è¿”å›çš„ç±»å‹å’Œèµ·å§‹å€¼ç±»å‹ä¸€è‡´ã€‚

æ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ã€‚

```java
public class ReduceStreamDemo {
    public static void main(String[] args) {
        Integer[] ints = {0, 1, 2, 3};
        List<Integer> list = Arrays.asList(ints);

        Optional<Integer> optional = list.stream().reduce((a, b) -> a + b);
        Optional<Integer> optional1 = list.stream().reduce(Integer::sum);
        System.out.println(optional.orElse(0));
        System.out.println(optional1.orElse(0));

        int reduce = list.stream().reduce(6, (a, b) -> a + b);
        System.out.println(reduce);
        int reduce1 = list.stream().reduce(6, Integer::sum);
        System.out.println(reduce1);
    }
}
```

è¿ç®—è§„åˆ™å¯ä»¥æ˜¯ [Lambda è¡¨è¾¾å¼](https://mp.weixin.qq.com/s/ozr0jYHIc12WSTmmd_vEjw)ï¼ˆæ¯”å¦‚ `(a, b) -> a + b`ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ç±»å::æ–¹æ³•åï¼ˆæ¯”å¦‚ `Integer::sum`ï¼‰ã€‚

ç¨‹åºè¿è¡Œçš„ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```java
6
6
12
12
```

0ã€1ã€2ã€3 åœ¨æ²¡æœ‰èµ·å§‹å€¼ç›¸åŠ çš„æ—¶å€™ç»“æœä¸º 6ï¼›æœ‰èµ·å§‹å€¼ 6 çš„æ—¶å€™ç»“æœä¸º 12ã€‚

### 03ã€è½¬æ¢æµ

æ—¢ç„¶å¯ä»¥æŠŠé›†åˆæˆ–è€…æ•°ç»„è½¬æˆæµï¼Œé‚£ä¹ˆä¹Ÿåº”è¯¥æœ‰å¯¹åº”çš„æ–¹æ³•ï¼Œå°†æµè½¬æ¢å›å»â€”â€”`collect()` æ–¹æ³•å°±æ»¡è¶³äº†è¿™ç§éœ€æ±‚ã€‚

```java
public class CollectStreamDemo {
    public static void main(String[] args) {
        List<String> list = new ArrayList<>();
        list.add("å‘¨æ°ä¼¦");
        list.add("ç‹åŠ›å®");
        list.add("é™¶å–†");
        list.add("æ—ä¿Šæ°");

        String[] strArray = list.stream().toArray(String[]::new);
        System.out.println(Arrays.toString(strArray));

        List<Integer> list1 = list.stream().map(String::length).collect(Collectors.toList());
        List<String> list2 = list.stream().collect(Collectors.toCollection(ArrayList::new));
        System.out.println(list1);
        System.out.println(list2);

        String str = list.stream().collect(Collectors.joining(", ")).toString();
        System.out.println(str);
    }
}
```

`toArray()` æ–¹æ³•å¯ä»¥å°†æµè½¬æ¢æˆæ•°ç»„ï¼Œä½ å¯èƒ½æ¯”è¾ƒå¥½å¥‡çš„æ˜¯ `String[]::new`ï¼Œå®ƒæ˜¯ä»€ä¹ˆä¸œä¸œå‘¢ï¼Ÿæ¥çœ‹ä¸€ä¸‹ `toArray()` æ–¹æ³•çš„æºç ã€‚

```java
<A> A[] toArray(IntFunction<A[]> generator);
```

ä¹Ÿå°±æ˜¯è¯´ `String[]::new` æ˜¯ä¸€ä¸ª IntFunctionï¼Œä¸€ä¸ªå¯ä»¥äº§ç”Ÿæ‰€éœ€çš„æ–°æ•°ç»„çš„å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡åç¼–è¯‘å­—èŠ‚ç çœ‹çœ‹å®ƒåˆ°åº•æ˜¯ä»€ä¹ˆï¼š

```java
String[] strArray = (String[])list.stream().toArray((x$0) -> {
    return new String[x$0];
});
System.out.println(Arrays.toString(strArray));
```

ä¹Ÿå°±æ˜¯ç›¸å½“äºè¿”å›äº†ä¸€ä¸ªæŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸²æ•°ç»„ã€‚

å½“æˆ‘ä»¬éœ€è¦æŠŠä¸€ä¸ªé›†åˆæŒ‰ç…§æŸç§è§„åˆ™è½¬æˆå¦å¤–ä¸€ä¸ªé›†åˆçš„æ—¶å€™ï¼Œå°±å¯ä»¥é…å¥—ä½¿ç”¨ `map()` æ–¹æ³•å’Œ `collect()` æ–¹æ³•ã€‚

```java
List<Integer> list1 = list.stream().map(String::length).collect(Collectors.toList());
```

é€šè¿‡ `stream()` æ–¹æ³•åˆ›å»ºé›†åˆçš„æµåï¼Œå†é€šè¿‡ `map(String:length)` å°†å…¶æ˜ å°„ä¸ºå­—ç¬¦ä¸²é•¿åº¦çš„ä¸€ä¸ªæ–°æµï¼Œæœ€åé€šè¿‡ `collect()` æ–¹æ³•å°†å…¶è½¬æ¢æˆæ–°çš„é›†åˆã€‚

Collectors æ˜¯ä¸€ä¸ªæ”¶é›†å™¨çš„å·¥å…·ç±»ï¼Œå†…ç½®äº†ä¸€ç³»åˆ—æ”¶é›†å™¨å®ç°ï¼Œæ¯”å¦‚è¯´ `toList()` æ–¹æ³•å°†å…ƒç´ æ”¶é›†åˆ°ä¸€ä¸ªæ–°çš„ `java.util.List` ä¸­ï¼›æ¯”å¦‚è¯´ `toCollection()` æ–¹æ³•å°†å…ƒç´ æ”¶é›†åˆ°ä¸€ä¸ªæ–°çš„ ` java.util.ArrayList` ä¸­ï¼›æ¯”å¦‚è¯´ `joining()` æ–¹æ³•å°†å…ƒç´ æ”¶é›†åˆ°ä¸€ä¸ªå¯ä»¥ç”¨åˆ†éš”ç¬¦æŒ‡å®šçš„å­—ç¬¦ä¸²ä¸­ã€‚

æ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„è¾“å‡ºç»“æœï¼š

```java
[å‘¨æ°ä¼¦, ç‹åŠ›å®, é™¶å–†, æ—ä¿Šæ°]
[3, 3, 2, 3]
[å‘¨æ°ä¼¦, ç‹åŠ›å®, é™¶å–†, æ—ä¿Šæ°]
å‘¨æ°ä¼¦, ç‹åŠ›å®, é™¶å–†, æ—ä¿Šæ°
```

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/java8/stream-2.jpg)

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 10.2 Optionalæœ€ä½³æŒ‡å—

æƒ³å­¦ä¹ ï¼Œæ°¸è¿œéƒ½ä¸æ™šï¼Œå°¤å…¶æ˜¯é’ˆå¯¹ Java 8 é‡Œé¢çš„å¥½ä¸œè¥¿ï¼ŒOptional å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œè¯¥ç±»æä¾›äº†ä¸€ç§ç”¨äºè¡¨ç¤ºå¯é€‰å€¼è€Œéç©ºå¼•ç”¨çš„ç±»çº§åˆ«è§£å†³æ–¹æ¡ˆã€‚ä½œä¸ºä¸€å Java ç¨‹åºå‘˜ï¼Œæˆ‘çœŸçš„æ˜¯çƒ¦é€äº† [NullPointerExceptionï¼ˆNPEï¼‰](https://tobebetterjavaer.com/exception/npe.html)ï¼Œå°½ç®¡å’Œå®ƒç†Ÿå¾—å°±åƒä¸€ä½è€æœ‹å‹ï¼ŒçŸ¥é“å®ƒä¹Ÿæ˜¯è¿«ä¸å¾—å·²â€”â€”ç¨‹åºæ­£åœ¨ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡å´å‘ç°è¿™ä¸ªå¯¹è±¡çš„å€¼ä¸º nullï¼Œäºæ˜¯ Java è™šæ‹Ÿæœºå°±æ€’å‘å†²å† åœ°æŠŠå®ƒæŠ›äº†å‡ºæ¥å½“åšæ›¿ç½ªç¾Šã€‚

å½“ç„¶äº†ï¼Œæˆ‘ä»¬ç¨‹åºå‘˜æ˜¯å¯Œæœ‰è´£ä»»å¿ƒçš„ï¼Œä¸ä¼šåè§†ä¸ç®¡ï¼Œäºæ˜¯å°±æœ‰äº†å¤§é‡çš„ null å€¼æ£€æŸ¥ã€‚å°½ç®¡æœ‰æ—¶å€™è¿™ç§æ£€æŸ¥å®Œå…¨æ²¡æœ‰å¿…è¦ï¼Œä½†æˆ‘ä»¬å·²ç»ä¹ æƒ¯äº†ä¾‹è¡Œå…¬äº‹ã€‚ç»ˆäºï¼ŒJava 8 çœ‹ä¸ä¸‹å»äº†ï¼Œå°±å¼•å…¥äº† Optionalï¼Œä»¥ä¾¿æˆ‘ä»¬ç¼–å†™çš„ä»£ç ä¸å†é‚£ä¹ˆåˆ»è–„å‘†æ¿ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/guava-20230329172935.png)


### 01ã€æ²¡æœ‰ Optional ä¼šæœ‰ä»€ä¹ˆé—®é¢˜

æˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€ä¸ªå®é™…çš„åº”ç”¨åœºæ™¯ã€‚å°ç‹ç¬¬ä¸€å¤©ä¸Šç­ï¼Œé¢†å¯¼è€é©¬å°±ç»™ä»–å®‰æ’äº†ä¸€ä¸ªä»»åŠ¡ï¼Œè¦ä»–ä»æ•°æ®åº“ä¸­æ ¹æ®ä¼šå‘˜ ID æ‹‰å–ä¸€ä¸ªä¼šå‘˜çš„å§“åï¼Œç„¶åå°†å§“åæ‰“å°åˆ°æ§åˆ¶å°ã€‚è™½ç„¶æ˜¯æ–°æ¥çš„ï¼Œä½†è¿™ä¸ªä»»åŠ¡éš¾ä¸å€’å°ç‹ï¼Œäºæ˜¯ä»–èŠ±äº† 10 åˆ†é’Ÿå†™ä¸‹äº†è¿™æ®µä»£ç ï¼š

```java
public class WithoutOptionalDemo {
    class Member {
        private String name;

        public String getName() {
            return name;
        }

        public void setName(String name) {
            this.name = name;
        }
    }

    public static void main(String[] args) {
        Member mem = getMemberByIdFromDB();
        if (mem != null) {
            System.out.println(mem.getName());
        }
    }

    public static Member getMemberByIdFromDB() {
        // å½“å‰ ID çš„ä¼šå‘˜ä¸å­˜åœ¨
        return null;
    }
}
```

ç”±äºå½“å‰ ID çš„ä¼šå‘˜ä¸å­˜åœ¨ï¼Œæ‰€ä»¥ `getMemberByIdFromDB()` æ–¹æ³•è¿”å›äº† null æ¥ä½œä¸ºæ²¡æœ‰è·å–åˆ°è¯¥ä¼šå‘˜çš„ç»“æœï¼Œé‚£å°±æ„å‘³ç€åœ¨æ‰“å°ä¼šå‘˜å§“åçš„æ—¶å€™è¦å…ˆå¯¹ mem åˆ¤ç©ºï¼Œå¦åˆ™å°±ä¼šæŠ›å‡º NPE å¼‚å¸¸ï¼Œä¸ä¿¡ï¼Ÿè®©å°ç‹æŠŠ `if (mem != null)` å»æ‰è¯•è¯•ï¼Œæ§åˆ¶å°ç«‹é©¬æ‰“å°é”™è¯¯å †æ ˆç»™ä½ é¢œè‰²çœ‹çœ‹ã€‚

```
Exception in thread "main" java.lang.NullPointerException
	at com.cmower.dzone.optional.WithoutOptionalDemo.main(WithoutOptionalDemo.java:24)
```

### 02ã€Optional æ˜¯å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜çš„

å°ç‹æŠŠä»£ç æäº¤åï¼Œå°±å…´é«˜é‡‡çƒˆåœ°å»æ‰¾è€é©¬è¦æ–°çš„ä»»åŠ¡äº†ã€‚æœ¬ç€è™šå¿ƒå­¦ä¹ çš„æ€åº¦ï¼Œå°ç‹è¯·æ±‚è€é©¬çœ‹ä¸€ä¸‹è‡ªå·±çš„ä»£ç ï¼Œäºæ˜¯è€ç‹å°±å‘Šè¯‰ä»–åº”è¯¥å°è¯•ä¸€ä¸‹ Optionalï¼Œå¯ä»¥é¿å…æ²¡æœ‰å¿…è¦çš„ null å€¼æ£€æŸ¥ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å°ç‹æ˜¯å¦‚ä½•é€šè¿‡ Optional æ¥è§£å†³ä¸Šè¿°é—®é¢˜çš„ã€‚

```java
public class OptionalDemo {
    public static void main(String[] args) {
        Optional<Member> optional = getMemberByIdFromDB();
        optional.ifPresent(mem -> {
            System.out.println("ä¼šå‘˜å§“åæ˜¯ï¼š" + mem.getName());
        });
    }

    public static Optional<Member> getMemberByIdFromDB() {
        boolean hasName = true;
        if (hasName) {
            return Optional.of(new Member("æ²‰é»˜ç‹äºŒ"));
        }
        return Optional.empty();
    }
}
class Member {
    private String name;

    public String getName() {
        return name;
    }

    // getter / setter
}
```

`getMemberByIdFromDB()` æ–¹æ³•è¿”å›äº† `Optional<Member>` ä½œä¸ºç»“æœï¼Œè¿™æ ·å°±è¡¨æ˜ Member å¯èƒ½å­˜åœ¨ï¼Œä¹Ÿå¯èƒ½ä¸å­˜åœ¨ï¼Œè¿™æ—¶å€™å°±å¯ä»¥åœ¨ Optional çš„ `ifPresent()` æ–¹æ³•ä¸­ä½¿ç”¨ Lambda è¡¨è¾¾å¼æ¥ç›´æ¥æ‰“å°ç»“æœã€‚

Optional ä¹‹æ‰€ä»¥å¯ä»¥è§£å†³ NPE çš„é—®é¢˜ï¼Œæ˜¯å› ä¸ºå®ƒæ˜ç¡®çš„å‘Šè¯‰æˆ‘ä»¬ï¼Œä¸éœ€è¦å¯¹å®ƒè¿›è¡Œåˆ¤ç©ºã€‚å®ƒå°±å¥½åƒåå­—è·¯å£çš„è·¯æ ‡ï¼Œæ˜ç¡®åœ°å‘Šè¯‰ä½ è¯¥å¾€å“ªèµ°ã€‚

### 03ã€åˆ›å»º Optional å¯¹è±¡

1ï¼‰å¯ä»¥ä½¿ç”¨é™æ€æ–¹æ³• `empty()` åˆ›å»ºä¸€ä¸ªç©ºçš„ Optional å¯¹è±¡

```java
Optional<String> empty = Optional.empty();
System.out.println(empty); // è¾“å‡ºï¼šOptional.empty
```

2ï¼‰å¯ä»¥ä½¿ç”¨é™æ€æ–¹æ³• `of()` åˆ›å»ºä¸€ä¸ªéç©ºçš„ Optional å¯¹è±¡

```java
Optional<String> opt = Optional.of("æ²‰é»˜ç‹äºŒ");
System.out.println(opt); // è¾“å‡ºï¼šOptional[æ²‰é»˜ç‹äºŒ]
```

å½“ç„¶äº†ï¼Œä¼ é€’ç»™ `of()` æ–¹æ³•çš„å‚æ•°å¿…é¡»æ˜¯éç©ºçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½ä¸º nullï¼Œå¦åˆ™ä»ç„¶ä¼šæŠ›å‡º NullPointerExceptionã€‚

```java
String name = null;
Optional<String> optnull = Optional.of(name);
```

3ï¼‰å¯ä»¥ä½¿ç”¨é™æ€æ–¹æ³• `ofNullable()` åˆ›å»ºä¸€ä¸ªå³å¯ç©ºåˆå¯éç©ºçš„ Optional å¯¹è±¡

```java
String name = null;
Optional<String> optOrNull = Optional.ofNullable(name);
System.out.println(optOrNull); // è¾“å‡ºï¼šOptional.empty
```

`ofNullable()` æ–¹æ³•å†…éƒ¨æœ‰ä¸€ä¸ªä¸‰å…ƒè¡¨è¾¾å¼ï¼Œå¦‚æœä¸ºå‚æ•°ä¸º nullï¼Œåˆ™è¿”å›ç§æœ‰å¸¸é‡ EMPTYï¼›å¦åˆ™ä½¿ç”¨ new å…³é”®å­—åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ Optional å¯¹è±¡â€”â€”ä¸ä¼šå†æŠ›å‡º NPE å¼‚å¸¸äº†ã€‚

### 04ã€åˆ¤æ–­å€¼æ˜¯å¦å­˜åœ¨

å¯ä»¥é€šè¿‡æ–¹æ³• `isPresent()` åˆ¤æ–­ä¸€ä¸ª Optional å¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œè¯¥æ–¹æ³•è¿”å› trueï¼Œå¦åˆ™è¿”å› falseâ€”â€”å–ä»£äº† `obj != null` çš„åˆ¤æ–­ã€‚

```java
Optional<String> opt = Optional.of("æ²‰é»˜ç‹äºŒ");
System.out.println(opt.isPresent()); // è¾“å‡ºï¼štrue

Optional<String> optOrNull = Optional.ofNullable(null);
System.out.println(opt.isPresent()); // è¾“å‡ºï¼šfalse
```

Java 11 åè¿˜å¯ä»¥é€šè¿‡æ–¹æ³• `isEmpty()` åˆ¤æ–­ä¸ `isPresent()` ç›¸åçš„ç»“æœã€‚

```java
Optional<String> opt = Optional.of("æ²‰é»˜ç‹äºŒ");
System.out.println(opt.isPresent()); // è¾“å‡ºï¼šfalse

Optional<String> optOrNull = Optional.ofNullable(null);
System.out.println(opt.isPresent()); // è¾“å‡ºï¼štrue
```

### 05ã€éç©ºè¡¨è¾¾å¼

Optional ç±»æœ‰ä¸€ä¸ªéå¸¸ç°ä»£åŒ–çš„æ–¹æ³•â€”â€”`ifPresent()`ï¼Œå…è®¸æˆ‘ä»¬ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹çš„æ–¹å¼æ‰§è¡Œä¸€äº›ä»£ç ï¼Œå› æ­¤ï¼Œæˆ‘æŠŠå®ƒç§°ä¸ºéç©ºè¡¨è¾¾å¼ã€‚å¦‚æœæ²¡æœ‰è¯¥æ–¹æ³•çš„è¯ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦å…ˆé€šè¿‡ `isPresent()` æ–¹æ³•å¯¹ Optional å¯¹è±¡è¿›è¡Œåˆ¤ç©ºåå†æ‰§è¡Œç›¸åº”çš„ä»£ç ï¼š

```java
Optional<String> optOrNull = Optional.ofNullable(null);
if (optOrNull.isPresent()) {
    System.out.println(optOrNull.get().length());
}
```

æœ‰äº† `ifPresent()` ä¹‹åï¼Œæƒ…å†µå°±å®Œå…¨ä¸åŒäº†ï¼Œå¯ä»¥ç›´æ¥å°† Lambda è¡¨è¾¾å¼ä¼ é€’ç»™è¯¥æ–¹æ³•ï¼Œä»£ç æ›´åŠ ç®€æ´ï¼Œæ›´åŠ ç›´è§‚ã€‚

```java
Optional<String> opt = Optional.of("æ²‰é»˜ç‹äºŒ");
opt.ifPresent(str -> System.out.println(str.length()));
```

Java 9 åè¿˜å¯ä»¥é€šè¿‡æ–¹æ³• `ifPresentOrElse(action, emptyAction)` æ‰§è¡Œä¸¤ç§ç»“æœï¼Œéç©ºæ—¶æ‰§è¡Œ actionï¼Œç©ºæ—¶æ‰§è¡Œ emptyActionã€‚

```java
Optional<String> opt = Optional.of("æ²‰é»˜ç‹äºŒ");
opt.ifPresentOrElse(str -> System.out.println(str.length()), () -> System.out.println("ä¸ºç©º"));
```

### 06ã€è®¾ç½®ï¼ˆè·å–ï¼‰é»˜è®¤å€¼

æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºï¼ˆè·å–ï¼‰ Optional å¯¹è±¡çš„æ—¶å€™ï¼Œéœ€è¦ä¸€ä¸ªé»˜è®¤å€¼ï¼Œ`orElse()` å’Œ `orElseGet()` æ–¹æ³•å°±æ´¾ä¸Šç”¨åœºäº†ã€‚

`orElse()` æ–¹æ³•ç”¨äºè¿”å›åŒ…è£¹åœ¨ Optional å¯¹è±¡ä¸­çš„å€¼ï¼Œå¦‚æœè¯¥å€¼ä¸ä¸º nullï¼Œåˆ™è¿”å›ï¼›å¦åˆ™è¿”å›é»˜è®¤å€¼ã€‚è¯¥æ–¹æ³•çš„å‚æ•°ç±»å‹å’Œå€¼å¾—ç±»å‹ä¸€è‡´ã€‚

```java
String nullName = null;
String name = Optional.ofNullable(nullName).orElse("æ²‰é»˜ç‹äºŒ");
System.out.println(name); // è¾“å‡ºï¼šæ²‰é»˜ç‹äºŒ
```

`orElseGet()` æ–¹æ³•ä¸ `orElse()` æ–¹æ³•ç±»ä¼¼ï¼Œä½†å‚æ•°ç±»å‹ä¸åŒã€‚å¦‚æœ Optional å¯¹è±¡ä¸­çš„å€¼ä¸º nullï¼Œåˆ™æ‰§è¡Œå‚æ•°ä¸­çš„å‡½æ•°ã€‚

```java
String nullName = null;
String name = Optional.ofNullable(nullName).orElseGet(()->"æ²‰é»˜ç‹äºŒ");
System.out.println(name); // è¾“å‡ºï¼šæ²‰é»˜ç‹äºŒ
```

ä»è¾“å‡ºç»“æœä»¥åŠä»£ç çš„å½¢å¼ä¸Šæ¥çœ‹ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•æå…¶ç›¸ä¼¼ï¼Œè¿™ä¸å…å¼•èµ·æˆ‘ä»¬çš„æ€€ç–‘ï¼ŒJava ç±»åº“çš„è®¾è®¡è€…æœ‰å¿…è¦è¿™æ ·åšå—ï¼Ÿ

å‡è®¾ç°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªè·å–é»˜è®¤å€¼çš„æ–¹æ³•ï¼Œå¾ˆä¼ ç»Ÿçš„æ–¹å¼ã€‚

```java
public static String getDefaultValue() {
    System.out.println("getDefaultValue");
    return "æ²‰é»˜ç‹äºŒ";
}
```

ç„¶åï¼Œé€šè¿‡ `orElse()` æ–¹æ³•å’Œ `orElseGet()` æ–¹æ³•åˆ†åˆ«è°ƒç”¨ `getDefaultValue()` æ–¹æ³•è¿”å›é»˜è®¤å€¼ã€‚

```java
public static void main(String[] args) {
    String name = null;
    System.out.println("orElse");
    String name2 = Optional.ofNullable(name).orElse(getDefaultValue());

    System.out.println("orElseGet");
    String name3 = Optional.ofNullable(name).orElseGet(OrElseOptionalDemo::getDefaultValue);
}
```

æ³¨ï¼š`ç±»å :: æ–¹æ³•å`æ˜¯ Java 8 å¼•å…¥çš„è¯­æ³•ï¼Œæ–¹æ³•ååé¢æ˜¯æ²¡æœ‰ `()` çš„ï¼Œè¡¨æ˜è¯¥æ–¹æ³•å¹¶ä¸ä¸€å®šä¼šè¢«è°ƒç”¨ã€‚

è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```java
orElse
getDefaultValue

orElseGet
getDefaultValue
```

è¾“å‡ºç»“æœæ˜¯ç›¸ä¼¼çš„ï¼Œæ²¡ä»€ä¹ˆå¤ªå¤§çš„ä¸åŒï¼Œè¿™æ˜¯åœ¨ Optional å¯¹è±¡çš„å€¼ä¸º null çš„æƒ…å†µä¸‹ã€‚å‡å¦‚ Optional å¯¹è±¡çš„å€¼ä¸ä¸º null å‘¢ï¼Ÿ

```java
public static void main(String[] args) {
    String name = "æ²‰é»˜ç‹ä¸‰";
    System.out.println("orElse");
    String name2 = Optional.ofNullable(name).orElse(getDefaultValue());

    System.out.println("orElseGet");
    String name3 = Optional.ofNullable(name).orElseGet(OrElseOptionalDemo::getDefaultValue);
}
```

è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```java
orElse
getDefaultValue
orElseGet
```

å’¦ï¼Œ`orElseGet()` æ²¡æœ‰å»è°ƒç”¨ `getDefaultValue()`ã€‚å“ªä¸ªæ–¹æ³•çš„æ€§èƒ½æ›´ä½³ï¼Œä½ æ˜ç™½äº†å§ï¼Ÿ

### 07ã€è·å–å€¼

ç›´è§‚ä»è¯­ä¹‰ä¸Šæ¥çœ‹ï¼Œ`get()` æ–¹æ³•æ‰æ˜¯æœ€æ­£å®—çš„è·å– Optional å¯¹è±¡å€¼çš„æ–¹æ³•ï¼Œä½†å¾ˆé—æ†¾ï¼Œè¯¥æ–¹æ³•æ˜¯æœ‰ç¼ºé™·çš„ï¼Œå› ä¸ºå‡å¦‚ Optional å¯¹è±¡çš„å€¼ä¸º nullï¼Œè¯¥æ–¹æ³•ä¼šæŠ›å‡º NoSuchElementException å¼‚å¸¸ã€‚è¿™å®Œå…¨ä¸æˆ‘ä»¬ä½¿ç”¨ Optional ç±»çš„åˆè¡·ç›¸æ‚–ã€‚

```java
public class GetOptionalDemo {
    public static void main(String[] args) {
        String name = null;
        Optional<String> optOrNull = Optional.ofNullable(name);
        System.out.println(optOrNull.get());
    }
}
```

è¿™æ®µç¨‹åºåœ¨è¿è¡Œæ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š

```
Exception in thread "main" java.util.NoSuchElementException: No value present
	at java.base/java.util.Optional.get(Optional.java:141)
	at com.cmower.dzone.optional.GetOptionalDemo.main(GetOptionalDemo.java:9)
```

å°½ç®¡æŠ›å‡ºçš„å¼‚å¸¸æ˜¯ NoSuchElementException è€Œä¸æ˜¯ NPEï¼Œä½†åœ¨æˆ‘ä»¬çœ‹æ¥ï¼Œæ˜¾ç„¶æ˜¯åœ¨â€œäº”åæ­¥ç¬‘ç™¾æ­¥â€ã€‚å»ºè®® `orElseGet()` æ–¹æ³•è·å– Optional å¯¹è±¡çš„å€¼ã€‚

### 08ã€è¿‡æ»¤å€¼

å°ç‹é€šè¿‡ Optional ç±»å¯¹ä¹‹å‰çš„ä»£ç è¿›è¡Œäº†å‡çº§ï¼Œå®Œæˆååˆå…´é«˜é‡‡çƒˆåœ°è·‘å»æ‰¾è€é©¬è¦ä»»åŠ¡äº†ã€‚è€é©¬è§‰å¾—è¿™å°ä¼™å­ä¸é”™ï¼Œå¤´è„‘çµæ´»ï¼Œåˆå¹²æ´»ç§¯æï¼Œå¾ˆå€¼å¾—åŸ¹å…»ï¼Œå°±åˆäº¤ç»™äº†å°ç‹ä¸€ä¸ªæ–°çš„ä»»åŠ¡ï¼šç”¨æˆ·æ³¨å†Œæ—¶å¯¹å¯†ç çš„é•¿åº¦è¿›è¡Œæ£€æŸ¥ã€‚

å°ç‹æ‹¿åˆ°ä»»åŠ¡åï¼Œä¹å¼€äº†èŠ±ï¼Œå› ä¸ºä»–åˆšè¦å­¦ä¹  Optional ç±»çš„ `filter()` æ–¹æ³•ï¼Œè¿™å°±æ´¾ä¸Šäº†ç”¨åœºã€‚

```java
public class FilterOptionalDemo {
    public static void main(String[] args) {
        String password = "12345";
        Optional<String> opt = Optional.ofNullable(password);
        System.out.println(opt.filter(pwd -> pwd.length() > 6).isPresent());
    }
}
```

`filter()` æ–¹æ³•çš„å‚æ•°ç±»å‹ä¸º Predicateï¼ˆJava 8 æ–°å¢çš„ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥å°†ä¸€ä¸ª Lambda è¡¨è¾¾å¼ä¼ é€’ç»™è¯¥æ–¹æ³•ä½œä¸ºæ¡ä»¶ï¼Œå¦‚æœè¡¨è¾¾å¼çš„ç»“æœä¸º falseï¼Œåˆ™è¿”å›ä¸€ä¸ª EMPTY çš„ Optional å¯¹è±¡ï¼Œå¦åˆ™è¿”å›è¿‡æ»¤åçš„ Optional å¯¹è±¡ã€‚

åœ¨ä¸Šä¾‹ä¸­ï¼Œç”±äº password çš„é•¿åº¦ä¸º 5 ï¼Œæ‰€ä»¥ç¨‹åºè¾“å‡ºçš„ç»“æœä¸º falseã€‚å‡è®¾å¯†ç çš„é•¿åº¦è¦æ±‚åœ¨ 6 åˆ° 10 ä½ä¹‹é—´ï¼Œé‚£ä¹ˆè¿˜å¯ä»¥å†è¿½åŠ ä¸€ä¸ªæ¡ä»¶ã€‚æ¥çœ‹å°ç‹å¢åŠ éš¾åº¦åçš„ä»£ç ã€‚


```java
Predicate<String> len6 = pwd -> pwd.length() > 6;
Predicate<String> len10 = pwd -> pwd.length() < 10;

password = "1234567";
opt = Optional.ofNullable(password);
boolean result = opt.filter(len6.and(len10)).isPresent();
System.out.println(result);
```

è¿™æ¬¡ç¨‹åºè¾“å‡ºçš„ç»“æœä¸º trueï¼Œå› ä¸ºå¯†ç å˜æˆäº† 7 ä½ï¼Œåœ¨ 6 åˆ° 10 ä½ä¹‹é—´ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå‡å¦‚å°ç‹ä½¿ç”¨ if-else æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œä»£ç è¯¥æœ‰å¤šå†—é•¿ã€‚

### 09ã€è½¬æ¢å€¼

å°ç‹æ£€æŸ¥å®Œäº†å¯†ç çš„é•¿åº¦ï¼Œä»ç„¶è§‰å¾—ä¸å¤Ÿå°½å…´ï¼Œè§‰å¾—è¦å¯¹å¯†ç çš„å¼ºåº¦ä¹Ÿè¿›è¡Œæ£€æŸ¥ï¼Œæ¯”å¦‚è¯´å¯†ç ä¸èƒ½æ˜¯â€œpasswordâ€ï¼Œè¿™æ ·çš„å¯†ç å¤ªå¼±äº†ã€‚äºæ˜¯ä»–åˆå¼€å§‹ç ”ç©¶èµ·äº† `map()` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥æŒ‰ç…§ä¸€å®šçš„è§„åˆ™å°†åŸæœ‰ Optional å¯¹è±¡è½¬æ¢ä¸ºä¸€ä¸ªæ–°çš„ Optional å¯¹è±¡ï¼ŒåŸæœ‰çš„ Optional å¯¹è±¡ä¸ä¼šæ›´æ”¹ã€‚

å…ˆæ¥çœ‹å°ç‹å†™çš„ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š

```java
public class OptionalMapDemo {
    public static void main(String[] args) {
        String name = "æ²‰é»˜ç‹äºŒ";
        Optional<String> nameOptional = Optional.of(name);
        Optional<Integer> intOpt = nameOptional
                .map(String::length);
        
        System.out.println( intOpt.orElse(0));
    }
}
```

åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`map()` æ–¹æ³•çš„å‚æ•° `String::length`ï¼Œæ„å‘³ç€è¦ å°†åŸæœ‰çš„å­—ç¬¦ä¸²ç±»å‹çš„ Optional æŒ‰ç…§å­—ç¬¦ä¸²é•¿åº¦é‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„ Optional å¯¹è±¡ï¼Œç±»å‹ä¸º Integerã€‚

ææ¸…æ¥šäº† `map()` æ–¹æ³•çš„åŸºæœ¬ç”¨æ³•åï¼Œå°ç‹å†³å®šæŠŠ `map()` æ–¹æ³•ä¸ `filter()` æ–¹æ³•ç»“åˆèµ·æ¥ç”¨ï¼Œå‰è€…ç”¨äºå°†å¯†ç è½¬åŒ–ä¸ºå°å†™ï¼Œåè€…ç”¨äºåˆ¤æ–­é•¿åº¦ä»¥åŠæ˜¯å¦æ˜¯â€œpasswordâ€ã€‚

```java
public class OptionalMapFilterDemo {
    public static void main(String[] args) {
        String password = "password";
        Optional<String>  opt = Optional.ofNullable(password);

        Predicate<String> len6 = pwd -> pwd.length() > 6;
        Predicate<String> len10 = pwd -> pwd.length() < 10;
        Predicate<String> eq = pwd -> pwd.equals("password");

        boolean result = opt.map(String::toLowerCase).filter(len6.and(len10 ).and(eq)).isPresent();
        System.out.println(result);
    }
}
```

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/java8/optional-2.jpg)

å¥½äº†ï¼Œæˆ‘äº²çˆ±çš„è¯»è€…æœ‹å‹ï¼Œä»¥ä¸Šå°±æ˜¯æœ¬æ–‡çš„å…¨éƒ¨å†…å®¹äº†â€”â€”å¯ä»¥è¯´æ˜¯å²ä¸Šæœ€ä½³ Optional æŒ‡å—äº†ï¼Œèƒ½çœ‹åˆ°è¿™é‡Œçš„éƒ½æ˜¯æœ€ä¼˜ç§€çš„ç¨‹åºå‘˜ï¼ŒäºŒå“¥å¿…é¡»è¦ä¼¸å‡ºå¤§æ‹‡æŒ‡ä¸ºä½ ç‚¹ä¸ªèµã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 10.3 æ·±å…¥æµ…å‡ºLambdaè¡¨è¾¾å¼

ä»Šå¤©åˆ†äº«çš„ä¸»é¢˜æ˜¯ã€ŠLambda è¡¨è¾¾å¼å…¥é—¨ã€‹ï¼Œè¿™ä¹Ÿæ˜¯ä¹‹å‰ä¸€äº›è¯»è€…ç•™è¨€å¼ºçƒˆè¦æ±‚æˆ‘å†™ä¸€å†™çš„ï¼Œä¸å¥½æ„æ€ï¼Œè®©ä½ ä»¬ä¹…ç­‰äº†ï¼Œç°åœ¨æ¥æ»¡è¶³ä½ ä»¬ï¼Œä¸ºæ—¶ä¸æ™šå§ï¼Ÿ

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/java8/Lambda-1.jpg)

### 01ã€åˆè¯† Lambda

Lambda è¡¨è¾¾å¼æè¿°äº†ä¸€ä¸ªä»£ç å—ï¼ˆæˆ–è€…å«åŒ¿åæ–¹æ³•ï¼‰ï¼Œå¯ä»¥å°†å…¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ„é€ æ–¹æ³•æˆ–è€…æ™®é€šæ–¹æ³•ä»¥ä¾¿åç»­æ‰§è¡Œã€‚è€ƒè™‘ä¸‹é¢è¿™æ®µä»£ç ï¼š

```java
() -> System.out.println("æ²‰é»˜ç‹äºŒ")
```

æ¥ä»å·¦åˆ°å³è§£é‡Šä¸€ä¸‹ï¼Œ`()` ä¸º Lambda è¡¨è¾¾å¼çš„å‚æ•°åˆ—è¡¨ï¼ˆæœ¬ä¾‹ä¸­æ²¡æœ‰å‚æ•°ï¼‰ï¼Œ`->` æ ‡è¯†è¿™ä¸²ä»£ç ä¸º Lambda è¡¨è¾¾å¼ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œçœ‹åˆ° `->` å°±çŸ¥é“è¿™æ˜¯ Lambdaï¼‰ï¼Œ`System.out.println("æ²‰é»˜ç‹äºŒ")` ä¸ºè¦æ‰§è¡Œçš„ä»£ç ï¼Œå³å°†â€œæ²‰é»˜ç‹äºŒâ€æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºæµã€‚

æœ‰ç‚¹ Java åŸºç¡€çš„åŒå­¦åº”è¯¥ä¸ä¼šå¯¹ Runnable æ¥å£æ„Ÿåˆ°é™Œç”Ÿï¼Œè¿™æ˜¯å¤šçº¿ç¨‹çš„ä¸€ä¸ªåŸºç¡€æ¥å£ï¼Œå®ƒçš„å®šä¹‰å¦‚ä¸‹ï¼š

```java
@FunctionalInterface
public interface Runnable
{
   public abstract void run();
}
```

Runnable æ¥å£éå¸¸ç®€å•ï¼Œä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³• `run()`ï¼›ç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ä¸€ä¸ªé™Œç”Ÿçš„æ³¨è§£ `@FunctionalInterface`ï¼Œè¿™ä¸ªæ³¨è§£æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ

æˆ‘çœ‹äº†å®ƒçš„æºç ï¼Œé‡Œé¢æœ‰è¿™æ ·ä¸€æ®µæ³¨é‡Šï¼š

>Note that instances of functional interfaces can be created with lambda expressions, method references, or constructor references.

å¤§è‡´çš„æ„æ€å°±æ˜¯è¯´ï¼Œé€šè¿‡ `@FunctionalInterface` æ ‡è®°çš„æ¥å£å¯ä»¥é€šè¿‡ Lambda è¡¨è¾¾å¼åˆ›å»ºå®ä¾‹ã€‚å…·ä½“æ€ä¹ˆè¡¨ç°å‘¢ï¼Ÿ

åŸæ¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¹¶å¯åŠ¨å®ƒæ˜¯è¿™æ ·çš„ï¼š

```java
public class LamadaTest {
    public static void main(String[] args) {
        new Thread(new Runnable() {
            @Override
            public void run() {
                System.out.println("æ²‰é»˜ç‹äºŒ");
            }
        }).start();
    }
}
```

é€šè¿‡ Lambda è¡¨è¾¾å¼å‘¢ï¼Ÿåªéœ€è¦ä¸‹é¢è¿™æ ·ï¼š

```java
public class LamadaTest {
    public static void main(String[] args) {
        new Thread(() -> System.out.println("æ²‰é»˜ç‹äºŒ")).start();
    }
}
```

æ˜¯ä¸æ˜¯å¾ˆå¦™ï¼æ¯”èµ·åŒ¿åå†…éƒ¨ç±»ï¼ŒLambda è¡¨è¾¾å¼ä¸ä»…æ˜“äºç†è§£ï¼Œæ›´å¤§å¤§ç®€åŒ–äº†å¿…é¡»ç¼–å†™çš„ä»£ç æ•°é‡ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/java8/Lambda-2.jpg)

### 02ã€Lambda è¯­æ³•

æ¯ä¸ª Lambda è¡¨è¾¾å¼éƒ½éµå¾ªä»¥ä¸‹æ³•åˆ™ï¼š

```
( parameter-list ) -> { expression-or-statements }
```

`()` ä¸­çš„ `parameter-list` æ˜¯ä»¥é€—å·åˆ†éš”çš„å‚æ•°ã€‚ä½ å¯ä»¥æŒ‡å®šå‚æ•°çš„ç±»å‹ï¼Œä¹Ÿå¯ä»¥ä¸æŒ‡å®šï¼ˆç¼–è¯‘å™¨ä¼šæ ¹æ®ä¸Šä¸‹æ–‡è¿›è¡Œæ¨æ–­ï¼‰ã€‚Java 11 åï¼Œè¿˜å¯ä»¥ä½¿ç”¨ `var` å…³é”®å­—ä½œä¸ºå‚æ•°ç±»å‹ï¼Œæœ‰ç‚¹ JavaScript çš„å‘³é“ã€‚

`->` ç›¸å½“äº Lambda çš„æ ‡è¯†ç¬¦ï¼Œå°±å¥½åƒè§åˆ°åœ£æ—¨å°±è§åˆ°äº†çš‡ä¸Šã€‚

`{}` ä¸­çš„ `expression-or-statements` ä¸º Lambda çš„ä¸»ä½“ï¼Œå¯ä»¥æ˜¯ä¸€è¡Œè¯­å¥ï¼Œä¹Ÿå¯ä»¥å¤šè¡Œã€‚

å¯ä»¥é€šè¿‡ Lambda è¡¨è¾¾å¼å¹²å¾ˆå¤šäº‹æƒ…ï¼Œæ¯”å¦‚è¯´

1ï¼‰ä¸ºå˜é‡èµ‹å€¼ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
Runnable r = () -> { System.out.println("æ²‰é»˜ç‹äºŒ"); };
r.run();
```

2ï¼‰ä½œä¸º return ç»“æœï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
static FileFilter getFilter(String ext)
{
    return (pathname) -> pathname.toString().endsWith(ext);
}
```

3ï¼‰ä½œä¸ºæ•°ç»„å…ƒç´ ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
final PathMatcher matchers[] =
{
        (path) -> path.toString().endsWith("txt"),
        (path) -> path.toString().endsWith("java")
};
```

4ï¼‰ä½œä¸ºæ™®é€šæ–¹æ³•æˆ–è€…æ„é€ æ–¹æ³•çš„å‚æ•°ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
new Thread(() -> System.out.println("æ²‰é»˜ç‹äºŒ")).start();
```

éœ€è¦æ³¨æ„ Lambda è¡¨è¾¾å¼çš„ä½œç”¨åŸŸèŒƒå›´ã€‚

```java
public static void main(String[] args) {

    int limit = 10;
    Runnable r = () -> {
        int limit = 5;
        for (int i = 0; i < limit; i++)
            System.out.println(i);
    };
}
```

ä¸Šé¢è¿™æ®µä»£ç åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šæç¤ºé”™è¯¯ï¼šå˜é‡ limit å·²ç»å®šä¹‰è¿‡äº†ã€‚

å’ŒåŒ¿åå†…éƒ¨ç±»ä¸€æ ·ï¼Œä¸è¦åœ¨ Lambda è¡¨è¾¾å¼ä¸»ä½“å†…å¯¹æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡è¿›è¡Œä¿®æ”¹ï¼Œå¦åˆ™ç¼–è¯‘ä¹Ÿä¸ä¼šé€šè¿‡ï¼šLambda è¡¨è¾¾å¼ä¸­ä½¿ç”¨çš„å˜é‡å¿…é¡»æ˜¯ final çš„ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/java8/Lambda-3.jpg)

è¿™ä¸ªé—®é¢˜å‘ç”Ÿçš„åŸå› æ˜¯å› ä¸º Java è§„èŒƒä¸­æ˜¯è¿™æ ·è§„å®šçš„ï¼š

>Any local variable, formal parameter, or exception parameter used but not declared in a lambda expression
must either be declared final or be effectively final [(Â§4.12.4)](http://docs.oracle.com/javase/specs/jls/se8/html/jls-4.html#jls-4.12.4),
or a compile-time error occurs where the use is attempted.

å¤§è‡´çš„æ„æ€å°±æ˜¯è¯´ï¼ŒLambda è¡¨è¾¾å¼ä¸­è¦ç”¨åˆ°çš„ï¼Œä½†åˆæœªåœ¨ Lambda è¡¨è¾¾å¼ä¸­å£°æ˜çš„å˜é‡ï¼Œå¿…é¡»å£°æ˜ä¸º final æˆ–è€…æ˜¯ effectively finalï¼Œå¦åˆ™å°±ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ã€‚

å…³äº final å’Œ effectively final çš„åŒºåˆ«ï¼Œå¯èƒ½æœ‰äº›å°ä¼™ä¼´ä¸å¤ªæ¸…æ¥šï¼Œè¿™é‡Œå¤šè¯´ä¸¤å¥ã€‚

```java
final int a;
a = 1;
// a = 2;
// ç”±äº a æ˜¯ final çš„ï¼Œæ‰€ä»¥ä¸èƒ½è¢«é‡æ–°èµ‹å€¼

int b;
b = 1;
// b æ­¤åå†æœªæ›´æ”¹
// b å°±æ˜¯ effectively final

int c;
c = 1;
// c å…ˆè¢«èµ‹å€¼ä¸º 1ï¼Œéšååˆè¢«é‡æ–°èµ‹å€¼ä¸º 2
c = 2;
// c å°±ä¸æ˜¯ effectively final
```

æ˜ç™½äº† final å’Œ effectively final çš„åŒºåˆ«åï¼Œæˆ‘ä»¬äº†è§£åˆ°ï¼Œå¦‚æœæŠŠ limit å®šä¹‰ä¸º finalï¼Œé‚£å°±æ— æ³•åœ¨ Lambda è¡¨è¾¾å¼ä¸­ä¿®æ”¹å˜é‡çš„å€¼ã€‚é‚£æœ‰ä»€ä¹ˆå¥½çš„è§£å†³åŠæ³•å‘¢ï¼Ÿæ—¢èƒ½è®©ç¼–è¯‘å™¨ä¸å‘å‡ºè­¦å‘Šï¼Œåˆèƒ½ä¿®æ”¹å˜é‡çš„å€¼ã€‚

æ€å‰æƒ³åï¼Œè¯•æ¥è¯•å»ï¼Œæˆ‘ç»ˆäºæ‰¾åˆ°äº† 3 ä¸ªå¯è¡Œçš„è§£å†³æ–¹æ¡ˆï¼š

1ï¼‰æŠŠ limit å˜é‡å£°æ˜ä¸º staticã€‚

2ï¼‰æŠŠ limit å˜é‡å£°æ˜ä¸º AtomicIntegerã€‚

3ï¼‰ä½¿ç”¨æ•°ç»„ã€‚

ä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†åœ°ä¸€ä¸€ä»‹ç»ä¸‹ã€‚

#### 01ï¼‰æŠŠ limit å˜é‡å£°æ˜ä¸º static

è¦æƒ³æŠŠ limit å˜é‡å£°æ˜ä¸º staticï¼Œå°±å¿…é¡»å°† limit å˜é‡æ”¾åœ¨ `main()` æ–¹æ³•å¤–éƒ¨ï¼Œå› ä¸º `main()` æ–¹æ³•æœ¬èº«æ˜¯ static çš„ã€‚å®Œæ•´çš„ä»£ç ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºã€‚

```java
public class ModifyVariable2StaticInsideLambda {
    static int limit = 10;
    public static void main(String[] args) {
        Runnable r = () -> {
            limit = 5;
            for (int i = 0; i < limit; i++) {
                System.out.println(i);
            }
        };
        new Thread(r).start();
    }
}
```

æ¥çœ‹ä¸€ä¸‹ç¨‹åºè¾“å‡ºçš„ç»“æœï¼š

```
0
1
2
3
4
```

OKï¼Œè¯¥æ–¹æ¡ˆæ˜¯å¯è¡Œçš„ã€‚

#### 02ï¼‰æŠŠ limit å˜é‡å£°æ˜ä¸º AtomicInteger

AtomicInteger å¯ä»¥ç¡®ä¿ int å€¼çš„ä¿®æ”¹æ˜¯åŸå­æ€§çš„ï¼Œå¯ä»¥ä½¿ç”¨ `set()` æ–¹æ³•è®¾ç½®ä¸€ä¸ªæ–°çš„ int å€¼ï¼Œ`get()` æ–¹æ³•è·å–å½“å‰çš„ int å€¼ã€‚

```java
public class ModifyVariable2AtomicInsideLambda {
    public static void main(String[] args) {
        final AtomicInteger limit = new AtomicInteger(10);
        Runnable r = () -> {
            limit.set(5);
            for (int i = 0; i < limit.get(); i++) {
                System.out.println(i);
            }
        };
        new Thread(r).start();
    }
}
```

æ¥çœ‹ä¸€ä¸‹ç¨‹åºè¾“å‡ºçš„ç»“æœï¼š

```
0
1
2
3
4
```

OKï¼Œè¯¥æ–¹æ¡ˆä¹Ÿæ˜¯å¯è¡Œçš„ã€‚

#### 03ï¼‰ä½¿ç”¨æ•°ç»„

ä½¿ç”¨æ•°ç»„çš„æ–¹å¼ç•¥å¸¦ä¸€äº›æ¬ºéª—çš„æ€§è´¨ï¼Œåœ¨å£°æ˜æ•°ç»„çš„æ—¶å€™è®¾ç½®ä¸º finalï¼Œä½†æ›´æ”¹ int çš„å€¼æ—¶å´ä¿®æ”¹çš„æ˜¯æ•°ç»„çš„ä¸€ä¸ªå…ƒç´ ã€‚

```java
public class ModifyVariable2ArrayInsideLambda {
    public static void main(String[] args) {
        final int [] limits = {10};
        Runnable r = () -> {
            limits[0] = 5;
            for (int i = 0; i < limits[0]; i++) {
                System.out.println(i);
            }
        };
        new Thread(r).start();
    }
}
```

æ¥çœ‹ä¸€ä¸‹ç¨‹åºè¾“å‡ºçš„ç»“æœï¼š

```
0
1
2
3
4
```

OKï¼Œè¯¥æ–¹æ¡ˆä¹Ÿæ˜¯å¯è¡Œçš„ã€‚

### 03ã€Lambda å’Œ this å…³é”®å­—

Lambda è¡¨è¾¾å¼å¹¶ä¸ä¼šå¼•å…¥æ–°çš„ä½œç”¨åŸŸï¼Œè¿™ä¸€ç‚¹å’ŒåŒ¿åå†…éƒ¨ç±»æ˜¯ä¸åŒçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒLambda è¡¨è¾¾å¼ä¸»ä½“å†…ä½¿ç”¨çš„ this å…³é”®å­—å’Œå…¶æ‰€åœ¨çš„ç±»å®ä¾‹ç›¸åŒã€‚

æ¥çœ‹ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ã€‚

```java
public class LamadaTest {
    public static void main(String[] args) {
        new LamadaTest().work();
    }

    public void work() {
        System.out.printf("this = %s%n", this);

        Runnable r = new Runnable()
        {
            @Override
            public void run()
            {
                System.out.printf("this = %s%n", this);
            }
        };
        new Thread(r).start();
        new Thread(() -> System.out.printf("this = %s%n", this)).start();
    }
}
```

Tipsï¼š`%s` ä»£è¡¨å½“å‰ä½ç½®è¾“å‡ºå­—ç¬¦ä¸²ï¼Œ`%n` ä»£è¡¨æ¢è¡Œç¬¦ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ `\n` ä»£æ›¿ï¼Œä½† `%n` æ˜¯è·¨å¹³å°çš„ã€‚

`work()` æ–¹æ³•ä¸­çš„ä»£ç å¯ä»¥åˆ†ä¸º 3 ä¸ªéƒ¨åˆ†ï¼š

1ï¼‰å•ç‹¬çš„ this å…³é”®å­—

```java
System.out.printf("this = %s%n", this);
```

å…¶ä¸­ this ä¸º `main()` æ–¹æ³•ä¸­é€šè¿‡ new å…³é”®å­—åˆ›å»ºçš„ LamadaTest å¯¹è±¡â€”â€”`new LamadaTest()`ã€‚

2ï¼‰åŒ¿åå†…éƒ¨ç±»ä¸­çš„ this å…³é”®å­—

```java
Runnable r = new Runnable()
{
    @Override
    public void run()
    {
        System.out.printf("this = %s%n", this);
    }
};
```

å…¶ä¸­ this ä¸º `work()` æ–¹æ³•ä¸­é€šè¿‡ new å…³é”®å­—åˆ›å»ºçš„ Runnable å¯¹è±¡â€”â€”`new Runnable(){...}`ã€‚

3ï¼‰Lambda è¡¨è¾¾å¼ä¸­çš„ this å…³é”®å­—

å…¶ä¸­ this å…³é”®å­—å’Œ 1ï¼‰ä¸­çš„ç›¸åŒã€‚

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„è¾“å‡ºç»“æœï¼š

```java
this = com.cmower.java_demo.journal.LamadaTest@3feba861
this = com.cmower.java_demo.journal.LamadaTest$1@64f033cb
this = com.cmower.java_demo.journal.LamadaTest@3feba861
```

ç¬¦åˆæˆ‘ä»¬åˆ†æçš„é¢„æœŸã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/java8/Lambda-4.jpg)

### 04ã€æœ€å

å°½ç®¡ Lambda è¡¨è¾¾å¼åœ¨ç®€åŒ– Java ç¼–ç¨‹æ–¹é¢åšäº†å¾ˆå¤šä»¤äººæƒŠè®¶çš„åŠªåŠ›ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸å½“çš„ä½¿ç”¨ä»ç„¶ä¼šå¯¼è‡´ä¸å¿…è¦çš„æ··ä¹±ï¼Œå¤§å®¶ä¼™æ…ç”¨ã€‚

å¥½äº†ï¼Œæˆ‘äº²çˆ±çš„è¯»è€…æœ‹å‹ä»¬ï¼Œä»¥ä¸Šå°±æ˜¯æœ¬æ–‡çš„å…¨éƒ¨å†…å®¹äº†ã€‚èƒ½åœ¨ç–«æƒ…æœŸé—´åšæŒçœ‹æŠ€æœ¯æ–‡ï¼ŒäºŒå“¥å¿…é¡»è¦ä¼¸å‡ºå¤§æ‹‡æŒ‡ä¸ºä½ ç‚¹ä¸ªèµğŸ‘ã€‚åŸåˆ›ä¸æ˜“ï¼Œå¦‚æœè§‰å¾—æœ‰ç‚¹ç”¨çš„è¯ï¼Œè¯·ä¸è¦åå•¬ä½ æ‰‹ä¸­**ç‚¹èµ**çš„æƒåŠ›â€”â€”å› ä¸ºè¿™å°†æ˜¯æˆ‘å†™ä½œçš„æœ€å¼ºåŠ¨åŠ›ã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 10.4 Java 14 æ–°ç‰¹æ€§

Java 14 çš„æ—¶å€™ï¼Œæ–°å¢äº†è®°å½• Recordã€æ¨¡å¼åŒ¹é… instanceof ç­‰æ–°ç‰¹æ€§ï¼Œè½¬æ­£äº† Java 12 æ—¶çš„ switch è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥è¿‡ä¸€éã€‚

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTc5Mzg5LTA2N2E2NGZiZWY3OTU0MTAucG5n?x-oss-process=image/format,png)

### 01ã€ä¸‹è½½ JDK 14

> æˆªæ­¢åˆ°2023å¹´03æœˆ30æ—¥ï¼ŒJava 20 å·²ç»å‘å¸ƒäº†ï¼Œä¸è¿‡ä¸æ˜¯ LTSï¼ˆé•¿æœŸæ”¯æŒï¼‰ç‰ˆæœ¬ï¼ŒJava 17ã€11ã€8 æ˜¯ç›®å‰æä¾›æ”¯æŒçš„ LTS ç‰ˆæœ¬ã€‚

è¦æƒ³å¼€ç®±ï¼Œå¾—å…ˆä¸‹è½½ JDK 14ï¼ˆå¦‚æœä½ æœ‰æ›´é«˜ç‰ˆæœ¬ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ï¼‰ï¼Œä¸ç„¶æ‹¿ä»€ä¹ˆå¼€ç®±å‘¢ï¼Œå¯¹å§ï¼Ÿæœ‰ 2 å¤„åœ°æ–¹å¯ä¾›ä¸‹è½½ï¼ŒOracle ä¸Šå¯ä»¥ä¸‹è½½å•†ç”¨ç‰ˆï¼Œ [jdk.java.net](https://jdk.java.net/14/)  ä¸Šå¯ä»¥ä¸‹è½½å¼€æºç‰ˆã€‚æˆ‘ä»¬å°±é€‰æ‹©åè€…å§ã€‚

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTc5Mzg5LTJkM2Q3MGQ4ODQ0NDk1MDEucG5n?x-oss-process=image/format,png)

æˆ‘ç›®å‰ç”¨çš„æ˜¯ Windows æ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥å°±é€‰æ‹© Windows ç‰ˆçš„ zip åŒ…è¿›è¡Œä¸‹è½½ï¼Œå®Œæˆåè®°å¾—è§£å‹ã€‚

### 02ã€å‡çº§ IntelliJ IDEA

>æˆªæ­¢åˆ° 2023å¹´03æœˆ30æ—¥ï¼ŒIntellij IDEA çš„æœ€æ–°ç‰ˆæœ¬æ˜¯ 2023.1ã€‚ 

éœ€è¦æŠŠ IDEA å‡çº§åˆ°æŠ¢å…ˆä½“éªŒç‰ˆ 2020.1 EAPï¼ˆå¦‚æœä½ å½“å‰ä½¿ç”¨çš„ç‰ˆæœ¬å¤§äºæ­¤ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ï¼‰ï¼Œå¦åˆ™æ— æ³•æ”¯æŒ Java 14 çš„æ–°ç‰¹æ€§ã€‚

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTc5Mzg5LThhYjFjYmRiNDA3MjBiM2UucG5n?x-oss-process=image/format,png)

ç¤¾åŒºç‰ˆçš„ä¸‹è½½åœ°å€å¦‚ä¸‹æ‰€ç¤ºï¼š

```
[https://www.jetbrains.com/idea/nextversion/#section=windows](https://www.jetbrains.com/idea/nextversion/#section=windows)
```

å®‰è£…çš„æ—¶å€™å¯ä»¥æŠŠä¹‹å‰çš„ç‰ˆæœ¬å¸è½½ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä¿ç•™ã€‚å®Œæˆåï¼Œæˆ‘ä»¬æ¥æ–°å»ºä¸€ä¸ª Java 14 çš„é¡¹ç›®ã€‚

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTc5Mzg5LTBhYWIwYWNiY2RiMzllZGIucG5n?x-oss-process=image/format,png)

### 01ã€instanceof

æŒ‰ç…§æ–°ç‰¹æ€§çš„é¡ºåºï¼Œæˆ‘ä»¬å°±å…ˆä» instanceof è¯´èµ·å§ã€‚æ—§å¼çš„ instanceof çš„ç”¨æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
public class OldInstanceOf {
    public static void main(String[] args) {
        Object str = "Java 14ï¼ŒçœŸé¦™";
        if (str instanceof String) {
            String s = (String)str;
            System.out.println(s.length());
        }
    }
}
```

éœ€è¦å…ˆä½¿ç”¨ instanceof åœ¨ if æ¡ä»¶ä¸­åˆ¤æ–­ str çš„ç±»å‹æ˜¯å¦ä¸º Stringï¼ˆç¬¬ä¸€æ­¥ï¼‰ï¼Œå†åœ¨  if è¯­å¥ä¸­å°† str å¼ºè½¬ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼ˆç¬¬äºŒæ­¥ï¼‰ï¼Œå¹¶ä¸”è¦é‡æ–°å£°æ˜ä¸€ä¸ªå˜é‡ç”¨äºå¼ºè½¬åçš„èµ‹å€¼ï¼ˆç¬¬ä¸‰æ­¥ï¼‰ã€‚

ä¸‰ä¸ªæ­¥éª¤ä¹Ÿä¸ç®—å¤šï¼Œä½†æ€»è§‰å¾—åº”è¯¥è¿˜æœ‰æ›´å¥½çš„è¯­æ³•ï¼Œè¿™ä¸ï¼ŒJava 14 å°±æƒ³åˆ°äº†è¿™ä¸€å±‚ã€‚

```java
public class NewInstanceOf {
    public static void main(String[] args) {
        Object str = "Java 14ï¼ŒçœŸé¦™";
        if (str instanceof String s) {
            System.out.println(s.length());
        }
    }
}
```

å¯ä»¥ç›´æ¥åœ¨ if æ¡ä»¶åˆ¤æ–­ç±»å‹çš„æ—¶å€™æ·»åŠ ä¸€ä¸ªå˜é‡ï¼Œå°±ä¸éœ€è¦å†å¼ºè½¬å’Œå£°æ˜æ–°çš„å˜é‡äº†ã€‚æ˜¯ä¸æ˜¯ç‰¹åˆ«ç®€æ´ï¼Ÿä½†æ¨¡å¼åŒ¹é…çš„ instanceof åœ¨ Java 14 ä¸­æ˜¯é¢„è§ˆç‰ˆçš„ï¼Œé»˜è®¤æ˜¯ä¸å¯ç”¨çš„ï¼Œæ‰€ä»¥è¿™æ®µä»£ç ä¼šæœ‰ä¸€ä¸ªå¥‡æ€ªçš„ç¼–è¯‘é”™è¯¯ï¼ˆJava 14 ä¸­ä¸æ”¯æŒæ¨¡å¼åŒ¹é…çš„ instanceofï¼‰ã€‚

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTc5Mzg5LTg1MTQ4YWI3MjI2ZmM4ZTUucG5n?x-oss-process=image/format,png)

é‚£æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿéœ€è¦åœ¨é¡¹ç›®é…ç½®ä¸­æ‰‹åŠ¨è®¾ç½®ä¸€ä¸‹è¯­è¨€çš„ç‰ˆæœ¬ã€‚

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTc5Mzg5LTdhMzE3MDYwNjk5NTJmMDgucG5n?x-oss-process=image/format,png)

è®¾ç½®å®Œæˆåï¼Œç¼–è¯‘é”™è¯¯å°±éšé£é£˜èµ°äº†ã€‚ç¨‹åºè¾“å‡ºçš„ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
10
```

ä¸é”™ä¸é”™ï¼ŒçœŸé¦™ã€‚æƒ³çŸ¥é“ Java ç¼–è¯‘å™¨åœ¨èƒŒåå¸®æˆ‘ä»¬åšäº†ä»€ä¹ˆå—ï¼Ÿçœ‹ä¸€ä¸‹åç¼–è¯‘åçš„å­—èŠ‚ç å°±æ˜ç™½äº†ã€‚

```java
public class NewInstanceOf {
    public NewInstanceOf() {
    }

    public static void main(String[] args) {
        Object str = "Java 14ï¼ŒçœŸé¦™";
        String s;
        if (str instanceof String && (s = (String)str) == (String)str) {
            System.out.println(s.length());
        }

    }
}
```

åœ¨ if æ¡ä»¶åˆ¤æ–­å‰ï¼Œå…ˆå£°æ˜äº†å˜é‡ sï¼Œç„¶ååœ¨ if  æ¡ä»¶ä¸­è¿›è¡Œäº†å¼ºè½¬ `s = (String)str)`ï¼Œå¹¶ä¸”åˆ¤æ–­äº† s å’Œ str æ˜¯å¦ç›¸ç­‰ã€‚ç¡®å®æ˜¯ä¸€ä¸ªè§£æ”¾å¼€æ”¾è€…ç”Ÿäº§åŠ›çš„å¥½ç‰¹æ€§ï¼Œå¼ºçƒˆå¸Œæœ›è¿™ä¸ªç‰¹æ€§åœ¨ä¸‹ä¸ªç‰ˆæœ¬ä¸­è½¬æ­£ã€‚

### 02ã€Records

åœ¨ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘è°ˆåˆ°äº†[ç±»çš„ä¸å¯å˜æ€§](https://tobebetterjavaer.com/basic-extra-meal/immutable.html)ï¼Œå®ƒæ˜¯è¿™æ ·å®šä¹‰çš„ï¼š

```java
public final class Writer {
    private final String name;
    private final int age;

    public Writer(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public int getAge() {
        return age;
    }

    public String getName() {
        return name;
    }
}
```

é‚£ä¹ˆï¼Œå¯¹äº Records æ¥è¯´ï¼Œä¸€æ¡ Record å°±ä»£è¡¨ä¸€ä¸ªä¸å˜çš„çŠ¶æ€ã€‚å°½ç®¡å®ƒä¼šæä¾›è¯¸å¦‚ `equals()`ã€`hashCode()`ã€`toString()`ã€æ„é€ æ–¹æ³•ï¼Œä»¥åŠå­—æ®µçš„ getterï¼Œä½†å®ƒæ— æ„æ›¿ä»£å¯å˜å¯¹è±¡çš„ç±»ï¼ˆæ²¡æœ‰ setterï¼‰ï¼Œä»¥åŠ Lombok æä¾›çš„åŠŸèƒ½ã€‚

æ¥ç”¨ Records æ›¿ä»£ä¸€ä¸‹ä¸Šé¢è¿™ä¸ª Writer ç±»ï¼š

```java
public record Writer(String name, int age) { }
```

ä½ çœ‹ï¼Œä¸€è¡Œä»£ç å°±æå®šã€‚å…³é”®æ˜¯æ¯”ä¹‹å‰çš„ä»£ç åŠŸèƒ½æ›´ä¸°å¯Œï¼Œæ¥çœ‹ä¸€ä¸‹åç¼–è¯‘åçš„å­—èŠ‚ç ï¼š

```java
public final class Writer extends java.lang.Record {
    private final java.lang.String name;
    private final int age;

    public Writer(java.lang.String name, int age) { /* compiled code */ }

    public java.lang.String toString() { /* compiled code */ }

    public final int hashCode() { /* compiled code */ }

    public final boolean equals(java.lang.Object o) { /* compiled code */ }

    public java.lang.String name() { /* compiled code */ }

    public int age() { /* compiled code */ }
}
```

ç±»æ˜¯ final çš„ï¼Œå­—æ®µæ˜¯ private final çš„ï¼Œæ„é€ æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œ`toString()`ã€`hashCode()`ã€`equals()` æ–¹æ³•ä¹Ÿæœ‰äº†ï¼Œgetter æ–¹æ³•ä¹Ÿæœ‰äº†ï¼Œåªä¸è¿‡æ²¡æœ‰ get å‰ç¼€ã€‚ä½†æ˜¯æ²¡æœ‰ setter æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ Records ç¡®å®é’ˆå¯¹çš„æ˜¯ä¸å¯å˜å¯¹è±¡â€”â€”é‰´å®šå®Œæ¯•ã€‚é‚£æ€ä¹ˆä½¿ç”¨ Records å‘¢ï¼Ÿ

```java
public class WriterDemo {
    public static void main(String[] args) {
        Writer writer = new Writer("æ²‰é»˜ç‹äºŒ",18);
        System.out.println("toStringï¼š" + writer);
        System.out.println("hashCodeï¼š" + writer.hashCode());
        System.out.println("nameï¼š" + writer.name());
        System.out.println("ageï¼š" + writer.age());

        Writer writer1 = new Writer("æ²‰é»˜ç‹äºŒ", 18);
        System.out.println("equalsï¼š" + (writer.equals(writer1)));
    }
}
```

ç¨‹åºè¾“å‡ºçš„ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
toStringï¼šWriter[name=æ²‰é»˜ç‹äºŒ, age=18]
hashCodeï¼š1130697218
nameï¼šæ²‰é»˜ç‹äºŒ
ageï¼š18
equalsï¼štrue
```

ä¸é”™ä¸é”™ï¼ŒçœŸé¦™ï¼Œä»¥åå®šä¹‰ä¸å¯å˜ç±»æ—¶å°±ç®€å•äº†ï¼Œå¼ºçƒˆå¸Œæœ›è¿™ä¸ªç‰¹æ€§åœ¨ä¸‹ä¸ªç‰ˆæœ¬ä¸­è½¬æ­£ã€‚

### 03ã€switch è¡¨è¾¾å¼

å…³äº switch è¡¨è¾¾å¼ï¼Œæˆ‘åœ¨ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« ä¸­å·²ç»è¯¦ç»†è¯´æ˜äº†ï¼Œç‚¹å‡»[ä¼ é€é—¨](https://mp.weixin.qq.com/s/1BDDLDSKDGwQAfIFMyySdg)å¯ä»¥è·³è½¬è¿‡å»çœ‹çœ‹ã€‚ä¸¤å‘¨æ—¶é—´è¿‡å»äº†ï¼Œswitch è¡¨è¾¾å¼ç»ˆäºâ€œåª³å¦‡ç†¬æˆå©†â€ï¼Œè½¬æ­£äº†ï¼Œæ­å–œæ­å–œã€‚

è®°å¾—è¿™ç¯‡æ–‡ç« å‘è¡¨åˆ°æ˜é‡‘çš„æ—¶å€™ï¼Œè¢«å–·å­å„ç§æ— è„‘ dissï¼Œè¯´ï¼šâ€œè¿˜ä»¥ä¸ºä½ æœ‰ä»€ä¹ˆæŠ€å·§ï¼Œæ²¡æƒ³åˆ°ç”¨çš„æ˜¯ Java 13ï¼Œå¯æˆ‘ä»¬è¿˜åœç•™åœ¨ Java 8 å•Šï¼â€è¿™æ˜¾ç„¶æ˜¯ä¸€ç§å›ºæ­¥è‡ªå°çš„å¿ƒæ€ï¼Œéå¸¸ä¸å¯å–ï¼Œç¨‹åºå‘˜ä¸åº”è¯¥è¿™æ ·ã€‚ä¸€ä¸ªæœ€ç®€å•çš„é“ç†å°±æ˜¯ï¼ŒJava 6 å½“å¹´ä¹Ÿå¾ˆç»å…¸ï¼Œä¸æ˜¯è¢« Java 8 å–ä»£äº†å—ï¼Ÿéšç€æ—¶é—´çš„æ¨ç§»ï¼ŒJava 8 æ—©æ™šä¼šè¢«æ›´åˆ’æ—¶ä»£çš„æ–°ç‰ˆæœ¬å–ä»£â€”â€”æ€»è¦è¿›æ­¥å˜›ã€‚

å…³äº switch è¡¨è¾¾å¼ï¼Œè¿™é‡Œå°±ç®€å•åœ°æ¬ä¸ªä¾‹å­ç»™ä½ ç§ç§ï¼š

```java
public class SwitchDemo {
    enum PlayerTypes {
        TENNIS,
        FOOTBALL,
        BASKETBALL,
        PINGPANG,
        UNKNOWN
    }

    public static void main(String[] args) {
        System.out.println(createPlayer(PlayerTypes.BASKETBALL));
    }

    private static String createPlayer(PlayerTypes playerType) {
        return switch (playerType) {
            case TENNIS -> "ç½‘çƒè¿åŠ¨å‘˜è´¹å¾·å‹’";
            case FOOTBALL -> "è¶³çƒè¿åŠ¨å‘˜Cç½—";
            case BASKETBALL -> "ç¯®çƒè¿åŠ¨å‘˜è©¹å§†æ–¯";
            case PINGPANG -> "ä¹’ä¹“çƒè¿åŠ¨å‘˜é©¬é¾™";
            case UNKNOWN -> throw new IllegalArgumentException("æœªçŸ¥");
        };
    }
}
```

é™¤äº†å¯ä»¥ä½¿ç”¨ `->` çš„æ–°å¼è¯­æ³•ï¼Œè¿˜å¯ä»¥ä½œä¸º return ç»“æœï¼ŒçœŸé¦™ã€‚

### 04ã€Text Blocks

åœ¨æ–‡æœ¬å—ï¼ˆText Blocksï¼‰å‡ºç°ä¹‹å‰ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ‹¼æ¥å¤šè¡Œçš„å­—ç¬¦ä¸²ï¼Œå°±éœ€è¦å¾ˆå¤šè‹±æ–‡åŒå¼•å·å’ŒåŠ å·ï¼Œçœ‹èµ·æ¥å°±å¥½åƒè€å¤ªå©†çš„è£¹è„šå¸ƒï¼Œéå¸¸ä¸é›…ã€‚å¦‚æœæ°å¥½è¦æ‹¼æ¥ä¸€äº› HTML æ ¼å¼çš„æ–‡æœ¬ï¼ˆåŸç”Ÿ SQL ä¹Ÿæ˜¯å¦‚æ­¤ï¼‰çš„è¯ï¼Œè¿˜è¦é€šè¿‡ç©ºæ ¼è¿›è¡Œæ’ç‰ˆï¼Œé€šè¿‡æ¢è¡Œè½¬ä¹‰ç¬¦ `\n` è¿›è¡Œæ¢è¡Œï¼Œè¿™äº›ç¹ççš„å·¥ä½œå¯¹äºä¸€åå¼€å‘äººå‘˜æ¥è¯´ï¼Œç®€ç›´å°±æ˜¯ç¾éš¾ã€‚

```java
public class OldTextBlock {
    public static void main(String[] args) {
        String html = "<html>\n" +
                "    <body>\n" +
                "        <p>Hello, world</p>\n" +
                "    </body>\n" +
                "</html>\n";
        System.out.println(html);
    }
}
```

Java 14 å°±å®Œå…¨ä¸åŒäº†ï¼š

```java
public class NewTextBlock {
    public static void main(String[] args) {
        String html = """
              <html>
                  <body>
                      <p>Hello, world</p>
                  </body>
              </html>
              """;
        System.out.println(html);
    }
}
```

å¤šä½™çš„è‹±æ–‡åŒå¼•å·ã€åŠ å·ã€æ¢è¡Œè½¬ä¹‰ç¬¦ï¼Œç»Ÿç»Ÿä¸è§äº†ã€‚ä»…ä»…æ˜¯é€šè¿‡å‰åä¸‰ä¸ªè‹±æ–‡åŒå¼•å·å°±å®ç°äº†ã€‚æˆ‘åªèƒ½è¯´ï¼Œé¦™ï¼Œå®ƒçœŸçš„é¦™ï¼

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTc5Mzg5LTU3Njg1YmQzZDdmNzRkMDcuZ2lm)

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)



# ç¬¬åä¸€ç« ï¼šJava ç½‘ç»œç¼–ç¨‹


## 11.1 äº†è§£ç½‘ç»œç¼–ç¨‹çš„åŸºç¡€çŸ¥è¯†

åœ¨å­¦ä¹  Java ç½‘ç»œç¼–ç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä»€ä¹ˆæ˜¯è®¡ç®—æœºç½‘ç»œã€‚

è®¡ç®—æœºç½‘ç»œæ˜¯æŒ‡ä¸¤å°æˆ–æ›´å¤šçš„è®¡ç®—æœºç»„æˆçš„ç½‘ç»œï¼Œåœ¨åŒä¸€ä¸ªç½‘ç»œä¸­ï¼Œä»»æ„ä¸¤å°è®¡ç®—æœºéƒ½å¯ä»¥ç›´æ¥é€šä¿¡ï¼Œå› ä¸ºæ‰€æœ‰è®¡ç®—æœºéƒ½éœ€è¦éµå¾ªåŒä¸€ç§ç½‘ç»œåè®®ã€‚

ä¸‹é¢æ˜¯ä¸€å¼ ç®€åŒ–çš„ç½‘ç»œæ‹“æ‰‘å›¾ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/network-base-20230330181204.png)

- ç”¨æˆ·è®¾å¤‡ï¼šLaptopï¼Œç”¨äºè®¿é—®ç½‘ç»œèµ„æºã€‚
- ç½‘ç»œäº¤æ¢æœºï¼šSwitchï¼Œç”¨äºè¿æ¥å±€åŸŸç½‘å†…çš„è®¾å¤‡ï¼Œä¾‹å¦‚ Laptop å’Œ Routerã€‚
- è·¯ç”±å™¨ï¼šRouterï¼Œç”¨äºè¿æ¥ä¸åŒç½‘ç»œï¼Œå°†å±€åŸŸç½‘ä¸äº’è”ç½‘ç›¸è¿ã€‚
- é˜²ç«å¢™ï¼šFirewallï¼Œç”¨äºä¿æŠ¤ç½‘ç»œå†…éƒ¨èµ„æºï¼Œé˜»æ­¢æœªç»æˆæƒçš„è®¿é—®ã€‚
- äº’è”ç½‘ï¼šInternetï¼Œæä¾›è¿æ¥åˆ°å…¶ä»–ç½‘ç»œå’Œå…¨çƒä¿¡æ¯èµ„æºã€‚
- æœåŠ¡å™¨ï¼šServerï¼Œç”¨äºæ‰˜ç®¡ç½‘ç»œåº”ç”¨ç¨‹åºå’Œæ•°æ®ã€‚

é‚£ä»€ä¹ˆæ˜¯äº’è”ç½‘å‘¢ï¼Ÿäº’è”ç½‘æ˜¯ç½‘ç»œçš„ç½‘ç»œï¼ˆInternetï¼‰ï¼Œå³æŠŠå¾ˆå¤šè®¡ç®—æœºç½‘ç»œè¿æ¥èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªå…¨çƒç»Ÿä¸€çš„äº’è”ç½‘ã€‚

å¯¹æŸä¸ªç‰¹å®šçš„è®¡ç®—æœºç½‘ç»œæ¥è¯´ï¼Œå®ƒå¯èƒ½ä½¿ç”¨ç½‘ç»œåè®® ABCï¼Œè€Œå¦ä¸€ä¸ªè®¡ç®—æœºç½‘ç»œå¯èƒ½ä½¿ç”¨ç½‘ç»œåè®® XYZã€‚å¦‚æœè®¡ç®—æœºç½‘ç»œå„è‡ªçš„é€šè®¯åè®®ä¸ç»Ÿä¸€ï¼Œå°±æ²¡æ³•æŠŠä¸åŒçš„ç½‘ç»œè¿æ¥èµ·æ¥å½¢æˆäº’è”ç½‘ã€‚å› æ­¤ï¼Œä¸ºäº†æŠŠè®¡ç®—æœºç½‘ç»œæ¥å…¥äº’è”ç½‘ï¼Œå°±å¿…é¡»ä½¿ç”¨ TCP/IP åè®®ã€‚

TCP/IP åè®®æ³›æŒ‡äº’è”ç½‘åè®®ï¼Œå…¶ä¸­æœ€é‡è¦çš„ä¸¤ä¸ªåè®®æ˜¯ TCP åè®®å’Œ IP åè®®ã€‚åªæœ‰ä½¿ç”¨ TCP/IP åè®®çš„è®¡ç®—æœºæ‰èƒ½å¤Ÿè”å…¥äº’è”ç½‘ï¼Œä½¿ç”¨å…¶ä»–ç½‘ç»œåè®®ï¼ˆä¾‹å¦‚ NetBIOSã€AppleTalk åè®®ç­‰ï¼‰æ˜¯æ— æ³•è”å…¥äº’è”ç½‘çš„ã€‚

### IP åœ°å€

åœ¨äº’è”ç½‘ä¸­ï¼Œä¸€ä¸ª IP åœ°å€ç”¨äºå”¯ä¸€æ ‡è¯†ä¸€ä¸ªç½‘ç»œæ¥å£ï¼ˆNetwork Interfaceï¼‰ã€‚ä¸€å°è”å…¥äº’è”ç½‘çš„è®¡ç®—æœºè‚¯å®šæœ‰ä¸€ä¸ª IP åœ°å€ï¼Œä½†ä¹Ÿå¯èƒ½æœ‰å¤šä¸ª IP åœ°å€ã€‚

IP åœ°å€åˆ†ä¸º IPv4 å’Œ IPv6 ä¸¤ç§ã€‚IPv4 é‡‡ç”¨ 32 ä½åœ°å€ï¼Œç±»ä¼¼`101.202.99.12`ï¼Œè€Œ IPv6 é‡‡ç”¨ 128 ä½åœ°å€ï¼Œç±»ä¼¼`2001:0DA8:100A:0000:0000:1020:F2F3:1428`ã€‚IPv4 åœ°å€æ€»å…±æœ‰ 232 ä¸ªï¼ˆå¤§çº¦ 42 äº¿ï¼‰ï¼Œè€Œ IPv6 åœ°å€åˆ™æ€»å…±æœ‰ 2128 ä¸ªï¼ˆå¤§çº¦ 340 ä¸‡äº¿äº¿äº¿äº¿ï¼‰ï¼ŒIPv4 çš„åœ°å€ç›®å‰å·²è€—å°½ï¼Œè€Œ IPv6 çš„åœ°å€æ˜¯æ ¹æœ¬ç”¨ä¸å®Œçš„ã€‚

IP åœ°å€åˆåˆ†ä¸ºå…¬ç½‘ IP åœ°å€å’Œå†…ç½‘ IP åœ°å€ã€‚å…¬ç½‘ IP åœ°å€å¯ä»¥ç›´æ¥è¢«è®¿é—®ï¼Œå†…ç½‘ IP åœ°å€åªèƒ½åœ¨å†…ç½‘è®¿é—®ã€‚å†…ç½‘ IP åœ°å€ç±»ä¼¼äºï¼š

- 192.168.x.x
- 10.x.x.x

æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ IP åœ°å€ï¼Œç§°ä¹‹ä¸ºæœ¬æœºåœ°å€ï¼Œå®ƒæ€»æ˜¯`127.0.0.1`ã€‚

IPv4 åœ°å€å®é™…ä¸Šæ˜¯ä¸€ä¸ª 32 ä½æ•´æ•°ã€‚ä¾‹å¦‚ï¼š

```ascii
1707762444 = 0x65ca630c
           = 65  ca  63 0c
           = 101.202.99.12
```

å¦‚æœä¸€å°è®¡ç®—æœºåªæœ‰ä¸€ä¸ªç½‘å¡ï¼Œå¹¶ä¸”æ¥å…¥äº†ç½‘ç»œï¼Œé‚£ä¹ˆï¼Œå®ƒæœ‰ä¸€ä¸ªæœ¬æœºåœ°å€`127.0.0.1`ï¼Œè¿˜æœ‰ä¸€ä¸ª IP åœ°å€ï¼Œä¾‹å¦‚`101.202.99.12`ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ª IP åœ°å€æ¥å…¥ç½‘ç»œã€‚

å¦‚æœä¸€å°è®¡ç®—æœºæœ‰ä¸¤å—ç½‘å¡ï¼Œé‚£ä¹ˆé™¤äº†æœ¬æœºåœ°å€ï¼Œå®ƒå¯ä»¥æœ‰ä¸¤ä¸ª IP åœ°å€ï¼Œå¯ä»¥åˆ†åˆ«æ¥å…¥ä¸¤ä¸ªç½‘ç»œã€‚é€šå¸¸è¿æ¥ä¸¤ä¸ªç½‘ç»œçš„è®¾å¤‡æ˜¯è·¯ç”±å™¨æˆ–è€…äº¤æ¢æœºï¼Œå®ƒè‡³å°‘æœ‰ä¸¤ä¸ª IP åœ°å€ï¼Œåˆ†åˆ«æ¥å…¥ä¸åŒçš„ç½‘ç»œï¼Œè®©ç½‘ç»œä¹‹é—´è¿æ¥èµ·æ¥ã€‚

å¦‚æœä¸¤å°è®¡ç®—æœºä½äºåŒä¸€ä¸ªç½‘ç»œï¼Œé‚£ä¹ˆä»–ä»¬ä¹‹é—´å¯ä»¥ç›´æ¥é€šä¿¡ï¼Œå› ä¸ºä»–ä»¬çš„ IP åœ°å€å‰æ®µæ˜¯ç›¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯ç½‘ç»œå·æ˜¯ç›¸åŒçš„ã€‚ç½‘ç»œå·æ˜¯ IP åœ°å€é€šè¿‡å­ç½‘æ©ç è¿‡æ»¤åå¾—åˆ°çš„ã€‚ä¾‹å¦‚ï¼š

æŸå°è®¡ç®—æœºçš„ IP æ˜¯`101.202.99.2`ï¼Œå­ç½‘æ©ç æ˜¯`255.255.255.0`ï¼Œé‚£ä¹ˆè®¡ç®—è¯¥è®¡ç®—æœºçš„ç½‘ç»œå·æ˜¯ï¼š

```
IP = 101.202.99.2
Mask = 255.255.255.0
Network = IP & Mask = 101.202.99.0
```

æ¯å°è®¡ç®—æœºéƒ½éœ€è¦æ­£ç¡®é…ç½® IP åœ°å€å’Œå­ç½‘æ©ç ï¼Œæ ¹æ®è¿™ä¸¤ä¸ªå°±å¯ä»¥è®¡ç®—ç½‘ç»œå·ï¼Œå¦‚æœä¸¤å°è®¡ç®—æœºè®¡ç®—å‡ºçš„ç½‘ç»œå·ç›¸åŒï¼Œè¯´æ˜ä¸¤å°è®¡ç®—æœºåœ¨åŒä¸€ä¸ªç½‘ç»œï¼Œå¯ä»¥ç›´æ¥é€šä¿¡ã€‚å¦‚æœä¸¤å°è®¡ç®—æœºè®¡ç®—å‡ºçš„ç½‘ç»œå·ä¸åŒï¼Œé‚£ä¹ˆä¸¤å°è®¡ç®—æœºä¸åœ¨åŒä¸€ä¸ªç½‘ç»œï¼Œä¸èƒ½ç›´æ¥é€šä¿¡ï¼Œå®ƒä»¬ä¹‹é—´å¿…é¡»é€šè¿‡è·¯ç”±å™¨æˆ–è€…äº¤æ¢æœºè¿™æ ·çš„ç½‘ç»œè®¾å¤‡é—´æ¥é€šä¿¡ï¼Œæˆ‘ä»¬æŠŠè¿™ç§è®¾å¤‡ç§°ä¸ºç½‘å…³ã€‚

ç½‘å…³çš„ä½œç”¨å°±æ˜¯è¿æ¥å¤šä¸ªç½‘ç»œï¼Œè´Ÿè´£æŠŠæ¥è‡ªä¸€ä¸ªç½‘ç»œçš„æ•°æ®åŒ…å‘åˆ°å¦ä¸€ä¸ªç½‘ç»œï¼Œè¿™ä¸ªè¿‡ç¨‹å«è·¯ç”±ã€‚

æ‰€ä»¥ï¼Œä¸€å°è®¡ç®—æœºçš„ä¸€ä¸ªç½‘å¡ä¼šæœ‰ 3 ä¸ªå…³é”®é…ç½®ï¼š

- IP åœ°å€ï¼Œä¾‹å¦‚ï¼š`10.0.2.15`
- å­ç½‘æ©ç ï¼Œä¾‹å¦‚ï¼š`255.255.255.0`
- ç½‘å…³çš„ IP åœ°å€ï¼Œä¾‹å¦‚ï¼š`10.0.2.2`

### åŸŸå

å› ä¸ºç›´æ¥è®°å¿† IP åœ°å€éå¸¸å›°éš¾ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸ä½¿ç”¨åŸŸåè®¿é—®æŸä¸ªç‰¹å®šçš„æœåŠ¡ã€‚åŸŸåè§£ææœåŠ¡å™¨ DNS è´Ÿè´£æŠŠåŸŸåç¿»è¯‘æˆå¯¹åº”çš„ IPï¼Œå®¢æˆ·ç«¯å†æ ¹æ® IP åœ°å€è®¿é—®æœåŠ¡å™¨ã€‚

ç”¨`nslookup`å¯ä»¥æŸ¥çœ‹åŸŸåå¯¹åº”çš„ IP åœ°å€ï¼š

```
$ nslookup www.tobebetterjavaer.com
Server:  xxx.xxx.xxx.xxx
Address: xxx.xxx.xxx.xxx#53

Non-authoritative answer:
Name:    www.tobebetterjavaer.com
Address: 47.98.33.223
```

æœ‰ä¸€ä¸ªç‰¹æ®Šçš„æœ¬æœºåŸŸå`localhost`ï¼Œå®ƒå¯¹åº”çš„ IP åœ°å€æ€»æ˜¯æœ¬æœºåœ°å€`127.0.0.1`ã€‚

### ç½‘ç»œæ¨¡å‹

ç”±äºè®¡ç®—æœºç½‘ç»œä»åº•å±‚çš„ä¼ è¾“åˆ°é«˜å±‚çš„è½¯ä»¶è®¾è®¡ååˆ†å¤æ‚ï¼Œè¦åˆç†åœ°è®¾è®¡è®¡ç®—æœºç½‘ç»œæ¨¡å‹ï¼Œå¿…é¡»é‡‡ç”¨åˆ†å±‚æ¨¡å‹ï¼Œæ¯ä¸€å±‚è´Ÿè´£å¤„ç†è‡ªå·±çš„æ“ä½œã€‚OSIï¼ˆOpen System Interconnectï¼‰ç½‘ç»œæ¨¡å‹æ˜¯ ISO ç»„ç»‡å®šä¹‰çš„ä¸€ä¸ªè®¡ç®—æœºäº’è”çš„æ ‡å‡†æ¨¡å‹ï¼Œæ³¨æ„å®ƒåªæ˜¯ä¸€ä¸ªå®šä¹‰ï¼Œç›®çš„æ˜¯ä¸ºäº†ç®€åŒ–ç½‘ç»œå„å±‚çš„æ“ä½œï¼Œæä¾›æ ‡å‡†æ¥å£ä¾¿äºå®ç°å’Œç»´æŠ¤ã€‚è¿™ä¸ªæ¨¡å‹ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡æ˜¯ï¼š

- åº”ç”¨å±‚ï¼Œæä¾›åº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡ï¼›
- è¡¨ç¤ºå±‚ï¼šå¤„ç†æ•°æ®æ ¼å¼ï¼ŒåŠ è§£å¯†ç­‰ç­‰ï¼›
- ä¼šè¯å±‚ï¼šè´Ÿè´£å»ºç«‹å’Œç»´æŠ¤ä¼šè¯ï¼›
- ä¼ è¾“å±‚ï¼šè´Ÿè´£æä¾›ç«¯åˆ°ç«¯çš„å¯é ä¼ è¾“ï¼›
- ç½‘ç»œå±‚ï¼šè´Ÿè´£æ ¹æ®ç›®æ ‡åœ°å€é€‰æ‹©è·¯ç”±æ¥ä¼ è¾“æ•°æ®ï¼›
- é“¾è·¯å±‚å’Œç‰©ç†å±‚è´Ÿè´£æŠŠæ•°æ®è¿›è¡Œåˆ†ç‰‡å¹¶ä¸”çœŸæ­£é€šè¿‡ç‰©ç†ç½‘ç»œä¼ è¾“ï¼Œä¾‹å¦‚ï¼Œæ— çº¿ç½‘ã€å…‰çº¤ç­‰ã€‚

äº’è”ç½‘å®é™…ä½¿ç”¨çš„ TCP/IP æ¨¡å‹å¹¶ä¸æ˜¯å¯¹åº”åˆ° OSI çš„ 7 å±‚æ¨¡å‹ï¼Œè€Œæ˜¯å¤§è‡´å¯¹åº” OSI çš„ 5 å±‚æ¨¡å‹ï¼š

![](https://cdn.tobebetterjavaer.com/stutymore/network-base-20230330184256.png)

### å¸¸ç”¨åè®®

IP åè®®æ˜¯ä¸€ä¸ªåˆ†ç»„äº¤æ¢ï¼Œå®ƒä¸ä¿è¯å¯é ä¼ è¾“ã€‚è€Œ TCP åè®®æ˜¯ä¼ è¾“æ§åˆ¶åè®®ï¼Œå®ƒæ˜¯é¢å‘è¿æ¥çš„åè®®ï¼Œæ”¯æŒå¯é ä¼ è¾“å’ŒåŒå‘é€šä¿¡ã€‚TCP åè®®æ˜¯å»ºç«‹åœ¨ IP åè®®ä¹‹ä¸Šçš„ï¼Œç®€å•åœ°è¯´ï¼ŒIP åè®®åªè´Ÿè´£å‘æ•°æ®åŒ…ï¼Œä¸ä¿è¯é¡ºåºå’Œæ­£ç¡®æ€§ï¼Œè€Œ TCP åè®®è´Ÿè´£æ§åˆ¶æ•°æ®åŒ…ä¼ è¾“ï¼Œå®ƒåœ¨ä¼ è¾“æ•°æ®ä¹‹å‰éœ€è¦å…ˆå»ºç«‹è¿æ¥ï¼Œå»ºç«‹è¿æ¥åæ‰èƒ½ä¼ è¾“æ•°æ®ï¼Œä¼ è¾“å®Œåè¿˜éœ€è¦æ–­å¼€è¿æ¥ã€‚TCP åè®®ä¹‹æ‰€ä»¥èƒ½ä¿è¯æ•°æ®çš„å¯é ä¼ è¾“ï¼Œæ˜¯é€šè¿‡æ¥æ”¶ç¡®è®¤ã€è¶…æ—¶é‡ä¼ è¿™äº›æœºåˆ¶å®ç°çš„ã€‚å¹¶ä¸”ï¼ŒTCP åè®®å…è®¸åŒå‘é€šä¿¡ï¼Œå³é€šä¿¡åŒæ–¹å¯ä»¥åŒæ—¶å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚

TCP åè®®ä¹Ÿæ˜¯åº”ç”¨æœ€å¹¿æ³›çš„åè®®ï¼Œè®¸å¤šé«˜çº§åè®®éƒ½æ˜¯å»ºç«‹åœ¨ TCP åè®®ä¹‹ä¸Šçš„ï¼Œä¾‹å¦‚ HTTPã€SMTP ç­‰ã€‚

TCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰å’Œ IPï¼ˆäº’è”ç½‘åè®®ï¼‰é€šå¸¸ä¸€èµ·ä½¿ç”¨ï¼Œè¢«ç§°ä¸º TCP/IP åè®®ã€‚

TCP/IP åè®®æ ˆåˆ†ä¸ºå››å±‚ï¼šåº”ç”¨å±‚ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚å’Œé“¾è·¯å±‚ã€‚IP åè®®ä½äºç½‘ç»œå±‚ï¼Œè´Ÿè´£å°†æ•°æ®åŒ…ä»æºä¸»æœºè·¯ç”±åˆ°ç›®æ ‡ä¸»æœºï¼›TCP åè®®ä½äºä¼ è¾“å±‚ï¼Œè´Ÿè´£åœ¨æºä¸»æœºå’Œç›®æ ‡ä¸»æœºä¹‹é—´å»ºç«‹å¯é çš„è¿æ¥å¹¶ç¡®ä¿æ•°æ®çš„æœ‰åºä¼ è¾“ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/network-base-20230330185529.png)

UDP åè®®ï¼ˆUser Datagram Protocolï¼‰æ˜¯ä¸€ç§æ•°æ®æŠ¥æ–‡åè®®ï¼Œå®ƒæ˜¯æ— è¿æ¥åè®®ï¼Œä¸ä¿è¯å¯é ä¼ è¾“ã€‚å› ä¸º UDP åè®®åœ¨é€šä¿¡å‰ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œå› æ­¤å®ƒçš„ä¼ è¾“æ•ˆç‡æ¯” TCP é«˜ï¼Œè€Œä¸” UDP åè®®æ¯” TCP åè®®è¦ç®€å•å¾—å¤šã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/network-base-20230330190328.png)

é€‰æ‹© UDP åè®®æ—¶ï¼Œä¼ è¾“çš„æ•°æ®é€šå¸¸æ˜¯èƒ½å®¹å¿ä¸¢å¤±çš„ï¼Œä¾‹å¦‚ï¼Œä¸€äº›è¯­éŸ³è§†é¢‘é€šä¿¡çš„åº”ç”¨ä¼šé€‰æ‹© UDP åè®®ã€‚

### å°ç»“

è®¡ç®—æœºç½‘ç»œçš„åŸºæœ¬æ¦‚å¿µä¸»è¦æœ‰ï¼š

- è®¡ç®—æœºç½‘ç»œï¼šç”±ä¸¤å°æˆ–æ›´å¤šè®¡ç®—æœºç»„æˆçš„ç½‘ç»œï¼›
- äº’è”ç½‘ï¼šè¿æ¥ç½‘ç»œçš„ç½‘ç»œï¼›
- IP åœ°å€ï¼šè®¡ç®—æœºçš„ç½‘ç»œæ¥å£ï¼ˆé€šå¸¸æ˜¯ç½‘å¡ï¼‰åœ¨ç½‘ç»œä¸­çš„å”¯ä¸€æ ‡è¯†ï¼›
- ç½‘å…³ï¼šè´Ÿè´£è¿æ¥å¤šä¸ªç½‘ç»œï¼Œå¹¶åœ¨å¤šä¸ªç½‘ç»œä¹‹é—´è½¬å‘æ•°æ®çš„è®¡ç®—æœºï¼Œé€šå¸¸æ˜¯è·¯ç”±å™¨æˆ–äº¤æ¢æœºï¼›
- ç½‘ç»œåè®®ï¼šäº’è”ç½‘ä½¿ç”¨ TCP/IP åè®®ï¼Œå®ƒæ³›æŒ‡äº’è”ç½‘åè®®ç°‡ï¼›
- IP åè®®ï¼šä¸€ç§åˆ†ç»„äº¤æ¢ä¼ è¾“åè®®ï¼›
- TCP åè®®ï¼šä¸€ç§é¢å‘è¿æ¥ï¼Œå¯é ä¼ è¾“çš„åè®®ï¼›
- UDP åè®®ï¼šä¸€ç§æ— è¿æ¥ï¼Œä¸å¯é ä¼ è¾“çš„åè®®ã€‚

> å‚è€ƒé“¾æ¥ï¼š[https://www.liaoxuefeng.com/wiki/1252599548343744/1305163149082658](https://www.liaoxuefeng.com/wiki/1252599548343744/1305163149082658)ï¼Œä½œè€…ï¼šå»–é›ªå³°ï¼Œæ•´ç†ï¼šæ²‰é»˜ç‹äºŒ

---------

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 11.2 ç½‘ç»œç¼–ç¨‹çš„æ ¸å¿ƒå¥—æ¥å­—Socket

åœ¨å¤ä»£ï¼Œç”±äºé€šä¿¡ä¸ä¾¿åˆ©ï¼Œä¸€äº›èªæ˜çš„äººå°±åˆ©ç”¨é¸½å­ä¼šé£ä¸”é£å¾—æ¯”è¾ƒå¿«ã€ä¼šè¾¨è®¤æ–¹å‘çš„ä¼˜ç‚¹ï¼Œå¯¹å…¶è¿›è¡Œäº†é©¯åŒ–ï¼Œç”¨æ¥è¿›è¡Œæ¶ˆæ¯çš„ä¼ é€’â€”â€”ä¹Ÿå°±æ˜¯æ‰€è°“çš„â€œé£é¸½ä¼ ä¹¦â€ã€‚è€Œåœ¨ Java ä¸­ï¼Œç½‘ç»œå¥—æ¥å­—ï¼ˆSocketï¼‰æ‰®æ¼”äº†åŒæ ·çš„è§’è‰²ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/socket/socket-a1a012de-33e5-424a-a4cf-bd929cd60200.jpg)

å¥—æ¥å­—ï¼ˆSocketï¼‰æ˜¯ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡å®ƒå‘é€æˆ–æ¥æ”¶æ•°æ®ï¼›å°±åƒæ“ä½œæ–‡ä»¶é‚£æ ·å¯ä»¥æ‰“å¼€ã€è¯»å†™å’Œå…³é—­ã€‚å¥—æ¥å­—å…è®¸åº”ç”¨ç¨‹åºå°† I/O åº”ç”¨äºç½‘ç»œä¸­ï¼Œå¹¶ä¸å…¶ä»–åº”ç”¨ç¨‹åºè¿›è¡Œé€šä¿¡ã€‚ç½‘ç»œå¥—æ¥å­—æ˜¯ IP åœ°å€ä¸ç«¯å£çš„ç»„åˆã€‚

### 01ã€ping ä¸ telnet

â€œè€ç‹å•Šï¼Œèƒ½ä¸èƒ½å¸®æˆ‘çœ‹ä¸€ä¸‹è¿™ä¸ªé—®é¢˜å‘¢ï¼Œæ˜æ˜æœ¬åœ°å¯ä»¥è¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œå¯ç­‰æˆ‘éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šæ—¶å°±é€šä¿¡ä¸äº†äº†ï¼Œæäº†åŠå¤©ä¹Ÿä¸çŸ¥é“ä»€ä¹ˆåŸå› ï¼Œæˆ‘çœ‹ä»£ç æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚â€å°äºŒçš„è¯­æ°”ä¸­å……æ»¡äº†æ²®ä¸§ã€‚

â€œping è¿‡å—ï¼Ÿæˆ–è€… telnet äº†å—ï¼Ÿâ€è€ç‹å¤´éƒ½æ²¡å›ï¼Œå†·å†°å†°åœ°æ‰”å‡ºå»äº†è¿™å¥è¯ã€‚

â€œå“¦ï¼Œæˆ‘å»è¯•è¯•ã€‚â€å°äºŒå¿ƒå¤´æ è¿‡ä¸€ä¸æ„§ç–šã€‚

ping ä¸ telnet è¿™ä¸¤ä¸ªå‘½ä»¤ï¼Œå¯¹è°ƒè¯•ç½‘ç»œç¨‹åºæœ‰ç€éå¸¸å¤§çš„å¸®åŠ©ã€‚

pingï¼Œä¸€ç§è®¡ç®—æœºç½‘ç»œå·¥å…·ï¼Œç”¨æ¥æµ‹è¯•æ•°æ®åŒ…èƒ½å¦é€è¿‡ IP åè®®åˆ°è¾¾ç‰¹å®šä¸»æœºã€‚ping ä¼šå‘ç›®æ ‡ä¸»æœºå‘å‡ºä¸€ä¸ª ICMP çš„è¯·æ±‚å›æ˜¾æ•°æ®åŒ…ï¼Œå¹¶ç­‰å¾…æ¥æ”¶å›æ˜¾å“åº”æ•°æ®åŒ…ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬ ping ä¸€ä¸‹åšå®¢å›­ã€‚æˆªå›¾å¦‚ä¸‹ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/socket/socket-ce54bbbe-3627-4af4-9f9c-4c041a7ef2a7.jpg)


telnetï¼ŒInternet è¿œç¨‹ç™»å½•æœåŠ¡çš„æ ‡å‡†åè®®å’Œä¸»è¦æ–¹å¼ï¼Œå¯ä»¥è®©æˆ‘ä»¬ååœ¨å®¶é‡Œçš„è®¡ç®—æœºé¢å‰ï¼Œç™»å½•åˆ°å¦ä¸€å°è¿œåœ¨å¤©æ¶¯æµ·è§’çš„è¿œç¨‹è®¡ç®—æœºä¸Šã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/socket/socket-f94e1fa5-16d0-4414-9a53-a2aa43b2a512.jpg)

åœ¨ Windows ç³»ç»Ÿä¸­ï¼Œtelnet ä¸€èˆ¬æ˜¯é»˜è®¤å®‰è£…çš„ï¼Œä½†æœªæ¿€æ´»ï¼ˆå¯ä»¥åœ¨æ§åˆ¶é¢æ¿ä¸­æ¿€æ´»å®ƒï¼‰ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬ telnet ä¸€ä¸‹ç«ï¼ˆshuiï¼‰åœŸï¼ˆmuï¼‰ç¤¾åŒºã€‚æˆªå›¾å¦‚ä¸‹ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/socket/socket-9d7051d9-e7de-48a8-9b28-b482d84f56c9.jpg)

ä½¿ç”¨ telnet ç™»å½•è¿œç¨‹è®¡ç®—æœºæ—¶ï¼Œéœ€è¦è¿œç¨‹è®¡ç®—æœºä¸Šè¿è¡Œä¸€ä¸ªæœåŠ¡ï¼Œå®ƒä¸€ç›´ä¸åœåœ°ç­‰å¾…é‚£äº›å¸Œæœ›å’Œå®ƒè¿›è¡Œè¿æ¥çš„ç½‘ç»œè¯·æ±‚ï¼›å½“æ¥æ”¶åˆ°ä¸€ä¸ªå®¢æˆ·ç«¯çš„ç½‘ç»œè¿æ¥æ—¶ï¼Œå®ƒä¾¿å”¤é†’æ­£åœ¨ç›‘å¬ç½‘ç»œè¿æ¥è¯·æ±‚çš„æœåŠ¡å™¨è¿›ç¨‹ï¼Œå¹¶ä¸ºä¸¤è€…å»ºç«‹è¿æ¥ã€‚è¿æ¥ä¼šä¸€ç›´ä¿æŒï¼Œç›´åˆ°æŸä¸€æ–¹ä¸­æ­¢ã€‚

ä¸è¿‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œtelnet åœ¨æ ¼å¤–é‡è§†å®‰å…¨çš„ç°ä»£ç½‘ç»œæŠ€æœ¯ä¸­å¹¶ä¸å—åˆ°é‡ç”¨ã€‚å› ä¸º telnet æ˜¯ä¸€ä¸ªæ˜æ–‡ä¼ è¾“åè®®ï¼Œç”¨æˆ·çš„æ‰€æœ‰å†…å®¹ï¼ˆåŒ…æ‹¬ç”¨æˆ·åå’Œå¯†ç ï¼‰éƒ½æ²¡æœ‰ç»è¿‡åŠ å¯†ï¼Œå®‰å…¨éšæ‚£éå¸¸å¤§ã€‚

### 02ã€Socket å®ä¾‹

ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰ä½“éªŒä¸€ä¸‹ telnet ç«åœŸç¤¾åŒºçš„é‚£æ¡å‘½ä»¤ï¼Œç»“æœéå¸¸æœ‰è¶£ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ Java çš„å®¢æˆ·ç«¯å¥—æ¥å­—ï¼ˆSocketï¼‰å®ç°ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ã€‚

```java
try (Socket socket = new Socket("bbs.newsmth.net", 23);) {
    InputStream is = socket.getInputStream();
    Scanner scanner = new Scanner(is, "gbk");

    while (scanner.hasNextLine()) {
        String line = scanner.nextLine();
        System.out.println(line);
    }

} catch (UnknownHostException e) {
    e.printStackTrace();
} catch (IOException e) {
    e.printStackTrace();
}
```

1ï¼‰å»ºç«‹å¥—æ¥å­—è¿æ¥éå¸¸ç®€å•ï¼Œåªéœ€è¦ä¸€è¡Œä»£ç ï¼š

```java
Socket socket = new Socket(host, port)
```

host ä¸ºä¸»æœºåï¼Œport ä¸ºç«¯å£å·ï¼ˆ23 ä¸ºé»˜è®¤çš„ telnet ç«¯å£å·ï¼‰ã€‚å¦‚æœæ— æ³•ç¡®å®šä¸»æœºçš„ IP åœ°å€ï¼Œåˆ™æŠ›å‡º `UnknownHostException` å¼‚å¸¸ï¼›å¦‚æœåœ¨åˆ›å»ºå¥—æ¥å­—æ—¶å‘ç”Ÿ IO é”™è¯¯ï¼Œåˆ™æŠ›å‡º `IOException` å¼‚å¸¸ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¥—æ¥å­—åœ¨å»ºç«‹çš„æ—¶å€™ï¼Œå¦‚æœè¿œç¨‹ä¸»æœºä¸å¯è®¿é—®ï¼Œè¿™æ®µä»£ç å°±ä¼šé˜»å¡å¾ˆé•¿æ—¶é—´ï¼Œç›´åˆ°åº•å±‚æ“ä½œç³»ç»Ÿçš„é™åˆ¶è€ŒæŠ›å‡ºå¼‚å¸¸ã€‚æ‰€ä»¥ä¸€èˆ¬ä¼šåœ¨å¥—æ¥å­—å»ºç«‹åè®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ã€‚

```java
Socket socket = new Socket(...);
socket.setSoTimeout(10000); // å•ä½ä¸ºæ¯«ç§’
```

2ï¼‰å¥—æ¥å­—è¿æ¥æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡ `java.net.Socket` ç±»çš„ `getInputStream()` æ–¹æ³•è·å–è¾“å…¥æµã€‚æœ‰äº† `InputStream` å¯¹è±¡åï¼Œå¯ä»¥å€ŸåŠ©æ–‡æœ¬æ‰«æå™¨ç±»ï¼ˆScannerï¼‰å°†å…¶ä¸­çš„å†…å®¹æ‰“å°å‡ºæ¥ã€‚

```java
InputStream is = socket.getInputStream();
Scanner scanner = new Scanner(is, "gbk");

while (scanner.hasNextLine()) {
    String line = scanner.nextLine();
    System.out.println(line);
}
```

éƒ¨åˆ†ç»“æœï¼ˆå®Œæ•´ç»“æœè‡ªå·±äº²æ‰‹å®è·µä¸€ä¸‹å“¦ï¼‰å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/socket/socket-6b60e4b2-14d0-4d95-bb5c-146bc6a06147.jpg)


### 03ã€ServerSocket å®ä¾‹

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸ªè¿œç¨‹æœåŠ¡ï¼Œé€šè¿‡ `java.net.ServerSocket` å®ç°ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ã€‚

```java
try (ServerSocket server = new ServerSocket(8888);
        Socket socket = server.accept();
        InputStream is = socket.getInputStream();
        OutputStream os = socket.getOutputStream();

        Scanner scanner = new Scanner(is)) {
    PrintWriter pw = new PrintWriter(new OutputStreamWriter(os, "gbk"), true);
    pw.println("ä½ å¥½å•Šï¼Œæ¬¢è¿å…³æ³¨ã€Œæ²‰é»˜ç‹äºŒã€ å…¬ä¼—å·ï¼Œå›å¤å…³é”®å­—ã€Œ2048ã€ é¢†å–ç¨‹åºå‘˜è¿›é˜¶å¿…è¯»èµ„æ–™åŒ…");

    boolean done = false;
    while (!done && scanner.hasNextLine()) {
        String line = scanner.nextLine();
        System.out.println(line);

        if ("2048".equals(line)) {
            done = true;
        }
    }
} catch (UnknownHostException e) {
    e.printStackTrace();
} catch (IOException e) {
    e.printStackTrace();
}
```

1ï¼‰å»ºç«‹æœåŠ¡å™¨ç«¯çš„å¥—æ¥å­—ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦æŒ‡å®šä¸€ä¸ªèƒ½å¤Ÿç‹¬å çš„ç«¯å£å·å°±å¯ä»¥äº†ï¼ˆ0~1023 è¿™äº›ç«¯å£éƒ½å·²ç»è¢«ç³»ç»Ÿé¢„ç•™äº†ï¼‰ã€‚

```java
ServerSocket server = new ServerSocket(8888);
```

2ï¼‰è°ƒç”¨ ServerSocket å¯¹è±¡çš„ `accept()` ç­‰å¾…å®¢æˆ·ç«¯å¥—æ¥å­—çš„è¿æ¥è¯·æ±‚ã€‚ä¸€æ—¦ç›‘å¬åˆ°å®¢æˆ·ç«¯çš„å¥—æ¥å­—è¯·æ±‚ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªè¡¨ç¤ºè¿æ¥å·²å»ºç«‹çš„ Socket å¯¹è±¡ï¼Œå¯ä»¥ä»ä¸­è·å–åˆ°è¾“å…¥æµå’Œè¾“å‡ºæµã€‚

```java
Socket socket = server.accept();
InputStream is = socket.getInputStream();
OutputStream os = socket.getOutputStream();
```

å®¢æˆ·ç«¯å¥—æ¥å­—å‘é€çš„æ‰€æœ‰ä¿¡æ¯éƒ½ä¼šåŒ…è£¹åœ¨æœåŠ¡å™¨ç«¯å¥—æ¥å­—çš„è¾“å…¥æµä¸­ï¼›è€ŒæœåŠ¡å™¨ç«¯å¥—æ¥å­—å‘é€çš„æ‰€æœ‰ä¿¡æ¯éƒ½ä¼šåŒ…è£¹åœ¨å®¢æˆ·ç«¯å¥—æ¥å­—çš„è¾“å‡ºæµä¸­ã€‚

3ï¼‰æœåŠ¡å™¨ç«¯å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ã€‚

```java
PrintWriter pw = new PrintWriter(new OutputStreamWriter(os, "gbk"), true);
pw.println("ä½ å¥½å•Šï¼Œæ¬¢è¿å…³æ³¨ã€Œæ²‰é»˜ç‹äºŒã€ å…¬ä¼—å·ï¼Œå›å¤å…³é”®å­—ã€Œ2048ã€ é¢†å–ç¨‹åºå‘˜è¿›é˜¶å¿…è¯»èµ„æ–™åŒ…");
```

4ï¼‰æœåŠ¡å™¨ç«¯å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç è¯»å–å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ¶ˆæ¯ã€‚

```java
Scanner scanner = new Scanner(is);
boolean done = false;
while (!done && scanner.hasNextLine()) {
    String line = scanner.nextLine();
    System.out.println(line);

    if ("2048".equals(line)) {
        done = true;
    }
}
```


è¿è¡Œè¯¥æœåŠ¡åï¼Œå¯ä»¥é€šè¿‡ `telnet localhost 8888` å‘½ä»¤è¿æ¥è¯¥è¿œç¨‹æœåŠ¡ï¼Œä¸å‡ºæ‰€æ–™ï¼Œä½ å°†ä¼šçœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/socket/socket-fac025fa-8cbf-448d-8a6d-cd8993ba87f4.jpg)

PSï¼šå¯ä»¥åœ¨å½“å‰å‘½ä»¤çª—å£ä¸­è¾“å…¥ 2048ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°è¯¥æ¶ˆæ¯åä¼šä¸­æ–­è¯¥å¥—æ¥å­—è¿æ¥ï¼ˆå½“å‰çª—å£ä¼šæ˜¾ç¤ºâ€œé—å¤±å¯¹ä¸»æœºçš„è¿æ¥â€ï¼‰ã€‚

### 04ã€ä¸ºå¤šä¸ªå®¢æˆ·ç«¯æœåŠ¡

éå¸¸é—æ†¾çš„æ˜¯ï¼Œä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨ç«¯åªèƒ½ä¸ºä¸€ä¸ªå®¢æˆ·ç«¯æœåŠ¡â€”â€”è¿™ä¸ç¬¦åˆæœåŠ¡å™¨ç«¯ä¸€å¯¹å¤šçš„è¦æ±‚ã€‚

ä¼˜åŒ–æ–¹æ¡ˆä¹Ÿéå¸¸ç®€å•ï¼ˆä½ åº”è¯¥ä¹Ÿèƒ½æƒ³å¾—åˆ°ï¼‰ï¼šæœåŠ¡å™¨ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„å¥—æ¥å­—è¯·æ±‚æ—¶ï¼Œå¯ä»¥å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ï¼Œè€Œä¸»ç¨‹åºç»§ç»­ç­‰å¾…ä¸‹ä¸€ä¸ªè¿æ¥ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ã€‚

```java
try (ServerSocket server = new ServerSocket(8888)) {

    while (true) {
        Socket socket = server.accept();
        Thread thread = new Thread(new Runnable() {

            @Override
            public void run() {
              // å¥—æ¥å­—å¤„ç†ç¨‹åº
            }
        });
        thread.start();

    }
} catch (IOException e) {
    e.printStackTrace();
}
```

çº¿ç¨‹å†…éƒ¨ï¼ˆ`run(){}` æ–¹æ³•é‡Œï¼‰ç”¨æ¥å¤„ç†å¥—æ¥å­—ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
try {
    InputStream is = socket.getInputStream();
    OutputStream os = socket.getOutputStream();
    Scanner scanner = new Scanner(is);

   // å…¶ä»–ä»£ç çœç•¥
   // å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯
   // è¯»å–å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ¶ˆæ¯
} catch (IOException e) {
    e.printStackTrace();
} finally {
    try {
        socket.close();
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

æœåŠ¡å™¨ç«¯ä»£ç ä¼˜åŒ–åé‡æ–°è¿è¡Œï¼Œä½ å°±å¯ä»¥é€šè¿‡ telnet å‘½ä»¤æµ‹è¯•äº†ã€‚æ‰“å¼€ä¸€ä¸ªå‘½ä»¤è¡Œçª—å£è¾“å…¥ `telnet localhost 8888`ï¼Œå†æ‰“å¼€ä¸€ä¸ªæ–°çš„å‘½ä»¤è¡Œçª—å£è¾“å…¥ `telnet localhost 8888`ï¼Œå¤šä¸ªçª—å£éƒ½å¯ä»¥å’ŒæœåŠ¡å™¨ç«¯è¿›è¡Œé€šä¿¡ï¼Œé™¤éæœåŠ¡å™¨ç«¯ä»£ç ä¸­æ–­è¿è¡Œã€‚

### 05ã€åŠ å…¥å¤šçº¿ç¨‹

[å¤šçº¿ç¨‹](https://tobebetterjavaer.com/thread/wangzhe-thread.html)æˆ‘ä»¬åé¢ä¼šè¯¦ç»†è®²ï¼Œè¿™é‡Œå°±ä¸»è¦æ˜¯å†™ä¸ªä¾‹å­ï¼Œå¥½è®©å¤§å®¶æ„Ÿè§‰æ›´æœ‰è¶£ä¸€äº›ï¼Œå…¶å®ä¹Ÿéå¸¸ç®€å•ã€‚

æ¥çœ‹æœåŠ¡ç«¯ï¼š

```java
import java.io.*;
import java.net.ServerSocket;
import java.net.Socket;

public class MultiThreadedServer {
    public static void main(String[] args) throws IOException {
        int port = 12345;
        ServerSocket serverSocket = new ServerSocket(port);
        System.out.println("Server is listening on port " + port);

        while (true) {
            Socket socket = serverSocket.accept();
            System.out.println("Client connected");
            new ClientHandler(socket).start();
        }
    }
}
class ClientHandler extends Thread {
    private Socket socket;

    public ClientHandler(Socket socket) {
        this.socket = socket;
    }

    public void run() {
        try {
            InputStream input = socket.getInputStream();
            BufferedReader reader = new BufferedReader(new InputStreamReader(input));

            OutputStream output = socket.getOutputStream();
            PrintWriter writer = new PrintWriter(output, true);

            String line;
            while ((line = reader.readLine()) != null) {
                System.out.println("Received: " + line);
                writer.println("Server: " + line);
            }

            socket.close();
        } catch (IOException e) {
            System.out.println("Client disconnected");
        }
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ª ClientHandler ç±»ï¼Œè¯¥ç±»ç»§æ‰¿è‡ª Thread ç±»ã€‚è¿™ä½¿å¾—æ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥éƒ½å¯ä»¥åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­å¤„ç†ï¼Œä»è€Œå…è®¸æœåŠ¡å™¨åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥ã€‚å½“ä¸€ä¸ªæ–°å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ ClientHandler å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ `start()` æ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚ClientHandler ç±»çš„ `run()` æ–¹æ³•åŒ…å«å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚çš„é€»è¾‘ã€‚

æ¥çœ‹å®¢æˆ·ç«¯ä»£ç ï¼š

```java
import java.io.*;
import java.net.Socket;

public class Client {
    public static void main(String[] args) throws IOException {
        String hostname = "localhost";
        int port = 12345;

        Socket socket = new Socket(hostname, port);
        System.out.println("Connected to the server");

        InputStream input = socket.getInputStream();
        BufferedReader reader = new BufferedReader(new InputStreamReader(input));

        OutputStream output = socket.getOutputStream();
        PrintWriter writer = new PrintWriter(output, true);

        writer.println("Hello, server!");
        String response = reader.readLine();
        System.out.println("Server response: " + response);

        socket.close();
    }
}
```

å¯åŠ¨æœåŠ¡å™¨ç«¯ï¼Œç„¶åå¤šå¯åŠ¨å‡ ä¸ªå®¢æˆ·ç«¯ï¼Œå°±å¯ä»¥ä½“éªŒåˆ°äº¤äº’çš„ä¹è¶£äº†ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/socket-20230330192826.png)

### 08ã€DatagramSocket å®ä¾‹

DatagramSocket ç±»æ˜¯ Java ä¸­å®ç° UDP åè®®çš„æ ¸å¿ƒç±»ã€‚ä¸åŸºäº TCP çš„ Socket å’Œ ServerSocket ç±»ä¸åŒï¼ŒDatagramSocket ç±»æä¾›äº†æ— è¿æ¥çš„é€šä¿¡æœåŠ¡ï¼Œå‘é€å’Œæ¥æ”¶æ•°æ®åŒ…ã€‚ç”±äºæ— éœ€å»ºç«‹è¿æ¥ï¼ŒUDP é€šå¸¸æ¯” TCP æ›´å¿«ï¼Œä½†å¯èƒ½ä¸å¦‚ TCP å¯é ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ DatagramSocket ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ UDP åè®®åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚

æœåŠ¡å™¨ç«¯ä»£ç ï¼š

```java
import java.io.IOException;
import java.net.DatagramPacket;
import java.net.DatagramSocket;

public class UDPServer {
    public static void main(String[] args) throws IOException {
        int port = 12345;
        DatagramSocket serverSocket = new DatagramSocket(port);
        System.out.println("Server is listening on port " + port);

        byte[] buffer = new byte[1024];
        DatagramPacket packet = new DatagramPacket(buffer, buffer.length);

        serverSocket.receive(packet);
        String message = new String(packet.getData(), 0, packet.getLength());
        System.out.println("Received: " + message);

        serverSocket.close();
    }
}
```

å®¢æˆ·ç«¯ä»£ç ï¼š

```java
import java.io.IOException;
import java.net.*;

public class UDPClient {
    public static void main(String[] args) throws IOException {
        String hostname = "localhost";
        int port = 12345;

        InetAddress address = InetAddress.getByName(hostname);
        DatagramSocket clientSocket = new DatagramSocket();

        String message = "Hello, server!";
        byte[] buffer = message.getBytes();

        DatagramPacket packet = new DatagramPacket(buffer, buffer.length, address, port);
        clientSocket.send(packet);
        System.out.println("Message sent");

        clientSocket.close();
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒæœåŠ¡å™¨ç«¯åˆ›å»ºä¸€ä¸ª DatagramSocket å¯¹è±¡å¹¶ç›‘å¬ç«¯å£ 12345ã€‚ç„¶åï¼Œå®ƒåˆ›å»ºä¸€ä¸ª DatagramPacket å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨æ¥æ”¶åˆ°çš„æ•°æ®åŒ…ã€‚`serverSocket.receive(packet)` æ–¹æ³•é˜»å¡ï¼Œç›´åˆ°æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…ã€‚æ”¶åˆ°æ•°æ®åŒ…åï¼ŒæœåŠ¡å™¨ä»æ•°æ®åŒ…ä¸­æå–å¹¶æ‰“å°æ¶ˆæ¯ã€‚

å®¢æˆ·ç«¯é¦–å…ˆè§£ææœåŠ¡å™¨çš„ IP åœ°å€ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª DatagramSocket å¯¹è±¡ã€‚æ¥ç€ï¼Œå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªåŒ…å«è¦å‘é€æ¶ˆæ¯çš„ DatagramPacket å¯¹è±¡ï¼Œå¹¶æŒ‡å®šç›®æ ‡åœ°å€å’Œç«¯å£ã€‚æœ€åï¼Œå®¢æˆ·ç«¯é€šè¿‡è°ƒç”¨ `clientSocket.send(packet)` æ–¹æ³•å‘é€æ•°æ®åŒ…ã€‚

è¿è¡Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

![](https://cdn.tobebetterjavaer.com/stutymore/socket-20230330193654.png)

### 07ã€æœ€å

å¦‚ä»Šå¤§å¤šæ•°åŸºäºç½‘ç»œçš„è½¯ä»¶ï¼Œå¦‚æµè§ˆå™¨ã€å³æ—¶é€šè®¯å·¥å…·ç”šè‡³æ˜¯ P2P ä¸‹è½½éƒ½æ˜¯åŸºäº Socket å®ç°çš„ï¼Œæ‰€ä»¥æŒæ¡ Java Socket ç¼–ç¨‹è¿˜æ˜¯è›®æœ‰å¿…è¦çš„ã€‚Socket ç¼–ç¨‹ä¹Ÿæ¯”è¾ƒæœ‰è¶£ï¼Œå¾ˆå¤šåˆå­¦è€…éƒ½ä¼šç¼–å†™ä¸€ä¸¤ä¸ªåŸºäºâ€œå®¢æˆ·ç«¯-æœåŠ¡å™¨ç«¯â€çš„å°ç¨‹åºæ¥æé«˜è‡ªå·±çš„ç¼–ç¨‹æ°´å¹³ï¼Œå»ºè®®ä½ ä¹Ÿè¯•ä¸€è¯•ã€‚

---------

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 11.3 ç”¨Socketå®ç°ä¸€ä¸ªHTTPæœåŠ¡å™¨

ä½œä¸ºä¸€ä¸ª Java åç«¯ï¼Œæä¾› HTTP æœåŠ¡å¯ä»¥è¯´æ˜¯åŸºæœ¬æŠ€èƒ½ä¹‹ä¸€äº†ï¼Œä½†æ˜¯ä½ çœŸçš„äº†è§£ HTTP åè®®ä¹ˆï¼Ÿä½ çŸ¥é“çŸ¥é“å¦‚ä½•æ‰‹æ’¸ä¸€ä¸ª HTTP æœåŠ¡å™¨ä¹ˆï¼ŸTomcat çš„åº•å±‚æ˜¯æ€ä¹ˆæ”¯æŒ HTTP æœåŠ¡çš„å‘¢ï¼Ÿå¤§åé¼é¼çš„ Servlet åˆæ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Œè¯¥æ€ä¹ˆä½¿ç”¨å‘¢ï¼Ÿ

åœ¨åˆå­¦ Java æ—¶ï¼ŒSocket ç¼–ç¨‹æ˜¯é€ƒä¸æ‰çš„ä¸€ç« ï¼›è™½ç„¶åœ¨å®é™…ä¸šåŠ¡é¡¹ç›®ä¸­ï¼Œä½¿ç”¨è¿™ä¸ªçš„å¯èƒ½æ€§åŸºæœ¬ä¸º 0ï¼Œ ä½†å¹¶ä¸æ„å‘³ç€ä¸ç”¨å­¦ã€‚æœ¬ç¯‡å°†ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨ Socket æ¥å®ç°ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œæä¾›å¸¸è§çš„ get/post è¯·æ±‚æ”¯æŒï¼Œå¹¶åœ¨æ­¤è¿‡ç¨‹ä¸­äº†è§£ä¸‹ HTTP åè®®ã€‚

### I. HTTP æœåŠ¡å™¨ä» 0 åˆ° 1

æ—¢ç„¶æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å€ŸåŠ© Socket æ¥æ­å»º HTTP æœåŠ¡å™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆéœ€è¦ç¡®è®¤ä¸¤ç‚¹ï¼Œä¸€æ˜¯å¦‚ä½•ä½¿ç”¨ Socketï¼›å¦ä¸€ä¸ªåˆ™æ˜¯ HTTP åè®®å¦‚ä½•è§£ææ•°æ®ï¼›ä¸‹é¢åˆ†åˆ«è¿›è¡Œè¯´æ˜ã€‚

#### 1\. Socket ç¼–ç¨‹åŸºç¡€

æˆ‘ä»¬è¿™é‡Œä¸»è¦æ˜¯åˆ©ç”¨ [ServerSocket](https://tobebetterjavaer.com/socket/socket.html) æ¥ç»‘å®šç«¯å£ï¼Œæä¾› TCP æœåŠ¡ï¼ŒåŸºæœ¬ä½¿ç”¨å§¿åŠ¿ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä¸€èˆ¬å¥—è·¯å¦‚ä¸‹

- åˆ›å»º ServerSocket å¯¹è±¡ï¼Œç»‘å®šç›‘å¬ç«¯å£
- é€šè¿‡ `accept()` æ–¹æ³•ç›‘å¬å®¢æˆ·ç«¯è¯·æ±‚
- è¿æ¥å»ºç«‹åï¼Œé€šè¿‡è¾“å…¥æµè¯»å–å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ä¿¡æ¯
- é€šè¿‡è¾“å‡ºæµå‘å®¢æˆ·ç«¯å‘é€å“åº”ä¿¡æ¯
- å…³é—­ç›¸å…³èµ„æº

å¯¹åº”çš„ä¼ªä»£ç å¦‚ä¸‹:

```java
ServerSocket serverSocket = new ServerSocket(port, ip)
serverSocket.accept();
// æ¥æ”¶è¯·æ±‚æ•°æ®
socket.getInputStream();

// è¿”å›æ•°æ®ç»™è¯·æ±‚æ–¹
out = socket.getOutputStream()
out.print(xxx)
out.flush();;

// å…³é—­è¿æ¥
socket.close()
```

å…·ä½“çš„ä»£ç ï¼Œæˆ‘ä»¬å‰é¢çš„ç« èŠ‚è¯¦ç»†åœ°è®²è¿‡äº†ï¼Œç¬¬ä¸€æ¬¡æ¥çš„å°ä¼™ä¼´å¯ä»¥[æˆ³é“¾æ¥](https://tobebetterjavaer.com/socket/socket.html)å»å­¦ä¹ ä¸€ä¸‹ã€‚

#### 2\. HTTP åè®®

ServerSocket èµ°çš„æ˜¯ [TCP åè®®](https://tobebetterjavaer.com/socket/network-base.html)ï¼ŒHTTP åè®®æœ¬èº«æ˜¯åœ¨ TCP åè®®ä¹‹ä¸Šçš„ä¸€å±‚ã€‚

TCP æ˜¯ä¸€ç§é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚åè®®ã€‚TCP åœ¨ä¸¤ä¸ªç½‘ç»œèŠ‚ç‚¹ä¹‹é—´æä¾›äº†ä¸€æ¡å¯é çš„é€šä¿¡ä¿¡é“ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸ä¼šä¸¢å¤±ã€é‡å¤æˆ–ä¹±åºã€‚TCP ä½¿ç”¨æ¡æ‰‹è¿‡ç¨‹å»ºç«‹è¿æ¥ï¼Œé€šè¿‡ç¡®è®¤å’Œé‡ä¼ æœºåˆ¶ç¡®ä¿æ•°æ®å¯é ä¼ è¾“ï¼Œå¹¶ä½¿ç”¨æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶ç®—æ³•æ¥ä¼˜åŒ–ç½‘ç»œæ€§èƒ½ã€‚

HTTP æ˜¯ä¸€ä¸ªç”¨äºåœ¨ Web æµè§ˆå™¨å’Œ Web æœåŠ¡å™¨ä¹‹é—´ä¼ è¾“è¶…æ–‡æœ¬ã€å›¾åƒã€è§†é¢‘å’Œå…¶ä»–åª’ä½“èµ„æºçš„åº”ç”¨å±‚åè®®ã€‚HTTP ä½¿ç”¨è¯·æ±‚-å“åº”æ¨¡å‹ï¼Œå³å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯ Web æµè§ˆå™¨ï¼‰å‘é€è¯·æ±‚ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›å“åº”ã€‚HTTP åè®®å®šä¹‰äº†ä¸€ç»„æ–¹æ³•ï¼ˆå¦‚ GETã€POSTã€PUTã€DELETE ç­‰ï¼‰ï¼Œç”¨äºæŒ‡å®šè¯·æ±‚çš„ç±»å‹å’Œç›®çš„ã€‚æ­¤å¤–ï¼ŒHTTP åè®®è¿˜å®šä¹‰äº†ä¸€ç»„çŠ¶æ€ä»£ç ï¼ˆå¦‚ 200ã€404ã€500 ç­‰ï¼‰ï¼Œç”¨äºè¡¨ç¤ºå“åº”çš„ç»“æœã€‚

HTTP åè®®ä¾èµ–äº TCP åè®®æ¥ä¼ è¾“æ•°æ®ã€‚å½“ Web æµè§ˆå™¨å‘ Web æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚æ—¶ï¼Œå®ƒé¦–å…ˆä½¿ç”¨ TCP åè®®ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚ä¸€æ—¦è¿æ¥å»ºç«‹ï¼ŒHTTP è¯·æ±‚æ¶ˆæ¯ä¼šè¢«å°è£…åœ¨ TCP æ•°æ®åŒ…ä¸­ï¼Œç„¶åé€šè¿‡ TCP ä¿¡é“å‘é€ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨æ”¶åˆ° TCP æ•°æ®åŒ…åï¼Œè§£åŒ…æå– HTTP è¯·æ±‚æ¶ˆæ¯ï¼Œå¤„ç†è¯·æ±‚å¹¶ç”Ÿæˆ HTTP å“åº”æ¶ˆæ¯ã€‚æœ€åï¼ŒHTTP å“åº”æ¶ˆæ¯è¢«å°è£…åœ¨ TCP æ•°æ®åŒ…ä¸­ï¼Œå¹¶é€šè¿‡ç›¸åŒçš„ TCP ä¿¡é“å‘é€å›å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ”¶åˆ° TCP æ•°æ®åŒ…åï¼Œè§£åŒ…æå– HTTP å“åº”æ¶ˆæ¯å¹¶æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/http-20230331112928.png)

è¿™å¹…å›¾å±•ç¤ºäº†å®¢æˆ·ç«¯ï¼ˆWeb æµè§ˆå™¨ï¼‰ä¸æœåŠ¡å™¨ï¼ˆWeb æœåŠ¡å™¨ï¼‰ä¹‹é—´çš„ HTTP è¯·æ±‚å’Œå“åº”ï¼Œå®ƒä»¬é€šè¿‡å¯é çš„ã€é¢å‘è¿æ¥çš„ TCP è¿æ¥è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚

å¥½ï¼Œå†è¯´å› HTTP æœåŠ¡å™¨è¿™ä»¶äº‹ï¼Œæœ€éœ€è¦å…³æ³¨çš„æ— éä¸¤ç‚¹ï¼š

- è¯·æ±‚çš„æ•°æ®æ€ä¹ˆæŒ‰ç…§ HTTP åè®®è§£æå‡ºæ¥
- å¦‚ä½•æŒ‰ç…§ HTTP åè®®ï¼Œè¿”å›æ•°æ®

æ‰€ä»¥æˆ‘ä»¬éœ€è¦çŸ¥é“æ•°æ®æ ¼å¼çš„è§„èŒƒã€‚

**è¯·æ±‚æ¶ˆæ¯**

HTTP è¯·æ±‚æ¶ˆæ¯ç”±è¯·æ±‚è¡Œï¼ˆRequest Lineï¼‰ã€è¯·æ±‚å¤´ï¼ˆRequest Headersï¼‰ã€ç©ºè¡Œï¼ˆEmpty Lineï¼‰ã€è¯·æ±‚ä½“ï¼ˆRequest Bodyï¼Œå¯é€‰ï¼‰å‡ ä¸ªéƒ¨åˆ†ç»„æˆã€‚

â‘ ã€è¯·æ±‚è¡ŒåˆåŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼ŒHTTP æ–¹æ³•ï¼ˆä¾‹å¦‚ GET, POST, PUT, DELETE ç­‰ï¼‰ã€è¯·æ±‚çš„ç›®æ ‡ URLï¼ˆé€šå¸¸æ˜¯ç›¸å¯¹ URLï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯ç»å¯¹ URLï¼‰ã€HTTP ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ HTTP/1.1 æˆ– HTTP/2ï¼‰ï¼Œè¿™äº›éƒ¨åˆ†ç”¨ç©ºæ ¼åˆ†éš”ï¼Œä¾‹å¦‚ï¼š

```
GET /index.html HTTP/1.1
```

â‘¡ã€è¯·æ±‚å¤´æ˜¯ä¸€ç³»åˆ—ä»¥é”®å€¼å¯¹è¡¨ç¤ºçš„å…ƒæ•°æ®ï¼Œç”¨äºæè¿°è¯·æ±‚çš„é™„åŠ ä¿¡æ¯ã€‚æ¯ä¸ªè¯·æ±‚å¤´å ä¸€è¡Œï¼Œé”®å’Œå€¼ä¹‹é—´ç”¨å†’å·ï¼ˆ:ï¼‰åˆ†éš”ã€‚è¯·æ±‚å¤´åŒ…å«è¯¸å¦‚ Hostã€User-Agentã€Content-Typeã€Content-Lengthã€Accept ç­‰ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š

```
Host: www.tobebetterjavaer.com
User-Agent: Mozilla/5.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
```

â‘¢ã€è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“ä¹‹é—´æœ‰ä¸€ä¸ªç©ºè¡Œï¼Œè¡¨ç¤ºè¯·æ±‚å¤´çš„ç»“æŸã€‚

â‘£ã€å¯¹äºæŸäº› HTTP æ–¹æ³•ï¼ˆä¾‹å¦‚ POSTã€PUT ç­‰ï¼‰ï¼Œè¿˜å¯ä»¥åœ¨è¯·æ±‚æ¶ˆæ¯ä¸­åŒ…å«è¯·æ±‚ä½“ã€‚è¯·æ±‚ä½“ç”¨äºä¼ è¾“è¦å‘é€ç»™æœåŠ¡å™¨çš„æ•°æ®ã€‚è¯·æ±‚ä½“çš„æ ¼å¼å’Œå†…å®¹å–å†³äº Content-Type è¯·æ±‚å¤´çš„å€¼ã€‚

ä¾‹å¦‚ï¼Œå½“æäº¤ HTML è¡¨å•æ—¶ï¼Œè¯·æ±‚ä½“å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š

```
username=æ²‰é»˜ç‹äºŒ&password=123456
```

å°†è¿™äº›éƒ¨åˆ†æ”¾åœ¨ä¸€èµ·ï¼Œå°±æ„æˆäº†ä¸€ä¸ªå®Œæ•´çš„ HTTP è¯·æ±‚æ¶ˆæ¯ï¼š

```
POST /login HTTP/1.1
Host: Host: www.tobebetterjavaer.com
User-Agent: Mozilla/5.0
Content-Type: application/x-www-form-urlencoded
Content-Length: 29
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8

username=æ²‰é»˜ç‹äºŒ&password=123456
```

æˆ‘ç”¨ä¸€å¼ æ€ç»´å¯¼å›¾æ¥è¡¨ç¤ºä¸‹ï¼š

![](https://cdn.tobebetterjavaer.com/stutymore/http-20230331114404.png)

**å“åº”æ¶ˆæ¯**

ä¸€ä¸ªå…¸å‹çš„ HTTP å“åº”æ¶ˆæ¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šçŠ¶æ€è¡Œï¼ˆStatus Lineï¼‰ã€å“åº”å¤´ï¼ˆResponse Headersï¼‰ã€å“åº”ä½“ï¼ˆResponse Bodyï¼‰ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/http-20230331120336.png)

ä¸Šé¢ä¸¤å¼ å›¾ï¼Œå¯ä»¥è®©ä½ å¯¹ HTTP è¯·æ±‚å’Œå“åº”æœ‰ä¸ªç›´è§‚æ˜ è±¡ï¼Œæ¥ä¸‹æ¥å¼€å§‹æŠ“é‡ç‚¹ã€‚

ä¸ç®¡æ˜¯è¯·æ±‚æ¶ˆæ¯è¿˜æ˜¯å“åº”æ¶ˆæ¯ï¼Œéƒ½å¯ä»¥åˆ’åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œè¿™å°±ä¸ºæˆ‘ä»¬åé¢çš„å¤„ç†ç®€åŒ–äº†å¾ˆå¤šå·¥ä½œã€‚

- ç¬¬ä¸€è¡Œï¼šçŠ¶æ€è¡Œ
- ç¬¬äºŒè¡Œåˆ°ç¬¬ä¸€ä¸ªç©ºè¡Œï¼šheaderï¼ˆè¯·æ±‚å¤´/ç›¸åº”å¤´ï¼‰
- å‰©ä¸‹æ‰€æœ‰ï¼šæ­£æ–‡

#### 3\. HTTP æœåŠ¡å™¨è®¾è®¡

æ¥ä¸‹æ¥è¿›å…¥æ­£é¢˜ï¼ŒåŸºäº Socket åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œä½¿ç”¨ Socket åŸºæœ¬æ²¡å•¥å¤ªå¤§çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦é¢å¤–å…³æ³¨ä»¥ä¸‹ä¸¤ç‚¹ï¼š

- å¯¹è¯·æ±‚æ•°æ®è¿›è¡Œè§£æ
- å°è£…è¿”å›ç»“æœ

##### a. è¯·æ±‚æ•°æ®è§£æ

æˆ‘ä»¬ä» Socket ä¸­æ‹¿åˆ°æ‰€æœ‰çš„æ•°æ®ï¼Œç„¶åè§£æä¸ºå¯¹åº”çš„ HTTP è¯·æ±‚ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸ª Request å¯¹è±¡ï¼Œå†…éƒ¨ä¿å­˜ä¸€äº›åŸºæœ¬çš„ HTTP ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥é‡ç‚¹å°±æ˜¯å°† Socket ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½æå‡ºæ¥ï¼Œå°è£…ä¸º request å¯¹è±¡ã€‚

>æ³¨æ„ğŸ“¢ï¼Œè¿™äº›ä»£ç æ”¾åœ¨ HttpMessageParser ç±»ä¸­ï¼Œéšåä¼šç»™å‡ºå®Œæ•´çš„ä»£ç ã€‚

```java
@Data
public static class Request {
    /**
     * è¯·æ±‚æ–¹æ³• GET/POST/PUT/DELETE/OPTION...
     */
    private String method;
    /**
     * è¯·æ±‚çš„uri
     */
    private String uri;
    /**
     * HTTPç‰ˆæœ¬
     */
    private String version;

    /**
     * è¯·æ±‚å¤´
     */
    private Map<String, String> headers;

    /**
     * è¯·æ±‚å‚æ•°ç›¸å…³
     */
    private String message;
}
```

æ ¹æ®å‰é¢çš„ HTTP åè®®ä»‹ç»ï¼Œè§£æè¿‡ç¨‹å¦‚ä¸‹ï¼Œæˆ‘ä»¬å…ˆçœ‹è¯·æ±‚è¡Œçš„è§£æè¿‡ç¨‹ã€‚

**è¯·æ±‚è¡Œ**ï¼ŒåŒ…å«ä¸‰ä¸ªåŸºæœ¬è¦ç´ ï¼šè¯·æ±‚æ–¹æ³• + URI + HTTP ç‰ˆæœ¬ï¼Œç”¨ç©ºæ ¼è¿›è¡Œåˆ†å‰²ï¼Œæ‰€ä»¥è§£æä»£ç å¦‚ä¸‹

```java
/**
 * æ ¹æ®æ ‡å‡†çš„HTTPåè®®ï¼Œè§£æè¯·æ±‚è¡Œ
 *
 * @param reader
 * @param request
 */
private static void decodeRequestLine(BufferedReader reader, Request request) throws IOException {
    String[] strs = StringUtils.split(reader.readLine(), " ");
    assert strs.length == 3;
    request.setMethod(strs[0]);
    request.setUri(strs[1]);
    request.setVersion(strs[2]);
}
```

**è¯·æ±‚å¤´çš„è§£æ**ï¼Œä»ç¬¬äºŒè¡Œï¼Œåˆ°ç¬¬ä¸€ä¸ªç©ºç™½è¡Œä¹‹é—´çš„æ‰€æœ‰æ•°æ®ï¼Œéƒ½æ˜¯è¯·æ±‚å¤´ï¼›è¯·æ±‚å¤´çš„æ ¼å¼ä¹Ÿæ¯”è¾ƒæ¸…æ™°ï¼Œå½¢å¦‚ `key:value`, å…·ä½“å®ç°å¦‚ä¸‹ï¼š

```java
/**
    * æ ¹æ®æ ‡å‡† HTTP åè®®ï¼Œè§£æè¯·æ±‚å¤´
    *
    * @param reader  è¯»å–è¯·æ±‚å¤´çš„ BufferedReader å¯¹è±¡
    * @param request å­˜å‚¨è¯·æ±‚ä¿¡æ¯çš„ Request å¯¹è±¡
    * @throws IOException å½“è¯»å–è¯·æ±‚å¤´ä¿¡æ¯æ—¶å‘ç”Ÿ I/O å¼‚å¸¸æ—¶ï¼Œå°†æŠ›å‡ºè¯¥å¼‚å¸¸
    */
private static void decodeRequestHeader(BufferedReader reader, Request request) throws IOException {
    // åˆ›å»ºä¸€ä¸ª Map å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨è¯·æ±‚å¤´ä¿¡æ¯
    Map<String, String> headers = new HashMap<>(16);
    // è¯»å–è¯·æ±‚å¤´ä¿¡æ¯ï¼Œæ¯è¡Œéƒ½æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œä»¥ç©ºè¡Œç»“æŸ
    String line = reader.readLine();
    String[] kv;
    while (!"".equals(line)) {
        // å°†æ¯è¡Œè¯·æ±‚å¤´ä¿¡æ¯æŒ‰å†’å·åˆ†éš”ï¼Œåˆ†åˆ«ä½œä¸ºé”®å’Œå€¼å­˜å…¥ Map ä¸­
        kv = StringUtils.split(line, ":");
        assert kv.length == 2;
        headers.put(kv[0].trim(), kv[1].trim());
        line = reader.readLine();
    }
    // å°†è§£æå‡ºæ¥çš„è¯·æ±‚å¤´ä¿¡æ¯å­˜å…¥ Request å¯¹è±¡ä¸­
    request.setHeaders(headers);
}
```

**æœ€åå°±æ˜¯æ­£æ–‡çš„è§£æäº†**ï¼Œè¿™ä¸€å—éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œæ­£æ–‡å¯èƒ½ä¸ºç©ºï¼Œä¹Ÿå¯èƒ½æœ‰æ•°æ®ï¼›æœ‰æ•°æ®æ—¶ï¼Œæˆ‘ä»¬è¦å¦‚ä½•æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½å–å‡ºæ¥å‘¢ï¼Ÿ

å…ˆçœ‹å…·ä½“å®ç°å¦‚ä¸‹ï¼š

```java
/**
 * æ ¹æ®æ ‡æ³¨HTTPåè®®ï¼Œè§£ææ­£æ–‡
 *
 * @param reader    è¾“å…¥æµè¯»å–å™¨ï¼Œç”¨äºè¯»å–è¯·æ±‚ä¸­çš„æ•°æ®
 * @param request   Request å¯¹è±¡ï¼Œè¡¨ç¤º HTTP è¯·æ±‚
 * @throws IOException å½“å‘ç”Ÿ I/O é”™è¯¯æ—¶æŠ›å‡º
 */
private static void decodeRequestMessage(BufferedReader reader, Request request) throws IOException {
    // ä»è¯·æ±‚å¤´ä¸­è·å– Content-Lengthï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™é»˜è®¤ä¸º 0
    int contentLen = Integer.parseInt(request.getHeaders().getOrDefault("Content-Length", "0"));

    // å¦‚æœ Content-Length ä¸º 0ï¼Œè¡¨ç¤ºæ²¡æœ‰è¯·æ±‚æ­£æ–‡ï¼Œç›´æ¥è¿”å›ã€‚
    // ä¾‹å¦‚ GET å’Œ OPTIONS è¯·æ±‚é€šå¸¸ä¸åŒ…å«è¯·æ±‚æ­£æ–‡
    if (contentLen == 0) {
        return;
    }

    // æ ¹æ® Content-Length åˆ›å»ºä¸€ä¸ªå­—ç¬¦æ•°ç»„æ¥å­˜å‚¨è¯·æ±‚æ­£æ–‡
    char[] message = new char[contentLen];

    // ä½¿ç”¨ BufferedReader è¯»å–è¯·æ±‚æ­£æ–‡
    reader.read(message);

    // å°†å­—ç¬¦æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º Request å¯¹è±¡çš„ message
    request.setMessage(new String(message));
}
```

æ³¨æ„ä¸Šé¢æˆ‘çš„ä½¿ç”¨å§¿åŠ¿ï¼Œé¦–å…ˆæ˜¯æ ¹æ®è¯·æ±‚å¤´ä¸­çš„`Content-Type`çš„å€¼ï¼Œæ¥è·å¾—æ­£æ–‡çš„æ•°æ®å¤§å°ï¼Œå› æ­¤æˆ‘ä»¬è·å–çš„æ–¹å¼æ˜¯åˆ›å»ºä¸€ä¸ªè¿™ä¹ˆå¤§çš„`char[]` æ•°ç»„æ¥è¯»å–æµä¸­æ‰€æœ‰æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬çš„æ•°ç»„æ¯”å®é™…çš„å°ï¼Œåˆ™è¯»ä¸å®Œï¼›å¦‚æœå¤§ï¼Œåˆ™æ•°ç»„ä¸­ä¼šæœ‰ä¸€äº›ç©ºçš„æ•°æ®ï¼›

**æœ€åå°†ä¸Šé¢çš„å‡ ä¸ªè§£æå°è£…ä¸€ä¸‹**ï¼Œå®Œæˆ request è§£æï¼š

```java
/**
 * HTTP è¯·æ±‚å¯ä»¥åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š
 * 1. è¯·æ±‚è¡Œï¼šåŒ…æ‹¬è¯·æ±‚æ–¹æ³•ã€URI å’Œ HTTP åè®®ç‰ˆæœ¬
 * 2. è¯·æ±‚å¤´ï¼šä»ç¬¬äºŒè¡Œå¼€å§‹ï¼Œç›´åˆ°ä¸€ä¸ªç©ºè¡Œä¸ºæ­¢
 * 3. æ¶ˆæ¯æ­£æ–‡ï¼šç´§è·Ÿåœ¨ç©ºè¡Œåçš„æ‰€æœ‰å†…å®¹ï¼Œé•¿åº¦ç”±è¯·æ±‚å¤´ä¸­çš„ Content-Length å†³å®š
 *
 * æœ¬æ–¹æ³•å°† InputStream ä¸­çš„ HTTP è¯·æ±‚æ•°æ®è§£æä¸ºä¸€ä¸ª Request å¯¹è±¡
 *
 * @param reqStream  åŒ…å« HTTP è¯·æ±‚æ•°æ®çš„è¾“å…¥æµ
 * @return           ä¸€ä¸ªè¡¨ç¤º HTTP è¯·æ±‚çš„ Request å¯¹è±¡
 * @throws IOException å½“å‘ç”Ÿ I/O é”™è¯¯æ—¶æŠ›å‡º
 */
public static Request parse2request(InputStream reqStream) throws IOException {
    // ä½¿ç”¨ BufferedReader å’Œ InputStreamReader è¯»å–è¾“å…¥æµä¸­çš„æ•°æ®
    BufferedReader httpReader = new BufferedReader(new InputStreamReader(reqStream, "UTF-8"));

    // åˆ›å»ºä¸€ä¸ªæ–°çš„ Request å¯¹è±¡
    Request httpRequest = new Request();

    // è§£æè¯·æ±‚è¡Œå¹¶è®¾ç½®åˆ° Request å¯¹è±¡ä¸­
    decodeRequestLine(httpReader, httpRequest);

    // è§£æè¯·æ±‚å¤´å¹¶è®¾ç½®åˆ° Request å¯¹è±¡ä¸­
    decodeRequestHeader(httpReader, httpRequest);

    // è§£ææ¶ˆæ¯æ­£æ–‡å¹¶è®¾ç½®åˆ° Request å¯¹è±¡ä¸­
    decodeRequestMessage(httpReader, httpRequest);

    // è¿”å›è§£æåçš„ Request å¯¹è±¡
    return httpRequest;
}
```

æ¥ä¸‹æ¥ï¼Œæ˜¯è¯·æ±‚ç»“æœçš„å°è£…ï¼Œç»™ä¸€ä¸ªç®€å•çš„è¿›è¡Œæ¼”ç¤ºï¼š

```java
/**
    * Response ç±»è¡¨ç¤ºä¸€ä¸ª HTTP å“åº”ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬ã€çŠ¶æ€ç ã€çŠ¶æ€ä¿¡æ¯ã€å“åº”å¤´å’Œå“åº”æ­£æ–‡ã€‚
    */
@Data
public static class Response {
    private String version;
    private int code;
    private String status;
    private Map<String, String> headers;
    private String message;
}

/**
    * æ ¹æ®ç»™å®šçš„ Request å¯¹è±¡å’Œå“åº”å­—ç¬¦ä¸²æ„å»ºä¸€ä¸ª HTTP å“åº”ã€‚
    *
    * @param request   ç”¨äºæ„å»ºå“åº”çš„ Request å¯¹è±¡
    * @param response  å“åº”å­—ç¬¦ä¸²
    * @return          ä¸€ä¸ªè¡¨ç¤º HTTP å“åº”çš„å­—ç¬¦ä¸²
    */
public static String buildResponse(Request request, String response) {
    // åˆ›å»ºä¸€ä¸ªæ–°çš„ Response å¯¹è±¡ï¼Œå¹¶è®¾ç½®ç‰ˆæœ¬ã€çŠ¶æ€ç å’ŒçŠ¶æ€ä¿¡æ¯
    Response httpResponse = new Response();
    httpResponse.setCode(200);
    httpResponse.setStatus("ok");
    httpResponse.setVersion(request.getVersion());

    // è®¾ç½®å“åº”å¤´
    Map<String, String> headers = new HashMap<>();
    headers.put("Content-Type", "application/json");
    headers.put("Content-Length", String.valueOf(response.getBytes().length));
    httpResponse.setHeaders(headers);

    // è®¾ç½®å“åº”æ­£æ–‡
    httpResponse.setMessage(response);

    // æ„å»ºå“åº”å­—ç¬¦ä¸²
    StringBuilder builder = new StringBuilder();
    buildResponseLine(httpResponse, builder);
    buildResponseHeaders(httpResponse, builder);
    buildResponseMessage(httpResponse, builder);
    return builder.toString();
}

/**
    * æ„å»ºå“åº”è¡Œï¼ŒåŒ…æ‹¬ç‰ˆæœ¬ã€çŠ¶æ€ç å’ŒçŠ¶æ€ä¿¡æ¯ã€‚
    *
    * @param response      ç”¨äºæ„å»ºå“åº”è¡Œçš„ Response å¯¹è±¡
    * @param stringBuilder ç”¨äºæ‹¼æ¥å“åº”å­—ç¬¦ä¸²çš„ StringBuilder å¯¹è±¡
    */
private static void buildResponseLine(Response response, StringBuilder stringBuilder) {
    stringBuilder.append(response.getVersion()).append(" ").append(response.getCode()).append(" ")
            .append(response.getStatus()).append("\n");
}

/**
    * æ„å»ºå“åº”å¤´ã€‚
    *
    * @param response      ç”¨äºæ„å»ºå“åº”å¤´çš„ Response å¯¹è±¡
    * @param stringBuilder ç”¨äºæ‹¼æ¥å“åº”å­—ç¬¦ä¸²çš„ StringBuilder å¯¹è±¡
    */
private static void buildResponseHeaders(Response response, StringBuilder stringBuilder) {
    for (Map.Entry<String, String> entry : response.getHeaders().entrySet()) {
        stringBuilder.append(entry.getKey()).append(":").append(entry.getValue()).append("\n");
    }
    stringBuilder.append("\n");
}

/**
    * æ„å»ºå“åº”æ­£æ–‡ã€‚
    *
    * @param response      ç”¨äºæ„å»ºå“åº”æ­£æ–‡çš„ Response å¯¹è±¡
    * @param stringBuilder ç”¨äºæ‹¼æ¥å“åº”å­—ç¬¦ä¸²çš„ StringBuilder å¯¹è±¡
    */
private static void buildResponseMessage(Response response, StringBuilder stringBuilder) {
    stringBuilder.append(response.getMessage());
}
```

##### b. è¯·æ±‚ä»»åŠ¡ HttpTask

æ¯ä¸ªè¯·æ±‚ï¼Œå•ç‹¬åˆ†é…ä¸€ä¸ªä»»åŠ¡æ¥å¹²è¿™ä¸ªäº‹æƒ…ï¼Œå°±æ˜¯ä¸ºäº†æ”¯æŒå¹¶å‘ï¼Œå¯¹äº ServerSocket è€Œè¨€ï¼Œæ¥æ”¶åˆ°äº†ä¸€ä¸ªè¯·æ±‚ï¼Œé‚£å°±åˆ›å»ºä¸€ä¸ª HttpTask ä»»åŠ¡æ¥å®ç° HTTP é€šä¿¡ã€‚

é‚£ä¹ˆè¿™ä¸ª httptask å¹²å•¥å‘¢ï¼Ÿ

- ä»è¯·æ±‚ä¸­ææ•°æ®
- å“åº”è¯·æ±‚
- å°è£…ç»“æœå¹¶è¿”å›

```java
/**
 * HttpTask ç±»å®ç°äº† Runnable æ¥å£ï¼Œç”¨äºå¤„ç†ä¸€ä¸ª HTTP è¯·æ±‚ã€‚
 * å½“åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œæ—¶ï¼Œè¯¥ä»»åŠ¡å°†å¤„ç†ä¸€ä¸ª Socket è¿æ¥ä¸Šçš„ HTTP è¯·æ±‚ï¼Œ
 * å¹¶å‘é€å“åº”æ¶ˆæ¯ã€‚
 */
public class HttpTask implements Runnable {
    // ç”¨äºå¤„ç† HTTP è¯·æ±‚çš„ Socket
    private Socket socket;

    /**
     * æ„é€ ä¸€ä¸ªæ–°çš„ HttpTaskï¼Œç”¨äºå¤„ç†æŒ‡å®šçš„ Socket è¿æ¥ã€‚
     *
     * @param socket  ç”¨äºå¤„ç† HTTP è¯·æ±‚çš„ Socket
     */
    public HttpTask(Socket socket) {
        this.socket = socket;
    }

    /**
     * å®ç° Runnable æ¥å£çš„ run æ–¹æ³•ï¼Œç”¨äºå¤„ç† HTTP è¯·æ±‚å¹¶å‘é€å“åº”æ¶ˆæ¯ã€‚
     */
    @Override
    public void run() {
        // æ£€æŸ¥ socket æ˜¯å¦ä¸º nullï¼Œå¦‚æœä¸º null åˆ™æŠ›å‡ºå¼‚å¸¸
        if (socket == null) {
            throw new IllegalArgumentException("socket can't be null.");
        }

        try {
            // è·å– Socket çš„è¾“å‡ºæµï¼Œå¹¶åˆ›å»ºä¸€ä¸ª PrintWriter å¯¹è±¡
            OutputStream outputStream = socket.getOutputStream();
            PrintWriter out = new PrintWriter(outputStream);

            // ä» Socket çš„è¾“å…¥æµä¸­è§£æ HTTP è¯·æ±‚
            HttpMessageParser.Request httpRequest = HttpMessageParser.parse2request(socket.getInputStream());

            try {
                // æ ¹æ®è¯·æ±‚ç»“æœè¿›è¡Œå“åº”ï¼Œçœç•¥è¿”å›
                String result = null;
                
                // æ ¹æ®è¯·æ±‚å’Œç»“æœæ„å»º HTTP å“åº”
                String httpRes = HttpMessageParser.buildResponse(httpRequest, result);

                // å°† HTTP å“åº”å‘é€åˆ°å®¢æˆ·ç«¯
                out.print(httpRes);
            } catch (Exception e) {
                // å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œæ„å»ºä¸€ä¸ªåŒ…å«å¼‚å¸¸ä¿¡æ¯çš„ HTTP å“åº”
                String httpRes = HttpMessageParser.buildResponse(httpRequest, e.toString());
                out.print(httpRes);
            }

            // åˆ·æ–°è¾“å‡ºæµï¼Œç¡®ä¿å“åº”æ¶ˆæ¯è¢«å‘é€
            out.flush();
        } catch (IOException e) {
            e.printStackTrace();
        } finally {
            // å…³é—­ Socket è¿æ¥
            try {
                socket.close();
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }
}
```

##### c. HTTP æœåŠ¡æ­å»º

å‰é¢çš„åŸºæœ¬ä¸ŠæŠŠè¯¥å¹²çš„äº‹æƒ…éƒ½å¹²äº†ï¼Œå‰©ä¸‹çš„å°±ç®€å•äº†ï¼Œåˆ›å»º`ServerSocket`ï¼Œç»‘å®šç«¯å£æ¥æ”¶è¯·æ±‚ï¼Œæˆ‘ä»¬åœ¨çº¿ç¨‹æ± ä¸­è·‘è¿™ä¸ª HTTP æœåŠ¡

```java
public class BasicHttpServer {
    // åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹æ‰§è¡Œå™¨ï¼Œç”¨äºå¯åŠ¨ HTTP æœåŠ¡å™¨
    private static ExecutorService bootstrapExecutor = Executors.newSingleThreadExecutor();
    // åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œç”¨äºå¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚
    private static ExecutorService taskExecutor;
    // è®¾ç½®æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£å·
    private static int PORT = 8999;

    // å¯åŠ¨ HTTP æœåŠ¡å™¨çš„æ–¹æ³•
    static void startHttpServer() {
        // è·å–å¤„ç†å™¨å¯ç”¨æ ¸å¿ƒæ•°ï¼Œç”¨äºè®¾ç½®çº¿ç¨‹æ± å¤§å°
        int nThreads = Runtime.getRuntime().availableProcessors();
        // åˆå§‹åŒ–çº¿ç¨‹æ± ï¼Œè®¾ç½®çº¿ç¨‹æ± å¤§å°ï¼Œé˜Ÿåˆ—å¤§å°å’Œä¸¢å¼ƒç­–ç•¥
        taskExecutor =
                new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue<>(100),
                        new ThreadPoolExecutor.DiscardPolicy());

        // å¾ªç¯å°è¯•å¯åŠ¨æœåŠ¡å™¨ï¼Œå¦‚æœå¯åŠ¨å¤±è´¥ï¼Œåˆ™ç­‰å¾…10ç§’åé‡è¯•
        while (true) {
            try {
                ServerSocket serverSocket = new ServerSocket(PORT);
                bootstrapExecutor.submit(new ServerThread(serverSocket));
                break;
            } catch (Exception e) {
                try {
                    // é‡è¯•ï¼Œç­‰å¾… 10 ç§’
                    TimeUnit.SECONDS.sleep(10);
                } catch (InterruptedException ie) {
                    Thread.currentThread().interrupt();
                }
            }
        }

        // å…³é—­å¯åŠ¨æ‰§è¡Œå™¨
        bootstrapExecutor.shutdown();
    }

    // HTTP æœåŠ¡å™¨ä¸»è¦ä»»åŠ¡ç±»
    private static class ServerThread implements Runnable {
        // ä¿å­˜ä¼ é€’ç»™æ„é€ å‡½æ•°çš„ ServerSocket å®ä¾‹
        private ServerSocket serverSocket;

        // æ„é€ å‡½æ•°
        public ServerThread(ServerSocket s) throws IOException {
            this.serverSocket = s;
        }

        // ä»»åŠ¡ä¸»ä½“æ–¹æ³•
        @Override
        public void run() {
            while (true) {
                try {
                    // ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥
                    Socket socket = this.serverSocket.accept();
                    // åˆ›å»ºä¸€ä¸ª HttpTask å®ä¾‹ï¼Œå°† Socket å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’
                    HttpTask eventTask = new HttpTask(socket);
                    // å°† HttpTask æäº¤ç»™ taskExecutor æ‰§è¡Œ
                    taskExecutor.submit(eventTask);
                } catch (Exception e) {
                    e.printStackTrace();
                    try {
                        // å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œç­‰å¾… 1 ç§’åç»§ç»­å°è¯•
                        TimeUnit.SECONDS.sleep(1);
                    } catch (InterruptedException ie) {
                        Thread.currentThread().interrupt();
                    }
                }
            }
        }
    }
}
```

è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨å®ç°ã€‚ä»¥ä¸‹æ˜¯å…³äºè¿™ä¸ª HTTP æœåŠ¡å™¨çš„ä¸»è¦ç»„ä»¶å’ŒåŠŸèƒ½çš„è¯¦ç»†è§£é‡Šï¼š

1ã€bootstrapExecutorï¼šä¸€ä¸ªå•çº¿ç¨‹çš„ ExecutorServiceï¼Œç”¨äºæ‰§è¡Œ HTTP æœåŠ¡å™¨çš„å¯åŠ¨ä»»åŠ¡ã€‚

2ã€taskExecutorï¼šä¸€ä¸ªçº¿ç¨‹æ± ï¼Œç”¨äºå¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚ã€‚çº¿ç¨‹æ± çš„å¤§å°ç­‰äºå¤„ç†å™¨å¯ç”¨æ ¸å¿ƒæ•°ï¼Œé˜Ÿåˆ—å¤§å°ä¸º100ï¼Œä½¿ç”¨ DiscardPolicy ä¸¢å¼ƒç­–ç•¥ã€‚

3ã€PORTï¼šæœåŠ¡å™¨ä¾¦å¬çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸º 8999ã€‚

4ã€startHttpServer() æ–¹æ³•ï¼š

    - a.åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ±  taskExecutor ç”¨äºå¤„ç† HTTP è¯·æ±‚ã€‚
    - b.åœ¨ä¸€ä¸ªå¾ªç¯ä¸­ï¼Œå°è¯•åˆ›å»ºä¸€ä¸ª ServerSocket å®ä¾‹å¹¶ç»‘å®šåˆ°æŒ‡å®šç«¯å£ã€‚å¦‚æœå¤±è´¥ï¼Œåˆ™ç­‰å¾… 10 ç§’åé‡è¯•ã€‚
    - c.å½“æˆåŠŸåˆ›å»º ServerSocket å®ä¾‹åï¼Œå°†å…¶ä½œä¸ºå‚æ•°æäº¤ç»™ bootstrapExecutor æ‰§è¡Œ ServerThread ä»»åŠ¡ã€‚
    - d.å…³é—­ bootstrapExecutorã€‚

5ã€ServerThread ç±»å®ç°äº† Runnable æ¥å£ï¼Œå®ƒæ˜¯ HTTP æœåŠ¡å™¨çš„ä¸»è¦ä»»åŠ¡ï¼š
    - a.serverSocket æˆå‘˜å˜é‡ï¼šä¿å­˜ä¼ é€’ç»™æ„é€ å‡½æ•°çš„ ServerSocket å®ä¾‹ã€‚
    - b.run() æ–¹æ³•ï¼š
        - åœ¨ä¸€ä¸ªæ— é™å¾ªç¯ä¸­ï¼Œè°ƒç”¨ serverSocket.accept() æ–¹æ³•ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥ã€‚
        - å½“æ¥å—åˆ°ä¸€ä¸ªæ–°çš„å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œåˆ›å»ºä¸€ä¸ª HttpTask å®ä¾‹ï¼Œå°† Socket å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’ã€‚
        - å°† HttpTask æäº¤ç»™ taskExecutor æ‰§è¡Œã€‚

è¿™ä¸ª HTTP æœåŠ¡å™¨çš„ä¸»è¦é€»è¾‘æ˜¯ï¼šä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥ç›‘å¬å®¢æˆ·ç«¯è¿æ¥ï¼Œå½“æœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œåˆ›å»ºä¸€ä¸ª HttpTask æ¥å¤„ç†å®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚ï¼Œå¹¶å°†è¿™ä¸ªä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ±  taskExecutor æ‰§è¡Œã€‚è¿™æ ·å¯ä»¥å®ç°å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚çš„å¹¶å‘å¤„ç†ã€‚

åˆ°è¿™é‡Œï¼Œä¸€ä¸ªåŸºäº Socket å®ç°çš„ HTTP æœåŠ¡å™¨åŸºæœ¬ä¸Šå°±æ­å»ºå®Œäº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥è¿›è¡Œæµ‹è¯•äº†

#### 4\. æµ‹è¯•

åšè¿™ä¸ªæœåŠ¡å™¨ï¼Œä¸»è¦æ˜¯åŸºäºé¡¹ç›® [quick-fix](https://github.com/liuyueyi/quick-fix) äº§ç”Ÿçš„ï¼Œè¿™ä¸ªé¡¹ç›®ä¸»è¦æ˜¯ä¸ºäº†è§£å†³åº”ç”¨å†…éƒ¨æœåŠ¡è®¿é—®ä¸æ•°æ®è®¢æ­£ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªé¡¹ç›®çš„åŸºç¡€ä¸Šè¿›è¡Œæµ‹è¯•ã€‚

ä¸€ä¸ªå®Œæ•´çš„ post è¯·æ±‚å¦‚ä¸‹

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/socket/http-f314ade3-9006-4caa-b905-5726121826c4.gif)

æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹æ‰“å°å‡ºè¿”å›å¤´çš„æƒ…å†µ

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/socket/http-59db6211-792a-494f-b01a-9d5848eceed1.gif)

### II. å…¶ä»–

#### 0\. é¡¹ç›®æºç 

- [quick-fix](https://github.com/liuyueyi/quick-fix)
- ç›¸å…³ä»£ç :
- com.git.hui.fix.core.endpoint.BasicHttpServer
- com.git.hui.fix.core.endpoint.HttpMessageParser
- com.git.hui.fix.core.endpoint.HttpTask

>ä½œè€…ï¼šä¸€ç°ï¼Œæ•´ç†ï¼šæ²‰é»˜ç‹äºŒï¼Œå›¢é˜Ÿï¼ŒæŠ€æœ¯æ´¾

---

æœ€è¿‘æ•´ç†äº†ä¸€ä»½ç‰›é€¼çš„å­¦ä¹ èµ„æ–™ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº Java åŸºç¡€éƒ¨åˆ†ï¼ˆJVMã€Java é›†åˆæ¡†æ¶ã€å¤šçº¿ç¨‹ï¼‰ï¼Œè¿˜å›Šæ‹¬äº† **æ•°æ®åº“ã€è®¡ç®—æœºç½‘ç»œã€ç®—æ³•ä¸æ•°æ®ç»“æ„ã€è®¾è®¡æ¨¡å¼ã€æ¡†æ¶ç±» Springã€Nettyã€å¾®æœåŠ¡ï¼ˆDubboï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ ç½‘å…³** ç­‰ç­‰ç­‰ç­‰â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¯ä»¥è¯´æ˜¯ 2022 å¹´å…¨ç½‘æœ€å…¨çš„å­¦ä¹ å’Œæ‰¾å·¥ä½œçš„ PDF èµ„æºäº†](https://tobebetterjavaer.com/pdf/programmer-111.html)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)



# ç¬¬åäºŒç« ï¼šJava NIO




## 12.1 NIOæ¯”IOå¼ºåœ¨å“ªï¼Ÿ

æˆ‘èŠ±äº†å‡ å¤©æ—¶é—´å»äº†è§£**NIO çš„æ ¸å¿ƒçŸ¥è¯†**ï¼ŒæœŸé—´çœ‹äº†ã€ŠJava ç¼–ç¨‹æ€æƒ³ã€‹å’Œã€Šç–¯ç‹‚ Java è®²ä¹‰ã€‹ä¸­çš„ NIO æ¨¡å—ã€‚**ä½†æ˜¯**ï¼Œçœ‹å®Œä¹‹åè¿˜æ˜¯å¾ˆ**è¿·**ï¼Œä¸çŸ¥é“ NIO æ˜¯å¹²å˜›ç”¨çš„ï¼Œç½‘ä¸Šçš„èµ„æ–™å’Œä¹¦ä¸Šçš„çŸ¥è¯†ç‚¹æ²¡æœ‰å¾ˆå¥½åœ°å¯¹åº”ä¸Šã€‚

æˆ‘è¿™é‡Œå…ˆç»™å¤§å®¶å±•ç¤ºä¸€å‰¯ä¼ ç»Ÿ IO å’Œ NIO çš„å¯¹æ¯”å›¾ï¼Œæ„Ÿå—ä¸€ä¸‹ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/nio-better-io-20230406180538.png)

[ä¼ ç»Ÿ IO](https://tobebetterjavaer.com/io/shangtou.html) åŸºäºå­—èŠ‚æµæˆ–å­—ç¬¦æµï¼ˆå¦‚ FileInputStreamã€BufferedReader ç­‰ï¼‰è¿›è¡Œæ–‡ä»¶è¯»å†™ï¼Œä»¥åŠä½¿ç”¨ [Socket å’Œ ServerSocket](https://tobebetterjavaer.com/socket/socket.html) è¿›è¡Œç½‘ç»œä¼ è¾“ã€‚

NIO ä½¿ç”¨[é€šé“ï¼ˆChannelï¼‰å’Œç¼“å†²åŒºï¼ˆBufferï¼‰](https://tobebetterjavaer.com/nio/buffer-channel.html)è¿›è¡Œæ–‡ä»¶æ“ä½œï¼Œä»¥åŠä½¿ç”¨ SocketChannel å’Œ ServerSocketChannel è¿›è¡Œç½‘ç»œä¼ è¾“ã€‚

ä¼ ç»Ÿ IO é‡‡ç”¨é˜»å¡å¼æ¨¡å‹ï¼Œå¯¹äºæ¯ä¸ªè¿æ¥ï¼Œéƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥å¤„ç†è¯»å†™æ“ä½œã€‚å½“ä¸€ä¸ªçº¿ç¨‹åœ¨ç­‰å¾… I/O æ“ä½œæ—¶ï¼Œæ— æ³•æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚è¿™ä¼šå¯¼è‡´å¤§é‡çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯ï¼Œä»¥åŠä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œé™ä½äº†ç³»ç»Ÿæ€§èƒ½ã€‚

NIO ä½¿ç”¨éé˜»å¡æ¨¡å‹ï¼Œå…è®¸çº¿ç¨‹åœ¨ç­‰å¾… I/O æ—¶æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚è¿™ç§æ¨¡å¼é€šè¿‡ä½¿ç”¨é€‰æ‹©å™¨ï¼ˆSelectorï¼‰æ¥ç›‘æ§å¤šä¸ªé€šé“ï¼ˆChannelï¼‰ä¸Šçš„ I/O äº‹ä»¶ï¼Œå®ç°äº†æ›´é«˜çš„æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚

### 01ã€NIO å’Œä¼ ç»Ÿ IO åœ¨æ“ä½œæ–‡ä»¶æ—¶çš„å·®å¼‚

JDK 1.4 ä¸­ï¼Œ`java.nio.*åŒ…`å¼•å…¥æ–°çš„ Java I/O åº“ï¼Œå…¶ç›®çš„æ˜¯**æé«˜é€Ÿåº¦**ã€‚å®é™…ä¸Šï¼Œâ€œæ—§â€çš„ I/O åŒ…å·²ç»ä½¿ç”¨ NIO**é‡æ–°å®ç°è¿‡ï¼Œå³ä½¿æˆ‘ä»¬ä¸æ˜¾å¼çš„ä½¿ç”¨ NIO ç¼–ç¨‹ï¼Œä¹Ÿèƒ½ä»ä¸­å—ç›Š**ã€‚

- nio ç¿»è¯‘æˆ no-blocking io æˆ–è€… new io éƒ½æ— æ‰€è°“å•¦ï¼Œéƒ½è¯´å¾—é€š~

åœ¨ã€ŠJava ç¼–ç¨‹æ€æƒ³ã€‹è¯»åˆ°â€œå³ä½¿æˆ‘ä»¬ä¸æ˜¾å¼çš„ä½¿ç”¨ NIO ç¼–ç¨‹ï¼Œä¹Ÿèƒ½ä»ä¸­å—ç›Šâ€çš„æ—¶å€™ï¼Œæˆ‘æ˜¯æŒºåœ¨æ„çš„ï¼Œæ‰€ä»¥ï¼šæˆ‘ä»¬**æµ‹è¯•**ä¸€ä¸‹ä½¿ç”¨ NIO å¤åˆ¶æ–‡ä»¶å’Œ[ä¼ ç»Ÿ IO å¤åˆ¶æ–‡ä»¶](https://tobebetterjavaer.com/io/file-path.html) çš„æ€§èƒ½ï¼š

```java
public class SimpleFileTransferTest {

    // ä½¿ç”¨ä¼ ç»Ÿçš„ I/O æ–¹æ³•ä¼ è¾“æ–‡ä»¶
    private long transferFile(File source, File des) throws IOException {
        long startTime = System.currentTimeMillis();

        if (!des.exists())
            des.createNewFile();

        // åˆ›å»ºè¾“å…¥è¾“å‡ºæµ
        BufferedInputStream bis = new BufferedInputStream(new FileInputStream(source));
        BufferedOutputStream bos = new BufferedOutputStream(new FileOutputStream(des));

        // ä½¿ç”¨æ•°ç»„ä¼ è¾“æ•°æ®
        byte[] bytes = new byte[1024 * 1024];
        int len;
        while ((len = bis.read(bytes)) != -1) {
            bos.write(bytes, 0, len);
        }

        long endTime = System.currentTimeMillis();
        return endTime - startTime;
    }

    // ä½¿ç”¨ NIO æ–¹æ³•ä¼ è¾“æ–‡ä»¶
    private long transferFileWithNIO(File source, File des) throws IOException {
        long startTime = System.currentTimeMillis();

        if (!des.exists())
            des.createNewFile();

        // åˆ›å»ºéšæœºå­˜å–æ–‡ä»¶å¯¹è±¡
        RandomAccessFile read = new RandomAccessFile(source, "rw");
        RandomAccessFile write = new RandomAccessFile(des, "rw");

        // è·å–æ–‡ä»¶é€šé“
        FileChannel readChannel = read.getChannel();
        FileChannel writeChannel = write.getChannel();

        // åˆ›å»ºå¹¶ä½¿ç”¨ ByteBuffer ä¼ è¾“æ•°æ®
        ByteBuffer byteBuffer = ByteBuffer.allocate(1024 * 1024);
        while (readChannel.read(byteBuffer) > 0) {
            byteBuffer.flip();
            writeChannel.write(byteBuffer);
            byteBuffer.clear();
        }

        // å…³é—­æ–‡ä»¶é€šé“
        writeChannel.close();
        readChannel.close();
        long endTime = System.currentTimeMillis();
        return endTime - startTime;
    }

    public static void main(String[] args) throws IOException {
        SimpleFileTransferTest simpleFileTransferTest = new SimpleFileTransferTest();
        File sourse = new File("[ç”µå½±å¤©å ‚www.dygod.cn]çŒœç«è½¦-cd1.rmvb");
        File des = new File("io.avi");
        File nio = new File("nio.avi");

        // æ¯”è¾ƒä¼ ç»Ÿçš„ I/O å’Œ NIO ä¼ è¾“æ–‡ä»¶çš„æ—¶é—´
        long time = simpleFileTransferTest.transferFile(sourse, des);
        System.out.println(time + "ï¼šæ™®é€šå­—èŠ‚æµæ—¶é—´");

        long timeNio = simpleFileTransferTest.transferFileWithNIO(sourse, nio);
        System.out.println(timeNio + "ï¼šNIOæ—¶é—´");
    }
}
```

å…ˆè§£é‡Šä¸€ä¸‹è¿™æ®µä»£ç ï¼Œé‡Œé¢å‡ºç°çš„ [RandomAccessFile](https://tobebetterjavaer.com/io/file-path.html) æˆ‘ä»¬ä¹‹å‰è®²è¿‡ï¼ŒFileChannel æ˜¯ Java NIOï¼ˆNew I/Oï¼‰åº“ä¸­çš„ä¸€ä¸ªç±»ï¼Œå®ƒæä¾›äº†å¯¹æ–‡ä»¶çš„é«˜æ•ˆ I/O æ“ä½œï¼Œæ”¯æŒéšæœºè®¿é—®æ–‡ä»¶ï¼Œå…è®¸åœ¨æ–‡ä»¶çš„ä»»æ„ä½ç½®è¿›è¡Œè¯»å†™æ“ä½œã€‚

ä¸ RandomAccessFile ä¸åŒï¼ŒFileChannel ä½¿ç”¨äº†[ç¼“å†²åŒºï¼ˆByteBufferï¼‰](https://tobebetterjavaer.com/nio/buffer-channel.html)è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚

å¥½ï¼Œåœ¨æˆ‘ç»™å‡ºå®é™…çš„ç»“è®ºä¹‹å‰ï¼Œä½ æ˜¯å¦ä¼šæœ‰è¿™æ ·çš„ç»“è®ºï¼š

- å¯¹äºè¾ƒå°çš„æ–‡ä»¶ï¼ŒNIO å’Œæ™®é€š IO ä¹‹é—´çš„æ€§èƒ½å·®å¼‚å¯èƒ½ä¸ä¼šéå¸¸æ˜æ˜¾ï¼Œå› ä¸ºæ–‡ä»¶æœ¬èº«è¾ƒå°ï¼Œå¤åˆ¶è¿‡ç¨‹è¾ƒå¿«ã€‚
- å¯¹äºè¾ƒå¤§çš„æ–‡ä»¶ï¼Œä½¿ç”¨ NIO çš„æ€§èƒ½å¯èƒ½ä¼šæ˜æ˜¾ä¼˜äºæ™®é€š IOã€‚å› ä¸º NIO ä½¿ç”¨äº†æ›´é«˜æ•ˆçš„ç¼“å†²åŒºå’Œé€šé“æœºåˆ¶ï¼Œå¯ä»¥åœ¨å†…å­˜ä¸­è¿›è¡Œæ›´å¿«çš„æ•°æ®ä¼ è¾“ã€‚

ç„¶è€Œå®é™…çš„ç»“æœï¼Œå´ä¼šä»¤ä½ å¤§è·Œçœ¼é•œï¼š

![](https://cdn.tobebetterjavaer.com/stutymore/why-20230331191748.png)

æ–‡ä»¶è¶Šå¤§çš„æƒ…å†µä¸‹ï¼Œç«Ÿç„¶æ™®é€šå­—èŠ‚æµï¼ˆä¼ ç»Ÿ IOï¼‰çš„é€Ÿåº¦æ›´å¿«(å½“ç„¶äº†ï¼Œä¸ªäººæµ‹è¯•ï¼Œæˆ–è®¸ä¸æ˜¯å¾ˆå‡†)ï¼Œé‚£è¿˜è¦ NIO åšä»€ä¹ˆå‘¢ï¼Ÿå†µä¸” NIO çš„å­¦ä¹ æˆæœ¬ä¹Ÿæ¯”ä¼ ç»Ÿ IO è¦é«˜ä¸€äº›ã€‚

é‚£è¿™æ„å‘³ç€æˆ‘ä»¬**å¯ä»¥ä¸ä½¿ç”¨/å­¦ä¹  NIO äº†å—**ï¼Ÿ

ç­”æ¡ˆæ˜¯**å¦å®š**çš„ï¼ŒIO æ“ä½œå¾€å¾€åœ¨**ä¸¤ä¸ªåœºæ™¯**ä¸‹ä¼šç”¨åˆ°ï¼š

- æ–‡ä»¶ IO
- ç½‘ç»œ IO

è€Œ NIO çš„**é­…åŠ›ä¸»è¦ä½“ç°åœ¨ç½‘ç»œä¸­**ï¼

NIOï¼ˆNew I/Oï¼‰çš„è®¾è®¡ç›®æ ‡æ˜¯è§£å†³ä¼ ç»Ÿ I/Oï¼ˆBIOï¼ŒBlocking I/Oï¼‰åœ¨å¤„ç†å¤§é‡å¹¶å‘è¿æ¥æ—¶çš„æ€§èƒ½ç“¶é¢ˆã€‚ä¼ ç»Ÿ I/O åœ¨ç½‘ç»œé€šä¿¡ä¸­ä¸»è¦ä½¿ç”¨é˜»å¡å¼ I/Oï¼Œä¸ºæ¯ä¸ªè¿æ¥åˆ†é…ä¸€ä¸ªçº¿ç¨‹ã€‚å½“è¿æ¥æ•°é‡å¢åŠ æ—¶ï¼Œç³»ç»Ÿæ€§èƒ½å°†å—åˆ°ä¸¥é‡å½±å“ï¼Œçº¿ç¨‹èµ„æºæˆä¸ºå…³é”®ç“¶é¢ˆã€‚è€Œ NIO æä¾›äº†éé˜»å¡ I/O å’Œ I/O å¤šè·¯å¤ç”¨ï¼Œå¯ä»¥åœ¨å•ä¸ªçº¿ç¨‹ä¸­å¤„ç†å¤šä¸ªå¹¶å‘è¿æ¥ï¼Œä»è€Œåœ¨ç½‘ç»œä¼ è¾“ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ã€‚

ä»¥ä¸‹æ˜¯ NIO åœ¨ç½‘ç»œä¼ è¾“ä¸­ä¼˜äºä¼ ç»Ÿ I/O çš„åŸå› ï¼š

â‘ ã€NIO æ”¯æŒéé˜»å¡ I/Oï¼Œè¿™æ„å‘³ç€åœ¨æ‰§è¡Œ I/O æ“ä½œæ—¶ï¼Œçº¿ç¨‹ä¸ä¼šè¢«é˜»å¡ã€‚è¿™ä½¿å¾—åœ¨ç½‘ç»œä¼ è¾“ä¸­å¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†å¤§é‡å¹¶å‘è¿æ¥ï¼ˆæ•°åƒç”šè‡³æ•°ç™¾ä¸‡ï¼‰ã€‚è€Œåœ¨æ“ä½œæ–‡ä»¶æ—¶ï¼Œè¿™ä¸ªä¼˜åŠ¿æ²¡æœ‰é‚£ä¹ˆæ˜æ˜¾ï¼Œå› ä¸ºæ–‡ä»¶è¯»å†™é€šå¸¸ä¸æ¶‰åŠå¤§é‡å¹¶å‘æ“ä½œã€‚

â‘¡ã€NIO æ”¯æŒ I/O å¤šè·¯å¤ç”¨ï¼Œè¿™æ„å‘³ç€ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶ç›‘è§†å¤šä¸ªé€šé“ï¼ˆå¦‚å¥—æ¥å­—ï¼‰ï¼Œå¹¶åœ¨ I/O äº‹ä»¶ï¼ˆå¦‚å¯è¯»ã€å¯å†™ï¼‰å‡†å¤‡å¥½æ—¶å¤„ç†å®ƒä»¬ã€‚è¿™å¤§å¤§æé«˜äº†ç½‘ç»œä¼ è¾“ä¸­çš„æ€§èƒ½ï¼Œå› ä¸ºå•ä¸ªçº¿ç¨‹å¯ä»¥é«˜æ•ˆåœ°ç®¡ç†å¤šä¸ªå¹¶å‘è¿æ¥ã€‚æ“ä½œæ–‡ä»¶æ—¶è¿™ä¸ªä¼˜åŠ¿ä¹Ÿæ— æ³•æç°å‡ºæ¥ã€‚

â‘¢ã€NIO æä¾›äº† [ByteBuffer ç±»](https://tobebetterjavaer.com/nio/buffer-channel.html)ï¼Œå¯ä»¥é«˜æ•ˆåœ°ç®¡ç†ç¼“å†²åŒºã€‚è¿™åœ¨ç½‘ç»œä¼ è¾“ä¸­å¾ˆé‡è¦ï¼Œå› ä¸ºæ•°æ®é€šå¸¸æ˜¯ä»¥å­—èŠ‚æµçš„å½¢å¼ä¼ è¾“ã€‚æ“ä½œæ–‡ä»¶çš„æ—¶å€™ï¼Œè™½ç„¶ä¹Ÿæœ‰ç¼“å†²åŒºï¼Œä½†ä¼˜åŠ¿ä»ç„¶ä¸å¤Ÿæ˜æ˜¾ã€‚

### 02ã€NIO å’Œä¼ ç»Ÿ IO åœ¨ç½‘ç»œä¼ è¾“ä¸­çš„å·®å¼‚

æ¥çœ‹æœåŠ¡å™¨ç«¯ä»£ç çš„å·®åˆ«ã€‚

IOï¼Œç”¨çš„[å¥—æ¥å­—](https://tobebetterjavaer.com/socket/socket.html)ï¼Œä»£ç æ¯”è¾ƒç®€å•ï¼Œæˆ‘å°±ä¸åŠ æ³¨é‡Šäº†ï¼Œä¹‹å‰å­¦è¿‡ï¼Œåº”è¯¥éƒ½èƒ½çœ‹å¾—æ‡‚ï¼Œç”¨ while å¾ªç¯ç›‘å¬å®¢æˆ·ç«¯ Socketï¼š

```java
public class IOServer {
    public static void main(String[] args) {
        try {
            ServerSocket serverSocket = new ServerSocket(8080);

            while (true) {
                Socket client = serverSocket.accept();
                InputStream in = client.getInputStream();
                OutputStream out = client.getOutputStream();

                byte[] buffer = new byte[1024];
                int bytesRead = in.read(buffer);
                out.write(buffer, 0, bytesRead);

                in.close();
                out.close();
                client.close();
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

NIOï¼Œè¿™éƒ¨åˆ†æˆ‘åŠ ä¸Šæ³¨é‡Šï¼Œä¸»è¦ç”¨åˆ°çš„æ˜¯ ServerSocketChannel å’Œ Selectorï¼š

```java
public class NIOServer {
    public static void main(String[] args) {
        try {
            // åˆ›å»º ServerSocketChannel
            ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();
            // ç»‘å®šç«¯å£
            serverSocketChannel.bind(new InetSocketAddress(8081));
            // è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼
            serverSocketChannel.configureBlocking(false);

            // åˆ›å»º Selector
            Selector selector = Selector.open();
            // å°† ServerSocketChannel æ³¨å†Œåˆ° Selectorï¼Œå…³æ³¨ OP_ACCEPT äº‹ä»¶
            serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);

            // æ— é™å¾ªç¯ï¼Œå¤„ç†äº‹ä»¶
            while (true) {
                // é˜»å¡ç›´åˆ°æœ‰äº‹ä»¶å‘ç”Ÿ
                selector.select();
                // è·å–å‘ç”Ÿäº‹ä»¶çš„ SelectionKey
                Iterator<SelectionKey> iterator = selector.selectedKeys().iterator();
                while (iterator.hasNext()) {
                    SelectionKey key = iterator.next();
                    // å¤„ç†å®Œåï¼Œä» selectedKeys é›†åˆä¸­ç§»é™¤
                    iterator.remove();

                    // åˆ¤æ–­äº‹ä»¶ç±»å‹
                    if (key.isAcceptable()) {
                        // æœ‰æ–°çš„è¿æ¥è¯·æ±‚
                        ServerSocketChannel server = (ServerSocketChannel) key.channel();
                        // æ¥å—è¿æ¥
                        SocketChannel client = server.accept();
                        // è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼
                        client.configureBlocking(false);
                        // å°†æ–°çš„ SocketChannel æ³¨å†Œåˆ° Selectorï¼Œå…³æ³¨ OP_READ äº‹ä»¶
                        client.register(selector, SelectionKey.OP_READ);
                    } else if (key.isReadable()) {
                        // æœ‰æ•°æ®å¯è¯»
                        SocketChannel client = (SocketChannel) key.channel();
                        // åˆ›å»º ByteBuffer ç¼“å†²åŒº
                        ByteBuffer buffer = ByteBuffer.allocate(1024);
                        // ä» SocketChannel ä¸­è¯»å–æ•°æ®å¹¶å†™å…¥ ByteBuffer
                        client.read(buffer);
                        // ç¿»è½¬ ByteBufferï¼Œå‡†å¤‡è¯»å–
                        buffer.flip();
                        // å°†æ•°æ®ä» ByteBuffer å†™å›åˆ° SocketChannel
                        client.write(buffer);
                        // å…³é—­è¿æ¥
                        client.close();
                    }
                }
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

ä¸Šé¢çš„ä»£ç åˆ›å»ºäº†ä¸€ä¸ªåŸºäº Java NIO çš„ç®€å• TCP æœåŠ¡å™¨ã€‚å®ƒä½¿ç”¨ [ServerSocketChannel å’Œ Selectorï¼ˆåé¢ä¼šè®²ï¼‰](https://tobebetterjavaer.com/nio/buffer-channel.html) å®ç°äº†éé˜»å¡ I/O å’Œ I/O å¤šè·¯å¤ç”¨ã€‚æœåŠ¡å™¨å¾ªç¯ç›‘å¬äº‹ä»¶ï¼Œå½“æœ‰æ–°çš„è¿æ¥è¯·æ±‚æ—¶ï¼Œæ¥å—è¿æ¥å¹¶å°†æ–°çš„ SocketChannel æ³¨å†Œåˆ° Selectorï¼Œå…³æ³¨ OP_READ äº‹ä»¶ã€‚å½“æœ‰æ•°æ®å¯è¯»æ—¶ï¼Œä» SocketChannel ä¸­è¯»å–æ•°æ®å¹¶å†™å…¥ ByteBufferï¼Œç„¶åå°†æ•°æ®ä» ByteBuffer å†™å›åˆ° SocketChannelã€‚

è¿™é‡Œç®€å•è¯´ä¸€ä¸‹ [Socket å’Œ ServerSocket](https://tobebetterjavaer.com/socket/socket.html)ï¼Œä»¥åŠ ServerSocketChannel å’Œ SocketChannelã€‚

Socket å’Œ ServerSocket æ˜¯ä¼ ç»Ÿçš„é˜»å¡å¼ I/O ç¼–ç¨‹æ–¹å¼ï¼Œç”¨äºå»ºç«‹å’Œç®¡ç† TCP è¿æ¥ã€‚

- Socketï¼šè¡¨ç¤ºå®¢æˆ·ç«¯å¥—æ¥å­—ï¼Œè´Ÿè´£ä¸æœåŠ¡å™¨ç«¯å»ºç«‹è¿æ¥å¹¶è¿›è¡Œæ•°æ®çš„è¯»å†™ã€‚
- ServerSocketï¼šè¡¨ç¤ºæœåŠ¡å™¨ç«¯å¥—æ¥å­—ï¼Œè´Ÿè´£ç›‘å¬å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ã€‚å½“æœ‰æ–°çš„è¿æ¥è¯·æ±‚æ—¶ï¼ŒServerSocket ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Socket å®ä¾‹ï¼Œç”¨äºä¸å®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ã€‚

åœ¨ä¼ ç»Ÿé˜»å¡å¼ I/O ç¼–ç¨‹ä¸­ï¼Œæ¯ä¸ªè¿æ¥éƒ½éœ€è¦ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œè¿™å¯¼è‡´äº†åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ€§èƒ½é—®é¢˜ã€‚åœ¨æ¥ä¸‹æ¥çš„å®¢æˆ·ç«¯æµ‹è¯•ç”¨ä¾‹ä¸­ä¼šçœ‹åˆ°ã€‚

ä¸ºäº†è§£å†³ä¼ ç»Ÿé˜»å¡å¼ I/O çš„æ€§èƒ½é—®é¢˜ï¼ŒJava NIO å¼•å…¥äº† [ServerSocketChannel å’Œ SocketChannel](https://tobebetterjavaer.com/nio/network-connect.html)ã€‚å®ƒä»¬æ˜¯éé˜»å¡ I/Oï¼Œå¯ä»¥åœ¨å•ä¸ªçº¿ç¨‹ä¸­å¤„ç†å¤šä¸ªè¿æ¥ã€‚

- ServerSocketChannelï¼šç±»ä¼¼äº ServerSocketï¼Œè¡¨ç¤ºæœåŠ¡å™¨ç«¯å¥—æ¥å­—é€šé“ã€‚å®ƒè´Ÿè´£ç›‘å¬å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ï¼Œå¹¶å¯ä»¥è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œè¿™æ„å‘³ç€åœ¨ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚æ—¶ä¸ä¼šé˜»å¡çº¿ç¨‹ã€‚
- SocketChannelï¼šç±»ä¼¼äº Socketï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯å¥—æ¥å­—é€šé“ã€‚å®ƒè´Ÿè´£ä¸æœåŠ¡å™¨ç«¯å»ºç«‹è¿æ¥å¹¶è¿›è¡Œæ•°æ®çš„è¯»å†™ã€‚SocketChannel ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œåœ¨è¯»å†™æ•°æ®æ—¶ä¸ä¼šé˜»å¡çº¿ç¨‹ã€‚

å†æ¥ç®€å•è¯´ä¸€ä¸‹ [Selector](https://tobebetterjavaer.com/nio/buffer-channel.html)ï¼Œåé¢ä¼šå†ç»†è®²ã€‚

Selector æ˜¯ Java NIO ä¸­çš„ä¸€ä¸ªå…³é”®ç»„ä»¶ï¼Œç”¨äºå®ç° [I/O å¤šè·¯å¤ç”¨](https://tobebetterjavaer.com/nio/moxing.html)ã€‚å®ƒå…è®¸åœ¨å•ä¸ªçº¿ç¨‹ä¸­åŒæ—¶ç›‘æ§å¤šä¸ª ServerSocketChannel å’Œ SocketChannelï¼Œå¹¶é€šè¿‡ SelectionKey æ ‡è¯†å…³æ³¨çš„äº‹ä»¶ã€‚å½“æŸä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒSelector ä¼šå°†å¯¹åº”çš„ SelectionKey æ·»åŠ åˆ°å·²é€‰æ‹©çš„é”®é›†åˆä¸­ã€‚é€šè¿‡ä½¿ç”¨ Selectorï¼Œå¯ä»¥åœ¨å•ä¸ªçº¿ç¨‹ä¸­åŒæ—¶å¤„ç†å¤šä¸ªè¿æ¥ï¼Œä»è€Œæœ‰æ•ˆåœ°æé«˜ I/O æ“ä½œçš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ã€‚

å®¢æˆ·ç«¯æµ‹è¯•ç”¨ä¾‹ï¼š

```java
public class TestClient {
    public static void main(String[] args) throws InterruptedException {
        int clientCount = 10000;
        ExecutorService executorServiceIO = Executors.newFixedThreadPool(10);
        ExecutorService executorServiceNIO = Executors.newFixedThreadPool(10);

        // ä½¿ç”¨ä¼ ç»Ÿ IO çš„å®¢æˆ·ç«¯
        Runnable ioClient = () -> {
            try {
                Socket socket = new Socket("localhost", 8080);
                OutputStream out = socket.getOutputStream();
                InputStream in = socket.getInputStream();
                out.write("Hello, æ²‰é»˜ç‹äºŒ IO!".getBytes());
                byte[] buffer = new byte[1024];
                in.read(buffer);
                in.close();
                out.close();
                socket.close();
            } catch (IOException e) {
                e.printStackTrace();
            }
        };

        // ä½¿ç”¨ NIO çš„å®¢æˆ·ç«¯
        Runnable nioClient = () -> {
            try {
                SocketChannel socketChannel = SocketChannel.open();
                socketChannel.connect(new InetSocketAddress("localhost", 8081));
                ByteBuffer buffer = ByteBuffer.wrap("Hello, æ²‰é»˜ç‹äºŒ NIO!".getBytes());
                socketChannel.write(buffer);
                buffer.clear();
                socketChannel.read(buffer);
                socketChannel.close();
            } catch (IOException e) {
                e.printStackTrace();
            }
        };

        // åˆ†åˆ«æµ‹è¯• NIO å’Œä¼ ç»Ÿ IO çš„æœåŠ¡å™¨æ€§èƒ½
        long startTime, endTime;

        startTime = System.currentTimeMillis();
        for (int i = 0; i < clientCount; i++) {
            executorServiceIO.execute(ioClient);
        }
        executorServiceIO.shutdown();
        executorServiceIO.awaitTermination(1, TimeUnit.MINUTES);
        endTime = System.currentTimeMillis();
        System.out.println("ä¼ ç»Ÿ IO æœåŠ¡å™¨å¤„ç† " + clientCount + " ä¸ªå®¢æˆ·ç«¯è€—æ—¶: " + (endTime - startTime) + "ms");

        startTime = System.currentTimeMillis();
        for (int i = 0; i < clientCount; i++) {
            executorServiceNIO.execute(nioClient);
        }
        executorServiceNIO.shutdown();
        executorServiceNIO.awaitTermination(1, TimeUnit.MINUTES);
        endTime = System.currentTimeMillis();
        System.out.println("NIO æœåŠ¡å™¨å¤„ç† " + clientCount + " ä¸ªå®¢æˆ·ç«¯è€—æ—¶: " + (endTime - startTime) + "ms");
    }
}
```

åœ¨è¿™ä¸ªç®€å•çš„æ€§èƒ½æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å›ºå®šçº¿ç¨‹æ± ï¼ˆ10ä¸ªçº¿ç¨‹ï¼‰æ¥æ¨¡æ‹Ÿå®¢æˆ·ç«¯å¹¶å‘è¯·æ±‚ã€‚åˆ†åˆ«æµ‹è¯• NIO å’Œä¼ ç»Ÿ IO æœåŠ¡å™¨å¤„ç† 10000 ä¸ªå®¢æˆ·ç«¯è¯·æ±‚æ‰€éœ€çš„æ—¶é—´ã€‚æ¥çœ‹ä¸€ä¸‹ç»“æœã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/why-20230404141335.png)

å¯ä»¥çœ‹å¾—å‡ºï¼ŒNIO æ¯” ä¼ ç»Ÿ IO å·®ä¸å¤šå¿«ä¸€å€çš„æ—¶é—´ã€‚å½“ç„¶äº†ï¼Œè¿™æ˜¯æ”¾åœ¨æˆ‘æœ¬åœ°æµ‹è¯•çš„ï¼Œå¦‚æœæœåŠ¡ç«¯æ”¾åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œè¿™ä¸ªç»“æœä¼šæœ‰æ‰€ä¸åŒï¼Œä½†æˆ‘åœ¨æœ¬åœ°è·‘äº†å‡ æ¬¡ï¼Œç»“æœå·®ä¸å¤šæ˜¯è¿™æ ·çš„ç»“æœã€‚

è¿™è¯´æ˜ NIO åœ¨ç½‘ç»œä¼ è¾“ä¸­çš„æ€§èƒ½ç¡®å®è¦ä¼˜äºä¼ ç»Ÿ IO çš„ã€‚

### 03ã€å°ç»“

æœ¬ç¯‡å†…å®¹ä¸»è¦è®²äº† NIOï¼ˆNew IOï¼‰å’Œä¼ ç»Ÿ IO ä¹‹é—´çš„å·®å¼‚ï¼ŒåŒ…æ‹¬ IO æ¨¡å‹ã€æ“ä½œæ–‡ä»¶ã€ç½‘ç»œä¼ è¾“ç­‰æ–¹é¢ã€‚

- ä¼ ç»Ÿ I/O é‡‡ç”¨é˜»å¡å¼æ¨¡å‹ï¼Œçº¿ç¨‹åœ¨ I/O æ“ä½œæœŸé—´æ— æ³•æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚NIO ä½¿ç”¨éé˜»å¡æ¨¡å‹ï¼Œå…è®¸çº¿ç¨‹åœ¨ç­‰å¾… I/O æ—¶æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œé€šè¿‡é€‰æ‹©å™¨ï¼ˆSelectorï¼‰ç›‘æ§å¤šä¸ªé€šé“ï¼ˆChannelï¼‰ä¸Šçš„ I/O äº‹ä»¶ï¼Œæé«˜æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚
- ä¼ ç»Ÿ I/O ä½¿ç”¨åŸºäºå­—èŠ‚æµæˆ–å­—ç¬¦æµçš„ç±»ï¼ˆå¦‚ FileInputStreamã€BufferedReader ç­‰ï¼‰è¿›è¡Œæ–‡ä»¶è¯»å†™ã€‚NIO ä½¿ç”¨é€šé“ï¼ˆChannelï¼‰å’Œç¼“å†²åŒºï¼ˆBufferï¼‰è¿›è¡Œæ–‡ä»¶æ“ä½œï¼ŒNIO åœ¨æ€§èƒ½ä¸Šçš„ä¼˜åŠ¿å¹¶ä¸å¤§ã€‚
- ä¼ ç»Ÿ I/O ä½¿ç”¨ Socket å’Œ ServerSocket è¿›è¡Œç½‘ç»œä¼ è¾“ï¼Œå­˜åœ¨é˜»å¡é—®é¢˜ã€‚NIO æä¾›äº† SocketChannel å’Œ ServerSocketChannelï¼Œæ”¯æŒéé˜»å¡ç½‘ç»œä¼ è¾“ï¼Œæé«˜äº†å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚

---

æœ€è¿‘æ•´ç†äº†ä¸€ä»½ç‰›é€¼çš„å­¦ä¹ èµ„æ–™ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº Java åŸºç¡€éƒ¨åˆ†ï¼ˆJVMã€Java é›†åˆæ¡†æ¶ã€å¤šçº¿ç¨‹ï¼‰ï¼Œè¿˜å›Šæ‹¬äº† **æ•°æ®åº“ã€è®¡ç®—æœºç½‘ç»œã€ç®—æ³•ä¸æ•°æ®ç»“æ„ã€è®¾è®¡æ¨¡å¼ã€æ¡†æ¶ç±» Springã€Nettyã€å¾®æœåŠ¡ï¼ˆDubboï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ ç½‘å…³** ç­‰ç­‰ç­‰ç­‰â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¯ä»¥è¯´æ˜¯ 2022 å¹´å…¨ç½‘æœ€å…¨çš„å­¦ä¹ å’Œæ‰¾å·¥ä½œçš„ PDF èµ„æºäº†](https://tobebetterjavaer.com/pdf/programmer-111.html)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 12.2 BIOã€NIO å’Œ AIO çš„åŒºåˆ«

> ä¸Šç¯‡ï¼Œæˆ‘ä»¬äº†è§£äº† [NIO å’Œä¼ ç»Ÿ IO çš„åŒºåˆ«](https://tobebetterjavaer.com/nio/nio-better-io.html)ï¼Œé‚£è¿™ç¯‡æˆ‘ä»¬æ¥äº†è§£ BIOã€NIO å’Œ AIO çš„åŒºåˆ«ï¼Œæ–°æ‰‹ä¹Ÿå¾ˆå®¹æ˜“æ··æ·†ï¼Œæˆ‘ä»¬æ¢ä¸€ä¸ªæ–¹å¼æ¥è®²ï¼Œè®²ç»™å¥³æœ‹å‹å¬ğŸ‘‚ã€‚

å‘¨æœ«åˆåï¼Œåœ¨å®¶é‡Œé¢è¿›è¡Œç”µè¯é¢è¯•ï¼Œæˆ‘é—®äº†é¢è¯•è€…å‡ ä¸ªå…³äº IO çš„é—®é¢˜ï¼Œå…¶ä¸­åŒ…æ‹¬ä»€ä¹ˆæ˜¯ BIOã€NIO å’Œ AIOï¼Ÿä¸‰è€…æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå…·ä½“å¦‚ä½•ä½¿ç”¨ç­‰é—®é¢˜ï¼Œä½†æ˜¯é¢è¯•è€…å›ç­”çš„å¹¶ä¸æ˜¯å¾ˆæ»¡æ„ã€‚äºæ˜¯æˆ‘åœ¨é¢è¯•è¯„ä»·ä¸­å†™é“ï¼š"å¯¹ Java çš„ IO æé†’ç†è§£ä¸å¤Ÿæ·±å…¥"ã€‚æ°å¥½è¢«å¥³æœ‹å‹çœ‹åˆ°äº†ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/io/BIONIOAIO-1.jpg)

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/io/BIONIOAIO-2.jpg)

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/io/BIONIOAIO-4.jpg)

### Java IO ä¸ BIOã€NIO

IOï¼Œå¸¸å†™ä½œ I/Oï¼Œæ˜¯ Input/Output çš„ç®€ç§°ï¼Œå³è¾“å…¥/è¾“å‡ºã€‚é€šå¸¸æŒ‡æ•°æ®åœ¨å†…éƒ¨å­˜å‚¨å™¨ï¼ˆå†…å­˜ï¼‰å’Œå¤–éƒ¨å­˜å‚¨å™¨ï¼ˆç¡¬ç›˜ã€ä¼˜ç›˜ç­‰ï¼‰æˆ–å…¶ä»–å‘¨è¾¹è®¾å¤‡ä¹‹é—´çš„è¾“å…¥å’Œè¾“å‡ºã€‚

è¾“å…¥/è¾“å‡ºæ˜¯ä¿¡æ¯å¤„ç†ç³»ç»Ÿï¼ˆä¾‹å¦‚è®¡ç®—æœºï¼‰ä¸å¤–éƒ¨ä¸–ç•Œï¼ˆå¯èƒ½æ˜¯äººç±»æˆ–å¦ä¸€ä¿¡æ¯å¤„ç†ç³»ç»Ÿï¼‰ä¹‹é—´çš„é€šä¿¡ã€‚

è¾“å…¥æ˜¯ç³»ç»Ÿæ¥æ”¶çš„ä¿¡å·æˆ–æ•°æ®ï¼Œè¾“å‡ºåˆ™æ˜¯ä»å…¶å‘é€çš„ä¿¡å·æˆ–æ•°æ®ã€‚

åœ¨ Java ä¸­ï¼Œæä¾›äº†ä¸€ç³»åˆ— APIï¼Œå¯ä»¥ä¾›å¼€å‘è€…æ¥è¯»å†™å¤–éƒ¨æ•°æ®æˆ–æ–‡ä»¶ã€‚æˆ‘ä»¬ç§°è¿™äº› API ä¸º [Java IO](https://tobebetterjavaer.com/io/shangtou.html)ã€‚

IO æ˜¯ Java ä¸­æ¯”è¾ƒé‡è¦ï¼Œä¸”æ¯”è¾ƒéš¾çš„çŸ¥è¯†ç‚¹ï¼Œä¸»è¦æ˜¯å› ä¸ºéšç€ Java çš„å‘å±•ï¼Œç›®å‰æœ‰ä¸‰ç§ IO å…±å­˜ã€‚åˆ†åˆ«æ˜¯ BIOã€NIO å’Œ AIOã€‚

BIO å…¨ç§° Block-IO æ˜¯ä¸€ç§**åŒæ­¥ä¸”é˜»å¡**çš„é€šä¿¡æ¨¡å¼ã€‚æ˜¯ä¸€ä¸ªæ¯”è¾ƒä¼ ç»Ÿçš„é€šä¿¡æ–¹å¼ï¼Œæ¨¡å¼ç®€å•ï¼Œä½¿ç”¨æ–¹ä¾¿ã€‚ä½†å¹¶å‘å¤„ç†èƒ½åŠ›ä½ï¼Œé€šä¿¡è€—æ—¶ï¼Œä¾èµ–ç½‘é€Ÿã€‚

[Java NIO](https://tobebetterjavaer.com/nio/nio-better-io.html)ï¼Œå…¨ç¨‹ Non-Block IO ï¼Œæ˜¯ Java SE 1.4 ç‰ˆä»¥åï¼Œé’ˆå¯¹ç½‘ç»œä¼ è¾“æ•ˆèƒ½ä¼˜åŒ–çš„æ–°åŠŸèƒ½ã€‚æ˜¯ä¸€ç§**éé˜»å¡åŒæ­¥**çš„é€šä¿¡æ¨¡å¼ã€‚

NIO ä¸åŸæ¥çš„ I/O æœ‰åŒæ ·çš„ä½œç”¨å’Œç›®çš„, ä»–ä»¬ä¹‹é—´æœ€é‡è¦çš„åŒºåˆ«æ˜¯æ•°æ®æ‰“åŒ…å’Œä¼ è¾“çš„æ–¹å¼ã€‚åŸæ¥çš„ I/O ä»¥æµçš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œè€Œ NIO ä»¥å—çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚

é¢å‘æµçš„ I/O ç³»ç»Ÿä¸€æ¬¡ä¸€ä¸ªå­—èŠ‚åœ°å¤„ç†æ•°æ®ã€‚ä¸€ä¸ªè¾“å…¥æµäº§ç”Ÿä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œä¸€ä¸ªè¾“å‡ºæµæ¶ˆè´¹ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ã€‚

é¢å‘å—çš„ I/O ç³»ç»Ÿä»¥å—çš„å½¢å¼å¤„ç†æ•°æ®ã€‚æ¯ä¸€ä¸ªæ“ä½œéƒ½åœ¨ä¸€æ­¥ä¸­äº§ç”Ÿæˆ–è€…æ¶ˆè´¹ä¸€ä¸ªæ•°æ®å—ã€‚æŒ‰å—å¤„ç†æ•°æ®æ¯”æŒ‰(æµå¼çš„)å­—èŠ‚å¤„ç†æ•°æ®è¦å¿«å¾—å¤šã€‚ä½†æ˜¯é¢å‘å—çš„ I/O ç¼ºå°‘ä¸€äº›é¢å‘æµçš„ I/O æ‰€å…·æœ‰çš„ä¼˜é›…æ€§å’Œç®€å•æ€§ã€‚

Java AIOï¼Œå…¨ç§° Asynchronous IOï¼Œæ˜¯**å¼‚æ­¥éé˜»å¡**çš„ IOã€‚æ˜¯ä¸€ç§éé˜»å¡å¼‚æ­¥çš„é€šä¿¡æ¨¡å¼ã€‚

åœ¨ NIO çš„åŸºç¡€ä¸Šå¼•å…¥äº†æ–°çš„å¼‚æ­¥é€šé“çš„æ¦‚å¿µï¼Œå¹¶æä¾›äº†å¼‚æ­¥æ–‡ä»¶é€šé“å’Œå¼‚æ­¥å¥—æ¥å­—é€šé“çš„å®ç°ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/io/BIONIOAIO-8.jpg)

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/io/BIONIOAIO-9.jpg)

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/io/BIONIOAIO-10.jpg)

### ä¸‰ç§ IO çš„åŒºåˆ«

é¦–å…ˆï¼Œæˆ‘ä»¬ç«™åœ¨å®è§‚çš„è§’åº¦ï¼Œé‡æ–°ç”»ä¸€ä¸‹é‡ç‚¹ï¼š

**BIO ï¼ˆBlocking I/Oï¼‰ï¼šåŒæ­¥é˜»å¡ I/O æ¨¡å¼ã€‚**

**NIO ï¼ˆNew I/Oï¼‰ï¼šåŒæ­¥éé˜»å¡æ¨¡å¼ã€‚**

**AIO ï¼ˆAsynchronous I/Oï¼‰ï¼šå¼‚æ­¥éé˜»å¡ I/O æ¨¡å‹ã€‚**

åŒæ­¥é˜»å¡æ¨¡å¼ï¼šè¿™ç§æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬çš„å·¥ä½œæ¨¡å¼æ˜¯å…ˆæ¥åˆ°å¨æˆ¿ï¼Œå¼€å§‹çƒ§æ°´ï¼Œå¹¶ååœ¨æ°´å£¶é¢å‰ä¸€ç›´ç­‰ç€æ°´çƒ§å¼€ã€‚

åŒæ­¥éé˜»å¡æ¨¡å¼ï¼šè¿™ç§æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬çš„å·¥ä½œæ¨¡å¼æ˜¯å…ˆæ¥åˆ°å¨æˆ¿ï¼Œå¼€å§‹çƒ§æ°´ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸ä¸€ç›´ååœ¨æ°´å£¶å‰é¢ç­‰ï¼Œè€Œæ˜¯å›åˆ°å®¢å…çœ‹ç”µè§†ï¼Œç„¶åæ¯éš”å‡ åˆ†é’Ÿåˆ°å¨æˆ¿çœ‹ä¸€ä¸‹æ°´æœ‰æ²¡æœ‰çƒ§å¼€ã€‚

å¼‚æ­¥éé˜»å¡ I/O æ¨¡å‹ï¼šè¿™ç§æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬çš„å·¥ä½œæ¨¡å¼æ˜¯å…ˆæ¥åˆ°å¨æˆ¿ï¼Œå¼€å§‹çƒ§æ°´ï¼Œæˆ‘ä»¬ä¸ä¸€ç›´ååœ¨æ°´å£¶å‰é¢ç­‰ï¼Œä¹Ÿä¸éš”ä¸€æ®µæ—¶é—´å»çœ‹ä¸€ä¸‹ï¼Œè€Œæ˜¯åœ¨å®¢å…çœ‹ç”µè§†ï¼Œæ°´å£¶ä¸Šé¢æœ‰ä¸ªå¼€å…³ï¼Œæ°´çƒ§å¼€ä¹‹åä»–ä¼šé€šçŸ¥æˆ‘ã€‚

é˜»å¡ VS éé˜»å¡ï¼šäººæ˜¯å¦ååœ¨æ°´å£¶å‰é¢ä¸€ç›´ç­‰ã€‚

åŒæ­¥ VS å¼‚æ­¥ï¼šæ°´å£¶æ˜¯ä¸æ˜¯åœ¨æ°´çƒ§å¼€ä¹‹åä¸»åŠ¨é€šçŸ¥äººã€‚

#### é€‚ç”¨åœºæ™¯

BIO æ–¹å¼é€‚ç”¨äºè¿æ¥æ•°ç›®æ¯”è¾ƒå°ä¸”å›ºå®šçš„æ¶æ„ï¼Œè¿™ç§æ–¹å¼å¯¹æœåŠ¡å™¨èµ„æºè¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ï¼ŒJDK1.4 ä»¥å‰çš„å”¯ä¸€é€‰æ‹©ï¼Œä½†ç¨‹åºç›´è§‚ç®€å•æ˜“ç†è§£ã€‚

NIO æ–¹å¼é€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒçŸ­ï¼ˆè½»æ“ä½œï¼‰çš„æ¶æ„ï¼Œæ¯”å¦‚èŠå¤©æœåŠ¡å™¨ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ï¼Œç¼–ç¨‹æ¯”è¾ƒå¤æ‚ï¼ŒJDK1.4 å¼€å§‹æ”¯æŒã€‚

AIO æ–¹å¼é€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒé•¿ï¼ˆé‡æ“ä½œï¼‰çš„æ¶æ„ï¼Œæ¯”å¦‚ç›¸å†ŒæœåŠ¡å™¨ï¼Œå……åˆ†è°ƒç”¨ OS å‚ä¸å¹¶å‘æ“ä½œï¼Œç¼–ç¨‹æ¯”è¾ƒå¤æ‚ï¼ŒJDK7 å¼€å§‹æ”¯æŒã€‚

#### ä½¿ç”¨æ–¹å¼

ä½¿ç”¨ BIO å®ç°æ–‡ä»¶çš„è¯»å–å’Œå†™å…¥ã€‚

```java
public class BioFileDemo {
    public static void main(String[] args) {
        BioFileDemo demo = new BioFileDemo();
        demo.writeFile();
        demo.readFile();
    }

    // ä½¿ç”¨ BIO å†™å…¥æ–‡ä»¶
    public void writeFile() {
        String filename = "logs/itwanger/paicoding.txt";
        try {
            FileWriter fileWriter = new FileWriter(filename);
            BufferedWriter bufferedWriter = new BufferedWriter(fileWriter);

            bufferedWriter.write("å­¦ç¼–ç¨‹å°±ä¸ŠæŠ€æœ¯æ´¾");
            bufferedWriter.newLine();

            System.out.println("å†™å…¥å®Œæˆ");
            bufferedWriter.close();
            fileWriter.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    // ä½¿ç”¨ BIO è¯»å–æ–‡ä»¶
    public void readFile() {
        String filename = "logs/itwanger/paicoding.txt";
        try {
            FileReader fileReader = new FileReader(filename);
            BufferedReader bufferedReader = new BufferedReader(fileReader);

            String line;
            while ((line = bufferedReader.readLine()) != null) {
                System.out.println("è¯»å–çš„å†…å®¹: " + line);
            }

            bufferedReader.close();
            fileReader.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Java ä¸­çš„ä¼ ç»Ÿé˜»å¡ I/Oï¼ˆBIOï¼‰å¯¹æ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œã€‚åœ¨ `writeFile()` æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ª FileWriter å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ BufferedWriter è¿›è¡Œç¼“å†²å†™å…¥ã€‚æ¥ç€ï¼Œä½¿ç”¨ `bufferedWriter.write()` æ–¹æ³•å°†å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ï¼Œç„¶åè°ƒç”¨ `bufferedWriter.newLine()` æ–¹æ³•æ·»åŠ æ¢è¡Œç¬¦ã€‚æœ€åï¼Œå…³é—­ BufferedWriter å’Œ FileWriterã€‚åœ¨ `readFile()` æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª FileReader å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ BufferedReader è¿›è¡Œç¼“å†²è¯»å–ã€‚ç„¶åé€šè¿‡è°ƒç”¨ `bufferedReader.readLine()` æ–¹æ³•å¾ªç¯è¯»å–æ–‡ä»¶å†…å®¹ï¼Œç›´åˆ°è¿”å› null è¡¨ç¤ºè¯»å–å®Œæ¯•ã€‚æœ€åï¼Œå…³é—­ BufferedReader å’Œ FileReaderã€‚

æ¥ä¸‹æ¥æ˜¯ NIO çš„ã€‚

```java
public class NioFileDemo {
    public static void main(String[] args) {
        NioFileDemo demo = new NioFileDemo();
        demo.writeFile();
        demo.readFile();
    }

    // ä½¿ç”¨ NIO å†™å…¥æ–‡ä»¶
    public void writeFile() {
        Path path = Paths.get("logs/itwanger/paicoding.txt");
        try {
            FileChannel fileChannel = FileChannel.open(path, EnumSet.of(StandardOpenOption.CREATE, StandardOpenOption.WRITE));

            ByteBuffer buffer = StandardCharsets.UTF_8.encode("å­¦ç¼–ç¨‹å°±ä¸ŠæŠ€æœ¯æ´¾");
            fileChannel.write(buffer);

            System.out.println("å†™å…¥å®Œæˆ");
            fileChannel.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    // ä½¿ç”¨ NIO è¯»å–æ–‡ä»¶
    public void readFile() {
        Path path = Paths.get("logs/itwanger/paicoding.txt");
        try {
            FileChannel fileChannel = FileChannel.open(path, StandardOpenOption.READ);
            ByteBuffer buffer = ByteBuffer.allocate(1024);

            int bytesRead = fileChannel.read(buffer);
            while (bytesRead != -1) {
                buffer.flip();
                System.out.println("è¯»å–çš„å†…å®¹: " + StandardCharsets.UTF_8.decode(buffer));
                buffer.clear();
                bytesRead = fileChannel.read(buffer);
            }

            fileChannel.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

è¿™ä¸ªç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ NIO çš„ [FileChannel](https://tobebetterjavaer.com/nio/buffer-channel.html) å¯¹æ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œã€‚åœ¨ `writeFile()` æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆæ‰“å¼€æ–‡ä»¶é€šé“å¹¶æŒ‡å®šåˆ›å»ºå’Œå†™å…¥é€‰é¡¹ã€‚æ¥ç€ï¼Œå°†è¦å†™å…¥çš„å­—ç¬¦ä¸²è½¬æ¢ä¸º ByteBufferï¼Œç„¶åä½¿ç”¨ `fileChannel.write()` æ–¹æ³•å°†å…¶å†™å…¥æ–‡ä»¶ã€‚åœ¨ `readFile()` æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ‰“å¼€æ–‡ä»¶é€šé“å¹¶æŒ‡å®šè¯»å–é€‰é¡¹ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª ByteBuffer ç”¨äºå­˜å‚¨è¯»å–åˆ°çš„æ•°æ®ã€‚ä½¿ç”¨ `fileChannel.read()` æ–¹æ³•å¾ªç¯è¯»å–æ–‡ä»¶å†…å®¹ï¼Œç›´åˆ°è¿”å› -1 è¡¨ç¤ºè¯»å–å®Œæ¯•ã€‚åœ¨å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬ç¿»è½¬ç¼“å†²åŒºï¼Œå°†å…¶è§£ç ä¸ºå­—ç¬¦ä¸²å¹¶æ‰“å°ï¼Œç„¶åæ¸…ç©ºç¼“å†²åŒºä»¥è¿›è¡Œä¸‹ä¸€æ¬¡è¯»å–ã€‚æœ€åï¼Œå…³é—­æ–‡ä»¶é€šé“ã€‚

ä½¿ç”¨ AIO å®ç°æ–‡ä»¶çš„è¯»å–å’Œå†™å…¥

```java
public class AioDemo {

    public static void main(String[] args) {
        AioDemo demo = new AioDemo();
        demo.writeFile();
        demo.readFile();
    }

    // ä½¿ç”¨ AsynchronousFileChannel å†™å…¥æ–‡ä»¶
    public void writeFile() {
        // ä½¿ç”¨ Paths.get() è·å–æ–‡ä»¶è·¯å¾„
        Path path = Paths.get("logs/itwanger/paicoding.txt");
        try {
            // ç”¨ AsynchronousFileChannel.open() æ‰“å¼€æ–‡ä»¶é€šé“ï¼ŒæŒ‡å®šå†™å…¥å’Œåˆ›å»ºæ–‡ä»¶çš„é€‰é¡¹ã€‚
            AsynchronousFileChannel fileChannel = AsynchronousFileChannel.open(path, StandardOpenOption.WRITE, StandardOpenOption.CREATE);

            // å°†è¦å†™å…¥çš„å­—ç¬¦ä¸²ï¼ˆ"å­¦ç¼–ç¨‹å°±ä¸ŠæŠ€æœ¯æ´¾"ï¼‰è½¬æ¢ä¸º ByteBufferã€‚
            ByteBuffer buffer = StandardCharsets.UTF_8.encode("å­¦ç¼–ç¨‹å°±ä¸ŠæŠ€æœ¯æ´¾");
            // è°ƒç”¨ fileChannel.write() æ–¹æ³•å°† ByteBuffer ä¸­çš„å†…å®¹å†™å…¥æ–‡ä»¶ã€‚è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ Future å¯¹è±¡ç­‰å¾…å†™å…¥æ“ä½œå®Œæˆã€‚
            Future<Integer> result = fileChannel.write(buffer, 0);
            // ç­‰å¾…å†™æ“ä½œå®Œæˆ
            result.get();

            System.out.println("å†™å…¥å®Œæˆ");
            fileChannel.close();
        } catch (IOException | InterruptedException | java.util.concurrent.ExecutionException e) {
            e.printStackTrace();
        }
    }

    // ä½¿ç”¨ AsynchronousFileChannel è¯»å–æ–‡ä»¶
    public void readFile() {
        Path path = Paths.get("logs/itwanger/paicoding.txt");
        try {
            // æŒ‡å®šè¯»å–æ–‡ä»¶çš„é€‰é¡¹ã€‚
            AsynchronousFileChannel fileChannel = AsynchronousFileChannel.open(path, StandardOpenOption.READ);
            // åˆ›å»ºä¸€ä¸ª ByteBufferï¼Œç”¨äºå­˜å‚¨ä»æ–‡ä»¶ä¸­è¯»å–çš„æ•°æ®ã€‚
            ByteBuffer buffer = ByteBuffer.allocate(1024);

            // è°ƒç”¨ fileChannel.read() æ–¹æ³•ä»æ–‡ä»¶ä¸­å¼‚æ­¥è¯»å–æ•°æ®ã€‚è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª CompletionHandler å¯¹è±¡ï¼Œç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œå®Œæˆåçš„å›è°ƒã€‚
            fileChannel.read(buffer, 0, buffer, new CompletionHandler<Integer, ByteBuffer>() {
                @Override
                public void completed(Integer result, ByteBuffer attachment) {
                    // åœ¨ CompletionHandler çš„ completed() æ–¹æ³•ä¸­ï¼Œç¿»è½¬ ByteBufferï¼ˆattachment.flip()ï¼‰ï¼Œç„¶åä½¿ç”¨ Charset.forName("UTF-8").decode() å°†å…¶è§£ç ä¸ºå­—ç¬¦ä¸²å¹¶æ‰“å°ã€‚æœ€åï¼Œæ¸…ç©ºç¼“å†²åŒºå¹¶å…³é—­æ–‡ä»¶é€šé“ã€‚
                    attachment.flip();
                    System.out.println("è¯»å–çš„å†…å®¹: " + StandardCharsets.UTF_8.decode(attachment));
                    attachment.clear();
                    try {
                        fileChannel.close();
                    } catch (IOException e) {
                        e.printStackTrace();
                    }
                }

                @Override
                public void failed(Throwable exc, ByteBuffer attachment) {
                    // å¦‚æœå¼‚æ­¥è¯»å–æ“ä½œå¤±è´¥ï¼ŒCompletionHandler çš„ failed() æ–¹æ³•å°†è¢«è°ƒç”¨ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯ã€‚
                    System.out.println("è¯»å–å¤±è´¥");
                    exc.printStackTrace();
                }
            });

            // ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆ
            Thread.sleep(1000);

        } catch (IOException | InterruptedException e) {
            e.printStackTrace();
        }
    }
}
```

è¿™æ®µä»£ç å±•ç¤ºäº†ä¸€ä¸ªåä¸º AioDemo çš„ç±»ï¼ŒåŒ…å«ä¸¤ä¸ªæ–¹æ³•ï¼š`writeFile()` å’Œ `readFile()`ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«ä½¿ç”¨ AsynchronousFileChannel å¯¹æ–‡ä»¶è¿›è¡Œå¼‚æ­¥å†™å…¥å’Œè¯»å–æ“ä½œã€‚ä»£ç çš„å…·ä½“å«ä¹‰æˆ‘éƒ½åŠ åˆ°æ³¨é‡Šå½“ä¸­äº†ï¼Œæ³¨æ„æŸ¥çœ‹ã€‚

æ»´æ»´æ»´ï¼Œæ°´å¼€äº†ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/io/BIONIOAIO-22.jpg)

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/io/BIONIOAIO-23.jpg)

### å°ç»“

BIOï¼ˆBlocking I/Oï¼‰ï¼šé‡‡ç”¨é˜»å¡å¼ I/O æ¨¡å‹ï¼Œçº¿ç¨‹åœ¨æ‰§è¡Œ I/O æ“ä½œæ—¶è¢«é˜»å¡ï¼Œæ— æ³•å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œé€‚ç”¨äºè¿æ¥æ•°è¾ƒå°‘ä¸”ç¨³å®šçš„åœºæ™¯ã€‚

NIOï¼ˆNew I/O æˆ– Non-blocking I/Oï¼‰ï¼šä½¿ç”¨éé˜»å¡ I/O æ¨¡å‹ï¼Œçº¿ç¨‹åœ¨ç­‰å¾… I/O æ—¶å¯æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œé€šè¿‡ Selector ç›‘æ§å¤šä¸ª Channel ä¸Šçš„äº‹ä»¶ï¼Œæé«˜æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ï¼Œé€‚ç”¨äºé«˜å¹¶å‘åœºæ™¯ã€‚

AIOï¼ˆAsynchronous I/Oï¼‰ï¼šé‡‡ç”¨å¼‚æ­¥ I/O æ¨¡å‹ï¼Œçº¿ç¨‹å‘èµ· I/O è¯·æ±‚åç«‹å³è¿”å›ï¼Œå½“ I/O æ“ä½œå®Œæˆæ—¶é€šè¿‡å›è°ƒå‡½æ•°é€šçŸ¥çº¿ç¨‹ï¼Œè¿›ä¸€æ­¥æé«˜äº†å¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œé€‚ç”¨äºé«˜ååé‡åœºæ™¯ã€‚

> å‚è€ƒé“¾æ¥ï¼š[https://mp.weixin.qq.com/s/QQxrr5yP8X9YdFqIwXDoQQ](https://mp.weixin.qq.com/s/QQxrr5yP8X9YdFqIwXDoQQ)

---

æœ€è¿‘æ•´ç†äº†ä¸€ä»½ç‰›é€¼çš„å­¦ä¹ èµ„æ–™ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº Java åŸºç¡€éƒ¨åˆ†ï¼ˆJVMã€Java é›†åˆæ¡†æ¶ã€å¤šçº¿ç¨‹ï¼‰ï¼Œè¿˜å›Šæ‹¬äº† **æ•°æ®åº“ã€è®¡ç®—æœºç½‘ç»œã€ç®—æ³•ä¸æ•°æ®ç»“æ„ã€è®¾è®¡æ¨¡å¼ã€æ¡†æ¶ç±» Springã€Nettyã€å¾®æœåŠ¡ï¼ˆDubboï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ ç½‘å…³** ç­‰ç­‰ç­‰ç­‰â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¯ä»¥è¯´æ˜¯ 2022 å¹´å…¨ç½‘æœ€å…¨çš„å­¦ä¹ å’Œæ‰¾å·¥ä½œçš„ PDF èµ„æºäº†](https://tobebetterjavaer.com/pdf/programmer-111.html)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 12.3 Bufferå’ŒChannel

é¦–å…ˆæˆ‘ä»¬å†æ¥å›é¡¾ä¸€ä¸‹ [IO å’Œ NIO çš„åŒºåˆ«](https://tobebetterjavaer.com/nio/nio-better-io.html)ï¼š

- å¯ç®€å•è®¤ä¸ºï¼š**IO æ˜¯é¢å‘æµçš„å¤„ç†ï¼ŒNIO æ˜¯é¢å‘å—(ç¼“å†²åŒº)çš„å¤„ç†**
- é¢å‘æµçš„ I/O ç³»ç»Ÿ**ä¸€æ¬¡ä¸€ä¸ªå­—èŠ‚åœ°å¤„ç†æ•°æ®**ã€‚
- ä¸€ä¸ªé¢å‘å—(ç¼“å†²åŒº)çš„ I/O ç³»ç»Ÿ**ä»¥å—çš„å½¢å¼å¤„ç†æ•°æ®**ã€‚

NIO ä¸»è¦æœ‰**ä¸¤ä¸ªæ ¸å¿ƒéƒ¨åˆ†ç»„æˆ**ï¼š

- **Buffer ç¼“å†²åŒº**
- **Channel é€šé“**

åœ¨ NIO ä¸­ï¼Œå¹¶ä¸æ˜¯ä»¥æµçš„æ–¹å¼æ¥å¤„ç†æ•°æ®çš„ï¼Œè€Œæ˜¯ä»¥ buffer ç¼“å†²åŒºå’Œ Channel é€šé“**é…åˆä½¿ç”¨**æ¥å¤„ç†æ•°æ®çš„ã€‚

ç®€å•ç†è§£ä¸€ä¸‹ï¼š

å¯ä»¥æŠŠ Channel é€šé“æ¯”ä½œé“è·¯ï¼Œbuffer ç¼“å†²åŒºæ¯”ä½œæˆç«è½¦(è¿è½½ç€è´§ç‰©)

è€Œæˆ‘ä»¬çš„ NIO å°±æ˜¯**é€šè¿‡ Channel é€šé“è¿è¾“ç€å­˜å‚¨æ•°æ®çš„ Buffer ç¼“å†²åŒºçš„æ¥å®ç°æ•°æ®çš„å¤„ç†**ï¼

è¦æ—¶åˆ»è®°ä½ï¼šChannel ä¸ä¸æ•°æ®æ‰“äº¤é“ï¼Œå®ƒåªè´Ÿè´£è¿è¾“æ•°æ®ã€‚ä¸æ•°æ®æ‰“äº¤é“çš„æ˜¯ Buffer ç¼“å†²åŒº

- **Channel-->è¿è¾“**
- **Buffer-->æ•°æ®**

ç›¸å¯¹äºä¼ ç»Ÿ IO è€Œè¨€ï¼Œ**æµæ˜¯å•å‘çš„**ã€‚å¯¹äº NIO è€Œè¨€ï¼Œæœ‰äº† Channel é€šé“è¿™ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬çš„**è¯»å†™éƒ½æ˜¯åŒå‘**çš„(é“è·¯ä¸Šçš„ç«è½¦èƒ½ä»å¹¿å·å»åŒ—äº¬ã€è‡ªç„¶å°±èƒ½ä»åŒ—äº¬è¿”è¿˜åˆ°å¹¿å·)ï¼

### Buffer ç¼“å†²åŒº

æˆ‘ä»¬æ¥çœ‹çœ‹ Buffer ç¼“å†²åŒºæœ‰ä»€ä¹ˆå€¼å¾—æˆ‘ä»¬æ³¨æ„çš„åœ°æ–¹ã€‚

Buffer æ˜¯ç¼“å†²åŒºçš„æŠ½è±¡ç±»ï¼š

![](https://cdn.tobebetterjavaer.com/stutymore/rumen-20230404151539.png)

å…¶ä¸­ ByteBuffer æ˜¯**ç”¨å¾—æœ€å¤šçš„å®ç°ç±»**(åœ¨é€šé“ä¸­è¯»å†™å­—èŠ‚æ•°æ®)ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/rumen-20230404152253.png)

æ‹¿åˆ°ä¸€ä¸ªç¼“å†²åŒºæˆ‘ä»¬å¾€å¾€ä¼šåšä»€ä¹ˆï¼Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯**è¯»å–ç¼“å†²åŒºçš„æ•°æ®/å†™æ•°æ®åˆ°ç¼“å†²åŒºä¸­**ã€‚æ‰€ä»¥ï¼Œç¼“å†²åŒºçš„æ ¸å¿ƒæ–¹æ³•å°±æ˜¯ put å’Œ getï¼š

![](https://cdn.tobebetterjavaer.com/stutymore/rumen-20230404152445.png)

Buffer ç±»ç»´æŠ¤äº† 4 ä¸ªæ ¸å¿ƒå˜é‡æ¥æä¾›**å…³äºå…¶æ‰€åŒ…å«çš„æ•°ç»„ä¿¡æ¯**ã€‚å®ƒä»¬æ˜¯ï¼š

- å®¹é‡ Capacity **ç¼“å†²åŒºèƒ½å¤Ÿå®¹çº³çš„æ•°æ®å…ƒç´ çš„æœ€å¤§æ•°é‡**ã€‚å®¹é‡åœ¨ç¼“å†²åŒºåˆ›å»ºæ—¶è¢«è®¾å®šï¼Œå¹¶ä¸”æ°¸è¿œä¸èƒ½è¢«æ”¹å˜ã€‚(ä¸èƒ½è¢«æ”¹å˜çš„åŸå› ä¹Ÿå¾ˆç®€å•ï¼Œåº•å±‚æ˜¯æ•°ç»„å˜›)
- ä¸Šç•Œ Limit **ç¼“å†²åŒºé‡Œçš„æ•°æ®çš„æ€»æ•°**ï¼Œä»£è¡¨äº†å½“å‰ç¼“å†²åŒºä¸­ä¸€å…±æœ‰å¤šå°‘æ•°æ®ã€‚
- ä½ç½® Position **ä¸‹ä¸€ä¸ªè¦è¢«è¯»æˆ–å†™çš„å…ƒç´ çš„ä½ç½®**ã€‚Position ä¼šè‡ªåŠ¨ç”±ç›¸åº”çš„ `get()`å’Œ `put()`å‡½æ•°æ›´æ–°ã€‚
- æ ‡è®° Mark ä¸€ä¸ªå¤‡å¿˜ä½ç½®ã€‚**ç”¨äºè®°å½•ä¸Šä¸€æ¬¡è¯»å†™çš„ä½ç½®**ã€‚

é¦–å…ˆå±•ç¤ºä¸€ä¸‹**æ˜¯å¦‚ä½•åˆ›å»ºç¼“å†²åŒºçš„ï¼Œæ ¸å¿ƒå˜é‡çš„å€¼æ˜¯æ€ä¹ˆå˜åŒ–çš„**ã€‚

```java
// åˆ›å»ºä¸€ä¸ªç¼“å†²åŒº
ByteBuffer byteBuffer = ByteBuffer.allocate(1024);

// çœ‹ä¸€ä¸‹åˆå§‹æ—¶4ä¸ªæ ¸å¿ƒå˜é‡çš„å€¼
System.out.println("åˆå§‹æ—¶-->limit--->"+byteBuffer.limit());
System.out.println("åˆå§‹æ—¶-->position--->"+byteBuffer.position());
System.out.println("åˆå§‹æ—¶-->capacity--->"+byteBuffer.capacity());
System.out.println("åˆå§‹æ—¶-->mark--->" + byteBuffer.mark());

System.out.println("--------------------------------------");

// æ·»åŠ ä¸€äº›æ•°æ®åˆ°ç¼“å†²åŒºä¸­
String s = "æ²‰é»˜ç‹äºŒ";
byteBuffer.put(s.getBytes());

// çœ‹ä¸€ä¸‹åˆå§‹æ—¶4ä¸ªæ ¸å¿ƒå˜é‡çš„å€¼
System.out.println("putå®Œä¹‹å-->limit--->"+byteBuffer.limit());
System.out.println("putå®Œä¹‹å-->position--->"+byteBuffer.position());
System.out.println("putå®Œä¹‹å-->capacity--->"+byteBuffer.capacity());
System.out.println("putå®Œä¹‹å-->mark--->" + byteBuffer.mark());
```

è¿è¡Œç»“æœï¼š

```
åˆå§‹æ—¶-->limit--->1024
åˆå§‹æ—¶-->position--->0
åˆå§‹æ—¶-->capacity--->1024
åˆå§‹æ—¶-->mark--->java.nio.HeapByteBuffer[pos=0 lim=1024 cap=1024]
--------------------------------------
putå®Œä¹‹å-->limit--->1024
putå®Œä¹‹å-->position--->12
putå®Œä¹‹å-->capacity--->1024
putå®Œä¹‹å-->mark--->java.nio.HeapByteBuffer[pos=12 lim=1024 cap=1024]
```

ç°åœ¨**æˆ‘æƒ³è¦ä»ç¼“å­˜åŒºæ‹¿æ•°æ®**ï¼Œæ€ä¹ˆæ‹¿å‘€ï¼Ÿï¼ŸNIO ç»™äº†æˆ‘ä»¬ä¸€ä¸ª`flip()`æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥**æ”¹åŠ¨ position å’Œ limit çš„ä½ç½®**ï¼

åœ¨ä¹‹å‰ä»£ç çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬`flip()`ä¸€ä¸‹ã€‚

```java
// flip()æ–¹æ³•
byteBuffer.flip();
System.out.println("flip()æ–¹æ³•ä¹‹å-->limit--->"+byteBuffer.limit());
System.out.println("flip()æ–¹æ³•ä¹‹å-->position--->"+byteBuffer.position());
System.out.println("flip()æ–¹æ³•ä¹‹å-->capacity--->"+byteBuffer.capacity());
System.out.println("flip()æ–¹æ³•ä¹‹å-->mark--->" + byteBuffer.mark());
```

å†çœ‹çœ‹ 4 ä¸ªæ ¸å¿ƒå±æ€§çš„å€¼ä¼šå‘ç”Ÿä»€ä¹ˆå˜åŒ–ï¼š

![](https://cdn.tobebetterjavaer.com/stutymore/rumen-20230404153844.png)

åœ¨è°ƒç”¨ `flip()` ä¹‹åï¼Œlimit å˜ä¸ºå½“å‰ position çš„å€¼ï¼ˆ12ï¼‰ï¼Œposition é‡ç½®ä¸º 0ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä»ç¼“å†²åŒºçš„å¼€å§‹ä½ç½®è¯»å–åˆšåˆšå†™å…¥çš„æ•°æ®ï¼Œç›´åˆ° limit æŒ‡å®šçš„ä½ç½®ã€‚capacity ä¿æŒä¸å˜ï¼ˆ1024ï¼‰ã€‚

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåˆå§‹å®¹é‡ä¸º 1024 çš„ ByteBufferã€‚

**åˆå§‹çŠ¶æ€**:

```
position = 0
limit = 1024
capacity = 1024
```

**æ·»åŠ æ•°æ® "æ²‰é»˜ç‹äºŒ" å**:

ç”±äº "æ²‰é»˜ç‹äºŒ" ä¸º UTF-8 ç¼–ç ï¼Œä¸€ä¸ªæ±‰å­—å  3 ä¸ªå­—èŠ‚ï¼Œå…±æœ‰ 4 ä¸ªæ±‰å­—ï¼Œæ‰€ä»¥å ç”¨ 12 ä¸ªå­—èŠ‚ã€‚

```
position = 12
limit = 1024
capacity = 1024
```

**è°ƒç”¨ `flip()` æ–¹æ³•å**:

```
position = 0
limit = 12
capacity = 1024
```

ç”¨ä¸€å¹…å›¾æ¥è¡¨ç¤ºå°±æ˜¯ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/rumen-20230404155658.png)

å½“åˆ‡æ¢æˆè¯»æ¨¡å¼ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è¯»å–ç¼“å†²åŒºçš„æ•°æ®äº†ï¼š

```java
// åˆ›å»ºä¸€ä¸ªlimit()å¤§å°çš„å­—èŠ‚æ•°ç»„(å› ä¸ºå°±åªæœ‰limitè¿™ä¹ˆå¤šä¸ªæ•°æ®å¯è¯»)
byte[] bytes = new byte[byteBuffer.limit()];
// å°†è¯»å–çš„æ•°æ®è£…è¿›æˆ‘ä»¬çš„å­—èŠ‚æ•°ç»„ä¸­
byteBuffer.get(bytes);
// è¾“å‡ºæ•°æ®
System.out.println(new String(bytes, 0, bytes.length));
```

è¾“å‡ºåçš„ç»“æœï¼š

```
æ²‰é»˜ç‹äºŒ
```

éšåè¾“å‡ºä¸€ä¸‹æ ¸å¿ƒå˜é‡çš„å€¼çœ‹çœ‹ï¼š

![](https://cdn.tobebetterjavaer.com/stutymore/rumen-20230404160130.png)

**è¯»å®Œå¦‚ä½•è¿˜æƒ³å†™æ•°æ®åˆ°ç¼“å†²åŒº**ï¼Œé‚£å°±ä½¿ç”¨`clear()` æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šâ€œæ¸…ç©ºâ€ç¼“å†²åŒºï¼Œæ•°æ®æ²¡æœ‰çœŸæ­£è¢«æ¸…ç©ºï¼Œåªæ˜¯è¢«**é—å¿˜**æ‰äº†

![](https://cdn.tobebetterjavaer.com/stutymore/rumen-20230404160412.png)

### Channel é€šé“

Channel é€šé“**åªè´Ÿè´£ä¼ è¾“æ•°æ®ã€ä¸ç›´æ¥æ“ä½œæ•°æ®**ã€‚æ“ä½œæ•°æ®éƒ½æ˜¯é€šè¿‡ Buffer ç¼“å†²åŒºæ¥è¿›è¡Œæ“ä½œï¼é€šå¸¸ï¼Œé€šé“å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼šæ–‡ä»¶é€šé“å’Œå¥—æ¥å­—é€šé“ã€‚

FileChannelï¼šç”¨äºæ–‡ä»¶ I/O çš„é€šé“ï¼Œæ”¯æŒæ–‡ä»¶çš„è¯»ã€å†™å’Œè¿½åŠ æ“ä½œã€‚FileChannel å…è®¸åœ¨æ–‡ä»¶çš„ä»»æ„ä½ç½®è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œæ”¯æŒæ–‡ä»¶é”å®šä»¥åŠå†…å­˜æ˜ å°„æ–‡ä»¶ç­‰é«˜çº§åŠŸèƒ½ã€‚FileChannel æ— æ³•è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œå› æ­¤å®ƒåªé€‚ç”¨äºé˜»å¡å¼æ–‡ä»¶æ“ä½œã€‚

SocketChannelï¼šç”¨äº TCP å¥—æ¥å­— I/O çš„é€šé“ã€‚SocketChannel æ”¯æŒéé˜»å¡æ¨¡å¼ï¼Œå¯ä»¥ä¸ Selectorï¼ˆä¸‹æ–‡ä¼šè®²ï¼‰ä¸€èµ·ä½¿ç”¨ï¼Œå®ç°é«˜æ•ˆçš„ç½‘ç»œé€šä¿¡ã€‚SocketChannel å…è®¸è¿æ¥åˆ°è¿œç¨‹ä¸»æœºï¼Œè¿›è¡Œæ•°æ®ä¼ è¾“ã€‚

ä¸ä¹‹åŒ¹é…çš„æœ‰ServerSocketChannelï¼šç”¨äºç›‘å¬ TCP å¥—æ¥å­—è¿æ¥çš„é€šé“ã€‚ä¸ SocketChannel ç±»ä¼¼ï¼ŒServerSocketChannel ä¹Ÿæ”¯æŒéé˜»å¡æ¨¡å¼ï¼Œå¹¶å¯ä»¥ä¸ Selector ä¸€èµ·ä½¿ç”¨ã€‚ServerSocketChannel è´Ÿè´£ç›‘å¬æ–°çš„è¿æ¥è¯·æ±‚ï¼Œæ¥æ”¶åˆ°è¿æ¥è¯·æ±‚åï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ SocketChannel ä»¥å¤„ç†æ•°æ®ä¼ è¾“ã€‚

DatagramChannelï¼šç”¨äº UDP å¥—æ¥å­— I/O çš„é€šé“ã€‚DatagramChannel æ”¯æŒéé˜»å¡æ¨¡å¼ï¼Œå¯ä»¥å‘é€å’Œæ¥æ”¶æ•°æ®æŠ¥åŒ…ï¼Œé€‚ç”¨äºæ— è¿æ¥çš„ã€ä¸å¯é çš„ç½‘ç»œé€šä¿¡ã€‚

è¿™ç¯‡æˆ‘ä»¬ä¸»è¦æ¥è®² FileChannelï¼ŒSocketChannelã€ServerSocketChannel å’Œ DatagramChannel ä¼šæ”¾åˆ°[åé¢çš„ç« èŠ‚ä¸­](https://tobebetterjavaer.com/nio/network-connect.html)è®²è§£ã€‚

#### æ–‡ä»¶é€šé“ FileChannel

å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼æ‰“å¼€ä¸€ä¸ªé€šé“ã€‚

```java
FileChannel.open(Paths.get("docs/é…å¥—æ•™ç¨‹.md"), StandardOpenOption.WRITE);
```

è¿™é‡Œæˆ‘ä»¬ç”¨åˆ°äº† [Paths](https://tobebetterjavaer.com/nio/paths-files.html)ï¼Œè¿™ä¸ªåé¢ä¹Ÿä¼šè®²åˆ°ã€‚

â‘ ã€ä½¿ç”¨**FileChannel é…åˆ ByteBuffer ç¼“å†²åŒº**å®ç°æ–‡ä»¶å¤åˆ¶çš„åŠŸèƒ½ï¼š

```java
try (FileChannel sourceChannel = FileChannel.open(Paths.get("logs/javabetter/itwanger.txt"), StandardOpenOption.READ);
    FileChannel destinationChannel = FileChannel.open(Paths.get("logs/javabetter/itwanger1.txt"), StandardOpenOption.WRITE, StandardOpenOption.CREATE)) {

  ByteBuffer buffer = ByteBuffer.allocate(1024);

  while (sourceChannel.read(buffer) != -1) {
      buffer.flip();
      destinationChannel.write(buffer);
      buffer.clear();
  }
}
```

æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º 1024 çš„ ByteBuffer ä½œä¸ºç¼“å†²åŒºã€‚åœ¨å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬ä»æºæ–‡ä»¶çš„ FileChannel è¯»å–æ•°æ®åˆ°ç¼“å†²åŒºã€‚å½“ `read()` æ–¹æ³•è¿”å› -1 æ—¶ï¼Œè¡¨ç¤ºå·²ç»åˆ°è¾¾æ–‡ä»¶æœ«å°¾ã€‚

è¯»å–æ•°æ®åï¼Œæˆ‘ä»¬è°ƒç”¨ `flip()` æ–¹æ³•ï¼Œä»¥ä¾¿åœ¨ç¼“å†²åŒºä¸­å‡†å¤‡å¥½è¦å†™å…¥çš„æ•°æ®ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†ç¼“å†²åŒºçš„å†…å®¹å†™å…¥ç›®æ ‡æ–‡ä»¶çš„ FileChannelï¼ˆ`write()` æ–¹æ³•ï¼‰ã€‚åœ¨å†™å…¥å®Œæˆåï¼Œæˆ‘ä»¬è°ƒç”¨ `clear()` æ–¹æ³•é‡ç½®ç¼“å†²åŒºï¼Œä»¥ä¾¿åœ¨ä¸‹ä¸€æ¬¡è¿­ä»£ä¸­é‡ç”¨å®ƒã€‚

â‘¡ã€ä½¿ç”¨**å†…å­˜æ˜ å°„æ–‡ä»¶ï¼ˆMappedByteBufferï¼‰**çš„æ–¹å¼å®ç°**æ–‡ä»¶å¤åˆ¶**çš„åŠŸèƒ½(ç›´æ¥æ“ä½œç¼“å†²åŒº)ï¼š

```java
try (FileChannel sourceChannel = FileChannel.open(Paths.get("logs/javabetter/itwanger.txt"), StandardOpenOption.READ);
      FileChannel destinationChannel = FileChannel.open(Paths.get("logs/javabetter/itwanger2.txt"), StandardOpenOption.WRITE, StandardOpenOption.CREATE, StandardOpenOption.READ)) {

    long fileSize = sourceChannel.size();
    MappedByteBuffer sourceMappedBuffer = sourceChannel.map(FileChannel.MapMode.READ_ONLY, 0, fileSize);
    MappedByteBuffer destinationMappedBuffer = destinationChannel.map(FileChannel.MapMode.READ_WRITE, 0, fileSize);

    for (int i = 0; i < fileSize; i++) {
        byte b = sourceMappedBuffer.get(i);
        destinationMappedBuffer.put(i, b);
    }
}
```

MappedByteBuffer æ˜¯ Java NIO ä¸­çš„ä¸€ä¸ªç±»ï¼Œå®ƒç»§æ‰¿è‡ª `java.nio.ByteBuffer`ã€‚MappedByteBuffer ç”¨äºè¡¨ç¤ºä¸€ä¸ªå†…å­˜æ˜ å°„æ–‡ä»¶ï¼Œå³å°†æ–‡ä»¶çš„ä¸€éƒ¨åˆ†æˆ–å…¨éƒ¨æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œä»¥ä¾¿é€šè¿‡ç›´æ¥æ“ä½œå†…å­˜æ¥å®ç°å¯¹æ–‡ä»¶çš„è¯»å†™ã€‚è¿™ç§æ–¹å¼å¯ä»¥æé«˜æ–‡ä»¶ I/O çš„æ€§èƒ½ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿå¯ä»¥ç›´æ¥åœ¨å†…å­˜å’Œç£ç›˜ä¹‹é—´ä¼ è¾“æ•°æ®ï¼Œæ— éœ€é€šè¿‡ Java åº”ç”¨ç¨‹åºè¿›è¡Œé¢å¤–çš„æ•°æ®æ‹·è´ã€‚

é€šå¸¸ä¸ FileChannel ä¸€èµ·ä½¿ç”¨ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ FileChannel çš„ `map()` æ–¹æ³•åˆ›å»º MappedByteBuffer å¯¹è±¡ã€‚`map()` æ–¹æ³•æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šæ˜ å°„æ¨¡å¼ï¼ˆFileChannel.MapModeï¼‰æ˜ å°„èµ·å§‹ä½ç½®å’Œæ˜ å°„çš„é•¿åº¦ã€‚

æ˜ å°„æ¨¡å¼åŒ…æ‹¬åªè¯»æ¨¡å¼ï¼ˆREAD_ONLYï¼‰ã€è¯»å†™æ¨¡å¼ï¼ˆREAD_WRITEï¼‰å’Œä¸“ç”¨æ¨¡å¼ï¼ˆPRIVATEï¼‰ã€‚

æˆ‘ä»¬è®¾ç½®æºæ–‡ä»¶çš„ MappedByteBuffer ä¸ºåªè¯»æ¨¡å¼ï¼ˆREAD_ONLYï¼‰ï¼Œç›®æ ‡æ–‡ä»¶çš„ MappedByteBuffer ä¸ºè¯»å†™æ¨¡å¼ï¼ˆREAD_WRITEï¼‰ã€‚

åœ¨å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬é€å­—èŠ‚åœ°ä»æºæ–‡ä»¶çš„ MappedByteBuffer è¯»å–æ•°æ®å¹¶å°†å…¶å†™å…¥ç›®æ ‡æ–‡ä»¶çš„ MappedByteBufferã€‚è¿™æ ·å°±å®ç°äº†æ–‡ä»¶å¤åˆ¶åŠŸèƒ½ã€‚åˆ©ç”¨å†…å­˜æ˜ å°„æ–‡ä»¶ï¼ˆMappedByteBufferï¼‰å®ç°çš„æ–‡ä»¶å¤åˆ¶ï¼Œå¯èƒ½ä¼šæ¯”ä½¿ç”¨ ByteBuffer çš„æ–¹æ³•æ›´å¿«ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ MappedByteBuffer è¿›è¡Œæ–‡ä»¶æ“ä½œæ—¶ï¼Œæ•°æ®çš„ä¿®æ”¹å¯èƒ½ä¸ä¼šç«‹å³å†™å…¥ç£ç›˜ã€‚å¯ä»¥é€šè¿‡è°ƒç”¨ MappedByteBuffer çš„ `force()` æ–¹æ³•å°†æ•°æ®ç«‹å³å†™å›ç£ç›˜ã€‚

â‘¢ã€é€šé“ä¹‹é—´é€šè¿‡`transfer()`å®ç°æ•°æ®çš„ä¼ è¾“(ç›´æ¥æ“ä½œç¼“å†²åŒº)ï¼š

```java
try (FileChannel sourceChannel = FileChannel.open(Paths.get("logs/javabetter/itwanger.txt"), StandardOpenOption.READ);
      FileChannel destinationChannel = FileChannel.open(Paths.get("logs/javabetter/itwanger3.txt"), StandardOpenOption.WRITE, StandardOpenOption.CREATE, StandardOpenOption.READ)) {
    sourceChannel.transferTo(0, sourceChannel.size(), destinationChannel);
} catch (IOException e) {
    throw new RuntimeException(e);
}
```

FileChannel çš„ `transferTo()` æ–¹æ³•æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„æ–‡ä»¶ä¼ è¾“æ–¹æ³•ï¼Œå®ƒå…è®¸å°†æ–‡ä»¶çš„ä¸€éƒ¨åˆ†æˆ–å…¨éƒ¨å†…å®¹ç›´æ¥ä»æºæ–‡ä»¶é€šé“ä¼ è¾“åˆ°ç›®æ ‡é€šé“ï¼ˆé€šå¸¸æ˜¯å¦ä¸€ä¸ªæ–‡ä»¶é€šé“æˆ–ç½‘ç»œé€šé“ï¼‰ã€‚è¿™ç§ä¼ è¾“æ–¹å¼å¯ä»¥é¿å…å°†æ–‡ä»¶æ•°æ®åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´è¿›è¡Œå¤šæ¬¡æ‹·è´ï¼Œæé«˜äº†æ–‡ä»¶ä¼ è¾“çš„æ€§èƒ½ã€‚

`transferTo()` æ–¹æ³•æ¥å—ä»¥ä¸‹ä¸‰ä¸ªå‚æ•°ï¼š

- positionï¼šæºæ–‡ä»¶ä¸­å¼€å§‹ä¼ è¾“çš„ä½ç½®ã€‚
- countï¼šè¦ä¼ è¾“çš„å­—èŠ‚æ•°ã€‚
- targetï¼šæ¥æ”¶æ•°æ®çš„ç›®æ ‡é€šé“ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`transferTo()` æ–¹æ³•å¯èƒ½æ— æ³•ä¸€æ¬¡ä¼ è¾“æ‰€æœ‰è¯·æ±‚çš„å­—èŠ‚ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨å¾ªç¯æ¥ç¡®ä¿æ‰€æœ‰å­—èŠ‚éƒ½è¢«ä¼ è¾“ã€‚

```java
public class FileChannelTransferToLoopExampleWithPaths {
    public static void main(String[] args) {
        Path sourcePath = Paths.get("logs/itwanger/paicoding.txt");
        Path destinationPath = Paths.get("logs/itwanger/paicoding_copy.txt");

        // ä½¿ç”¨ try-with-resources è¯­å¥ç¡®ä¿é€šé“èµ„æºè¢«æ­£ç¡®å…³é—­
        try (FileChannel sourceChannel = FileChannel.open(sourcePath, StandardOpenOption.READ);
             FileChannel destinationChannel = FileChannel.open(destinationPath, StandardOpenOption.CREATE, StandardOpenOption.WRITE)) {

            long position = 0;
            long count = sourceChannel.size();

            // å¾ªç¯ä¼ è¾“ï¼Œç›´åˆ°æ‰€æœ‰å­—èŠ‚éƒ½è¢«ä¼ è¾“
            while (position < count) {
                long transferred = sourceChannel.transferTo(position, count - position, destinationChannel);
                position += transferred;
            }

        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

æ­¤å¤–ï¼Œ`transferTo()` æ–¹æ³•åœ¨åº•å±‚ä½¿ç”¨äº†æ“ä½œç³»ç»Ÿæä¾›çš„é›¶æ‹·è´åŠŸèƒ½ï¼ˆå¦‚ Linux çš„ `sendfile()` ç³»ç»Ÿè°ƒç”¨ï¼‰ï¼Œå¯ä»¥å¤§å¹…æé«˜æ–‡ä»¶ä¼ è¾“æ€§èƒ½ã€‚ä½†æ˜¯ï¼Œä¸åŒæ“ä½œç³»ç»Ÿå’Œ JVM å®ç°å¯èƒ½ä¼šå½±å“é›¶æ‹·è´çš„å¯ç”¨æ€§å’Œæ€§èƒ½ï¼Œå› æ­¤å®é™…æ€§èƒ½å¯èƒ½å› ç¯å¢ƒè€Œå¼‚ã€‚

é›¶æ‹·è´ï¼ˆZero-Copyï¼‰æ˜¯ä¸€ç§ä¼˜åŒ–æ•°æ®ä¼ è¾“æ€§èƒ½çš„æŠ€æœ¯ï¼Œå®ƒæœ€å¤§é™åº¦åœ°å‡å°‘äº†åœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­çš„ CPU å’Œå†…å­˜å¼€é”€ã€‚åœ¨ä¼ ç»Ÿçš„æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œæ•°æ®é€šå¸¸éœ€è¦åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´è¿›è¡Œå¤šæ¬¡æ‹·è´ï¼Œè¿™ä¼šå¯¼è‡´é¢å¤–çš„ CPU å’Œå†…å­˜å¼€é”€ã€‚é›¶æ‹·è´æŠ€æœ¯é€šè¿‡é¿å…è¿™äº›å¤šä½™çš„æ‹·è´æ“ä½œï¼Œå®ç°äº†æ›´é«˜æ•ˆçš„æ•°æ®ä¼ è¾“ã€‚

åœ¨ Java ä¸­ï¼Œé›¶æ‹·è´æŠ€æœ¯ä¸»è¦åº”ç”¨äºæ–‡ä»¶å’Œç½‘ç»œ I/Oã€‚FileChannel ç±»çš„ `transferTo()` å’Œ `transferFrom()` æ–¹æ³•å°±åˆ©ç”¨äº†é›¶æ‹·è´æŠ€æœ¯ï¼Œå¯ä»¥åœ¨æ–‡ä»¶å’Œç½‘ç»œé€šé“ä¹‹é—´é«˜æ•ˆåœ°ä¼ è¾“æ•°æ®ã€‚è¯¦ç»†å‚è€ƒï¼š[æ·±å…¥å‰–æLinux IOåŸç†å’Œå‡ ç§é›¶æ‹·è´æœºåˆ¶çš„å®ç°](https://zhuanlan.zhihu.com/p/83398714)

#### ç›´æ¥ä¸éç›´æ¥ç¼“å†²åŒº

ç›´æ¥ç¼“å†²åŒºå’Œéç›´æ¥ç¼“å†²åŒºçš„å·®åˆ«ä¸»è¦åœ¨äºå®ƒä»¬åœ¨å†…å­˜ä¸­çš„å­˜å‚¨æ–¹å¼ã€‚è¿™é‡Œç»™å‡ºäº†ç›´æ¥ç¼“å†²åŒºå’Œéç›´æ¥ç¼“å†²åŒºçš„ç®€è¦æ¦‚è¿°å’ŒåŒºåˆ«ï¼š

éç›´æ¥ç¼“å†²åŒºï¼š

- åˆ†é…åœ¨ JVM å †å†…å­˜ä¸­
- å—åˆ°åƒåœ¾å›æ”¶çš„ç®¡ç†
- åœ¨è¯»å†™æ“ä½œæ—¶ï¼Œéœ€è¦å°†æ•°æ®ä»å †å†…å­˜å¤åˆ¶åˆ°æ“ä½œç³»ç»Ÿçš„æœ¬åœ°å†…å­˜ï¼Œå†è¿›è¡Œ I/O æ“ä½œ
- åˆ›å»ºï¼š `ByteBuffer.allocate(int capacity)`

ç›´æ¥ç¼“å†²åŒºï¼š

- åˆ†é…åœ¨æ“ä½œç³»ç»Ÿçš„æœ¬åœ°å†…å­˜ä¸­
- ä¸å—åƒåœ¾å›æ”¶çš„ç®¡ç†
- åœ¨è¯»å†™æ“ä½œæ—¶ï¼Œç›´æ¥åœ¨æœ¬åœ°å†…å­˜ä¸­è¿›è¡Œï¼Œé¿å…äº†æ•°æ®å¤åˆ¶ï¼Œæé«˜äº†æ€§èƒ½
- åˆ›å»ºï¼š `ByteBuffer.allocateDirect(int capacity)`
- è¿˜æœ‰å‰é¢æåˆ°çš„ `FileChannel.map()` æ–¹æ³•ï¼Œä¼šè¿”å›ä¸€ä¸ªç±»å‹ä¸º MappedByteBuffer çš„ç›´æ¥ç¼“å†²åŒºã€‚

ByteBuffer.allocateå’ŒByteBuffer.allocateDirectç›´æ¥çš„å·®å¼‚ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/buffer-channel-selector-20230406183808.png)


ç›´æ¥ç¼“å†²åŒºå’Œéç›´æ¥ç¼“å†²åŒºä¹‹é—´çš„å·®å¼‚ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/buffer-channel-selector-20230406182921.png)

éç›´æ¥ç¼“å†²åŒºå­˜å‚¨åœ¨JVMå†…éƒ¨ï¼Œæ•°æ®éœ€è¦ä»åº”ç”¨ç¨‹åºï¼ˆJavaï¼‰å¤åˆ¶åˆ°éç›´æ¥ç¼“å†²åŒºï¼Œå†å¤åˆ¶åˆ°å†…æ ¸ç¼“å†²åŒºï¼Œæœ€åå‘é€åˆ°è®¾å¤‡ï¼ˆç£ç›˜/ç½‘ç»œï¼‰ã€‚è€Œå¯¹äºç›´æ¥ç¼“å†²åŒºï¼Œæ•°æ®å¯ä»¥ç›´æ¥ä»åº”ç”¨ç¨‹åºï¼ˆJavaï¼‰å¤åˆ¶åˆ°å†…æ ¸ç¼“å†²åŒºï¼Œæ— éœ€ç»è¿‡JVMçš„éç›´æ¥ç¼“å†²åŒºã€‚

#### å¼‚æ­¥æ–‡ä»¶é€šé“ AsynchronousFileChannel

AsynchronousFileChannel æ˜¯ Java 7 å¼•å…¥çš„ä¸€ä¸ªå¼‚æ­¥æ–‡ä»¶é€šé“ç±»ï¼Œæä¾›äº†å¯¹æ–‡ä»¶çš„å¼‚æ­¥è¯»ã€å†™ã€æ‰“å¼€å’Œå…³é—­ç­‰æ“ä½œã€‚

å¯ä»¥é€šè¿‡ `AsynchronousFileChannel.open()` æ–¹æ³•æ‰“å¼€ä¸€ä¸ªå¼‚æ­¥æ–‡ä»¶é€šé“ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª [Path å¯¹è±¡](https://tobebetterjavaer.com/nio/paths-files.html)å’Œä¸€ç»„æ‰“å¼€é€‰é¡¹ï¼ˆå¦‚ StandardOpenOption.READã€StandardOpenOption.WRITE ç­‰ï¼‰ä½œä¸ºå‚æ•°ã€‚

```java
Path file = Paths.get("example.txt");
AsynchronousFileChannel fileChannel = AsynchronousFileChannel.open(file, StandardOpenOption.READ, StandardOpenOption.WRITE);
```

AsynchronousFileChannel æä¾›äº†ä¸¤ç§å¼‚æ­¥æ“ä½œçš„æ–¹å¼ï¼š

**â‘ ã€Future æ–¹å¼**ï¼šä½¿ç”¨ [Future](https://tobebetterjavaer.com/thread/callable-future-futuretask.html) å¯¹è±¡æ¥è·Ÿè¸ªå¼‚æ­¥æ“ä½œçš„å®Œæˆæƒ…å†µã€‚å½“æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼ˆå¦‚ `read()` æˆ– `write()`ï¼‰æ—¶ï¼Œå®ƒä¼šç«‹å³è¿”å›ä¸€ä¸ª Future å¯¹è±¡ã€‚å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¯¹è±¡æ¥æ£€æŸ¥æ“ä½œæ˜¯å¦å®Œæˆï¼Œä»¥åŠè·å–æ“ä½œçš„ç»“æœã€‚è¿™ç§æ–¹å¼é€‚ç”¨äºä¸éœ€è¦åœ¨æ“ä½œå®Œæˆæ—¶ç«‹å³æ‰§è¡Œå…¶ä»–æ“ä½œçš„åœºæ™¯ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

```java
ByteBuffer buffer = ByteBuffer.allocate(1024);
long position = 0;
Future<Integer> result = fileChannel.read(buffer, position);

while (!result.isDone()) {
    // æ‰§è¡Œå…¶ä»–æ“ä½œ
}

int bytesRead = result.get();
System.out.println("Bytes read: " + bytesRead);
```

**â‘¡ã€CompletionHandler æ–¹å¼**ï¼Œä½¿ç”¨ä¸€ä¸ªå®ç°äº† CompletionHandler æ¥å£çš„å¯¹è±¡æ¥å¤„ç†å¼‚æ­¥æ“ä½œçš„å®Œæˆã€‚æˆ‘ä»¬éœ€è¦æä¾›ä¸€ä¸ª CompletionHandler å®ç°ç±»ï¼Œé‡å†™ `completed()` å’Œ `failed()` æ–¹æ³•ï¼Œåˆ†åˆ«å¤„ç†æ“ä½œæˆåŠŸå’Œæ“ä½œå¤±è´¥çš„æƒ…å†µã€‚å½“å¼‚æ­¥æ“ä½œå®Œæˆæ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨ç›¸åº”çš„æ–¹æ³•ã€‚è¿™ç§æ–¹å¼é€‚ç”¨äºéœ€è¦åœ¨æ“ä½œå®Œæˆæ—¶ç«‹å³æ‰§è¡Œå…¶ä»–æ“ä½œçš„åœºæ™¯ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

```java
ByteBuffer buffer = ByteBuffer.allocate(1024);
long position = 0;

fileChannel.read(buffer, position, buffer, new CompletionHandler<Integer, ByteBuffer>() {
    @Override
    public void completed(Integer result, ByteBuffer attachment) {
        System.out.println("Bytes read: " + result);
    }

    @Override
    public void failed(Throwable exc, ByteBuffer attachment) {
        System.err.println("Read failed");
        exc.printStackTrace();
    }
});
```

æ¥çœ‹å®Œæ•´çš„ç¤ºä¾‹ï¼Œé‡‡ç”¨ Future çš„å½¢å¼ã€‚

```java
Path path = Paths.get("docs/é…å¥—æ•™ç¨‹.md");

try (AsynchronousFileChannel fileChannel = AsynchronousFileChannel.open(path, StandardOpenOption.READ)) {
    ByteBuffer buffer = ByteBuffer.allocate(1024);
    long position = 0;

    while (true) {
        Future<Integer> result = fileChannel.read(buffer, position);

        while (!result.isDone()) {
            // åœ¨è¿™é‡Œå¯ä»¥æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œä¾‹å¦‚å¤„ç†å…¶ä»– I/O æ“ä½œ
        }

        int bytesRead = result.get();
        if (bytesRead <= 0) {
            break;
        }

        position += bytesRead;
        buffer.flip();

        byte[] data = new byte[buffer.limit()];
        buffer.get(data);
        System.out.println(new String(data));

        buffer.clear();
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `AsynchronousFileChannel.read()` æ–¹æ³•å‘èµ·å¼‚æ­¥è¯»å–æ“ä½œã€‚è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª `Future<Integer>` å¯¹è±¡ï¼Œè¡¨ç¤ºè¯»å–æ“ä½œçš„ç»“æœã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨ `isDone()` æ–¹æ³•æ¥æ£€æŸ¥å¼‚æ­¥æ“ä½œæ˜¯å¦å®Œæˆã€‚å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨ `get()` æ–¹æ³•è·å–å®é™…è¯»å–çš„å­—èŠ‚æ•°ã€‚

ç„¶åæˆ‘ä»¬æ¥çœ‹ CompletionHandler æ¥å£çš„å½¢å¼ï¼š

```java
public static void readAllBytes(Path path) throws IOException, InterruptedException {
    AsynchronousFileChannel fileChannel = AsynchronousFileChannel.open(path, StandardOpenOption.READ);
    ByteBuffer buffer = ByteBuffer.allocate(1024);
    AtomicLong position = new AtomicLong(0);
    CountDownLatch latch = new CountDownLatch(1);

    fileChannel.read(buffer, position.get(), null, new CompletionHandler<Integer, Object>() {
        @Override
        public void completed(Integer bytesRead, Object attachment) {
            if (bytesRead > 0) {
                position.addAndGet(bytesRead);
                buffer.flip();
                byte[] data = new byte[buffer.limit()];
                buffer.get(data);
                System.out.print(new String(data));
                buffer.clear();

                fileChannel.read(buffer, position.get(), attachment, this);
            } else {
                latch.countDown();
                try {
                    fileChannel.close();
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        }

        @Override
        public void failed(Throwable exc, Object attachment) {
            System.out.println("Error: " + exc.getMessage());
            latch.countDown();
        }
    });

    latch.await();
}
```

1ã€åœ¨ readAllBytes æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `AsynchronousFileChannel.open()` æ–¹æ³•ä»¥è¯»å–æ¨¡å¼æ‰“å¼€å¼‚æ­¥æ–‡ä»¶é€šé“ã€‚

2ã€åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º 1024 çš„ ByteBuffer æ¥å­˜å‚¨ä»æ–‡ä»¶ä¸­è¯»å–çš„æ•°æ®ã€‚

3ã€ä½¿ç”¨ [AtomicLong](https://tobebetterjavaer.com/thread/atomic.html) ç±»å‹çš„ position å˜é‡æ¥è®°å½•å½“å‰è¯»å–çš„æ–‡ä»¶ä½ç½®ã€‚åˆå§‹å€¼ä¸º 0ã€‚

4ã€åˆ›å»ºä¸€ä¸ª [CountDownLatch](https://tobebetterjavaer.com/thread/CountDownLatch.html) å¯¹è±¡ï¼Œç”¨äºåœ¨å¼‚æ­¥æ“ä½œå®Œæˆæ—¶é€šçŸ¥ä¸»çº¿ç¨‹ã€‚åˆå§‹å€¼ä¸º 1ã€‚

5ã€ä½¿ç”¨ `fileChannel.read()` æ–¹æ³•å¯åŠ¨å¼‚æ­¥è¯»å–æ“ä½œã€‚è¿™ä¸ªæ–¹æ³•çš„å‚æ•°åŒ…æ‹¬ï¼šç”¨äºå­˜å‚¨æ•°æ®çš„ç¼“å†²åŒºã€å½“å‰è¯»å–ä½ç½®ã€é™„åŠ å¯¹è±¡ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­ä¸éœ€è¦ï¼Œæ‰€ä»¥ä¼ é€’ nullï¼‰ä»¥åŠä¸€ä¸ªå®ç°äº† CompletionHandler æ¥å£çš„å¯¹è±¡ï¼Œç”¨äºåœ¨è¯»å–æ“ä½œå®Œæˆæ—¶å›è°ƒã€‚

6ã€CompletionHandler æ¥å£æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š`completed()` å’Œ `failed()`ã€‚åœ¨è¯»å–æ“ä½œæˆåŠŸå®Œæˆæ—¶è°ƒç”¨ `completed()` æ–¹æ³•ï¼›å¦‚æœè¯»å–æ“ä½œå¤±è´¥ï¼Œè°ƒç”¨ `failed()` æ–¹æ³•ã€‚

7ã€åœ¨ `completed()` æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆæ£€æŸ¥ bytesReadï¼ˆæœ¬æ¬¡è¯»å–çš„å­—èŠ‚æ•°ï¼‰æ˜¯å¦å¤§äº 0ã€‚å¦‚æœå¤§äº 0ï¼Œè¯´æ˜è¿˜æœ‰æ•°æ®éœ€è¦è¯»å–ã€‚

- æ›´æ–° position å˜é‡ï¼Œå°†å…¶å¢åŠ  bytesReadã€‚
- å°†ç¼“å†²åŒºç¿»è½¬ï¼ˆ`flip()`ï¼‰ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ä»ä¸­è¯»å–æ•°æ®ã€‚
- åˆ›å»ºä¸€ä¸ªæ–°çš„å­—èŠ‚æ•°ç»„ï¼Œå…¶å¤§å°ç­‰äºç¼“å†²åŒºçš„é™åˆ¶ï¼ˆ`limit()`ï¼‰ã€‚
- ä»ç¼“å†²åŒºä¸­è·å–æ•°æ®å¹¶å°†å…¶å­˜å‚¨åœ¨æ–°åˆ›å»ºçš„å­—èŠ‚æ•°ç»„ä¸­ã€‚
- å°†å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶è¾“å‡ºã€‚
- æ¸…é™¤ç¼“å†²åŒºï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ç»§ç»­è¯»å–æ›´å¤šæ•°æ®ã€‚
- å†æ¬¡è°ƒç”¨ fileChannel.read() æ–¹æ³•ï¼Œä»¥ç»§ç»­ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚

8ã€å¦‚æœ bytesRead ç­‰äºæˆ–å°äº 0ï¼Œè¯´æ˜æˆ‘ä»¬å·²ç»è¯»å–å®Œæ–‡ä»¶ä¸­çš„æ‰€æœ‰æ•°æ®ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ï¼šè°ƒç”¨ `latch.countDown()` æ–¹æ³•ï¼Œä»¥é€šçŸ¥ä¸»çº¿ç¨‹å¼‚æ­¥æ“ä½œå·²å®Œæˆã€‚å…³é—­ fileChannelã€‚

9ã€å¦‚æœè¯»å–æ“ä½œå¤±è´¥ï¼Œæˆ‘ä»¬å°†åœ¨ `failed()` æ–¹æ³•ä¸­è¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶è°ƒç”¨ `latch.countDown()` æ–¹æ³•é€šçŸ¥ä¸»çº¿ç¨‹ã€‚

10ã€æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨ `latch.await()` æ–¹æ³•æ¥ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆã€‚ä¸»çº¿ç¨‹å°†åœ¨æ­¤å¤„é˜»å¡ï¼Œç›´åˆ° latch çš„è®¡æ•°å˜ä¸º 0ã€‚

### å°ç»“

Java NIO ä¸­çš„ Buffer å’Œ Channel æ˜¯ NIO ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ã€‚Buffer è´Ÿè´£å­˜å‚¨æ•°æ®ï¼Œæä¾›äº†å¯¹æ•°æ®çš„è¯»å†™æ“ä½œã€‚å®ƒæœ‰å¤šç§ç±»å‹ï¼Œå¦‚ ByteBufferã€CharBufferã€IntBuffer ç­‰ï¼Œä»¥æ”¯æŒä¸åŒçš„æ•°æ®ç±»å‹ã€‚

Channel ä»£è¡¨äº†ä¸ I/O è®¾å¤‡ï¼ˆå¦‚æ–‡ä»¶æˆ–å¥—æ¥å­—ï¼‰ä¹‹é—´çš„è¿æ¥ã€‚å®ƒæä¾›äº†ä»æºè®¾å¤‡åˆ° Buffer çš„æ•°æ®è¯»å–èƒ½åŠ›å’Œä» Buffer åˆ°ç›®æ ‡è®¾å¤‡çš„æ•°æ®å†™å…¥èƒ½åŠ›ã€‚Channel å¯ä»¥æ˜¯å¯è¯»ã€å¯å†™æˆ–åŒæ—¶å¯è¯»å†™çš„ï¼Œæˆ‘ä»¬è¯¦ç»†ä»‹ç»äº†æ–‡ä»¶é€šé“ FileChannel å’Œå¼‚æ­¥æ–‡ä»¶é€šé“ AsynchronousFileChannelã€‚

æ€»ä¹‹ï¼ŒNIO ä½¿ç”¨ Buffer å’Œ Channel è¿™ä¸¤ä¸ªç»„ä»¶æ¥è¿›è¡Œé«˜æ•ˆçš„æ•°æ®ä¼ è¾“ï¼Œä»¥æé«˜ I/O æ“ä½œçš„æ€§èƒ½ã€‚

> å‚è€ƒé“¾æ¥ï¼š[https://www.zhihu.com/question/29005375/answer/667616386](https://www.zhihu.com/question/29005375/answer/667616386)ï¼Œæ•´ç†ï¼šæ²‰é»˜ç‹äºŒ

---

æœ€è¿‘æ•´ç†äº†ä¸€ä»½ç‰›é€¼çš„å­¦ä¹ èµ„æ–™ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº Java åŸºç¡€éƒ¨åˆ†ï¼ˆJVMã€Java é›†åˆæ¡†æ¶ã€å¤šçº¿ç¨‹ï¼‰ï¼Œè¿˜å›Šæ‹¬äº† **æ•°æ®åº“ã€è®¡ç®—æœºç½‘ç»œã€ç®—æ³•ä¸æ•°æ®ç»“æ„ã€è®¾è®¡æ¨¡å¼ã€æ¡†æ¶ç±» Springã€Nettyã€å¾®æœåŠ¡ï¼ˆDubboï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ ç½‘å…³** ç­‰ç­‰ç­‰ç­‰â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¯ä»¥è¯´æ˜¯ 2022 å¹´å…¨ç½‘æœ€å…¨çš„å­¦ä¹ å’Œæ‰¾å·¥ä½œçš„ PDF èµ„æºäº†](https://tobebetterjavaer.com/pdf/programmer-111.html)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 12.4 Paths å’Œ Files

Paths å’Œ Files åœ¨ Java 7 çš„æ—¶å€™å¼•å…¥ï¼Œä½œä¸ºå¯¹ [`java.io.File` ç±»](https://tobebetterjavaer.com/io/file-path.html)çš„è¡¥å……å’Œæ”¹è¿›ã€‚

### Paths ç±»

Paths ç±»ä¸»è¦ç”¨äºæ“ä½œæ–‡ä»¶å’Œç›®å½•è·¯å¾„ã€‚å®ƒæä¾›äº†ä¸€äº›é™æ€æ–¹æ³•ï¼Œç”¨äºåˆ›å»º`java.nio.file.Path`å®ä¾‹ï¼Œä»£è¡¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„è·¯å¾„ã€‚

ä¸‹é¢æ˜¯ Paths çš„ä¸€ä¸ªç¤ºä¾‹ã€‚

```java
// åˆ›å»ºä¸€ä¸ªPathå®ä¾‹ï¼Œè¡¨ç¤ºå½“å‰ç›®å½•ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶
Path path = Paths.get("example.txt");

// åˆ›å»ºä¸€ä¸ªç»å¯¹è·¯å¾„
Path absolutePath = Paths.get("/home/user/example.txt");
```

java.nio.file.Path æ¥å£åœ¨ Java NIO.2 ä¸­ä»£è¡¨ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­çš„è·¯å¾„ã€‚å®ƒæä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•æ¥æ“ä½œå’ŒæŸ¥è¯¢è·¯å¾„ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/paths-files-20230404181334.png)

ä¸‹é¢æ˜¯ Paths å’Œ Path ä¸€èµ·ä½¿ç”¨çš„å®ä¾‹ï¼š

```java
Path path = Paths.get("docs/é…å¥—æ•™ç¨‹.md");

// è·å–æ–‡ä»¶å
System.out.println("File name: " + path.getFileName());

// è·å–çˆ¶ç›®å½•
System.out.println("Parent: " + path.getParent());

// è·å–æ ¹ç›®å½•
System.out.println("Root: " + path.getRoot());

// å°†è·¯å¾„ä¸å¦ä¸€ä¸ªè·¯å¾„ç»“åˆ
Path newPath = path.resolve("config/app.properties");
System.out.println("Resolved path: " + newPath);

// ç®€åŒ–è·¯å¾„
Path normalizedPath = newPath.normalize();
System.out.println("Normalized path: " + normalizedPath);

// å°†ç›¸å¯¹è·¯å¾„è½¬æ¢ä¸ºç»å¯¹è·¯å¾„
Path absolutePath = path.toAbsolutePath();
System.out.println("Absolute path: " + absolutePath);

// è®¡ç®—ä¸¤ä¸ªè·¯å¾„ä¹‹é—´çš„ç›¸å¯¹è·¯å¾„
Path basePath = Paths.get("/docs/");
Path targetPath = Paths.get("/docs/imgs/itwanger");
Path relativePath = basePath.relativize(targetPath);
System.out.println("Relative path: " + relativePath);
```

### Files ç±»

`java.nio.file.Files`ç±»æä¾›äº†å¤§é‡é™æ€æ–¹æ³•ï¼Œç”¨äºå¤„ç†æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶å’Œç›®å½•ã€‚è¿™äº›æ–¹æ³•åŒ…æ‹¬æ–‡ä»¶çš„åˆ›å»ºã€åˆ é™¤ã€å¤åˆ¶ã€ç§»åŠ¨ç­‰æ“ä½œï¼Œä»¥åŠè¯»å–å’Œè®¾ç½®æ–‡ä»¶å±æ€§ã€‚

ä¸‹é¢å±•ç¤ºä¸€ä¸ª Files å’Œ Paths ä¸€èµ·ä½¿ç”¨çš„ç¤ºä¾‹ï¼š

```java
// åˆ›å»ºä¸€ä¸ªPathå®ä¾‹
Path path = Paths.get("logs/javabetter/itwanger4.txt");

// åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶
Files.createFile(path);

// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
boolean exists = Files.exists(path);
System.out.println("File exists: " + exists);

// åˆ é™¤æ–‡ä»¶
Files.delete(path);
```

ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨æ–¹æ³•åŠå…¶ç¤ºä¾‹ï¼š

1ã€`exists(Path path, LinkOption... options)`ï¼šæ£€æŸ¥æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨ã€‚

```java
Path path = Paths.get("file.txt");
boolean exists = Files.exists(path);
System.out.println("File exists: " + exists);
```

LinkOption æ˜¯ä¸€ä¸ªæšä¸¾ç±»ï¼Œå®ƒå®šä¹‰äº†å¦‚ä½•å¤„ç†æ–‡ä»¶ç³»ç»Ÿé“¾æ¥çš„é€‰é¡¹ã€‚å®ƒä½äº java.nio.file åŒ…ä¸­ã€‚LinkOption ä¸»è¦åœ¨ä¸æ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„æ“ä½œç›¸å…³çš„æ–¹æ³•ä¸­ä½¿ç”¨ï¼Œä»¥æ§åˆ¶è¿™äº›æ–¹æ³•å¦‚ä½•å¤„ç†ç¬¦å·é“¾æ¥ã€‚ç¬¦å·é“¾æ¥æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„æ–‡ä»¶ï¼Œå®ƒåœ¨ Unix å’Œç±» Unix ç³»ç»Ÿï¼ˆå¦‚ Linux å’Œ macOSï¼‰ä¸Šå¾ˆå¸¸è§ã€‚åœ¨ Windows ä¸Šï¼Œç±»ä¼¼çš„æ¦‚å¿µè¢«ç§°ä¸ºå¿«æ·æ–¹å¼ã€‚

2ã€`createFile(Path path, FileAttribute<?>... attrs)`ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºæ–‡ä»¶ã€‚

```java
Path newPath = Paths.get("newFile.txt");
Files.createFile(newPath);
```

FileAttribute æ˜¯ä¸€ä¸ªæ³›å‹æ¥å£ï¼Œç”¨äºå¤„ç†å„ç§ä¸åŒç±»å‹çš„å±æ€§ã€‚åœ¨ä½¿ç”¨ FileAttribute æ—¶ï¼Œä½ éœ€è¦ä¸ºå…¶æä¾›ä¸€ä¸ªç‰¹å®šçš„å®ç°ã€‚`java.nio.file.attribute` åŒ…ä¸­çš„ PosixFileAttributes ç±»æä¾›äº† POSIXï¼ˆPortable Operating System Interfaceï¼Œå®šä¹‰äº†è®¸å¤šä¸æ–‡ä»¶ç³»ç»Ÿç›¸å…³çš„æ“ä½œï¼ŒåŒ…æ‹¬æ–‡ä»¶å’Œç›®å½•çš„åˆ›å»ºã€åˆ é™¤ã€è¯»å–å’Œä¿®æ”¹ã€‚ï¼‰æ–‡ä»¶å±æ€§çš„å®ç°ã€‚

```java
Path path = Paths.get("fileWithPermissions.txt");

Set<PosixFilePermission> permissions = PosixFilePermissions.fromString("rw-r-----");
FileAttribute<Set<PosixFilePermission>> fileAttribute = PosixFilePermissions.asFileAttribute(permissions);

Files.createFile(path, fileAttribute);
```

PosixFileAttributes æ¥å£æä¾›äº†è·å– POSIX æ–‡ä»¶å±æ€§çš„æ–¹æ³•ï¼Œå¦‚æ–‡ä»¶æ‰€æœ‰è€…ã€æ–‡ä»¶æ‰€å±çš„ç»„ä»¥åŠæ–‡ä»¶çš„è®¿é—®æƒé™ã€‚ä»¥ä¸Šç¤ºä¾‹ä¼šåˆ›å»ºä¸€ä¸ªè¯»å†™å±æ€§çš„æ–‡ä»¶ã€‚

3ã€`createDirectory(Path dir, FileAttribute<?>... attrs)`ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç›®å½•ã€‚

```java
Path newDir = Paths.get("newDirectory");
Files.createDirectory(newDir);
```

4ã€`delete(Path path)`ï¼šåˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ã€‚

```java
Path pathToDelete = Paths.get("fileToDelete.txt");
Files.delete(pathToDelete);
```

5ã€`copy(Path source, Path target, CopyOption... options)`ï¼šå¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•ã€‚

```java
Path sourcePath = Paths.get("sourceFile.txt");
Path targetPath = Paths.get("targetFile.txt");
Files.copy(sourcePath, targetPath, StandardCopyOption.REPLACE_EXISTING);
```

åœ¨ Java NIO ä¸­ï¼Œæœ‰ä¸¤ä¸ªå®ç°äº† CopyOption æ¥å£çš„æšä¸¾ç±»ï¼šStandardCopyOption å’Œ LinkOptionã€‚

StandardCopyOption æšä¸¾ç±»æä¾›äº†ä»¥ä¸‹ä¸¤ä¸ªé€‰é¡¹ï¼š

- REPLACE_EXISTINGï¼šå¦‚æœç›®æ ‡æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œè¯¥é€‰é¡¹ä¼šä½¿ `Files.copy()` æ–¹æ³•æ›¿æ¢ç›®æ ‡æ–‡ä»¶ã€‚å¦‚æœä¸æŒ‡å®šæ­¤é€‰é¡¹ï¼Œ`Files.copy()` æ–¹æ³•åœ¨ç›®æ ‡æ–‡ä»¶å·²å­˜åœ¨æ—¶å°†æŠ›å‡º FileAlreadyExistsExceptionã€‚
- COPY_ATTRIBUTESï¼šæ­¤é€‰é¡¹è¡¨ç¤ºåœ¨å¤åˆ¶æ–‡ä»¶æ—¶ï¼Œå°½å¯èƒ½åœ°å¤åˆ¶æ–‡ä»¶çš„å±æ€§ï¼ˆå¦‚æ–‡ä»¶æ—¶é—´æˆ³ã€æƒé™ç­‰ï¼‰ã€‚å¦‚æœä¸æŒ‡å®šæ­¤é€‰é¡¹ï¼Œé‚£ä¹ˆç›®æ ‡æ–‡ä»¶å°†å…·æœ‰é»˜è®¤çš„å±æ€§ã€‚

6ã€`move(Path source, Path target, CopyOption... options)`ï¼šç§»åŠ¨æˆ–é‡å‘½åæ–‡ä»¶æˆ–ç›®å½•ã€‚

```java
Path sourcePath = Paths.get("sourceFile.txt");
Path targetPath = Paths.get("targetFile.txt");
Files.move(sourcePath, targetPath, StandardCopyOption.REPLACE_EXISTING);
```

7ã€`readAllLines(Path path, Charset cs)`ï¼šè¯»å–æ–‡ä»¶çš„æ‰€æœ‰è¡Œåˆ°ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ã€‚

```java
Path path = Paths.get("file.txt");
List<String> lines = Files.readAllLines(path, StandardCharsets.UTF_8);
lines.forEach(System.out::println);
```

8ã€`write(Path path, Iterable<? extends CharSequence> lines, Charset cs, OpenOption... options)`ï¼šå°†å­—ç¬¦ä¸²åˆ—è¡¨å†™å…¥æ–‡ä»¶ã€‚

```java
Path path = Paths.get("file.txt");
List<String> lines = Arrays.asList("æ²‰é»˜ç‹äºŒ 1", "æ²‰é»˜ç‹äºŒ 2", "æ²‰é»˜ç‹äºŒ 3");
Files.write(path, lines, StandardCharsets.UTF_8);
```

OpenOption æ˜¯ Java NIO ä¸­ä¸€ä¸ªç”¨äºé…ç½®æ–‡ä»¶æ“ä½œçš„æ¥å£ã€‚å®ƒæä¾›äº†åœ¨ä½¿ç”¨ `Files.newByteChannel()`ã€`Files.newInputStream()`ã€`Files.newOutputStream()`ã€`AsynchronousFileChannel.open()` å’Œ `FileChannel.open()` æ–¹æ³•æ—¶å®šåˆ¶è¡Œä¸ºçš„é€‰é¡¹ã€‚

åœ¨ Java NIO ä¸­ï¼Œæœ‰ä¸¤ä¸ªå®ç°äº† OpenOption æ¥å£çš„æšä¸¾ç±»ï¼šStandardOpenOption å’Œ LinkOptionã€‚

StandardOpenOption æšä¸¾ç±»æä¾›äº†ä»¥ä¸‹å‡ ä¸ªé€‰é¡¹ï¼š

- READï¼šä»¥è¯»å–æ¨¡å¼æ‰“å¼€æ–‡ä»¶ã€‚
- WRITEï¼šä»¥å†™å…¥æ¨¡å¼æ‰“å¼€æ–‡ä»¶ã€‚
- APPENDï¼šä»¥è¿½åŠ æ¨¡å¼æ‰“å¼€æ–‡ä»¶ã€‚
- TRUNCATE_EXISTINGï¼šåœ¨æ‰“å¼€æ–‡ä»¶æ—¶ï¼Œæˆªæ–­æ–‡ä»¶çš„å†…å®¹ï¼Œä½¿å…¶é•¿åº¦ä¸º 0ã€‚ä»…é€‚ç”¨äº WRITE æˆ– APPEND æ¨¡å¼ã€‚
- CREATEï¼šå½“æ–‡ä»¶ä¸å­˜åœ¨æ—¶åˆ›å»ºæ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ™æ‰“å¼€æ–‡ä»¶ã€‚
- CREATE_NEWï¼šå½“æ–‡ä»¶ä¸å­˜åœ¨æ—¶åˆ›å»ºæ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼ŒæŠ›å‡º FileAlreadyExistsExceptionã€‚
- DELETE_ON_CLOSEï¼šåœ¨å…³é—­é€šé“æ—¶åˆ é™¤æ–‡ä»¶ã€‚
- SPARSEï¼šæç¤ºæ–‡ä»¶ç³»ç»Ÿåˆ›å»ºä¸€ä¸ªç¨€ç–æ–‡ä»¶ã€‚
- SYNCï¼šè¦æ±‚æ¯æ¬¡æ›´æ–°æ–‡ä»¶çš„å†…å®¹æˆ–å…ƒæ•°æ®æ—¶éƒ½è¿›è¡ŒåŒæ­¥ã€‚
- DSYNCï¼šè¦æ±‚æ¯æ¬¡æ›´æ–°æ–‡ä»¶å†…å®¹æ—¶éƒ½è¿›è¡ŒåŒæ­¥ã€‚

8ã€`newBufferedReader(Path path, Charset cs) å’Œ newBufferedWriter(Path path, Charset cs, OpenOption... options)`ï¼šåˆ›å»º BufferedReader å’Œ BufferedWriter å¯¹è±¡ä»¥è¯»å–å’Œå†™å…¥æ–‡ä»¶ã€‚

```java
Path path = Paths.get("file.txt");

// Read file
try (BufferedReader reader = Files.newBufferedReader(path, StandardCharsets.UTF_8)) {
    String line;
    while ((line = reader.readLine()) != null) {
        System.out.println(line);
    }
}

// Write file
Path outputPath = Paths.get("outputFile.txt");
try (BufferedWriter writer = Files.newBufferedWriter(outputPath, StandardCharsets.UTF_8)) {
    writer.write("æ²‰é»˜ç‹äºŒ");
}
```

#### Files.walkFileTree() é™æ€æ–¹æ³•

è¿™ä¸ªæ–¹æ³•å¯ä»¥é€’å½’åœ°è®¿é—®ç›®å½•ç»“æ„ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ï¼Œå¹¶å…è®¸æ‚¨å¯¹è¿™äº›æ–‡ä»¶å’Œç›®å½•æ‰§è¡Œè‡ªå®šä¹‰æ“ä½œã€‚ä½¿ç”¨ walkFileTree æ–¹æ³•æ—¶ï¼Œéœ€è¦æä¾›ä¸€ä¸ªèµ·å§‹è·¯å¾„ï¼ˆèµ·å§‹ç›®å½•ï¼‰å’Œä¸€ä¸ªå®ç°äº† FileVisitor æ¥å£çš„å¯¹è±¡ã€‚FileVisitor æ¥å£åŒ…å«å››ä¸ªæ–¹æ³•ï¼Œå®ƒä»¬åœ¨éå†è¿‡ç¨‹ä¸­çš„ä¸åŒé˜¶æ®µè¢«è°ƒç”¨ï¼š

- preVisitDirectoryï¼šåœ¨è®¿é—®ç›®å½•ä¹‹å‰è°ƒç”¨ã€‚
- postVisitDirectoryï¼šåœ¨è®¿é—®ç›®å½•ä¹‹åè°ƒç”¨ã€‚
- visitFileï¼šåœ¨è®¿é—®æ–‡ä»¶æ—¶è°ƒç”¨ã€‚
- visitFileFailedï¼šåœ¨è®¿é—®æ–‡ä»¶å¤±è´¥æ—¶è°ƒç”¨ã€‚

æ¥çœ‹ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ï¼š

```java
public class WalkFileTreeExample {
    public static void main(String[] args) {
        Path startingDir = Paths.get("docs");
        MyFileVisitor fileVisitor = new MyFileVisitor();

        try {
            Files.walkFileTree(startingDir, fileVisitor);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    private static class MyFileVisitor extends SimpleFileVisitor<Path> {
        @Override
        public FileVisitResult preVisitDirectory(Path dir, BasicFileAttributes attrs) throws IOException {
            System.out.println("å‡†å¤‡è®¿é—®ç›®å½•: " + dir);
            return FileVisitResult.CONTINUE;
        }

        @Override
        public FileVisitResult postVisitDirectory(Path dir, IOException exc) throws IOException {
            System.out.println("æ­£åœ¨è®¿é—®ç›®å½•: " + dir);
            return FileVisitResult.CONTINUE;
        }

        @Override
        public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException {
            System.out.println("è®¿é—®æ–‡ä»¶: " + file);
            return FileVisitResult.CONTINUE;
        }

        @Override
        public FileVisitResult visitFileFailed(Path file, IOException exc) throws IOException {
            System.err.println("è®¿é—®æ–‡ä»¶å¤±è´¥: " + file);
            return FileVisitResult.CONTINUE;
        }
    }
}
```

è¿è¡Œç»“æœå¦‚ä¸‹ï¼š

```
å‡†å¤‡è®¿é—®ç›®å½•: docs
è®¿é—®æ–‡ä»¶: docs/å®‰è£…ç¯å¢ƒ.md
å‡†å¤‡è®¿é—®ç›®å½•: docs/imgs
è®¿é—®æ–‡ä»¶: docs/imgs/init_03.jpg
å‡†å¤‡è®¿é—®ç›®å½•: docs/imgs/itwanger
è®¿é—®æ–‡ä»¶: docs/imgs/itwanger/tongzhishu.jpeg
è®¿é—®æ–‡ä»¶: docs/imgs/itwanger/tongzhishu1.jpeg
è®¿é—®æ–‡ä»¶: docs/imgs/itwanger/tongzhishu1.pdf
æ­£åœ¨è®¿é—®ç›®å½•: docs/imgs/itwanger
è®¿é—®æ–‡ä»¶: docs/imgs/init_02.jpg
è®¿é—®æ–‡ä»¶: docs/imgs/init_00.jpg
è®¿é—®æ–‡ä»¶: docs/imgs/init_01.jpg
è®¿é—®æ–‡ä»¶: docs/imgs/init_04.jpg
æ­£åœ¨è®¿é—®ç›®å½•: docs/imgs
è®¿é—®æ–‡ä»¶: docs/æœåŠ¡å™¨å¯åŠ¨æ•™ç¨‹.md
è®¿é—®æ–‡ä»¶: docs/é…å¥—æ•™ç¨‹.md
è®¿é—®æ–‡ä»¶: docs/çº¦å®š.md
è®¿é—®æ–‡ä»¶: docs/æœ¬åœ°å¼€å‘ç¯å¢ƒé…ç½®æ•™ç¨‹.md
è®¿é—®æ–‡ä»¶: docs/å‰ç«¯å·¥ç¨‹ç»“æ„è¯´æ˜.md
æ­£åœ¨è®¿é—®ç›®å½•: docs
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º MyFileVisitor çš„è‡ªå®šä¹‰ FileVisitor ç±»ï¼Œå®ƒæ‰©å±•äº† SimpleFileVisitor ç±»ã€‚SimpleFileVisitor æ˜¯ FileVisitor æ¥å£çš„ä¸€ä¸ªå®ç°ï¼Œå®ƒæä¾›äº†ä¸€äº›é»˜è®¤çš„è¡Œä¸ºã€‚æˆ‘ä»¬å¯ä»¥è¦†ç›– SimpleFileVisitor ä¸­çš„æ–¹æ³•ä»¥å®ç°è‡ªå·±çš„é€»è¾‘ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯æ‰“å°å‡ºäº†è®¿é—®çš„æ–‡ä»¶å’Œç›®å½•ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ Files.walkFileTree æ–¹æ³•éå†æ–‡ä»¶æ ‘ã€‚è¿™ä¸ªæ–¹æ³•ä¼šéå†æ•´ä¸ªç›®å½•ç»“æ„ï¼Œå¹¶è°ƒç”¨ MyFileVisitor ä¸­çš„ç›¸åº”æ–¹æ³•ã€‚

å…¶ä¸­ï¼ŒFileVisitResult æšä¸¾åŒ…å«ä»¥ä¸‹å››ä¸ªé€‰é¡¹ï¼š

- CONTINUE ï¼š ç»§ç»­
- TERMINATE ï¼š ç»ˆæ­¢
- SKIP_SIBLINGS ï¼š è·³è¿‡å…„å¼ŸèŠ‚ç‚¹ï¼Œç„¶åç»§ç»­
- SKIP_SUBTREE ï¼š è·³è¿‡å­æ ‘ï¼ˆä¸è®¿é—®æ­¤ç›®å½•çš„æ¡ç›®ï¼‰ï¼Œç„¶åç»§ç»­ï¼Œä»…åœ¨ preVisitDirectory æ–¹æ³•è¿”å›æ—¶æ‰æœ‰æ„ä¹‰ï¼Œé™¤æ­¤ä»¥å¤–å’Œ CONTINUE ç›¸åŒã€‚

#### æœç´¢æ–‡ä»¶

`walkFileTree()` æ–¹æ³•è¿˜å¯ä»¥ç”¨äºæœç´¢æ–‡ä»¶ï¼Œä¸‹é¢è¿™ä¸ªä¾‹å­æ‰©å±•äº† SimpleFileVisitor æ¥æŸ¥æ‰¾ä¸€ä¸ªåä¸º itwanger.txt çš„æ–‡ä»¶ï¼š

```java
public class FindFileWithWalkFileTree {
    public static void main(String[] args) {
        Path startingDir = Paths.get("logs");
        String targetFileName = "itwanger.txt";
        FindFileVisitor findFileVisitor = new FindFileVisitor(targetFileName);

        try {
            Files.walkFileTree(startingDir, findFileVisitor);
            if (findFileVisitor.isFileFound()) {
                System.out.println("æ‰¾åˆ°æ–‡ä»¶äº†: " + findFileVisitor.getFoundFilePath());
            } else {
                System.out.println("oohï¼Œæ–‡ä»¶æ²¡æ‰¾åˆ°");
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    private static class FindFileVisitor extends SimpleFileVisitor<Path> {
        private String targetFileName;
        private Path foundFilePath;

        public FindFileVisitor(String targetFileName) {
            this.targetFileName = targetFileName;
        }

        public boolean isFileFound() {
            return foundFilePath != null;
        }

        public Path getFoundFilePath() {
            return foundFilePath;
        }

        @Override
        public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException {
            String fileName = file.getFileName().toString();
            if (fileName.equals(targetFileName)) {
                foundFilePath = file;
                return FileVisitResult.TERMINATE;
            }
            return FileVisitResult.CONTINUE;
        }
    }
}
```

åœ¨ä¸»æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Files.walkFileTree æ–¹æ³•éå†æ–‡ä»¶æ ‘ï¼Œå¹¶ä¼ é€’ä¸€ä¸ªèµ·å§‹ç›®å½•å’Œ FindFileVisitor å®ä¾‹ã€‚éå†å®Œæˆåï¼Œæˆ‘ä»¬æ£€æŸ¥æ˜¯å¦æ‰¾åˆ°äº†ç›®æ ‡æ–‡ä»¶ï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œå°±æ‰“å°å‡ºå®ƒçš„è·¯å¾„ã€‚

æœç´¢ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

![](https://cdn.tobebetterjavaer.com/stutymore/paths-files-20230404190926.png)

### å°ç»“

Paths å’Œ Files æ˜¯ Java NIO ä¸­çš„ä¸¤ä¸ªæ ¸å¿ƒç±»ã€‚Paths æä¾›äº†ä¸€ç³»åˆ—é™æ€æ–¹æ³•ï¼Œç”¨äºæ“ä½œè·¯å¾„ï¼ˆPath å¯¹è±¡ï¼‰ã€‚å®ƒå¯ä»¥å°†å­—ç¬¦ä¸²æˆ– URI è½¬æ¢ä¸º Path å¯¹è±¡ï¼Œæ–¹ä¾¿åç»­æ“ä½œã€‚Files ç±»æä¾›äº†ä¸°å¯Œçš„æ–‡ä»¶æ“ä½œæ–¹æ³•ï¼Œå¦‚æ–‡ä»¶çš„åˆ›å»ºã€åˆ é™¤ã€ç§»åŠ¨ã€å¤åˆ¶ã€è¯»å–å’Œå†™å…¥ç­‰ã€‚è¿™äº›æ–¹æ³•æ”¯æŒå„ç§é€‰é¡¹å’Œå±æ€§ï¼Œå¦‚è¦†ç›–ã€ä¿ç•™å±æ€§å’Œç¬¦å·é“¾æ¥å¤„ç†ã€‚Files è¿˜æ”¯æŒæ–‡ä»¶éå†ï¼ˆå¦‚ walkFileTree æ–¹æ³•ï¼‰ï¼Œå¯ä»¥å¤„ç†æ–‡ä»¶ç›®å½•æ ‘ã€‚æ€»ä¹‹ï¼ŒPaths å’Œ Files ä¸ºæ–‡ä»¶å’Œç›®å½•æ“ä½œæä¾›äº†ç®€æ´ã€é«˜æ•ˆçš„æ–¹æ³•ã€‚

---

æœ€è¿‘æ•´ç†äº†ä¸€ä»½ç‰›é€¼çš„å­¦ä¹ èµ„æ–™ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº Java åŸºç¡€éƒ¨åˆ†ï¼ˆJVMã€Java é›†åˆæ¡†æ¶ã€å¤šçº¿ç¨‹ï¼‰ï¼Œè¿˜å›Šæ‹¬äº† **æ•°æ®åº“ã€è®¡ç®—æœºç½‘ç»œã€ç®—æ³•ä¸æ•°æ®ç»“æ„ã€è®¾è®¡æ¨¡å¼ã€æ¡†æ¶ç±» Springã€Nettyã€å¾®æœåŠ¡ï¼ˆDubboï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ ç½‘å…³** ç­‰ç­‰ç­‰ç­‰â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¯ä»¥è¯´æ˜¯ 2022 å¹´å…¨ç½‘æœ€å…¨çš„å­¦ä¹ å’Œæ‰¾å·¥ä½œçš„ PDF èµ„æºäº†](https://tobebetterjavaer.com/pdf/programmer-111.html)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 12.5 NIO å®ç°ç®€æ˜“ç‰ˆèŠå¤©å®¤

åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬æ›¾åˆ©ç”¨ Java çš„å¥—æ¥å­— Socket å’Œ ServerSocket å®Œæˆ[ç½‘ç»œç¼–ç¨‹](https://tobebetterjavaer.com/socket/socket.html)ï¼Œä½† Socket å’Œ ServerSocket æ˜¯åŸºäº Java IO çš„ï¼Œåœ¨ç½‘ç»œç¼–ç¨‹æ–¹é¢ï¼Œæ€§èƒ½ä¼šæ¯”è¾ƒå·®ã€‚[åŸå› æˆ‘ä»¬åœ¨ä¹‹å‰ä¹Ÿè®²è¿‡](https://tobebetterjavaer.com/nio/nio-better-io.html)ã€‚

é‚£ Java NIO çš„ SocketChannel å’Œ ServerSocketChannel æ€§èƒ½æ€ä¹ˆæ ·å‘¢ï¼Ÿ

### SocketChannel å’Œ ServerSocketChannel

åœ¨å­¦ä¹  NIO çš„[ç¬¬ä¸€è®²é‡Œ](https://tobebetterjavaer.com/nio/nio-better-io.html)ï¼Œæˆ‘ä»¬å·²ç»ä»‹ç»è¿‡ SocketChannel å’Œ ServerSocketChanneläº†ï¼Œè¿™é‡Œå†ç®€å•è¡¥å……ä¸‹ã€‚

ServerSocketChannel ç”¨äºåˆ›å»ºæœåŠ¡å™¨ç«¯å¥—æ¥å­—ï¼Œè€Œ SocketChannel ç”¨äºåˆ›å»ºå®¢æˆ·ç«¯å¥—æ¥å­—ã€‚å®ƒä»¬éƒ½æ”¯æŒé˜»å¡å’Œéé˜»å¡æ¨¡å¼ï¼Œé€šè¿‡è®¾ç½®å…¶ blocking å±æ€§æ¥åˆ‡æ¢ã€‚é˜»å¡æ¨¡å¼ä¸‹ï¼Œè¯»/å†™æ“ä½œä¼šä¸€ç›´é˜»å¡ç›´åˆ°å®Œæˆï¼Œè€Œéé˜»å¡æ¨¡å¼ä¸‹ï¼Œè¯»/å†™æ“ä½œä¼šç«‹å³è¿”å›ã€‚

é˜»å¡æ¨¡å¼ï¼š

- ä¼˜ç‚¹ï¼šç¼–ç¨‹ç®€å•ï¼Œé€‚åˆä½å¹¶å‘åœºæ™¯ã€‚
- ç¼ºç‚¹ï¼šæ€§èƒ½è¾ƒå·®ï¼Œä¸é€‚åˆé«˜å¹¶å‘åœºæ™¯ã€‚

éé˜»å¡æ¨¡å¼ï¼š

- ä¼˜ç‚¹ï¼šæ€§èƒ½æ›´å¥½ï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯ã€‚
- ç¼ºç‚¹ï¼šç¼–ç¨‹ç›¸å¯¹å¤æ‚ã€‚

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼ˆé˜»å¡æ¨¡å¼ä¸‹ï¼‰ï¼š

å…ˆæ¥çœ‹ Server ç«¯çš„ï¼š

```java
public class BlockingServer {
    public static void main(String[] args) throws IOException {
        // åˆ›å»ºæœåŠ¡å™¨å¥—æ¥å­—
        ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();
        // ç»‘å®šç«¯å£
        serverSocketChannel.socket().bind(new InetSocketAddress(8080));
        // è®¾ç½®ä¸ºé˜»å¡æ¨¡å¼ï¼ˆé»˜è®¤ä¸ºé˜»å¡æ¨¡å¼ï¼‰
        serverSocketChannel.configureBlocking(true);

        while (true) {
            // æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥
            SocketChannel socketChannel = serverSocketChannel.accept();
            // åˆ†é…ç¼“å†²åŒº
            ByteBuffer buffer = ByteBuffer.allocate(1024);

            // è¯»å–æ•°æ®
            int bytesRead = socketChannel.read(buffer);
            while (bytesRead != -1) {
                buffer.flip();
                System.out.println(StandardCharsets.UTF_8.decode(buffer));
                buffer.clear();
                bytesRead = socketChannel.read(buffer);
            }
            // å…³é—­å¥—æ¥å­—
            socketChannel.close();
        }
    }
}
```

ç®€å•è§£é‡Šä¸€ä¸‹è¿™æ®µä»£ç ï¼Œä¹Ÿæ¯”è¾ƒå¥½ç†è§£ã€‚

é¦–å…ˆåˆ›å»ºæœåŠ¡å™¨ç«¯å¥—æ¥å­—ServerSocketChannelï¼Œç„¶åç»‘å®š 8080 ç«¯å£ï¼Œæ¥ç€ä½¿ç”¨ while å¾ªç¯ç›‘å¬å®¢æˆ·ç«¯å¥—æ¥å­—ã€‚å¦‚æœæ¥æ”¶åˆ°å®¢æˆ·ç«¯è¿æ¥ SocketChannelï¼Œå°±ä»é€šé“é‡Œè¯»å–æ•°æ®åˆ°ç¼“å†²åŒº ByteBufferï¼Œä¸€ç›´è¯»åˆ°é€šé“é‡Œæ²¡æœ‰æ•°æ®ï¼Œå…³é—­å½“å‰é€šé“ã€‚

å…¶ä¸­ `serverSocketChannel.configureBlocking(true)` ç”¨æ¥è®¾ç½®é€šé“ä¸ºé˜»å¡æ¨¡å¼ï¼ˆå¯ä»¥ç¼ºçœï¼‰ã€‚

å†æ¥çœ‹å®¢æˆ·ç«¯çš„ï¼š

```java
public class BlockingClient {
    public static void main(String[] args) throws IOException {
        // åˆ›å»ºå®¢æˆ·ç«¯å¥—æ¥å­—
        SocketChannel socketChannel = SocketChannel.open();
        // è¿æ¥æœåŠ¡å™¨
        socketChannel.connect(new InetSocketAddress("localhost", 8080));
        // åˆ†é…ç¼“å†²åŒº
        ByteBuffer buffer = ByteBuffer.allocate(1024);

        // å‘æœåŠ¡å™¨å‘é€æ•°æ®
        buffer.put("æ²‰é»˜ç‹äºŒï¼Œè¿™æ˜¯æ¥è‡ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯ã€‚".getBytes(StandardCharsets.UTF_8));
        buffer.flip();
        socketChannel.write(buffer);
        // æ¸…ç©ºç¼“å†²åŒº
        buffer.clear();

        // å…³é—­å¥—æ¥å­—
        socketChannel.close();
    }
}
```

å®¢æˆ·ç«¯ä»£ç å°±æ›´ç®€å•äº†ï¼Œå»ºç«‹é€šé“ SocketChannelï¼Œè¿æ¥æœåŠ¡å™¨ï¼Œç„¶ååœ¨ç¼“å†²åŒºé‡Œæ”¾ä¸€æ®µæ•°æ®ï¼Œä¹‹åå†™å…¥åˆ°é€šé“ä¸­ï¼Œå…³é—­å¥—æ¥å­—ã€‚

å…ˆè¿è¡Œ BlockingServerï¼Œå†è¿è¡Œ BlockingClientï¼Œå¯ä»¥åœ¨ Server ç«¯çš„æ§åˆ¶å°æ”¶åˆ°ä»¥ä¸‹ä¿¡æ¯ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/network-connect-20230407124624.png)

å¥½ï¼Œæˆ‘ä»¬å†æ¥çœ‹éé˜»å¡æ¨¡å¼ä¸‹çš„ç¤ºä¾‹ã€‚

å…ˆæ¥çœ‹ Server ç«¯ï¼š

```java
public class NonBlockingServer {
    public static void main(String[] args) throws IOException {
        // åˆ›å»ºæœåŠ¡å™¨å¥—æ¥å­—
        ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();
        // ç»‘å®šç«¯å£
        serverSocketChannel.socket().bind(new InetSocketAddress(8080));
        // è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼
        serverSocketChannel.configureBlocking(false);

        // åˆ›å»ºé€‰æ‹©å™¨
        Selector selector = Selector.open();
        // æ³¨å†ŒæœåŠ¡å™¨å¥—æ¥å­—åˆ°é€‰æ‹©å™¨
        serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);

        while (true) {
            selector.select();
            Set<SelectionKey> selectedKeys = selector.selectedKeys();
            Iterator<SelectionKey> iterator = selectedKeys.iterator();

            while (iterator.hasNext()) {
                SelectionKey key = iterator.next();
                iterator.remove();

                if (key.isAcceptable()) {
                    // æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥
                    SocketChannel socketChannel = serverSocketChannel.accept();
                    socketChannel.configureBlocking(false);
                    socketChannel.register(selector, SelectionKey.OP_READ);
                }

                if (key.isReadable()) {
                    // è¯»å–æ•°æ®
                    SocketChannel socketChannel = (SocketChannel) key.channel();
                    ByteBuffer buffer = ByteBuffer.allocate(1024);
                    int bytesRead = socketChannel.read(buffer);

                    if (bytesRead != -1) {
                        buffer.flip();
                        System.out.print(StandardCharsets.UTF_8.decode(buffer));
                        buffer.clear();
                    } else {
                        // å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥ï¼Œå–æ¶ˆé€‰æ‹©é”®å¹¶å…³é—­é€šé“
                        key.cancel();
                        socketChannel.close();
                    }
                }
            }
        }
    }
}
```

ä¸ä¹‹å‰é˜»å¡æ¨¡å¼ç›¸åŒçš„ï¼Œæˆ‘ä»¬å°±ä¸å†èµ˜è¿°äº†ï¼Œåªè¯´ä¸åŒçš„ã€‚

â‘ ã€é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ª ServerSocketChannelï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ã€‚

```java
ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();
serverSocketChannel.configureBlocking(false);
```

â‘¡ã€åˆ›å»ºä¸€ä¸ª Selector å®ä¾‹ï¼Œç”¨äºå¤„ç†å¤šä¸ªé€šé“çš„äº‹ä»¶ã€‚

```java
Selector selector = Selector.open();
```

â‘¢ã€å°† ServerSocketChannel æ³¨å†Œåˆ° Selector ä¸Šï¼Œå¹¶è®¾ç½®æ„Ÿå…´è¶£çš„äº‹ä»¶ä¸º OP_ACCEPTã€‚è¿™æ„å‘³ç€å½“æœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚æ—¶ï¼ŒSelector ä¼šé€šçŸ¥æˆ‘ä»¬ã€‚

```java
serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);
```

çœ‹ä¸€ä¸‹ OP_ACCEPT çš„æ³¨é‡Šï¼š

![](https://cdn.tobebetterjavaer.com/stutymore/network-connect-20230407130621.png)


â‘£ã€å¾ªç¯å¤„ç† Selector ä¸­çš„äº‹ä»¶ã€‚é¦–å…ˆè°ƒç”¨ `selector.select()` æ–¹æ³•æ¥ç­‰å¾…æ„Ÿå…´è¶£çš„äº‹ä»¶å‘ç”Ÿã€‚è¿™ä¸ªæ–¹æ³•ä¼šé˜»å¡ï¼Œç›´åˆ°è‡³å°‘æœ‰ä¸€ä¸ªæ„Ÿå…´è¶£çš„äº‹ä»¶å‘ç”Ÿã€‚

```java
while (true) {
    int readyChannels = selector.select();
    if (readyChannels == 0) {
        continue;
    }
    // ...
}
```

â‘¤ã€å½“ `selector.select()` è¿”å›æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `selector.selectedKeys()` è·å–æ‰€æœ‰å·²å°±ç»ªçš„äº‹ä»¶ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè¿­ä»£å¤„ç†ã€‚åœ¨å¤„ç†äº‹ä»¶æ—¶ï¼Œæ ¹æ® SelectionKey çš„ç±»å‹æ¥æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚

```java
Set<SelectionKey> selectedKeys = selector.selectedKeys();
Iterator<SelectionKey> keyIterator = selectedKeys.iterator();
while (keyIterator.hasNext()) {
    SelectionKey key = keyIterator.next();
    // å¤„ç†äº‹ä»¶
    // ...
    keyIterator.remove();
}
```

â‘¥ã€å½“ SelectionKey çš„ç±»å‹ä¸º OP_ACCEPT æ—¶ï¼Œè¯´æ˜æœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ¥å—æ–°çš„è¿æ¥ï¼Œå¹¶å°†æ–°åˆ›å»ºçš„ SocketChannel è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ã€‚ç„¶åï¼Œå°†è¯¥ SocketChannel æ³¨å†Œåˆ° Selector ä¸Šï¼Œå¹¶è®¾ç½®æ„Ÿå…´è¶£çš„äº‹ä»¶ä¸º OP_READã€‚

```java
if (key.isAcceptable()) {
    ServerSocketChannel server = (ServerSocketChannel) key.channel();
    SocketChannel client = server.accept();
    client.configureBlocking(false);
    client.register(selector, SelectionKey.OP_READ);
}
```

â‘¦ã€å½“ SelectionKey çš„ç±»å‹ä¸º OP_READ æ—¶ï¼Œè¯´æ˜æœ‰å®¢æˆ·ç«¯å‘é€äº†æ•°æ®ã€‚æˆ‘ä»¬éœ€è¦ä» SocketChannel ä¸­è¯»å–æ•°æ®ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚

```java
if (key.isReadable()) {
    SocketChannel client = (SocketChannel) key.channel();
    ByteBuffer buffer = ByteBuffer.allocate(1024);
    int bytesRead = client.read(buffer);
    // å¯¹è¯»å–åˆ°çš„æ•°æ®è¿›è¡Œå¤„ç†
    // ...
}
```

â‘§ã€ï¼ˆå¦‚æœå¯ä»¥çš„è¯ï¼‰å½“ SelectionKey çš„ç±»å‹ä¸º OP_WRITE æ—¶ï¼Œè¯´æ˜å¯ä»¥å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥å°†è¦å‘é€çš„æ•°æ®å†™å…¥ SocketChannelã€‚

```java
if (key.isWritable()) {
    SocketChannel client = (SocketChannel) key.channel();
    ByteBuffer buffer = ByteBuffer.wrap("ä½ å¥½ï¼Œå®¢æˆ·ç«¯".getBytes());
   client.write(buffer);
}
```

ä¸è¿‡ï¼Œæœ¬ä¾‹ä¸­å¹¶æ²¡æœ‰è¿™ä¸€æ­¥ã€‚å¦‚æœéœ€è¦çš„è¯ï¼Œå¯ä»¥æŒ‰ç…§è¿™æ ·çš„æ–¹å¼å‘å®¢æˆ·ç«¯å†™å…¥æ•°æ®ã€‚

â‘¨ã€åœ¨æœåŠ¡å™¨åœæ­¢è¿è¡Œæ—¶ï¼Œéœ€è¦å…³é—­ Selector å’Œ ServerSocketChannelï¼Œé‡Šæ”¾èµ„æºã€‚

```java
key.cancel();
socketChannel.close();
```

å¥½ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹å®¢æˆ·ç«¯çš„ã€‚

```java
public class NonBlockingClient {
    public static void main(String[] args) throws IOException {
        // åˆ›å»ºå®¢æˆ·ç«¯å¥—æ¥å­—
        SocketChannel socketChannel = SocketChannel.open();
        // è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼
        socketChannel.configureBlocking(false);
        // è¿æ¥æœåŠ¡å™¨
        socketChannel.connect(new InetSocketAddress("localhost", 8080));

        while (!socketChannel.finishConnect()) {
            // ç­‰å¾…è¿æ¥å®Œæˆ
        }

        // åˆ†é…ç¼“å†²åŒº
        ByteBuffer buffer = ByteBuffer.allocate(1024);

        // å‘æœåŠ¡å™¨å‘é€æ•°æ®
        String message = "ä½ å¥½ï¼Œæ²‰é»˜ç‹äºŒï¼Œè¿™æ˜¯æ¥è‡ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯ã€‚";
        buffer.put(message.getBytes(StandardCharsets.UTF_8));
        buffer.flip();
        socketChannel.write(buffer);
        // æ¸…ç©ºç¼“å†²åŒº
        buffer.clear();

        // å…³é—­å¥—æ¥å­—
        socketChannel.close();
    }
}
```

å®¢æˆ·ç«¯ä»£ç ä¾ç„¶æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬ç›´æ¥ç•¥è¿‡ï¼Œä¸å†è§£é‡Šã€‚ç„¶åè¿è¡Œ Serverï¼Œå†è¿è¡Œ Clientã€‚å¯ä»¥è¿è¡Œå¤šæ¬¡ï¼Œç»“æœå¦‚ä¸‹ï¼š

![](https://cdn.tobebetterjavaer.com/stutymore/network-connect-20230407131553.png)

### Scatter å’Œ Gather

Scatter å’Œ Gather æ˜¯ Java NIO ä¸­ä¸¤ç§é«˜æ•ˆçš„ I/O æ“ä½œï¼Œç”¨äºå°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªç¼“å†²åŒºæˆ–ä»å¤šä¸ªç¼“å†²åŒºä¸­æ”¶é›†æ•°æ®ã€‚

Scatterï¼ˆåˆ†æ•£ï¼‰ï¼šå®ƒå°†ä» Channel è¯»å–çš„æ•°æ®åˆ†æ•£ï¼ˆå†™å…¥ï¼‰åˆ°å¤šä¸ªç¼“å†²åŒºã€‚è¿™ç§æ“ä½œå¯ä»¥åœ¨è¯»å–æ•°æ®æ—¶å°†å…¶åˆ†æ•£åˆ°ä¸åŒçš„ç¼“å†²åŒºï¼Œæœ‰åŠ©äºå¤„ç†ç»“æ„åŒ–æ•°æ®ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¶ˆæ¯å¤´ã€æ¶ˆæ¯ä½“å’Œæ¶ˆæ¯å°¾åˆ†åˆ«å†™å…¥ä¸åŒçš„ç¼“å†²åŒºã€‚

Gatherï¼ˆèšé›†ï¼‰ï¼šä¸ Scatter ç›¸åï¼Œå®ƒå°†å¤šä¸ªç¼“å†²åŒºä¸­çš„æ•°æ®èšé›†ï¼ˆè¯»å–ï¼‰å¹¶å†™å…¥åˆ°ä¸€ä¸ª Channelã€‚è¿™ç§æ“ä½œå…è®¸æˆ‘ä»¬åœ¨å‘é€æ•°æ®æ—¶ä»å¤šä¸ªç¼“å†²åŒºä¸­èšé›†æ•°æ®ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¶ˆæ¯å¤´ã€æ¶ˆæ¯ä½“å’Œæ¶ˆæ¯å°¾ä»ä¸åŒçš„ç¼“å†²åŒºä¸­èšé›†åˆ°ä¸€èµ·å¹¶å†™å…¥åˆ°åŒä¸€ä¸ª Channelã€‚

æ¥å†™ä¸€ä¸ªå®Œæ•´çš„ demoï¼Œå…ˆçœ‹ Serverã€‚

```java
// åˆ›å»ºä¸€ä¸ªServerSocketChannel
ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();
serverSocketChannel.socket().bind(new InetSocketAddress(9000));

// æ¥å—è¿æ¥
SocketChannel socketChannel = serverSocketChannel.accept();

// Scatterï¼šåˆ†æ•£è¯»å–æ•°æ®åˆ°å¤šä¸ªç¼“å†²åŒº
ByteBuffer headerBuffer = ByteBuffer.allocate(128);
ByteBuffer bodyBuffer = ByteBuffer.allocate(1024);

ByteBuffer[] buffers = {headerBuffer, bodyBuffer};

long bytesRead = socketChannel.read(buffers);

// è¾“å‡ºç¼“å†²åŒºæ•°æ®
headerBuffer.flip();
while (headerBuffer.hasRemaining()) {
    System.out.print((char) headerBuffer.get());
}

System.out.println();

bodyBuffer.flip();
while (bodyBuffer.hasRemaining()) {
    System.out.print((char) bodyBuffer.get());
}

// Gatherï¼šèšé›†æ•°æ®ä»å¤šä¸ªç¼“å†²åŒºå†™å…¥åˆ°Channel
ByteBuffer headerResponse = ByteBuffer.wrap("Header Response".getBytes());
ByteBuffer bodyResponse = ByteBuffer.wrap("Body Response".getBytes());

ByteBuffer[] responseBuffers = {headerResponse, bodyResponse};

long bytesWritten = socketChannel.write(responseBuffers);

// å…³é—­è¿æ¥
socketChannel.close();
serverSocketChannel.close();
```

å†æ¥çœ‹ Clientï¼š

```java
// åˆ›å»ºä¸€ä¸ªSocketChannel
SocketChannel socketChannel = SocketChannel.open();
socketChannel.connect(new InetSocketAddress("localhost", 9000));

// å‘é€æ•°æ®åˆ°æœåŠ¡å™¨
String header = "Header Content";
String body = "Body Content";

ByteBuffer headerBuffer = ByteBuffer.wrap(header.getBytes());
ByteBuffer bodyBuffer = ByteBuffer.wrap(body.getBytes());

ByteBuffer[] buffers = {headerBuffer, bodyBuffer};
socketChannel.write(buffers);

// ä»æœåŠ¡å™¨æ¥æ”¶æ•°æ®
ByteBuffer headerResponseBuffer = ByteBuffer.allocate(128);
ByteBuffer bodyResponseBuffer = ByteBuffer.allocate(1024);

ByteBuffer[] responseBuffers = {headerResponseBuffer, bodyResponseBuffer};

long bytesRead = socketChannel.read(responseBuffers);

// è¾“å‡ºæ¥æ”¶åˆ°çš„æ•°æ®
headerResponseBuffer.flip();
while (headerResponseBuffer.hasRemaining()) {
    System.out.print((char) headerResponseBuffer.get());
}

bodyResponseBuffer.flip();
while (bodyResponseBuffer.hasRemaining()) {
    System.out.print((char) bodyResponseBuffer.get());
}

// å…³é—­è¿æ¥
socketChannel.close();
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Scattering ä» SocketChannel åˆ†æ•£è¯»å–æ•°æ®åˆ°å¤šä¸ªç¼“å†²åŒºï¼Œå¹¶ä½¿ç”¨ Gathering å°†æ•°æ®ä»å¤šä¸ªç¼“å†²åŒºèšé›†å†™å…¥åˆ° SocketChannelã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°å¤„ç†å¤šä¸ªç¼“å†²åŒºä¸­çš„æ•°æ®ã€‚

### å¼‚æ­¥å¥—æ¥å­—é€šé“ AsynchronousSocketChannel å’Œ AsynchronousServerSocketChannel

AsynchronousSocketChannel å’Œ AsynchronousServerSocketChannel æ˜¯ Java 7 å¼•å…¥çš„å¼‚æ­¥ I/O ç±»ï¼Œåˆ†åˆ«ç”¨äºå¤„ç†å¼‚æ­¥å®¢æˆ·ç«¯ Socket å’ŒæœåŠ¡å™¨ç«¯ ServerSocketã€‚å¼‚æ­¥ I/O å…è®¸åœ¨ I/O æ“ä½œè¿›è¡Œæ—¶æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œå¹¶åœ¨æ“ä½œå®Œæˆæ—¶æ¥æ”¶é€šçŸ¥ï¼Œæé«˜äº†å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚

æ¥çœ‹ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå…ˆçœ‹æœåŠ¡å™¨ç«¯ã€‚

```java
public class AsynchronousServer {

    public static void main(String[] args) throws IOException, InterruptedException {
        AsynchronousServerSocketChannel server = AsynchronousServerSocketChannel.open();
        server.bind(new InetSocketAddress("localhost", 5000));

        System.out.println("æœåŠ¡å™¨ç«¯å¯åŠ¨");

        server.accept(null, new CompletionHandler<AsynchronousSocketChannel, Void>() {
            @Override
            public void completed(AsynchronousSocketChannel client, Void attachment) {
                // æ¥æ”¶ä¸‹ä¸€ä¸ªè¿æ¥è¯·æ±‚
                server.accept(null, this);

                ByteBuffer buffer = ByteBuffer.allocate(1024);
                Future<Integer> readResult = client.read(buffer);

                try {
                    readResult.get();
                    buffer.flip();
                    String message = new String(buffer.array(), 0, buffer.remaining());
                    System.out.println("æ¥æ”¶åˆ°çš„æ¶ˆæ¯: " + message);
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }

            @Override
            public void failed(Throwable exc, Void attachment) {
                exc.printStackTrace();
            }
        });

        // ä¸ºäº†è®©æœåŠ¡å™¨ç»§ç»­è¿è¡Œï¼Œæˆ‘ä»¬éœ€è¦é˜»æ­¢ main çº¿ç¨‹é€€å‡º
        Thread.currentThread().join();
    }
}
```

ä»£ç ç»“æ„å’Œä¹‹å‰è®²åˆ°çš„[å¼‚æ­¥æ–‡ä»¶é€šé“ AsynchronousFileChannel](https://tobebetterjavaer.com/nio/buffer-channel.html) æ¯”è¾ƒç›¸ä¼¼ï¼Œå¼‚æ­¥æœåŠ¡å•å¥—æ¥å­—é€šé“ AsynchronousServerSocketChannel æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ï¼Œæ¯å½“æ”¶åˆ°ä¸€ä¸ªæ–°çš„è¿æ¥æ—¶ï¼Œä¼šè°ƒç”¨ `completed()` æ–¹æ³•ï¼Œç„¶åè¯»å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®å¹¶å°†å…¶æ‰“å°åˆ°æ§åˆ¶å°ã€‚

æ¥ç®€å•åˆ†æä¸€ä¸‹å§ã€‚

â‘ ã€åˆ›å»ºäº†ä¸€ä¸ª AsynchronousServerSocketChannel å®ä¾‹å¹¶å°†å…¶æ‰“å¼€ã€‚è¿™ä¸ªé€šé“å°†ç”¨äºç›‘å¬å®¢æˆ·ç«¯è¿æ¥ã€‚

```java
AsynchronousServerSocketChannel server = AsynchronousServerSocketChannel.open();
```

â‘¡ã€è°ƒç”¨ `accept()` æ–¹æ³•æ¥æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ã€‚è¿™ä¸ªæ–¹æ³•éœ€è¦ä¸€ä¸ª CompletionHandler å®ä¾‹ï¼Œå½“å®¢æˆ·ç«¯è¿æ¥æˆåŠŸæ—¶ï¼Œ`completed()` æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚

```java
server.accept(null, new CompletionHandler<AsynchronousSocketChannel, Void>() { ... });
```

â‘¢ã€å®ç° CompletionHandlerï¼ŒI/O æ“ä½œæˆåŠŸæ—¶ï¼Œä¼šè°ƒç”¨ `completed()` æ–¹æ³•ï¼›å½“ I/O æ“ä½œå¤±è´¥æ—¶ï¼Œä¼šè°ƒç”¨ `failed()` æ–¹æ³•ã€‚

```java
new CompletionHandler<AsynchronousSocketChannel, Void>() {
    @Override
    public void completed(AsynchronousSocketChannel client, Void attachment) { ... }

    @Override
    public void failed(Throwable exc, Void attachment) { ... }
}
```

åœ¨ completed æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè°ƒç”¨ `server.accept()` æ¥æ¥æ”¶ä¸‹ä¸€ä¸ªè¿æ¥è¯·æ±‚ã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç¼“å†²åŒº ByteBuffer å¹¶ä½¿ç”¨ `client.read()` ä»å®¢æˆ·ç«¯è¯»å–æ•°æ®ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ª [Future](https://tobebetterjavaer.com/thread/callable-future-futuretask.html) å¯¹è±¡æ¥ç­‰å¾…è¯»å–æ“ä½œå®Œæˆã€‚å½“è¯»å–å®Œæˆæ—¶ï¼Œæˆ‘ä»¬å°†ç¼“å†²åŒºçš„å†…å®¹æ‰“å°åˆ°æ§åˆ¶å°ã€‚

â‘£ã€ä¸ºäº†è®©æœåŠ¡å™¨ç»§ç»­è¿è¡Œå¹¶æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ï¼Œæˆ‘ä»¬éœ€è¦é˜»æ­¢ main çº¿ç¨‹é€€å‡ºã€‚

```java
Thread.currentThread().join();
```

å†æ¥çœ‹å®¢æˆ·ç«¯çš„ï¼š

```java
public class AsynchronousClient {

    public static void main(String[] args) {
        try {
            AsynchronousSocketChannel client = AsynchronousSocketChannel.open();
            Future<Void> connectResult = client.connect(new InetSocketAddress("localhost", 5000));
            connectResult.get(); // ç­‰å¾…è¿æ¥å®Œæˆ

            String message = "æ²‰é»˜ç‹äºŒï¼Œåœ¨å—ï¼Ÿ";
            ByteBuffer buffer = ByteBuffer.wrap(message.getBytes(StandardCharsets.UTF_8));
            Future<Integer> writeResult = client.write(buffer);
            writeResult.get(); // ç­‰å¾…å‘é€å®Œæˆ

            System.out.println("æ¶ˆæ¯å‘é€å®Œæ¯•");

            client.close();
        } catch (IOException | InterruptedException | ExecutionException e) {
            e.printStackTrace();
        }
    }
}
```

å°±æ˜¯ç®€å•çš„è¿æ¥å’Œå†™å…¥æ•°æ®ï¼Œå°±ä¸å¤šåšè§£é‡Šäº†ã€‚è¿™é‡Œå…ˆè¿è¡Œä¸€ä¸‹ Server ç«¯ï¼Œç„¶åå†è¿è¡Œä¸€ä¸‹å®¢æˆ·ç«¯ï¼Œçœ‹ä¸€ä¸‹ç»“æœã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/network-connect-20230407161351.png)

### ç®€å•çš„èŠå¤©å®¤

æˆ‘ä»¬æ¥é€šè¿‡ SocketChannel å’Œ ServerSocketChannel å®ç°ä¸€ä¸ª 0.1 ç‰ˆçš„èŠå¤©å®¤ï¼Œå…ˆè¯´ä¸€ä¸‹éœ€æ±‚ï¼Œæ¯”è¾ƒç®€å•ï¼ŒæœåŠ¡ç«¯å¯åŠ¨ç›‘å¬å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€ä¿¡æ¯åï¼ŒæœåŠ¡å™¨ç«¯æ¥æ”¶åˆ°åæŠŠå®¢æˆ·ç«¯æ¶ˆæ¯å›æ˜¾ç»™å®¢æˆ·ç«¯ï¼Œæ¯”è¾ƒå‘†ç“œï¼Œä½†å¯ä»¥å…ˆæ¥çœ‹ä¸€ä¸‹ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/network-connect-20230407164326.png)

æˆ‘ä»¬æ¥çœ‹æœåŠ¡å™¨ç«¯ä»£ç ï¼š

```java
public class ChatServer {
    private Selector selector;
    private ServerSocketChannel serverSocketChannel;
    private static final int PORT = 8080;

    public ChatServer() {
        try {
            selector = Selector.open();
            serverSocketChannel = ServerSocketChannel.open();
            serverSocketChannel.socket().bind(new InetSocketAddress(PORT));
            serverSocketChannel.configureBlocking(false);
            serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);
            System.out.println("èŠå¤©å®¤æœåŠ¡ç«¯å¯åŠ¨äº† " + PORT);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public void start() {
        try {
            while (true) {
                if (selector.select() > 0) {
                    Iterator<SelectionKey> iterator = selector.selectedKeys().iterator();
                    while (iterator.hasNext()) {
                        SelectionKey key = iterator.next();
                        iterator.remove();
                        handleKey(key);
                    }
                }
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    private void handleKey(SelectionKey key) throws IOException {
        if (key.isAcceptable()) {
            SocketChannel socketChannel = serverSocketChannel.accept();
            socketChannel.configureBlocking(false);
            socketChannel.register(selector, SelectionKey.OP_READ);
            System.out.println("å®¢æˆ·ç«¯è¿æ¥ä¸Šäº†: " + socketChannel.getRemoteAddress());
        } else if (key.isReadable()) {
            SocketChannel socketChannel = (SocketChannel) key.channel();
            ByteBuffer buffer = ByteBuffer.allocate(1024);
            int read = socketChannel.read(buffer);
            if (read > 0) {
                buffer.flip();
                String msg = new String(buffer.array(), 0, read);
                System.out.println("å®¢æˆ·ç«¯è¯´: " + msg);
                socketChannel.write(ByteBuffer.wrap(("æœåŠ¡ç«¯å›å¤: " + msg).getBytes()));
            }
        }
    }

    public static void main(String[] args) {
        new ChatServer().start();
    }
}
```

è§£é‡Šä¸€ä¸‹ä»£ç é€»è¾‘ï¼š

1ã€åˆ›å»ºä¸€ä¸ª ServerSocketChannelï¼Œå¹¶å°†å…¶ç»‘å®šåˆ°æŒ‡å®šç«¯å£ã€‚

2ã€å°† ServerSocketChannel è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ã€‚

3ã€åˆ›å»ºä¸€ä¸ª Selectorï¼Œå¹¶å°† ServerSocketChannel æ³¨å†Œåˆ°å®ƒä¸Šé¢ï¼Œç›‘å¬ OP_ACCEPT äº‹ä»¶ï¼ˆç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ï¼‰ã€‚

4ã€æ— é™å¾ªç¯ï¼Œç­‰å¾…æ„Ÿå…´è¶£çš„äº‹ä»¶å‘ç”Ÿã€‚

5ã€ä½¿ç”¨ `Selector.select()` æ–¹æ³•ï¼Œç­‰å¾…å·²æ³¨å†Œçš„é€šé“ä¸­æœ‰äº‹ä»¶å‘ç”Ÿã€‚

6ã€è·å–åˆ°å‘ç”Ÿäº‹ä»¶çš„é€šé“çš„ SelectionKeyã€‚

7ã€åˆ¤æ–­ SelectionKey çš„äº‹ä»¶ç±»å‹ï¼š

- a. å¦‚æœæ˜¯ OP_ACCEPT äº‹ä»¶ï¼Œè¯´æ˜æœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥è¿›æ¥ã€‚æ¥å—æ–°çš„è¿æ¥ï¼Œå¹¶å°†æ–°è¿æ¥çš„ SocketChannel æ³¨å†Œåˆ° Selector ä¸Šï¼Œç›‘å¬ OP_READ äº‹ä»¶ã€‚
- b. å¦‚æœæ˜¯ OP_READ äº‹ä»¶ï¼Œè¯´æ˜å®¢æˆ·ç«¯å‘é€äº†æ¶ˆæ¯ã€‚è¯»å–å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ï¼Œå¹¶å°†å…¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚
å¤„ç†å®Œæ¯•åï¼Œæ¸…é™¤å·²å¤„ç†çš„ SelectionKeyã€‚

å†æ¥çœ‹ä¸€ä¸‹å®¢æˆ·ç«¯çš„ä»£ç ï¼š

```java
public class ChatClient {
    private Selector selector;
    private SocketChannel socketChannel;
    private static final String HOST = "localhost";
    private static final int PORT = 8080;

    public ChatClient() {
        try {
            selector = Selector.open();
            socketChannel = SocketChannel.open(new InetSocketAddress(HOST, PORT));
            socketChannel.configureBlocking(false);
            socketChannel.register(selector, SelectionKey.OP_READ);
            System.out.println("è¿æ¥åˆ°èŠå¤©å®¤äº†");
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public void start() {
        new Thread(() -> {
            try {
                while (true) {
                    if (selector.select() > 0) {
                        for (SelectionKey key : selector.selectedKeys()) {
                            selector.selectedKeys().remove(key);
                            if (key.isReadable()) {
                                readMessage();
                            }
                        }
                    }
                }
            } catch (IOException e) {
                e.printStackTrace();
            }
        }).start();

        try (BufferedReader reader = new BufferedReader(new InputStreamReader(System.in
        ))) {
            String input;
            while ((input = reader.readLine()) != null) {
                sendMessage(input);
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
    private void sendMessage(String message) throws IOException {
        if (message != null && !message.trim().isEmpty()) {
            ByteBuffer buffer = ByteBuffer.wrap(message.getBytes());
            socketChannel.write(buffer);
        }
    }

    private void readMessage() throws IOException {
        ByteBuffer buffer = ByteBuffer.allocate(1024);
        int read = socketChannel.read(buffer);
        if (read > 0) {
            buffer.flip();
            String msg = new String(buffer.array(), 0, read);
            System.out.println(msg);
        }
    }

    public static void main(String[] args) {
        new ChatClient().start();
    }
}
```

è§£é‡Šä¸€ä¸‹ä»£ç é€»è¾‘ï¼š

1ã€åˆ›å»ºä¸€ä¸ª SocketChannelï¼Œå¹¶è¿æ¥åˆ°æŒ‡å®šçš„æœåŠ¡å™¨åœ°å€å’Œç«¯å£ã€‚

2ã€å°† SocketChannel è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ã€‚

3ã€åˆ›å»ºä¸€ä¸ª Selectorï¼Œå¹¶å°† SocketChannel æ³¨å†Œåˆ°å®ƒä¸Šé¢ï¼Œç›‘å¬ OP_READ äº‹ä»¶ï¼ˆç­‰å¾…æ¥æ”¶æœåŠ¡å™¨çš„æ¶ˆæ¯ï¼‰ã€‚

4ã€å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹ç”¨äºè¯»å–ç”¨æˆ·åœ¨æ§åˆ¶å°è¾“å…¥çš„æ¶ˆæ¯ï¼Œå¹¶å‘é€ç»™æœåŠ¡å™¨ã€‚

5ã€æ— é™å¾ªç¯ï¼Œç­‰å¾…æ„Ÿå…´è¶£çš„äº‹ä»¶å‘ç”Ÿã€‚

6ã€ä½¿ç”¨` Selector.select()` æ–¹æ³•ï¼Œç­‰å¾…å·²æ³¨å†Œçš„é€šé“ä¸­æœ‰äº‹ä»¶å‘ç”Ÿã€‚

7ã€è·å–åˆ°å‘ç”Ÿäº‹ä»¶çš„é€šé“çš„ SelectionKeyã€‚

8ã€åˆ¤æ–­ SelectionKey çš„äº‹ä»¶ç±»å‹ï¼š

- a. å¦‚æœæ˜¯ OP_READ äº‹ä»¶ï¼Œè¯´æ˜æœåŠ¡å™¨å‘é€äº†æ¶ˆæ¯ã€‚è¯»å–æœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯ï¼Œå¹¶åœ¨æ§åˆ¶å°æ˜¾ç¤ºã€‚
å¤„ç†å®Œæ¯•åï¼Œæ¸…é™¤å·²å¤„ç†çš„ SelectionKeyã€‚

æ¥çœ‹è¿è¡Œåçš„æ•ˆæœã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/network-connect-20230407164913.png)

å¥½ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å‡çº§ä¸€ä¸‹éœ€æ±‚ï¼Œä¹Ÿå°±æ˜¯ 0.2 ç‰ˆèŠå¤©å®¤ï¼Œè¦æ±‚æœåŠ¡å™¨ç«¯ä¹Ÿèƒ½ä»æ§åˆ¶å°æ•²å…¥ä¿¡æ¯ä¸»åŠ¨å‘é€ç»™å®¢æˆ·ç«¯ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/network-connect-20230407165110.png)

æ¥çœ‹æœåŠ¡å™¨ç«¯ä»£ç ï¼š

```java
public class Chat2Server {

    public static void main(String[] args) throws IOException {
        // åˆ›å»ºä¸€ä¸ª ServerSocketChannel
        ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();
        serverSocketChannel.configureBlocking(false);
        serverSocketChannel.bind(new InetSocketAddress(8080));

        // åˆ›å»ºä¸€ä¸ª Selector
        Selector selector = Selector.open();
        serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);
        System.out.println("èŠå¤©å®¤æœåŠ¡ç«¯å¯åŠ¨äº†");

        // å®¢æˆ·ç«¯è¿æ¥
        AtomicReference<SocketChannel> clientRef = new AtomicReference<>();

        // ä»æ§åˆ¶å°è¯»å–è¾“å…¥å¹¶å‘é€ç»™å®¢æˆ·ç«¯
        Thread sendMessageThread = new Thread(() -> {
            try (BufferedReader reader = new BufferedReader(new InputStreamReader(System.in))) {
                while (true) {
                    System.out.println("è¾“å…¥æœåŠ¡å™¨ç«¯æ¶ˆæ¯: ");
                    String message = reader.readLine();
                    SocketChannel client = clientRef.get();
                    if (client != null && client.isConnected()) {
                        ByteBuffer buffer = ByteBuffer.wrap((message + "\n").getBytes());
                        client.write(buffer);
                    }
                }
            } catch (IOException e) {
                e.printStackTrace();
            }
        });
        sendMessageThread.start();

        while (true) {
            int readyChannels = selector.select();

            if (readyChannels == 0) {
                continue;
            }

            Set<SelectionKey> selectedKeys = selector.selectedKeys();
            Iterator<SelectionKey> keyIterator = selectedKeys.iterator();

            while (keyIterator.hasNext()) {
                SelectionKey key = keyIterator.next();

                if (key.isAcceptable()) {
                    // æ¥å—å®¢æˆ·ç«¯è¿æ¥
                    SocketChannel client = serverSocketChannel.accept();
                    System.out.println("å®¢æˆ·ç«¯å·²è¿æ¥");
                    client.configureBlocking(false);
                    client.register(selector, SelectionKey.OP_READ);
                    clientRef.set(client);
                } else if (key.isReadable()) {
                    // è¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯
                    SocketChannel channel = (SocketChannel) key.channel();
                    ByteBuffer buffer = ByteBuffer.allocate(1024);
                    int bytesRead = channel.read(buffer);

                    if (bytesRead > 0) {
                        buffer.flip();
                        byte[] bytes = new byte[buffer.remaining()];
                        buffer.get(bytes);
                        String message = new String(bytes).trim();
                        System.out.println("å®¢æˆ·ç«¯æ¶ˆæ¯: " + message);
                    }
                }
                keyIterator.remove();
            }
        }
    }
}
```

å†æ¥çœ‹å®¢æˆ·ç«¯ä»£ç ï¼š

```java
public class Chat2Client {

    public static void main(String[] args) throws IOException {
        // åˆ›å»ºä¸€ä¸ª SocketChannel
        SocketChannel socketChannel = SocketChannel.open();
        socketChannel.configureBlocking(false);
        socketChannel.connect(new InetSocketAddress("localhost", 8080));

        // åˆ›å»ºä¸€ä¸ª Selector
        Selector selector = Selector.open();
        socketChannel.register(selector, SelectionKey.OP_CONNECT);

        // ä»æ§åˆ¶å°è¯»å–è¾“å…¥å¹¶å‘é€ç»™æœåŠ¡å™¨ç«¯
        Thread sendMessageThread = new Thread(() -> {
            try (BufferedReader reader = new BufferedReader(new InputStreamReader(System.in))) {
                while (true) {
                    System.out.println("è¾“å…¥å®¢æˆ·ç«¯æ¶ˆæ¯: ");
                    String message = reader.readLine();
                    if (socketChannel.isConnected()) {
                        ByteBuffer buffer = ByteBuffer.wrap((message + "\n").getBytes());
                        socketChannel.write(buffer);
                    }
                }
            } catch (IOException e) {
                e.printStackTrace();
            }
        });
        sendMessageThread.start();

        while (true) {
            int readyChannels = selector.select();

            if (readyChannels == 0) {
                continue;
            }

            Set<SelectionKey> selectedKeys = selector.selectedKeys();
            Iterator<SelectionKey> keyIterator = selectedKeys.iterator();

            while (keyIterator.hasNext()) {
                SelectionKey key = keyIterator.next();

                if (key.isConnectable()) {
                    // è¿æ¥åˆ°æœåŠ¡å™¨
                    socketChannel.finishConnect();
                    socketChannel.register(selector, SelectionKey.OP_READ);
                    System.out.println("å·²è¿æ¥åˆ°æœåŠ¡å™¨");
                } else if (key.isReadable()) {
                    // è¯»å–æœåŠ¡å™¨ç«¯æ¶ˆæ¯
                    ByteBuffer buffer = ByteBuffer.allocate(1024);
                    int bytesRead = socketChannel.read(buffer);

                    if (bytesRead > 0) {
                        buffer.flip();
                        byte[] bytes = new byte[buffer.remaining()];
                        buffer.get(bytes);
                        String message = new String(bytes).trim();
                        System.out.println("æœåŠ¡å™¨ç«¯æ¶ˆæ¯: " + message);
                    }
                }
                keyIterator.remove();
            }
        }
    }
}
```

è¿è¡Œ Serverï¼Œå†è¿è¡Œ Clientï¼Œäº¤äº’ä¿¡æ¯å¦‚ä¸‹ï¼š

![](https://cdn.tobebetterjavaer.com/stutymore/network-connect-20230407180853.png)

æˆ‘ä»¬ä½¿ç”¨äº† Selector å’Œéé˜»å¡ I/Oï¼Œè¿™ä½¿å¾—æœåŠ¡å™¨å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªè¿æ¥ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨ Intellij IDEA ä¸­å¯ä»¥å†é…ç½®ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œè§ä¸‹å›¾ï¼ˆå¡«ä¸Šè¿™å››é¡¹å†…å®¹ï¼‰ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/network-connect-20230407181717.png)

ç„¶åå¯åŠ¨ï¼Œå°±å¯ä»¥å®Œæˆä¸€ä¸ª Server å’Œå¤šä¸ª Client äº¤äº’äº†ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/network-connect-20230407181906.png)

OKï¼Œå…³äºèŠå¤©å®¤ï¼Œæˆ‘ä»¬å°±å…ˆè®²åˆ°è¿™é‡Œã€‚

### å°ç»“

å‰é¢æˆ‘ä»¬äº†è§£åˆ°ï¼ŒJava NIO åœ¨æ–‡ä»¶ IO ä¸Šçš„æ€§èƒ½å…¶å®å’Œä¼ ç»Ÿ IO å·®ä¸å¤šï¼Œç”šè‡³åœ¨å¤„ç†å¤§æ–‡ä»¶çš„æ—¶å€™è¿˜æœ‰äº›ç”˜æ‹œä¸‹é£ï¼Œä½† NIO çš„ä¸»è¦ä½œç”¨ä½“ç°åœ¨ç½‘ç»œ IO ä¸Šï¼Œåƒ [Netty](https://tobebetterjavaer.com/netty/rumen.html) æ¡†æ¶åº•å±‚å…¶å®å°±æ˜¯ NIOï¼Œæˆ‘ä»¬æ¥åšä¸€ä¸‹ç®€å•çš„æ€»ç»“å§ã€‚

SocketChannelï¼ˆç”¨äº TCP è¿æ¥ï¼‰å’Œ ServerSocketChannelï¼ˆç”¨äºç›‘å¬å’Œæ¥å—æ–°çš„ TCP è¿æ¥ï¼‰å¯ä»¥ç”¨æ¥æ›¿ä»£ä¼ ç»Ÿçš„ Socket å’Œ ServerSocket ç±»ï¼Œæä¾›éé˜»å¡æ¨¡å¼ã€‚

NIO æ”¯æŒé˜»å¡å’Œéé˜»å¡æ¨¡å¼ã€‚éé˜»å¡æ¨¡å¼å…è®¸ç¨‹åºåœ¨ç­‰å¾… I/O æ—¶æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œä»è€Œæé«˜å¹¶å‘æ€§èƒ½ã€‚éé˜»å¡æ¨¡å¼çš„å®ç°ä¾èµ–äº Selectorï¼Œå®ƒå¯ä»¥ç›‘æ§å¤šä¸ªé€šé“ä¸Šçš„ I/O äº‹ä»¶ã€‚

NIO æ”¯æŒå°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ª Bufferï¼ˆScatterï¼‰æˆ–ä»å¤šä¸ª Buffer æ”¶é›†æ•°æ®ï¼ˆGatherï¼‰ï¼Œæä¾›äº†æ›´é«˜æ•ˆçš„æ•°æ®ä¼ è¾“æ–¹å¼ã€‚

Java NIO.2 å¼•å…¥äº† AsynchronousSocketChannel å’Œ AsynchronousServerSocketChannelï¼Œè¿™äº›ç±»æä¾›äº†åŸºäºå›è°ƒçš„å¼‚æ­¥ I/O æ“ä½œã€‚å¼‚æ­¥å¥—æ¥å­—é€šé“å¯ä»¥åœ¨å®Œæˆ I/O æ“ä½œæ—¶è‡ªåŠ¨è§¦å‘å›è°ƒå‡½æ•°ï¼Œä»è€Œå®ç°é«˜æ•ˆçš„å¼‚æ­¥å¤„ç†ã€‚

æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ NIO å®ç°äº†ç®€å•çš„èŠå¤©å®¤åŠŸèƒ½ã€‚é€šè¿‡ ServerSocketChannel å’Œ SocketChannel åˆ›å»ºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼Œå®ç°äº’ç›¸å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚åœ¨å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ Selector æ¥ç®¡ç†å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼Œæé«˜å¹¶å‘æ€§èƒ½ã€‚

æ€»ä¹‹ï¼ŒJava NIO ç½‘ç»œç¼–ç¨‹å®è·µæä¾›äº†æ›´é«˜æ•ˆã€çµæ´»ä¸”å¯æ‰©å±•çš„ I/O å¤„ç†æ–¹å¼ï¼Œå¯¹äºå¤§å‹åº”ç”¨ç¨‹åºå’Œé«˜å¹¶å‘åœºæ™¯å…·æœ‰æ˜¾è‘—ä¼˜åŠ¿ã€‚

---------

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 12.6 Java IOæ¨¡å‹

Java çš„ IO åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œä¸€ç±»æ˜¯[ä¼ ç»Ÿçš„ IO](https://tobebetterjavaer.com/io/shangtou.html)ï¼ˆBlocking IOï¼‰ï¼Œä¸€ç±»æ˜¯ [NIO](https://tobebetterjavaer.com/nio/nio-better-io.html) ï¼ˆNew IOï¼‰ã€‚

ä¼ ç»Ÿçš„ IO åŸºäºå­—èŠ‚æµå’Œå­—ç¬¦æµï¼Œä»¥é˜»å¡å¼ IO æ“ä½œä¸ºä¸»ã€‚å¸¸ç”¨çš„ç±»æœ‰ FileInputStreamã€FileOutputStreamã€InputStreamReaderã€OutputStreamWriter ç­‰ã€‚è¿™äº›ç±»åœ¨è¯»å†™æ•°æ®æ—¶ï¼Œä¼šå¯¼è‡´æ‰§è¡Œçº¿ç¨‹é˜»å¡ï¼Œç›´åˆ°æ“ä½œå®Œæˆã€‚

Java NIO æ˜¯ Java 1.4 ç‰ˆæœ¬å¼•å…¥çš„ï¼ŒåŸºäºé€šé“ï¼ˆChannelï¼‰å’Œç¼“å†²åŒºï¼ˆBufferï¼‰è¿›è¡Œæ“ä½œï¼Œé‡‡ç”¨éé˜»å¡å¼ IO æ“ä½œï¼Œå…è®¸çº¿ç¨‹åœ¨ç­‰å¾… IO æ—¶æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚å¸¸è§çš„ NIO ç±»æœ‰ ByteBufferã€FileChannelã€SocketChannelã€ServerSocketChannel ç­‰ã€‚

### é˜»å¡ IO å’Œéé˜»å¡ IO

é‚£ä»€ä¹ˆæ˜¯é˜»å¡å¼ IOï¼Œä»€ä¹ˆæ˜¯éé˜»å¡ IO å‘¢ï¼Ÿ

é˜»å¡ I/Oï¼ˆBlocking I/Oï¼‰ï¼šåœ¨è¿™ç§æ¨¡å‹ä¸­ï¼ŒI/O æ“ä½œæ˜¯é˜»å¡çš„ï¼Œå³æ‰§è¡Œ I/O æ“ä½œæ—¶ï¼Œçº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æ“ä½œå®Œæˆã€‚åœ¨é˜»å¡ I/O æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªè¿æ¥éƒ½éœ€è¦ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ã€‚å› æ­¤ï¼Œå¯¹äºå¤§é‡å¹¶å‘è¿æ¥çš„åœºæ™¯ï¼Œé˜»å¡ I/O æ¨¡å‹çš„æ€§èƒ½è¾ƒå·®ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/moxing-20230408110408.png)

éé˜»å¡ I/Oï¼ˆNon-blocking I/Oï¼‰ï¼šåœ¨è¿™ç§æ¨¡å‹ä¸­ï¼ŒI/O æ“ä½œä¸ä¼šé˜»å¡çº¿ç¨‹ã€‚å½“æ•°æ®å°šæœªå‡†å¤‡å¥½æ—¶ï¼ŒI/O è°ƒç”¨ä¼šç«‹å³è¿”å›ã€‚çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œç„¶ååœ¨é€‚å½“çš„æ—¶å€™å†æ¬¡å°è¯•æ‰§è¡Œ I/O æ“ä½œã€‚éé˜»å¡ I/O æ¨¡å‹å…è®¸å•ä¸ªçº¿ç¨‹åŒæ—¶å¤„ç†å¤šä¸ªè¿æ¥ï¼Œä½†å¯èƒ½éœ€è¦åœ¨åº”ç”¨ç¨‹åºçº§åˆ«è¿›è¡Œå¤æ‚çš„è°ƒåº¦å’Œç®¡ç†ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/moxing-20230408110433.png)

### å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´

åœ¨ä¸Šé¢çš„ä¸¤å¹…å›¾ä¸­ï¼Œæ¶‰åŠåˆ°äº†ä¸¤ä¸ªæ¦‚å¿µï¼šå†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ã€‚æˆ‘ä»¬ä¹‹å‰åœ¨[ä»‹ç»éç›´æ¥ç¼“å†²åŒºçš„æ—¶å€™](https://tobebetterjavaer.com/nio/buffer-channel.html)ï¼Œæœ‰è¿™æ ·ä¸€å‰¯å›¾ç‰‡ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/buffer-channel-selector-20230406182813.png)

å…¶ä¸­çš„éç›´æ¥ç¼“å†²åŒºï¼ˆJVMï¼‰å°±æ˜¯åœ¨ç”¨æˆ·ç©ºé—´ä¸­ï¼Œå†…æ ¸ç¼“å†²åŒºï¼ˆOSï¼‰å°±æ˜¯åœ¨å†…æ ¸ç©ºé—´ä¸Šã€‚

å†…æ ¸ç©ºé—´æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸çš„ä¸“ç”¨å†…å­˜åŒºåŸŸï¼Œç”¨äºå­˜å‚¨å†…æ ¸ä»£ç ã€æ•°æ®ç»“æ„å’Œè¿è¡Œå†…æ ¸çº§åˆ«çš„ç³»ç»Ÿè°ƒç”¨ã€‚å†…æ ¸ç©ºé—´å…·æœ‰è¾ƒé«˜çš„æƒé™çº§åˆ«ï¼Œèƒ½å¤Ÿç›´æ¥è®¿é—®ç¡¬ä»¶èµ„æºå’Œåº•å±‚ç³»ç»ŸæœåŠ¡ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå†…æ ¸ç©ºé—´æ˜¯å—åˆ°ä¸¥æ ¼ä¿æŠ¤çš„ï¼Œç”¨æˆ·çº§åˆ«çš„ç¨‹åºä¸èƒ½ç›´æ¥è®¿é—®å†…æ ¸ç©ºé—´ï¼Œä»¥ç¡®ä¿æ“ä½œç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§ã€‚

ç”¨æˆ·ç©ºé—´æ˜¯ä¸ºç”¨æˆ·çº§åˆ«çš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡åˆ†é…çš„å†…å­˜åŒºåŸŸã€‚å®ƒåŒ…å«äº†åº”ç”¨ç¨‹åºçš„ä»£ç ã€æ•°æ®å’Œè¿è¡Œæ—¶å †æ ˆã€‚ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´ç›¸å¯¹éš”ç¦»ï¼Œå…·æœ‰è¾ƒä½çš„æƒé™çº§åˆ«ï¼Œä¸èƒ½ç›´æ¥è®¿é—®å†…æ ¸ç©ºé—´æˆ–ç¡¬ä»¶èµ„æºã€‚åº”ç”¨ç¨‹åºéœ€è¦é€šè¿‡ç³»ç»Ÿè°ƒç”¨ä¸å†…æ ¸ç©ºé—´è¿›è¡Œäº¤äº’ï¼Œè¯·æ±‚æ“ä½œç³»ç»Ÿæä¾›çš„æœåŠ¡ã€‚

å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´çš„åˆ’åˆ†æœ‰åŠ©äºæ“ä½œç³»ç»Ÿå®ç°å†…å­˜ä¿æŠ¤å’Œæƒé™æ§åˆ¶ï¼Œç¡®ä¿ç³»ç»Ÿè¿è¡Œçš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§ã€‚å½“ç”¨æˆ·ç¨‹åºéœ€è¦è®¿é—®ç³»ç»Ÿèµ„æºæˆ–æ‰§è¡Œç‰¹æƒæ“ä½œæ—¶ï¼Œå®ƒéœ€è¦é€šè¿‡ç³»ç»Ÿè°ƒç”¨åˆ‡æ¢åˆ°å†…æ ¸ç©ºé—´ï¼Œç”±å†…æ ¸ä»£ç†æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚è¿™ç§è®¾è®¡å¯ä»¥é˜²æ­¢æ¶æ„æˆ–é”™è¯¯çš„ç”¨æˆ·ç¨‹åºç›´æ¥è®¿é—®å†…æ ¸ç©ºé—´ï¼Œä»è€Œç ´åç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§ã€‚åŒæ—¶ï¼Œè¿™ç§åˆ’åˆ†ä¹Ÿæé«˜äº†æ“ä½œç³»ç»Ÿçš„å¯æ‰©å±•æ€§ï¼Œå› ä¸ºå†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´å¯ä»¥ç‹¬ç«‹åœ°è¿›è¡Œæ‰©å±•å’Œä¼˜åŒ–ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/moxing-20230408114300.png)


### å¤šè·¯å¤ç”¨ã€ä¿¡å·é©±åŠ¨ã€å¼‚æ­¥ IO

é™¤äº†å‰é¢æåˆ°çš„é˜»å¡ IO å’Œéé˜»å¡ IO æ¨¡å‹ï¼Œè¿˜æœ‰å¦å¤–ä¸‰ç§ IO æ¨¡å‹ï¼Œåˆ†åˆ«æ˜¯å¤šè·¯å¤ç”¨ã€ä¿¡å·é©±åŠ¨å’Œå¼‚æ­¥ IOã€‚

#### å¤šè·¯å¤ç”¨

I/O å¤šè·¯å¤ç”¨ï¼ˆI/O Multiplexingï¼‰æ¨¡å‹ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„å¤šè·¯å¤ç”¨åŠŸèƒ½ï¼ˆå¦‚ selectã€pollã€epoll ç­‰ï¼‰ï¼Œä½¿å¾—å•ä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ª I/O äº‹ä»¶ã€‚å½“æŸä¸ªè¿æ¥ä¸Šçš„æ•°æ®å‡†å¤‡å¥½æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥åº”ç”¨ç¨‹åºã€‚è¿™æ ·ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å¤„ç†å¤šä¸ªå¹¶å‘è¿æ¥ï¼Œè€Œä¸éœ€è¦ä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ã€‚

- select æ˜¯ Unix ç³»ç»Ÿä¸­æœ€æ—©çš„ I/O å¤šè·¯å¤ç”¨æŠ€æœ¯ã€‚å®ƒå…è®¸ä¸€ä¸ªçº¿ç¨‹åŒæ—¶ç›‘è§†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆå¦‚[å¥—æ¥å­—](https://tobebetterjavaer.com/socket/socket.html)ï¼‰ï¼Œå¹¶ç­‰å¾…æŸä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸Šçš„ I/O äº‹ä»¶ï¼ˆå¦‚å¯è¯»ã€å¯å†™æˆ–å¼‚å¸¸ï¼‰ã€‚select çš„ä¸»è¦é—®é¢˜æ˜¯æ€§èƒ½å—é™ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡æ–‡ä»¶æè¿°ç¬¦æ—¶ã€‚è¿™æ˜¯å› ä¸ºå®ƒä½¿ç”¨ä¸€ä¸ªä½æ©ç æ¥è¡¨ç¤ºæ–‡ä»¶æè¿°ç¬¦é›†ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦ä¼ é€’è¿™ä¸ªæ©ç ï¼Œå¹¶åœ¨å†…æ ¸å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´è¿›è¡Œå¤åˆ¶ã€‚

- poll æ˜¯å¯¹ select çš„æ”¹è¿›ã€‚å®ƒä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ•°ç»„è€Œä¸æ˜¯ä½æ©ç æ¥è¡¨ç¤ºæ–‡ä»¶æè¿°ç¬¦é›†ã€‚è¿™æ ·å¯ä»¥é¿å… select ä¸­çš„æ€§èƒ½é—®é¢˜ã€‚ç„¶è€Œï¼Œpoll ä»ç„¶éœ€è¦éå†æ•´ä¸ªæ–‡ä»¶æè¿°ç¬¦æ•°ç»„ï¼Œä»¥æ£€æŸ¥æ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œåœ¨å¤„ç†å¤§é‡æ–‡ä»¶æè¿°ç¬¦æ—¶ï¼Œæ€§èƒ½ä»ç„¶å—é™ã€‚

- epoll æ˜¯ Linux ä¸­çš„ä¸€ç§é«˜æ€§èƒ½ I/O å¤šè·¯å¤ç”¨æŠ€æœ¯ã€‚å®ƒé€šè¿‡åœ¨å†…æ ¸ä¸­ç»´æŠ¤ä¸€ä¸ªäº‹ä»¶è¡¨æ¥é¿å…éå†æ–‡ä»¶æè¿°ç¬¦æ•°ç»„çš„æ€§èƒ½é—®é¢˜ã€‚å½“æŸä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸Šçš„ I/O äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå†…æ ¸ä¼šå°†è¯¥äº‹ä»¶æ·»åŠ åˆ°äº‹ä»¶è¡¨ä¸­ã€‚åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ epoll_wait å‡½æ•°æ¥è·å–å·²å‡†å¤‡å¥½çš„ I/O äº‹ä»¶ï¼Œè€Œæ— éœ€éå†æ•´ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†ã€‚è¿™ç§æ–¹æ³•å¤§å¤§æé«˜äº†åœ¨å¤§é‡å¹¶å‘è¿æ¥ä¸‹çš„æ€§èƒ½ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/moxing-20230408115158.png)

åœ¨ Java NIO ä¸­ï¼ŒI/O å¤šè·¯å¤ç”¨ä¸»è¦é€šè¿‡ Selector ç±»å®ç°ã€‚Selector èƒ½å¤Ÿç›‘æ§å¤šä¸ª Channelï¼ˆé€šé“ï¼‰ä¸Šçš„ I/O äº‹ä»¶ï¼Œå¦‚è¿æ¥ã€è¯»å–å’Œå†™å…¥ã€‚è¿™ä½¿å¾—ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†å¤šä¸ªå¹¶å‘è¿æ¥ï¼Œæé«˜äº†ç¨‹åºçš„æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚

ä»¥ä¸‹æ˜¯ Java NIO ä¸­ I/O å¤šè·¯å¤ç”¨çš„åº”ç”¨ï¼š

â‘ ã€é¦–å…ˆï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ª Selector å¯¹è±¡ã€‚

```java
Selector selector = Selector.open();
```

â‘¡ã€ç„¶åï¼Œéœ€è¦å°† Channel æ³¨å†Œåˆ° Selectorã€‚æ¯ä¸ª Channel å¿…é¡»é…ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œæ‰èƒ½ä¸ Selector ä¸€èµ·ä½¿ç”¨ã€‚åœ¨æ³¨å†Œ Channel æ—¶ï¼Œè¿˜éœ€è¦æŒ‡å®šæ„Ÿå…´è¶£çš„ I/O äº‹ä»¶ï¼Œå¦‚ SelectionKey.OP_ACCEPTï¼ˆæ¥å—è¿æ¥ï¼‰ã€SelectionKey.OP_READï¼ˆè¯»å–æ•°æ®ï¼‰ç­‰ã€‚

```java
ServerSocketChannel serverChannel = ServerSocketChannel.open();
serverChannel.configureBlocking(false);
serverChannel.bind(new InetSocketAddress(8080));

// æ³¨å†Œæ„Ÿå…´è¶£çš„äº‹ä»¶
serverChannel.register(selector, SelectionKey.OP_ACCEPT);
```

â‘¢ã€æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ Selector çš„ `select()` æ–¹æ³•ç­‰å¾… I/O äº‹ä»¶ã€‚`select()` æ–¹æ³•ä¼šé˜»å¡ï¼Œç›´åˆ°è‡³å°‘æœ‰ä¸€ä¸ª Channel ä¸Šçš„äº‹ä»¶å‘ç”Ÿã€‚å½“æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ `selectedKeys()` æ–¹æ³•è·å–å·²å‡†å¤‡å¥½è¿›è¡Œ I/O æ“ä½œçš„ Channel çš„ SelectionKey é›†åˆã€‚

```java
while (true) {
    int readyChannels = selector.select();
    if (readyChannels == 0) continue;

    Set<SelectionKey> selectedKeys = selector.selectedKeys();
    Iterator<SelectionKey> keyIterator = selectedKeys.iterator();

    while (keyIterator.hasNext()) {
        SelectionKey key = keyIterator.next();

        if (key.isAcceptable()) {
            // å¤„ç†æ¥å—è¿æ¥äº‹ä»¶
        } else if (key.isReadable()) {
            // å¤„ç†è¯»å–æ•°æ®äº‹ä»¶
        } else if (key.isWritable()) {
            // å¤„ç†å†™å…¥æ•°æ®äº‹ä»¶
        }
        keyIterator.remove();
    }
}
```

â‘£ã€æœ€åï¼Œæ ¹æ® SelectionKey çš„çŠ¶æ€ï¼Œæ‰§è¡Œç›¸åº”çš„ I/O æ“ä½œã€‚ä¾‹å¦‚ï¼Œå¦‚æœ SelectionKey è¡¨ç¤º Channel å·²å‡†å¤‡å¥½æ¥å—æ–°çš„è¿æ¥ï¼Œå¯ä»¥è°ƒç”¨ ServerSocketChannel çš„ `accept()` æ–¹æ³•ã€‚å¦‚æœ SelectionKey è¡¨ç¤º Channel å·²å‡†å¤‡å¥½è¯»å–æ•°æ®ï¼Œå¯ä»¥ä» SocketChannel ä¸­è¯»å–æ•°æ®ã€‚

```java
if (key.isAcceptable()) {
    SocketChannel socketChannel = serverSocketChannel.accept();
    socketChannel.configureBlocking(false);
    socketChannel.register(selector, SelectionKey.OP_READ);
    System.out.println("å®¢æˆ·ç«¯è¿æ¥ä¸Šäº†: " + socketChannel.getRemoteAddress());
}
```

å®Œæ•´çš„ä»£ç ç¤ºä¾‹å¯ä»¥çœ‹ä¹‹å‰çš„ç« èŠ‚ï¼š[Java NIO ç½‘ç»œç¼–ç¨‹å®è·µ](https://tobebetterjavaer.com/nio/network-connect.html)

#### ä¿¡å·é©±åŠ¨

ä¿¡å·é©±åŠ¨ I/Oï¼ˆSignal-driven I/Oï¼‰æ¨¡å‹ä¸­ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å‘æ“ä½œç³»ç»Ÿæ³¨å†Œä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œå½“æŸä¸ª I/O äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå‘é€ä¸€ä¸ªä¿¡å·é€šçŸ¥åº”ç”¨ç¨‹åºã€‚åº”ç”¨ç¨‹åºåœ¨æ”¶åˆ°ä¿¡å·åå¤„ç†ç›¸åº”çš„ I/O äº‹ä»¶ã€‚è¿™ç§æ¨¡å‹ä¸éé˜»å¡ I/O ç±»ä¼¼ï¼Œä¹Ÿéœ€è¦åœ¨åº”ç”¨ç¨‹åºçº§åˆ«è¿›è¡Œäº‹ä»¶ç®¡ç†å’Œè°ƒåº¦ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/moxing-20230408115251.png)

å¤šè·¯å¤ç”¨å’Œä¿¡å·é©±åŠ¨çš„å·®åˆ«ä¸»è¦åœ¨äº‹ä»¶é€šçŸ¥æœºåˆ¶å’Œå¼•ç”¨åœºæ™¯ä¸Šã€‚

å¤šè·¯å¤ç”¨æ¨¡å‹å…è®¸ä¸€ä¸ªçº¿ç¨‹åŒæ—¶ç®¡ç†å¤šä¸ª I/O è¿æ¥ã€‚è¿™æ˜¯é€šè¿‡ä½¿ç”¨ç‰¹æ®Šçš„ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚ selectã€poll å’Œ epollï¼‰å®ç°çš„ï¼Œå®ƒä»¬èƒ½å¤Ÿç›‘è§†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸Šçš„ I/O äº‹ä»¶ã€‚å½“æŸä¸ª I/O äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè¿™äº›ç³»ç»Ÿè°ƒç”¨ä¼šè¿”å›ï¼Œé€šçŸ¥åº”ç”¨ç¨‹åºæ‰§è¡Œç›¸åº”çš„ I/O æ“ä½œã€‚I/O å¤šè·¯å¤ç”¨æ¨¡å‹é€‚ç”¨äºé«˜å¹¶å‘ã€ä½å»¶è¿Ÿå’Œé«˜ååé‡çš„åœºæ™¯ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿæœ‰æ•ˆåœ°å‡å°‘çº¿ç¨‹æ•°é‡å’Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ã€‚

ä¿¡å·é©±åŠ¨æ¨¡å‹ä¾èµ–äºä¿¡å·ï¼ˆå¦‚ SIGIOï¼‰æ¥é€šçŸ¥åº”ç”¨ç¨‹åº I/O äº‹ä»¶çš„å‘ç”Ÿã€‚åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œåº”ç”¨ç¨‹åºé¦–å…ˆè®¾ç½®æ–‡ä»¶æè¿°ç¬¦ä¸ºä¿¡å·é©±åŠ¨æ¨¡å¼ï¼Œå¹¶ä¸ºç›¸åº”çš„ä¿¡å·æ³¨å†Œå¤„ç†å‡½æ•°ã€‚å½“ I/O äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå†…æ ¸ä¼šå‘é€ä¸€ä¸ªä¿¡å·ç»™åº”ç”¨ç¨‹åºï¼Œè§¦å‘ä¿¡å·å¤„ç†å‡½æ•°çš„æ‰§è¡Œã€‚ç„¶åï¼Œåº”ç”¨ç¨‹åºå¯ä»¥åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­æ‰§è¡Œç›¸åº”çš„ I/O æ“ä½œã€‚I/O ä¿¡å·é©±åŠ¨æ¨¡å‹é€‚ç”¨äºä½å¹¶å‘ã€ä½å»¶è¿Ÿå’Œä½ååé‡çš„åœºæ™¯ï¼Œå› ä¸ºå®ƒéœ€è¦ä¸ºæ¯ä¸ª I/O äº‹ä»¶åˆ›å»ºä¸€ä¸ªä¿¡å·å’Œä¿¡å·å¤„ç†å‡½æ•°ã€‚

Linux çš„å†…æ ¸å°†æ‰€æœ‰å¤–éƒ¨è®¾å¤‡éƒ½çœ‹åšä¸€ä¸ªæ–‡ä»¶æ¥æ“ä½œï¼Œå¯¹ä¸€ä¸ªæ–‡ä»¶çš„è¯»å†™æ“ä½œä¼šè°ƒç”¨å†…æ ¸æä¾›çš„ç³»ç»Ÿå‘½ä»¤(api)ï¼Œè¿”å›ä¸€ä¸ª file descriptorï¼ˆfdï¼Œæ–‡ä»¶æè¿°ç¬¦ï¼‰ã€‚è€Œå¯¹ä¸€ä¸ªSocketçš„è¯»å†™ä¹Ÿä¼šæœ‰å“åº”çš„æè¿°ç¬¦ï¼Œç§°ä¸º socket fdï¼ˆSocketæ–‡ä»¶æè¿°ç¬¦ï¼‰ï¼Œæè¿°ç¬¦å°±æ˜¯ä¸€ä¸ªæ•°å­—ï¼ŒæŒ‡å‘å†…æ ¸ä¸­çš„ä¸€ä¸ªç»“æ„ä½“ï¼ˆæ–‡ä»¶è·¯å¾„ï¼Œæ•°æ®åŒºç­‰ä¸€äº›å±æ€§ï¼‰ã€‚

åœ¨Linuxä¸‹å¯¹æ–‡ä»¶çš„æ“ä½œæ˜¯åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦(file descriptor)æ¥å®ç°çš„ã€‚

#### å¼‚æ­¥ IO

å¼‚æ­¥ I/Oï¼ˆAsynchronous I/Oï¼‰æ¨¡å‹ä¸åŒæ­¥ I/O æ¨¡å‹çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œå¼‚æ­¥ I/O æ“ä½œä¼šåœ¨åå°è¿è¡Œï¼Œå½“æ“ä½œå®Œæˆæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥åº”ç”¨ç¨‹åºã€‚åº”ç”¨ç¨‹åºä¸éœ€è¦ç­‰å¾… I/O æ“ä½œçš„å®Œæˆï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚è¿™ç§æ¨¡å‹é€‚ç”¨äºå¤„ç†å¤§é‡å¹¶å‘è¿æ¥ï¼Œä¸”å¯ä»¥ç®€åŒ–åº”ç”¨ç¨‹åºçš„è®¾è®¡å’Œå¼€å‘ã€‚

- åŒæ­¥ï¼šåœ¨æ‰§è¡Œ I/O æ“ä½œæ—¶ï¼Œåº”ç”¨ç¨‹åºéœ€è¦ç­‰å¾…æ“ä½œçš„å®Œæˆã€‚åŒæ­¥æ“ä½œä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Œç›´åˆ°æ“ä½œå®Œæˆã€‚åŒæ­¥ I/O åŒ…æ‹¬é˜»å¡ I/Oã€éé˜»å¡ I/O å’Œ I/O å¤šè·¯å¤ç”¨ã€‚
- å¼‚æ­¥ï¼šåœ¨æ‰§è¡Œ I/O æ“ä½œæ—¶ï¼Œåº”ç”¨ç¨‹åºä¸éœ€è¦ç­‰å¾…æ“ä½œçš„å®Œæˆã€‚å¼‚æ­¥æ“ä½œå…è®¸åº”ç”¨ç¨‹åºåœ¨ I/O æ“ä½œè¿›è¡Œæ—¶ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚å¼‚æ­¥ I/O æ¨¡å‹åŒ…æ‹¬ä¿¡å·é©±åŠ¨ I/O å’Œå¼‚æ­¥ I/Oã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/moxing-20230408115328.png)

å‡è®¾ä½ ç°åœ¨æ˜¯ä¸ªå¤§å¨ï¼ˆç‚–ä¸ªè€æ¯é¸¡æ±¤ï¼Œåˆ‡ç‚¹åœŸè±†ä¸/å§œä¸/è‘±ä¸ï¼‰ï¼š

- åŒæ­¥/é˜»å¡ï¼šä½ ç«™åœ¨é”…è¾¹ï¼Œä¸€ç›´ç­‰åˆ°æ±¤ç‚–å¥½ï¼ŒæœŸé—´ä¸èƒ½åšå…¶ä»–äº‹æƒ…ï¼Œç›´åˆ°æ±¤ç‚–å¥½æ‰å»å¤„ç†å…¶ä»–ä»»åŠ¡ã€‚
- åŒæ­¥/éé˜»å¡ï¼šä½ ä¸æ–­åœ°æŸ¥çœ‹é”…é‡Œçš„æ±¤ï¼Œçœ‹æ˜¯å¦ç‚–å¥½ã€‚åœ¨æ£€æŸ¥çš„é—´éš™ï¼Œä½ å¯ä»¥å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œå¦‚åˆ‡èœã€‚ä½†ä½ éœ€è¦ä¸æ–­åœ°åˆ‡æ¢ä»»åŠ¡ï¼Œç¡®ä¿æ±¤ç‚–å¥½äº†å°±å¯ä»¥å¤„ç†ã€‚
- å¼‚æ­¥/ä¿¡å·é©±åŠ¨ï¼šä½ ç»™é”…å®‰è£…ä¸€ä¸ªä¼ æ„Ÿå™¨ï¼Œå½“æ±¤ç‚–å¥½æ—¶ï¼Œä¼ æ„Ÿå™¨ä¼šå‘å‡ºä¿¡å·æé†’ä½ ã€‚åœ¨æ­¤æœŸé—´ï¼Œä½ å¯ä»¥å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œè€Œä¸ç”¨æ‹…å¿ƒé”™è¿‡æ±¤ç‚–å¥½çš„æ—¶æœºã€‚
- å¼‚æ­¥ I/Oï¼šä½ è¯·äº†ä¸€ä¸ªåŠ©æ‰‹ï¼Œè®©ä»–è´Ÿè´£ç‚–æ±¤ã€‚å½“æ±¤ç‚–å¥½æ—¶ï¼ŒåŠ©æ‰‹ä¼šé€šçŸ¥ä½ ã€‚ä½ å¯ä»¥ä¸“å¿ƒå¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œè€Œæ— éœ€å…³å¿ƒç‚–æ±¤çš„è¿‡ç¨‹ã€‚

### å°ç»“

ç®€å•æ€»ç»“ä¸€ä¸‹ï¼ŒIO æ¨¡å‹ä¸»è¦æœ‰äº”ç§ï¼šé˜»å¡ I/Oã€éé˜»å¡ I/Oã€å¤šè·¯å¤ç”¨ã€ä¿¡å·é©±åŠ¨å’Œå¼‚æ­¥ I/Oã€‚

- é˜»å¡ I/Oï¼šåº”ç”¨ç¨‹åºæ‰§è¡Œ I/O æ“ä½œæ—¶ï¼Œä¼šä¸€ç›´ç­‰å¾…æ•°æ®ä¼ è¾“å®Œæˆï¼ŒæœŸé—´æ— æ³•æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚
- éé˜»å¡ I/Oï¼šåº”ç”¨ç¨‹åºæ‰§è¡Œ I/O æ“ä½œæ—¶ï¼Œå¦‚æœæ•°æ®æœªå‡†å¤‡å¥½ï¼Œç«‹å³è¿”å›é”™è¯¯çŠ¶æ€ï¼Œä¸ç­‰å¾…æ•°æ®ä¼ è¾“å®Œæˆï¼Œå¯æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚
- å¤šè·¯å¤ç”¨ï¼šå…è®¸ä¸€ä¸ªçº¿ç¨‹åŒæ—¶ç®¡ç†å¤šä¸ª I/O è¿æ¥ï¼Œé€‚ç”¨äºé«˜å¹¶å‘ã€ä½å»¶è¿Ÿå’Œé«˜ååé‡åœºæ™¯ï¼Œå‡å°‘çº¿ç¨‹æ•°é‡å’Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ã€‚
- ä¿¡å·é©±åŠ¨ï¼šä¾èµ–ä¿¡å·é€šçŸ¥åº”ç”¨ç¨‹åº I/O äº‹ä»¶ï¼Œé€‚ç”¨äºä½å¹¶å‘ã€ä½å»¶è¿Ÿå’Œä½ååé‡åœºæ™¯ï¼Œéœ€è¦ä¸ºæ¯ä¸ª I/O äº‹ä»¶åˆ›å»ºä¿¡å·å’Œä¿¡å·å¤„ç†å‡½æ•°ã€‚
- å¼‚æ­¥ I/Oï¼šåº”ç”¨ç¨‹åºå‘èµ· I/O æ“ä½œåï¼Œå†…æ ¸è´Ÿè´£æ•°æ®ä¼ è¾“è¿‡ç¨‹ï¼Œå®Œæˆåé€šçŸ¥åº”ç”¨ç¨‹åºã€‚åº”ç”¨ç¨‹åºæ— éœ€ç­‰å¾…æ•°æ®ä¼ è¾“ï¼Œå¯æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚

---------

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

# ç¬¬åä¸‰ç« ï¼šJava é‡è¦çŸ¥è¯†ç‚¹

## 13.1 Javaå‘½åè§„èŒƒ

â€œäºŒå“¥ï¼ŒJava ä¸­çš„å‘½åçº¦å®šéƒ½æœ‰å“ªäº›å‘¢ï¼Ÿâ€ä¸‰å¦¹çš„è„¸ä¸Šæ³›ç€ç”œç”œçš„ç¬‘å®¹ï¼Œå¥¹å¼€å§‹å¯¹æ¥ä¸‹æ¥è¦å­¦ä¹ çš„å†…å®¹å……æ»¡æœŸå¾…äº†ï¼Œè¿™æ­£æ˜¯æˆ‘æ„Ÿåˆ°æ¬£æ…°çš„åœ°æ–¹ã€‚

â€œå¯¹äºæˆ‘ä»¬ä¸­å›½äººæ¥è¯´ï¼Œåå­—ä¹Ÿæ˜¯æœ‰è®²ç©¶çš„ï¼Œæ¯”å¦‚è¯´æˆ‘å«æ²‰é»˜ç‹äºŒï¼Œä½ å°±å«æ²‰é»˜ç‹ä¸‰ï¼Œå“ˆå“ˆã€‚â€æˆ‘ç¬‘ç€å¯¹ä¸‰å¦¹è¯´ã€‚

å‘½åçº¦å®šå†³å®šæˆ‘ä»¬ä½¿ç”¨ä»€ä¹ˆæ ·çš„æ ‡è¯†ç¬¦æ¥å‘½ååŒ…ã€ç±»ã€å­—æ®µã€æ–¹æ³•ç­‰ç­‰ï¼Œè™½ç„¶è¿™ä¸ªè§„åˆ™ä¸æ˜¯å¼ºåˆ¶çš„ï¼Œå¯ä»¥éµå®ˆï¼Œä¹Ÿå¯ä»¥ä¸éµå®ˆï¼Œä½†å¦‚æœä¸éµå®ˆçš„è¯ï¼Œå°±ä¼šå¸¦æ¥å¾ˆå¤šä¸å¿…è¦çš„éº»çƒ¦ã€‚

èµ·ä¸ªå¥½çš„åå­—ï¼Œå°±å¥½åƒç©¿ä¸€ä»¶å¾—ä½“çš„è¡£æœï¼Œå‘ˆç°ç»™äººçš„ç”¨æˆ·ä½“éªŒæ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ã€‚ 

å¥½çš„å‘½åå¯ä»¥è®©ä½ çš„ä»£ç æ›´æ˜“è¯»ï¼ŒåŒ…æ‹¬ä½ è‡ªå·±å’Œä½ çš„å°ä¼™ä¼´ï¼Œçœ‹ä¸€çœ¼ï¼Œä¸ç”¨æƒ³å¤ªå¤šï¼Œå°±èƒ½æ˜ç™½ä»£ç æ˜¯å¹²å˜›çš„ã€‚

æ‹¿æˆ‘è¿™ä¸ªç¬”åâ€œæ²‰é»˜ç‹äºŒâ€æ¥ä¸¾ä¾‹å§ï¼Œè¯»èµ·æ¥æˆ‘å°±è§‰å¾—æœ—æœ—ä¸Šå£ï¼Œè¯»è€…çœ‹åˆ°è¿™ä¸ªç¬”åå°±çŸ¥é“æˆ‘æ˜¯ä¸€ä¸ªä»€ä¹ˆæ ·çš„äººâ€”â€”å¯¹ä¸ç†Ÿçš„äººä¿æŒæ²‰é»˜ï¼Œå¯¹ç†Ÿçš„äººå¦™è¯­è¿ç ï¼Œå“ˆå“ˆã€‚

>å½“ç„¶äº†ï¼Œå¦‚æœä½ æš‚æ—¶è®°ä¸ä½ä¹Ÿæ²¡å…³ç³»ï¼Œåé¢å†å›å¤´æ¥è®°ä¸€ä¸‹å°±å¥½äº†ã€‚

### 01ã€åŒ…ï¼ˆpackageï¼‰

åŒ…çš„å‘½ååº”è¯¥éµå®ˆä»¥ä¸‹è§„åˆ™ï¼š

- åº”è¯¥å…¨éƒ¨æ˜¯å°å†™å­—æ¯
- ç‚¹åˆ†éš”ç¬¦ä¹‹é—´æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªè‡ªç„¶è¯­ä¹‰çš„è‹±è¯­å•è¯
- åŒ…åç»Ÿä¸€ä½¿ç”¨å•æ•°å½¢å¼ï¼Œæ¯”å¦‚è¯´ `com.itwanger.util` ä¸èƒ½æ˜¯ `com.itwanger.utils`
- åœ¨æœ€æ–°çš„ Java ç¼–ç¨‹è§„èŒƒä¸­ï¼Œè¦æ±‚å¼€å‘äººå‘˜åœ¨è‡ªå·±å®šä¹‰çš„åŒ…åå‰åŠ ä¸Šå”¯ä¸€çš„å‰ç¼€ã€‚ç”±äºäº’è”ç½‘ä¸Šçš„åŸŸåæ˜¯ä¸ä¼šé‡å¤çš„ï¼Œæ‰€ä»¥å¤šæ•°å¼€å‘äººå‘˜é‡‡ç”¨è‡ªå·±å…¬å¸ï¼ˆæˆ–è€…ä¸ªäººåšå®¢ï¼‰åœ¨äº’è”ç½‘ä¸Šçš„åŸŸåç§°ä½œä¸ºåŒ…çš„å”¯ä¸€å‰ç¼€ã€‚æ¯”å¦‚æˆ‘æ–‡ç« ä¸­å‡ºç°çš„ä»£ç ç¤ºä¾‹çš„åŒ…åå°±æ˜¯ `package com.itwanger`ã€‚

### 02ã€ç±»ï¼ˆclassï¼‰

ç±»çš„å‘½ååº”è¯¥éµå®ˆä»¥ä¸‹è§„åˆ™ï¼š

- å¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´
- æœ€å¥½æ˜¯ä¸€ä¸ªåè¯ï¼Œæ¯”å¦‚è¯´ System
- ç±»åä½¿ç”¨ UpperCamelCaseï¼ˆé©¼å³°å¼å‘½åï¼‰é£æ ¼
- å°½é‡ä¸è¦çœç•¥æˆå•è¯çš„é¦–å­—æ¯ï¼Œä½†ä»¥ä¸‹æƒ…å½¢ä¾‹å¤–ï¼šDO/BO/DTO/VO/AO/PO/UID ç­‰

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-grammar/fifteen-01.png)

å¦å¤–ï¼Œå¦‚æœæ˜¯æŠ½è±¡ç±»çš„è¯ï¼Œä½¿ç”¨ Abstract æˆ– Base å¼€å¤´ï¼›å¦‚æœæ˜¯å¼‚å¸¸ç±»çš„è¯ï¼Œä½¿ç”¨ Exception ç»“å°¾ï¼›å¦‚æœæ˜¯æµ‹è¯•ç±»çš„è¯ï¼Œä½¿ç”¨ Test ç»“å°¾ã€‚

### 03ã€æ¥å£ï¼ˆinterfaceï¼‰

æ¥å£çš„å‘½ååº”è¯¥éµå®ˆä»¥ä¸‹è§„åˆ™ï¼š

- å¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´
- æœ€å¥½æ˜¯ä¸€ä¸ªå½¢å®¹è¯ï¼Œæ¯”å¦‚è¯´ Runnable
- å°½é‡ä¸è¦çœç•¥æˆå•è¯çš„é¦–å­—æ¯

æ¥çœ‹ä¸ªä¾‹å­ï¼š

```java
interface Printable {}
```

æ¥å£å’Œå®ç°ç±»ä¹‹é—´ä¹Ÿæœ‰ä¸€äº›è§„åˆ™ï¼š

- å®ç°ç±»ç”¨ Impl çš„åç¼€ä¸æ¥å£åŒºåˆ«ï¼Œæ¯”å¦‚è¯´ CacheServiceImpl å®ç° CacheService æ¥å£
- æˆ–è€…ï¼ŒAbstractTranslator å®ç° Translatable æ¥å£

### 04ã€å­—æ®µï¼ˆfieldï¼‰å’Œå˜é‡ï¼ˆvariableï¼‰

å­—æ®µå’Œå˜é‡çš„å‘½ååº”è¯¥éµå®ˆä»¥ä¸‹è§„åˆ™ï¼š

- å¿…é¡»ä»¥å°å†™å­—æ¯å¼€å¤´
- å¯ä»¥åŒ…å«å¤šä¸ªå•è¯ï¼Œç¬¬ä¸€ä¸ªå•è¯çš„é¦–å­—æ¯å°å†™ï¼Œå…¶ä»–çš„å•è¯é¦–å­—æ¯å¤§å†™ï¼Œæ¯”å¦‚è¯´ `firstName`
- æœ€å¥½ä¸è¦ä½¿ç”¨å•ä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚è¯´ `int a`ï¼Œé™¤éæ˜¯å±€éƒ¨å˜é‡
- ç±»å‹ä¸ä¸­æ‹¬å·ç´§æŒ¨ç›¸è¿æ¥è¡¨ç¤ºæ•°ç»„ï¼Œæ¯”å¦‚è¯´ `int[] arrayDemo`ï¼Œmain æ–¹æ³•ä¸­å­—ç¬¦ä¸²æ•°ç»„å‚æ•°ä¸åº”è¯¥å†™æˆ `String args[]`
- POJO ç±»ä¸­çš„ä»»ä½•å¸ƒå°”ç±»å‹çš„å˜é‡ï¼Œéƒ½ä¸è¦åŠ  is å‰ç¼€ï¼Œå¦åˆ™éƒ¨åˆ†æ¡†æ¶è§£æä¼šå¼•èµ·åºåˆ—åŒ–é”™è¯¯ï¼Œæˆ‘è‡ªå·±çŸ¥é“çš„æœ‰ fastjson
- é¿å…åœ¨å­ç±»å’Œçˆ¶ç±»çš„æˆå‘˜å˜é‡ä¹‹é—´ã€æˆ–è€…ä¸åŒä»£ç å—çš„å±€éƒ¨å˜é‡ä¹‹é—´é‡‡ç”¨å®Œå…¨ç›¸åŒçš„å‘½åï¼Œä½¿å¯ç†è§£æ€§é™ä½ã€‚å­ç±»ã€çˆ¶ç±»æˆå‘˜å˜é‡åç›¸åŒï¼Œå³ä½¿æ˜¯ public ç±»å‹çš„å˜é‡ä¹Ÿèƒ½å¤Ÿé€šè¿‡ç¼–è¯‘ï¼Œå¦å¤–ï¼Œå±€éƒ¨å˜é‡åœ¨åŒä¸€æ–¹æ³•å†…çš„ä¸åŒä»£ç å—ä¸­åŒåä¹Ÿæ˜¯åˆæ³•çš„ï¼Œè¿™äº›æƒ…å†µéƒ½è¦é¿å…ã€‚

åä¾‹ï¼š

```java
public class ConfusingName {
    public int stock;

    // é setter/getter çš„å‚æ•°åç§°ï¼Œä¸å…è®¸ä¸æœ¬ç±»æˆå‘˜å˜é‡åŒå
    public void get(String alibaba) {
        if (condition) {
            final int money = 666;
// ...
        }
        for (int i = 0; i < 10; i++) {
// åœ¨åŒä¸€æ–¹æ³•ä½“ä¸­ï¼Œä¸å…è®¸ä¸å…¶å®ƒä»£ç å—ä¸­çš„ money å‘½åç›¸åŒ final int money = 15978;
// ...
        }
    }
}

class Son extends ConfusingName {
// ä¸å…è®¸ä¸çˆ¶ç±»çš„æˆå‘˜å˜é‡åç§°ç›¸åŒ public int stock;
}
```

### 05ã€å¸¸é‡ï¼ˆconstantï¼‰

å¸¸é‡çš„å‘½ååº”è¯¥éµå®ˆä»¥ä¸‹è§„åˆ™ï¼š

- åº”è¯¥å…¨éƒ¨æ˜¯å¤§å†™å­—æ¯
- å¯ä»¥åŒ…å«å¤šä¸ªå•è¯ï¼Œå•è¯ä¹‹é—´ä½¿ç”¨â€œ_â€è¿æ¥ï¼Œæ¯”å¦‚è¯´ `MAX_PRIORITY`ï¼ŒåŠ›æ±‚è¯­ä¹‰è¡¨è¾¾å®Œæ•´æ¸…æ¥šï¼Œä¸è¦å«Œåå­—é•¿
- å¯ä»¥åŒ…å«æ•°å­—ï¼Œä½†ä¸èƒ½ä»¥æ•°å­—å¼€å¤´

æ¥çœ‹ä¸ªä¾‹å­ï¼š

```java
static final int MIN_AGE = 18;  
```

### 06ã€æ–¹æ³•ï¼ˆmethodï¼‰

æ–¹æ³•çš„å‘½ååº”è¯¥éµå®ˆä»¥ä¸‹è§„åˆ™ï¼š

- å¿…é¡»ä»¥å°å†™å­—æ¯å¼€å¤´
- æœ€å¥½æ˜¯ä¸€ä¸ªåŠ¨è¯ï¼Œæ¯”å¦‚è¯´ `print()`
- å¯ä»¥åŒ…å«å¤šä¸ªå•è¯ï¼Œç¬¬ä¸€ä¸ªå•è¯çš„é¦–å­—æ¯å°å†™ï¼Œå…¶ä»–çš„å•è¯é¦–å­—æ¯å¤§å†™ï¼Œæ¯”å¦‚è¯´ `actionPerformed()`

æ¥çœ‹ä¸ªä¾‹å­ï¼š

```java
void writeBook(){}
```

Service/DAO å±‚çš„æ–¹æ³•å‘½åè§„çº¦ï¼š

- è·å–å•ä¸ªå¯¹è±¡çš„æ–¹æ³•ç”¨ get åšå‰ç¼€
- è·å–å¤šä¸ªå¯¹è±¡çš„æ–¹æ³•ç”¨ list åšå‰ç¼€ï¼Œå¤æ•°ç»“å°¾ï¼Œå¦‚ï¼šlistObjects
- è·å–ç»Ÿè®¡å€¼çš„æ–¹æ³•ç”¨ count åšå‰ç¼€
- æ’å…¥çš„æ–¹æ³•ç”¨ save/insert åšå‰ç¼€
- åˆ é™¤çš„æ–¹æ³•ç”¨ remove/delete åšå‰ç¼€
- ä¿®æ”¹çš„æ–¹æ³•ç”¨ update åšå‰ç¼€


### 07ã€æ€»ç»“

é™¤äº†ä»¥ä¸Šè¿™äº›è§„åˆ™ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…±åŒçš„è§„åˆ™éœ€è¦éµå®ˆï¼Œæ¯”å¦‚è¯´ï¼š

- ä»£ç ä¸­çš„å‘½åå‡ä¸èƒ½ä»¥ä¸‹åˆ’çº¿æˆ–ç¾å…ƒç¬¦å·å¼€å§‹ï¼Œä¹Ÿä¸èƒ½ä»¥ä¸‹åˆ’çº¿æˆ–ç¾å…ƒç¬¦å·ç»“æŸã€‚åä¾‹ï¼š`_name / __name / $name / name_ / name$ / name__`
- æ‰€æœ‰ç¼–ç¨‹ç›¸å…³çš„å‘½åä¸¥ç¦ä½¿ç”¨æ‹¼éŸ³ä¸è‹±æ–‡æ··åˆçš„æ–¹å¼ï¼Œæ›´ä¸å…è®¸ç›´æ¥ä½¿ç”¨ä¸­æ–‡çš„æ–¹å¼ã€‚åä¾‹ï¼š`DaZhePromotion [æ‰“æŠ˜] / getPingfenByName() [è¯„åˆ†] / String fw[ç¦å¨ƒ] / int æŸå˜é‡ = 3`
- ä»£ç å’Œæ³¨é‡Šä¸­éƒ½è¦é¿å…ä½¿ç”¨ä»»ä½•è¯­è¨€çš„ç§æ—æ­§è§†æ€§è¯è¯­ã€‚åä¾‹ï¼š`RIBENGUIZI / Asan / blackList / whiteList / slave`
- æ–¹æ³•åã€å‚æ•°åã€æˆå‘˜å˜é‡ã€å±€éƒ¨å˜é‡éƒ½ç»Ÿä¸€ä½¿ç”¨ lowerCamelCase é£æ ¼ã€‚
- æœç»å®Œå…¨ä¸è§„èŒƒçš„ç¼©å†™ï¼Œé¿å…æœ›æ–‡ä¸çŸ¥ä¹‰ã€‚åä¾‹ï¼šAbstractClass â€œç¼©å†™â€æˆ AbsClassï¼›condition â€œç¼©å†™â€æˆ condiï¼›Function ç¼©å†™â€æˆ Fuï¼Œæ­¤ç±»éšæ„ç¼©å†™ä¸¥é‡é™ä½äº†ä»£ç çš„å¯é˜…è¯»æ€§ã€‚
- ä¸ºäº†è¾¾åˆ°ä»£ç è‡ªè§£é‡Šçš„ç›®æ ‡ï¼Œä»»ä½•è‡ªå®šä¹‰ç¼–ç¨‹å…ƒç´ åœ¨å‘½åæ—¶ï¼Œä½¿ç”¨å°½é‡å®Œæ•´çš„å•è¯ç»„åˆæ¥è¡¨è¾¾ã€‚
- åœ¨å¸¸é‡ä¸å˜é‡çš„å‘½åæ—¶ï¼Œè¡¨ç¤ºç±»å‹çš„åè¯æ”¾åœ¨è¯å°¾ï¼Œä»¥æå‡è¾¨è¯†åº¦ã€‚æ­£ä¾‹ï¼š`startTime / workQueue / nameList / TERMINATED_THREAD_COUNT`
- å¦‚æœæ¨¡å—ã€æ¥å£ã€ç±»ã€æ–¹æ³•ä½¿ç”¨äº†è®¾è®¡æ¨¡å¼ï¼Œåœ¨å‘½åæ—¶éœ€ä½“ç°å‡ºå…·ä½“æ¨¡å¼ã€‚ å°†è®¾è®¡æ¨¡å¼ä½“ç°åœ¨åå­—ä¸­ï¼Œæœ‰åˆ©äºé˜…è¯»è€…å¿«é€Ÿç†è§£æ¶æ„è®¾è®¡ç†å¿µã€‚æ¯”å¦‚è¯´ï¼š`public class OrderFactory;public class LoginProxy;public class ResourceObserver;`
- æšä¸¾ç±»åå¸¦ä¸Š Enum åç¼€ï¼Œæšä¸¾æˆå‘˜åç§°éœ€è¦å…¨å¤§å†™ï¼Œå•è¯é—´ç”¨ä¸‹åˆ’çº¿éš”å¼€ã€‚æšä¸¾å…¶å®å°±æ˜¯ç‰¹æ®Šçš„å¸¸é‡ç±»ï¼Œä¸”æ„é€ æ–¹æ³•è¢«é»˜è®¤å¼ºåˆ¶æ˜¯ç§æœ‰ã€‚æ¯”å¦‚è¯´ï¼š`æšä¸¾åå­—ä¸º ProcessStatusEnum çš„æˆå‘˜åç§°ï¼šSUCCESS / UNKNOWN_REASON`ã€‚

-----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 13.2 ä¸­æ–‡ä¹±ç åŠå­—ç¬¦ç¼–ç å…¨æ”»ç•¥

å°±åœ¨æ˜¨å¤©ï¼Œæˆ‘åœ¨[äºŒå“¥çš„ç¼–ç¨‹æ˜Ÿçƒ](https://tobebetterjavaer.com/zhishixingqiu/)é‡Œçœ‹åˆ°è¿™æ ·ä¸€å¼ æˆªå›¾ï¼Œæœ‰çƒå‹åé¦ˆè¯´æ”¯ä»˜å®çš„ç†è´¢é¡µé¢å‡ºç°äº†ä¸­æ–‡ä¹±ç ï¼Œä¼°è®¡ä¸å°‘å°ä¼™ä¼´å’Œæˆ‘ä¸€æ ·ï¼Œéƒ½æƒŠå‘†äº†ğŸ˜®ï¼é˜¿é‡Œè¿™ç§å¤§å‚è¿˜èƒ½å‡ºç°è¿™ç§ä½çº§é”™è¯¯ï¼Ÿ

![](https://cdn.tobebetterjavaer.com/stutymore/java-unicode-20230408135521.png)

éš¾é“æ˜¨å¤©çš„äººåŠ›éƒ½æŠ•å…¥åˆ°â€œé€šä¹‰åƒé—®â€çš„çªç„¶å‘å¸ƒä¸Šäº†ï¼Ÿ

é‚£å€Ÿè¿™ä¸ªæœºä¼šï¼Œæˆ‘å°±æ¥å’Œå¤§å®¶æ¢è®¨ä¸€ä¸‹ï¼Œä¸­æ–‡ä¹±ç æ˜¯æ€ä¹ˆå‡ºç°çš„ï¼Œä»¥åŠå¦‚ä½•å¿«é€Ÿè§£å†³ä¹±ç é—®é¢˜ã€‚

### ä»€ä¹ˆæ˜¯ä¸­æ–‡ä¹±ç 

Qï¼šä»€ä¹ˆæ˜¯ä¸­æ–‡ä¹±ç ï¼Ÿ

GPT4ï¼šä¸­æ–‡ä¹±ç æ˜¯æŒ‡åœ¨è®¡ç®—æœºç³»ç»Ÿæˆ–è½¯ä»¶ä¸­ï¼Œç”±äºå­—ç¬¦ç¼–ç ä¸ä¸€è‡´æˆ–å¤„ç†ä¸å½“ï¼Œå¯¼è‡´ä¸­æ–‡å­—ç¬¦æ— æ³•æ­£å¸¸æ˜¾ç¤ºï¼Œå‡ºç°ä¹±ç ç°è±¡ã€‚è¿™ç§ç°è±¡é€šå¸¸è¡¨ç°ä¸ºä¸­æ–‡å­—ç¬¦è¢«æ›¿æ¢æˆå…¶ä»–ä¸ç›¸å…³çš„å­—ç¬¦ã€ç¬¦å·æˆ–ä¹±ç ã€‚

æ¯”å¦‚è¯´ï¼Œå†å²ä¸Šè‘—åçš„â€œé”Ÿæ–¤æ‹·â€åŒå­¦ï¼Œå°±æ˜¯ä¸­æ–‡ä¹±ç çš„ç»ä½³ä»£è¨€äººã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-points/ten-06.png)

### ä»€ä¹ˆæ˜¯å­—ç¬¦ç¼–ç 

Qï¼šé‚£ä»€ä¹ˆæ˜¯å­—ç¬¦ç¼–ç å‘¢ï¼Ÿ

GPT4ï¼šå­—ç¬¦ç¼–ç ï¼ˆCharacter Encodingï¼‰æ˜¯ä¸€ç§è§„åˆ™æˆ–çº¦å®šï¼Œå®ƒå°†å­—ç¬¦ï¼ˆå¦‚å­—æ¯ã€æ•°å­—ã€æ ‡ç‚¹ç¬¦å·ç­‰ï¼‰æ˜ å°„åˆ°è®¡ç®—æœºä¸­çš„äºŒè¿›åˆ¶æ•°æ®ã€‚ç®€å•æ¥è¯´ï¼Œå­—ç¬¦ç¼–ç å°±æ˜¯å°†äººç±»å¯è¯»çš„å­—ç¬¦è½¬æ¢ä¸ºè®¡ç®—æœºå¯ä»¥å¤„ç†çš„äºŒè¿›åˆ¶æ•°æ®çš„è¿‡ç¨‹ã€‚

å¯¹äºè®¡ç®—æœºæ¥è¯´ï¼Œåªè®¤ 0 å’Œ 1ï¼Œæ‰€æœ‰çš„ä¿¡æ¯æœ€ç»ˆéƒ½æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ•°ã€‚ä¸€ä¸ªäºŒè¿›åˆ¶æ•°è¦ä¹ˆæ˜¯ 0ï¼Œè¦ä¹ˆæ˜¯ 1ã€‚8 ä¸ªäºŒè¿›åˆ¶æ•°æ”¾åœ¨ä¸€èµ·æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œå°±ä¼šç»„åˆå‡º 256 ç§çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ 2 çš„ 8 æ¬¡æ–¹ï¼ˆ`2^8`ï¼‰ï¼Œä» 00000000 åˆ° 11111111ã€‚

ä¸ºäº†è®©è®¡ç®—æœºèƒ½å¤Ÿè¯†åˆ«å’Œå¤„ç†å„ç§å­—ç¬¦ï¼Œéœ€è¦ä½¿ç”¨å­—ç¬¦ç¼–ç æ¥å¯¹å­—ç¬¦è¿›è¡Œç¼–ç å’Œè§£ç ã€‚å¸¸è§çš„å­—ç¬¦ç¼–ç åŒ…æ‹¬ ASCIIã€UTF-8ã€UTF-16ã€GBKã€GB2312 ç­‰ã€‚

![](https://cdn.tobebetterjavaer.com/studymore/char-byte-20230322174312.png)

#### **1ï¼‰ASCII**

ASCII ç ç”±ç”µæŠ¥ç å‘å±•è€Œæ¥ï¼Œç¬¬ä¸€ç‰ˆæ ‡å‡†å‘å¸ƒäº 1963 å¹´ï¼Œæœ€åä¸€æ¬¡æ›´æ–°åˆ™æ˜¯åœ¨ 1986 å¹´ï¼Œè‡³ä»Šä¸ºæ­¢å…±å®šä¹‰äº† 128 ä¸ªå­—ç¬¦ã€‚å…¶ä¸­ 33 ä¸ªå­—ç¬¦æ— æ³•æ˜¾ç¤ºåœ¨ä¸€èˆ¬çš„è®¾å¤‡ä¸Šï¼Œéœ€è¦ç”¨ç‰¹æ®Šçš„è®¾å¤‡æ‰èƒ½æ˜¾ç¤ºã€‚

ASCII ç çš„å±€é™åœ¨äºåªèƒ½æ˜¾ç¤º 26 ä¸ªåŸºæœ¬æ‹‰ä¸å­—æ¯ã€é˜¿æ‹‰ä¼¯æ•°å­—å’Œè‹±å¼æ ‡ç‚¹ç¬¦å·ï¼Œå› æ­¤åªèƒ½ç”¨äºæ˜¾ç¤ºç°ä»£ç¾å›½è‹±è¯­ï¼Œå¯¹äºå…¶ä»–ä¸€äº›è¯­è¨€åˆ™æ— èƒ½æ— åŠ›ï¼Œæ¯”å¦‚åœ¨æ³•è¯­ä¸­ï¼Œå­—æ¯ä¸Šæ–¹æœ‰æ³¨éŸ³ç¬¦å·ï¼Œå®ƒå°±æ— æ³•ç”¨ ASCII ç è¡¨ç¤ºã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-points/ten-01.png)

PSï¼šæ‹‰ä¸å­—æ¯ï¼ˆä¹Ÿç§°ä¸ºç½—é©¬å­—æ¯ï¼‰æ˜¯å¤šæ•°æ¬§æ´²è¯­è¨€é‡‡ç”¨çš„å­—æ¯ç³»ç»Ÿï¼Œæ˜¯ä¸–ç•Œä¸Šæœ€é€šè¡Œçš„å­—æ¯æ–‡å­—ç³»ç»Ÿï¼Œæ˜¯ç½—é©¬æ–‡æ˜çš„æˆæœä¹‹ä¸€ã€‚

è™½ç„¶åç§°ä¸Šå«ä½œæ‹‰ä¸å­—æ¯ï¼Œä½†æ‹‰ä¸æ–‡ä¸­å¹¶æ²¡æœ‰ç”¨ Jã€U å’Œ W è¿™ä¸‰ä¸ªå­—æ¯ã€‚

åœ¨æˆ‘çš„å°è±¡ä¸­ï¼Œå¯èƒ½è¯´æ‹‰ä¸å­—æ¯å¤šå°‘æœ‰äº›é™Œç”Ÿï¼Œè¯´è‹±è¯­å­—æ¯å¯èƒ½å°±æœ‰ç›´è§‚çš„å°è±¡äº†ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-points/ten-02.png)

é˜¿æ‹‰ä¼¯æ•°å­—ï¼Œæˆ‘ä»¬éƒ½å¾ˆç†Ÿæ‚‰äº†ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-points/ten-03.png)

ä½†æ˜¯ï¼Œé˜¿æ‹‰ä¼¯æ•°å­—å¹¶éèµ·æºäºé˜¿æ‹‰ä¼¯ï¼Œè€Œæ˜¯èµ·æºäºå¤å°åº¦ã€‚å­¦è¿‡å†å²çš„ä½ åº”è¯¥æœ‰ä¸€äº›å°è±¡ï¼Œé˜¿æ‹‰ä¼¯åˆ†å¸ƒäºè¥¿äºšå’ŒåŒ—éï¼Œä»¥é˜¿æ‹‰ä¼¯è¯­ä¸ºä¸»è¦è¯­è¨€ï¼Œä»¥ä¼Šæ–¯å…°æ•™ä¸ºä¸»è¦ä¿¡ä»°ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-points/ten-04.png)

å¤„åœ¨è¿™æ ·çš„åœ°ç†ä½ç½®ï¼Œåšèµ·ä¸œäºšå’Œæ¬§æ´²çš„ä¸€äº›ç”Ÿæ„å°±å¾ˆæœ‰ä¼˜åŠ¿ï¼Œäºæ˜¯é˜¿æ‹‰ä¼¯æ•°å­—å°±ç”±é˜¿æ‹‰ä¼¯äººä¼ åˆ°äº†æ¬§æ´²ï¼Œå› æ­¤å¾—åã€‚

è‹±å¼æ ‡ç‚¹ç¬¦å·ï¼Œä¹Ÿå«è‹±æ–‡æ ‡ç‚¹ç¬¦å·ï¼Œå’Œä¸­æ–‡æ ‡ç‚¹ç¬¦å·å¾ˆç›¸è¿‘ã€‚æ ‡ç‚¹ç¬¦å·æ˜¯è¾…åŠ©æ–‡å­—è®°å½•è¯­è¨€çš„ç¬¦å·ï¼Œæ˜¯ä¹¦é¢è¯­çš„ç»„æˆéƒ¨åˆ†ï¼Œç”¨æ¥è¡¨ç¤ºåœé¡¿ã€åŠ å¼ºè¯­æ°”ç­‰ã€‚

è‹±æ–‡æ ‡ç‚¹ç¬¦å·åœ¨ 16 ä¸–çºªæ—¶ï¼Œåˆ†ä¸ºæœ—è¯µå­¦æ´¾å’Œå¥æ³•å­¦æ´¾ï¼Œä¸»è¦ç”±å¤å…¸æ—¶æœŸçš„å¸Œè…Šæ–‡å’Œæ‹‰ä¸æ–‡æ¼”å˜è€Œæ¥ï¼Œåœ¨ 17 ä¸–çºªåè¿›å…¥ç¨³å®šé˜¶æ®µã€‚ä¿„æ–‡çš„æ ‡ç‚¹ç¬¦å·ä¾æ®å¸Œè…Šæ–‡è€Œæ¥ï¼Œåˆ°äº† 18 ä¸–çºªåä¹Ÿé‡‡ç”¨äº†è‹±æ–‡æ ‡ç‚¹ç¬¦å·ã€‚

åœ¨å¾ˆå¤šäººçš„å°è±¡ä¸­ï¼Œå¤æ–‡æ˜¯æ²¡æœ‰æ ‡ç‚¹ç¬¦å·çš„ï¼Œä½†ç®¡é”¡ååšå£«ç ”ç©¶æŒ‡å‡ºï¼Œ**ä¸­å›½æ—©åœ¨å…ˆç§¦æ—¶ä»£å°±æœ‰æ ‡ç‚¹ç¬¦å·äº†**ï¼Œåæ¥èåˆäº†ä¸€äº›è‹±æ–‡æ ‡ç‚¹ç¬¦å·åï¼Œé€æ¸å½¢æˆäº†ç°åœ¨çš„ä¸­æ–‡æ ‡ç‚¹ç¬¦å·ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-points/ten-05.png)


#### **2ï¼‰Unicode**

è¿™ä¸ªä¸–ç•Œä¸Šï¼Œé™¤äº†è‹±è¯­ï¼Œè¿˜æœ‰æ³•è¯­ã€è‘¡è„ç‰™è¯­ã€è¥¿ç­ç‰™è¯­ã€å¾·è¯­ã€ä¿„è¯­ã€é˜¿æ‹‰ä¼¯è¯­ã€éŸ©è¯­ã€æ—¥è¯­ç­‰ç­‰ç­‰ç­‰ã€‚ASCII ç ç”¨æ¥è¡¨ç¤ºè‹±è¯­æ˜¯ç»°ç»°æœ‰ä½™çš„ï¼Œä½†å…¶ä»–è¿™äº›è¯­è¨€å°±æ²¡åŠæ³•äº†ã€‚

åƒæˆ‘çš„ä¸»äººäºŒå“¥çš„æ¯è¯­â€”â€”ä¸­æ–‡ï¼Œå°±åšå¤§ç²¾æ·±ï¼Œä¸å…¶å¯¹åº”çš„æ±‰å­—æ•°é‡å¾ˆå¤šå¾ˆå¤šï¼Œä¸œæ±‰çš„ã€Šè¯´æ–‡è§£å­—ã€‹æ”¶å­— 9353 ä¸ªï¼Œæ¸…æœã€Šåº·ç†™å­—å…¸ã€‹æ”¶å­— 47035 ä¸ªï¼Œå½“ä»£çš„ã€Šæ±‰è¯­å¤§å­—å…¸ã€‹æ”¶å­— 60370 ä¸ªã€‚1994 å¹´ä¸­åä¹¦å±€ã€ä¸­å›½å‹è°Šå‡ºç‰ˆå…¬å¸å‡ºç‰ˆçš„ã€Šä¸­åå­—æµ·ã€‹æ”¶å­— 85568 ä¸ªã€‚

>å¸¸ç”¨å­—å¤§æ¦‚ 2500 ä¸ªï¼Œæ¬¡å¸¸ç”¨å­— 1000 ä¸ªã€‚

ä¸€ä¸ªå­—èŠ‚åªèƒ½è¡¨ç¤º 256 ç§ç¬¦å·ï¼Œæ‰€ä»¥å¦‚æœæ‹¿ ASCII ç æ¥è¡¨ç¤ºæ±‰å­—çš„è¯ï¼Œæ˜¯è¿œè¿œä¸å¤Ÿç”¨çš„ï¼Œé‚£å°±å¿…é¡»è¦ç”¨æ›´å¤šçš„å­—èŠ‚ã€‚ç®€ä½“ä¸­æ–‡å¸¸è§çš„ç¼–ç æ–¹å¼æ˜¯ GB2312ï¼Œä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªæ±‰å­—ï¼Œç†è®ºä¸Šæœ€å¤šå¯ä»¥è¡¨ç¤º 256 x 256 = 65536 ä¸ªç¬¦å·ã€‚

è¦çŸ¥é“ï¼Œä¸–ç•Œä¸Šå­˜åœ¨ç€å¤šç§ç¼–ç æ–¹å¼ï¼ŒåŒä¸€ä¸ªäºŒè¿›åˆ¶æ•°å­—å¯ä»¥è¢«è§£é‡Šæˆä¸åŒçš„ç¬¦å·ã€‚å› æ­¤ï¼Œè¦æƒ³æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå°±å¿…é¡»çŸ¥é“å®ƒçš„ç¼–ç æ–¹å¼ï¼Œå¦åˆ™ç”¨é”™è¯¯çš„ç¼–ç æ–¹å¼è§£è¯»ï¼Œå°±ä¼šå‡ºç°ä¹±ç ã€‚

- ç¼–ç å°±æ˜¯å°†åŸå§‹æ•°æ®ï¼ˆæ¯”å¦‚è¯´æ–‡æœ¬ã€å›¾åƒã€è§†é¢‘ã€éŸ³é¢‘ç­‰ï¼‰è½¬æ¢ä¸ºäºŒè¿›åˆ¶å½¢å¼ã€‚
- è§£ç å°±æ˜¯å°†äºŒè¿›åˆ¶æ•°æ®è½¬æ¢ä¸ºåŸå§‹æ•°æ®ï¼Œæ˜¯ä¸€ä¸ªåå‘çš„è¿‡ç¨‹ã€‚

å¦‚æœæœ‰ä¸€ç§ç¼–ç ï¼Œå°†ä¸–ç•Œä¸Šæ‰€æœ‰çš„ç¬¦å·éƒ½çº³å…¥å…¶ä¸­ã€‚æ¯ä¸€ä¸ªç¬¦å·éƒ½ç»™äºˆä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ç¼–ç ï¼Œé‚£ä¹ˆä¹±ç é—®é¢˜å°±ä¼šå½»åº•æ¶ˆå¤±ã€‚

è¿™ä¸ªè‰°å·¨çš„ä»»åŠ¡ç”±è°æ¥å®Œæˆå‘¢ï¼Ÿ**Unicode**ï¼Œä¸­æ–‡è¯‘ä½œä¸‡å›½ç ã€å›½é™…ç ã€ç»Ÿä¸€ç ã€å•ä¸€ç ï¼Œå°±åƒå®ƒçš„åå­—éƒ½è¡¨ç¤ºçš„ï¼Œè¿™æ˜¯ä¸€ç§æ‰€æœ‰ç¬¦å·çš„ç¼–ç ã€‚

Unicode è‡³ä»Šä»åœ¨ä¸æ–­å¢ä¿®ï¼Œæ¯ä¸ªæ–°ç‰ˆæœ¬éƒ½ä¼šåŠ å…¥æ›´å¤šæ–°çš„å­—ç¬¦ã€‚ç›®å‰æœ€æ–°çš„ç‰ˆæœ¬ä¸º 2020 å¹´ 3 æœˆå…¬å¸ƒçš„ 13.0ï¼Œæ”¶å½•äº† 13 ä¸‡ä¸ªå­—ç¬¦ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-points/ten-07.png)

Unicode æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é›†åˆï¼Œç°åœ¨çš„è§„æ¨¡å¯ä»¥å®¹çº³ 100 å¤šä¸‡ä¸ªç¬¦å·ã€‚æ¯ä¸ªç¬¦å·çš„ç¼–ç éƒ½ä¸ä¸€æ ·ï¼Œæ¯”å¦‚ï¼Œ`U+0639`è¡¨ç¤ºé˜¿æ‹‰ä¼¯å­—æ¯ `Ain`ï¼Œ`U+0041` è¡¨ç¤ºè‹±è¯­çš„å¤§å†™å­—æ¯ `A`ï¼Œ`U+4E25` è¡¨ç¤ºæ±‰å­—`ä¸¥`ã€‚

å…·ä½“çš„ç¬¦å·å¯¹åº”è¡¨ï¼Œå¯ä»¥æŸ¥è¯¢ï¼š

>- unicode.orgï¼š[http://www.unicode.org](http://www.unicode.org)
>- æ±‰å­—å¯¹åº”è¡¨ï¼š[ttp://www.chi2ko.com/tool/CJK.htm](http://www.chi2ko.com/tool/CJK.htm)

æ›¾æœ‰äººè¿™æ ·è¯´ï¼š

>Unicode æ”¯æŒçš„å­—ç¬¦ä¸Šé™æ˜¯ 65536 ä¸ªï¼ŒUnicode å­—ç¬¦å¿…é¡»å ä¸¤ä¸ªå­—èŠ‚ã€‚

ä½†è¿™æ˜¯ä¸€ç§è¯¯è§£ï¼Œè®°ä½ï¼ŒUnicode åªæ˜¯ä¸€ä¸ªç”¨æ¥æ˜ å°„å­—ç¬¦å’Œæ•°å­—çš„æ ‡å‡†ã€‚å®ƒå¯¹æ”¯æŒå­—ç¬¦çš„æ•°é‡æ²¡æœ‰é™åˆ¶ï¼Œä¹Ÿä¸è¦æ±‚å­—ç¬¦å¿…é¡»å ä¸¤ä¸ªã€ä¸‰ä¸ªæˆ–è€…å…¶å®ƒä»»æ„æ•°é‡çš„å­—èŠ‚ï¼Œæ‰€ä»¥å®ƒå¯ä»¥æ— ç©·å¤§ã€‚

#### 3ï¼‰UTF-8

Unicode è™½ç„¶ç»Ÿä¸€äº†å…¨ä¸–ç•Œå­—ç¬¦çš„ç¼–ç ï¼Œä½†æ²¡æœ‰è§„å®šå¦‚ä½•å­˜å‚¨ã€‚å¦‚æœç»Ÿä¸€è§„å®šçš„è¯ï¼Œæ¯ä¸ªç¬¦å·å°±è¦ç”¨ 3 ä¸ªæˆ– 4 ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œå› ä¸º 2 ä¸ªå­—èŠ‚åªèƒ½è¡¨ç¤º 65536 ä¸ªï¼Œæ ¹æœ¬è¡¨ç¤ºä¸å…¨ã€‚

é‚£æ€ä¹ˆåŠå‘¢ï¼Ÿ

UTFï¼ˆUnicode Transformation Formatsï¼ŒUnicode çš„ç¼–ç æ–¹å¼ï¼‰æ¥äº†ï¼æœ€å¸¸è§çš„å°±æ˜¯ UTF-8 å’Œ UTF-16ã€‚

åœ¨ UTF-8 ä¸­ï¼Œ0-127 å·çš„å­—ç¬¦ç”¨ 1 ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºï¼Œä½¿ç”¨å’Œ ASCII ç›¸åŒçš„ç¼–ç ã€‚åªæœ‰ 128 å·åŠä»¥ä¸Šçš„å­—ç¬¦æ‰ç”¨ 2 ä¸ªã€3 ä¸ªæˆ–è€… 4 ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºã€‚

å¦‚æœåªæœ‰ä¸€ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆæœ€é«˜çš„æ¯”ç‰¹ä½ä¸º 0ï¼›å¦‚æœæœ‰å¤šä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå­—èŠ‚ä»æœ€é«˜ä½å¼€å§‹ï¼Œè¿ç»­æœ‰å‡ ä¸ªæ¯”ç‰¹ä½çš„å€¼ä¸º 1ï¼Œå°±ä½¿ç”¨å‡ ä¸ªå­—èŠ‚ç¼–ç ï¼Œå‰©ä¸‹çš„å­—èŠ‚å‡ä»¥ 10 å¼€å¤´ã€‚

å…·ä½“çš„è¡¨ç°å½¢å¼ä¸ºï¼š

- 0xxxxxxxï¼šä¸€ä¸ªå­—èŠ‚ï¼›
- 110xxxxx 10xxxxxxï¼šä¸¤ä¸ªå­—èŠ‚ç¼–ç å½¢å¼ï¼ˆå¼€å§‹ä¸¤ä¸ª 1ï¼‰ï¼›
- 1110xxxx 10xxxxxx 10xxxxxxï¼šä¸‰å­—èŠ‚ç¼–ç å½¢å¼ï¼ˆå¼€å§‹ä¸‰ä¸ª 1ï¼‰ï¼›
- 11110xxx 10xxxxxx 10xxxxxx 10xxxxxxï¼šå››å­—èŠ‚ç¼–ç å½¢å¼ï¼ˆå¼€å§‹å››ä¸ª 1ï¼‰ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼ŒUTF-8 æ˜¯ä¸€ç§å¯å˜é•¿åº¦çš„ç¼–ç æ–¹å¼â€”â€”è¿™æ˜¯å®ƒçš„ä¼˜åŠ¿ä¹Ÿæ˜¯åŠ£åŠ¿ã€‚

æ€ä¹ˆè®²å‘¢ï¼Ÿä¼˜åŠ¿å°±æ˜¯å®ƒåŒ…ç½—ä¸‡è±¡ï¼ŒåŠ£åŠ¿å°±æ˜¯æµªè´¹ç©ºé—´ã€‚ä¸¾ä¾‹æ¥è¯´å§ï¼ŒUTF-8 é‡‡ç”¨äº† 3 ä¸ªå­—èŠ‚ï¼ˆ`256*256*256=16777216`ï¼‰æ¥ç¼–ç å¸¸ç”¨çš„æ±‰å­—ï¼Œä½†å¸¸ç”¨çš„æ±‰å­—æ²¡æœ‰è¿™ä¹ˆå¤šï¼Œè¿™å¯¹äºè®¡ç®—æœºæ¥è¯´ï¼Œå°±æ˜¯ä¸€ç§ä¸¥é‡çš„èµ„æºæµªè´¹ã€‚

#### 4ï¼‰GB2312

åŸºäºè¿™æ ·çš„è€ƒè™‘ï¼Œä¸­å›½å›½å®¶æ ‡å‡†æ€»å±€äº 1980 å¹´å‘å¸ƒäº† GB2312 ç¼–ç ï¼Œå³ä¸­åäººæ°‘å…±å’Œå›½å›½å®¶æ ‡å‡†ç®€ä½“ä¸­æ–‡å­—ç¬¦é›†ã€‚GB2312 æ ‡å‡†å…±æ”¶å½• 6763 ä¸ªæ±‰å­—ï¼ˆ2 ä¸ªå­—èŠ‚å°±å¤Ÿç”¨äº†ï¼‰ï¼Œå…¶ä¸­ä¸€çº§æ±‰å­— 3755 ä¸ªï¼ŒäºŒçº§æ±‰å­— 3008 ä¸ªï¼›åŒæ—¶æ”¶å½•äº†åŒ…æ‹¬æ‹‰ä¸å­—æ¯ã€å¸Œè…Šå­—æ¯ã€æ—¥æ–‡å¹³å‡ååŠç‰‡å‡åå­—æ¯ã€ä¿„è¯­è¥¿é‡Œå°”å­—æ¯åœ¨å†…çš„ 682 ä¸ªå­—ç¬¦ã€‚

GB2312 çš„å‡ºç°ï¼ŒåŸºæœ¬æ»¡è¶³äº†æ±‰å­—çš„è®¡ç®—æœºå¤„ç†éœ€æ±‚ã€‚å¯¹äºäººåã€å¤æ±‰è¯­ç­‰æ–¹é¢å‡ºç°çš„ç½•ç”¨å­—å’Œç¹ä½“å­—ï¼ŒGB2312 ä¸èƒ½å¤„ç†ï¼Œå°±æœ‰äº† GBKï¼ˆK ä¸ºâ€œæ‰©å±•â€çš„æ±‰è¯­æ‹¼éŸ³ï¼ˆkuÃ²zhÇnï¼‰ç¬¬ä¸€ä¸ªå£°æ¯ï¼‰ã€‚

### ä¸­æ–‡ä¹±ç æ˜¯å¦‚ä½•å‡ºç°çš„ï¼Ÿ

Qï¼šæ¥ä¸€ä¸²å‡ºç°ä¸­æ–‡ä¹±ç çš„ demoï¼Œä¸­æ–‡ä¸ºæ²‰é»˜ç‹äºŒ

GPT4ï¼šä¸‹é¢æ˜¯ä¸€ä¸ªå¯èƒ½å¯¼è‡´ä¸­æ–‡ä¹±ç çš„ç¤ºä¾‹ã€‚é¦–å…ˆä½¿ç”¨ GBK ç¼–ç å°†ä¸­æ–‡å­—ç¬¦ä¸² "æ²‰é»˜ç‹äºŒ" è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„ï¼Œç„¶åä½¿ç”¨ UTF-8 ç¼–ç å°†å­—èŠ‚æ•°ç»„è½¬å›å­—ç¬¦ä¸²ã€‚è¿™å°†å¯¼è‡´å­—ç¬¦ä¸²åœ¨è§£ç æ—¶å‡ºç°ä¹±ç ã€‚

```java
public class EncodingDemo {
    public static void main(String[] args) {
        String originalStr = "æ²‰é»˜ç‹äºŒ";
        String encodedStr = "";

        try {
            byte[] bytes = originalStr.getBytes("GBK");
            encodedStr = new String(bytes, "UTF-8");
        } catch (UnsupportedEncodingException e) {
            e.printStackTrace();
        }

        System.out.println("è½¬ç å‰: " + originalStr);
        System.out.println("è½¬ç å: " + encodedStr);
    }
}
```

ç¨‹åºä¼šè¾“å‡ºä»€ä¹ˆå‘¢ï¼Ÿ

```
è½¬ç å‰: æ²‰é»˜ç‹äºŒ
è½¬ç å: ï¿½ï¿½Ä¬ï¿½ï¿½ï¿½ï¿½
```

å˜¿å˜¿ï¼Œä¹±ç æ¥äº†ï¼åœ¨ Unicode ä¸­ï¼Œï¿½ æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç¬¦å·ï¼Œå®ƒç”¨æ¥è¡¨ç¤ºæ— æ³•æ˜¾ç¤ºï¼Œå®ƒçš„åå…­è¿›åˆ¶æ˜¯ `0xEF 0xBF 0xBD`ã€‚é‚£ä¹ˆä¸¤ä¸ª ï¿½ï¿½ å°±æ˜¯ `0xEF 0xBF 0xBD 0xEF 0xBF 0xBD`ï¼Œå¦‚æœç”¨ GBK è¿›è¡Œè§£ç çš„è¯ï¼Œå°±æ˜¯å¤§åé¼é¼çš„â€œ**é”Ÿæ–¤æ‹·**â€ã€‚

å¯ä»¥é€šè¿‡ä»£ç æ¥éªŒè¯ä¸€ä¸‹ï¼š

```java
// è¾“å‡º efbfbdefbfbd
char[] kuijinkao = HexUtil.encodeHex("ï¿½ï¿½", StandardCharsets.UTF_8);
System.out.println(kuijinkao);
// å€ŸåŠ© hutool è½¬æˆäºŒè¿›åˆ¶
byte[] testBytes = HexUtil.decodeHex(kuijinkao);
// ä½¿ç”¨ GBK è§£ç 
String testResult = new String(testBytes, Charset.forName("GBK"));
// è¾“å‡ºé”Ÿæ–¤æ‹·
System.out.println(testResult);
```

æ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœï¼š

```java
efbfbdefbfbd
é”Ÿæ–¤æ‹·
```

æ‰€ä»¥ï¼Œä»¥åå†è§åˆ°**é”Ÿæ–¤æ‹·**ï¼Œç¬¬ä¸€æ—¶é—´æƒ³åˆ° UTF-8 å’Œ GBK çš„è½¬æ¢é—®é¢˜å‡†æ²¡é”™ã€‚

### å¦‚ä½•è§£å†³ä¸­æ–‡ä¹±ç å‘¢ï¼Ÿ

Qï¼šå¦‚ä½•è§£å†³ä¸­æ–‡ä¹±ç å‘¢ï¼Ÿ

GPT4ï¼šè§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜éœ€è¦ç¡®ä¿åœ¨ç¼–ç å’Œè§£ç è¿‡ç¨‹ä¸­ä½¿ç”¨ç›¸åŒçš„å­—ç¬¦ç¼–ç ã€‚è¿™æ˜¯ä¸€ä¸ªä¿®æ”¹è¿‡çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•é¿å…ä¸­æ–‡ä¹±ç é—®é¢˜ï¼š

```java
String originalStr = "æ²‰é»˜ç‹äºŒ";

byte[] bytes = originalStr.getBytes(StandardCharsets.UTF_8);
String encodedStr = new String(bytes, StandardCharsets.UTF_8);

System.out.println("æ­£ç¡®è½¬ç å‰: " + originalStr);
System.out.println("æ­£ç¡®è½¬ç å: " + encodedStr);
```

è¾“å‡ºç»“æœï¼š

```java
æ­£ç¡®è½¬ç å‰: æ²‰é»˜ç‹äºŒ
æ­£ç¡®è½¬ç å: æ²‰é»˜ç‹äºŒ
```

é™¤æ­¤ä¹‹å¤–ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›é¿å…ä¹±ç çš„å®è·µï¼š

- ä½¿ç”¨ç»Ÿä¸€çš„å­—ç¬¦ç¼–ç ï¼Œå¦‚ UTF-8ã€‚å®ƒåŒ…å«äº†æ‰€æœ‰ Unicode å­—ç¬¦ï¼Œå¹¶ä¸”å¹¿æ³›æ”¯æŒã€‚ç¡®ä¿åœ¨æ‰€æœ‰å¹³å°å’Œç³»ç»Ÿä¸Šä½¿ç”¨ç›¸åŒçš„ç¼–ç ã€‚
- åœ¨å¤„ç†æ–‡æœ¬æ–‡ä»¶æ—¶ï¼Œå§‹ç»ˆæ˜ç¡®æŒ‡å®šå­—ç¬¦ç¼–ç ã€‚ä¾‹å¦‚ï¼Œåœ¨ Java ä¸­ä½¿ç”¨ InputStreamReaderã€OutputStreamWriter æ—¶ï¼ŒæŒ‡å®šç¼–ç å‚æ•°ã€‚
- åœ¨ HTMLã€XML ç­‰æ–‡æ¡£ä¸­ï¼ŒæŒ‡å®šå­—ç¬¦ç¼–ç ã€‚ä¾‹å¦‚ï¼Œåœ¨ HTML é¡µé¢ä¸­æ·»åŠ  `<meta charset="UTF-8">`ã€‚
- å¯¹äºæ•°æ®åº“ï¼Œç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„å­—ç¬¦é›†ã€‚åœ¨åˆ›å»ºæ•°æ®åº“å’Œè¡¨æ—¶ï¼Œæ˜ç¡®æŒ‡å®šå­—ç¬¦é›†ï¼Œå¦‚ utf8mb4ã€‚

å½“ä¸ç¬¬ä¸‰æ–¹æœåŠ¡é€šä¿¡æ—¶ï¼Œç¡®ä¿åŒæ–¹ä½¿ç”¨ç›¸åŒçš„å­—ç¬¦ç¼–ç ã€‚åœ¨å¤„ç† API è¯·æ±‚å’Œå“åº”æ—¶ï¼Œæ£€æŸ¥å­—ç¬¦ç¼–ç æ˜¯å¦åŒ¹é…ã€‚

Qï¼šé’ˆå¯¹æ”¯ä»˜å®è¿™ç§ç”Ÿäº§ç¯å¢ƒäº‹æ•…ï¼Œå¦‚ä½•å¿«é€Ÿå®šä½å¹¶è§£å†³é—®é¢˜å‘¢ï¼Ÿ

GPT4ï¼š

1ã€æ”¶é›†ä¿¡æ¯ï¼šäº†è§£é—®é¢˜çš„å…·ä½“è¡¨ç°ï¼Œä¾‹å¦‚å“ªäº›é¡µé¢æˆ–åŠŸèƒ½å—åˆ°å½±å“ï¼Œé—®é¢˜çš„ä¸¥é‡ç¨‹åº¦ï¼Œä»¥åŠç”¨æˆ·åé¦ˆã€‚è¿™å°†æœ‰åŠ©äºå¿«é€Ÿå®šä½é—®é¢˜èŒƒå›´ã€‚

2ã€æ£€æŸ¥æ—¥å¿—ï¼šæŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—å’Œåº”ç”¨ç¨‹åºæ—¥å¿—ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨å¼‚å¸¸ä¿¡æ¯æˆ–é”™è¯¯ã€‚æ—¥å¿—ä¿¡æ¯æœ‰åŠ©äºè¯†åˆ«é—®é¢˜å‘ç”Ÿçš„æ—¶é—´å’Œå…·ä½“åŸå› ã€‚

3ã€å¤ç°é—®é¢˜ï¼šåœ¨æµ‹è¯•ç¯å¢ƒä¸­å°è¯•å¤ç°é—®é¢˜ï¼Œä»¥ä¾¿æ›´æ·±å…¥åœ°äº†è§£é—®é¢˜ç»†èŠ‚ã€‚å¦‚æœæ— æ³•å¤ç°é—®é¢˜ï¼Œå¯èƒ½éœ€è¦è¿›ä¸€æ­¥æ”¶é›†ç”Ÿäº§ç¯å¢ƒçš„è¯¦ç»†ä¿¡æ¯ã€‚

4ã€å®šä½é—®é¢˜ï¼šæ ¹æ®æ”¶é›†åˆ°çš„ä¿¡æ¯ï¼Œç¡®å®šé—®é¢˜å¯èƒ½å‘ç”Ÿçš„ä»£ç æˆ–ç³»ç»Ÿéƒ¨åˆ†ã€‚æ£€æŸ¥ç›¸å…³ä»£ç ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠå­—ç¬¦ç¼–ç ã€æ•°æ®ä¼ è¾“ã€æ•°æ®åº“æ“ä½œçš„éƒ¨åˆ†ã€‚

5ã€è§£å†³é—®é¢˜ï¼šä¿®å¤é—®é¢˜ä»£ç ï¼Œç¡®ä¿å­—ç¬¦ç¼–ç åœ¨æ•´ä¸ªç³»ç»Ÿä¸­ä¿æŒä¸€è‡´ã€‚è¿›è¡Œå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼ŒéªŒè¯é—®é¢˜æ˜¯å¦å·²è§£å†³ã€‚

6ã€éƒ¨ç½²ä¿®å¤ï¼šå°†ä¿®å¤åçš„ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚ä¸ºäº†é¿å…å½±å“æ­£å¸¸æœåŠ¡ï¼Œå¯ä»¥è€ƒè™‘å…ˆåœ¨ä¸€ä¸ªå°è§„æ¨¡çš„ç”Ÿäº§ç¯å¢ƒä¸­è¿›è¡ŒéªŒè¯ï¼Œç„¶åé€æ­¥æ‰©å¤§éƒ¨ç½²èŒƒå›´ã€‚

7ã€ç›‘æ§ï¼šåœ¨ä¿®å¤åæŒç»­å…³æ³¨ç³»ç»Ÿè¿è¡ŒçŠ¶å†µï¼Œç¡®ä¿é—®é¢˜å·²å¾—åˆ°è§£å†³ã€‚æ”¶é›†ç”¨æˆ·åé¦ˆï¼Œç¡®è®¤ç”¨æˆ·æ»¡æ„åº¦ã€‚

8ã€æ€»ç»“ç»éªŒï¼šé’ˆå¯¹æ­¤æ¬¡é—®é¢˜ï¼Œæ€»ç»“ç»éªŒæ•™è®­ï¼Œåˆ†æé—®é¢˜äº§ç”Ÿçš„æ ¹æœ¬åŸå› ï¼Œä¼˜åŒ–å¼€å‘å’Œæµ‹è¯•æµç¨‹ï¼Œé¿å…ç±»ä¼¼é—®é¢˜å†æ¬¡å‘ç”Ÿã€‚

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 13.3 æ·±å…¥å‰–æJavaä¸­çš„æ‹†ç®±å’Œè£…ç®±

â€œå“¥ï¼Œå¬è¯´ Java çš„æ¯ä¸ª[åŸºæœ¬ç±»å‹](https://tobebetterjavaer.com/basic-grammar/basic-data-type.html)éƒ½å¯¹åº”äº†ä¸€ä¸ªåŒ…è£…ç±»å‹ï¼Œæ¯”å¦‚è¯´ int çš„åŒ…è£…ç±»å‹ä¸º Integerï¼Œdouble çš„åŒ…è£…ç±»å‹ä¸º Doubleï¼Œæ˜¯è¿™æ ·å—ï¼Ÿâ€ä»ä¸‰å¦¹è¿™å¥è¯å½“ä¸­ï¼Œèƒ½å¬å¾—å‡ºæ¥ï¼Œå¥¹å·²ç»æå‰é¢„ä¹ è¿™å—å†…å®¹äº†ã€‚

â€œæ˜¯çš„ï¼Œä¸‰å¦¹ã€‚åŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»å‹çš„åŒºåˆ«ä¸»è¦æœ‰ä»¥ä¸‹ 4 ç‚¹ï¼Œæˆ‘æ¥å¸¦ä½ å­¦ä¹ ä¸€ä¸‹ã€‚â€æˆ‘å›ç­”è¯´ã€‚æˆ‘ä»¬å®¶çš„æ–œå¯¹é¢åˆšå¥½æ˜¯ä¸€æ‰€å°å­¦ï¼Œæ‰€ä»¥æ—¶ä¸æ—¶è¿˜èƒ½å¬åˆ°æœ—æœ—çš„è¯»ä¹¦å£°ï¼Œè®©äººå¿ƒæƒ…éå¸¸æ„‰å¿«ã€‚

â€œä¸‰å¦¹ï¼Œä½ å‡†å¤‡å¥½äº†å—ï¼Ÿæˆ‘ä»¬å¼€å§‹å§ã€‚â€

â€œç¬¬ä¸€ï¼Œ**åŒ…è£…ç±»å‹å¯ä»¥ä¸º nullï¼Œè€ŒåŸºæœ¬ç±»å‹ä¸å¯ä»¥**ã€‚åˆ«å°çœ‹è¿™ä¸€ç‚¹åŒºåˆ«ï¼Œå®ƒä½¿å¾—åŒ…è£…ç±»å‹å¯ä»¥åº”ç”¨äº POJO ä¸­ï¼Œè€ŒåŸºæœ¬ç±»å‹åˆ™ä¸è¡Œã€‚â€

â€œPOJO æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿâ€é‡åˆ°ä¸ä¼šçš„å°±é—®ï¼Œä¸‰å¦¹åœ¨è¿™ä¸€ç‚¹ä¸Šè¿˜æ˜¯éå¸¸å…¢å…¢ä¸šä¸šçš„ã€‚

â€œPOJO çš„è‹±æ–‡å…¨ç§°æ˜¯ Plain Ordinary Java Objectï¼Œç¿»è¯‘ä¸€ä¸‹å°±æ˜¯ï¼Œç®€å•æ— è§„åˆ™çš„ Java å¯¹è±¡ï¼Œåªæœ‰å­—æ®µä»¥åŠå¯¹åº”çš„ setter å’Œ getter æ–¹æ³•ã€‚â€

```java
class Writer {
	private Integer age;
	private String name;

	public Integer getAge() {
		return age;
	}

	public void setAge(Integer age) {
		this.age = age;
	}

	public String getName() {
		return name;
	}

	public void setName(String name) {
		this.name = name;
	}
}
```

å’Œ POJO ç±»ä¼¼çš„ï¼Œè¿˜æœ‰æ•°æ®ä¼ è¾“å¯¹è±¡ DTOï¼ˆData Transfer Objectï¼Œæ³›æŒ‡ç”¨äºå±•ç¤ºå±‚ä¸æœåŠ¡å±‚ä¹‹é—´çš„æ•°æ®ä¼ è¾“å¯¹è±¡ï¼‰ã€è§†å›¾å¯¹è±¡ VOï¼ˆView Objectï¼ŒæŠŠæŸä¸ªé¡µé¢çš„æ•°æ®å°è£…èµ·æ¥ï¼‰ã€æŒä¹…åŒ–å¯¹è±¡ POï¼ˆPersistant Objectï¼Œå¯ä»¥çœ‹æˆæ˜¯ä¸æ•°æ®åº“ä¸­çš„è¡¨æ˜ å°„çš„ Java å¯¹è±¡ï¼‰ã€‚

â€œé‚£ä¸ºä»€ä¹ˆ POJO çš„å­—æ®µå¿…é¡»è¦ç”¨åŒ…è£…ç±»å‹å‘¢ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œã€Š[é˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œ](https://tobebetterjavaer.com/pdf/ali-java-shouce.html)ã€‹ä¸Šæœ‰è¯¦ç»†çš„è¯´æ˜ï¼Œä½ çœ‹ã€‚â€æˆ‘æ‰“å¼€ PDFï¼Œå¹¶ç¿»åˆ°äº†å¯¹åº”çš„å†…å®¹ï¼ŒæŒ‡ç€å±å¹•å¿µé“ã€‚

>æ•°æ®åº“çš„æŸ¥è¯¢ç»“æœå¯èƒ½æ˜¯ nullï¼Œå¦‚æœä½¿ç”¨åŸºæœ¬ç±»å‹çš„è¯ï¼Œå› ä¸ºè¦è‡ªåŠ¨æ‹†ç®±ï¼Œå°±ä¼šæŠ›å‡º [NullPointerException çš„å¼‚å¸¸](https://tobebetterjavaer.com/exception/npe.html)ã€‚

â€œä»€ä¹ˆæ˜¯è‡ªåŠ¨æ‹†ç®±å‘¢ï¼Ÿâ€

â€œè‡ªåŠ¨æ‹†ç®±æŒ‡çš„æ˜¯ï¼Œå°†åŒ…è£…ç±»å‹è½¬ä¸ºåŸºæœ¬ç±»å‹ï¼Œæ¯”å¦‚è¯´æŠŠ Integer å¯¹è±¡è½¬æ¢æˆ int å€¼ï¼›å¯¹åº”çš„ï¼ŒæŠŠåŸºæœ¬ç±»å‹è½¬ä¸ºåŒ…è£…ç±»å‹ï¼Œåˆ™ç§°ä¸ºè‡ªåŠ¨è£…ç®±ã€‚â€

â€œå“¦ã€‚â€

â€œé‚£æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ç¬¬äºŒç‚¹ä¸åŒã€‚**åŒ…è£…ç±»å‹å¯ç”¨äºæ³›å‹ï¼Œè€ŒåŸºæœ¬ç±»å‹ä¸å¯ä»¥**ï¼Œå¦åˆ™å°±ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ã€‚â€ä¸€è¾¹è¯´ç€ï¼Œæˆ‘ä¸€è¾¹åœ¨ Intellij IDEA ä¸­å™¼é‡Œå•ªå•¦åœ°æ•²äº†èµ·æ¥ã€‚

â€œä¸‰å¦¹ï¼Œä½ ç§ï¼Œç¼–è¯‘å™¨æç¤ºé”™è¯¯äº†ã€‚â€

```java
List<int> list = new ArrayList<>(); // æç¤º Syntax error, insert "Dimensions" to complete ReferenceType
List<Integer> list = new ArrayList<>();
```

â€œä¸ºä»€ä¹ˆå‘¢ï¼Ÿâ€ä¸‰å¦¹åŠæ—¶åœ°é—®é“ã€‚

â€œå› ä¸º[æ³›å‹](https://tobebetterjavaer.com/basic-extra-meal/generic.html)åœ¨ç¼–è¯‘æ—¶ä¼šè¿›è¡Œç±»å‹æ“¦é™¤ï¼Œæœ€ååªä¿ç•™åŸå§‹ç±»å‹ï¼Œè€ŒåŸå§‹ç±»å‹åªèƒ½æ˜¯ Object ç±»åŠå…¶å­ç±»â€”â€”åŸºæœ¬ç±»å‹æ˜¯ä¸ªä¾‹å¤–ã€‚â€

â€œé‚£ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥è¯´ç¬¬ä¸‰ç‚¹ï¼Œ**åŸºæœ¬ç±»å‹æ¯”åŒ…è£…ç±»å‹æ›´é«˜æ•ˆ**ã€‚â€æˆ‘å–äº†ä¸€å£èŒ¶ç»§ç»­è¯´é“ã€‚

â€œä½œä¸ºå±€éƒ¨å˜é‡æ—¶ï¼ŒåŸºæœ¬ç±»å‹åœ¨æ ˆä¸­ç›´æ¥å­˜å‚¨çš„å…·ä½“æ•°å€¼ï¼Œè€ŒåŒ…è£…ç±»å‹åˆ™å­˜å‚¨çš„æ˜¯å †ä¸­çš„å¼•ç”¨ã€‚â€æˆ‘ä¸€è¾¹è¯´ç€ï¼Œä¸€è¾¹æ‰“å¼€ [`draw.io`](https://app.diagrams.net/) ç”»èµ·äº†å›¾ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-points/box-01.png)

å¾ˆæ˜¾ç„¶ï¼Œç›¸æ¯”è¾ƒäºåŸºæœ¬ç±»å‹è€Œè¨€ï¼ŒåŒ…è£…ç±»å‹éœ€è¦å ç”¨æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼Œä¸ä»…è¦å­˜å‚¨å¯¹è±¡ï¼Œè¿˜è¦å­˜å‚¨å¼•ç”¨ã€‚å‡å¦‚æ²¡æœ‰åŸºæœ¬ç±»å‹çš„è¯ï¼Œå¯¹äºæ•°å€¼è¿™ç±»ç»å¸¸ä½¿ç”¨åˆ°çš„æ•°æ®æ¥è¯´ï¼Œæ¯æ¬¡éƒ½è¦é€šè¿‡ new ä¸€ä¸ªåŒ…è£…ç±»å‹å°±æ˜¾å¾—éå¸¸ç¬¨é‡ã€‚

â€œä¸‰å¦¹ï¼Œä½ æƒ³çŸ¥é“ç¨‹åºè¿è¡Œæ—¶ï¼Œæ•°æ®éƒ½å­˜å‚¨åœ¨ä»€ä¹ˆåœ°æ–¹å—ï¼Ÿâ€

â€œå—¯å—¯ï¼Œå“¥ï¼Œä½ è¯´è¯´å‘—ã€‚â€

â€œé€šå¸¸æ¥è¯´ï¼Œæœ‰ 4 ä¸ªåœ°æ–¹å¯ä»¥ç”¨æ¥å­˜å‚¨æ•°æ®ã€‚â€

1ï¼‰å¯„å­˜å™¨ã€‚è¿™æ˜¯æœ€å¿«çš„å­˜å‚¨åŒºï¼Œå› ä¸ºå®ƒä½äº CPU å†…éƒ¨ï¼Œç”¨æ¥æš‚æ—¶å­˜æ”¾å‚ä¸è¿ç®—çš„æ•°æ®å’Œè¿ç®—ç»“æœã€‚

2ï¼‰æ ˆã€‚ä½äº RAMï¼ˆRandom Access Memoryï¼Œä¹Ÿå«ä¸»å­˜ï¼Œä¸ CPU ç›´æ¥äº¤æ¢æ•°æ®çš„å†…éƒ¨å­˜å‚¨å™¨ï¼‰ä¸­ï¼Œé€Ÿåº¦ä»…æ¬¡äºå¯„å­˜å™¨ã€‚ä½†æ˜¯ï¼Œåœ¨åˆ†é…å†…å­˜çš„æ—¶å€™ï¼Œå­˜æ”¾åœ¨æ ˆä¸­çš„æ•°æ®å¤§å°ä¸ç”Ÿå­˜å‘¨æœŸå¿…é¡»åœ¨ç¼–è¯‘æ—¶æ˜¯ç¡®å®šçš„ï¼Œç¼ºä¹çµæ´»æ€§ã€‚åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼å’Œå¯¹è±¡çš„å¼•ç”¨é€šå¸¸å­˜å‚¨åœ¨è¿™å—åŒºåŸŸã€‚

3ï¼‰å †ã€‚ä¹Ÿä½äº RAM åŒºï¼Œå¯ä»¥åŠ¨æ€åˆ†é…å†…å­˜å¤§å°ï¼Œç¼–è¯‘å™¨ä¸å¿…çŸ¥é“è¦ä»å †é‡Œåˆ†é…å¤šå°‘å­˜å‚¨ç©ºé—´ï¼Œç”Ÿå­˜å‘¨æœŸä¹Ÿä¸å¿…äº‹å…ˆå‘Šè¯‰ç¼–è¯‘å™¨ï¼ŒJava çš„åƒåœ¾æ”¶é›†å™¨ä¼šè‡ªåŠ¨æ”¶èµ°ä¸å†ä½¿ç”¨çš„æ•°æ®ï¼Œå› æ­¤å¯ä»¥å¾—åˆ°æ›´å¤§çš„çµæ´»æ€§ã€‚ä½†æ˜¯ï¼Œè¿è¡Œæ—¶åŠ¨æ€åˆ†é…å†…å­˜å’Œé”€æ¯å¯¹è±¡éƒ½éœ€è¦å ç”¨æ—¶é—´ï¼Œæ‰€ä»¥æ•ˆç‡æ¯”æ ˆä½ä¸€äº›ã€‚new åˆ›å»ºçš„å¯¹è±¡éƒ½ä¼šå­˜å‚¨åœ¨è¿™å—åŒºåŸŸã€‚

4ï¼‰ç£ç›˜ã€‚å¦‚æœæ•°æ®å®Œå…¨å­˜å‚¨åœ¨ç¨‹åºä¹‹å¤–ï¼Œå°±å¯ä»¥ä¸å—ç¨‹åºçš„é™åˆ¶ï¼Œåœ¨ç¨‹åºæ²¡æœ‰è¿è¡Œæ—¶ä¹Ÿå¯ä»¥å­˜åœ¨ã€‚åƒæ–‡ä»¶ã€æ•°æ®åº“ï¼Œå°±æ˜¯é€šè¿‡æŒä¹…åŒ–çš„æ–¹å¼ï¼Œè®©å¯¹è±¡å­˜æ”¾åœ¨ç£ç›˜ä¸Šã€‚å½“éœ€è¦çš„æ—¶å€™ï¼Œå†ååºåˆ—åŒ–æˆç¨‹åºå¯ä»¥è¯†åˆ«çš„å¯¹è±¡ã€‚

â€œèƒ½æ˜ç™½å—ï¼Ÿä¸‰å¦¹ï¼Ÿâ€

â€œè¿™èŠ‚è®²å®Œåï¼Œæˆ‘å†å¥½å¥½æ¶ˆåŒ–ä¸€ä¸‹ã€‚â€

â€œé‚£å¥½ï¼Œæˆ‘ä»¬æ¥è¯´ç¬¬å››ç‚¹ï¼Œ**ä¸¤ä¸ªåŒ…è£…ç±»å‹çš„å€¼å¯ä»¥ç›¸åŒï¼Œä½†å´ä¸ç›¸ç­‰**ã€‚â€

```java
Integer chenmo = new Integer(10);
Integer wanger = new Integer(10);

System.out.println(chenmo == wanger); // false
System.out.println(chenmo.equals(wanger )); // true
```

â€œä¸¤ä¸ªåŒ…è£…ç±»å‹åœ¨ä½¿ç”¨â€œ==â€è¿›è¡Œåˆ¤æ–­çš„æ—¶å€™ï¼Œåˆ¤æ–­çš„æ˜¯å…¶æŒ‡å‘çš„åœ°å€æ˜¯å¦ç›¸ç­‰ï¼Œç”±äºæ˜¯ä¸¤ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥åœ°å€æ˜¯ä¸åŒçš„ã€‚â€

â€œè€Œ `chenmo.equals(wanger)` çš„è¾“å‡ºç»“æœä¸º trueï¼Œæ˜¯å› ä¸º `equals()` æ–¹æ³•å†…éƒ¨æ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ª int å€¼æ˜¯å¦ç›¸ç­‰ã€‚â€

```java
private final int value;

public int intValue() {
    return value;
}
public boolean equals(Object obj) {
    if (obj instanceof Integer) {
        return value == ((Integer)obj).intValue();
    }
    return false;
}
```

è™½ç„¶ chenmo å’Œ wanger çš„å€¼éƒ½æ˜¯ 10ï¼Œä½†ä»–ä»¬å¹¶ä¸ç›¸ç­‰ã€‚æ¢å¥è¯è¯´å°±æ˜¯ï¼šå°†â€œ==â€æ“ä½œç¬¦åº”ç”¨äºåŒ…è£…ç±»å‹æ¯”è¾ƒçš„æ—¶å€™ï¼Œå…¶ç»“æœå¾ˆå¯èƒ½ä¼šå’Œé¢„æœŸçš„ä¸ç¬¦ã€‚

â€œä¸‰å¦¹ï¼Œç§ï¼Œ`((Integer)obj).intValue()` è¿™æ®µä»£ç å°±æ˜¯ç”¨æ¥è‡ªåŠ¨æ‹†ç®±çš„ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†åœ°è¯´ä¸€è¯´è‡ªåŠ¨è£…ç®±å’Œè‡ªåŠ¨æ‹†ç®±ã€‚â€

æ—¢ç„¶æœ‰åŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»å‹ï¼Œè‚¯å®šæœ‰äº›æ—¶å€™è¦åœ¨å®ƒä»¬ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚æŠŠåŸºæœ¬ç±»å‹è½¬æ¢æˆåŒ…è£…ç±»å‹çš„è¿‡ç¨‹å«åšè£…ç®±ï¼ˆboxingï¼‰ã€‚åä¹‹ï¼ŒæŠŠåŒ…è£…ç±»å‹è½¬æ¢æˆåŸºæœ¬ç±»å‹çš„è¿‡ç¨‹å«åšæ‹†ç®±ï¼ˆunboxingï¼‰ã€‚

åœ¨ Java 1.5 ä¹‹å‰ï¼Œå¼€å‘äººå‘˜è¦æ‰‹åŠ¨è¿›è¡Œè£…æ‹†ç®±ï¼Œæ¯”å¦‚è¯´ï¼š

```java
Integer chenmo = new Integer(10); // æ‰‹åŠ¨è£…ç®±
int wanger = chenmo.intValue();  // æ‰‹åŠ¨æ‹†ç®±
```

Java 1.5 ä¸ºäº†å‡å°‘å¼€å‘äººå‘˜çš„å·¥ä½œï¼Œæä¾›äº†è‡ªåŠ¨è£…ç®±ä¸è‡ªåŠ¨æ‹†ç®±çš„åŠŸèƒ½ã€‚è¿™ä¸‹å°±æ–¹ä¾¿äº†ã€‚

```jav
Integer chenmo  = 10;  // è‡ªåŠ¨è£…ç®±
int wanger = chenmo;     // è‡ªåŠ¨æ‹†ç®±
```

æ¥çœ‹ä¸€ä¸‹åç¼–è¯‘åçš„ä»£ç ã€‚

```java
Integer chenmo = Integer.valueOf(10);
int wanger = chenmo.intValue();
```

ä¹Ÿå°±æ˜¯è¯´ï¼Œè‡ªåŠ¨è£…ç®±æ˜¯é€šè¿‡ `Integer.valueOf()` å®Œæˆçš„ï¼›è‡ªåŠ¨æ‹†ç®±æ˜¯é€šè¿‡ `Integer.intValue()` å®Œæˆçš„ã€‚

â€œå—¯ï¼Œä¸‰å¦¹ï¼Œç»™ä½ å‡ºä¸€é“é¢è¯•é¢˜å§ã€‚â€

```java
// 1ï¼‰åŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»å‹
int a = 100;
Integer b = 100;
System.out.println(a == b);

// 2ï¼‰ä¸¤ä¸ªåŒ…è£…ç±»å‹
Integer c = 100;
Integer d = 100;
System.out.println(c == d);

// 3ï¼‰
c = 200;
d = 200;
System.out.println(c == d);
```

â€œç»™ä½  3 åˆ†é’Ÿæ—¶é—´ï¼Œä½ å…ˆæ€è€ƒä¸‹ï¼Œæˆ‘å»æŠ½æ ¹åå­ï¼Œç­‰æˆ‘å›æ¥ï¼Œç„¶åå†æ¥åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆã€‚â€

ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚

â€œå—¯ï¼Œå“¥ï¼Œä½ è¿‡æ¥å§ï¼Œæˆ‘è¯´ä¸€è¯´æˆ‘çš„æƒ³æ³•ã€‚â€

ç¬¬ä¸€æ®µä»£ç ï¼ŒåŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»å‹è¿›è¡Œ == æ¯”è¾ƒï¼Œè¿™æ—¶å€™ b ä¼šè‡ªåŠ¨æ‹†ç®±ï¼Œç›´æ¥å’Œ a æ¯”è¾ƒå€¼ï¼Œæ‰€ä»¥ç»“æœä¸º trueã€‚

ç¬¬äºŒæ®µä»£ç ï¼Œä¸¤ä¸ªåŒ…è£…ç±»å‹éƒ½è¢«èµ‹å€¼ä¸ºäº† 100ï¼Œè¿™æ—¶å€™ä¼šè¿›è¡Œè‡ªåŠ¨è£…ç®±ï¼ŒæŒ‰ç…§ä½ ä¹‹å‰è¯´çš„ï¼Œå°†â€œ==â€æ“ä½œç¬¦åº”ç”¨äºåŒ…è£…ç±»å‹æ¯”è¾ƒçš„æ—¶å€™ï¼Œå…¶ç»“æœå¾ˆå¯èƒ½ä¼šå’Œé¢„æœŸçš„ä¸ç¬¦ï¼Œæˆ‘æƒ³ç»“æœå¯èƒ½ä¸º falseã€‚

ç¬¬ä¸‰æ®µä»£ç ï¼Œä¸¤ä¸ªåŒ…è£…ç±»å‹é‡æ–°è¢«èµ‹å€¼ä¸ºäº† 200ï¼Œè¿™æ—¶å€™ä»ç„¶ä¼šè¿›è¡Œè‡ªåŠ¨è£…ç®±ï¼Œæˆ‘æƒ³ç»“æœä»ç„¶ä¸º falseã€‚

â€œå—¯å—¯ï¼Œä¸‰å¦¹ï¼Œä½ åˆ†æçš„å¾ˆæœ‰é€»è¾‘ï¼Œä½†ç¬¬äºŒæ®µä»£ç çš„ç»“æœä¸º trueï¼Œæ˜¯ä¸æ˜¯æ„Ÿåˆ°å¾ˆå¥‡æ€ªï¼Ÿâ€

â€œä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘€ï¼Ÿâ€ä¸‰å¦¹æ€¥åˆ‡åœ°é—®ã€‚

â€œä½ è¯´çš„æ²¡é”™ï¼Œè‡ªåŠ¨è£…ç®±æ˜¯é€šè¿‡ `Integer.valueOf()` å®Œæˆçš„ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•çš„æºç å°±æ˜ç™½ä¸ºä»€ä¹ˆäº†ã€‚â€

```java
public static Integer valueOf(int i) {
    if (i >= IntegerCache.low && i <= IntegerCache.high)
        return IntegerCache.cache[i + (-IntegerCache.low)];
    return new Integer(i);
}
```

æ˜¯ä¸æ˜¯çœ‹åˆ°äº†ä¸€ä¸ªä¹‹å‰ä»æ¥æ²¡è§è¿‡çš„ç±»â€”â€”[IntegerCache](https://tobebetterjavaer.com/basic-extra-meal/int-cache.html)ï¼Ÿ

â€œéš¾é“è¯´æ˜¯ Integer çš„ç¼“å­˜ç±»ï¼Ÿâ€ä¸‰å¦¹åšå‡ºäº†è‡ªå·±çš„åˆ¤æ–­ã€‚

â€œæ˜¯çš„ï¼Œæ¥çœ‹ä¸€ä¸‹ IntegerCache çš„æºç å§ã€‚â€

```java
private static class IntegerCache {
    static final int low = -128;
    static final int high;
    static final Integer cache[];

    static {
        // high value may be configured by property
        int h = 127;
        int i = parseInt(integerCacheHighPropValue);
        i = Math.max(i, 127);
        h = Math.min(i, Integer.MAX_VALUE - (-low) -1);
        high = h;

        cache = new Integer[(high - low) + 1];
        int j = low;
        for(int k = 0; k < cache.length; k++)
            cache[k] = new Integer(j++);

        // range [-128, 127] must be interned (JLS7 5.1.7)
        assert IntegerCache.high >= 127;
    }
}
```

å¤§è‡´çŸä¸€ä¸‹è¿™æ®µä»£ç ä½ å°±å…¨æ˜ç™½äº†ã€‚-128 åˆ° 127 ä¹‹é—´çš„æ•°ä¼šä» IntegerCache ä¸­å–ï¼Œç„¶åæ¯”è¾ƒï¼Œæ‰€ä»¥ç¬¬äºŒæ®µä»£ç ï¼ˆ100 åœ¨è¿™ä¸ªèŒƒå›´ä¹‹å†…ï¼‰çš„ç»“æœæ˜¯ trueï¼Œè€Œç¬¬ä¸‰æ®µä»£ç ï¼ˆ200 ä¸åœ¨è¿™ä¸ªèŒƒå›´ä¹‹å†…ï¼Œæ‰€ä»¥ new å‡ºæ¥äº†ä¸¤ä¸ª Integer å¯¹è±¡ï¼‰çš„ç»“æœæ˜¯ falseã€‚

â€œä¸‰å¦¹ï¼Œçœ‹å®Œä¸Šé¢çš„åˆ†æä¹‹åï¼Œæˆ‘å¸Œæœ›ä½ è®°ä½ä¸€ç‚¹ï¼š**å½“éœ€è¦è¿›è¡Œè‡ªåŠ¨è£…ç®±æ—¶ï¼Œå¦‚æœæ•°å­—åœ¨ -128 è‡³ 127 ä¹‹é—´æ—¶ï¼Œä¼šç›´æ¥ä½¿ç”¨ç¼“å­˜ä¸­çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯é‡æ–°åˆ›å»ºä¸€ä¸ªå¯¹è±¡**ã€‚â€

â€œè‡ªåŠ¨è£…æ‹†ç®±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åŠŸèƒ½ï¼Œå¤§å¤§èŠ‚çœäº†æˆ‘ä»¬å¼€å‘äººå‘˜çš„ç²¾åŠ›ï¼Œä½†ä¹Ÿä¼šå¼•å‘ä¸€äº›éº»çƒ¦ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼Œæ€§èƒ½å°±å¾ˆå·®ã€‚â€

```java
long t1 = System.currentTimeMillis();
Long sum = 0L;
for (int i = 0; i < Integer.MAX_VALUE;i++) {
    sum += i;
}
long t2 = System.currentTimeMillis();        
System.out.println(t2-t1);
```

â€œçŸ¥é“ä¸ºä»€ä¹ˆå—ï¼Ÿä¸‰å¦¹ã€‚â€

â€œéš¾é“æ˜¯å› ä¸º sum è¢«å£°æ˜æˆäº†åŒ…è£…ç±»å‹ Long è€Œä¸æ˜¯åŸºæœ¬ç±»å‹ longã€‚â€ä¸‰å¦¹è‹¥æœ‰æ‰€æ€ã€‚

â€œæ˜¯æ»´ï¼Œç”±äº sum æ˜¯ä¸ª Long å‹ï¼Œè€Œ i ä¸º int ç±»å‹ï¼Œ`sum += i` åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šå…ˆæŠŠ i å¼ºè½¬ä¸º long å‹ï¼Œç„¶åå†æŠŠ sum æ‹†ç®±ä¸º long å‹è¿›è¡Œç›¸åŠ æ“ä½œï¼Œä¹‹åå†è‡ªåŠ¨è£…ç®±ä¸º Long å‹èµ‹å€¼ç»™ sumã€‚â€

â€œä¸‰å¦¹ï¼Œä½ å¯ä»¥è¯•ä¸€ä¸‹ï¼ŒæŠŠ sum æ¢æˆ long å‹æ¯”è¾ƒä¸€ä¸‹å®ƒä»¬è¿è¡Œçš„æ—¶é—´ã€‚â€

ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚

â€œå“‡ï¼Œsum ä¸º Long å‹çš„æ—¶å€™ï¼Œè¶³è¶³è¿è¡Œäº† 5825 æ¯«ç§’ï¼›sum ä¸º long å‹çš„æ—¶å€™ï¼Œåªéœ€è¦ 679 æ¯«ç§’ã€‚â€

â€œå¥½äº†ï¼Œä¸‰å¦¹ï¼Œä»Šå¤©çš„ä¸»é¢˜å°±å…ˆè®²åˆ°è¿™å§ã€‚æˆ‘å†å»æ¥æ ¹åå­ã€‚â€

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 13.4 æ·±å…¥ç†è§£Javaæµ…æ‹·è´ä¸æ·±æ‹·è´

â€œå“¥ï¼Œå¬è¯´æµ…æ‹·è´å’Œæ·±æ‹·è´æ˜¯ Java é¢è¯•ä¸­ç»å¸¸ä¼šè¢«é—®åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼Œæ˜¯è¿™æ ·å—ï¼Ÿâ€

â€œè¿˜çœŸçš„æ˜¯ï¼Œè€Œä¸”äº†è§£æµ…æ‹·è´å’Œæ·±æ‹·è´çš„åŸç†ï¼Œå¯¹ [Java æ˜¯å€¼ä¼ é€’è¿˜æ˜¯å¼•ç”¨ä¼ é€’](https://tobebetterjavaer.com/basic-extra-meal/pass-by-value.html)ä¹Ÿä¼šæœ‰æ›´æ·±çš„ç†è§£ã€‚â€æˆ‘è‚¯å®šåœ°å›ç­”ã€‚

â€œä¸ç®¡æ˜¯æµ…æ‹·è´è¿˜æ˜¯æ·±æ‹·è´ï¼Œéƒ½å¯ä»¥é€šè¿‡è°ƒç”¨ Object ç±»çš„ `clone()` æ–¹æ³•æ¥å®Œæˆã€‚â€æˆ‘ä¸€è¾¹è¯´ï¼Œä¸€è¾¹æ‰“å¼€ Intellij IDEAï¼Œå¹¶æ‰¾åˆ°äº† `clone()` æ–¹æ³•çš„æºç ã€‚

```java
protected native Object clone() throws CloneNotSupportedException;
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`clone()` æ–¹æ³•åŒæ—¶æ˜¯ä¸€ä¸ªæœ¬åœ°ï¼ˆ`native`ï¼‰æ–¹æ³•ï¼Œå®ƒçš„å…·ä½“å®ç°ä¼šäº¤ç»™ HotSpot è™šæ‹Ÿæœºï¼Œé‚£å°±æ„å‘³ç€è™šæ‹Ÿæœºåœ¨è¿è¡Œè¯¥æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šå°†å…¶æ›¿æ¢ä¸ºæ›´é«˜æ•ˆçš„ C/C++ ä»£ç ï¼Œè¿›è€Œè°ƒç”¨æ“ä½œç³»ç»Ÿå»å®Œæˆå¯¹è±¡çš„å…‹éš†å·¥ä½œã€‚

>Java 9 åï¼Œè¯¥æ–¹æ³•ä¼šè¢«æ ‡æ³¨ `@HotSpotIntrinsicCandidate` æ³¨è§£ï¼Œè¢«è¯¥æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•ï¼Œåœ¨ HotSpot è™šæ‹Ÿæœºä¸­ä¼šæœ‰ä¸€å¥—é«˜æ•ˆçš„å®ç°ã€‚

â€œå“¥ï¼Œé‚£ä½ å°±å…ˆè¯´æµ…æ‹·è´å§ï¼â€

â€œå¥½çš„å‘€ã€‚ç›´æ¥ä¸Šå®æˆ˜ä»£ç ã€‚â€

```java
class Writer implements Cloneable{
    private int age;
    private String name;

    // getter/setter å’Œæ„é€ æ–¹æ³•éƒ½å·²çœç•¥

    @Override
    public String toString() {
        return super.toString().substring(26) + "{" +
                "age=" + age +
                ", name='" + name + '\'' +
                '}';
    }
}
```

Writer ç±»æœ‰ä¸¤ä¸ªå­—æ®µï¼Œåˆ†åˆ«æ˜¯ int ç±»å‹çš„ ageï¼Œå’Œ String ç±»å‹çš„ nameã€‚ç„¶åé‡å†™äº† `toString()` æ–¹æ³•ï¼Œæ–¹ä¾¿æ‰“å°å¯¹è±¡çš„å…·ä½“ä¿¡æ¯ã€‚

â€œä¸ºä»€ä¹ˆè¦å®ç° Cloneable æ¥å£å‘¢ï¼Ÿâ€ä¸‰å¦¹å¼€å¯äº†åä¸‡ä¸ªä¸ºä»€ä¹ˆçš„æ¨¡å¼ã€‚

Cloneable æ¥å£æ˜¯ä¸€ä¸ªæ ‡è®°æ¥å£ï¼Œå®ƒè‚šå­é‡Œé¢æ˜¯ç©ºçš„ï¼š

```java
public interface Cloneable {
}
```

åªæ˜¯ï¼Œå¦‚æœä¸€ä¸ªç±»æ²¡æœ‰å®ç° Cloneable æ¥å£ï¼Œå³ä¾¿å®ƒé‡å†™äº† `clone()` æ–¹æ³•ï¼Œä¾ç„¶æ˜¯æ— æ³•è°ƒç”¨è¯¥æ–¹æ³•è¿›è¡Œå¯¹è±¡å…‹éš†çš„ï¼Œç¨‹åºåœ¨æ‰§è¡Œ `clone()` æ–¹æ³•çš„æ—¶å€™ä¼šæŠ›å‡º CloneNotSupportedException å¼‚å¸¸ã€‚

```java
Exception in thread "main" java.lang.CloneNotSupportedException
```

æ ‡è®°æ¥å£çš„ä½œç”¨å…¶å®å¾ˆç®€å•ï¼Œç”¨æ¥è¡¨ç¤ºæŸä¸ªåŠŸèƒ½åœ¨æ‰§è¡Œçš„æ—¶å€™æ˜¯åˆæ³•çš„ã€‚

â€œå“¦ï¼Œæˆ‘æ‚Ÿäº†ï¼â€ä¸‰å¦¹çœ‹æ¥æ˜¯å½»åº•æ˜ç™½äº†æˆ‘è¯´çš„å†…å®¹ã€‚

â€œæ¥ç€ï¼Œæ¥æµ‹è¯•ç±»ã€‚â€

```java
class TestClone {
    public static void main(String[] args) throws CloneNotSupportedException {
        Writer writer1 = new Writer(18,"äºŒå“¥");
        Writer writer2 = (Writer) writer1.clone();

        System.out.println("æµ…æ‹·è´åï¼š");
        System.out.println("writer1ï¼š" + writer1);
        System.out.println("writer2ï¼š" + writer2);

        writer2.setName("ä¸‰å¦¹");

        System.out.println("è°ƒæ•´äº† writer2 çš„ name åï¼š");
        System.out.println("writer1ï¼š" + writer1);
        System.out.println("writer2ï¼š" + writer2);
    }
}
```

- é€šè¿‡ new å…³é”®å­—å£°æ˜äº†ä¸€ä¸ª Writer å¯¹è±¡ï¼ˆ18 å²çš„äºŒå“¥ï¼‰ï¼Œå°†å…¶èµ‹å€¼ç»™ writer1ã€‚
- é€šè¿‡è°ƒç”¨ `clone()` æ–¹æ³•è¿›è¡Œå¯¹è±¡æ‹·è´ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™ writer2ã€‚
- ä¹‹åæ‰“å° writer1 å’Œ writer2ã€‚
- å°† writer2 çš„ name å­—æ®µè°ƒæ•´ä¸ºâ€œä¸‰å¦¹â€ã€‚
- å†æ¬¡æ‰“å°ã€‚

æ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœã€‚

```
æµ…æ‹·è´åï¼š
writer1ï¼šWriter@68837a77{age=18, name='äºŒå“¥'}
writer2ï¼šWriter@b97c004{age=18, name='äºŒå“¥'}
è°ƒæ•´äº† writer2 çš„ name åï¼š
writer1ï¼šWriter@68837a77{age=18, name='äºŒå“¥'}
writer2ï¼šWriter@b97c004{age=18, name='ä¸‰å¦¹'}
```

å¯ä»¥çœ‹å¾—å‡ºï¼Œæµ…æ‹·è´åï¼Œwriter1 å’Œ writer2 å¼•ç”¨äº†ä¸åŒçš„å¯¹è±¡ï¼Œä½†å€¼æ˜¯ç›¸åŒçš„ï¼Œè¯´æ˜æ‹·è´æˆåŠŸã€‚ä¹‹åï¼Œä¿®æ”¹äº† writer2 çš„ name å­—æ®µï¼Œç›´æ¥ä¸Šå›¾å°±æ˜ç™½äº†ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-points/deep-copy-01.png)

 ä¹‹å‰çš„ä¾‹å­ä¸­ï¼ŒWriter ç±»åªæœ‰ä¸¤ä¸ªå­—æ®µï¼Œæ²¡æœ‰å¼•ç”¨ç±»å‹å­—æ®µã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å†æ¥çœ‹å¦å¤–ä¸€ä¸ªä¾‹å­ï¼Œä¸º Writer ç±»å¢åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„å¼•ç”¨ç±»å‹å­—æ®µ Bookï¼Œå…ˆæ¥çœ‹ Book çš„å®šä¹‰ã€‚

```java
class Book {
    private String bookName;
    private int price;

    // getter/setter å’Œæ„é€ æ–¹æ³•éƒ½å·²çœç•¥

    @Override
    public String toString() {
        return super.toString().substring(26) +
                " bookName='" + bookName + '\'' +
                ", price=" + price +
                '}';
    }
}
```

æœ‰ä¸¤ä¸ªå­—æ®µï¼Œåˆ†åˆ«æ˜¯ String ç±»å‹çš„ bookName å’Œ int ç±»å‹çš„ priceã€‚

ç„¶åæ¥çœ‹ Writer ç±»çš„å®šä¹‰ã€‚

```java
class Writer implements Cloneable{
    private int age;
    private String name;
    private Book book;

    // getter/setter å’Œæ„é€ æ–¹æ³•éƒ½å·²çœç•¥

    @Override
    public String toString() {
        return super.toString().substring(26) +
                " age=" + age +
                ", name='" + name + '\'' +
                ", book=" + book +
                '}';
    }

    @Override
    protected Object clone() throws CloneNotSupportedException {
        return super.clone();
    }
}
```

æ¯”ä¹‹å‰çš„ä¾‹å­å¤šäº†ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹çš„å­—æ®µ bookï¼Œ`clone()` æ–¹æ³•å¹¶æ²¡æœ‰ä»»ä½•æ”¹å˜ã€‚

å†æ¥çœ‹æµ‹è¯•ç±»ã€‚

```java
class TestClone {
    public static void main(String[] args) throws CloneNotSupportedException {
        Writer writer1 = new Writer(18,"äºŒå“¥");
        Book book1 = new Book("ç¼–è¯‘åŸç†",100);
        writer1.setBook(book1);

        Writer writer2 = (Writer) writer1.clone();
        System.out.println("æµ…æ‹·è´åï¼š");

        System.out.println("writer1ï¼š" + writer1);
        System.out.println("writer2ï¼š" + writer2);

        Book book2 = writer2.getBook();
        book2.setBookName("æ°¸æ’çš„å›¾çµ");
        book2.setPrice(70);
        System.out.println("writer2.book å˜æ›´åï¼š");

        System.out.println("writer1ï¼š" + writer1);
        System.out.println("writer2ï¼š" + writer2);
    }
}
```

- é€šè¿‡ new å…³é”®å­—å£°æ˜äº†ä¸€ä¸ª Writer å¯¹è±¡ï¼ˆ18 å²çš„äºŒå“¥ï¼‰ï¼Œå°†å…¶èµ‹å€¼ç»™ writer1ã€‚
- é€šè¿‡ new å…³é”®å­—å£°æ˜äº†ä¸€ä¸ª Book å¯¹è±¡ï¼ˆ100 å—çš„ç¼–è¯‘åŸç†ï¼‰ï¼Œå°†å…¶èµ‹å€¼ç»™ book1ã€‚
- å°† writer1 çš„ book å­—æ®µè®¾ç½®ä¸º book1ã€‚
- é€šè¿‡è°ƒç”¨ `clone()` æ–¹æ³•è¿›è¡Œå¯¹è±¡æ‹·è´ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™ writer2ã€‚
- ä¹‹åæ‰“å° writer1 å’Œ writer2ã€‚
- è·å– writer2 çš„ book å­—æ®µï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™ book2ã€‚
- å°† book2 çš„ bookName å­—æ®µè°ƒæ•´ä¸ºâ€œæ°¸æ’çš„å›¾çµâ€ï¼Œprice å­—æ®µè°ƒæ•´ä¸º 70ã€‚
- å†æ¬¡æ‰“å°ã€‚

æ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœã€‚

```
æµ…æ‹·è´åï¼š
writer1ï¼šWriter@68837a77 age=18, name='äºŒå“¥', book=Book@32e6e9c3 bookName='ç¼–è¯‘åŸç†', price=100}}
writer2ï¼šWriter@6d00a15d age=18, name='äºŒå“¥', book=Book@32e6e9c3 bookName='ç¼–è¯‘åŸç†', price=100}}
writer2.book å˜æ›´åï¼š
writer1ï¼šWriter@68837a77 age=18, name='äºŒå“¥', book=Book@32e6e9c3 bookName='æ°¸æ’çš„å›¾çµ', price=70}}
writer2ï¼šWriter@36d4b5c age=18, name='äºŒå“¥', book=Book@32e6e9c3 bookName='æ°¸æ’çš„å›¾çµ', price=70}}
```

ä¸ä¹‹å‰ä¾‹å­ä¸åŒçš„æ˜¯ï¼Œwriter2.book å˜æ›´åï¼Œwriter1.book ä¹Ÿå‘ç”Ÿäº†æ”¹å˜ã€‚è¿™æ˜¯å› ä¸ºå­—ç¬¦ä¸² String æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œä¸€ä¸ªæ–°çš„å€¼å¿…é¡»åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å¼€è¾Ÿä¸€æ®µæ–°çš„å†…å­˜ç©ºé—´ï¼Œè€Œè‡ªå®šä¹‰å¯¹è±¡çš„å†…å­˜åœ°å€å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œåªæ˜¯å¯¹åº”çš„å­—æ®µå€¼å‘ç”Ÿäº†æ”¹å˜ï¼Œè§ä¸‹å›¾ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-points/deep-copy-02.png)

â€œå“‡ï¼Œå“¥ï¼ŒæœçœŸä¸€å›¾èƒœåƒè¨€ï¼Œæˆ‘æ˜ç™½äº†ã€‚â€ä¸‰å¦¹ä¼¼ä¹å¯¹æˆ‘ç”»çš„å›¾å¾ˆæ„Ÿå…´è¶£å‘¢ï¼Œâ€œé‚£ä½ ç»§ç»­è¯´æ·±æ‹·è´å§ï¼â€

â€œå—¯ï¼Œä¸‰å¦¹ï¼Œä½ æœ‰æ²¡æœ‰æ³¨æ„åˆ°ï¼Œæµ…æ‹·è´å…‹éš†çš„å¯¹è±¡ä¸­ï¼Œå¼•ç”¨ç±»å‹çš„å­—æ®µæŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªï¼Œå½“æ”¹å˜ä»»ä½•ä¸€ä¸ªå¯¹è±¡ï¼Œå¦å¤–ä¸€ä¸ªå¯¹è±¡ä¹Ÿä¼šéšä¹‹æ”¹å˜ï¼Œé™¤å»å­—ç¬¦ä¸²çš„ç‰¹æ®Šæ€§å¤–ã€‚â€

â€œæ·±æ‹·è´å’Œæµ…æ‹·è´ä¸åŒçš„ï¼Œæ·±æ‹·è´ä¸­çš„å¼•ç”¨ç±»å‹å­—æ®µä¹Ÿä¼šå…‹éš†ä¸€ä»½ï¼Œå½“æ”¹å˜ä»»ä½•ä¸€ä¸ªå¯¹è±¡ï¼Œå¦å¤–ä¸€ä¸ªå¯¹è±¡ä¸ä¼šéšä¹‹æ”¹å˜ã€‚â€

â€œæ˜ç™½äº†è¿™ä¸€ç‚¹åï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¾‹å­ã€‚â€

```java
class Book implements Cloneable{
    private String bookName;
    private int price;

    // getter/setter å’Œæ„é€ æ–¹æ³•éƒ½å·²çœç•¥

    @Override
    public String toString() {
        return super.toString().substring(26) +
                " bookName='" + bookName + '\'' +
                ", price=" + price +
                '}';
    }

    @Override
    protected Object clone() throws CloneNotSupportedException {
        return super.clone();
    }
}
```

æ³¨æ„ï¼Œæ­¤æ—¶çš„ Book ç±»å’Œæµ…æ‹·è´æ—¶ä¸åŒï¼Œé‡å†™äº† `clone()` æ–¹æ³•ï¼Œå¹¶å®ç°äº† Cloneable æ¥å£ã€‚ä¸ºçš„å°±æ˜¯æ·±æ‹·è´çš„æ—¶å€™ä¹Ÿèƒ½å¤Ÿå…‹éš†è¯¥å­—æ®µã€‚

```java
class Writer implements Cloneable{
    private int age;
    private String name;
    private Book book;

    // getter/setter å’Œæ„é€ æ–¹æ³•éƒ½å·²çœç•¥

    @Override
    public String toString() {
        return super.toString().substring(26) +
                " age=" + age +
                ", name='" + name + '\'' +
                ", book=" + book +
                '}';
    }

    @Override
    protected Object clone() throws CloneNotSupportedException {
        Writer writer = (Writer) super.clone();
        writer.setBook((Book) writer.getBook().clone());
        return writer;
    }
}
```

æ³¨æ„ï¼Œæ­¤æ—¶ Writer ç±»ä¹Ÿä¸ä¹‹å‰çš„ä¸åŒï¼Œ`clone()` æ–¹æ³•å½“ä¸­ï¼Œä¸å†åªè°ƒç”¨ Object çš„ `clone()` æ–¹æ³•å¯¹ Writer è¿›è¡Œå…‹éš†äº†ï¼Œè¿˜å¯¹ Book ä¹Ÿè¿›è¡Œäº†å…‹éš†ã€‚

æ¥çœ‹æµ‹è¯•ç±»ã€‚

```java
class TestClone {
    public static void main(String[] args) throws CloneNotSupportedException {
        Writer writer1 = new Writer(18,"äºŒå“¥");
        Book book1 = new Book("ç¼–è¯‘åŸç†",100);
        writer1.setBook(book1);

        Writer writer2 = (Writer) writer1.clone();
        System.out.println("æ·±æ‹·è´åï¼š");

        System.out.println("writer1ï¼š" + writer1);
        System.out.println("writer2ï¼š" + writer2);

        Book book2 = writer2.getBook();
        book2.setBookName("æ°¸æ’çš„å›¾çµ");
        book2.setPrice(70);
        System.out.println("writer2.book å˜æ›´åï¼š");

        System.out.println("writer1ï¼š" + writer1);
        System.out.println("writer2ï¼š" + writer2);
    }
}
```

è¿™ä¸ªæµ‹è¯•ç±»å’Œä¹‹å‰çš„æµ…æ‹·è´çš„æµ‹è¯•ç±»å°±å®Œå…¨ä¸€æ ·äº†ï¼Œä½†è¿è¡Œç»“æœæ˜¯ä¸åŒçš„ã€‚

```
æ·±æ‹·è´åï¼š
writer1ï¼šWriter@6be46e8f age=18, name='äºŒå“¥', book=Book@5056dfcb bookName='ç¼–è¯‘åŸç†', price=100}}
writer2ï¼šWriter@6d00a15d age=18, name='äºŒå“¥', book=Book@51efea79 bookName='ç¼–è¯‘åŸç†', price=100}}
writer2.book å˜æ›´åï¼š
writer1ï¼šWriter@6be46e8f age=18, name='äºŒå“¥', book=Book@5056dfcb bookName='ç¼–è¯‘åŸç†', price=100}}
writer2ï¼šWriter@6d00a15d age=18, name='äºŒå“¥', book=Book@51efea79 bookName='æ°¸æ’çš„å›¾çµ', price=70}}
```

ä¸åªæ˜¯ writer1 å’Œ writer2 æ˜¯ä¸åŒçš„å¯¹è±¡ï¼Œå®ƒä»¬ä¸­çš„ book ä¹Ÿæ˜¯ä¸åŒçš„å¯¹è±¡ã€‚æ‰€ä»¥ï¼Œæ”¹å˜äº† writer2 ä¸­çš„ book å¹¶ä¸ä¼šå½±å“åˆ° writer1ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-points/deep-copy-03.png)

ä¸è¿‡ï¼Œé€šè¿‡ `clone()` æ–¹æ³•å®ç°çš„æ·±æ‹·è´æ¯”è¾ƒç¬¨é‡ï¼Œå› ä¸ºè¦å°†æ‰€æœ‰çš„å¼•ç”¨ç±»å‹éƒ½é‡å†™ `clone()` æ–¹æ³•ï¼Œå½“åµŒå¥—çš„å¯¹è±¡æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œå°±åºŸäº†ï¼

â€œé‚£æœ‰æ²¡æœ‰å¥½çš„åŠæ³•å‘¢ï¼Ÿâ€ä¸‰å¦¹æ€¥åˆ‡çš„é—®ã€‚

â€œå½“ç„¶æœ‰äº†ï¼Œåˆ©ç”¨[åºåˆ—åŒ–](https://tobebetterjavaer.com/io/serialize.html)ã€‚â€æˆ‘èƒ¸æœ‰æˆç«¹çš„å›ç­”ï¼Œâ€œåºåˆ—åŒ–æ˜¯å°†å¯¹è±¡å†™åˆ°æµä¸­ä¾¿äºä¼ è¾“ï¼Œè€Œååºåˆ—åŒ–åˆ™æ˜¯å°†å¯¹è±¡ä»æµä¸­è¯»å–å‡ºæ¥ã€‚â€

â€œå†™å…¥æµä¸­çš„å¯¹è±¡å°±æ˜¯å¯¹åŸå§‹å¯¹è±¡çš„æ‹·è´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸ªè¦åºåˆ—åŒ–çš„ç±»éƒ½è¦å®ç° [Serializable æ¥å£](https://tobebetterjavaer.com/io/Serializbale.html)ï¼Œè¯¥æ¥å£å’Œ Cloneable æ¥å£ç±»ä¼¼ï¼Œéƒ½æ˜¯æ ‡è®°å‹æ¥å£ã€‚â€

æ¥çœ‹ä¾‹å­ã€‚

```java
class Book implements Serializable {
    private String bookName;
    private int price;

    // getter/setter å’Œæ„é€ æ–¹æ³•éƒ½å·²çœç•¥

    @Override
    public String toString() {
        return super.toString().substring(26) +
                " bookName='" + bookName + '\'' +
                ", price=" + price +
                '}';
    }
}
```

Book éœ€è¦å®ç° Serializable æ¥å£ã€‚

```java
class Writer implements Serializable {
    private int age;
    private String name;
    private Book book;

    // getter/setter å’Œæ„é€ æ–¹æ³•éƒ½å·²çœç•¥

    @Override
    public String toString() {
        return super.toString().substring(26) +
                " age=" + age +
                ", name='" + name + '\'' +
                ", book=" + book +
                '}';
    }

    //æ·±åº¦æ‹·è´
    public Object deepClone() throws IOException, ClassNotFoundException {
        // åºåˆ—åŒ–
        ByteArrayOutputStream bos = new ByteArrayOutputStream();
        ObjectOutputStream oos = new ObjectOutputStream(bos);

        oos.writeObject(this);

        // ååºåˆ—åŒ–
        ByteArrayInputStream bis = new ByteArrayInputStream(bos.toByteArray());
        ObjectInputStream ois = new ObjectInputStream(bis);

        return ois.readObject();
    }
}
```

Writer ç±»ä¹Ÿéœ€è¦å®ç° Serializable æ¥å£ï¼Œå¹¶ä¸”åœ¨è¯¥ç±»ä¸­ï¼Œå¢åŠ äº†ä¸€ä¸ª `deepClone()` çš„æ–¹æ³•ï¼Œåˆ©ç”¨ OutputStream è¿›è¡Œåºåˆ—åŒ–ï¼ŒInputStream è¿›è¡Œååºåˆ—åŒ–ï¼Œè¿™æ ·å°±å®ç°äº†æ·±æ‹·è´ã€‚

æ¥çœ‹ç¤ºä¾‹ã€‚

```java
class TestClone {
    public static void main(String[] args) throws IOException, ClassNotFoundException {
        Writer writer1 = new Writer(18,"äºŒå“¥");
        Book book1 = new Book("ç¼–è¯‘åŸç†",100);
        writer1.setBook(book1);

        Writer writer2 = (Writer) writer1.deepClone();
        System.out.println("æ·±æ‹·è´åï¼š");

        System.out.println("writer1ï¼š" + writer1);
        System.out.println("writer2ï¼š" + writer2);

        Book book2 = writer2.getBook();
        book2.setBookName("æ°¸æ’çš„å›¾çµ");
        book2.setPrice(70);
        System.out.println("writer2.book å˜æ›´åï¼š");

        System.out.println("writer1ï¼š" + writer1);
        System.out.println("writer2ï¼š" + writer2);
    }
}
```

ä¸ä¹‹å‰æµ‹è¯•ç±»ä¸åŒçš„æ˜¯ï¼Œè°ƒç”¨äº† `deepClone()` æ–¹æ³•ã€‚

```
æ·±æ‹·è´åï¼š
writer1ï¼šWriter@9629756 age=18, name='äºŒå“¥', book=Book@735b5592 bookName='ç¼–è¯‘åŸç†', price=100}}
writer2ï¼šWriter@544fe44c age=18, name='äºŒå“¥', book=Book@31610302 bookName='ç¼–è¯‘åŸç†', price=100}}
writer2.book å˜æ›´åï¼š
writer1ï¼šWriter@9629756 age=18, name='äºŒå“¥', book=Book@735b5592 bookName='ç¼–è¯‘åŸç†', price=100}}
writer2ï¼šWriter@544fe44c age=18, name='äºŒå“¥', book=Book@31610302 bookName='æ°¸æ’çš„å›¾çµ', price=70}}
```

æµ‹è¯•ç»“æœå’Œä¹‹å‰ç”¨ `clone()` æ–¹æ³•å®ç°çš„æ·±æ‹·è´ç±»ä¼¼ã€‚

â€œä¸è¿‡ï¼Œä¸‰å¦¹ï¼Œéœ€è¦æ³¨æ„ï¼Œç”±äºæ˜¯åºåˆ—åŒ–æ¶‰åŠåˆ°è¾“å…¥æµå’Œè¾“å‡ºæµçš„è¯»å†™ï¼Œåœ¨æ€§èƒ½ä¸Šè¦æ¯” HotSpot è™šæ‹Ÿæœºå®ç°çš„ `clone()` æ–¹æ³•å·®å¾ˆå¤šã€‚â€æˆ‘è¯­é‡å¿ƒé•¿åœ°è¯´ã€‚

â€œå¥½çš„ï¼ŒäºŒå“¥ï¼Œä½ å…ˆå»ä¼‘æ¯å§ï¼Œè®©æˆ‘æ¥ç¢ç£¨ä¸€ä¼šï¼Œæ€»ç»“ä¸€ä¸‹æµ…æ‹·è´å’Œæ·±æ‹·è´ä¹‹é—´çš„å·®å¼‚ã€‚â€

â€œå—¯å—¯ã€‚â€


----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 13.5 Java hashCodeæ–¹æ³•è§£æ

ä»Šå¤©æˆ‘ä»¬æ¥è°ˆè°ˆ Java ä¸­çš„ `hashCode()` æ–¹æ³•ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒJava æ˜¯ä¸€é—¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ï¼Œæ‰€æœ‰çš„ç±»éƒ½ä¼šé»˜è®¤ç»§æ‰¿è‡ª Object ç±»ï¼Œè€Œ Object çš„ä¸­æ–‡æ„æ€å°±æ˜¯â€œå¯¹è±¡â€ã€‚

Object ç±»ä¸­å°±åŒ…å«äº† `hashCode()` æ–¹æ³•ï¼š

```java
public native int hashCode();
```

æ„å‘³ç€æ‰€æœ‰çš„ç±»éƒ½ä¼šæœ‰ä¸€ä¸ª `hashCode()` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª int ç±»å‹çš„å€¼ã€‚ç”±äº `hashCode()` æ–¹æ³•æ˜¯ä¸€ä¸ª[æœ¬åœ°æ–¹æ³•](https://tobebetterjavaer.com/oo/native-method.html)ï¼ˆ`native` å…³é”®å­—ä¿®é¥°çš„æ–¹æ³•ï¼Œç”¨ `C/C++` è¯­è¨€å®ç°ï¼Œç”± Java è°ƒç”¨ï¼‰ï¼Œæ„å‘³ç€ Object ç±»ä¸­å¹¶æ²¡æœ‰ç»™å‡ºå…·ä½“çš„å®ç°ã€‚

å…·ä½“çš„å®ç°å¯ä»¥å‚è€ƒ `jdk/src/hotspot/share/runtime/synchronizer.cpp`ï¼ˆæºç å¯ä»¥åˆ° [GitHub ä¸Š OpenJDK çš„ä»“åº“ä¸­ä¸‹è½½](https://github.com/openjdk/jdk/blob/master/src/hotspot/share/runtime/synchronizer.cpp)ï¼‰ã€‚`get_next_hash()` æ–¹æ³•ä¼šæ ¹æ® hashCode çš„å–å€¼æ¥å†³å®šé‡‡ç”¨å“ªä¸€ç§å“ˆå¸Œå€¼çš„ç”Ÿæˆç­–ç•¥ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/basic-extra-meal/hashcode-1.png)

Java 9 ä¹‹åï¼Œ`hashCode()` æ–¹æ³•ä¼šè¢« `@HotSpotIntrinsicCandidate` æ³¨è§£ä¿®é¥°ï¼Œè¡¨æ˜å®ƒåœ¨ HotSpot è™šæ‹Ÿæœºä¸­æœ‰ä¸€å¥—é«˜æ•ˆçš„å®ç°ï¼ŒåŸºäº CPU æŒ‡ä»¤ã€‚

é‚£å¤§å®¶æœ‰æ²¡æœ‰æƒ³è¿‡è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼š**ä¸ºä»€ä¹ˆ Object ç±»éœ€è¦ä¸€ä¸ª `hashCode()` æ–¹æ³•å‘¢**ï¼Ÿ

åœ¨ Java ä¸­ï¼Œ`hashCode()` æ–¹æ³•çš„ä¸»è¦ä½œç”¨å°±æ˜¯ä¸ºäº†é…åˆ[å“ˆå¸Œè¡¨](https://tobebetterjavaer.com/collection/hashmap.html)ä½¿ç”¨çš„ã€‚

å“ˆå¸Œè¡¨ï¼ˆHash Tableï¼‰ï¼Œä¹Ÿå«æ•£åˆ—è¡¨ï¼Œæ˜¯ä¸€ç§å¯ä»¥é€šè¿‡å…³é”®ç å€¼ï¼ˆkey-valueï¼‰ç›´æ¥è®¿é—®çš„æ•°æ®ç»“æ„ï¼Œå®ƒæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å¯ä»¥å¿«é€Ÿå®ç°æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤ã€‚å…¶ä¸­ç”¨åˆ°çš„ç®—æ³•å«åšå“ˆå¸Œï¼Œå°±æ˜¯æŠŠä»»æ„é•¿åº¦çš„è¾“å…¥ï¼Œå˜æ¢æˆå›ºå®šé•¿åº¦çš„è¾“å‡ºï¼Œè¯¥è¾“å‡ºå°±æ˜¯å“ˆå¸Œå€¼ã€‚åƒ MD5ã€SHA1 éƒ½ç”¨çš„æ˜¯å“ˆå¸Œç®—æ³•ã€‚

åƒ Java ä¸­çš„ HashSetã€Hashtableï¼ˆæ³¨æ„æ˜¯å°å†™çš„ tï¼‰ã€HashMap éƒ½æ˜¯åŸºäºå“ˆå¸Œè¡¨çš„å…·ä½“å®ç°ã€‚å…¶ä¸­çš„ [HashMap](https://tobebetterjavaer.com/collection/hashmap.html) å°±æ˜¯æœ€å…¸å‹çš„ä»£è¡¨ï¼Œä¸ä»…é¢è¯•å®˜ç»å¸¸é—®ï¼Œå·¥ä½œä¸­çš„ä½¿ç”¨é¢‘ç‡ä¹Ÿéå¸¸çš„é«˜ã€‚

å¤§å®¶æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰å“ˆå¸Œè¡¨ï¼Œä½†åˆéœ€è¦è¿™æ ·ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œå®ƒé‡Œé¢å­˜æ”¾çš„æ•°æ®æ˜¯ä¸å…è®¸é‡å¤çš„ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

è¦ä¸ä½¿ç”¨ `equals()` æ–¹æ³•è¿›è¡Œé€ä¸ªæ¯”è¾ƒï¼Ÿè¿™ç§æ–¹æ¡ˆå½“ç„¶æ˜¯å¯è¡Œçš„ã€‚ä½†å¦‚æœæ•°æ®é‡ç‰¹åˆ«ç‰¹åˆ«å¤§ï¼Œé‡‡ç”¨ `equals()` æ–¹æ³•è¿›è¡Œé€ä¸ªå¯¹æ¯”çš„æ•ˆç‡è‚¯å®šå¾ˆä½å¾ˆä½ï¼Œæœ€å¥½çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯å“ˆå¸Œè¡¨ã€‚

æ‹¿ HashMap æ¥è¯´å§ã€‚å½“æˆ‘ä»¬è¦åœ¨å®ƒé‡Œé¢æ·»åŠ å¯¹è±¡æ—¶ï¼Œå…ˆè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„ `hashCode()` æ–¹æ³•ï¼Œå¾—åˆ°å¯¹åº”çš„å“ˆå¸Œå€¼ï¼Œç„¶åå°†å“ˆå¸Œå€¼å’Œå¯¹è±¡ä¸€èµ·æ”¾åˆ° HashMap ä¸­ã€‚å½“æˆ‘ä»¬è¦å†æ·»åŠ ä¸€ä¸ªæ–°çš„å¯¹è±¡æ—¶ï¼š

- è·å–å¯¹è±¡çš„å“ˆå¸Œå€¼ï¼›
- å’Œä¹‹å‰å·²ç»å­˜åœ¨çš„å“ˆå¸Œå€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œç›´æ¥å­˜è¿›å»ï¼›
- å¦‚æœæœ‰ç›¸ç­‰çš„ï¼Œå†è°ƒç”¨ `equals()` æ–¹æ³•è¿›è¡Œå¯¹è±¡ä¹‹é—´çš„æ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œä¸å­˜äº†ï¼›
- å¦‚æœä¸ç­‰ï¼Œè¯´æ˜å“ˆå¸Œå†²çªäº†ï¼Œå¢åŠ ä¸€ä¸ªé“¾è¡¨ï¼Œå­˜æ”¾æ–°çš„å¯¹è±¡ï¼›
- å¦‚æœé“¾è¡¨çš„é•¿åº¦å¤§äº 8ï¼Œè½¬ä¸ºçº¢é»‘æ ‘æ¥å¤„ç†ã€‚

å°±è¿™ä¹ˆä¸€å¥—ä¸‹æ¥ï¼Œè°ƒç”¨ `equals()` æ–¹æ³•çš„é¢‘ç‡å°±å¤§å¤§é™ä½äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦å“ˆå¸Œç®—æ³•è¶³å¤Ÿçš„é«˜æ•ˆï¼ŒæŠŠå‘ç”Ÿå“ˆå¸Œå†²çªçš„é¢‘ç‡é™åˆ°æœ€ä½ï¼Œå“ˆå¸Œè¡¨çš„æ•ˆç‡å°±ç‰¹åˆ«çš„é«˜ã€‚

æ¥çœ‹ä¸€ä¸‹ HashMap çš„å“ˆå¸Œç®—æ³•ï¼š

```java
static final int hash(Object key) {
    int h;
    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
}
```

å…ˆè°ƒç”¨å¯¹è±¡çš„ `hashCode()` æ–¹æ³•ï¼Œç„¶åå¯¹è¯¥å€¼è¿›è¡Œå³ç§»è¿ç®—ï¼Œç„¶åå†è¿›è¡Œå¼‚æˆ–è¿ç®—ã€‚

é€šå¸¸æ¥è¯´ï¼ŒString ä¼šç”¨æ¥ä½œä¸º HashMap çš„é”®è¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œå› æ­¤æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ String çš„ `hashCode()` æ–¹æ³•ï¼š

```java
public int hashCode() {
    int h = hash;
    if (h == 0 && value.length > 0) {
        char val[] = value;

        for (int i = 0; i < value.length; i++) {
            h = 31 * h + val[i];
        }
        hash = h;
    }
    return h;
}
```

å¯æƒ³è€ŒçŸ¥ï¼Œç»è¿‡è¿™ä¹ˆä¸€ç³»åˆ—å¤æ‚çš„è¿ç®—ï¼Œå†åŠ ä¸Š JDK ä½œè€…è¿™ç§å¤§å¸ˆçº§åˆ«çš„è®¾è®¡ï¼Œå“ˆå¸Œå†²çªçš„æ¦‚ç‡æˆ‘ç›¸ä¿¡å·²ç»é™åˆ°äº†æœ€ä½ï¼ˆæˆ‘ä»¬åœ¨ HashMap ä¸­æ·±å…¥æ¢è®¨è¿‡ï¼‰ã€‚

å½“ç„¶äº†ï¼Œä»ç†è®ºä¸Šæ¥è¯´ï¼Œå¯¹äºä¸¤ä¸ªä¸åŒå¯¹è±¡ï¼Œå®ƒä»¬é€šè¿‡ `hashCode()` æ–¹æ³•è®¡ç®—åçš„å€¼å¯èƒ½ç›¸åŒã€‚å› æ­¤ï¼Œä¸èƒ½ä½¿ç”¨ `hashCode()` æ–¹æ³•æ¥åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œå¿…é¡»å¾—é€šè¿‡ `equals()` æ–¹æ³•ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼š

- å¦‚æœä¸¤ä¸ªå¯¹è±¡è°ƒç”¨ `equals()` æ–¹æ³•å¾—åˆ°çš„ç»“æœä¸º trueï¼Œè°ƒç”¨ `hashCode()` æ–¹æ³•å¾—åˆ°çš„ç»“æœå¿…å®šç›¸ç­‰ï¼›
- å¦‚æœä¸¤ä¸ªå¯¹è±¡è°ƒç”¨ `hashCode()` æ–¹æ³•å¾—åˆ°çš„ç»“æœä¸ç›¸ç­‰ï¼Œè°ƒç”¨ `equals()` æ–¹æ³•å¾—åˆ°çš„ç»“æœå¿…å®šä¸º falseï¼›

åä¹‹ï¼š

- å¦‚æœä¸¤ä¸ªå¯¹è±¡è°ƒç”¨ `equals()` æ–¹æ³•å¾—åˆ°çš„ç»“æœä¸º falseï¼Œè°ƒç”¨ `hashCode()` æ–¹æ³•å¾—åˆ°çš„ç»“æœä¸ä¸€å®šä¸ç›¸ç­‰ï¼›
- å¦‚æœä¸¤ä¸ªå¯¹è±¡è°ƒç”¨ `hashCode()` æ–¹æ³•å¾—åˆ°çš„ç»“æœç›¸ç­‰ï¼Œè°ƒç”¨ `equals()` æ–¹æ³•å¾—åˆ°çš„ç»“æœä¸ä¸€å®šä¸º trueï¼›

æ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ã€‚

```java
public class Test {
    public static void main(String[] args) {
        Student s1 = new Student(18, "å¼ ä¸‰");
        Map<Student, Integer> scores = new HashMap<>();
        scores.put(s1, 98);
        System.out.println(scores.get(new Student(18, "å¼ ä¸‰")));
    }
}
 class Student {
    private int age;
    private String name;

     public Student(int age, String name) {
         this.age = age;
         this.name = name;
     }

     @Override
     public boolean equals(Object o) {
         Student student = (Student) o;
         return age == student.age &&
                 Objects.equals(name, student.name);
     }
 }
```

æˆ‘ä»¬é‡å†™äº† Student ç±»çš„ `equals()` æ–¹æ³•ï¼Œå¦‚æœä¸¤ä¸ªå­¦ç”Ÿçš„å¹´çºªå’Œå§“åç›¸åŒï¼Œæˆ‘ä»¬å°±è®¤ä¸ºæ˜¯åŒä¸€ä¸ªå­¦ç”Ÿï¼Œè™½ç„¶å¾ˆç¦»è°±ï¼Œä½†æˆ‘ä»¬å°±æ˜¯è¿™ä¹ˆè‰ç‡ã€‚

åœ¨ `main()` æ–¹æ³•ä¸­ï¼Œ18 å²çš„å¼ ä¸‰è€ƒè¯•å¾—äº† 98 åˆ†ï¼Œå¾ˆä¸é”™çš„æˆç»©ï¼Œæˆ‘ä»¬æŠŠå¼ ä¸‰å’Œæˆç»©æ”¾åˆ°äº† HashMap ä¸­ï¼Œç„¶åå‡†å¤‡è¾“å‡ºå¼ ä¸‰çš„æˆç»©ï¼š

```
null
```

å¾ˆä¸å·§ï¼Œç»“æœä¸º nullï¼Œè€Œä¸æ˜¯é¢„æœŸå½“ä¸­çš„ 98ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

åŸå› å°±åœ¨äºé‡å†™ `equals()` æ–¹æ³•çš„æ—¶å€™æ²¡æœ‰é‡å†™ `hashCode()` æ–¹æ³•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ`hashCode()` æ–¹æ³•æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œä¼šè¿”å›å¯¹è±¡çš„å­˜å‚¨åœ°å€ï¼Œæ˜¾ç„¶ `put()` ä¸­çš„ s1 å’Œ `get()` ä¸­çš„ `new Student(18, "å¼ ä¸‰")` æ˜¯ä¸¤ä¸ªå¯¹è±¡ï¼Œå®ƒä»¬çš„å­˜å‚¨åœ°å€è‚¯å®šæ˜¯ä¸åŒçš„ã€‚

HashMap çš„ `get()` æ–¹æ³•ä¼šè°ƒç”¨ `hash(key.hashCode())` è®¡ç®—å¯¹è±¡çš„å“ˆå¸Œå€¼ï¼Œè™½ç„¶ä¸¤ä¸ªä¸åŒçš„ `hashCode()` ç»“æœç»è¿‡ `hash()` æ–¹æ³•è®¡ç®—åæœ‰å¯èƒ½å¾—åˆ°ç›¸åŒçš„ç»“æœï¼Œä½†è¿™ç§æ¦‚ç‡å¾®ä¹å…¶å¾®ï¼Œæ‰€ä»¥å°±å¯¼è‡´ `scores.get(new Student(18, "å¼ ä¸‰"))` æ— æ³•å¾—åˆ°é¢„æœŸçš„å€¼ 18ã€‚

æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œé‡å†™ `hashCode()` æ–¹æ³•ã€‚

```java
 @Override
 public int hashCode() {
     return Objects.hash(age, name);
 }
```

[Objects ç±»](https://tobebetterjavaer.com/common-tool/Objects.html)çš„ `hash()` æ–¹æ³•å¯ä»¥é’ˆå¯¹ä¸åŒæ•°é‡çš„å‚æ•°ç”Ÿæˆæ–°çš„ `hashCode()` å€¼ã€‚

```java
public static int hashCode(Object a[]) {
 if (a == null)
     return 0;

 int result = 1;

 for (Object element : a)
     result = 31 * result + (element == null ? 0 : element.hashCode());

 return result;
}
```

ä»£ç ä¼¼ä¹å¾ˆç®€å•ï¼Œå½’çº³å‡ºçš„æ•°å­¦å…¬å¼å¦‚ä¸‹æ‰€ç¤ºï¼ˆn ä¸ºå­—ç¬¦ä¸²é•¿åº¦ï¼‰ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/basic-extra-meal/hashcode-2.png)

æ³¨æ„ï¼š31 æ˜¯ä¸ªå¥‡è´¨æ•°ï¼Œä¸å¤§ä¸å°ï¼Œä¸€èˆ¬è´¨æ•°éƒ½éå¸¸é€‚åˆå“ˆå¸Œè®¡ç®—ï¼Œå¶æ•°ç›¸å½“äºç§»ä½è¿ç®—ï¼Œå®¹æ˜“æº¢å‡ºï¼Œé€ æˆæ•°æ®ä¿¡æ¯ä¸¢å¤±ã€‚

è¿™å°±æ„å‘³ç€å¹´çºªå’Œå§“åç›¸åŒçš„æƒ…å†µä¸‹ï¼Œä¼šå¾—åˆ°ç›¸åŒçš„å“ˆå¸Œå€¼ã€‚`scores.get(new Student(18, "å¼ ä¸‰"))` å°±ä¼šè¿”å› 98 çš„é¢„æœŸå€¼äº†ã€‚

ã€ŠJava ç¼–ç¨‹æ€æƒ³ã€‹è¿™æœ¬åœ£ç»ä¸­æœ‰ä¸€æ®µè¯ï¼Œå¯¹ `hashCode()` æ–¹æ³•è¿›è¡Œäº†ä¸€æ®µæè¿°ã€‚

> è®¾è®¡ `hashCode()` æ—¶æœ€é‡è¦çš„å› ç´ å°±æ˜¯ï¼šæ— è®ºä½•æ—¶ï¼Œå¯¹åŒä¸€ä¸ªå¯¹è±¡è°ƒç”¨ `hashCode()` éƒ½åº”è¯¥ç”ŸæˆåŒæ ·çš„å€¼ã€‚å¦‚æœåœ¨å°†ä¸€ä¸ªå¯¹è±¡ç”¨ `put()` æ–¹æ³•æ·»åŠ è¿› HashMap æ—¶äº§ç”Ÿä¸€ä¸ª `hashCode()` å€¼ï¼Œè€Œç”¨ `get()` æ–¹æ³•å–å‡ºæ—¶å´äº§ç”Ÿäº†å¦å¤–ä¸€ä¸ª `hashCode()` å€¼ï¼Œé‚£ä¹ˆå°±æ— æ³•é‡æ–°å–å¾—è¯¥å¯¹è±¡äº†ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ çš„ `hashCode()` æ–¹æ³•ä¾èµ–äºå¯¹è±¡ä¸­æ˜“å˜çš„æ•°æ®ï¼Œç”¨æˆ·å°±è¦å½“å¿ƒäº†ï¼Œå› ä¸ºæ­¤æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ`hashCode()` å°±ä¼šç”Ÿæˆä¸€ä¸ªä¸åŒçš„å“ˆå¸Œå€¼ï¼Œç›¸å½“äºäº§ç”Ÿäº†ä¸€ä¸ªä¸åŒçš„é”®ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœ¨é‡å†™ `hashCode()` å’Œ `equals()` æ–¹æ³•æ—¶ï¼Œå¯¹è±¡ä¸­æŸä¸ªå­—æ®µå®¹æ˜“å‘ç”Ÿæ”¹å˜ï¼Œé‚£ä¹ˆæœ€å¥½èˆå¼ƒè¿™äº›å­—æ®µï¼Œä»¥å…äº§ç”Ÿä¸å¯é¢„æœŸçš„ç»“æœã€‚

å¥½ã€‚æœ‰äº†ä¸Šé¢è¿™äº›å†…å®¹ä½œä¸ºåŸºç¡€åï¼Œæˆ‘ä»¬å›å¤´å†æ¥çœ‹çœ‹æœ¬åœ°æ–¹æ³• `hashCode()` çš„ C++ æºç ã€‚

```cpp
static inline intptr_t get_next_hash(Thread* current, oop obj) {
  intptr_t value = 0;
  if (hashCode == 0) {
    // è¿™ç§å½¢å¼ä½¿ç”¨å…¨å±€çš„ Park-Miller éšæœºæ•°ç”Ÿæˆå™¨ã€‚
    // åœ¨ MP ç³»ç»Ÿä¸Šï¼Œæˆ‘ä»¬å°†å¯¹å…¨å±€å˜é‡è¿›è¡Œå¤§é‡çš„è¯»å†™è®¿é—®ï¼Œå› æ­¤è¯¥æœºåˆ¶ä¼šå¼•å‘å¤§é‡çš„ä¸€è‡´æ€§é€šä¿¡ã€‚
    value = os::random();
  } else if (hashCode == 1) {
    // è¿™ç§å˜ä½“åœ¨ STWï¼ˆStop The Worldï¼‰æ“ä½œä¹‹é—´å…·æœ‰ç¨³å®šï¼ˆå¹‚ç­‰ï¼‰çš„ç‰¹æ€§ã€‚
    // åœ¨ä¸€äº› 1-0 åŒæ­¥æ–¹æ¡ˆä¸­ï¼Œè¿™å¯èƒ½å¾ˆæœ‰ç”¨ã€‚
    intptr_t addr_bits = cast_from_oop<intptr_t>(obj) >> 3;
    value = addr_bits ^ (addr_bits >> 5) ^ GVars.stw_random;
  } else if (hashCode == 2) {
    value = 1;            // ç”¨äºæ•æ„Ÿæ€§æµ‹è¯•
  } else if (hashCode == 3) {
    value = ++GVars.hc_sequence;
  } else if (hashCode == 4) {
    value = cast_from_oop<intptr_t>(obj);
  } else {
    // Marsaglia çš„å¼‚æˆ–ç§»ä½æ–¹æ¡ˆï¼Œå…·æœ‰çº¿ç¨‹ç‰¹å®šçš„çŠ¶æ€
    // è¿™å¯èƒ½æ˜¯æœ€å¥½çš„æ•´ä½“å®ç° -- æˆ‘ä»¬å¯èƒ½ä¼šåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å°†å…¶è®¾ä¸ºé»˜è®¤å®ç°ã€‚
    unsigned t = current->_hashStateX;
    t ^= (t << 11);
    current->_hashStateX = current->_hashStateY;
    current->_hashStateY = current->_hashStateZ;
    current->_hashStateZ = current->_hashStateW;
    unsigned v = current->_hashStateW;
    v = (v ^ (v >> 19)) ^ (t ^ (t >> 8));
    current->_hashStateW = v;
    value = v;
  }

  value &= markWord::hash_mask;
  if (value == 0) value = 0xBAD;
  assert(value != markWord::no_hash, "invariant");
  return value;
}
```

å¦‚æœæ²¡æœ‰ C++ åŸºç¡€çš„è¯ï¼Œä¸ç”¨ç»†è‡´å»çœ‹æ¯ä¸€è¡Œä»£ç ï¼Œæˆ‘ä»¬åªé€šè¿‡è¡¨é¢å»äº†è§£ä¸€ä¸‹ `get_next_hash()` è¿™ä¸ªæ–¹æ³•å°±è¡Œã€‚å…¶ä¸­çš„ `hashCode` å˜é‡æ˜¯ JVM å¯åŠ¨æ—¶çš„ä¸€ä¸ªå…¨å±€å‚æ•°ï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥åˆ‡æ¢å“ˆå¸Œå€¼çš„ç”Ÿæˆç­–ç•¥ã€‚

- `hashCode==0`ï¼Œè°ƒç”¨æ“ä½œç³»ç»Ÿ OS çš„ `random()` æ–¹æ³•è¿”å›éšæœºæ•°ã€‚
- `hashCode == 1`ï¼Œåœ¨ STWï¼ˆstop-the-worldï¼‰æ“ä½œä¸­ï¼Œè¿™ç§ç­–ç•¥é€šå¸¸ç”¨äºåŒæ­¥æ–¹æ¡ˆä¸­ã€‚åˆ©ç”¨å¯¹è±¡åœ°å€è¿›è¡Œè®¡ç®—ï¼Œä½¿ç”¨ä¸ç»å¸¸æ›´æ–°çš„éšæœºæ•°ï¼ˆ`GVars.stw_random`ï¼‰å‚ä¸å…¶ä¸­ã€‚
- `hashCode == 2`ï¼Œä½¿ç”¨è¿”å› 1ï¼Œç”¨äºæŸäº›æƒ…å†µä¸‹çš„æµ‹è¯•ã€‚
- `hashCode == 3`ï¼Œä» 0 å¼€å§‹è®¡ç®—å“ˆå¸Œå€¼ï¼Œä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šä¸ªçº¿ç¨‹å¯èƒ½ä¼šå¾—åˆ°ç›¸åŒçš„å“ˆå¸Œå€¼ã€‚
- `hashCode == 4`ï¼Œä¸åˆ›å»ºå¯¹è±¡çš„å†…å­˜ä½ç½®æœ‰å…³ï¼ŒåŸæ ·è¾“å‡ºã€‚
- `hashCode == 5`ï¼Œé»˜è®¤å€¼ï¼Œæ”¯æŒå¤šçº¿ç¨‹ï¼Œä½¿ç”¨äº† Marsaglia çš„ xor-shift ç®—æ³•äº§ç”Ÿä¼ªéšæœºæ•°ã€‚æ‰€è°“çš„ xor-shift ç®—æ³•ï¼Œç®€å•æ¥è¯´ï¼Œçœ‹èµ·æ¥å°±æ˜¯ä¸€ä¸ªç§»ä½å¯„å­˜å™¨ï¼Œæ¯æ¬¡ç§»å…¥çš„ä½ç”±å¯„å­˜å™¨ä¸­è‹¥å¹²ä½å–å¼‚æˆ–ç”Ÿæˆã€‚æ‰€è°“çš„ä¼ªéšæœºæ•°ï¼Œä¸æ˜¯å®Œå…¨éšæœºçš„ï¼Œä½†æ˜¯çœŸéšæœºç”Ÿæˆæ¯”è¾ƒå›°éš¾ï¼Œæ‰€ä»¥åªè¦èƒ½é€šè¿‡ä¸€å®šçš„éšæœºæ•°ç»Ÿè®¡æ£€æµ‹ï¼Œå°±å¯ä»¥å½“ä½œçœŸéšæœºæ•°æ¥ä½¿ç”¨ã€‚

è¿™é‡Œç®€å•æ€»ç»“ä¸‹ã€‚

åœ¨ Java ä¸­ï¼Œ`hashCode()`æ–¹æ³•æ˜¯å®šä¹‰åœ¨ `java.lang.Object` ç±»ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥ç±»æ˜¯æ‰€æœ‰ Java æ‰€æœ‰ç±»çš„çˆ¶ç±»ã€‚å› æ­¤ï¼Œæ¯ä¸ª Java å¯¹è±¡éƒ½å¯ä»¥è°ƒç”¨ `hashCode()`æ–¹æ³•ã€‚`hashCode()`æ–¹æ³•ä¸»è¦ç”¨äºæ”¯æŒå“ˆå¸Œè¡¨ï¼ˆå¦‚ java.util.HashMapï¼‰ï¼Œè¿™äº›æ•°æ®ç»“æ„ä½¿ç”¨å“ˆå¸Œç®—æ³•èƒ½å®ç°å¿«é€ŸæŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚

`hashCode()`æ–¹æ³•çš„ä¸»è¦ç›®çš„æ˜¯è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¿™ä¸ªæ•´æ•°ç§°ä¸ºå“ˆå¸Œç ï¼Œå®ƒä»£è¡¨äº†å¯¹è±¡åœ¨å†…å­˜ä¸­çš„ä¸€ç§è¿‘ä¼¼è¡¨ç¤ºã€‚å“ˆå¸Œç ç”¨äºå°†å¯¹è±¡æ˜ å°„åˆ°å“ˆå¸Œè¡¨ä¸­çš„ä¸€ä¸ªç‰¹å®šçš„ä½ç½®ã€‚ä¸¤ä¸ªç›¸ç­‰çš„å¯¹è±¡ï¼ˆæ ¹æ® [`equals()`æ–¹æ³•æ¯”è¾ƒ](https://tobebetterjavaer.com/string/equals.html)ï¼‰åº”è¯¥å…·æœ‰ç›¸åŒçš„å“ˆå¸Œç ã€‚ç„¶è€Œï¼Œå…·æœ‰ç›¸åŒå“ˆå¸Œç çš„ä¸¤ä¸ªå¯¹è±¡å¹¶ä¸ä¸€å®šç›¸ç­‰ã€‚

å½“ä½ åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ç±»å¹¶è¦†ç›– `equals()`æ–¹æ³•æ—¶ï¼Œé€šå¸¸ä¹Ÿéœ€è¦è¦†ç›– `hashCode()`æ–¹æ³•ï¼Œä»¥ç¡®ä¿ç›¸ç­‰çš„å¯¹è±¡å…·æœ‰ç›¸åŒçš„å“ˆå¸Œç ã€‚è¿™æœ‰åŠ©äºæé«˜å“ˆå¸Œè¡¨åœ¨ä½¿ç”¨è‡ªå®šä¹‰ç±»çš„å¯¹è±¡ä½œä¸ºé”®æ—¶çš„å‡†ç¡®æ€§ã€‚

---

æœ€è¿‘æ•´ç†äº†ä¸€ä»½ç‰›é€¼çš„å­¦ä¹ èµ„æ–™ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº Java åŸºç¡€éƒ¨åˆ†ï¼ˆJVMã€Java é›†åˆæ¡†æ¶ã€å¤šçº¿ç¨‹ï¼‰ï¼Œè¿˜å›Šæ‹¬äº† **æ•°æ®åº“ã€è®¡ç®—æœºç½‘ç»œã€ç®—æ³•ä¸æ•°æ®ç»“æ„ã€è®¾è®¡æ¨¡å¼ã€æ¡†æ¶ç±» Springã€Nettyã€å¾®æœåŠ¡ï¼ˆDubboï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ ç½‘å…³** ç­‰ç­‰ç­‰ç­‰â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¯ä»¥è¯´æ˜¯ 2022 å¹´å…¨ç½‘æœ€å…¨çš„å­¦ä¹ å’Œæ‰¾å·¥ä½œçš„ PDF èµ„æºäº†](https://tobebetterjavaer.com/pdf/programmer-111.html)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 13.6 Javaæ˜¯å€¼ä¼ é€’è¿˜æ˜¯å¼•ç”¨ä¼ é€’ï¼Ÿ

â€œå“¥ï¼Œè¯´è¯´ Java åˆ°åº•æ˜¯å€¼ä¼ é€’è¿˜æ˜¯å¼•ç”¨ä¼ é€’å§ï¼Ÿâ€ä¸‰å¦¹ä¸€è„¸çš„å›°æƒ‘ï¼Œçœ‹å¾—å‡ºæ¥å¥¹è¢«è¿™ä¸ªé—®é¢˜æŠ˜ç£¨å¾—ä¸è½»ã€‚

â€œè¯´å®åœ¨çš„ï¼Œæˆ‘åœ¨ä¸€å¼€å§‹å­¦ Java çš„æ—¶å€™ä¹Ÿè¢«è¿™ä¸ªé—®é¢˜æŠ˜ç£¨å¾—å¤Ÿå‘›ï¼Œæ€»ä»¥ä¸º[åŸºæœ¬æ•°æ®ç±»å‹](https://tobebetterjavaer.com/basic-grammar/basic-data-type.html)åœ¨ä¼ å‚çš„æ—¶å€™æ˜¯å€¼ä¼ é€’ï¼Œè€Œå¼•ç”¨ç±»å‹æ˜¯å¼•ç”¨ä¼ é€’ã€‚â€æˆ‘å¯¹ä¸‰å¦¹è¢’éœ²äº†å¿ƒå£°ï¼Œä¸ºçš„å°±æ˜¯è®©å¥¹ä¸å†é‚£ä¹ˆç„¦è™‘ï¼Œå¥¹å“¥å½“å¹´ä¹Ÿæ˜¯è¿™ä¹ˆè¿‡æ¥çš„ã€‚

[C è¯­è¨€](https://tobebetterjavaer.com/xuexiluxian/c.html)æ˜¯å¾ˆå¤šç¼–ç¨‹è¯­è¨€çš„æ¯èƒï¼ŒåŒ…æ‹¬ Javaï¼Œé‚£ä¹ˆå¯¹äº C è¯­è¨€æ¥è¯´ï¼Œæ‰€æœ‰çš„æ–¹æ³•å‚æ•°éƒ½æ˜¯â€œé€šè¿‡å€¼â€ä¼ é€’çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¼ é€’ç»™è¢«è°ƒç”¨æ–¹æ³•çš„å‚æ•°å€¼å­˜æ”¾åœ¨ä¸´æ—¶å˜é‡ä¸­ï¼Œè€Œä¸æ˜¯å­˜æ”¾åœ¨åŸæ¥çš„å˜é‡ä¸­ã€‚è¿™å°±æ„å‘³ç€ï¼Œè¢«è°ƒç”¨çš„æ–¹æ³•ä¸èƒ½ä¿®æ”¹è°ƒç”¨æ–¹æ³•ä¸­å˜é‡çš„å€¼ï¼Œè€Œåªèƒ½ä¿®æ”¹å…¶ç§æœ‰å˜é‡çš„ä¸´æ—¶å‰¯æœ¬çš„å€¼ã€‚

Java ç»§æ‰¿äº† C è¯­è¨€è¿™ä¸€ç‰¹æ€§ï¼Œå› æ­¤ Java æ˜¯æŒ‰ç…§å€¼æ¥ä¼ é€’çš„ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¿…é¡»å¾—ææ¸…æ¥šï¼Œåˆ°åº•ä»€ä¹ˆæ˜¯å€¼ä¼ é€’ï¼ˆpass by valueï¼‰ï¼Œä»€ä¹ˆæ˜¯å¼•ç”¨ä¼ é€’ï¼ˆpass by referenceï¼‰ï¼Œå¦åˆ™ï¼Œè®¨è®º Java åˆ°åº•æ˜¯å€¼ä¼ é€’è¿˜æ˜¯å¼•ç”¨ä¼ é€’å°±æ˜¾å¾—æ¯«æ— æ„ä¹‰ã€‚

å½“ä¸€ä¸ªå‚æ•°æŒ‰ç…§å€¼çš„æ–¹å¼åœ¨ä¸¤ä¸ªæ–¹æ³•ä¹‹é—´ä¼ é€’æ—¶ï¼Œè°ƒç”¨è€…å’Œè¢«è°ƒç”¨è€…å…¶å®æ˜¯ç”¨çš„ä¸¤ä¸ªä¸åŒçš„å˜é‡â€”â€”è¢«è°ƒç”¨è€…ä¸­çš„å˜é‡ï¼ˆåŸå§‹å€¼ï¼‰æ˜¯è°ƒç”¨è€…ä¸­å˜é‡çš„ä¸€ä»½æ‹·è´ï¼Œå¯¹å®ƒä»¬å½“ä¸­çš„ä»»ä½•ä¸€ä¸ªå˜é‡ä¿®æ”¹éƒ½ä¸ä¼šå½±å“åˆ°å¦å¤–ä¸€ä¸ªå˜é‡ï¼Œæ®è¯´ Fortran è¯­è¨€æ˜¯é€šè¿‡å¼•ç”¨ä¼ é€’çš„ã€‚

â€œFortran è¯­è¨€ï¼Ÿâ€ä¸‰å¦¹çå¤§äº†åŒçœ¼ï¼Œä¼¼ä¹å¬è§äº†ä»€ä¹ˆæ–°çš„åè¯ã€‚

â€œæ˜¯çš„ï¼ŒFortran è¯­è¨€ï¼Œ1957 å¹´ç”± IBM å…¬å¸å¼€å‘ï¼Œæ˜¯ä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªè¢«æ­£å¼é‡‡ç”¨å¹¶æµä¼ è‡³ä»Šçš„é«˜çº§ç¼–ç¨‹è¯­è¨€ã€‚â€

å½“ä¸€ä¸ªå‚æ•°æŒ‰ç…§å¼•ç”¨ä¼ é€’çš„æ–¹å¼åœ¨ä¸¤ä¸ªæ–¹æ³•ä¹‹é—´ä¼ é€’æ—¶ï¼Œè°ƒç”¨è€…å’Œè¢«è°ƒç”¨è€…å…¶å®ç”¨çš„æ˜¯åŒä¸€ä¸ªå˜é‡ï¼Œå½“è¯¥å˜é‡è¢«ä¿®æ”¹æ—¶ï¼ŒåŒæ–¹éƒ½æ˜¯å¯è§çš„ã€‚

â€œæˆ‘ä»¬ä¹‹æ‰€ä»¥å®¹æ˜“æä¸æ¸…æ¥š Java åˆ°åº•æ˜¯å€¼ä¼ é€’è¿˜æ˜¯å¼•ç”¨ä¼ é€’ï¼Œä¸»è¦æ˜¯å› ä¸º Java ä¸­çš„ä¸¤ç±»æ•°æ®ç±»å‹çš„å«æ³•å®¹æ˜“å¼•å‘è¯¯ä¼šï¼Œæ¯”å¦‚è¯´ int æ˜¯åŸºæœ¬ç±»å‹ï¼Œè¯´å®ƒæ˜¯å€¼ä¼ é€’çš„ï¼Œæˆ‘ä»¬å°±å¾ˆå®¹æ˜“ç†è§£ï¼›ä½†å¯¹äºå¼•ç”¨ç±»å‹ï¼Œæ¯”å¦‚è¯´ Stringï¼Œè¯´å®ƒä¹Ÿæ˜¯å€¼ä¼ é€’çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å®¹æ˜“å¼„ä¸æ˜ç™½ã€‚â€

æˆ‘ä»¬æ¥çœ‹çœ‹åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹ä¹‹é—´çš„å·®åˆ«ã€‚

```java
int age = 18;
String name = "äºŒå“¥";
```

age æ˜¯åŸºæœ¬ç±»å‹ï¼Œå€¼å°±ä¿å­˜åœ¨å˜é‡ä¸­ï¼Œè€Œ name æ˜¯å¼•ç”¨ç±»å‹ï¼Œå˜é‡ä¸­ä¿å­˜çš„æ˜¯å¯¹è±¡çš„åœ°å€ã€‚ä¸€èˆ¬ç§°è¿™ç§å˜é‡ä¸ºå¯¹è±¡çš„å¼•ç”¨ï¼Œå¼•ç”¨å­˜æ”¾åœ¨æ ˆä¸­ï¼Œè€Œå¯¹è±¡å­˜æ”¾åœ¨å †ä¸­ã€‚

è¿™é‡Œè¯´çš„æ ˆå’Œå †ï¼Œæ˜¯æŒ‡å†…å­˜ä¸­çš„ä¸€å—åŒºåŸŸï¼Œå’Œæ•°æ®ç»“æ„ä¸­çš„æ ˆå’Œå †ä¸ä¸€æ ·ã€‚æ ˆæ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…é‡Šæ”¾çš„ï¼Œæ‰€ä»¥é€‚åˆå­˜æ”¾ç¼–è¯‘æœŸå°±ç¡®å®šç”Ÿå‘½å‘¨æœŸçš„æ•°æ®ï¼›è€Œå †ä¸­å­˜æ”¾çš„æ•°æ®ï¼Œç¼–è¯‘å™¨æ˜¯ä¸éœ€è¦çŸ¥é“ç”Ÿå‘½å‘¨æœŸçš„ï¼Œåˆ›å»ºåçš„å›æ”¶å·¥ä½œç”±åƒåœ¾æ”¶é›†å™¨æ¥å®Œæˆã€‚

â€œç”»å¹…å›¾ã€‚â€

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-points/pass-by-value-01.png)

å½“ç”¨ = èµ‹å€¼è¿ç®—ç¬¦æ”¹å˜ age å’Œ name çš„å€¼æ—¶ã€‚

```java
age = 16;
name = "ä¸‰å¦¹";
```

å¯¹äºåŸºæœ¬ç±»å‹ ageï¼Œèµ‹å€¼è¿ç®—ç¬¦ä¼šç›´æ¥æ”¹å˜å˜é‡çš„å€¼ï¼ŒåŸæ¥çš„å€¼è¢«è¦†ç›–ã€‚

å¯¹äºå¼•ç”¨ç±»å‹ nameï¼Œèµ‹å€¼è¿ç®—ç¬¦ä¼šæ”¹å˜å¯¹è±¡å¼•ç”¨ä¸­ä¿å­˜çš„åœ°å€ï¼ŒåŸæ¥çš„åœ°å€è¢«è¦†ç›–ï¼Œä½†åŸæ¥çš„å¯¹è±¡ä¸ä¼šè¢«è¦†ç›–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-points/pass-by-value-02.png)

â€œä¸‰å¦¹ï¼Œæ³¨æ„å¬ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥è¯´è¯´åŸºæœ¬æ•°æ®ç±»å‹çš„å‚æ•°ä¼ é€’ã€‚â€

Java æœ‰ 8 ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ intã€longã€byteã€shortã€floatã€double ã€char å’Œ booleanï¼Œå°±æ‹¿ int ç±»å‹æ¥ä¸¾ä¾‹å§ã€‚

```java
class PrimitiveTypeDemo {
    public static void main(String[] args) {
        int age = 18;
        modify(age);
        System.out.println(age);
    }

    private static void modify(int age1) {
        age1 = 30;
    }
}
```

1ï¼‰`main()` æ–¹æ³•ä¸­çš„ age ä¸ºåŸºæœ¬ç±»å‹ï¼Œæ‰€ä»¥å®ƒçš„å€¼ 18 ç›´æ¥å­˜å‚¨åœ¨å˜é‡ä¸­ã€‚

2ï¼‰è°ƒç”¨ `modify()` æ–¹æ³•çš„æ—¶å€™ï¼Œå°†ä¼šæŠŠ age çš„å€¼ 18 å¤åˆ¶ç»™å½¢å‚ age1ã€‚

3ï¼‰`modify()` æ–¹æ³•ä¸­ï¼Œå¯¹ age1  åšå‡ºäº†ä¿®æ”¹ã€‚

4ï¼‰å›åˆ° `main()` æ–¹æ³•ä¸­ï¼Œage çš„å€¼ä»ç„¶ä¸º 18ï¼Œå¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚

å¦‚æœæˆ‘ä»¬æƒ³è®© age çš„å€¼å‘ç”Ÿæ”¹å˜ï¼Œå°±éœ€è¦è¿™æ ·åšã€‚

```java
class PrimitiveTypeDemo1 {
    public static void main(String[] args) {
        int age = 18;
        age = modify(age);
        System.out.println(age);
    }

    private static int modify(int age1) {
        age1 = 30;
        return age1;
    }
}
```

ç¬¬ä¸€ï¼Œè®© `modify()` æ–¹æ³•æœ‰è¿”å›å€¼ï¼›

ç¬¬äºŒï¼Œä½¿ç”¨èµ‹å€¼è¿ç®—ç¬¦é‡æ–°å¯¹ age è¿›è¡Œèµ‹å€¼ã€‚

â€œå¥½äº†ï¼Œå†æ¥è¯´è¯´å¼•ç”¨ç±»å‹çš„å‚æ•°ä¼ é€’ã€‚â€

å°±ä»¥ String ä¸ºä¾‹å§ã€‚

```java
class ReferenceTypeDemo {
    public static void main(String[] args) {
        String name = "äºŒå“¥";
        modify(name);
        System.out.println(name);
    }

    private static void modify(String name1) {
        name1 = "ä¸‰å¦¹";
    }
}
```

åœ¨è°ƒç”¨ `modify()` æ–¹æ³•çš„æ—¶å€™ï¼Œå½¢å‚ name1 å¤åˆ¶äº† name çš„åœ°å€ï¼ŒæŒ‡å‘çš„æ˜¯å †ä¸­â€œäºŒå“¥â€çš„ä½ç½®ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-points/pass-by-value-03.png)

å½“ `modify()` æ–¹æ³•è°ƒç”¨ç»“æŸåï¼Œæ”¹å˜äº†å½¢å‚ name1 çš„åœ°å€ï¼Œä½† `main()` æ–¹æ³•ä¸­ name å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/core-points/pass-by-value-04.png)

æ€»ç»“ï¼š

- Java ä¸­çš„å‚æ•°ä¼ é€’æ˜¯æŒ‰å€¼ä¼ é€’çš„ã€‚
- å¦‚æœå‚æ•°æ˜¯åŸºæœ¬ç±»å‹ï¼Œä¼ é€’çš„æ˜¯åŸºæœ¬ç±»å‹çš„å­—é¢é‡å€¼çš„æ‹·è´ã€‚
- å¦‚æœå‚æ•°æ˜¯å¼•ç”¨ç±»å‹ï¼Œä¼ é€’çš„æ˜¯å¼•ç”¨çš„å¯¹è±¡åœ¨å †ä¸­åœ°å€çš„æ‹·è´ã€‚

â€œå¥½äº†ï¼Œä¸‰å¦¹ï¼Œä»Šå¤©çš„å­¦ä¹ å°±åˆ°è¿™å§ã€‚â€

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 12.7 Javaä¸ºä»€ä¹ˆæ— æ³•å®ç°çœŸæ­£çš„æ³›å‹

â€œäºŒå“¥ï¼Œä¸ºå•¥ Java ä¸èƒ½å®ç°çœŸæ­£çš„æ³›å‹å•Šï¼Ÿâ€ä¸‰å¦¹å¼€é—¨è§å±±åœ°é—®ã€‚

ç®€å•æ¥å›é¡¾ä¸€ä¸‹[ç±»å‹æ“¦é™¤](https://tobebetterjavaer.com/basic-extra-meal/generic.html)ï¼Œçœ‹ä¸‹é¢è¿™æ®µä»£ç ã€‚

```java
public class Cmower {
    public static void method(ArrayList<String> list) {
        System.out.println("Arraylist<String> list");
    }

    public static void method(ArrayList<Date> list) {
        System.out.println("Arraylist<Date> list");
    }
}
```

â€œä¸‰å¦¹ï¼Œä½ æ˜¯ä¸æ˜¯è®¤ä¸º `ArrayList<String> list` å’Œ `ArrayList<Date> list` æ˜¯ä¸¤ç§ä¸åŒçš„ç±»å‹ï¼Œå› ä¸º String å’Œ Date æ˜¯ä¸åŒçš„ç±»ã€‚â€æˆ‘é—®ã€‚

â€œå—¯ã€‚â€ä¸‰å¦¹ç‚¹ç‚¹å¤´ã€‚

ä½†ç”±äºç±»å‹æ“¦é™¤çš„åŸå› ï¼Œä»¥ä¸Šä»£ç æ˜¯ä¸ä¼šç¼–è¯‘é€šè¿‡çš„â€”â€”ç¼–è¯‘å™¨ä¼šæç¤ºä¸€ä¸ªé”™è¯¯ï¼š

```
>'method(ArrayList<String>)' clashes with 'method(ArrayList<Date>)'; both methods have same erasure
```

ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸¤ä¸ª `method()` æ–¹æ³•ç»è¿‡ç±»å‹æ“¦é™¤åçš„æ–¹æ³•ç­¾åæ˜¯å®Œå…¨ç›¸åŒçš„ï¼ŒJava æ˜¯ä¸å…è®¸è¿™æ ·åšçš„ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŒ‰ç…§æˆ‘ä»¬çš„å‡è®¾ï¼šå¦‚æœ Java èƒ½å¤Ÿå®ç°çœŸæ­£æ„ä¹‰ä¸Šçš„æ³›å‹ï¼Œä¸¤ä¸ª `method()` æ–¹æ³•æ˜¯å¯ä»¥åŒæ—¶å­˜åœ¨çš„ï¼Œå°±å¥½åƒæ–¹æ³•é‡è½½ä¸€æ ·ã€‚

```java
public class Cmower {
    public static void method(String list) {
    }

    public static void method(Date list) {
    }
}
```

â€œä¸ºä»€ä¹ˆ Java ä¸èƒ½å®ç°çœŸæ­£æ„ä¹‰ä¸Šçš„æ³›å‹å‘¢ï¼ŸèƒŒåçš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿå¿«å‘Šè¯‰æˆ‘å‘€ï¼â€ä¸‰å¦¹ç€æ€¥äº†ã€‚

â€œä¿æŒè€å¿ƒï¼Œå¥½ä¸å¥½ï¼Ÿâ€æˆ‘å®‰æ…°é“ã€‚

**ç¬¬ä¸€ï¼Œå…¼å®¹æ€§**

Java åœ¨ 2004 å¹´å·²ç»ç§¯ç´¯äº†è¾ƒä¸ºä¸°å¯Œçš„ç”Ÿæ€ï¼Œå¦‚æœæŠŠç°æœ‰çš„ç±»ä¿®æ”¹ä¸ºæ³›å‹ç±»ï¼Œéœ€è¦è®©æ‰€æœ‰çš„ç”¨æˆ·é‡æ–°ä¿®æ”¹æºä»£ç å¹¶ä¸”ç¼–è¯‘ï¼Œè¿™å°±ä¼šå¯¼è‡´ Java 1.4 ä¹‹å‰æ‰“ä¸‹çš„æ±Ÿå±±å¯èƒ½ä¼šå®Œå…¨è¦†ç­ã€‚

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ çš„ä»£ç åŸæ¥è¿è¡Œçš„å¥½å¥½çš„ï¼Œå°±å› ä¸º JDK çš„å‡çº§ï¼Œå¯¼è‡´æ‰€æœ‰çš„æºä»£ç éƒ½æ— æ³•ç¼–è¯‘é€šè¿‡å¹¶ä¸”æ— æ³•è¿è¡Œï¼Œæ˜¯ä¸æ˜¯ä¼šéå¸¸ç—›è‹¦ï¼Ÿ

ç±»å‹æ“¦é™¤å°±å®Œç¾å®ç°äº†å…¼å®¹æ€§ï¼ŒJava 1.5 ä¹‹åçš„ç±»å¯ä»¥ä½¿ç”¨æ³›å‹ï¼Œè€Œ Java 1.4 ä¹‹å‰æ²¡æœ‰ä½¿ç”¨æ³›å‹çš„ç±»ä¹Ÿå¯ä»¥ä¿ç•™ï¼Œå¹¶ä¸”ä¸ç”¨åšä»»ä½•ä¿®æ”¹å°±èƒ½åœ¨æ–°ç‰ˆæœ¬çš„ Java è™šæ‹Ÿæœºä¸Šè¿è¡Œã€‚

è€ç”¨æˆ·ä¸å—å½±å“ï¼Œæ–°ç”¨æˆ·å¯ä»¥è‡ªç”±åœ°é€‰æ‹©ä½¿ç”¨æ³›å‹ï¼Œå¯è°“ä¸€ä¸¾ä¸¤å¾—ã€‚

**ç¬¬äºŒï¼Œä¸æ˜¯â€œå®ç°ä¸äº†â€**ã€‚Pizzaï¼Œ1996 å¹´çš„å®éªŒè¯­è¨€ï¼Œåœ¨ Java çš„åŸºç¡€ä¸Šæ‰©å±•äº†æ³›å‹ã€‚

>Pizza æ•™ç¨‹åœ°å€ï¼š[http://pizzacompiler.sourceforge.net/doc/tutorial.html](http://pizzacompiler.sourceforge.net/doc/tutorial.html)

â€œ1996 å¹´ï¼Ÿâ€ä¸‰å¦¹è¡¨ç¤ºå¾ˆåƒæƒŠã€‚

â€œå—¯ï¼Œä½ é‚£ä¼šè¿˜æ²¡å‡ºç”Ÿã€‚â€æˆ‘è¯´ï¼Œâ€œæ’ä¸€ä¸‹ Java çš„ç‰ˆæœ¬å†å²å§ï¼Œä½ å¥½æœ‰ä¸€ä¸ªæ—¶é—´çº¿ä¸Šçš„è§‚å¿µã€‚â€

- 1995å¹´5æœˆ23æ—¥ï¼ŒJavaè¯­è¨€è¯ç”Ÿ
- 1996å¹´1æœˆï¼ŒJDK1.0 è¯ç”Ÿ
- 1997å¹´2æœˆ18æ—¥ï¼ŒJDK1.1å‘å¸ƒ
- 1998å¹´2æœˆï¼ŒJDK1.1è¢«ä¸‹è½½è¶…è¿‡2,000,000æ¬¡
- 2000å¹´5æœˆ8æ—¥ï¼ŒJDK1.3å‘å¸ƒ
- 2000å¹´5æœˆ29æ—¥ï¼ŒJDK1.4å‘å¸ƒ
- 2004å¹´9æœˆ30æ—¥18:00 PMï¼ŒJ2SE1.5 å‘å¸ƒ

ä¹Ÿå°±æ˜¯è¯´ï¼ŒPizza åœ¨ JDK 1.0 çš„ç‰ˆæœ¬ä¸Šå°±å®ç°äº†â€œçœŸæ­£æ„ä¹‰ä¸Šçš„â€æ³›å‹ï¼Œæˆ‘å¼•è¿‡æ¥ä¸¤æ®µä¾‹å­ï¼Œä½ ä¸€çœ‹å°±æ˜ç™½äº†ã€‚

é¦–å…ˆæ˜¯ StoreSomethingï¼Œä¸€ä¸ªæ³›å‹ç±»ï¼Œæ ‡è¯†ç¬¦æ˜¯å¤§å†™å­—æ¯ A è€Œä¸æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„å¤§å†™å­—æ¯ Tã€‚

```java
class StoreSomething<A> {
     A something;

     StoreSomething(A something) {
         this.something = something;
     }

     void set(A something) {
         this.something = something;
     }

     A get() {
         return something;
     }
}
```

è¿™ä¸ª A å‘¢ï¼Œå¯ä»¥æ˜¯ä»»ä½•åˆæ³•çš„ Java ç±»å‹ï¼š

```java
StoreSomething<String> a = new StoreSomething("I'm a string!");
StoreSomething<int> b = new StoreSomething(17+4);

b.set(9);

int i = b.get();
String s = a.get();
```

å¯¹å§ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„â€œçœŸæ­£æ„ä¹‰ä¸Šçš„æ³›å‹â€ï¼ŒA ä¸ä»…ä»…å¯ä»¥æ˜¯å¼•ç”¨ç±»å‹ Stringï¼Œè¿˜å¯ä»¥æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ã€‚è¦çŸ¥é“ï¼ŒJava çš„æ³›å‹ä¸å…è®¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œåªèƒ½æ˜¯åŒ…è£…å™¨ç±»å‹ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/generic/true-generic-01.png)

é™¤æ­¤ä¹‹å¤–ï¼ŒPizza çš„æ³›å‹è¿˜å¯ä»¥ç›´æ¥ä½¿ç”¨ `new` å…³é”®å­—è¿›è¡Œå£°æ˜ï¼Œå¹¶ä¸” Pizza ç¼–è¯‘å™¨ä¼šä»æ„é€ æ–¹æ³•çš„å‚æ•°ä¸Šæ¨æ–­å‡ºå…·ä½“çš„å¯¹è±¡ç±»å‹ï¼Œç©¶ç«Ÿæ˜¯ String è¿˜æ˜¯ intã€‚è¦çŸ¥é“ï¼ŒJava çš„æ³›å‹å› ä¸ºç±»å‹æ“¦é™¤çš„åŸå› ï¼Œç¨‹åºå‘˜æ˜¯æ— æ³•çŸ¥é“ä¸€ä¸ª ArrayList ç©¶ç«Ÿæ˜¯ `ArrayList<String>` è¿˜æ˜¯ `ArrayList<Integer>` çš„ã€‚

```java
ArrayList<Integer> ints = new ArrayList<Integer>();
ArrayList<String> strs = new ArrayList<String>();

System.out.println(ints.getClass());
System.out.println(strs.getClass());
```

è¾“å‡ºç»“æœï¼š

```
class java.util.ArrayList
class java.util.ArrayList
```

éƒ½æ˜¯ ArrayList è€Œå·²ã€‚

â€œé‚£ Pizza è¿™ç§â€œçœŸæ­£æ„ä¹‰ä¸Šçš„æ³›å‹â€ä¸ºä»€ä¹ˆæ²¡æœ‰è¢« Java é‡‡çº³å‘¢ï¼Ÿâ€ä¸‰å¦¹å¾ˆå…³å¿ƒè¿™ä¸ªé—®é¢˜ã€‚

äº‹å®ä¸Šï¼ŒJava çš„æ ¸å¿ƒå¼€å‘ç»„å¯¹ Pizza çš„æ³›å‹è®¾è®¡éå¸¸æ„Ÿå…´è¶£ï¼Œå¹¶ä¸”ä¸ Pizza çš„è®¾è®¡è€… Martin å’Œ Phil å–å¾—äº†è”ç³»ï¼Œæ–°åˆä½œäº†ä¸€ä¸ªé¡¹ç›® Generic Javaï¼Œäº‰å–åœ¨ Java ä¸­æ·»åŠ æ³›å‹æ”¯æŒï¼Œä½†ä¸å¼•å…¥ Pizza çš„å…¶ä»–åŠŸèƒ½ï¼Œæ¯”å¦‚è¯´å‡½æ•°å¼ç¼–ç¨‹ã€‚

*è¿™é‡Œå†è¡¥å……ä¸€ç‚¹ç»´åŸºç™¾ç§‘ä¸Šçš„èµ„æ–™ï¼ŒMartin Odersky æ˜¯ä¸€åå¾·å›½è®¡ç®—æœºç§‘å­¦å®¶ï¼Œä»–å’Œå…¶ä»–äººä¸€èµ·è®¾è®¡äº† Scala ç¼–ç¨‹è¯­è¨€ï¼Œä»¥åŠ Generic Javaï¼ˆè¿˜æœ‰ä¹‹å‰çš„ Pizzaï¼‰ï¼Œä»–å®ç°çš„ Generic Java ç¼–è¯‘å™¨æˆä¸ºäº† Java ç¼–è¯‘å™¨ javac çš„åŸºç¡€ã€‚*

ç«™åœ¨é©¬åç‚®çš„æ€ç»´æ¥çœ‹ï¼ŒPizza çš„æ³›å‹è®¾è®¡å’Œå‡½æ•°å¼ç¼–ç¨‹éå¸¸å…·æœ‰å†å²å‰ç»æ€§ã€‚ç„¶è€Œ Java çš„æ ¸å¿ƒå¼€å‘ç»„åœ¨å½“æ—¶ä¼¼ä¹å¹¶ä¸æƒ³æŠŠå‡½æ•°å¼ç¼–ç¨‹å¼•å…¥åˆ° Java ä¸­ã€‚

ä»¥è‡³äº Java åœ¨ 1.4 ä¹‹å‰ä»ç„¶æ˜¯ä¸æ”¯æŒæ³›å‹çš„ã€‚

â€œä¸ºä»€ä¹ˆ Java 1.5 çš„æ—¶å€™åˆçªç„¶æ”¯æŒæ³›å‹äº†å‘¢ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œå½“ç„¶æ˜¯åˆ°äº†ä¸æ”¯æŒä¸è¡Œçš„æ—¶å€™äº†ã€‚â€æˆ‘è¯´ã€‚

æ²¡æœ‰æ³›å‹ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ä»£ç ï¼š

```java
ArrayList list = new ArrayList();
list.add("æ²‰é»˜ç‹äºŒ");
list.add(new Date());
```

ä¸ç®¡æ˜¯ String ç±»å‹ï¼Œè¿˜æ˜¯ Date ç±»å‹ï¼Œéƒ½å¯ä»¥ä¸€è‚¡è„‘å¡è¿› ArrayList å½“ä¸­ï¼Œè¿™çœ‹èµ·æ¥ä¼¼ä¹å¾ˆæ–¹ä¾¿ï¼Œä½†å–çš„æ—¶å€™å°±æ‚²å‰§äº†ã€‚

```java
String s = list.get(1);
```

è¿™æ ·å–è¡Œå—ï¼Ÿä¸è¡Œã€‚è¿˜å¾—åŠ ä¸Šå¼ºåˆ¶è½¬æ¢ã€‚

```java
String s = (String) list.get(1);
```

ä½†æˆ‘ä»¬çŸ¥é“ï¼Œè¿™è¡Œä»£ç åœ¨è¿è¡Œçš„æ—¶å€™å¿…ç„¶ä¼šå‡ºé”™ï¼š

```
Exception in thread "main" java.lang.ClassCastException: java.util.Date cannot be cast to java.lang.String
```

è¿™å°±åˆå›åˆ°â€œå…¼å®¹æ€§â€çš„é—®é¢˜äº†ã€‚

Java è¯­è¨€å’Œå…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸ä¸€æ ·ï¼Œæœ‰ç€æ²‰é‡çš„å†å²åŒ…è¢±ï¼Œ1.5 ä¹‹å‰å·²ç»æœ‰å¤§é‡çš„ç¨‹åºéƒ¨ç½²åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹äº†ï¼Œè¿™æ—¶å€™å¦‚æœä¸€åˆ€åˆ‡ï¼ŒåŸæ¥æ²¡æœ‰ä½¿ç”¨æ³›å‹çš„ä»£ç ç›´æ¥æ‰¼æ€äº†ï¼Œåæœä¸å ªæƒ³è±¡ã€‚

Java ä¸€ç›´ä»¥æ¥éƒ½å¼ºè°ƒå…¼å®¹æ€§ï¼Œæˆ‘è®¤ä¸ºè¿™ä¹Ÿæ˜¯ Java ä¹‹æ‰€ä»¥èƒ½è¢«å¹¿æ³›ä½¿ç”¨çš„ä¸»è¦åŸå› ä¹‹ä¸€ï¼Œå¼€å‘è€…ä¸å¿…æ‹…å¿ƒ Java ç‰ˆæœ¬å‡çº§çš„é—®é¢˜ï¼Œä¸€ä¸ªåœ¨ JDK 1.4 ä¸Šå¯ä»¥è·‘çš„ä»£ç ï¼Œæ”¾åœ¨ JDK 1.5 ä¸Šä»ç„¶å¯ä»¥è·‘ã€‚

è¿™é‡Œå¿…é¡»å¾—è¯´æ˜ä¸€ç‚¹ï¼ŒJ2SE1.5 çš„å‘å¸ƒï¼Œæ˜¯ Java è¯­è¨€å‘å±•å²ä¸Šçš„é‡è¦é‡Œç¨‹ç¢‘ï¼Œä¸ºäº†è¡¨ç¤ºè¯¥ç‰ˆæœ¬çš„é‡è¦æ€§ï¼ŒJ2SE1.5 ä¹Ÿæ­£å¼æ›´åä¸º Java SE 5.0ï¼Œå¾€åå»å°±æ˜¯ Java SE 6.0ï¼ŒJava SE 7.0ã€‚ã€‚ã€‚ã€‚

ä½† Java å¹¶ä¸æ”¯æŒé«˜ç‰ˆæœ¬ JDK ç¼–è¯‘ç”Ÿæˆçš„å­—èŠ‚ç æ–‡ä»¶åœ¨ä½ç‰ˆæœ¬çš„ JREï¼ˆJava è¿è¡Œæ—¶ç¯å¢ƒï¼‰ä¸Šè·‘ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/generic/true-generic-02.png)


é’ˆå¯¹æ³›å‹ï¼Œå…¼å®¹æ€§å…·ä½“è¡¨ç°åœ¨ä»€ä¹ˆåœ°æ–¹å‘¢ï¼Ÿæ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ã€‚

```java
ArrayList<Integer> ints = new ArrayList<Integer>();
ArrayList<String> strs = new ArrayList<String>();
ArrayList list;
list = ints;
list = strs;
```

â€œå…¼å®¹æ€§è¡¨ç°åœ¨ä¸Šé¢è¿™æ®µä»£ç å¿…é¡»å¾—èƒ½å¤Ÿç¼–è¯‘è¿è¡Œã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿâ€æˆ‘æ‰­å¤´çœ‹äº†ä¸€ä¸‹æ—è¾¹çš„ä¸‰å¦¹ï¼Œç»§ç»­è¯´ã€‚

â€œåªèƒ½æç±»å‹æ“¦é™¤äº†ï¼â€æˆ‘å¦¹è‚¯å®šåœ°å›ç­”ã€‚

â€œæ˜¯æ»´ã€‚â€

ç¼–è¯‘å‰è¿›è¡Œæ³›å‹æ£€æµ‹ï¼Œ`ArrayList<Integer>` åªèƒ½æ”¾ Integerï¼Œ`ArrayList<String>` åªèƒ½æ”¾ Stringï¼Œå–çš„æ—¶å€™å°±ä¸ç”¨æ‹…å¿ƒç±»å‹å¼ºè½¬å‡ºé”™äº†ã€‚

ä½†ç¼–è¯‘åçš„å­—èŠ‚ç æ–‡ä»¶é‡Œï¼Œæ˜¯æ²¡æœ‰æ³›å‹çš„ï¼Œæ”¾çš„éƒ½æ˜¯ Objectã€‚

Java ç¥å¥‡å°±ç¥å¥‡åœ¨è¿™ï¼Œè¡¨é¢ä¸Šä¸‡ç‰©çš†å¯¹è±¡ï¼Œä½†ä¸ºäº†æ€§èƒ½ä¸Šçš„è€ƒé‡ï¼Œåˆå­˜åœ¨ intã€double è¿™ç§åŸå§‹ç±»å‹ï¼Œä½†åŸå§‹ç±»å‹åˆæ²¡åŠæ³•å’Œ Object å…¼å®¹ï¼Œäºæ˜¯æˆ‘ä»¬å°±åªèƒ½å†™ `ArrayList<Integer>` è¿™æ ·å¾ˆå ç”¨å†…å­˜ç©ºé—´çš„ä»£ç ã€‚

è¿™ææ€•ä¹Ÿæ˜¯ Java æ³›å‹è¢«åæ§½çš„åŸå› ä¹‹ä¸€äº†ã€‚

ä¸€ä¸ªå¥½æ¶ˆæ¯æ˜¯ Valhalla é¡¹ç›®æ­£åœ¨åŠªåŠ›è§£å†³è¿™äº›å› ä¸ºæ³›å‹æ“¦é™¤å¸¦æ¥çš„å†å²é—ç•™é—®é¢˜ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/generic/true-generic-03.png)


Project Valhallaï¼šæ­£åœ¨è¿›è¡Œå½“ä¸­çš„ OpenJDK é¡¹ç›®ï¼Œè®¡åˆ’ç»™æœªæ¥çš„ Java æ·»åŠ æ”¹è¿›çš„æ³›å‹æ”¯æŒã€‚

>æºç åœ°å€ï¼š[http://openjdk.java.net/projects/valhalla/](http://openjdk.java.net/projects/valhalla/)

è®©æˆ‘ä»¬æ‹­ç›®ä»¥å¾…å§ï¼

â€œæ€ä¹ˆæ ·ï¼Ÿä¸‰å¦¹ï¼Œè¿™ä¸‹å…¨éƒ¨éƒ½æ˜ç™½äº†å§ï¼â€æˆ‘é—®ã€‚

â€œå—¯å—¯ã€‚äºŒå“¥ï¼Œä½ è®²å¾—å¯çœŸæ£’ğŸ‘â€ä¸‰å¦¹å¤¸å¥–å¾—æˆ‘æœ‰ç‚¹å°å¼€å¿ƒï¼Œå˜¿å˜¿ã€‚

---

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

## 12.8 æŒæ¡ Java åå°„

â€œäºŒå“¥ï¼Œä»€ä¹ˆæ˜¯åå°„å‘€ï¼Ÿâ€ä¸‰å¦¹å¼€é—¨è§å±±åœ°é—®ã€‚

â€œè¦æƒ³çŸ¥é“ä»€ä¹ˆæ˜¯åå°„ï¼Œå°±éœ€è¦å…ˆæ¥äº†è§£ä»€ä¹ˆæ˜¯â€˜æ­£å°„â€™ã€‚â€æˆ‘ç¬‘ç€å¯¹ä¸‰å¦¹è¯´ï¼Œâ€œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨æŸä¸ªç±»ä¹‹å‰å·²ç»ç¡®å®šå®ƒåˆ°åº•æ˜¯ä¸ªä»€ä¹ˆç±»äº†ï¼Œæ‹¿åˆ°æ‰‹å°±ç›´æ¥å¯ä»¥ä½¿ç”¨ `new` å…³é”®å­—æ¥è°ƒç”¨æ„é€ æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ï¼Œä¹‹åä½¿ç”¨è¿™ä¸ªç±»çš„å¯¹è±¡æ¥è¿›è¡Œæ“ä½œã€‚â€

```java
Writer writer = new Writer();
writer.setName("æ²‰é»˜ç‹äºŒ");
```

åƒä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œå°±å¯ä»¥ç†è§£ä¸ºâ€œæ­£å°„â€ã€‚è€Œåå°„å°±æ„å‘³ç€ä¸€å¼€å§‹æˆ‘ä»¬ä¸çŸ¥é“è¦åˆå§‹åŒ–çš„ç±»åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œä¹Ÿå°±æ²¡æ³•ç›´æ¥ä½¿ç”¨ `new` å…³é”®å­—åˆ›å»ºå¯¹è±¡äº†ã€‚

æˆ‘ä»¬åªçŸ¥é“è¿™ä¸ªç±»çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œå°±å¥½åƒæˆ‘ä»¬çœ‹ç”µå½±çš„æ—¶å€™ï¼Œä¸ºäº†æŠ“ä½ä¸€ä¸ªçŠ¯ç½ªå«Œç–‘äººï¼Œè­¦å¯Ÿå°±ä¼šé—®ä¸€äº›ç›®å‡»è¯äººï¼Œæ ¹æ®è¿™äº›è¯äººæä¾›çš„ä¿¡æ¯ï¼Œæ‰¾ä¸“å®¶æŠŠçŠ¯ç½ªå«Œç–‘äººçš„æ ·è²Œç»™ç”»å‡ºæ¥â€”â€”è¿™ä¸ªè¿‡ç¨‹ï¼Œå°±å¯ä»¥ç§°ä¹‹ä¸º**åå°„**ã€‚

```java
Class clazz = Class.forName("com.itwanger.s39.Writer");
Method method = clazz.getMethod("setName", String.class);
Constructor constructor = clazz.getConstructor();
Object object = constructor.newInstance();
method.invoke(object,"æ²‰é»˜ç‹äºŒ");
```

åƒä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œå°±å¯ä»¥ç†è§£ä¸ºâ€œåå°„â€ã€‚

â€œåå°„çš„å†™æ³•æ¯”æ­£å°„å¤æ‚å¾—å¤šå•Šï¼â€ä¸‰å¦¹æ„Ÿæ…¨åœ°è¯´ã€‚

â€œæ˜¯çš„ï¼Œåå°„çš„æˆæœ¬æ˜¯è¦æ¯”æ­£å°„çš„é«˜å¾—å¤šã€‚â€æˆ‘è¯´ï¼Œâ€œåå°„çš„ç¼ºç‚¹ä¸»è¦æœ‰ä¸¤ä¸ªã€‚â€

- **ç ´åå°è£…**ï¼šç”±äºåå°„å…è®¸è®¿é—®ç§æœ‰å­—æ®µå’Œç§æœ‰æ–¹æ³•ï¼Œæ‰€ä»¥å¯èƒ½ä¼šç ´åå°è£…è€Œå¯¼è‡´å®‰å…¨é—®é¢˜ã€‚
- **æ€§èƒ½å¼€é”€**ï¼šç”±äºåå°„æ¶‰åŠåˆ°åŠ¨æ€è§£æï¼Œå› æ­¤æ— æ³•æ‰§è¡Œ Java è™šæ‹Ÿæœºä¼˜åŒ–ï¼Œå†åŠ ä¸Šåå°„çš„å†™æ³•çš„ç¡®è¦å¤æ‚å¾—å¤šï¼Œæ‰€ä»¥æ€§èƒ½è¦æ¯”â€œæ­£å°„â€å·®å¾ˆå¤šï¼Œåœ¨ä¸€äº›æ€§èƒ½æ•æ„Ÿçš„ç¨‹åºä¸­åº”è¯¥é¿å…ä½¿ç”¨åå°„ã€‚

â€œé‚£åå°„æœ‰å“ªäº›å¥½å¤„å‘¢ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

åå°„çš„ä¸»è¦åº”ç”¨åœºæ™¯æœ‰ï¼š

- **å¼€å‘é€šç”¨æ¡†æ¶**ï¼šåƒ Springï¼Œä¸ºäº†ä¿æŒé€šç”¨æ€§ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶æ¥åŠ è½½ä¸åŒçš„å¯¹è±¡ï¼Œè°ƒç”¨ä¸åŒçš„æ–¹æ³•ã€‚
- **åŠ¨æ€ä»£ç†**ï¼šåœ¨é¢å‘åˆ‡é¢ç¼–ç¨‹ä¸­ï¼Œéœ€è¦æ‹¦æˆªç‰¹å®šçš„æ–¹æ³•ï¼Œå°±ä¼šé€‰æ‹©åŠ¨æ€ä»£ç†çš„æ–¹å¼ï¼Œè€ŒåŠ¨æ€ä»£ç†çš„åº•å±‚æŠ€æœ¯å°±æ˜¯åå°„ã€‚
- **æ³¨è§£**ï¼šæ³¨è§£æœ¬èº«åªæ˜¯èµ·åˆ°ä¸€ä¸ªæ ‡è®°ç¬¦çš„ä½œç”¨ï¼Œå®ƒéœ€è¦åˆ©ç”¨å‘å°„æœºåˆ¶ï¼Œæ ¹æ®æ ‡è®°ç¬¦å»æ‰§è¡Œç‰¹å®šçš„è¡Œä¸ºã€‚

â€œå¥½äº†ï¼Œæ¥çœ‹ä¸€ä¸‹å®Œæ•´çš„ä¾‹å­å§ã€‚â€æˆ‘å¯¹ä¸‰å¦¹è¯´ã€‚

Writer ç±»ï¼Œæœ‰ä¸¤ä¸ªå­—æ®µï¼Œç„¶åè¿˜æœ‰å¯¹åº”çš„ getter/setterã€‚

```java
public class Writer {
    private int age;
    private String name;

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}
```

æµ‹è¯•ç±»ï¼š

```java
public class ReflectionDemo1 {
    public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException {
        Writer writer = new Writer();
        writer.setName("æ²‰é»˜ç‹äºŒ");
        System.out.println(writer.getName());

        Class clazz = Class.forName("com.itwanger.s39.Writer");
        Constructor constructor = clazz.getConstructor();
        Object object = constructor.newInstance();

        Method setNameMethod = clazz.getMethod("setName", String.class);
        setNameMethod.invoke(object, "æ²‰é»˜ç‹äºŒ");
        Method getNameMethod = clazz.getMethod("getName");
        System.out.println(getNameMethod.invoke(object));
    }
}
```

æ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœï¼š

```
æ²‰é»˜ç‹äºŒ
æ²‰é»˜ç‹äºŒ
```

åªä¸è¿‡ï¼Œåå°„çš„è¿‡ç¨‹ç•¥æ˜¾æ›²æŠ˜äº†ä¸€äº›ã€‚

ç¬¬ä¸€æ­¥ï¼Œè·å–åå°„ç±»çš„ Class å¯¹è±¡ï¼š

```java
Class clazz = Class.forName("com.itwanger.s39.Writer");
```

ç¬¬äºŒæ­¥ï¼Œé€šè¿‡  Class å¯¹è±¡è·å–æ„é€ æ–¹æ³• Constructor å¯¹è±¡ï¼š

```java
Constructor constructor = clazz.getConstructor();
```

ç¬¬ä¸‰æ­¥ï¼Œé€šè¿‡ Constructor å¯¹è±¡åˆå§‹åŒ–åå°„ç±»å¯¹è±¡ï¼š

```java
Object object = constructor.newInstance();
```

ç¬¬å››æ­¥ï¼Œè·å–è¦è°ƒç”¨çš„æ–¹æ³•çš„ Method å¯¹è±¡ï¼š

```java
Method setNameMethod = clazz.getMethod("setName", String.class);
Method getNameMethod = clazz.getMethod("getName");
```

ç¬¬äº”æ­¥ï¼Œé€šè¿‡ `invoke()` æ–¹æ³•æ‰§è¡Œï¼š

```java
setNameMethod.invoke(object, "æ²‰é»˜ç‹äºŒ");
getNameMethod.invoke(object)
```

â€œä¸‰å¦¹ï¼Œä½ çœ‹ï¼Œç»è¿‡è¿™äº”ä¸ªæ­¥éª¤ï¼ŒåŸºæœ¬ä¸Šå°±æŒæ¡äº†åå°„çš„ä½¿ç”¨æ–¹æ³•ã€‚â€æˆ‘è¯´ã€‚

â€œå¥½åƒåå°„ä¹Ÿæ²¡ä»€ä¹ˆå¤æ‚çš„å•Šï¼â€ä¸‰å¦¹è¯´ã€‚

æˆ‘å…ˆå¯¹ä¸‰å¦¹ç‚¹ç‚¹å¤´ï¼Œç„¶åè¯´ï¼šâ€œæ˜¯çš„ï¼ŒæŒæ¡åå°„çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ç¡®å®ä¸éš¾ï¼Œä½†è¦ç†è§£æ•´ä¸ªåå°„æœºåˆ¶è¿˜æ˜¯éœ€è¦èŠ±ä¸€ç‚¹æ—¶é—´å»äº†è§£ä¸€ä¸‹ Java è™šæ‹Ÿæœºçš„ç±»åŠ è½½æœºåˆ¶çš„ã€‚â€

è¦æƒ³ä½¿ç”¨åå°„ï¼Œé¦–å…ˆéœ€è¦è·å¾—åå°„ç±»çš„ Class å¯¹è±¡ï¼Œæ¯ä¸€ä¸ªç±»ï¼Œä¸ç®¡å®ƒæœ€ç»ˆç”Ÿæˆäº†å¤šå°‘ä¸ªå¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡åªä¼šå¯¹åº”ä¸€ä¸ª Class å¯¹è±¡ï¼Œè¿™ä¸ª Class å¯¹è±¡æ˜¯ç”± Java è™šæ‹Ÿæœºç”Ÿæˆçš„ï¼Œç”±å®ƒæ¥è·æ‚‰æ•´ä¸ªç±»çš„ç»“æ„ä¿¡æ¯ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œ`java.lang.Class` æ˜¯æ‰€æœ‰åå°„ API çš„å…¥å£ã€‚

è€Œæ–¹æ³•çš„åå°„è°ƒç”¨ï¼Œæœ€ç»ˆæ˜¯ç”± Method å¯¹è±¡çš„ `invoke()` æ–¹æ³•å®Œæˆçš„ï¼Œæ¥çœ‹ä¸€ä¸‹æºç ï¼ˆJDK 8 ç¯å¢ƒä¸‹ï¼‰ã€‚

```java
public Object invoke(Object obj, Object... args)
        throws IllegalAccessException, IllegalArgumentException,
        InvocationTargetException {
    // å¦‚æœæ–¹æ³•ä¸å…è®¸è¢«è¦†ç›–ï¼Œè¿›è¡Œæƒé™æ£€æŸ¥
    if (!override) {
        if (!Reflection.quickCheckMemberAccess(clazz, modifiers)) {
            Class<?> caller = Reflection.getCallerClass();
            // æ£€æŸ¥è°ƒç”¨è€…æ˜¯å¦å…·æœ‰è®¿é—®æƒé™
            checkAccess(caller, clazz, obj, modifiers);
        }
    }
    // è·å–æ–¹æ³•è®¿é—®å™¨ï¼ˆä» volatile å˜é‡ä¸­è¯»å–ï¼‰
    MethodAccessor ma = methodAccessor;
    if (ma == null) {
        // å¦‚æœè®¿é—®å™¨ä¸ºç©ºï¼Œå°è¯•è·å–æ–¹æ³•è®¿é—®å™¨
        ma = acquireMethodAccessor();
    }
    // ä½¿ç”¨æ–¹æ³•è®¿é—®å™¨è°ƒç”¨æ–¹æ³•ï¼Œå¹¶è¿”å›ç»“æœ
    return ma.invoke(obj, args);
}
```

ä¸¤ä¸ªåµŒå¥—çš„ if è¯­å¥æ˜¯ç”¨æ¥è¿›è¡Œæƒé™æ£€æŸ¥çš„ã€‚

`invoke()` æ–¹æ³•å®é™…ä¸Šæ˜¯å§”æ´¾ç»™ MethodAccessor æ¥å£æ¥å®Œæˆçš„ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/fanshe/fanshe-01.png)

MethodAccessor æ¥å£æœ‰ä¸‰ä¸ªå®ç°ç±»ï¼Œå…¶ä¸­çš„ MethodAccessorImpl æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå¦å¤–ä¸¤ä¸ªå…·ä½“çš„å®ç°ç±»ç»§æ‰¿äº†è¿™ä¸ªæŠ½è±¡ç±»ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/fanshe/fanshe-02.png)

- NativeMethodAccessorImplï¼šé€šè¿‡æœ¬åœ°æ–¹æ³•æ¥å®ç°åå°„è°ƒç”¨ï¼›
- DelegatingMethodAccessorImplï¼šé€šè¿‡å§”æ´¾æ¨¡å¼æ¥å®ç°åå°„è°ƒç”¨ï¼›

é€šè¿‡ debug çš„æ–¹å¼è¿›å…¥ `invoke()` æ–¹æ³•åï¼Œå¯ä»¥çœ‹åˆ°ç¬¬ä¸€æ¬¡åå°„è°ƒç”¨ä¼šç”Ÿæˆä¸€ä¸ªå§”æ´¾å®ç° DelegatingMethodAccessorImplï¼Œå®ƒåœ¨ç”Ÿæˆçš„æ—¶å€™ä¼šä¼ é€’ä¸€ä¸ªæœ¬åœ°å®ç° NativeMethodAccessorImplã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/fanshe/fanshe-03.png)

ä¹Ÿå°±æ˜¯è¯´ï¼Œ`invoke()` æ–¹æ³•åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šå…ˆè°ƒç”¨ DelegatingMethodAccessorImplï¼Œç„¶åè°ƒç”¨ NativeMethodAccessorImplï¼Œæœ€åå†è°ƒç”¨å®é™…çš„æ–¹æ³•ã€‚

â€œä¸ºä»€ä¹ˆä¸ç›´æ¥è°ƒç”¨æœ¬åœ°å®ç°å‘¢ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œä¹‹æ‰€ä»¥é‡‡ç”¨å§”æ´¾å®ç°ï¼Œæ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨æœ¬åœ°å®ç°å’ŒåŠ¨æ€å®ç°ä¹‹é—´åˆ‡æ¢ã€‚åŠ¨æ€å®ç°æ˜¯å¦å¤–ä¸€ç§åå°„è°ƒç”¨æœºåˆ¶ï¼Œå®ƒæ˜¯é€šè¿‡ç”Ÿæˆå­—èŠ‚ç çš„å½¢å¼æ¥å®ç°çš„ã€‚å¦‚æœåå°„è°ƒç”¨çš„æ¬¡æ•°æ¯”è¾ƒå¤šï¼ŒåŠ¨æ€å®ç°çš„æ•ˆç‡å°±ä¼šæ›´é«˜ï¼Œå› ä¸ºæœ¬åœ°å®ç°éœ€è¦ç»è¿‡ Java åˆ° C/C++ å†åˆ° Java ä¹‹é—´çš„åˆ‡æ¢è¿‡ç¨‹ï¼Œè€ŒåŠ¨æ€å®ç°ä¸éœ€è¦ï¼›ä½†å¦‚æœåå°„è°ƒç”¨çš„æ¬¡æ•°æ¯”è¾ƒå°‘ï¼Œåè€Œæœ¬åœ°å®ç°æ›´å¿«ä¸€äº›ã€‚â€æˆ‘è¯´ã€‚

â€œé‚£ä¸´ç•Œç‚¹æ˜¯å¤šå°‘å‘¢ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œé»˜è®¤æ˜¯ 15 æ¬¡ã€‚â€æˆ‘è¯´ï¼Œâ€œå¯ä»¥é€šè¿‡ `-Dsun.reflect.inflationThreshold` å‚æ•°ç±»è°ƒæ•´ã€‚â€

æ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ã€‚

```java
Method setAgeMethod = clazz.getMethod("setAge", int.class);
for (int i = 0;i < 20; i++) {
    setAgeMethod.invoke(object, 18);
}
```

åœ¨ `invoke()` æ–¹æ³•å¤„åŠ æ–­ç‚¹è¿›å…¥ debug æ¨¡å¼ï¼Œå½“ i = 15 çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯ç¬¬ 16 æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šè¿›å…¥åˆ° if æ¡ä»¶åˆ†æ”¯ä¸­ï¼Œæ”¹å˜ DelegatingMethodAccessorImpl çš„å§”æ´¾æ¨¡å¼ delegate ä¸º `(MethodAccessorImpl)(new MethodAccessorGenerator()).generateMethod()`ï¼Œè€Œä¹‹å‰çš„å§”æ´¾æ¨¡å¼ delegate ä¸º NativeMethodAccessorImplã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/fanshe/fanshe-04.png)

â€œè¿™ä¸‹æ˜ç™½äº†å§ï¼Ÿä¸‰å¦¹ã€‚â€æˆ‘è¯´ï¼Œâ€œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥ç†Ÿæ‚‰ä¸€ä¸‹åå°„å½“ä¸­å¸¸ç”¨çš„ APIã€‚â€

**1ï¼‰è·å–åå°„ç±»çš„ Class å¯¹è±¡**

`Class.forName()`ï¼Œå‚æ•°ä¸ºåå°„ç±»çš„å®Œå…¨é™å®šåã€‚

```java
Class c1 = Class.forName("com.itwanger.s39.ReflectionDemo3");
System.out.println(c1.getCanonicalName());

Class c2 = Class.forName("[D");
System.out.println(c2.getCanonicalName());

Class c3 = Class.forName("[[Ljava.lang.String;");
System.out.println(c3.getCanonicalName());
```

æ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœï¼š

```
com.itwanger.s39.ReflectionDemo3
double[]
java.lang.String[][]
```

ç±»å + `.class`ï¼Œåªé€‚åˆåœ¨ç¼–è¯‘å‰å°±çŸ¥é“æ“ä½œçš„ Classã€‚ã€‚

```java
Class c1 = ReflectionDemo3.class;
System.out.println(c1.getCanonicalName());

Class c2 = String.class;
System.out.println(c2.getCanonicalName());

Class c3 = int[][][].class;
System.out.println(c3.getCanonicalName());
```

æ¥çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœï¼š

```java
com.itwanger.s39.ReflectionDemo3
java.lang.String
int[][][]
```

**2ï¼‰åˆ›å»ºåå°„ç±»çš„å¯¹è±¡**

é€šè¿‡åå°„æ¥åˆ›å»ºå¯¹è±¡çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š

- ç”¨ Class å¯¹è±¡çš„ `newInstance()` æ–¹æ³•ã€‚
- ç”¨ Constructor å¯¹è±¡çš„ `newInstance()` æ–¹æ³•ã€‚

```java
Class c1 = Writer.class;
Writer writer = (Writer) c1.newInstance();

Class c2 = Class.forName("com.itwanger.s39.Writer");
Constructor constructor = c2.getConstructor();
Object object = constructor.newInstance();
```

**3ï¼‰è·å–æ„é€ æ–¹æ³•**

Class å¯¹è±¡æä¾›äº†ä»¥ä¸‹æ–¹æ³•æ¥è·å–æ„é€ æ–¹æ³• Constructor å¯¹è±¡ï¼š

- `getConstructor()`ï¼šè¿”å›åå°„ç±»çš„ç‰¹å®š public æ„é€ æ–¹æ³•ï¼Œå¯ä»¥ä¼ é€’å‚æ•°ï¼Œå‚æ•°ä¸ºæ„é€ æ–¹æ³•å‚æ•°å¯¹åº” Class å¯¹è±¡ï¼›ç¼ºçœçš„æ—¶å€™è¿”å›é»˜è®¤æ„é€ æ–¹æ³•ã€‚
- `getDeclaredConstructor()`ï¼šè¿”å›åå°„ç±»çš„ç‰¹å®šæ„é€ æ–¹æ³•ï¼Œä¸é™å®šäº public çš„ã€‚
- `getConstructors()`ï¼šè¿”å›ç±»çš„æ‰€æœ‰ public æ„é€ æ–¹æ³•ã€‚
- `getDeclaredConstructors()`ï¼šè¿”å›ç±»çš„æ‰€æœ‰æ„é€ æ–¹æ³•ï¼Œä¸é™å®šäº public çš„ã€‚

```java
Class c2 = Class.forName("com.itwanger.s39.Writer");
Constructor constructor = c2.getConstructor();

Constructor[] constructors1 = String.class.getDeclaredConstructors();
for (Constructor c : constructors1) {
    System.out.println(c);
}
```

**4ï¼‰è·å–å­—æ®µ**

å¤§ä½“ä¸Šå’Œè·å–æ„é€ æ–¹æ³•ç±»ä¼¼ï¼ŒæŠŠå…³é”®å­— Constructor æ¢æˆ Field å³å¯ã€‚

```java
Method setNameMethod = clazz.getMethod("setName", String.class);
Method getNameMethod = clazz.getMethod("getName");
```

**5ï¼‰è·å–æ–¹æ³•**

å¤§ä½“ä¸Šå’Œè·å–æ„é€ æ–¹æ³•ç±»ä¼¼ï¼ŒæŠŠå…³é”®å­— Constructor æ¢æˆ Method å³å¯ã€‚

```java
Method[] methods1 = System.class.getDeclaredMethods();
Method[] methods2 = System.class.getMethods();
```

â€œæ³¨æ„ï¼Œä¸‰å¦¹ï¼Œå¦‚æœä½ æƒ³åå°„è®¿é—®ç§æœ‰å­—æ®µå’Œï¼ˆæ„é€ ï¼‰æ–¹æ³•çš„è¯ï¼Œéœ€è¦ä½¿ç”¨ `Constructor/Field/Method.setAccessible(true)` æ¥ç»•å¼€ Java è¯­è¨€çš„è®¿é—®é™åˆ¶ã€‚â€æˆ‘è¯´ã€‚

â€œå¥½çš„ï¼ŒäºŒå“¥ã€‚è¿˜æœ‰èµ„æ–™å¯ä»¥å‚è€ƒå—ï¼Ÿâ€ä¸‰å¦¹é—®ã€‚

â€œæœ‰çš„ï¼Œæœ‰ä¸¤ç¯‡æ–‡ç« å†™å¾—éå¸¸ä¸é”™ï¼Œä½ åœ¨å­¦ä¹ åå°„çš„æ—¶å€™å¯ä»¥ä½œä¸ºå‚è€ƒã€‚â€æˆ‘è¯´ã€‚

ç¬¬ä¸€ç¯‡ï¼šæ·±å…¥ç†è§£ Java åå°„å’ŒåŠ¨æ€ä»£ç†

>é“¾æ¥ï¼š[https://dunwu.github.io/javacore/basics/java-reflection.html](https://dunwu.github.io/javacore/basics/java-reflection.html)

ç¬¬äºŒç¯‡ï¼šå¤§ç™½è¯è¯´Javaåå°„ï¼šå…¥é—¨ã€ä½¿ç”¨ã€åŸç†ï¼š

>é“¾æ¥ï¼š[https://www.cnblogs.com/chanshuyi/p/head_first_of_reflection.html](https://www.cnblogs.com/chanshuyi/p/head_first_of_reflection.html)

è¿™é‡Œç®€å•æ€»ç»“ä¸‹ã€‚

åå°„æ˜¯ Java ä¸­çš„ä¸€ä¸ªå¼ºå¤§ç‰¹æ€§ï¼Œå®ƒå…è®¸åœ¨è¿è¡Œæ—¶æ£€æŸ¥å’Œæ“ä½œ[ç±»](https://tobebetterjavaer.com/oo/object-class.html)ã€[æ¥å£](https://tobebetterjavaer.com/oo/interface.html)ã€[å­—æ®µ](https://tobebetterjavaer.com/oo/var.html)å’Œ[æ–¹æ³•](https://tobebetterjavaer.com/oo/method.html)ã€‚åå°„æ˜¯ Java çš„æ ¸å¿ƒç»„ä»¶ï¼Œæ”¯æŒå„ç§æ¡†æ¶å’Œåº“çš„å®ç°ï¼Œå¦‚ Springã€Hibernate ç­‰ã€‚ä½¿ç”¨åå°„ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åˆ›å»ºå¯¹è±¡ã€è°ƒç”¨æ–¹æ³•å’Œè®¿é—®å­—æ®µï¼Œè€Œæ— éœ€åœ¨ç¼–è¯‘æ—¶äº†è§£è¿™äº›å¯¹è±¡çš„å…·ä½“å®ç°ã€‚

åå°„çš„ä¸»è¦ç±»ä½äº `java.lang.reflect` åŒ…ä¸­ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªå…³é”®ç±»ï¼š

- Classï¼šä»£è¡¨ä¸€ä¸ªç±»æˆ–æ¥å£ï¼ŒåŒ…å«äº†ç±»çš„ç»“æ„ä¿¡æ¯ï¼ˆå¦‚åç§°ã€æ„é€ å‡½æ•°ã€æ–¹æ³•ã€å­—æ®µç­‰ï¼‰ã€‚é€šè¿‡ Class å¯¹è±¡ï¼Œå¯ä»¥è·å–ç±»çš„å…ƒæ•°æ®å¹¶æ“ä½œç±»çš„å®ä¾‹ã€‚
- Constructorï¼šä»£è¡¨ç±»çš„[æ„é€ æ–¹æ³•](https://tobebetterjavaer.com/oo/construct.html)ï¼Œç”¨äºåˆ›å»ºç±»çš„å®ä¾‹ã€‚
- Methodï¼šä»£è¡¨ç±»çš„æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡å®ƒè°ƒç”¨ç±»çš„å®ä¾‹æ–¹æ³•ã€‚
- Fieldï¼šä»£è¡¨ç±»çš„å­—æ®µï¼Œå¯ä»¥è·å–æˆ–ä¿®æ”¹å­—æ®µçš„å€¼ã€‚
- Modifierï¼šåŒ…å«æ–¹æ³•ã€å­—æ®µå’Œç±»çš„[è®¿é—®ä¿®é¥°ç¬¦ï¼ˆå¦‚ publicã€private ç­‰ï¼‰](https://tobebetterjavaer.com/oo/access-control.html)ã€‚

ä½¿ç”¨åå°„æ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

- æ€§èƒ½ï¼šåå°„æ“ä½œé€šå¸¸æ¯”ç›´æ¥æ“ä½œå¯¹è±¡çš„æ–¹æ³•å’Œå­—æ®µæ…¢ï¼Œå› ä¸ºæ¶‰åŠåˆ°é¢å¤–çš„é—´æ¥è°ƒç”¨å’ŒåŠ¨æ€è§£æã€‚å› æ­¤ï¼Œåœ¨å…³æ³¨æ€§èƒ½çš„åœºæ™¯ä¸­ï¼Œæ…ç”¨åå°„ã€‚
- å®‰å…¨æ€§ï¼šé€šè¿‡åå°„ï¼Œå¯ä»¥è®¿é—®å’Œæ“ä½œç±»çš„ç§æœ‰å­—æ®µå’Œæ–¹æ³•ï¼Œè¿™å¯èƒ½å¯¼è‡´å®‰å…¨é—®é¢˜ã€‚å› æ­¤ï¼Œä½¿ç”¨åå°„æ—¶è¦ç¡®ä¿ä»£ç çš„å®‰å…¨æ€§ã€‚
- ç»´æŠ¤æ€§ï¼šåå°„ä½¿ä»£ç å˜å¾—æ›´åŠ å¤æ‚ï¼Œå¯èƒ½å¯¼è‡´éš¾ä»¥ç»´æŠ¤ã€‚åœ¨ä½¿ç”¨åå°„æ—¶è¦ç¡®ä¿ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

å°½ç®¡åå°„å­˜åœ¨ä¸Šè¿°é—®é¢˜ï¼Œä½†åœ¨æŸäº›åœºæ™¯ä¸‹ï¼ˆå¦‚æ¡†æ¶å¼€å‘ã€åŠ¨æ€ä»£ç†ç­‰ï¼‰ï¼Œå®ƒä»ç„¶æ˜¯éå¸¸æœ‰ç”¨çš„å·¥å…·ã€‚

æ¥ä¸€ä¸ªå®Œæ•´çš„ demo ç¤ºä¾‹å§ã€‚

```java
class Person {
    private String name;
    private int age;

    public Person() {
    }

    public Person(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }

    private void privateMethod() {
        System.out.println("ç§æœ‰æ–¹æ³•");
    }
}

public class ReflectionDemo {
    public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException,
            IllegalAccessException, InvocationTargetException, InstantiationException, NoSuchFieldException {
        // è·å– Person ç±»çš„ Class å¯¹è±¡
        Class<?> personClass = Class.forName("com.github.paicoding.forum.test.javabetter.importance.Person");

        // è·å–å¹¶æ‰“å°ç±»å
        System.out.println("ç±»å: " + personClass.getName());

        // è·å–æ„é€ å‡½æ•°
        Constructor<?> constructor = personClass.getConstructor(String.class, int.class);

        // ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»º Person å¯¹è±¡å®ä¾‹
        Object personInstance = constructor.newInstance("æ²‰é»˜ç‹äºŒ", 30);

        // è·å–å¹¶è°ƒç”¨ getName æ–¹æ³•
        Method getNameMethod = personClass.getMethod("getName");
        String name = (String) getNameMethod.invoke(personInstance);
        System.out.println("åå­—: " + name);

        // è·å–å¹¶è°ƒç”¨ setAge æ–¹æ³•
        Method setAgeMethod = personClass.getMethod("setAge", int.class);
        setAgeMethod.invoke(personInstance, 35);

        // è·å–å¹¶è®¿é—® age å­—æ®µ
        Field ageField = personClass.getDeclaredField("age");
        ageField.setAccessible(true);
        int age = ageField.getInt(personInstance);
        System.out.println("å¹´çºª: " + age);

        // è·å–å¹¶è°ƒç”¨ç§æœ‰æ–¹æ³•
        Method privateMethod = personClass.getDeclaredMethod("privateMethod");
        privateMethod.setAccessible(true);
        privateMethod.invoke(personInstance);
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆé€šè¿‡ `Class.forName()` æ–¹æ³•è·å– Person ç±»çš„ Class å¯¹è±¡ã€‚æ¥ç€ï¼Œæˆ‘ä»¬è·å–äº† Person ç±»çš„æ„é€ æ–¹æ³•ã€æ–¹æ³•å’Œå­—æ®µï¼Œå¹¶ä½¿ç”¨è¿™äº›åå°„å¯¹è±¡æ¥åˆ›å»ºå®ä¾‹ã€è°ƒç”¨æ–¹æ³•å’Œè®¿é—®å­—æ®µã€‚æ³¨æ„ï¼Œåœ¨è®¿é—®ç§æœ‰æ–¹æ³•å’Œå­—æ®µæ—¶ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨ `setAccessible(true)` æ–¹æ³•æ¥å…è®¸è®¿é—®ã€‚

â€œå¥½äº†ï¼Œä¸‰å¦¹ï¼Œå…³äºåå°„ï¼Œå°±å…ˆè®²åˆ°è¿™é‡Œå§ã€‚â€

----

GitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„å¼€æºçŸ¥è¯†åº“ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://github.com/itwanger/toBeBetterJavaer)ã€‹ç¬¬ä¸€ç‰ˆ PDF ç»ˆäºæ¥äº†ï¼åŒ…æ‹¬JavaåŸºç¡€è¯­æ³•ã€æ•°ç»„&å­—ç¬¦ä¸²ã€OOPã€é›†åˆæ¡†æ¶ã€Java IOã€å¼‚å¸¸å¤„ç†ã€Java æ–°ç‰¹æ€§ã€ç½‘ç»œç¼–ç¨‹ã€NIOã€å¹¶å‘ç¼–ç¨‹ã€JVMç­‰ç­‰ï¼Œå…±è®¡ 32 ä¸‡ä½™å­—ï¼Œå¯ä»¥è¯´æ˜¯é€šä¿—æ˜“æ‡‚ã€é£è¶£å¹½é»˜â€¦â€¦è¯¦æƒ…æˆ³ï¼š[å¤ªèµäº†ï¼ŒGitHub ä¸Šæ ‡æ˜Ÿ 7600+ çš„ Java æ•™ç¨‹](https://tobebetterjavaer.com/overview/)

å¾®ä¿¡æœ **æ²‰é»˜ç‹äºŒ** æˆ–æ‰«æä¸‹æ–¹äºŒç»´ç å…³æ³¨äºŒå“¥çš„åŸåˆ›å…¬ä¼—å·æ²‰é»˜ç‹äºŒï¼Œå›å¤ **222** å³å¯å…è´¹é¢†å–ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)


# ç¬¬åå››ç« ï¼šJavaå¹¶å‘ç¼–ç¨‹

é™äºã€ŠäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ã€‹.pdf ç¯‡å¹…çš„åŸå› ï¼Œç›®å‰å·²ç» 32 ä½™ä¸‡å­—ï¼Œæˆ‘ 32G å†…å­˜çš„ç”µè„‘ï¼Œæ¯æ¬¡æƒ³æ›´æ–°è¿™ä»½å°å†Œï¼Œéƒ½å—¡å—¡å—¡ç›´å«çš„å‰å®³ï¼æ‰€ä»¥ Java å¹¶å‘ç¼–ç¨‹çš„ PDF æš‚æ—¶åªå¯¹ã€Š[äºŒå“¥çš„ç¼–ç¨‹æ˜Ÿçƒï¼ˆæˆ³é“¾æ¥æœ‰ä¼˜æƒ åˆ¸ï¼‰](https://tobebetterjavaer.com/zhishixingqiu/)ã€‹ç”¨æˆ·å¼€æ”¾ï¼Œå¦‚æœä½ éœ€è¦è¿™ä»½ PDF å¹¶ä¸”æƒ³äº«å—æ›´å¤šæœåŠ¡çš„è¯ï¼Œå¯ä»¥æ‰«ç åŠ å…¥ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/thread-20230410210802.png)

ä¸€å¥è¯ä»‹ç»ä¸€ä¸‹äºŒå“¥çš„ç¼–ç¨‹æ˜Ÿçƒï¼Œè¿™æ˜¯ä¸€ä¸ªç¼–ç¨‹å­¦ä¹ æŒ‡å— + Javaé¡¹ç›®å®æˆ˜ + LeetCode åˆ·é¢˜çš„ç§å¯†åœˆå­ï¼Œä½ å¯ä»¥é˜…è¯»æ˜Ÿçƒä¸“æ ã€å‘äºŒå“¥æé—®ã€å¸®ä½ åˆ¶å®šå­¦ä¹ è®¡åˆ’ã€å’Œçƒå‹ä¸€èµ·æ‰“å¡æˆé•¿ã€‚è¿™æ˜¯ PDF çš„å¤§è‡´å†…å®¹ï¼Œæƒ³è¦åŠ å…¥æ˜Ÿçƒçš„ç”¨æˆ·ï¼Œå¯ä»¥æå‰æ„Ÿå—ä¸€ä¸‹ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/thread-20230410211343.png)

å¦‚æœä½ ä¸æƒ³ä»˜è´¹ï¼Œä¹Ÿæ²¡å…³ç³»ï¼Œä½ å®Œå…¨å¯ä»¥åˆ°ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://tobebetterjavaer.com/home.html)ã€‹ç½‘ç«™æŸ¥çœ‹å¹¶å‘ç¼–ç¨‹æ¿å—ï¼Œå†…å®¹è™½ç„¶ä¸åŒï¼Œä½†è´¨é‡ä¹Ÿæ˜¯å®Œå…¨æœ‰ä¿éšœã€‚

ä¼—æ‰€å‘¨çŸ¥ï¼ŒJava å¹¶å‘æ˜¯ Java ç¨‹åºå‘˜å¿…é¡»æ‡‚ä½†åˆå¾ˆéš¾æ‡‚çš„ä¸€å—çŸ¥è¯†ç‚¹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¾ˆå°‘æœ‰äººæ•¢è¯´è‡ªå·±ç²¾é€š Java å¹¶å‘çš„ï¼Œä¸€æ˜¯å®¹æ˜“è¢«é¢è¯•å®˜åŠæ‰“ï¼ŒäºŒæ˜¯å¹¶å‘ç¼–ç¨‹æ¶‰åŠåˆ°æ“ä½œç³»ç»Ÿã€å†…å­˜ã€CPU ç­‰è®¡ç®—æœºä¸“ä¸šæ¯”è¾ƒæ ¸å¿ƒçš„å†…å®¹ï¼Œæ¯”è¾ƒè€ƒéªŒä¸€ä¸ªç¨‹åºå‘˜çš„å†…åŠŸã€‚

è¿™é‡Œå°±é¡ºå¸¦ç»™ä½ ç›˜ç‚¹ä¸€ä¸‹ Java å¹¶å‘åˆ°åº•è¯¥å¦‚ä½•ä»å…¥é—¨åˆ°ç²¾é€šï¼Œè¯·åŠæ—¶ç”¨é¸¡æ¯›æ¸å­æŠŠæ”¶è—å¤¹é‡Œçš„ç°æ¸…ç†ä¸€ä¸‹ã€‚åœ¨é˜…è¯»è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰æ‰€å¸®åŠ©ï¼Œéº»çƒ¦é»˜é»˜æ”¶è—å’Œä¸»åŠ¨è½¬å‘ï¼Œç®—æ˜¯å¯¹æˆ‘ç å­—çš„è¿™ä»½åšæŒçš„äº¿ç‚¹ç‚¹é¼“åŠ±ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xuexiluxian/java-thread-1.gif)


## ä¸€ã€ä¸ºä»€ä¹ˆè¦å­¦ Java å¹¶å‘ï¼Ÿ

æœ‰å¥è¯ä¸çŸ¥é“å½“è®²ä¸å½“è®²ï¼Œå…ˆè®²äº†å†è¯´ï¼Œå°±æ˜¯â€œå¦‚æœä½ åªæƒ³ CURDï¼Œé‚£ä¹ˆ Java å¹¶å‘ä¸å­¦ä¹Ÿç½¢ï¼â€ä½†å…¶å®å‘¢ï¼Œå¤§å®¶éƒ½å·²ç»è¢«æ•™è‚²çš„å¾ˆæœ‰æ¶µå…»äº†ï¼Œå·¥ä½œä¸­æ‹§ä¸æ‹§èºä¸ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯é¢è¯•ä¸€å®šè¦ä¼šé€ ç«ç®­ï¼Œä¸ç„¶é¢è¯•çš„æœºä¼šéƒ½å¾ˆéš¾æå¾—åˆ°ã€‚

é‚£ä½œä¸º Java ä½“ç³»ä¸­éå¸¸é‡è¦çš„ä¸€ç¯ï¼ŒJava å¹¶å‘è‡ªç„¶æ˜¯å¿…é¡»è¦æŒæ¡çš„ï¼Œæœ€èµ·ç ä¹Ÿå¾—ä¼šèµ·ä¸ªå¤šçº¿ç¨‹å§ï¼Ÿå“ˆå“ˆå“ˆã€‚é«˜çº§ç‚¹çš„ï¼Œåƒå¹³å¸¸å¼€å‘ä¸­ç”¨åˆ°çš„ Tomcat æœåŠ¡å™¨ã€æ¶ˆæ¯ä¸­é—´ä»¶ã€RPC æ¡†æ¶ç­‰ç­‰ï¼Œå®ƒä»¬çš„åº•å±‚éƒ½æ¶‰åŠåˆ°äº†å¹¶å‘ç¼–ç¨‹ã€‚

å½“ç„¶äº†ï¼ŒJava å¹¶å‘æ¶‰åŠåˆ°ä¸œè¥¿å®åœ¨æ˜¯ä¸å°‘ï¼ŒåŒ…æ‹¬æ“ä½œç³»ç»Ÿçš„çŸ¥è¯†ï¼ŒJava è™šæ‹Ÿæœºçš„ä¸€äº›çŸ¥è¯†ï¼ŒJava çº¿ç¨‹æ¨¡å‹çš„çŸ¥è¯†ï¼Œå¤šçº¿ç¨‹ç›¸å…³çš„å…³é”®å­—ï¼Œæ¯”å¦‚è¯´ synchronizedã€volatile ç­‰ï¼Œè¿˜æœ‰é”çš„çŸ¥è¯†ã€JDK æä¾›çš„å·¥å…·ç±»ç­‰ç­‰ï¼Œå­¦èµ·æ¥è¿˜æ˜¯éå¸¸å®¹æ˜“ä»¤äººå¤´å¤§çš„ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xuexiluxian/java-thread-2.png)

å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›é«˜æ•ˆçš„å­¦ä¹ è·¯çº¿å›¾ï¼Œä»¥åŠä¸€äº›ä¼˜è´¨çš„å­¦ä¹ èµ„æºï¼Œä»è€Œå‡å°‘æˆ‘ä»¬å­¦ä¹ Java å¹¶å‘ç¼–ç¨‹æ‰€æŠ•å…¥çš„æ—¶é—´å’Œç²¾åŠ›ã€‚

## äºŒã€Java å¹¶å‘å­¦ä¹ è·¯çº¿å›¾

è¿™æ˜¯æˆ‘æœ€è¿‘æ•´ç†çš„ä¸€å¼ å…³äº Java å¹¶å‘ç¼–ç¨‹çš„æ€ç»´å¯¼å›¾ï¼Œå¤§çš„æ–¹å‘å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šçº¿ç¨‹åŸºç¡€ã€ç†è®ºåŸºç¡€ã€å·¥å…·ç±» JUCã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xuexiluxian/java-thread-map.png)

çº¿ç¨‹åŸºç¡€éƒ¨åˆ†åŒ…æ‹¬ï¼š

- çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼
- çº¿ç¨‹çš„çŠ¶æ€åˆ‡æ¢
- çº¿ç¨‹çš„åŸºæœ¬æ“ä½œ
- çº¿ç¨‹ç»„å’Œçº¿ç¨‹ä¼˜å…ˆçº§

ç†è®ºåŸºç¡€åŒ…æ‹¬ï¼š

- è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«
- å¤šçº¿ç¨‹è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œåˆå¸¦æ¥äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ
- å¦‚ä½•è§£å†³å¹¶å‘é—®é¢˜ï¼ŸåŒ…æ‹¬ Java å†…å­˜æ¨¡å‹ï¼Œä»¥åŠä¸¤ä¸ªå¸¸è§çš„å…³é”®å­— volatile å’Œ synchronized

å·¥å…·ç±» JUC åŒ…æ‹¬ï¼š

- é” Lock ç³»çš„ AQSã€ReentrantLockã€ReentrantReadWriteLockã€Conditionã€LockSupport
- å¹¶å‘å®¹å™¨ç³»çš„ ConcurrentHashMapã€ConcurrentLinkedQueueã€CopyOnWriteArrayListã€ThreadLocalã€BlockingQueue
- çº¿ç¨‹æ± ç³»çš„ ThreadPoolExecutorã€ScheduledThreadPoolExecutor
- åŸå­ç³»çš„ AtomicIntegerã€AtomicIntegerArrayã€AtomicReference ç­‰ç­‰
- é€šä¿¡å·¥å…·ç³»çš„å€’è®¡æ—¶å™¨ CountDownLatchã€å¾ªç¯æ …æ  CyclicBarrierã€èµ„æºè®¿é—®æ§åˆ¶ Semaphoreã€æ•°æ®äº¤æ¢ Exchangerã€ç§»ç›¸å™¨Phaser
- Fork/Joinæ¡†æ¶

æœ€åå†æ¥ä¸ªç»å…¸çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼è¿›è¡Œå®è·µï¼Œæ•´ä¸ª Java å¹¶å‘ä½“ç³»å°±å­¦å¾—éå¸¸æ‰å®äº†ï¼

## ä¸‰ã€ç¡¬æ ¸ Java å¹¶å‘å­¦ä¹ èµ„æ–™

### **1ï¼‰Javaè¿›é˜¶ä¹‹è·¯**

å­¦ Javaï¼Œå½“ç„¶è¦æ‰¾äºŒå“¥çš„Javaè¿›é˜¶ä¹‹è·¯ï¼Œç½‘å€æˆ‘è´´ä¸‹é¢äº†å“ˆï¼š

>[https://tobebetterjavaer.com/home.html](https://tobebetterjavaer.com/home.html)

è¿›å»ç›´æ¥æ‰¾ Java æ ¸å¿ƒé‡Œé¢çš„ Java å¹¶å‘ç¼–ç¨‹å°±å¯¹äº†ã€‚æˆ‘æŒ‰ç…§å‰é¢çš„æ€ç»´å¯¼å›¾æ•´ç†äº† 29 ç¯‡æ–‡ç« ï¼Œå…¨éƒ¨éƒ½æ˜¯ç¡¬æ ¸çº§åˆ«çš„ï¼Œè·Ÿç€å­¦å°±å¯¹äº†ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/thread-20230410204505.png)

### **2ï¼‰è§†é¢‘**

æ‡‚çš„éƒ½æ‡‚ï¼Œçœ‹è§†é¢‘åˆ° B ç«™ã€‚é»‘é©¬çš„ã€ŠJavaå¹¶å‘ç¼–ç¨‹ã€‹è¯„ä»·è¿˜ä¸é”™ï¼Œ300 å¤šä¸ªå°èŠ‚ï¼Œæˆ‘è§‰å¾—è®²çš„æ¯”è¾ƒå¥½çš„æœ‰ä¸‰éƒ¨åˆ†ï¼šsynchronizedä¼˜åŒ–åŸç†ã€AQSå’Œçº¿ç¨‹æ± ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xuexiluxian/java-thread-4.png)

>è§†é¢‘åœ°å€ï¼š[https://www.bilibili.com/video/BV16J411h7Rd](https://www.bilibili.com/video/BV16J411h7Rd)

è¿˜æœ‰å°šç¡…è°·å®‹çº¢åº·è€å¸ˆè®²çš„è¿™ä¸ªè§†é¢‘ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/thread-20230406095805.png)

>è§†é¢‘åœ°å€ï¼š[https://www.bilibili.com/video/BV1Kw411Z7dF/](https://www.bilibili.com/video/BV1Kw411Z7dF/)

### **3ï¼‰ä¹¦ç±**

çº¸è´¨ä¹¦åªæ¨èä¸€æœ¬ã€Š[Java å¹¶å‘ç¼–ç¨‹å®æˆ˜](https://book.douban.com/subject/10484692/)ã€‹ï¼Œè±†ç“£è¯„åˆ† 9.0ã€‚ä¸è¿‡è¿™æœ¬ä¹¦ç¡®å®æœ‰ç‚¹è€äº†ï¼ŒåŸºæœ¬ä¸Šæ˜¯æŒ‰ç…§ Java 6 æ¥è®²è§£çš„ï¼Œå¸Œæœ›å‡ºç‰ˆç¤¾èƒ½æ—©ç‚¹å‡º 2.0 ç‰ˆã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xuexiluxian/java-thread-5.png)

ã€ŠJava å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹è¿™æœ¬ä¹¦ä»æ€»ä½“ä¸Šæ¥çœ‹ï¼Œåˆ†ä¸¤æ¡ä¸»çº¿ï¼š

- ä»‹ç» Java å¹¶å‘åŒ…çš„é‡è¦ç»„ä»¶å’ŒåŸç†
- å¦‚ä½•åˆ©ç”¨è¿™äº›ç»„ä»¶æ¥ä¿è¯çº¿ç¨‹å®‰å…¨

åˆ°åº•è¯¥å¦‚ä½•è·å¾—çº¿ç¨‹å®‰å…¨å‘¢ï¼ŸèƒŒä¼šå¹¶ç†è§£ä¸‹é¢è¿™æ®µè¯ï¼š

>Writing thread-safe code is, at its core, about managing access to state, and in particular to shared, mutable state.

å¦‚æœå‘ç°ä¸æ˜¯å¾ˆå¥½æ‡‚ï¼Œæƒ³ä»å›½å†…ä½œè€…ä¸‹æ‰‹çš„è¯ï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹ã€Š[Javaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯](https://book.douban.com/subject/26591326/)ã€‹å’Œã€Š[å›¾è§£Javaå¹¶å‘ç¼–ç¨‹](https://book.douban.com/subject/35634953/)ã€‹è¿™ä¸¤æœ¬ä¹¦ï¼Œè™½ç„¶è±†ç“£ä¸Šè¯„åˆ†ä¸€èˆ¬ï¼Œä½†å¯¹äºæ„å»º Java å¹¶å‘çš„çŸ¥è¯†ä½“ç³»è¿˜æ˜¯æœ‰å¾ˆå¤§å¸®åŠ©çš„ã€‚

ä¹‹åï¼Œå†å»å•ƒã€ŠJava å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹å°±ä¼šå‘ç°æ²¡æœ‰ä»¥å‰é‚£ä¹ˆè´¹åŠ²äº†ï¼Œè¿™æœ¬ä¹¦ä¹‹æ‰€ä»¥è¢«èª‰ä¸º Java å¹¶å‘ç¼–ç¨‹çš„åœ£ç»ï¼Œç¡®å®å¯ä»¥çœ‹å¾—å‡ºä½œè€…åœ¨å¹¶å‘ç¼–ç¨‹æ–¹é¢æœ‰ç€ä¸°å¯Œçš„ç»éªŒã€‚

### **4ï¼‰å¼€æºç”µå­ä¹¦**

æ¨è RedSpiderç¤¾åŒºçš„[æ·±å…¥æµ…å‡º Java å¤šçº¿ç¨‹](http://concurrent.redspider.group/RedSpider.html)ï¼Œæ¯”Java å¹¶å‘ç¼–ç¨‹å®æˆ˜æ›´é€šä¿—æ˜“æ‡‚ä¸€äº›ï¼Œå› ä¸ºé‡Œé¢ç©¿æ’äº†å¾ˆå¤šç²¾ç¾çš„æ‰‹ç»˜å›¾ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xuexiluxian/java-thread-6.png)

>GitHubåœ°å€ï¼š[https://github.com/RedSpider1/concurrent](https://github.com/RedSpider1/concurrent)

è€ƒè™‘åˆ°æœ‰äº›å°ä¼™ä¼´å¯èƒ½éœ€è¦ [PDF ç‰ˆæœ¬](https://tobebetterjavaer.com/pdf/java-concurrent.html)ï¼Œæˆ‘èŠ±äº†ä¸€å‘¨çš„æ—¶é—´æ•´ç†äº†ä¸€ä»½ï¼Œéœ€è¦çš„å°ä¼™ä¼´è¯·æ‰«æä¸‹æ–¹çš„äºŒç»´ç å…³æ³¨ä½œè€…çš„åŸåˆ›å…¬ä¼—å·ã€Œ**æ²‰é»˜ç‹äºŒ**ã€å›å¤å…³é”®å­—ã€Œ**å¹¶å‘**ã€å°±å¯ä»¥æ‹‰å–åˆ°äº†ã€‚

![æ‰«ç å…³æ³¨åå›å¤ã€Œå¹¶å‘ã€å…³é”®å­—](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

å†æ¨èä¸€ä»½ GitHub ä¸Šæ˜Ÿæ ‡ 3.6k+ çš„ Java å¹¶å‘çŸ¥è¯†ç‚¹æ€»ç»“ï¼š

>[https://github.com/CL0610/Java-concurrency](https://github.com/CL0610/Java-concurrency)

ä»“åº“é‡Œæœ‰ä¸€å¥è¯æˆ‘éå¸¸å–œæ¬¢ï¼Œä¹Ÿåˆ†äº«ç»™å„ä½å°ä¼™ä¼´ï¼š

>åŠªåŠ›çš„æ„ä¹‰ï¼Œå°±æ˜¯ï¼Œåœ¨ä»¥åçš„æ—¥å­é‡Œï¼Œæ”¾çœ¼æœ›å»å…¨æ˜¯è‡ªå·±å–œæ¬¢çš„äººå’Œäº‹ï¼


### **5ï¼‰ä»˜è´¹ä¸“æ **

ç‹å®ä»¤è€å¸ˆåœ¨æå®¢æ—¶é—´ä¸Šå¼€äº†ä¸€é—¨ã€ŠJava å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹çš„ä»˜è´¹ä¸“æ ï¼Œè´¨é‡è¿˜æ˜¯æŒºé«˜çš„ï¼Œå–œæ¬¢çš„å°ä¼™ä¼´å¯ä»¥æˆ³[é“¾æ¥](http://gk.link/a/11cBH)å»è´­ä¹°ã€‚

<a href="http://gk.link/a/11cBH" target="_blank">
<img src="https://cdn.tobebetterjavaer.com/stutymore/thread-20230410204829.png" />
</a>


## å››ã€ä¼˜è´¨å…«è‚¡æ–‡

è¿™é‡Œç»™å¤§å®¶æ¨èä¸¤ä»½ Java å¹¶å‘ç¼–ç¨‹æ–¹é¢çš„å…«è‚¡æ–‡ï¼Œä¸€ä»½æ¥è‡ª[ä¸‰åˆ†æ¶æ»´æ»´çš„é¢æ¸£é€†è¢­](https://tobebetterjavaer.com/sidebar/sanfene/javathread.html)ï¼Œä¸€ä»½æ¥è‡ªå°ç‰›ï¼Œå…ˆæˆªå›¾ç»™å¤§å®¶çœ‹ä¸€ä¸‹ Java å¹¶å‘æ–¹é¢éƒ½æœ‰å“ªäº›é«˜é¢‘çš„é¢è¯•é¢˜ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xuexiluxian/java-thread-7.png)

ä¸ºäº†æ–¹ä¾¿å¤§å®¶çš„é˜…è¯»å’ŒèƒŒè¯µï¼Œæˆ‘å·²ç»å°†å…¶æ•´ç†åˆ°äº†äºŒå“¥çš„å°ç ´ç«™ã€ŠJavaè¿›é˜¶ä¹‹è·¯ã€‹ä¸Šï¼Œé¢æ¸£é€†è¢­ Java å¹¶å‘ç¯‡ï¼š

>[https://tobebetterjavaer.com/sidebar/sanfene/javathread.html](https://tobebetterjavaer.com/sidebar/sanfene/javathread.html)

Java å¹¶å‘ç¼–ç¨‹å…«è‚¡æ–‡ï¼ˆèƒŒè¯µç‰ˆï¼‰ï¼š

>[https://tobebetterjavaer.com/baguwen/java-thread.html](https://tobebetterjavaer.com/baguwen/java-thread.html)

è¿™ä¸¤ä»½å…«è‚¡æ–‡çš„è´¨é‡éƒ½éå¸¸é«˜ï¼Œæ¥çœ‹ä¸€ä¸‹AQSäº†è§£å¤šå°‘å°èŠ‚ä¸‹çš„å†…å®¹ï¼Œå›¾æ–‡å¹¶èŒ‚ï¼Œéå¸¸å®¹æ˜“æ¶ˆåŒ–å’Œå¸æ”¶ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xuexiluxian/java-thread-8.png)

è¯šå®ç‚¹è¯´ï¼Œå¦‚æœèƒ½æŠŠè¿™ä¸¤ä»½å…«è‚¡æ–‡èƒŒä¼šçš„è¯ï¼Œç®€å†ä¸Šå°±çœŸçš„æ•¢å†™â€œç²¾é€šâ€Java å¹¶å‘äº†ã€‚

## äº”ã€Java å¹¶å‘å­¦ä¹ å¿ƒå¾—

Java æä¾›çš„å¹¶å‘ç»„ä»¶ï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š

- ä»é¢„é˜²é˜¶æ®µä¸‹æ‰‹ï¼Œé˜²æ­¢é”™è¯¯å‘ç”Ÿï¼Œæ¯”å¦‚è¯´ synchronized å…³é”®å­—
- ä¸€æ—¦å‘ç”Ÿé”™è¯¯èƒ½åŠæ—¶é‡è¯•ï¼Œæ¯”å¦‚è¯´ CAS

å¯¹äºçº¿ç¨‹æ•°é‡æ¯”è¾ƒå¤šçš„å¹¶å‘åœºæ™¯ï¼Œé‡‡ç”¨é¢„é˜²çš„æªæ–½ä¼šæ¯”è¾ƒåˆç†ï¼Œè¿™æ ·å¤§éƒ¨åˆ†çº¿ç¨‹å°±ä¸ä¼šå› ä¸ºå°æ¦‚ç‡æ—¶é—´çš„ CAS é‡è¯•æµªè´¹æ‰å¤§é‡çš„ CPU å‘¨æœŸï¼›åœ¨çº¿ç¨‹æ•°é‡å°çš„æ—¶å€™ï¼ŒCAS çš„æ„ä¹‰å°±æ¯”è¾ƒå¤§ï¼Œå› ä¸ºé¢„é˜²æªæ–½å¸¦æ¥çš„çº¿ç¨‹åˆ‡æ¢è¦æ¯” CAS ç­‰å¾…çš„å¼€é”€æ›´å¤§ã€‚

æƒ³è¦å­¦å¥½ Java å¹¶å‘ç¼–ç¨‹ï¼Œå°±å¿…é¡»å¾—å¯¹ä¸‹å›¾ä¸­æåˆ°çš„åŸºç¡€æ¦‚å¿µè¿›è¡Œå……åˆ†çš„ç†è§£ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xuexiluxian/java-thread-9.jpg)

åœ¨æˆ‘çœ‹æ¥ï¼Œå¹¶å‘ç¼–ç¨‹ä¸»è¦æ˜¯ç”¨æ¥è§£å†³è¿™ä¸¤ä¸ªç—›ç‚¹çš„ï¼š

- å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€å˜é‡é€ æˆçš„ä¸ä¸€è‡´é—®é¢˜ï¼›
- ä¸ºæé«˜æ€§èƒ½ï¼Œè®¡ç®—æœºçš„å¾ˆå¤šæ‰§è¡Œå•å…ƒéƒ½é…å¤‡äº†ç¼“å­˜ï¼Œé‚£åŠ¿å¿…ä¼šå½±å“å¹¶å‘ç¼–ç¨‹çš„æ•°æ®ä¸€è‡´æ€§ã€‚

éœ€è¦æé†’ä¸€ç‚¹çš„æ˜¯ï¼Œå¤šçº¿ç¨‹å¹¶å‘è™½ç„¶æ˜¯ç”¨æ¥è§£å†³æ€§èƒ½é—®é¢˜çš„ï¼Œä½†å¹¶ä¸æ„å‘³ç€æ‰€æœ‰æƒ…å†µä¸‹éƒ½éœ€è¦å¼€å¯å¤šçº¿ç¨‹ï¼Œæœ‰æ—¶å€™åè€Œä¼šé€‚å¾—å…¶åï¼Œé‚£å¦‚æœä¸æ˜¯ç‰¹åˆ«è¦æ±‚ï¼Œå°½é‡ä¸è¦è¿‡æ—©å¼€å¯å¤šçº¿ç¨‹ã€‚

å¹¶å‘ç¼–ç¨‹æ˜¯ Java ä½“ç³»å½“ä¸­ç›¸å¯¹éš¾æŒæ¡çš„ä¸€å—çŸ¥è¯†ç‚¹ï¼Œæ¯”è¾ƒè€ƒéªŒä¸€åç¨‹åºå‘˜çš„å†…åŠŸï¼Œå…¶å®å¹¶å‘ç¼–ç¨‹æœ€æ—©çš„åº”ç”¨é¢†åŸŸå°±æ˜¯æ“ä½œç³»ç»Ÿçš„å®ç°ã€‚

å¦‚æœä½ å·²ç»æœ‰ä¸€å®šçš„ç¼–ç¨‹ç»éªŒï¼Œå»ºè®®å…ˆå­¦ä¸€ä¸‹ã€Šè®¡ç®—æœºç»„æˆåŸç†ã€‹ï¼Œå¯¹æ“ä½œç³»ç»Ÿã€å†…å­˜ã€CPU å…ˆè¿›è¡Œä¸€äº›å¤§è‡´çš„äº†è§£ï¼Œç„¶åå†æ¥å­¦ä¹  Java å¹¶å‘ç¼–ç¨‹ï¼Œå¯èƒ½å°±ä¼šæ„Ÿè§‰èˆ’æœå¤šäº†ï¼

ç»“åˆæˆ‘å¤šå¹´çš„å·¥ä½œç»éªŒæ¥çœ‹ï¼Œå¹¶å‘ç¼–ç¨‹å¯ä»¥æŠ½è±¡æˆ**ä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜ï¼šåˆ†å·¥ã€åŒæ­¥å’Œäº’æ–¥**ã€‚

1ï¼‰åˆ†å·¥

åˆ†å·¥æŒ‡çš„æ˜¯å¦‚ä½•é«˜æ•ˆåœ°æ‹†è§£ä»»åŠ¡å¹¶åˆ†é…ç»™çº¿ç¨‹ï¼Œåƒå¹¶å‘ç¼–ç¨‹é¢†åŸŸçš„ä¸€äº›è®¾è®¡æ¨¡å¼ï¼Œæ¯”å¦‚è¯´ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…å°±æ˜¯ç”¨æ¥è¿›è¡Œåˆ†å·¥çš„ã€‚

2ï¼‰åŒæ­¥

åŒæ­¥æŒ‡çš„æ˜¯çº¿ç¨‹ä¹‹é—´å¦‚ä½•åä½œï¼Œä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œäº†ä¸€ä¸ªä»»åŠ¡ï¼Œè¦é€šçŸ¥å¦å¤–ä¸€ä¸ªçº¿ç¨‹å¼€å·¥ã€‚è¿˜æ‹¿ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹æ¥è¯´å§ï¼Œå½“é˜Ÿåˆ—æ»¡çš„æ—¶å€™ï¼Œç”Ÿäº§è€…çº¿ç¨‹ç­‰å¾…ï¼Œå½“é˜Ÿåˆ—ä¸æ»¡çš„æ—¶å€™ï¼Œç”Ÿäº§è€…çº¿ç¨‹éœ€è¦è¢«å”¤é†’é‡æ–°æ‰§è¡Œï¼›å½“é˜Ÿåˆ—ç©ºçš„æ—¶å€™ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹å¼€å§‹ç­‰å¾…ï¼Œä¸ç©ºçš„æ—¶å€™ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹è¢«é‡æ–°å”¤é†’ã€‚

3ï¼‰äº’æ–¥

äº’æ–¥æŒ‡çš„æ˜¯ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºï¼Œæ˜¯è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜çš„æ€æ‰‹é”ã€‚

å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªå…±äº«å˜é‡çš„æ—¶å€™ï¼Œå¾ˆå®¹æ˜“å‡ºç°â€œçº¿ç¨‹å®‰å…¨â€é—®é¢˜ï¼Œå› ä¸ºç»“æœå¯èƒ½æ˜¯ä¸ç¡®å®šçš„â€”â€”å¯¼è‡´å‡ºç°è¿™ä¸ªé—®é¢˜çš„æ ¹æºå°±æ˜¯å¯è§æ€§ã€æœ‰åºæ€§å’ŒåŸå­æ€§â€”â€”ä¸ºäº†è§£å†³å®ƒä»¬ï¼ŒJava å¼•å…¥äº†å†…å­˜æ¨¡å‹çš„æ¦‚å¿µï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£â€œçº¿ç¨‹å®‰å…¨â€çš„é—®é¢˜ï¼Œä½†è¦æƒ³å®Œå…¨è§£å†³â€œçº¿ç¨‹å®‰å…¨â€é—®é¢˜ï¼Œè¿˜å¾—é äº’æ–¥ã€‚

äº’æ–¥çš„æ ¸å¿ƒæŠ€æœ¯å°±æ˜¯é”ï¼Œæ¯”å¦‚è¯´ synchronizedï¼Œè¿˜æœ‰å„ç§ Lockã€‚

é”å¯ä»¥è§£å†³çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œä½†åŒæ—¶ä¹Ÿå°±æ„å‘³ç€ç¨‹åºçš„æ€§èƒ½è¦å—åˆ°å½±å“ã€‚

å› æ­¤ï¼ŒJava æä¾›äº†é’ˆå¯¹ä¸åŒåœºæ™¯ä¸‹çš„é”ï¼Œæ¯”å¦‚è¯´è¯»å†™é” ReadWriteLockï¼Œå¯ä»¥è§£å†³å¤šçº¿ç¨‹åŒæ—¶è¯»ï¼Œä½†åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å†™çš„é—®é¢˜ï¼›ä½† ReadWriteLock ä¹Ÿæœ‰è‡ªå·±çš„é—®é¢˜ï¼Œå°±æ˜¯å¦‚æœæœ‰çº¿ç¨‹æ­£åœ¨è¯»ï¼Œå†™çº¿ç¨‹éœ€è¦ç­‰å¾…åº¦çº¿ç¨‹é‡Šæ”¾é”åæ‰èƒ½è·å¾—å†™é”ï¼Œä¹Ÿå°±æ˜¯è¯»çš„è¿‡ç¨‹ä¸­ä¸å…è®¸å†™ï¼Œå±äºä¸€ç§æ‚²è§‚çš„è¯»é”ã€‚

ä¸ºäº†è¿›ä¸€æ­¥æå‡å¹¶å‘æ‰§è¡Œçš„æ•ˆç‡ï¼ŒJava 8 å¼•å…¥äº†ä¸€ä¸ªæ–°çš„è¯»å†™é” StampedLockï¼Œä¸ReadWriteLock ç›¸æ¯”ï¼ŒStampedLockçš„ä¼˜åŠ¿åœ¨äºè¯»çš„è¿‡ç¨‹ä¸­ä¹Ÿå…è®¸è·å–å†™é”åå†™å…¥ï¼Œä½†å¸¦æ¥çš„é—®é¢˜å°±æ˜¯å¯èƒ½è¯»çš„æ•°æ®ä¸ä¸€è‡´ï¼Œéœ€è¦ä¸€ç‚¹é¢å¤–çš„ä»£ç æ¥åˆ¤æ–­è¯»çš„è¿‡ç¨‹ä¸­æ˜¯å¦æœ‰å†™å…¥ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ç§ä¹è§‚çš„é”ã€‚

ä¹è§‚é”çš„æ„æ€å°±æ˜¯ä¼°è®¡è¯»çš„è¿‡ç¨‹ä¸­å¤§æ¦‚ç‡ä¸ä¼šæœ‰å†™å…¥ï¼Œè€Œæ‚²è§‚é”åˆ™æ˜¯è¯»çš„è¿‡ç¨‹ä¸­æ‹’ç»æœ‰å†™å…¥ï¼Œä¸¤è€…çš„åŒºåˆ«å°±åœ¨äºæ€§èƒ½ä¸Šä¼šæœ‰å·®å¼‚ï¼Œä¹è§‚é”éœ€è¦é’ˆå¯¹å°æ¦‚ç‡äº‹ä»¶è¿›è¡Œå¤šä¸€æ­¥çš„æ£€æµ‹ï¼Œä½†æ€§èƒ½ä¹Ÿä¼šæœ‰æ‰€æå‡ï¼›æ‚²è§‚é”æ›´èƒ½ä¿è¯â€œçº¿ç¨‹å®‰å…¨æ€§â€ã€‚

å¬æˆ‘è¿™ä¹ˆä¸€è¯´ï¼Œæ˜¯ä¸æ˜¯ä¸€ä¸‹å­å°±æ¸…æ™°å¤šäº†ï¼

# ç¬¬åäº”ç« ï¼šJVMï¼ˆJava è™šæ‹Ÿæœºï¼‰

åŒæ ·é™äºã€ŠäºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯ã€‹.pdf ç¯‡å¹…çš„åŸå› ï¼Œç›®å‰å·²ç» 32 ä½™ä¸‡å­—ï¼Œæˆ‘ 32G å†…å­˜çš„ç”µè„‘ï¼Œæ¯æ¬¡æƒ³æ›´æ–°è¿™ä»½å°å†Œï¼Œéƒ½å—¡å—¡å—¡ç›´å«çš„å‰å®³ï¼äºŒå“¥çš„æŠ€æœ¯æ´¾å›¢é˜Ÿæˆå‘˜æ¥¼ä»”å‡ºå“çš„ã€ŠJVM æ‰‹å†Œã€‹ï¼Œæš‚æ—¶åªå¯¹ã€Š[æŠ€æœ¯æ´¾æ˜Ÿçƒï¼ˆæˆ³é“¾æ¥æœ‰ä¼˜æƒ åˆ¸ï¼‰](https://paicoding.com/article/detail/169)ã€‹ç”¨æˆ·å¼€æ”¾ï¼Œå¦‚æœä½ éœ€è¦è¿™ä»½ PDF å¹¶ä¸”æƒ³äº«å—æ›´å¤šæœåŠ¡çš„è¯ï¼Œå¯ä»¥æ‰«ç åŠ å…¥ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/jvm-20230410212958.png)

ä»‹ç»ä¸€ä¸‹æŠ€æœ¯æ´¾æ˜Ÿçƒæä¾›çš„æœåŠ¡å†…å®¹ï¼ŒæŠ€æœ¯æ´¾é¡¹ç›®å­¦ä¹ æ•™ç¨‹ï¼Œåç»­ä¼šé‡‡ç”¨è¿è½½çš„æ–¹å¼ï¼Œè®©ä½ ä» 0 åˆ° 1 ä¹Ÿèƒ½æ­å»ºä¸€å¥—è‡ªå·±çš„ç½‘ç«™ï¼›æŠ€æœ¯æ´¾é¡¹ç›®ç­”ç–‘è§£æƒ‘ï¼Œè®©ä½ å¿«é€Ÿä¸Šæ‰‹è¯¥é¡¹ç›®ï¼Œå°ç™½ä¹Ÿèƒ½æ‡‚ï¼›å‘æ¥¼ä»”ã€äºŒå“¥å’Œå¤§å‚å˜‰å®¾ 1 å¯¹ 1 äº¤æµæé—®ï¼Œå‘Šåˆ«è¿·èŒ«ï¼›ä¸ªäººæˆé•¿è·¯çº¿ã€èŒä¸šè§„åˆ’å’Œå»ºè®®ï¼Œå¸®åŠ©ä½ æœ‰è®¡åˆ’å­¦ä¹ ï¼›ç®€å†æŒ‡å¯¼ï¼Œè®©ä½ çš„ç®€å†ä¹Ÿèƒ½è„±é¢–è€Œå‡ºï¼Œæ”¶è·æ›´å¤šé¢è¯•æœºä¼šï¼›éœ€æ±‚æ–¹æ¡ˆã€æŠ€æœ¯æ¶æ„è®¾è®¡æä¾›å‚è€ƒå»ºè®®ï¼Œå¯¹æ ‡å¤§å‚ã€‚

è¿™æ˜¯ PDF çš„å¤§è‡´å†…å®¹ï¼Œæƒ³è¦åŠ å…¥æ˜Ÿçƒçš„ç”¨æˆ·ï¼Œå¯ä»¥æå‰æ„Ÿå—ä¸€ä¸‹ã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/jvm-20230410213258.png)

å¦‚æœä½ ä¸æƒ³ä»˜è´¹ï¼Œä¹Ÿæ²¡å…³ç³»ï¼Œä½ å®Œå…¨å¯ä»¥åˆ°ã€Š[äºŒå“¥çš„ Java è¿›é˜¶ä¹‹è·¯](https://tobebetterjavaer.com/home.html)ã€‹ç½‘ç«™æŸ¥çœ‹ JVM æ¿å—çš„å†…å®¹ï¼Œå†…å®¹è™½ç„¶ä¸åŒï¼Œä½†è´¨é‡ä¹Ÿæ˜¯å®Œå…¨æœ‰ä¿éšœã€‚

2020 å¹´çš„æ—¶å€™ï¼Œé€šè¯»äº†ä¸€éå‘¨å¿—æ˜è€å¸ˆçš„ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºï¼šJVM é«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µã€‹ç¬¬ä¸‰ç‰ˆï¼Œè¯»å®Œä¹‹åå—ç›ŠåŒªæµ…ï¼Œè¿™è®©æˆ‘å¯¹ Java è™šæ‹Ÿæœºæœ‰äº†ä¸€ä¸ªæ›´å®Œæ•´çš„è®¤è¯†ã€‚æ¯«æ— ç–‘é—®ï¼Œã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹æ˜¯ JVM ä¹¦ç±ä¸­æœ€å¥½çš„ä¸€æœ¬ä¹¦äº†ï¼Œå›½äº§æŠ€æœ¯ä¹¦çš„å¤©èŠ±æ¿ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xuexiluxian/java/jvm-7036a048-4034-4965-92a6-e35d0211ba71.png)

å¦‚æœè§‰å¾—è¿™æœ¬ä¹¦å¤ªåšäº†ï¼Œå¯ä»¥é˜…è¯»æˆ‘å…¬ä¼—å·ä¸Šçš„è¿™ç¯‡æ–‡ç« ï¼Œå¯¹ JVM ä¼šæœ‰ä¸€ä¸ªç³»ç»Ÿçš„æ¢³ç†ã€‚

[JVM æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“](https://mp.weixin.qq.com/s/zOdiefZpkpa2dxpcBLlc6A)

åœ¨é‡‘ä¸‰é“¶å››/é‡‘ä¹é“¶åçš„è·³æ§½å­£ä¸­ï¼Œå¾ˆå¤šå°ä¼™ä¼´éƒ½ä¼šå¿ä¸ä½è ¢è ¢æ¬²åŠ¨ï¼Œå…¶ä¸­ JVM æ›´æ˜¯é¢è¯•ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥æˆ‘èŠ±äº†å‡ å¤©çš„æ—¶é—´æ•´ç†äº†ä¸€æ¡ JVM çš„å­¦ä¹ è·¯çº¿ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°å¤§å®¶ã€‚

## ä¸€ã€ä¸ºä»€ä¹ˆè¦å­¦ä¹  JVMï¼Ÿ

æ›¾ç»æˆ‘å¯¹ JVM ä¹Ÿæ˜¯æ„Ÿåˆ°éå¸¸çš„å¤´ç—›ï¼Œå®Œå…¨æä¸æ‡‚è¯¥æ€ä¹ˆå…¥é—¨ï¼Œåªæ˜¯å¬è¯´ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹è¿™æœ¬ä¹¦å¾ˆåŠï¼Œä½†çœŸè¯»èµ·æ¥ï¼Œå´éœ€è¦æå¤§çš„è€å¿ƒå’Œå®šåŠ›ï¼Œå¦åˆ™å¾ˆå¿«å°±ä¼šåœ¨è¯»å®Œç¬¬ä¸€ç«  JVM çš„ç®€å²åæ”¾å¼ƒã€‚

é‚£é¦–å…ˆï¼Œæˆ‘ä»¬å°±è¦ææ¸…æ¥šï¼Œä¸ºä»€ä¹ˆè¦å­¦ä¹  JVM ï¼Ÿ

ç¬¬ä¸€ï¼Œå½“ç„¶æ˜¯é¢è¯•è¦è€ƒï¼Œè¿™ä¸€ç‚¹æ¯«æ— ç–‘é—®ï¼Œå°¤å…¶æ˜¯å¯¹äºè¦å‚åŠ æ ¡æ‹›çš„åº”å±Šç”Ÿæ¥è¯´ï¼ŒJVM æ˜¯ç»•ä¸è¿‡å»çš„ï¼Œå¿…é¡»å¾—å­¦ã€‚

ç¬¬äºŒï¼Œå¦‚æœä½ æƒ³æˆä¸ºå…¬å¸ä¸å¯æˆ–ç¼ºçš„é¡¶æ¢æŸ±ï¼Œé‚£ JVM ä½ å¾—å­¦ï¼Œå› ä¸ºä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé‡åˆ°çš„é—®é¢˜åŸºæœ¬ä¸Š Google ä¸‹å°±èƒ½è§£å†³äº†ï¼Œå¯ä¸€æ—¦é‡åˆ° JVM æ€§èƒ½è°ƒä¼˜ï¼Œå°±å¿…é¡»å¾—æœ‰èƒ½æŸ¥ OOM çš„åŸå› ã€èƒ½çœ‹æ‡‚å­—èŠ‚ç çš„è€é¸Ÿå‡ºé©¬äº†ã€‚

åº”ç”¨ç¨‹åºä¸€æ—¦ä¸Šçº¿ï¼Œå‡ºé—®é¢˜æ˜¯æ¿ä¸Šé’‰é’‰çš„äº‹ï¼Œé™¤äº†æ•°æ®åº“ã€ç½‘ç»œã€ä»£ç é€»è¾‘ä¸Šçš„é—®é¢˜ï¼Œå‰©ä¸‹çš„å°±æœ‰å†…å­˜æº¢å‡ºå•Šï¼Œé¢‘ç¹ GC å¯¼è‡´çš„æ€§èƒ½ç“¶é¢ˆå•Šç­‰æ£˜æ‰‹é—®é¢˜ã€‚

é‡åˆ°è¿™ç§é—®é¢˜ï¼Œä½ å°±å¿…é¡»å¾—èƒ½çœ‹æ‡‚ GC æ—¥å¿—ï¼Œæ˜ç™½ä»€ä¹ˆæ˜¯è€å¹´ä»£ã€æ°¸ä¹…ä»£ã€å…ƒæ•°æ®åŒºç­‰ï¼Œè¿™äº›éƒ½æ˜¯ Java è™šæ‹Ÿæœºæ–¹é¢çš„çŸ¥è¯†ã€‚

æ˜ç™½äº†å­¦ä¹  JVM çš„é‡è¦æ€§ï¼Œé‚£æˆ‘ä»¬å°±å¼€æå§ï¼

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xuexiluxian/java/jvm-4cbbdc72-3bdd-4b14-9d8d-ecd7764afb11.png)


## äºŒã€JVM å­¦ä¹ è·¯çº¿å›¾

è¿™æ˜¯æˆ‘æœ€è¿‘æ•´ç†çš„ä¸€å¼ å…³äº JVM çš„æ€ç»´å¯¼å›¾ï¼Œå¤§çš„æ–¹å‘å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šå­—èŠ‚ç ä¸ç±»çš„åŠ è½½ã€å†…å­˜ä¸åƒåœ¾å›æ”¶ã€æ€§èƒ½ç›‘æ§å’Œè°ƒä¼˜ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xuexiluxian/java/jvm-b4ec034b-9f20-40b9-a2a3-e77afffd2abf.png)

å­—èŠ‚ç ä¸ç±»çš„åŠ è½½åŒ…æ‹¬ï¼š

- ç±»çš„åŠ è½½æœºåˆ¶ï¼ˆç±»çš„åŠ è½½è¿‡ç¨‹ã€ç±»åŠ è½½å™¨ã€åŒäº²å§”æ´¾æ¨¡å‹ï¼‰
- å­—èŠ‚ç ï¼ˆç±»æ–‡ä»¶ç»“æ„ã€å­—èŠ‚ç æŒ‡ä»¤ã€å­—èŠ‚ç æ‰§è¡Œå¼•æ“ã€å®æˆ˜å­—èŠ‚ç ï¼‰

å†…å­˜ä¸åƒåœ¾å›æ”¶åŒ…æ‹¬ï¼š

- JVM å†…å­˜ç»“æ„
- åƒåœ¾å›æ”¶ç®—æ³•
- åƒåœ¾å›æ”¶æœºåˆ¶
- åƒåœ¾æ”¶é›†å™¨

æ€§èƒ½ç›‘æ§å’Œè°ƒä¼˜åŒ…æ‹¬ï¼š

- è°ƒä¼˜æŒ‡æ ‡
- è°ƒä¼˜å¯¹è±¡
- è°ƒä¼˜å·¥å…·
- JIT ä¼˜åŒ–

æœ‰ç†è®ºçŸ¥è¯†ï¼Œæœ‰åŠ¨æ‰‹å®æˆ˜ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥æŠŠ JVM è¿™å—å­¦çš„éå¸¸æ‰å®äº†ã€‚


## ä¸‰ã€ç¡¬æ ¸ JVM å­¦ä¹ èµ„æ–™

### **1ï¼‰Javaè¿›é˜¶ä¹‹è·¯**

å­¦ Javaï¼Œæ€ä¹ˆèƒ½å°‘å¾—äº†ã€ŠäºŒå“¥çš„Javaè¿›é˜¶ä¹‹è·¯ã€‹ï¼Œç½‘å€æˆ‘è´´ä¸‹é¢äº†å“ˆï¼š

>[https://tobebetterjavaer.com/home.html](https://tobebetterjavaer.com/home.html)

è¿›å»ç›´æ¥æ‰¾ã€ŒJava æ ¸å¿ƒã€é‡Œé¢çš„ Java è™šæ‹Ÿæœºå°±å¯¹äº†ã€‚æˆ‘æŒ‰ç…§å‰é¢çš„æ€ç»´å¯¼å›¾æ•´ç†äº† 19 ç¯‡æ–‡ç« ï¼Œå…¨éƒ¨éƒ½æ˜¯ç¡¬æ ¸çº§åˆ«çš„ï¼Œè·Ÿç€å­¦å°±å¯¹äº†ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xuexiluxian/java/jvm-cc84fead-278b-46aa-a8ab-a3b07acefc12.png)

### **2ï¼‰è§†é¢‘**

æ‡‚çš„éƒ½æ‡‚ï¼Œçœ‹è§†é¢‘åˆ° B ç«™ã€‚å…ˆæ¨èå®‹çº¢åº·è€å¸ˆçš„ JVM å…¨å¥—æ•™ç¨‹ï¼Œ200å¤šä¸‡çš„æ’­æ”¾é‡ï¼Œè¿˜æ˜¯éå¸¸å—æ¬¢è¿çš„ã€‚å…¨å¥—è¯¾ç¨‹åˆ†ä¸ºï¼š

- å†…å­˜ä¸åƒåœ¾å›æ”¶ç¯‡
- å­—èŠ‚ç ä¸ç±»çš„åŠ è½½ç¯‡
- æ€§èƒ½ç›‘æ§å’Œè°ƒä¼˜ç¯‡

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xuexiluxian/java/jvm-59c829ce-7fe3-45a5-b074-35dacb08941e.png)

>è§†é¢‘åœ°å€ï¼š[https://www.bilibili.com/video/BV1PJ411n7xZ](https://www.bilibili.com/video/BV1PJ411n7xZ)

å‹æƒ…æç¤ºï¼Œå¯¹äºæ‰¾å·¥ä½œé¢è¯•çš„å°ä¼™ä¼´ï¼Œçœ‹ p01-p203ã€p266-301 å°±å¤Ÿäº†ï¼

è¿˜æœ‰é»‘é©¬çš„è¿™ä»½ JVM è§†é¢‘æ•™ç¨‹ï¼Œ1 ä¸‡+çš„ç‚¹èµé‡ï¼Œç¡®å®å¾ˆç‰›é€¼äº†ã€‚

- 1. JVM å†…å­˜ç»“æ„çš„ç»„æˆã€å„éƒ¨åˆ†åŠŸèƒ½ä½œç”¨ï¼Œå­¦ä¼šåˆ©ç”¨å†…å­˜è¯Šæ–­å·¥å…·æ’æŸ¥å†…å­˜ç›¸å…³é—®é¢˜ï¼›
- 2. JVM çš„æ‹›ç‰ŒåŠŸèƒ½-åƒåœ¾å›æ”¶æœºåˆ¶æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œå¦‚ä½•è¿›è¡Œåƒåœ¾å›æ”¶è°ƒä¼˜ï¼›
- 3. Java ç¨‹åºä»ç¼–è¯‘ä¸ºå­—èŠ‚ç åˆ°åŠ è½½åˆ°è¿è¡Œçš„å…¨æµç¨‹ï¼Œå„ä¸ªé˜¶æ®µçš„ä¼˜åŒ–å¤„ç†ï¼›
- 4. äº†è§£ Java å†…å­˜æ¨¡å‹ç›¸å…³çŸ¥è¯†ï¼Œè§è¯†å¤šçº¿ç¨‹å¹¶å‘è¯»å†™å…±äº«æ•°æ®æ—¶çš„é—®é¢˜å’Œ Java çš„è§£å†³æ–¹æ¡ˆã€‚

![](https://cdn.tobebetterjavaer.com/stutymore/jvm-20230410211836.png)

>è§†é¢‘åœ°å€ï¼š[https://www.bilibili.com/video/BV1yE411Z7AP](https://www.bilibili.com/video/BV1yE411Z7AP)

å†æ¨èä¸€ä¸ªç‹‚ç¥è¯´çš„ï¼Œ40å¤šä¸‡çš„æ’­æ”¾é‡ï¼Œç®—æ˜¯ä¸€ä¸ªé¢å‘ JVM é¢è¯•çš„çªå‡»ç‰ˆã€‚åƒä¸€äº›å¸¸è§çš„ JVM é¢è¯•é¢˜ï¼Œè§†é¢‘é‡Œéƒ½æœ‰è®²åˆ°ï¼Œæ¯”å¦‚è¯´ï¼š

- ä»€ä¹ˆæ˜¯ JVMï¼Ÿ
- è¯´ä¸€è¯´ç±»åŠ è½½å™¨ï¼Ÿ
- æ ˆå’Œå †çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ
- JDK 8 å’Œä¹‹å‰å‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ–ï¼Ÿ
- æ–°ç”Ÿä»£å’Œè€å¹´ä»£æ˜¯å¹²å˜›çš„ï¼Ÿ
- FromåŒºå’Œ ToåŒºä»€ä¹ˆåŒºåˆ«ï¼Ÿ
- å¦‚ä½•æ’æŸ¥ OOMï¼Ÿ
- è¯´è¯´åƒåœ¾å›æ”¶ç®—æ³•
- è¯´è¯´  JVM å†…å­˜ç»“æ„ 

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xuexiluxian/java/jvm-be0910d8-7669-46cb-b8b9-2399162e723d.png)

>è§†é¢‘åœ°å€ï¼š[https://www.bilibili.com/video/BV1iJ411d7jS](https://www.bilibili.com/video/BV1iJ411d7jS)

### **3ï¼‰ä¹¦ç±**

çº¸è´¨ä¹¦åªæ¨èä¸€æœ¬å‘¨å¿—æ˜è€å¸ˆçš„ç¥ä¹¦ã€Š[æ·±å…¥ç†è§£ Java è™šæ‹Ÿæœº](https://book.douban.com/subject/34907497/)ã€‹ï¼ŒåŸºæœ¬ä¸Šå­¦ä¹  JVM çš„å°ä¼™ä¼´äººæ‰‹ä¸€æœ¬ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xuexiluxian/java/jvm-3f6065c5-2fbf-4107-804e-393b32a4f9ab.png)

è¿™æ˜¯ä¸€éƒ¨ä»å·¥ä½œåŸç†å’Œå·¥ç¨‹å®è·µä¸¤ä¸ªç»´åº¦æ·±å…¥å‰–æJVMçš„è‘—ä½œï¼Œæ˜¯è®¡ç®—æœºé¢†åŸŸå…¬è®¤çš„ç»å…¸ã€‚

å…¨ä¹¦åˆ†ä¸ºäº”ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†ä¸ºèµ°è¿‘ Javaï¼Œä¸»è¦æ˜¯å¯¹ JVM çš„å‘å±•å†å²è¿›è¡Œäº†ä»‹ç»ï¼Œå…¶ä¸­ç¬¬äºŒéƒ¨åˆ†è‡ªåŠ¨å†…å­˜ç®¡ç†å’Œç¬¬ä¸‰éƒ¨åˆ†è™šæ‹Ÿæœºæ‰§è¡Œå­ç³»ç»Ÿéœ€è¦é‡ç‚¹æŒæ¡ï¼Œè¿™ä¸¤éƒ¨åˆ†çš„å†…å®¹ä¹Ÿæ˜¯æœ€å¤šçš„ã€‚

ç¬¬å››éƒ¨åˆ†ç¨‹åºç¼–è¯‘ä¸ä»£ç ä¼˜åŒ–ä¸­éœ€è¦é‡ç‚¹æŒæ¡çš„æ˜¯ JIT éƒ¨åˆ†ï¼Œç¬¬äº”éƒ¨åˆ†é«˜æ•ˆå¹¶å‘æœ€å¥½å’Œ[Java å¹¶å‘ç¼–ç¨‹](https://tobebetterjavaer.com/xuexiluxian/java/thread.html)ï¼ˆæˆ‘å‰é¢ä¹Ÿåšäº†å­¦ä¹ è·¯çº¿çš„æ€»ç»“ï¼‰è¿™å—å†…å®¹ç»“åˆèµ·æ¥å­¦ä¹ ã€‚

å¯ä»¥é…åˆ GitHub ä¸Šè¿™ä¸ªå¼€æºçš„é˜…è¯»ç¬”è®°å­¦ä¹ ï¼š

>[https://github.com/TangBean/understanding-the-jvm](https://github.com/TangBean/understanding-the-jvm)

### **4ï¼‰å¼€æºç”µå­ä¹¦**

æ¨è doocs ç¤¾åŒºçš„ [JVM åº•å±‚åŸç†æœ€å…¨çŸ¥è¯†æ€»ç»“](https://doocs.github.io/jvm/)ï¼Œç®—æ˜¯ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹è¿™æœ¬ä¹¦çš„ä¸€ä¸ªç²¾ç®€çŸ¥è¯†ç‚¹æ¢³ç†ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xuexiluxian/java/jvm-f2e2e5c4-c193-4af5-b1bc-fea8df2006af.png)


>GitHub åœ°å€ï¼š[https://github.com/doocs/jvm](https://github.com/doocs/jvm)

è€ƒè™‘åˆ°æœ‰äº›å°ä¼™ä¼´å¯èƒ½éœ€è¦ PDF ç‰ˆæœ¬ï¼Œæˆ‘éƒ½æ•´ç†å¥½äº†ï¼Œéœ€è¦çš„å°ä¼™ä¼´è¯·æ‰«æä¸‹æ–¹çš„äºŒç»´ç å…³æ³¨ä½œè€…çš„åŸåˆ›å…¬ä¼—å·ã€Œ**æ²‰é»˜ç‹äºŒ**ã€å›å¤å…³é”®å­—ã€Œ**java**ã€å°±å¯ä»¥æ‹‰å–åˆ°äº†ã€‚

![æ‰«ç å…³æ³¨åå›å¤ã€Œjavaã€å…³é”®å­—](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/gongzhonghao.png)

å†æ¨èä¸€ä»½ GitHub ä¸Šå¼€æºçš„ Java è™šæ‹ŸæœºçŸ¥è¯†ç‚¹æ€»ç»“ï¼š

>[https://github.com/heibaiying/Full-Stack-Notes/blob/master/notes/Java_è™šæ‹Ÿæœº.md](https://github.com/heibaiying/Full-Stack-Notes/blob/master/notes/Java_è™šæ‹Ÿæœº.md)

ä¸ºäº†æ–¹ä¾¿å¤§å®¶çš„å­¦ä¹ ï¼Œæˆ‘ä¹Ÿå°†å…¶æ•´ç†æˆäº† PDFï¼Œå†…å®¹åŒ…å«äº† Java å†…å­˜åŒºåŸŸã€åƒåœ¾æ”¶é›†ç®—æ³•ã€ç»å…¸åƒåœ¾æ”¶é›†å™¨ã€è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶ã€ç¨‹åºç¼–è¯‘å’Œä»£ç ä¼˜åŒ–ï¼Œæ‰‹ç»˜å›¾ä¹Ÿéå¸¸çš„æ¼‚äº®ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xuexiluxian/java/jvm-2beabbe4-2ddd-4180-8690-1bc3224e6b41.png)

éœ€è¦çš„å°ä¼™ä¼´å¯ä»¥å¾®ä¿¡æœç´¢ã€Œ**æ²‰é»˜ç‹äºŒ**ã€å›å¤å…³é”®å­—ã€Œ**java**ã€å°±å¯ä»¥æ‹‰å–åˆ°äº†ã€‚

### **5ï¼‰ä»˜è´¹ä¸“æ **

éƒ‘é›¨è¿ªè€å¸ˆåœ¨æå®¢æ—¶é—´ä¸Šå¼€äº†ä¸€é—¨ã€Šæ·±å…¥æ‹†è§£Javaè™šæ‹Ÿæœºã€‹çš„ä»˜è´¹ä¸“æ ï¼Œè´¨é‡è¿˜æ˜¯æŒºé«˜çš„ï¼Œå–œæ¬¢çš„å°ä¼™ä¼´å¯ä»¥æˆ³[é“¾æ¥](http://gk.link/a/11htX)å»è´­ä¹°ï¼Œåæ­£æˆ‘è‡ªå·±æ„Ÿè§‰è´¨é‡è¿˜ä¸é”™ã€‚

<a href="http://gk.link/a/11htX" target="_blank">
<img src="https://cdn.tobebetterjavaer.com/stutymore/jvm-20230410212606.png" />
</a>

## å››ã€JVM å…«è‚¡æ–‡

è¿™é‡Œç»™å¤§å®¶æ¨èä¸¤ä»½ Java è™šæ‹Ÿæœºæ–¹é¢çš„å…«è‚¡æ–‡ï¼Œä¸€ä»½æ¥è‡ªè¯»è€…[ä¸‰åˆ†æ¶](https://tobebetterjavaer.com/sidebar/sanfene/jvm.html)ï¼Œä¸€ä»½æ¥è‡ªè¯»è€…å°ç‰›ï¼Œå…ˆæˆªå›¾ç»™å¤§å®¶çœ‹ä¸€ä¸‹ Java è™šæ‹Ÿæœºçš„ç†è§£ç‰ˆå…«è‚¡æ–‡ï¼Œå›¾æ–‡å¹¶èŒ‚ï¼Œéå¸¸å®¹æ˜“æ¶ˆåŒ–å’Œå¸æ”¶ã€‚

![](https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/xuexiluxian/java/jvm-a11893df-e518-4bdc-a166-884b168a8cf0.png)


ä¸ºäº†æ–¹ä¾¿å¤§å®¶çš„é˜…è¯»å’ŒèƒŒè¯µï¼Œæˆ‘å·²ç»å°†å…¶æ•´ç†åˆ°äº†ã€ŠäºŒå“¥çš„Javaè¿›é˜¶ä¹‹è·¯ã€‹ä¸Šï¼Œé¢æ¸£é€†è¢­ Java è™šæ‹Ÿæœºç¯‡ï¼š

>[https://tobebetterjavaer.com/sidebar/sanfene/jvm.html](https://tobebetterjavaer.com/sidebar/sanfene/jvm.html)

Java è™šæ‹Ÿæœºå…«è‚¡æ–‡ï¼ˆèƒŒè¯µç‰ˆï¼‰ï¼š

>[https://tobebetterjavaer.com/baguwen/jvm.html](https://tobebetterjavaer.com/baguwen/jvm.html)

è¯šå®ç‚¹è¯´ï¼Œå¦‚æœèƒ½æŠŠè¿™ä¸¤ä»½å…«è‚¡æ–‡èƒŒä¼š/ç†è§£çš„è¯ï¼Œç®€å†ä¸Šå°±çœŸçš„æ•¢å†™â€œç²¾é€šâ€Java è™šæ‹Ÿæœºäº†ã€‚

## äº”ã€å­¦ä¹  JVM çš„ä¸€ç‚¹å°å¿ƒå¾—

å’Œ C++ ç›¸æ¯”ï¼ŒJava çš„å†…å­˜ç®¡ç†æœºåˆ¶å¯ä»¥è¯´æ˜¯ä¸€å¤§ç‰¹è‰²ï¼ŒJava å¼€å‘ä¸å†éœ€è¦è‡ªå·±å»å†™ä»£ç æ‰‹åŠ¨é‡Šæ”¾å†…å­˜ï¼Œç”šè‡³ä½ æƒ³è‡ªå·±å¹²ï¼ŒJVM éƒ½ä¸ç»™ä½ è¿™ä¸ªæœºä¼šï¼Œè™šæ‹Ÿæœºå®Œå…¨æŒæ¡äº† Java å†…å­˜çš„æ§åˆ¶æƒã€‚

è¿™çœ‹èµ·æ¥æŒºç¾å¥½çš„ï¼Œä½†å¹¶ä¸æ„å‘³ç€Java å¼€å‘å°±å¯ä»¥éšæ„å†™ä»£ç ï¼Œéšæ„ä½¿ç”¨å†…å­˜ï¼Œä»æˆ‘å¤šå¹´çš„ä½¿ç”¨ä½“éªŒæ¥çœ‹ï¼Œå†…å­˜æº¢å‡ºå’Œå†…å­˜æ³„éœ²è¿˜æ˜¯ä¼šæ—¶ä¸æ—¶å‘ç”Ÿçš„ï¼Œå°¤å…¶æ˜¯åˆå­¦é˜¶æ®µï¼Œå°¤å…¶åœ¨å¼€å¯å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ã€‚

ä¸€æ—¦å‡ºç°å†…å­˜æº¢å‡ºæˆ–è€…å†…å­˜æ³„éœ²ï¼Œæ’æŸ¥é—®é¢˜è¿˜æ˜¯æŒºå›°éš¾çš„ï¼Œæ‰€ä»¥çŸ¥é“é€Šå°¼åŸºåˆ°åº•æ˜¯æ€ä¹ˆç®¡ç†å†…å­˜çš„å°±å˜å¾—ååˆ†é‡è¦äº†ã€‚

[JVM çš„åƒåœ¾å›æ”¶](https://tobebetterjavaer.com/jvm/gc.html)ï¼Œå…¶å®å°±æ˜¯æ”¶æ‹¾é‚£äº›ä¸å†ä½¿ç”¨çš„ Java å¯¹è±¡ï¼ŒæŠŠä»–ä»¬æ›¾ç»å ç”¨çš„å†…å­˜é‡æ–°é‡Šæ”¾å‡ºæ¥ã€‚æ‰€ä»¥æˆ‘ä»¬è¦ææ¸…æ¥šï¼š

- [å¯¹è±¡æ˜¯å¦‚ä½•åˆ›å»ºçš„](https://tobebetterjavaer.com/jvm/whereis-the-object.html)ï¼Ÿå¯¹è±¡æ˜¯å¦‚ä½•è¢«è®¿é—®çš„ï¼Ÿåˆ°åº•å“ªäº›å¯¹è±¡æ˜¯åºŸå¼ƒçš„ï¼Ÿäºæ˜¯æˆ‘ä»¬å°±éœ€è¦ææ¸…æ¥šå¯¹è±¡çš„ç”Ÿå’Œæ­»ã€‚
- è¿™äº›åºŸå¼ƒäº†çš„å¯¹è±¡åˆ°åº•æ”¾åœ¨å“ªï¼Ÿäºæ˜¯å°±éœ€è¦äº†è§£[JVM çš„å†…å­˜ç»“æ„](https://tobebetterjavaer.com/jvm/neicun-jiegou.html)ï¼šæ–¹æ³•åŒºã€å †ã€ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆã€‚
- è¿™äº›åºŸå¼ƒäº†çš„å¯¹è±¡ä¼šä¸ä¼šé€ æˆå†…å­˜æ³„éœ²ï¼ˆOOMï¼ŒOutOfMemoryErrorï¼‰ï¼Ÿäºæ˜¯æˆ‘ä»¬å°±éœ€è¦äº†è§£æ¯ä¸ªåˆ†åŒºçš„ OOMã€‚
- è¿™äº›åºŸå¼ƒäº†å¯¹è±¡ä»€ä¹ˆæ—¶å€™è¢«å›æ”¶ï¼Ÿäºæ˜¯æˆ‘ä»¬å°±éœ€è¦äº†è§£åƒåœ¾å›æ”¶ç®—æ³•ï¼Œæ¯”å¦‚è¯´æ¸…é™¤ç®—æ³•ã€å¤åˆ¶ç®—æ³•ã€æ ‡è®°æ•´ç†ç®—æ³•å’Œåˆ†ä»£æ”¶é›†ç®—æ³•ã€‚

çŸ¥é“äº†ä¸€ä¸ªå¯¹è±¡åœ¨å†…å­˜ä¸­çš„ç”Ÿå’Œæ­»ï¼Œæˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“ç±»æ˜¯å¦‚ä½•åœ¨å†…å­˜ä¸­å˜æˆå¯¹è±¡çš„ï¼Ÿå¯¹è±¡çš„æ–¹æ³•æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ

äºæ˜¯æˆ‘ä»¬å¼€å§‹å­¦ä¹  Java è™šæ‹Ÿæœºçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå­¦ä¹ [å­—èŠ‚ç æ–‡ä»¶](https://tobebetterjavaer.com/jvm/class-file-jiegou.html)ï¼ˆ .class æ–‡ä»¶ï¼‰ï¼Œå­¦ä¹ [ç±»çš„åŠ è½½æœºåˆ¶](https://tobebetterjavaer.com/jvm/class-load.html)ï¼Œå­¦ä¹ [è™šæ‹Ÿæœºæ ˆçš„æ ˆå¸§ç»“æ„](https://tobebetterjavaer.com/jvm/how-jvm-run-zijiema-zhiling.html)ï¼Œå­¦ä¹ æ–¹æ³•çš„è°ƒç”¨è¿‡ç¨‹ï¼Œå­¦ä¹ [å­—èŠ‚ç æŒ‡ä»¤](https://tobebetterjavaer.com/jvm/zijiema-zhiling.html)ç­‰ç­‰ã€‚

ä¸ºäº†ç›‘æ§è™šæ‹Ÿæœºå’Œæ•…éšœæ’æŸ¥ï¼Œæˆ‘ä»¬éœ€è¦å­¦ä¹ [å¸¸ç”¨çš„ JDK å‘½ä»¤è¡Œå·¥å…·](https://tobebetterjavaer.com/jvm/problem-tools.html)ï¼ŒæŒæ¡å¿…è¦çš„çº¿ä¸Šé—®é¢˜æ’æŸ¥æ–¹æ³•ï¼›æ­¤å¤–ï¼Œè¿˜éœ€è¦äº†è§£ JIT (Just In Time)å¹¶ä¸æ˜¯ç®€å•çš„å°†çƒ­ç‚¹ä»£ç ç¼–è¯‘æˆæœºå™¨ç å°±æ”¶å·¥çš„ï¼Œå®ƒè¿˜ä¼šå¯¹ä»£ç çš„æ‰§è¡Œè¿›è¡Œä¼˜åŒ–ï¼ˆ[æ–¹æ³•å†…è”å’Œé€ƒé€¸åˆ†æ](https://tobebetterjavaer.com/jvm/jit.html)ï¼‰ã€‚

JVM ç›¸å…³çš„çŸ¥è¯†å·²ç»æˆä¸ºé¢è¯•å¿…è€ƒçš„ç§‘ç›®äº†ï¼Œä½†è€å®è®²ï¼ŒJVM ç›¸å…³çš„çŸ¥è¯†è¿˜çœŸçš„ä¸å¤ªå¥½ç”¨åœ¨é¡¹ç›®ä¸­ï¼Œæˆ–è€…è¯´ä¸å¤ªå¥½åœ¨é¡¹ç›®ä¸­ä½“ç°å‡ºæ¥ã€‚

é‚£è¿™é‡Œç»™å¤§å®¶æ¨èä¸€ä¸ªå®æˆ˜é¡¹ç›®ï¼ŒåŸºäº Spring Boot çš„åœ¨çº¿ Java IDEï¼Œå¯ä»¥è¿œç¨‹æ‰§è¡Œ Java ä»£ç å¹¶å°†ç¨‹åºçš„è¿è¡Œç»“æœåé¦ˆå‡ºæ¥ã€‚æ¶‰åŠäº† Java ç±»æ–‡ä»¶çš„ç»“æ„ã€Java ç±»åŠ è½½å™¨å’Œ Java ç±»çš„çƒ­æ›¿æ¢ç­‰ JVM ç›¸å…³çš„æŠ€æœ¯ã€‚

>[https://github.com/TangBean/OnlineExecutor](https://github.com/TangBean/OnlineExecutor)

å¬æˆ‘è¿™ä¹ˆä¸€è¯´ï¼Œæ˜¯ä¸æ˜¯ä¸€ä¸‹å­å°±æ¸…æ™°å¤šäº†ï¼

**Java è™šæ‹Ÿæœºè™½ç„¶éš¾å­¦ï¼Œä½†å¦‚æœä½ èƒ½åšæŒå­¦ä¸‹å»ï¼Œå†…åŠŸè‡ªç„¶è€Œç„¶å°±æå‡äº†ä¸€å¤§æˆª**ã€‚

